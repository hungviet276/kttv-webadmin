<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>Thông tin báo cáo</title>
</head>
<body id="view_chart_body">
</body>
<script src="/admin_lte/plugins/jquery/jquery.min.js"></script>
<script th:inline="javascript">

    /*<![CDATA[*/
    const listParameterTypeId = /*[[${listParameterTypeId}]]*/;
    const stationCode = /*[[${stationCode}]]*/;
    const startDate = /*[[${startDate}]]*/;
    const endDate = /*[[${endDate}]]*/;
    /*]]>*/
    var apiUrl = /*[[${session.apiUrl}]]*/;
    var token = /*[[${session.token}]]*/;
    // ve chart
    function displayChart(data, type) {
        let divWrap = $('<div style="position: relative; width: 100%; height: 500px; min-height: 500px;">');
        let iframe = $('<iframe>');
        let urlChart = '/report/parameter';
        iframe.attr('src', encodeURI(urlChart + '?stationCode=' + stationCode + '&parameterTypeId=' + data.chartMapping.parameterTypeId  + '&type='+ type + '&startDate=' + startDate + '&endDate=' + endDate));
        iframe.attr('width', '100%');
        iframe.attr('height', '500');
        divWrap.append(iframe);
        $('#view_chart_body').append(divWrap);
    }
    // lay du lieu hien thi len view
    for (let i = 0; i < listParameterTypeId.length; i++) {
        let parameterData = listParameterTypeId[i].split('_');
        let parameterTypeId = parameterData[0];
        let type = parameterData.length > 1 ? parameterData[1]: "";
        let dataReq = {
            stationCode: stationCode,
            parameterTypeId: parameterTypeId,
            type: type,
            startDate: startDate,
            endDate: endDate
        };
        $.ajax({
            headers: {
                'Authorization': token
            },
            url: apiUrl + "report/get-parameter-chart-mapping-and-data",
            method: 'POST',
            async: false,
            contentType: 'application/json',
            data: JSON.stringify(dataReq),
            success: function (data) {
                displayChart(data, type);
            },
            error: function (e) {
                console.log(e)
            }
        })
    }
</script>
</html>