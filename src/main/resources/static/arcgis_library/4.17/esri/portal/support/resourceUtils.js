// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../request ../../core/Error ../../core/maybe ../../core/urlUtils ../../core/urlUtils".split(" "),function(F,c,d,D,v,m,n,w){function x(a){var b=a.lastIndexOf("/");return-1===b?[".",a]:[a.slice(0,b),a.slice(b+1)]}function e(a){var b;b=w.getPathExtension(a);b=m.isNone(b)?[a,""]:[a.slice(0,a.length-b.length-1),"."+b];a=b[1];b=x(b[0]);return[b[0],b[1],a]}function y(a){return d.__awaiter(this,void 0,void 0,function(){var b;return d.__generator(this,function(c){switch(c.label){case 0:return a instanceof
Blob?[2,a]:[4,D(a.url,{responseType:"blob"})];case 1:return b=c.sent(),[2,b.data]}})})}function z(a){if(a instanceof Blob)return a.type;a=w.getPathExtension(a.url);return f[a]||A}Object.defineProperty(c,"__esModule",{value:!0});c.resourceContentExtension=c.resourceContentType=c.getSiblingOfSameTypeI=c.getSiblingOfSameType=c.contentToBlob=c.splitPrefixFileNameAndExtension=c.removeAllResources=c.removeResource=c.addOrUpdateResource=c.fetchResources=void 0;c.fetchResources=function(a,b,c){void 0===b&&
(b={});return d.__awaiter(this,void 0,void 0,function(){var k,h,B,l,C,p,g,r,e,f,q;return d.__generator(this,function(d){switch(d.label){case 0:return[4,a.load(c)];case 1:return d.sent(),k=n.join(a.itemUrl,"resources"),h=b.start,B=void 0===h?1:h,l=b.num,C=void 0===l?10:l,p=b.sortOrder,g=void 0===p?"asc":p,r=b.sortField,e=void 0===r?"created":r,f={query:{start:B,num:C,sortOrder:g,sortField:e},signal:m.get(c,"signal")},[4,a.portal._request(k,f)];case 2:return q=d.sent(),[2,{total:q.total,nextStart:q.nextStart,
resources:q.resources.map(function(b){return{created:new Date(b.created),size:b.size,resource:a.resourceFromPath(b.resource)}})}]}})})};c.addOrUpdateResource=function(a,b,c,k){return d.__awaiter(this,void 0,void 0,function(){var h,e,l,f,p,g;return d.__generator(this,function(d){switch(d.label){case 0:if(!a.hasPath())throw new v("portal-item-resource-"+b+":invalid-path","Resource does not have a valid path");return[4,a.portalItem.load(k)];case 1:return d.sent(),h=n.join(a.portalItem.userItemUrl,"add"===
b?"addResources":"updateResources"),e=x(a.path),l=e[0],f=e[1],[4,y(c)];case 2:return p=d.sent(),g=new FormData,l&&"."!==l&&g.append("resourcesPrefix",l),g.append("fileName",f),g.append("file",p,f),g.append("f","json"),m.isSome(k)&&k.access&&g.append("access",k.access),[4,a.portalItem.portal._request(h,{method:"post",body:g,signal:m.get(k,"signal")})];case 3:return d.sent(),[2,a]}})})};c.removeResource=function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var h;return d.__generator(this,
function(d){switch(d.label){case 0:if(!b.hasPath())throw new v("portal-item-resources-remove:invalid-path","Resource does not have a valid path");return[4,a.load(c)];case 1:return d.sent(),h=n.join(a.userItemUrl,"removeResources"),[4,a.portal._request(h,{method:"post",query:{resource:b.path},signal:m.get(c,"signal")})];case 2:return d.sent(),b.portalItem=null,[2]}})})};c.removeAllResources=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c;return d.__generator(this,function(d){switch(d.label){case 0:return[4,
a.load(b)];case 1:return d.sent(),c=n.join(a.userItemUrl,"removeResources"),[2,a.portal._request(c,{method:"post",query:{deleteAll:!0},signal:m.get(b,"signal")})]}})})};c.splitPrefixFileNameAndExtension=e;c.contentToBlob=y;c.getSiblingOfSameType=function(a,b){if(!a.hasPath())return null;var c=e(a.path);return a.portalItem.resourceFromPath(n.join(c[0],b+c[2]))};c.getSiblingOfSameTypeI=function(a,b){if(!a.hasPath())return null;var c=e(a.path);return a.portalItem.resourceFromPath(n.join(c[0],b+c[2]))};
c.resourceContentType=z;c.resourceContentExtension=function(a){return t[z(a)]||E};var f={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"},t={},u;for(u in f)t[f[u]]=u;var A="text/plain",E=t[A]});