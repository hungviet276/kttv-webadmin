// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../request ../../core/Error ../../core/maybe ../../core/promiseUtils ../../layers/support/lazyLayerLoader ../PortalItem ./portalItemUtils".split(" "),function(G,f,c,u,v,w,k,x,n,p){function q(a){switch(a.type){case "Map Service":return y(a);case "Feature Service":return z(a);case "Feature Collection":return A(a);case "Scene Service":return B(a);case "Image Service":return C(a);case "Stream Service":return{className:"StreamLayer"};case "Vector Tile Service":return{className:"VectorTileLayer"};
case "KML":return{className:"KMLLayer"};case "WMTS":return{className:"WMTSLayer"};case "WMS":return{className:"WMSLayer"};default:return k.reject(new v("portal:unknown-item-type","Unknown item type '${type}'",{type:a.type}))}}function D(a){return(0,x.layerLookupMap[a.className])().then(function(b){return{constructor:b,properties:a.properties}})}function y(a){return E(a).then(function(a){return a?{className:"TileLayer"}:{className:"MapImageLayer"}})}function z(a){return r(a).then(function(a){if("object"===
typeof a){var b={};null!=a.id&&(b.layerId=a.id);return{className:"FeatureLayer",properties:b}}return{className:"GroupLayer"}})}function B(a){return r(a).then(function(b){if("object"===typeof b){var g={},e=void 0;null!=b.id?(g.layerId=b.id,e=a.url+"/layers/"+b.id):e=a.url;if(Array.isArray(a.typeKeywords)&&0<a.typeKeywords.length){b={IntegratedMesh:"IntegratedMeshLayer","3DObject":"SceneLayer",Point:"SceneLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};for(var d=0,h=Object.keys(b);d<
h.length;d++){var c=h[d];if(-1!==a.typeKeywords.indexOf(c))return{className:b[c]}}}return m(e).then(function(a){var b="SceneLayer",d={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};a&&a.layerType&&d[a.layerType]&&(b=d[a.layerType]);return{className:b,properties:g}})}return{className:"GroupLayer"}})}function A(a){return c.__awaiter(this,void 0,void 0,function(){var b,g,e;return c.__generator(this,function(d){switch(d.label){case 0:return[4,
a.load()];case 1:return d.sent(),(b=p.hasTypeKeyword(a,"Map Notes"))?[2,{className:"MapNotesLayer"}]:(g=p.hasTypeKeyword(a,"Route Layer"))?[2,{className:"RouteLayer"}]:[4,a.fetchData()];case 2:return e=d.sent(),1===l(e)?[2,{className:"FeatureLayer"}]:[2,{className:"GroupLayer"}]}})})}function C(a){var b,g,e;return c.__awaiter(this,void 0,void 0,function(){var d,h,f,k,l;return c.__generator(this,function(c){switch(c.label){case 0:return[4,a.load()];case 1:return c.sent(),d=null!==(g=null===(b=a.typeKeywords)||
void 0===b?void 0:b.map(function(a){return a.toLowerCase()}))&&void 0!==g?g:[],-1<d.indexOf("elevation 3d layer")?[2,{className:"ElevationLayer"}]:-1<d.indexOf("tiled imagery")?[2,{className:"ImageryTileLayer"}]:[4,a.fetchData()];case 2:return h=c.sent(),f=null===h||void 0===h?void 0:h.layerType,"ArcGISTiledImageServiceLayer"===f?[2,{className:"ImageryTileLayer"}]:"ArcGISImageServiceLayer"===f?[2,{className:"ImageryLayer"}]:[4,m(a.url)];case 3:return k=c.sent(),l=null===(e=k.cacheType)||void 0===
e?void 0:e.toLowerCase(),"map"===l?[2,{className:"ImageryTileLayer"}]:[2,{className:"ImageryLayer"}]}})})}function E(a){return m(a.url).then(function(a){return a.tileInfo})}function r(a){return!a.url||a.url.match(/\/\d+$/)?k.resolve({}):a.load().then(function(){return a.fetchData()}).then(function(b){return 0<l(b)?t(b):m(a.url).then(t)})}function t(a){return 1===l(a)?{id:w.unwrap(F(a))}:!1}function F(a){var b=a.layers;return b&&b.length?b[0].id:(a=a.tables)&&a.length?a[0].id:null}function l(a){var b,
c,e,d,f=null!==(c=null===(b=null===a||void 0===a?void 0:a.layers)||void 0===b?void 0:b.length)&&void 0!==c?c:0;a=null!==(d=null===(e=null===a||void 0===a?void 0:a.tables)||void 0===e?void 0:e.length)&&void 0!==d?d:0;return f+a}function m(a){return u(a,{responseType:"json",query:{f:"json"}}).then(function(a){return a.data})}Object.defineProperty(f,"__esModule",{value:!0});f.selectLayerClassPath=f.fromItem=void 0;f.fromItem=function(a){!a.portalItem||a.portalItem instanceof n||(a=c.__assign(c.__assign({},
a),{portalItem:new n(a.portalItem)}));return a.portalItem.load().then(q).then(D).then(function(b){var f=c.__assign({portalItem:a.portalItem},b.properties);return k.resolve(new b.constructor(f))})};f.selectLayerClassPath=q});