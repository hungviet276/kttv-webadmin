// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../config ../intl ../kernel ../request ../core/Error ../core/JSONSupport ../core/lang ../core/Loadable ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../geometry/Extent ./PortalQueryParams ./PortalQueryResult ./PortalUser @dojo/framework/shim/Promise".split(" "),function(f,H,c,q,v,h,y,n,z,A,B,C,e,d,D,E,r,F,G){var p,x={PortalGroup:function(){return new Promise(function(c,a){f(["./PortalGroup"],c,a)})},PortalItem:function(){return new Promise(function(c,
a){f(["./PortalItem"],c,a)})},PortalUser:function(){return new Promise(function(c,a){f(["./PortalUser"],c,a)})}};return function(w){function a(b){b=w.call(this,b)||this;b.access=null;b.allSSL=!1;b.authMode="auto";b.authorizedCrossOriginDomains=null;b.basemapGalleryGroupQuery=null;b.bingKey=null;b.canListApps=!1;b.canListData=!1;b.canListPreProvisionedItems=!1;b.canProvisionDirectPurchase=!1;b.canSearchPublic=!0;b.canShareBingPublic=!1;b.canSharePublic=!1;b.canSignInArcGIS=!1;b.canSignInIDP=!1;b.colorSetsGroupQuery=
null;b.commentsEnabled=!1;b.created=null;b.culture=null;b.customBaseUrl=null;b.defaultBasemap=null;b.defaultExtent=null;b.defaultVectorBasemap=null;b.description=null;b.eueiEnabled=null;b.featuredGroups=null;b.featuredItemsGroupQuery=null;b.galleryTemplatesGroupQuery=null;b.livingAtlasGroupQuery=null;b.hasCategorySchema=!1;b.helperServices=null;b.homePageFeaturedContent=null;b.homePageFeaturedContentCount=null;b.httpPort=null;b.httpsPort=null;b.id=null;b.ipCntryCode=null;b.isPortal=!1;b.isReadOnly=
!1;b.layerTemplatesGroupQuery=null;b.maxTokenExpirationMinutes=null;b.modified=null;b.name=null;b.portalHostname=null;b.portalMode=null;b.portalProperties=null;b.region=null;b.rotatorPanels=null;b.showHomePageDescription=!1;b.sourceJSON=null;b.supportsHostedServices=!1;b.symbolSetsGroupQuery=null;b.templatesGroupQuery=null;b.units=null;b.url=q.portalUrl;b.urlKey=null;b.user=null;b.useStandardizedQuery=!1;b.useVectorBasemaps=!1;b.vectorBasemapGalleryGroupQuery=null;return b}c.__extends(a,w);g=a;a.prototype.normalizeCtorArgs=
function(b){return"string"===typeof b?{url:b}:b};a.prototype.destroy=function(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)};a.prototype.readAuthorizedCrossOriginDomains=function(b){if(b)for(var a=0;a<b.length;a++){var c=b[a];-1===q.request.trustedServers.indexOf(c)&&q.request.trustedServers.push(c)}return b};a.prototype.readDefaultBasemap=function(b){return b?(b=p.fromJSON(b),b.portalItem={portal:this},b):null};a.prototype.readDefaultVectorBasemap=
function(b){return b?(b=p.fromJSON(b),b.portalItem={portal:this},b):null};Object.defineProperty(a.prototype,"extraQuery",{get:function(){var b=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!b?" AND orgid:"+this.id:null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isOrganization",{get:function(){return!!this.access},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"restUrl",{get:function(){var b=this.url;if(b)var a=b.indexOf("/sharing"),
b=0<a?b.substring(0,a):this.url.replace(/\/+$/,""),b=b+"/sharing/rest";return b},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"thumbnailUrl",{get:function(){var b=this.restUrl,a=this.thumbnail;return b&&a?this._normalizeSSL(b+"/portals/self/resources/"+a):null},enumerable:!1,configurable:!0});a.prototype.readUrlKey=function(b){return b?b.toLowerCase():b};a.prototype.readUser=function(b){var a=null;b&&(a=G.fromJSON(b),a.portal=this);return a};a.prototype.load=function(b){var a=
this,c=(new Promise(function(b,a){f(["../Basemap"],b,a)})).then(function(a){e.throwIfAborted(b);p=a}).then(function(){return a.sourceJSON?a.sourceJSON:a._fetchSelf(a.authMode,!1,b)}).then(function(b){if(h.id){var c=h.id;a.credential=c.findCredential(a.restUrl);a.credential||a.authMode!==g.AUTH_MODE_AUTO||(a._esriId_credentialCreateHandle=c.on("credential-create",function(){c.findCredential(a.restUrl)&&a._signIn()}))}a.sourceJSON=b;a.read(b)});this.addResolvingPromise(c);return e.resolve(this)};a.prototype.createClosestFacilityTask=
function(){return c.__awaiter(this,void 0,void 0,function(){var b,a;return c.__generator(this,function(c){switch(c.label){case 0:return[4,this.load()];case 1:return c.sent(),b=this._getHelperServiceUrl("closestFacility"),[4,new Promise(function(b,a){f(["../tasks/ClosestFacilityTask"],b,a)})];case 2:return a=c.sent(),[2,new a(b)]}})})};a.prototype.createElevationLayers=function(){return c.__awaiter(this,void 0,void 0,function(){var b,a;return c.__generator(this,function(c){switch(c.label){case 0:return[4,
this.load()];case 1:return c.sent(),b=this._getHelperService("defaultElevationLayers"),[4,new Promise(function(b,a){f(["../layers/ElevationLayer"],b,a)})];case 2:return a=c.sent(),[2,b?b.map(function(b){return new a({id:b.id,url:b.url})}):[]]}})})};a.prototype.createGeometryService=function(){return c.__awaiter(this,void 0,void 0,function(){var b,a;return c.__generator(this,function(c){switch(c.label){case 0:return[4,this.load()];case 1:return c.sent(),b=this._getHelperServiceUrl("geometry"),[4,new Promise(function(b,
a){f(["../tasks/GeometryService"],b,a)})];case 2:return a=c.sent(),[2,new a({url:b})]}})})};a.prototype.createPrintTask=function(){return c.__awaiter(this,void 0,void 0,function(){var b,a;return c.__generator(this,function(c){switch(c.label){case 0:return[4,this.load()];case 1:return c.sent(),b=this._getHelperServiceUrl("printTask"),[4,new Promise(function(b,a){f(["../tasks/PrintTask"],b,a)})];case 2:return a=c.sent(),[2,new a(b)]}})})};a.prototype.createRouteTask=function(){return c.__awaiter(this,
void 0,void 0,function(){var b,a;return c.__generator(this,function(c){switch(c.label){case 0:return[4,this.load()];case 1:return c.sent(),b=this._getHelperServiceUrl("route"),[4,new Promise(function(b,a){f(["../tasks/RouteTask"],b,a)})];case 2:return a=c.sent(),[2,new a(b)]}})})};a.prototype.createServiceAreaTask=function(){return c.__awaiter(this,void 0,void 0,function(){var b,a;return c.__generator(this,function(c){switch(c.label){case 0:return[4,this.load()];case 1:return c.sent(),b=this._getHelperServiceUrl("serviceArea"),
[4,new Promise(function(b,a){f(["../tasks/ServiceAreaTask"],b,a)})];case 2:return a=c.sent(),[2,new a(b)]}})})};a.prototype.fetchBasemaps=function(b,a){var c=new r;c.query=b||(this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery);c.disableExtraQuery=!0;return this.queryGroups(c,a).then(function(b){c.num=100;c.query='type:"Web Map" -type:"Web Application"';return b.total?(b=b.results[0],c.sortField=b.sortField||"name",c.sortOrder=b.sortOrder||"desc",b.queryItems(c,
a)):null}).then(function(b){return b&&b.total?b.results.filter(function(b){return"Web Map"===b.type}).map(function(b){return new p({portalItem:b})}):[]})};a.prototype.fetchCategorySchema=function(b){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",b).then(function(b){return b.categorySchema}):e.isAborted(b)?e.reject(e.createAbortError()):e.resolve([])};a.prototype.fetchFeaturedGroups=function(b){var a=this.featuredGroups,c=new r;c.num=100;c.sortField="title";
if(a&&a.length){for(var d=[],u=0;u<a.length;u++){var m=a[u];d.push('(title:"'+m.title+'" AND owner:'+m.owner+")")}c.query=d.join(" OR ");return this.queryGroups(c,b).then(function(b){return b.results})}return e.isAborted(b)?e.reject(e.createAbortError()):e.resolve([])};a.prototype.fetchRegions=function(b){var a=this.user&&this.user.culture||this.culture||v.getLocale();return this._request(this.restUrl+"/portals/regions",c.__assign(c.__assign({},b),{query:{culture:a}}))};a.getDefault=function(){if(!g._default||
g._default.destroyed)g._default=new g;return g._default};a.prototype.queryGroups=function(b,a){return this._queryPortal("/community/groups",b,"PortalGroup",a)};a.prototype.queryItems=function(b,a){return this._queryPortal("/search",b,"PortalItem",a)};a.prototype.queryUsers=function(b,a){b.sortField||(b.sortField="username");return this._queryPortal("/community/users",b,"PortalUser",a)};a.prototype.toJSON=function(){throw new n("internal:not-yet-implemented","Portal.toJSON is not yet implemented");
};a.fromJSON=function(b){if(!b)return null;if(b.declaredClass)throw Error("JSON object is already hydrated");return new g({sourceJSON:b})};a.prototype._getHelperService=function(b){var a=this.helperServices&&this.helperServices[b];if(!a)throw new n("portal:service-not-found",'The `helperServices` do not include an entry named "'+b+'"');return a};a.prototype._getHelperServiceUrl=function(b){var a=this._getHelperService(b);if(!a.url)throw new n("portal:service-url-not-found",'The `helperServices` entry "'+
b+'" does not include a `url` value');return a.url};a.prototype._fetchSelf=function(b,a,d){void 0===b&&(b=this.authMode);void 0===a&&(a=!1);var l=this.restUrl+"/portals/self";b=c.__assign({authMode:b,query:{culture:v.getLocale().toLowerCase()}},d);"auto"===b.authMode&&(b.authMode="no-prompt");a&&(b.query.default=!0);return this._request(l,b)};a.prototype._queryPortal=function(b,a,d,t){var l=this,k=D.ensureType(r,a),f=function(a){return l._request(l.restUrl+b,c.__assign(c.__assign({},k.toRequestOptions(l)),
t)).then(function(b){var c=k.clone();c.start=b.nextStart;return new F({nextQueryParams:c,queryParams:k,total:b.total,results:g._resultsToTypedArray(a,{portal:l},b,t)})}).then(function(b){return e.all(b.results.map(function(a){return"function"===typeof a.when?a.when():b})).then(function(){return b},function(a){e.throwIfAbortError(a);return b})})};return d&&x[d]?x[d]().then(function(b){e.throwIfAborted(t);return f(b)}):f()};a.prototype._signIn=function(){var b=this;if(this.authMode===g.AUTH_MODE_ANONYMOUS)return e.reject(new n("portal:invalid-auth-mode",
'Current "authMode"\' is "'+this.authMode+'"'));if("failed"===this.loadStatus)return e.reject(this.loadError);var a=function(a){return e.resolve().then(function(){if("not-loaded"===b.loadStatus)return a||(b.authMode="immediate"),b.load().then(function(){return null});if("loading"===b.loadStatus)return b.load().then(function(){if(b.credential)return null;b.credential=a;return b._fetchSelf("immediate")});if(b.user&&b.credential===a)return null;b.credential=a;return b._fetchSelf("immediate")}).then(function(a){a&&
(b.sourceJSON=a,b.read(a))})};return h.id?h.id.getCredential(this.restUrl).then(function(b){return a(b)}):a(this.credential)};a.prototype._normalizeSSL=function(b){return b.replace(/^http:/i,"https:").replace(":7080",":7443")};a.prototype._normalizeUrl=function(b){var a=this.credential&&this.credential.token;return this._normalizeSSL(a?b+(-1<b.indexOf("?")?"\x26":"?")+"token\x3d"+a:b)};a.prototype._requestToTypedArray=function(b,a,c){var d=this;return this._request(b,a).then(function(b){var a=g._resultsToTypedArray(c,
{portal:d},b);return e.all(a.map(function(a){return"function"===typeof a.when?a.when():b})).then(function(){return a},function(){return a})})};a.prototype._request=function(b,a){void 0===a&&(a={});var d=c.__assign({f:"json"},a.query),e=a.authMode,f=a.body,m=a.cacheBust,k=a.method,h=a.responseType;a={authMode:void 0===e?this.authMode===g.AUTH_MODE_ANONYMOUS?"anonymous":"auto":e,body:void 0===f?null:f,cacheBust:void 0===m?!1:m,method:void 0===k?"auto":k,query:d,responseType:void 0===h?"json":h,timeout:0,
signal:a.signal};return y(this._normalizeSSL(b),a).then(function(a){return a.data})};a._resultsToTypedArray=function(a,c,d,e){if(d){var b=C.isSome(e)?e.signal:null;d=d.listings||d.notifications||d.userInvitations||d.tags||d.items||d.groups||d.comments||d.provisions||d.results||d.relatedItems||d;if(a||c)d=d.map(function(d){d=A.mixin(a?a.fromJSON(d):d,c);"function"===typeof d.load&&d.load(b);return d})}else d=[];return d};var g;a.AUTH_MODE_ANONYMOUS="anonymous";a.AUTH_MODE_AUTO="auto";a.AUTH_MODE_IMMEDIATE=
"immediate";c.__decorate([d.property()],a.prototype,"access",void 0);c.__decorate([d.property()],a.prototype,"allSSL",void 0);c.__decorate([d.property()],a.prototype,"authMode",void 0);c.__decorate([d.property()],a.prototype,"authorizedCrossOriginDomains",void 0);c.__decorate([d.reader("authorizedCrossOriginDomains")],a.prototype,"readAuthorizedCrossOriginDomains",null);c.__decorate([d.property()],a.prototype,"basemapGalleryGroupQuery",void 0);c.__decorate([d.property()],a.prototype,"bingKey",void 0);
c.__decorate([d.property()],a.prototype,"canListApps",void 0);c.__decorate([d.property()],a.prototype,"canListData",void 0);c.__decorate([d.property()],a.prototype,"canListPreProvisionedItems",void 0);c.__decorate([d.property()],a.prototype,"canProvisionDirectPurchase",void 0);c.__decorate([d.property()],a.prototype,"canSearchPublic",void 0);c.__decorate([d.property()],a.prototype,"canShareBingPublic",void 0);c.__decorate([d.property()],a.prototype,"canSharePublic",void 0);c.__decorate([d.property()],
a.prototype,"canSignInArcGIS",void 0);c.__decorate([d.property()],a.prototype,"canSignInIDP",void 0);c.__decorate([d.property()],a.prototype,"colorSetsGroupQuery",void 0);c.__decorate([d.property()],a.prototype,"commentsEnabled",void 0);c.__decorate([d.property({type:Date})],a.prototype,"created",void 0);c.__decorate([d.property()],a.prototype,"credential",void 0);c.__decorate([d.property()],a.prototype,"culture",void 0);c.__decorate([d.property()],a.prototype,"currentVersion",void 0);c.__decorate([d.property()],
a.prototype,"customBaseUrl",void 0);c.__decorate([d.property()],a.prototype,"defaultBasemap",void 0);c.__decorate([d.reader("defaultBasemap")],a.prototype,"readDefaultBasemap",null);c.__decorate([d.property({type:E})],a.prototype,"defaultExtent",void 0);c.__decorate([d.property()],a.prototype,"defaultVectorBasemap",void 0);c.__decorate([d.reader("defaultVectorBasemap")],a.prototype,"readDefaultVectorBasemap",null);c.__decorate([d.property()],a.prototype,"description",void 0);c.__decorate([d.property()],
a.prototype,"eueiEnabled",void 0);c.__decorate([d.property({dependsOn:["user","id","canSearchPublic"],readOnly:!0})],a.prototype,"extraQuery",null);c.__decorate([d.property()],a.prototype,"featuredGroups",void 0);c.__decorate([d.property()],a.prototype,"featuredItemsGroupQuery",void 0);c.__decorate([d.property()],a.prototype,"galleryTemplatesGroupQuery",void 0);c.__decorate([d.property()],a.prototype,"livingAtlasGroupQuery",void 0);c.__decorate([d.property()],a.prototype,"hasCategorySchema",void 0);
c.__decorate([d.property()],a.prototype,"helpBase",void 0);c.__decorate([d.property()],a.prototype,"helperServices",void 0);c.__decorate([d.property()],a.prototype,"helpMap",void 0);c.__decorate([d.property()],a.prototype,"homePageFeaturedContent",void 0);c.__decorate([d.property()],a.prototype,"homePageFeaturedContentCount",void 0);c.__decorate([d.property()],a.prototype,"httpPort",void 0);c.__decorate([d.property()],a.prototype,"httpsPort",void 0);c.__decorate([d.property()],a.prototype,"id",void 0);
c.__decorate([d.property()],a.prototype,"ipCntryCode",void 0);c.__decorate([d.property({dependsOn:["access"],readOnly:!0})],a.prototype,"isOrganization",null);c.__decorate([d.property()],a.prototype,"isPortal",void 0);c.__decorate([d.property()],a.prototype,"isReadOnly",void 0);c.__decorate([d.property()],a.prototype,"layerTemplatesGroupQuery",void 0);c.__decorate([d.property()],a.prototype,"maxTokenExpirationMinutes",void 0);c.__decorate([d.property({type:Date})],a.prototype,"modified",void 0);c.__decorate([d.property()],
a.prototype,"name",void 0);c.__decorate([d.property()],a.prototype,"portalHostname",void 0);c.__decorate([d.property()],a.prototype,"portalMode",void 0);c.__decorate([d.property()],a.prototype,"portalProperties",void 0);c.__decorate([d.property()],a.prototype,"region",void 0);c.__decorate([d.property({dependsOn:["url"],readOnly:!0})],a.prototype,"restUrl",null);c.__decorate([d.property()],a.prototype,"rotatorPanels",void 0);c.__decorate([d.property()],a.prototype,"showHomePageDescription",void 0);
c.__decorate([d.property()],a.prototype,"sourceJSON",void 0);c.__decorate([d.property()],a.prototype,"staticImagesUrl",void 0);c.__decorate([d.property()],a.prototype,"stylesGroupQuery",void 0);c.__decorate([d.property()],a.prototype,"supportsHostedServices",void 0);c.__decorate([d.property()],a.prototype,"symbolSetsGroupQuery",void 0);c.__decorate([d.property()],a.prototype,"templatesGroupQuery",void 0);c.__decorate([d.property()],a.prototype,"thumbnail",void 0);c.__decorate([d.property({dependsOn:["restUrl",
"thumbnail"],readOnly:!0})],a.prototype,"thumbnailUrl",null);c.__decorate([d.property()],a.prototype,"units",void 0);c.__decorate([d.property()],a.prototype,"url",void 0);c.__decorate([d.property()],a.prototype,"urlKey",void 0);c.__decorate([d.reader("urlKey")],a.prototype,"readUrlKey",null);c.__decorate([d.property()],a.prototype,"user",void 0);c.__decorate([d.reader("user")],a.prototype,"readUser",null);c.__decorate([d.property()],a.prototype,"useStandardizedQuery",void 0);c.__decorate([d.property()],
a.prototype,"useVectorBasemaps",void 0);c.__decorate([d.property()],a.prototype,"vectorBasemapGalleryGroupQuery",void 0);return a=g=c.__decorate([d.subclass("esri.portal.Portal")],a)}(z.JSONSupportMixin(B))});