// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Collection ../../core/has ../../core/promiseUtils ../../layers/support/lazyLayerLoader ../PortalItem ./featureCollectionUtils ./portalLayers ../../renderers/support/styleUtils".split(" "),function(M,q,f,x,N,y,l,z,t,A,B){function C(a,d,c){return f.__awaiter(this,void 0,void 0,function(){var b;return f.__generator(this,function(e){switch(e.label){case 0:return b=new a,b.read(d,c.context),"group"===b.type&&u(d)?[4,D(b,d,c.context)]:[3,2];case 1:e.sent(),e.label=
2;case 2:return[4,B.loadStyleRenderer(b,c.context)];case 3:return e.sent(),[2,b]}})})}function v(a,d){return f.__awaiter(this,void 0,void 0,function(){var c;return f.__generator(this,function(b){switch(b.label){case 0:return[4,E(a,d)];case 1:return c=b.sent(),[2,C(c,a,d)]}})})}function E(a,d){return f.__awaiter(this,void 0,void 0,function(){var c,b,e,k,g,m,r,n,p;return f.__generator(this,function(h){switch(h.label){case 0:c=d.context;switch(c.origin){case "web-scene":switch(c.layerContainerType){case "basemap":h=
F;break;case "ground":h=G;break;default:h=H}break;default:switch(c.layerContainerType){case "basemap":h=I;break;case "tables":h=J;break;default:h=K}}b=h;e=a.layerType||a.type;!e&&d&&d.defaultLayerType&&(e=d.defaultLayerType);g=(k=b[e])?l.layerLookupMap[k]:l.layerLookupMap.UnknownLayer;m=c&&c.portal;if("Feature Collection"!==a.type)return[3,4];if(!a.itemId)return[3,3];r=new z({id:a.itemId,portal:m});return[4,r.load()];case 1:return h.sent(),[4,A.selectLayerClassPath(r)];case 2:n=h.sent(),p=n.className||
"UnknownLayer",g=l.layerLookupMap[p],h.label=3;case 3:return[3,8];case 4:return"ArcGISFeatureLayer"!==e?[3,8]:[4,t.isMapNotesLayer(a,m)];case 5:if(!h.sent())return[3,6];g=l.layerLookupMap.MapNotesLayer;return[3,8];case 6:return[4,t.isRouteLayer(a,m)];case 7:h.sent()?g=l.layerLookupMap.RouteLayer:u(a)&&(g=l.layerLookupMap.GroupLayer),h.label=8;case 8:return a.wmtsInfo&&a.wmtsInfo.url&&a.wmtsInfo.layerIdentifier&&(g=l.layerLookupMap.WMTSLayer),[2,g()]}})})}function u(a){if("ArcGISFeatureLayer"!==a.layerType||
"Feature Collection"===a.type)return!1;a=a.featureCollection;return!!(a&&a.layers&&1<a.layers.length)}function L(a,d,c){return f.__awaiter(this,void 0,void 0,function(){var b,e,k;return f.__generator(this,function(g){switch(g.label){case 0:return b=new x,e=w(b,Array.isArray(d.layers)?d.layers:[],c),[4,a];case 1:return k=g.sent(),[4,e];case 2:return g.sent(),"group"===k.type?(k.layers.addMany(b),[2,k]):[2,void 0]}})})}function D(a,d,c){return f.__awaiter(this,void 0,void 0,function(){var b,e,k,g,m;
return f.__generator(this,function(f){switch(f.label){case 0:return b=l.layerLookupMap.FeatureLayer,[4,b()];case 1:return e=f.sent(),k=d.featureCollection,g=k.showLegend,m=k.layers.map(function(a){var b=new e;b.read(a,c);null!=g&&b.read({showLegend:g},c);return b}),a.layers.addMany(m),[2]}})})}function w(a,d,c){return f.__awaiter(this,void 0,void 0,function(){var b,e,k,g,m,l,n,p,h;return f.__generator(this,function(f){switch(f.label){case 0:if(!d)return[2];b=[];e=0;for(k=d;e<k.length;e++)g=k[e],m=
v(g,c),"GroupLayer"===g.layerType?b.push(L(m,g,c)):b.push(m);return[4,y.eachAlways(b)];case 1:l=f.sent();n=0;for(p=l;n<p.length;n++)h=p[n],!h.value||c.filter&&!c.filter(h.value)||a.add(h.value);return[2]}})})}Object.defineProperty(q,"__esModule",{value:!0});q.populateOperationalLayers=q.createLayer=void 0;var H={ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",
BuildingSceneLayer:"BuildingSceneLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer",KML:"KMLLayer",RasterDataLayer:"UnsupportedLayer"},G={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer",RasterDataElevationLayer:"UnsupportedLayer"},
F={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",DefaultTileLayer:"TileLayer"},K={ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",
ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",VectorTileLayer:"VectorTileLayer",GroupLayer:"GroupLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",GeoRSS:"GeoRSSLayer",KML:"KMLLayer",WFS:"UnsupportedLayer",SubtypeGroupLayer:"UnsupportedLayer",WMS:"WMSLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",DefaultTileLayer:"TileLayer"},J={ArcGISFeatureLayer:"FeatureLayer"},I={ArcGISImageServiceLayer:"ImageryLayer",
ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"};q.createLayer=v;q.populateOperationalLayers=function(a,d,c){return f.__awaiter(this,void 0,void 0,
function(){return f.__generator(this,function(b){return[2,w(a,d,c)]})})}});