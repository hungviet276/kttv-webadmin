// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/featureConversionUtils ./FeatureSetReader".split(" "),function(k,f,m,g,n,l){Object.defineProperty(f,"__esModule",{value:!0});f.FeatureSetReaderJSON=void 0;k=function(f){function b(a,c,b){a=f.call(this,a)||this;a._featureIndex=-1;a._dateFields=new Set;a._geometryType=b;a._features=c;return a}m.__extends(b,f);b.fromFeatures=function(a,c,e){e=n.convertFromFeatures([],a,c,!1,!1,e);for(var d=
0;d<e.length;d++)e[d].displayId=a[d].displayId;return b.fromOptimizedFeatures(e,c)};b.fromFeatureSet=function(a,c){a=g.convertFromFeatureSet(a,c);return b.fromOptimizedFeatureSet(a)};b.fromOptimizedFeatureSet=function(a){var c=b.fromOptimizedFeatures(a.features,a.geometryType);c._exceededTransferLimit=a.exceededTransferLimit;c._transform=a.transform;var e=0;for(a=a.fields;e<a.length;e++){var d=a[e];"esriFieldTypeDate"===d.type&&c._dateFields.add(d.name)}return c};b.fromOptimizedFeatures=function(a,
c,e){var d=l.FeatureSetReader.createInstance();a=new b(d,a,c);a._transform=e;return a};Object.defineProperty(b.prototype,"_current",{get:function(){return this._features[this._featureIndex]},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"geometryType",{get:function(){return this._geometryType},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"hasFeatures",{get:function(){return!!this._features.length},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"hasNext",{get:function(){return this._featureIndex+1<this._features.length},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"exceededTransferLimit",{get:function(){return this._exceededTransferLimit},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"hasZ",{get:function(){return!1},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"hasM",{get:function(){return!1},enumerable:!1,configurable:!0});b.prototype.getApproximateSize=function(){return this._features.length};
b.prototype.getCursor=function(){return this.copy()};b.prototype.getQuantizationTransform=function(){return this._transform};b.prototype.getAttributeHash=function(){var a="",c;for(c in this._current.attributes)a+=this._current.attributes[c];return a};b.prototype.getIndex=function(){return this._featureIndex};b.prototype.setIndex=function(a){this._featureIndex=a};b.prototype.getObjectId=function(){return this._current.objectId};b.prototype.getDisplayId=function(){return this._current.displayId};b.prototype.setDisplayId=
function(a){this._current.displayId=a};b.prototype.getGroupId=function(){return this._current.groupId};b.prototype.setGroupId=function(a){this._current.groupId=a};b.prototype.copy=function(){var a=new b(this.instance,this._features,this.geometryType);this.copyInto(a);return a};b.prototype.next=function(){if(!this._hasFilter)return++this._featureIndex<this._features.length;for(;++this._featureIndex<this._features.length&&!this._passesFilter(););return this._featureIndex<this._features.length};b.prototype.readLegacyFeature=
function(){return g.convertToFeature(this._current,this.geometryType,this.hasZ,this.hasM)};b.prototype.readOptimizedFeature=function(){return this._current};b.prototype.readLegacyPointGeometry=function(){var a=this.readGeometry();return a?{x:a.coords[0],y:a.coords[1]}:null};b.prototype.readLegacyGeometry=function(){var a=this.readGeometry();return g.convertToGeometry(a,this.geometryType,this.hasZ,this.hasM)};b.prototype.readLegacyCentroid=function(){var a=this.readCentroid();return a?{x:a.coords[0],
y:a.coords[1]}:null};b.prototype.readGeometryArea=function(){return g.getQuantizedArea(this._current.geometry,2)};b.prototype.readUnquantizedGeometry=function(){var a=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!a)return a;for(var a=a.clone(),c=a.coords,b=0,d=0,f=a.lengths;d<f.length;d++){for(var g=f[d],h=1;h<g;h++)c[2*(b+h)]+=c[2*(b+h)-2],c[2*(b+h)+1]+=c[2*(b+h)-1];b+=g}return a};b.prototype.readHydratedGeometry=function(){var a=this._current.geometry;if(!a)return null;a=a.clone();
g.unquantizeOptimizedGeometry(a,a,this.hasZ,this.hasM,this._transform);return a};b.prototype.getXHydrate=function(){var a=this._current.geometry.coords[0]+this._tx,b=this.getQuantizationTransform();return a*b.scale[0]+b.translate[0]};b.prototype.getYHydrate=function(){var a=this._current.geometry.coords[1]+this._ty,b=this.getQuantizationTransform();return b.translate[1]-a*b.scale[1]};b.prototype.readGeometry=function(){if(!this._current.hasGeometry)return null;var a=this._current.geometry.clone();
if(a.isPoint)return a.coords[0]+=this._tx,a.coords[1]+=this._ty,a;for(var b=0,e=0,d=a.lengths;e<d.length;e++){var f=d[e];a.coords[2*b]+=this._tx;a.coords[2*b+1]+=this._ty;b+=f}return a};b.prototype.readCentroid=function(){if(!this._current.hasGeometry)return null;if(!this._current.centroid){var a=this._computeCentroid();if(!a)return null;a.coords[0]-=this._tx;a.coords[1]-=this._ty;this._current.centroid=a}a=this._current.centroid.clone();a.coords[0]+=this._tx;a.coords[1]+=this._ty;return a};b.prototype._readAttribute=
function(a,b){var c=this._current.attributes[a];if(void 0!==c)return b&&this._dateFields.has(a)?new Date(c):c;b=this.readAttributes();a=a.toLocaleLowerCase().trim();for(var d in b)if(d.toLocaleLowerCase().trim()===a)return a=this._current.attributes[d],this._dateFields.has(d)?new Date(a):a};b.prototype.copyInto=function(a){f.prototype.copyInto.call(this,a);a._featureIndex=this._featureIndex;a._transform=this._transform;a._dateFields=this._dateFields};b.prototype._readAttributes=function(){return this._current.attributes};
b.prototype._passesFilter=function(){var a;if(!this._hasFilter)return!0;var b=0;a=0;switch(this.geometryType){case "esriGeometryPoint":b=this._current.geometry;if(!b)return!1;a=b.coords;b=a[0];a=a[1];break;case "esriGeometryPolygon":b=this.readCentroid();if(!b)return!1;a=b.coords;b=a[0];a=a[1];b-=this._tx;a-=this._ty;break;default:return!1}return b>=this._xmin&&b<=this._xmax&&a>=this._ymin&&a<=this._ymax?!0:!1};return b}(l.FeatureSetReader);f.FeatureSetReaderJSON=k});