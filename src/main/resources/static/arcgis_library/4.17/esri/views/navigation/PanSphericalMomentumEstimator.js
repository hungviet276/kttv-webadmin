// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(h,e,n,p,f,d,k,g,l,q){Object.defineProperty(e,"__esModule",{value:!0});e.PanSphericalMomentumEstimator=e.PanSphericalMomentum=void 0;var m=function(c){function b(a,b,r,f,e,d,g){void 0===d&&(d=0);a=c.call(this,a,b,r)||this;a.angularVelocity1=f;a.axis1=e;a.angularVelocity2=
d;a.axis2=g;return a}n.__extends(b,c);b.prototype.value1=function(a){return c.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,a)};b.prototype.value2=function(a){return c.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,a)};return b}(q.Momentum);e.PanSphericalMomentum=m;h=function(){function c(b,a,c){void 0===b&&(b=300);void 0===a&&(a=12);void 0===c&&(c=.84);this.minimumInitialVelocity=b;this.stopVelocity=a;this.friction=c;this.enabled=!0;this.tmpAxis1=d.vec3f64.create();
this.tmpAxis2=d.vec3f64.create();this.tmpAngles=p.vec2f64.create();this.time=new g.FilteredFiniteDifference(.3);this.screen=[new g.FilteredFiniteDifference(.4),new g.FilteredFiniteDifference(.4)];this.angle1=new l.FilteredValue(.6);this.angle2=new l.FilteredValue(.6);this.axis1=d.vec3f64.create();this.axis2=d.vec3f64.create();this.lastScene=d.vec3f64.create()}c.prototype.addMomentumDirectRotation=function(b,a,c,d,e,g){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(c))return;
d=k.rotationAngleAndAxisDirectRotation(this.lastScene,a,this.tmpAxis2,d,e,g);this.angle2.update(0);1E-5>f.vec3.squaredLength(this.tmpAxis2)?d=0:f.vec3.normalize(this.axis1,this.tmpAxis2);this.angle1.update(d);f.vec3.copy(this.lastScene,a)}this.screen[0].update(b[0]);this.screen[1].update(b[1]);this.time.update(c)}};c.prototype.addMomentumPreserveHeading=function(b,a,c,d,e,g,h){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(c))return;k.rotationAnglesAndAxesHeadingPreserving(this.lastScene,
a,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,d,e,g,h,!1);1E-5>f.vec3.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),f.vec3.normalize(this.axis1,this.tmpAxis1),f.vec3.normalize(this.axis2,this.tmpAxis2));f.vec3.copy(this.lastScene,a)}this.screen[0].update(b[0]);this.screen[1].update(b[1]);this.time.update(c)}};c.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();
this.angle2.reset();this.time.reset()};c.prototype.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var b=this.screen[0].filteredDelta,a=this.screen[1].filteredDelta,b=Math.sqrt(b*b+a*a)/this.time.filteredDelta;return Math.abs(b)<this.minimumInitialVelocity?null:this.createMomentum(b,this.stopVelocity,this.friction)};c.prototype.createMomentum=function(b,a,c){return new m(b,a,c,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/
this.time.filteredDelta,this.axis2)};return c}();e.PanSphericalMomentumEstimator=h});