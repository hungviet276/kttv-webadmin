// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/maybe ../../../webgl ./enums ./shaders/MaterialPrograms".split(" "),function(t,u,d,m,q,h,n){var p=function(d){return d===h.WGLDrawPhase.HITTEST||d===h.WGLDrawPhase.LABEL_ALPHA},r=function(b,e,c,a){a=a.reduce(function(a,c){var f;return d.__assign(d.__assign({},a),(f={},f[c]=b.driverTestResult[c],f))},{});e=d.__assign(d.__assign(d.__assign(d.__assign({},e.getVariation()),b.rendererInfo.getVariation()),{highlight:b.drawPhase===h.WGLDrawPhase.HIGHLIGHT,id:p(b.drawPhase)}),
a);if(m.isSome(c))for(a=0;a<c.length;a++)e[c[a]]=!0;return e};return function(){function b(d){this._programByKey=new Map;this._programCache=new q.ProgramCache(d)}b.prototype.dispose=function(){this._programCache&&this._programCache.dispose()};b.prototype.getProgram=function(e,c,a,b){void 0===a&&(a=[]);void 0===b&&(b=[]);var g=c.vsPath+"."+c.fsPath+JSON.stringify(a)+b.join(".");if(this._programByKey.has(g))return this._programByKey.get(g);b=b.reduce(function(a,c){var b;return d.__assign(d.__assign({},
a),(b={},b[c]=e.driverTestResult[c],b))},{});a=d.__assign(d.__assign({},a.map(function(a){return"string"===typeof a?{name:a,value:!0}:a}).reduce(function(a,c){var b;return d.__assign(d.__assign({},a),(b={},b[c.name]=c.value,b))},{})),b);c=this._programCache.getProgram(n.createProgramTemplate(c.vsPath,c.fsPath,c.attributes),a);if(!c)throw Error("Unable to get program for key: ${key}");this._programByKey.set(g,c);return c};b.prototype.getMaterialProgram=function(b,c,a,d,g,f){void 0===f&&(f=["ignoresSamplerPrecision"]);
var e,l=f;e=b.rendererInfo;var k=b.drawPhase,l=c.getVariationHash()+"-"+l.join(".")+"-",k=(p(k)?1:0)|(k===h.WGLDrawPhase.HIGHLIGHT?2:0);e=l+k+"-"+e.getVariationHash()+"-"+(m.isSome(g)&&g.join("."));if(this._programByKey.has(e))return this._programByKey.get(e);b=r(b,c,g,f);a=this._programCache.getProgram(n.createProgramTemplate(a,a,d),b);if(!a)throw Error("Unable to get program for key: ${key}");this._programByKey.set(e,a);return a};return b}()});