// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../../../layers/features/textUtils".split(" "),function(h,m,l,g,n,k,r,c,t,u,v){Object.defineProperty(m,"__esModule",{value:!0});h=function(h){function f(a){var b=h.call(this,a)||this;b._horizontalAlignment="center";b._verticalAlignment="middle";b._textToGlyphs=new Map;var e=a.scaleFactor||1;b._cimTextLayer=a;c.isFunction(a.color)?
b._dynamicPropertyMap.set("_color",function(b,d,c){return k.premultiplyAlphaRGBA(a.color(b,d,c))}):b._color=k.premultiplyAlphaRGBA(a.color);c.isFunction(a.color)?b._dynamicPropertyMap.set("_haloColor",function(b,d,c){return k.premultiplyAlphaRGBA(a.outlineColor(b,d,c))}):b._haloColor=k.premultiplyAlphaRGBA(a.outlineColor);var f;c.isFunction(a.size)||(f=Math.min(Math.round(g.pt2px(a.size*a.sizeRatio)),127));b._dynamicPropertyMap.set("_size",function(b,d,e){return c.isFunction(a.size)?Math.min(Math.round(g.pt2px(a.size(b,
d,e)*a.sizeRatio)),127):f});c.isFunction(a.outlineSize)?b._dynamicPropertyMap.set("_haloSize",function(b,d,c){return Math.min(Math.floor(5*g.pt2px(a.outlineSize(b,d,c)*a.sizeRatio)),127)}):b._haloSize=Math.min(Math.floor(5*g.pt2px(a.outlineSize*a.sizeRatio)),127);var p;c.isFunction(a.offsetX)||(p=Math.round(g.pt2px(a.offsetX*a.sizeRatio)));b._dynamicPropertyMap.set("_xOffset",function(b,d,e){return c.isFunction(a.offsetX)?Math.round(g.pt2px(a.offsetX(b,d,e)*a.sizeRatio)):p});var q;c.isFunction(a.offsetY)||
(q=Math.round(g.pt2px(a.offsetY*a.sizeRatio)));b._dynamicPropertyMap.set("_yOffset",function(b,d,e){return c.isFunction(a.offsetY)?Math.round(g.pt2px(a.offsetY(b,d,e)*a.sizeRatio)):q});c.isFunction(a.angle)?b._dynamicPropertyMap.set("_angle",a.angle):b._angle=a.angle;c.isFunction(a.horizontalAlignment)?b._dynamicPropertyMap.set("_horizontalAlignment",a.horizontalAlignment):b._horizontalAlignment=a.horizontalAlignment;c.isFunction(a.verticalAlignment)?b._dynamicPropertyMap.set("_verticalAlignment",
a.verticalAlignment):b._verticalAlignment=a.verticalAlignment;b._scaleFactor=e;c.isFunction(a.text)?b._dynamicPropertyMap.set("_text",a.text):b._text=a.text;e=Math.min(Math.round(g.pt2px(a.referenceSize*a.sizeRatio)),127);b._referenceSize=Math.round(Math.sqrt(256*e));b._materialKey=a.materialKey;e=r.TextMaterialKey.load(b._materialKey);e.sdf=!0;b._bitset=(1===a.alignment?1:0)|(a.colorLocked?1:0)<<1;b._materialKey=e.data;b._decoration="none";b._lineHeight=1;b._lineWidth=512;b._textPlacement=a.markerPlacement;
b.effects=a.effects;b._isCIM=!0;return b}l.__extends(f,h);f.fromCIMText=function(a){return new f(a)};f.prototype.analyze=function(a,b,c,g){return l.__awaiter(this,void 0,void 0,function(){var e,f,h;return l.__generator(this,function(d){switch(d.label){case 0:return e=b.readLegacyFeature(),d=this._cimTextLayer,f="string"===typeof d.text?d.text:"function"===typeof d.text?d.text(e,c,g):"",[4,a.getMosaicItem(this._cimTextLayer.cim,v.codepoints(f))];case 1:return h=d.sent(),this._textToGlyphs.set(f,h.glyphMosaicItems),
[2,h]}})})};f.prototype.bindFeature=function(a,b,c){var e=this,f=a.readLegacyFeature();this._dynamicPropertyMap.forEach(function(a,g){e[g]=a(f,b,c)});this._text&&0!==this._text.length?(this._size*=this._scaleFactor,this._scale=this._size/24,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=n.getXAnchorDirection(this._horizontalAlignment||"center"),this._yAlignD=n.getYAnchorDirection(this._verticalAlignment||"baseline"),a=this._textToGlyphs.get(this._text),this.bindTextInfo(a,
!1)):this._shapingInfo=null};return f}(t.default(u.default));m.default=h});