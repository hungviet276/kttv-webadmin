// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/aaBoundingRect":function(){define(["require","exports","../../core/compilerUtils","../Extent"],function(n,a,d,l){function k(b){void 0===b&&(b=a.ZERO);return[b[0],b[1],b[2],b[3]]}function e(a){return a[0]>=a[2]?0:a[2]-a[0]}function c(a){return a[1]>=a[3]?0:a[3]-a[1]}function h(a,b,f){return b>=a[0]&&f>=a[1]&&b<=a[2]&&f<=a[3]}function m(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a}function f(a){return 4===a.length}function b(a,b,f){return a<b?b:a>f?f:
a}Object.defineProperty(a,"__esModule",{value:!0});a.UNIT=a.ZERO=a.NEGATIVE_INFINITY=a.POSITIVE_INFINITY=a.equals=a.isPoint=a.is=a.empty=a.set=a.setMax=a.setMin=a.pad=a.offset=a.size=a.distance=a.intersection=a.contains=a.intersects=a.containsPointWithMargin=a.containsXY=a.containsPointObject=a.containsPoint=a.center=a.area=a.diameter=a.height=a.width=a.allFinite=a.expandWithNestedArray=a.expand=a.expandPointInPlace=a.toExtent=a.fromExtent=a.fromValues=a.clone=a.create=void 0;a.create=k;a.clone=function(a){return[a[0],
a[1],a[2],a[3]]};a.fromValues=function(a,b,f,d,c){void 0===c&&(c=k());c[0]=a;c[1]=b;c[2]=f;c[3]=d;return c};a.fromExtent=function(a,b){void 0===b&&(b=k());b[0]=a.xmin;b[1]=a.ymin;b[2]=a.xmax;b[3]=a.ymax;return b};a.toExtent=function(a,b){return new l({xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:b})};a.expandPointInPlace=function(a,b){b[0]<a[0]&&(a[0]=b[0]);b[0]>a[2]&&(a[2]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[1]>a[3]&&(a[3]=b[1])};a.expand=function(a,b,c){void 0===c&&(c=a);if("length"in b)if(f(b))c[0]=
Math.min(a[0],b[0]),c[1]=Math.min(a[1],b[1]),c[2]=Math.max(a[2],b[2]),c[3]=Math.max(a[3],b[3]);else{if(2===b.length||3===b.length)c[0]=Math.min(a[0],b[0]),c[1]=Math.min(a[1],b[1]),c[2]=Math.max(a[2],b[0]),c[3]=Math.max(a[3],b[1])}else switch(b.type){case "extent":c[0]=Math.min(a[0],b.xmin);c[1]=Math.min(a[1],b.ymin);c[2]=Math.max(a[2],b.xmax);c[3]=Math.max(a[3],b.ymax);break;case "point":c[0]=Math.min(a[0],b.x);c[1]=Math.min(a[1],b.y);c[2]=Math.max(a[2],b.x);c[3]=Math.max(a[3],b.y);break;default:d.neverReached(b)}return c};
a.expandWithNestedArray=function(a,b,f){void 0===f&&(f=a);var g=b.length,c=a[0],d=a[1],e=a[2];a=a[3];for(var m=0;m<g;m++){var h=b[m],c=Math.min(c,h[0]),d=Math.min(d,h[1]),e=Math.max(e,h[0]);a=Math.max(a,h[1])}f[0]=c;f[1]=d;f[2]=e;f[3]=a;return f};a.allFinite=function(a){for(var b=0;4>b;b++)if(!isFinite(a[b]))return!1;return!0};a.width=e;a.height=c;a.diameter=function(a){var b=e(a);a=c(a);return Math.sqrt(b*b+a*a)};a.area=function(a){return e(a)*c(a)};a.center=function(a,b){void 0===b&&(b=[0,0]);b[0]=
(a[0]+a[2])/2;b[1]=(a[1]+a[3])/2;return b};a.containsPoint=function(a,b){return h(a,b[0],b[1])};a.containsPointObject=function(a,b){return h(a,b.x,b.y)};a.containsXY=h;a.containsPointWithMargin=function(a,b,f){return b[0]>=a[0]-f&&b[1]>=a[1]-f&&b[0]<=a[2]+f&&b[1]<=a[3]+f};a.intersects=function(a,b){return Math.max(b[0],a[0])<=Math.min(b[2],a[2])&&Math.max(b[1],a[1])<=Math.min(b[3],a[3])};a.contains=function(a,b){return b[0]>=a[0]&&b[2]<=a[2]&&b[1]>=a[1]&&b[3]<=a[3]};a.intersection=function(a,f,c){void 0===
c&&(c=a);var g=f[0],d=f[1],e=f[2];f=f[3];c[0]=b(a[0],g,e);c[1]=b(a[1],d,f);c[2]=b(a[2],g,e);c[3]=b(a[3],d,f);return c};a.distance=function(a,b){var f=(a[1]+a[3])/2,g=Math.max(Math.abs(b[0]-(a[0]+a[2])/2)-e(a)/2,0);a=Math.max(Math.abs(b[1]-f)-c(a)/2,0);return Math.sqrt(g*g+a*a)};a.size=function(a,b){b[0]=a[2]-a[0];b[1]=a[3]-a[1]};a.offset=function(a,b,f,c){void 0===c&&(c=a);c[0]=a[0]+b;c[1]=a[1]+f;c[2]=a[2]+b;c[3]=a[3]+f;return c};a.pad=function(a,b,f){void 0===f&&(f=a);f[0]=a[0]-b;f[1]=a[1]-b;f[2]=
a[2]+b;f[3]=a[3]+b;return f};a.setMin=function(a,b,f){void 0===f&&(f=a);f[0]=b[0];f[1]=b[1];f!==a&&(f[2]=a[2],f[3]=a[3]);return f};a.setMax=function(a,b,f){void 0===f&&(f=a);f[2]=b[0];f[3]=b[1];f!==a&&(f[0]=a[0],f[1]=a[1]);return a};a.set=m;a.empty=function(b){return b?m(b,a.NEGATIVE_INFINITY):k(a.NEGATIVE_INFINITY)};a.is=f;a.isPoint=function(a){return(0===e(a)||!isFinite(a[0]))&&(0===c(a)||!isFinite(a[1]))};a.equals=function(a,b,c){if(null==a||null==b)return a===b;if(!f(a)||!f(b))return!1;if(c)for(var g=
0;g<a.length;g++){if(!c(a[g],b[g]))return!1}else for(g=0;g<a.length;g++)if(a[g]!==b[g])return!1;return!0};a.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];a.NEGATIVE_INFINITY=[Infinity,Infinity,-Infinity,-Infinity];a.ZERO=[0,0,0,0];a.UNIT=[0,0,1,1]})},"esri/geometry/support/scaleUtils":function(){define(["require","exports","../../core/unitUtils"],function(n,a,d){function l(a,e){e=d.getMetersPerUnitForSR(e);return a/(e*d.inchesPerMeter*96)}Object.defineProperty(a,"__esModule",{value:!0});
a.getExtentForScale=a.getScaleForResolution=a.getResolutionForScale=a.getScale=void 0;a.getScale=function(a,e){e=e||a.extent;a=a.width;var c=d.getMetersPerUnitForSR(e&&e.spatialReference);return e&&a?e.width/a*c*d.inchesPerMeter*96:0};a.getResolutionForScale=l;a.getScaleForResolution=function(a,e){e=d.getMetersPerUnitForSR(e);return a*e*d.inchesPerMeter*96};a.getExtentForScale=function(a,d){var c=a.extent;a=a.width;d=l(d,c.spatialReference);return c.clone().expand(d*a/c.width)}})},"esri/layers/support/layerUtils":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.areLabelsVisible=a.getLayersForScale=a.serializeTimeOptions=a.serializeLayerDefinitions=a.isBaseLayer=a.isTiledLayer=void 0;a.isTiledLayer=function(a){return a&&"base-tile"===a.type||"tile"===a.type||"elevation"===a.type||"imagery-tile"===a.type||"base-elevation"===a.type||"open-street-map"===a.type||"wcs"===a.type||"web-tile"===a.type||"wmts"===a.type||"vector-tile"===a.type};a.isBaseLayer=function(a){return a.parent&&"esri.Basemap"===
a.parent.declaredClass&&-1<a.parent.baseLayers.indexOf(a)};a.serializeLayerDefinitions=function(a){var d=/[:;]/,k=[],e=!1;if(a&&(a.forEach(function(a,f){k.push([f,a]);!e&&d.test(a)&&(e=!0)}),0<k.length)){a=void 0;if(e){var c={};k.forEach(function(a){c[a[0]]=a[1]});a=JSON.stringify(c)}else{var h=[];k.forEach(function(a){h.push(a[0]+":"+a[1])});a=h.join(";")}return a}return null};a.serializeTimeOptions=function(a){if(a){var d=[];a.forEach(function(a,e){d.push('"'+e+'":'+JSON.stringify(a))});if(d.length)return"{"+
d.join(",")+"}"}};a.getLayersForScale=function(a,l){var d=[];if(0<a&&l)for(var e=function(c){if(0<=l[c].parentLayerId&&-1===d.indexOf(l[c].parentLayerId)&&l.some(function(a){return a.id===l[c].parentLayerId}))return"continue";if(0<=l[c].id){var e=!0,f=l[c].maxScale,b=l[c].minScale;if(0<f||0<b)0<f&&0<b?e=f<=a&&a<=b:0<f?e=f<=a:0<b&&(e=a<=b);e&&d.push(l[c].id)}},c=0;c<l.length;c++)e(c);return d};a.areLabelsVisible=function(a){return!0===a.labelsVisible&&null!=a.labelingInfo&&0<a.labelingInfo.length}})},
"esri/views/BreakpointsOwner":function(){define("require exports tslib ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators".split(" "),function(n,a,d,l,k,e,c){function h(a,f){return f?m[a].valueToClassName[f].split(" "):[]}Object.defineProperty(a,"__esModule",{value:!0});a.BreakpointsOwner=void 0;var m={widthBreakpoint:{getValue:function(a){var b=a.viewSize[0];a=a.breakpoints;var f=this.values;return b<=a.xsmall?f.xsmall:b<=a.small?f.small:b<=a.medium?f.medium:
b<=a.large?f.large:f.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",
large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(a){var b=a.viewSize[1];a=a.breakpoints;var f=this.values;return b<=a.xsmall?f.xsmall:b<=a.small?f.small:b<=a.medium?f.medium:
b<=a.large?f.large:f.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",
large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(a){a=a.viewSize;var b=this.values;return a[1]>=a[0]?b.portrait:b.landscape},values:{portrait:"portrait",landscape:"landscape"},
valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},f={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=function(a){return function(a){function b(){for(var b=[],g=0;g<arguments.length;g++)b[g]=arguments[g];b=a.apply(this,b)||this;b._breakpointsHandles=new k;b.orientation=null;b.widthBreakpoint=null;b.heightBreakpoint=null;b.breakpoints=f;return b}d.__extends(b,a);b.prototype.initialize=function(){this._breakpointsHandles.add(e.init(this,
["breakpoints","size"],this._updateClassNames))};b.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};Object.defineProperty(b.prototype,"breakpoints",{set:function(a){var b=this._get("breakpoints");if(a!==b){b=(b=a)&&b.xsmall<b.small&&b.small<b.medium&&b.medium<b.large;if(!b){var g=JSON.stringify(f,null,2);console.warn("provided breakpoints are not valid, using defaults:"+g)}a=b?a:f;this._set("breakpoints",
d.__assign({},a))}},enumerable:!1,configurable:!0});b.prototype._updateClassNames=function(){if(this.container){var a=l.acquire(),b=l.acquire(),f=!1,g;for(g in m){var c=this[g],d=m[g].getValue({viewSize:this.size,breakpoints:this.breakpoints});c!==d&&(f=!0,this[g]=d,h(g,c).forEach(function(a){return b.push(a)}),h(g,d).forEach(function(b){return a.push(b)}))}f&&(this._applyClassNameChanges(a,b),l.release(a),l.release(b))}};b.prototype._applyClassNameChanges=function(a,b){var f=this.container;f&&(b.forEach(function(a){return f.classList.remove(a)}),
a.forEach(function(a){return f.classList.add(a)}))};b.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var b in m)h(b,this[b]).forEach(function(b){return a.classList.remove(b)})};d.__decorate([c.property()],b.prototype,"breakpoints",null);d.__decorate([c.property()],b.prototype,"orientation",void 0);d.__decorate([c.property()],b.prototype,"widthBreakpoint",void 0);d.__decorate([c.property()],b.prototype,"heightBreakpoint",void 0);return b=d.__decorate([c.subclass("esri.views.BreakpointsOwner")],
b)}(a)}})},"esri/views/GroundView":function(){define("require exports tslib ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./support/GroundViewElevationSampler".split(" "),function(n,a,d,l,k,e,c,h,m){return function(a){function b(b){b=a.call(this,b)||this;b.handles=new e;b.view=null;b.layerViews=new k;return b}d.__extends(b,a);b.prototype.initialize=function(){var a=this;this.handles.add(c.when(this,"view.map.ground",function(a){return a.load()}));
this.handles.add(this.layerViews.on("after-changes",function(){return a.layerViewsAfterChangesHandler()}))};b.prototype.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};Object.defineProperty(b.prototype,"elevationSampler",{get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new m({view:this.view}):null},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"updating",
{get:function(){return this.suspended?!1:this.layerViews.some(function(a){return a.updating})},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"suspended",{get:function(){return!this.view||this.view.suspended},enumerable:!1,configurable:!0});b.prototype.layerViewsAfterChangesHandler=function(){var a=this;this.handles.remove("updating");this.handles.add(this.layerViews.map(function(b){return b.watch("updating",function(){return a.updateUpdating()},!0)}).toArray(),"updating");this.updateUpdating()};
b.prototype.updateUpdating=function(){this.notifyChange("updating")};d.__decorate([h.property({readOnly:!0,dependsOn:["view.ready","view.basemapTerrain?.ready"]})],b.prototype,"elevationSampler",null);d.__decorate([h.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],b.prototype,"updating",null);d.__decorate([h.property({constructOnly:!0})],b.prototype,"view",void 0);d.__decorate([h.property({type:k,readOnly:!0})],b.prototype,"layerViews",void 0);d.__decorate([h.property({readOnly:!0,dependsOn:["view.suspended"]})],
b.prototype,"suspended",null);return b=d.__decorate([h.subclass("esri.views.GroundView")],b)}(l)})},"esri/views/support/GroundViewElevationSampler":function(){define("require exports tslib ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/support/ElevationProvider ../3d/terrain/TerrainConst".split(" "),function(n,a,d,l,k,
e,c,h,m,f,b,g){var p=k.getLogger("esri.views.support.GroundViewElevationSampler");return function(a){function k(b){b=a.call(this,b)||this;b.demResolution={min:-1,max:-1};b.noDataValue=g.ELEVATION_NODATA_VALUE;return b}d.__extends(k,a);k.prototype.initialize=function(){var a=this;this.view.basemapTerrain.on("elevation-change",function(){return a.emit("changed",{})})};Object.defineProperty(k.prototype,"extent",{get:function(){var a=this.view.basemapTerrain;return a.extent&&a.spatialReference?c.toExtent(a.extent,
a.spatialReference):null},enumerable:!1,configurable:!0});k.prototype.elevationAt=function(a){var f=a.spatialReference,g=this.spatialReference;if(!m.canProject(f,g))return p.error("Cannot sample elevation at a location with spatial reference ("+(f?f.wkid:"unknown")+") different from the view ("+g.wkid+")"),null;h.extentContainsPoint(this.extent,a)||(f=this.extent,p.warn("#elevationAt()","Point used to sample elevation ("+a.x+", "+a.y+") is outside of the sampler extent ("+(f.xmin+", "+f.ymin+", "+
f.xmax+", "+f.ymax)+")"));return b.getElevationAtPoint(this.view.elevationProvider,a)};k.prototype.queryElevation=function(a){return f.updateGeometryElevation(a.clone(),this)};d.__decorate([e.property({readOnly:!0})],k.prototype,"demResolution",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:["view.basemapTerrain.extent","view.basemapTerrain.spatialReference"]})],k.prototype,"extent",null);d.__decorate([e.property({readOnly:!0})],k.prototype,"noDataValue",void 0);d.__decorate([e.property({readOnly:!0,
aliasOf:"view.basemapTerrain.spatialReference"})],k.prototype,"spatialReference",void 0);d.__decorate([e.property({constructOnly:!0})],k.prototype,"view",void 0);return k=d.__decorate([e.subclass("esri.views.support.GroundViewElevationSampler")],k)}(l.EventedAccessor)})},"esri/layers/support/ElevationSampler":function(){define("require exports tslib ../../geometry ../../core/compilerUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f){function b(a,b){var f=g(a,b.spatialReference);if(!f)return null;switch(a.type){case "point":a.z=b.elevationAt(f)||0;break;case "polyline":u.spatialReference=f.spatialReference;for(var c=a.hasM&&!a.hasZ,d=0;d<a.paths.length;d++)for(var e=a.paths[d],m=f.paths[d],h=0;h<e.length;h++){var p=e[h],r=m[h];u.x=r[0];u.y=r[1];r=b.elevationAt(u)||0;c&&(p[3]=p[2]);p[2]=r}a.hasZ=!0;break;case "multipoint":u.spatialReference=f.spatialReference;c=a.hasM&&!a.hasZ;for(d=0;d<a.points.length;d++)e=
a.points[d],m=f.points[d],u.x=m[0],u.y=m[1],m=b.elevationAt(u)||0,c&&(e[3]=e[2]),e[2]=m;a.hasZ=!0;break;default:k.neverReached(a)}return a}function g(a,b){var g=a.spatialReference;return g.equals(b)?a:f.canProject(g,b)?f.project(a,b):(p.error("Cannot project geometry spatial reference (wkid:"+g.wkid+") to elevation sampler spatial reference (wkid:"+b.wkid+")"),null)}Object.defineProperty(a,"__esModule",{value:!0});a.updateGeometryElevation=a.MultiTileElevationSampler=a.TileElevationSampler=a.ElevationSamplerBase=
void 0;var p=e.getLogger("esri.layers.support.ElevationSampler");n=function(){function a(){}a.prototype.queryElevation=function(a){return b(a.clone(),this)};a.prototype.on=function(){return r};a.prototype.projectIfRequired=function(a,b){return g(a,b)};return a}();a.ElevationSamplerBase=n;var t=function(a){function b(b,f,g){var d=a.call(this)||this;d.tile=b;d.noDataValue=g;d.extent=h.toExtent(b.tile.extent,f.spatialReference);g=c.getMetersPerUnitForSR(f.spatialReference);b=f.lodAt(b.tile.level).resolution*
g;d.demResolution={min:b,max:b};return d}d.__extends(b,a);Object.defineProperty(b.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!1,configurable:!0});b.prototype.contains=function(a){a=this.projectIfRequired(a,this.spatialReference);return m.extentContainsPoint(this.extent,a)};b.prototype.elevationAt=function(a){var b=this.projectIfRequired(a,this.spatialReference);if(!b)return null;if(!this.contains(a)){var f=this.extent;p.warn("#elevationAt()","Point used to sample elevation ("+
a.x+", "+a.y+") is outside of the sampler extent ("+(f.xmin+", "+f.ymin+", "+f.xmax+", "+f.ymax)+")")}return this.tile.sample(b.x,b.y)};return b}(n);a.TileElevationSampler=t;n=function(a){function b(b,f,g){var c=a.call(this)||this,d;"number"===typeof f?(c.noDataValue=f,d=null):(d=f,c.noDataValue=g);c.samplers=d?b.map(function(a){return new t(a,d,c.noDataValue)}):b;if(b=c.samplers[0])for(c.extent=b.extent.clone(),b=b.demResolution,c.demResolution={min:b.min,max:b.max},b=1;b<c.samplers.length;b++)f=
c.samplers[b],c.extent.union(f.extent),c.demResolution.min=Math.min(c.demResolution.min,f.demResolution.min),c.demResolution.max=Math.max(c.demResolution.max,f.demResolution.max);else c.extent=h.toExtent(h.create(),d.spatialReference),c.demResolution={min:0,max:0};return c}d.__extends(b,a);Object.defineProperty(b.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!1,configurable:!0});b.prototype.elevationAt=function(a){var b=this.projectIfRequired(a,this.spatialReference);
if(!b)return null;for(var f=0,g=this.samplers;f<g.length;f++){var c=g[f];if(c.contains(b))return c.elevationAt(b)}p.warn("#elevationAt()","Point used to sample elevation ("+a.x+", "+a.y+") is outside of the sampler");return null};return b}(n);a.MultiTileElevationSampler=n;a.updateGeometryElevation=b;var u=new l.Point,r={remove:function(){}}})},"esri/views/3d/support/ElevationProvider":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.getElevationAtPoint=
void 0;a.getElevationAtPoint=function(a,l,k){void 0===k&&(k="ground");return a.getElevation(l.x,l.y,l.z||0,l.spatialReference,k)}})},"esri/views/3d/terrain/TerrainConst":function(){define(["require","exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.GEOMETRY_VERTEX_STRIDE=a.DEFAULT_TILE_BACKGROUND=a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR=a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR=a.GEOGRAPHIC_WORLD_EXTENT=
a.WEBMERCATOR_WORLD_EXTENT=a.ELEVATION_DESIRED_RESOLUTION_LEVEL=a.LOADING_LEVEL_MODULO=a.ELEVATION_NODATA_VALUE=a.MAX_MEMORY_LOD_BIAS=a.MAX_PATCH_TESSELATION=a.MAX_ROOT_TILES=a.TILE_LOADING_DEBUGLOG=void 0;a.TILE_LOADING_DEBUGLOG=!1;a.MAX_ROOT_TILES=64;a.MAX_PATCH_TESSELATION=512;a.MAX_MEMORY_LOD_BIAS=2.5;a.ELEVATION_NODATA_VALUE=d.clampFloat32(d.NUMBER_MAX_FLOAT32/10);a.LOADING_LEVEL_MODULO=2;a.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;a.WEBMERCATOR_WORLD_EXTENT=l.create();k.WebMercatorAuxiliarySphere.getExtent(0,
0,0,a.WEBMERCATOR_WORLD_EXTENT);a.GEOGRAPHIC_WORLD_EXTENT=l.create([-180,-90,180,90]);a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";a.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
a.GEOMETRY_VERTEX_STRIDE=5})},"esri/views/3d/terrain/TilingScheme":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/support/TileInfo ../support/projectionUtils".split(" "),function(n,a,d,l,k,e,c,h,m,f){var b=f.webMercator.x2lon,g=f.webMercator.y2lat;n=function(){function a(b){var g=a.checkUnsupported(b);if(g)throw g;this.spatialReference=
b.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isWGS84Comparable=f.canProjectToWGS84ComparableLonLat(this.spatialReference);this.origin=[b.origin.x,b.origin.y];this.pixelSize=b.size[0];this.dpi=b.dpi;var c=b.lods.reduce(function(a,b,f){b.level<a.min&&(a.min=b.level,a.minIndex=f);a.max=Math.max(a.max,b.level);return a},{min:Infinity,minIndex:0,max:-Infinity}),d=b.lods[c.minIndex],e=Math.pow(2,d.level),g=d.resolution*e,d=d.scale*e;this.levels=Array(c.max+1);for(c=0;c<
this.levels.length;c++)this.levels[c]={resolution:g,scale:d,tileSize:[g*b.size[0],g*b.size[1]]},g/=2,d/=2}a.prototype.clone=function(){return new a(this.toTileInfo())};a.prototype.toTileInfo=function(){return new m({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(function(a,b){return{level:b,scale:a.scale,resolution:a.resolution}})})};a.prototype.getExtent=
function(a,b,f,g){var c=this.levels[a];a=c.tileSize[0];c=c.tileSize[1];g[0]=this.origin[0]+f*a;g[2]=g[0]+a;g[3]=this.origin[1]-b*c;g[1]=g[3]-c};a.prototype.convertExtentToRadians=function(a,f){this._isWebMercator?(f[0]=b(a[0]),f[1]=g(a[1]),f[2]=b(a[2]),f[3]=g(a[3])):this._isWGS84Comparable&&(f[0]=k.deg2rad(a[0]),f[1]=k.deg2rad(a[1]),f[2]=k.deg2rad(a[2]),f[3]=k.deg2rad(a[3]))};a.prototype.getExtentGeometry=function(a,b,f,g){void 0===g&&(g=new d.Extent);this.getExtent(a,b,f,p);g.spatialReference=this.spatialReference;
g.xmin=p[0];g.ymin=p[1];g.xmax=p[2];g.ymax=p[3];g.zmin=void 0;g.zmax=void 0;return g};a.prototype.ensureMaxLod=function(a){if(null==a)return!1;for(var b=!1;this.levels.length<=a;){var b=this.levels[this.levels.length-1],f=b.resolution/2;this.levels.push({resolution:f,scale:b.scale/2,tileSize:[f*this.pixelSize,f*this.pixelSize]});b=!0}return b};a.prototype.capMaxLod=function(a){this.levels.length>a+1&&(this.levels.length=a+1)};a.prototype.getMaxLod=function(){return this.levels.length-1};a.prototype.scaleAtLevel=
function(a){return this.levels[0].scale/Math.pow(2,a)};a.prototype.levelAtScale=function(a){var b=this.levels[0].scale;return a>=b?0:Math.log(b/a)*Math.LOG2E};a.prototype.resolutionAtLevel=function(a){return this.levels[0].resolution/Math.pow(2,a)};a.prototype.compatibleWith=function(b){if(!(b instanceof a)){if(a.checkUnsupported(b))return!1;b=new a(b)}if(!b.spatialReference.equals(this.spatialReference)||b.pixelSize!==this.pixelSize)return!1;var f=Math.min(this.levels.length,b.levels.length)-1,g=
this.levels[f].resolution,c=.5*g;if(!k.floatEqualAbsolute(b.origin[0],this.origin[0],c)||!k.floatEqualAbsolute(b.origin[1],this.origin[1],c))return!1;c=.5*g/Math.pow(2,f)/this.pixelSize*12;return k.floatEqualAbsolute(g,b.levels[f].resolution,c)};a.prototype.rootTilesInExtent=function(b,f,g){var c=this.levels[0].tileSize;if(0===c[0]||0===c[1])return[];a.computeRowColExtent(b,c,this.origin,p);b=p[1];var d=p[3],e=p[0],m=p[2],h=m-e,k=d-b;h*k>g&&(g=Math.floor(Math.sqrt(g)),k>g&&(b=b+Math.floor(.5*k)-Math.floor(.5*
g),d=b+g),h>g&&(e=e+Math.floor(.5*h)-Math.floor(.5*g),m=e+g));g=[];for(h=b;h<d;h++)for(k=e;k<m;k++)g.push([0,h,k]);f&&(f[0]=this.origin[0]+e*c[0],f[1]=this.origin[1]-d*c[1],f[2]=this.origin[0]+m*c[0],f[3]=this.origin[1]-b*c[1]);return g};a.computeRowColExtent=function(a,b,f,g){var c=.001*(a[2]-a[0]+(a[3]-a[1]));g[0]=Math.max(0,Math.floor((a[0]+c-f[0])/b[0]));g[2]=Math.max(0,Math.ceil((a[2]-c-f[0])/b[0]));g[1]=Math.max(0,Math.floor((f[1]-a[3]+c)/b[1]));g[3]=Math.max(0,Math.ceil((f[1]-a[1]-c)/b[1]))};
a.isPowerOfTwo=function(a){a=a.lods;var b=a[0].resolution*Math.pow(2,a[0].level);return!a.some(function(a){return!k.floatEqualRelative(a.resolution,b/Math.pow(2,a.level))})};a.hasGapInLevels=function(a){a=a.lods.map(function(a){return a.level});a.sort(function(a,b){return a-b});for(var b=1;b<a.length;b++)if(a[b]!==a[0]+b)return!0;return!1};a.tileSizeSupported=function(a){var b=a.size[1];return b===a.size[0]&&0===(b&b-1)&&128<=b&&512>=b};a.checkUnsupported=function(b){return b?1>b.lods.length?new l("tilingscheme:generic",
"Tiling scheme must have at least one level"):a.isPowerOfTwo(b)?a.hasGapInLevels(b)?new l("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):a.tileSizeSupported(b)?null:new l("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new l("tilingscheme:power-of-two","Tiling scheme must be power of two"):new l("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};a.fromExtent=function(b,f){var g=b[2]-b[0],
c=b[3]-b[1],d=e.getMetersPerUnitForSR(f),h=1.2*Math.max(g,c);b=new a(new m({size:[256,256],origin:{x:b[0]-.5*(h-g),y:b[3]+.5*(h-c)},lods:[{level:0,resolution:h/256,scale:1/(256/96*.0254/(h*d))}],spatialReference:f}));b.ensureMaxLod(20);return b};a.makeWebMercatorAuxiliarySphere=function(b){var f=new a(a.WebMercatorAuxiliarySphereTileInfo);f.ensureMaxLod(b);return f};a.makeGCSWithTileSize=function(b,f,g){void 0===f&&(f=256);void 0===g&&(g=16);var c=256/f;b=new a(new m({size:[f,f],origin:{x:-180,y:90,
spatialReference:b},spatialReference:b,lods:[{level:0,resolution:.703125*c,scale:2.95497598570834E8*c}]}));b.ensureMaxLod(g);return b};Object.defineProperty(a.prototype,"test",{get:function(){return{isWebMercator:this._isWebMercator,isWGS84:this._isWGS84Comparable}},enumerable:!1,configurable:!0});a.WebMercatorAuxiliarySphereTileInfo=new m({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:c.WebMercator},spatialReference:c.WebMercator,lods:[{level:0,resolution:156543.03392800014,
scale:5.91657527591555E8}]});a.WebMercatorAuxiliarySphere=a.makeWebMercatorAuxiliarySphere(19);return a}();var p=h.create();return n})},"esri/layers/support/TileInfo":function(){define("require exports tslib ../../geometry ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p){var t=new k.default({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});return function(a){function e(b){b=a.call(this,b)||this;b.dpi=96;b.format=null;b.origin=null;b.minScale=0;b.maxScale=0;b.size=null;b.spatialReference=null;return b}d.__extends(e,a);k=e;e.create=function(a){void 0===
a&&(a={size:256,spatialReference:l.SpatialReference.WebMercator});var f=a.resolutionFactor||1,g=a.scales,e=a.size||256,d=a.spatialReference||l.SpatialReference.WebMercator;if(!b.isValid(d)){f=[];if(g)for(a=0;a<g.length;a++){var m=g[a];f.push({level:a,scale:m,resolution:m})}else{var h=5E-4;for(a=23;0<=a;a--)f.unshift({level:a,scale:h,resolution:h}),h*=2}return new k({dpi:96,lods:f,origin:new l.Point(0,0,d),size:[e,e],spatialReference:d})}var m=b.getInfo(d),p=a.origin?new l.Point({x:a.origin.x,y:a.origin.y,
spatialReference:d}):m?new l.Point({x:m.origin[0],y:m.origin[1],spatialReference:d}):new l.Point({x:0,y:0,spatialReference:d}),r=1/(39.37*c.getMetersPerUnitForSR(d)*96),t=[];if(g)for(a=0;a<g.length;a++)m=g[a],h=m*r,t.push({level:a,scale:m,resolution:h});else for(m=b.isGeographic(d)?512/e*5.916575275917094E8:256/e*5.91657527591555E8,g=Math.ceil(24/f),t.push({level:0,scale:m,resolution:m*r}),a=1;a<g;a++)m/=Math.pow(2,f),h=m*r,t.push({level:a,scale:m,resolution:h});return new k({dpi:96,lods:t,origin:p,
size:[e,e],spatialReference:d})};Object.defineProperty(e.prototype,"isWrappable",{get:function(){var a=this.spatialReference,f=this.origin;if(a&&f){var g=b.getInfo(a);return a.isWrappable&&Math.abs(g.origin[0]-f.x)<=g.dx}return!1},enumerable:!1,configurable:!0});e.prototype.readOrigin=function(a,b){return l.Point.fromJSON(d.__assign({spatialReference:b.spatialReference},a))};Object.defineProperty(e.prototype,"lods",{set:function(a){var b=this,f=0,g=0,c=[];this._levelToLOD={};a&&(f=-Infinity,g=Infinity,
a.forEach(function(a){c.push(a.scale);f=a.scale>f?a.scale:f;g=a.scale<g?a.scale:g;b._levelToLOD[a.level]=a}));this._set("scales",c);this._set("minScale",f);this._set("maxScale",g);this._set("lods",a);this._initializeUpsampleLevels()},enumerable:!1,configurable:!0});e.prototype.readSize=function(a,b){return[b.cols,b.rows]};e.prototype.writeSize=function(a,b){b.cols=a[0];b.rows=a[0]};e.prototype.zoomToScale=function(a){var b=this.scales;if(0>=a)return b[0];if(a>=b.length)return b[b.length-1];var f=
Math.round(a);return b[f]+(f-a)*(b[Math.round(a-.5)]-b[f])};e.prototype.scaleToZoom=function(a){for(var b=this.scales,f=b.length-1,g=0;g<f;g++){var c=b[g],e=b[g+1];if(c<=a)break;if(e===a)return g+1;if(c>a&&e<a)return g+1-(a-e)/(c-e)}return g};e.prototype.snapScale=function(a,b){void 0===b&&(b=.95);a=this.scaleToZoom(a);return a%Math.floor(a)>=b?this.zoomToScale(Math.ceil(a)):this.zoomToScale(Math.floor(a))};e.prototype.tileAt=function(a,c,e,d){var m=this.lodAt(a);if(!m)return null;var h;if("number"===
typeof c)h=c,c=e;else{if(b.equals(c.spatialReference,this.spatialReference))h=c.x,c=c.y;else{d=g.project(c,this.spatialReference);if(!d)return null;h=d.x;c=d.y}d=e}e=m.resolution*this.size[0];m=m.resolution*this.size[1];d||(d={id:null,level:0,row:0,col:0,extent:f.create()});d.level=a;d.row=Math.floor((this.origin.y-c)/m+.001);d.col=Math.floor((h-this.origin.x)/e+.001);this.updateTileInfo(d);return d};e.prototype.updateTileInfo=function(a){var b=this.lodAt(a.level);if(b){var g=b.resolution*this.size[0],
b=b.resolution*this.size[1];a.id=a.level+"/"+a.row+"/"+a.col;a.extent||(a.extent=f.create());a.extent[0]=this.origin.x+a.col*g;a.extent[1]=this.origin.y-(a.row+1)*b;a.extent[2]=a.extent[0]+g;a.extent[3]=a.extent[1]+b}};e.prototype.upsampleTile=function(a){var b=this._upsampleLevels[a.level];if(!b||-1===b.parentLevel)return!1;a.level=b.parentLevel;a.row=Math.floor(a.row/b.factor+.001);a.col=Math.floor(a.col/b.factor+.001);this.updateTileInfo(a);return!0};e.prototype.getTileBounds=function(a,b){var f=
this.lodAt(b.level).resolution,g=f*this.size[0],f=f*this.size[1];a[0]=this.origin.x+b.col*g;a[1]=this.origin.y-(b.row+1)*f;a[2]=a[0]+g;a[3]=a[1]+f;return a};e.prototype.lodAt=function(a){return this._levelToLOD&&this._levelToLOD[a]||null};e.prototype.clone=function(){return k.fromJSON(this.write({}))};e.prototype._initializeUpsampleLevels=function(){var a=this.lods;this._upsampleLevels=[];for(var b=null,f=0;f<a.length;f++){var g=a[f];this._upsampleLevels[g.level]={parentLevel:b?b.level:-1,factor:b?
b.resolution/g.resolution:0};b=g}};var k;d.__decorate([h.property({type:Number,json:{write:!0}})],e.prototype,"compressionQuality",void 0);d.__decorate([h.property({type:Number,json:{write:!0}})],e.prototype,"dpi",void 0);d.__decorate([h.property({type:String,json:{read:t.read,write:t.write,origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"format",void 0);d.__decorate([h.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],e.prototype,"isWrappable",null);d.__decorate([h.property({type:l.Point,
json:{write:!0}})],e.prototype,"origin",void 0);d.__decorate([h.reader("origin")],e.prototype,"readOrigin",null);d.__decorate([h.property({type:[p],value:null,json:{write:!0}})],e.prototype,"lods",null);d.__decorate([h.property({readOnly:!0})],e.prototype,"minScale",void 0);d.__decorate([h.property({readOnly:!0})],e.prototype,"maxScale",void 0);d.__decorate([h.property({readOnly:!0})],e.prototype,"scales",void 0);d.__decorate([h.property({cast:function(a){return Array.isArray(a)?a:"number"===typeof a?
[a,a]:[256,256]}})],e.prototype,"size",void 0);d.__decorate([h.reader("size",["rows","cols"])],e.prototype,"readSize",null);d.__decorate([h.writer("size",{cols:{type:m.Integer},rows:{type:m.Integer}})],e.prototype,"writeSize",null);d.__decorate([h.property({type:l.SpatialReference,json:{write:!0}})],e.prototype,"spatialReference",void 0);return e=k=d.__decorate([h.subclass("esri.layers.support.TileInfo")],e)}(e.JSONSupport)})},"esri/layers/support/LOD":function(){define("require exports tslib ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(n,a,d,l,k,e){return function(a){function c(f){f=a.call(this,f)||this;f.level=0;f.levelValue=null;f.resolution=0;f.scale=0;return f}d.__extends(c,a);m=c;c.prototype.clone=function(){return new m({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};var m;d.__decorate([k.property({type:e.Integer,json:{write:!0}})],c.prototype,"level",void 0);d.__decorate([k.property({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0);d.__decorate([k.property({type:Number,
json:{write:!0}})],c.prototype,"resolution",void 0);d.__decorate([k.property({type:Number,json:{write:!0}})],c.prototype,"scale",void 0);return c=m=d.__decorate([k.subclass("esri.layers.support.LOD")],c)}(l.JSONSupport)})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/geodesicConstants ../webgl-engine/lib/BufferVectorMath".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){function p(a,b,f,g){if(2>a.length)return!1;2===a.length&&(ba[0]=a[0],ba[1]=a[1],ba[2]=0,a=ba);return t(a,b,0,f,g,0,1)}function t(a,b,f,g,c,e,d){void 0===d&&(d=1);b=J(b,c,T);if(l.isNone(b))return!1;if(b===r){if(a===g&&f===e)return!0;for(b=f+3*d;f<b;f++,e++)g[e]=a[f];return!0}for(d=f+3*d;f<d;f+=3,e+=3)b(a,f,g,e);return!0}function u(b,f){if(f.spatialReference===b)return f.spatialReferenceId;f.spatialReference=b;"metersPerUnit"in f&&(f.metersPerUnit=k.getMetersPerUnitForSR(b,
1));return b.wkt===a.SphericalECEFSpatialReference.wkt?f.spatialReferenceId=1:b.isWGS84?f.spatialReferenceId=2:b.isWebMercator?f.spatialReferenceId=3:b.wkt===a.WGS84ECEFSpatialReference.wkt?f.spatialReferenceId=4:4490===b.wkid?f.spatialReferenceId=5:f.spatialReferenceId=0}function r(a,b,f,g){a!==f&&(f[g++]=a[b++],f[g++]=a[b++],f[g]=a[b])}function q(a,f,g,c){g[c++]=ca*(a[f++]/b.earthRadius);g[c++]=ca*(Math.PI/2-2*Math.atan(Math.exp(-1*a[f++]/b.earthRadius)));g[c]=a[f]}function v(a,b,f,g){q(a,b,f,g);
x(f,g,f,g)}function w(a,b,f,g){q(a,b,f,g);E(f,g,f,g)}function z(a,f,g,c){var e=.4999999*Math.PI,e=d.clamp(X*a[f+1],-e,e),e=Math.sin(e);g[c++]=X*a[f]*b.earthRadius;g[c++]=b.halfEarthRadius*Math.log((1+e)/(1-e));g[c]=a[f+2]}function x(a,f,g,c){var e=b.earthRadius+a[f+2],d=X*a[f+1];a=X*a[f];f=Math.cos(d);g[c++]=Math.cos(a)*f*e;g[c++]=Math.sin(a)*f*e;g[c]=Math.sin(d)*e}function B(a,f,c,e){var m=g.Vec3Compact.length(a,f),h=d.asinClamped(a[f+2]/(0===m?1:m));a=Math.atan2(a[f+1],a[f]);c[e++]=ca*a;c[e++]=
ca*h;c[e]=m-b.earthRadius}function A(a,b,f,g){B(a,b,f,g);z(f,g,f,g)}function C(a,b,f,g){B(a,b,f,g);E(f,g,f,g)}function E(a,f,g,c){var e=b.earthEllipsoidConstants,d=X*a[f],m=X*a[f+1];a=a[f+2];f=Math.sin(m);var m=Math.cos(m),h=e.a/Math.sqrt(1-e.e2*f*f);g[c++]=(h+a)*m*Math.cos(d);g[c++]=(h+a)*m*Math.sin(d);g[c++]=(h*(1-e.e2)+a)*f}function G(a,f,g,c){var e=b.earthEllipsoidConstants,d=a[f],m=a[f+1];a=a[f+2];var h,p,k,r,t,u;f=Math.abs(a);h=d*d+m*m;p=Math.sqrt(h);k=h+a*a;r=Math.sqrt(k);d=Math.atan2(m,d);
t=a*a/k;k=h/k;m=e.a2/r;h=e.a3-e.a4/r;.3<k?(t=f/r*(1+k*(e.a1+m+t*h)/r),r=Math.asin(t),m=t*t,k=Math.sqrt(1-m)):(k=p/r*(1-t*(e.a5-m-k*h)/r),r=Math.acos(k),m=1-k*k,t=Math.sqrt(m));u=1-e.e2*m;m=e.a/Math.sqrt(u);e=e.a6*m;m=p-m*k;h=f-e*t;f=k*m+t*h;p=k*h-t*m;e=p/(e/u+f);r+=e;0>a&&(r=-r);g[c++]=ca*d;g[c++]=ca*r;g[c]=f+p*e/2}function F(a,b,f,g){G(a,b,f,g);x(f,g,f,g)}function H(a,b,f,g){G(a,b,f,g);z(f,g,f,g)}function J(a,b,f){void 0===f&&(f=K());return I(a,b,f).projector}function I(a,b,f){if(f.source.spatialReference===
a&&f.dest.spatialReference===b)return f;var g=u(a,f.source),c=u(b,f.dest);0===g&&0===c?a.equals(b)?f.projector=r:f.projector=null:f.projector=U[g][c];return f}function K(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:r}}var L,M,Q,R,O,N,S,P;Object.defineProperty(a,"__esModule",{value:!0});a.getProjector=a.wgs84ComparableLonLatToECEF=a.vectorToWGS84ComparableLonLat=a.canProjectToWGS84ComparableLonLat=
a.webMercator=a.boundingRectToBoundingRect=a.mbsToMbs=a.transformDirection=a.computeLinearTransformation=a.localLinearScaleFactors=a.bufferToBuffer=a.xyzToVector=a.pathsToPaths=a.vectorToVector=a.getProjectorName=a.canProject=a.WGS84ECEFSpatialReference=a.SphericalECEFSpatialReference=void 0;a.SphericalECEFSpatialReference=new m({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",'+b.earthRadius+',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});
a.WGS84ECEFSpatialReference=new m({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});a.canProject=function(a,b){return!!J(a,b,T)};a.getProjectorName=function(a,b){a=
J(a,b,T);return a===r?"copy3":a===x?"wgs84ToSphericalECEF":a===z?"wgs84ToWebMercator":a===E?"wgs84ToWGS84ECEF":a===q?"webMercatorToWGS84":a===v?"webMercatorToSphericalECEF":a===w?"webMercatorToWGS84ECEF":a===G?"wgs84ECEFToWGS84":a===F?"wgs84ECEFToSphericalECEF":a===H?"wgs84ECEFToWebMercator":a===B?"sphericalECEFToWGS84":a===A?"sphericalECEFToWebMercator":a===C?"sphericalECEFToWGS84ECEF":null};a.vectorToVector=p;a.pathsToPaths=function(a,b,f,g,c,e,d){void 0===d&&(d=0);for(var m=[],h=0;h<a.length;h++)for(var p=
a[h],k=0,r=p;k<r.length;k++)p=r[k],m.push(p[0],p[1],b?p[2]:d);if(!t(m,g,0,m,e,0,m.length/3))return!1;g=0;for(e=c.length=0;e<a.length;e++){p=a[e];d=[];h=0;for(k=p;h<k.length;h++)p=k[h],b&&f?d.push([m[g++],m[g++],m[g++],p[3]]):b?d.push([m[g++],m[g++],m[g++]]):(f?d.push([m[g++],m[g++],p[2]]):d.push([m[g++],m[g++]]),g++);c.push(d)}return!0};a.xyzToVector=function(a,b,f,g,c,e){ba[0]=a;ba[1]=b;ba[2]=f;return t(ba,g,0,c,e,0,1)};a.bufferToBuffer=t;a.localLinearScaleFactors=function(a,f,g,e){var d=u(f,Z),
m=u(e,V);if(d===m&&0!==d||f.equals(e))return g[0]=1,g[1]=1,g[2]=1,!0;if(1===d){f=c.vec3.length(a);a=f/Math.sqrt(a[0]*a[0]+a[1]*a[1]);f/=b.earthRadius;if(3===m)return g[0]=a*f,g[1]=a*f,g[2]=1,!0;if(2===m||5===m)return m=180/(b.earthRadius*Math.PI),g[0]=m*a*f,g[1]=m*f,g[2]=1,!0}return!1};a.computeLinearTransformation=function(a,b,f,g){var c=u(a,Z),d=u(g,V);if(c===d&&1!==d&&(0!==c||a.equals(g)))return e.mat4.identity(f),e.mat4.translate(f,f,b),!0;if(1===d){a=U[c][6];d=U[6][d];if(l.isNone(a)||l.isNone(d))return!1;
a(b,0,ga,0);d(ga,0,ia,0);a=X*ga[0];d=X*ga[1];b=Math.sin(a);a=Math.cos(a);g=Math.sin(d);d=Math.cos(d);f[0]=-b;f[4]=-g*a;f[8]=d*a;f[12]=ia[0];f[1]=a;f[5]=-g*b;f[9]=d*b;f[13]=ia[1];f[2]=0;f[6]=d;f[10]=g;f[14]=ia[2];f[3]=0;f[7]=0;f[11]=0;f[15]=1;return!0}if(3===d&&(2===c||1===c)){a=U[c][6];if(l.isNone(a))return!1;a(b,0,ga,0);b=X*ga[1];z(ga,0,ia,0);e.mat4.identity(f);e.mat4.translate(f,f,ia);b=1/Math.cos(b);e.mat4.scale(f,f,[b,b,1]);return!0}return!1};a.transformDirection=function(a,b,f,g,e){c.vec3.copy(ha,
a);c.vec3.add(da,a,b);p(ha,f,ha,e);p(da,f,da,e);c.vec3.subtract(g,da,ha);c.vec3.normalize(g,g)};a.mbsToMbs=function(a,f,g,c){f=I(f,c,Y);if(f.projector===r)return g[0]=a[0],g[1]=a[1],g[2]=a[2],g[3]=a[3],!0;if(l.isNone(f.projector))return!1;c=f.source;var e=f.dest;if(3===e.spatialReferenceId){f=U[c.spatialReferenceId][2];if(l.isNone(f))return!1;f(a,0,ga,0);f=Math.abs(X*ga[1])+Math.asin(a[3]/(b.earthRadius+a[2]));z(ga,0,g,0);g[3]=f>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(f)*a[3];return!0}f.projector(a,
0,g,0);g[3]=a[3]*c.metersPerUnit/e.metersPerUnit;return!0};a.boundingRectToBoundingRect=function(a,b,g,c){if(null==a)return!1;if(b.equals(c))return f.set(g,a),!0;ba[0]=a[0];ba[1]=a[1];ba[2]=0;if(!t(ba,b,0,ba,c,0,1))return!1;g[0]=ba[0];g[1]=ba[1];ba[0]=a[2];ba[1]=a[3];ba[2]=0;if(!t(ba,b,0,ba,c,0,1))return!1;g[2]=ba[0];g[3]=ba[1];return!0};(function(a){a.x2lon=function(a){return a/b.earthRadius};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/b.earthRadius))};a.lon2x=function(a){return a*
b.earthRadius};a.lat2y=function(a){a=Math.sin(a);return b.earthRadius/2*Math.log((1+a)/(1-a))}})(a.webMercator||(a.webMercator={}));a.canProjectToWGS84ComparableLonLat=function(a){a=u(a,Z);return!!U[a][6]};a.vectorToWGS84ComparableLonLat=function(a,b,f){b=u(b,Z);b=U[b][6];if(l.isNone(b))return!1;b(a,0,ba,0);f!==ba&&(f[0]=ba[0],f[1]=ba[1],2<f.length&&(f[2]=ba[2]));return!0};a.wgs84ComparableLonLatToECEF=function(a,f,g,c){void 0===c&&(c=0);c=b.earthRadius+c;var e=Math.cos(g);a[0]=Math.cos(f)*e*c;a[1]=
Math.sin(f)*e*c;a[2]=Math.sin(g)*c};var U=(L={},L[2]=(M={},M[5]=null,M[6]=r,M[1]=x,M[0]=null,M[3]=z,M[2]=r,M[4]=E,M),L[5]=(Q={},Q[5]=r,Q[6]=r,Q[1]=x,Q[0]=null,Q[3]=null,Q[2]=null,Q[4]=E,Q),L[3]=(R={},R[5]=null,R[6]=q,R[1]=v,R[0]=null,R[3]=r,R[2]=q,R[4]=w,R),L[4]=(O={},O[5]=G,O[6]=G,O[1]=F,O[0]=null,O[3]=H,O[2]=G,O[4]=r,O),L[1]=(N={},N[5]=B,N[6]=B,N[1]=r,N[0]=null,N[3]=A,N[2]=B,N[4]=C,N),L[0]=(S={},S[5]=null,S[6]=null,S[1]=null,S[0]=r,S[3]=null,S[2]=null,S[4]=null,S),L[6]=(P={},P[5]=null,P[6]=r,P[1]=
x,P[0]=null,P[3]=null,P[2]=r,P[4]=E,P),L);a.getProjector=J;var Z={spatialReference:null,spatialReferenceId:0},V={spatialReference:null,spatialReferenceId:0},T=K(),Y=K(),X=d.deg2rad(1),ca=d.rad2deg(1),ba=h.vec3f64.create(),ga=h.vec3f64.create(),ia=h.vec3f64.create(),ha=h.vec3f64.create(),da=h.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require","exports","./math/mat4"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.mat4=void 0;a.mat4=d})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require",
"exports","../factories/vec3f64","./common"],function(n,a,d,l){function k(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function e(a,b,g){var f=b[0],c=b[1],e=b[2],d=b[3],m=b[4],h=b[5],k=b[6],l=b[7],x=b[8],B=b[9],A=b[10],C=b[11],E=b[12],G=b[13],F=b[14];b=b[15];var H=g[0],J=g[1],I=g[2],K=g[3];a[0]=H*f+J*m+I*x+K*E;a[1]=H*c+J*h+I*B+K*G;a[2]=H*e+J*k+I*A+K*F;a[3]=H*d+J*l+I*C+K*b;H=g[4];J=g[5];I=g[6];K=g[7];a[4]=H*f+J*m+
I*x+K*E;a[5]=H*c+J*h+I*B+K*G;a[6]=H*e+J*k+I*A+K*F;a[7]=H*d+J*l+I*C+K*b;H=g[8];J=g[9];I=g[10];K=g[11];a[8]=H*f+J*m+I*x+K*E;a[9]=H*c+J*h+I*B+K*G;a[10]=H*e+J*k+I*A+K*F;a[11]=H*d+J*l+I*C+K*b;H=g[12];J=g[13];I=g[14];K=g[15];a[12]=H*f+J*m+I*x+K*E;a[13]=H*c+J*h+I*B+K*G;a[14]=H*e+J*k+I*A+K*F;a[15]=H*d+J*l+I*C+K*b;return a}function c(a,b,g){var f=b[0],c=b[1],e=b[2],d=b[3],m=f+f,h=c+c,k=e+e;b=f*m;var l=f*h,f=f*k,x=c*h,c=c*k,e=e*k,m=d*m,h=d*h,d=d*k;a[0]=1-(x+e);a[1]=l+d;a[2]=f-h;a[3]=0;a[4]=l-d;a[5]=1-(b+e);
a[6]=c+m;a[7]=0;a[8]=f+h;a[9]=c-m;a[10]=1-(b+x);a[11]=0;a[12]=g[0];a[13]=g[1];a[14]=g[2];a[15]=1;return a}function h(a,b,g){a[0]=b[0]-g[0];a[1]=b[1]-g[1];a[2]=b[2]-g[2];a[3]=b[3]-g[3];a[4]=b[4]-g[4];a[5]=b[5]-g[5];a[6]=b[6]-g[6];a[7]=b[7]-g[7];a[8]=b[8]-g[8];a[9]=b[9]-g[9];a[10]=b[10]-g[10];a[11]=b[11]-g[11];a[12]=b[12]-g[12];a[13]=b[13]-g[13];a[14]=b[14]-g[14];a[15]=b[15]-g[15];return a}Object.defineProperty(a,"__esModule",{value:!0});a.sub=a.mul=a.equals=a.exactEquals=a.multiplyScalarAndAdd=a.multiplyScalar=
a.subtract=a.add=a.frob=a.str=a.targetTo=a.lookAt=a.ortho=a.perspectiveFromFieldOfView=a.perspective=a.frustum=a.fromQuat=a.fromRotationTranslationScaleOrigin=a.fromRotationTranslationScale=a.getRotation=a.getScaling=a.getTranslation=a.fromQuat2=a.fromRotationTranslation=a.fromZRotation=a.fromYRotation=a.fromXRotation=a.fromRotation=a.fromScaling=a.fromTranslation=a.rotateZ=a.rotateY=a.rotateX=a.rotate=a.scale=a.translate=a.multiply=a.determinant=a.adjoint=a.invert=a.transpose=a.identity=a.set=a.copy=
void 0;a.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};a.set=function(a,b,g,c,e,d,m,h,k,l,z,x,B,A,C,E,G){a[0]=b;a[1]=g;a[2]=c;a[3]=e;a[4]=d;a[5]=m;a[6]=h;a[7]=k;a[8]=l;a[9]=z;a[10]=x;a[11]=B;a[12]=A;a[13]=C;a[14]=E;a[15]=G;return a};a.identity=k;a.transpose=function(a,b){if(a===b){var f=b[1],c=b[2],e=b[3],d=b[6],m=b[7],h=b[11];a[1]=b[4];a[2]=b[8];
a[3]=b[12];a[4]=f;a[6]=b[9];a[7]=b[13];a[8]=c;a[9]=d;a[11]=b[14];a[12]=e;a[13]=m;a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};a.invert=function(a,b){var f=b[0],c=b[1],e=b[2],d=b[3],m=b[4],h=b[5],k=b[6],l=b[7],z=b[8],x=b[9],B=b[10],A=b[11],C=b[12],E=b[13],G=b[14];b=b[15];var F=f*h-c*m,H=f*k-e*m,J=f*l-d*m,I=c*k-e*h,K=c*l-d*h,L=e*l-d*k,M=z*E-x*C,Q=z*G-
B*C,n=z*b-A*C,O=x*G-B*E,N=x*b-A*E,S=B*b-A*G,P=F*S-H*N+J*O+I*n-K*Q+L*M;if(!P)return null;P=1/P;a[0]=(h*S-k*N+l*O)*P;a[1]=(e*N-c*S-d*O)*P;a[2]=(E*L-G*K+b*I)*P;a[3]=(B*K-x*L-A*I)*P;a[4]=(k*n-m*S-l*Q)*P;a[5]=(f*S-e*n+d*Q)*P;a[6]=(G*J-C*L-b*H)*P;a[7]=(z*L-B*J+A*H)*P;a[8]=(m*N-h*n+l*M)*P;a[9]=(c*n-f*N-d*M)*P;a[10]=(C*K-E*J+b*F)*P;a[11]=(x*J-z*K-A*F)*P;a[12]=(h*Q-m*O-k*M)*P;a[13]=(f*O-c*Q+e*M)*P;a[14]=(E*H-C*I-G*F)*P;a[15]=(z*I-x*H+B*F)*P;return a};a.adjoint=function(a,b){var f=b[0],c=b[1],e=b[2],d=b[3],
m=b[4],h=b[5],k=b[6],l=b[7],z=b[8],x=b[9],B=b[10],A=b[11],C=b[12],E=b[13],G=b[14];b=b[15];a[0]=h*(B*b-A*G)-x*(k*b-l*G)+E*(k*A-l*B);a[1]=-(c*(B*b-A*G)-x*(e*b-d*G)+E*(e*A-d*B));a[2]=c*(k*b-l*G)-h*(e*b-d*G)+E*(e*l-d*k);a[3]=-(c*(k*A-l*B)-h*(e*A-d*B)+x*(e*l-d*k));a[4]=-(m*(B*b-A*G)-z*(k*b-l*G)+C*(k*A-l*B));a[5]=f*(B*b-A*G)-z*(e*b-d*G)+C*(e*A-d*B);a[6]=-(f*(k*b-l*G)-m*(e*b-d*G)+C*(e*l-d*k));a[7]=f*(k*A-l*B)-m*(e*A-d*B)+z*(e*l-d*k);a[8]=m*(x*b-A*E)-z*(h*b-l*E)+C*(h*A-l*x);a[9]=-(f*(x*b-A*E)-z*(c*b-d*E)+
C*(c*A-d*x));a[10]=f*(h*b-l*E)-m*(c*b-d*E)+C*(c*l-d*h);a[11]=-(f*(h*A-l*x)-m*(c*A-d*x)+z*(c*l-d*h));a[12]=-(m*(x*G-B*E)-z*(h*G-k*E)+C*(h*B-k*x));a[13]=f*(x*G-B*E)-z*(c*G-e*E)+C*(c*B-e*x);a[14]=-(f*(h*G-k*E)-m*(c*G-e*E)+C*(c*k-e*h));a[15]=f*(h*B-k*x)-m*(c*B-e*x)+z*(c*k-e*h);return a};a.determinant=function(a){var b=a[0],f=a[1],c=a[2],e=a[3],d=a[4],m=a[5],h=a[6],k=a[7],l=a[8],z=a[9],x=a[10],B=a[11],A=a[12],C=a[13],E=a[14];a=a[15];return(b*m-f*d)*(x*a-B*E)-(b*h-c*d)*(z*a-B*C)+(b*k-e*d)*(z*E-x*C)+(f*
h-c*m)*(l*a-B*A)-(f*k-e*m)*(l*E-x*A)+(c*k-e*h)*(l*C-z*A)};a.multiply=e;a.translate=function(a,b,g){var f=g[0],c=g[1];g=g[2];var e=void 0,d=void 0,m=void 0,h=void 0,k=void 0,l=void 0,x=void 0,B=void 0,A=void 0,C=void 0,E=void 0,G=void 0;b===a?(a[12]=b[0]*f+b[4]*c+b[8]*g+b[12],a[13]=b[1]*f+b[5]*c+b[9]*g+b[13],a[14]=b[2]*f+b[6]*c+b[10]*g+b[14],a[15]=b[3]*f+b[7]*c+b[11]*g+b[15]):(e=b[0],d=b[1],m=b[2],h=b[3],k=b[4],l=b[5],x=b[6],B=b[7],A=b[8],C=b[9],E=b[10],G=b[11],a[0]=e,a[1]=d,a[2]=m,a[3]=h,a[4]=k,a[5]=
l,a[6]=x,a[7]=B,a[8]=A,a[9]=C,a[10]=E,a[11]=G,a[12]=e*f+k*c+A*g+b[12],a[13]=d*f+l*c+C*g+b[13],a[14]=m*f+x*c+E*g+b[14],a[15]=h*f+B*c+G*g+b[15]);return a};a.scale=function(a,b,g){var f=g[0],c=g[1];g=g[2];a[0]=b[0]*f;a[1]=b[1]*f;a[2]=b[2]*f;a[3]=b[3]*f;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*g;a[9]=b[9]*g;a[10]=b[10]*g;a[11]=b[11]*g;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};a.rotate=function(a,b,g,c){var f=c[0],e=c[1];c=c[2];var d=Math.sqrt(f*f+e*e+c*c),m=void 0,h=void 0,
p=void 0,k=void 0,x=void 0,B=void 0,A=void 0,C=void 0,E=void 0,G=void 0,F=void 0,H=void 0,J=void 0,I=void 0,K=void 0,L=void 0,M=void 0,Q=void 0,n=void 0,O=void 0,N=void 0,S=void 0,h=m=void 0;if(d<l.EPSILON)return null;d=1/d;f*=d;e*=d;c*=d;m=Math.sin(g);h=Math.cos(g);p=1-h;k=b[0];x=b[1];B=b[2];A=b[3];C=b[4];E=b[5];G=b[6];F=b[7];H=b[8];J=b[9];I=b[10];K=b[11];L=f*f*p+h;M=e*f*p+c*m;Q=c*f*p-e*m;n=f*e*p-c*m;O=e*e*p+h;N=c*e*p+f*m;S=f*c*p+e*m;m=e*c*p-f*m;h=c*c*p+h;a[0]=k*L+C*M+H*Q;a[1]=x*L+E*M+J*Q;a[2]=B*
L+G*M+I*Q;a[3]=A*L+F*M+K*Q;a[4]=k*n+C*O+H*N;a[5]=x*n+E*O+J*N;a[6]=B*n+G*O+I*N;a[7]=A*n+F*O+K*N;a[8]=k*S+C*m+H*h;a[9]=x*S+E*m+J*h;a[10]=B*S+G*m+I*h;a[11]=A*S+F*m+K*h;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};a.rotateX=function(a,b,g){var f=Math.sin(g);g=Math.cos(g);var c=b[4],e=b[5],d=b[6],m=b[7],h=b[8],k=b[9],l=b[10],x=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=c*g+h*f;a[5]=e*g+k*f;a[6]=d*g+l*f;a[7]=m*g+x*f;
a[8]=h*g-c*f;a[9]=k*g-e*f;a[10]=l*g-d*f;a[11]=x*g-m*f;return a};a.rotateY=function(a,b,g){var f=Math.sin(g);g=Math.cos(g);var c=b[0],e=b[1],d=b[2],m=b[3],h=b[8],k=b[9],l=b[10],x=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=c*g-h*f;a[1]=e*g-k*f;a[2]=d*g-l*f;a[3]=m*g-x*f;a[8]=c*f+h*g;a[9]=e*f+k*g;a[10]=d*f+l*g;a[11]=m*f+x*g;return a};a.rotateZ=function(a,b,g){var f=Math.sin(g);g=Math.cos(g);var c=b[0],e=b[1],d=b[2],m=b[3],h=b[4],k=b[5],
l=b[6],x=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=c*g+h*f;a[1]=e*g+k*f;a[2]=d*g+l*f;a[3]=m*g+x*f;a[4]=h*g-c*f;a[5]=k*g-e*f;a[6]=l*g-d*f;a[7]=x*g-m*f;return a};a.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};a.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;
a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromRotation=function(a,b,g){var f=g[0],c=g[1];g=g[2];var e=Math.sqrt(f*f+c*c+g*g),d=void 0,m=void 0,h=void 0;if(e<l.EPSILON)return null;e=1/e;f*=e;c*=e;g*=e;d=Math.sin(b);m=Math.cos(b);h=1-m;a[0]=f*f*h+m;a[1]=c*f*h+g*d;a[2]=g*f*h-c*d;a[3]=0;a[4]=f*c*h-g*d;a[5]=c*c*h+m;a[6]=g*c*h+f*d;a[7]=0;a[8]=f*g*h+c*d;a[9]=c*g*h-f*d;a[10]=g*g*h+m;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromXRotation=function(a,b){var g=Math.sin(b);b=Math.cos(b);
a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=g;a[7]=0;a[8]=0;a[9]=-g;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromYRotation=function(a,b){var g=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-g;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=g;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromZRotation=function(a,b){var g=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=g;a[2]=0;a[3]=0;a[4]=-g;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;
return a};a.fromRotationTranslation=c;a.fromQuat2=function(a,b){var g=m,f=-b[0],e=-b[1],d=-b[2],h=b[3],k=b[4],l=b[5],w=b[6],z=b[7],x=f*f+e*e+d*d+h*h;0<x?(g[0]=2*(k*h+z*f+l*d-w*e)/x,g[1]=2*(l*h+z*e+w*f-k*d)/x,g[2]=2*(w*h+z*d+k*e-l*f)/x):(g[0]=2*(k*h+z*f+l*d-w*e),g[1]=2*(l*h+z*e+w*f-k*d),g[2]=2*(w*h+z*d+k*e-l*f));c(a,b,g);return a};var m=d.create();a.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};a.getScaling=function(a,b){var g=b[0],f=b[1],c=b[2],e=b[4],d=b[5],m=b[6],h=b[8],
k=b[9];b=b[10];a[0]=Math.sqrt(g*g+f*f+c*c);a[1]=Math.sqrt(e*e+d*d+m*m);a[2]=Math.sqrt(h*h+k*k+b*b);return a};a.getRotation=function(a,b){var g=b[0]+b[5]+b[10],f=0;0<g?(f=2*Math.sqrt(g+1),a[3]=.25*f,a[0]=(b[6]-b[9])/f,a[1]=(b[8]-b[2])/f,a[2]=(b[1]-b[4])/f):b[0]>b[5]&&b[0]>b[10]?(f=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/f,a[0]=.25*f,a[1]=(b[1]+b[4])/f,a[2]=(b[8]+b[2])/f):b[5]>b[10]?(f=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/f,a[0]=(b[1]+b[4])/f,a[1]=.25*f,a[2]=(b[6]+b[9])/f):(f=2*Math.sqrt(1+
b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/f,a[0]=(b[8]+b[2])/f,a[1]=(b[6]+b[9])/f,a[2]=.25*f);return a};a.fromRotationTranslationScale=function(a,b,g,c){var f=b[0],e=b[1],d=b[2],m=b[3],h=f+f,p=e+e,k=d+d;b=f*h;var l=f*p,f=f*k,B=e*p,e=e*k,d=d*k,h=m*h,p=m*p,m=m*k,k=c[0],A=c[1];c=c[2];a[0]=(1-(B+d))*k;a[1]=(l+m)*k;a[2]=(f-p)*k;a[3]=0;a[4]=(l-m)*A;a[5]=(1-(b+d))*A;a[6]=(e+h)*A;a[7]=0;a[8]=(f+p)*c;a[9]=(e-h)*c;a[10]=(1-(b+B))*c;a[11]=0;a[12]=g[0];a[13]=g[1];a[14]=g[2];a[15]=1;return a};a.fromRotationTranslationScaleOrigin=
function(a,b,g,c,e){var f=b[0],d=b[1],m=b[2],h=b[3],p=f+f,k=d+d,t=m+m;b=f*p;var l=f*k,A=f*t,f=d*k,d=d*t,C=m*t,m=h*p,k=h*k,E=h*t,G=c[0],F=c[1],t=c[2];c=e[0];h=e[1];e=e[2];var p=(1-(f+C))*G,H=(l+E)*G,G=(A-k)*G,l=(l-E)*F,C=(1-(b+C))*F,F=(d+m)*F,A=(A+k)*t,d=(d-m)*t;b=(1-(b+f))*t;a[0]=p;a[1]=H;a[2]=G;a[3]=0;a[4]=l;a[5]=C;a[6]=F;a[7]=0;a[8]=A;a[9]=d;a[10]=b;a[11]=0;a[12]=g[0]+c-(p*c+l*h+A*e);a[13]=g[1]+h-(H*c+C*h+d*e);a[14]=g[2]+e-(G*c+F*h+b*e);a[15]=1;return a};a.fromQuat=function(a,b){var g=b[0],f=b[1],
c=b[2];b=b[3];var e=g+g,d=f+f,m=c+c,g=g*e,h=f*e,f=f*d,k=c*e,l=c*d,c=c*m,e=b*e,d=b*d;b*=m;a[0]=1-f-c;a[1]=h+b;a[2]=k-d;a[3]=0;a[4]=h-b;a[5]=1-g-c;a[6]=l+e;a[7]=0;a[8]=k+d;a[9]=l-e;a[10]=1-g-f;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.frustum=function(a,b,g,c,e,d,m){var f=1/(g-b),h=1/(e-c),p=1/(d-m);a[0]=2*d*f;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*d*h;a[6]=0;a[7]=0;a[8]=(g+b)*f;a[9]=(e+c)*h;a[10]=(m+d)*p;a[11]=-1;a[12]=0;a[13]=0;a[14]=m*d*2*p;a[15]=0;return a};a.perspective=function(a,b,g,c,
e){b=1/Math.tan(b/2);var f=void 0;a[0]=b/g;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=e&&Infinity!==e?(f=1/(c-e),a[10]=(e+c)*f,a[14]=2*e*c*f):(a[10]=-1,a[14]=-2*c);return a};a.perspectiveFromFieldOfView=function(a,b,g,c){var f=Math.tan(b.upDegrees*Math.PI/180),e=Math.tan(b.downDegrees*Math.PI/180),d=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var m=2/(d+b),h=2/(f+e);a[0]=m;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=h;
a[6]=0;a[7]=0;a[8]=-((d-b)*m*.5);a[9]=(f-e)*h*.5;a[10]=c/(g-c);a[11]=-1;a[12]=0;a[13]=0;a[14]=c*g/(g-c);a[15]=0;return a};a.ortho=function(a,b,g,c,e,d,m){var f=1/(b-g),h=1/(c-e),p=1/(d-m);a[0]=-2*f;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*h;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*p;a[11]=0;a[12]=(b+g)*f;a[13]=(e+c)*h;a[14]=(m+d)*p;a[15]=1;return a};a.lookAt=function(a,b,g,c){var f=void 0,e=void 0,d=void 0,m=void 0,h=void 0,p=void 0,z=void 0,x=void 0,B=void 0,A=void 0,C=b[0],E=b[1];b=b[2];d=c[0];m=c[1];c=c[2];
z=g[0];x=g[1];g=g[2];if(Math.abs(C-z)<l.EPSILON&&Math.abs(E-x)<l.EPSILON&&Math.abs(b-g)<l.EPSILON)return k(a);z=C-z;x=E-x;B=b-g;A=1/Math.sqrt(z*z+x*x+B*B);z*=A;x*=A;B*=A;f=m*B-c*x;e=c*z-d*B;d=d*x-m*z;(A=Math.sqrt(f*f+e*e+d*d))?(A=1/A,f*=A,e*=A,d*=A):d=e=f=0;m=x*d-B*e;h=B*f-z*d;p=z*e-x*f;(A=Math.sqrt(m*m+h*h+p*p))?(A=1/A,m*=A,h*=A,p*=A):p=h=m=0;a[0]=f;a[1]=m;a[2]=z;a[3]=0;a[4]=e;a[5]=h;a[6]=x;a[7]=0;a[8]=d;a[9]=p;a[10]=B;a[11]=0;a[12]=-(f*C+e*E+d*b);a[13]=-(m*C+h*E+p*b);a[14]=-(z*C+x*E+B*b);a[15]=
1;return a};a.targetTo=function(a,b,g,c){var f=b[0],e=b[1];b=b[2];var d=c[0],m=c[1],h=c[2];c=f-g[0];var p=e-g[1];g=b-g[2];var k=c*c+p*p+g*g;0<k&&(k=1/Math.sqrt(k),c*=k,p*=k,g*=k);var l=m*g-h*p,h=h*c-d*g,d=d*p-m*c,k=l*l+h*h+d*d;0<k&&(k=1/Math.sqrt(k),l*=k,h*=k,d*=k);a[0]=l;a[1]=h;a[2]=d;a[3]=0;a[4]=p*d-g*h;a[5]=g*l-c*d;a[6]=c*h-p*l;a[7]=0;a[8]=c;a[9]=p;a[10]=g;a[11]=0;a[12]=f;a[13]=e;a[14]=b;a[15]=1;return a};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+
a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};a.add=function(a,b,g){a[0]=b[0]+g[0];a[1]=b[1]+g[1];a[2]=b[2]+g[2];a[3]=b[3]+g[3];
a[4]=b[4]+g[4];a[5]=b[5]+g[5];a[6]=b[6]+g[6];a[7]=b[7]+g[7];a[8]=b[8]+g[8];a[9]=b[9]+g[9];a[10]=b[10]+g[10];a[11]=b[11]+g[11];a[12]=b[12]+g[12];a[13]=b[13]+g[13];a[14]=b[14]+g[14];a[15]=b[15]+g[15];return a};a.subtract=h;a.multiplyScalar=function(a,b,g){a[0]=b[0]*g;a[1]=b[1]*g;a[2]=b[2]*g;a[3]=b[3]*g;a[4]=b[4]*g;a[5]=b[5]*g;a[6]=b[6]*g;a[7]=b[7]*g;a[8]=b[8]*g;a[9]=b[9]*g;a[10]=b[10]*g;a[11]=b[11]*g;a[12]=b[12]*g;a[13]=b[13]*g;a[14]=b[14]*g;a[15]=b[15]*g;return a};a.multiplyScalarAndAdd=function(a,
b,g,c){a[0]=b[0]+g[0]*c;a[1]=b[1]+g[1]*c;a[2]=b[2]+g[2]*c;a[3]=b[3]+g[3]*c;a[4]=b[4]+g[4]*c;a[5]=b[5]+g[5]*c;a[6]=b[6]+g[6]*c;a[7]=b[7]+g[7]*c;a[8]=b[8]+g[8]*c;a[9]=b[9]+g[9]*c;a[10]=b[10]+g[10]*c;a[11]=b[11]+g[11]*c;a[12]=b[12]+g[12]*c;a[13]=b[13]+g[13]*c;a[14]=b[14]+g[14]*c;a[15]=b[15]+g[15]*c;return a};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&
a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};a.equals=function(a,b){var g=a[0],c=a[1],e=a[2],f=a[3],d=a[4],m=a[5],h=a[6],k=a[7],z=a[8],x=a[9],B=a[10],A=a[11],C=a[12],E=a[13],G=a[14];a=a[15];var F=b[0],H=b[1],J=b[2],I=b[3],K=b[4],L=b[5],M=b[6],Q=b[7],n=b[8],O=b[9],N=b[10],S=b[11],P=b[12],U=b[13],Z=b[14];b=b[15];return Math.abs(g-F)<=l.EPSILON*Math.max(1,Math.abs(g),Math.abs(F))&&Math.abs(c-H)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(H))&&Math.abs(e-J)<=l.EPSILON*Math.max(1,Math.abs(e),
Math.abs(J))&&Math.abs(f-I)<=l.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(d-K)<=l.EPSILON*Math.max(1,Math.abs(d),Math.abs(K))&&Math.abs(m-L)<=l.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(h-M)<=l.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(k-Q)<=l.EPSILON*Math.max(1,Math.abs(k),Math.abs(Q))&&Math.abs(z-n)<=l.EPSILON*Math.max(1,Math.abs(z),Math.abs(n))&&Math.abs(x-O)<=l.EPSILON*Math.max(1,Math.abs(x),Math.abs(O))&&Math.abs(B-N)<=l.EPSILON*Math.max(1,Math.abs(B),Math.abs(N))&&
Math.abs(A-S)<=l.EPSILON*Math.max(1,Math.abs(A),Math.abs(S))&&Math.abs(C-P)<=l.EPSILON*Math.max(1,Math.abs(C),Math.abs(P))&&Math.abs(E-U)<=l.EPSILON*Math.max(1,Math.abs(E),Math.abs(U))&&Math.abs(G-Z)<=l.EPSILON*Math.max(1,Math.abs(G),Math.abs(Z))&&Math.abs(a-b)<=l.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.mul=e;a.sub=h})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.Vec3Compact=void 0;
(function(a){a.length=function(a,d){var e=a[d],c=a[d+1];a=a[d+2];return Math.sqrt(e*e+c*c+a*a)};a.normalize=function(a,d){var e=a[d],c=a[d+1],h=a[d+2],e=1/Math.sqrt(e*e+c*c+h*h);a[d]*=e;a[d+1]*=e;a[d+2]*=e};a.scale=function(a,d,e){a[d]*=e;a[d+1]*=e;a[d+2]*=e};a.add=function(a,d,e,c,h,m){void 0===m&&(m=d);h=h||a;h[m]=a[d]+e[c];h[m+1]=a[d+1]+e[c+1];h[m+2]=a[d+2]+e[c+2]};a.subtract=function(a,d,e,c,h,m){void 0===m&&(m=d);h=h||a;h[m]=a[d]-e[c];h[m+1]=a[d+1]-e[c+1];h[m+2]=a[d+2]-e[c+2]}})(a.Vec3Compact||
(a.Vec3Compact={}))})},"esri/views/PopupView":function(){define("require exports tslib ../core/arrayUtils ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.PopupView=void 0;a.PopupView=function(a){return function(a){function f(){return null!==a&&a.apply(this,arguments)||this}d.__extends(f,a);f.prototype.fetchPopupFeatures=function(a,g){return d.__awaiter(this,void 0,void 0,function(){var b,c,
f,m,h,k,w,z,x;return d.__generator(this,function(p){switch(p.label){case 0:return[4,this.when()];case 1:return p.sent(),[4,this._prepareFetchPopupFeatures(a,g)];case 2:return b=p.sent(),c=b.location,f=b.queryArea,m=b.layerViewsAndGraphics,h=b.clientOnlyGraphics,k=e.resolve(h),w=this._queryLayerPopupFeatures({queryArea:f,layerViewsAndGraphics:m,options:g}),z=w.map(function(a){return a.promise}),x=e.eachAlwaysValues(d.__spreadArrays([k],z)).then(l.flatten),[2,{location:c,clientOnlyGraphics:h,allGraphicsPromise:x,
promisesPerLayerView:w}]}})})};f.prototype._queryLayerPopupFeatures=function(a){var b=a.queryArea,c=a.options;return a.layerViewsAndGraphics.map(function(a){var g=a.layerView;a={clientGraphics:a.graphics,event:k.isSome(c)?c.event:null,signal:k.isSome(c)?c.signal:null,defaultPopupTemplateEnabled:k.isSome(c)?!!c.defaultPopupTemplateEnabled:!1};a=g.fetchPopupFeatures(b,a);return{layerView:g,promise:a}})};f.prototype._isValidPopupGraphic=function(a,g){return a&&!!a.getEffectivePopupTemplate(k.isSome(g)&&
g.defaultPopupTemplateEnabled)};f.prototype._prepareFetchPopupFeatures=function(a,g){return d.__awaiter(this,void 0,void 0,function(){var b,c,f,e,m,h,k,l;return d.__generator(this,function(d){switch(d.label){case 0:return[4,this._popupHitTestGraphics(a,g)];case 1:return b=d.sent(),c=b.clientGraphics,f=b.queryArea,e=b.location,m=this._getFetchPopupLayerViews(),h=this._graphicsPerFetchPopupLayerView(c,m),k=h.layerViewsAndGraphics,l=h.clientOnlyGraphics,[2,{clientOnlyGraphics:l,layerViewsAndGraphics:k,
queryArea:f,location:e}]}})})};f.prototype._popupHitTestGraphics=function(a,g){return d.__awaiter(this,void 0,void 0,function(){var b,c,f,e,m,h,k=this;return d.__generator(this,function(d){switch(d.label){case 0:return[4,this.popupHitTest(a)];case 1:return b=d.sent(),c=b.results,f=b.mapPoint,e=c.filter(function(a){return k._isValidPopupGraphic(a.graphic,g)}),m=e.length?e[0].mapPoint:null,h=e.map(function(a){return a.graphic}),[2,{clientGraphics:h,queryArea:f,location:f||m}]}})})};f.prototype._getFetchPopupLayerViews=
function(){var a=this,g=[];this.allLayerViews.forEach(function(b){a._isValidPopupLayerView(b)&&g.push(b)});k.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&g.push(this.graphicsView);return g.reverse()};f.prototype._isValidPopupLayerView=function(a){return k.isSome(a)&&(!("layer"in a)||!a.suspended)&&"fetchPopupFeatures"in a};f.prototype._graphicsPerFetchPopupLayerView=function(a,g){var b=[],c=new Map;g=g.map(function(a){var b=[];"layer"in a?c.set(a.layer,b):c.set(a.graphics,
b);return{layerView:a,graphics:b}});for(var d=0;d<a.length;d++){var f=a[d],e=c.get(f.layer)||null;e?e.push(f):b.push(f)}return{layerViewsAndGraphics:g,clientOnlyGraphics:b}};return f=d.__decorate([c.subclass("esri.views.PopupView")],f)}(a)}})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe","@dojo/framework/shim/Promise"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.layerView3DImporter=void 0;var k=function(){return new Promise(function(a,
c){n(["./layers/TileLayerView3D"],a,c)})},e=function(){return new Promise(function(a,c){n(["./layers/FeatureLayerView3D"],a,c)})},c=function(){return new Promise(function(a,c){n(["./layers/ElevationLayerView3D"],a,c)})},h={"base-dynamic":function(){return new Promise(function(a,c){n(["./layers/BaseDynamicLayerView3D"],a,c)})},"base-elevation":c,"base-tile":k,"bing-maps":k,"building-scene":function(){return new Promise(function(a,c){n(["./layers/BuildingSceneLayerView3D"],a,c)})},csv:e,elevation:c,
feature:e,geojson:e,graphics:function(){return new Promise(function(a,c){n(["./layers/GraphicsLayerView3D"],a,c)})},group:function(){return new Promise(function(a,c){n(["../layers/GroupLayerView"],a,c)})},imagery:function(){return new Promise(function(a,c){n(["./layers/ImageryLayerView3D"],a,c)})},"integrated-mesh":function(){return new Promise(function(a,c){n(["./layers/IntegratedMeshLayerView3D"],a,c)})},"map-image":function(){return new Promise(function(a,c){n(["./layers/MapImageLayerView3D"],
a,c)})},"ogc-feature":e,"open-street-map":k,"point-cloud":function(){return new Promise(function(a,c){n(["./layers/PointCloudLayerView3D"],a,c)})},scene:function(a){return null==a.profile||"mesh-pyramids"===a.profile?new Promise(function(a,b){n(["./layers/SceneLayerView3D"],a,b)}):new Promise(function(a,b){n(["./layers/SceneLayerGraphicsView3D"],a,b)})},stream:function(){return new Promise(function(a,c){n(["./layers/StreamLayerView3D"],a,c)})},tile:k,"imagery-tile":function(){return new Promise(function(a,
c){n(["./layers/ImageryTileLayerView3D"],a,c)})},"vector-tile":function(){return new Promise(function(a,c){n(["./layers/VectorTileLayerView3D"],a,c)})},wcs:function(){return new Promise(function(a,c){n(["./layers/ImageryTileLayerView3D"],a,c)})},"web-tile":k,wms:function(){return new Promise(function(a,c){n(["./layers/WMSLayerView3D"],a,c)})},wmts:function(){return new Promise(function(a,c){n(["./layers/WMTSLayerView3D"],a,c)})},"geo-rss":null,kml:null,"map-notes":null,route:null,unknown:null,unsupported:null};
a.layerView3DImporter={hasLayerViewModule:function(a){return l.isSome(h[a.type])},importLayerView:function(a){var c=h[a.type];if(!l.isSome(c))throw a=a.declaredClass?a.declaredClass.slice(a.declaredClass.lastIndexOf(".")+1):"Unknown",c=a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new d(c+":view-not-supported",a+" is not supported in 3D");return c(a)}}})},"esri/views/3d/constraints/Constraints":function(){define("require exports tslib ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),
function(n,a,d,l,k,e,c,h,m){Object.defineProperty(a,"__esModule",{value:!0});a.Constraints=void 0;n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.tilt=new m.default;b.altitude=new e.default;b.clipDistance=new c.default;b.collision=new h.default;return b}d.__extends(b,a);d.__decorate([k.property({type:m.default})],b.prototype,"tilt",void 0);d.__decorate([k.property({type:e.default})],b.prototype,"altitude",void 0);d.__decorate([k.property({type:c.default})],b.prototype,"clipDistance",
void 0);d.__decorate([k.property({type:h.default})],b.prototype,"collision",void 0);return b=d.__decorate([k.subclass("esri.views.3d.constraints.Constraints")],b)}(l);a.Constraints=n;a.default=n})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports tslib ../../../core/Accessor ../../../core/deprecate ../../../core/Logger ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});
a.AltitudeConstraint=void 0;n=function(a){function f(){var b=null!==a&&a.apply(this,arguments)||this;b.min=h.AltitudeDefault.min;b.max=h.AltitudeDefault.max;return b}d.__extends(f,a);Object.defineProperty(f.prototype,"mode",{get:function(){k.deprecated(e.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"});return"manual"},set:function(a){k.deprecated(e.getLogger(this.declaredClass),
"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"})},enumerable:!1,configurable:!0});d.__decorate([c.property({type:Number})],f.prototype,"min",void 0);d.__decorate([c.property({type:Number})],f.prototype,"max",void 0);return f=d.__decorate([c.subclass("esri.views.3d.constraints.AltitudeConstraint")],f)}(l);a.AltitudeConstraint=n;a.default=n})},"esri/views/3d/state/Constraints":function(){define("require exports tslib ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/mathUtils ../../../core/accessorSupport/decorators ../../../geometry/support/geodesicConstants ../support/mathUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.TiltDefault=a.AltitudeDefault=a.Constraints=void 0;var b=k.getLogger("esri.views.3d.state.Constraints");n=function(m){function k(a){a=m.call(this,a)||this;a.collision=new p;a.distance=Infinity;a.minimumPoiDistance=4;return a}d.__extends(k,m);Object.defineProperty(k.prototype,"altitude",{get:function(){return 2===this.mode?null:this._get("altitude")||null},set:function(a){2===this.mode?b.warn("Altitude constraint is ignored in local scenes"):
this._set("altitude",a)},enumerable:!1,configurable:!0});k.prototype.clampAltitude=function(a){return this.altitude?e.clamp(a,this.altitude.min,this.altitude.max):a};k.prototype.clampTilt=function(a,b){if(!this.tilt)return b;a=this.tilt(a);return e.clamp(b,a.min,a.max)};k.prototype.clampDistance=function(a){return Math.min(a,this.distance)};k.prototype.createDefaultTilt=function(){return 2===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};k.prototype.createConstantMaxTilt=
function(b){return function(c,d){void 0===d&&(d=g);d.min=a.TiltDefault.min;d.max=b;return d}};k.prototype.createDefaultTiltLocal=function(){var b=this.collision.enabled?f.makePiecewiseLinearFunction([[4E3,a.TiltDefault.max],[1E4,c.deg2rad(88)],[6E6,c.deg2rad(88)]]):function(){return a.TiltDefault.max};return function(c,d){void 0===d&&(d=g);d.min=a.TiltDefault.min;d.max=b(c);return d}};k.prototype.createDefaultTiltGlobal=function(){var b=this.collision.enabled?f.makePiecewiseLinearFunction([[4E3,a.TiltDefault.max],
[5E4,c.deg2rad(88)],[6E6,c.deg2rad(88)],[2E7,a.TiltDefault.min]]):f.makePiecewiseLinearFunction([[3E5,a.TiltDefault.max],[3E6,c.deg2rad(88)],[6E6,c.deg2rad(88)],[2E7,a.TiltDefault.min]]);return function(c,d){void 0===d&&(d=g);d.min=a.TiltDefault.min;d.max=b(c);return d}};d.__decorate([h.property()],k.prototype,"altitude",null);d.__decorate([h.property({readOnly:!0})],k.prototype,"collision",void 0);d.__decorate([h.property()],k.prototype,"distance",void 0);d.__decorate([h.property({readOnly:!0})],
k.prototype,"minimumPoiDistance",void 0);d.__decorate([h.property()],k.prototype,"tilt",void 0);d.__decorate([h.property({constructOnly:!0})],k.prototype,"mode",void 0);return k=d.__decorate([h.subclass("esri.views.3d.state.Constraints")],k)}(l);a.Constraints=n;a.AltitudeDefault={min:-2E5,max:4*m.earthRadius};a.TiltDefault={min:c.deg2rad(.5),max:c.deg2rad(179.5)};var g={min:0,max:0},p=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.enabled=!0;b.elevationMargin=5;return b}
d.__extends(b,a);d.__decorate([h.property({type:Boolean})],b.prototype,"enabled",void 0);d.__decorate([h.property({type:Number})],b.prototype,"elevationMargin",void 0);return b=d.__decorate([h.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],b)}(l);a.default=n})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define(["require","exports","tslib","../../../core/Accessor","../../../core/accessorSupport/decorators"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",
{value:!0});a.ClipDistanceConstraint=void 0;n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.mode="auto";return c}d.__extends(c,a);Object.defineProperty(c.prototype,"near",{get:function(){return this._get("near")},set:function(a){this._set("near",a);a>=this._get("far")&&(this.far=a+1E-9);this.mode="manual"},enumerable:!1,configurable:!0});c.prototype.castNear=function(a){return Math.max(1E-8,a)};Object.defineProperty(c.prototype,"far",{get:function(){return this._get("far")},
set:function(a){this._set("far",a);a<=this._get("near")&&(this.near=a-1E-9);this.mode="manual"},enumerable:!1,configurable:!0});c.prototype.castFar=function(a){return Math.max(1E-8,a)};c.prototype.autoUpdate=function(a,c){"auto"===this.mode&&(this._get("near")!==a&&this._set("near",a),this._get("far")!==c&&this._set("far",c))};d.__decorate([k.property({type:Number,value:1E-8})],c.prototype,"near",null);d.__decorate([k.cast("near")],c.prototype,"castNear",null);d.__decorate([k.property({type:Number,
value:1E-8})],c.prototype,"far",null);d.__decorate([k.cast("far")],c.prototype,"castFar",null);d.__decorate([k.property({type:["auto","manual"]})],c.prototype,"mode",void 0);return c=d.__decorate([k.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],c)}(l);a.ClipDistanceConstraint=n;a.default=n})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports tslib ../../../core/Accessor ../../../core/deprecate ../../../core/Logger ../../../core/accessorSupport/decorators".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.CollisionConstraint=void 0;n=function(a){function m(){return null!==a&&a.apply(this,arguments)||this}d.__extends(m,a);Object.defineProperty(m.prototype,"enabled",{set:function(a){k.deprecated(e.getLogger(this.declaredClass),"SceneView.constraint.collision.enabled",{replacement:"Map.ground.navigationConstraint",version:"4.8"});this._set("enabled",a)},enumerable:!1,configurable:!0});d.__decorate([c.property({value:!0})],m.prototype,
"enabled",null);return m=d.__decorate([c.subclass("esri.views.3d.constraints.CollisionConstraint")],m)}(l);a.CollisionConstraint=n;a.default=n})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports tslib ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.TiltConstraint=void 0;var h=k.rad2deg(c.TiltDefault.min),m=k.rad2deg(c.TiltDefault.max);
n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.mode="auto";return b}d.__extends(b,a);Object.defineProperty(b.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!1,configurable:!0});b.prototype.castMax=function(a){return k.clamp(a,h,m)};b.prototype.autoUpdate=function(a){"auto"===this.mode&&this._get("max")!==a&&this._set("max",a)};d.__decorate([e.property({type:["auto","manual"]})],b.prototype,"mode",
void 0);d.__decorate([e.property({type:Number,value:m})],b.prototype,"max",null);d.__decorate([e.cast("max")],b.prototype,"castMax",null);return b=d.__decorate([e.subclass("esri.views.3d.constraints.TiltConstraint")],b)}(l);a.TiltConstraint=n;a.default=n})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports tslib ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(n,a,d,l,k,e,c,h,m,f){return function(a){function b(b){b=a.call(this,b)||this;b.atmosphere=new c.default;return b}d.__extends(b,a);m=b;b.fromWebsceneEnvironment=function(a){a=a.cloneConstructProperties();return new m(d.__assign(d.__assign({},a),{lighting:h.SceneViewLighting.fromWebsceneLighting(a.lighting)}))};b.prototype.castLighting=function(a){return this.convertLighting(a)};b.prototype.updateLighting=function(a){this.lighting=this.convertLighting(a)};b.prototype.convertLighting=function(a){return a?
a instanceof h.SceneViewLighting?a:a instanceof f?this.lighting?this.lighting.cloneWithWebsceneLighting(a):h.SceneViewLighting.fromWebsceneLighting(a):e.ensureType(h.SceneViewLighting,a):new h.SceneViewLighting};b.prototype.clone=function(){return new m({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:l.clone(this.background)})};b.prototype.cloneWithWebsceneEnvironment=function(a){return new m(d.__assign(d.__assign({atmosphere:this.atmosphere.clone(),
atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:l.clone(this.background)},a.cloneConstructProperties()),{lighting:null!=this.lighting?this.lighting.cloneWithWebsceneLighting(a.lighting):h.SceneViewLighting.fromWebsceneLighting(a.lighting)}))};var m;d.__decorate([k.property({type:c.default,json:{read:!1}})],b.prototype,"atmosphere",void 0);d.__decorate([k.property()],b.prototype,"lighting",void 0);d.__decorate([k.cast("lighting")],b.prototype,"castLighting",null);
return b=m=d.__decorate([k.subclass("esri.views.3d.environment.SceneViewEnvironment")],b)}(m)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define(["require","exports","tslib","../../../core/Accessor","../../../core/accessorSupport/decorators"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.SceneViewAtmosphere=void 0;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);e=c;Object.defineProperty(c.prototype,"quality",{set:function(a){-1!==
["low","high"].indexOf(a)&&this._set("quality",a)},enumerable:!1,configurable:!0});c.prototype.clone=function(){return new e({quality:this.quality})};var e;d.__decorate([k.property({type:["low","high"],value:"low"})],c.prototype,"quality",null);return c=e=d.__decorate([k.subclass("esri.views.3d.environment.SceneViewAtmosphere")],c)}(l);a.SceneViewAtmosphere=n;a.default=n})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports tslib ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),
function(n,a,d,l,k,e){function c(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)}Object.defineProperty(a,"__esModule",{value:!0});a.calculateTimezoneOffset=a.SceneViewLighting=void 0;n=function(a){function e(b){b=a.call(this,b)||this;b.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};b.cameraTrackingEnabled=!0;b.ambientOcclusionEnabled=!1;b.waterReflectionEnabled=!1;var g=(new Date).getFullYear(),g=new Date("March 15, "+g+" 12:00:00 UTC");b._set("defaultDate",g);b._set("date",
g);return b}d.__extends(e,a);b=e;e.fromWebsceneLighting=function(a){return new b(d.__assign({},a.cloneConstructProperties()))};Object.defineProperty(e.prototype,"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var b=this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);b&&this._set("date",a)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"date",{set:function(a){null!=a&&(this.positionTimezoneInfo.autoUpdated=
!1,this._set("date",new Date(a.getTime())))},enumerable:!1,configurable:!0});e.prototype.autoUpdate=function(a,b){var g=c(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=b.hours;this.positionTimezoneInfo.minutes=b.minutes;this.positionTimezoneInfo.seconds=b.seconds;b=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=!0,b=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())));var d=c(this.positionTimezoneInfo);g!==d&&(h.target=this,h.timezoneOffset=d,this.emit("timezone-will-change",
h));if(null!=a)return b!==a.getTime()};e.prototype.clone=function(){var a=this._get("date")===this._get("defaultDate"),c=new b(d.__assign(d.__assign({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}));a&&c._set("date",c._get("defaultDate"));c.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;c.positionTimezoneInfo.hours=
this.positionTimezoneInfo.hours;c.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;c.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return c};e.prototype.cloneWithWebsceneLighting=function(a){var b=this.clone();null!=a.date&&(b.date=a.date);b.directShadowsEnabled=a.directShadowsEnabled;b.displayUTCOffset=a.displayUTCOffset;return b};var b;d.__decorate([k.property({type:Boolean})],e.prototype,"cameraTrackingEnabled",void 0);d.__decorate([k.property({type:Boolean})],e.prototype,
"ambientOcclusionEnabled",void 0);d.__decorate([k.property({type:Boolean})],e.prototype,"waterReflectionEnabled",void 0);d.__decorate([k.property({type:Date})],e.prototype,"defaultDate",null);d.__decorate([k.property({type:Date})],e.prototype,"date",null);return e=b=d.__decorate([k.subclass("esri.views.3d.environment.SceneViewLighting")],e)}(l.EventedMixin(e));a.SceneViewLighting=n;a.calculateTimezoneOffset=c;var h={target:null,timezoneOffset:0};a.default=n})},"esri/webscene/Lighting":function(){define(["require",
"exports","tslib","../core/JSONSupport","../core/accessorSupport/decorators"],function(n,a,d,l,k){return function(a){function c(c){c=a.call(this,c)||this;c.date=null;c.directShadowsEnabled=!1;c.displayUTCOffset=null;return c}d.__extends(c,a);e=c;c.prototype.readDate=function(a,c){return null!=c.datetime&&new Date(c.datetime)||null};c.prototype.writeDate=function(a,c,b){c[b]=a.getTime()};c.prototype.readDirectShadowsEnabled=function(a,c){return!!c.directShadows};c.prototype.writedirectShadowsEnabled=
function(a,c,b){a&&(c[b]=a)};c.prototype.writeDisplayUTCOffset=function(a,c){null!=a&&(c.displayUTCOffset=a)};c.prototype.clone=function(){return new e(this.cloneConstructProperties())};c.prototype.cloneConstructProperties=function(){var a={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(a.date=new Date(this.date.getTime()));return a};var e;d.__decorate([k.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],
c.prototype,"date",void 0);d.__decorate([k.reader("date",["datetime"])],c.prototype,"readDate",null);d.__decorate([k.writer("date")],c.prototype,"writeDate",null);d.__decorate([k.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],c.prototype,"directShadowsEnabled",void 0);d.__decorate([k.reader("directShadowsEnabled",["directShadows"])],c.prototype,"readDirectShadowsEnabled",null);d.__decorate([k.writer("directShadowsEnabled")],c.prototype,"writedirectShadowsEnabled",null);
d.__decorate([k.property({type:Number,json:{write:!0}})],c.prototype,"displayUTCOffset",void 0);d.__decorate([k.writer("displayUTCOffset")],c.prototype,"writeDisplayUTCOffset",null);return c=e=d.__decorate([k.subclass("esri.webscene.Lighting")],c)}(l.JSONSupport)})},"esri/webscene/Environment":function(){define("require exports tslib ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),function(n,a,d,l,k,e,c,h){var m=function(a,b,g){return{enabled:!g||
!g.isPresentation}};return function(a){function b(b){b=a.call(this,b)||this;b.lighting=new c;b.background=null;b.atmosphereEnabled=!0;b.starsEnabled=!0;return b}d.__extends(b,a);g=b;b.prototype.clone=function(){return new g(this.cloneConstructProperties())};b.prototype.cloneConstructProperties=function(){return{lighting:c.prototype.clone.call(this.lighting),background:k.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};var g;d.__decorate([e.property({type:c,
json:{write:!0}})],b.prototype,"lighting",void 0);d.__decorate([e.property(h.backgroundProperty)],b.prototype,"background",void 0);d.__decorate([e.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:m}}})],b.prototype,"atmosphereEnabled",void 0);d.__decorate([e.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:m}}})],b.prototype,"starsEnabled",void 0);return b=g=d.__decorate([e.subclass("esri.webscene.Environment")],b)}(l.JSONSupport)})},"esri/webscene/background/utils":function(){define(["require",
"exports","./Background","./ColorBackground"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.backgroundProperty=void 0;n={base:d,key:"type",typeMap:{color:l}};a.backgroundProperty={types:n,json:{read:function(a){return function(d,c,h){if(!d)return d;for(var e in a.typeMap)if(d.type===e)return c=new a.typeMap[e],c.read(d,h),c}}(n),write:{overridePolicy:function(a,d,c){return{enabled:!c||!c.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define(["require",
"exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],function(n,a,d,l,k){return function(a){function c(c){return a.call(this,c)||this}d.__extends(c,a);c.prototype.clone=function(){};d.__decorate([k.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0);return c=d.__decorate([k.subclass("esri.webscene.background.Background")],c)}(l.JSONSupport)})},"esri/webscene/background/ColorBackground":function(){define("require exports tslib ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(n,a,d,l,k,e,c){var h=d.__assign(d.__assign({},e.colorAndTransparencyProperty),{nonNullable:!0});return function(a){function c(b){b=a.call(this,b)||this;b.type="color";b.color=new l([0,0,0,1]);return b}d.__extends(c,a);b=c;c.prototype.clone=function(){return new b(this.cloneProperties())};c.prototype.cloneProperties=function(){return{color:this.color.clone()}};var b;d.__decorate([k.enumeration({color:"color"},{readOnly:!0})],c.prototype,"type",void 0);d.__decorate([k.property(h)],c.prototype,
"color",void 0);return c=b=d.__decorate([k.subclass("esri.webscene.background.ColorBackground")],c)}(c)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports tslib ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ./EnvironmentRenderer ../support/earthUtils ../support/pointUtils ../support/projectionUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z){Object.defineProperty(a,"__esModule",{value:!0});a.SceneViewEnvironmentManager=void 0;var x=g.vec3f64.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);n=function(a){function k(){for(var b=[],g=0;g<arguments.length;g++)b[g]=arguments[g];b=a.apply(this,b)||this;b._referencePointUpdateDelay=200;b._referencePointUpdateInterval=3E3;b._referencePointUpdateDistThreshold=1E6;b._referencePosUpdateQuery=null;b._referencePosMapCoordsRequested=
null;b._viewHandles=new e;b._preserveAbsoluteDateTime=!1;b._trackingEnabled=!1;b._referencePosResetPreserveAbsoluteTime=!1;b.referencePosUpdateTimer=null;b._referencePosWGS84Comparable=null;b._referencePosMapCoords=null;b._mainLight=new w.MainLight;b._ambientLight=new w.AmbientLight;b._moonLight=new w.FillLight;b._renderer=null;b._resetReferencePosition();return b}d.__extends(k,a);k.prototype.destroy=function(){this.disconnectView();this._viewHandles.destroy()};Object.defineProperty(k.prototype,"updating",
{get:function(){return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||this._renderer&&this._renderer.updating)},enumerable:!1,configurable:!0});k.prototype.connectView=function(a){var b=this;this._renderer||(this._view=a,this._renderer=new t({view:a}),this._viewHandles.add([a.watch("environment.lighting.date",function(a){return b._lightingDateHandler(a)},!0),a.watch("stationary",function(){return b._interactingStationaryHandler()}),a.watch(["environment.lighting.directShadowsEnabled",
"environment.lighting.ambientOcclusionEnabled","environment.lighting.waterReflectionEnabled","environment.background.color"],function(){return b._updateRenderParamsHandler()},!0),a.watch("spatialReference",function(){return b._resetReferencePosition(!0)},!0),m.init(a,"viewingMode",function(){return b._resetReferencePosition(!0)},!0),m.init(a,"environment.lighting.cameraTrackingEnabled",function(a){return b._updateCameraTracking(a)},!0),m.init(a,"state.camera",function(){return b._cameraHandler(null)},
!0),this.watch("disableQueries",function(){return b._cameraHandler(null)})]),this._updateRenderParamsHandler(),this._updateLightParams(),this._cameraHandler(),this.notifyChange("updating"))};k.prototype.disconnectView=function(){this._renderer&&(this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer.destroy(),this._view=this._renderer=null)};k.prototype._updateCameraTracking=function(a){if(this._trackingEnabled=a)this._cameraHandler();else if(a=this._view.environment.lighting)a.positionTimezoneInfo.autoUpdated=
!1};k.prototype._lightingDateHandler=function(a){if(a){var b=this._view.environment.lighting;if(!b.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!q.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var g=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(g)){this._requestReferencePositionUpdate(g);return}}this._preupdateTracking(a);this._referencePosWGS84Comparable&&(g=u.positionToTimezone(this._referencePosWGS84Comparable,
A),c.isSome(g)&&(b.autoUpdate(null,g),this._trackingEnabled&&(b.positionTimezoneInfo.autoUpdated=!0)))}this._updateLightParams(a)}};k.prototype._preupdateTracking=function(a){!this._trackingEnabled&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(a)};k.prototype._cameraHandler=function(a){void 0===a&&(a=null);if(this._view.ready){var b=this._view.camera;b&&(this._cameraHandlerClientSide(b,a)||this._cameraHandlerServerSide(b))}};k.prototype._cameraHandlerClientSide=function(a,
b){if(!q.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;a=a.position;this._referencePosWGS84Comparable||(this._referencePosWGS84Comparable=g.vec3f64.create());r.pointToWGS84ComparableLonLat(a,this._referencePosWGS84Comparable);this._autoUpdateTimezone(this._referencePosWGS84Comparable,b)||this._updateLightParams(b);return!0};k.prototype._cameraHandlerServerSide=function(a){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(a))&&
this._requestReferencePositionUpdate(a,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=a.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};k.prototype._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};k.prototype._updateLightParams=function(a){var g=this._view.environment.lighting;a=a||g.date;var g=this._view._stage,c;this._referencePosWGS84Comparable?(c=v.computeColorAndIntensity(a,
this._referencePosWGS84Comparable),v.computeDirection(a,this._referencePosWGS84Comparable,this._view.viewingMode,c.diffuse.direction)):c={diffuse:{color:[1,1,1],intensity:.55,direction:x},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};b.vec3.scale(this._mainLight.intensity,c.diffuse.color,c.diffuse.intensity*Math.PI);b.vec3.negate(this._mainLight.direction,c.diffuse.direction);b.vec3.scale(this._ambientLight.intensity,c.ambient.color,c.ambient.intensity);b.vec3.lerp(this._moonLight.intensity,
C,E,c.globalFactor);b.vec3.scale(this._moonLight.intensity,this._moonLight.intensity,(1-.5*c.globalFactor)*(1-.4*c.noonFactor*(1-c.globalFactor)));b.vec3.copy(this._moonLight.direction,c.diffuse.direction);g.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:c.globalFactor,groundLightingFactor:1-c.noonFactor});this._updateRenderParamsHandler()};k.prototype._autoUpdateTimezone=function(a,b){void 0===b&&(b=null);if(!this._view.environment.lighting.cameraTrackingEnabled)return!1;
var g=B;g.setTime((b||this._view.environment.lighting.date).getTime());a=u.positionToTimezone(a,A);if(c.isNone(a))return!1;var d=this._view.environment.lighting.positionTimezoneInfo;if(!d.autoUpdated)d=a;else if(d.hours===a.hours&&d.minutes===a.minutes&&d.seconds===a.seconds)return!1;var e=g.getUTCHours()-(a.hours-d.hours),f=g.getUTCMinutes()-(a.minutes-d.minutes),d=g.getUTCSeconds()-(a.seconds-d.seconds);g.setUTCHours(e);g.setUTCMinutes(f);g.setUTCSeconds(d);return b?!1:this._view.environment.lighting.autoUpdate(g,
a)};k.prototype._updateRenderParamsHandler=function(){var a=this._view._stage;if(a){var b=this._referencePosWGS84Comparable?v.computeShadowsEnabled(this._referencePosWGS84Comparable,this._view.viewingMode):!0,g=this._view.environment.background,g=g instanceof z?{type:"color",color:p.vec4f64.fromArray(l.toUnitRGBA(g.color))}:{type:"color",color:p.vec4f64.fromValues(0,0,0,1)};a.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&b,ssao:this._view.environment.lighting.ambientOcclusionEnabled,
waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,background:g})}};k.prototype._resetReferencePosition=function(a){void 0===a&&(a=!1);var b=this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");b&&a&&this._cameraHandler(null)};k.prototype._requestReferencePositionUpdate=function(a,b){var g=this;void 0===b&&(b=!1);
if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(a):this._referencePosMapCoordsRequested=a.clone(),this._referencePosResetPreserveAbsoluteTime=!!b,!this._referencePosUpdateQuery&&!this.referencePosUpdateTimer&&this._view.stationary)){var c=this._referencePosUpdateQuery=h.after(this._referencePointUpdateDelay).then(function(){if(g._referencePosUpdateQuery===c)return g._doReferencePositionUpdateQuery(function(){return g._referencePosUpdateQuery!==
c})}).catch(function(a){"mapcoordshelper:missing-geometry-service"===a.name&&(g.disableQueries=!0)}).then(function(){g._referencePosUpdateQuery===c&&(g._referencePosUpdateQuery=null,g.referencePosUpdateTimer||g._executePendingReferencePositionUpdate(),g.notifyChange("updating"))}),d=this.referencePosUpdateTimer=h.after(this._referencePointUpdateInterval).then(function(){g.referencePosUpdateTimer===d&&(g.referencePosUpdateTimer=null,g._referencePosUpdateQuery||g._executePendingReferencePositionUpdate())});
this.notifyChange("updating")}};k.prototype._doReferencePositionUpdateQuery=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,g;return d.__generator(this,function(c){switch(c.label){case 0:return this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosMapCoordsRequested=
this._referencePosResetPreserveAbsoluteTime=null,[4,this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords)];case 1:return b=c.sent(),a()||isNaN(b[0])||isNaN(b[1])||(g=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=b[0],this._referencePosWGS84Comparable[1]=b[1],this._referencePosWGS84Comparable[2]=g):this._referencePosWGS84Comparable=[b[0],b[1],g],this._referencePosChanged()),[2]}})})};k.prototype._executePendingReferencePositionUpdate=
function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)};k.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLightParams()};k.prototype._exceedsReferencePosDistThreshold=function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this._view.mapCoordsHelper&&(a*=this._view.mapCoordsHelper.unitInMeters),
a>this._referencePointUpdateDistThreshold):!0};k.prototype._cancelReferencePosUpdates=function(){var a=!!this._referencePosUpdateQuery;this.referencePosUpdateTimer=this._referencePosUpdateQuery=null;return a};Object.defineProperty(k.prototype,"test",{get:function(){var a=this;return{renderer:this._renderer,set referencePointUpdateInterval(b){a._referencePointUpdateInterval=b},set referencePointUpdateDistThreshold(b){a._referencePointUpdateDistThreshold=b},set referencePosUpdateTimer(b){a.referencePosUpdateTimer=
b},set referencePointUpdateDelay(b){a._referencePointUpdateDelay=b}}},enumerable:!1,configurable:!0});k.FIXED_LIGHT_DIRECTION=x;d.__decorate([f.property({type:Boolean,dependsOn:["disableQueries","_renderer.updating"],readOnly:!0})],k.prototype,"updating",null);d.__decorate([f.property()],k.prototype,"disableQueries",void 0);d.__decorate([f.property()],k.prototype,"_renderer",void 0);return k=d.__decorate([f.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],k)}(k.EventedAccessor);
a.SceneViewEnvironmentManager=n;var B=new Date,A={hours:0,minutes:0,seconds:0},C=g.vec3f64.fromValues(.22,.22,.33),E=g.vec3f64.fromValues(.22,.22,.22);a.default=n})},"esri/core/libs/gl-matrix-2/vec4f64":function(){define(["require","exports","./factories/vec4f64"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.vec4f64=void 0;a.vec4f64=d})},"esri/core/libs/gl-matrix-2/factories/vec4f64":function(){define(["require","exports"],function(n,a){function d(){return[0,0,0,0]}function l(){return[1,
1,1,1]}function k(){return[1,0,0,0]}function e(){return[0,1,0,0]}function c(){return[0,0,1,0]}function h(){return[0,0,0,1]}Object.defineProperty(a,"__esModule",{value:!0});a.UNIT_W=a.UNIT_Z=a.UNIT_Y=a.UNIT_X=a.ONES=a.ZEROS=a.unitW=a.unitZ=a.unitY=a.unitX=a.ones=a.zeros=a.createView=a.fromArray=a.fromValues=a.clone=a.create=void 0;a.create=d;a.clone=function(a){return[a[0],a[1],a[2],a[3]]};a.fromValues=function(a,c,b,g){return[a,c,b,g]};a.fromArray=function(a){for(var c=d(),b=Math.min(4,a.length),
g=0;g<b;++g)c[g]=a[g];return c};a.createView=function(a,c){return new Float64Array(a,c,4)};a.zeros=function(){return d()};a.ones=l;a.unitX=k;a.unitY=e;a.unitZ=c;a.unitW=h;a.ZEROS=d();a.ONES=l();a.UNIT_X=k();a.UNIT_Y=e();a.UNIT_Z=c();a.UNIT_W=h()})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("require exports tslib ../../../core/Accessor ../../../core/compilerUtils ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){var p=[14,15];return function(a){function t(){var b=null!==a&&a.apply(this,arguments)||this;b._handles=new e;b._initContext=null;b._pendingAtmosphere=null;b._atmosphere=null;b._stars=null;return b}d.__extends(t,a);Object.defineProperty(t.prototype,"canRender",{get:function(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||"global"!==this.view.viewingMode},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"updating",
{get:function(){return null!=this._pendingAtmosphere},enumerable:!1,configurable:!0});t.prototype.initialize=function(){this.view._stage.addRenderPlugin(p,this)};t.prototype.destroy=function(){this._pendingAtmosphere&&(this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._handles&&this._handles.removeAll();this.view&&(this.view._stage.removeRenderPlugin(this),
this._set("view",null))};t.prototype.initializeRenderContext=function(a){this._initContext=a;this._techniqueRepository=this._initContext.shaderTechniqueRep;this.setup()};t.prototype.setup=function(){var a=this;this._handles.add(c.when(this.view,"basemapTerrain",function(){return a._updateBasemapTerrain()},!0));this._handles.add([c.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],function(){return a._updateAtmosphere()},!0),c.init(this.view,"environment.starsEnabled",
function(){return a._updateStars()},!0)])};t.prototype.uninitializeRenderContext=function(){this._stars&&(this._stars.uninitializeRenderContext(),this._stars.destroy(),this._stars=null);this._atmosphere&&(this._atmosphere.uninitializeRenderContext(),this._atmosphere.destroy(),this._atmosphere=null)};t.prototype.render=function(a){var b=!0;this._stars&&this._stars.canRender&&(b=this._stars.render(a)&&b);this._atmosphere&&this._atmosphere.canRender&&(b=this._atmosphere.render(a)&&b);return b};t.prototype._setNeedsRender=
function(){this._initContext&&this._initContext.requestRender()};t.prototype._updateStars=function(){var a=this.view.get("environment.starsEnabled")||!1;a&&!this._stars?(this._stars=new g(this.view),this._stars.initializeRenderContext(this._initContext),this._setNeedsRender()):!a&&this._stars&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())};t.prototype._updateAtmosphere=function(){var a=this,b=this._getAtmosphereType();if(this.atmosphereType!==b)if(this.atmosphereType=b,this._pendingAtmosphere&&
(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),b=this._getAtmosphereClass()){var g=new b(this.view,this._techniqueRepository);g.initializeRenderContext(this._initContext);null==this._atmosphere&&(this._atmosphere=g,this._setNeedsRender());this._pendingAtmosphere=g;g.when().then(function(){a._pendingAtmosphere!==a._atmosphere&&(a._atmosphere.destroy(),a._atmosphere=a._pendingAtmosphere);a._pendingAtmosphere=null;a._setNeedsRender();a._updateBasemapTerrain()}).catch(function(){a._pendingAtmosphere===
g&&(a._pendingAtmosphere=null)})}else this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),this._updateBasemapTerrain()};t.prototype._getAtmosphereClass=function(){var a=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(a);switch(a){case "none":return null;case "realistic":return f.RealisticAtmosphere;case "panoramic":return m;case "simple":return b;default:k.neverReached(a)}};t.prototype._getAtmosphereType=function(){var a=
this.view.get("environment.atmosphereEnabled"),b=this.view.get("environment.atmosphere.quality");return a&&null!=b?"local"===this.view.viewingMode?"panoramic":"high"===b&&f.RealisticAtmosphere.isSupported(this._initContext)?"realistic":"simple":"none"};t.prototype._updateBasemapTerrain=function(){var a=this.view.basemapTerrain;a&&(a.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};Object.defineProperty(t.prototype,"test",{get:function(){return{atmosphere:this._atmosphere}},
enumerable:!1,configurable:!0});d.__decorate([h.property({constructOnly:!0})],t.prototype,"view",void 0);d.__decorate([h.property({constructOnly:!0})],t.prototype,"atmosphereClassFromType",void 0);d.__decorate([h.property({dependsOn:["_pendingAtmosphere"]})],t.prototype,"updating",null);d.__decorate([h.property()],t.prototype,"_pendingAtmosphere",void 0);return t=d.__decorate([h.subclass("esri.views.3d.environment.EnvironmentRenderer")],t)}(l)})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("require exports ../../../core/Logger ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w){var z=d.getLogger("esri.views.3d.environment.PanoramicAtmosphere");n=function(){function a(a,b){this.slot=14;this._readyResolver=l.createResolver();this._readyController=l.createAbortController();this.view=a;this._techniqueRepository=b;this._atmosphereTechniqueConfig=new c.SimpleAtmosphereTechniqueConfiguration}Object.defineProperty(a.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!1,configurable:!0});a.prototype.destroy=
function(){this._readyResolver.reject();this._texture&&(this._texture.dispose(),this._texture=null);this._readyController&&(this._readyController.abort(),this._readyController=null)};a.prototype.when=function(){return this._readyResolver.promise};a.prototype.initializeRenderContext=function(a){var b=this,g=a.rctx;this._atmosphereTechniqueConfig.geometry=1;this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(c.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique);
this._vao=this._createVertexArrayObject(g);this._vaoCount=v.vertexCount(this._vao,"geometry");m.requestImage(h,{signal:this._readyController.signal}).then(function(g){b._texture=new q(a.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},g);a.requestRender();b._readyController=null;b._readyResolver.resolve()}).catch(function(a){l.isAbortError(a)||z.error("Unable to initialize atmosphere: image request failed",a);b._readyResolver.reject()})};a.prototype.uninitializeRenderContext=
function(){this.destroy()};a.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass)return!1;var b=a.rctx,c=this._atmosphereTechnique.program;b.bindProgram(c);this._atmosphereTechnique.bindPipelineState(b);b.bindTexture(this._texture);c.setUniform1i("tex",0);g.View.bindProjectionMatrix(c,a.camera.projectionMatrix);var d=x;k.mat4.copy(d,a.camera.viewMatrix);d[12]=0;d[13]=0;d[14]=0;d[15]=1;c.setUniformMatrix4fv("view",x);c.setUniform4f("color",1,1,1,1);a.scenelightingData.setLightDirectionUniform(c);
b.bindVAO(this._vao);c.assertCompatibleVertexAttributeLocations(this._vao);b.drawArrays(4,0,this._vaoCount);return!0};a.prototype._createVertexArrayObject=function(a){for(var b=t.createPolySphereGeometry(1,2,!1),g=b.indices[u.VertexAttrConstants.POSITION],c=0;c<g.length;c+=3){var d=g[c];g[c]=g[c+2];g[c+2]=d}for(var b=b.vertexAttributes[u.VertexAttrConstants.POSITION].data,d=B.createBuffer(g.length),e=d.position,c=0;c<g.length;++c){var h=3*g[c];e.set(c,0,b[h]);e.set(c,1,b[h+1]);e.set(c,2,b[h+2])}return new w(a,
p.Default3D,{geometry:f.glLayout(B)},{geometry:r.createVertex(a,35044,d.buffer)})};return a}();var x=e.mat4f64.create(),B=b.newLayout().vec3f("position");return n})},"esri/core/libs/gl-matrix-2/mat4f64":function(){define(["require","exports","./factories/mat4f64"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.mat4f64=void 0;a.mat4f64=d})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["require","exports"],function(n,a){function d(){return[1,0,0,0,0,1,0,0,0,
0,1,0,0,0,0,1]}Object.defineProperty(a,"__esModule",{value:!0});a.IDENTITY=a.createView=a.fromValues=a.clone=a.create=void 0;a.create=d;a.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]};a.fromValues=function(a,d,e,c,h,m,f,b,g,p,t,u,r,q,v,w){return[a,d,e,c,h,m,f,b,g,p,t,u,r,q,v,w]};a.createView=function(a,d){return new Float64Array(a,d,16)};a.IDENTITY=d()})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports tslib ../environment/SimpleAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.SimpleAtmosphereTechniqueConfiguration=a.SimpleAtmosphereTechnique=void 0;e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype.initializeProgram=function(a){var g=b.shader.get().build({geometry:this.configuration.geometry});return new m(a.rctx,g.generateSource("vertex"),g.generateSource("fragment"),h.Default3D)};b.prototype.initializePipeline=function(){return 1===this.configuration.geometry?
f.makePipelineState({blending:f.separateBlendingParams(770,1,771,771),culling:f.backFaceCullingParams,depthTest:{func:515},colorWrite:f.defaultColorWriteParams}):f.makePipelineState({blending:f.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:f.defaultColorWriteParams})};b.shader=new k.ReloadableShaderModule(l,function(){return new Promise(function(a,b){n(["../environment/SimpleAtmosphere.glsl"],a,b)})});return b}(e.ShaderTechnique);a.SimpleAtmosphereTechnique=e;e=function(a){function b(){var b=
null!==a&&a.apply(this,arguments)||this;b.geometry=0;return b}d.__extends(b,a);d.__decorate([c.parameter({count:3})],b.prototype,"geometry",void 0);return b}(c.ShaderTechniqueConfiguration);a.SimpleAtmosphereTechniqueConfiguration=e})},"esri/views/3d/environment/SimpleAtmosphere.glsl":function(){define("require exports tslib ../webgl-engine/core/shaderLibrary/Transform.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderModules/ShaderBuilder".split(" "),function(n,a,d,l,
k,e){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var q=new e.ShaderBuilder;2===a.geometry?(q.attributes.add("position","vec2"),q.varyings.add("color","vec4"),q.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha","float"),q.vertex.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n      void main(void) {\n          float ndotl \x3d dot(normalize(cameraPosition), -lightingMainDirection);\n          float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n          color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\n\n          gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\n      }\n  "],
["\n      void main(void) {\n          float ndotl \x3d dot(normalize(cameraPosition), -lightingMainDirection);\n          float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n          color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\n\n          gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\n      }\n  "])))),q.fragment.code.add(k.glsl(h||(h=d.__makeTemplateObject(["\n      void main() {\n          gl_FragColor \x3d color;\n      }\n  "],["\n      void main() {\n          gl_FragColor \x3d color;\n      }\n  "]))))):
(q.include(l.Transform,{linearDepth:!1}),q.attributes.add("position","vec3"),q.varyings.add("vtc","vec2"),q.varyings.add("falloff","float"),1!==a.geometry&&q.varyings.add("innerFactor","float"),q.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),1!==a.geometry&&q.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float"),1!==a.geometry&&q.vertex.code.add(k.glsl(m||(m=d.__makeTemplateObject(["\n\t\t\tconst float TWICEPI \x3d 2.0*3.14159265;\n\t\t\tconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\n\t\t"],
["\n\t\t\tconst float TWICEPI \x3d 2.0*3.14159265;\n\t\t\tconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\n\t\t"])))),q.vertex.code.add(k.glsl(f||(f=d.__makeTemplateObject(["\n\t\tvoid main(void) {\n\t\t\tvec3 lightDirection \x3d -lightingMainDirection;\n\t"],["\n\t\tvoid main(void) {\n\t\t\tvec3 lightDirection \x3d -lightingMainDirection;\n\t"])))),1===a.geometry?q.vertex.code.add(k.glsl(b||(b=d.__makeTemplateObject(["\n\t\t\tvec3 pos \x3d position;\n\t\t\tfloat ndotl \x3d lightDirection.z;\n\t\t\tvtc \x3d vec2(0.0, position.z+0.05);\n\t\t\t"],
["\n\t\t\tvec3 pos \x3d position;\n\t\t\tfloat ndotl \x3d lightDirection.z;\n\t\t\tvtc \x3d vec2(0.0, position.z+0.05);\n\t\t\t"])))):q.vertex.code.add(k.glsl(g||(g=d.__makeTemplateObject(["\n\t\t\tinnerFactor \x3d clamp(-position.z, 0.0, 1.0);\n\t\t\tfloat scale \x3d position.y * (1.0 + innerFactor * innerScale);\n\t\t\tfloat phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n\t\t\tvec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n\t\t\tfloat ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\n\n\t\t\tvtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\n\t\t\tvtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\n\t\t"],
["\n\t\t\tinnerFactor \x3d clamp(-position.z, 0.0, 1.0);\n\t\t\tfloat scale \x3d position.y * (1.0 + innerFactor * innerScale);\n\t\t\tfloat phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n\t\t\tvec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n\t\t\tfloat ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\n\n\t\t\tvtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\n\t\t\tvtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\n\t\t"])))),
q.vertex.code.add(k.glsl(p||(p=d.__makeTemplateObject(["\n\t\tfalloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n\t\tgl_Position \x3d transformPosition(proj, view, pos);\n\t\tgl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n\t\t\t}\n\t"],["\n\t\tfalloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n\t\tgl_Position \x3d transformPosition(proj, view, pos);\n\t\tgl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n\t\t\t}\n\t"])))),
q.fragment.uniforms.add("tex","sampler2D"),1!==a.geometry&&q.fragment.uniforms.add("altitudeFade","float"),q.fragment.code.add(k.glsl(t||(t=d.__makeTemplateObject(["\n\t\tvoid main() {\n\t\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t"],["\n\t\tvoid main() {\n\t\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t"])))),1===a.geometry?q.fragment.code.add(k.glsl(u||(u=d.__makeTemplateObject(["\n\t\t\tgl_FragColor \x3d texColor * falloff;\n\t\t\t}\n\t\t"],["\n\t\t\tgl_FragColor \x3d texColor * falloff;\n\t\t\t}\n\t\t"])))):
q.fragment.code.add(k.glsl(r||(r=d.__makeTemplateObject(["\n\t\t\tvec4 atmosphereColor \x3d texColor * falloff;\n\t\t\tvec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n\t\t\tgl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n\t\t}\n\t\t"],["\n\t\t\tvec4 atmosphereColor \x3d texColor * falloff;\n\t\t\tvec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n\t\t\tgl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n\t\t}\n\t\t"])))));
return q};var c,h,m,f,b,g,p,t,u,r})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["require","exports","tslib","../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.Transform=void 0;a.Transform=function(a,h){h.linearDepth?a.vertex.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye \x3d view * vec4(pos, 1.0);\n      depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "],
["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye \x3d view * vec4(pos, 1.0);\n      depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "])))):a.vertex.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "],
["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "]))))};var k,e})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["require","exports"],function(n,a){function d(a){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];for(var e="",c=0;c<d.length;c++)e+=a[c]+d[c];return e+=a[a.length-1]}Object.defineProperty(a,
"__esModule",{value:!0});a.glsl=void 0;a.glsl=d;(function(a){a.int=function(a){return Math.round(a).toString()};a.float=function(a){return a.toPrecision(8)}})(d=a.glsl||(a.glsl={}))})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define("require exports tslib ../../../../../core/Logger ../../../../../core/MapUtils ../../../../../core/SetUtils".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.Stage=a.Code=a.ShaderBuilder=a.Includes=void 0;
var c=l.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");n=function(){function a(){this.includedModules=new Map}a.prototype.include=function(a,b){this.includedModules.has(a)?this.includedModules.get(a)!==b&&c.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(a,b),a(this.builder,b))};return a}();a.Includes=n;l=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.vertex=new f;c.fragment=new f;
c.attributes=new b;c.varyings=new g;c.extensions=new p;c.defines=new t;return c}d.__extends(c,a);Object.defineProperty(c.prototype,"builder",{get:function(){return this},enumerable:!1,configurable:!0});c.prototype.generateSource=function(a){var b=this.extensions.generateSource(a),g=this.attributes.generateSource(a),c=this.varyings.generateSource(),d="vertex"===a?this.vertex:this.fragment,e=d.uniforms.generateSource(),f=d.code.generateSource();a="vertex"===a?r:u;d=this.defines.generateSource().concat(d.defines.generateSource());
return"\n"+b.join("\n")+"\n\n"+d.join("\n")+"\n\n"+a+"\n\n"+e.join("\n")+"\n\n"+g.join("\n")+"\n\n"+c.join("\n")+"\n\n"+f.join("\n")};return c}(n);a.ShaderBuilder=l;var h=function(){function a(){this._entries=[];this._set=new Set}a.prototype.add=function(a,b,g){var c=a+"_"+b+"_"+g;this._set.has(c)||(this._entries.push([a,b,g]),this._set.add(c));return this};a.prototype.generateSource=function(){return this._entries.map(function(a){var b=a[2];return"uniform "+a[1]+" "+a[0]+(b?"["+b+"]":"")+";"})};
return a}(),m=function(){function a(){this._entries=[]}a.prototype.add=function(a){this._entries.push(a)};a.prototype.generateSource=function(){return this._entries};return a}();a.Code=m;var f=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.uniforms=new h;b.code=new m;b.defines=new t;return b}d.__extends(b,a);Object.defineProperty(b.prototype,"builder",{get:function(){return this},enumerable:!1,configurable:!0});return b}(n);a.Stage=f;var b=function(){function a(){this._entries=
[]}a.prototype.add=function(a,b){this._entries.push([a,b])};a.prototype.generateSource=function(a){return"fragment"===a?[]:this._entries.map(function(a){return"attribute "+a[1]+" "+a[0]+";"})};return a}(),g=function(){function a(){this._entries=[]}a.prototype.add=function(a,b){this._entries.push([a,b])};a.prototype.generateSource=function(){return this._entries.map(function(a){return"varying "+a[1]+" "+a[0]+";"})};return a}(),p=function(){function a(){this._entries=new Set}a.prototype.add=function(a){this._entries.add(a)};
a.prototype.generateSource=function(b){var g="vertex"===b?a.ALLOWLIST_VERTEX:a.ALLOWLIST_FRAGMENT;return e.valuesOfSet(this._entries).filter(function(a){return 0<=g.indexOf(a)}).map(function(a){return"#extension "+a+" : enable"})};a.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];a.ALLOWLIST_VERTEX=[];return a}(),t=function(){function a(){this._entries=new Map}a.prototype.addInt=function(a,b){b=0===b%1?b.toFixed(0):b.toString();this._entries.set(a,b)};a.prototype.addFloat=
function(a,b){b=0===b%1?b.toFixed(1):b.toString();this._entries.set(a,b)};a.prototype.generateSource=function(){return k.pairsOfMap(this._entries).map(function(a){return"#define "+a[0]+" "+a[1]})};return a}(),u="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",r="precision highp float;\nprecision highp sampler2D;"})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["require",
"exports","tslib"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.ReloadableShaderModule=void 0;n=function(){function a(a,d){this._module=a;this._loadModule=d}a.prototype.get=function(){return this._module};a.prototype.reload=function(){return d.__awaiter(this,void 0,void 0,function(){var a;return d.__generator(this,function(d){switch(d.label){case 0:return a=this,[4,this._loadModule()];case 1:return a._module=d.sent(),[2,this._module]}})})};return a}();a.ReloadableShaderModule=
n})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.ShaderTechnique=void 0;n=function(){function a(a,d){d&&(this._config=d.snapshot());this._program=this.initializeProgram(a);a.commonUniformStore&&(this._commonUniformStore=a.commonUniformStore,this._commonUniformStore.subscribeProgram(this._program));this._pipeline=this.initializePipeline(a)}a.prototype.dispose=function(){this._program&&
(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose(),this._program=null)};a.prototype.reload=function(a){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose());this._program=this.initializeProgram(a);this._commonUniformStore&&this._commonUniformStore.subscribeProgram(this._program)};Object.defineProperty(a.prototype,"program",{get:function(){return this._program},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"pipeline",{get:function(){return this._pipeline},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"key",{get:function(){return this._config.key},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"configuration",{get:function(){return this._config},enumerable:!1,configurable:!0});a.prototype.bindPass=function(a,d,e){};a.prototype.bindMaterial=function(a,d,e){};a.prototype.bindDraw=function(a,d,e){};a.prototype.bindPipelineState=
function(a){a.setPipelineState(this.pipeline)};a.prototype.ensureAttributeLocations=function(a){this.program.assertCompatibleVertexAttributeLocations(a)};Object.defineProperty(a.prototype,"primitiveType",{get:function(){return 4},enumerable:!1,configurable:!0});return a}();a.ShaderTechnique=n})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["require","exports","../../../../../core/mathUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",
{value:!0});a.parameter=a.ShaderTechniqueConfiguration=void 0;n=function(){function a(){this._key="";this._keyDirty=!1;this._parameterBits=this._parameterBits.map(function(){return 0})}Object.defineProperty(a.prototype,"key",{get:function(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key},enumerable:!1,configurable:!0});a.prototype.snapshot=function(){for(var a={key:this.key},d=0,c=this._parameterNames;d<c.length;d++){var h=c[d];
a[h]=this[h]}return a};return a}();a.ShaderTechniqueConfiguration=n;a.parameter=function(a){void 0===a&&(a={});return function(k,e){var c,h;k._parameterNames=null!==(c=k._parameterNames)&&void 0!==c?c:[];k._parameterNames.push(e);var m=k._parameterNames.length-1;c=Math.ceil(d.log2(a.count||2));for(var f=null!==(h=k._parameterBits)&&void 0!==h?h:[0],b=0;16<f[b]+c;)b++,b>=f.length&&f.push(0);k._parameterBits=f;var g=f[b],p=(1<<c)-1<<g;f[b]+=c;Object.defineProperty(k,e,{get:function(){return this[m]},
set:function(a){if(this[m]!==a&&(this[m]=a,this._keyDirty=!0,this._parameterBits[b]=this._parameterBits[b]&~p|+a<<g&p,"number"!==typeof a&&"boolean"!==typeof a))throw"Configuration values must be booleans or numbers!";}})}}})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.Default3D=void 0;a.Default3D={position:0,normal:1,uv0:2,color:3,size:4,tangent:4,uvMapSpace:4,auxpos1:5,
symbolColor:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,instanceColor:7,bound1:5,bound2:6,bound3:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}})},"esri/views/webgl/Program":function(){define(["require","exports","../../core/has","../../core/maybe","./ShaderTranspiler"],function(n,a,d,l,k){function e(a,d){if(l.isNone(a)||a.length!==d.length)return!0;for(var c=0;c<a.length;++c)if(a[c]!==d[c])return!0;return!1}return function(){function a(c,d,e,b,g){void 0===g&&(g={});this._glName=
this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};c||console.error("RenderingContext isn't initialized!");0===d.length&&console.error("Shaders source should not be empty!");this._context=
c;this._vertexShaderSource=d;this._fragmentShaderSource=e;if(Array.isArray(g))for(d=0;d<g.length;d++)this._defines[g[d]]="1";else this._defines=g;this._id=a._nextId++;this._locations=b;l.isSome(c.instanceCounter)&&c.instanceCounter.increment(3,this)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"locations",
{get:function(){return this._locations},enumerable:!1,configurable:!0});a.prototype.getDefine=function(a){return this._defines[a]};a.prototype.dispose=function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);l.isSome(this._context.instanceCounter)&&this._context.instanceCounter.decrement(3,this);this._context=
null}};a.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,c=a.createProgram();a.attachShader(c,this._vShader);a.attachShader(c,this._fShader);for(var d in this._locations)a.bindAttribLocation(c,this._locations[d],d);a.linkProgram(c);this._glName=c;this._initialized=!0}};a.prototype.getUniformLocation=function(a){this.initialize();
void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};a.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};a.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};a.prototype.setUniform1i=function(a,c){var d=
this._nameToUniform1[a];if(void 0===d||c!==d)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),c),this._nameToUniform1[a]=c};a.prototype.setUniform1iv=function(c,d){var f=this._nameToUniform1v[c];e(f,d)&&(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(c),d),void 0===f?this._nameToUniform1v[c]=a._arrayCopy(d):a._arrayAssign(d,f))};a.prototype.setUniform2iv=function(c,d){var f=this._nameToUniform2[c];e(f,d)&&(this._context.bindProgram(this),
this._context.gl.uniform2iv(this.getUniformLocation(c),d),void 0===f?this._nameToUniform2[c]=a._arrayCopy(d):a._arrayAssign(d,f))};a.prototype.setUniform3iv=function(c,d){var f=this._nameToUniform3[c];e(f,d)&&(this._context.bindProgram(this),this._context.gl.uniform3iv(this.getUniformLocation(c),d),void 0===f?this._nameToUniform3[c]=a._arrayCopy(d):a._arrayAssign(d,f))};a.prototype.setUniform4iv=function(c,d){var f=this._nameToUniform4[c];e(f,d)&&(this._context.bindProgram(this),this._context.gl.uniform4iv(this.getUniformLocation(c),
d),void 0===f?this._nameToUniform4[c]=a._arrayCopy(d):a._arrayAssign(d,f))};a.prototype.setUniform1f=function(a,c){var d=this._nameToUniform1[a];if(void 0===d||c!==d)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),c),this._nameToUniform1[a]=c};a.prototype.setUniform1fv=function(c,d){var f=this._nameToUniform1v[c];e(f,d)&&(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(c),d),void 0===f?this._nameToUniform1v[c]=a._arrayCopy(d):
a._arrayAssign(d,f))};a.prototype.setUniform2f=function(a,c,d){var b=this._nameToUniform2[a];if(void 0===b||c!==b[0]||d!==b[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),c,d),void 0===b?this._nameToUniform2[a]=[c,d]:(b[0]=c,b[1]=d)};a.prototype.setUniform2fv=function(c,d){var f=this._nameToUniform2[c];e(f,d)&&(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(c),d),void 0===f?this._nameToUniform2[c]=a._arrayCopy(d):a._arrayAssign(d,
f))};a.prototype.setUniform3f=function(a,c,d,b){var g=this._nameToUniform3[a];if(void 0===g||c!==g[0]||d!==g[1]||b!==g[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),c,d,b),void 0===g?this._nameToUniform3[a]=[c,d,b]:(g[0]=c,g[1]=d,g[2]=b)};a.prototype.setUniform3fv=function(c,d){var f=this._nameToUniform3[c];e(f,d)&&(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(c),d),void 0===f?this._nameToUniform3[c]=a._arrayCopy(d):
a._arrayAssign(d,f))};a.prototype.setUniform4f=function(a,c,d,b,g){var e=this._nameToUniform4[a];if(void 0===e||c!==e[0]||d!==e[1]||b!==e[2]||g!==e[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(a),c,d,b,g),void 0===e?this._nameToUniform4[a]=[c,d,b,g]:(e[0]=c,e[1]=d,e[2]=b,e[3]=g)};a.prototype.setUniform4fv=function(c,d){var f=this._nameToUniform4[c];e(f,d)&&(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(c),d),void 0===f?
this._nameToUniform4[c]=a._arrayCopy(d):a._arrayAssign(d,f))};a.prototype.setUniformMatrix3fv=function(c,d,f){void 0===f&&(f=!1);var b=this._nameToUniformMatrix3[c],g;g=l.isNone(b)?!0:9!==b.length?e(b,d):9!==b.length||b[0]!==d[0]||b[1]!==d[1]||b[2]!==d[2]||b[3]!==d[3]||b[4]!==d[4]||b[5]!==d[5]||b[6]!==d[6]||b[7]!==d[7]||b[8]!==d[8];g&&(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(c),f,d),void 0===b?this._nameToUniformMatrix3[c]=a._arrayCopy(d):a._arrayAssign(d,
b))};a.prototype.setUniformMatrix4fv=function(c,d,f){void 0===f&&(f=!1);var b=this._nameToUniformMatrix4[c],g;g=l.isNone(b)?!0:16!==b.length?e(b,d):16!==b.length||b[0]!==d[0]||b[1]!==d[1]||b[2]!==d[2]||b[3]!==d[3]||b[4]!==d[4]||b[5]!==d[5]||b[6]!==d[6]||b[7]!==d[7]||b[8]!==d[8]||b[9]!==d[9]||b[10]!==d[10]||b[11]!==d[11]||b[12]!==d[12]||b[13]!==d[13]||b[14]!==d[14]||b[15]!==d[15];g&&(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(c),f,d),void 0===b?this._nameToUniformMatrix4[c]=
a._arrayCopy(d):a._arrayAssign(d,b))};a.prototype.assertCompatibleVertexAttributeLocations=function(a){(a=a.locations===this.locations)||console.error("VertexAttributeLocations are incompatible");return a};a._padToThree=function(a){var c=a.toString();1E3>a&&(c=("  "+a).slice(-3));return c};a.prototype._addLineNumbers=function(c){var d=2;return c.replace(/\n/g,function(){return"\n"+a._padToThree(d++)+":"})};a.prototype._loadShader=function(a){var c=35633===a,d=c?this._vertexShaderSource:this._fragmentShaderSource,
b="",g;for(g in this._defines)b+="#define "+g+" "+this._defines[g]+"\n";d=b+d;"webgl2"===this._context.contextVersion&&(d=k.transpileShader(d,c?"vertex":"fragment"));c=this._context.gl;a=c.createShader(a);c.shaderSource(a,d);c.compileShader(a);return a};a._arrayCopy=function(a){for(var c=[],d=0;d<a.length;++d)c.push(a[d]);return c};a._arrayAssign=function(a,c){for(var d=0;d<a.length;++d)c[d]=a[d]};a._nextId=0;return a}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports",
"./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(n,a,d,l){function k(a){return a.map(function(a){return"eof"!==a.type?a.data:""}).join("")}function e(a,c,b,g){g=g||b;for(var d=0;d<a.length;d++){var f=a[d];if("ident"===f.type&&f.data===b)return g in c?c[g]++:c[g]=0,e(a,c,g+"_"+c[g],g)}return b}function c(a,c,b){void 0===b&&(b="afterVersion");var g={data:"\n",type:"whitespace"},d=function(b){return b<a.length?/[^\r\n]$/.test(a[b].data):!1},e=function(a){for(var g=-1,c=0,d=-1,e=0;e<a.length;e++){var f=
a[e];"preprocessor"===f.type&&(f.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++c:f.data.match(/\#endif\s*.*/)&&--c);("afterVersion"===b||"afterPrecision"===b)&&"preprocessor"===f.type&&/^#version/.test(f.data)&&(d=Math.max(d,e));if("afterPrecision"===b&&"keyword"===f.type&&"precision"===f.data){a:{for(f=e;f<a.length;f++){var h=a[f];if("operator"===h.type&&";"===h.data)break a}f=null}if(null===f)throw Error("precision statement not followed by any semicolons!");d=Math.max(d,f)}g<d&&0===c&&(g=e)}return g+
1}(a);d(e-1)&&a.splice(e++,0,g);for(var f=0;f<c.length;f++){var h=c[f];a.splice(e++,0,h)}d(e-1)&&d(e)&&a.splice(e,0,g)}Object.defineProperty(a,"__esModule",{value:!0});a.transpileShader=void 0;var h=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];a.transpileShader=function(a,f){a=l(a);var b;a:{b="100";var g="300 es";void 0===b&&(b="100");void 0===g&&(g="300 es");for(var m=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,t=0;t<a.length;t++){var u=a[t];
if("preprocessor"===u.type){var r=m.exec(u.data);if(r){m=r[1].replace(/\s\s+/g," ");if(m===g){b=m;break a}if(m===b){u.data="#version "+g;break a}throw Error("unknown glsl version: "+m);}}}a.splice(0,0,{type:"preprocessor",data:"#version "+g},{type:"whitespace",data:"\n"});b=null}if("300 es"===b)throw Error("shader is already glsl 300 es");m=u=null;t={};r={};for(b=0;b<a.length;++b)switch(g=a[b],g.type){case "keyword":"vertex"===f&&"attribute"===g.data?g.data="in":"varying"===g.data&&(g.data="vertex"===
f?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(g.data.trim())&&(g.data=g.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===f&&"gl_FragColor"===g.data){if(!u){var u=e(a,t,"fragColor"),q=void 0;void 0===q&&(q="lowp");c(a,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:q},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:u},{type:"operator",data:";"}],"afterPrecision")}g.data=
u}if("fragment"===f&&"gl_FragData"===g.data){for(var q=a,v=void 0,w=void 0,z=-1,x=b+1;x<q.length;x++){var B=q[x];if("operator"===B.type&&("["===B.data&&(v=x),"]"===B.data)){w=x;break}"integer"===B.type&&(z=parseInt(B.data,10))}v&&w&&q.splice(v,w-v+1);q=z;v=e(a,t,"fragData");w="mediump";void 0===w&&(w="lowp");c(a,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",
data:q.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:w},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:v},{type:"operator",data:";"}],"afterPrecision");g.data=v}else"fragment"===f&&"gl_FragDepthEXT"===g.data&&(m||(m=e(a,t,"gl_FragDepth")),g.data=m);break;case "ident":if(0<=d.indexOf(g.data)){if(q="vertex"===f)a:{for(q=b-1;0<=q;q--)if(v=a[q],
"whitespace"!==v.type&&"block-comment"!==v.type)if("keyword"===v.type){if("attribute"===v.data||"in"===v.data){q=!0;break a}}else break;q=!1}if(q)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");g.data in r||(r[g.data]=e(a,t,g.data));g.data=r[g.data]}}for(b=a.length-1;0<=b;--b)g=a[b],"preprocessor"===g.type&&((f=g.data.match(/\#extension\s+(.*)\:/))&&f[1]&&0<=h.indexOf(f[1].trim())&&(f=a[b+1],a.splice(b,f&&"whitespace"===f.type?2:1)),(f=g.data.match(/\#ifdef\s+(.*)/))&&
f[1]&&0<=h.indexOf(f[1].trim())&&(g.data="#if 1"),(f=g.data.match(/\#ifndef\s+(.*)/))&&f[1]&&0<=h.indexOf(f[1].trim())&&(g.data="#if 0"));return k(a)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(n,a){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(n){"use strict;";return function(a){var d=n(),l=[],l=l.concat(d(a));return l=l.concat(d(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(n,a,d){"use strict;";var l="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function k(a){a.length&&v.push({type:l[t],
data:a,position:x,line:w,column:z})}function e(){q=q.length?[]:q;if("/"===r&&"*"===u)return x=p+g-1,t=0,r=u,g+1;if("/"===r&&"/"===u)return x=p+g-1,t=1,r=u,g+1;if("#"===u)return t=2,x=p+g,g;if(/\s/.test(u))return t=9,x=p+g,g;B=/\d/.test(u);A=/[^\w_]/.test(u);x=p+g;t=B?4:A?3:9999;return g}function c(){if(("\r"===u||"\n"===u)&&"\\"!==r)return k(q.join("")),t=999,g;q.push(u);r=u;return g+1}function h(){if("."===r&&/\d/.test(u))return t=5,g;if("/"===r&&"*"===u)return t=0,g;if("/"===r&&"/"===u)return t=
1,g;if("."===u&&q.length){for(;m(q););t=5;return g}if(";"===u||")"===u||"("===u){if(q.length)for(;m(q););k(u);t=999;return g+1}var a=2===q.length&&"\x3d"!==u;if(/[\w_\d\s]/.test(u)||a){for(;m(q););t=999;return g}q.push(u);r=u;return g+1}function m(b){var g=0,c,d;do{c=a.indexOf(b.slice(0,b.length+g).join(""));d=a[c];if(-1===c){if(0<g--+b.length)continue;d=b.slice(0,1).join("")}k(d);x+=d.length;q=q.slice(d.length);return q.length}while(1)}function f(){if("."===u||/[eE]/.test(u))return q.push(u),t=5,
r=u,g+1;if("x"===u&&1===q.length&&"0"===q[0])return t=11,q.push(u),r=u,g+1;if(/[^\d]/.test(u))return k(q.join("")),t=999,g;q.push(u);r=u;return g+1}function b(){"f"===u&&(q.push(u),r=u,g+=1);if(/[eE]/.test(u)||"-"===u&&/[eE]/.test(r))return q.push(u),r=u,g+1;if(/[^\d]/.test(u))return k(q.join("")),t=999,g;q.push(u);r=u;return g+1}var g=0,p=0,t=999,u,r,q=[],v=[],w=1,z=0,x=0,B=!1,A=!1,C="",E;return function(a){v=[];if(null!==a){a=a.replace?a.replace(/\r\n/g,"\n"):a;g=0;C+=a;for(E=C.length;u=C[g],g<
E;){a=g;switch(t){case 0:"/"===u&&"*"===r?(q.push(u),k(q.join("")),t=999):(q.push(u),r=u);g+=1;break;case 1:g=c();break;case 2:g=c();break;case 3:g=h();break;case 4:g=f();break;case 11:/[^a-fA-F0-9]/.test(u)?(k(q.join("")),t=999):(q.push(u),r=u,g+=1);break;case 5:g=b();break;case 9999:if(/[^\d\w_]/.test(u)){var m=q.join("");t=-1<n.indexOf(m)?8:-1<d.indexOf(m)?7:6;k(q.join(""));t=999}else q.push(u),r=u,g+=1;break;case 9:/[^\s]/g.test(u)?(k(q.join("")),t=999):(q.push(u),r=u,g+=1);break;case 999:g=e()}if(a!==
g)switch(C[a]){case "\n":z=0;++w;break;default:++z}}p+=g;C=C.slice(g);return v}q.length&&k(q.join(""));t=10;k("(eof)");return v}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/renderState":function(){define(["require","exports","tslib"],function(n,a,d){function l(a){return x.intern(a)}function k(a){return B.intern(a)}function e(a){return A.intern(a)}function c(a){return C.intern(a)}function h(a){return E.intern(a)}function m(a){return G.intern(a)}function f(a){return F.intern(a)}function b(a){return H.intern(a)}function g(a){return"["+a.join(",")+"]"}function p(a){return a?g([a.srcRgb,a.srcAlpha,a.dstRgb,a.dstAlpha,a.opRgb,a.opAlpha,a.color.r,a.color.g,
a.color.b,a.color.a]):null}function t(a){return a?g([a.face,a.mode]):null}function u(a){return a?g([a.factor,a.units]):null}function r(a){return a?g([a.func]):null}function q(a){return a?g([a.function.func,a.function.ref,a.function.mask,a.operation.fail,a.operation.zFail,a.operation.zPass]):null}function v(a){return a?g([a.zNear,a.zFar]):null}function w(a){return a?g([a.r,a.g,a.b,a.a]):null}function z(a){return a?g([a.mask]):null}Object.defineProperty(a,"__esModule",{value:!0});a.StateTracker=a.makePipelineState=
a.makeStencilWrite=a.makeColorWrite=a.makeDepthWrite=a.makeStencilTest=a.makeDepthTest=a.makePolygonOffset=a.makeCulling=a.makeBlending=a.defaultColorWriteParams=a.defaultDepthWriteParams=a.backFaceCullingParams=a.separateBlendingParams=a.simpleBlendingParams=void 0;a.simpleBlendingParams=function(a,b,g,c){void 0===g&&(g=32774);void 0===c&&(c=[0,0,0,0]);return{srcRgb:a,srcAlpha:a,dstRgb:b,dstAlpha:b,opRgb:g,opAlpha:g,color:{r:c[0],g:c[1],b:c[2],a:c[3]}}};a.separateBlendingParams=function(a,b,c,g,
d,e,f){void 0===d&&(d=32774);void 0===e&&(e=32774);void 0===f&&(f=[0,0,0,0]);return{srcRgb:a,srcAlpha:b,dstRgb:c,dstAlpha:g,opRgb:d,opAlpha:e,color:{r:f[0],g:f[1],b:f[2],a:f[3]}}};a.backFaceCullingParams={face:1029,mode:2305};a.defaultDepthWriteParams={zNear:0,zFar:1};a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.makeBlending=l;a.makeCulling=k;a.makePolygonOffset=e;a.makeDepthTest=c;a.makeStencilTest=h;a.makeDepthWrite=m;a.makeColorWrite=f;a.makeStencilWrite=b;a.makePipelineState=function(a){return J.intern(a)};
n=function(){function a(a,b){this.makeKey=a;this.makeRef=b;this.interns=new Map}a.prototype.intern=function(a){if(!a)return null;var b=this.makeKey(a),c=this.interns;c.has(b)||c.set(b,this.makeRef(a));return c.get(b)};return a}();var x=new n(p,function(a){return d.__assign({__tag:"Blending"},a)}),B=new n(t,function(a){return d.__assign({__tag:"Culling"},a)}),A=new n(u,function(a){return d.__assign({__tag:"PolygonOffset"},a)}),C=new n(r,function(a){return d.__assign({__tag:"DepthTest"},a)}),E=new n(q,
function(a){return d.__assign({__tag:"StencilTest"},a)}),G=new n(v,function(a){return d.__assign({__tag:"DepthWrite"},a)}),F=new n(w,function(a){return d.__assign({__tag:"ColorWrite"},a)}),H=new n(z,function(a){return d.__assign({__tag:"StencilWrite"},a)}),J=new n(function(a){return a?g([p(a.blending),t(a.culling),u(a.polygonOffset),r(a.depthTest),q(a.stencilTest),v(a.depthWrite),w(a.colorWrite),z(a.stencilWrite)]):null},function(a){return{blending:l(a.blending),culling:k(a.culling),polygonOffset:e(a.polygonOffset),
depthTest:c(a.depthTest),stencilTest:h(a.stencilTest),depthWrite:m(a.depthWrite),colorWrite:f(a.colorWrite),stencilWrite:b(a.stencilWrite)}});n=function(){function a(a){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=a}a.prototype.setPipeline=function(a){if(this._pipelineInvalid||a!==this._pipeline)this.setBlending(a.blending),
this.setCulling(a.culling),this.setPolygonOffset(a.polygonOffset),this.setDepthTest(a.depthTest),this.setStencilTest(a.stencilTest),this.setDepthWrite(a.depthWrite),this.setColorWrite(a.colorWrite),this.setStencilWrite(a.stencilWrite),this._pipeline=a;this._pipelineInvalid=!1};a.prototype.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};a.prototype.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};a.prototype.invalidatePolygonOffset=function(){this._pipelineInvalid=
this._polygonOffsetInvalid=!0};a.prototype.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};a.prototype.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};a.prototype.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};a.prototype.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};
a.prototype.setBlending=function(a){this._blending=this.setSubState(a,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};a.prototype.setCulling=function(a){this._culling=this.setSubState(a,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};a.prototype.setPolygonOffset=function(a){this._polygonOffset=this.setSubState(a,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=
!1};a.prototype.setDepthTest=function(a){this._depthTest=this.setSubState(a,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};a.prototype.setStencilTest=function(a){this._stencilTest=this.setSubState(a,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};a.prototype.setDepthWrite=function(a){this._depthWrite=this.setSubState(a,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);
this._depthWriteInvalid=!1};a.prototype.setColorWrite=function(a){this._colorWrite=this.setSubState(a,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};a.prototype.setStencilWrite=function(a){this._stencilWrite=this.setSubState(a,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};a.prototype.setSubState=function(a,b,c,g){if(c||a!==b)g(a),this._pipelineInvalid=!0;return a};return a}();a.StateTracker=
n})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["require","exports"],function(n,a){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/imageUtils":function(){define(["require","exports","tslib","../../../request"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.requestImage=void 0;a.requestImage=function(a,e){return l(a,d.__assign({responseType:"image"},e)).then(function(a){return a.data})}})},"esri/views/3d/support/buffer/glUtil":function(){define(["require","exports","tslib"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.glLayout=void 0;var l={divisor:0};a.glLayout=
function(a,c){void 0===c&&(c={});c=d.__assign(d.__assign({},l),c);var e=a.stride;return a.fieldNames.filter(function(c){c=a.fields.get(c).optional;return!(c&&c.glPadding)}).map(function(d){var f=a.fields.get(d),b=f.constructor.ElementCount;var g=k[f.constructor.ElementType];if(!g)throw Error("BufferType not supported in WebGL");return{name:d,stride:e,count:b,type:g,offset:f.offset,normalized:!(!f.optional||!f.optional.glNormalized),divisor:c.divisor}})};var k={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,
i32:5124,f32:5126}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView","./types"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.newLayout=a.InterleavedLayout=a.InterleavedBuffer=void 0;var k=function(){function a(a,c){this.layout=a;this.buffer="number"===typeof c?new ArrayBuffer(c*a.stride):c;c=0;for(var d=a.fieldNames;c<d.length;c++){var b=d[c],g=a.fields.get(b);this[b]=new g.constructor(this.buffer,g.offset,this.stride)}}
Object.defineProperty(a.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"byteLength",{get:function(){return this.buffer.byteLength},enumerable:!1,configurable:!0});a.prototype.getField=function(a,c){return(a=this[a])&&a.elementCount===c.ElementCount&&a.elementType===c.ElementType?a:null};
a.prototype.slice=function(c,d){return new a(this.layout,this.buffer.slice(c*this.stride,d*this.stride))};a.prototype.copyFrom=function(a,c,d,b){var g=this.stride;0===g%4?(a=new Uint32Array(a.buffer,c*g,b*g/4),d=new Uint32Array(this.buffer,d*g,b*g/4)):(a=new Uint8Array(a.buffer,c*g,b*g),d=new Uint8Array(this.buffer,d*g,b*g));d.set(a)};return a}();a.InterleavedBuffer=k;var e=function(){function a(){this.stride=0;this.fields=new Map;this.fieldNames=[]}a.prototype.vec2f=function(a,c){this.appendField(a,
d.BufferViewVec2f,c);return this};a.prototype.vec2f64=function(a,c){this.appendField(a,d.BufferViewVec2f64,c);return this};a.prototype.vec3f=function(a,c){this.appendField(a,d.BufferViewVec3f,c);return this};a.prototype.vec3f64=function(a,c){this.appendField(a,d.BufferViewVec3f64,c);return this};a.prototype.vec4f=function(a,c){this.appendField(a,d.BufferViewVec4f,c);return this};a.prototype.vec4f64=function(a,c){this.appendField(a,d.BufferViewVec4f64,c);return this};a.prototype.mat3f=function(a,c){this.appendField(a,
d.BufferViewMat3f,c);return this};a.prototype.mat3f64=function(a,c){this.appendField(a,d.BufferViewMat3f64,c);return this};a.prototype.mat4f=function(a,c){this.appendField(a,d.BufferViewMat4f,c);return this};a.prototype.mat4f64=function(a,c){this.appendField(a,d.BufferViewMat4f64,c);return this};a.prototype.vec4u8=function(a,c){this.appendField(a,d.BufferViewVec4u8,c);return this};a.prototype.f32=function(a,c){this.appendField(a,d.BufferViewFloat,c);return this};a.prototype.f64=function(a,c){this.appendField(a,
d.BufferViewFloat64,c);return this};a.prototype.u8=function(a,c){this.appendField(a,d.BufferViewUint8,c);return this};a.prototype.u16=function(a,c){this.appendField(a,d.BufferViewUint16,c);return this};a.prototype.i8=function(a,c){this.appendField(a,d.BufferViewInt8,c);return this};a.prototype.vec2i8=function(a,c){this.appendField(a,d.BufferViewVec2i8,c);return this};a.prototype.vec2i16=function(a,c){this.appendField(a,d.BufferViewVec2i16,c);return this};a.prototype.vec2u8=function(a,c){this.appendField(a,
d.BufferViewVec2u8,c);return this};a.prototype.vec4u16=function(a,c){this.appendField(a,d.BufferViewVec4u16,c);return this};a.prototype.u32=function(a,c){this.appendField(a,d.BufferViewUint32,c);return this};a.prototype.appendField=function(a,c,d){var b=c.ElementCount*l.elementTypeSize(c.ElementType);this.fields.set(a,{size:b,constructor:c,offset:this.stride,optional:d});this.stride+=b;this.fieldNames.push(a)};a.prototype.alignTo=function(a){this.stride=Math.floor((this.stride+a-1)/a)*a;return this};
a.prototype.hasField=function(a){return 0<=this.fieldNames.indexOf(a)};a.prototype.createBuffer=function(a){return new k(this,a)};a.prototype.createView=function(a){return new k(this,a)};a.prototype.clone=function(){var c=new a;c.stride=this.stride;c.fields=new Map;this.fields.forEach(function(a,d){return c.fields.set(d,a)});c.fieldNames=this.fieldNames.slice();c.BufferType=this.BufferType;return c};return a}();a.InterleavedLayout=e;a.newLayout=function(){return new e}})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports tslib ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),
function(n,a,d,l,k,e,c,h,m){Object.defineProperty(a,"__esModule",{value:!0});a.BufferViewVec4i32=a.BufferViewVec3i32=a.BufferViewVec2i32=a.BufferViewInt32=a.BufferViewVec4i16=a.BufferViewVec3i16=a.BufferViewVec2i16=a.BufferViewInt16=a.BufferViewVec4i8=a.BufferViewVec3i8=a.BufferViewVec2i8=a.BufferViewInt8=a.BufferViewVec4u32=a.BufferViewVec3u32=a.BufferViewVec2u32=a.BufferViewUint32=a.BufferViewVec4u16=a.BufferViewVec3u16=a.BufferViewVec2u16=a.BufferViewUint16=a.BufferViewVec4u8=a.BufferViewVec3u8=
a.BufferViewVec2u8=a.BufferViewUint8=a.BufferViewVec4f64=a.BufferViewVec3f64=a.BufferViewVec2f64=a.BufferViewFloat64=a.BufferViewMat4f64=a.BufferViewMat4f=a.BufferViewMat3f64=a.BufferViewMat3f=a.BufferViewVec4f=a.BufferViewVec3f=a.BufferViewVec2f=a.BufferViewFloat=void 0;n=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};
b.ElementType="f32";return b}(e.BufferViewScalarImpl);a.BufferViewFloat=n;n=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="f32";return b}(c.BufferViewVec2Impl);a.BufferViewVec2f=n;n=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}
d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="f32";return b}(h.BufferViewVec3Impl);a.BufferViewVec3f=n;n=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="f32";return b}(m.BufferViewVec4Impl);a.BufferViewVec4f=n;n=function(a){function b(b,
c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="f32";return b}(l.BufferViewMat3Impl);a.BufferViewMat3f=n;l=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d,e)||this;b.elementType="f64";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+
a.byteLength)};b.ElementType="f64";return b}(l.BufferViewMat3Impl);a.BufferViewMat3f64=l;l=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="f32";return b}(k.BufferViewMat4Impl);a.BufferViewMat4f=l;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d,e)||this;b.elementType=
"f64";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="f64";return b}(k.BufferViewMat4Impl);a.BufferViewMat4f64=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d,e)||this;b.elementType="f64";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="f64";return b}(e.BufferViewScalarImpl);a.BufferViewFloat64=
k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d,e)||this;b.elementType="f64";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="f64";return b}(c.BufferViewVec2Impl);a.BufferViewVec2f64=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d,e)||this;b.elementType="f64";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,
a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="f64";return b}(h.BufferViewVec3Impl);a.BufferViewVec3f64=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d,e)||this;b.elementType="f64";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="f64";return b}(m.BufferViewVec4Impl);a.BufferViewVec4f64=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint8Array,
b,c,d,e)||this;b.elementType="u8";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="u8";return b}(e.BufferViewScalarImpl);a.BufferViewUint8=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint8Array,b,c,d,e)||this;b.elementType="u8";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="u8";return b}(c.BufferViewVec2Impl);
a.BufferViewVec2u8=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint8Array,b,c,d,e)||this;b.elementType="u8";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="u8";return b}(h.BufferViewVec3Impl);a.BufferViewVec3u8=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint8Array,b,c,d,e)||this;b.elementType="u8";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,
a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="u8";return b}(m.BufferViewVec4Impl);a.BufferViewVec4u8=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint16Array,b,c,d,e)||this;b.elementType="u16";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="u16";return b}(e.BufferViewScalarImpl);a.BufferViewUint16=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint16Array,
b,c,d,e)||this;b.elementType="u16";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="u16";return b}(c.BufferViewVec2Impl);a.BufferViewVec2u16=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint16Array,b,c,d,e)||this;b.elementType="u16";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="u16";return b}(h.BufferViewVec3Impl);
a.BufferViewVec3u16=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint16Array,b,c,d,e)||this;b.elementType="u16";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="u16";return b}(m.BufferViewVec4Impl);a.BufferViewVec4u16=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint32Array,b,c,d,e)||this;b.elementType="u32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,
a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="u32";return b}(e.BufferViewScalarImpl);a.BufferViewUint32=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint32Array,b,c,d,e)||this;b.elementType="u32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="u32";return b}(c.BufferViewVec2Impl);a.BufferViewVec2u32=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint32Array,
b,c,d,e)||this;b.elementType="u32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="u32";return b}(h.BufferViewVec3Impl);a.BufferViewVec3u32=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint32Array,b,c,d,e)||this;b.elementType="u32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="u32";return b}(m.BufferViewVec4Impl);
a.BufferViewVec4u32=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int8Array,b,c,d,e)||this;b.elementType="i8";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="i8";return b}(e.BufferViewScalarImpl);a.BufferViewInt8=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int8Array,b,c,d,e)||this;b.elementType="i8";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,
a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="i8";return b}(c.BufferViewVec2Impl);a.BufferViewVec2i8=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int8Array,b,c,d,e)||this;b.elementType="i8";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="i8";return b}(h.BufferViewVec3Impl);a.BufferViewVec3i8=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int8Array,b,c,d,
e)||this;b.elementType="i8";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="i8";return b}(m.BufferViewVec4Impl);a.BufferViewVec4i8=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int16Array,b,c,d,e)||this;b.elementType="i16";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="i16";return b}(e.BufferViewScalarImpl);
a.BufferViewInt16=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int16Array,b,c,d,e)||this;b.elementType="i16";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="i16";return b}(c.BufferViewVec2Impl);a.BufferViewVec2i16=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int16Array,b,c,d,e)||this;b.elementType="i16";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,
a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="i16";return b}(h.BufferViewVec3Impl);a.BufferViewVec3i16=k;k=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int16Array,b,c,d,e)||this;b.elementType="i16";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="i16";return b}(m.BufferViewVec4Impl);a.BufferViewVec4i16=k;e=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int32Array,
b,c,d,e)||this;b.elementType="i32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="i32";return b}(e.BufferViewScalarImpl);a.BufferViewInt32=e;c=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int32Array,b,c,d,e)||this;b.elementType="i32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="i32";return b}(c.BufferViewVec2Impl);
a.BufferViewVec2i32=c;h=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int32Array,b,c,d,e)||this;b.elementType="i32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="i32";return b}(h.BufferViewVec3Impl);a.BufferViewVec3i32=h;m=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int32Array,b,c,d,e)||this;b.elementType="i32";return b}d.__extends(b,a);b.fromTypedArray=function(a,c){return new b(a.buffer,
a.byteOffset,c,a.byteOffset+a.byteLength)};b.ElementType="i32";return b}(m.BufferViewVec4Impl);a.BufferViewVec4i32=m})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.BufferViewMat3Impl=void 0;n=function(){function a(a,d,e,c,h){void 0===e&&(e=0);this.TypedArrayConstructor=a;this.elementCount=9;a=this.TypedArrayConstructor;void 0===c&&(c=9*a.BYTES_PER_ELEMENT);var m=0===d.byteLength?0:e;this.typedBuffer=
null==h?new a(d,m):new a(d,m,(h-e)/a.BYTES_PER_ELEMENT);this.typedBufferStride=c/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getMat=function(a,d){a*=this.typedBufferStride;for(var e=0;9>e;e++)d[e]=this.typedBuffer[a+e];return d};a.prototype.setMat=function(a,d){a*=this.typedBufferStride;for(var e=0;9>e;e++)this.typedBuffer[a+e]=d[e]};a.prototype.get=function(a,d){return this.typedBuffer[a*
this.typedBufferStride+d]};a.prototype.set=function(a,d,e){this.typedBuffer[a*this.typedBufferStride+d]=e};a.prototype.copyFrom=function(a,d,e){var c=this.typedBuffer,h=d.typedBuffer;a*=this.typedBufferStride;d=e*d.typedBufferStride;for(e=0;9>e;++e)c[a+e]=h[d+e]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!1,configurable:!0});a.ElementCount=9;return a}();a.BufferViewMat3Impl=n})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.BufferViewMat4Impl=void 0;n=function(){function a(a,d,e,c,h){void 0===e&&(e=0);this.TypedArrayConstructor=a;this.elementCount=16;a=this.TypedArrayConstructor;void 0===c&&(c=16*a.BYTES_PER_ELEMENT);var m=0===d.byteLength?0:e;this.typedBuffer=null==h?new a(d,m):new a(d,m,(h-e)/a.BYTES_PER_ELEMENT);this.typedBufferStride=c/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*
this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getMat=function(a,d){a*=this.typedBufferStride;for(var e=0;16>e;e++)d[e]=this.typedBuffer[a+e];return d};a.prototype.setMat=function(a,d){a*=this.typedBufferStride;for(var e=0;16>e;e++)this.typedBuffer[a+e]=d[e]};a.prototype.get=function(a,d){return this.typedBuffer[a*this.typedBufferStride+d]};a.prototype.set=function(a,d,e){this.typedBuffer[a*this.typedBufferStride+d]=e};a.prototype.copyFrom=function(a,d,e){var c=this.typedBuffer,h=d.typedBuffer;
a*=this.typedBufferStride;d=e*d.typedBufferStride;for(e=0;16>e;++e)c[a+e]=h[d+e]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!1,configurable:!0});a.ElementCount=16;return a}();a.BufferViewMat4Impl=n})},"esri/views/3d/support/buffer/internals/Scalar":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.BufferViewScalarImpl=void 0;n=function(){function a(a,d,e,c,h){void 0===e&&(e=0);this.TypedArrayConstructor=
a;this.elementCount=1;a=this.TypedArrayConstructor;void 0===c&&(c=a.BYTES_PER_ELEMENT);var m=0===d.byteLength?0:e;this.typedBuffer=null==h?new a(d,m):new a(d,m,(h-e)/a.BYTES_PER_ELEMENT);this.typedBufferStride=c/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.get=function(a){return this.typedBuffer[a*this.typedBufferStride]};a.prototype.set=function(a,d){this.typedBuffer[a*
this.typedBufferStride]=d};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!1,configurable:!0});a.ElementCount=1;return a}();a.BufferViewScalarImpl=n})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.BufferViewVec2Impl=void 0;n=function(){function a(a,d,c,h,m){void 0===c&&(c=0);this.TypedArrayConstructor=
a;this.elementCount=2;a=this.TypedArrayConstructor;void 0===h&&(h=2*a.BYTES_PER_ELEMENT);var e=0===d.byteLength?0:c;this.typedBuffer=null==m?new a(d,e):new a(d,e,(m-c)/a.BYTES_PER_ELEMENT);this.typedBufferStride=h/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,e){return d.vec2.set(e,this.typedBuffer[a*this.typedBufferStride],this.typedBuffer[a*this.typedBufferStride+
1])};a.prototype.setVec=function(a,d){this.typedBuffer[a*this.typedBufferStride]=d[0];this.typedBuffer[a*this.typedBufferStride+1]=d[1]};a.prototype.get=function(a,d){return this.typedBuffer[a*this.typedBufferStride+d]};a.prototype.set=function(a,d,c){this.typedBuffer[a*this.typedBufferStride+d]=c};a.prototype.setValues=function(a,d,c){this.typedBuffer[a*this.typedBufferStride]=d;this.typedBuffer[a*this.typedBufferStride+1]=c};a.prototype.copyFrom=function(a,d,c){var e=this.typedBuffer,m=d.typedBuffer;
a*=this.typedBufferStride;d=c*d.typedBufferStride;e[a]=m[d];e[a+1]=m[d+1]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!1,configurable:!0});a.ElementCount=2;return a}();a.BufferViewVec2Impl=n})},"esri/core/libs/gl-matrix-2/vec2":function(){define(["require","exports","./math/vec2"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.vec2=void 0;a.vec2=d})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["require","exports",
"./common"],function(n,a,d){function l(a,c,d){a[0]=c[0]-d[0];a[1]=c[1]-d[1];return a}function k(a,c,d){a[0]=c[0]*d[0];a[1]=c[1]*d[1];return a}function e(a,c,d){a[0]=c[0]/d[0];a[1]=c[1]/d[1];return a}function c(a,c){var b=c[0]-a[0];a=c[1]-a[1];return Math.sqrt(b*b+a*a)}function h(a,c){var b=c[0]-a[0];a=c[1]-a[1];return b*b+a*a}function m(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)}function f(a){var b=a[0];a=a[1];return b*b+a*a}Object.defineProperty(a,"__esModule",{value:!0});a.sqrLen=a.sqrDist=
a.dist=a.div=a.mul=a.sub=a.len=a.equals=a.exactEquals=a.str=a.angle=a.rotate=a.transformMat4=a.transformMat3=a.transformMat2d=a.transformMat2=a.random=a.lerp=a.cross=a.dot=a.normalize=a.inverse=a.negate=a.squaredLength=a.length=a.squaredDistance=a.distance=a.scaleAndAdd=a.scale=a.round=a.max=a.min=a.floor=a.ceil=a.divide=a.multiply=a.subtract=a.add=a.set=a.copy=void 0;a.copy=function(a,c){a[0]=c[0];a[1]=c[1];return a};a.set=function(a,c,d){a[0]=c;a[1]=d;return a};a.add=function(a,c,d){a[0]=c[0]+d[0];
a[1]=c[1]+d[1];return a};a.subtract=l;a.multiply=k;a.divide=e;a.ceil=function(a,c){a[0]=Math.ceil(c[0]);a[1]=Math.ceil(c[1]);return a};a.floor=function(a,c){a[0]=Math.floor(c[0]);a[1]=Math.floor(c[1]);return a};a.min=function(a,c,d){a[0]=Math.min(c[0],d[0]);a[1]=Math.min(c[1],d[1]);return a};a.max=function(a,c,d){a[0]=Math.max(c[0],d[0]);a[1]=Math.max(c[1],d[1]);return a};a.round=function(a,c){a[0]=Math.round(c[0]);a[1]=Math.round(c[1]);return a};a.scale=function(a,c,d){a[0]=c[0]*d;a[1]=c[1]*d;return a};
a.scaleAndAdd=function(a,c,d,e){a[0]=c[0]+d[0]*e;a[1]=c[1]+d[1]*e;return a};a.distance=c;a.squaredDistance=h;a.length=m;a.squaredLength=f;a.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];return a};a.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];return a};a.normalize=function(a,c){var b=c[0],d=c[1],b=b*b+d*d;0<b&&(b=1/Math.sqrt(b),a[0]=c[0]*b,a[1]=c[1]*b);return a};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]};a.cross=function(a,c,d){c=c[0]*d[1]-c[1]*d[0];a[0]=a[1]=0;a[2]=c;return a};a.lerp=function(a,
c,d,e){var b=c[0];c=c[1];a[0]=b+e*(d[0]-b);a[1]=c+e*(d[1]-c);return a};a.random=function(a,c){c=c||1;var b=2*d.RANDOM()*Math.PI;a[0]=Math.cos(b)*c;a[1]=Math.sin(b)*c;return a};a.transformMat2=function(a,c,d){var b=c[0];c=c[1];a[0]=d[0]*b+d[2]*c;a[1]=d[1]*b+d[3]*c;return a};a.transformMat2d=function(a,c,d){var b=c[0];c=c[1];a[0]=d[0]*b+d[2]*c+d[4];a[1]=d[1]*b+d[3]*c+d[5];return a};a.transformMat3=function(a,c,d){var b=c[0];c=c[1];a[0]=d[0]*b+d[3]*c+d[6];a[1]=d[1]*b+d[4]*c+d[7];return a};a.transformMat4=
function(a,c,d){var b=c[0];c=c[1];a[0]=d[0]*b+d[4]*c+d[12];a[1]=d[1]*b+d[5]*c+d[13];return a};a.rotate=function(a,c,d,e){var b=c[0]-d[0];c=c[1]-d[1];var g=Math.sin(e);e=Math.cos(e);a[0]=b*e-c*g+d[0];a[1]=b*g+c*e+d[1];return a};a.angle=function(a,c){var b=a[0];a=a[1];var d=c[0];c=c[1];var e=b*b+a*a;0<e&&(e=1/Math.sqrt(e));var g=d*d+c*c;0<g&&(g=1/Math.sqrt(g));b=(b*d+a*c)*e*g;return 1<b?0:-1>b?Math.PI:Math.acos(b)};a.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};a.exactEquals=function(a,c){return a[0]===
c[0]&&a[1]===c[1]};a.equals=function(a,c){var b=a[0];a=a[1];var e=c[0];c=c[1];return Math.abs(b-e)<=d.EPSILON*Math.max(1,Math.abs(b),Math.abs(e))&&Math.abs(a-c)<=d.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};a.len=m;a.sub=l;a.mul=k;a.div=e;a.dist=c;a.sqrDist=h;a.sqrLen=f})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec3"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.BufferViewVec3Impl=void 0;n=
function(){function a(a,d,c,h,m){void 0===c&&(c=0);this.TypedArrayConstructor=a;this.elementCount=3;a=this.TypedArrayConstructor;void 0===h&&(h=3*a.BYTES_PER_ELEMENT);var e=0===d.byteLength?0:c;this.typedBuffer=null==m?new a(d,e):new a(d,e,(m-c)/a.BYTES_PER_ELEMENT);this.typedBufferStride=h/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,e){return d.vec3.set(e,
this.typedBuffer[a*this.typedBufferStride],this.typedBuffer[a*this.typedBufferStride+1],this.typedBuffer[a*this.typedBufferStride+2])};a.prototype.setVec=function(a,d){this.typedBuffer[a*this.typedBufferStride]=d[0];this.typedBuffer[a*this.typedBufferStride+1]=d[1];this.typedBuffer[a*this.typedBufferStride+2]=d[2]};a.prototype.get=function(a,d){return this.typedBuffer[a*this.typedBufferStride+d]};a.prototype.set=function(a,d,c){this.typedBuffer[a*this.typedBufferStride+d]=c};a.prototype.setValues=
function(a,d,c,h){this.typedBuffer[a*this.typedBufferStride]=d;this.typedBuffer[a*this.typedBufferStride+1]=c;this.typedBuffer[a*this.typedBufferStride+2]=h};a.prototype.copyFrom=function(a,d,c){var e=this.typedBuffer,m=d.typedBuffer;a*=this.typedBufferStride;d=c*d.typedBufferStride;e[a]=m[d];e[a+1]=m[d+1];e[a+2]=m[d+2]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!1,configurable:!0});a.ElementCount=3;return a}();a.BufferViewVec3Impl=n})},
"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec4"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.BufferViewVec4Impl=void 0;n=function(){function a(a,d,c,h,m){void 0===c&&(c=0);this.TypedArrayConstructor=a;this.elementCount=4;a=this.TypedArrayConstructor;void 0===h&&(h=4*a.BYTES_PER_ELEMENT);var e=0===d.byteLength?0:c;this.typedBuffer=null==m?new a(d,e):new a(d,e,(m-c)/a.BYTES_PER_ELEMENT);this.typedBufferStride=
h/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,e){return d.vec4.set(e,this.typedBuffer[a*this.typedBufferStride],this.typedBuffer[a*this.typedBufferStride+1],this.typedBuffer[a*this.typedBufferStride+2],this.typedBuffer[a*this.typedBufferStride+3])};a.prototype.setVec=function(a,d){this.typedBuffer[a*this.typedBufferStride]=d[0];this.typedBuffer[a*
this.typedBufferStride+1]=d[1];this.typedBuffer[a*this.typedBufferStride+2]=d[2];this.typedBuffer[a*this.typedBufferStride+3]=d[3]};a.prototype.get=function(a,d){return this.typedBuffer[a*this.typedBufferStride+d]};a.prototype.set=function(a,d,c){this.typedBuffer[a*this.typedBufferStride+d]=c};a.prototype.setValues=function(a,d,c,h,m){this.typedBuffer[a*this.typedBufferStride]=d;this.typedBuffer[a*this.typedBufferStride+1]=c;this.typedBuffer[a*this.typedBufferStride+2]=h;this.typedBuffer[a*this.typedBufferStride+
3]=m};a.prototype.copyFrom=function(a,d,c){var e=this.typedBuffer,m=d.typedBuffer;a*=this.typedBufferStride;d=c*d.typedBufferStride;e[a]=m[d];e[a+1]=m[d+1];e[a+2]=m[d+2];e[a+3]=m[d+3]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!1,configurable:!0});a.ElementCount=4;return a}();a.BufferViewVec4Impl=n})},"esri/core/libs/gl-matrix-2/vec4":function(){define(["require","exports","./math/vec4"],function(n,a,d){Object.defineProperty(a,"__esModule",
{value:!0});a.vec4=void 0;a.vec4=d})},"esri/core/libs/gl-matrix-2/math/vec4":function(){define(["require","exports","./common"],function(n,a,d){function l(a,c,d){a[0]=c[0]-d[0];a[1]=c[1]-d[1];a[2]=c[2]-d[2];a[3]=c[3]-d[3];return a}function k(a,c,d){a[0]=c[0]*d[0];a[1]=c[1]*d[1];a[2]=c[2]*d[2];a[3]=c[3]*d[3];return a}function e(a,c,d){a[0]=c[0]/d[0];a[1]=c[1]/d[1];a[2]=c[2]/d[2];a[3]=c[3]/d[3];return a}function c(a,c){var b=c[0]-a[0],d=c[1]-a[1],e=c[2]-a[2];a=c[3]-a[3];return Math.sqrt(b*b+d*d+e*e+
a*a)}function h(a,c){var b=c[0]-a[0],d=c[1]-a[1],e=c[2]-a[2];a=c[3]-a[3];return b*b+d*d+e*e+a*a}function m(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)}function f(a){var b=a[0],c=a[1],d=a[2];a=a[3];return b*b+c*c+d*d+a*a}Object.defineProperty(a,"__esModule",{value:!0});a.sqrLen=a.len=a.sqrDist=a.dist=a.div=a.mul=a.sub=a.equals=a.exactEquals=a.str=a.transformQuat=a.transformMat4=a.random=a.lerp=a.dot=a.normalize=a.inverse=a.negate=a.squaredLength=a.length=a.squaredDistance=
a.distance=a.scaleAndAdd=a.scale=a.round=a.max=a.min=a.floor=a.ceil=a.divide=a.multiply=a.subtract=a.add=a.set=a.copy=void 0;a.copy=function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];return a};a.set=function(a,c,d,e,f){a[0]=c;a[1]=d;a[2]=e;a[3]=f;return a};a.add=function(a,c,d){a[0]=c[0]+d[0];a[1]=c[1]+d[1];a[2]=c[2]+d[2];a[3]=c[3]+d[3];return a};a.subtract=l;a.multiply=k;a.divide=e;a.ceil=function(a,c){a[0]=Math.ceil(c[0]);a[1]=Math.ceil(c[1]);a[2]=Math.ceil(c[2]);a[3]=Math.ceil(c[3]);return a};
a.floor=function(a,c){a[0]=Math.floor(c[0]);a[1]=Math.floor(c[1]);a[2]=Math.floor(c[2]);a[3]=Math.floor(c[3]);return a};a.min=function(a,c,d){a[0]=Math.min(c[0],d[0]);a[1]=Math.min(c[1],d[1]);a[2]=Math.min(c[2],d[2]);a[3]=Math.min(c[3],d[3]);return a};a.max=function(a,c,d){a[0]=Math.max(c[0],d[0]);a[1]=Math.max(c[1],d[1]);a[2]=Math.max(c[2],d[2]);a[3]=Math.max(c[3],d[3]);return a};a.round=function(a,c){a[0]=Math.round(c[0]);a[1]=Math.round(c[1]);a[2]=Math.round(c[2]);a[3]=Math.round(c[3]);return a};
a.scale=function(a,c,d){a[0]=c[0]*d;a[1]=c[1]*d;a[2]=c[2]*d;a[3]=c[3]*d;return a};a.scaleAndAdd=function(a,c,d,e){a[0]=c[0]+d[0]*e;a[1]=c[1]+d[1]*e;a[2]=c[2]+d[2]*e;a[3]=c[3]+d[3]*e;return a};a.distance=c;a.squaredDistance=h;a.length=m;a.squaredLength=f;a.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=-c[3];return a};a.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];a[3]=1/c[3];return a};a.normalize=function(a,c){var b=c[0],d=c[1],e=c[2];c=c[3];var g=b*b+d*d+e*e+c*c;0<g&&(g=
1/Math.sqrt(g),a[0]=b*g,a[1]=d*g,a[2]=e*g,a[3]=c*g);return a};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,e){var b=c[0],g=c[1],f=c[2];c=c[3];a[0]=b+e*(d[0]-b);a[1]=g+e*(d[1]-g);a[2]=f+e*(d[2]-f);a[3]=c+e*(d[3]-c);return a};a.random=function(a,c){c=c||1;var b,e,f,g,h,m;do b=2*d.RANDOM()-1,e=2*d.RANDOM()-1,h=b*b+e*e;while(1<=h);do f=2*d.RANDOM()-1,g=2*d.RANDOM()-1,m=f*f+g*g;while(1<=m);h=Math.sqrt((1-h)/m);a[0]=c*b;a[1]=c*e;a[2]=c*f*h;a[3]=c*g*h;return a};
a.transformMat4=function(a,c,d){var b=c[0],e=c[1],f=c[2];c=c[3];a[0]=d[0]*b+d[4]*e+d[8]*f+d[12]*c;a[1]=d[1]*b+d[5]*e+d[9]*f+d[13]*c;a[2]=d[2]*b+d[6]*e+d[10]*f+d[14]*c;a[3]=d[3]*b+d[7]*e+d[11]*f+d[15]*c;return a};a.transformQuat=function(a,c,d){var b=c[0],e=c[1],f=c[2],g=d[0],h=d[1],m=d[2];d=d[3];var k=d*b+h*f-m*e,p=d*e+m*b-g*f,l=d*f+g*e-h*b,b=-g*b-h*e-m*f;a[0]=k*d+b*-g+p*-m-l*-h;a[1]=p*d+b*-h+l*-g-k*-m;a[2]=l*d+b*-m+k*-h-p*-g;a[3]=c[3];return a};a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+
a[2]+", "+a[3]+")"};a.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]};a.equals=function(a,c){var b=a[0],e=a[1],f=a[2];a=a[3];var g=c[0],h=c[1],m=c[2];c=c[3];return Math.abs(b-g)<=d.EPSILON*Math.max(1,Math.abs(b),Math.abs(g))&&Math.abs(e-h)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(f-m)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(m))&&Math.abs(a-c)<=d.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};a.sub=l;a.mul=k;a.div=e;a.dist=c;a.sqrDist=h;a.len=m;
a.sqrLen=f})},"esri/views/3d/support/buffer/types":function(){define(["require","exports","../../../../core/compilerUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.maximumValue=a.isInteger=a.isSigned=a.elementTypeSize=void 0;a.elementTypeSize=function(a){switch(a){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8;default:d.neverReached(a)}};a.isSigned=function(a){switch(a){case "u8":case "u16":case "u32":return!1;
case "i8":case "i16":case "i32":case "f32":case "f64":return!0;default:d.neverReached(a)}};a.isInteger=function(a){switch(a){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1;default:d.neverReached(a)}};a.maximumValue=function(a){switch(a){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308;
default:d.neverReached(a)}}})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define(["require","exports","../../../../../../core/libs/gl-matrix-2/mat4","../../../../../../core/libs/gl-matrix-2/mat4f32"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.View=void 0;(function(a){function c(a,c,e){d.mat4.translate(k,e,c);a.setUniform3fv("localOrigin",c);a.setUniformMatrix4fv("view",k)}a.bindCamPosition=function(a,c,d){a.setUniform3f("camPos",d[3]-c[0],d[7]-
c[1],d[11]-c[2])};a.bindProjectionMatrix=function(a,c){a.setUniformMatrix4fv("proj",c)};a.bindNearFar=function(a,c){a.setUniform2fv("nearFar",c)};a.bindViewCustomOrigin=c;a.bindView=function(a,d){c(a,d.origin,d.camera.viewMatrix)};a.bindViewport=function(a,c){a.setUniform4fv("viewport",c.camera.fullViewport)}})(a.View||(a.View={}));var k=l.mat4f32.create()})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["require","exports","./factories/mat4f32"],function(n,a,d){Object.defineProperty(a,
"__esModule",{value:!0});a.mat4f32=void 0;a.mat4f32=d})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["require","exports"],function(n,a){function d(){var a=new Float32Array(16);a[0]=1;a[5]=1;a[10]=1;a[15]=1;return a}Object.defineProperty(a,"__esModule",{value:!0});a.IDENTITY=a.createView=a.fromValues=a.clone=a.create=void 0;a.create=d;a.clone=function(a){var d=new Float32Array(16);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];d[9]=a[9];
d[10]=a[10];d[11]=a[11];d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};a.fromValues=function(a,d,e,c,h,m,f,b,g,p,t,u,r,q,v,w){var k=new Float32Array(16);k[0]=a;k[1]=d;k[2]=e;k[3]=c;k[4]=h;k[5]=m;k[6]=f;k[7]=b;k[8]=g;k[9]=p;k[10]=t;k[11]=u;k[12]=r;k[13]=q;k[14]=v;k[15]=w;return k};a.createView=function(a,d){return new Float32Array(a,d,16)};a.IDENTITY=d()})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./Util".split(" "),
function(n,a,d,l,k,e,c,h,m){var f=c.Vec3Compact,b;(function(a){for(var b=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],c=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],d=[0,0,1,0,1,1,0,1],e=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],f=Array(36),g=0;6>g;g++)for(var k=0;6>k;k++)f[6*g+k]=g;for(var p=Array(36),g=0;6>g;g++)p[6*g+0]=0,p[6*g+1]=1,p[6*g+2]=2,p[6*g+3]=2,p[6*g+4]=3,p[6*g+5]=0;a.createGeometry=function(a){Array.isArray(a)||
(a=[a,a,a]);for(var g=new Float32Array(24),k=0;8>k;k++)g[3*k]=b[k][0]*a[0],g[3*k+1]=b[k][1]*a[1],g[3*k+2]=b[k][2]*a[2];a={};a[m.VertexAttrConstants.POSITION]=new Uint32Array(e);a[m.VertexAttrConstants.NORMAL]=new Uint32Array(f);a[m.VertexAttrConstants.UV0]=new Uint32Array(p);k={};k[m.VertexAttrConstants.POSITION]={size:3,data:g};k[m.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(c)};k[m.VertexAttrConstants.UV0]={size:2,data:new Float32Array(d)};return new h.GeometryData(k,a)}})(b||(b={}));
var g;(function(a){var b=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],c=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],d=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],e=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var f=new Float32Array(18),g=0;6>g;g++)f[3*g]=b[g][0]*a[0],f[3*g+1]=b[g][1]*a[1],f[3*g+2]=b[g][2]*a[2];a={};a[m.VertexAttrConstants.POSITION]=new Uint32Array(d);a[m.VertexAttrConstants.NORMAL]=
new Uint32Array(e);g={};g[m.VertexAttrConstants.POSITION]={size:3,data:f};g[m.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(c)};return new h.GeometryData(g,a)}})(g||(g={}));var p;(function(a){var b=l.vec3f32.fromValues(-.5,0,-.5),c=l.vec3f32.fromValues(.5,0,-.5),e=l.vec3f32.fromValues(0,0,.5),f=l.vec3f32.fromValues(0,.5,0),g=l.vec3f32.create(),k=l.vec3f32.create(),p=l.vec3f32.create(),r=l.vec3f32.create(),t=l.vec3f32.create();d.vec3.subtract(g,b,f);d.vec3.subtract(k,b,c);d.vec3.cross(p,
g,k);d.vec3.normalize(p,p);d.vec3.subtract(g,c,f);d.vec3.subtract(k,c,e);d.vec3.cross(r,g,k);d.vec3.normalize(r,r);d.vec3.subtract(g,e,f);d.vec3.subtract(k,e,b);d.vec3.cross(t,g,k);d.vec3.normalize(t,t);var q=[b,c,e,f],u=[0,-1,0,p[0],p[1],p[2],r[0],r[1],r[2],t[0],t[1],t[2]],J=[0,1,2,3,1,0,3,2,1,3,0,2],I=[0,0,0,1,1,1,2,2,2,3,3,3];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var b=new Float32Array(12),c=0;4>c;c++)b[3*c]=q[c][0]*a[0],b[3*c+1]=q[c][1]*a[1],b[3*c+2]=q[c][2]*a[2];a={};
a[m.VertexAttrConstants.POSITION]=new Uint32Array(J);a[m.VertexAttrConstants.NORMAL]=new Uint32Array(I);c={};c[m.VertexAttrConstants.POSITION]={size:3,data:b};c[m.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(u)};return new h.GeometryData(c,a)}})(p||(p={}));var t;(function(a){function c(a,b,c,e,f){if(Math.abs(d.vec3.dot(b,a))>f)return!1;d.vec3.cross(c,a,b);d.vec3.normalize(c,c);d.vec3.cross(e,c,a);d.vec3.normalize(e,e);return!0}function t(a,b,d,e,f,g,h){return c(a,b,f,g,h)||c(a,d,f,g,
h)||c(a,e,f,g,h)}a.createBoxGeometry=b.createGeometry;a.createDiamondGeometry=g.createGeometry;a.createTetrahedronGeometry=p.createGeometry;a.createSphereGeometry=function(a,b,c,d,e,f,g){a=a||50;d=void 0!==d?d:-Math.PI;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:.5*-Math.PI;g=void 0!==g?g:Math.PI;var k=Math.max(3,Math.floor(b)||8),p=Math.max(2,Math.floor(c)||6),r=(k+1)*(p+1);c=new Float32Array(3*r);b=new Float32Array(3*r);for(var r=new Float32Array(2*r),t=[],q=0,u=0;u<=p;u++){for(var l=[],v=u/p,w=f+v*
g,B=Math.cos(w),x=0;x<=k;x++){var z=x/k,A=d+z*e,C=Math.cos(A)*B,E=Math.sin(w),A=-Math.sin(A)*B;c[3*q]=C*a;c[3*q+1]=E*a;c[3*q+2]=A*a;b[3*q]=C;b[3*q+1]=E;b[3*q+2]=A;r[2*q]=z;r[2*q+1]=v;l.push(q);++q}t.push(l)}a=new Uint32Array(2*k*(p-1)*3);for(u=q=0;u<p;u++)for(x=0;x<k;x++)d=t[u][x],e=t[u][x+1],f=t[u+1][x+1],g=t[u+1][x],0===u?(a[q++]=d,a[q++]=f,a[q++]=g):u===p-1?(a[q++]=d,a[q++]=e,a[q++]=f):(a[q++]=d,a[q++]=e,a[q++]=f,a[q++]=f,a[q++]=g,a[q++]=d);m.assert(q===a.length);k={};k[m.VertexAttrConstants.POSITION]=
a;k[m.VertexAttrConstants.NORMAL]=a;k[m.VertexAttrConstants.UV0]=a;p={};p[m.VertexAttrConstants.POSITION]={size:3,data:c};p[m.VertexAttrConstants.NORMAL]={size:3,data:b};p[m.VertexAttrConstants.UV0]={size:2,data:r};return new h.GeometryData(p,k)};a.createPolySphereGeometry=function(a,b,c){function d(b,c){b>c&&(c=[c,b],b=c[0],c=c[1]);var d=b.toString()+"."+c.toString();if(k[d])return k[d];var g=e.length;e.length+=3;f.add(e,3*b,e,3*c,e,g);f.scale(e,g,a/f.length(e,g));g/=3;return k[d]=g}var e;c?(e=[0,
-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],c=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(c=a*(1+Math.sqrt(5))/2,e=[-a,c,0,a,c,0,-a,-c,0,a,-c,0,0,-a,c,0,a,c,0,-a,-c,0,a,-c,c,0,-a,c,0,a,-c,0,-a,-c,0,a],c=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var g=0;g<e.length;g+=3)f.scale(e,g,a/f.length(e,g));for(var k={},g=0;g<b;g++){for(var p=c.length,r=new Uint32Array(4*p),t=0;t<
p;t+=3){var q=c[t],u=c[t+1],l=c[t+2],v=d(q,u),w=d(u,l),B=d(l,q),x=4*t;r[x]=q;r[x+1]=v;r[x+2]=B;r[x+3]=u;r[x+4]=w;r[x+5]=v;r[x+6]=l;r[x+7]=B;r[x+8]=w;r[x+9]=v;r[x+10]=w;r[x+11]=B}c=r;k={}}b=new Float32Array(e);for(g=0;g<b.length;g+=3)f.normalize(b,g);g={};g[m.VertexAttrConstants.POSITION]=c;g[m.VertexAttrConstants.NORMAL]=c;c={};c[m.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(e)};c[m.VertexAttrConstants.NORMAL]={size:3,data:b};return new h.GeometryData(c,g)};a.createPointGeometry=function(a,
b,c,d,e,g,f,k){b=b?new Float64Array([b[0],b[1],b[2]]):new Float32Array([0,0,0]);a=a?new Float32Array([a[0],a[1],a[2]]):new Float32Array([0,0,1]);g=g?new Float32Array(g):new Float32Array([0,0]);c=c?new Uint8Array([255*c[0],255*c[1],255*c[2],3<c.length?255*c[3]:255]):new Uint8Array([255,255,255,255]);var p=null!=d&&2===d.length?new Float32Array(d):new Float32Array([1,1]);d={};d[m.VertexAttrConstants.POSITION]={size:3,data:b};d[m.VertexAttrConstants.NORMAL]={size:3,data:a};d[m.VertexAttrConstants.UV0]=
{size:g.length,data:g};d[m.VertexAttrConstants.COLOR]={size:4,data:c};d[m.VertexAttrConstants.SIZE]={size:2,data:p};null!=e&&(e=new Float32Array([e[0],e[1],e[2],e[3]]),d[m.VertexAttrConstants.AUXPOS1]={size:4,data:e});null!=f&&(f=new Float32Array([f[0],f[1],f[2],f[3]]),d[m.VertexAttrConstants.AUXPOS2]={size:4,data:f});return null!=k?(k.initialize(d,h.GeometryData.DefaultIndices,"point"),k):new h.GeometryData(d,h.GeometryData.DefaultIndices,"point")};a.updatePointGeometry=function(a,b,c,d,e,g,f,h){var k=
h.vertexAttributes;if(null!=a){var p=k[m.VertexAttrConstants.NORMAL].data;p[0]=a[0];p[1]=a[1];p[2]=a[2]}null!=b&&(p=k[m.VertexAttrConstants.POSITION].data,p[0]=b[0],p[1]=b[1],p[2]=b[2]);null!=c&&(p=k[m.VertexAttrConstants.COLOR].data,p[0]=c[0],p[1]=c[1],p[2]=c[2],p[3]=c[3]);null!=d&&(p=k[m.VertexAttrConstants.SIZE].data,p[0]=d[0],p[1]=d[1]);null!=e&&(p=k[m.VertexAttrConstants.AUXPOS1].data,p[0]=e[0],p[1]=e[1],p[2]=e[2],p[3]=e[3]);null!=g&&(p=k[m.VertexAttrConstants.UV0].data,p[0]=g[0],p[1]=g[1]);
null!=f&&(p=k[m.VertexAttrConstants.AUXPOS2].data,p[0]=f[0],p[1]=f[1],p[2]=f[2],p[3]=f[3]);return h};a.createPointArrayGeometry=function(a,b){for(var c=new Float32Array(3*a.length),d=new Float32Array(b?3*a.length:3),e=new Uint32Array(a.length),g=new Uint32Array(a.length),f=0;f<a.length;f++)c[3*f]=a[f][0],c[3*f+1]=a[f][1],c[3*f+2]=a[f][2],b&&(d[3*f]=b[f][0],d[3*f+1]=b[f][1],d[3*f+2]=b[f][2]),e[f]=f,g[f]=0;b||(d[0]=0,d[1]=1,d[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;f={};f[m.VertexAttrConstants.POSITION]=
e;f[m.VertexAttrConstants.NORMAL]=b?e:g;f[m.VertexAttrConstants.UV0]=g;b={};b[m.VertexAttrConstants.POSITION]={size:3,data:c};b[m.VertexAttrConstants.NORMAL]={size:3,data:d};b[m.VertexAttrConstants.UV0]={size:2,data:a};return new h.GeometryData(b,f,"point")};a.createTriangleGeometry=function(){var a=new Float32Array([0,0,0,0,0,100,100,0,0]),b=new Uint32Array([0,1,2]),c=new Float32Array([0,1,0]),d=new Uint32Array([0,0,0]),e=new Float32Array([0,0]),f=new Uint32Array([0,0,0]),g={};g[m.VertexAttrConstants.POSITION]=
b;g[m.VertexAttrConstants.NORMAL]=d;g[m.VertexAttrConstants.UV0]=f;b={};b[m.VertexAttrConstants.POSITION]={size:3,data:a};b[m.VertexAttrConstants.NORMAL]={size:3,data:c};b[m.VertexAttrConstants.UV0]={size:2,data:e};return new h.GeometryData(b,g)};var q=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];a.createSquareGeometry=function(a){var b,c;void 0===a&&(a=q);for(var d=new Float64Array(12),e=0;4>e;e++)for(var f=0;3>f;f++)d[3*e+f]=a[e][f];var g=new Uint32Array([0,1,2,2,3,0]);a=new Float32Array([0,0,1]);var k=
new Uint32Array([0,0,0,0,0,0]),e=new Float32Array([0,0,1,0,1,1,0,1]),f=new Uint8Array([255,255,255,255]),g=(b={},b[m.VertexAttrConstants.POSITION]=g,b[m.VertexAttrConstants.NORMAL]=k,b[m.VertexAttrConstants.UV0]=g,b[m.VertexAttrConstants.COLOR]=k,b);b=(c={},c[m.VertexAttrConstants.POSITION]={size:3,data:d},c[m.VertexAttrConstants.NORMAL]={size:3,data:a},c[m.VertexAttrConstants.UV0]={size:2,data:e},c[m.VertexAttrConstants.COLOR]={size:4,data:f},c);return new h.GeometryData(b,g)};a.createConeGeometry=
function(a,b,c,d,e,f){void 0===e&&(e=!0);void 0===f&&(f=!0);var g=0,k=l.vec3f32.fromValues(0,g,0),p=l.vec3f32.fromValues(0,g+a,0),r=l.vec3f32.fromValues(0,-1,0),t=l.vec3f32.fromValues(0,1,0);d&&(g=a,p=l.vec3f32.fromValues(0,0,0),k=l.vec3f32.fromValues(0,g,0),r=l.vec3f32.fromValues(0,1,0),t=l.vec3f32.fromValues(0,-1,0));k=[p,k];r=[r,t];t=c+2;p=Math.sqrt(a*a+b*b);if(d)for(d=c-1;0<=d;d--)q=2*Math.PI/c*d,u=l.vec3f32.fromValues(Math.cos(q)*b,g,Math.sin(q)*b),k.push(u),q=l.vec3f32.fromValues(a*Math.cos(q)/
p,-b/p,a*Math.sin(q)/p),r.push(q);else for(d=0;d<c;d++){var q=2*Math.PI/c*d,u=l.vec3f32.fromValues(Math.cos(q)*b,g,Math.sin(q)*b);k.push(u);q=l.vec3f32.fromValues(a*Math.cos(q)/p,b/p,a*Math.sin(q)/p);r.push(q)}a=new Uint32Array(6*(c+2));c=new Uint32Array(6*(c+2));g=b=0;if(e){for(d=3;d<k.length;d++)a[b++]=1,a[b++]=d-1,a[b++]=d,c[g++]=0,c[g++]=0,c[g++]=0;a[b++]=k.length-1;a[b++]=2;a[b++]=1;c[g++]=0;c[g++]=0;c[g++]=0}if(f){for(d=3;d<k.length;d++)a[b++]=d,a[b++]=d-1,a[b++]=0,c[g++]=d,c[g++]=d-1,c[g++]=
1;a[b++]=0;a[b++]=2;a[b++]=k.length-1;c[g++]=1;c[g++]=2;c[g++]=r.length-1}e=new Float32Array(3*t);for(d=0;d<t;d++)e[3*d]=k[d][0],e[3*d+1]=k[d][1],e[3*d+2]=k[d][2];f=new Float32Array(3*t);for(d=0;d<t;d++)f[3*d]=r[d][0],f[3*d+1]=r[d][1],f[3*d+2]=r[d][2];k={};k[m.VertexAttrConstants.POSITION]=a;k[m.VertexAttrConstants.NORMAL]=c;r={};r[m.VertexAttrConstants.POSITION]={size:3,data:e};r[m.VertexAttrConstants.NORMAL]={size:3,data:f};return new h.GeometryData(r,k)};a.createCylinderGeometry=function(a,b,c,
e,g,f){e=e?l.vec3f32.clone(e):l.vec3f32.fromValues(1,0,0);g=g?l.vec3f32.clone(g):l.vec3f32.fromValues(0,0,0);f=void 0===f?!0:f;var k=l.vec3f32.create();d.vec3.normalize(k,e);e=l.vec3f32.create();d.vec3.scale(e,k,Math.abs(a));var p=l.vec3f32.create();d.vec3.scale(p,e,-.5);d.vec3.add(p,p,g);var r=l.vec3f32.fromValues(0,1,0);.2>Math.abs(1-d.vec3.dot(k,r))&&d.vec3.set(r,0,0,1);var t=l.vec3f32.create();d.vec3.cross(t,k,r);d.vec3.normalize(t,t);d.vec3.cross(r,t,k);var q=2*c+(f?2:0),u=c+(f?2:0);a=new Float32Array(3*
q);g=new Float32Array(3*u);var v=new Float32Array(2*q),w=new Uint32Array(3*c*(f?4:2)),z=new Uint32Array(3*c*(f?4:2));f&&(a[3*(q-2)+0]=p[0],a[3*(q-2)+1]=p[1],a[3*(q-2)+2]=p[2],v[2*(q-2)]=0,v[2*(q-2)+1]=0,a[3*(q-1)+0]=a[3*(q-2)+0]+e[0],a[3*(q-1)+1]=a[3*(q-2)+1]+e[1],a[3*(q-1)+2]=a[3*(q-2)+2]+e[2],v[2*(q-1)]=1,v[2*(q-1)+1]=1,g[3*(u-2)+0]=-k[0],g[3*(u-2)+1]=-k[1],g[3*(u-2)+2]=-k[2],g[3*(u-1)+0]=k[0],g[3*(u-1)+1]=k[1],g[3*(u-1)+2]=k[2]);for(var k=function(a,b,c){w[a]=b;z[a]=c},B=0,x=l.vec3f32.create(),
A=l.vec3f32.create(),C=0;C<c;C++){var E=2*Math.PI/c*C;d.vec3.scale(x,r,Math.sin(E));d.vec3.scale(A,t,Math.cos(E));d.vec3.add(x,x,A);g[3*C+0]=x[0];g[3*C+1]=x[1];g[3*C+2]=x[2];d.vec3.scale(x,x,b);d.vec3.add(x,x,p);a[3*C+0]=x[0];a[3*C+1]=x[1];a[3*C+2]=x[2];v[2*C+0]=C/c;v[2*C+1]=0;a[3*(C+c)+0]=a[3*C+0]+e[0];a[3*(C+c)+1]=a[3*C+1]+e[1];a[3*(C+c)+2]=a[3*C+2]+e[2];v[2*(C+c)+0]=C/c;v[2*C+1]=1;E=(C+1)%c;k(B++,C,C);k(B++,C+c,C);k(B++,E,E);k(B++,E,E);k(B++,C+c,C);k(B++,E+c,E)}if(f){for(C=0;C<c;C++)E=(C+1)%c,
k(B++,q-2,u-2),k(B++,C,u-2),k(B++,E,u-2);for(C=0;C<c;C++)E=(C+1)%c,k(B++,C+c,u-1),k(B++,q-1,u-1),k(B++,E+c,u-1)}b={};b[m.VertexAttrConstants.POSITION]=w;b[m.VertexAttrConstants.NORMAL]=z;b[m.VertexAttrConstants.UV0]=w;c={};c[m.VertexAttrConstants.POSITION]={size:3,data:a};c[m.VertexAttrConstants.NORMAL]={size:3,data:g};c[m.VertexAttrConstants.UV0]={size:2,data:v};return new h.GeometryData(c,b)};a.createTubeGeometry=function(b,c,d,e,g){d=d||10;e=null!=e?e:!0;m.assert(1<b.length);for(var f=[],h=[],
k=0;k<d;k++){f.push([0,-k-1,-((k+1)%d)-1]);var p=k/d*2*Math.PI;h.push([Math.cos(p)*c,Math.sin(p)*c])}return a.createPathExtrusionGeometry(h,b,[[0,0,0]],f,e,g)};a.createPathExtrusionGeometry=function(a,b,c,g,f,p){void 0===p&&(p=l.vec3f32.fromValues(0,0,0));var r=a.length,q=new Float32Array(b.length*r*3+(6*c.length||0)),v=new Float32Array(b.length*r+(2*c.length||0)),w=new Float32Array(b.length*r*3+(c?6:0)),z=(b.length-1)*r*6+6*g.length,x=new Uint32Array(z),z=new Uint32Array(z),B=0,A=0,C=0,E=0,G=0,n=
l.vec3f32.create(),P=l.vec3f32.create(),U=l.vec3f32.create(),Z=l.vec3f32.create(),V=l.vec3f32.create(),T=l.vec3f32.create(),Y=l.vec3f32.create(),X=k.vec3f64.create(),ca=l.vec3f32.create(),ba=l.vec3f32.create(),ga=l.vec3f32.create(),ia=l.vec3f32.create(),ha=l.vec3f32.create(),da=e.plane.create();d.vec3.set(ca,0,1,0);d.vec3.subtract(P,b[1],b[0]);d.vec3.normalize(P,P);f?(d.vec3.add(X,b[0],p),d.vec3.normalize(U,X)):d.vec3.set(U,0,0,1);t(P,U,ca,ca,V,U,u);d.vec3.copy(Z,U);d.vec3.copy(ia,V);for(var fa=0;fa<
c.length;fa++)d.vec3.scale(T,V,c[fa][0]),d.vec3.scale(X,U,c[fa][2]),d.vec3.add(T,T,X),d.vec3.add(T,T,b[0]),q[B++]=T[0],q[B++]=T[1],q[B++]=T[2],v[C++]=0;w[A++]=-P[0];w[A++]=-P[1];w[A++]=-P[2];for(fa=0;fa<g.length;fa++)x[E++]=0<g[fa][0]?g[fa][0]:-g[fa][0]-1+c.length,x[E++]=0<g[fa][1]?g[fa][1]:-g[fa][1]-1+c.length,x[E++]=0<g[fa][2]?g[fa][2]:-g[fa][2]-1+c.length,z[G++]=0,z[G++]=0,z[G++]=0;for(var ka=c.length,fa=c.length-1,ja=0;ja<b.length;ja++){var pa=!1;0<ja&&(d.vec3.copy(n,P),ja<b.length-1?(d.vec3.subtract(P,
b[ja+1],b[ja]),d.vec3.normalize(P,P)):pa=!0,d.vec3.add(ba,n,P),d.vec3.normalize(ba,ba),d.vec3.add(ga,b[ja-1],Z),e.plane.fromPositionAndNormal(b[ja],ba,da),e.plane.intersectRay(da,e.ray.wrap(ga,n),X)?(d.vec3.subtract(X,X,b[ja]),d.vec3.normalize(U,X),d.vec3.cross(V,ba,U),d.vec3.normalize(V,V)):t(ba,Z,ia,ca,V,U,u),d.vec3.copy(Z,U),d.vec3.copy(ia,V));f&&(d.vec3.add(X,b[ja],p),d.vec3.normalize(ha,X));for(var na=0;na<r;na++)if(d.vec3.scale(T,V,a[na][0]),d.vec3.scale(X,U,a[na][1]),d.vec3.add(T,T,X),d.vec3.normalize(Y,
T),w[A++]=Y[0],w[A++]=Y[1],w[A++]=Y[2],f?v[C++]=d.vec3.dot(T,ha):v[C++]=T[2],d.vec3.add(T,T,b[ja]),q[B++]=T[0],q[B++]=T[1],q[B++]=T[2],!pa){var va=(na+1)%r;x[E++]=ka+na;x[E++]=ka+r+na;x[E++]=ka+va;x[E++]=ka+va;x[E++]=ka+r+na;x[E++]=ka+r+va;for(va=0;6>va;va++)z[G++]=x[E-6+va]-fa}ka+=r}a=b[b.length-1];for(fa=0;fa<c.length;fa++)d.vec3.scale(T,V,c[fa][0]),d.vec3.scale(X,U,c[fa][1]),d.vec3.add(T,T,X),d.vec3.add(T,T,a),q[B++]=T[0],q[B++]=T[1],q[B++]=T[2],v[C++]=0;c=A/3;w[A++]=P[0];w[A++]=P[1];w[A++]=P[2];
r=ka-r;for(fa=0;fa<g.length;fa++)x[E++]=0<=g[fa][0]?ka+g[fa][0]:-g[fa][0]-1+r,x[E++]=0<=g[fa][2]?ka+g[fa][2]:-g[fa][2]-1+r,x[E++]=0<=g[fa][1]?ka+g[fa][1]:-g[fa][1]-1+r,z[G++]=c,z[G++]=c,z[G++]=c;g={};g[m.VertexAttrConstants.POSITION]=x;g[m.VertexAttrConstants.NORMAL]=z;x={};x[m.VertexAttrConstants.POSITION]={size:3,data:q};x.zOffset={size:1,data:v};x[m.VertexAttrConstants.NORMAL]={size:3,data:w};return new h.GeometryData(x,g)};a.createPolylineGeometry=function(a,b){m.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");
m.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");m.assert(void 0===b||b.length===a.length,"createPolylineGeometry: need same number of points and normals");m.assert(void 0===b||3===b[0].length,"createPolylineGeometry(): malformed normal");for(var c=new Float64Array(3*a.length),d=new Uint32Array(2*(a.length-1)),e=0,g=0,f=0;f<a.length;f++){for(var k=0;3>k;k++)c[e++]=a[f][k];0<f&&(d[g++]=f-1,d[g++]=f)}e={};g={};e[m.VertexAttrConstants.POSITION]=d;g[m.VertexAttrConstants.POSITION]=
{size:3,data:c};if(b){for(var c=new Float32Array(3*b.length),p=0,f=0;f<a.length;f++)for(k=0;3>k;k++)c[p++]=b[f][k];e[m.VertexAttrConstants.NORMAL]=d;g[m.VertexAttrConstants.NORMAL]={size:3,data:c}}return new h.GeometryData(g,e,"line")};a.createExtrudedTriangle=function(a,b,c,d){var e,g,f=new Float32Array(18);a=[[-b,0,d/2],[c,0,d/2],[0,a,d/2],[-b,0,-d/2],[c,0,-d/2],[0,a,-d/2]];for(b=0;6>b;b++)f[3*b]=a[b][0],f[3*b+1]=a[b][1],f[3*b+2]=a[b][2];a=(e={},e[m.VertexAttrConstants.POSITION]=new Uint32Array([0,
1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),e);e=(g={},g[m.VertexAttrConstants.POSITION]={size:3,data:f},g);return new h.GeometryData(e,a)};a.transformInPlace=function(a,b){a=a.vertexAttributes[m.VertexAttrConstants.POSITION].data;for(var c=0;c<a.length;c+=3)d.vec3.set(r,a[c],a[c+1],a[c+2]),d.vec3.transformMat4(r,r,b),a[c]=r[0],a[c+1]=r[1],a[c+2]=r[2]};a.cgToGIS=function(a,b){void 0===b&&(b=a);var c=a.getVertexAttr();a=c.position.data;var c=c.normal.data,d=b.getVertexAttr(),e=d.position.data,
d=d.normal.data;if(c)for(var g=0;g<c.length;g+=3){var f=c[g+1];d[g+1]=-c[g+2];d[g+2]=f}if(a)for(g=0;g<a.length;g+=3)f=a[g+1],e[g+1]=-a[g+2],e[g+2]=f;return b};a.makeOrthoBasisDirUp=c;a.makeOrthoBasisDirUpFallback=t})(t||(t={}));var u=.99619469809,r=l.vec3f32.create();return t})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["require","exports","./factories/vec3f32"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.vec3f32=void 0;a.vec3f32=d})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["require",
"exports"],function(n,a){function d(){return new Float32Array(3)}function l(a,c,b){var d=new Float32Array(3);d[0]=a;d[1]=c;d[2]=b;return d}function k(){return l(1,1,1)}function e(){return l(1,0,0)}function c(){return l(0,1,0)}function h(){return l(0,0,1)}Object.defineProperty(a,"__esModule",{value:!0});a.UNIT_Z=a.UNIT_Y=a.UNIT_X=a.ONES=a.ZEROS=a.unitZ=a.unitY=a.unitX=a.ones=a.zeros=a.createView=a.fromValues=a.clone=a.create=void 0;a.create=d;a.clone=function(a){var c=new Float32Array(3);c[0]=a[0];
c[1]=a[1];c[2]=a[2];return c};a.fromValues=l;a.createView=function(a,c){return new Float32Array(a,c,3)};a.zeros=function(){return d()};a.ones=k;a.unitX=e;a.unitY=c;a.unitZ=h;a.ZEROS=d();a.ONES=k();a.UNIT_X=e();a.UNIT_Y=c();a.UNIT_Z=h()})},"esri/views/3d/support/geometryUtils":function(){define("require exports ./geometryUtils/axisAngle ./geometryUtils/boundedPlane ./geometryUtils/clipRay ./geometryUtils/frustum ./geometryUtils/lineSegment ./geometryUtils/plane ./geometryUtils/ray ./geometryUtils/sphere ./geometryUtils/triangle ./geometryUtils/vector".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){Object.defineProperty(a,"__esModule",{value:!0});a.axisAngle=a.vector=a.frustum=a.sphere=a.clipRay=a.ray=a.lineSegment=a.triangle=a.boundedPlane=a.plane=void 0;a.plane=h;a.boundedPlane=l;a.triangle=b;a.lineSegment=c;a.ray=m;a.clipRay=k;a.sphere=f;a.frustum=e;a.vector=g;a.axisAngle=d})},"esri/views/3d/support/geometryUtils/axisAngle":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../stack","./vector"],function(n,a,d,l,k){function e(c){void 0===
c&&(c=a.UP);return[c[0],c[1],c[2],c[3]]}function c(a,c,d,b,g){void 0===g&&(g=e());g[0]=a;g[1]=c;g[2]=d;g[3]=b;return g}Object.defineProperty(a,"__esModule",{value:!0});a.UP=a.axis=a.fromPoints=a.fromAxisAndAngle=a.fromValues=a.copy=a.wrapAxisAngle=a.wrap=a.create=void 0;a.create=e;a.wrap=function(a,d,e,b){return c(a,d,e,b,l.sv4d.get())};a.wrapAxisAngle=function(a,d){return c(a[0],a[1],a[2],d,l.sv4d.get())};a.copy=function(a,d){void 0===d&&(d=e());return c(a[0],a[1],a[2],a[3],d)};a.fromValues=c;a.fromAxisAndAngle=
function(a,c,f){void 0===f&&(f=e());d.vec3.copy(f,a);f[3]=c;return f};a.fromPoints=function(a,c,f){void 0===f&&(f=e());d.vec3.cross(f,a,c);d.vec3.normalize(f,f);f[3]=k.angle(a,c);return f};a.axis=function(a){return a};a.UP=[0,0,1,0]})},"esri/views/3d/support/stack":function(){define(["require","exports","../../../core/VectorStack"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.sq4d=a.sm4d=a.sm3d=a.sv4d=a.sv3d=a.sv2d=void 0;a.sv2d=d.VectorStack.createVec2f64();a.sv3d=d.VectorStack.createVec3f64();
a.sv4d=d.VectorStack.createVec4f64();a.sm3d=d.VectorStack.createMat3f64();a.sm4d=d.VectorStack.createMat4f64();a.sq4d=d.VectorStack.createQuatf64()})},"esri/core/VectorStack":function(){define("require exports ./maybe ./nextTick ./libs/gl-matrix-2/mat3f64 ./libs/gl-matrix-2/mat4f64 ./libs/gl-matrix-2/quatf64 ./libs/gl-matrix-2/vec2f64 ./libs/gl-matrix-2/vec3f64 ./libs/gl-matrix-2/vec4f64".split(" "),function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.VectorStack=void 0;
n=function(){function a(a,b,c){var d=this;this.itemByteSize=a;this.itemCreate=b;this.buffers=[];this.items=[];this.itemsPtr=this.itemsPerBuffer=0;this.itemsPerBuffer=Math.ceil(c/this.itemByteSize);this.tickHandle=l.before(function(){return d.reset()})}a.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=d.nullifyNonnullableForDispose(this.tickHandle));this.itemsPtr=0;this.items=d.nullifyNonnullableForDispose(this.items);this.buffers=d.nullifyNonnullableForDispose(this.buffers)};
a.prototype.get=function(){0===this.itemsPtr&&l(function(){});for(var a=Math.floor(this.itemsPtr/this.itemsPerBuffer);this.buffers.length<=a;){for(var b=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),c=0;c<this.itemsPerBuffer;++c)this.items.push(this.itemCreate(b,c*this.itemByteSize));this.buffers.push(b)}return this.items[this.itemsPtr++]};a.prototype.reset=function(){for(var a=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>a;)this.buffers.pop(),this.items.length=
this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0};a.createVec2f64=function(c){void 0===c&&(c=b);return new a(16,h.vec2f64.createView,c)};a.createVec3f64=function(c){void 0===c&&(c=b);return new a(24,m.vec3f64.createView,c)};a.createVec4f64=function(c){void 0===c&&(c=b);return new a(32,f.vec4f64.createView,c)};a.createMat3f64=function(c){void 0===c&&(c=b);return new a(72,k.mat3f64.createView,c)};a.createMat4f64=function(c){void 0===c&&(c=b);return new a(128,e.mat4f64.createView,c)};a.createQuatf64=
function(d){void 0===d&&(d=b);return new a(32,c.quatf64.createView,d)};Object.defineProperty(a.prototype,"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!1,configurable:!0});return a}();a.VectorStack=n;var b=4096})},"esri/core/libs/gl-matrix-2/mat3f64":function(){define(["require","exports","./factories/mat3f64"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.mat3f64=void 0;a.mat3f64=d})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.createView=a.fromValues=a.clone=a.create=void 0;a.create=function(){return[1,0,0,0,1,0,0,0,1]};a.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]};a.fromValues=function(a,l,k,e,c,h,m,f,b){return[a,l,k,e,c,h,m,f,b]};a.createView=function(a,l){return new Float64Array(a,l,9)}})},"esri/core/libs/gl-matrix-2/quatf64":function(){define(["require","exports","./factories/quatf64"],function(n,a,d){Object.defineProperty(a,
"__esModule",{value:!0});a.quatf64=void 0;a.quatf64=d})},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["require","exports"],function(n,a){function d(){return[0,0,0,1]}Object.defineProperty(a,"__esModule",{value:!0});a.IDENTITY=a.createView=a.fromValues=a.clone=a.create=void 0;a.create=d;a.clone=function(a){return[a[0],a[1],a[2],a[3]]};a.fromValues=function(a,d,e,c){return[a,d,e,c]};a.createView=function(a,d){return new Float64Array(a,d,4)};a.IDENTITY=d()})},"esri/core/libs/gl-matrix-2/vec2f64":function(){define(["require",
"exports","./factories/vec2f64"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.vec2f64=void 0;a.vec2f64=d})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.UNIT_Y=a.UNIT_X=a.ONES=a.ZEROS=a.unitY=a.unitX=a.ones=a.zeros=a.createView=a.fromArray=a.fromValues=a.clone=a.create=void 0;a.create=function(){return[0,0]};a.clone=function(a){return[a[0],a[1]]};a.fromValues=function(a,
l){return[a,l]};a.fromArray=function(a){for(var d=[0,0],k=Math.min(2,a.length),e=0;e<k;++e)d[e]=a[e];return d};a.createView=function(a,l){return new Float64Array(a,l,2)};a.zeros=function(){return[0,0]};a.ones=function(){return[1,1]};a.unitX=function(){return[1,0]};a.unitY=function(){return[0,1]};a.ZEROS=[0,0];a.ONES=[1,1];a.UNIT_X=[1,0];a.UNIT_Y=[0,1]})},"esri/views/3d/support/geometryUtils/vector":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3",
"../../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.angleAroundAxis=a.angle=a.projectPointSignedLength=a.projectPoint=void 0;a.projectPoint=function(a,c,d){c=l.vec3.dot(a,c)/l.vec3.dot(a,a);return l.vec3.scale(d,a,c)};a.projectPointSignedLength=function(a,c){return l.vec3.dot(a,c)/l.vec3.length(a)};a.angle=function(a,c){a=l.vec3.dot(a,c)/(l.vec3.length(a)*l.vec3.length(c));return-d.acosClamped(a)};a.angleAroundAxis=function(a,m,f){l.vec3.normalize(e,
a);l.vec3.normalize(c,m);a=l.vec3.dot(e,c);a=d.acosClamped(a);m=l.vec3.cross(e,e,c);return 0>l.vec3.dot(m,f)?2*Math.PI-a:a};var e=k.vec3f64.create(),c=k.vec3f64.create()})},"esri/views/3d/support/geometryUtils/boundedPlane":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack ./lineSegment ./plane ./ray ./vector".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){function q(b){void 0===b&&(b=a.UP);return{plane:t.create(b.plane),origin:f.vec3f64.clone(b.origin),basis1:f.vec3f64.clone(b.basis1),basis2:f.vec3f64.clone(b.basis2)}}function v(a,b){void 0===b&&(b=q());return w(a.origin,a.basis1,a.basis2,b)}function w(a,b,c,d){void 0===d&&(d=q());m.vec3.copy(d.origin,a);m.vec3.copy(d.basis1,b);m.vec3.copy(d.basis2,c);z(d);a=d;1E-6<Math.abs(m.vec3.dot(a.basis1,a.basis2)/(m.vec3.length(a.basis1)*m.vec3.length(a.basis2)))&&R.warn("fromValues()",
"Provided basis vectors are not perpendicular");1E-6<Math.abs(m.vec3.dot(a.basis1,I(a)))&&R.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-m.vec3.dot(I(a),a.origin)-a.plane[3])&&R.warn("fromValues()","Plane offset is not consistent with plane origin");return d}function z(a){t.fromVectorsAndPoint(a.basis2,a.basis1,a.origin,a.plane)}function x(a,b,c){a!==c&&v(a,c);a=m.vec3.scale(g.sv3d.get(),I(a),b);m.vec3.add(c.origin,c.origin,a);c.plane[3]-=b;return c}function B(a,
b){void 0===b&&(b=q());var c=(a[2]-a[0])/2,d=(a[3]-a[1])/2;m.vec3.set(b.origin,a[0]+c,a[1]+d,0);m.vec3.set(b.basis1,c,0,0);m.vec3.set(b.basis2,0,d,0);t.fromValues(0,0,1,0,b.plane);return b}function A(a,b,c){return t.intersectRay(a.plane,b,c)?K(a,c):!1}function C(a,c,d){var e=O.get(),f=O.get();Q(a,c,e,f);for(var f=Number.POSITIVE_INFINITY,h=0,p=U;h<p.length;h++){var r=M(a,p[h],N.get()),q=g.sv3d.get();t.intersectLineSegment(e,r,q)&&(r=b.directionFromTo(g.sv3d.get(),c.origin,q),r=Math.abs(k.acosClamped(m.vec3.dot(c.direction,
r))),r<f&&(f=r,m.vec3.copy(d,q)))}return f===Number.POSITIVE_INFINITY?E(a,c,d):d}function E(a,b,c){if(A(a,b,c))return c;var d=O.get(),e=O.get();Q(a,b,d,e);for(var f=Number.POSITIVE_INFINITY,h=0,k=U;h<k.length;h++){var p=M(a,k[h],N.get()),r=g.sv3d.get();t.intersectLineSegmentClamp(d,p,r)&&(p=u.distance2(b,r),t.isPointInside(e,r)&&p<f&&(f=p,m.vec3.copy(c,r)))}H(a,b.origin)<f&&G(a,b.origin,c);return c}function G(a,b,c){var d=t.projectPoint(a.plane,b,g.sv3d.get());b=p.projectPointClamp(L(a,a.basis1),
d,-1,1,g.sv3d.get());d=p.projectPointClamp(L(a,a.basis2),d,-1,1,g.sv3d.get());m.vec3.subtract(c,m.vec3.add(g.sv3d.get(),b,d),a.origin);return c}function F(a,b,c){var d=a.origin,e=a.basis1,f=a.basis2;b=m.vec3.subtract(g.sv3d.get(),b,d);e=r.projectPointSignedLength(e,b);f=r.projectPointSignedLength(f,b);a=r.projectPointSignedLength(I(a),b);return m.vec3.set(c,e,f,a)}function H(a,b){b=F(a,b,g.sv3d.get());var c=a.basis2;a=m.vec3.length(a.basis1);c=m.vec3.length(c);a=Math.max(Math.abs(b[0])-a,0);c=Math.max(Math.abs(b[1])-
c,0);b=b[2];return a*a+c*c+b*b}function J(a,b){var c=-a.plane[3];return r.projectPointSignedLength(I(a),b)-c}function I(a){return t.normal(a.plane)}function K(a,b){var c=m.vec3.subtract(g.sv3d.get(),b,a.origin);b=m.vec3.squaredLength(a.basis1);var d=m.vec3.squaredLength(a.basis2),e=m.vec3.dot(a.basis1,c);a=m.vec3.dot(a.basis2,c);return 0>-e-b&&0>e-b&&0>-a-d&&0>a-d}function L(a,b){var c=N.get();m.vec3.copy(c.origin,a.origin);m.vec3.copy(c.vector,b);return c}function M(a,b,c){var d=a.basis1,e=a.basis2;
a=a.origin;var f=m.vec3.scale(g.sv3d.get(),d,b.origin[0]),h=m.vec3.scale(g.sv3d.get(),e,b.origin[1]);m.vec3.add(c.origin,f,h);m.vec3.add(c.origin,c.origin,a);d=m.vec3.scale(g.sv3d.get(),d,b.direction[0]);b=m.vec3.scale(g.sv3d.get(),e,b.direction[1]);m.vec3.scale(c.vector,m.vec3.add(d,d,b),2);return c}function Q(a,b,c,d){a=I(a);t.fromVectorsAndPoint(a,b.direction,b.origin,c);t.fromVectorsAndPoint(t.normal(c),a,b.origin,d)}Object.defineProperty(a,"__esModule",{value:!0});a.UP=a.normal=a.rotate=a.transform=
a.equals=a.setAltitudeAt=a.altitudeAt=a.axisAt=a.extrusionContainsPoint=a.distanceToSilhouette=a.distance=a.distance2=a.projectPointLocal=a.projectPoint=a.closestPoint=a.closestPointOnSilhouette=a.intersectRayClosestSilhouette=a.intersectRay=a.fromAABoundingRect=a.setExtent=a.elevate=a.updateUnboundedPlane=a.fromValues=a.copy=a.wrap=a.create=a.BoundedPlaneClass=void 0;var R=l.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");n=function(){return function(){this.plane=t.create();this.origin=
f.vec3f64.create();this.basis1=f.vec3f64.create();this.basis2=f.vec3f64.create()}}();a.BoundedPlaneClass=n;a.create=q;a.wrap=function(a,b,c){var d=P.get();d.origin=a;d.basis1=b;d.basis2=c;d.plane=t.wrap(0,0,0,0);z(d);return d};a.copy=v;a.fromValues=w;a.updateUnboundedPlane=z;a.elevate=x;a.setExtent=function(a,b,c){B(b,c);x(c,J(a,a.origin),c);return c};a.fromAABoundingRect=B;a.intersectRay=A;a.intersectRayClosestSilhouette=function(a,b,c){if(A(a,b,c))return c;a=C(a,b,g.sv3d.get());m.vec3.add(c,b.origin,
m.vec3.scale(g.sv3d.get(),b.direction,m.vec3.distance(b.origin,a)/m.vec3.length(b.direction)));return c};a.closestPointOnSilhouette=C;a.closestPoint=E;a.projectPoint=G;a.projectPointLocal=F;a.distance2=H;a.distance=function(a,b){return Math.sqrt(H(a,b))};a.distanceToSilhouette=function(a,b){for(var c=Number.NEGATIVE_INFINITY,d=0,e=U;d<e.length;d++){var g=M(a,e[d],N.get()),g=p.distance2(g,b);g>c&&(c=g)}return Math.sqrt(c)};a.extrusionContainsPoint=function(a,b){return t.isPointInside(a.plane,b)&&K(a,
b)};a.axisAt=function(a,b,c,e){switch(c){case 0:m.vec3.copy(e,a.basis1);m.vec3.normalize(e,e);break;case 1:m.vec3.copy(e,a.basis2);m.vec3.normalize(e,e);break;case 2:m.vec3.copy(e,I(a));break;default:d.neverReached(c)}return e};a.altitudeAt=J;a.setAltitudeAt=function(a,b,c,d){var e=J(a,b);a=m.vec3.scale(S,I(a),c-e);m.vec3.add(d,b,a);return d};a.equals=function(a,b){return m.vec3.exactEquals(a.basis1,b.basis1)&&m.vec3.exactEquals(a.basis2,b.basis2)&&m.vec3.exactEquals(a.origin,b.origin)};a.transform=
function(a,b,d){a!==d&&v(a,d);c.mat4.invert(Z,b);c.mat4.transpose(Z,Z);m.vec3.transformMat4(d.basis1,a.basis1,Z);m.vec3.transformMat4(d.basis2,a.basis2,Z);m.vec3.transformMat4(t.normal(d.plane),t.normal(a.plane),Z);m.vec3.transformMat4(d.origin,a.origin,b);t.setOffsetFromPoint(d.plane,d.origin,d.plane);return d};a.rotate=function(a,b,d,e){a!==e&&v(a,e);c.mat4.rotate(V,c.mat4.identity(V),b,d);m.vec3.transformMat4(e.basis1,a.basis1,V);m.vec3.transformMat4(e.basis2,a.basis2,V);z(e);return e};a.normal=
I;a.UP={plane:t.create(),origin:f.vec3f64.fromValues(0,0,0),basis1:f.vec3f64.fromValues(1,0,0),basis2:f.vec3f64.fromValues(0,1,0)};var O=new e.ObjectStack(t.create),N=new e.ObjectStack(p.create),S=f.vec3f64.create(),P=new e.ObjectStack(function(){return{origin:null,basis1:null,basis2:null,plane:null}}),U=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Z=h.mat4f64.create(),V=h.mat4f64.create()})},"esri/core/ObjectStack":function(){define(["require",
"exports","./maybe","./nextTick"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.ObjectStack=void 0;n=function(){function a(a){var c=this;this.allocator=a;this.items=[];this.itemsPtr=0;this.tickHandle=l.before(function(){return c.reset()});this.grow()}a.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=d.nullifyNonnullableForDispose(this.tickHandle));this.items=d.nullifyNonnullableForDispose(this.items)};a.prototype.get=function(){0===this.itemsPtr&&
l(function(){});this.itemsPtr===this.items.length&&this.grow();return this.items[this.itemsPtr++]};a.prototype.reset=function(){this.items.length=Math.min(Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*k),this.items.length);this.itemsPtr=0};a.prototype.grow=function(){for(var a=0;a<Math.max(8,Math.min(this.items.length,k));a++)this.items.push(this.allocator())};return a}();a.ObjectStack=n;var k=1024;a.default=n})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define("require exports ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),
function(n,a,d,l,k,e,c){function h(a){return a?{origin:e.vec3f64.clone(a.origin),vector:e.vec3f64.clone(a.vector)}:{origin:e.vec3f64.create(),vector:e.vec3f64.create()}}function m(a,b){var c=u.get();c.origin=a;c.vector=b;return c}function f(a,b,c){void 0===c&&(c=h());k.vec3.copy(c.origin,a);k.vec3.copy(c.vector,b);return c}function b(a,b){b=k.vec3.subtract(c.sv3d.get(),b,a.origin);var e=k.vec3.dot(a.vector,b),g=k.vec3.dot(a.vector,a.vector),e=d.clamp(e/g,0,1);a=k.vec3.subtract(c.sv3d.get(),k.vec3.scale(c.sv3d.get(),
a.vector,e),b);return k.vec3.dot(a,a)}function g(a,b,e,g,f){var h=a.vector,m=a.origin;b=k.vec3.subtract(c.sv3d.get(),b,m);m=k.vec3.length(h);b=k.vec3.dot(h,b)/m;k.vec3.scale(f,h,d.clamp(b,e,g));return k.vec3.add(f,f,a.origin)}function p(a,b,e,g){var f=a.origin,h=k.vec3.add(c.sv3d.get(),f,a.vector);a=b.origin;var m=k.vec3.add(c.sv3d.get(),a,b.vector),p=c.sv3d.get();b=c.sv3d.get();p[0]=f[0]-a[0];p[1]=f[1]-a[1];p[2]=f[2]-a[2];b[0]=m[0]-a[0];b[1]=m[1]-a[1];b[2]=m[2]-a[2];if(1E-6>Math.abs(b[0])&&1E-6>
Math.abs(b[1])&&1E-6>Math.abs(b[2]))return!1;m=c.sv3d.get();m[0]=h[0]-f[0];m[1]=h[1]-f[1];m[2]=h[2]-f[2];if(1E-6>Math.abs(m[0])&&1E-6>Math.abs(m[1])&&1E-6>Math.abs(m[2]))return!1;var h=p[0]*b[0]+p[1]*b[1]+p[2]*b[2],r=b[0]*m[0]+b[1]*m[1]+b[2]*m[2],t=b[0]*b[0]+b[1]*b[1]+b[2]*b[2],q=(m[0]*m[0]+m[1]*m[1]+m[2]*m[2])*t-r*r;if(1E-6>Math.abs(q))return!1;p=(h*r-(p[0]*m[0]+p[1]*m[1]+p[2]*m[2])*t)/q;h=(h+r*p)/t;e&&(p=d.clamp(p,0,1),h=d.clamp(h,0,1));e=c.sv3d.get();r=c.sv3d.get();e[0]=f[0]+p*m[0];e[1]=f[1]+p*
m[1];e[2]=f[2]+p*m[2];r[0]=a[0]+h*b[0];r[1]=a[1]+h*b[1];r[2]=a[2]+h*b[2];g.tA=p;g.tB=h;g.pA=e;g.pB=r;g.distance2=k.vec3.squaredDistance(e,r);return!0}Object.defineProperty(a,"__esModule",{value:!0});a.closestLineSegmentDistance2=a.closestLineSegmentPoint=a.closestRayDistance2=a.projectPointClamp=a.pointAt=a.projectPoint=a.distance=a.distance2=a.fromPoints=a.fromValues=a.copy=a.wrap=a.create=void 0;a.create=h;a.wrap=m;a.copy=function(a,b){void 0===b&&(b=h());return f(a.origin,a.vector,b)};a.fromValues=
f;a.fromPoints=function(a,b,c){void 0===c&&(c=h());k.vec3.copy(c.origin,a);k.vec3.subtract(c.vector,b,a);return c};a.distance2=b;a.distance=function(a,c){return Math.sqrt(b(a,c))};a.projectPoint=function(a,b,c){return g(a,b,0,1,c)};a.pointAt=function(a,b,c){return k.vec3.add(c,a.origin,k.vec3.scale(c,a.vector,b))};a.projectPointClamp=g;a.closestRayDistance2=function(a,b){if(p(a,m(b.origin,b.direction),!1,t)){b=t.tA;var d=t.pB,e=t.distance2;if(0<=b&&1>=b)return e;if(0>b)return k.vec3.squaredDistance(a.origin,
d);if(1<b)return k.vec3.squaredDistance(k.vec3.add(c.sv3d.get(),a.origin,a.vector),d)}return null};a.closestLineSegmentPoint=function(a,b,c){return p(a,b,!0,t)?(k.vec3.copy(c,t.pA),!0):!1};a.closestLineSegmentDistance2=function(a,b){return p(a,b,!0,t)?t.distance2:null};var t={tA:0,tB:0,pA:e.vec3f64.create(),pB:e.vec3f64.create(),distance2:0},u=new l.ObjectStack(function(){return{origin:null,vector:null}})})},"esri/views/3d/support/geometryUtils/plane":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),
function(n,a,d,l,k,e){function c(b){void 0===b&&(b=a.UP);return[b[0],b[1],b[2],b[3]]}function h(a,b){void 0===b&&(b=c());return m(a[0],a[1],a[2],a[3],b)}function m(a,b,d,e,g){void 0===g&&(g=c());g[0]=a;g[1]=b;g[2]=d;g[3]=e;return g}function f(a,b,d){void 0===d&&(d=c());l.vec3.copy(d,b);b=l.vec3.dot(b,b);1E-5<Math.abs(b-1)&&1E-12<b&&l.vec3.scale(d,d,1/Math.sqrt(b));p(d,a,d);return d}function b(a,b,d,g){void 0===g&&(g=c());return t(l.vec3.subtract(e.sv3d.get(),a,b),l.vec3.subtract(e.sv3d.get(),d,b),
a,g)}function g(a,c,d,e,f){if(3>a.count)return!1;a.getVec(d,w);for(var h=e,m=!1;h<a.count-1&&!m;)a.getVec(h,z),h++,m=!l.vec3.exactEquals(w,z);if(!m)return!1;h=Math.max(h,f);for(m=!1;h<a.count&&!m;)a.getVec(h,x),h++,l.vec3.subtract(B,w,z),l.vec3.normalize(B,B),l.vec3.subtract(A,z,x),l.vec3.normalize(A,A),m=!l.vec3.exactEquals(w,x)&&!l.vec3.exactEquals(z,x)&&Math.abs(l.vec3.dot(B,A))<v;if(!m)return 0===d&&1===e&&2===f?!1:g(a,c,0,1,2);b(w,z,x,c);return!0}function p(a,b,c){a!==c&&h(a,c);c[3]=-l.vec3.dot(c,
b);return c}function t(a,b,d,g){void 0===g&&(g=c());a=l.vec3.cross(e.sv3d.get(),b,a);return f(d,a,g)}function u(a,b,c){a=l.vec3.scale(e.sv3d.get(),a,l.vec3.dot(a,b));l.vec3.subtract(c,b,a);return c}function r(a,b){return l.vec3.dot(a,b)+a[3]}function q(a,b,c,e,g,f){var h=l.vec3.dot(a,c);if(0===h)return!1;a=-(l.vec3.dot(a,b)+a[3])/h;g&&(a=e?Math.max(0,a):d.clamp(a,0,1));if(0>a||!e&&1<a)return!1;l.vec3.add(f,b,l.vec3.scale(f,c,a));return!0}Object.defineProperty(a,"__esModule",{value:!0});a.UP=a.normal=
a.signedDistance=a.distance=a.projectVector=a.projectPoint=a.clipInfinite=a.clip=a.isAABBFullyInside=a.isPointOutside=a.isPointInside=a.isSphereFullyOutside=a.isSphereFullyInside=a.intersectLineSegmentClamp=a.intersectLineSegment=a.intersectRay=a.fromVectorsAndPoint=a.negate=a.setOffsetFromPoint=a.fromManyPointsSampleAt=a.fromManyPoints=a.fromPoints=a.fromPositionAndNormal=a.fromNormalAndOffset=a.fromValues=a.copy=a.wrap=a.create=void 0;a.create=c;a.wrap=function(a,b,c,d){return m(a,b,c,d,e.sv4d.get())};
a.copy=h;a.fromValues=m;a.fromNormalAndOffset=function(a,b,d){void 0===d&&(d=c());l.vec3.copy(d,a);d[3]=b;return d};a.fromPositionAndNormal=f;a.fromPoints=b;a.fromManyPoints=function(a,b){return g(a,b,0,1,2)};a.fromManyPointsSampleAt=g;var v=.99619469809,w=k.vec3f64.create(),z=k.vec3f64.create(),x=k.vec3f64.create(),B=k.vec3f64.create(),A=k.vec3f64.create();a.setOffsetFromPoint=p;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.fromVectorsAndPoint=t;a.intersectRay=function(a,
b,c){return q(a,b.origin,b.direction,!0,!1,c)};a.intersectLineSegment=function(a,b,c){return q(a,b.origin,b.vector,!1,!1,c)};a.intersectLineSegmentClamp=function(a,b,c){return q(a,b.origin,b.vector,!1,!0,c)};a.isSphereFullyInside=function(a,b){var c=b.radius;return 0<=r(a,b.center)-c};a.isSphereFullyOutside=function(a,b){var c=b.radius;return 0>r(a,b.center)+c};a.isPointInside=function(a,b){return 0<=r(a,b)};a.isPointOutside=function(a,b){return 0>r(a,b)};a.isAABBFullyInside=function(a,b){var c=b[0],
d=b[1],e=b[2],g=b[3],f=b[4];b=b[5];return 0<=a[0]*(0<a[0]?c:g)+a[1]*(0<a[1]?d:f)+a[2]*(0<a[2]?e:b)+a[3]};a.clip=function(a,b){var c=l.vec3.dot(a,b.ray.direction);a=-r(a,b.ray.origin);if(0>a&&0<=c)return!1;if(-1E-6<c&&1E-6>c)return 0<a;if((0>a||0>c)&&!(0>a&&0>c))return!0;a/=c;0<c?a<b.c1&&(b.c1=a):a>b.c0&&(b.c0=a);return b.c0<=b.c1};a.clipInfinite=function(a,b){var c=l.vec3.dot(a,b.ray.direction);a=-r(a,b.ray.origin);if(-1E-6<c&&1E-6>c)return 0<a;a/=c;0<c?a<b.c1&&(b.c1=a):a>b.c0&&(b.c0=a);return b.c0<=
b.c1};a.projectPoint=function(a,b,c){var d=l.vec3.scale(e.sv3d.get(),a,-a[3]);b=l.vec3.subtract(e.sv3d.get(),b,d);a=u(a,b,e.sv3d.get());l.vec3.add(c,a,d);return c};a.projectVector=u;a.distance=function(a,b){return Math.abs(r(a,b))};a.signedDistance=r;a.normal=function(a){return a};a.UP=[0,0,1,0]})},"esri/views/3d/support/geometryUtils/ray":function(){define("require exports ../../../../core/ObjectStack ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),
function(n,a,d,l,k,e,c,h){function m(a){return a?{origin:c.vec3f64.clone(a.origin),direction:c.vec3f64.clone(a.direction)}:{origin:c.vec3f64.create(),direction:c.vec3f64.create()}}function f(a,b,c){void 0===c&&(c=m());e.vec3.copy(c.origin,a);e.vec3.copy(c.direction,b);return c}function b(a,b,c){void 0===c&&(c=m());var d=l.castRenderScreenPointArray3(k.vec2.copy(h.sv3d.get(),b));d[2]=0;a.unprojectPoint(d,c.origin);b=l.castRenderScreenPointArray3(k.vec2.copy(h.sv3d.get(),b));b[2]=1;a=a.unprojectPoint(b,
h.sv3d.get());e.vec3.subtract(c.direction,a,c.origin);return c}function g(a,b,c){void 0===c&&(c=m());e.vec3.copy(c.origin,a.eye);b=e.vec3.set(h.sv3d.get(),b[0],b[1],1);a=a.unprojectPoint(b,h.sv3d.get());e.vec3.subtract(c.direction,a,c.origin);return c}function p(a,b){a=e.vec3.cross(h.sv3d.get(),e.vec3.normalize(h.sv3d.get(),a.direction),e.vec3.subtract(h.sv3d.get(),b,a.origin));return e.vec3.dot(a,a)}function t(){return{origin:null,direction:null}}Object.defineProperty(a,"__esModule",{value:!0});
a.createWrapper=a.closestPoint=a.distance=a.distance2=a.fromRenderAtEye=a.fromScreenAtEye=a.fromRender=a.fromScreen=a.fromValues=a.fromPoints=a.copy=a.wrap=a.create=void 0;a.create=m;a.wrap=function(a,b){var c=u.get();c.origin=a;c.direction=b;return c};a.copy=function(a,b){void 0===b&&(b=m());return f(a.origin,a.direction,b)};a.fromPoints=function(a,b,c){void 0===c&&(c=m());e.vec3.copy(c.origin,a);e.vec3.subtract(c.direction,b,a);return c};a.fromValues=f;a.fromScreen=function(a,c,d){void 0===d&&(d=
m());return b(a,a.screenToRender(c,l.castRenderScreenPointArray3(h.sv3d.get())),d)};a.fromRender=b;a.fromScreenAtEye=function(a,b,c){void 0===c&&(c=m());return g(a,a.screenToRender(b,l.castRenderScreenPointArray3(h.sv3d.get())),c)};a.fromRenderAtEye=g;a.distance2=p;a.distance=function(a,b){return Math.sqrt(p(a,b))};a.closestPoint=function(a,b,c){b=e.vec3.dot(a.direction,e.vec3.subtract(c,b,a.origin));e.vec3.add(c,a.origin,e.vec3.scale(c,a.direction,b));return c};a.createWrapper=t;var u=new d.ObjectStack(t)})},
"esri/views/3d/support/geometryUtils/clipRay":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../stack ./ray".split(" "),function(n,a,d,l,k,e){function c(a){return a?{ray:e.create(a.ray),c0:a.c0,c1:a.c1}:{ray:e.create(),c0:0,c1:Number.MAX_VALUE}}function h(a,b,d,f){void 0===f&&(f=c());e.copy(a,f.ray);f.c0=b;f.c1=d;return f}function m(a,b,d){void 0===d&&(d=c());var g=l.vec3.length(a.vector);e.fromValues(a.origin,b,d.ray);d.c0=0;d.c1=g;return d}
function f(a,b,c){return l.vec3.add(c,a.ray.origin,l.vec3.scale(c,a.ray.direction,b))}Object.defineProperty(a,"__esModule",{value:!0});a.getAt=a.getEnd=a.getStart=a.fromLineSegmentAndDirection=a.fromLineSegment=a.fromRay=a.fromValues=a.copy=a.wrap=a.create=void 0;a.create=c;a.wrap=function(a,c,d){var e=b.get();e.ray=a;e.c0=c;e.c1=d;return e};a.copy=function(a,b){void 0===b&&(b=c());return h(a.ray,a.c0,a.c1,b)};a.fromValues=h;a.fromRay=function(a,b){void 0===b&&(b=c());e.copy(a,b.ray);b.c0=0;b.c1=
Number.MAX_VALUE;return b};a.fromLineSegment=function(a,b){void 0===b&&(b=c());var d=l.vec3.normalize(k.sv3d.get(),a.vector);return m(a,d,b)};a.fromLineSegmentAndDirection=m;a.getStart=function(a,b){return f(a,a.c0,b)};a.getEnd=function(a,b){return f(a,a.c1,b)};a.getAt=f;var b=new d.ObjectStack(function(){return{c0:0,c1:0,ray:null}})})},"esri/views/3d/support/geometryUtils/frustum":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../stack ./clipRay ./plane".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){function g(a){if(a){var c=a.planes;a=a.points;return{planes:[b.create(c[0]),b.create(c[1]),b.create(c[2]),b.create(c[3]),b.create(c[4]),b.create(c[5])],points:[e.vec3f64.clone(a[0]),e.vec3f64.clone(a[1]),e.vec3f64.clone(a[2]),e.vec3f64.clone(a[3]),e.vec3f64.clone(a[4]),e.vec3f64.clone(a[5]),e.vec3f64.clone(a[6]),e.vec3f64.clone(a[7])]}}return{planes:[b.create(),b.create(),b.create(),b.create(),b.create(),b.create()],points:[e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create(),
e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create()]}}function p(a,c,d){void 0===d&&(d=g());for(var e=0;6>e;e++)b.copy(a[e],d.planes[e]);for(e=0;8>e;e++)k.vec3.copy(d.points[e],c[e]);return d}function t(a){var c=a.planes;a=a.points;b.fromPoints(a[4],a[0],a[3],c[0]);b.fromPoints(a[1],a[5],a[6],c[1]);b.fromPoints(a[4],a[5],a[1],c[2]);b.fromPoints(a[3],a[2],a[6],c[3]);b.fromPoints(a[0],a[1],a[2],c[4]);b.fromPoints(a[5],a[4],a[7],c[5])}function u(a,c){for(var d=
0;6>d;d++)if(!b.clip(a[d],c))return!1;return!0}Object.defineProperty(a,"__esModule",{value:!0});a.planePointIndices=a.intersectsAABB=a.intersectsPoint=a.intersectsLineSegment=a.intersectClipRay=a.intersectsRay=a.intersectsSphere=a.recomputePlanes=a.fromMatrix=a.fromValues=a.copy=a.create=void 0;a.create=g;a.copy=function(a,b){void 0===b&&(b=g());return p(a.planes,a.points,b)};a.fromValues=p;a.fromMatrix=function(a,b,d){void 0===d&&(d=g());var e=d.points;a=l.mat4.multiply(m.sm4d.get(),b,a);l.mat4.invert(a,
a);for(b=0;8>b;++b){var f=c.vec4.transformMat4(m.sv4d.get(),r[b],a);k.vec3.set(e[b],f[0]/f[3],f[1]/f[3],f[2]/f[3])}t(d);return d};a.recomputePlanes=t;a.intersectsSphere=function(a,c){for(var d=0;6>d;d++)if(b.isSphereFullyInside(a[d],c))return!1;return!0};a.intersectsRay=function(a,b){return u(a,f.fromRay(b,q.get()))};a.intersectClipRay=function(a,c){for(var d=0;6>d;d++)if(!b.clipInfinite(a[d],c))return!1;return!0};a.intersectsLineSegment=function(a,b,c){return u(a,f.fromLineSegmentAndDirection(b,
c,q.get()))};a.intersectsPoint=function(a,c){for(var d=0;6>d;d++)if(0<b.signedDistance(a[d],c))return!1;return!0};a.intersectsAABB=function(a,c){for(var d=0;6>d;d++)if(b.isAABBFullyInside(a[d],c))return!1;return!0};a.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};var r=[h.vec4f64.fromValues(-1,-1,-1,1),h.vec4f64.fromValues(1,-1,-1,1),h.vec4f64.fromValues(1,1,-1,1),h.vec4f64.fromValues(-1,1,-1,1),h.vec4f64.fromValues(-1,-1,1,1),h.vec4f64.fromValues(1,
-1,1,1),h.vec4f64.fromValues(1,1,1,1),h.vec4f64.fromValues(-1,1,1,1)],q=new d.ObjectStack(f.create)})},"esri/views/3d/support/geometryUtils/sphere":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack ./ray ./vector".split(" "),function(n,a,d,l,k,e,c,h,m,f,b,g,p){function t(a){return a?
{radius:a.radius,center:m.vec3f64.clone(a.center)}:{radius:1,center:m.vec3f64.create()}}function u(a,b){void 0===b&&(b=t());return r(a.radius,a.center,b)}function r(a,b,c){void 0===c&&(c=t());h.vec3.copy(c.center,b);c.radius=a;return c}function q(a,c,d){var e=h.vec3.subtract(b.sv3d.get(),c.origin,a.center),f=h.vec3.dot(c.direction,c.direction),g=2*h.vec3.dot(c.direction,e);a=h.vec3.dot(e,e)-a.radius*a.radius;a=g*g-4*f*a;if(0>a)return!1;e=Math.sqrt(a);a=(-g-e)/(2*f);f=(-g+e)/(2*f);if(0>a||f<a&&0<f)a=
f;if(0>a)return!1;d&&h.vec3.add(d,c.origin,h.vec3.scale(b.sv3d.get(),c.direction,a));return!0}function v(a,d,e){var f=b.sv3d.get(),g=b.sm4d.get();h.vec3.cross(f,d.origin,d.direction);h.vec3.cross(e,f,d.origin);h.vec3.scale(e,e,1/h.vec3.length(e)*a.radius);a=z(a,d.origin);d=p.angle(d.origin,e);c.mat4.identity(g);c.mat4.rotate(g,g,d+a,f);h.vec3.transformMat4(e,e,g);return e}function w(a,c,d){c=h.vec3.subtract(b.sv3d.get(),c,a.center);c=h.vec3.scale(b.sv3d.get(),c,a.radius/h.vec3.length(c));return h.vec3.add(d,
c,a.center)}function z(a,c){c=h.vec3.subtract(b.sv3d.get(),c,a.center);c=h.vec3.length(c);return k.acosClamped(a.radius/(a.radius+Math.abs(a.radius-c)))}function x(a,b,c,e){a=h.vec3.subtract(C,b,a.center);switch(c){case 0:return a=f.cartesianToSpherical(a,C),a=a[2],h.vec3.set(e,-Math.sin(a),Math.cos(a),0);case 1:return a=f.cartesianToSpherical(a,C),c=a[1],a=a[2],b=Math.sin(c),h.vec3.set(e,-b*Math.cos(a),-b*Math.sin(a),Math.cos(c));case 2:return h.vec3.normalize(e,a);default:d.neverReached(c)}}function B(a,
b){b=h.vec3.subtract(H,b,a.center);return h.vec3.length(b)-a.radius}Object.defineProperty(a,"__esModule",{value:!0});a.setAltitudeAt=a.altitudeAt=a.axisAt=a.angleToSilhouette=a.distanceToSilhouette=a.projectPoint=a.closestPoint=a.closestPointOnSilhouette=a.intersectRayClosestSilhouette=a.intersectsRay=a.intersectScreen=a.intersectRay=a.setExtent=a.elevate=a.fromValues=a.copy=a.wrap=a.create=void 0;var A=l.getLogger("esri.views.3d.support.geometryUtils.sphere");a.create=t;a.wrap=function(a,b){var c=
E.get();c.radius=a;c.center=b||F;return c};a.copy=u;a.fromValues=r;a.elevate=function(a,b,c){a!==c&&h.vec3.copy(c.center,a.center);c.radius=a.radius+b;return c};a.setExtent=function(a,b,c){A.error("sphere.setExtent is not yet supported");return a===c?c:u(a,c)};a.intersectRay=q;a.intersectScreen=function(a,b,c,d){b=g.fromScreenAtEye(b,c,G);return q(a,b,d)};a.intersectsRay=function(a,b){return q(a,b,null)};a.intersectRayClosestSilhouette=function(a,c,d){if(q(a,c,d))return d;a=v(a,c,b.sv3d.get());h.vec3.add(d,
c.origin,h.vec3.scale(b.sv3d.get(),c.direction,h.vec3.distance(c.origin,a)/h.vec3.length(c.direction)));return d};a.closestPointOnSilhouette=v;a.closestPoint=function(a,b,c){if(q(a,b,c))return c;g.closestPoint(b,a.center,c);return w(a,c,c)};a.projectPoint=w;a.distanceToSilhouette=function(a,c){c=h.vec3.subtract(b.sv3d.get(),c,a.center);c=h.vec3.squaredLength(c);return Math.sqrt(Math.abs(c-a.radius*a.radius))};a.angleToSilhouette=z;var C=m.vec3f64.create();a.axisAt=x;a.altitudeAt=B;a.setAltitudeAt=
function(a,b,c,d){var e=B(a,b);a=x(a,b,2,H);c=h.vec3.scale(H,a,c-e);h.vec3.add(d,b,c);return d};var E=new e.ObjectStack(function(){return{center:null,radius:0}}),G=g.create(),F=m.vec3f64.create(),H=m.vec3f64.create();Object.freeze(F)})},"esri/views/3d/support/geometryUtils/triangle":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack ./lineSegment".split(" "),
function(n,a,d,l,k,e,c,h){function m(a){return a?{p0:e.vec3f64.clone(a.p0),p1:e.vec3f64.clone(a.p1),p2:e.vec3f64.clone(a.p2)}:{p0:e.vec3f64.create(),p1:e.vec3f64.create(),p2:e.vec3f64.create()}}function f(a,b,c,d){void 0===d&&(d=m());k.vec3.copy(d.p0,a);k.vec3.copy(d.p1,b);k.vec3.copy(d.p2,c);return d}function b(a,b,c){var d=l.vec2.distance(a,b);b=l.vec2.distance(b,c);a=l.vec2.distance(c,a);c=(d+b+a)/2;d=c*(c-d)*(c-b)*(c-a);return 0>=d?0:Math.sqrt(d)}Object.defineProperty(a,"__esModule",{value:!0});
a.areaPoints3d=a.area2d=a.areaPoints2d=a.intersectRay=a.distance2=a.fromValues=a.copy=a.wrap=a.create=void 0;a.create=m;a.wrap=function(a,b,c){var d=p.get();d.p0=a;d.p1=b;d.p2=c;return d};a.copy=function(a,b){void 0===b&&(b=m());return f(a.p0,a.p1,a.p2,b)};a.fromValues=f;a.distance2=function(a,b){var d=a.p0,e=a.p1;a=a.p2;var f=k.vec3.subtract(c.sv3d.get(),e,d),m=k.vec3.subtract(c.sv3d.get(),a,e),p=k.vec3.subtract(c.sv3d.get(),d,a),r=k.vec3.subtract(c.sv3d.get(),b,d),t=k.vec3.subtract(c.sv3d.get(),
b,e),u=k.vec3.subtract(c.sv3d.get(),b,a),l=k.vec3.cross(f,f,p),q=k.vec3.dot(k.vec3.cross(c.sv3d.get(),f,l),r),t=k.vec3.dot(k.vec3.cross(c.sv3d.get(),m,l),t),u=k.vec3.dot(k.vec3.cross(c.sv3d.get(),p,l),u);if(0<q&&0<t&&0<u)return b=k.vec3.dot(l,r),b*b/k.vec3.dot(l,l);d=h.distance2(h.fromValues(d,f,g.get()),b);e=h.distance2(h.fromValues(e,m,g.get()),b);b=h.distance2(h.fromValues(a,p,g.get()),b);return Math.min(d,e,b)};a.intersectRay=function(a,b,c){var d=b.direction;b=b.origin;var e=a.p0,f=a.p1,g=a.p2,
h=f[0]-e[0],m=f[1]-e[1],p=f[2]-e[2],f=g[0]-e[0];a=g[1]-e[1];var g=g[2]-e[2],r=d[1]*g-a*d[2],t=d[2]*f-g*d[0],u=d[0]*a-f*d[1],l=h*r+m*t+p*u;if(-1E-5<l&&1E-5>l)return!1;var l=1/l,q=b[0]-e[0],v=b[1]-e[1],e=b[2]-e[2],r=l*(q*r+v*t+e*u);if(0>r||1<r)return!1;t=v*p-m*e;p=e*h-p*q;h=q*m-h*v;m=l*(d[0]*t+d[1]*p+d[2]*h);if(0>m||1<r+m)return!1;c&&(k.vec3.scale(c,d,l*(f*t+a*p+g*h)),k.vec3.add(c,b,c));return!0};a.areaPoints2d=b;a.area2d=function(a){return b(a.p0,a.p1,a.p2)};a.areaPoints3d=function(a,b,c){k.vec3.subtract(t,
b,a);k.vec3.subtract(u,c,a);return k.vec3.length(k.vec3.cross(t,t,u))/2};var g=new d.ObjectStack(h.create),p=new d.ObjectStack(function(){return{p0:null,p1:null,p2:null}}),t=e.vec3f64.create(),u=e.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require","exports","./geometryDataUtils","./Util"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.GeometryData=void 0;n=function(){function a(d,c,h){void 0===c&&(c=a.DefaultIndices);void 0===h&&(h=
"triangle");this.initialize(d,c,h)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"indexCount",{get:function(){var a=l.getFirstObjectValue(this._indices);return null==
a?0:a.length},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!1,configurable:!0});a.prototype.getVertexAttr=function(){return this.vertexAttributes};a.prototype.initialize=function(e,c,h){void 0===c&&(c=a.DefaultIndices);void 0===h&&(h="triangle");var m={},f;for(f in e){var b=e[f],g=b.size;m[f]={data:b.data,size:g,offsetIdx:0,strideIdx:g}}if(c===a.DefaultIndices){c=l.getFirstObjectValue(m);c=null==c?0:c.data.length/
c.size;e=d.generateDefaultIndexArray(c);c={};for(var k in m)c[k]=e}this._id=d.getNewId();this._vertexAttributes=m;this._indices=c;this._primitiveType=h};a.prototype.toRenderData=function(){return{id:this._id.toString(),indices:this._indices,vertexAttr:this._vertexAttributes}};a.prototype.getIndices=function(a){return this._indices[a]};a.prototype.getAttribute=function(a){return this._vertexAttributes[a]};a.prototype.estimateGpuMemoryUsage=function(){var a=0;this._indices[l.VertexAttrConstants.POSITION]&&
(a+=12*this._indices[l.VertexAttrConstants.POSITION].length);this._indices[l.VertexAttrConstants.NORMAL]&&(a+=12*this._indices[l.VertexAttrConstants.NORMAL].length);this._indices[l.VertexAttrConstants.UV0]&&(a+=8*this._indices[l.VertexAttrConstants.UV0].length);this._indices[l.VertexAttrConstants.COLOR]&&(a+=4*this._indices[l.VertexAttrConstants.COLOR].length);return a};a.DefaultIndices={};return a}();a.GeometryData=n})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../../support/geometryUtils/triangle"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.getNewId=a.computeAttachmentOriginLines=a.computeAttachmentOriginPoints=a.computeAttachmentOriginTriangles=a.generateDefaultIndexArray=void 0;var e=1,c=null,h=new Uint32Array([0]);a.generateDefaultIndexArray=function(a){if(1===a)return h;if(a>e||null==c){for(;a>e;)e*=2;c=new Uint32Array(e);for(var b=
0;b<e;b++)c[b]=b}return new Uint32Array(c.buffer,0,a)};a.computeAttachmentOriginTriangles=function(a,c,e){if(!a)return!1;var h=a.strideIdx,m=a.offsetIdx;a=a.data;d.vec3.set(e,0,0,0);d.vec3.set(p,0,0,0);for(var r=0,t=0,u=0;u<c.length-2;u+=3){var l=c[u+0]*h+m,A=c[u+1]*h+m,C=c[u+2]*h+m;d.vec3.set(f,a[l+0],a[l+1],a[l+2]);d.vec3.set(b,a[A+0],a[A+1],a[A+2]);d.vec3.set(g,a[C+0],a[C+1],a[C+2]);(l=k.areaPoints3d(f,b,g))?(d.vec3.add(f,f,b),d.vec3.add(f,f,g),d.vec3.scale(f,f,1/3*l),d.vec3.add(e,e,f),r+=l):(d.vec3.add(p,
p,f),d.vec3.add(p,p,b),d.vec3.add(p,p,g),t+=3)}return 0===t&&0===r?!1:0!==r?(d.vec3.scale(e,e,1/r),!0):0!==t?(d.vec3.scale(e,p,1/t),!0):!1};a.computeAttachmentOriginPoints=function(a,b,c){if(!a||!b)return!1;var e=a.strideIdx,f=a.offsetIdx;a=a.data;d.vec3.set(c,0,0,0);for(var g=-1,h=0,m=0;m<b.length;m++){var k=b[m]*e+f;g!==k&&(c[0]+=a[k+0],c[1]+=a[k+1],c[2]+=a[k+2],h++);g=k}1<h&&d.vec3.scale(c,c,1/h);return 0<h};a.computeAttachmentOriginLines=function(a,c,e,g){if(!a)return!1;var h=a.strideIdx,m=a.offsetIdx;
a=a.data;d.vec3.set(g,0,0,0);d.vec3.set(p,0,0,0);var k=0,r=0,t=c?c.length-1:a.length/h-1;e=t+(e?2:0);for(var u=0;u<e;u+=2){var l=u<t?u:t,q=u<t?u+1:0,l=(c?c[l]:l)*h+m,q=(c?c[q]:q)*h+m;f[0]=a[l+0];f[1]=a[l+1];f[2]=a[l+2];b[0]=a[q+0];b[1]=a[q+1];b[2]=a[q+2];d.vec3.scale(f,d.vec3.add(f,f,b),.5);q=d.vec3.dist(f,b);0<q?(d.vec3.add(g,g,d.vec3.scale(f,f,q)),k+=q):(d.vec3.add(p,p,f),r++)}return 0!==k?(d.vec3.scale(g,g,1/k),!0):0!==r?(d.vec3.scale(g,p,1/r),!0):!1};var m=0;a.getNewId=function(){return m++};
var f=l.vec3f64.create(),b=l.vec3f64.create(),g=l.vec3f64.create(),p=l.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/Util":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),function(n,a,d,l,k,e,c,h,m){function f(a,b){if(!a)throw b=
b||"assert",a=Error(b),a.stack&&console.log(a.stack),new r(b);}function b(a){for(var b in a)return b}function g(a,b){a[12]=b[0];a[13]=b[1];a[14]=b[2]}function p(a,b){void 0===b&&(b=0);for(var c=0,d=0;4>d;d++)c+=a[b+d]*v[d];return c}function t(a){return a-Math.floor(a)}Object.defineProperty(a,"__esModule",{value:!0});a.inverseProjectionInfo=a.unpackFloatRGBA=a.packFloatRGBA=a.fovd2fovy=a.fovd2fovx=a.fovy2fovd=a.fovx2fovd=a.fovy2fovx=a.fovx2fovy=a.isTranslationMatrix=a.createTranslationMatrix=a.getMatrixTranslation=
a.setMatrixTranslation3=a.setMatrixTranslation=a.logWithBase=a.objectEmpty=a.getFirstObjectValue=a.getFirstObjectKey=a.project=a.rayRay2D=a.rayBoxTest=a.rayTriangle3D=a.dec2hex=a.rgb2hex=a.hex2rgb=a.fallbackIfUndefined=a.encodeNormal=a.encodeInt16=a.verify=a.assert=a.VertexAttrConstants=a.AssertException=void 0;var u=m.vec4f64.create(),r=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};return a}();a.AssertException=r;a.VertexAttrConstants=
{POSITION:"position",NORMAL:"normal",UV0:"uv0",UVMAPSPACE:"uvMapSpace",MEANVERTEXPOSITION:"meanVertexPosition",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",BOUND1:"bound1",BOUND2:"bound2",BOUND3:"bound3",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",TANGENT:"tangent"};a.assert=f;a.verify=function(a,b){a||console.warn("Verify failed: "+(b||"")+"\n"+Error("verify").stack)};a.encodeInt16=function(a){return d.clamp(Math.round(32767*a),-32767,32767)};a.encodeNormal=function(a,b){var c=Math.abs(a[0]),d=Math.abs(a[1]),
e=1/(c+d+Math.abs(a[2])),f=Math.min(a[2]*e,0);b[0]=(0>a[0]?-1:1)*(c*e-f);b[1]=(0>a[1]?-1:1)*(d*e-f)};a.fallbackIfUndefined=function(a,b){return void 0===a?b:a};a.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};a.rgb2hex=function(a){var b=d.clamp(Math.round(255*a[0]),0,255),c=d.clamp(Math.round(255*a[1]),0,255);a=d.clamp(Math.round(255*a[2]),0,255);return"0x"+((b<<16)+(c<<8)+a).toString(16)};a.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-
a.length)+a};a.rayTriangle3D=function(a,b,d,e,f,g,h,m,k){void 0===k&&(k=c.vec3f64.create());var p=e[h]-d[g],r=e[h+1]-d[g+1],t=e[h+2]-d[g+2];e=f[m]-d[g];h=f[m+1]-d[g+1];f=f[m+2]-d[g+2];var u=b[1]*f-h*b[2],l=b[2]*e-f*b[0],q=b[0]*h-e*b[1];m=p*u+r*l+t*q;if(-1E-5<m&&1E-5>m)return!1;m=1/m;var v=a[0]-d[g],w=a[1]-d[g+1];a=a[2]-d[g+2];k[1]=m*(v*u+w*l+a*q);if(0>k[1]||1<k[1])return!1;d=w*t-r*a;a=a*p-t*v;p=v*r-p*w;k[2]=m*(b[0]*d+b[1]*a+b[2]*p);if(0>k[2]||1<k[1]+k[2])return!1;k[0]=m*(e*d+h*a+f*p);return!0};a.rayBoxTest=
function(a,b,c,d){var e,f=(c[0]-a[0])/b[0],g=(d[0]-a[0])/b[0];f>g&&(e=f,f=g,g=e);var h=(c[1]-a[1])/b[1],m=(d[1]-a[1])/b[1];h>m&&(e=h,h=m,m=e);if(f>m||h>g)return!1;h>f&&(f=h);m<g&&(g=m);c=(c[2]-a[2])/b[2];a=(d[2]-a[2])/b[2];c>a&&(e=c,c=a,a=e);if(f>a||c>g)return!1;a<g&&(g=a);return 0>g?!1:!0};a.rayRay2D=function(a,b,c,d,f,g){void 0===g&&(g=e.vec2f64.create());var h=(d[f]-c[f])*(b[0]-a[0])-(d[0]-c[0])*(b[f]-a[f]);if(0===h)return!1;c=((d[0]-c[0])*(a[f]-c[f])-(d[f]-c[f])*(a[0]-c[0]))/h;g[0]=a[0]+c*(b[0]-
a[0]);g[1]=a[f]+c*(b[f]-a[f]);return!0};a.project=function(a,b,c,d,e){e||(e=a);u[0]=a[0];u[1]=a[1];u[2]=a[2];u[3]=1;h.vec4.transformMat4(u,u,b);2<e.length&&(e[2]=-u[2]);h.vec4.transformMat4(u,u,c);f(0!==u[3]);e[0]=u[0]/u[3];e[1]=u[1]/u[3];e[2]=u[2]/u[3];e[0]=(.5*e[0]+.5)*d[2]+d[0];e[1]=(.5*e[1]+.5)*d[3]+d[1]};a.getFirstObjectKey=b;a.getFirstObjectValue=function(a){return a[b(a)]};a.objectEmpty=function(a){for(var b in a)return!1;return!0};a.logWithBase=function(a,b){return Math.log(a)/Math.log(b)};
a.setMatrixTranslation=g;a.setMatrixTranslation3=function(a,b,c,d){a[12]=b;a[13]=c;a[14]=d};a.getMatrixTranslation=function(a,b){void 0===b&&(b=c.vec3f64.create());b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.createTranslationMatrix=function(a,b){a=l.mat4.identity(a);g(a,b);return a};a.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};a.fovx2fovy=function(a,b,c){return 2*Math.atan(c*
Math.tan(.5*a)/b)};a.fovy2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/c)};a.fovx2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/b)};a.fovy2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/c)};a.fovd2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};a.fovd2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};a.packFloatRGBA=function(a,b,c){void 0===c&&(c=0);a=d.clamp(a,0,w);for(var e=
0;4>e;e++)b[c+e]=Math.floor(256*t(a*q[e]))};a.unpackFloatRGBA=p;var q=[1,256,65536,16777216],v=[1/256,1/65536,1/16777216,1/4294967296],w=p(new Uint8ClampedArray([255,255,255,255]));a.inverseProjectionInfo=function(a,b,c,d,e){0===a[11]?(d[0]=2/(b*a[0]),d[1]=2/(c*a[5]),d[2]=(1+a[12])/a[0],d[3]=(1+a[13])/a[5],k.vec2.set(e,0,1)):(d[0]=-2/(b*a[0]),d[1]=-2/(c*a[5]),d[2]=(1-a[8])/a[0],d[3]=(1-a[9])/a[5],k.vec2.set(e,1,0))}})},"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/maybe",
"../../core/typedArrayUtil"],function(n,a,d,l){return function(){function a(e,c,h,m,f){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=e;this._bufferType=c;this._usage=h;this._id=a._nextId++;this._glName=this._context.gl.createBuffer();d.isSome(e.instanceCounter)&&e.instanceCounter.increment(1,this);m&&this.setData(m,f)}a.createIndex=function(d,c,h,m){return new a(d,34963,c,h,m)};a.createVertex=function(d,c,h){return new a(d,
34962,c,h)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"usage",{get:function(){return this._usage},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"bufferType",{get:function(){return this._bufferType},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"indexType",{get:function(){return this._indexType},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!1,configurable:!0});a.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),d.isSome(this._context.instanceCounter)&&
this._context.instanceCounter.decrement(1,this),this._context=null)};a.prototype.setData=function(a,c){if(a){if("number"===typeof a){if(0>a&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&c)switch(this._indexType=c,this._size=a,c){case 5123:a*=2;break;case 5125:a*=4}}else c=a.byteLength,l.isUint16Array(a)&&(c/=2,this._indexType=5123),l.isUint32Array(a)&&(c/=4,this._indexType=5125),this._size=c;c=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);
this._context.gl.bufferData(this._bufferType,a,this._usage);this._context.bindVAO(c)}};a.prototype.setSubData=function(a,c,d,m){void 0===c&&(c=0);void 0===d&&(d=0);if(a){(0>c||c>=this._size)&&console.error("offset is out of range!");var e=c,b=d,g=m,h=a.byteLength;l.isUint16Array(a)&&(h/=2,e*=2,b*=2,g*=2);l.isUint32Array(a)&&(h/=4,e*=4,b*=4,g*=4);void 0===m&&(m=h-1);d>=m&&console.error("end must be bigger than start!");c+d-m>this._size&&console.error("An attempt to write beyond the end of the buffer!");
c=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);d=this._context.gl;a=ArrayBuffer.isView(a)?a.buffer:a;d.bufferSubData(this._bufferType,e,a.slice(b,g));this._context.bindVAO(c)}};a._nextId=0;return a}()})},"esri/views/webgl/Texture":function(){define(["require","exports","tslib","../../core/mathUtils","../../core/maybe"],function(n,a,d,l,k){return function(){function a(c,e,m){void 0===m&&(m=null);this._glName=this._context=null;this._id=-1;this._descriptor=
void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=c;this._descriptor=d.__assign({target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1},e);this._id=++a._nextId;k.isSome(c.instanceCounter)&&c.instanceCounter.increment(0,this);this.setData(m)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._descriptor},enumerable:!1,configurable:!0});a.prototype.dispose=function(){var a=this;if(this._context&&this._context.gl){if(this._glName){var d=this._context.gl;this._boundToUnits.forEach(function(c){a._context.bindTexture(null,c)});d.deleteTexture(this._glName);this._glName=null}k.isSome(this._context.instanceCounter)&&this._context.instanceCounter.decrement(0,this);this._context=null}};a.prototype.release=
function(){this.dispose()};a.prototype.resize=function(a,d){var c=this._descriptor;if(c.width!==a||c.height!==d)c.width=a,c.height=d,this.setData(null)};a.prototype.setData=function(c){if(this._context&&this._context.gl){var d=this._context.gl;this._glName||(this._glName=d.createTexture());void 0===c&&(c=null);null===c&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);var e=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var f=
this._descriptor;a._validateTexture(f);d.pixelStorei(d.UNPACK_ALIGNMENT,f.unpackAlignment);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,f.flipped?1:0);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f.preMultiplyAlpha?1:0);var b=f.pixelFormat,g=f.internalFormat?f.internalFormat:b;if(c instanceof ImageData||c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement){var p=c.width,t=c.height;c instanceof HTMLVideoElement&&(p=c.videoWidth,t=c.videoHeight);f.width&&f.height&&console.assert(p===
f.width&&t===f.height);d.texImage2D(d.TEXTURE_2D,0,g,b,f.dataType,c);f.hasMipmap&&this.generateMipmap();void 0===f.width&&(f.width=p);void 0===f.height&&(f.height=t)}else{null!=f.width&&null!=f.height||console.error("Width and height must be specified!");d.DEPTH24_STENCIL8&&g===d.DEPTH_STENCIL&&(g=d.DEPTH24_STENCIL8);var p=f.width,t=f.height,u=c;if(k.isSome(u)&&"type"in u&&"compressed"===u.type)for(b=Math.round(Math.log(Math.max(p,t))/Math.LN2)+1,f.hasMipmap=f.hasMipmap&&b===c.levels.length,u=0;;++u){d.compressedTexImage2D(d.TEXTURE_2D,
u,g,p,t,0,c.levels[Math.min(u,c.levels.length-1)]);if(1===p&&1===t||!f.hasMipmap)break;p=Math.max(1,p>>1);t=Math.max(1,t>>1)}else if(k.isSome(c))d.texImage2D(d.TEXTURE_2D,0,g,p,t,0,b,f.dataType,c),f.hasMipmap&&this.generateMipmap();else for(u=0;;++u){d.texImage2D(d.TEXTURE_2D,u,g,p,t,0,b,f.dataType,null);if(1===p&&1===t||!f.hasMipmap)break;p=Math.max(1,p>>1);t=Math.max(1,t>>1)}}a._applySamplingMode(d,this._descriptor);a._applyWrapMode(d,this._descriptor);a._applyAnisotropicFilteringParameters(this._context,
this._descriptor);this._context.bindTexture(e,0)}};a.prototype.updateData=function(a,d,e,f,b,g){g||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var c=this._context.gl,h=this._descriptor,m=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>d||0>e||f>h.width||b>h.height||d+f>h.width||e+b>h.height)&&console.error("An attempt to update out of bounds of the texture!");c.pixelStorei(c.UNPACK_ALIGNMENT,
h.unpackAlignment);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,h.flipped?1:0);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h.preMultiplyAlpha?1:0);g instanceof ImageData||g instanceof HTMLImageElement||g instanceof HTMLCanvasElement||g instanceof HTMLVideoElement?c.texSubImage2D(c.TEXTURE_2D,a,d,e,h.pixelFormat,h.dataType,g):c.texSubImage2D(c.TEXTURE_2D,a,d,e,f,b,h.pixelFormat,h.dataType,g);this._context.bindTexture(m,0)};a.prototype.generateMipmap=function(){var c=this._descriptor;c.hasMipmap||(this._samplingModeDirty=
c.hasMipmap=!0,a._validateTexture(c));9729===c.samplingMode?(this._samplingModeDirty=!0,c.samplingMode=9985):9728===c.samplingMode&&(this._samplingModeDirty=!0,c.samplingMode=9984);c=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var d=this._context.gl;d.generateMipmap(d.TEXTURE_2D);this._context.bindTexture(c,0)};a.prototype.setSamplingMode=function(c){c!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=c,a._validateTexture(this._descriptor),this._samplingModeDirty=
!0)};a.prototype.setWrapMode=function(c){c!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=c,a._validateTexture(this._descriptor),this._wrapModeDirty=!0)};a.prototype.applyChanges=function(){var c=this._context.gl,d=this._descriptor;this._samplingModeDirty&&(a._applySamplingMode(c,d),this._samplingModeDirty=!1);this._wrapModeDirty&&(a._applyWrapMode(c,d),this._wrapModeDirty=!1)};a.prototype.setBoundToUnit=function(a,d){d?this._boundToUnits.add(a):this._boundToUnits.delete(a)};a._validateTexture=
function(a){(0>a.width||0>a.height)&&console.error("Negative dimension parameters are not allowed!");l.isPowerOfTwo(a.width)&&l.isPowerOfTwo(a.height)||("number"===typeof a.wrapMode?33071!==a.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===a.wrapMode.s&&33071===a.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),a.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};a._applySamplingMode=
function(a,d){var c=d.samplingMode,e=d.samplingMode;if(9985===c||9987===c)c=9729,d.hasMipmap||(e=9729);else if(9984===c||9986===c)c=9728,d.hasMipmap||(e=9728);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,c);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e)};a._applyWrapMode=function(a,d){"number"===typeof d.wrapMode?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,d.wrapMode),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,d.wrapMode)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,d.wrapMode.s),
a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,d.wrapMode.t))};a._applyAnisotropicFilteringParameters=function(a,d){if(null!=d.maxAnisotropy){var c=a.capabilities.textureFilterAnisotropic;c&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,c.TEXTURE_MAX_ANISOTROPY,d.maxAnisotropy))}};a._nextId=0;return a}()})},"esri/views/webgl/Util":function(){define(["require","exports","tslib","../../core/compilerUtils","../../core/maybe"],function(n,a,d,l,k){function e(a){return a[0].stride}function c(a){switch(a){case 5126:return 4;
case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw l.neverReached(a),Error("Unknown data type");}}function h(a){switch(a){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;case 6408:return 4;case 34041:return 4;case 33325:return 2;case 33326:return 4;case 35898:return 4;case 33327:return 4;case 33328:return 8;case 34842:return 8;case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;
case 36168:return 1;default:l.neverReached(a)}return 0}function m(a){if(k.isNone(a))return 0;if("colorAttachment"in a)return a.glName?m(a.colorAttachment)+m(a.depthStencilAttachment):0;if("descriptor"in a)return a.glName?m(a.descriptor):0;var b=a.internalFormat||"pixelFormat"in a&&a.pixelFormat;if(!b)return 0;var c="hasMipmap"in a&&a.hasMipmap?1.3:1;a=a.width*a.height;return h(b)*a*c}Object.defineProperty(a,"__esModule",{value:!0});a.getGpuMemoryUsage=a.getBytesPerElementFormat=a.unbindVertexBufferLayout=
a.bindVertexBufferLayout=a.setBaseInstanceOffset=a.copyFramebufferToTexture=a.findAttribute=a.hasAttribute=a.addDescriptor=a.getTypedArrayConstructor=a.getBytesPerElement=a.getStride=a.vertexCount=void 0;a.vertexCount=function(a,b){return a.vertexBuffers[b].size/e(a.layout[b])};a.getStride=e;a.getBytesPerElement=c;a.getTypedArrayConstructor=function(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;
case 5125:return Uint32Array;case 5123:return Uint16Array;default:throw l.neverReached(a),Error("Unknown data type");}};a.addDescriptor=function(a,b,d,e,h,m){var g=c(e);if(0<a.length){var f=a[0].stride,k=f+g*d;a.forEach(function(a){return a.stride=k});a.push({name:b,count:d,type:e,offset:f,stride:k,normalized:h,divisor:m})}else a.push({name:b,count:d,type:e,offset:0,stride:g*d,normalized:h,divisor:m})};a.hasAttribute=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return!0;return!1};a.findAttribute=
function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return a[c];return null};a.copyFramebufferToTexture=function(a,b,c,d,e){void 0===e&&(e=0);var g=a.getBoundFramebufferObject(),f=a.getBoundTexture(0);a.bindFramebuffer(b);a.bindTexture(c,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,e,c.descriptor.pixelFormat,d[0],d[1],d[2],d[3],0);a.gl.flush();a.bindFramebuffer(g);a.bindTexture(f,0)};a.setBaseInstanceOffset=function(a,b){var c={},e;for(e in a)c[e]=a[e].map(function(a){return a.divisor?d.__assign(d.__assign({},
a),{baseInstance:b}):a});return c};a.bindVertexBufferLayout=function(a,b,c,d,e){var f=a.gl,g=a.capabilities.instancing;a.bindBuffer(c);for(a=0;a<d.length;a++){c=d[a];var h=b[c.name],m=(e?e:0+c.baseInstance?c.baseInstance:0)*c.stride;void 0===h&&console.error("There is no location for vertex attribute '"+c.name+"' defined.");c.baseInstance&&!c.divisor&&console.error("Vertex attribute '"+c.name+"' uses baseInstanceOffset without divisor.");if(4>=c.count)f.vertexAttribPointer(h,c.count,c.type,c.normalized,
c.stride,c.offset+m),f.enableVertexAttribArray(h),c.divisor&&0<c.divisor&&g&&g.vertexAttribDivisor(h,c.divisor);else if(9===c.count)for(var k=0;3>k;k++)f.vertexAttribPointer(h+k,3,c.type,c.normalized,c.stride,c.offset+12*k+m),f.enableVertexAttribArray(h+k),c.divisor&&0<c.divisor&&g&&g.vertexAttribDivisor(h+k,c.divisor);else if(16===c.count)for(k=0;4>k;k++)f.vertexAttribPointer(h+k,4,c.type,c.normalized,c.stride,c.offset+16*k+m),f.enableVertexAttribArray(h+k),c.divisor&&0<c.divisor&&g&&g.vertexAttribDivisor(h+
k,c.divisor);else console.error("Unsupported vertex attribute element count: "+c.count)}};a.unbindVertexBufferLayout=function(a,b,c,d){var e=a.gl,f=a.capabilities.instancing;a.bindBuffer(c);for(c=0;c<d.length;c++){var g=d[c],h=b[g.name];if(4>=g.count)e.disableVertexAttribArray(h),g.divisor&&0<g.divisor&&f&&f.vertexAttribDivisor(h,0);else if(9===g.count)for(var m=0;3>m;m++)e.disableVertexAttribArray(h+m),g.divisor&&0<g.divisor&&f&&f.vertexAttribDivisor(h+m,0);else if(16===g.count)for(m=0;4>m;m++)e.disableVertexAttribArray(h+
m),g.divisor&&0<g.divisor&&f&&f.vertexAttribDivisor(h+m,0);else console.error("Unsupported vertex attribute element count: "+g.count)}a.unbindBuffer(34962)};a.getBytesPerElementFormat=h;a.getGpuMemoryUsage=m})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","../../core/maybe","./Util"],function(n,a,d,l){return function(){function a(e,c,h,m,f){this._context=e;this._locations=c;this._layout=h;this._buffers=m;this._indexBuffer=f;this._glName=null;this._initialized=!1;this._id=
a._nextId++;d.isSome(e.instanceCounter)&&e.instanceCounter.increment(2,this)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"indexBuffer",{get:function(){return this._indexBuffer},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(c,d){return c+a._buffers[d].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"layout",{get:function(){return this._layout},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"locations",{get:function(){return this._locations},enumerable:!1,configurable:!0});a.prototype.dispose=
function(a){void 0===a&&(a=!0);if(this._context){var c=this._context.capabilities.vao;c&&this._glName&&(c.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(a){for(var e in this._buffers)this._buffers[e].dispose(),delete this._buffers[e];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}d.isSome(this._context.instanceCounter)&&this._context.instanceCounter.decrement(2,this);this._context=null}};a.prototype.initialize=
function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var c=a.createVertexArray();a.bindVertexArray(c);this._bindLayout();a.bindVertexArray(null);this._glName=c}this._initialized=!0}};a.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};a.prototype._bindLayout=function(){var a=this._buffers,c=!!this._context.capabilities.vao,d=this._layout,m=this._indexBuffer;a||
console.error("Vertex buffer dictionary is empty!");var f=this._context.gl,b;for(b in a){var g=a[b];g||console.error("Vertex buffer is uninitialized!");var k=d[b];k||console.error("Vertex element descriptor is empty!");l.bindVertexBufferLayout(this._context,this._locations,g,k)}m&&(c?f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,m.glName):this._context.bindBuffer(m))};a.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};a.prototype._unbindLayout=
function(){var a=this._buffers,c=this._layout;a||console.error("Vertex buffer dictionary is empty!");for(var d in a){var m=a[d];m||console.error("Vertex buffer is uninitialized!");l.unbindVertexBufferLayout(this._context,this._locations,m,c[d])}(a=this._indexBuffer)&&this._context.unbindBuffer(a.bufferType)};a._nextId=0;return a}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("require exports ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/geodesicConstants ./atmosphereUtils ./RealisticAtmosphereTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x){Object.defineProperty(a,"__esModule",{value:!0});a.RealisticAtmosphere=void 0;n=function(){function a(a,d){this._view=a;this.canRender=!0;this._skyslot=14;this._hazeSlot=15;this._renderData={texDepth:m.vec2f64.create(),cameraPosition:b.vec3f64.create(),projectionInverse:c.mat4f64.create(),viewInverse:c.mat4f64.create(),heightParameters:p.vec4f64.create(),atmosphereParameters1:p.vec4f64.create(),atmosphereParameters2:p.vec4f64.create(),atmosphereParameters3:b.vec3f64.create(),
invWavelength:B,invWavelengthScaled:A,radii:m.vec2f64.create(),scale:0,scaleDepth:C,lowerAlphaBlendBound:0,scaleOverScaleDepth:0,oneOverScaleDepth:0,scaleDepthBlue:E,oneOverScaleDepthBlue:F,scaleOverScaleDepthBlue:0,g:H,g2:H*H,miePhaseCoefficients:J,nearFar:m.vec2f64.create(),cameraHeight:0,cameraHeightSq:0,C:0,CSur:0,innerFadeDistance:0,altitudeFade:0};this._lowerElevationBoundRadius=0;this._lowerBoundEarthRadius=t.earthRadius;this._updateRadius(t.earthRadius);this._techniqueRepository=d;this._atmosphereTechniqueConfig=
new r.RealisticAtmosphereTechniqueConfiguration}a.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this._vao&&(this._vao.dispose(),this._vao=null)};a.prototype.when=function(){return l.resolve()};a.prototype.initializeRenderContext=function(a){var b=this;a=a.rctx;this._handles=new d;this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,
context:"ground"});this._handles.add(k.on(this._view,"basemapTerrain","elevation-change",function(a){return b._updateElevation(a)},function(){return b._updateElevation()}));this._handles.add(k.on(this._view,"basemapTerrain","elevation-bounds-change",function(){return b._updateVisibleElevationBounds()},function(){return b._updateVisibleElevationBounds()}));this._atmosphereTechniqueConfig.haze=!1;this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(r.RealisticAtmosphereTechnique,
this._atmosphereTechniqueConfig,this._atmosphereTechnique);this._atmosphereTechniqueConfig.haze=!0;this._atmosphereHazeTechnique=this._techniqueRepository.acquireAndReleaseExisting(r.RealisticAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereHazeTechnique);this._vao=this._createVertexArrayObject(a)};a.prototype.uninitializeRenderContext=function(){this.destroy()};a.prototype.render=function(a){if(a.slot!==this._hazeSlot&&a.slot!==this._skyslot||0!==a.pass)return!1;this._update(a.camera);
a.slot===this._skyslot&&this._renderSky(a);a.slot===this._hazeSlot&&this._renderHaze(a);return!0};a.prototype._renderSky=function(a){var b=a.rctx,c=this._atmosphereTechnique.program;b.bindProgram(c);this._atmosphereTechnique.bindPipelineState(b);c.setUniform3fv("atmosphereParameters3",this._renderData.atmosphereParameters3);this._renderCommon(c,a)};a.prototype._renderHaze=function(a){var b=this,c=a.rctx,d=a.offscreenRenderingHelper,e=this._atmosphereHazeTechnique.program;c.bindProgram(e);this._atmosphereHazeTechnique.bindPipelineState(c);
d.renderDepthDetached(function(){c.bindTexture(d.depthTexture,0);e.setUniform1i("depthTex",0);b._renderCommon(e,a)})};a.prototype._renderCommon=function(a,b){var c=b.rctx;a.setUniform3fv("invWavelength",this._renderData.invWavelength);a.setUniform3fv("invWavelengthScaled",this._renderData.invWavelengthScaled);b.scenelightingData.setLightDirectionUniform(a);a.setUniform4fv("heightParameters",this._renderData.heightParameters);a.setUniform3fv("cameraPosition",this._renderData.cameraPosition);a.setUniformMatrix4fv("projectionInverse",
this._renderData.projectionInverse);a.setUniformMatrix4fv("viewInverse",this._renderData.viewInverse);a.setUniform2fv("nearFar",this._renderData.nearFar);a.setUniform2fv("radii",this._renderData.radii);a.setUniform4fv("atmosphereParameters1",this._renderData.atmosphereParameters1);a.setUniform4fv("atmosphereParameters2",this._renderData.atmosphereParameters2);a.setUniform1f("innerFadeDistance",this._renderData.innerFadeDistance);a.setUniform1f("altitudeFade",this._renderData.altitudeFade);c.bindVAO(this._vao);
a.assertCompatibleVertexAttributeLocations(this._vao);c.drawArrays(5,0,4)};a.prototype._createVertexArrayObject=function(a){var b=I.createBuffer(4);b.position.setVec(0,[-1,-1]);b.position.setVec(1,[1,-1]);b.position.setVec(2,[-1,1]);b.position.setVec(3,[1,1]);b.uv0.setVec(0,[0,0]);b.uv0.setVec(1,[1,0]);b.uv0.setVec(2,[0,1]);b.uv0.setVec(3,[1,1]);return new x(a,w.Default3D,{geometry:q.glLayout(I)},{geometry:z.createVertex(a,35044,b.buffer)})};a.prototype._adjustRadiusForTesselation=function(a){return a*
Math.cos(Math.PI/Math.pow(2,4)/16)};a.prototype._updateElevation=function(a){a=a?a.tile:this._view.basemapTerrain.rootTiles[0];0===a.lij[0]&&(a=this._adjustRadiusForTesselation(t.earthRadius+a.elevationBounds[0]),a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds()))};a.prototype._updateVisibleElevationBounds=function(){var a=this._adjustRadiusForTesselation(t.earthRadius+this._view.basemapTerrain.elevationBounds.min);
(0>this._lowerBoundEarthRadius||a<this._lowerBoundEarthRadius)&&this._updateRadius(a)};a.prototype._updateRadius=function(a){this._lowerBoundEarthRadius=a;var b=a/10*10.25,c=1/(b-a),d=c/C,e=c/E,m=.3*(b-a)+a,k=this._renderData;g.vec4.set(k.atmosphereParameters1,c,C,d,G);g.vec4.set(k.atmosphereParameters2,H,E,e,F);f.vec3.set(k.atmosphereParameters3,H*H,J,m);h.vec2.set(k.radii,a,b);k.scale=c;k.lowerAlphaBlendBound=m;k.scaleOverScaleDepth=d;k.scaleOverScaleDepthBlue=e;b=u.INNER_ATMOSPHERE_DEPTH;k.innerFadeDistance=
2*Math.sqrt((2*a-b)*b)};a.prototype._update=function(a){a&&(this._renderData.cameraHeight=f.vec3.length(a.eye),this._renderData.cameraHeightSq=this._renderData.cameraHeight*this._renderData.cameraHeight,this._renderData.C=this._renderData.cameraHeightSq-this._renderData.radii[1]*this._renderData.radii[1],this._renderData.CSur=this._renderData.cameraHeightSq-this._renderData.radii[0]*this._renderData.radii[0],this._renderData.heightParameters=p.vec4f64.fromValues(this._renderData.cameraHeight,this._renderData.cameraHeightSq,
this._renderData.C,this._renderData.CSur),f.vec3.copy(this._renderData.cameraPosition,a.eye),e.mat4.invert(this._renderData.projectionInverse,a.projectionMatrix),e.mat4.invert(this._renderData.viewInverse,a.viewMatrix),h.vec2.set(this._renderData.nearFar,a.near,a.far),this._renderData.altitudeFade=u.computeInnerAltitudeFade(this._renderData.cameraHeight-this._lowerBoundEarthRadius))};a.isSupported=function(a){return a.rctx.capabilities.depthTexture};return a}();a.RealisticAtmosphere=n;a=.02*Math.PI;
n=.004*Math.PI;var B=b.vec3f64.fromValues(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),A=b.vec3f64.clone(B);f.vec3.scale(A,A,a);f.vec3.add(A,A,b.vec3f64.fromValues(n,n,n));var C=.25,E=.05,G=1/C,F=1/E,H=-.99999,J=(1-H*H)/(2+H*H)*1.5,I=v.newLayout().vec2f("position").vec2f("uv0")})},"esri/views/3d/environment/atmosphereUtils":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.INNER_ATMOSPHERE_DEPTH=a.computeInnerAltitudeFade=void 0;a.computeInnerAltitudeFade=
function(a){return Math.min(1,Math.max(0,(a-1E5)/9E5))};a.INNER_ATMOSPHERE_DEPTH=1E4})},"esri/views/3d/environment/RealisticAtmosphereTechnique":function(){define("require exports tslib ../environment/RealisticAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.RealisticAtmosphereTechniqueConfiguration=a.RealisticAtmosphereTechnique=void 0;e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype.initializeProgram=function(a){var c=b.shader.get().build({haze:this.configuration.haze});return new m(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),h.Default3D)};b.prototype.initializePipeline=function(){return this.configuration.haze?
f.makePipelineState({blending:f.separateBlendingParams(1,0,769,1),colorWrite:f.defaultColorWriteParams}):f.makePipelineState({blending:f.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:f.defaultColorWriteParams})};b.shader=new k.ReloadableShaderModule(l,function(){return new Promise(function(a,b){n(["../environment/RealisticAtmosphere.glsl"],a,b)})});return b}(e.ShaderTechnique);a.RealisticAtmosphereTechnique=e;e=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||
this;b.haze=!1;return b}d.__extends(b,a);d.__decorate([c.parameter()],b.prototype,"haze",void 0);return b}(c.ShaderTechniqueConfiguration);a.RealisticAtmosphereTechniqueConfiguration=e})},"esri/views/3d/environment/RealisticAtmosphere.glsl":function(){define("require exports tslib ../webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderModules/ShaderBuilder".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",
{value:!0});a.build=void 0;a.build=function(a){var H=new e.ShaderBuilder;H.attributes.add("position","vec2");H.attributes.add("uv0","vec2");H.varyings.add("worldRay","vec3");H.varyings.add("vtc","vec2");a.haze&&H.varyings.add("eyeDir","vec3");H.vertex.uniforms.add("projectionInverse","mat4");H.vertex.uniforms.add("viewInverse","mat4");H.vertex.code.add(k.glsl(h||(h=d.__makeTemplateObject(["\n    void main(void) {\n      vec3 posViewNear \x3d (projectionInverse * vec4(position, -1, 1)).xyz;\n\n      worldRay \x3d (viewInverse * vec4(posViewNear, 0)).xyz;\n      vtc \x3d uv0;\n\n      ",
"\n\n      gl_Position \x3d vec4(position, 1, 1);\n    }\n  "],["\n    void main(void) {\n      vec3 posViewNear \x3d (projectionInverse * vec4(position, -1, 1)).xyz;\n\n      worldRay \x3d (viewInverse * vec4(posViewNear, 0)).xyz;\n      vtc \x3d uv0;\n\n      ","\n\n      gl_Position \x3d vec4(position, 1, 1);\n    }\n  "])),a.haze?k.glsl(c||(c=d.__makeTemplateObject(["eyeDir \x3d posViewNear;"],["eyeDir \x3d posViewNear;"]))):""));H.fragment.uniforms.add("lightingMainDirection","vec3").add("invWavelength",
"vec3").add("invWavelengthScaled","vec3").add("radii","vec2").add("atmosphereParameters1","vec4").add("atmosphereParameters2","vec4").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4");a.haze?H.fragment.uniforms.add("depthTex","sampler2D"):H.fragment.uniforms.add("atmosphereParameters3","vec3").add("innerFadeDistance","float").add("altitudeFade","float");H.fragment.include(l.ColorConversion);H.fragment.code.add(k.glsl(m||(m=d.__makeTemplateObject(["\n  // Atmosphere\n  const float krESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\n  const float kmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\n\n  // The inner (planetary) radius\n  #define innerRadius radii[0]\n  // The outer (atmosphere) radius\n  #define outerRadius radii[1]\n\n  // Atmosphere parameters:\n\n  // shellScale:               1.0 / (outerRadius - innerRadius)\n  #define shellScale atmosphereParameters1.x\n\n  // shellDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  // scaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  #define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)\n\n  // scaleOverScaleDepth:      scale / shellDepth\n  // scaleOverScaleDepthBlue:  scale / scaleDepthBlue\n  #define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)\n\n  // oneOverScaleDepth:        1.0 / shellDepth\n  // oneOverScaleDepthBlue;    1.0 / scaleDepthBlue\n  #define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)\n  "],
["\n  // Atmosphere\n  const float krESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\n  const float kmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\n\n  // The inner (planetary) radius\n  #define innerRadius radii[0]\n  // The outer (atmosphere) radius\n  #define outerRadius radii[1]\n\n  // Atmosphere parameters:\n\n  // shellScale:               1.0 / (outerRadius - innerRadius)\n  #define shellScale atmosphereParameters1.x\n\n  // shellDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  // scaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  #define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)\n\n  // scaleOverScaleDepth:      scale / shellDepth\n  // scaleOverScaleDepthBlue:  scale / scaleDepthBlue\n  #define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)\n\n  // oneOverScaleDepth:        1.0 / shellDepth\n  // oneOverScaleDepthBlue;    1.0 / scaleDepthBlue\n  #define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)\n  "]))));
a.haze||H.fragment.code.add(k.glsl(f||(f=d.__makeTemplateObject(["\n      #define g atmosphereParameters2.x\n      #define gSq atmosphereParameters3.x\n      #define miePhaseCoefficients atmosphereParameters3.y\n      #define lowerAlphaBlendBound atmosphereParameters3.z\n    "],["\n      #define g atmosphereParameters2.x\n      #define gSq atmosphereParameters3.x\n      #define miePhaseCoefficients atmosphereParameters3.y\n      #define lowerAlphaBlendBound atmosphereParameters3.z\n    "]))));H.fragment.code.add(k.glsl(b||
(b=d.__makeTemplateObject(["\n  // The camera's current height\n  #define cameraHeight heightParameters[0]\n  // cameraHeight^2\n  #define cameraHeightSq heightParameters[1]\n  // cameraHeightSq - outerRadiusSq; // C \x3d ||o-c||^2 - r^2\n  #define C heightParameters[2]\n  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C \x3d ||o-c||^2 - r^2\n  #define CSur heightParameters[3]\n\n  ","\n    // Loop constants for integral approximation\n    const float samples \x3d 5.0;\n    const int maxSamples \x3d 5;\n\n    // ToneMapping operators\n    vec3 expTM(vec3 inputColor,float _exposure) {\n        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);\n    }\n\n    // Approximation for inner integral based on a radii ratio of 10.25:10\n    float scale(float _cos) {\n      float x \x3d 1.0 - _cos;\n      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));\n    }\n\n    void main() {\n      // Obtain ray from Camera\n      vec3 worldSpaceRay \x3d normalize(worldRay);\n\n      // Compute Atmosphere intersection; i.e. ray/sphere intersection\n      float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\n      float det \x3d B * B - 4.0 * C; // det \x3d B^2 - 4.0* C\n\n      // idealized sphere intersection to discard early some pixels\n      float detSur \x3d B * B - 4.0 * CSur; // det \x3d B^2 - 4.0* C\n\n      // the minimal sample start position:\n      // at the camera by default, on the earth radius surface if the camera is underground.\n      float minRayStart \x3d 0.0;\n  "],
["\n  // The camera's current height\n  #define cameraHeight heightParameters[0]\n  // cameraHeight^2\n  #define cameraHeightSq heightParameters[1]\n  // cameraHeightSq - outerRadiusSq; // C \x3d ||o-c||^2 - r^2\n  #define C heightParameters[2]\n  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C \x3d ||o-c||^2 - r^2\n  #define CSur heightParameters[3]\n\n  ","\n    // Loop constants for integral approximation\n    const float samples \x3d 5.0;\n    const int maxSamples \x3d 5;\n\n    // ToneMapping operators\n    vec3 expTM(vec3 inputColor,float _exposure) {\n        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);\n    }\n\n    // Approximation for inner integral based on a radii ratio of 10.25:10\n    float scale(float _cos) {\n      float x \x3d 1.0 - _cos;\n      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));\n    }\n\n    void main() {\n      // Obtain ray from Camera\n      vec3 worldSpaceRay \x3d normalize(worldRay);\n\n      // Compute Atmosphere intersection; i.e. ray/sphere intersection\n      float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\n      float det \x3d B * B - 4.0 * C; // det \x3d B^2 - 4.0* C\n\n      // idealized sphere intersection to discard early some pixels\n      float detSur \x3d B * B - 4.0 * CSur; // det \x3d B^2 - 4.0* C\n\n      // the minimal sample start position:\n      // at the camera by default, on the earth radius surface if the camera is underground.\n      float minRayStart \x3d 0.0;\n  "])),
a.haze?"// Camera HDR\n        const float exposure \x3d 1.5;\n        const vec3 oneOverGamma \x3d vec3(1.0); //Gamma \x3d 1.0":"const float exposure \x3d 2.0;\n        const vec3 oneOverGamma \x3d vec3(0.454545); // Gamma \x3d 2.2\n        vec3 reinhardTM(vec3 inputColor, float _exposure) {\n          vec3 intermediate \x3d inputColor * _exposure;\n          intermediate /\x3d ( 1.0 + intermediate );\n          return pow(intermediate, oneOverGamma);\n        }\n        "));a.haze||H.fragment.code.add(k.glsl(g||
(g=d.__makeTemplateObject(["\n      float surfaceBlend \x3d 0.0;\n      vec4 surfaceColor \x3d vec4(0.0);\n      if (detSur \x3e\x3d 0.0) {\n        float nearSurface \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\n        float farSurface \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n        if (nearSurface \x3d\x3d 0.0) {\n          minRayStart \x3d farSurface;\n        }\n\n        // Compute lighting at the point where the ray enters the earth surface\n        // Lighting computation is copied from the terrain shader.\n        vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurface;\n        float lightAngle \x3d dot(-lightingMainDirection, normalize(vPos));\n        float brightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));\n\n        // Make the surface transparent based on altitude\n        surfaceColor \x3d vec4(brightness, brightness, brightness, 1.0 - altitudeFade);\n\n        // Fade based on the distance the ray travels below the earth surface\n        float relDist \x3d (farSurface - nearSurface) / innerFadeDistance;\n\n        // early exit\n        if (relDist \x3e 1.0) {\n          gl_FragColor \x3d surfaceColor;\n          return;\n        }\n\n        surfaceBlend \x3d smoothstep(0.0, 1.0, relDist * relDist);\n      }\n    "],
["\n      float surfaceBlend \x3d 0.0;\n      vec4 surfaceColor \x3d vec4(0.0);\n      if (detSur \x3e\x3d 0.0) {\n        float nearSurface \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\n        float farSurface \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n        if (nearSurface \x3d\x3d 0.0) {\n          minRayStart \x3d farSurface;\n        }\n\n        // Compute lighting at the point where the ray enters the earth surface\n        // Lighting computation is copied from the terrain shader.\n        vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurface;\n        float lightAngle \x3d dot(-lightingMainDirection, normalize(vPos));\n        float brightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));\n\n        // Make the surface transparent based on altitude\n        surfaceColor \x3d vec4(brightness, brightness, brightness, 1.0 - altitudeFade);\n\n        // Fade based on the distance the ray travels below the earth surface\n        float relDist \x3d (farSurface - nearSurface) / innerFadeDistance;\n\n        // early exit\n        if (relDist \x3e 1.0) {\n          gl_FragColor \x3d surfaceColor;\n          return;\n        }\n\n        surfaceBlend \x3d smoothstep(0.0, 1.0, relDist * relDist);\n      }\n    "]))));
H.fragment.code.add(k.glsl(p||(p=d.__makeTemplateObject(["\n    if (det \x3e\x3d 0.0) {\n    ","\n    float rayStart \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n    ","\n\n    float scatterDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStart \x3c minRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStart \x3d minRayStart;\n      ","\n    }\n    ","\n    // Initialize the scattering loop variables\n    vec3 start \x3d cameraPosition + worldSpaceRay * rayStart;\n  "],
["\n    if (det \x3e\x3d 0.0) {\n    ","\n    float rayStart \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n    ","\n\n    float scatterDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStart \x3c minRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStart \x3d minRayStart;\n      ","\n    }\n    ","\n    // Initialize the scattering loop variables\n    vec3 start \x3d cameraPosition + worldSpaceRay * rayStart;\n  "])),
a.haze?"\n          float depthSample \x3d texture2D(depthTex, vtc).r;\n\n          float zNear \x3d nearFar[0];\n          float zFar \x3d nearFar[1];\n\n          // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n          float zNorm \x3d 2.0 * depthSample - 1.0;\n          float linDepth \x3d 2.0 * zNear * zFar /\n            (zFar + zNear - zNorm * (zFar - zNear));\n\n          float rayEnd;\n          float altitudeAlpha \x3d 1.0;\n\n          // find intersections with ground, but only between the near and far\n          // clipping planes.\n          if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\n            vec3 cameraSpaceRay \x3d normalize(eyeDir);\n            cameraSpaceRay /\x3d cameraSpaceRay.z;\n            cameraSpaceRay *\x3d linDepth;\n\n            float cameraSpaceRayLength \x3d length(cameraSpaceRay);\n\n            vec3 world \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n            float worldRadiusSq \x3d dot(world, world);\n\n            // Handle tall structures:\n            // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n            float transitionStart \x3d innerRadius + 20000.0;\n            float transitionHeight \x3d 25000.0;\n            float transitionEnd \x3d transitionStart + transitionHeight;\n\n            float edge0 \x3d transitionStart * transitionStart;\n            float edge1 \x3d transitionEnd * transitionEnd;\n\n            altitudeAlpha \x3d 1.0 - clamp((worldRadiusSq - edge0) / (edge1 - edge0), 0.0, 1.0);\n            rayEnd \x3d cameraSpaceRayLength;\n\n            if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\n              float nearSurface \x3d 0.5 * ( -B - sqrt(detSur) );\n              float interp \x3d clamp(((cameraHeight - innerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n              rayEnd \x3d mix(cameraSpaceRayLength, nearSurface, interp);\n            }\n          }":
"",a.haze?"float near \x3d abs(rayStart);\n        float far \x3d abs(rayEnd);":"float rayEnd \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere",a.haze?"":"// clamp to value at inner radius altitude\n          scatterDistance \x3d shellScale * min(0.0, innerRadius - cameraHeight);",a.haze?"":"else { // outside atmosphere\n          scatterDistance \x3d -1.0;\n        }"));a.haze&&H.fragment.code.add(k.glsl(t||(t=d.__makeTemplateObject(["\n      vec3 end \x3d cameraPosition + worldSpaceRay * rayEnd;\n\n      float endLength \x3d length(end);\n      //altitudeStart, altitudeEnd\n      vec2 altitudeInterval \x3d vec2(length(start) - innerRadius, endLength - innerRadius);\n\n      // for camera positions below altitude 0, invert the altitudes, to achieve\n      // a similar haze as above ground. Note that there is a small but visible change\n      // when the camera passes altitude 0.\n      if (altitudeInterval.x \x3c 0.0) {\n        altitudeInterval \x3d -altitudeInterval;\n      }\n\n      // computed for the original end point to get consistent light angles after possible inversions\n      float lightAngle \x3d dot(-lightingMainDirection, end) / endLength;\n\n      if (near \x3e far)\n      {\n        if (altitudeInterval.x \x3c altitudeInterval.y)\n        {\n          // Switch positive slopes for flipped rays\n          end \x3d cameraPosition + worldSpaceRay * rayStart;\n          start \x3d cameraPosition + worldSpaceRay * rayEnd;\n          worldSpaceRay *\x3d -1.0;\n          float tmp \x3d altitudeInterval.x;\n          altitudeInterval.x \x3d altitudeInterval.y;\n          altitudeInterval.y \x3d tmp;\n        }\n        else if (altitudeInterval.x \x3d\x3d altitudeInterval.y)\n        { // create minuscule fake slope for integration if the slope is zero\n          altitudeInterval.x +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n          // slope for the camera function\n        }\n      }\n\n      // Calculate its scattering offset\n      // Assumes camera constrains of WSV 3.8\n      if (altitudeInterval.x \x3e outerRadius - innerRadius)\n      { // outside atmosphere\n        scatterDistance \x3d innerRadius - outerRadius;\n      } else\n      {\n        scatterDistance \x3d altitudeInterval.y - altitudeInterval.x;\n      }\n    "],
["\n      vec3 end \x3d cameraPosition + worldSpaceRay * rayEnd;\n\n      float endLength \x3d length(end);\n      //altitudeStart, altitudeEnd\n      vec2 altitudeInterval \x3d vec2(length(start) - innerRadius, endLength - innerRadius);\n\n      // for camera positions below altitude 0, invert the altitudes, to achieve\n      // a similar haze as above ground. Note that there is a small but visible change\n      // when the camera passes altitude 0.\n      if (altitudeInterval.x \x3c 0.0) {\n        altitudeInterval \x3d -altitudeInterval;\n      }\n\n      // computed for the original end point to get consistent light angles after possible inversions\n      float lightAngle \x3d dot(-lightingMainDirection, end) / endLength;\n\n      if (near \x3e far)\n      {\n        if (altitudeInterval.x \x3c altitudeInterval.y)\n        {\n          // Switch positive slopes for flipped rays\n          end \x3d cameraPosition + worldSpaceRay * rayStart;\n          start \x3d cameraPosition + worldSpaceRay * rayEnd;\n          worldSpaceRay *\x3d -1.0;\n          float tmp \x3d altitudeInterval.x;\n          altitudeInterval.x \x3d altitudeInterval.y;\n          altitudeInterval.y \x3d tmp;\n        }\n        else if (altitudeInterval.x \x3d\x3d altitudeInterval.y)\n        { // create minuscule fake slope for integration if the slope is zero\n          altitudeInterval.x +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n          // slope for the camera function\n        }\n      }\n\n      // Calculate its scattering offset\n      // Assumes camera constrains of WSV 3.8\n      if (altitudeInterval.x \x3e outerRadius - innerRadius)\n      { // outside atmosphere\n        scatterDistance \x3d innerRadius - outerRadius;\n      } else\n      {\n        scatterDistance \x3d altitudeInterval.y - altitudeInterval.x;\n      }\n    "]))));
H.fragment.code.add(k.glsl(u||(u=d.__makeTemplateObject(["\n    vec2 opticalStartDepth \x3d exp(scatterDistance * oneOverScaleDepth);\n\n    float rayLength \x3d rayEnd - rayStart;\n    float sampleLength \x3d rayLength / samples;\n    float scaledLength \x3d sampleLength * shellScale;\n    vec3 sampleRay \x3d worldSpaceRay * sampleLength;\n    vec3 samplePoint \x3d start + sampleRay * 0.5;\n  "],["\n    vec2 opticalStartDepth \x3d exp(scatterDistance * oneOverScaleDepth);\n\n    float rayLength \x3d rayEnd - rayStart;\n    float sampleLength \x3d rayLength / samples;\n    float scaledLength \x3d sampleLength * shellScale;\n    vec3 sampleRay \x3d worldSpaceRay * sampleLength;\n    vec3 samplePoint \x3d start + sampleRay * 0.5;\n  "]))));
a.haze?H.fragment.code.add(k.glsl(r||(r=d.__makeTemplateObject(["\n      float cameraAngle \x3d dot(-worldSpaceRay, end) / length(end);\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth;\n\n      float scaledValues \x3d scale(lightAngle) + scaleCameraAngle;\n      vec2 scaledValuesDepth \x3d scaledValues * shellDepth;\n    "],["\n      float cameraAngle \x3d dot(-worldSpaceRay, end) / length(end);\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth;\n\n      float scaledValues \x3d scale(lightAngle) + scaleCameraAngle;\n      vec2 scaledValuesDepth \x3d scaledValues * shellDepth;\n    "])))):
H.fragment.code.add(k.glsl(q||(q=d.__makeTemplateObject(["\n      float cameraAngle \x3d dot(worldSpaceRay, start / length(start));\n      float angleMultiplier \x3d cameraAngle \x3e 0.0 ? cameraAngle : 0.0;\n\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth * shellDepth;\n    "],["\n      float cameraAngle \x3d dot(worldSpaceRay, start / length(start));\n      float angleMultiplier \x3d cameraAngle \x3e 0.0 ? cameraAngle : 0.0;\n\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth * shellDepth;\n    "]))));
H.fragment.code.add(k.glsl(v||(v=d.__makeTemplateObject(["\n    // Loop variables\n    vec3 frontColor \x3d vec3(0.0);\n    vec3 frontColorBlue \x3d vec3(0.0);\n    vec3 attenuate \x3d vec3(0.0);\n    vec3 attenuateBlue \x3d vec3(0.0);\n\n    // Now loop through the sample rays\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\n      float height \x3d length(samplePoint);\n      float altitude \x3d abs(height - innerRadius);\n\n      vec2 depth \x3d exp(-altitude * scaleOverScaleDepth);\n  "],["\n    // Loop variables\n    vec3 frontColor \x3d vec3(0.0);\n    vec3 frontColorBlue \x3d vec3(0.0);\n    vec3 attenuate \x3d vec3(0.0);\n    vec3 attenuateBlue \x3d vec3(0.0);\n\n    // Now loop through the sample rays\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\n      float height \x3d length(samplePoint);\n      float altitude \x3d abs(height - innerRadius);\n\n      vec2 depth \x3d exp(-altitude * scaleOverScaleDepth);\n  "]))));
a.haze?H.fragment.code.add(k.glsl(w||(w=d.__makeTemplateObject(["\n      vec2 scatter \x3d depth * scaledValuesDepth - cameraOffset;\n    "],["\n      vec2 scatter \x3d depth * scaledValuesDepth - cameraOffset;\n    "])))):H.fragment.code.add(k.glsl(z||(z=d.__makeTemplateObject(["\n      float lightAngle \x3d dot(-lightingMainDirection, samplePoint) / height;\n      float cameraAngle \x3d dot(worldSpaceRay, samplePoint) / height;\n      float tmpScaledValues \x3d scale(lightAngle) - scale(cameraAngle);\n      vec2 scatter \x3d cameraOffset + tmpScaledValues * depth * shellDepth;\n    "],
["\n      float lightAngle \x3d dot(-lightingMainDirection, samplePoint) / height;\n      float cameraAngle \x3d dot(worldSpaceRay, samplePoint) / height;\n      float tmpScaledValues \x3d scale(lightAngle) - scale(cameraAngle);\n      vec2 scatter \x3d cameraOffset + tmpScaledValues * depth * shellDepth;\n    "]))));H.fragment.code.add(k.glsl(x||(x=d.__makeTemplateObject(["\n      attenuate \x3d exp(-scatter.x * invWavelengthScaled);\n      attenuateBlue \x3d exp(-scatter.y * invWavelengthScaled);\n\n      frontColor +\x3d attenuate * depth.x;\n      frontColorBlue +\x3d attenuateBlue * depth.y;\n\n      samplePoint +\x3d sampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\n    float LdotR \x3d clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);\n    float LdotRSq \x3d LdotR * LdotR + 1.0;\n  "],
["\n      attenuate \x3d exp(-scatter.x * invWavelengthScaled);\n      attenuateBlue \x3d exp(-scatter.y * invWavelengthScaled);\n\n      frontColor +\x3d attenuate * depth.x;\n      frontColorBlue +\x3d attenuateBlue * depth.y;\n\n      samplePoint +\x3d sampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\n    float LdotR \x3d clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);\n    float LdotRSq \x3d LdotR * LdotR + 1.0;\n  "]))));
a.haze?H.fragment.code.add(k.glsl(B||(B=d.__makeTemplateObject(["\n      // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n      vec3 colorCoefficients \x3d (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );\n\n      // Scaled Length is only applied afterwards to save multiplications\n      vec3 color \x3d colorCoefficients * frontColor;\n      vec3 colorBlue \x3d colorCoefficients * frontColorBlue;\n    "],["\n      // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n      vec3 colorCoefficients \x3d (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );\n\n      // Scaled Length is only applied afterwards to save multiplications\n      vec3 color \x3d colorCoefficients * frontColor;\n      vec3 colorBlue \x3d colorCoefficients * frontColorBlue;\n    "])))):
H.fragment.code.add(k.glsl(A||(A=d.__makeTemplateObject(["\n      vec3 rayleighCoefficients \x3d (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;\n      float mieCoefficients \x3d scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);\n\n      // Calculate the attenuation factor for the ground\n      vec3 color \x3d rayleighCoefficients * frontColor + mieCoefficients * frontColor;\n      vec3 colorBlue \x3d rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;\n    "],
["\n      vec3 rayleighCoefficients \x3d (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;\n      float mieCoefficients \x3d scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);\n\n      // Calculate the attenuation factor for the ground\n      vec3 color \x3d rayleighCoefficients * frontColor + mieCoefficients * frontColor;\n      vec3 colorBlue \x3d rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;\n    "]))));H.fragment.code.add(k.glsl(C||
(C=d.__makeTemplateObject(["\n    // HDR to LDR conversion\n    vec3 ldrBlue \x3d expTM(colorBlue, 2.0 * exposure);\n    vec3 ldrRed \x3d expTM(color, exposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR \x3d mix(ldrBlue, ldrRed, 0.2);\n  "],["\n    // HDR to LDR conversion\n    vec3 ldrBlue \x3d expTM(colorBlue, 2.0 * exposure);\n    vec3 ldrRed \x3d expTM(color, exposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR \x3d mix(ldrBlue, ldrRed, 0.2);\n  "]))));a.haze?
H.fragment.code.add(k.glsl(E||(E=d.__makeTemplateObject(["\n      LDR *\x3d (1.0 - cameraAngle);\n      vec3 hsv \x3d rgb2hsv(LDR);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost haze saturation by 50%\n      LDR \x3d hsv2rgb(hsv);\n      vec3 finalColor \x3d LDR;\n      // when rendering we specify the blend functions such that\n      // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\n    "],["\n      LDR *\x3d (1.0 - cameraAngle);\n      vec3 hsv \x3d rgb2hsv(LDR);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost haze saturation by 50%\n      LDR \x3d hsv2rgb(hsv);\n      vec3 finalColor \x3d LDR;\n      // when rendering we specify the blend functions such that\n      // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\n    "])))):
H.fragment.code.add(k.glsl(G||(G=d.__makeTemplateObject(["\n      // reinhard tonemapper for looking upwards\n      vec3 ldrReinhard \x3d reinhardTM(color, exposure);\n      LDR +\x3d angleMultiplier * ldrReinhard;\n\n      // height dependent parameter to smooth out reddish atmosphere\n      float side \x3d (rayEnd + rayStart) * 0.5;\n      float atmoHeight \x3d sqrt(cameraHeightSq - side * side);\n      float h2 \x3d clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);\n\n      vec3 finalColor \x3d LDR * h2;\n      vec3 hsv \x3d rgb2hsv(finalColor);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost sky saturation by 50%\n      finalColor \x3d hsv2rgb(hsv);\n    "],
["\n      // reinhard tonemapper for looking upwards\n      vec3 ldrReinhard \x3d reinhardTM(color, exposure);\n      LDR +\x3d angleMultiplier * ldrReinhard;\n\n      // height dependent parameter to smooth out reddish atmosphere\n      float side \x3d (rayEnd + rayStart) * 0.5;\n      float atmoHeight \x3d sqrt(cameraHeightSq - side * side);\n      float h2 \x3d clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);\n\n      vec3 finalColor \x3d LDR * h2;\n      vec3 hsv \x3d rgb2hsv(finalColor);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost sky saturation by 50%\n      finalColor \x3d hsv2rgb(hsv);\n    "]))));
H.fragment.code.add(k.glsl(F||(F=d.__makeTemplateObject(["\n    ","\n      } else { // Outside Atmosphere\n        gl_FragColor \x3d vec4(0.0);\n      }\n    }\n  "],["\n    ","\n      } else { // Outside Atmosphere\n        gl_FragColor \x3d vec4(0.0);\n      }\n    }\n  "])),a.haze?"gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;":"float atmosStrength \x3d clamp((length(ldrRed) - 0.05) * 1.05, 0.0, 1.0);\n          gl_FragColor \x3d vec4(finalColor, atmosStrength * clamp(1.0 - ( atmoHeight - innerRadius ) / (outerRadius - innerRadius), 0.0, 1.0));\n          if (surfaceBlend \x3e 0.0) {\n            gl_FragColor \x3d mix(gl_FragColor, surfaceColor, surfaceBlend);\n          }"));
return H};var c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.ColorConversion=void 0;a.ColorConversion=function(a){a.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    vec4 premultiplyAlpha(vec4 v) {\n      return vec4(v.rgb * v.a, v.a);\n    }\n\n    // Note: the min in the last line has been added to fix an instability in chrome.\n    // See https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/23911\n    // With proper floating point handling, the value could never be \x3e1.\n    vec3 rgb2hsv(vec3 c) {\n      vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n      vec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n      vec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n      float d \x3d q.x - min(q.w, q.y);\n      float e \x3d 1.0e-10;\n      return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n    }\n\n    vec3 hsv2rgb(vec3 c) {\n      vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n      vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n      return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n    }\n\n    float rgb2v(vec3 c) {\n      return max(c.x, max(c.y, c.z));\n    }\n  "],
["\n    vec4 premultiplyAlpha(vec4 v) {\n      return vec4(v.rgb * v.a, v.a);\n    }\n\n    // Note: the min in the last line has been added to fix an instability in chrome.\n    // See https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/23911\n    // With proper floating point handling, the value could never be \x3e1.\n    vec3 rgb2hsv(vec3 c) {\n      vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n      vec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n      vec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n      float d \x3d q.x - min(q.w, q.y);\n      float e \x3d 1.0e-10;\n      return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n    }\n\n    vec3 hsv2rgb(vec3 c) {\n      vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n      vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n      return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n    }\n\n    float rgb2v(vec3 c) {\n      return max(c.x, max(c.y, c.z));\n    }\n  "]))))};
var k})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("require exports ../../../core/Logger ../../../core/mathUtils ../../../core/mathUtils ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/geodesicConstants ./atmosphereUtils ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/imageUtils ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H){function J(a,b,c,d,e){var f=g.vec3.length(a),h=d*Math.sqrt(f*f-d*d)/f,m=e.silCircleV1,k=e.silCircleV2;g.vec3.scale(e.silCircleCenter,a,Math.sqrt(d*d-h*h)/f);g.vec3.cross(m,a,b);1>g.vec3.squaredLength(m)&&g.vec3.cross(m,a,c);g.vec3.scale(m,m,h/g.vec3.length(m));g.vec3.cross(k,m,a);g.vec3.scale(k,k,h/g.vec3.length(k));return h}function I(a,b,c,d){g.vec3.add(S,d.silCircleCenter,d.silCircleV2);g.vec3.scale(P,S,R);h.mat4.lookAt(N,b,S,c);
C.project(S,N,a.projectionMatrix,a.viewport);C.project(P,N,a.projectionMatrix,a.viewport);return g.vec3.distance(S,P)/a.height}var K=d.getLogger("esri.views.3d.environment.SimpleAtmosphere"),L=-u.INNER_ATMOSPHERE_DEPTH,M=(t.earthRadius+L)/t.earthRadius,Q=(t.earthRadius+0)/t.earthRadius,R=(t.earthRadius+3E5)/t.earthRadius,O=w.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);n=function(){function a(a,c){this.slot=14;this._renderData={texV:b.vec2f64.create(),silCircleCenter:p.vec3f64.create(),
silCircleV1:p.vec3f64.create(),silCircleV2:p.vec3f64.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this._readyResolver=e.createResolver();this._readyController=e.createAbortController();this._techniqueRepository=c;this._atmosphereTechniqueConfig=new r.SimpleAtmosphereTechniqueConfiguration;this.view=a}Object.defineProperty(a.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!1,configurable:!0});a.prototype.when=function(){return this._readyResolver.promise};
a.prototype.initializeRenderContext=function(a){var b=this,d=a.rctx;this._cameraChangeHandle=c.init(this.view,"state.camera",function(){return a.requestRender()},!0);this._atmosphereTechniqueConfig.geometry=0;this._atmosphereConeTechnique=this._techniqueRepository.acquireAndReleaseExisting(r.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereConeTechnique);this._atmosphereTechniqueConfig.geometry=2;this._atmosphereUndergroundTechnique=this._techniqueRepository.acquireAndReleaseExisting(r.SimpleAtmosphereTechnique,
this._atmosphereTechniqueConfig,this._atmosphereUndergroundTechnique);this._vao=this._createRibbon(d);this._vaoCount=F.vertexCount(this._vao,"geometry");this._fadeVao=A.createQuadVAO(d);this._fadeVaoCount=F.vertexCount(this._fadeVao,"geometry");v.requestImage(q,{signal:this._readyController.signal}).then(function(c){b._texture=new G(d,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},c);a.requestRender();b._readyController=null;b._readyResolver.resolve()}).catch(function(a){e.isAbortError(a)||
K.error("Unable to initialize simple atmosphere: image request failed",a);b._readyResolver.reject()})};a.prototype.uninitializeRenderContext=function(){this.destroy()};a.prototype.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null);this._texture&&(this._texture.dispose(),this._texture=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null);this._vao&&(this._vao.dispose(),this._vao=null);this._readyController&&
(this._readyController.abort(),this._readyController=null)};a.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass)return!1;this._update(a.camera);var b=a.rctx;this._atmosphereConeTechnique.bindPipelineState(b);if(1>this._renderData.undergroundFadeAlpha){var c=this._atmosphereConeTechnique.program;b.bindProgram(c);c.setUniformMatrix4fv("proj",a.camera.projectionMatrix);c.setUniformMatrix4fv("view",a.camera.viewMatrix);c.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);c.setUniform3fv("silCircleV1",
this._renderData.silCircleV1);c.setUniform3fv("silCircleV2",this._renderData.silCircleV2);c.setUniform2fv("texV",this._renderData.texV);b.bindTexture(this._texture,0);c.setUniform1i("tex",0);a.scenelightingData.setLightDirectionUniform(c);c.setUniform1f("altitudeFade",this._renderData.altitudeFade);c.setUniform1f("innerScale",this._renderData.innerScale);b.bindVAO(this._vao);b.drawArrays(4,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(c=this._atmosphereUndergroundTechnique.program,b.bindProgram(c),
c.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),a.scenelightingData.setLightDirectionUniform(c),c.setUniform3fv("cameraPosition",a.camera.eye),b.bindVAO(this._fadeVao),b.drawArrays(5,0,this._fadeVaoCount));return!0};a.prototype._update=function(a){var b=p.vec3f64.create(),c=t.earthRadius,d=g.vec3.length(a.eye),e=d-c;this._renderData.undergroundFadeAlpha=0>e?Math.min(-e/5E3,1):0;var h=c+L,m=c+Math.max(50,e);this._renderData.innerScale=m*m/(Math.sqrt(m*m-c*c)*Math.sqrt(m*
m-h*h)+c*h)-1;this._renderData.altitudeFade=u.computeInnerAltitudeFade(e);g.vec3.scale(b,a.eye,(c+50)/d);J(b,a.center,a.up,c,this._renderData);b=I(a,b,a.up,this._renderData);d=O(e);h=.001953125;m=0+b*d*1;50<e&&(J(a.eye,a.center,a.up,c,this._renderData),a=I(a,a.eye,a.up,this._renderData),a=l.clamp((a-1.5)/(b-1.5),0,1),h=0+.001953125*a,m=0+1*k.lerp(1,b*d,a));f.vec2.set(this._renderData.texV,h,m)};a.prototype._createRibbon=function(a){var b=new Float32Array(1155),c=new Uint32Array(1920);b[0]=0;b[1]=
0;b[2]=-1;for(var d=0;128>d;d++){var e=9*d+3;b[e+0]=d;b[e+1]=M;b[e+2]=-1;b[e+3]=d;b[e+4]=Q;b[e+5]=0;b[e+6]=d;b[e+7]=R;b[e+8]=1;var e=3*d+1,f=127===d?1:e+3,g=15*d;c[g+0]=e;c[g+1]=e+1;c[g+2]=f+1;c[g+3]=f+1;c[g+4]=f;c[g+5]=e;c[g+6]=e+1;c[g+7]=e+2;c[g+8]=f+2;c[g+9]=f+2;c[g+10]=f+1;c[g+11]=e+1;c[g+12]=e;c[g+13]=f;c[g+14]=0}e=U.createBuffer(c.length);f=e.position;for(d=0;d<c.length;++d)g=3*c[d],f.set(d,0,b[g]),f.set(d,1,b[g+1]),f.set(d,2,b[g+2]);return new H(a,B.Default3D,{geometry:z.glLayout(U)},{geometry:E.createVertex(a,
35044,e.buffer)})};return a}();var N=m.mat4f64.create(),S=p.vec3f64.create(),P=p.vec3f64.create(),U=x.newLayout().vec3f("position");return n})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.createEmptyDepthTexture=a.createColorTexture=a.createEmptyTexture=
a.createQuadVAO=void 0;a.createQuadVAO=function(a,e,f){void 0===e&&(e=l.Pos2);void 0===f&&(f=d.Default3D);var b=null;switch(e){case l.Pos2Tex:b=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;default:b=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new c(a,f,{geometry:e},{geometry:k.createVertex(a,35044,b)})};a.createEmptyTexture=function(a,c){void 0===c&&(c=4);return new e(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:c,height:c})};a.createColorTexture=function(a,
c,d){void 0===d&&(d=4);for(var b=new Uint8Array(d*d*4),f=0;f<b.length;f+=4)b[f+0]=255*c[0],b[f+1]=255*c[1],b[f+2]=255*c[2],b[f+3]=255*c[3];return new e(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:d,height:d},b)};a.createEmptyDepthTexture=function(a){return new e(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require","exports"],
function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.Pos2Tex=a.Pos2=a.Pos3Col=a.Pos3NormalTex=a.Pos3Tex=a.Pos3=void 0;a.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];a.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];a.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},
{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}];a.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];a.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];a.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/environment/Stars":function(){define("require exports tslib ../../../assets ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v){var w=c.getLogger("esri.views.3d.environment.Stars");n=function(){function a(a){this.slot=14;this.numBinaryFloats=2;this.numBinaryUInt8=1;this.bytesPerStar=9;this._loadDataController=m.createAbortController();this._numStars=0;this._modelMatrix=g.mat4f64.create();this._destroyed=!1;this.view=a;this._loadDataPromise=this._loadBrightStarCatalogue()}Object.defineProperty(a.prototype,"canRender",{get:function(){return null!=this._vao},enumerable:!1,configurable:!0});
a.prototype.destroy=function(){this._destroyed=!0;this._loadDataController&&(this._loadDataController.abort(),this._loadDataController=null);this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null);this._vao=h.disposeMaybe(this._vao);this._starsTechnique=h.disposeMaybe(this._starsTechnique)};a.prototype.initializeRenderContext=function(a){var b=this;this._initContext=a;var c=a.rctx;this._starsTechnique=new p.StarsTechnique({rctx:c,viewingMode:this.view.state.mode},null);this._dateHandle=
f.init(this.view,"environment.lighting.date",function(a){return b._update(a)});this._loadDataPromise.then(function(){if(!b._destroyed){b._numStars=b._starData.byteLength/b.bytesPerStar;var d=new Float32Array(b._starData,0,b._numStars*b.numBinaryFloats),e=new Uint8Array(b._starData,b._numStars*b.numBinaryFloats*4,b._numStars*b.numBinaryUInt8);b._vao=b._createVertexArrayObject(c,d,e);a.requestRender()}})};a.prototype.uninitializeRenderContext=function(){this.destroy()};a.prototype.render=function(a){if(a.slot!==
this.slot||0!==a.pass)return!1;var b=a.rctx,c=this._starsTechnique.program;b.bindProgram(c);this._starsTechnique.bindPass(b,{camera:a.camera,modelMatrix:this._modelMatrix});this._starsTechnique.bindPipelineState(b);b.bindVAO(this._vao);c.assertCompatibleVertexAttributeLocations(this._vao);b.drawArrays(0,0,this._numStars);return!0};a.prototype._computeDayDuration=function(a){var b=new Date(a.getFullYear(),0,1,11,58,56),c=new Date(a.getFullYear()+1,0,1,11,58,55);return(+a-+b)/(+c-+b)};a.prototype._update=
function(a){if(a){var c=a.getHours()/12,d=a.getMinutes()/60*(2/24),e=a.getSeconds()/60*(2/1440),c=(c+d+e-.9972222)%2;a=2*this._computeDayDuration(a);d=this._modelMatrix;b.mat4.copy(d,B);b.mat4.rotateZ(d,d,-a*Math.PI);b.mat4.multiply(d,x,d);b.mat4.rotateZ(d,d,-c*Math.PI);this._initContext.requestRender()}};a.prototype._hexToRGB=function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]};a.prototype._unpackUint8Attributes=function(a){return 192<=a?
[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]};a.prototype._createVertexArrayObject=function(a,b,c){for(var d=A.createBuffer(this._numStars),e=d.position,f=d.color,g=d.size,h=0;h<this._numStars;h++){var m=b[2*h+0],k=b[2*h+1];e.set(h,0,-Math.cos(m)*Math.sin(k));e.set(h,1,-Math.sin(m)*Math.sin(k));e.set(h,2,-Math.cos(k));m=this._unpackUint8Attributes(c[h]);k=this._hexToRGB(z[m[1]]);f.set(h,0,255*k[0]);f.set(h,1,255*k[1]);f.set(h,2,255*k[2]);f.set(h,
3,255);g.set(h,m[0])}return new v(a,r.Default3D,{geometry:t.glLayout(A)},{geometry:q.createVertex(a,35044,d.buffer)})};a.prototype._verifyStartData=function(a){if(!a)throw new e("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new e("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};a.prototype._loadBrightStarCatalogue=function(){return d.__awaiter(this,void 0,void 0,
function(){var a,b,c;return d.__generator(this,function(d){switch(d.label){case 0:return C?(this._starData=C,[2]):[4,k.result(l.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:this._loadDataController.signal}))];case 1:a=d.sent();this._loadDataController=null;if(!1===a.ok){if(m.isAbortError(a.error))throw a.error;w.error("loadBrightStarCatalogue",a.error.message);return[2]}b=a.value;c=b.data;try{this._verifyStartData(c)}catch(I){throw w.error("loadBrightStarCatalogue",
I),I;}this._starData=C=c;return[2]}})})};return a}();var z="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),x=g.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),B=g.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),A=u.newLayout().vec3f("position").vec4u8("color").f32("size"),
C=null;return n})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports tslib ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../environment/Stars.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState @dojo/framework/shim/Promise".split(" "),function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,
"__esModule",{value:!0});a.StarsTechnique=void 0;h=function(a){function h(){return null!==a&&a.apply(this,arguments)||this}d.__extends(h,a);h.prototype.initializeProgram=function(a){var b=h.shader.get().build();return new f(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),m.Default3D)};h.prototype.initializePipeline=function(){return b.makePipelineState({blending:b.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:b.defaultColorWriteParams})};h.prototype.bindPass=
function(a,b){a=b.camera;b=b.modelMatrix;var c=this.makeInfiniteProjectionMatrix(a.projectionMatrix,a.near,g);l.mat4.multiply(c,c,a.viewMatrix);l.mat4.multiply(c,c,b);this.program.setUniformMatrix4fv("transform",c);this.program.setUniform4fv("viewport",a.fullViewport);this.program.setUniform1f("pixelRatio",a.pixelRatio)};h.prototype.makeInfiniteProjectionMatrix=function(a,b,c){l.mat4.copy(c,a);c[10]=2.4E-7-1;c[11]=-1;c[14]=(2.4E-7-2)*b;return c};h.shader=new c.ReloadableShaderModule(e,function(){return new Promise(function(a,
b){n(["../environment/Stars.glsl"],a,b)})});return h}(h.ShaderTechnique);a.StarsTechnique=h;var g=k.mat4f64.create()})},"esri/views/3d/environment/Stars.glsl":function(){define("require exports tslib ../webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderModules/ShaderBuilder".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(){var a=new e.ShaderBuilder;a.attributes.add("position",
"vec3");a.attributes.add("color","vec4");a.attributes.add("size","float");a.varyings.add("vcolor","vec4");a.varyings.add("vsize","float");a.vertex.uniforms.add("transform","mat4").add("viewport","vec4").add("pixelRatio","float");a.include(l.AlignPixel);a.vertex.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n    void main(void) {\n      vec4 posProj \x3d transform * vec4(position, 0);\n      gl_Position \x3d alignToPixelCenter(posProj, viewport.zw);\n      vcolor \x3d color / 1.2;\n      vsize \x3d size * 5.0 * pixelRatio;\n      gl_PointSize \x3d vsize;\n    }\n  "],
["\n    void main(void) {\n      vec4 posProj \x3d transform * vec4(position, 0);\n      gl_Position \x3d alignToPixelCenter(posProj, viewport.zw);\n      vcolor \x3d color / 1.2;\n      vsize \x3d size * 5.0 * pixelRatio;\n      gl_PointSize \x3d vsize;\n    }\n  "]))));a.fragment.code.add(k.glsl(h||(h=d.__makeTemplateObject(["\n    void main() {\n      float cap \x3d 0.7;\n      float scale \x3d 1.0 / cap;\n      float helper \x3d clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);\n      float alpha \x3d clamp((cap - helper) * scale, 0.0, 1.0);\n      float intensity \x3d alpha * alpha * alpha;\n      if (vsize \x3c 3.0) {\n        intensity *\x3d 0.5;\n      }\n      gl_FragColor \x3d vec4(vcolor.xyz, intensity);\n    }\n  "],
["\n    void main() {\n      float cap \x3d 0.7;\n      float scale \x3d 1.0 / cap;\n      float helper \x3d clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);\n      float alpha \x3d clamp((cap - helper) * scale, 0.0, 1.0);\n      float intensity \x3d alpha * alpha * alpha;\n      if (vsize \x3c 3.0) {\n        intensity *\x3d 0.5;\n      }\n      gl_FragColor \x3d vec4(vcolor.xyz, intensity);\n    }\n  "]))));return a};var c,h})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.AlignPixel=void 0;a.AlignPixel=function(a){var c=l.glsl(k||(k=d.__makeTemplateObject(["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],
["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "]))),m=l.glsl(e||(e=d.__makeTemplateObject(["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],
["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "])));a.vertex.code.add(c);a.vertex.code.add(m);a.fragment.code.add(c);a.fragment.code.add(m)};var k,e})},"esri/views/3d/support/earthUtils":function(){define(["require",
"exports","../../../core/mathUtils","../../../geometry/Point","../../../geometry/support/geodesicConstants"],function(n,a,d,l,k){function e(a,c,e,b){var f,h;a instanceof l&&c instanceof l&&(e=c.longitude,b=c.latitude,h=a.latitude,f=a.longitude);a=d.deg2rad(h);b=d.deg2rad(b);f=d.deg2rad(f);c=d.deg2rad(e);e=Math.sin((a-b)/2);f=Math.sin((f-c)/2);e=2*d.asinClamped(Math.sqrt(e*e+Math.cos(a)*Math.cos(b)*f*f))*k.earthRadius;return Math.round(1E4*e)/1E4}function c(a,c){a/=15;c||(a=Math.round(a));return a}
Object.defineProperty(a,"__esModule",{value:!0});a.positionToTimezone=a.longitudeToTimezone=a.getMaxCameraAltitude=a.getLatDeltaForDistance=a.getLonDeltaForDistance=a.getGreatCircleSpanAt=a.getGreatCircleDistance=void 0;a.getGreatCircleDistance=e;a.getGreatCircleSpanAt=function(a,c,d){var b=c.spatialReference,f=new l(c.x,a.y,b),h=new l(d.x,a.y,b);c=new l(a.x,c.y,b);a=new l(a.x,d.y,b);return{lon:e(f,h),lat:e(c,a)}};a.getLonDeltaForDistance=function(a,c){c/=k.earthRadius;a=d.deg2rad(a);c=Math.sin(c/
2);a=Math.cos(a);a=2*d.asinClamped(Math.sqrt(c*c/(a*a)));return d.rad2deg(a)};a.getLatDeltaForDistance=function(a){return d.rad2deg(a/k.earthRadius)};a.getMaxCameraAltitude=function(a){a=d.deg2rad(a/2);return(1-Math.sin(a))*k.earthRadius/Math.sin(a)};a.longitudeToTimezone=c;a.positionToTimezone=function(a,d){d||(d={hours:0,minutes:0,seconds:0});d.hours=c(a[0],!0);a=d.hours%1;d.hours-=a;d.minutes=60*a;a=d.minutes%1;d.minutes-=a;d.seconds=Math.round(60*a);return d}})},"esri/views/3d/support/pointUtils":function(){define("require exports ../../../geometry ../../../core/maybe ../../../core/libs/gl-matrix-2/vec3f64 ./projectionUtils".split(" "),
function(n,a,d,l,k,e){function c(a,c){h[0]=a.x;h[1]=a.y;h[2]=a.hasZ?a.z:0;return e.vectorToWGS84ComparableLonLat(h,a.spatialReference,c)}Object.defineProperty(a,"__esModule",{value:!0});a.pointToWGS84ComparableLonLatPoint=a.pointToWGS84ComparableLonLat=a.pointToVector=a.pointToPoint=a.vectorToDehydratedPoint=a.vectorToPoint=void 0;a.vectorToPoint=function(a,c,b,g){g=l.isSome(g)?g:new d.Point({spatialReference:b});return e.bufferToBuffer(a,c,0,h,b,0,1)?(g.x=h[0],g.y=h[1],g.z=h[2],g.spatialReference=
b,g):null};a.vectorToDehydratedPoint=function(a,c,b,d){l.isNone(d)&&(d=b.spatialReference);return e.bufferToBuffer(a,c,0,h,d,0,1)?(b.x=h[0],b.y=h[1],b.z=h[2],b.spatialReference=d,b):null};a.pointToPoint=function(a,c,b,d){void 0===b&&(b=c.spatialReference);void 0===d&&(d=0);h[0]=a.x;h[1]=a.y;var f=a.z;h[2]=void 0!==f?f:d;if(!e.bufferToBuffer(h,a.spatialReference,0,h,b,0,1))return!1;c.x=h[0];c.y=h[1];c.spatialReference=b;void 0!==f?(c.z=h[2],c.hasZ=!0):(c.z=void 0,c.hasZ=!1);return!0};a.pointToVector=
function(a,c,b,d){void 0===d&&(d=0);h[0]=a.x;h[1]=a.y;var f=a.z;h[2]=void 0!==f?f:d;return e.bufferToBuffer(h,a.spatialReference,0,c,b,0,1)};a.pointToWGS84ComparableLonLat=c;a.pointToWGS84ComparableLonLatPoint=function(a,d){return c(a,h)?(d.x=h[0],d.y=h[1],d.z=h[2],!0):!1};var h=k.vec3f64.create()})},"esri/views/3d/support/sunUtils":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../lib/SunCalc".split(" "),
function(n,a,d,l,k,e,c,h){function m(a,b,c,d){for(var e=[],f=0;f<c.length;f++)e[f]=(d[f]-c[f])*a/b+c[f];return e}Object.defineProperty(a,"__esModule",{value:!0});a.computeShadowsEnabled=a.computeDirection=a.computeColorAndIntensity=a.settings=void 0;a.settings={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*
Math.PI,altitude:.6*Math.PI}}};a.computeColorAndIntensity=function(b,f){var k,p,l,t,w=f[2],z=g;e.vec3.set(z.ambient.color,1,1,1);z.ambient.intensity=a.settings.global.ambient;e.vec3.set(z.diffuse.color,1,1,1);z.diffuse.intensity=a.settings.global.diffuse;w=(Math.abs(w)-a.settings.local.altitude)/(a.settings.global.altitude-a.settings.local.altitude);w=d.clamp(w,0,1);z.globalFactor=w;f=h.getTimes(b,f[1],f[0]);if(1>w){l=b.valueOf();var x,B;f.polarException===h.POLAR_EXCEPTION.MIDNIGHT_SUN?(x=l-36E5*
(b.getHours()+48)-6E4*b.getMinutes(),B=x+432E6):f.polarException===h.POLAR_EXCEPTION.POLAR_NIGHT?(x=l-2,B=l-1):(x=f.sunrise.valueOf(),B=f.sunset.valueOf());var A=B-x;t=x+A/2;p=A/4;k=t-p;p=t+p;var C=.06*A,A=x-C/2;x+=C/2;var E=B-C/2,G=B+C/2;B=a.settings.local;var F=[.01,B.ambientAtNight],H=[.8,.8,1],J=[.01,.01,.01],I=[B.diffuseAtTwilight,B.ambientAtTwilight],K=[1,.75,.75],L=[.8,.8,1],M=[.9*B.diffuseAtNoon,B.ambientAtNoon],Q=[1,.98,.98],n=[.98,.98,1],O=[B.diffuseAtNoon,B.ambientAtNoon],N=[1,1,1],S=[1,
1,1];B=[0,0];var P=[0,0,0],C=[0,0,0];l<A||l>G?(B=F,P=J,C=H):l<x?(C=x-A,B=m(l-A,C,F,I),P=m(l-A,C,J,K),C=m(l-A,C,H,L)):l<k?(C=k-x,B=m(l-x,C,I,M),P=m(l-x,C,K,Q),C=m(l-x,C,L,n)):l<t?(C=t-k,B=m(l-k,C,M,O),P=m(l-k,C,Q,N),C=m(l-k,C,n,S)):l<p?(C=p-t,B=m(l-t,C,O,M),P=m(l-t,C,N,Q),C=m(l-t,C,S,n)):l<E?(C=E-p,B=m(l-p,C,M,I),P=m(l-p,C,Q,K),C=m(l-p,C,n,L)):l<G&&(C=G-E,B=m(l-E,C,I,F),P=m(l-E,C,K,J),C=m(l-E,C,L,H));l=B[0];t=c.vec3f64.fromValues(P[0],P[1],P[2]);k=B[1];p=c.vec3f64.fromValues(C[0],C[1],C[2]);e.vec3.lerp(z.ambient.color,
p,z.ambient.color,w);z.ambient.intensity=d.lerp(k,z.ambient.intensity,w);e.vec3.lerp(z.diffuse.color,t,z.diffuse.color,w);z.diffuse.intensity=d.lerp(l,z.diffuse.intensity,w)}w=b.valueOf();f.polarException===h.POLAR_EXCEPTION.MIDNIGHT_SUN?(b=w-36E5*(b.getHours()+48)-6E4*b.getMinutes(),f=b+432E6):f.polarException===h.POLAR_EXCEPTION.POLAR_NIGHT?(b=w-2,f=w-1):(b=f.sunrise.valueOf(),f=f.sunset.valueOf());b=1-d.clamp(Math.abs(w-(b+(f-b)/2))/432E5,0,1);z.noonFactor=b;return z};a.computeDirection=function(g,
m,k,r){r||(r=c.vec3f64.create());var p=b,t=l.mat4.identity(f);if("global"===k)h.getPosition(g,0,0,p),e.vec3.set(r,0,0,-1),l.mat4.rotateX(t,t,-p.azimuth),l.mat4.rotateY(t,t,-p.altitude);else{var u=a.settings.planarDirection;k=u.globalAngles;u=(Math.abs(m[2])-u.localAltitude)/(u.globalAltitude-u.localAltitude);u=d.clamp(u,0,1);1>u?(h.getPosition(g,m[1],m[0],p),p.azimuth=(1-u)*p.azimuth+u*k.azimuth,p.altitude=(1-u)*p.altitude+u*k.altitude):(p.azimuth=k.azimuth,p.altitude=k.altitude);e.vec3.set(r,0,-1,
0);l.mat4.rotateZ(t,t,-p.azimuth);l.mat4.rotateX(t,t,-p.altitude)}e.vec3.transformMat4(r,r,t);return r};a.computeShadowsEnabled=function(b,c){return"global"===c?!0:Math.abs(b[2])<a.settings.planarDirection.localAltitude};var f=k.mat4f64.create(),b={azimuth:0,altitude:0},g={ambient:{color:c.vec3f64.create(),intensity:0},diffuse:{color:c.vec3f64.create(),intensity:0,direction:c.vec3f64.create()},globalFactor:0,noonFactor:0}})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function n(a){return new Date(864E5*
(a+.5-2440588))}function a(a,c){return u(b(a)*g(w)-p(c)*b(w),g(a))}function d(a,c){return t(b(c)*g(w)+g(c)*b(w)*b(a))}function l(a,c,d){return u(b(a),g(a)*b(c)-p(d)*g(c))}function k(a,c,d){return t(b(c)*b(d)+g(c)*g(d)*g(a))}function e(a){return q*(1.9148*b(a)+.02*b(2*a)+3E-4*b(3*a))}function c(b,c){b=q*(357.5291+.98560028*b);var g=e(b);b=b+g+102.9372*q+f;c||(c={dec:0,ra:0});c.dec=d(b,0);c.ra=a(b,0);return c}function h(a,c,d){return 2451545+a+.0053*b(c)-.0069*b(2*d)}function m(c){var e=q*(134.963+
13.064993*c),f=q*(93.272+13.22935*c);c=q*(218.316+13.176396*c)+6.289*q*b(e);f=5.128*q*b(f);e=385001-20905*g(e);return{ra:a(c,f),dec:d(c,f),dist:e}}var f=Math.PI,b=Math.sin,g=Math.cos,p=Math.tan,t=Math.asin,u=Math.atan2,r=Math.acos,q=f/180,v={dec:0,ra:0},w=23.4397*q,z={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(a,b,d,e){d=q*-d;b*=q;var f=a.valueOf()/864E5-.5+2440588-2451545;a=c(f,v);d=q*(280.16+360.9856235*f)-d-a.ra;e||(e={azimuth:0,altitude:0});e.azimuth=l(d,b,a.dec);
e.altitude=k(d,b,a.dec);return e}},x=[[-.83,"sunrise","sunset"]];z.addTime=function(a,b,c){x.push([a,b,c])};z.getTimes=function(a,c,m){function k(a){var c=l,d=w;a=r((b(a)-b(c)*b(d))/(g(c)*g(d)));return h(9E-4+(a+p)/(2*f)+t,u,v)}var p=q*-m,l=q*c,t=Math.round(a.valueOf()/864E5-.5+2440588-2451545-9E-4-p/(2*f));a=9E-4+(0+p)/(2*f)+t;var u=q*(357.5291+.98560028*a);c=e(u);var v=u+c+102.9372*q+f,w=d(v,0);a=h(a,u,v);c={solarNoon:n(a),nadir:n(a-.5),polarException:z.POLAR_EXCEPTION.NORMAL};var B,A,C,R;m=0;for(B=
x.length;m<B;m+=1)A=x[m],C=k(A[0]*q),R=a-(C-a),c[A[1]]=n(R),c[A[2]]=n(C);c.polarException=function(a){a=(b(a)-b(l)*b(w))/(g(l)*g(w));return-1>a?z.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?z.POLAR_EXCEPTION.POLAR_NIGHT:z.POLAR_EXCEPTION.NORMAL}(x[0][0]*q);return c};z.getMoonPosition=function(a,b,c){c=q*-c;b*=q;var d=a.valueOf()/864E5-.5+2440588-2451545;a=m(d);c=q*(280.16+360.9856235*d)-c-a.ra;d=k(c,b,a.dec);d+=.017*q/p(d+10.26*q/(d+5.1*q));return{azimuth:l(c,b,a.dec),altitude:d,distance:a.dist}};z.getMoonFraction=
function(a){var d=a.valueOf()/864E5-.5+2440588-2451545;a=c(d);d=m(d);a=r(b(a.dec)*b(d.dec)+g(a.dec)*g(d.dec)*g(a.ra-d.ra));a=u(149598E3*b(a),d.dist-149598E3*g(a));return(1+g(a))/2};return z})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.SphericalHarmonicsLight=a.AmbientLight=a.FillLight=a.MainLight=void 0;n=function(){return function(a,k,e){void 0===
a&&(a=d.vec3f64.create());void 0===k&&(k=d.vec3f64.fromValues(.57735,.57735,.57735));void 0===e&&(e=!0);this.intensity=a;this.direction=k;this.castShadows=e}}();a.MainLight=n;n=function(){return function(a,k){void 0===a&&(a=d.vec3f64.create());void 0===k&&(k=d.vec3f64.fromValues(.57735,.57735,.57735));this.intensity=d.vec3f64.create();this.direction=d.vec3f64.create();this.intensity=a;this.direction=k}}();a.FillLight=n;n=function(){return function(a){void 0===a&&(a=d.vec3f64.create());this.intensity=
a}}();a.AmbientLight=n;n=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();a.SphericalHarmonicsLight=n})},"esri/views/3d/input/SceneInputManager":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G){n=function(a){function l(){var b=null!==a&&a.apply(this,arguments)||this;b._handles=new k;return b}d.__extends(l,a);l.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};Object.defineProperty(l.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",
a),this._updateMode())},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!1,configurable:!0});l.prototype.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};l.prototype.connect=function(){var a=
this,c=this.view;this._source=new w.BrowserEventSource(this.view.surface,c.input);var d=[new A.ImmediateDoubleClick,new C.PointerClickHoldAndDrag,new E.SingleAndDoubleClick,new B.Drag(this.view.navigation),new G.VerticalTwoFingerDrag];this._inputManager=d=new z.InputManager({eventSource:this._source,recognizers:d});d.installHandlers("prevent-context-menu",[new x.PreventContextMenu],z.ViewEventPriorities.INTERNAL);this._modeDragPan=new t.PinchAndPanNavigation(c,"primary");this._modeDragRotate=new m.DragRotate(c,
"secondary","center");this._modeDragZoom=new f.DragZoom(c,"tertiary");d.installHandlers("navigation",[new u.PointerDownCancelAnimation(c),new h.DoubleClickZoom(c),new b.GamepadNavigation(c),new g.KeyboardNavigation(c,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new p.MouseWheelZoom(c),new q.SingleKeyResetTilt(c,"p"),new r.SingleKeyResetHeading(c,"n"),new m.DragRotate(c,
"primary","eye",["b"]),new m.DragRotate(c,"secondary","center",["b"]),new t.PinchAndPanNavigation(c,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new v.TwoFingerTilt(c)],z.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(d);this._updateMode();e.init(this.view.navigation,"browserTouchPanEnabled",function(b){a._source.browserTouchPanningEnabled=!b})};l.prototype._updateMode=function(){var a=this.primaryDragAction,a=F.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=
a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};Object.defineProperty(l.prototype,"test",{get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}},enumerable:!1,configurable:!0});d.__decorate([c.property()],l.prototype,"view",void 0);d.__decorate([c.property({value:"pan"})],l.prototype,"primaryDragAction",null);d.__decorate([c.property({value:"default"})],
l.prototype,"mode",null);d.__decorate([c.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],l.prototype,"hasPendingInputs",void 0);d.__decorate([c.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],l.prototype,"latestPointerType",void 0);d.__decorate([c.property()],l.prototype,"_inputManager",void 0);return l=d.__decorate([c.subclass("esri.views.3d.input.SceneInputManager")],l)}(l);var F=new Map;a=new Map;l=new Map;a.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});
a.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});l.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});l.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});F.set("default",a);F.set("pro",l);return n})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports tslib ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.DoubleClickZoom=void 0;n=function(a){function c(b,c){var d=a.call(this,!0)||this;d.view=b;d.registerIncoming("double-click",c,function(a){return d.handleDoubleClick(a)});return d}d.__extends(c,a);c.prototype.handleDoubleClick=function(a){var b=a.data;if(h.eventMatchesPointerAction(b,"primary")){var c=this.view.state.isGlobal?new k.ZoomStepController({view:this.view,mode:"animation"}):new e.ZoomStepController({view:this.view,
mode:"animation"});this.view.state.switchCameraController(c);c.zoomStep(Math.log(.5)/Math.log(.6),l.createScreenPointArray(b.x,b.y));a.stopPropagation()}};return c}(c.InputHandler);a.DoubleClickZoom=n})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p){Object.defineProperty(a,"__esModule",{value:!0});a.ZoomStepController=void 0;n=function(a){function h(){var c=null!==a&&a.apply(this,arguments)||this;c.zoomLocation=e.vec3f64.create();c.tmpCamera=new b.default;c.tmpViewDir=e.vec3f64.create();c.targetOnSphere=e.vec3f64.create();c.tmpCenter=e.vec3f64.create();c.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new b.default,interactionDirection:null,tiltMode:0};c.sphere=
f.sphere.create();return c}d.__extends(h,a);h.prototype.initialize=function(){this.intersector=new g.Intersector(this.view.state.mode)};h.prototype.zoomStep=function(a,b){if(this.active){var c=this.view.state,d=this.constraintOptions.interactionStartCamera;this.animation.finished?d.copyFrom(c.camera):this.animation.cameraAt(1,d);d=!1;0<a&&this.intersectionHelper.intersectScreen(b,this.zoomLocation)&&(d=!0);this.tmpCamera.copyFrom(c.camera);d?this.intersectionHelper.intersectRay(this.tmpCamera.ray,
this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:k.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};h.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:p.outExpo}};h.prototype.updateCamera=function(a,b,d,e){this.sphere.radius=
k.vec3.length(d);k.vec3.subtract(this.tmpViewDir,a.center,a.eye);var g=k.vec3.length(this.tmpViewDir),h=g*b;1>=b&&4>h&&(h=4,b=h/g);1E-6>Math.abs(g-h)||(g=k.vec3.length(a.center),this.sphere.radius!==g&&k.vec3.scale(a.center,a.center,(this.sphere.radius+b*(g-this.sphere.radius))/g),k.vec3.scale(this.tmpViewDir,this.tmpViewDir,-b),k.vec3.add(a.eye,a.center,this.tmpViewDir),c.applyAll(this.view,a,this.constraintOptions),1E-12<k.vec3.squaredDistance(d,a.center)&&f.sphere.intersectScreen(this.sphere,a,
e,this.targetOnSphere)&&m.panToPosition(this.sphere,a,d,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0),c.applySurfaceCollisionConstraint(this.view,a))};return h=d.__decorate([l.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],h)}(h.PointToPointAnimationController);a.ZoomStepController=n})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p){Object.defineProperty(a,"__esModule",{value:!0});a.pixelDistanceToInteractionFactor=a.applyAll=void 0;Object.defineProperty(a,"applyTiltConstraint",{enumerable:!0,get:function(){return f.applyTiltConstraint}});Object.defineProperty(a,"getTiltConstraintError",{enumerable:!0,get:function(){return f.getTiltConstraintError}});Object.defineProperty(a,"applyAltitudeConstraint",{enumerable:!0,get:function(){return b.applyAltitudeConstraint}});Object.defineProperty(a,"getAltitudeConstraintError",
{enumerable:!0,get:function(){return b.getAltitudeConstraintError}});Object.defineProperty(a,"applyDistanceConstraint",{enumerable:!0,get:function(){return g.applyDistanceConstraint}});Object.defineProperty(a,"getDistanceConstraintError",{enumerable:!0,get:function(){return g.getDistanceConstraintError}});Object.defineProperty(a,"applySurfaceCollisionConstraint",{enumerable:!0,get:function(){return p.applySurfaceCollisionConstraint}});a.applyAll=function(a,b,d,e){void 0===d&&(d=u);void 0===e&&(e=
b);var f=!1;e!==b&&e.copyFrom(b);e.markViewDirty();e.computeUp(a.state.mode);for(b=0;b<r;b++){for(var g=0,h=0,m=t;h<m.length;h++){var p=m[h];if(k.hasConstraintType(d.selection,p.type)){var l=Math.abs(p.error(a,e,d));p.apply(a,e,d)&&(f=!0,g+=l)}}if(0===g)break}b=k.hasConstraintType(d.selection,8);a:switch(d.interactionType){case 4:d=1;break a;case 5:d=a.state.isGlobal?2:1;break a;default:d=0}b&&c.applySurfaceCollisionConstraint(a,e,d)&&(f=!0);f&&e.computeUp(a.state.mode);return f};a.pixelDistanceToInteractionFactor=
function(a,b){a="number"===typeof a?a:d.vec2.distance(a,b);return m.inOutCubic(Math.min(1,a/150))};var t=[{type:1,error:function(a,b,c){return h.getTiltConstraintError(a,b,c)*b.distance},apply:h.applyTiltConstraint},{type:2,error:l.getAltitudeConstraintError,apply:l.applyAltitudeConstraint},{type:4,error:e.getDistanceConstraintError,apply:e.applyDistanceConstraint}],u={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},r=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/intersectionUtils".split(" "),
function(n,a,d,l,k,e,c,h){function m(a,c,f){void 0===f&&(f=e.defaultApplyOptions);var g;g=a.state.constraints.altitude;g=a.state.isGlobal&&g?2===f.interactionType&&e.hasConstraintType(f.selection,1)?!1:!0:!1;if(!g)return 0;var h=a.state.constraints.altitude;g=b;g.min=h.min;g.max=h.max;var k=f.interactionType;if(0!==k){var h=g.min,p=g.max,r=f.interactionStartCamera;f=f.interactionFactor;var k=2===k||1===k,l=m(a,r),r=0===l?0:a.renderCoordsHelper.getAltitude(r.eye);g.min=h;g.max=p;e.adjustRangeForInteraction(l,
r,k,f,.05*r,g)}a=a.renderCoordsHelper.getAltitude(c.eye);a=d.clamp(a,g.min,g.max)-a;return 1E-6>=Math.abs(a)?0:a}function f(a,b,c,d){a.renderCoordsHelper.worldUpAtPosition(b.eye,d);l.vec3.scale(d,d,c);return d}Object.defineProperty(a,"__esModule",{value:!0});a.getAltitudeConstraintError=a.applyAltitudeConstraint=void 0;a.applyAltitudeConstraint=function(a,b,k){void 0===k&&(k=e.defaultApplyOptions);var r=m(a,b,k);if(0===r)return!1;var u=a.renderCoordsHelper,q=u.getAltitude(b.eye)+r;a=e.interactionDirectionTowardsConstraintMinimization(b,
k.interactionDirection,f(a,b,d.sign(r),p),g);k=l.vec3.copy(t,b.viewForward);u.intersectInfiniteManifold(c.ray.wrap(b.eye,a),q,b.eye)||u.setAltitude(q,b.eye);h.closestPointOnRay(b.eye,k,b.center,b.center);b.markViewDirty();return!0};a.getAltitudeConstraintError=m;var b={min:0,max:0},g=k.vec3f64.create(),p=k.vec3f64.create(),t=k.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3"],
function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.interactionDirectionTowardsConstraintMinimization=a.defaultApplyOptions=a.adjustRangeForInteraction=a.hasConstraintType=void 0;a.hasConstraintType=function(a,d){return 0!==(a&d)};a.adjustRangeForInteraction=function(a,d,c,h,m,f){0!==a&&(c?(f.min=Math.min(f.min,d),f.max=Math.max(f.max,d)):null!=h?(f.min-=Math.max(0,(d-f.min)*(1-h)),f.max+=Math.max(0,(d-f.max)*(1-h))):m&&(f.min-=Math.max(0,d-f.min-m),f.max+=Math.max(0,d-f.max-m)))};
a.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};a.interactionDirectionTowardsConstraintMinimization=function(a,e,c,h){e=e||a.viewForward;l.vec3.copy(h,e);l.vec3.scale(h,h,d.sign(l.vec3.dot(e,c)));return h}})},"esri/views/3d/support/intersectionUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./geometryUtils".split(" "),
function(n,a,d,l,k,e){function c(a,b,c,d){var e=m;a?(c&&d&&(e.len=l.vec3.distance(b,c)),l.vec3.copy(e.dir,a)):d?(e.len=l.vec3.distance(b,c),l.vec3.subtract(e.dir,c,b),l.vec3.scale(e.dir,e.dir,1/e.len)):(l.vec3.subtract(e.dir,c,b),l.vec3.normalize(e.dir,e.dir));return e}function h(a,b,c,d){d.clip[0]=0;d.clip[1]=c?d.len:Number.MAX_VALUE;for(c=0;c<a.length;c++){var f;var g=a[c],h=b;f=d;var m=l.vec3.dot(e.plane.normal(g),f.dir),g=-e.plane.signedDistance(g,h);0>g&&0<=m?f=!1:-1E-6<m&&1E-6>m?f=0<g:!(0>g||
0>m)||0>g&&0>m?(g/=m,0<m?g<f.clip[1]&&(f.clip[1]=g):g>f.clip[0]&&(f.clip[0]=g),f=f.clip[0]<=f.clip[1]):f=!0;if(!f)return!1}return!0}Object.defineProperty(a,"__esModule",{value:!0});a.closestPointOnRay=a.frustumLineSegment=a.frustumPoint=a.frustumRay=a.frustumSphere=a.planeSphere=void 0;a.planeSphere=function(a,b,c){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]<c};a.frustumSphere=function(a,b,c){var d=b[0],e=b[1];b=b[2];return a[0][0]*d+a[0][1]*e+a[0][2]*b+a[0][3]>c||a[1][0]*d+a[1][1]*e+a[1][2]*b+a[1][3]>
c||a[2][0]*d+a[2][1]*e+a[2][2]*b+a[2][3]>c||a[3][0]*d+a[3][1]*e+a[3][2]*b+a[3][3]>c||a[4][0]*d+a[4][1]*e+a[4][2]*b+a[4][3]>c||a[5][0]*d+a[5][1]*e+a[5][2]*b+a[5][3]>c?!1:!0};a.frustumRay=function(a,b,d,e){d=c(e,b,d,!1);return h(a,b,null,d)};a.frustumPoint=function(a,b){for(var c=0;6>c;c++)if(0<e.plane.signedDistance(a[c],b))return!1;return!0};a.frustumLineSegment=function(a,b,d,e){e=c(e,b,d,!0);return h(a,b,d,e)};a.closestPointOnRay=function(a,b,c,d){c=l.vec3.dot(b,l.vec3.subtract(d,c,a));l.vec3.add(d,
a,l.vec3.scale(d,b,c));return d};var m={dir:k.vec3f64.create(),len:0,clip:d.vec2f64.create()}})},"esri/views/3d/camera/constraintUtils/distance":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/mathUtils".split(" "),function(n,a,d,l,k,e,c){function h(a,b,c){void 0===c&&(c=k.defaultApplyOptions);if(!a.state.isLocal)return 0;var e=a.state.constraints.distance;if(!a.pointsOfInterest.surfaceOrigin.renderLocation||
Infinity===e)return 0;m.min=0;m.max=e;var e=m,f=c.interactionType;if(0!==f){var g=e.min,p=e.max,r=c.interactionStartCamera;c=c.interactionFactor;var f=1===f||4===f,l=h(a,r),r=0===l?0:d.vec3.distance(r.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);e.min=g;e.max=p;k.adjustRangeForInteraction(l,r,f,c,.05*r,e)}a=d.vec3.distance(b.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);a=m.max-a;return-1E-6<=a?0:a}Object.defineProperty(a,"__esModule",{value:!0});a.applyDistanceConstraint=a.getDistanceConstraintError=
void 0;a.getDistanceConstraintError=h;a.applyDistanceConstraint=function(a,m,r){void 0===r&&(r=k.defaultApplyOptions);var l=h(a,m,r);if(0===l)return!1;var t=a.pointsOfInterest.surfaceOrigin,l=d.vec3.distance(m.eye,a.pointsOfInterest.surfaceOrigin.renderLocation)+l,u=d.vec3.copy(f,m.eye);r=k.interactionDirectionTowardsConstraintMinimization(m,r.interactionDirection,c.directionFromTo(p,m.eye,a.pointsOfInterest.surfaceOrigin.renderLocation),g);return e.sphere.intersectRay(e.sphere.wrap(l,t.renderLocation),
e.ray.wrap(m.eye,r),m.eye)?(t=d.vec3.subtract(b,m.eye,u),d.vec3.add(m.center,m.center,t),m.markViewDirty(),t=a.renderCoordsHelper.getAltitude(m.center),a.renderCoordsHelper.intersectInfiniteManifold(m.ray,t,m.center),m.markViewDirty(),!0):!1};var m={min:0,max:0},f=l.vec3f64.create(),b=l.vec3f64.create(),g=l.vec3f64.create(),p=l.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64",
"../intersectionUtils"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.applySurfaceCollisionConstraint=void 0;a.applySurfaceCollisionConstraint=function(a,h,m){void 0===m&&(m=0);var c=a.state.constraints;if(!c.collision.enabled)return!1;var b=k.surfaceElevationBelowEye(a,h),g=a.renderCoordsHelper.getAltitude(h.eye),c=b+c.collision.elevationMargin;if(g>=c)return!1;b=d.vec3.length(h.eye);d.vec3.subtract(e,h.center,h.eye);a.renderCoordsHelper.setAltitude(c,h.eye);1===m?d.vec3.add(h.center,
h.eye,e):2===m&&d.vec3.scale(h.center,h.center,(b-g+c)/b);h.markViewDirty();return!0};var e=l.vec3f64.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ../../../geometry/support/geodesicConstants ../webgl-engine/lib/Intersector".split(" "),function(n,a,d,l,k,e,c){function h(a,b){return a.elevationProvider?a.elevationProvider.getElevation(b[0],b[1],
b[2],a.renderCoordsHelper.spatialReference,"ground")||0:0}function m(a,b,c){if(!a.state.isGlobal)return!1;var e=h(a,b);a=a.stateManager.constraintsManager.nearFarHeuristic.compute(b,c,a.dataExtent,e,u).far;a*=a;return d.vec3.squaredDistance(b,c)>a}function f(a,f,g){void 0===g&&(g=l.vec3f64.create());var h=b[a.viewingMode];h||(h=new c.Intersector(a.state.mode),h.options.backfacesTerrain=!a.state.isGlobal,h.options.invisibleTerrain=!0,b[a.viewingMode]=h);var k=a.state.isGlobal;return a.sceneIntersectionHelper.intersectRay(f,
h,g)&&!m(a,f.origin,g)?!0:!a.renderCoordsHelper.intersectManifold(f,0,g)||m(a,f.origin,g)?k?(a=g,g=d.vec3.dot(f.origin,f.origin)-e.earthRadius*e.earthRadius,d.vec3.scale(a,f.direction,(0<g?Math.sqrt(g)/3:1)/d.vec3.length(f.direction)),d.vec3.add(a,a,f.origin),!0):!1:!0}Object.defineProperty(a,"__esModule",{value:!0});a.cameraOnContentAlongViewDirection=a.surfaceElevationBelowEye=a.eyeWithinExtent=void 0;a.eyeWithinExtent=function(a,b,c,d){return a.renderCoordsHelper.fromRenderCoords(b.eye,g,d)&&k.containsPoint(c,
g)};a.surfaceElevationBelowEye=function(a,b){return h(a,b.eye)};a.cameraOnContentAlongViewDirection=function(a,b,c,e){var g=a.state.camera.clone();b&&(g.eye=b);c&&(g.center=c);e&&(g.up=e);f(a,g.ray,p)||d.vec3.copy(p,g.center);c=a.state.constraints;e=c.minimumPoiDistance;d.vec3.squaredDistance(g.eye,p)<e&&(b=c.collision.enabled,d.vec3.copy(t,g.viewForward),d.vec3.scale(t,t,e),b?d.vec3.subtract(g.eye,p,t):d.vec3.add(p,g.eye,t),a=a.renderCoordsHelper,e=a.getAltitude(g.eye),c=c.collision.elevationMargin,
b&&e<c&&(d.vec3.subtract(t,p,g.eye),a.setAltitude(c,g.eye),d.vec3.add(p,g.eye,t)));g.center=p;return g};var b={},g=l.vec3f64.create(),p=l.vec3f64.create(),t=l.vec3f64.create(),u={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("require exports ../../../../core/has ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./intersectorUtils ../materials/renderers/utils".split(" "),
function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.Intersector=void 0;n=function(){function a(a){this.options=new m.IntersectorOptions;this.results=new m.IntersectorResults;this.transform=new m.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.tolerance=1E-5;this.verticalOffset=null;this._ray={origin:c.vec3f64.create(),direction:c.vec3f64.create()};this._rayEndPoint=c.vec3f64.create();this._rayStartPointTransformed=c.vec3f64.create();
this._rayEndPointTransformed=c.vec3f64.create();this.viewingMode=null==a?1:a}Object.defineProperty(a.prototype,"ray",{get:function(){return this._ray},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"rayBeginPoint",{get:function(){return this._ray.origin},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"rayEndPoint",{get:function(){return this._rayEndPoint},enumerable:!1,configurable:!0});a.prototype.reset=function(a,b){this.resetWithRay(h.ray.fromPoints(a,b,this._ray))};
a.prototype.resetWithRay=function(a){a!==this._ray&&h.ray.copy(a,this._ray);0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;e.vec3.add(this._rayEndPoint,this._ray.origin,this._ray.direction);this._numObjectsTested=0;this.results.init(this._ray)};a.prototype.intersect=function(a,b,c,d,e,f){var g=this;this.point=b;this.camera=c;this.filterPredicate=e;this.tolerance=null==d?
1E-5:d;b=m.getVerticalOffsetObject3D(this.verticalOffset);c=f?function(a){f(a)&&g.intersectObject(a)}:function(a){g.intersectObject(a)};if(a&&0<a.length)for(d=0;d<a.length;d++){e=a[d];var h=e.getSpatialQueryAccelerator&&e.getSpatialQueryAccelerator();if(h)l.isSome(b)?h.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,c,b):h.forEachAlongRay(this._ray.origin,this._ray.direction,c),this.options.selectionMode&&this.options.hud&&h.forEachDegenerateObject(c);else for(h=0,e=e.getObjects();h<
e.length;h++)c(e[h])}this.sortResults()};a.prototype.intersectObject=function(a){var b=this;this._numObjectsTested++;var c=a.geometryRecords;if(c)for(var d=a.id,g=a.objectTransformation,h,v=m.getVerticalOffsetObject3D(this.verticalOffset),w=function(c){var p=c.geometry,r=c.material,t=c.instanceParameters;if(f.isInstanceHidden(t))return"continue";h=p.id;z.transform.setAndInvalidateLazyTransforms(g,c.getShaderTransformation());e.vec3.transformMat4(z._rayStartPointTransformed,z._ray.origin,z.transform.inverse);
e.vec3.transformMat4(z._rayEndPointTransformed,z._rayEndPoint,z.transform.inverse);var u=z.transform.transform;l.isSome(v)&&(v.objectTransform=z.transform);r.intersect(p,t,z.transform.transform,z,z._rayStartPointTransformed,z._rayEndPointTransformed,function(c,e,f,g,p,r){0<=c&&(!l.isSome(b.filterPredicate)||b.filterPredicate(b._ray.origin,b._rayEndPoint,c))&&(p?(null==b.results.hud.dist||c<b.results.hud.dist)&&b.results.hud.set(a,d,c,e,k.mat4f64.IDENTITY,g,r,h,f):(p=function(b){return b.set(a,d,c,
e,u,g,null,h,f)},(null==b.results.min.drapedLayerOrder||g>=b.results.min.drapedLayerOrder)&&(null==b.results.min.dist||c<b.results.min.dist)&&p(b.results.min),0!==b.options.store&&(null==b.results.max.drapedLayerOrder||g<b.results.max.drapedLayerOrder)&&(null==b.results.max.dist||c>b.results.max.dist)&&p(b.results.max),2===b.options.store&&(r=new m.IntersectorResult(b._ray),p(r),b.results.all.push(r))))},c.shaderTransformation)},z=this,x=0;x<c.length;x++)w(c[x])};a.prototype.sortResults=function(){this.results.all.sort(function(a,
b){return a.dist!==b.dist?a.dist-b.dist:a.drapedLayerOrder!==b.drapedLayerOrder?(void 0!==a.drapedLayerOrder?a.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==b.drapedLayerOrder?b.drapedLayerOrder:Number.MAX_VALUE):(void 0!==b.drapedLayerGraphicOrder?b.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==a.drapedLayerGraphicOrder?a.drapedLayerGraphicOrder:Number.MIN_VALUE)})};a.DEFAULT_TOLERANCE=1E-5;return a}();a.Intersector=n})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/geometryUtils/boundedPlane ../../support/geometryUtils/sphere ./Object3D".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v){function w(a,b){return d.isNone(a)||null==a.layerUid?null:d.isSome(b.graphicsView)&&a.layerUid===b.graphicsView.mockLayerId?b.graphics:b.map.findLayerByUid(a.layerUid)}function z(a,b){if(d.isNone(a))return null;var c=w(a,b);return d.isNone(c)?null:c===b.graphics?d.isSome(b.graphicsView)?d.unwrap(b.graphicsView.getGraphicFromGraphicUid(a.graphicUid)):null:(b=b.allLayerViews.find(function(a){return a.layer===c}))?x(b,a):null}function x(a,b){return!a||a.suspended?
null:"getGraphicFromIntersectorMetadata"in a&&b?a.getGraphicFromIntersectorMetadata(b):"getGraphicFromGraphicUid"in a&&null!=b.graphicUid?a.getGraphicFromGraphicUid(b.graphicUid):null}Object.defineProperty(a,"__esModule",{value:!0});a.TERRAIN_ID=a.getVerticalOffsetTerrain=a.getVerticalOffsetI3S=a.getVerticalOffsetObject3D=a.Object3DVerticalOffsetGlobalViewingMode=a.I3SVerticalOffsetGlobalViewingMode=a.TerrainVerticalOffsetGlobalViewingMode=a.IntersectorResult=a.IntersectorResults=a.IntersectorTransform=
a.IntersectorOptions=a.sliceFilterPredicate=void 0;a.sliceFilterPredicate=function(a){return function(b,c,d){f.vec3.lerp(J,b,c,d);return!r.extrusionContainsPoint(a,J)}};n=function(){return function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.store=2}}();a.IntersectorOptions=n;n=function(){function a(){this._transform=c.mat4f64.create();this._transformInverse=new B({value:this._transform},
e.mat4.invert,c.mat4f64.create);this._transformInverseTranspose=new B(this._transformInverse,e.mat4.transpose,c.mat4f64.create);this._transformTranspose=new B({value:this._transform},e.mat4.transpose,c.mat4f64.create);this._transformInverseRotation=new B({value:this._transform},l.mat3.normalFromMat4Legacy,k.mat3f64.create)}a.prototype.invalidateLazyTransforms=function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};
Object.defineProperty(a.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!1,configurable:!0});a.prototype.setTransformMatrix=function(a){e.mat4.copy(this._transform,a)};a.prototype.multiplyTransform=function(a){e.mat4.multiply(this._transform,this._transform,a)};a.prototype.set=function(a){e.mat4.copy(this._transform,a);this.invalidateLazyTransforms()};a.prototype.setAndInvalidateLazyTransforms=function(a,b){this.setTransformMatrix(a);
this.multiplyTransform(b);this.invalidateLazyTransforms()};return a}();a.IntersectorTransform=n;var B=function(){function a(a,b,c){this.original=a;this.update=b;this.dirty=!0;this.transform=c()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform},enumerable:!1,configurable:!0});return a}();n=function(){function a(){this.min=new A;this.max=new A;this.hud=
new A;this.ground=new A}a.prototype.init=function(a){this.min.init(a);this.max.init(a);this.hud.init(a);this.ground.init(a);this.all=[]};return a}();a.IntersectorResults=n;var A=function(){function a(a){this.normal=g.vec3f64.create();this.transformation=c.mat4f64.create();this._ray=u.ray.create();this.init(a)}Object.defineProperty(a.prototype,"ray",{get:function(){return this._ray},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hasIntersectionPoint",{get:function(){return null!=
this.dist},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return f.vec3.scale(I,this.ray.direction,this.dist),f.vec3.length(I)},enumerable:!1,configurable:!0});a.prototype.getIntersectionPoint=function(a){if(!this.hasIntersectionPoint)return!1;f.vec3.scale(I,this.ray.direction,this.dist);f.vec3.add(a,this.ray.origin,I);return!0};a.prototype.getTransformedNormal=function(a){f.vec3.copy(K,this.normal);K[3]=0;p.vec4.transformMat4(K,
K,this.transformation);f.vec3.copy(a,K);f.vec3.normalize(a,a);return a};a.prototype.init=function(a){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";a?u.ray.copy(a,this._ray):this._ray=u.ray.create()};a.prototype.set=function(a,b,c,d,h,m,k,p,r,l){a instanceof v&&(a={type:"stage",obj:a});this.dist=c;f.vec3.copy(this.normal,d);e.mat4.copy(this.transformation,h);this.target=a;this.name=
b;this.drapedLayerOrder=m;this.center=k?g.vec3f64.clone(k):null;this.geometryId=p;this.triangleNr=r;this.drapedLayerGraphicOrder=l};a.prototype.copyFrom=function(a){u.ray.copy(a._ray,this._ray);this.dist=a.dist;this.target=a.target;this.name=a.name;this.drapedLayerOrder=a.drapedLayerOrder;this.center=a.center?g.vec3f64.clone(a.center):null;this.geometryId=a.geometryId;this.triangleNr=a.triangleNr;this.intersector=a.intersector;this.drapedLayerGraphicOrder=a.drapedLayerGraphicOrder;f.vec3.copy(this.normal,
a.normal);e.mat4.copy(this.transformation,a.transformation)};a.prototype.toOwner=function(a){if(!this.target)return null;switch(this.target.type){case "stage":return w(this.target.obj.metadata,a);case "external":switch(this.intersector){case "PointRenderer":var b=this.target.metadata.layerUid;return null!=b?a.map.findLayerByUid(b):null;case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return w(this.target.metadata,a);case "TerrainRenderer":return a.map&&a.map.ground}}return null};a.prototype.toGraphic=
function(a){if(!this.target)return null;switch(this.target.type){case "stage":return z(this.target.obj.metadata,a);case "external":switch(this.intersector){case "PointRenderer":return this.target.metadata.createGraphic();case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return z(this.target.metadata,a)}}return null};return a}();a.IntersectorResult=A;n=function(){function a(a){void 0===a&&(a=0);this.offset=a;this.tmpVertex=g.vec3f64.create()}a.prototype.applyToVertex=function(a,b,c){var d=
a+this.localOrigin[0],e=b+this.localOrigin[1],f=c+this.localOrigin[2],g=this.offset/Math.sqrt(d*d+e*e+f*f);this.tmpVertex[0]=a+d*g;this.tmpVertex[1]=b+e*g;this.tmpVertex[2]=c+f*g;return this.tmpVertex};a.prototype.applyToAabb=function(a){var b=a[0]+this.localOrigin[0],c=a[1]+this.localOrigin[1],d=a[2]+this.localOrigin[2],e=a[3]+this.localOrigin[0],f=a[4]+this.localOrigin[1],g=a[5]+this.localOrigin[2],h=this.offset/Math.sqrt(b*b+c*c+d*d);a[0]+=b*h;a[1]+=c*h;a[2]+=d*h;b=this.offset/Math.sqrt(e*e+f*
f+g*g);a[3]+=e*b;a[4]+=f*b;a[5]+=g*b;return a};return a}();a.TerrainVerticalOffsetGlobalViewingMode=n;var C=function(){function a(a){void 0===a&&(a=0);this.offset=a;this.componentLocalOriginLength=0;this.tmpVertex=g.vec3f64.create();this.mbs=t.vec4f64.create();this.obb={center:g.vec3f64.create(),halfSize:b.vec3f32.create(),quaternion:null}}Object.defineProperty(a.prototype,"localOrigin",{set:function(a){this.componentLocalOriginLength=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},enumerable:!1,configurable:!0});
a.prototype.applyToVertex=function(a,b,c){var d=c+this.componentLocalOriginLength,e=this.offset/Math.sqrt(a*a+b*b+d*d);this.tmpVertex[0]=a+a*e;this.tmpVertex[1]=b+b*e;this.tmpVertex[2]=c+d*e;return this.tmpVertex};a.prototype.applyToAabb=function(a){var b=a[0],c=a[1],d=a[2]+this.componentLocalOriginLength,e=a[3],f=a[4],g=a[5]+this.componentLocalOriginLength,h=this.offset/Math.sqrt(b*b+c*c+d*d);a[0]+=b*h;a[1]+=c*h;a[2]+=d*h;b=this.offset/Math.sqrt(e*e+f*f+g*g);a[3]+=e*b;a[4]+=f*b;a[5]+=g*b;return a};
a.prototype.applyToMbs=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),c=this.offset/b;this.mbs[0]=a[0]+a[0]*c;this.mbs[1]=a[1]+a[1]*c;this.mbs[2]=a[2]+a[2]*c;this.mbs[3]=a[3]+a[3]*this.offset/b;return this.mbs};a.prototype.applyToObb=function(a){var b=a.center,c=this.offset/Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);this.obb.center[0]=b[0]+b[0]*c;this.obb.center[1]=b[1]+b[1]*c;this.obb.center[2]=b[2]+b[2]*c;f.vec3.transformQuat(this.obb.halfSize,a.halfSize,a.quaternion);f.vec3.add(this.obb.halfSize,
this.obb.halfSize,a.center);b=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);this.obb.halfSize[0]+=this.obb.halfSize[0]*b;this.obb.halfSize[1]+=this.obb.halfSize[1]*b;this.obb.halfSize[2]+=this.obb.halfSize[2]*b;f.vec3.subtract(this.obb.halfSize,this.obb.halfSize,a.center);h.quat.conjugate(L,a.quaternion);f.vec3.transformQuat(this.obb.halfSize,this.obb.halfSize,L);this.obb.halfSize[0]*=0>this.obb.halfSize[0]?
-1:1;this.obb.halfSize[1]*=0>this.obb.halfSize[1]?-1:1;this.obb.halfSize[2]*=0>this.obb.halfSize[2]?-1:1;this.obb.quaternion=a.quaternion;return this.obb};return a}();a.I3SVerticalOffsetGlobalViewingMode=C;var E=function(){function a(a){void 0===a&&(a=0);this.offset=a;this.sphere=q.create();this.tmpVertex=g.vec3f64.create()}a.prototype.applyToVertex=function(a,b,c){var d=this.objectTransform.transform,e=d[0]*a+d[4]*b+d[8]*c+d[12],f=d[1]*a+d[5]*b+d[9]*c+d[13];a=d[2]*a+d[6]*b+d[10]*c+d[14];b=this.offset/
Math.sqrt(e*e+f*f+a*a);e+=e*b;f+=f*b;a+=a*b;b=this.objectTransform.inverse;this.tmpVertex[0]=b[0]*e+b[4]*f+b[8]*a+b[12];this.tmpVertex[1]=b[1]*e+b[5]*f+b[9]*a+b[13];this.tmpVertex[2]=b[2]*e+b[6]*f+b[10]*a+b[14];return this.tmpVertex};a.prototype.applyToMinMax=function(a,b){var c=this.offset/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]+=a[0]*c;a[1]+=a[1]*c;a[2]+=a[2]*c;a=this.offset/Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);b[0]+=b[0]*a;b[1]+=b[1]*a;b[2]+=b[2]*a};a.prototype.applyToAabb=function(a){var b=
this.offset/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]+=a[0]*b;a[1]+=a[1]*b;a[2]+=a[2]*b;b=this.offset/Math.sqrt(a[3]*a[3]+a[4]*a[4]+a[5]*a[5]);a[3]+=a[3]*b;a[4]+=a[4]*b;a[5]+=a[5]*b;return a};a.prototype.applyToBoundingSphere=function(a,b){var c=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]),d=this.offset/c;this.sphere.center[0]=b[0]+b[0]*d;this.sphere.center[1]=b[1]+b[1]*d;this.sphere.center[2]=b[2]+b[2]*d;this.sphere.radius=a+a*this.offset/c;return this.sphere};return a}();a.Object3DVerticalOffsetGlobalViewingMode=
E;var G=new E;a.getVerticalOffsetObject3D=function(a){return d.isSome(a)?(G.offset=a,G):null};var F=new C;a.getVerticalOffsetI3S=function(a){return d.isSome(a)?(F.offset=a,F):null};var H=new n;a.getVerticalOffsetTerrain=function(a){return d.isSome(a)?(H.offset=a,H):null};a.TERRAIN_ID="terrain";var J=g.vec3f64.create(),I=g.vec3f64.create(),K=t.vec4f64.create(),L=m.quatf64.create()})},"esri/core/libs/gl-matrix-2/mat3":function(){define(["require","exports","./math/mat3"],function(n,a,d){Object.defineProperty(a,
"__esModule",{value:!0});a.mat3=void 0;a.mat3=d})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["require","exports","./common"],function(n,a,d){function l(a,c,d){var e=c[0],f=c[1],b=c[2],g=c[3],h=c[4],k=c[5],l=c[6],r=c[7];c=c[8];var q=d[0],v=d[1],w=d[2],z=d[3],x=d[4],B=d[5],A=d[6],C=d[7];d=d[8];a[0]=q*e+v*g+w*l;a[1]=q*f+v*h+w*r;a[2]=q*b+v*k+w*c;a[3]=z*e+x*g+B*l;a[4]=z*f+x*h+B*r;a[5]=z*b+x*k+B*c;a[6]=A*e+C*g+d*l;a[7]=A*f+C*h+d*r;a[8]=A*b+C*k+d*c;return a}function k(a,c,d){a[0]=c[0]-d[0];
a[1]=c[1]-d[1];a[2]=c[2]-d[2];a[3]=c[3]-d[3];a[4]=c[4]-d[4];a[5]=c[5]-d[5];a[6]=c[6]-d[6];a[7]=c[7]-d[7];a[8]=c[8]-d[8];return a}Object.defineProperty(a,"__esModule",{value:!0});a.sub=a.mul=a.equals=a.exactEquals=a.multiplyScalarAndAdd=a.multiplyScalar=a.subtract=a.add=a.frob=a.str=a.projection=a.normalFromMat4=a.normalFromMat4Legacy=a.fromQuat=a.fromMat2d=a.fromScaling=a.fromRotation=a.fromTranslation=a.scaleByVec2=a.scale=a.rotate=a.translate=a.multiply=a.determinant=a.adjoint=a.invert=a.transpose=
a.identity=a.set=a.copy=a.fromMat4=void 0;a.fromMat4=function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[4];a[4]=c[5];a[5]=c[6];a[6]=c[8];a[7]=c[9];a[8]=c[10];return a};a.copy=function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];return a};a.set=function(a,c,d,m,f,b,g,k,l,u){a[0]=c;a[1]=d;a[2]=m;a[3]=f;a[4]=b;a[5]=g;a[6]=k;a[7]=l;a[8]=u;return a};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=
function(a,c){if(a===c){var d=c[1],e=c[2],f=c[5];a[1]=c[3];a[2]=c[6];a[3]=d;a[5]=c[7];a[6]=e;a[7]=f}else a[0]=c[0],a[1]=c[3],a[2]=c[6],a[3]=c[1],a[4]=c[4],a[5]=c[7],a[6]=c[2],a[7]=c[5],a[8]=c[8];return a};a.invert=function(a,c){var d=c[0],e=c[1],f=c[2],b=c[3],g=c[4],k=c[5],l=c[6],u=c[7];c=c[8];var r=c*g-k*u,q=-c*b+k*l,v=u*b-g*l,w=d*r+e*q+f*v;if(!w)return null;w=1/w;a[0]=r*w;a[1]=(-c*e+f*u)*w;a[2]=(k*e-f*g)*w;a[3]=q*w;a[4]=(c*d-f*l)*w;a[5]=(-k*d+f*b)*w;a[6]=v*w;a[7]=(-u*d+e*l)*w;a[8]=(g*d-e*b)*w;return a};
a.adjoint=function(a,c){var d=c[0],e=c[1],f=c[2],b=c[3],g=c[4],k=c[5],l=c[6],u=c[7];c=c[8];a[0]=g*c-k*u;a[1]=f*u-e*c;a[2]=e*k-f*g;a[3]=k*l-b*c;a[4]=d*c-f*l;a[5]=f*b-d*k;a[6]=b*u-g*l;a[7]=e*l-d*u;a[8]=d*g-e*b;return a};a.determinant=function(a){var c=a[3],d=a[4],e=a[5],f=a[6],b=a[7],g=a[8];return a[0]*(g*d-e*b)+a[1]*(-g*c+e*f)+a[2]*(b*c-d*f)};a.multiply=l;a.translate=function(a,c,d){var e=c[0],f=c[1],b=c[2],g=c[3],h=c[4],k=c[5],l=c[6],r=c[7];c=c[8];var q=d[0];d=d[1];a[0]=e;a[1]=f;a[2]=b;a[3]=g;a[4]=
h;a[5]=k;a[6]=q*e+d*g+l;a[7]=q*f+d*h+r;a[8]=q*b+d*k+c;return a};a.rotate=function(a,c,d){var e=c[0],f=c[1],b=c[2],g=c[3],h=c[4],k=c[5],l=c[6],r=c[7];c=c[8];var q=Math.sin(d);d=Math.cos(d);a[0]=d*e+q*g;a[1]=d*f+q*h;a[2]=d*b+q*k;a[3]=d*g-q*e;a[4]=d*h-q*f;a[5]=d*k-q*b;a[6]=l;a[7]=r;a[8]=c;return a};a.scale=function(a,c,d){var e=d[0],f=d[1];d=d[2];a[0]=e*c[0];a[1]=e*c[1];a[2]=e*c[2];a[3]=f*c[3];a[4]=f*c[4];a[5]=f*c[5];a[6]=d*c[6];a[7]=d*c[7];a[8]=d*c[8];return a};a.scaleByVec2=function(a,c,d){var e=d[0];
d=d[1];a[0]=e*c[0];a[1]=e*c[1];a[2]=e*c[2];a[3]=d*c[3];a[4]=d*c[4];a[5]=d*c[5];return a};a.fromTranslation=function(a,c){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=c[0];a[7]=c[1];a[8]=1;return a};a.fromRotation=function(a,c){var d=Math.sin(c);c=Math.cos(c);a[0]=c;a[1]=d;a[2]=0;a[3]=-d;a[4]=c;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromScaling=function(a,c){a[0]=c[0];a[1]=0;a[2]=0;a[3]=0;a[4]=c[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat2d=function(a,c){a[0]=c[0];a[1]=c[1];a[2]=0;a[3]=c[2];
a[4]=c[3];a[5]=0;a[6]=c[4];a[7]=c[5];a[8]=1;return a};a.fromQuat=function(a,c){var d=c[0],e=c[1],f=c[2];c=c[3];var b=d+d,g=e+e,k=f+f,d=d*b,l=e*b,e=e*g,u=f*b,r=f*g,f=f*k,b=c*b,g=c*g;c*=k;a[0]=1-e-f;a[3]=l-c;a[6]=u+g;a[1]=l+c;a[4]=1-d-f;a[7]=r-b;a[2]=u-g;a[5]=r+b;a[8]=1-d-e;return a};a.normalFromMat4Legacy=function(a,c){var d=c[0],e=c[1],f=c[2],b=c[4],g=c[5],k=c[6],l=c[8],u=c[9];c=c[10];var r=c*g-k*u,q=-c*b+k*l,v=u*b-g*l,w=d*r+e*q+f*v;if(!w)return null;w=1/w;a[0]=r*w;a[1]=(-c*e+f*u)*w;a[2]=(k*e-f*g)*
w;a[3]=q*w;a[4]=(c*d-f*l)*w;a[5]=(-k*d+f*b)*w;a[6]=v*w;a[7]=(-u*d+e*l)*w;a[8]=(g*d-e*b)*w;return a};a.normalFromMat4=function(a,c){var d=c[0],e=c[1],f=c[2],b=c[3],g=c[4],k=c[5],l=c[6],u=c[7],r=c[8],q=c[9],v=c[10],w=c[11],z=c[12],x=c[13],B=c[14];c=c[15];var A=d*k-e*g,C=d*l-f*g,E=d*u-b*g,G=e*l-f*k,F=e*u-b*k,H=f*u-b*l,J=r*x-q*z,I=r*B-v*z,r=r*c-w*z,K=q*B-v*x,q=q*c-w*x,v=v*c-w*B,w=A*v-C*q+E*K+G*r-F*I+H*J;if(!w)return null;w=1/w;a[0]=(k*v-l*q+u*K)*w;a[1]=(l*r-g*v-u*I)*w;a[2]=(g*q-k*r+u*J)*w;a[3]=(f*q-e*
v-b*K)*w;a[4]=(d*v-f*r+b*I)*w;a[5]=(e*r-d*q-b*J)*w;a[6]=(x*H-B*F+c*G)*w;a[7]=(B*E-z*H-c*C)*w;a[8]=(z*F-x*E+c*A)*w;return a};a.projection=function(a,c,d){a[0]=2/c;a[1]=0;a[2]=0;a[3]=0;a[4]=-2/d;a[5]=0;a[6]=-1;a[7]=1;a[8]=1;return a};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],
2)+Math.pow(a[7],2)+Math.pow(a[8],2))};a.add=function(a,c,d){a[0]=c[0]+d[0];a[1]=c[1]+d[1];a[2]=c[2]+d[2];a[3]=c[3]+d[3];a[4]=c[4]+d[4];a[5]=c[5]+d[5];a[6]=c[6]+d[6];a[7]=c[7]+d[7];a[8]=c[8]+d[8];return a};a.subtract=k;a.multiplyScalar=function(a,c,d){a[0]=c[0]*d;a[1]=c[1]*d;a[2]=c[2]*d;a[3]=c[3]*d;a[4]=c[4]*d;a[5]=c[5]*d;a[6]=c[6]*d;a[7]=c[7]*d;a[8]=c[8]*d;return a};a.multiplyScalarAndAdd=function(a,c,d,m){a[0]=c[0]+d[0]*m;a[1]=c[1]+d[1]*m;a[2]=c[2]+d[2]*m;a[3]=c[3]+d[3]*m;a[4]=c[4]+d[4]*m;a[5]=
c[5]+d[5]*m;a[6]=c[6]+d[6]*m;a[7]=c[7]+d[7]*m;a[8]=c[8]+d[8]*m;return a};a.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]};a.equals=function(a,c){var e=a[0],m=a[1],f=a[2],b=a[3],g=a[4],k=a[5],l=a[6],u=a[7];a=a[8];var r=c[0],q=c[1],v=c[2],w=c[3],z=c[4],x=c[5],B=c[6],A=c[7];c=c[8];return Math.abs(e-r)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(r))&&Math.abs(m-q)<=d.EPSILON*Math.max(1,Math.abs(m),Math.abs(q))&&
Math.abs(f-v)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(v))&&Math.abs(b-w)<=d.EPSILON*Math.max(1,Math.abs(b),Math.abs(w))&&Math.abs(g-z)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(k-x)<=d.EPSILON*Math.max(1,Math.abs(k),Math.abs(x))&&Math.abs(l-B)<=d.EPSILON*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(u-A)<=d.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(a-c)<=d.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};a.mul=l;a.sub=k})},"esri/core/libs/gl-matrix-2/quat":function(){define(["require",
"exports","./math/quat"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.quat=void 0;a.quat=d})},"esri/core/libs/gl-matrix-2/math/quat":function(){define("require exports ../factories/mat3f64 ../factories/quatf64 ../factories/vec3f64 ./common ./vec3 ./vec4".split(" "),function(n,a,d,l,k,e,c,h){function m(a,b,c){c*=.5;var d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c);return a}function f(a,b,c){var d=b[0],e=b[1],f=b[2];b=b[3];var g=c[0],h=c[1],m=c[2];c=c[3];a[0]=
d*c+b*g+e*m-f*h;a[1]=e*c+b*h+f*g-d*m;a[2]=f*c+b*m+d*h-e*g;a[3]=b*c-d*g-e*h-f*m;return a}function b(a,b,c,d){var f=b[0],g=b[1],h=b[2];b=b[3];var m=c[0],k=c[1],p=c[2];c=c[3];var r,l,u;l=f*m+g*k+h*p+b*c;0>l&&(l=-l,m=-m,k=-k,p=-p,c=-c);1-l>e.EPSILON?(r=Math.acos(l),u=Math.sin(r),l=Math.sin((1-d)*r)/u,d=Math.sin(d*r)/u):l=1-d;a[0]=l*f+d*m;a[1]=l*g+d*k;a[2]=l*h+d*p;a[3]=l*b+d*c;return a}function g(a,b){var c=b[0]+b[4]+b[8];if(0<c)c=Math.sqrt(c+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=
(b[1]-b[3])*c;else{var d=0;b[4]>b[0]&&(d=1);b[8]>b[3*d+d]&&(d=2);var e=(d+1)%3,f=(d+2)%3,c=Math.sqrt(b[3*d+d]-b[3*e+e]-b[3*f+f]+1);a[d]=.5*c;c=.5/c;a[3]=(b[3*e+f]-b[3*f+e])*c;a[e]=(b[3*e+d]+b[3*d+e])*c;a[f]=(b[3*f+d]+b[3*d+f])*c}return a}Object.defineProperty(a,"__esModule",{value:!0});a.setAxes=a.sqlerp=a.rotationTo=a.equals=a.exactEquals=a.normalize=a.sqrLen=a.squaredLength=a.len=a.length=a.lerp=a.dot=a.scale=a.mul=a.add=a.set=a.copy=a.str=a.fromEuler=a.fromMat3=a.conjugate=a.invert=a.random=a.slerp=
a.calculateW=a.rotateZ=a.rotateY=a.rotateX=a.multiply=a.getAxisAngle=a.setAxisAngle=a.identity=void 0;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=m;a.getAxisAngle=function(a,b){var c=2*Math.acos(b[3]),d=Math.sin(c/2);d>e.EPSILON?(a[0]=b[0]/d,a[1]=b[1]/d,a[2]=b[2]/d):(a[0]=1,a[1]=0,a[2]=0);return c};a.multiply=f;a.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+b*g;a[1]=e*c+f*g;a[2]=f*c-e*g;a[3]=b*c-d*g;return a};
a.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c-f*g;a[1]=e*c+b*g;a[2]=f*c+d*g;a[3]=b*c-e*g;return a};a.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+e*g;a[1]=e*c-d*g;a[2]=f*c+b*g;a[3]=b*c-f*g;return a};a.calculateW=function(a,b){var c=b[0],d=b[1];b=b[2];a[0]=c;a[1]=d;a[2]=b;a[3]=Math.sqrt(Math.abs(1-c*c-d*d-b*b));return a};a.slerp=b;a.random=function(a){var b=e.RANDOM(),c=e.RANDOM(),d=
e.RANDOM(),f=Math.sqrt(1-b),b=Math.sqrt(b);a[0]=f*Math.sin(2*Math.PI*c);a[1]=f*Math.cos(2*Math.PI*c);a[2]=b*Math.sin(2*Math.PI*d);a[3]=b*Math.cos(2*Math.PI*d);return a};a.invert=function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=c*c+d*d+e*e+b*b,f=f?1/f:0;a[0]=-c*f;a[1]=-d*f;a[2]=-e*f;a[3]=b*f;return a};a.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};a.fromMat3=g;a.fromEuler=function(a,b,c,d){var e=.5*Math.PI/180;b*=e;c*=e;d*=e;e=Math.sin(b);b=Math.cos(b);var f=Math.sin(c);
c=Math.cos(c);var g=Math.sin(d);d=Math.cos(d);a[0]=e*c*d-b*f*g;a[1]=b*f*d+e*c*g;a[2]=b*c*g-e*f*d;a[3]=b*c*d+e*f*g;return a};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};a.copy=h.copy;a.set=h.set;a.add=h.add;a.mul=f;a.scale=h.scale;a.dot=h.dot;a.lerp=h.lerp;a.length=h.length;a.len=a.length;a.squaredLength=h.squaredLength;a.sqrLen=a.squaredLength;a.normalize=h.normalize;a.exactEquals=h.exactEquals;a.equals=h.equals;a.rotationTo=function(b,d,e){var f=c.dot(d,e);if(-.999999>
f)return c.cross(p,t,d),1E-6>c.len(p)&&c.cross(p,u,d),c.normalize(p,p),m(b,p,Math.PI),b;if(.999999<f)return b[0]=0,b[1]=0,b[2]=0,b[3]=1,b;c.cross(p,d,e);b[0]=p[0];b[1]=p[1];b[2]=p[2];b[3]=1+f;return a.normalize(b,b)};var p=k.create(),t=k.fromValues(1,0,0),u=k.fromValues(0,1,0);a.sqlerp=function(a,c,d,e,f,g){b(r,c,f,g);b(q,d,e,g);b(a,r,q,2*g*(1-g));return a};var r=l.create(),q=l.create();a.setAxes=function(b,c,d,e){var f=v;f[0]=d[0];f[3]=d[1];f[6]=d[2];f[1]=e[0];f[4]=e[1];f[7]=e[2];f[2]=-c[0];f[5]=
-c[1];f[8]=-c[2];return a.normalize(b,g(b,f))};var v=d.create()})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports tslib ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./GeometryRecord ./IdGen ./Object3DStateSet ./Util ../materials/renderers/utils".split(" "),function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){n=function(){function a(b){void 0===
b&&(b={});this._objectTransformation=e.mat4f64.create();this._bvObjectSpace=new r;this._bvWorldSpace=new r;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._visible=!0;this.id=a._idGen.gen(b.idHint);this.castShadow=null!=b.castShadow?b.castShadow:!0;(this.metadata=b.metadata)&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new u);this.objectTransformation=e.mat4f64.create();this._initializeGeometryRecords(b.geometries,b.materials,b.transformations,b.origins)}Object.defineProperty(a.prototype,
"geometryRecords",{get:function(){return this._geometryRecords},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"geometries",{get:function(){return this._geometries},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(a){k.mat4.copy(this._objectTransformation,a);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")},enumerable:!1,configurable:!0});a.prototype.dispose=
function(){for(var a=0,b=this._geometryRecords;a<b.length;a++)f.pool.release(b[a]);this._geometries=this._geometryRecords=null};a.prototype._initializeGeometryRecords=function(a,b,c,d){if(Array.isArray(a)){p.assert(b.length===a.length,"Object3D: materials don't match geometries");p.assert(c.length===a.length,"Object3D: transformations don't match geometries");this._geometryRecords=Array(a.length);this._geometries=a.slice();for(var g=0;g<a.length;g++)this._geometryRecords[g]=f.pool.acquire(a[g],b[g],
e.mat4f64.clone(c[g]),{highlights:null,occludees:null,visible:!0},d&&d[g]);this._hasVolatileTransformation=!1}else this._geometryRecords=[],this._geometries=[]};Object.defineProperty(a.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(a){p.assert(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!1,configurable:!0});a.prototype.getNumGeometryRecords=function(){return this._geometryRecords.length};a.prototype.getGeometryRecord=
function(a){p.assert(0<=a&&a<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this._geometryRecords[a]};a.prototype.addGeometry=function(a,b,c,d,g,h){c=c?c:e.mat4f64.IDENTITY;this._geometries.push(a);a=f.pool.acquire(a,b,c,d||{highlights:null,occludees:null,visible:!0},g,h);this._geometryRecords.push(a);this._hasVolatileTransformation=this._geometryRecords.some(function(a){return!!a.shaderTransformation});this._notifyDirty("objGeometryAdded",a);this._invalidateBoundingVolume();
return a};a.prototype.removeGeometry=function(a){var b=this._geometryRecords.splice(a,1)[0];f.pool.release(b);this._hasVolatileTransformation=this._geometryRecords.some(function(a){return!!a.shaderTransformation});this._geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",b);this._invalidateBoundingVolume();return b};a.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};a.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",
this._geometryRecords[a]);this._invalidateBoundingVolume()};Object.defineProperty(a.prototype,"isVisible",{get:function(){return this._visible},enumerable:!1,configurable:!0});a.prototype.setVisible=function(a){this._visible=a;a=0;for(var b=this._geometryRecords;a<b.length;a++)b[a].instanceParameters.visible=this._visible;this._notifyDirty("visibilityChanged")};a.prototype.occlude=function(){for(var a=g.generateObject3DStateId(1),b=0,c=this._geometryRecords;b<c.length;b++){var d=c[b];d.instanceParameters.occludees=
t.addObject3DStateID(d.instanceParameters.occludees,a)}this._notifyDirty("occlusionChanged");return a};a.prototype.removeOcclude=function(a){for(var b=0,c=this._geometryRecords;b<c.length;b++){var d=c[b];d.instanceParameters.occludees=t.removeObject3DStateID(d.instanceParameters.occludees,a)}this._notifyDirty("occlusionChanged")};a.prototype.highlight=function(){for(var a=g.generateObject3DStateId(0),b=0,c=this._geometryRecords;b<c.length;b++){var d=c[b];d.instanceParameters.highlights=t.addObject3DStateID(d.instanceParameters.highlights,
a)}this._notifyDirty("highlightChanged");return a};a.prototype.removeHighlight=function(a){for(var b=0,c=this._geometryRecords;b<c.length;b++){var d=c[b];d.instanceParameters.highlights=t.removeObject3DStateID(d.instanceParameters.highlights,a)}this._notifyDirty("highlightChanged")};a.prototype.getCombinedStaticTransformation=function(a,b){return k.mat4.multiply(l.unwrapOr(b,e.mat4f64.create()),this.objectTransformation,a.getStaticTransformation())};a.prototype.getCombinedShaderTransformation=function(a,
b){b=b||e.mat4f64.create();k.mat4.multiply(b,this.objectTransformation,a.getShaderTransformation());return b};a.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};a.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};a.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};a.prototype.getCenter=function(a){this._validateBoundingVolume();
return a?this._bvObjectSpace.center:this._bvWorldSpace.center};a.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};a.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this._geometryRecords.length;++a){var b=this._geometries[a],d=this._geometryRecords[a],b=b.boundingInfo;this._calculateTransformedBoundingVolume(b,
this._bvObjectSpace,d.getShaderTransformation());this._calculateTransformedBoundingVolume(b,this._bvWorldSpace,this.getCombinedShaderTransformation(d))}c.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5);c.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);for(var d=h.vec3f64.create(),e=h.vec3f64.create(),f=m.maxScale(this.objectTransformation),a=0;a<this._geometryRecords.length;++a){var b=this._geometries[a],g=this._geometryRecords[a].getShaderTransformation(),
k=m.maxScale(g),b=b.boundingInfo;c.vec3.transformMat4(d,b.getCenter(),g);g=c.vec3.distance(d,this._bvObjectSpace.center);b=b.getBSRadius()*k;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,g+b);c.vec3.transformMat4(e,d,this.objectTransformation);k=c.vec3.distance(e,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,k+b*f)}this._bvDirty=!1}};a.prototype._calculateTransformedBoundingVolume=function(a,b,d){var e=a.getBBMin();a=a.getBBMax();
var f=h.vec3f64.clone(e),g=h.vec3f64.clone(a);c.vec3.transformMat4(f,f,d);c.vec3.transformMat4(g,g,d);for(var m=0;3>m;++m)b.bbMin[m]=Math.min(b.bbMin[m],f[m],g[m]),b.bbMax[m]=Math.max(b.bbMax[m],f[m],g[m]);for(m=0;3>m;++m){c.vec3.copy(f,e);c.vec3.copy(g,a);f[m]=a[m];g[m]=e[m];c.vec3.transformMat4(f,f,d);c.vec3.transformMat4(g,g,d);for(var k=0;3>k;++k)b.bbMin[k]=Math.min(b.bbMin[k],f[k],g[k]),b.bbMax[k]=Math.max(b.bbMax[k],f[k],g[k])}};a.prototype._invalidateBoundingVolume=function(){this._bvDirty=
!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})};a.prototype._notifyDirty=function(a,b,c,d){this._parentLayer&&this._parentLayer.notifyDirty(a,b,c||1,d||this)};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{hasGeometry:function(b){return-1<a._geometries.indexOf(b)},getGeometryIndex:function(b){return a._geometries.indexOf(b)}}},enumerable:!1,configurable:!0});a._idGen=new b.IdGen;
return a}();var u=function(){function a(){this.bbMin=h.vec3f64.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.bbMax=h.vec3f64.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}a.prototype.isEmpty=function(){return this.bbMax[0]<this.bbMin[0]&&this.bbMax[1]<this.bbMin[1]&&this.bbMax[2]<this.bbMin[2]};return a}(),r=function(a){function b(){var b=a.call(this)||this;b.center=h.vec3f64.create();b.bsRadius=0;return b}d.__extends(b,a);b.prototype.init=function(){c.vec3.set(this.bbMin,
Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);c.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);c.vec3.set(this.center,0,0,0);this.bsRadius=0};b.prototype.getCenter=function(){return this.center};b.prototype.getBSRadius=function(){return this.bsRadius};return b}(u);return n})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","../../../../core/ObjectPool","../../../../core/libs/gl-matrix-2/vec3","./IdGen"],function(n,a,d,l,k){return function(){function a(){}
a.prototype.acquire=function(c,d,e,f,b,g){this.id=a._idGen.gen(c&&c.id);this.geometry=c;this.material=d;this.transformation=e;this.instanceParameters=f;this.origin=b;this.shaderTransformation=g};a.prototype.getStaticTransformation=function(){return this.transformation};a.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation};a.prototype.computeAttachmentOrigin=function(a){return(this.material.computeAttachmentOrigin?
this.material.computeAttachmentOrigin(this.geometry,a):this.geometry.computeAttachmentOrigin(a))?(l.vec3.transformMat4(a,a,this.getStaticTransformation()),!0):!1};a._idGen=new k.IdGen;a.pool=new d(a);return a}()})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.IdGen=void 0;n=function(){function a(){this._count=0}a.prototype.gen=function(a){null==a&&(a="a");return a+"_"+this._count++};return a}();a.IdGen=
n})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["require","exports","./IdGen"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.Object3DStateSet=a.generateObject3DStateId=void 0;var l=new d.IdGen;a.generateObject3DStateId=function(a){return{id:l.gen(0===a?"highlight":"occludee"),channel:a}};n=function(){function a(){this.items=[]}a.prototype.addObject=function(a,c){this.items.push({type:0,objectStateId:c,object:a})};a.prototype.addRenderGeometry=function(a,
c,d){this.items.push({type:1,objectStateId:c,renderGeometry:a,owner:d})};a.prototype.addExternal=function(a,c){this.items.push({type:2,objectStateId:c,remove:a})};a.prototype.remove=function(a){for(var c=this.items.length-1;0<=c;--c){var d=this.items[c];d.objectStateId===a&&(this._removeObjectStateItem(d),this.items.splice(c,1))}};a.prototype.removeObject=function(a){for(var c=this.items.length-1;0<=c;--c){var d=this.items[c];0===d.type&&d.object===a&&(this._removeObjectStateItem(d),this.items.splice(c,
1))}};a.prototype.removeRenderGeometry=function(a){for(var c=this.items.length-1;0<=c;--c){var d=this.items[c];1===d.type&&d.renderGeometry===a&&(this._removeObjectStateItem(d),this.items.splice(c,1))}};a.prototype.removeAll=function(){var a=this;this.items.forEach(function(c){a._removeObjectStateItem(c)});this.items=[]};a.prototype._removeObjectStateItem=function(a){switch(a.type){case 0:0===a.objectStateId.channel?a.object.removeHighlight(a.objectStateId):1===a.objectStateId.channel&&a.object.removeOcclude(a.objectStateId);
break;case 1:a.owner.removeRenderGeometryObjectState(a.renderGeometry,a.objectStateId);break;case 2:a.remove(a.objectStateId)}};return a}();a.Object3DStateSet=n})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("require exports ../../../../../core/maybe ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../lib/doublePrecisionUtils ../../lib/Util".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,
"__esModule",{value:!0});a.encodeDoubleVec3=a.calculateTransformRelToOrigin=a.releaseMaterials=a.acquireMaterials=a.isInstanceHidden=a.removeObject3DStateID=a.addObject3DStateID=void 0;a.addObject3DStateID=function(a,b){d.isNone(a)&&(a=[]);a.push(b);return a};a.removeObject3DStateID=function(a,b){if(d.isNone(a))return a;a=a.filter(function(a){return a!==b});return 0===a.length?null:a};a.isInstanceHidden=function(a){return l.isSome(a)?!a.visible:!1};a.acquireMaterials=function(a,b){var c=new Map;c.set(0,
b.acquire(a,0));c.set(3,b.acquire(a,3));c.set(2,b.acquire(a,2));c.set(1,b.acquire(a,1));c.set(4,b.acquire(a,4));return c};a.releaseMaterials=function(a,b){b.release(a,0);b.release(a,3);b.release(a,2);b.release(a,1);b.release(a,4)};a.calculateTransformRelToOrigin=function(a,c,d){var e=a.origin.vec3;h.setMatrixTranslation3(b,-e[0],-e[1],-e[2]);l.isSome(a.transformation)?k.mat4.multiply(c,b,a.transformation):k.mat4.copy(c,b);d&&(k.mat4.invert(d,c),k.mat4.transpose(d,d))};a.encodeDoubleVec3=function(a,
b,d,e,h){m[0]=a.get(b,0);m[1]=a.get(b,1);m[2]=a.get(b,2);c.encodeDoubleArray(m,f,3);d.set(h,0,f[0]);e.set(h,0,f[1]);d.set(h,1,f[2]);e.set(h,1,f[3]);d.set(h,2,f[4]);e.set(h,2,f[5])};var m=new Float64Array(3),f=new Float32Array(6),b=e.mat4f64.create()})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["require","exports"],function(n,a){function d(a,c,d){for(var e=0;e<d;++e)c[2*e]=a[e],c[2*e+1]=a[e]-c[2*e]}Object.defineProperty(a,"__esModule",{value:!0});a.encodeDoubleArraySplit=
a.decodeDoubleArray=a.encodeDoubleArray=a.encodeDouble=void 0;a.encodeDouble=function(a,c){k[0]=a;k[1]=a-k[0];c[0]=k[0];c[1]=k[1]};a.encodeDoubleArray=d;a.decodeDoubleArray=function(a,c,d){for(var e=0;e<d;++e)c[e]=a[2*e]+a[2*e+1]};a.encodeDoubleArraySplit=function(a,c,h,m){for(var e=0;e<m;++e)l[0]=a[e],d(l,k,1),c[e]=k[0],h[e]=k[1]};var l=new Float64Array(1),k=new Float32Array(2)})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/geodesicConstants ./common ../../state/utils/viewUtils ../../support/geometryUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){function p(a,b,e,g){void 0===e&&(e=f.defaultApplyOptions);void 0===g&&(g=!0);A.eyeCenterDistance=0;A.requiresTwoSteps=!1;var m=t(a,b,e,void 0,A);if(0===m)return!1;k.mat4.identity(v);k.mat4.rotate(v,v,-m,b.viewRight);switch(e.tiltMode){case 1:c.vec3.transformMat4(q,b.viewForward,v);c.vec3.scale(q,q,A.eyeCenterDistance);c.vec3.add(b.center,b.eye,q);break;case 0:c.vec3.subtract(q,b.center,b.eye);c.vec3.transformMat4(q,q,v);c.vec3.subtract(b.eye,b.center,q);break;default:d.neverReached(e.tiltMode)}c.vec3.transformMat4(b.up,
b.up,v);b.markViewDirty();return A.requiresTwoSteps&&g?p(a,b,e,!1):!0}function t(a,e,h,k,p){void 0===h&&(h=f.defaultApplyOptions);void 0===k&&(k=f.defaultApplyOptions);if(!a.state.constraints.tilt)return 0;var q=a.state.constraints.tilt(e.distance,x);var v=h;if(0!==v.interactionType){var A=v.interactionStartCamera,C=v.interactionFactor,E=q.min,F=q.max,H=t(a,A,f.defaultApplyOptions,v),G=0===H?0:b.viewAngle(a.renderCoordsHelper,A.center,A.eye);q.min=E;q.max=F;2===v.interactionType?(f.hasConstraintType(v.selection,
2)&&r(a,A,q),f.adjustRangeForInteraction(H,G,!0,C,z,q)):f.adjustRangeForInteraction(H,G,!1,C,z,q)}2===k.interactionType&&f.hasConstraintType(k.selection,2)&&r(a,k.interactionStartCamera,q);if(1===h.tiltMode||1===k.tiltMode){a:switch(p&&(p.requiresTwoSteps=!1),a.viewingMode){case "global":h=B;v=a.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;k=v+m.earthRadius;v=a.renderCoordsHelper.intersectManifold(e.ray,v,w);h.eyeCenterDistance=e.distance;v?(h.eyeCenterDistance=c.vec3.distance(e.eye,
w),h.tiltAtCenter=b.viewAngle(a.renderCoordsHelper,w,e.eye)):a.state.isLocal?h.tiltAtCenter=b.viewAngle(a.renderCoordsHelper,e.center,e.eye):(g.sphere.closestPointOnSilhouette(g.sphere.wrap(k),e.ray,w),h.eyeCenterDistance=c.vec3.distance(e.eye,w),h.tiltAtCenter=l.acosClamped(-c.vec3.dot(e.viewForward,c.vec3.normalize(w,w))));h.radius=k;h.eyeRadius=c.vec3.length(e.eye);h.constraints=a.state.constraints;h.centerIsOnSurface=v;e=l.clamp(h.tiltAtCenter,q.min,q.max);if(1E-9<Math.abs(h.tiltAtCenter-e)){if(h.centerIsOnSurface){e=
h.constraints;a=k=h.tiltAtCenter;q=e.clampTilt(h.eyeCenterDistance,k);v=u(h,q);if(e.clampTilt(v,k)!==q)for(k=0;10>k&&1E-9<Math.abs(q-a);)v=(a+q)/2,A=u(h,v),A=e.clampTilt(A,v),1E-9<Math.abs(A-v)?a=v:q=v,k++;e=q;q=e;a=l.asinClamped(h.radius/h.eyeRadius*Math.sin(h.tiltAtCenter));q=l.asinClamped(h.radius/h.eyeRadius*Math.sin(q));a=h.eyeRadius>h.radius?a-q:q-a}else e=h.constraints.clampTilt(h.eyeCenterDistance,h.tiltAtCenter),p&&e<Math.PI/2&&(p.requiresTwoSteps=!0,e=Math.PI/2-1E-5),a=h.tiltAtCenter-Math.PI/
2-(e-Math.PI/2);p&&(p.eyeCenterDistance=u(h,e));p=a}else p=0;break a;case "local":k=b.viewAngle(a.renderCoordsHelper,e.center,e.eye);h=l.clamp(k,q.min,q.max);q=k-h;1E-9<Math.abs(q)?(p&&(k=a.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a=a.renderCoordsHelper.getAltitude(e.eye)-k,h=Math.cos(h),p.eyeCenterDistance=1E-4<Math.abs(h)?a/h:e.distance),p=q):p=0;break a;default:d.neverReached(a.viewingMode),p=void 0}return p}p=b.viewAngle(a.renderCoordsHelper,e.center,e.eye);e=l.clamp(p,
q.min,q.max);p-=e;p=1E-9<Math.abs(p)?p:0;return p}function u(a,b){if(!a.centerIsOnSurface)return a.eyeCenterDistance;b=Math.PI-l.clamp(b,0,Math.PI);var c=l.asinClamped(a.radius/a.eyeRadius*Math.sin(b)),d=Math.sin(Math.PI-b-c)/Math.sin(b);return a.eyeRadius<a.radius&&1<d?Math.sin(Math.PI-b-(Math.PI-c))/Math.sin(b)*a.eyeRadius:d*a.eyeRadius}function r(a,b,d){if(!a.state.isLocal){var e=a.state.constraints;if(e.altitude){a=c.vec3.squaredLength(b.center);var f=Math.sqrt(a);b=b.distance;var g=e.altitude.min+
m.earthRadius,e=e.altitude.max+m.earthRadius,g=(g*g-b*b-a)/(-2*f*b);d.min=Math.max(d.min,Math.min(Math.PI-l.acosClamped((e*e-b*b-a)/(-2*f*b)),d.max));d.max=Math.min(d.max,Math.PI-l.acosClamped(g))}}}Object.defineProperty(a,"__esModule",{value:!0});a.getTiltConstraintError=a.applyTiltConstraint=void 0;a.applyTiltConstraint=p;a.getTiltConstraintError=t;var q=h.vec3f64.create(),v=e.mat4f64.create(),w=h.vec3f64.create(),z=l.deg2rad(5),x={min:0,max:0},B={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,
eyeCenterDistance:0,tiltAtCenter:0},A={eyeCenterDistance:0,requiresTwoSteps:!1}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.viewAngle=void 0;a.viewAngle=function(a,m,f){a.worldUpAtPosition(m,e);l.vec3.subtract(c,f,m);a=l.vec3.length(c);return 0===a?0:d.acosClamped(l.vec3.dot(c,e)/
a)};var e=k.vec3f64.create(),c=k.vec3f64.create()})},"esri/views/animation/easing":function(){define(["require","exports"],function(n,a){function d(a){return a}function l(a){var c=2*(a-Math.sqrt((a-1)*a)),d=c/2/a;return function(e){return e<d?a*e*e:c*e-c+1}}function k(a,c){return function(d){return d<c?c*a(d/c):1-a((1-d)/(1-c))*(1-c)}}Object.defineProperty(a,"__esModule",{value:!0});a.named=a.inOutCoastQuint=a.outCoastQuint=a.inCoastQuint=a.inOutCoastQuart=a.outCoastQuart=a.inCoastQuart=a.inOutCoastCubic=
a.outCoastCubic=a.inCoastCubic=a.inOutCoastQuad=a.outCoastQuad=a.inCoastQuad=a.inOutCirc=a.outCirc=a.inCirc=a.inOutExpo=a.outExpo=a.inExpo=a.inOutSine=a.outSine=a.inSine=a.inOutQuint=a.outQuint=a.inQuint=a.inOutQuart=a.outQuart=a.inQuart=a.inOutCubic=a.outCubic=a.inCubic=a.inOutQuad=a.outQuad=a.inQuad=a.linear=void 0;a.linear=d;a.inQuad=function(a){return a*a};a.outQuad=function(d){return 1-a.inQuad(1-d)};a.inOutQuad=function(d){return.5>d?a.inQuad(2*d)/2:(a.outQuad(2*(d-.5))+1)/2};a.inCubic=function(a){return a*
a*a};a.outCubic=function(d){return 1-a.inCubic(1-d)};a.inOutCubic=function(d){return.5>d?a.inCubic(2*d)/2:(a.outCubic(2*(d-.5))+1)/2};a.inQuart=function(a){return a*a*a*a};a.outQuart=function(d){return 1-a.inQuart(1-d)};a.inOutQuart=function(d){return.5>d?a.inQuart(2*d)/2:(a.outQuart(2*(d-.5))+1)/2};a.inQuint=function(a){return a*a*a*a*a};a.outQuint=function(d){return 1-a.inQuint(1-d)};a.inOutQuint=function(d){return.5>d?a.inQuint(2*d)/2:(a.outQuint(2*(d-.5))+1)/2};a.inSine=function(a){return-Math.cos(a*
Math.PI/2)+1};a.outSine=function(d){return 1-a.inSine(1-d)};a.inOutSine=function(d){return.5>d?a.inSine(2*d)/2:(a.outSine(2*(d-.5))+1)/2};a.inExpo=function(a){return Math.pow(2,10*(a-1))};a.outExpo=function(d){return 1-a.inExpo(1-d)};a.inOutExpo=function(d){return.5>d?a.inExpo(2*d)/2:(a.outExpo(2*(d-.5))+1)/2};a.inCirc=function(a){return-(Math.sqrt(1-a*a)-1)};a.outCirc=function(d){return 1-a.inCirc(1-d)};a.inOutCirc=function(d){return.5>d?a.inCirc(2*d)/2:(a.outCirc(2*(d-.5))+1)/2};a.inCoastQuad=k(l(1),
1);a.outCoastQuad=k(l(1),0);a.inOutCoastQuad=k(l(1),.5);a.inCoastCubic=k(l(2),1);a.outCoastCubic=k(l(2),0);a.inOutCoastCubic=k(l(2),.5);a.inCoastQuart=k(l(3),1);a.outCoastQuart=k(l(3),0);a.inOutCoastQuart=k(l(3),.5);a.inCoastQuint=k(l(4),1);a.outCoastQuint=k(l(4),0);a.inOutCoastQuint=k(l(4),.5);a.named={linear:d,"in-quad":a.inQuad,"out-quad":a.outQuad,"in-out-quad":a.inOutQuad,"in-coast-quad":a.inCoastQuad,"out-coast-quad":a.outCoastQuad,"in-out-coast-quad":a.inOutCoastQuad,"in-cubic":a.inCubic,"out-cubic":a.outCubic,
"in-out-cubic":a.inOutCubic,"in-coast-cubic":a.inCoastCubic,"out-coast-cubic":a.outCoastCubic,"in-out-coast-cubic":a.inOutCoastCubic,"in-quart":a.inQuart,"out-quart":a.outQuart,"in-out-quart":a.inOutQuart,"in-coast-quart":a.inCoastQuart,"out-coast-quart":a.outCoastQuart,"in-out-coast-quart":a.inOutCoastQuart,"in-quint":a.inQuint,"out-quint":a.outQuint,"in-out-quint":a.inOutQuint,"in-coast-quint":a.inCoastQuint,"out-coast-quint":a.outCoastQuint,"in-out-coast-quint":a.inOutCoastQuint,"in-sine":a.inSine,
"out-sine":a.outSine,"in-out-sine":a.inOutSine,"in-expo":a.inExpo,"out-expo":a.outExpo,"in-out-expo":a.inOutExpo,"in-circ":a.inCirc,"out-circ":a.outCirc,"in-out-circ":a.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports tslib ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector".split(" "),
function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.PointToPointAnimationController=void 0;n=function(a){function h(b){b=a.call(this,b)||this;b.view=null;b.mode="interaction";b.hasTarget=!1;return b}d.__extends(h,a);Object.defineProperty(h.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!1,configurable:!0});h.prototype.initialize=function(){this.animation=new c.default(this.view.state.mode);this.viewAnimation="interaction"===
this.mode?null:new e};Object.defineProperty(h.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!1,configurable:!0});h.prototype.begin=function(a,c){this.hasTarget=!0;c=this.animationSettings(c);b.copyFrom(this.view.state.camera);var d=new f.Intersector(this.view.state.mode);this.intersectionHelper.intersectRay(b.ray,d,g)&&(b.center=g);this.animation.update(b,a,c);this.animation.finished&&this.finish()};h.prototype.finish=function(){this.animation.currentTime=this.animation.time;
a.prototype.finish.call(this)};Object.defineProperty(h.prototype,"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!1,configurable:!0});h.prototype.stepController=function(a,b){this.hasTarget&&this.animation.step(a,b)};h.prototype.onControllerEnd=function(b){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,b),this.animation.currentTime=this.animation.time);a.prototype.onControllerEnd.call(this,b)};h.prototype.animationSettings=
function(a){void 0===a&&(a={});return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};d.__decorate([l.property({constructOnly:!0})],h.prototype,"view",void 0);d.__decorate([l.property({constructOnly:!0})],h.prototype,"mode",void 0);return h=d.__decorate([l.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],h)}(h.AnimationController);
a.PointToPointAnimationController=n;var b=new m.default,g=k.vec3f64.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.Animation=void 0;var h=l.vec3f64.create();n=function(){function a(a){this.currentTime=0;
this.animation=new c.Animation(function(){return new k.default(a)});this._current=new k.default(a)}Object.defineProperty(a.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"time",{get:function(){return this.animation.time},enumerable:!1,configurable:!0});a.prototype.update=function(a,b,c){var e=this.animation.definition.source,f=this.animation.definition.target,g=d.vec3.subtract(h,b.center,a.center),
m=d.vec3.length(g);1E-5<=m?(g[0]/=m,g[1]/=m,g[2]/=m):(g[0]=0,g[1]=1,g[0]=0);d.vec3.copy(e.lookAtDirection,g);d.vec3.copy(f.lookAtDirection,g);e.copyFromRenderCamera(a);f.copyFromRenderCamera(b);this._current.copyFrom(e);this.animation.update(e,f,c);this.currentTime=0;a.almostEquals(b)&&(this.currentTime=this.animation.time)};a.prototype.cameraAt=function(a,b){this.animation.cameraAt(a,this._current);b=b||new e.default;this._current.copyToRenderCamera(b);return b};a.prototype.step=function(a,b){this.finished||
(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,b)};return a}();a.Animation=n;a.default=n})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils".split(" "),function(n,a,d,l,k,e,c,
h){Object.defineProperty(a,"__esModule",{value:!0});var m=c.vec3f64.create(),f=c.vec3f64.create(),b=c.vec3f64.create(),g=c.vec3f64.create(),p=c.vec3f64.create(),t=c.vec3f64.create(),u=c.vec3f64.fromValues(0,0,1),r=c.vec3f64.fromValues(0,1,0),q=c.vec3f64.fromValues(1,0,0),v=k.mat3f64.create();n=function(){function a(a){void 0===a&&(a=1);this.viewingMode=a;this.center=c.vec3f64.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=c.vec3f64.clone(r)}a.prototype.pixelsPerPanAtZoom=function(a){return this.size/
2/(this._zoomToPanScale*a)};a.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};a.prototype.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};a.prototype.compareTo=function(a,b){b||(b={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(1===this.viewingMode){var c=e.vec3.length(this.center),d=e.vec3.length(a.center),c=(c+d)/2;b.pan=h.angle(this.center,a.center)*c}else b.pan=e.vec3.distance(this.center,a.center);c=Math.abs(a.yaw-
this.yaw);c>=Math.PI&&(c=2*Math.PI-c);b.rotate=Math.max(c,Math.abs(a.pitch-this.pitch));b.sourceZoom=this.distance;b.targetZoom=a.distance;return b};a.prototype.interpolate=function(a,b,c){1===this.viewingMode?h.slerp(a.center,b.center,c.pan,this.center):e.vec3.lerp(this.center,a.center,b.center,c.pan);this.distance=d.lerp(a.distance,b.distance,c.zoom);this.pitch=d.lerp(a.pitch,b.pitch,c.rotate);a=a.yaw;b=b.yaw;Math.abs(b-a)>=Math.PI&&(a+=2*(a<b?1:-1)*Math.PI);this.yaw=d.lerp(a,b,c.rotate)};a.prototype.copyFrom=
function(a){e.vec3.copy(this.center,a.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;e.vec3.copy(this.lookAtDirection,a.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};a.prototype.copyFromRenderCamera=function(a){var b=this._lookAtOrientation(a.center,v);e.vec3.copy(this.center,a.center);e.vec3.subtract(g,a.center,a.eye);e.vec3.transformMat3(g,g,b);e.vec3.transformMat3(p,a.up,b);this.distance=e.vec3.length(g);g[0]/=this.distance;g[1]/=this.distance;
g[2]/=this.distance;this.pitch=this._eyeUpToPitch(g);this.yaw=this._eyeUpToYaw(g,p);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};a.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};a.prototype.copyToRenderCamera=function(a){var b=this._lookAtOrientation(this.center,v);l.mat3.transpose(b,b);this._axisAngleVec3(q,this.pitch-Math.PI/2,r,g);this._axisAngleVec3(u,this.yaw,g);this._axisAngleVec3(q,this.pitch-Math.PI/2,u,p);
this._axisAngleVec3(u,this.yaw,p);e.vec3.scale(g,g,this.distance);e.vec3.transformMat3(g,g,b);e.vec3.transformMat3(p,p,b);a.center=this.center;a.eye=e.vec3.subtract(g,this.center,g);a.up=p};a.prototype._axisAngleVec3=function(a,c,d,g){void 0===g&&(g=d);var h=Math.cos(c);c=Math.sin(c);e.vec3.scale(m,d,h);e.vec3.cross(f,a,d);e.vec3.scale(f,f,c);e.vec3.scale(b,a,(1-h)*e.vec3.dot(a,d));return e.vec3.add(g,e.vec3.add(g,m,f),b)};a.prototype._lookAtOrientation=function(a,c){this._upAtLookAt(a,b);e.vec3.cross(m,
this.lookAtDirection,b);e.vec3.normalize(m,m);0===m[0]&&0===m[1]&&0===m[2]&&e.vec3.copy(m,q);e.vec3.cross(f,b,m);e.vec3.normalize(f,f);c||(c=k.mat3f64.create());c[0]=m[0];c[1]=f[0];c[2]=b[0];c[3]=m[1];c[4]=f[1];c[5]=b[1];c[6]=m[2];c[7]=f[2];c[8]=b[2];return c};a.prototype._upAtLookAt=function(a,b){return 2===this.viewingMode?e.vec3.copy(b,u):e.vec3.normalize(b,a)};a.prototype._eyeUpToPitch=function(a){return Math.PI-h.angle(u,a)};a.prototype._eyeUpToYaw=function(a,b){.5>Math.abs(b[2])?(e.vec3.copy(t,
b),0<a[2]&&e.vec3.scale(t,t,-1)):e.vec3.copy(t,a);e.vec3.cross(f,t,u);e.vec3.normalize(f,f);return h.angle(q,f,u)};return a}();a.default=n})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ../../support/geometryUtils/vector ./Util".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,b,c){void 0===a&&(a=f.vec3f64.create());void 0===b&&(b=f.vec3f64.create());void 0===c&&(c=f.vec3f64.fromValues(0,0,1));this._viewUp=f.vec3f64.create();this._viewForward=f.vec3f64.create();this._viewRight=f.vec3f64.create();this._ray=p.ray.createWrapper();this._viewport=g.vec4f64.fromValues(0,0,1,1);this._padding=g.vec4f64.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=h.vec2f64.fromValues(1,
1E3);this._viewDirty=!0;this._viewMatrix=e.mat4f64.create();this._projectionDirty=!0;this._projectionMatrix=e.mat4f64.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=e.mat4f64.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=e.mat4f64.create();this._frustumDirty=!0;this._frustum=p.frustum.create();this._fullViewport=null;this.pixelRatio=1;this.relativeElevation=0;this._eye=f.vec3f64.clone(a);this._center=f.vec3f64.clone(b);this._up=f.vec3f64.clone(c);
this._padding=g.vec4f64.create()}Object.defineProperty(a.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"ray",{get:function(){this._ray.origin=this.eye;this._ray.direction||(this._ray.direction=f.vec3f64.create());
m.vec3.subtract(this._ray.direction,this.center,this.eye);return this._ray},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"viewMatrix",{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(a){k.mat4.copy(this._viewMatrix,a);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=
!0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"nearFar",
{get:function(){return this._nearFar},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"near",{get:function(){return this._nearFar[0]},set:function(a){this._nearFar[0]!==a&&(this._nearFar[0]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"far",{get:function(){return this._nearFar[1]},set:function(a){this._nearFar[1]!==a&&(this._nearFar[1]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=
!0)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"y",{get:function(){return this._viewport[1]},set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"fullHeight",{get:function(){return this._viewport[3]+
this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=g.vec4f64.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"padding",{get:function(){return this._padding},set:function(a){if(this._padding[0]!==a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+
this._padding[2]),b.vec4.copy(this._padding,a),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(k.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=
this.width,b=this.height,c=this.near*Math.tan(this.fovY/2),d=c*this.aspect;k.mat4.frustum(this._projectionMatrix,-d*(1+2*this._padding[3]/a),d*(1+2*this._padding[1]/a),-c*(1+2*this._padding[2]/b),c*(1+2*this._padding[0]/b),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){k.mat4.copy(this._projectionMatrix,a);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"fov",{get:function(){return this._fov},
set:function(a){this._fov=a;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"fovX",{get:function(){return r.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=r.fovx2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"fovY",{get:function(){return r.fovd2fovy(this._fov,this.width,
this.height)},set:function(a){this._fov=r.fovy2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"distance",{get:function(){return m.vec3.distance(this._center,this._eye)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"frustum",{get:function(){this._recomputeFrustum();return this._frustum},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"viewInverseTransposeMatrix",
{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=e.mat4f64.create()),k.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),k.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!1,configurable:!0});a.prototype.depthNDCToWorld=function(a){return 2*this.near*this.far/(this.far+
this.near-(2*a-1)*(this.far-this.near))};Object.defineProperty(a.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/2)/(this.width/2)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"aboveGround",{get:function(){return this.relativeElevation&&0<=this.relativeElevation},enumerable:!1,configurable:!0});a.prototype.copyFrom=
function(a){m.vec3.copy(this._eye,a._eye);m.vec3.copy(this._center,a._center);m.vec3.copy(this._up,a._up);b.vec4.copy(this._viewport,a._viewport);b.vec4.copy(this._padding,a._padding);c.vec2.copy(this._nearFar,a._nearFar);this._fov=a._fov;this.relativeElevation=a.relativeElevation;this._viewDirty=a._viewDirty;this._viewDirty||(k.mat4.copy(this._viewMatrix,a._viewMatrix),m.vec3.copy(this._viewRight,a._viewRight),m.vec3.copy(this._viewUp,a._viewUp),m.vec3.copy(this._viewForward,a._viewForward));a._projectionDirty?
this._projectionDirty=!0:(k.mat4.copy(this._projectionMatrix,a._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;this._frustumDirty=a._frustumDirty;this._frustumDirty||(p.frustum.copy(a._frustum,this._frustum),this._frustumDirty=!1);a._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?k.mat4.copy(this._viewInverseTransposeMatrix,a._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=e.mat4f64.clone(a._viewInverseTransposeMatrix),
this._viewInverseTransposeMatrixDirty=!1);a._fullViewport?this._fullViewport?b.vec4.copy(this._fullViewport,a._fullViewport):this._fullViewport=g.vec4f64.clone(a._fullViewport):this._fullViewport=null;this.pixelRatio=a.pixelRatio;return this};a.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};a.prototype.clone=function(){var b=new a;b.copyFrom(this);return b};a.prototype.equals=function(a){return m.vec3.exactEquals(this._eye,a._eye)&&m.vec3.exactEquals(this._center,
a._center)&&m.vec3.exactEquals(this._up,a._up)&&b.vec4.exactEquals(this._viewport,a._viewport)&&b.vec4.exactEquals(this._padding,a._padding)&&c.vec2.exactEquals(this._nearFar,a._nearFar)&&this._fov===a._fov&&this.pixelRatio===a.pixelRatio&&this.relativeElevation===a.relativeElevation};a.prototype.almostEquals=function(a){if(this.pixelRatio!==a.pixelRatio||.001<=Math.abs(a._fov-this._fov))return!1;var c=1-1E-10;m.vec3.sub(w,a._eye,a._center);m.vec3.sub(z,this._eye,this._center);var d=m.vec3.dot(w,
z),e=m.vec3.sqrLen(w),f=m.vec3.sqrLen(z);return d*d>=c*e*f&&m.vec3.sqrDist(a._eye,this._eye)<2.5E-7*Math.max(e,f)&&.5>b.vec4.squaredDistance(a._padding,this._padding)&&.5>b.vec4.squaredDistance(a._viewport,this._viewport)};a.prototype.markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};a.prototype.computeRenderPixelSizeAt=function(a){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(a))};a.prototype.computeRenderPixelSizeAtDist=function(a){return a*
this.perRenderPixelRatio};a.prototype.computeScreenPixelSizeAt=function(a){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(a))};a.prototype.viewDirectionDistance=function(a){return Math.abs(u.projectPointSignedLength(this.viewForward,m.vec3.subtract(w,a,this._eye)))};a.prototype.computeScreenPixelSizeAtDist=function(a){return a*this.perScreenPixelRatio};a.prototype.computeDistanceFromRadius=function(a,b){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(b||1)))};a.prototype.getScreenCenter=
function(a){void 0===a&&(a=l.createScreenPointArray());a[0]=(this.padding[3]+this.width/2)/this.pixelRatio;a[1]=(this.padding[0]+this.height/2)/this.pixelRatio;return a};a.prototype.getRenderCenter=function(a,b,c){void 0===b&&(b=.5);void 0===c&&(c=.5);a||(a=l.createRenderScreenPointArray3());a[0]=this.padding[3]+this.width*b;a[1]=this.padding[2]+this.height*c;2<a.length&&(a[2]=.5);return a};a.prototype.setGLViewport=function(a){var b=this.viewport,c=this.padding;a.setViewport(b[0]-c[3],b[1]-c[2],
b[2]+c[1]+c[3],b[3]+c[0]+c[2])};a.prototype.applyProjection=function(a,c,e){void 0===e&&(e=!1);a!==q&&m.vec3.copy(q,a);q[3]=1;e&&(c[2]=-q[2]);b.vec4.transformMat4(q,q,this.projectionMatrix);m.vec3.scale(q,q,1/Math.abs(q[3]));a=this.fullViewport;c[0]=d.lerp(0,a[0]+a[2],.5+.5*q[0]);c[1]=d.lerp(0,a[1]+a[3],.5+.5*q[1]);e||(c[2]=.5*(q[2]+1));return c};a.prototype.projectPoint=function(a,c){q[0]=a[0];q[1]=a[1];q[2]=a[2];q[3]=1;b.vec4.transformMat4(q,q,this.viewProjectionMatrix);if(0===q[3])return null;
m.vec3.scale(q,q,1/Math.abs(q[3]));a=this.fullViewport;"x"in c?(c.x=d.lerp(0,a[0]+a[2],.5+.5*q[0]),c.y=d.lerp(0,a[1]+a[3],.5+.5*q[1])):(c[0]=d.lerp(0,a[0]+a[2],.5+.5*q[0]),c[1]=d.lerp(0,a[1]+a[3],.5+.5*q[1]),2<c.length&&(c[2]=.5*(q[2]+1)));return c};a.prototype.unprojectPoint=function(a,c){k.mat4.multiply(v,this.projectionMatrix,this.viewMatrix);if(!k.mat4.invert(v,v))return null;var d=this.fullViewport;q[0]=2*(a[0]-d[0])/d[2]-1;q[1]=2*(a[1]-d[1])/d[3]-1;q[2]=2*a[2]-1;q[3]=1;b.vec4.transformMat4(q,
q,v);if(0===q[3])return null;c[0]=q[0]/q[3];c[1]=q[1]/q[3];c[2]=q[2]/q[3];return c};a.prototype.computeUp=function(a){1===a?this.computeUpGlobal():this.computeUpLocal()};a.prototype.screenToRender=function(a,b){var c=this.fullHeight-a[1]*this.pixelRatio;b[0]=a[0]*this.pixelRatio;b[1]=c;return b};a.prototype.renderToScreen=function(a,b){var c=(this.fullHeight-a[1])/this.pixelRatio;b[0]=a[0]/this.pixelRatio;b[1]=c;return b};a.prototype.computeUpGlobal=function(){m.vec3.subtract(w,this.center,this.eye);
var a=m.vec3.length(this.center);1>a?(m.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(m.vec3.dot(w,this.center))>.9999*m.vec3.length(w)*a||(m.vec3.cross(this.up,w,this.center),m.vec3.cross(this.up,this.up,w),m.vec3.normalize(this.up,this.up),this.markViewDirty())};a.prototype.computeUpLocal=function(){t.directionFromTo(w,this.eye,this.center);.9999>=Math.abs(w[2])&&(m.vec3.scale(w,w,w[2]),m.vec3.set(this.up,-w[0],-w[1],1-w[2]),m.vec3.normalize(this.up,this.up),this.markViewDirty())};a.prototype._compareAndSetView=
function(a,b){m.vec3.exactEquals(a,b)||(m.vec3.copy(b,a),this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0)};a.prototype._recomputeFrustum=function(){this._frustumDirty&&(p.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};a.prototype._ensureViewClean=function(){this._viewDirty&&(k.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),m.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),m.vec3.set(this._viewUp,
this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),m.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return a}();a.default=n;var q=g.vec4f64.create(),v=e.mat4f64.create(),w=f.vec3f64.create(),z=f.vec3f64.create()})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,
"__esModule",{value:!0});a.Animation=void 0;var c={zoom:0,pan:0,rotate:0};n=function(){function a(a){this.createCamera=a;this.time=0;this.definition=new l.Definition(a);this.path=new e.Path}a.prototype.update=function(a,c,b){this.definition.update(a,c,b);this.path.update(this.definition,b);this.time=this._applyTimeSettings(this.path.time,b);this.settings=b};a.prototype.cameraAt=function(a,e){e=e||this.createCamera();a=Math.min(Math.max(0,a),1);a=this.settings.easing?this.normalizedEasing(this.settings.easing,
a):1<=this.time?this.normalizedEasing(d.inOutCoastQuad,a):this.normalizedEasing(d.outExpo,a);a=this.path.interpolateComponentsAt(a,c);e.interpolate(this.definition.source,this.definition.target,a);return e};a.prototype.normalizedEasing=function(a,c){var b=a(0),d=a(1);return(a(c)-b)/(d-b)};a.prototype._applyTimeSettings=function(a,c){var b=null!=c.speedFactor?c.speedFactor:1;null!=c.duration?a=c.duration:null!=c.speedFactor&&(a/=b);return a=Math.min(Math.max(null!=c.minDuration?c.minDuration:k.defaultSettings.minDuration/
b,a),null!=c.maxDuration?c.maxDuration:k.defaultSettings.maxDuration/b)};return a}();a.Animation=n;a.default=n})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.Definition=void 0;n=function(){function a(a){this.createCamera=a;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:d.defaultSettings.desiredScreenFlow};this.source=a();this.target=
a()}a.prototype.clone=function(){var d=new a(this.createCamera);d.copyFrom(this);return d};a.prototype.copyFrom=function(a){this.update(a.source,a.target,a.settings)};a.prototype.update=function(a,e,c){this.source!==a&&this.source.copyFrom(a);this.target!==e&&this.target.copyFrom(e);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=c.desiredScreenFlow?c.desiredScreenFlow:d.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*
this.target.size;this.halfWindowSize=this.target.size/2};a.prototype.halfWindowPanAtZoom=function(a){a=this.target.pixelsPerPanAtZoom(a);return this.halfWindowSize/a};Object.defineProperty(a.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hasRotate",{get:function(){return 1E-9<
this.compared.rotate},enumerable:!1,configurable:!0});return a}();a.Definition=n;a.default=n})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.defaultSettings=void 0;a.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports tslib ../../easing ../Path ../Segment ./planning".split(" "),function(n,a,d,l,k,
e,c){Object.defineProperty(a,"__esModule",{value:!0});a.Path=void 0;n=function(a){function h(c,b){var d=a.call(this)||this;d._preallocSegments=[new e.default,new e.default,new e.default];d.update(c,b);return d}d.__extends(h,a);h.prototype.update=function(a,b){if(a){this.definition?this.definition.copyFrom(a):this.definition=a.clone();var d=null;b&&b.apex&&(d=c.optimalDistance(a,b.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==d?this._updateWithoutApex():this._updateWithApex(d,
b.apex)}};h.prototype.segmentInterpolateComponentsAt=function(a,b,c){c=a.interpolateComponentsAt(b,c);a===this._ascensionSegment?c.zoom=l.outQuad(c.zoom):a===this._descensionSegment&&(c.zoom=l.inQuad(c.zoom));return c};h.prototype._updateWithApex=function(a,b){var c=this._preallocSegments,d=c[0],e=c[1],c=c[2],f=null!=b.ascensionFactor?b.ascensionFactor:.5;b=Math.min(1-f,null!=b.ascensionFactor?b.descensionFactor:.5);var h=1-f-b;d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();
d.definition.compared.targetZoom=a;d.definition.compared.pan=this.definition.compared.pan*f;d.definition.compared.rotate=this.definition.compared.rotate*f;d.update();this._ascensionSegment=d;this.segments.push(d);0<h&&(e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone(),e.definition.copyFrom(this.definition),e.definition.compared.sourceZoom=a,e.definition.compared.targetZoom=a,e.definition.compared.pan=this.definition.compared.pan*h,e.definition.compared.rotate=
this.definition.compared.rotate*h,e.update(),this.segments.push(e));c.definition?c.definition.copyFrom(this.definition):c.definition=this.definition.clone();c.definition.compared.sourceZoom=a;c.definition.compared.pan=this.definition.compared.pan*b;c.definition.compared.rotate=this.definition.compared.rotate*b;c.update();this._descensionSegment=c;this.segments.push(c)};h.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return h}(k.default);
a.Path=n;a.default=n})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.Path=void 0;n=function(){function a(){this.segments=[]}Object.defineProperty(a.prototype,"time",{get:function(){return this.segments.reduce(function(a,d){return a+d.time},0)},enumerable:!1,configurable:!0});a.prototype.interpolateComponentsAt=function(a,d){a=Math.min(Math.max(a,0),1);a*=this.time;for(var e=0,c=0,h=this.definition,
m=0;m<this.segments.length;m++){var f=this.segments[m],b=f.definition;if(a<=f.time||m===this.segments.length-1)return d=this.segmentInterpolateComponentsAt(f,a/f.time,d),d.pan=h.hasPan?(e+b.compared.pan*d.pan)/h.compared.pan:1,d.rotate=h.hasRotate?(c+b.compared.rotate*d.rotate)/h.compared.rotate:1,a=d.zoom*(b.compared.targetZoom-b.compared.sourceZoom)+b.compared.sourceZoom,e=this.segments[0].definition.compared.sourceZoom,c=this.segments[this.segments.length-1].definition.compared.targetZoom,d.zoom=
h.hasZoom?(a-e)/(c-e):1,d;a-=f.time;e+=b.compared.pan;c+=b.compared.rotate}};a.prototype.segmentInterpolateComponentsAt=function(a,d,e){return a.interpolateComponentsAt(d,e)};return a}();a.Path=n;a.default=n})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.Segment=void 0;n=function(){function a(a){a&&this.update(a)}a.prototype.update=function(a){a&&(this.definition?this.definition.copyFrom(a):this.definition=
a.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};a.prototype._updatePrecomputedVariables=function(){var a=this.definition,d=a.compared,e=d.sourceZoom,c=d.targetZoom;this._zoomSign=e>c?1:-1;this._panPixelsAtSource=d.pan*a.source.pixelsPerPanAtZoom(e);a=(a.source.pixelsPerRotateAtZoom(e)+a.target.pixelsPerRotateAtZoom(c))/2;this._rotatePixels=d.rotate*a};a.prototype._updatePixelFlow=function(){var a=this.definition.compared.sourceZoom,d=this.definition.compared.targetZoom,e=this.definition,
c=e.hasZoom,h=e.hasPan,e=e.hasRotate,m=0,f=0;c&&(h&&(m=(d/a-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),e&&(f=Math.log(a/d)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;a=this.definition.desiredPixelFlow;c&&h&&e?(d=m+f+m*f,this._zoomPixelFlow=m*f/d*a,this._panPixelFlow=f/d*a,this._rotatePixelFlow=m/d*a):c&&h?(d=1+m,this._zoomPixelFlow=m/d*a,this._panPixelFlow=
1/d*a):c&&e?(d=1+f,this._zoomPixelFlow=f/d*a,this._rotatePixelFlow=1/d*a):h&&e?(m=this._panPixelsAtSource/this._rotatePixels,d=1+m,this._panPixelFlow=m/d*a,this._rotatePixelFlow=1/d*a):h?this._panPixelFlow=a:c?this._zoomPixelFlow=a:e&&(this._rotatePixelFlow=a);this.time=e?this.rotateTime:c?this.zoomTime:h?this.panTime:0};Object.defineProperty(a.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*
this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow:0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var a=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*a+1)/(a*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"rotateTime",{get:function(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0},enumerable:!1,configurable:!0});a.prototype._interpolateComponentsZoom=function(a){if(0===a||1===a)return a;if(this.definition.hasZoom){var d=this.definition.compared.sourceZoom,e=this.definition.compared.targetZoom;return(d*Math.pow(d/e,-a)-d)/(e-d)}return a};a.prototype._interpolateComponentsPan=function(a){if(0===a||1===a)return a;if(this.definition.hasPan&&this.definition.hasZoom){var d=-1/
(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,d*a*this.time)-1)/(d*Math.LN2)}return a};a.prototype._interpolateComponentsRotate=function(a){return a};a.prototype.interpolateComponentsAt=function(a,d){a=Math.min(Math.max(a,0),1);var e=this._interpolateComponentsZoom(a),c=this._interpolateComponentsPan(a);a=this._interpolateComponentsRotate(a);d?(d.zoom=e,d.pan=c,d.rotate=a):d={zoom:e,pan:c,rotate:a};return d};return a}();
a.Segment=n;a.default=n})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require","exports","./functions"],function(n,a,d){function l(a,d){var c=Math.max(a.compared.sourceZoom,a.compared.targetZoom);a=a.source.zoomAtPixelsPerPan(a.desiredPixelFlow/a.compared.pan)/2;return a<c?null!=d.maximumDistance?c+(d.maximumDistance-c)/2:1.5*c:d.maximumDistance?Math.min(d.maximumDistance,a):a}Object.defineProperty(a,"__esModule",{value:!0});a.optimalDistance=void 0;a.optimalDistance=function(a,
e){var c=l(a,e),h={ascensionFactor:null!=e.ascensionFactor?e.ascensionFactor:.5,descensionFactor:null!=e.descensionFactor?e.descensionFactor:.5},m=0===h.ascensionFactor,f=0===h.descensionFactor,b=m?d.tAscensionZoomOnly:d.tAscensionZoomPan,g=m?d.dtAscensionZoomOnly:d.dtAscensionZoomPan,k=m?d.ddtAscensionZoomOnly:d.ddtAscensionZoomPan,t=f?d.tDescensionZoomOnly:d.tDescensionZoomPan,u=f?d.dtDescensionZoomOnly:d.dtDescensionZoomPan,r=f?d.ddtDescensionZoomOnly:d.ddtDescensionZoomPan,m=function(c){return b(a,
c,h)+d.tPanion(a,c,h)+t(a,c,h)},f=function(b){return g(a,b,h)+d.dtPanion(a,b,h)+u(a,b,h)},q=function(b){return k(a,b,h)+d.ddtPanion(a,b,h)+r(a,b,h)},v=m(c),w=d.tBaseLine(a),z=e.maximumIterations||20,x=null!=e.maximumDistance?e.maximumDistance:Infinity;for(e=0;e<z;e++){var B=(f(c)+1E-6)/q(c);if(isNaN(B)||c>=x&&0>B){if(!isFinite(x))return null;c=x;v=m(c);break}c-=B;if(c<a.compared.sourceZoom||c<a.compared.targetZoom)return null;B=m(c);if(.005>=Math.abs(B-v)/v)break;v=B}return v>.7*w||c<a.compared.sourceZoom||
c<a.compared.targetZoom?null:c}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.tBaseLine=a.ddtDescensionZoomOnly=a.dtDescensionZoomOnly=a.tDescensionZoomOnly=a.ddtDescensionZoomPan=a.dtDescensionZoomPan=a.tDescensionZoomPan=a.ddtPanion=a.dtPanion=a.tPanion=a.ddtAscensionZoomOnly=a.dtAscensionZoomOnly=a.tAscensionZoomOnly=a.ddtAscensionZoomPan=a.dtAscensionZoomPan=a.tAscensionZoomPan=void 0;
a.tAscensionZoomPan=function(a,l,k){var d=a.halfWindowPanAtZoom(l-a.compared.sourceZoom);return-a.halfWindowSize*(k.ascensionFactor*Math.LN2*a.compared.pan+d)*Math.log(a.compared.sourceZoom/l)/(a.desiredPixelFlow*Math.LN2*d)};a.dtAscensionZoomPan=function(a,l,k){var d=1/l,c=Math.log(a.compared.sourceZoom*d),h=1/a.desiredPixelFlow,m=1/Math.LN2;l-=a.compared.sourceZoom;var f=1/l;k=(k.ascensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(l))/a.halfWindowPanAtZoom(1);return a.halfWindowSize*d*
h*m*f*k-a.halfWindowSize*c*h*m*f+a.halfWindowSize*c*h*m*k/(l*l)};a.ddtAscensionZoomPan=function(a,l,k){var d=l-a.compared.sourceZoom,c=1/d,h=1/l,m=Math.log(a.compared.sourceZoom*h);k=(k.ascensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(d))/a.halfWindowPanAtZoom(1);return a.halfWindowSize*c*(-2*c*h*k+2*c*m+2*h-2*m*k/(d*d)-k/(l*l))/(a.desiredPixelFlow*Math.LN2)};a.tAscensionZoomOnly=function(a,l){return-a.halfWindowSize*Math.log(a.compared.sourceZoom/l)/(a.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomOnly=
function(a,l){return a.halfWindowSize/(l*a.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomOnly=function(a,l){return-a.halfWindowSize/(l*l*a.desiredPixelFlow*Math.LN2)};a.tPanion=function(a,l,k){return-a.compared.pan*a.halfWindowSize*(k.ascensionFactor+k.descensionFactor-1)/(a.desiredPixelFlow*a.halfWindowPanAtZoom(l))};a.dtPanion=function(a,l,k){return a.compared.pan*a.halfWindowSize*(k.ascensionFactor+k.descensionFactor-1)/(a.desiredPixelFlow*a.halfWindowPanAtZoom(l*l))};a.ddtPanion=function(a,l,
k){return-2*a.compared.pan*a.halfWindowSize*(k.ascensionFactor+k.descensionFactor-1)/(a.desiredPixelFlow*a.halfWindowPanAtZoom(l*l*l))};a.tDescensionZoomPan=function(a,l,k){return a.halfWindowSize*(-a.halfWindowPanAtZoom(l)-k.descensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(a.compared.targetZoom))*Math.log(l/a.compared.targetZoom)/(a.desiredPixelFlow*Math.LN2*a.halfWindowPanAtZoom(-l+a.compared.targetZoom))};a.dtDescensionZoomPan=function(a,l,k){var d=Math.log(l/a.compared.targetZoom),
c=1/a.desiredPixelFlow,h=1/Math.LN2,m=-l+a.compared.targetZoom,f=1/m;k=(-a.halfWindowPanAtZoom(l)-k.descensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(a.compared.targetZoom))/a.halfWindowPanAtZoom(1);return-a.halfWindowSize*d*c*h*f+a.halfWindowSize*d*c*h*k/(m*m)+a.halfWindowSize*c*h*f*k/l};a.ddtDescensionZoomPan=function(a,l,k){var d=l-a.compared.targetZoom,c=1/d,h=1/l,m=Math.log(l/a.compared.targetZoom);k=(a.halfWindowPanAtZoom(l)+k.descensionFactor*Math.LN2*a.compared.pan-a.halfWindowPanAtZoom(a.compared.targetZoom))/
a.halfWindowPanAtZoom(1);return a.halfWindowSize*c*(-2*c*h*k-2*c*m+2*h+2*m*k/(d*d)-k/(l*l))/(a.desiredPixelFlow*Math.LN2)};a.tDescensionZoomOnly=function(a,l){return a.halfWindowSize*Math.log(l/a.compared.targetZoom)/(a.desiredPixelFlow*Math.LN2)};a.dtDescensionZoomOnly=function(a,l){return a.halfWindowSize/(l*a.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(a,l){return-a.halfWindowSize/(l*l*a.desiredPixelFlow*Math.LN2)};a.tBaseLine=function(a){var d=Math.LN2*a.compared.pan,k=a.halfWindowPanAtZoom(a.compared.sourceZoom-
a.compared.targetZoom),e=a.halfWindowSize*Math.log(a.compared.sourceZoom/a.compared.targetZoom)/(a.desiredPixelFlow*Math.LN2*k);return a.compared.sourceZoom<=a.compared.targetZoom?e*(d-k):e*(d+k)}})},"esri/views/3d/state/controllers/AnimationController":function(){define("require exports tslib ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../ViewAnimation ./CameraController".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",
{value:!0});a.AnimationController=void 0;n=function(a){function f(){return null!==a&&a.apply(this,arguments)||this}d.__extends(f,a);Object.defineProperty(f.prototype,"canStop",{get:function(){return!0},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(a){this._asyncResult&&(this._asyncResult.reject(k.createAbortError()),this._asyncResult=null);this.state===h.State.Finished||this.state===h.State.Stopped?this.state===
h.State.Finished?a.resolve():a.reject(k.createAbortError()):this._asyncResult=a},enumerable:!1,configurable:!0});f.prototype.onControllerStart=function(){var a=this;this.state=h.State.Running;l.isSome(this.viewAnimation)&&this.viewAnimation.when(function(){return a.updateStateFromViewAnimation()},function(){return a.updateStateFromViewAnimation()})};f.prototype.updateStateFromViewAnimation=function(){!l.isSome(this.viewAnimation)||this.state!==h.State.Ready&&this.state!==h.State.Running||(this.viewAnimation.state===
c.State.FINISHED?this.finish():this.viewAnimation.state===c.State.STOPPED&&(this.state=h.State.Stopped))};f.prototype.onControllerEnd=function(){l.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===h.State.Finished?this.viewAnimation.finish():this.state===h.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===h.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(k.createAbortError()))};f.prototype.finish=function(){this.finishController()};return f=
d.__decorate([e.subclass("esri.views.3d.state.controllers.AnimationController")],f)}(h.CameraController);a.AnimationController=n})},"esri/views/3d/state/controllers/CameraController":function(){define(["require","exports","tslib","../../../../core/Accessor","../../../../core/accessorSupport/decorators"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.CameraController=a.State=void 0;var e;(function(a){a.Ready="ready";a.Rejected="rejected";a.Running="running";a.Stopped="stopped";
a.Finished="finished"})(e=a.State||(a.State={}));n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.state=e.Ready;return c}d.__extends(c,a);Object.defineProperty(c.prototype,"active",{get:function(){return this.state===e.Running},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"isInteractive",{get:function(){return!1},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"canStop",{get:function(){return!1},enumerable:!1,configurable:!0});c.prototype.stopController=
function(){return this.canStop?(this.state=e.Stopped,!0):!1};c.prototype.finishController=function(){this.state=e.Finished};Object.defineProperty(c.prototype,"steppingFinished",{get:function(){return!1},enumerable:!1,configurable:!0});d.__decorate([k.property({readOnly:!0,dependsOn:["state"]})],c.prototype,"active",null);d.__decorate([k.property()],c.prototype,"state",void 0);return c=d.__decorate([k.subclass("esri.views.3d.state.controllers.CameraController")],c)}(l);a.CameraController=n})},"esri/views/3d/state/utils/navigationUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/geodesicConstants ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../support/geometryUtils/coordinateSystem ../../webgl-engine/lib/Camera".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){function q(a,b,c){var d=t.sm4d.get();k.mat4.identity(d);k.mat4.rotate(d,d,c[3],g.axisAngle.axis(c));m.vec3.subtract(a.eye,a.eye,b);m.vec3.transformMat4(a.eye,a.eye,d);m.vec3.add(a.eye,a.eye,b);m.vec3.subtract(a.center,a.center,b);m.vec3.transformMat4(a.center,a.center,d);m.vec3.add(a.center,a.center,b);m.vec3.transformMat4(a.up,a.up,d);a.markViewDirty()}function v(a,b){m.vec3.set(b,0,0,0);for(var c=0;c<a.length;c++)m.vec3.add(b,b,a[c]);m.vec3.scale(b,b,1/
a.length)}function w(a,c,d){return Math.sin(a/m.vec3.length(c))*(d+b.earthRadius)}function z(a,b,c,d){c=g.ray.fromScreenAtEye(b,c,va);g.sphere.closestPointOnSilhouette(a,c,Q);return g.sphere.intersectRay(a,c,d)?m.vec3.squaredDistance(Q,c.origin)<m.vec3.squaredDistance(d,c.origin)?(m.vec3.copy(d,Q),!1):!0:(m.vec3.subtract(R,b.eye,b.center),m.vec3.normalize(R,R),g.plane.fromNormalAndOffset(R,-m.vec3.dot(m.vec3.normalize(R,R),Q),O),g.plane.intersectRay(O,c,d),!1)}function x(b,c,e,f,g,h){m.vec3.cross(pa,
b,c);m.vec3.subtract(ka,b,c);m.vec3.length(b)<=g||!f.aboveGround?(m.vec3.cross(e,ka,f.eye),b=m.vec3.dot(b,c)/(m.vec3.length(b)*m.vec3.length(c)),h=Math.cos(d.clamp(p.cyclicalPI.normalize(d.deg2rad(h)),0,a.TiltThresholdPanningSpeed)),c=-d.acosClamped(b)-Math.max(0,m.vec3.length(c)-g)/(h*g)):(m.vec3.subtract(N,f.eye,f.center),m.vec3.cross(e,ka,N),c=-m.vec3.length(ka)/g);m.vec3.normalize(e,e);m.vec3.scale(e,e,m.vec3.length(pa));return c}function B(b,c,e,f){f=Math.cos(d.clamp(p.cyclicalPI.normalize(d.deg2rad(f)),
0,a.TiltThresholdPanningSpeed));c=c>e?-(c-e)/(f*e):c<-e?Math.PI-(c+e)/(f*e):d.acosClamped(c/e);return((b>e?-(b-e)/(f*e):b<-e?Math.PI-(b+e)/(f*e):d.acosClamped(b/e))-c)*e}function A(a,b,d,e,f,g,h,k,p,r){p=B(a[2],b[2],h.radius,p);b=r?B(a[0],b[0],h.radius,180):b[0]-a[0];a=Math.sin(k)*b-Math.cos(k)*p;k=Math.cos(k)*b+Math.sin(k)*p;m.vec3.normalize(fa,f);f=r?a/Math.sqrt(Math.abs(Math.pow(h.radius,2)-Math.pow(m.vec3.dot(d,fa),2))):a/h.radius;d=k/Math.sqrt(Math.abs(Math.pow(h.radius,2)-Math.pow(m.vec3.dot(d,
e),2)));c.vec2.set(g,f,d)}function C(a,b,c,d,e,f,g,h,k,p){m.vec3.cross(pa,a,b);u.coordinateSystemFromOneAxisAndNormalVector(f.up,f.eye,Z,V,T);u.coordinateSystemFromOneAxisAndNormalVector([0,0,1],f.eye,S,P,U);m.vec3.copy(c,P);m.vec3.copy(d,S);m.vec3.normalize(c,c);m.vec3.scale(c,c,m.vec3.length(pa));u.vectorCoordinates(a,m.vec3.normalize(V,V),m.vec3.normalize(T,T),m.vec3.normalize(Z,Z),Y);u.vectorCoordinates(b,V,T,Z,X);A(Y,X,a,S,P,e,g,h,k,p)}function E(a,b,c,d,e,f,g){k.mat4.identity(ga);k.mat4.identity(ia);
k.mat4.identity(ha);k.mat4.rotate(ga,ga,e,d);k.mat4.rotate(ia,ia,g,f);k.mat4.multiply(ha,ga,ia);m.vec3.subtract(b,a,c);m.vec3.transformMat4(b,b,ha);m.vec3.add(b,b,c)}function G(a,b,c,d,e,f){k.mat4.identity(ga);k.mat4.identity(ia);k.mat4.identity(ha);k.mat4.rotate(ga,ga,d,c);k.mat4.rotate(ia,ia,f,e);k.mat4.multiply(ha,ga,ia);m.vec3.subtract(a.eye,a.eye,b);m.vec3.transformMat4(a.eye,a.eye,ha);m.vec3.add(a.eye,a.eye,b);m.vec3.subtract(a.center,a.center,b);m.vec3.transformMat4(a.center,a.center,ha);m.vec3.add(a.center,
a.center,b);m.vec3.subtract(a.up,a.up,b);m.vec3.transformMat4(a.up,a.up,ha);m.vec3.add(a.up,a.up,b);a.markViewDirty()}function F(b,c,d,e,f,g,h,m){void 0===h&&(h=a.PreservingHeadingThreshold.Pole);void 0===m&&(m=a.PreservingHeadingThreshold.Angle);b=Math.abs(b[2])<d*h||Math.abs(c)>d;return(Math.abs(e)>Math.PI-m||Math.abs(e)<m)&&b&&g.aboveGround&&f<a.PreservingHeadingThreshold.Tilt?!0:!1}function H(a,b,c,d,e,f){f?(g.axisAngle.fromPoints(c,d,ba),q(b,a.center,ba)):(c=x(c,d,na,b,a.radius,e),q(b,a.center,
g.axisAngle.wrapAxisAngle(na,c)))}function J(a,b,c,d,e,f,g){var h=g?20:1;m.vec3.copy(da,d);ja.copyFrom(b);for(var k,p=0;p<h&&1E-12<m.vec3.squaredDistance(c,da);p++)if(d=m.vec3.squaredDistance(c,da),C(c,da,P,S,ca,ja,a,e,f,g),G(ja,a.center,S,ca[1],P,ca[0]),E(da,da,a.center,S,ca[1],P,ca[0]),k=m.vec3.squaredDistance(c,da),k<d||0===p)b.copyFrom(ja);else break}Object.defineProperty(a,"__esModule",{value:!0});a.panMotionToRotationMatrix=a.panToPosition=a.applyPanSphericalPreserveHeading=a.applyPanSphericalDirectRotation=
a.preserveHeadingThreshold=a.applyRotationWithTwoAxes=a.rotatePointAroundTwoAxes=a.rotationAnglesAndAxesHeadingPreserving=a.rotationAnglesHeadingPreserving=a.lengthFromPoints=a.rotationAngleAndAxisDirectRotation=a.sphereOrPlanePointFromScreenPoint=a.applyPanPlanar=a.decidePanMode=a.pickPointAndInitSphere=a.TiltThresholdPanningSpeed=a.PreservingHeadingThreshold=a.VerticalPanTresholds=a.PanMode=a.offSurfaceTiltToEyeTiltGlobal=a.onSurfaceTiltToEyeTiltGlobal=a.centroid=a.centroidOnSphere=a.applyZoomOnSphere=
a.applyZoomToPoint=a.intersectPlaneFromScreenPoint=a.applyRotation=a.normalizeRotationDelta=a.rotationFromPointsAroundAxis=a.normalizeCoordinate=a.Earth=void 0;a.Earth=g.sphere.fromValues(b.earthRadius,f.vec3f64.create());a.normalizeCoordinate=function(a,b,c){c[0]=b[0]/(a.fullWidth/a.pixelRatio);c[1]=b[1]/(a.fullHeight/a.pixelRatio);return c};a.rotationFromPointsAroundAxis=function(a,b,c){var d=t.sv3d.get(),e=t.sv3d.get(),f=t.sv3d.get();m.vec3.copy(e,a);m.vec3.copy(f,b);a=m.vec3.dot(e,c);b=m.vec3.dot(f,
c);m.vec3.scale(d,c,a);m.vec3.subtract(e,e,d);m.vec3.normalize(e,e);m.vec3.scale(d,c,b);m.vec3.subtract(f,f,d);m.vec3.normalize(f,f);a=m.vec3.dot(e,f);m.vec3.cross(d,c,e);c=m.vec3.dot(f,d);return Math.atan2(c,a)};a.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};a.applyRotation=q;a.intersectPlaneFromScreenPoint=function(a,b,c,d){return g.plane.intersectRay(a,g.ray.fromScreen(b,c,va),d)};a.applyZoomToPoint=function(a,b,c,d){var e=t.sv3d.get();
c=1-c;m.vec3.subtract(e,b,a.eye);var f=m.vec3.length(e),g=f*(1-c);0<=c&&g<d&&(g=d,c=-(g-f)/f);1E-6>Math.abs(f-g)||(m.vec3.scale(e,e,c),m.vec3.add(a.eye,a.eye,e),m.vec3.lerp(a.center,a.center,b,c))};a.applyZoomOnSphere=function(a,b,c){b.getScreenCenter(I);g.sphere.intersectScreen(a,b,I,b.center);b.markViewDirty();a=b.distance;c*=a;1E-6>Math.abs(a-c)||(c=m.vec3.scale(t.sv3d.get(),b.viewForward,c),m.vec3.subtract(b.eye,b.center,c),b.markViewDirty())};var I=l.createScreenPointArray();a.centroidOnSphere=
function(a,b,c){v(b,c);m.vec3.normalize(c,c);m.vec3.scale(c,c,a)};a.centroid=v;a.onSurfaceTiltToEyeTiltGlobal=w;a.offSurfaceTiltToEyeTiltGlobal=function(a,b,c){return w(Math.PI/2,b,c)+(a-Math.PI/2)};var K;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(K=a.PanMode||(a.PanMode={}));a.VerticalPanTresholds={Elevation:3E4,Angle:d.deg2rad(8)};a.PreservingHeadingThreshold={Pole:.95,Angle:d.deg2rad(18),Tilt:45};a.TiltThresholdPanningSpeed=d.deg2rad(80);a.pickPointAndInitSphere=function(b,
c,d,e){var h=f.vec3f64.create(),k=g.sphere.create(),p=!0;b.intersectScreen(d,h)?k.radius=m.vec3.length(h):(k.radius=c.aboveGround?Math.max(m.vec3.length(c.center),.9*a.Earth.radius):m.vec3.length(c.eye)-c.relativeElevation,e?z(k,c,d,h):p=g.sphere.intersectScreen(k,c,d,h));return{sphere:k,scenePickPoint:p?h:null}};a.decidePanMode=function(b,c,e){var f=m.vec3.length(b.eye);if(Math.abs(f-a.Earth.radius)>a.VerticalPanTresholds.Elevation)return K.Horizontal;if(b.aboveGround===c.radius>f)return K.Vertical;
m.vec3.subtract(L,b.eye,e);m.vec3.normalize(L,L);return Math.abs(.5*Math.PI-d.acosClamped(m.vec3.dot(e,L)/m.vec3.length(e)))<a.VerticalPanTresholds.Angle?K.Vertical:K.Horizontal};var L=f.vec3f64.create();a.applyPanPlanar=function(a,b,c){m.vec3.subtract(M,c,b);m.vec3.subtract(a.eye,a.eye,M);m.vec3.subtract(a.center,a.center,M);a.markViewDirty()};var M=f.vec3f64.create();a.sphereOrPlanePointFromScreenPoint=z;var Q=f.vec3f64.create(),R=f.vec3f64.create(),O=g.plane.create();a.rotationAngleAndAxisDirectRotation=
x;var N=f.vec3f64.create();a.lengthFromPoints=B;a.rotationAnglesHeadingPreserving=A;a.rotationAnglesAndAxesHeadingPreserving=C;a.rotatePointAroundTwoAxes=E;a.applyRotationWithTwoAxes=G;a.preserveHeadingThreshold=F;a.applyPanSphericalDirectRotation=H;a.applyPanSphericalPreserveHeading=J;a.panToPosition=function(b,c,e,f,g,h,k){F(e,m.vec3.dot(c.up,e),b.radius,-p.cyclicalPI.normalize(d.deg2rad(g)),h,c,a.PreservingHeadingThreshold.Pole,a.PreservingHeadingThreshold.Angle)?J(b,c,e,f,-p.cyclicalPI.normalize(d.deg2rad(g)),
h,k):H(b,c,e,f,h,k)};a.panMotionToRotationMatrix=function(a,b,c,e,f,g,h,r,l){if(F(a.center,m.vec3.dot(a.up,a.center),m.vec3.length(a.center),-p.cyclicalPI.normalize(d.deg2rad(g)),h,b))switch(a=-p.cyclicalPI.normalize(d.deg2rad(f)),u.coordinateSystemFromOneAxisAndNormalVector([0,0,1],b.eye,S,P,U),f=c.translation[0]*e.pan,g=c.translation[1]*e.pan,b=Math.max(Math.sqrt(Math.abs(1-Math.pow(m.vec3.dot(b.center,S),2)/Math.pow(m.vec3.length(b.center),2))),.5),h=-Math.cos(a)*g+Math.sin(a)*f,k.mat4.rotate(r.pan.matrix,
r.pan.matrix,(Math.sin(a)*g+Math.cos(a)*f)/b,S),r.pan.enabled=!0,l.mode){case "pan":k.mat4.rotate(r.pan.matrix,r.pan.matrix,h,P);r.pan.enabled=!0;break;case "zoom":r.zoom=-c.translation[1]*e.zoom}else switch(a=b.eye,b=b.viewRight,a=m.vec3.cross(t.sv3d.get(),b,a),f=c.translation[0]*e.pan,0!==f&&(k.mat4.rotate(r.pan.matrix,r.pan.matrix,-f,a),r.pan.enabled=!0),l.mode){case "pan":c=c.translation[1]*e.pan;0!==c&&(k.mat4.rotate(r.pan.matrix,r.pan.matrix,c,b),r.pan.enabled=!0);break;case "zoom":r.zoom=-c.translation[1]*
e.zoom}};var S=f.vec3f64.create(),P=f.vec3f64.create(),U=f.vec3f64.create(),Z=f.vec3f64.create(),V=f.vec3f64.create(),T=f.vec3f64.create(),Y=f.vec3f64.create(),X=f.vec3f64.create(),ca=h.vec2f64.create(),ba=g.axisAngle.create(),ga=e.mat4f64.create(),ia=e.mat4f64.create(),ha=e.mat4f64.create(),da=f.vec3f64.create(),fa=f.vec3f64.create(),ka=f.vec3f64.create(),ja=new r.default,pa=f.vec3f64.create(),na=f.vec3f64.create(),va={origin:f.vec3f64.create(),direction:f.vec3f64.create()}})},"esri/views/3d/support/geometryUtils/coordinateSystem":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,d,l,k){function e(a){return{operations:a,value:a.create()}}function c(a,c,d,e){return a.operations.setAltitudeAt(a.value,c,d,e)}Object.defineProperty(a,"__esModule",{value:!0});a.coordinateSystemFromOneAxisAndNormalVector=a.vectorCoordinates=a.elevate=a.setAltitudeOfTransformation=a.setAltitudeAt=a.altitudeAt=a.distanceToSilhouette=a.closestPointOnSilhouette=
a.intersectRayClosestSilhouette=a.closestPoint=a.intersectsRay=a.intersectRay=a.axisAt=a.normalAt=a.wrap=a.fromValues=a.createFromOperations=a.setExtent=a.create=void 0;a.create=function(a){var b=a.operations;return{operations:b,value:b.create(a.value)}};a.setExtent=function(a,c,d){a.operations.setExtent(a.value,c,d.value);return d};a.createFromOperations=e;a.fromValues=function(a,c,d){void 0===d&&(d=e(a));d.operations=a;a.copy(c,d.value);return d};a.wrap=function(a,c){m.operations=a;m.value=c;return m};
a.normalAt=function(a,c,d){return a.operations.axisAt(a.value,c,2,d)};a.axisAt=function(a,c,d,e){return a.operations.axisAt(a.value,c,d,e)};a.intersectRay=function(a,c,d){return a.operations.intersectRay(a.value,c,d)};a.intersectsRay=function(a,c){return a.operations.intersectRay(a.value,c,null)};a.closestPoint=function(a,c,d){return a.operations.closestPoint(a.value,c,d)};a.intersectRayClosestSilhouette=function(a,c,d){return a.operations.intersectRayClosestSilhouette(a.value,c,d)};a.closestPointOnSilhouette=
function(a,c,d){return a.operations.closestPointOnSilhouette(a.value,c,d)};a.distanceToSilhouette=function(a,c){return a.operations.distanceToSilhouette(a.value,c)};a.altitudeAt=function(a,c){return a.operations.altitudeAt(a.value,c)};a.setAltitudeAt=c;a.setAltitudeOfTransformation=function(a,e,f,m){e!==m&&d.mat4.copy(m,e);l.vec3.set(h,m[12],m[13],m[14]);c(a,h,f,h);m[12]=h[0];m[13]=h[1];m[14]=h[2];return m};a.elevate=function(a,c,d){return a.operations.elevate(a.value,c,d.value)};var h=k.vec3f64.create(),
m={operations:null,value:null};a.vectorCoordinates=function(a,c,d,e,f){f[0]=l.vec3.dot(a,c);f[1]=l.vec3.dot(a,d);f[2]=l.vec3.dot(a,e);return f};a.coordinateSystemFromOneAxisAndNormalVector=function(a,c,d,e,h){l.vec3.copy(d,a);l.vec3.copy(f,c);l.vec3.normalize(f,f);l.vec3.cross(e,f,d);l.vec3.cross(h,e,d)};var f=k.vec3f64.create()})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.ZoomStepController=void 0;n=function(a){function g(){var b=null!==a&&a.apply(this,arguments)||this;b.zoomLocation=e.vec3f64.create();b.tmpCamera=new m.default;b.tmpRayDir=e.vec3f64.create();b.tmpCenter=e.vec3f64.create();b.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new m.default,interactionDirection:null,tiltMode:0};return b}d.__extends(g,a);g.prototype.zoomStep=
function(a,b){if(this.active){var c=this.view.state,d=this.constraintOptions.interactionStartCamera;this.animation.finished?d.copyFrom(c.camera):this.animation.cameraAt(1,d);this.tmpCamera.copyFrom(c.camera);c=new f.Intersector(this.view.state.mode);0<a?(this.intersectionHelper.intersectScreenFreePointFallback(b,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,c,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,
c,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:k.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation);this.begin(this.tmpCamera)}};g.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:b.outExpo}};g.prototype.updateCamera=function(a,b,d){k.vec3.subtract(this.tmpRayDir,d,a.eye);var e=k.vec3.length(this.tmpRayDir),f=e*b;1>=b&&4>f&&(f=4,b=f/e);1E-6>Math.abs(e-f)||(k.vec3.scale(this.tmpRayDir,this.tmpRayDir,
b),k.vec3.subtract(a.eye,d,this.tmpRayDir),k.vec3.lerp(a.center,a.center,d,1-b),c.applyAll(this.view,a,this.constraintOptions))};return g=d.__decorate([l.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],g)}(h.PointToPointAnimationController);a.ZoomStepController=n})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.eventMatchesMousePointerAction=a.eventMatchesPointerAction=void 0;a.eventMatchesPointerAction=
function(a,l){switch(l){case "primary":return"touch"===a.pointerType||0===a.button;case "secondary":return"touch"!==a.pointerType&&2===a.button;case "tertiary":return"touch"!==a.pointerType&&1===a.button}};a.eventMatchesMousePointerAction=function(a,l){if("touch"===a.pointerType)return!1;switch(l){case "primary":return 0===a.button;case "secondary":return 2===a.button;case "tertiary":return 1===a.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports tslib ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.DragRotate=void 0;n=function(a){function e(c,b,d,e){var f=a.call(this,!0)||this;f.view=c;f.pointerAction=b;f.pivotPoint=d;f.registerIncoming("drag",e,function(a){return f.handleDrag(a)});return f}d.__extends(e,a);e.prototype.handleDrag=function(a){var b=a.data;if(!(1<b.pointers.size)&&c.eventMatchesMousePointerAction(a.data,this.pointerAction)){var d=l.createScreenPointArray(b.center.x,b.center.y);switch(b.action){case "start":this.cameraController&&
(this.cameraController.end(),this.cameraController=null);this.cameraController=new k.RotateController({view:this.view,pivot:this.pivotPoint});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}a.stopPropagation()}};return e}(e.InputHandler);a.DragRotate=n})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports tslib ../../../../core/mathUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){Object.defineProperty(a,"__esModule",{value:!0});a.RotateController=void 0;n=function(a){function r(d){d=a.call(this,d)||this;d.view=null;d.pivot="center";d.lastPoint=m.vec2f64.create();d.tmpWorldUp=b.vec3f64.create();d.tmpViewDir=b.vec3f64.create();d.tmpRotCurPoint=m.vec2f64.create();d.tmpTransf=c.mat4f64.create();d.tmpAxis=b.vec3f64.create();d.pivotPos=b.vec3f64.create();d.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};return d}d.__extends(r,a);Object.defineProperty(r.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!1,configurable:!0});r.prototype.initialize=function(){this.rotScale="center"===this.pivot?3:1.5};r.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":f.vec3.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=
0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||f.vec3.copy(this.pivotPos,this.beginCamera.center),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;u.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};r.prototype.update=function(a){if(this.active){var b;switch(this.pivot){case "eye":b=
this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,b=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,b,this.pivotPos);g.applyAll(this.view,this.currentCamera,this.constraintOptions)}};r.prototype.end=function(){this.active&&this.finishController()};r.prototype.applyRotation=function(a,b,c,d){this.view.renderCoordsHelper.worldUpAtPosition(d,this.tmpWorldUp);u.normalizeCoordinate(a,b,this.tmpRotCurPoint);b=(this.lastPoint[1]-this.tmpRotCurPoint[1])*
this.rotScale;var g=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;f.vec3.subtract(this.tmpViewDir,c,d);var m=f.vec3.length(this.tmpViewDir),m=l.acosClamped(f.vec3.dot(this.tmpViewDir,this.tmpWorldUp)/m);if("eye"===this.pivot){var k=.5*Math.PI-m,r=.495*Math.PI;b=k-Math.max(-r,Math.min(r,k+-.5*b))}b=l.clamp(b+m,p.TiltDefault.min,p.TiltDefault.max)-m;e.mat4.identity(this.tmpTransf);f.vec3.cross(this.tmpAxis,a.up,this.tmpViewDir);"center"===this.pivot&&(g=-g);e.mat4.rotate(this.tmpTransf,this.tmpTransf,
g,this.tmpWorldUp);e.mat4.rotate(this.tmpTransf,this.tmpTransf,b,this.tmpAxis);f.vec3.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);f.vec3.add(c,d,this.tmpViewDir);f.vec3.transformMat4(a.up,a.up,this.tmpTransf);h.vec2.copy(this.lastPoint,this.tmpRotCurPoint);a.markViewDirty()};d.__decorate([k.property({constructOnly:!0})],r.prototype,"view",void 0);d.__decorate([k.property()],r.prototype,"pivot",void 0);return r=d.__decorate([k.subclass("esri.views.3d.state.controllers.RotateController")],
r)}(t.InteractiveController);a.RotateController=n})},"esri/views/3d/state/controllers/InteractiveController":function(){define("require exports tslib ../../../../core/accessorSupport/decorators ./CameraController ../../webgl-engine/lib/Camera".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.InteractiveController=void 0;n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.beginCamera=new e.default;c.currentCamera=new e.default;return c}d.__extends(c,
a);Object.defineProperty(c.prototype,"isInteractive",{get:function(){return!0},enumerable:!1,configurable:!0});c.prototype.stepController=function(a,c){c.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(c)};c.prototype.onControllerStart=function(a){this.state=k.State.Running;this.beginCamera.copyFrom(a);this.currentCamera.copyFrom(a)};c.prototype.onControllerEnd=function(a){a.copyViewFrom(this.currentCamera)};return c=d.__decorate([l.subclass("esri.views.3d.state.controllers.InteractiveController")],
c)}(k.CameraController);a.InteractiveController=n})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports tslib ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.DragZoom=void 0;n=function(a){function c(b,c,d){var e=a.call(this,!0)||this;e.view=b;e.pointerAction=
c;e.registerIncoming("drag",d,function(a){return e.handleDrag(a)});return e}d.__extends(c,a);c.prototype.handleDrag=function(a){var b=a.data;if(!(1<b.pointers.size)&&h.eventMatchesMousePointerAction(a.data,this.pointerAction)){var c=l.createScreenPointArray(b.center.x,b.center.y);switch(b.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=this.view.state.isGlobal?new k.ZoomController({view:this.view}):new e.ZoomController({view:this.view});
this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(c);break;case "update":this.cameraController&&this.cameraController.update(c);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}a.stopPropagation()}};return c}(c.InputHandler);a.DragZoom=n})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports tslib ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p){Object.defineProperty(a,"__esModule",{value:!0});a.ZoomController=void 0;n=function(a){function b(b){b=a.call(this,b)||this;b.view=null;b.pickPoint=m.vec3f64.create();b.tmpP0=c.vec2f64.create();b.panAxisAngle=p.axisAngle.create();b.tmpRayDir=m.vec3f64.create();b.targetOnSphere=m.vec3f64.create();b.dragBeginPoint=l.createScreenPointArray();b.normalizedAnchorPoint=c.vec2f64.create();b.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};b.sphere=p.sphere.create();b.hasPickPoint=!1;return b}d.__extends(b,a);Object.defineProperty(b.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!1,configurable:!0});b.prototype.begin=function(a){this.active&&(e.vec2.copy(this.dragBeginPoint,a),g.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),a=g.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,a,!1),this.hasPickPoint=!!a.scenePickPoint,
this.pickPoint=a.scenePickPoint,this.sphere=a.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};b.prototype.update=function(a){if(this.active){this.currentCamera.eye=this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;h.vec3.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var b=h.vec3.length(this.tmpRayDir);g.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var c=12*(this.normalizedAnchorPoint[1]-
this.tmpP0[1]),d=b*Math.pow(2,c),e=this.view.state.constraints.minimumPoiDistance;0>c&&d<e&&(d=e);1E-6>Math.abs(b-d)||(this.hasPickPoint&&d<b&&(c=1-(1-d/b)*(1-this.sphere.radius/h.vec3.length(this.currentCamera.center)),h.vec3.scale(this.currentCamera.center,this.currentCamera.center,c)),h.vec3.scale(this.tmpRayDir,this.tmpRayDir,-d/b),h.vec3.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(this.dragBeginPoint,
a),f.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(g.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),p.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),g.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle)),f.applySurfaceCollisionConstraint(this.view,this.currentCamera))}};b.prototype.end=function(){this.active&&this.finishController()};d.__decorate([k.property({constructOnly:!0})],
b.prototype,"view",void 0);return b=d.__decorate([k.subclass("esri.views.3d.state.controllers.global.ZoomController")],b)}(b.InteractiveController);a.ZoomController=n})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports tslib ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){Object.defineProperty(a,"__esModule",{value:!0});a.ZoomController=void 0;n=function(a){function g(b){b=a.call(this,b)||this;b.view=null;b.tmpP=f.vec3f64.create();b.tmpN=f.vec3f64.create();b.tmpP0=h.vec2f64.create();b.tmpPoi=f.vec3f64.create();b.tmpRayDir=f.vec3f64.create();b.dragBeginPoint=k.createScreenPointArray();b.normalizedAnchorPoint=h.vec2f64.create();b.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:f.vec3f64.create(),
tiltMode:0};b.plane=t.plane.create();return b}d.__extends(g,a);Object.defineProperty(g.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!1,configurable:!0});g.prototype.begin=function(a){this.active&&(c.vec2.copy(this.dragBeginPoint,a),p.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(a,this.tmpP),m.vec3.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center),m.vec3.normalize(this.tmpN,
this.tmpN),0>this.tmpN[1]&&m.vec3.negate(this.tmpN,this.tmpN),t.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.beginCamera)};g.prototype.update=function(a){if(this.active){p.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||m.vec3.copy(this.tmpPoi,this.currentCamera.center);p.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var d=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);c.vec2.copy(this.normalizedAnchorPoint,
this.tmpP0);m.vec3.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var e=m.vec3.length(this.tmpRayDir),f=e*(1-d);m.vec3.copy(this.constraintOptions.interactionDirection,this.tmpRayDir);m.vec3.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,l.sign(d)/e);var g=this.view.state.constraints.minimumPoiDistance;0<=d&&f<g&&(f=g,d=-(f-e)/e);1E-6>Math.abs(e-f)||(m.vec3.scale(this.tmpRayDir,this.tmpRayDir,d),m.vec3.add(this.currentCamera.eye,this.currentCamera.eye,
this.tmpRayDir),m.vec3.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,d),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=b.pixelDistanceToInteractionFactor(this.dragBeginPoint,a),b.applyAll(this.view,this.currentCamera,this.constraintOptions))}};g.prototype.end=
function(){this.active&&this.finishController()};d.__decorate([e.property({constructOnly:!0})],g.prototype,"view",void 0);return g=d.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomController")],g)}(g.InteractiveController);a.ZoomController=n})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("require exports tslib ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),function(n,
a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.GamepadNavigation=void 0;n=function(a){function c(c){var b=a.call(this,!0)||this;b.view=c;b.watchHandles=new l;b.handle=b.registerIncoming("gamepad",function(a){return b.handleEventGamepad(a)});b.handle.pause();return b}d.__extends(c,a);c.prototype.onInstall=function(c){var b=this;a.prototype.onInstall.call(this,c);this.watchHandles.add([k.init(this.view.navigation.gamepad,"enabled",function(a){a?b.handle.resume():(b.handle.pause(),b.cameraControllerGamepad&&
(b.cameraControllerGamepad.finishController(),b.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",function(a){b.cameraControllerGamepad&&a&&b.cameraControllerGamepad.gamepadDevice!==a&&(b.cameraControllerGamepad.finishController(),b.cameraControllerGamepad=null)})])};c.prototype.onUninstall=function(){this.watchHandles.removeAll();a.prototype.onUninstall.call(this)};c.prototype.handleEventGamepad=function(a){var b=this.view.navigation.gamepad.device;if(!b||a.data.device===
b)if((b=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||e.GamepadKeyboardController.activatesFor(this.view,a.data))b||(b=new e.GamepadKeyboardController({view:this.view,gamepadDevice:a.data.device}),this.view.state.switchCameraController(b)&&(this.cameraControllerGamepad=b)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===a.data.device&&this.cameraControllerGamepad.handleEventGamepad(a.data)};return c}(c.InputHandler);
a.GamepadNavigation=n})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("require exports tslib ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/geodesicConstants ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E){Object.defineProperty(a,"__esModule",{value:!0});a.GamepadKeyboardController=void 0;n=function(a){function b(b){b=a.call(this,b)||this;b.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};b.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];b.tmpCamera=new C.default;b.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new C.default,interactionFactor:0,interactionDirection:null,tiltMode:1};return b}d.__extends(b,a);
b.prototype.handleEventGamepad=function(a){var b=E.extractTransformation(a,this.view.navigation.gamepad,this.transformation);("end"===a.action||E.isZeroTransformation(b))&&this.finishController()};b.prototype.activateDirection=function(a){this.keysButtonState[a]=1;E.extractTransformationKeyboard(this.keysButtonState,this.transformation)};b.prototype.deactivateDirection=function(a){this.keysButtonState[a]=0;a=E.extractTransformationKeyboard(this.keysButtonState,this.transformation);E.isZeroTransformation(a)&&
this.finishController()};b.prototype.onControllerStart=function(b){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;a.prototype.onControllerStart.call(this,b)};b.prototype.updateFilteredSurfaceElevation=function(a){this.filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*a};b.prototype.stepController=function(b,c){this.updateStartHeading();this.updateFilteredSurfaceElevation(b);
this.currentCamera.copyViewFrom(c);this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this.calculateControlTransformation(b,this.currentCamera,M);this.applyDisabledMovementTypes(M);this.applyPan(M.pan);this.applyRotate(M.rotate);this.applyZoom(M.zoom);this.applyAscend(M.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;p.applyAll(this.view,this.currentCamera,this.constraintOptions);a.prototype.stepController.call(this,
b,c)};b.prototype.updateStartHeading=function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};b.prototype.applyRotate=function(a){if(a.enabled){var b=this.currentCamera,c=b.center,d=b.up,e=b.eye;f.vec3.subtract(c,c,e);f.vec3.transformMat4(c,c,a.matrix);f.vec3.add(c,c,e);f.vec3.transformMat4(d,d,a.matrix);b.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;p.applyAll(this.view,b,this.constraintOptions)}};b.prototype.applyPan=
function(a,b){void 0===b&&(b=this.currentCamera);if(a.enabled){var c=b.center,d=b.eye,e=b.up;f.vec3.transformMat4(d,d,a.matrix);f.vec3.transformMat4(c,c,a.matrix);this.view.state.isGlobal&&f.vec3.transformMat4(e,e,a.matrix);b.markViewDirty();this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;p.applyAll(this.view,b,this.constraintOptions)}};b.prototype.applyZoom=function(a){if(a){var b=this.currentCamera,c=b.eye,b=b.viewForward;f.vec3.add(c,c,f.vec3.scale(A.sv3d.get(),b,a));
this.currentCamera.markViewDirty();f.vec3.copy(Q,b);f.vec3.negate(Q,Q);this.constraintOptions.interactionDirection=Q;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;p.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};b.prototype.applyAscend=function(a){if(a){var b=this.currentCamera,c=b.center,b=b.eye,d=this.view.renderCoordsHelper.worldUpAtPosition(b,A.sv3d.get());this.constraintOptions.interactionDirection=
f.vec3.copy(Q,d);this.view.state.isGlobal?(d=f.vec3.length(b),a=(d+a)/d,f.vec3.scale(b,b,a),f.vec3.scale(c,c,a)):(a=f.vec3.scale(A.sv3d.get(),d,a),f.vec3.add(b,b,a),f.vec3.add(c,c,a));this.currentCamera.markViewDirty();this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=8;p.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;p.applyAll(this.view,this.currentCamera,this.constraintOptions);
this.constraintOptions.interactionDirection=null}};b.prototype.calculateControlTransformation=function(a,b,c){c.zoom=0;c.ascend=0;c.pan.enabled=!1;h.mat4.identity(c.pan.matrix);c.rotate.enabled=!1;h.mat4.identity(c.rotate.matrix);a=this.computeVelocities(a);this.view.state.isLocal?this.calculateControlTransformationLocal(a,b,c):this.calculateControlTransformationGlobal(a,b,c)};b.prototype.updateCameraCenter=function(){var a=this.currentCamera;this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(a.ray,
this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a.center);this.currentCamera.markViewDirty()};b.prototype.calculateControlTransformationLocal=function(a,b,c){var d=b.viewRight,e=b.viewForward,g=this.transformation,m=this.view.navigation.gamepad,e=f.vec3.set(A.sv3d.get(),e[0],e[1],0);f.vec3.normalize(e,e);var p=g.translation[0]*a.pan;0!==p&&(p=f.vec3.scale(A.sv3d.get(),d,p),h.mat4.translate(c.pan.matrix,c.pan.matrix,p),c.pan.enabled=!0);switch(m.mode){case "pan":m=-g.translation[1]*
a.pan;0!==m&&(m=f.vec3.scale(A.sv3d.get(),e,m),h.mat4.translate(c.pan.matrix,c.pan.matrix,m),c.pan.enabled=!0);c.zoom=g.zoom*a.zoom;break;case "zoom":c.zoom=(-g.translation[1]+g.zoom)*a.zoom;break;default:l.neverReached(m.mode)}c.ascend=g.translation[2]*a.ascend;m=-g.heading*a.rotate;0!==m&&(h.mat4.rotate(c.rotate.matrix,c.rotate.matrix,m,this.view.renderCoordsHelper.worldUpAtPosition(b.eye,A.sv3d.get())),c.rotate.enabled=!0);a=g.tilt*a.rotate;b=v.viewAngle(this.view.renderCoordsHelper,b.center,b.eye);
if(b=k.clamp(b+a,t.TiltDefault.min,t.TiltDefault.max)-b)h.mat4.rotate(c.rotate.matrix,c.rotate.matrix,b,d),c.rotate.enabled=!0};b.prototype.calculateControlTransformationGlobal=function(a,b,c){var d=b.eye,e=b.viewRight,g=this.transformation,m=this.view.navigation.gamepad,d=f.vec3.cross(A.sv3d.get(),e,d);f.vec3.normalize(d,d);f.vec3.negate(d,d);r.panMotionToRotationMatrix(this.beginCamera,b,g,a,this.view.camera.heading,this.headingStart,this.view.camera.tilt,c,m);this.tmpCamera.copyFrom(this.currentCamera);
this.applyPan(M.pan,this.tmpCamera);m=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;c.ascend=g.translation[2]*a.ascend;d=-g.heading*a.rotate;0!==d&&(h.mat4.rotate(c.rotate.matrix,c.rotate.matrix,d,this.tmpCamera.eye),c.rotate.enabled=!0);b=this.clampTiltDeltaGlobalToValidRange(g.tilt*a.rotate,b.ray,m);0!==b&&(h.mat4.rotate(c.rotate.matrix,c.rotate.matrix,b,this.tmpCamera.viewRight),c.rotate.enabled=!0);c.zoom=g.zoom*a.zoom};b.prototype.clampTiltDeltaGlobalToValidRange=
function(a,b,c){var d=q.onSurfaceTiltToEyeTiltGlobal(t.TiltDefault.min,b.origin,c),e=0,h=0,e=A.sv3d.get();this.view.renderCoordsHelper.intersectManifold(b,c,e)?(e=v.viewAngle(this.view.renderCoordsHelper,e,b.origin),e=q.onSurfaceTiltToEyeTiltGlobal(e,b.origin,c),h=q.onSurfaceTiltToEyeTiltGlobal(t.TiltDefault.max,b.origin,c)):(x.sphere.closestPointOnSilhouette(x.sphere.wrap(c+g.earthRadius),b,e),e=k.acosClamped(-f.vec3.dot(b.direction,f.vec3.normalize(e,e))),e=q.offSurfaceTiltToEyeTiltGlobal(e,b.origin,
c),h=q.offSurfaceTiltToEyeTiltGlobal(t.TiltDefault.max,b.origin,c));return k.clamp(e+a,d,h)-e};b.prototype.getPointAbsoluteSurfaceElevation=function(a,b,c){var d=this.view.renderCoordsHelper,e=d.getAltitude(a);b+=Math.abs(e-b);f.vec3.copy(c,a);d.setAltitude(b,c);return b};b.prototype.clampedDistanceToSurface=function(a,b){var c=this.view.renderCoordsHelper,d=this.view.state.camera,e=w.headingTiltToDirectionUp(this.view,b,0,F,R).direction,e=c.intersectManifoldClosestSilhouette(x.ray.wrap(b,e),a,A.sv3d.get()),
e=f.vec3.distance(b,e);a=c.intersectManifoldClosestSilhouette(x.ray.wrap(b,B.directionFromTo(A.sv3d.get(),b,d.center)),a,A.sv3d.get());b=f.vec3.distance(b,a);return Math.min(e,b)};b.prototype.computeHeadingRotateRadius=function(a){var b=this.view,c=b.renderCoordsHelper,d=b.state,b=d.isGlobal,d=c.intersectManifoldClosestSilhouette(d.camera.ray,this.filteredSurfaceElevation,A.sv3d.get());if(b)return b=f.vec3.subtract(A.sv3d.get(),a,d),c=f.vec3.length(b),f.vec3.scale(b,b,1/c),a=f.vec3.normalize(A.sv3d.get(),
a),a=k.acosClamped(f.vec3.dot(a,b)),c*Math.sin(Math.min(H,a));a=f.vec3.copy(A.sv3d.get(),a);c.setAltitude(this.filteredSurfaceElevation,a);return f.vec3.distance(d,a)};b.prototype.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:I};b.prototype.computeVelocities=function(a){var b=this.filteredSurfaceElevation,c=b+g.earthRadius,d=this.view.state,e=d.camera,f=d.isGlobal,h=A.sv3d.get(),m=this.getPointAbsoluteSurfaceElevation(e.eye,b,h),p=this.clampedDistanceToSurface(b,
h),r=e.width/2,l=J*e.width,d=J*e.width,e=p*Math.tan(.5*e.fovX)/r,u=e/c,c=e/this.computeHeadingRotateRadius(h),f=(f?u:e)*l*a,b=m-b,b=Math.max(this.minimumAscendVelocity()*a,Math.pow(2,l*a/r)*b-b),p=Math.pow(2,l*a/r)*p-p;a*=k.clamp(c*d,K,L);return{pan:f,ascend:b,zoom:p,rotate:a}};b.prototype.applyDisabledMovementTypes=function(a){!e.isSome(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.mode!==this.disableMovements.mode||(a.zoom=this.disableMovements.zoom?0:a.zoom,a.ascend=
this.disableMovements.ascend?0:a.ascend,a.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&h.mat4.identity(a.pan.matrix),a.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&h.mat4.identity(a.rotate.matrix))};b.activatesFor=function(a,b){a=E.extractTransformation(b,a.navigation.gamepad,G);return!("end"===b.action||E.isZeroTransformation(a))};d.__decorate([c.property({constructOnly:!0})],b.prototype,"view",void 0);d.__decorate([c.property({constructOnly:!0})],
b.prototype,"gamepadDevice",void 0);d.__decorate([c.property({constructOnly:!0})],b.prototype,"disableMovements",void 0);return b=d.__decorate([c.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],b)}(u.InteractiveController);a.GamepadKeyboardController=n;var G={translation:[0,0,0],heading:0,tilt:0,zoom:0},F=80,H=k.deg2rad(F),J=.75,I=5,K=k.deg2rad(30),L=k.deg2rad(80),M={zoom:0,ascend:0,pan:{enabled:!1,matrix:m.mat4f64.create()},rotate:{enabled:!1,matrix:m.mat4f64.create()}},Q=
b.vec3f64.create(),R=z.createDirectionUp()})},"esri/views/3d/support/cameraUtils":function(){define("require exports tslib ../../../Camera ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/geodesicConstants ../../../geometry/support/scaleUtils ../camera/intersectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./ElevationProvider ./mathUtils ./pointUtils ./projectionUtils ../../support/spatialReferenceSupport".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B){function A(a){return"global"===a.viewingMode?r:u}function C(a,b,c){var d=a.state.camera,f=d.fovX,d=d.width/2/d.pixelRatio;"global"===a.viewingMode&&null!=c&&(b*=Math.cos(e.deg2rad(c)));b/=a.renderCoordsHelper.unitInMeters;return d/(96*39.37/b)/Math.tan(f/2)}function E(a,b,c){var d=a.state.camera;b=96*39.37/(d.width/2/d.pixelRatio/(b*Math.tan(d.fovX/2)));"global"===a.viewingMode&&(b/=Math.cos(e.deg2rad(c)));return b*=a.renderCoordsHelper.unitInMeters}
function G(a,b,c,d,e,f){if(N(f)){var g=O(f.signal);L(a,d.heading,d.tilt,b,c,e,g);g.resolver.promise.then(function(b){return f.resolver.resolve(R(a,b,d.fov))},function(a){return f.resolver.reject(a)})}else return b=L(a,d.heading,d.tilt,b,c,e),R(a,b,d.fov,f)}function F(a,b,c,d,e){return A(a).directionToHeadingTilt(b,c,d,e)}function H(a,b){return!!(a.basemapTerrain&&a.renderCoordsHelper.fromRenderCoords(b,T,a.spatialReference)&&v.getElevationAtPoint(a.elevationProvider,T)>T.z-1)}function J(a,b,c){return d.__awaiter(this,
void 0,void 0,function(){var e;return d.__generator(this,function(d){switch(d.label){case 0:return a.renderCoordsHelper.fromRenderCoords(b,T,a.spatialReference)?[4,a.elevationProvider.queryElevation(T.x,T.y,T.z,T.spatialReference,"ground",c)]:[2,!1];case 1:return e=d.sent(),[2,e>T.z-1]}})})}function I(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var e,g;return d.__generator(this,function(d){switch(d.label){case 0:e=m.vec3f64.create();if(b)return[3,1];h.vec3.copy(e,a.state.camera.center);
return[3,5];case 1:if(!(b instanceof f))return[3,4];z.pointToVector(b,e,a.renderSpatialReference);return null!=b.z||null==a.basemapTerrain?[3,3]:[4,a.elevationProvider.queryElevation(b.x,b.y,b.z,b.spatialReference,"ground",c)];case 2:return g=d.sent(),null!=g&&a.renderCoordsHelper.setAltitude(g,e),[2,e];case 3:return[3,5];case 4:h.vec3.copy(e,b),d.label=5;case 5:return[2,e]}})})}function K(a,b){var c=m.vec3f64.create();b&&b instanceof f?(z.pointToVector(b,c,a.renderSpatialReference),null==b.z&&null!=
a.basemapTerrain&&(b=v.getElevationAtPoint(a.elevationProvider,b),null!=b&&a.renderCoordsHelper.setAltitude(b,c))):b?h.vec3.copy(c,b):h.vec3.copy(c,a.state.camera.center);return c}function L(a,b,c,d,e,g,h){var m=d&&d instanceof f?d:null;if(N(h))I(a,d,h.signal).then(function(d){M(a,b,c,m,d,e,g,h)},function(a){return h.resolver.reject(a)});else return d=K(a,d),M(a,b,c,m,d,e,g,h)}function M(a,c,d,e,f,g,h,k){e||(e=z.vectorToPoint(f,a.renderSpatialReference,a.spatialReference||b.WGS84));g=Math.max(g,a.state.constraints.minimumPoiDistance);
var p=Q(a,c,d,f,g,h),r=A(a).eyeForCenterWithHeadingTilt,l=r(f,g,p.heading,p.tilt);if(1===h&&"global"===a.viewingMode&&0<d){var u=function(){var b=g,m=g,p=a.state.constraints.tilt(m),m=A(a).eyeTiltToLookAtTilt(d,f,m),m=Math.min(m,.5*Math.PI),p=p.min*(1-ca)+m*ca,b=A(a).lookAtTiltToEyeTilt(p,f,b);h=1>d-b?0:1;return M(a,c,b,e,f,g,h,k)},p=a.map.ground.navigationConstraint;if(!p||"stay-above"===p.type){if(H(a,l.eye))return u();if(N(k)){J(a,l.eye,k.signal).then(function(a){if(a)return u();k.resolver.resolve({eye:l.eye,
up:l.up,center:m.vec3f64.clone(f),heading:l.heading,tilt:l.tilt})});return}}}p=!k||N(k)?{center:m.vec3f64.create(),eye:m.vec3f64.create(),up:m.vec3f64.create(),tilt:0,heading:0}:k;p.eye=l.eye;p.up=l.up;p.center=m.vec3f64.clone(f);p.heading=l.heading;p.tilt=l.tilt;N(k)&&k.resolver.resolve(p);return p}function Q(a,c,d,e,f,g){var h=0;if(g=1===g)if(h=a.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(f/h)/Math.LN2)g=!0;else{var m=a.renderSpatialReference,k=a.spatialReference||b.WGS84;g=z.vectorToPoint(e,
m,k);m=z.vectorToPoint(a.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,m,k);h*=Math.tan(.5*a.state.camera.fov);g=5<m.distance(g)/h}g?(c=0,g=a.state.constraints.tilt(f),g.max=Math.min(g.max,.5*Math.PI),g=g.min*(1-ca)+g.max*ca,d=A(a).eyeTiltToLookAtTilt(d,e,f),h=Math.min(d,g)):h=A(a).eyeTiltToLookAtTilt(d,e,f);d=h=a.state.constraints.clampTilt(f,h);d=A(a).lookAtTiltToEyeTilt(d,e,f);return{heading:c,tilt:d}}function R(a,c,d,e){a=z.vectorToPoint(c.eye,a.renderSpatialReference,a.spatialReference||
b.WGS84);return a?e?(e.position=a,e.heading=c.heading,e.tilt=c.tilt,e.fov=d,e):new l(a,c.heading,c.tilt,d):null}function O(a){return{resolver:c.createResolver(),signal:a}}function N(a){return a&&"resolver"in a}Object.defineProperty(a,"__esModule",{value:!0});a.isAsyncContext=a.createAsyncContext=a.computeScale=a.scaleToResolution=a.zoomToScale=a.scaleToZoom=a.observerToCamera=a.toExtent=a.fromExtent=a.getObserverForPointAtDistance=a.directionToHeadingTilt=a.fromCenterDistance=a.fromCenterScale=a.distanceToScale=
a.scaleToDistance=a.internalToExternal=a.externalToInternal=a.headingTiltToDirectionUp=void 0;var S=k.getLogger("esri.views.3d.support.cameraUtils"),P=m.vec3f64.create(),U=m.vec3f64.create(),Z=m.vec3f64.create(),V={heading:0,tilt:0},T=new f,Y=new w.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),X=new w.Cyclical(-180,180);a.headingTiltToDirectionUp=function(a,b,c,d,e){return A(a).headingTiltToDirectionUp(b,c,d,e)};a.externalToInternal=function(a,b){var c=a.renderSpatialReference,d=A(a).headingTiltToDirectionUp,
f=m.vec3f64.create();if(!z.pointToVector(b.position,f,c))return null;c=d(f,b.heading,b.tilt);h.vec3.scale(c.direction,c.direction,a.state.camera.distance);h.vec3.add(c.direction,c.direction,f);a=t.cameraOnContentAlongViewDirection(a,f,c.direction,c.up);a.fov=e.deg2rad(b.fov);return a};a.internalToExternal=function(a,c,d){var g=a.renderSpatialReference,m=h.vec3.copy(Z,c.viewForward),m=F(a,c.eye,m,c.up,V);a=a.spatialReference||b.WGS84;x.vectorToVector(c.eye,g,P,a)||(a=b.WGS84,x.vectorToVector(c.eye,
g,P,a));if(!d)return new l(new f(P,a),m.heading,m.tilt,e.rad2deg(c.fov));d.position.x=P[0];d.position.y=P[1];d.position.z=P[2];d.position.spatialReference=a;d.heading=m.heading;d.tilt=m.tilt;d.fov=e.rad2deg(c.fov);return d};a.scaleToDistance=C;a.distanceToScale=E;a.fromCenterScale=function(a,b,c,d,e,f){c=C(a,c,b.latitude);return G(a,b,c,d,e,f)};a.fromCenterDistance=G;a.directionToHeadingTilt=F;a.getObserverForPointAtDistance=L;a.fromExtent=function(a,c,d,e,h,m){var k,p=0;null!=c.zmax&&null!=c.zmin&&
(k=(c.zmax+c.zmin)/2,p=c.zmax-c.zmin);var r,l;if("global"===a.viewingMode){if(!B.isSpatialReferenceSupported(c.spatialReference,"global"))return N(m)&&m.resolver.reject(),null;var u=new f(c.xmin,c.ymin,c.spatialReference),t=new f(c.xmax,c.ymax,c.spatialReference),v=c.spatialReference.isGeographic?X:Y;c=new f(v.center(u.x,t.x),(t.y+u.y)/2,c.spatialReference);null!=k&&(c.z=k);l=q.getGreatCircleSpanAt(c,u,t);r=l.lon;l=l.lat;v.diff(u.x,t.x)>v.range/2&&(r+=g.halfEarthCircumference);r=Math.min(r,g.halfEarthCircumference);
l=Math.min(l,g.halfEarthCircumference)}else u=a.spatialReference||b.WGS84,r=c.xmax-c.xmin,l=c.ymax-c.ymin,c=new f({x:c.xmin+.5*r,y:c.ymin+.5*l,z:k,spatialReference:u});k=a.state.camera;p=Math.max(1/Math.tan(k.fovX/2)*r*.5,1/Math.tan(k.fovY/2)*l*.5,1/Math.tan(k.fov/2)*p*.5)/1;if(N(m))r=O(m.signal),L(a,d,e,c,p,h,r),r.resolver.promise.then(function(b){return m.resolver.resolve(R(a,b,a.camera.fov))},function(a){return m.resolver.reject(a)});else return d=L(a,d,e,c,p,h),R(a,d,a.camera.fov,m)};a.toExtent=
function(a,c,d){var e=a.renderSpatialReference,f=h.vec3.dist(c.eye,d);d=z.vectorToPoint(d,e,a.spatialReference||b.WGS84);e=2*f*Math.tan(c.fovX/2)*1;c=2*f*Math.tan(c.fovY/2)*1;return"global"===a.viewingMode?r.toExtent(a,d,e,c):u.toExtent(a,d,e,c)};var ca=.7;a.observerToCamera=R;a.scaleToZoom=function(a,b){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.levelAtScale(b);S.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.zoomToScale=function(a,b){if(a=
a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.scaleAtLevel(b);S.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};a.scaleToResolution=function(a,b){return a.spatialReference?p.getResolutionForScale(b,a.spatialReference):void 0};a.computeScale=function(a,c,d){var e=a.renderSpatialReference;c||(c=a.state.camera);var f;f=b.WGS84;c instanceof l?(f=c.position.latitude,z.pointToVector(c.position,P,e),z.pointToVector(d,U,e),c=h.vec3.distance(P,U)):(x.vectorToVector(c.center,
e,U,f),f=U[1],c=c.distance);return E(a,c,f)};a.createAsyncContext=O;a.isAsyncContext=N})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ./cameraUtilsInternal ./pointUtils ./projectionUtils".split(" "),function(n,a,d,l,k,e,c,h,m,f,b){function g(a,b,c,f){void 0===f&&(f=m.createDirectionUp());
l.mat4.identity(u);a=f.direction;var g=f.up;l.mat4.rotateZ(u,u,-d.deg2rad(b));l.mat4.rotateX(u,u,d.deg2rad(c));e.vec3.transformMat4(a,t,u);e.vec3.scale(a,a,-1);e.vec3.transformMat4(g,p,u);return f}Object.defineProperty(a,"__esModule",{value:!0});a.toExtent=a.eyeTiltToLookAtTilt=a.lookAtTiltToEyeTilt=a.eyeForCenterWithHeadingTilt=a.directionToHeadingTilt=a.headingTiltToDirectionUp=void 0;var p=c.vec3f64.fromValues(0,1,0),t=c.vec3f64.fromValues(0,0,1),u=k.mat4f64.create(),r=c.vec3f64.create(),q=c.vec3f64.create();
a.headingTiltToDirectionUp=g;a.directionToHeadingTilt=function(a,b,c,d){return m.directionToHeadingTilt(b,c,d,t,p)};a.eyeForCenterWithHeadingTilt=function(a,b,d,f){var h=g(a,d,f),m=c.vec3f64.create();e.vec3.scale(m,h.direction,-b);e.vec3.add(m,m,a);return{up:h.up,eye:m,heading:d,tilt:f}};a.lookAtTiltToEyeTilt=function(a){return d.rad2deg(a)};a.eyeTiltToLookAtTilt=function(a){return d.deg2rad(a)};a.toExtent=function(a,c,d,e,g){var m=a.renderSpatialReference;a=a.map&&a.spatialReference||c.spatialReference;
f.pointToVector(c,r,m);f.pointToVector(c,q,m);r[0]-=d/2;q[0]+=d/2;r[1]-=e/2;q[1]+=e/2;b.vectorToVector(r,m,r,a);b.vectorToVector(q,m,q,a);g?(g.xmin=r[0],g.ymin=r[1],g.xmax=q[0],g.ymax=q[1],g.spatialReference=a):g=new h(r[0],r[1],q[0],q[1],a);return g}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports","../../../core/mathUtils","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",
{value:!0});a.directionToHeadingTilt=a.createDirectionUp=void 0;var e=k.vec3f64.create(),c=k.vec3f64.create();a.createDirectionUp=function(){return{direction:k.vec3f64.create(),up:k.vec3f64.create()}};a.directionToHeadingTilt=function(a,m,f,b,g){var h=e;l.vec3.normalize(h,a);var k=l.vec3.dot(h,b),u=0<k,k=Math.abs(k);.99<k&&(k=Math.abs(l.vec3.dot(m,b)),.99>k?(l.vec3.copy(h,m),u&&l.vec3.scale(h,h,-1)):h=null);m=0;h&&(l.vec3.scale(c,b,l.vec3.dot(b,h)),l.vec3.subtract(h,h,c),m=l.vec3.dot(h,g)/(l.vec3.length(h)*
l.vec3.length(g)),l.vec3.cross(c,h,g),m=(0<l.vec3.dot(c,b)?1:-1)*d.rad2deg(d.acosClamped(m)));a=d.rad2deg(d.acosClamped(-l.vec3.dot(b,a)/l.vec3.length(a)));if(!f)return{heading:m,tilt:a};f.heading=m;f.tilt=a;return f}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/geodesicConstants ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){function u(a,b,c,f){void 0===f&&(f=g.createDirectionUp());e.vec3.cross(B,a,v);0===e.vec3.dot(B,B)&&e.vec3.cross(B,a,w);l.mat4.identity(x);l.mat4.rotate(x,x,-d.deg2rad(b),a);l.mat4.rotate(x,x,-d.deg2rad(c),B);b=f.up;c=f.direction;e.vec3.cross(b,B,a);e.vec3.normalize(b,b);e.vec3.transformMat4(b,b,x);e.vec3.normalize(c,a);e.vec3.negate(c,c);e.vec3.transformMat4(c,c,x);return f}function r(a){var b=a[1];a[1]=-a[2];a[2]=b}function q(a,b){b=u(b,a.heading,a.tilt);a.up=
b.up;return a}Object.defineProperty(a,"__esModule",{value:!0});a.toExtent=a.eyeTiltToLookAtTilt=a.lookAtTiltToEyeTilt=a.eyeForCenterWithHeadingTilt=a.directionToHeadingTilt=a.headingTiltToDirectionUp=void 0;var v=c.vec3f64.fromValues(0,0,1),w=e.vec3.normalize(c.vec3f64.create(),c.vec3f64.fromValues(1,1,1)),z=new t.Cyclical(-180,180),x=k.mat4f64.create(),B=c.vec3f64.create(),A=c.vec3f64.create();a.headingTiltToDirectionUp=u;a.directionToHeadingTilt=function(a,b,c,d){var f=B;e.vec3.normalize(f,a);e.vec3.cross(A,
f,v);0===e.vec3.dot(A,A)&&e.vec3.cross(A,f,w);e.vec3.cross(A,A,f);return g.directionToHeadingTilt(b,c,d,f,A)};a.eyeForCenterWithHeadingTilt=function(a,b,f,g){var h={eye:c.vec3f64.create(),up:null,tilt:g,heading:f},m=B;m[0]=a[0];m[1]=a[2];m[2]=-a[1];f=d.deg2rad(f);var k=d.deg2rad(g);g=Math.sin(f);f=Math.cos(f);var p=Math.sin(k),l=Math.cos(k),u=e.vec3.length(m);if(1E-8>Math.abs(k))k=b+u;else var t=u/p,v=d.asinClamped(b/t),k=t*Math.sin(Math.PI-k-v);var l=l*b,t=b*b*p*p,v=f*f*t,w=k-l,x=w*w,z=v*(v+x-m[1]*
m[1]);if(0>z)return e.vec3.scale(h.eye,m,k/u),h.tilt=0,h;var A=Math.sqrt(z),C=m[1]*w,z=v+x,A=0<f?-A+C:A+C;if(1E-8>Math.abs(z))return 1E-8>u?(h.eye[0]=0,h.eye[1]=0,h.eye[2]=b):e.vec3.scale(h.eye,m,k/u),h.tilt=0,r(h.eye),q(h,a);h.eye[1]=A/z;b*=p;A=h.eye[1]*h.eye[1];p=1-A;z=Math.sqrt(p);t=v*A+g*g*t-2*f*b*h.eye[1]*z*w+p*x;if(1E-8>Math.abs(t))return e.vec3.scale(h.eye,m,k/u),h.tilt=0,r(h.eye),q(h,a);h.eye[0]=(p*(k*m[0]-l*m[0])-b*z*(m[0]*h.eye[1]*f+m[2]*g))/t;h.eye[2]=(p*(k*m[2]-l*m[2])-b*z*(m[2]*h.eye[1]*
f-m[0]*g))/t;e.vec3.scale(h.eye,h.eye,k);r(h.eye);return q(h,a)};a.lookAtTiltToEyeTilt=function(a,b,c){b=e.vec3.length(b);c=d.asinClamped(c/(Math.sqrt(c*c+b*b-2*c*b*Math.cos(Math.PI-a))/Math.sin(a)));return d.rad2deg(a-c)};a.eyeTiltToLookAtTilt=function(a,b,c){a=d.deg2rad(a);b=e.vec3.length(b);return d.asinClamped(c/(b/Math.sin(a)))+a};a.toExtent=function(a,c,e,g,k){function r(a){var b=Math.PI/2;a=t.cyclical2PI.normalize(a,-b);a>b&&(a=Math.PI-a);return a}var l;l=c.latitude;c=c.longitude;var u=p.getLonDeltaForDistance(l,
e)/2;e=c-u;c+=u;l=d.deg2rad(l);u=f.earthRadius;l=(1+Math.sin(l))/(1-Math.sin(l));var q=(l+1)*Math.tan(g/u/2);l=1.5*Math.PI-2*Math.atan(.5*(q+Math.sqrt(4*l+q*q)));g=l+g/u;l=r(l);g=r(g);g<l&&(u=g,g=l,l=u);l=Math.max(d.rad2deg(l),-90);g=Math.min(d.rad2deg(g),90);c=z.monotonic(e,c);180<c-e&&(u=(c-e-180)/2,e+=u,c-=u);u=a.spatialReference&&a.spatialReference.isGeographic?a.spatialReference:m.WGS84;k?(k.xmin=e,k.ymin=l,k.xmax=c,k.ymax=g,k.spatialReference=u):k=new h(e,l,c,g,u);a.spatialReference&&a.spatialReference.isWebMercator&&
b.geographicToWebMercator(k,!1,k);return k}})},"esri/views/support/spatialReferenceSupport":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.isSpatialReferenceSupported=void 0;a.isSpatialReferenceSupported=function(a,l){return null==a?!1:"2d"===l?!0:"local"===l?!a.isGeographic:a.isWebMercator||a.isWGS84||4490===a.wkid}})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["require","exports","../../core/libs/gl-matrix-2/vec3"],
function(n,a,d){function l(a){var d=a*a;0>a&&(d*=-1);return d}Object.defineProperty(a,"__esModule",{value:!0});a.isZeroTransformation=a.extractTransformationKeyboard=a.extractTransformation=a.resetTransformation=a.quadraticAccentuation=void 0;a.quadraticAccentuation=l;a.resetTransformation=function(a){a.translation[0]=0;a.translation[1]=0;a.translation[2]=0;a.heading=0;a.tilt=0;return a};a.extractTransformation=function(a,e,c){var h=a.state;a=a.device;e="forward-down"===e.tiltDirection?1:-1;"standard"===
a.deviceType?(c.translation[0]=l(h.axes[0]),c.translation[1]=l(h.axes[1]),c.translation[2]=l(h.buttons[7])-l(h.buttons[6]),c.heading=l(h.axes[2]),c.tilt=l(h.axes[3])):"spacemouse"===a.deviceType&&(c.translation[0]=1.2*l(h.axes[0]),c.translation[1]=1.2*l(h.axes[1]),c.translation[2]=2*-l(h.axes[2]),c.heading=1.2*l(h.axes[5]),c.tilt=1.2*l(h.axes[3]));c.tilt*=e;d.vec3.scale(c.translation,c.translation,1);return c};a.extractTransformationKeyboard=function(a,d){d.translation[0]=a[1]-a[0];d.translation[1]=
a[3]-a[2];d.translation[2]=a[4]-a[5];d.heading=a[7]-a[6];d.tilt=a[8]-a[9];d.zoom=a[10]-a[11];return d};a.isZeroTransformation=function(a){return 0===a.translation[0]&&0===a.translation[1]&&0===a.translation[2]&&0===a.heading&&0===a.tilt&&0===a.zoom}})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["require","exports","tslib","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});
a.KeyboardNavigation=void 0;n=function(a){function c(c,d){var e,b=a.call(this,!0)||this;b.view=c;b.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:2};b.keyToNumber=(e={},e[d.left]=0,e[d.right]=1,e[d.forward]=2,e[d.backward]=3,e[d.up]=4,e[d.down]=5,e[d.headingLeft]=6,e[d.headingRight]=7,e[d.tiltUp]=8,e[d.tiltDown]=9,e[d.zoomIn]=10,e[d.zoomOut]=11,e);b.registerIncoming("key-down",null,function(a){return b.handleKeyDown(a)});b.registerIncoming("key-up",null,function(a){return b.handleKeyUp(a)});
b.registerIncoming("blur",null,function(){return b.handleBlur()});return b}d.__extends(c,a);c.prototype.handleKeyDown=function(a){if(!a.data.native.ctrlKey&&!a.data.native.metaKey){var c=this.keyToNumber[a.data.key];null!=c&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new l.GamepadKeyboardController({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&
(this.cameraControllerKeyboard.activateDirection(c),a.stopPropagation()))}};c.prototype.handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};c.prototype.handleKeyUp=function(a){if(!a.data.native.ctrlKey&&!a.data.native.metaKey){var c=this.keyToNumber[a.data.key];null!=c&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(c),
a.stopPropagation())}};return c}(k.InputHandler);a.KeyboardNavigation=n})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports tslib ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.MouseWheelZoom=void 0;n=function(a){function c(c,b){var d=a.call(this,!0)||this;d.view=c;d.registerIncoming("mouse-wheel",
b,function(a){return d.handleMouseWheel(a)});return d}d.__extends(c,a);c.prototype.handleMouseWheel=function(a){if(this.view.navigation.mouseWheelZoomEnabled){var b=a.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new k.ZoomStepController({view:this.view,mode:"interaction"}):new e.ZoomStepController({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*b.deltaY,
l.createScreenPointArray(b.x,b.y));a.preventDefault();a.stopPropagation()}};return c}(c.InputHandler);a.MouseWheelZoom=n})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports tslib ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.PinchAndPanNavigation=void 0;n=
function(a){function e(c,b,d){var e=a.call(this,!0)||this;e.view=c;e.pointerAction=b;e.lastEndTimestamp=0;e.lastTimestamp=0;e.registerIncoming("drag",d,function(a){return e.handleDrag(a)});return e}d.__extends(e,a);e.prototype.handleDrag=function(a){if("mouse"!==a.data.pointerType||c.eventMatchesMousePointerAction(a.data,this.pointerAction)){var b=a.timestamp-this.lastEndTimestamp,b=this.momentum&&this.momentum.active&&40>b;switch(a.data.action){case "start":case "update":if(b)break;this.controller&&
this.controller.active?2<a.data.timestamp-this.lastTimestamp&&(this.controller.update(a.data),this.lastTimestamp=a.timestamp):this.startController(a);break;case "end":case "removed":this.endController(a,!0);break;case "added":this.endController(a,!1),this.startController(a)}a.stopPropagation()}};e.prototype.endController=function(a,b){this.controller&&this.controller.active&&(this.lastEndTimestamp=a.timestamp,a=this.controller.end(a.data),b&&a&&(this.momentum=a,this.view.state.switchCameraController(this.momentum)));
this.controller=null};e.prototype.startController=function(a){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(a.data);this.lastTimestamp=a.timestamp};e.prototype.createController=function(){return this.view.state.isGlobal?new l.PinchAndPanController({view:this.view}):new k.PinchAndPanController({view:this.view})};return e}(e.InputHandler);a.PinchAndPanNavigation=n})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports tslib ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H){Object.defineProperty(a,"__esModule",{value:!0});a.PinchAndPanController=void 0;n=function(a){function t(c){c=a.call(this,c)||this;c.view=null;c.smoothRotation=new p.ExponentialFalloff(.05);c.rotationAxis=b.vec3f64.create();c.panningPlane=B.plane.create();c.smoothScaling=new p.ExponentialFalloff(.05);c.zoomCenterScreen=k.createScreenPointArray();c.zoomMomentumEstimator=new H.ZoomMomentumEstimator;c.rotationMomentumEstimator=new F.RotationMomentumEstimator;
c.panSphericalMomentumEstimator=new G.PanSphericalMomentumEstimator;c.panPlanarMomentumEstimator=new E.PanPlanarMomentumEstimator;c.adjustedSphere=B.sphere.create();c.tmp3d=b.vec3f64.create();c.tmpMat=h.mat4f64.create();c.tmpAxisAngle=B.axisAngle.create();c.tmpScreenPointArray=k.createScreenPointArray();c.beginScreenPoint=k.createScreenPointArray();c.beginScenePoint=b.vec3f64.create();c.screenPickPoint=k.createScreenPointArray();c.panMode=x.PanMode.Horizontal;c.tmpInteractionDirection=b.vec3f64.create();
c.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new C.default,interactionDirection:null,tiltMode:0};return c}d.__extends(t,a);Object.defineProperty(t.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!1,configurable:!0});t.prototype.begin=function(a){if(this.active){var b=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=b;this.rotationMomentumEstimator.enabled=b;this.panPlanarMomentumEstimator.enabled=
b;this.panSphericalMomentumEstimator.enabled=b;this.beginHeading=-A.cyclicalPI.normalize(l.deg2rad(this.view.camera.heading));this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();k.screenPointObjectToArray(a.center,this.screenPickPoint);m.vec2.copy(this.beginScreenPoint,this.screenPickPoint);b=z.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=b.scenePickPoint;this.sphere=b.sphere;
f.vec3.copy(this.beginScenePoint,this.scenePickPoint);this.panMode=z.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);this.panMode===x.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(a):this.preparePlanarPanMode(a));this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};t.prototype.preparePlanarPanModeOverground=function(a){var c=f.vec3.negate(this.tmp3d,this.beginCamera.viewForward);B.plane.fromPositionAndNormal(this.scenePickPoint,
c,this.panningPlane);var d=k.createScreenPointArray(this.screenPickPoint[0],0),c=b.vec3f64.create(),e=f.vec3.length(this.beginCamera.eye);this.adjustedSphere.radius=e<this.sphere.radius?e-100:this.sphere.radius;z.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,d,c);d=k.createRenderScreenPointArray3();this.beginCamera.projectPoint(c,d);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*d[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&
B.plane.fromPositionAndNormal(this.scenePickPoint,B.plane.normal(this.panningPlane),this.panningPlane);a=k.screenPointObjectToArray(a.center,this.tmpScreenPointArray);z.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,a,this.beginScenePoint)};t.prototype.preparePlanarPanMode=function(a){var b=f.vec3.negate(this.tmp3d,this.beginCamera.viewForward);B.plane.fromPositionAndNormal(this.scenePickPoint,b,this.panningPlane);var d=B.sphere.angleToSilhouette(this.sphere,this.currentCamera.eye),
b=B.axisAngle.fromPoints(this.currentCamera.eye,this.scenePickPoint,this.tmpAxisAngle),d=-b[3]-(this.currentCamera.aboveGround?.25:.025)*d;if(0<d){var e=c.mat4.identity(this.tmpMat);c.mat4.rotate(e,e,-d,b);f.vec3.subtract(this.scenePickPoint,this.scenePickPoint,this.sphere.center);f.vec3.transformMat4(this.scenePickPoint,this.scenePickPoint,e);f.vec3.add(this.scenePickPoint,this.scenePickPoint,this.sphere.center);B.plane.setOffsetFromPoint(this.panningPlane,this.scenePickPoint,this.panningPlane);
a=k.screenPointObjectToArray(a.center,this.tmpScreenPointArray);z.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,a,this.beginScenePoint)}};t.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<a.pointers.size;this.panMode===x.PanMode.Horizontal?(b&&this.zoomSpherical(a),this.panningSpherical(a),b&&this.rotateSpherical(a)):(b&&this.zoomPlanar(a),this.panningPlanar(a),b&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};t.prototype.end=
function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===x.PanMode.Horizontal?new w.ZoomSphericalMomentumController({view:this.view,momentum:a,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere.radius}):new v.ZoomPlanarMomentumController({view:this.view,momentum:a,zoomCenter:this.beginScenePoint});if(a=this.rotationMomentumEstimator.evaluateMomentum())return new q.RotationMomentumController({view:this.view,
momentum:a,center:this.sphere.center,axis:this.rotationAxis});if(this.panMode===x.PanMode.Horizontal){if(a=this.panSphericalMomentumEstimator.evaluateMomentum())return new r.PanSphericalMomentumController({view:this.view,momentum:a})}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new u.PanPlanarMomentumController({view:this.view,momentum:a});return null};t.prototype.zoomSpherical=function(a){var b=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,
40),120);this.smoothScaling.update(b);z.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);k.screenPointObjectToArray(a.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);g.applyAll(this.view,this.currentCamera,this.constraintOptions)};t.prototype.panningSpherical=function(a){var b=
k.screenPointObjectToArray(a.center,this.tmpScreenPointArray);z.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,b,this.tmp3d);z.preserveHeadingThreshold(this.beginScenePoint,f.vec3.dot(this.currentCamera.up,this.beginScenePoint),this.sphere.radius,this.beginHeading,this.view.camera.tilt,this.beginCamera)?(z.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(b,
this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(z.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(b,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere.radius,this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(this.screenPickPoint,
b);g.applyAll(this.view,this.currentCamera,this.constraintOptions)};t.prototype.rotateSpherical=function(a){f.vec3.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||f.vec3.negate(this.rotationAxis,this.rotationAxis);var b=this.smoothRotation.value,c=z.normalizeRotationDelta(a.angle-b),b=b+c;this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(b);c=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(c,
.001*a.timestamp);z.applyRotation(this.currentCamera,this.sphere.center,B.axisAngle.wrapAxisAngle(this.rotationAxis,c));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(a.radius*b);g.applyAll(this.view,this.currentCamera,this.constraintOptions)};t.prototype.panningPlanar=function(a){var b=k.screenPointObjectToArray(a.center,this.tmpScreenPointArray);z.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,b,this.tmp3d)&&
(z.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(b,this.tmp3d,.001*a.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(this.beginScreenPoint,b),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),g.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=
null)};t.prototype.zoomPlanar=function(a){var b=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(b);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);z.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(a.radius-
this.beginRadius);g.applyAll(this.view,this.currentCamera,this.constraintOptions)};t.prototype.rotatePlanar=function(a){f.vec3.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||f.vec3.negate(this.rotationAxis,this.rotationAxis);var b=this.smoothRotation.value,c=a.angle-b,c=z.normalizeRotationDelta(c);this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(b+c);b=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(b,
.001*a.timestamp);z.applyRotation(this.currentCamera,this.sphere.center,B.axisAngle.wrapAxisAngle(this.rotationAxis,b));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(a.radius*b);g.applyAll(this.view,this.currentCamera,this.constraintOptions)};d.__decorate([e.property({constructOnly:!0})],t.prototype,"view",void 0);return t=d.__decorate([e.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],t)}(t.InteractiveController);
a.PinchAndPanController=n})},"esri/views/3d/input/util":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.ExponentialFalloff=void 0;n=function(){function a(a){this._gain=a}a.prototype.reset=function(a){this._value=a};Object.defineProperty(a.prototype,"gain",{set:function(a){this._gain=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!1,configurable:!0});
a.prototype.update=function(a){this._value=void 0===this._value?a:this._gain*a+(1-this._gain)*this._value};return a}();a.ExponentialFalloff=n})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.PanPlanarMomentumController=
void 0;n=function(a){function c(c){c=a.call(this,c)||this;c.interactionType=4;c.tmpPan=e.vec3f64.create();return c}d.__extends(c,a);c.prototype.momentumStep=function(a,b){a=this.momentum.value(a);k.vec3.scale(this.tmpPan,this.momentum.direction,a);k.vec3.subtract(b.eye,b.eye,this.tmpPan);k.vec3.subtract(b.center,b.center,this.tmpPan);b.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};d.__decorate([l.property({constructOnly:!0})],c.prototype,"momentum",void 0);return c=d.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],
c)}(c.MomentumController);a.PanPlanarMomentumController=n})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../ViewAnimation ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.MomentumController=void 0;n=function(a){function c(b){b=a.call(this,b)||this;b.view=null;
b.beginCamera=new h.default;b.elapsedTimeSec=0;b.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new h.default,interactionDirection:null,tiltMode:0};return b}d.__extends(c,a);c.prototype.initialize=function(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=new k};Object.defineProperty(c.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},enumerable:!1,configurable:!0});c.prototype.onControllerStart=
function(b){this.beginCamera.copyFrom(b);this.constraintOptions.interactionStartCamera=this.beginCamera;a.prototype.onControllerStart.call(this,b)};c.prototype.stepController=function(a,c){c.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=a;this.momentumStep(this.elapsedTimeSec,c);e.applyAll(this.view,c,this.constraintOptions)};d.__decorate([l.property({constructOnly:!0})],c.prototype,"view",void 0);return c=d.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],
c)}(c.AnimationController);a.MomentumController=n})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.PanSphericalMomentumController=void 0;var m=e.vec3f64.create(),
f=e.vec3f64.create();n=function(a){function b(b){b=a.call(this,b)||this;b.interactionType=4;return b}d.__extends(b,a);b.prototype.momentumStep=function(a,b){var c=this.momentum.value1(a);a=this.momentum.value2(a);k.vec3.copy(f,b.eye);k.vec3.normalize(f,f);k.vec3.cross(this.momentum.axis2,f,this.momentum.axis1);h.applyRotationWithTwoAxes(b,m,this.momentum.axis1,c,this.momentum.axis2,a)};d.__decorate([l.property({constructOnly:!0})],b.prototype,"momentum",void 0);return b=d.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],
b)}(c.MomentumController);a.PanSphericalMomentumController=n})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.RotationMomentumController=void 0;n=function(a){function e(b){b=a.call(this,
b)||this;b.interactionType=2;return b}d.__extends(e,a);Object.defineProperty(e.prototype,"center",{set:function(a){this._set("center",k.vec3f64.clone(a))},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"axis",{set:function(a){this._set("axis",k.vec3f64.clone(a))},enumerable:!1,configurable:!0});e.prototype.momentumStep=function(a,d){a=this.momentum.value(a);c.applyRotation(d,this.center,h.axisAngle.wrapAxisAngle(this.axis,a))};d.__decorate([l.property({constructOnly:!0})],e.prototype,
"momentum",void 0);d.__decorate([l.property({constructOnly:!0})],e.prototype,"center",null);d.__decorate([l.property({constructOnly:!0})],e.prototype,"axis",null);return e=d.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],e)}(e.MomentumController);a.RotationMomentumController=n})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(n,a,d,l,k,e,c,h,m){Object.defineProperty(a,"__esModule",{value:!0});a.ZoomPlanarMomentumController=void 0;n=function(a){function b(b){b=a.call(this,b)||this;b.interactionType=1;b.constraintOptions.interactionDirection=e.vec3f64.create();return b}d.__extends(b,a);Object.defineProperty(b.prototype,"zoomCenter",{set:function(a){this._set("zoomCenter",e.vec3f64.clone(a))},enumerable:!1,configurable:!0});b.prototype.momentumStep=function(a,b){k.vec3.copy(this.constraintOptions.interactionDirection,
b.eye);a=this.momentum.valueDelta(0,a);h.applyZoomToPoint(b,this.zoomCenter,a,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=m.directionFromTo(this.constraintOptions.interactionDirection,b.eye,this.constraintOptions.interactionDirection)};d.__decorate([l.property({constructOnly:!0})],b.prototype,"momentum",void 0);d.__decorate([l.property({constructOnly:!0})],b.prototype,"zoomCenter",null);return b=d.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],
b)}(c.MomentumController);a.ZoomPlanarMomentumController=n})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports tslib ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});
a.ZoomSphericalMomentumController=void 0;n=function(a){function b(b){b=a.call(this,b)||this;b.interactionType=1;b.radius=0;b.tmpSceneCenter=e.vec3f64.create();b.tmpZoomAxisAngle=f.axisAngle.create();b.sphere=f.sphere.create();return b}d.__extends(b,a);Object.defineProperty(b.prototype,"screenCenter",{set:function(a){this._set("screenCenter",l.createScreenPointArray(a[0],a[1]))},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"sceneCenter",{set:function(a){this._set("sceneCenter",
e.vec3f64.clone(a))},enumerable:!1,configurable:!0});b.prototype.initialize=function(){this.sphere.radius=this.radius};b.prototype.momentumStep=function(a,b){a=this.momentum.valueDelta(0,a);m.applyZoomOnSphere(this.sphere,b,a);this.constraintOptions.interactionType=1;c.applyAll(this.view,b,this.constraintOptions);m.sphereOrPlanePointFromScreenPoint(this.sphere,b,this.screenCenter,this.tmpSceneCenter);f.axisAngle.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);m.applyRotation(b,
this.sphere.center,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=4};d.__decorate([k.property({constructOnly:!0})],b.prototype,"momentum",void 0);d.__decorate([k.property({constructOnly:!0})],b.prototype,"screenCenter",null);d.__decorate([k.property({constructOnly:!0})],b.prototype,"sceneCenter",null);d.__decorate([k.property({constructOnly:!0})],b.prototype,"radius",void 0);return b=d.__decorate([k.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],
b)}(h.MomentumController);a.ZoomSphericalMomentumController=n})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports tslib ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.PanPlanarMomentumEstimator=a.PanPlanarMomentum=void 0;var h=function(a){function c(b,c,d,e,f){b=a.call(this,b,c,d)||this;b.sceneVelocity=e;b.direction=
f;return b}d.__extends(c,a);c.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,b)};return c}(c.Momentum);a.PanPlanarMomentum=h;n=function(){function a(a,b,c){void 0===a&&(a=300);void 0===b&&(b=12);void 0===c&&(c=.84);this.minimumInitialVelocity=a;this.stopVelocity=b;this.friction=c;this.enabled=!0;this.time=new e.FilteredFiniteDifference(.6);this.screen=[new e.FilteredFiniteDifference(.4),new e.FilteredFiniteDifference(.4)];this.scene=[new e.FilteredFiniteDifference(.6),
new e.FilteredFiniteDifference(.6),new e.FilteredFiniteDifference(.6)];this.tmpDirection=k.vec3f64.create()}a.prototype.add=function(a,b,c){!this.enabled||this.time.hasLastValue&&.015>this.time.computeDelta(c)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(b[0]),this.scene[1].update(b[1]),this.scene[2].update(b[2]),this.time.update(c))};a.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();
this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,b,c){l.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var d=
l.vec3.length(this.tmpDirection);0<d&&l.vec3.scale(this.tmpDirection,this.tmpDirection,1/d);return new h(a,b,c,d/this.time.filteredDelta,this.tmpDirection)};return a}();a.PanPlanarMomentumEstimator=n})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.FilteredFiniteDifference=void 0;n=function(){function a(a){this.gain=a}a.prototype.update=function(a){if(this.hasLastValue){var d=this.computeDelta(a);
this.updateDelta(d)}this.lastValue=a};a.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(a.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!1,configurable:!0});a.prototype.computeDelta=function(a){return a-this.lastValue};a.prototype.updateDelta=function(a){this.filteredDelta=this.hasFilteredDelta?
(1-this.gain)*this.filteredDelta+this.gain*a:a};return a}();a.FilteredFiniteDifference=n})},"esri/views/navigation/Momentum":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.Momentum=void 0;n=function(){function a(a,d,e){this._initialVelocity=a;this._stopVelocity=d;this._friction=e;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},
enumerable:!1,configurable:!0});a.prototype.isFinished=function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!1,configurable:!0});a.prototype.value=function(a){return this.valueFromInitialVelocity(this._initialVelocity,a)};a.prototype.valueDelta=function(a,d){var e=this.value(a);return this.value(a+d)-e};a.prototype.valueFromInitialVelocity=function(a,d){d=Math.min(d,this.duration);var e=1-this.friction;return a*(Math.pow(e,
d)-1)/Math.log(e)};return a}();a.Momentum=n})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports tslib ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.PanSphericalMomentumEstimator=a.PanSphericalMomentum=void 0;var b=function(a){function b(b,
c,d,e,f,g,h){void 0===g&&(g=0);b=a.call(this,b,c,d)||this;b.angularVelocity1=e;b.axis1=f;b.angularVelocity2=g;b.axis2=h;return b}d.__extends(b,a);b.prototype.value1=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,b)};b.prototype.value2=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,b)};return b}(f.Momentum);a.PanSphericalMomentum=b;n=function(){function a(a,b,c){void 0===a&&(a=300);void 0===b&&(b=12);void 0===c&&(c=.84);
this.minimumInitialVelocity=a;this.stopVelocity=b;this.friction=c;this.enabled=!0;this.tmpAxis1=e.vec3f64.create();this.tmpAxis2=e.vec3f64.create();this.tmpAngles=l.vec2f64.create();this.time=new h.FilteredFiniteDifference(.3);this.screen=[new h.FilteredFiniteDifference(.4),new h.FilteredFiniteDifference(.4)];this.angle1=new m.FilteredValue(.6);this.angle2=new m.FilteredValue(.6);this.axis1=e.vec3f64.create();this.axis2=e.vec3f64.create();this.lastScene=e.vec3f64.create()}a.prototype.addMomentumDirectRotation=
function(a,b,d,e,f,g){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(d))return;e=c.rotationAngleAndAxisDirectRotation(this.lastScene,b,this.tmpAxis2,e,f,g);this.angle2.update(0);1E-5>k.vec3.squaredLength(this.tmpAxis2)?e=0:k.vec3.normalize(this.axis1,this.tmpAxis2);this.angle1.update(e);k.vec3.copy(this.lastScene,b)}this.screen[0].update(a[0]);this.screen[1].update(a[1]);this.time.update(d)}};a.prototype.addMomentumPreserveHeading=function(a,b,d,e,f,g,h){if(this.enabled){if(this.time.hasLastValue){if(.01>
this.time.computeDelta(d))return;c.rotationAnglesAndAxesHeadingPreserving(this.lastScene,b,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,e,f,g,h,!1);1E-5>k.vec3.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),k.vec3.normalize(this.axis1,this.tmpAxis1),k.vec3.normalize(this.axis2,this.tmpAxis2));k.vec3.copy(this.lastScene,b)}this.screen[0].update(a[0]);this.screen[1].update(a[1]);this.time.update(d)}};
a.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,c,d){return new b(a,
c,d,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return a}();a.PanSphericalMomentumEstimator=n})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.FilteredValue=void 0;n=function(){function a(a){this.gain=a}a.prototype.update=function(a){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*a:a};a.prototype.reset=
function(){this.filteredValue=void 0};Object.defineProperty(a.prototype,"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!1,configurable:!0});return a}();a.FilteredValue=n})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","tslib","./MomentumEstimator"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.RotationMomentumEstimator=void 0;n=function(a){function e(c,d,e,f){void 0===c&&(c=3);void 0===d&&(d=.01);
void 0===e&&(e=.95);void 0===f&&(f=12);return a.call(this,c,d,e,f)||this}d.__extends(e,a);e.prototype.add=function(c,d){if(this.value.hasLastValue){var e=this.value.lastValue;for(c-=e;c>Math.PI;)c-=2*Math.PI;for(;c<-Math.PI;)c+=2*Math.PI;c=e+c}a.prototype.add.call(this,c,d)};return e}(l.MomentumEstimator);a.RotationMomentumEstimator=n})},"esri/views/navigation/MomentumEstimator":function(){define(["require","exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(n,a,d,
l,k){Object.defineProperty(a,"__esModule",{value:!0});a.MomentumEstimator=void 0;n=function(){function a(a,d,e,f){void 0===a&&(a=2.5);void 0===d&&(d=.01);void 0===e&&(e=.95);void 0===f&&(f=12);this.minimumInitialVelocity=a;this.stopVelocity=d;this.friction=e;this.maxVelocity=f;this.enabled=!0;this.value=new l.FilteredFiniteDifference(.8);this.time=new l.FilteredFiniteDifference(.3)}a.prototype.add=function(a,d){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(d))return;if(this.value.hasFilteredDelta){var c=
this.value.computeDelta(a);0>this.value.filteredDelta*c&&this.value.reset()}}this.time.update(d);this.value.update(a)}};a.prototype.reset=function(){this.value.reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;var a=this.value.filteredDelta/this.time.filteredDelta,a=d.clamp(a,-this.maxVelocity,this.maxVelocity);return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=
function(a,d,e){return new k.Momentum(a,d,e)};return a}();a.MomentumEstimator=n})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","tslib","./Momentum","./MomentumEstimator"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.ZoomMomentumEstimator=a.ZoomMomentum=void 0;var e=function(a){function c(c,d,b){return a.call(this,c,d,b)||this}d.__extends(c,a);c.prototype.value=function(c){c=a.prototype.value.call(this,c);return Math.exp(c)};c.prototype.valueDelta=
function(c,d){var b=a.prototype.value.call(this,c);c=a.prototype.value.call(this,c+d);return Math.exp(c-b)};return c}(l.Momentum);a.ZoomMomentum=e;n=function(a){function c(c,d,b,e){void 0===c&&(c=2.5);void 0===d&&(d=.01);void 0===b&&(b=.95);void 0===e&&(e=12);return a.call(this,c,d,b,e)||this}d.__extends(c,a);c.prototype.add=function(c,d){a.prototype.add.call(this,Math.log(c),d)};c.prototype.createMomentum=function(a,c,b){return new e(a,c,b)};return c}(k.MomentumEstimator);a.ZoomMomentumEstimator=
n})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports tslib ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z){Object.defineProperty(a,"__esModule",{value:!0});a.PinchAndPanController=a.PanMode=void 0;var x;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(x=a.PanMode||(a.PanMode={}));var B=h.vec3f64.fromValues(0,0,1),A=16/180*Math.PI;n=function(a){function b(b){b=a.call(this,b)||this;b.view=null;b.rotationValueSmooth=new f.ExponentialFalloff(.05);b.scalingValueSmooth=new f.ExponentialFalloff(.05);b.planeHorizontal=r.plane.create();b.planeVertical=
r.plane.create();b.rotationMomentumEstimator=new w.RotationMomentumEstimator;b.panMomentumEstimator=new v.PanPlanarMomentumEstimator(300,12,.9);b.zoomMomentumEstimator=new z.ZoomMomentumEstimator;b.beginCenter=h.vec3f64.create();b.tmpPoints=[];b.beginCenterScreen=k.createScreenPointArray();b.tmpCentroid3d=h.vec3f64.create();b.tmpCentroid2d=k.createScreenPointArray();b.tmp2d=k.createScreenPointArray();b.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new q.default,
interactionDirection:null,tiltMode:0};return b}d.__extends(b,a);Object.defineProperty(b.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!1,configurable:!0});b.prototype.begin=function(a){if(this.active){var b=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=b;this.rotationMomentumEstimator.enabled=b;this.panMomentumEstimator.enabled=b;this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.rotationValueSmooth.reset();
this.scalingValueSmooth.reset();k.screenPointObjectToArray(a.center,this.beginCenterScreen);r.plane.fromNormalAndOffset(B,0,this.planeHorizontal);b=h.vec3f64.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,b);var d=h.vec3f64.create();c.vec3.negate(d,this.beginCamera.viewForward);var e=h.vec3f64.create();c.vec3.copy(e,B);var f=c.vec3.dot(d,e);this.panMode=l.asinClamped(0>f?-f:f)>=A?x.Horizontal:x.Vertical;r.plane.setOffsetFromPoint(this.planeHorizontal,b,this.planeHorizontal);
this.beginCamera.aboveGround||r.plane.negate(this.planeHorizontal,this.planeHorizontal);this.panMode===x.Vertical?(c.vec3.scale(e,e,f),c.vec3.subtract(this.planeVertical,d,e),c.vec3.normalize(this.planeVertical,this.planeVertical),r.plane.setOffsetFromPoint(this.planeVertical,b,this.planeVertical),this.computePlanePoints(a.pointers,this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(a.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);u.centroid(this.tmpPoints,
this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};b.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<a.pointers.size,c=this.panMode===x.Horizontal?this.planeHorizontal:this.planeVertical,d=this.beginCenter;if(b){var e=this.beginRadius/a.radius,f=.001875*Math.min(Math.max(a.radius,40),120);this.scalingValueSmooth.gain=f;this.scalingValueSmooth.update(e);u.applyZoomToPoint(this.currentCamera,d,this.scalingValueSmooth.value,
this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=m.pixelDistanceToInteractionFactor(Math.abs(a.radius-this.beginRadius));m.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(a.pointers,c,this.currentCamera,this.tmpPoints);u.centroid(this.tmpPoints,this.tmpCentroid3d);k.screenPointObjectToArray(a.center,this.tmpCentroid2d);
u.applyPanPlanar(this.currentCamera,d,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*a.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=m.pixelDistanceToInteractionFactor(this.beginCenterScreen,this.tmpCentroid2d);m.applyAll(this.view,this.currentCamera,this.constraintOptions);b&&(b=this.planeHorizontal,c=this.rotationValueSmooth.value,e=u.normalizeRotationDelta(a.angle-c),f=.00125*Math.min(Math.max(a.radius,
40),120),this.rotationValueSmooth.gain=f,this.rotationValueSmooth.update(c+e),f=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(f,.001*a.timestamp),u.applyRotation(this.currentCamera,d,r.axisAngle.wrapAxisAngle(b,f)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=m.pixelDistanceToInteractionFactor(Math.abs(a.radius*f)),m.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};b.prototype.end=
function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();return(a=this.zoomMomentumEstimator.evaluateMomentum())?new t.ZoomPlanarMomentumController({view:this.view,momentum:a,zoomCenter:this.beginCenter}):(a=this.rotationMomentumEstimator.evaluateMomentum())?new p.RotationMomentumController({view:this.view,momentum:a,center:this.beginCenter,axis:r.plane.normal(this.planeHorizontal)}):(a=this.panMomentumEstimator.evaluateMomentum())?new g.PanPlanarMomentumController({view:this.view,
momentum:a}):null};b.prototype.computePlanePoints=function(a,b,c,d){d.length=a.size;var e=this.tmp2d,f=0;a.forEach(function(a){e[0]=a.x;e[1]=a.y;void 0===d[f]&&(d[f]=h.vec3f64.create());u.intersectPlaneFromScreenPoint(b,c,e,d[f]);f+=1});return d};d.__decorate([e.property({constructOnly:!0})],b.prototype,"view",void 0);return b=d.__decorate([e.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],b)}(b.InteractiveController);a.PinchAndPanController=n})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require",
"exports","tslib","../../../input/InputHandler"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.PointerDownCancelAnimation=void 0;n=function(a){function e(c,d){var e=a.call(this,!0)||this;e.view=c;e.registerIncoming("pointer-down",d,function(){return e.view.state.stopActiveCameraController()});return e}d.__extends(e,a);return e}(l.InputHandler);a.PointerDownCancelAnimation=n})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","tslib",
"./SingleKey"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.SingleKeyResetHeading=void 0;n=function(a){function e(c,d,e){e=a.call(this,d,e)||this;e.view=c;e.key=d;return e}d.__extends(e,a);e.prototype.activate=function(){this.view.goTo({heading:0}).catch(function(){})};return e}(l.SingleKey);a.SingleKeyResetHeading=n})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","tslib","../../../input/InputHandler"],function(n,a,d,l){Object.defineProperty(a,
"__esModule",{value:!0});a.SingleKey=void 0;n=function(a){function e(c,d){var e=a.call(this,!0)||this;e.key=c;e.registerIncoming("key-down",d,function(a){return e._handleKeyDown(a)});return e}d.__extends(e,a);e.prototype._handleKeyDown=function(a){a.data.key===this.key&&(this.activate(),a.stopPropagation())};return e}(l.InputHandler);a.SingleKey=n})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","tslib","./SingleKey"],function(n,a,d,l){Object.defineProperty(a,
"__esModule",{value:!0});a.SingleKeyResetTilt=void 0;n=function(a){function e(c,d,e){e=a.call(this,d,e)||this;e.view=c;e.key=d;return e}d.__extends(e,a);e.prototype.activate=function(){this.view.goTo({tilt:0}).catch(function(){})};return e}(l.SingleKey);a.SingleKeyResetTilt=n})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports tslib ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,
"__esModule",{value:!0});a.TwoFingerTilt=void 0;n=function(a){function c(c,d){void 0===d&&(d=!1);var b=a.call(this,!0)||this;b.view=c;b.invert=d;b.registerIncoming("vertical-two-finger-drag",function(a){return b.handleTwoFinger(a)});return b}d.__extends(c,a);c.prototype.handleTwoFinger=function(a){var c=l.createScreenPointArray(0,a.data.delta*(this.invert?-1:1));switch(a.data.action){case "begin":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
new k.RotateController({view:this.view,pivot:"center"});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(c);break;case "update":this.cameraController&&this.cameraController.update(c);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}};return c}(e.InputHandler);a.TwoFingerTilt=n})},"esri/views/input/BrowserEventSource":function(){define("require exports ../../core/has ../../core/screenUtils ../../core/libs/pep/pep ./keys ./gamepad/GamepadSource".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.BrowserEventSource=void 0;var h=d("trident"),m=d("edge"),f=d("chrome"),b=d("ff"),g=d("safari");n=function(){function a(a,b){var d=this;this.input=b;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=a;k.applyLocal(a);a.getAttribute("tabindex")||a.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,
"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new c.GamepadSource(a,this.input);this._gamepadSource.onEvent=
function(a){return d._callback("gamepad",a)}}a.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(b){a._releasePointerCaptureSafe(b)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};Object.defineProperty(a.prototype,"browserTouchPanningEnabled",{get:function(){return this._browserTouchPanningEnabled},
set:function(a){this._browserTouchPanningEnabled=a;this._updateTouchAction();this._updateTouchEventHandling()},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"activeEvents",{set:function(a){var b=this,c;for(c in this._active)a&&a.has(c)||(this._element.removeEventListener(p[c],this._active[c]),delete this._active[c]);a&&a.forEach(function(a){if(!b._active[a]&&p[a]){var c=
(b._eventHandlers[a]||b._handleDefault).bind(b,a);b._element.addEventListener(p[a],c);b._active[a]=c}});this._gamepadSource.hasEventListeners=a&&a.has("gamepad")},enumerable:!1,configurable:!0});a.prototype.setPointerCapture=function(a,b){b?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._releasePointerCaptureSafe(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};a.prototype._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?
"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};a.prototype._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};a.prototype._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");
this._element.classList.remove("esri-view-surface--touch-pan");this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};a.prototype._releasePointerCaptureSafe=function(a){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(a)||this._element.releasePointerCapture(a)}catch(r){}};a.prototype._updateNormalizedPointerLikeEvent=function(b,c){b=l.createScreenPointFromNativeEvent(this._element,b);a.test.disableSubpixelCoordinates&&(b.x=Math.round(b.x),b.y=Math.round(b.y));
c.x=b.x;c.y=b.y;return c};a.prototype._handleKey=function(a,b){var c=e.eventKey(b);c&&"key-up"===a&&this._keyDownState.delete(c);b={native:b,key:c,repeat:c&&this._keyDownState.has(c)};c&&"key-down"===a&&this._keyDownState.add(b.key);this._callback(a,b)};a.prototype._handlePointer=function(a,b){b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons,eventId:this._eventId++});this._callback(a,b)};a.prototype._handlePointerPreventDefault=
function(a,b){var c=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons,eventId:this._eventId++});b.preventDefault();this._callback(a,c)};a.prototype._handleMouseWheel=function(a,c){var d=c.deltaY;switch(c.deltaMode){case 0:if(h||m)d=d/document.documentElement.clientHeight*600;break;case 1:d*=30;break;case 2:d*=900}h||m?d*=.7:f||g?d*=.6:b&&(d*=1.375);var e=Math.abs(d);100<e&&(d=d/e*200/(1+Math.exp(-.02*(e-100))));c=this._updateNormalizedPointerLikeEvent(c,
{native:c,x:0,y:0,deltaY:d});this._callback(a,c)};a.prototype._handlePointerCaptureLost=function(a,b){this._activePointerCaptures.delete(b.pointerId);this._handleDefault(a,b)};a.prototype._handleDefault=function(a,b){var c={native:b};b.preventDefault();this._callback(a,c)};a.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};a.prototype._preventMultiTouchPanning=function(a){1<a.touches.length&&a.preventDefault()};a.test={disableSubpixelCoordinates:!1};return a}();a.BrowserEventSource=
n;var p={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"}})},"esri/core/libs/pep/pep":function(){define(function(){function n(a,c){c=c||Object.create(null);var d=document.createEvent("Event");
d.initEvent(a,c.bubbles||!1,c.cancelable||!1);a=2;for(var e;a<f.length;a++)e=f[a],d[e]=c[e]||b[a];d.buttons=c.buttons||0;a=0;a=c.pressure&&d.buttons?c.pressure:d.buttons?.5:0;d.x=d.clientX;d.y=d.clientY;d.pointerId=c.pointerId||0;d.width=c.width||0;d.height=c.height||0;d.pressure=a;d.tiltX=c.tiltX||0;d.tiltY=c.tiltY||0;d.twist=c.twist||0;d.tangentialPressure=c.tangentialPressure||0;d.pointerType=c.pointerType||"";d.hwTimestamp=c.hwTimestamp||0;d.isPrimary=c.isPrimary||!1;return d}function a(){this.array=
[];this.size=0}function d(a,b,c,d){this.addCallback=a.bind(d);this.removeCallback=b.bind(d);this.changedCallback=c.bind(d);A&&(this.observer=new A(this.mutationWatcher.bind(this)))}function l(a){return"body /shadow-deep/ "+k(a)}function k(a){return'[touch-action\x3d"'+a+'"]'}function e(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; }"}function c(){if(F){E.forEach(function(a){String(a)===a?(G+=k(a)+e(a)+"\n",H&&(G+=l(a)+e(a)+"\n")):(G+=a.selectors.map(k)+e(a.rule)+"\n",H&&(G+=a.selectors.map(l)+
e(a.rule)+"\n"))});var a=document.createElement("style");a.textContent=G;document.head.appendChild(a)}}function h(a){if(!q.pointermap.has(a))throw a=Error("NotFoundError"),a.name="NotFoundError",a;}function m(a){for(var b=a.parentNode;b&&b!==a.ownerDocument;)b=b.parentNode;if(!b)throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var f="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),b=[!1,!1,
null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],g=window.Map&&window.Map.prototype.forEach?Map:a;a.prototype={set:function(a,b){if(void 0===b)return this.delete(a);this.has(a)||this.size++;this.array[a]=b},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,b){return this.array.forEach(function(c,d){a.call(b,c,d,this)},this)}};var p="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),
t=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],u={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},r="undefined"!==typeof SVGElementInstance,q={pointermap:new g,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,b){var c=b.events;c&&(c.forEach(function(a){b[a]&&(this.eventMap[a]=b[a].bind(b))},this),this.eventSources[a]=b,this.eventSourceList.push(b))},register:function(a){for(var b=
this.eventSourceList.length,c=0,d;c<b&&(d=this.eventSourceList[c]);c++)d.register.call(d,a)},unregister:function(a){for(var b=this.eventSourceList.length,c=0,d;c<b&&(d=this.eventSourceList[c]);c++)d.unregister.call(d,a)},contains:function(a,b){try{return a.contains(b)}catch(ga){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=
!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var b=a.type;(b=this.eventMap&&
this.eventMap[b])&&b(a);a._handledByPE=!0}},listen:function(a,b){b.forEach(function(b){this.addEvent(a,b)},this)},unlisten:function(a,b){b.forEach(function(b){this.removeEvent(a,b)},this)},addEvent:function(a,b){a.addEventListener(b,this.boundHandler)},removeEvent:function(a,b){a.removeEventListener(b,this.boundHandler)},makeEvent:function(a,b){this.captureInfo[b.pointerId]&&(b.relatedTarget=null);a=new n(a,b);b.preventDefault&&(a.preventDefault=b.preventDefault);a._target=a._target||b.target;return a},
fireEvent:function(a,b){a=this.makeEvent(a,b);return this.dispatchEvent(a)},cloneEvent:function(a){for(var b=Object.create(null),c,d=0;d<p.length;d++)c=p[d],b[c]=a[c]||t[d],r&&("target"===c||"relatedTarget"===c)&&b[c]instanceof SVGElementInstance&&(b[c]=b[c].correspondingUseElement);a.preventDefault&&(b.preventDefault=function(){a.preventDefault()});return b},getTarget:function(a){var b=this.captureInfo[a.pointerId];if(!b)return a._target;if(a._target===b||!(a.type in u))return b},propagate:function(a,
b,c){for(var d=a.target,e=[];null!=d&&d!==document&&!d.contains(a.relatedTarget);)if(e.push(d),d=d.parentNode,!d)return;c&&e.reverse();e.forEach(function(c){a.target=c;b.call(this,a)},this)},setCapture:function(a,b,c){this.captureInfo[a]&&this.releaseCapture(a,c);this.captureInfo[a]=b;this.implicitRelease=this.releaseCapture.bind(this,a,c);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);var d=new n("gotpointercapture");d.pointerId=
a;d._target=b;c||this.asyncDispatchEvent(d)},releaseCapture:function(a,b){var c=this.captureInfo[a];if(c){this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);var d=new n("lostpointercapture");d.pointerId=a;d._target=c;b||this.asyncDispatchEvent(d)}},dispatchEvent:function(a){var b=this.getTarget(a);if(b)return b.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,
a))}};q.boundHandler=q.eventHandler.bind(q);var v={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var b=a.olderShadowRoot;!b&&(a=a.querySelector("shadow"))&&(b=a.olderShadowRoot);return b},allShadows:function(a){var b=[];for(a=this.shadow(a);a;)b.push(a),a=this.olderShadow(a);return b},searchRoot:function(a,b,c){if(a){var d=a.elementFromPoint(b,
c),e;for(e=this.targetingShadow(d);e;){if(a=e.elementFromPoint(b,c))return d=this.targetingShadow(a),this.searchRoot(d,b,c)||a;e=this.olderShadow(e)}return d}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var b=a.clientX,c=a.clientY;a=this.owner(a.target);a.elementFromPoint(b,c)||(a=document);return this.searchRoot(a,b,c)}},w=Array.prototype.forEach.call.bind(Array.prototype.forEach),
z=Array.prototype.map.call.bind(Array.prototype.map),x=Array.prototype.slice.call.bind(Array.prototype.slice),B=Array.prototype.filter.call.bind(Array.prototype.filter),A=window.MutationObserver||window.WebKitMutationObserver,C={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};d.prototype={watchSubtree:function(a){this.observer&&v.canTarget(a)&&this.observer.observe(a,C)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?
this.installOnLoad():this.installNewSubtree(a)},installNewSubtree:function(a){w(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,b){this.changedCallback(a,b)},concatLists:function(a,b){return a.concat(x(b))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===
document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var b=z(a,this.findElements,this);b.push(B(a,this.isElement));return b.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,
this)):"attributes"===a.type&&this.elementChanged(a.target,a.oldValue)}};var E=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],G="",F=window.PointerEvent||window.MSPointerEvent,H=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,J=q.pointermap,I=[1,4,2,8,16],K=!1;try{K=1===(new MouseEvent("test",{buttons:1})).buttons}catch(ca){}var L={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){q.listen(a,
this.events)},unregister:function(a){q.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var b=this.lastTouches,c=a.clientX;a=a.clientY;for(var d=0,e=b.length,f;d<e&&(f=b[d]);d++){var g=Math.abs(a-f.y);if(25>=Math.abs(c-f.x)&&25>=g)return!0}},prepareEvent:function(a){var b=q.cloneEvent(a),c=b.preventDefault;b.preventDefault=function(){a.preventDefault();c()};b.pointerId=this.POINTER_ID;b.isPrimary=!0;b.pointerType=this.POINTER_TYPE;return b},prepareButtonsForMove:function(a,
b){var c=J.get(this.POINTER_ID);a.buttons=0!==b.which&&c?c.buttons:0;b.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=J.get(this.POINTER_ID),c=this.prepareEvent(a);K||(c.buttons=I[c.button],b&&(c.buttons|=b.buttons),a.buttons=c.buttons);J.set(this.POINTER_ID,a);b&&0!==b.buttons?q.move(c):q.down(c)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);K||this.prepareButtonsForMove(b,a);b.button=-1;J.set(this.POINTER_ID,a);q.move(b)}},
mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=J.get(this.POINTER_ID),c=this.prepareEvent(a);if(!K){var d=I[c.button];c.buttons=b?b.buttons&~d:0;a.buttons=c.buttons}J.set(this.POINTER_ID,a);c.buttons&=~I[c.button];0===c.buttons?q.up(c):q.move(c)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);K||this.prepareButtonsForMove(b,a);b.button=-1;J.set(this.POINTER_ID,a);q.enterOver(b)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=
this.prepareEvent(a);K||this.prepareButtonsForMove(b,a);b.button=-1;q.leaveOut(b)}},cancel:function(a){a=this.prepareEvent(a);q.cancel(a);this.deactivateMouse()},deactivateMouse:function(){J.delete(this.POINTER_ID)}},M=q.captureInfo,Q=v.findTarget.bind(v),R=v.allShadows.bind(v),O=q.pointermap,N,S={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){N.enableOnSubtree(a)},unregister:function(){},elementAdded:function(a){var b=a.getAttribute("touch-action"),c=this.touchActionToScrollType(b);
c&&(a._scrollType=c,q.listen(a,this.events),R(a).forEach(function(a){a._scrollType=c;q.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;q.unlisten(a,this.events);R(a).forEach(function(a){a._scrollType=void 0;q.unlisten(a,this.events)},this)},elementChanged:function(a,b){var c=a.getAttribute("touch-action"),d=this.touchActionToScrollType(c);b=this.touchActionToScrollType(b);d&&b?(a._scrollType=d,R(a).forEach(function(a){a._scrollType=d},this)):b?this.elementRemoved(a):
d&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var b=this.scrollTypes;if("none"===a)return"none";if(a===b.XSCROLLER)return"X";if(a===b.YSCROLLER)return"Y";if(b.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===O.size||1===O.size&&O.has(1))this.firstTouch=
a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var b=0;if("touchstart"===a||"touchmove"===a)b=
1;return b},touchToPointer:function(a){var b=this.currentTouchEvent,c=q.cloneEvent(a),d=c.pointerId=a.identifier+2;c.target=M[d]||Q(c);c.bubbles=!0;c.cancelable=!0;c.detail=this.clickCount;c.button=0;c.buttons=this.typeToButtons(b.type);c.width=2*(a.radiusX||a.webkitRadiusX||0);c.height=2*(a.radiusY||a.webkitRadiusY||0);c.pressure=a.force||a.webkitForce||.5;c.isPrimary=this.isPrimaryTouch(a);c.pointerType=this.POINTER_TYPE;c.altKey=b.altKey;c.ctrlKey=b.ctrlKey;c.metaKey=b.metaKey;c.shiftKey=b.shiftKey;
var e=this;c.preventDefault=function(){e.scrolling=!1;e.firstXY=null;b.preventDefault()};return c},processTouches:function(a,b){var c=a.changedTouches;this.currentTouchEvent=a;a=0;for(var d;a<c.length;a++)d=c[a],b.call(this,this.touchToPointer(d))},shouldScroll:function(a){if(this.firstXY){var b;b=a.currentTarget._scrollType;if("none"===b)b=!1;else if("XY"===b)b=!0;else{a=a.changedTouches[0];var c="Y"===b?"X":"Y";b=Math.abs(a["client"+b]-this.firstXY[b])>=Math.abs(a["client"+c]-this.firstXY[c])}this.firstXY=
null;return b}},findTouch:function(a,b){for(var c=0,d=a.length,e;c<d&&(e=a[c]);c++)if(e.identifier===b)return!0},vacuumTouches:function(a){var b=a.touches;if(O.size>=b.length){var c=[];O.forEach(function(a,d){1===d||this.findTouch(b,d-2)||c.push(a.out)},this);c.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){O.set(a.pointerId,
{target:a.target,out:a,outTarget:a.target});q.enterOver(a);q.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var b=O.get(a.pointerId);if(b){var c=b.out,d=b.outTarget;q.move(a);c&&d!==a.target&&(c.relatedTarget=a.target,a.relatedTarget=d,c.target=d,a.target?(q.leaveOut(c),q.enterOver(a)):(a.target=d,a.relatedTarget=null,this.cancelOut(a)));b.out=a;b.outTarget=
a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||(q.up(a),q.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){q.cancel(a);q.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){O.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var b=L.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},
b.push(a),b=function(a,b){b=a.indexOf(b);-1<b&&a.splice(b,1)}.bind(null,b,a),setTimeout(b,2500))}};N=new d(S.elementAdded,S.elementRemoved,S.elementChanged,S);var P=q.pointermap,U=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,Z={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){q.listen(a,this.events)},unregister:function(a){q.unlisten(a,this.events)},
POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var b=a;U&&(b=q.cloneEvent(a),b.pointerType=this.POINTER_TYPES[a.pointerType]);return b},cleanup:function(a){P.delete(a)},MSPointerDown:function(a){P.set(a.pointerId,a);a=this.prepareEvent(a);q.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);q.move(a)},MSPointerUp:function(a){var b=this.prepareEvent(a);q.up(b);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);q.leaveOut(a)},MSPointerOver:function(a){a=
this.prepareEvent(a);q.enterOver(a)},MSPointerCancel:function(a){var b=this.prepareEvent(a);q.cancel(b);this.cleanup(a.pointerId)},MSLostPointerCapture:function(a){a=q.makeEvent("lostpointercapture",a);q.dispatchEvent(a)},MSGotPointerCapture:function(a){a=q.makeEvent("gotpointercapture",a);q.dispatchEvent(a)}},V,T,Y;window.navigator.msPointerEnabled?(V=function(a){h(a);m(this);0!==q.pointermap.get(a).buttons&&(q.setCapture(a,this,!0),this.msSetPointerCapture(a))},T=function(a){h(a);q.releaseCapture(a,
!0);this.msReleasePointerCapture(a)}):(V=function(a){h(a);m(this);0!==q.pointermap.get(a).buttons&&q.setCapture(a,this)},T=function(a){h(a);q.releaseCapture(a)});Y=function(a){return!!q.captureInfo[a]};var X=window.PointerEvent||window.MSPointerEvent;return{dispatcher:q,Installer:d,PointerEvent:n,PointerMap:g,targetFinding:v,applyGlobal:function(){c();window.PointerEvent||(window.PointerEvent=n,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,
enumerable:!0}),q.registerSource("ms",Z)):(Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),q.registerSource("mouse",L),void 0!==window.ontouchstart&&q.registerSource("touch",S)),q.register(document));window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:V},releasePointerCapture:{value:T},hasPointerCapture:{value:Y}})},applyLocal:function(a){X||(window.PointerEvent||(window.navigator.msPointerEnabled?
q.registerSource("ms",Z):(q.registerSource("mouse",L),void 0!==window.ontouchstart&&q.registerSource("touch",S)),q.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=V.bind(a),a.releasePointerCapture=T.bind(a),a.hasPointerCapture=Y.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action","none"))}}})},"esri/views/input/gamepad/GamepadSource":function(){define(["require","exports","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],
function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.GamepadSource=void 0;n=function(){function a(a,d){var c=this;this.element=a;this.input=d;this._hasEventListeners=!1;this.onConnectGamepad=function(a){c.connectGamepad(a.gamepad)};this.onDisconnectGamepad=function(a){a=a.gamepad;var b=a.index,d=c.inputDevices[b];d&&(c.emitGamepadEvent(a,k.extractState(d),!1),c.inputDevices.splice(b,1),c.latestUpdate.splice(b,1),c.input.gamepad.devices.remove(d),c.ensurePollingState())};this.frameTask=
null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(this.connectGamepad),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState()}a.prototype.destroy=function(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),window.removeEventListener("gamepaddisconnected",
this.onDisconnectGamepad))};Object.defineProperty(a.prototype,"hasEventListeners",{set:function(a){this._hasEventListeners!==a&&(this._hasEventListeners=a,this.ensurePollingState())},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"eventsEnabled",{get:function(){return this.supported&&0<this.inputDevices.length&&this._hasEventListeners},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"onEvent",{set:function(a){this.callback=a},enumerable:!1,configurable:!0});a.prototype.connectGamepad=
function(a){var c=new l(a);"unknown"!==c.deviceType&&(this.inputDevices[a.index]=c,this.input.gamepad.devices.add(c));this.ensurePollingState()};a.prototype.ensurePollingState=function(){this.eventsEnabled?this.startPolling():this.stopPolling()};a.prototype.startPolling=function(){var a=this;null==this.frameTask&&(this.frameTask=d.addFrameTask({update:function(){return a.readGamepadState()}}))};a.prototype.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=
[])};a.prototype.readGamepadState=function(){var a=this,d=document.hasFocus(),e=this.element.contains(document.activeElement),f="document"===this.input.gamepad.enabledFocusMode&&!d||"view"===this.input.gamepad.enabledFocusMode&&!e;this.forEachGamepad(function(b){var c=a.inputDevices[b.index];if(c){var d=a.latestUpdate[b.index],c=k.extractState(c),e=f||k.stateIdle(c);d&&(d.timestamp===b.timestamp||!d.active&&e||k.stateEqual(d.state,c))||a.emitGamepadEvent(b,c,!e)}})};a.prototype.forEachGamepad=function(a){for(var c=
window.navigator.getGamepads(),d=0;d<c.length;d++){var e=c[d];this.validate(e)&&a(e)}};a.prototype.emitGamepadEvent=function(a,d,e){var c=this.latestUpdate[a.index];if((c=c&&c.active)||e)this.latestUpdate[a.index]={timestamp:a.timestamp,state:d,active:e},this.callback&&this.callback({device:this.inputDevices[a.index],state:d,action:!c&&e?"start":c&&e?"update":"end"})};a.prototype.validate=function(a){if(!a||!a.connected)return!1;for(var c=0;c<a.axes.length;c++)if(isNaN(a.axes[c]))return!1;return!0};
return a}();a.GamepadSource=n})},"esri/views/input/gamepad/GamepadState":function(){define(["require","exports","../../../core/mathUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.stateIdle=a.stateEqual=a.extractState=void 0;a.extractState=function(a){var k=a.native;return k?{buttons:k.buttons.map(function(a){return a.pressed?a.value?a.value:1:0}),axes:k.axes.map(function(e){var c=a.axisThreshold,h=Math.abs(e);e=h<c?0:d.sign(e)*(h-c)/(1-c);return e})}:{buttons:[],axes:[]}};
a.stateEqual=function(a,d){if(a.axes.length!==d.axes.length||a.buttons.length!==d.buttons.length)return!1;for(var e=0;e<a.axes.length;e++)if(a.axes[e]!==d.axes[e])return!1;for(e=0;e<a.buttons.length;e++)if(a.buttons[e]!==d.buttons[e])return!1;return!0};a.stateIdle=function(a){for(var d=0;d<a.axes.length;d++)if(0!==a.axes[d])return!1;for(d=0;d<a.buttons.length;d++)if(0!==a.buttons[d])return!1;return!0}})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports","tslib",
"../InputHandler"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.PreventContextMenu=void 0;n=function(a){function e(){var c=a.call(this,!0)||this;c.registerIncoming("context-menu",function(a){a.data.native.preventDefault()});return c}d.__extends(e,a);return e}(l.InputHandler);a.PreventContextMenu=n;a.default=n})},"esri/views/input/recognizers/Drag":function(){define("require exports tslib ../../../core/screenUtils ../../../layers/support/timeUtils ../InputHandler ./support".split(" "),
function(n,a,d,l,k,e,c){function h(a){var b=[];a.forEach(function(a){b.push(l.createScreenPoint(a.event.x,a.event.y))});return c.fitCircleLSQ(b)}function m(a){var c=h(a),d=0;a.forEach(function(a){for(var e=b(a,c),e=e-a.lastAngle;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;e=a.lastAngle+e;a.lastAngle=e;d+=e-a.initialAngle});d/=a.size||1;return{angle:d,radius:c.radius,center:c.center}}function f(a){var b=new Map;a.forEach(function(a,c){return b.set(c,a.event)});return b}function b(a,b){a=
a.event;return Math.atan2(a.y-b.center.y,a.x-b.center.x)}Object.defineProperty(a,"__esModule",{value:!0});a.Button=a.Drag=void 0;n=function(a){function c(b){var c=a.call(this,!1)||this;c.navigationTouch=b;c.startStateModifiers=new Set;c.activePointerMap=new Map;c.isDragging=!1;c.isCurrentDragSuppressed=!1;c.drag=c.registerOutgoing("drag");c.registerIncoming("pointer-drag",c.handlePointerDrag.bind(c));c.registerIncoming("pointer-up",c.handlePointerUpAndPointerLost.bind(c));c.registerIncoming("pointer-capture-lost",
c.handlePointerUpAndPointerLost.bind(c));c.registerIncoming("pointer-cancel",c.handlePointerUpAndPointerLost.bind(c));return c}d.__extends(c,a);c.prototype.createPayload=function(a,b,c,d){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:b.buttons,timestamp:d,pointers:f(this.activePointerMap),pointer:b,angle:c.angle,radius:c.radius,center:c.center}};c.prototype.addPointer=function(a){var c=a.native.pointerId,d=m(this.activePointerMap).angle;a={event:a,initialAngle:0,lastAngle:0};
this.activePointerMap.set(c,a);c=b(a,h(this.activePointerMap));a.initialAngle=c;a.lastAngle=c;this.updatePointerAngles(d)};c.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var b=this.activePointerMap.get(a.native.pointerId);b?b.event=a:this.addPointer(a)}};c.prototype.removePointer=function(a){var b=m(this.activePointerMap).angle;this.activePointerMap.delete(a);this.updatePointerAngles(b)};c.prototype.updatePointerAngles=function(a){var c=m(this.activePointerMap);this.activePointerMap.forEach(function(d){d.initialAngle=
b(d,c)-a;d.lastAngle=b(d,c)-a})};c.prototype.emitEvent=function(a,b,c){var d=m(this.activePointerMap);this.drag.emit(this.createPayload(a,b,d,c),void 0,this.startStateModifiers)};c.prototype.handlePointerUpAndPointerLost=function(a){var b=a.data.native.pointerId,c=k.Milliseconds(a.timestamp);this.activePointerMap.get(b)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",a.data,c),this.isCurrentDragSuppressed=this.isDragging=!1,this.removePointer(b)):
(this.removePointer(b),this.emitEvent("removed",a.data,k.Milliseconds(a.timestamp))))};c.prototype.handlePointerDrag=function(a){var b=a.data,c=b.currentEvent,d=k.Milliseconds(a.timestamp);switch(b.action){case "start":case "update":this.isDragging?this.activePointerMap.has(c.native.pointerId)?(this.updatePointer(c),!this.isCurrentDragSuppressed&&this.emitEvent("update",c,d)):(this.addPointer(c),this.emitEvent("added",c,d),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(c),this.pointerType=
a.data.startEvent.pointerType,this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",c,d))}};Object.defineProperty(c.prototype,"isSuppressed",{get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size},enumerable:!1,configurable:!0});return c}(e.InputHandler);a.Drag=
n;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(a.Button||(a.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require","exports","../../../core/screenUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.fitCircleLSQ=a.euclideanDistance=a.manhattanDistance=void 0;a.manhattanDistance=function(a,d){return Math.abs(d.x-a.x)+Math.abs(d.y-a.y)};a.euclideanDistance=
function(a,d){var e=d.x-a.x;a=d.y-a.y;return Math.sqrt(e*e+a*a)};a.fitCircleLSQ=function(a,k){k?(k.radius=0,k.center.x=0,k.center.y=0):k={radius:0,center:d.createScreenPoint()};if(0===a.length)return k;if(1===a.length)return k.center.x=a[0].x,k.center.y=a[0].y,k;if(2===a.length){var e=a[0];a=a[1];var c=[a.x-e.x,a.y-e.y],h=c[0],c=c[1];k.radius=Math.sqrt(h*h+c*c)/2;k.center.x=(e.x+a.x)/2;k.center.y=(e.y+a.y)/2;return k}for(var m=0,f=0,b=0;b<a.length;b++)m+=a[b].x,f+=a[b].y;for(var m=m/a.length,f=f/
a.length,g=a.map(function(a){return a.x-m}),p=a.map(function(a){return a.y-f}),l=e=k=0,u=0,r=h=0,b=c=0;b<g.length;b++){var q=g[b],v=p[b],w=q*q,z=v*v;k+=w;e+=z;l+=q*v;u+=w*q;h+=z*v;r+=q*z;c+=v*w}b=k;g=l;p=e;u=.5*(u+r);h=.5*(h+c);c=b*p-l*g;r=(u*p-h*g)/c;h=(b*h-l*u)/c;c=d.createScreenPoint(r+m,h+f);return{radius:Math.sqrt(r*r+h*h+(k+e)/a.length),center:c}}})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("require exports tslib ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.ImmediateDoubleClick=void 0;n=function(a){function h(c,b,d,h,m){void 0===c&&(c=e.DefaultParameters.maximumDoubleClickDelay);void 0===b&&(b=e.DefaultParameters.maximumDoubleClickDistance);void 0===d&&(d=e.DefaultParameters.maximumDoubleTouchDelay);void 0===h&&(h=e.DefaultParameters.maximumDoubleTouchDistance);void 0===m&&(m=l.default);var f=a.call(this,!1)||this;f.maximumDoubleClickDelay=c;f.maximumDoubleClickDistance=b;f.maximumDoubleTouchDelay=
d;f.maximumDoubleTouchDistance=h;f._clock=m;f._pointerState=new Map;f._immediateDoubleClick=f.registerOutgoing("immediate-double-click");f.registerIncoming("pointer-down",f._handlePointerDown.bind(f));f.registerIncoming("pointer-up",function(a){f._handlePointerLoss(a,"pointer-up")});f.registerIncoming("pointer-capture-lost",function(a){f._handlePointerLoss(a,"pointer-capture-lost")});f.registerIncoming("pointer-cancel",function(a){f._handlePointerLoss(a,"pointer-cancel")});return f}d.__extends(h,
a);h.prototype.onUninstall=function(){this._pointerState.forEach(function(a){a.immediateDoubleClick&&a.immediateDoubleClick.timeoutHandle.remove()});a.prototype.onUninstall.call(this)};h.prototype._handlePointerDown=function(a){a=a.data;var b=this._pointerId(a);this._pointerState.has(b)||(this._pointerState.set(b,{downButton:a.native.button,immediateDoubleClick:null}),this.startCapturingPointer(a.native))};h.prototype._handlePointerLoss=function(a,b){var d=a.data,e=this._pointerId(d);if((e=this._pointerState.get(e))&&
"pointer-up"===b&&e.downButton===d.native.button)if(b=e.immediateDoubleClick){b.timeoutHandle.remove();var f="touch"===a.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;c.manhattanDistance(b,a.data)>f?this._startImmediateDoubleClick(a,e):(this._immediateDoubleClick.emit(a.data,void 0,b.modifiers),this._removeState(d))}else this._startImmediateDoubleClick(a,e)};h.prototype._startImmediateDoubleClick=function(a,b){var c=this;b.immediateDoubleClick={x:a.data.x,
y:a.data.y,modifiers:a.modifiers,timeoutHandle:this._clock.setTimeout(function(){return c._removeState(a.data)},"touch"===a.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}};h.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};h.prototype._removeState=function(a){var b=this._pointerId(a);this._pointerState.delete(b);this.stopCapturingPointer(a.native);this.refreshHasPendingInputs()};return h}(k.InputHandler);
a.ImmediateDoubleClick=n})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("require exports tslib ../../../core/clock ../../../core/MapUtils ../InputHandler ./support".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.SingleAndDoubleClick=a.DefaultParameters=void 0;a.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};n=function(e){function h(c,b,d,h,m){void 0===
c&&(c=a.DefaultParameters.maximumDoubleClickDelay);void 0===b&&(b=a.DefaultParameters.maximumDoubleClickDistance);void 0===d&&(d=a.DefaultParameters.maximumDoubleTouchDelay);void 0===h&&(h=a.DefaultParameters.maximumDoubleTouchDistance);void 0===m&&(m=l.default);var f=e.call(this,!1)||this;f.maximumDoubleClickDelay=c;f.maximumDoubleClickDistance=b;f.maximumDoubleTouchDelay=d;f.maximumDoubleTouchDistance=h;f._clock=m;f._pointerState=new Map;f._click=f.registerOutgoing("click");f._doubleClick=f.registerOutgoing("double-click");
f.registerIncoming("immediate-click",f._handleImmediateClick.bind(f));f.registerIncoming("pointer-drag",f._handlePointerDrag.bind(f));f.registerIncoming("drag",f._handleDrag.bind(f));return f}d.__extends(h,e);h.prototype.onUninstall=function(){this._pointerState.forEach(function(a){null!=a.doubleClickTimeout&&(a.doubleClickTimeout.remove(),a.doubleClickTimeout=null)})};Object.defineProperty(h.prototype,"hasPendingInputs",{get:function(){return k.someMap(this._pointerState,function(a){return null!=
a.doubleClickTimeout})},enumerable:!1,configurable:!0});h.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};h.prototype._handleImmediateClick=function(a){var b=a.data,d=this._pointerId(b),e=this._pointerState.get(d);if(e){var f="touch"===b.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;c.manhattanDistance(e.event.data,b)>f?(this._clearDoubleClickTimeout(d,!0),this._startClick(a)):(this._clearDoubleClickTimeout(d,
!1),this._doubleClick.emit(e.event.data,void 0,e.event.modifiers))}else this._startClick(a)};h.prototype._startClick=function(a){var b=this,c=this._pointerId(a.data);this._pointerState.set(c,{event:a,doubleClickTimeout:this._clock.setTimeout(function(){return b._doubleClickTimeoutExceeded(c)},"touch"===a.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};h.prototype._handlePointerDrag=function(a){a=this._pointerId(a.data.currentEvent);
this._clearDoubleClickTimeout(a,!0)};h.prototype._handleDrag=function(a){a=this._pointerId(a.data.pointer);this._clearDoubleClickTimeout(a,!0)};h.prototype._clearDoubleClickTimeout=function(a,b){var c=this._pointerState.get(a);c&&(c.doubleClickTimeout.remove(),c.doubleClickTimeout=null,b&&this._doubleClickTimeoutExceeded(a),this._pointerState.delete(a),this.refreshHasPendingInputs())};h.prototype._doubleClickTimeoutExceeded=function(a){var b=this._pointerState.get(a);this._click.emit(b.event.data,
void 0,b.event.modifiers);b.doubleClickTimeout=null;this._pointerState.delete(a);this.refreshHasPendingInputs()};return h}(e.InputHandler);a.SingleAndDoubleClick=n})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("require exports tslib ../../../core/clock ../InputHandler ./support".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.PointerClickHoldAndDrag=a.DefaultParameters=void 0;a.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,
movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};n=function(c){function h(d,e,b,g,h,k){void 0===d&&(d=a.DefaultParameters.maximumClickDelay);void 0===e&&(e=a.DefaultParameters.movementUntilMouseDrag);void 0===b&&(b=a.DefaultParameters.movementUntilPenDrag);void 0===g&&(g=a.DefaultParameters.movementUntilTouchDrag);void 0===h&&(h=a.DefaultParameters.holdDelay);void 0===k&&(k=l.default);var f=c.call(this,!1)||this;f.maximumClickDelay=d;f.movementUntilMouseDrag=e;f.movementUntilPenDrag=
b;f.movementUntilTouchDrag=g;f.holdDelay=h;f._clock=k;f._pointerState=new Map;f._pointerDrag=f.registerOutgoing("pointer-drag");f._immediateClick=f.registerOutgoing("immediate-click");f._pointerHold=f.registerOutgoing("hold");f.registerIncoming("pointer-down",f._handlePointerDown.bind(f));f.registerIncoming("pointer-up",function(a){f._handlePointerLoss(a,"pointer-up")});f.registerIncoming("pointer-capture-lost",function(a){f._handlePointerLoss(a,"pointer-capture-lost")});f.registerIncoming("pointer-cancel",
function(a){f._handlePointerLoss(a,"pointer-cancel")});f._moveHandle=f.registerIncoming("pointer-move",f._handlePointerMove.bind(f));f._moveHandle.pause();return f}d.__extends(h,c);h.prototype.onUninstall=function(){this._pointerState.forEach(function(a){null!=a.holdTimeout&&(a.holdTimeout.remove(),a.holdTimeout=null)});c.prototype.onUninstall.call(this)};h.prototype._handlePointerDown=function(a){var c=this,b=a.data,d=b.native.pointerId,e=null;0===this._pointerState.size&&(e=this._clock.setTimeout(function(){var b=
c._pointerState.get(d);b&&(b.isDragging||(c._pointerHold.emit(b.previousEvent,void 0,a.modifiers),b.holdEmitted=!0),b.holdTimeout=null)},this.holdDelay));e={startEvent:b,previousEvent:b,startTimestamp:a.timestamp,isDragging:!1,downButton:b.native.button,holdTimeout:e,modifiers:new Set};this._pointerState.set(d,e);this.startCapturingPointer(b.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(a)};h.prototype._createPointerDragData=function(a,c,b){return{action:a,startEvent:c.startEvent,
previousEvent:c.previousEvent,currentEvent:b}};h.prototype._handlePointerMove=function(a){var c=a.data,b=this._pointerState.get(c.native.pointerId);if(b){if(b.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",b,c),void 0,b.modifiers);else{var d=e.euclideanDistance(c,b.startEvent),h=this._getDragThreshold(c.native.pointerType);d>h&&this.startDragging(a)}b.previousEvent=c}};h.prototype._getDragThreshold=function(a){switch(a){case "touch":return this.movementUntilTouchDrag;case "pen":return this.movementUntilPenDrag;
default:return this.movementUntilMouseDrag}};h.prototype.startDragging=function(a){var c=this,b=a.data,d=b.native.pointerId;this._pointerState.forEach(function(e){null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null);e.isDragging||(e.modifiers=a.modifiers,e.isDragging=!0,d===e.startEvent.native.pointerId?c._pointerDrag.emit(c._createPointerDragData("start",e,b)):c._pointerDrag.emit(c._createPointerDragData("start",e,e.previousEvent),a.timestamp))})};h.prototype._handlePointerLoss=function(a,
c){var b=a.data,d=b.native.pointerId,e=this._pointerState.get(d);e&&(null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null),e.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",e,"pointer-up"===c?b:e.previousEvent),void 0,e.modifiers):"pointer-up"===c&&e.downButton===b.native.button&&a.timestamp-e.startTimestamp<=this.maximumClickDelay&&!e.holdEmitted&&this._immediateClick.emit(b),this._pointerState.delete(d),this.stopCapturingPointer(b.native),0===this._pointerState.size&&
this._moveHandle.pause())};return h}(k.InputHandler);a.PointerClickHoldAndDrag=n})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","tslib","../DragEventSeparator","../InputHandler"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.VerticalTwoFingerDrag=void 0;n=function(a){function c(c,d){void 0===c&&(c=20);void 0===d&&(d=40);var e=a.call(this,!1)||this;e._threshold=c;e._maxDelta=d;e.state="ready";e.emittedArtificalEnd2=!1;e._vertical=
e.registerOutgoing("vertical-two-finger-drag");e._artificalDrag=e.registerOutgoing("drag");e.dragEventSeparator=new l.DragEventSeparator({start:function(a,c){return e.observeStart(a,c)},update:function(a,c,d){return e.observeUpdate(a,c,d)},end:function(a,c){return e.observeEnd(c)}});e.registerIncoming("drag",function(a){return e.dragEventSeparator.handle(a)});return e}d.__extends(c,a);Object.defineProperty(c.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!1,configurable:!0});
c.prototype.observeStart=function(a,c){1===a&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:c.data.button,buttons:c.data.buttons,pointerType:c.data.pointerType,timestamp:c.data.timestamp,pointers:c.data.pointers,pointer:c.data.pointer,angle:c.data.angle,radius:c.data.radius,center:c.data.center,artifical:!0}),c.stopPropagation());this.state=2===a?"ready":"failed"};c.prototype.observeUpdate=function(a,c,d){"failed"!==this.state&&2===a&&("active"===
this.state?(this._vertical.emit({delta:c.data.center.y-this._thresholdReachedCenter.y,action:"update"}),c.stopPropagation()):this.checkMovementWithinLimits(c.data,d.data)?this.checkVerticalThresholdReached(c.data,d.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=c.data.center,this._artificalDrag.emit({action:"end",button:c.data.button,buttons:c.data.buttons,pointerType:c.data.pointerType,timestamp:c.data.timestamp,pointers:c.data.pointers,pointer:c.data.pointer,
angle:c.data.angle,radius:c.data.radius,center:c.data.center,artifical:!0}),this._vertical.emit({delta:c.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),c.stopPropagation()):this.state="failed")};c.prototype.observeEnd=function(a){"active"===this.state&&(this._vertical.emit({delta:a.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",a.stopPropagation())};c.prototype.checkMovementWithinLimits=function(a,c){var d=-Infinity,b=Infinity,e=-Infinity,h=Infinity;
c.pointers.forEach(function(a){d=Math.max(d,a.x);b=Math.min(b,a.x);e=Math.max(e,a.y);h=Math.min(h,a.y)});var m=-Infinity,k=Infinity,l=-Infinity,q=Infinity;a.pointers.forEach(function(a){m=Math.max(m,a.x);k=Math.min(k,a.x);l=Math.max(l,a.y);q=Math.min(q,a.y)});return Math.abs(a.center.x-c.center.x)<this._threshold&&Math.abs(m-k-(d-b))<=this._maxDelta&&Math.abs(l-q-(e-h))<=this._maxDelta};c.prototype.checkVerticalThresholdReached=function(a,c){var d=Math.abs(a.center.y-c.center.y);a.pointers.forEach(function(a,
e){e=c.pointers.get(e);d=Math.min(d,Math.abs(a.y-e.y))});return d>=this._threshold};return c}(k.InputHandler);a.VerticalTwoFingerDrag=n})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.DragEventSeparator=void 0;n=function(){function a(a){this.callbacks=a;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=function(){return!0})}a.prototype.handle=function(a){var d=a.data,e=d.pointers.size;
switch(d.action){case "start":this.currentCount=e;this.emitStart(a);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=e;this.emitStart(a);break;case "update":this.emitUpdate(a);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=e;this.emitStart(a);break;case "end":this.emitEnd(a),this.currentCount=0}this.previousEvent=a};a.prototype.emitStart=function(a){this.startEvent=a;this.callbacks.condition(this.currentCount,a)&&this.callbacks.start(this.currentCount,
a,this.startEvent)};a.prototype.emitUpdate=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.update(this.currentCount,a,this.startEvent)};a.prototype.emitEnd=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.end(this.currentCount,a,this.startEvent);this.startEvent=null};return a}();a.DragEventSeparator=n})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("require exports tslib ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ./Deconflictor ./LabelDeconflictor ../../support/geometryUtils ../../../support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){function p(a){a=a.layer;return!(!a||!a.featureReduction||"selection"!==a.featureReduction.type)}function t(a){(a=a.graphics3DGraphics)&&a.forEach(function(a){return a.clearVisibilityFlag(3)})}Object.defineProperty(a,"__esModule",{value:!0});a.GraphicsDeconflictor=void 0;n=function(a){function r(){var b=null!==a&&a.apply(this,arguments)||this;b._handles=new l;b._contexts=new Map;b._viewState=new m.DeconflictorViewState;b.visibilityGroup=0;b._iconMarginFactor=-.1;return b}
d.__extends(r,a);Object.defineProperty(r.prototype,"labels",{get:function(){return this._labels},enumerable:!1,configurable:!0});Object.defineProperty(r.prototype,"viewState",{get:function(){return this._viewState},enumerable:!1,configurable:!0});r.prototype.initialize=function(){var a=this;this._handles.add([this.view.watch("state.camera",function(){a.updateViewState();a.setDirty()}),this.view.watch("map.ground.opacity",function(b,c){1!==b&&1!==c||a.setDirty()}),c.init(this.view,"slicePlane",function(){a.updateSlicePlane();
a.slicePlaneChanged()})]);this._frameTask=this.view.resourceController.scheduler.registerTask(g.Task.GRAPHICS_DECONFLICTOR,function(b){return a.update(b)},function(){return a.needsUpdate()});this._labels=new f.LabelDeconflictor({view:this.view,parent:this})};r.prototype.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};Object.defineProperty(r.prototype,"iconMarginFactor",{get:function(){return this._iconMarginFactor},
set:function(a){this._iconMarginFactor=a;this.setDirty()},enumerable:!1,configurable:!0});r.prototype.setDirty=function(){0<this._contexts.size&&(a.prototype.setDirty.call(this),this._labels.setDirty())};r.prototype.update=function(b){a.prototype.update.call(this,b);this.needsUpdate()||this._labels.setDirty()};r.prototype.setInitialIconVisibilityFlag=function(a,b){a=!(this._graphicSupportsDeconfliction(b)&&p(a));b.setVisibilityFlag(3,a,0)};r.prototype.updateViewState=function(){this.view&&this.view.state&&
(this._viewState.camera.copyFrom(this.view.state.camera),this.updateSlicePlane())};r.prototype.updateSlicePlane=function(){var a=this.view?this.view.slicePlane:null;e.isSome(a)&&b.boundedPlane.transform(a,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=e.isSome(a)};r.prototype.slicePlaneChanged=function(){k.someMap(this._contexts,function(a,b){return b.symbolCreationContext.slicePlaneEnabled})&&this.setDirty()};r.prototype.addGraphicsOwner=function(a){var b=
this,c=this._contexts.get(a);null==c&&(c=new Map,this._contexts.set(a,c),this.setDirty());return{addGraphic:function(d){return b.addGraphic(a,c,d)},removeGraphic:function(a){return b.removeGraphic(c,a)},labelingInfoChange:function(){return b._labels.enabledChanged(a,c)},featureReductionChange:function(){return b.enabledChanged(a,c)},slicePlaneEnabledChange:function(){return b._slicePlaneEnabledChanged(a,c)},clear:function(){return c.forEach(function(a){return b.removeGraphic(c,a.graphics3DGraphic)})}}};
r.prototype.removeGraphicsOwner=function(a){var b=this,c=this._contexts.get(a);c&&(c.forEach(function(a){return b.removeGraphic(c,a.graphics3DGraphic)}),this._contexts.delete(a),this.setDirty())};r.prototype.addGraphic=function(a,b,c){var d=c.graphic.uid;c=new m.DeconflictorGraphic(c,a.symbolCreationContext.slicePlaneEnabled);b.set(d,c);p(a)&&this.addToActiveGraphics(c);a.labelsEnabled&&this._labels.addToActiveGraphics(c)};r.prototype.removeGraphic=function(a,b){b=b.graphic.uid;var c=a.get(b);c&&
(this.removeFromActiveGraphics(c),this._labels.removeFromActiveGraphics(c),a.delete(b),this.setDirty())};r.prototype.enabledChanged=function(a,b){var c=p(a);c||t(a);this.modifyGraphics(b,c)};r.prototype._slicePlaneEnabledChanged=function(a,b){var c=a.symbolCreationContext.slicePlaneEnabled;b.forEach(function(a){return a.slicePlaneEnabled=c});this.setDirty()};r.prototype.getGraphicsLayers=function(a){return a._graphics};r.prototype._graphicSupportsDeconfliction=function(a){if(a.isDraped)return!1;a=
a._graphics;if(!a||!a.length)return!1;for(var b=0;b<a.length;b++)if(this.layerSupportsDeconfliction(a[b]))return!0;return!1};return r=d.__decorate([h.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],r)}(m.Deconflictor);a.GraphicsDeconflictor=n})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/geodesicConstants ./deconflictorDebug ../../support/debugFlags ../../support/geometryUtils ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F){function H(a){var b,c,e,f,g;return d.__generator(this,function(d){switch(d.label){case 0:if(!Map.prototype.entries)return[3,5];b=a.entries();c=b.next();d.label=1;case 1:return c.done?[3,4]:[4,c.value[1]];case 2:d.sent(),d.label=3;case 3:return c=b.next(),[3,1];case 4:return[3,9];case 5:e=k.valuesOfMap(a),f=0,g=e,d.label=6;case 6:if(!(f<g.length))return[3,9];c=g[f];return[4,c];case 7:d.sent(),d.label=8;case 8:return f++,[3,6];case 9:return[2]}})}
function J(a,b,c){var e,f;return d.__generator(this,function(d){switch(d.label){case 0:return b.clear(),a.forEach(function(a,d){var e=b.pushNew();e.id=d;e.prio=a.info?-a.info[c].distance:Number.MAX_VALUE}),[4];case 1:d.sent(),e=b.iterableSort(function(a,b){return b.prio-a.prio}),f=e.next(),d.label=2;case 2:return f.done?[3,5]:[4];case 3:d.sent(),d.label=4;case 4:return f=e.next(),[3,2];case 5:return b.forEachSimple(function(b){var c=a.get(b.id);c&&(a.delete(b.id),a.set(b.id,c))}),b.clear(),[2]}})}
Object.defineProperty(a,"__esModule",{value:!0});a.Deconflictor=a.DeconflictorViewState=a.DeconflictorGraphic=void 0;var I=t.vec3f64.create(),K=r.vec4f64.create(),L=r.vec4f64.create(),M=t.vec3f64.create(),Q=b.mat4f64.create(),R=B.sphere.create(),O=B.ray.create(),N=t.vec3f64.create(),S=v.create(),P=function(){return function(){this.aabr=v.create();this.distance=0;this.visible=this.culled=!1}}();n=function(){return function(a,b,c){void 0===c&&(c={});this.graphics3DGraphic=a;this.slicePlaneEnabled=b;
this.info=c}}();a.DeconflictorGraphic=n;var U=function(){function a(){this.active=new Map;this.visible=new Map}a.prototype.clear=function(){this.active.clear();this.visible.clear()};return a}(),Z=function(){return function(){}}(),V=function(){return function(){this.sortArray=new h({allocator:function(a){return a||new Z}})}}(),T=function(){function a(){this.camera=new C.default;this.slicePlane=B.boundedPlane.create();this.slicePlaneEnabled=!1}a.prototype.copyFrom=function(a){this.camera.copyFrom(a.camera);
B.boundedPlane.copy(a.slicePlane,this.slicePlane);this.slicePlaneEnabled=a.slicePlaneEnabled};return a}();a.DeconflictorViewState=T;l=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._dirty=!1;b._runningViewState=new T;b._state=0;b.graphics=new U;b.iterators=new V;b.accBinsNumX=15;b.accBinsNumY=20;b.accBinsSizeX=0;b.accBinsSizeY=0;b.accBins=null;b.accNumTests=0;return b}d.__extends(b,a);Object.defineProperty(b.prototype,"dirty",{get:function(){return this._dirty},enumerable:!1,
configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0});b.prototype.destroy=function(){this.graphics.clear();this.iterators=null};b.prototype.setDirty=function(){!this._dirty&&0<this.graphics.active.size&&(this._dirty=!0,this.notifyChange("updating"))};Object.defineProperty(b.prototype,"updating",{get:function(){return 0!==this._state||this._dirty},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"updatingProgress",
{get:function(){if(!this.updating)return 1;var a=this._state/4;return this._dirty?.5*a:a},enumerable:!1,configurable:!0});b.prototype.needsUpdate=function(){return this.view.ready&&null!=this.view.state&&this.updating};b.prototype.update=function(a){switch(this._state){case 0:this.startUpdate(),a.madeProgress();case 1:if(this._state=1,!this.processActiveGraphics(a))break;case 2:if(this._state=2,!this.sortVisibleGraphics(a))break;case 3:if(this._state=3,!this.deconflictVisibleGraphics(a))break;default:z.drawAccelerationStruct(this,
this.graphics.visible),this._state=0,this.notifyChange("updating")}};b.prototype.modifyGraphics=function(a,b){var c=this;b?a.forEach(function(a){return c.addToActiveGraphics(a)}):a.forEach(function(a){return c.removeFromActiveGraphics(a)});this.setDirty()};b.prototype.layerSupportsDeconfliction=function(a){if(c.isNone(a)||"object3d"!==a.type)return!1;a=a.stageObject;return 1===(a?a.getNumGeometryRecords():0)&&a.getGeometryRecord(0).material instanceof F.default?!0:!1};b.prototype.startUpdate=function(){z.prepare(this.view);
this._dirty=!1;this._runningViewState.copyFrom(this.viewState);var a=this._runningViewState.camera;this.initBins(a.fullWidth,a.fullHeight);this.resetIterators()};b.prototype.addToActiveGraphics=function(a){a.info[this.visibilityGroup]=new P;this.graphics.active.set(a.graphics3DGraphic.graphic.uid,a);this.setDirty()};b.prototype.removeFromActiveGraphics=function(a){this.removeFromVisibleGraphics(a);var b=a.graphics3DGraphic;b.destroyed||b.clearVisibilityFlag(3,this.visibilityGroup);delete a.info[this.visibilityGroup];
this.graphics.active.delete(a.graphics3DGraphic.graphic.uid);this.setDirty()};b.prototype.addToVisibleGraphics=function(a){this.graphics.visible.set(a.graphics3DGraphic.graphic.uid,a)};b.prototype.removeFromVisibleGraphics=function(a){this.graphics.visible.delete(a.graphics3DGraphic.graphic.uid)};b.prototype.processActiveGraphics=function(a){var b=this.ensureActiveGraphicsIterator(),d=f.mat4.invert(Q,this._runningViewState.camera.projectionMatrix),e="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&
0<this._runningViewState.camera.relativeElevation?R:null,g=0;c.isSome(e)&&(p.vec3.transformMat4(e.center,q.ZEROS,this._runningViewState.camera.viewMatrix),e.radius=w.earthRadius,g=B.sphere.distanceToSilhouette(e,q.ZEROS));for(;!a.done;){a.madeProgress();var h=b.next();if(h.done)return this.resetActiveGraphicsIterator(),!0;var m=(h=h.value)&&h.info[this.visibilityGroup];m&&(this.collectGraphics3DGraphics(h,d,e,g),m.culled?this.removeFromVisibleGraphics(h):this.addToVisibleGraphics(h))}return!1};b.prototype.sortVisibleGraphics=
function(a){for(var b=this.ensureSortGraphicsIterator();!a.done;){var c=b.next();a.madeProgress();if(c.done)return this.resetSortGraphicsIterator(),!0}return!1};b.prototype.deconflictVisibleGraphics=function(a){for(var b=this.ensureVisibleGraphicsIterator(),c=1===this.visibilityGroup;!a.done;){a.madeProgress();var d=b.next();if(d.done)return this.resetVisibleGraphicsIterator(),!0;var d=d.value,e=d.info[this.visibilityGroup];if(e&&!e.culled){var f=d.graphics3DGraphic;(f=(!c||f.isVisible())&&!this.isConflicted(d))&&
this.addToBins(d);e.visible=f;this.setGraphicVisibility(d,f);z.drawPoly(e,f)}}return!1};b.prototype.resetIterators=function(){this.iterators.active=null;this.iterators.visible=null;this.iterators.sort=null};b.prototype.ensureActiveGraphicsIterator=function(){this.iterators.active||(this.iterators.active=H(this.graphics.active));return this.iterators.active};b.prototype.resetActiveGraphicsIterator=function(){this.iterators.active=null};b.prototype.ensureVisibleGraphicsIterator=function(){this.iterators.visible||
(this.iterators.visible=H(this.graphics.visible));return this.iterators.visible};b.prototype.resetVisibleGraphicsIterator=function(){this.iterators.visible=null};b.prototype.ensureSortGraphicsIterator=function(){this.iterators.sort||(this.iterators.sort=J(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup));return this.iterators.sort};b.prototype.resetSortGraphicsIterator=function(){this.iterators.sort=null};b.prototype.collectGraphics3DGraphics=function(a,b,d,e){var f=a.graphics3DGraphic;
if(!f.destroyed){var g=a.info[this.visibilityGroup];if(f.isVisible(0,3)){f=this.getGraphicsLayers(f);v.empty(g.aabr);for(var h=null,m=0;m<f.length;m++){var k=f[m];if(this.layerSupportsDeconfliction(k)){var p=k.stageObject.getGeometryRecord(0).material;if(c.isNone(h)){h=this.getProjectionInfo(k,b,X);if(h.isOutsideScreen||this.isCulledBySlice(a,I)||c.isSome(d)&&this.isCulledByHorizon(h,d,e)){g.culled=!0;return}!x.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&g.visible&&(h.distance*=.7)}this.expandBoundingRect(g,
k,p,h)}}c.isNone(h)?g.culled=!0:(g.distance=h.distance,g.culled=!1)}else g.culled=!0}};b.prototype.getProjectionInfo=function(a,b,c){var d=this._runningViewState.camera;a=a.stageObject;var e=a.getGeometryRecord(0),f=e.material,g=a.getCenter();p.vec3.transformMat4(I,g,d.viewMatrix);e=e.geometry.data.getVertexAttr();g=e[G.VertexAttrConstants.AUXPOS1].data;f.applyShaderOffsetsView(I,e[G.VertexAttrConstants.NORMAL].data,a.objectTransformation,g,d,c.scaleInfo,I);u.vec4.set(K,I[0],I[1],I[2],1);u.vec4.transformMat4(L,
K,d.projectionMatrix);p.vec3.scale(c.positionNDC,L,1/L[3]);f.applyShaderOffsetsNDC(c.positionNDC,g,d,c.positionNDC,M);c.distanceWithoutPolygonOffset=d.depthNDCToWorld(M[2]);c.distance=M[2]===c.positionNDC[2]?c.distanceWithoutPolygonOffset:d.depthNDCToWorld(c.positionNDC[2]);u.vec4.set(L,c.positionNDC[0],c.positionNDC[1],c.positionNDC[2],1);u.vec4.transformMat4(K,L,b);u.vec4.scale(K,K,1/K[3]);p.vec3.set(c.positionView,I[0],I[1],I[2]);return c};b.prototype.isCulledByHorizon=function(a,b,c){p.vec3.copy(O.direction,
a.positionView);p.vec3.set(O.origin,0,0,0);return A.intersectRay(b,O,N)?a.distanceWithoutPolygonOffset>c:!1};b.prototype.isCulledBySlice=function(a,b){return a.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&B.boundedPlane.extrusionContainsPoint(this._runningViewState.slicePlane,b)};b.prototype.expandBoundingRect=function(a,b,c,d){var f=d.positionNDC;d=d.scaleInfo;var g=this._runningViewState.camera;b=b.getScreenSize(Y);E.applyPrecomputedScaleFactor(b,d.factor,b);b[0]*=g.pixelRatio;b[1]*=
g.pixelRatio;c=v.offset(c.calculateRelativeScreenBounds(b,d.factorAlignment.scale,S),e.lerp(0,g.fullWidth,.5+.5*f[0]),e.lerp(0,g.fullHeight,.5+.5*f[1]));f=this.iconMarginFactor;0!==f&&(f*=Math.min(v.width(c),v.height(c)),c[0]-=f,c[1]-=f,c[2]+=f,c[3]+=f);v.expand(a.aabr,c)};b.prototype.isConflicted=function(a){var b=a.graphics3DGraphic.graphic.uid;a=a.info[this.visibilityGroup];for(var c=Math.floor(a.aabr[0]/this.accBinsSizeX);c<=Math.floor(a.aabr[2]/this.accBinsSizeX);c++)if(!(0>c||c>=this.accBinsNumX))for(var d=
Math.floor(a.aabr[1]/this.accBinsSizeY);d<=Math.floor(a.aabr[3]/this.accBinsSizeY);d++)if(!(0>d||d>=this.accBinsNumY))for(var e=this.accBins[c][d],f=0;f<e.length;f++){var g=e.data[f],h=g.info[this.visibilityGroup];if(h&&h.visible&&g.graphics3DGraphic.graphic.uid!==b&&(this.accNumTests++,v.intersects(h.aabr,a.aabr)))return!0}return!1};b.prototype.initBins=function(a,b){if(null==this.accBins){this.accBins=[];for(var c=0;c<this.accBinsNumX;c++){this.accBins.push([]);for(var d=this.accBins[this.accBins.length-
1],e=0;e<this.accBinsNumY;e++)d.push(new h)}}else for(c=0;c<this.accBinsNumX;c++)for(e=0;e<this.accBinsNumY;e++)this.accBins[c][e].clear();this.accBinsSizeX=a/this.accBinsNumX;this.accBinsSizeY=b/this.accBinsNumY;this.accNumTests=0};b.prototype.addToBins=function(a){for(var b=a.info[this.visibilityGroup],c=Math.floor(b.aabr[2]/this.accBinsSizeX),d=Math.floor(b.aabr[1]/this.accBinsSizeY),e=Math.floor(b.aabr[3]/this.accBinsSizeY),b=Math.floor(b.aabr[0]/this.accBinsSizeX);b<=c;b++)if(!(0>b||b>=this.accBinsNumX))for(var f=
d;f<=e;f++)0>f||f>=this.accBinsNumY||this.accBins[b][f].push(a)};b.prototype.setGraphicVisibility=function(a,b){a=a.graphics3DGraphic;a.destroyed||(a.setVisibilityFlag(3,b,this.visibilityGroup),1===this.visibilityGroup&&this.view.labeler.setLabelGraphicVisibility(a,b))};d.__decorate([m.property({constructOnly:!0})],b.prototype,"view",void 0);d.__decorate([m.property({type:Boolean,readOnly:!0})],b.prototype,"updating",null);return b=d.__decorate([m.subclass("esri.views.3d.layers.graphics.Deconflictor")],
b)}(l);a.Deconflictor=l;var Y=g.vec2f64.create(),X=new (function(){function a(){this.positionView=t.vec3f64.create();this.positionNDC=t.vec3f64.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}Object.defineProperty(a.prototype,"isOutsideScreen",{get:function(){var a=this.positionNDC;return-1>a[0]||-1>a[1]||-1>a[2]||1<=a[0]||1<=a[1]},enumerable:!1,configurable:!0});
return a}())})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../support/debugFlags"],function(n,a,d){function l(a,c,d,e,h){m&&(m(),m=null);var g=f.height,k=b;k.beginPath();k.lineWidth=1;k.strokeStyle=h;k.moveTo(a,g-d);k.lineTo(c,g-d);k.stroke();k.lineTo(c,g-e);k.stroke();k.lineTo(c,g-d);k.stroke();k.lineTo(a,g-d);k.stroke();k.lineTo(a,g-d);k.stroke();k.closePath()}Object.defineProperty(a,"__esModule",{value:!0});a.drawPoly=a.prepare=a.drawAccelerationStruct=
void 0;var k=!1,e=!1,c=!1,h=!1,m=null,f,b;a.drawAccelerationStruct=function(a,c){if(e&&b){m&&(m(),m=null);for(var d=b,f=0,g=0;g<a.accBinsNumX;g++)for(var h=0;h<a.accBinsNumY;h++){var k=a.accBins[g][a.accBinsNumY-1-h],f=f+k.length,p=g*a.accBinsSizeX,z=(g+1)*a.accBinsSizeX,x=h*a.accBinsSizeY,B=(h+1)*a.accBinsSizeY;d.fillText(k.length.toFixed(),p+5,x+15);l(p,z,x,B,"blue")}d.fillText("total totalShownLabels: "+f,70,40);d.fillText("total visible labels: "+c.size,70,50);d.fillText("total numTests: "+a.accNumTests,
70,30)}};a.prepare=function(a){c=d.DECONFLICTOR_SHOW_VISIBLE;h=d.DECONFLICTOR_SHOW_INVISIBLE;k=c||h;e=d.DECONFLICTOR_SHOW_GRID;m=null;k||e?m=function(){null==f&&(f=document.createElement("canvas"),f.setAttribute("id","canvas2d"),a.surface.parentElement.style.position="relative",a.surface.parentElement.appendChild(f));var c=a.height*a.pixelRatio;f.setAttribute("width",a.width*a.pixelRatio+"px");f.setAttribute("height",c+"px");f.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:"+
a.width+"px;height:"+a.height+"px");b=f.getContext("2d");b.clearRect(0,0,a.width,a.height);b.font="12px Arial"}:f&&(f.parentElement.removeChild(f),f=null)};a.drawPoly=function(a,b){k&&(b&&c||!b&&h)&&l(a.aabr[0],a.aabr[2],a.aabr[1],a.aabr[3],b?"green":"red")}})},"esri/views/3d/support/debugFlags":function(){define(["require","exports","tslib","../../../core/Accessor","../../../core/accessorSupport/decorators"],function(n,a,d,l,k){return new (function(a){function c(){var c=null!==a&&a.apply(this,arguments)||
this;c.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;c.SCENEVIEW_LOCKING_LOG=!1;c.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;c.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;c.DECONFLICTOR_SHOW_VISIBLE=!1;c.DECONFLICTOR_SHOW_INVISIBLE=!1;c.DECONFLICTOR_SHOW_GRID=!1;c.LABELS_SHOW_BORDER=!1;c.OVERLAY_DRAW_DEBUG_TEXTURE=!1;c.OVERLAY_SHOW_CENTER=!1;c.SHOW_POI=!1;c.TERRAIN_DEBUG_POPUP=!1;c.TESTS_DISABLE_UPDATE_THRESHOLDS=!1;c.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1;c.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;c.DRAW_MESH_GEOMETRY_NORMALS=
!1;c.FEATURE_TILE_FETCH_SHOW_TILES=!1;c.FEATURE_TILE_TREE_SHOW_TILES=!1;c.I3S_TREE_SHOW_TILES=!1;c.I3S_SHOW_MODIFICATIONS=!1;c.ENABLE_PROFILE_DEPTH_RANGE=!1;c.DISABLE_FAST_UPDATES=!1;c.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;c.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;c.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;return c}d.__extends(c,a);d.__decorate([k.property()],c.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);d.__decorate([k.property()],c.prototype,"SCENEVIEW_LOCKING_LOG",void 0);d.__decorate([k.property()],
c.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);d.__decorate([k.property()],c.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);d.__decorate([k.property()],c.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);d.__decorate([k.property()],c.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);d.__decorate([k.property()],c.prototype,"DECONFLICTOR_SHOW_GRID",void 0);d.__decorate([k.property()],c.prototype,"LABELS_SHOW_BORDER",void 0);d.__decorate([k.property()],c.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",
void 0);d.__decorate([k.property()],c.prototype,"OVERLAY_SHOW_CENTER",void 0);d.__decorate([k.property()],c.prototype,"SHOW_POI",void 0);d.__decorate([k.property()],c.prototype,"TERRAIN_DEBUG_POPUP",void 0);d.__decorate([k.property()],c.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0);d.__decorate([k.property()],c.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);d.__decorate([k.property()],c.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);d.__decorate([k.property()],
c.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);d.__decorate([k.property()],c.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);d.__decorate([k.property()],c.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);d.__decorate([k.property()],c.prototype,"I3S_TREE_SHOW_TILES",void 0);d.__decorate([k.property()],c.prototype,"I3S_SHOW_MODIFICATIONS",void 0);d.__decorate([k.property()],c.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);d.__decorate([k.property()],c.prototype,"DISABLE_FAST_UPDATES",void 0);d.__decorate([k.property()],
c.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);d.__decorate([k.property()],c.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);d.__decorate([k.property()],c.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);return c=d.__decorate([k.subclass("esri.views.3d.support.DebugFlags")],c)}(l))})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","../../../../core/mathUtils","../../../../geometry/support/geodesicConstants"],function(n,
a,d,l){function k(a,c,d){var e=d.parameters;d=d.paddingPixelsOverride;b.scale=Math.min(e.divisor/(c-e.offset),1);b.factor=Math.abs(a*a*a);b.minPixelSize=e.minPixelSize;b.paddingPixels=d;return b}function e(a,b){return 0===a?b.minPixelSize:b.minPixelSize*(1+2*b.paddingPixels/a)}function c(a,b){return Math.max(d.lerp(a*b.scale,a,b.factor),e(a,b))}Object.defineProperty(a,"__esModule",{value:!0});a.scale=a.applyPrecomputedScaleFactor=a.precomputeScaleFactor=a.applyScaleFactorVec2=a.applyScaleFactor=a.getLabelSettings=
a.getSettings=void 0;a.getSettings=function(a){return new h(a,m)};a.getLabelSettings=function(a){var b=m.curvatureDependent;return new h(a,{curvatureDependent:{min:{curvature:b.min.curvature,tiltAngle:b.min.tiltAngle,scaleFallOffFactor:f.curvatureDependent.min.scaleFallOffFactor},max:{curvature:b.max.curvature,tiltAngle:b.max.tiltAngle,scaleFallOffFactor:f.curvatureDependent.max.scaleFallOffFactor}},scaleStart:m.scaleStart,scaleFallOffRange:m.scaleFallOffRange,minPixelSize:f.minPixelSize})};a.applyScaleFactor=
c;a.applyScaleFactorVec2=function(a,b,c){void 0===c&&(c=[0,0]);var f=Math.min(Math.max(b.scale,e(a[1],b)/a[1]),1);c[0]=d.lerp(a[0]*f,a[0],b.factor);c[1]=d.lerp(a[1]*f,a[1],b.factor);return c};a.precomputeScaleFactor=function(a,b,d,e){a=k(a,b,d);a.minPixelSize=0;a.paddingPixels=0;a=c(1,a);e.scale=a;e.factor=0;e.minPixelSize=d.parameters.minPixelSize;e.paddingPixels=d.paddingPixelsOverride};a.applyPrecomputedScaleFactor=function(a,b,c){void 0===c&&(c=[0,0]);b=Math.min(Math.max(b.scale,e(a[1],b)/a[1]),
1);c[0]=a[0]*b;c[1]=a[1]*b;return c};a.scale=function(a,b,d,e){return c(a,k(b,d,e))};var h=function(){function a(a,b,c,d){void 0===c&&(c={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=a;this.description=b;this.parameters=c;this._paddingPixelsOverride=d;2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=
this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!1,configurable:!0});a.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};
a.prototype.overridePadding=function(b){return b!==this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,b):this};a.prototype.calculateParameters=function(a,b){var c=this.description,d=c.scaleStart,e=c.scaleFallOffRange,c=c.minPixelSize,f=a.fovY,g=a.distance,h=this.calculateCurvatureDependentParameters(a),m=this.coverageCompensation(a,h),k=h.tiltAngle,h=h.scaleFallOffFactor,g=Math.sin(k)*g,k=.5*Math.PI-k-f*(.5-d*m),d=g/Math.cos(k),e=(d-g/Math.cos(k+f*e*m)*h)/(1-h);b.camera.fovY=
a.fovY;b.camera.distance=a.distance;b.offset=e;b.divisor=d-e;b.minPixelSize=c;return b};a.prototype.calculateCurvatureDependentParametersLocal=function(a,b){void 0===b&&(b=g);b.tiltAngle=this.description.curvatureDependent.min.tiltAngle;b.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return b};a.prototype.calculateCurvatureDependentParametersGlobal=function(a,b){void 0===b&&(b=g);var c=this.description.curvatureDependent;a=1+a.distance/l.earthRadius;var e=[c.min.curvature,
c.max.curvature],f=e[0];a=d.clamp((Math.sqrt(a*a-1)-f)/(e[1]-f),0,1);e=[c.min,c.max];c=e[0];e=e[1];b.tiltAngle=d.lerp(c.tiltAngle,e.tiltAngle,a);b.scaleFallOffFactor=d.lerp(c.scaleFallOffFactor,e.scaleFallOffFactor,a);return b};a.prototype.surfaceCoverageCompensationLocal=function(a,b){return(a.fovY-b.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,b){var c=l.earthRadius*l.earthRadius;b=b.tiltAngle+.5*Math.PI;var d=a.fovY;a=a.distance;a=a*a+c-2*Math.cos(b)*a*l.earthRadius;
var e=Math.sqrt(a);return(Math.acos(Math.sqrt(a-c)/e)-Math.asin(l.earthRadius/(e/Math.sin(b)))+.5*d)/d};return a}(),m={curvatureDependent:{min:{curvature:d.deg2rad(10),tiltAngle:d.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:d.deg2rad(70),tiltAngle:d.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},f={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14},b={scale:0,factor:0,minPixelSize:0,paddingPixels:0},g={tiltAngle:0,
scaleFallOffFactor:0}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports tslib ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterialTexture ../lib/Material ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/utils ../shaders/HUDMaterial.glsl ../shaders/HUDMaterialTechnique".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F){function H(a,b,c,d,e,f,g,h){b=b-e-(0<h[0]?d[0]*h[0]:0);var m=b+d[0]+2*e;c=c-e-(0<h[1]?d[1]*h[1]:0);e=c+d[1]+2*e;g.textureIsSignedDistanceField&&(g=g.distanceFieldBoundingBox,b+=d[0]*g[0],c+=d[1]*g[1],m-=d[0]*(1-g[2]),e-=d[1]*(1-g[3]),b-=f,m+=f,c-=f,e+=f);return a[0]>b&&a[0]<m&&a[1]>c&&a[1]<e}Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function e(b,c){c=a.call(this,c)||this;c.techniqueConfig=new F.HUDMaterialTechniqueConfiguration;
c.params=C.copyParameters(b,ga);return c}d.__extends(e,a);e.prototype.setParameterValues=function(a){for(var b in a)"textureId"===b&&B.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[b]=a[b];this.parametersChanged()};e.prototype.getParameters=function(){return this.params};e.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.verticalOffset=
!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset;this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField;this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled;this.techniqueConfig.vvColor=!!this.params.vvColorEnabled;
0===a&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder);4===a&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion);this.techniqueConfig.depthEnabled=this.params.depthEnabled;return this.techniqueConfig};e.prototype.intersect=function(a,b,c,d,e,f,g,h,m){m?this.intersectDrapedHudGeometry(a,f,g,h):this.intersectHudGeometry(a,b,c,d,g,h)};e.prototype.intersectDrapedHudGeometry=function(a,b,c,d){var e=a.getAttribute(B.VertexAttrConstants.POSITION),f=
a.getAttribute(B.VertexAttrConstants.SIZE),g=this.params,h=G.calculateAnchorPosForRendering(g),m=1,k=1;d&&(k=d(T),m=k[0],k=k[5]);m*=a.screenToWorldRatio;k*=a.screenToWorldRatio;d=X*a.screenToWorldRatio;for(var p=0;p<e.data.length/e.size;p++){var l=p*e.size,r=e.data[l],l=e.data[l+1],t=p*f.size;ca[0]=f.data[t]*m;ca[1]=f.data[t+1]*k;t=void 0;g.textureIsSignedDistanceField&&(t=g.outlineSize*a.screenToWorldRatio/2);H(b,r,l,ca,d,t,g,h)&&c()}};e.prototype.intersectHudGeometry=function(a,b,d,e,f,g){if(e.options.selectionMode&&
e.options.hud&&!E.isInstanceHidden(b)){var h=a.data;a=this.params;var k=b=1;c.mat3.fromMat4(S,d);if(g){k=g(T);b=k[0];k=k[5];g=S;var l=g[0],r=g[1],u=g[2],q=g[3],v=g[4],w=g[5],z=g[6],A=g[7],C=g[8],F=1/Math.sqrt(l*l+r*r+u*u),I=1/Math.sqrt(q*q+v*v+w*w),J=1/Math.sqrt(z*z+A*A+C*C);g[0]=l*F;g[1]=r*F;g[2]=u*F;g[3]=q*I;g[4]=v*I;g[5]=w*I;g[6]=z*J;g[7]=A*J;g[8]=C*J}g=h.getVertexAttr()[B.VertexAttrConstants.POSITION];l=h.getVertexAttr()[B.VertexAttrConstants.SIZE];r=h.getVertexAttr()[B.VertexAttrConstants.NORMAL];
h=h.getVertexAttr()[B.VertexAttrConstants.AUXPOS1];B.assert(3<=g.size);u=e.point;q=e.camera;v=G.calculateAnchorPosForRendering(a);b*=q.pixelRatio;k*=q.pixelRatio;w="screen"===this.params.centerOffsetUnits;for(z=0;z<g.data.length/g.size;z++)A=z*g.size,p.vec3.set(M,g.data[A],g.data[A+1],g.data[A+2]),p.vec3.transformMat4(M,M,d),A=z*l.size,ca[0]=l.data[A]*b,ca[1]=l.data[A+1]*k,p.vec3.transformMat4(M,M,q.viewMatrix),A=z*h.size,p.vec3.set(Z,h.data[A+0],h.data[A+1],h.data[A+2]),w||(M[0]+=Z[0],M[1]+=Z[1],
0!==Z[2]&&(A=Z[2],p.vec3.normalize(Z,M),p.vec3.subtract(M,M,p.vec3.scale(Z,Z,A)))),A=z*r.size,p.vec3.set(Q,r.data[A],r.data[A+1],r.data[A+2]),this.normalAndViewAngle(Q,S,q,V),this.applyVerticalOffsetTransformationView(M,V,q,K),q.applyProjection(M,R),-1<R[0]&&(A=Math.floor(R[0])+this.params.screenOffset[0],C=Math.floor(R[1])+this.params.screenOffset[1],w&&(A+=Z[0],0!==Z[1]&&(C+=x.applyScaleFactor(Z[1],K.factorAlignment))),x.applyPrecomputedScaleFactor(ca,K.factor,ca),F=Y*q.pixelRatio,I=void 0,a.textureIsSignedDistanceField&&
(I=a.outlineSize*q.pixelRatio/2),H(u,A,C,ca,F,I,a,v)&&(C=e.ray,p.vec3.transformMat4(N,M,m.mat4.invert(U,q.viewMatrix)),R[0]=u[0],R[1]=u[1],q.unprojectPoint(R,M),A=t.vec3f64.create(),p.vec3.copy(A,C.direction),F=1/p.vec3.length(A),p.vec3.scale(A,A,F),C=p.vec3.distance(C.origin,M)*F,f(C,A,-1,1,!0,N)))}};e.prototype.computeAttachmentOrigin=function(a,b){a=a.data;var c="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null;if(!c)return null;var d=B.VertexAttrConstants.POSITION,c=c[d];
a="getIndices"in a?a.getIndices(d):"indices"in a?a.indices[d]:null;return v.computeAttachmentOriginPoints(c,a,b)};e.prototype.createBufferWriter=function(){return new ha(this)};e.prototype.normalAndViewAngle=function(a,b,d,e){u.isMat4(b)&&(b=c.mat3.fromMat4(P,b));p.vec3.transformMat3(e.normal,a,b);p.vec3.transformMat4(e.normal,e.normal,d.viewInverseTransposeMatrix);e.cosAngle=p.vec3.dot(O,ba);return e};e.prototype.updateScaleInfo=function(a,b,c){var d=this.params;d.screenSizePerspective?x.precomputeScaleFactor(c,
b,d.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);d.screenSizePerspectiveAlignment?x.precomputeScaleFactor(c,b,d.screenSizePerspectiveAlignment,a.factorAlignment):(a.factorAlignment.factor=a.factor.factor,a.factorAlignment.scale=a.factor.scale,a.factorAlignment.minPixelSize=a.factor.minPixelSize,a.factorAlignment.paddingPixels=a.factor.paddingPixels)};e.prototype.applyShaderOffsetsView=function(a,b,c,d,e,f,g){b=this.normalAndViewAngle(b,
c,e,V);this.applyVerticalGroundOffsetView(a,b,e,g);this.applyVerticalOffsetTransformationView(g,b,e,f);this.applyPolygonOffsetView(g,b,d[3],e,g);this.applyCenterOffsetView(g,d,g);return g};e.prototype.applyShaderOffsetsNDC=function(a,b,c,d,e){this.applyCenterOffsetNDC(a,b,c,d);k.isSome(e)&&p.vec3.copy(e,d);this.applyPolygonOffsetNDC(d,b,c,d);return d};e.prototype.applyPolygonOffsetView=function(a,b,c,d,e){var f=d.aboveGround?1:-1;c=l.sign(c);0===c&&(c=f);f*=c;if(0>=this.params.shaderPolygonOffset)return p.vec3.copy(e,
a);b=l.clamp(Math.abs(b.cosAngle),.01,1);d=1-Math.sqrt(1-b*b)/b/d.viewport[2];0<f?p.vec3.scale(e,a,d):p.vec3.scale(e,a,1/d);return e};e.prototype.applyVerticalGroundOffsetView=function(a,b,c,d){var e=p.vec3.length(a),f=c.aboveGround?1:-1;c=.5*c.computeRenderPixelSizeAtDist(e);b=p.vec3.scale(M,b.normal,f*c);p.vec3.add(d,a,b);return d};e.prototype.applyVerticalOffsetTransformationView=function(a,b,c,d){var e=this.params;if(!e.verticalOffset||!e.verticalOffset.screenLength){if(e.screenSizePerspective||
e.screenSizePerspectiveAlignment){var f=p.vec3.length(a);this.updateScaleInfo(d,f,b.cosAngle)}else d.factor.scale=1,d.factorAlignment.scale=1;return a}f=p.vec3.length(a);c=C.verticalOffsetAtDistance(c,f,e.verticalOffset,b.cosAngle,e.screenSizePerspectiveAlignment||e.screenSizePerspective);this.updateScaleInfo(d,f,b.cosAngle);p.vec3.scale(b.normal,b.normal,c);return p.vec3.add(a,a,b.normal)};e.prototype.applyCenterOffsetView=function(a,b,c){var d="screen"!==this.params.centerOffsetUnits;c!==a&&p.vec3.copy(c,
a);d&&(c[0]+=b[0],c[1]+=b[1],b[2]&&(p.vec3.normalize(Q,c),p.vec3.add(c,c,p.vec3.scale(Q,Q,b[2]))));return c};e.prototype.applyCenterOffsetNDC=function(a,b,c,d){var e="screen"!==this.params.centerOffsetUnits;d!==a&&p.vec3.copy(d,a);e||(d[0]+=b[0]/c.fullWidth*2,d[1]+=b[1]/c.fullHeight*2);return d};e.prototype.applyPolygonOffsetNDC=function(a,b,c,d){var e=this.params.shaderPolygonOffset;a!==d&&p.vec3.copy(d,a);e&&(a=c.aboveGround?1:-1,b=a*l.sign(b[3]),d[2]-=(b||a)*e);return d};e.prototype.getGLMaterial=
function(a){if(0===a.output)return new J(a);if(4===a.output)return new I(a)};e.prototype.calculateRelativeScreenBounds=function(a,c,d){void 0===d&&(d=r.create());var e=this.params,f=d;void 0===f&&(f=L);b.vec2.copy(f,e.anchorPos);f[0]*=-a[0];f[1]*=-a[1];f[0]+=e.screenOffset[0]*c;f[1]+=e.screenOffset[1]*c;d[2]=d[0]+a[0];d[3]=d[1]+a[1];return d};return e}(z.Material);a.default=n;a=function(a){function b(b){b=a.call(this,d.__assign(d.__assign({},b),b.material.getParameters()))||this;b.updateParameters();
return b}d.__extends(b,a);b.prototype.beginSlot=function(a){return a===(this.params.drawInSecondSlot?19:18)};b.prototype.updateParameters=function(){this.params=C.copyParameters(this.material.getParameters());this.updateTexture(this.params.textureId);this.selectProgram()};b.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(F.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);
this.bindTexture(a,this.technique.program);this.bindTextureScale(a,this.technique.program);this.technique.bindPass(a,this.params,b)};return b}(w);var J=function(a){function b(b){b=a.call(this,d.__assign(d.__assign({},b),{output:0}))||this;b.isOcclusionSlot=!1;return b}d.__extends(b,a);b.prototype.beginSlot=function(a){var b=this.params.drawInSecondSlot?19:18;if(this.params.occlusionTest)return this.isOcclusionSlot=12===a,12===a||a===b;this.isOcclusionSlot=!1;return a===b};b.prototype.getTechnique=
function(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique};b.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(F.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique);this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(F.HUDMaterialTechnique,this.material.getTechniqueConfig(6),this.occlusionTechnique)};b.prototype.bind=function(a,b){var c=this.getTechnique();a.bindProgram(c.program);this.isOcclusionSlot||
(this.bindTexture(a,c.program),this.bindTextureScale(a,c.program));c.bindPass(a,this.params,b)};return b}(a),I=function(a){function b(b){return a.call(this,d.__assign(d.__assign({},b),{output:4}))||this}d.__extends(b,a);return b}(a),K={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},L=g.vec2f64.create(),M=t.vec3f64.create(),Q=t.vec3f64.create(),R=e.createRenderScreenPointArray3(),O=t.vec3f64.create(),N=t.vec3f64.create(),
S=h.mat3f64.create(),P=h.mat3f64.create(),U=f.mat4f64.create(),Z=t.vec3f64.create(),V={normal:O,cosAngle:0},T=f.mat4f64.create(),Y=1,X=2,ca=[0,0],ba=t.vec3f64.fromValues(0,0,1),ga={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,
vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:g.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,debugDrawBorder:!1},ia=q.newLayout().vec3f(B.VertexAttrConstants.POSITION).vec3f(B.VertexAttrConstants.NORMAL).vec2f(B.VertexAttrConstants.UV0).vec4u8(B.VertexAttrConstants.COLOR).vec2f(B.VertexAttrConstants.SIZE).vec4f(B.VertexAttrConstants.AUXPOS1).vec4f(B.VertexAttrConstants.AUXPOS2),
ha=function(){function a(a){this.material=a;this.vertexBufferLayout=ia}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[B.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d){A.writePosition(b.indices[B.VertexAttrConstants.POSITION],b.vertexAttr[B.VertexAttrConstants.POSITION].data,a.transformation,c.position,d,6);A.writeNormal(b.indices[B.VertexAttrConstants.NORMAL],b.vertexAttr[B.VertexAttrConstants.NORMAL].data,
a.invTranspTransformation,c.normal,d,6);a=b.vertexAttr[B.VertexAttrConstants.UV0].data;var e=void 0,f=void 0,g=void 0,h=void 0;null==a||4>a.length?(a=this.material.getParameters(),f=e=0,g=a.texCoordScale[0],h=a.texCoordScale[1]):(e=a[0],f=a[1],g=a[2],h=a[3]);var g=Math.min(1.99999,g+1),h=Math.min(1.99999,h+1),m=b.indices[B.VertexAttrConstants.POSITION].length,k=c.uv0;a=d;for(var p=0;p<m;++p)k.set(a,0,e),k.set(a,1,f),a+=1,k.set(a,0,g),k.set(a,1,f),a+=1,k.set(a,0,g),k.set(a,1,h),a+=1,k.set(a,0,g),k.set(a,
1,h),a+=1,k.set(a,0,e),k.set(a,1,h),a+=1,k.set(a,0,e),k.set(a,1,f),a+=1;A.writeColor(b.indices[B.VertexAttrConstants.COLOR],b.vertexAttr[B.VertexAttrConstants.COLOR].data,4,c.color,d,6);e=b.indices[B.VertexAttrConstants.SIZE];f=b.vertexAttr[B.VertexAttrConstants.SIZE].data;g=e.length;h=c.size;a=d;for(p=0;p<g;++p)for(var m=f[2*e[p]],k=f[2*e[p]+1],l=0;6>l;++l)h.set(a,0,m),h.set(a,1,k),a+=1;b.indices[B.VertexAttrConstants.AUXPOS1]&&b.vertexAttr[B.VertexAttrConstants.AUXPOS1]&&A.writeBufferVec4(b.indices[B.VertexAttrConstants.AUXPOS1],
b.vertexAttr[B.VertexAttrConstants.AUXPOS1].data,c.auxpos1,d,6);b.indices[B.VertexAttrConstants.AUXPOS2]&&b.vertexAttr[B.VertexAttrConstants.AUXPOS2]&&A.writeBufferVec4(b.indices[B.VertexAttrConstants.AUXPOS2],b.vertexAttr[B.VertexAttrConstants.AUXPOS2].data,c.auxpos2,d,6)};return a}()})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["require","exports"],function(n,a){function d(a){return a instanceof Float32Array&&16<=a.length}function l(a){return Array.isArray(a)&&16<=a.length}Object.defineProperty(a,
"__esModule",{value:!0});a.isMat4=a.isMat4f64=a.isMat4f32=void 0;a.isMat4f32=d;a.isMat4f64=l;a.isMat4=function(a){return d(a)||l(a)}})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define("require exports tslib ../../../../core/maybe ./DefaultTextureUnits ./GLMaterial".split(" "),function(n,a,d,l,k,e){return function(a){function c(c){var d=a.call(this,c)||this;d._textureIDs=new Set;d._textureRepository=c.textureRep;d._textureId=c.textureId;d._initTransparent=!!c.initTextureTransparent;
d._texture=d._acquireIfNotUndefined(d._textureId);d._textureNormal=d._acquireIfNotUndefined(c.normalTextureId);d._textureEmissive=d._acquireIfNotUndefined(c.emissiveTextureId);d._textureOcclusion=d._acquireIfNotUndefined(c.occlusionTextureId);d._textureMetallicRoughness=d._acquireIfNotUndefined(c.metallicRoughnessTextureId);return d}d.__extends(c,a);c.prototype.dispose=function(){var a=this;this._textureIDs.forEach(function(c){return a._textureRepository.release(c)});this._textureIDs.clear()};c.prototype.updateTexture=
function(a){a!==this._textureId&&(this._releaseIfNotUndefined(this._textureId),this._textureId=a,this._texture=this._acquireIfNotUndefined(this._textureId))};c.prototype.bindTexture=function(a,c){l.isSome(this._texture)&&(c.setUniform1i("tex",k.DefaultTextureUnits.DIFFUSE),a.bindTexture(this._texture.glTexture,k.DefaultTextureUnits.DIFFUSE));l.isSome(this._textureNormal)&&(c.setUniform1i("normalTexture",k.DefaultTextureUnits.NORMAL),a.bindTexture(this._textureNormal.glTexture,k.DefaultTextureUnits.NORMAL));
l.isSome(this._textureEmissive)&&(c.setUniform1i("texEmission",k.DefaultTextureUnits.EMISSION),a.bindTexture(this._textureEmissive.glTexture,k.DefaultTextureUnits.EMISSION));l.isSome(this._textureOcclusion)&&(c.setUniform1i("texOcclusion",k.DefaultTextureUnits.OCCLUSION),a.bindTexture(this._textureOcclusion.glTexture,k.DefaultTextureUnits.OCCLUSION));l.isSome(this._textureMetallicRoughness)&&(c.setUniform1i("texMetallicRoughness",k.DefaultTextureUnits.METALLIC_ROUGHNESS),a.bindTexture(this._textureMetallicRoughness.glTexture,
k.DefaultTextureUnits.METALLIC_ROUGHNESS))};c.prototype.bindTextureScale=function(a,c){(a=l.isSome(this._texture)&&this._texture.glTexture)&&a.descriptor.textureCoordinateScaleFactor?c.setUniform2fv("textureCoordinateScaleFactor",a.descriptor.textureCoordinateScaleFactor):c.setUniform2f("textureCoordinateScaleFactor",1,1)};c.prototype._acquireIfNotUndefined=function(a){if(!l.isNone(a))return this._textureIDs.add(a),this._textureRepository.acquire(a,this._initTransparent)};c.prototype._releaseIfNotUndefined=
function(a){void 0!==a&&(this._textureIDs.delete(a),this._textureRepository.release(a))};return c}(e.GLMaterial)})},"esri/views/3d/webgl-engine/lib/DefaultTextureUnits":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.DefaultTextureUnits=void 0;a.DefaultTextureUnits={DIFFUSE:0,NORMAL:1,EMISSION:2,OCCLUSION:3,METALLIC_ROUGHNESS:4,SSAO:6,SHADOW_MAP:7}})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["require","exports","tslib",
"./AutoDisposable"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.GLMaterial=void 0;n=function(a){function e(c){var d=a.call(this)||this;d.material=c.material;d.techniqueRep=c.techniqueRep;d.output=c.output;return d}d.__extends(e,a);e.prototype.getTechnique=function(){return this.technique};e.prototype.getPipelineState=function(a,d){return this.getTechnique().pipeline};e.prototype.ensureResources=function(a){return 2};e.prototype.ensureParameters=function(a){};return e}(l.AutoDisposable);
a.GLMaterial=n})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["require","exports","tslib"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.autoDispose=a.AutoDisposable=a.AutoDisposableMixin=void 0;a.AutoDisposableMixin=function(a){return function(a){function e(){var c=null!==a&&a.apply(this,arguments)||this;c._isDisposed=!1;return c}d.__extends(e,a);e.prototype.dispose=function(){for(var a,d=0,e=null!==(a=this._managedDisposables)&&void 0!==a?a:[];d<e.length;d++){a=
e[d];var f=this[a];this[a]=null;f&&"function"===typeof f.dispose&&f.dispose()}this._isDisposed=!0};Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0});return e}(a)};n=function(a){function k(){return null!==a&&a.apply(this,arguments)||this}d.__extends(k,a);return k}(a.AutoDisposableMixin(function(){return function(){}}()));a.AutoDisposable=n;a.autoDispose=function(){return function(a,d){var e,c;a.hasOwnProperty("_managedDisposables")||
(a._managedDisposables=null!==(c=null===(e=a._managedDisposables)||void 0===e?void 0:e.slice())&&void 0!==c?c:[]);a._managedDisposables.unshift(d)}}})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require","exports","../../../../core/maybe","./DefaultVertexAttributeLocations","./IdGen"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.materialPredicate=a.Material=void 0;n=function(){function a(c){this.supportsEdges=!1;this._visible=!0;this._renderOccluded=1;
this._insertOrder=this._renderPriority=0;this._vertexAttributeLocations=l.Default3D;this.id=a._idGen.gen(c)}a.prototype.dispose=function(){};a.prototype.update=function(a){return!1};Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this.parametersChanged())},enumerable:!1,configurable:!0});a.prototype.isVisibleInPass=function(a){return!0};Object.defineProperty(a.prototype,"renderOccluded",{get:function(){return this._renderOccluded},
set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this.parametersChanged())},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(a){a!==this._renderPriority&&(this._renderPriority=a,this.parametersChanged())},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"insertOrder",{get:function(){return this._insertOrder},set:function(a){a!==this._insertOrder&&(this._insertOrder=a,this.parametersChanged())},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"vertexAttributeLocations",{get:function(){return this._vertexAttributeLocations},enumerable:!1,configurable:!0});a.prototype.isVisible=function(){return this._visible};a.prototype.parametersChanged=function(){d.isSome(this.materialRepository)&&this.materialRepository.materialChanged(this)};a._idGen=new k.IdGen;return a}();a.Material=n;a.materialPredicate=function(a,c){return a.isVisible()&&a.isVisibleInPass(c.pass)&&0!==(a.renderOccluded&
c.renderOccludedMask)}})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["require","exports","../../../support/buffer/BufferView","../../lib/Util"],function(n,a,d,l){function k(a,c,d,e,f){var b=d.typedBuffer;d=d.typedBufferStride;var g=a.length;e*=d;if(null==f||1===f)for(var h=0;h<g;++h){var m=2*a[h];b[e]=c[m];b[e+1]=c[m+1];e+=d}else for(h=0;h<g;++h)for(var m=2*a[h],k=0;k<f;++k)b[e]=c[m],b[e+1]=c[m+1],e+=d}function e(a,c,d,e,f){var b=d.typedBuffer;d=d.typedBufferStride;
var g=a.length;e*=d;if(null==f||1===f)for(var h=0;h<g;++h){var m=3*a[h];b[e]=c[m];b[e+1]=c[m+1];b[e+2]=c[m+2];e+=d}else for(h=0;h<g;++h)for(var m=3*a[h],k=0;k<f;++k)b[e]=c[m],b[e+1]=c[m+1],b[e+2]=c[m+2],e+=d}function c(a,c,d,e,f){var b=d.typedBuffer;d=d.typedBufferStride;var g=a.length;e*=d;if(null==f||1===f)for(var h=0;h<g;++h){var m=4*a[h];b[e]=c[m];b[e+1]=c[m+1];b[e+2]=c[m+2];b[e+3]=c[m+3];e+=d}else for(h=0;h<g;++h)for(var m=4*a[h],k=0;k<f;++k)b[e]=c[m],b[e+1]=c[m+1],b[e+2]=c[m+2],b[e+3]=c[m+3],
e+=d}function h(a,c,d,f,h,m){if(d){var b=f.typedBuffer;f=f.typedBufferStride;var g=a.length;h*=f;if(null==m||1===m)for(var k=0;k<g;++k){var p=3*a[k],l=c[p],r=c[p+1],u=c[p+2];b[h]=d[0]*l+d[4]*r+d[8]*u+d[12];b[h+1]=d[1]*l+d[5]*r+d[9]*u+d[13];b[h+2]=d[2]*l+d[6]*r+d[10]*u+d[14];h+=f}else for(k=0;k<g;++k)for(var p=3*a[k],l=c[p],r=c[p+1],u=c[p+2],p=d[0]*l+d[4]*r+d[8]*u+d[12],t=d[1]*l+d[5]*r+d[9]*u+d[13],l=d[2]*l+d[6]*r+d[10]*u+d[14],r=0;r<m;++r)b[h]=p,b[h+1]=t,b[h+2]=l,h+=f}else e(a,c,f,h,m)}function m(a,
c,d,f,h,m){if(d){var b=f.typedBuffer;f=f.typedBufferStride;var g=a.length,k=d[0],p=d[1],l=d[2],r=d[4],u=d[5],t=d[6],E=d[8],G=d[9];d=d[10];var F=1E-5<Math.abs(1-k*k+r*r+E*E)||1E-5<Math.abs(1-p*p+u*u+G*G)||1E-5<Math.abs(1-l*l+t*t+d*d);h*=f;if(null==m||1===m)for(var H=0;H<g;++H){var J=3*a[H],I=c[J],K=c[J+1],L=c[J+2];m=k*I+r*K+E*L;var J=p*I+u*K+G*L,n=l*I+t*K+d*L;F&&(I=m*m+J*J+n*n,.999999>I&&1E-6<I&&(I=Math.sqrt(I),m/=I,J/=I,n/=I));b[h+0]=m;b[h+1]=J;b[h+2]=n;h+=f}else for(H=0;H<g;++H)for(J=3*a[H],I=c[J],
K=c[J+1],L=c[J+2],J=k*I+r*K+E*L,n=p*I+u*K+G*L,K=l*I+t*K+d*L,F&&(I=J*J+n*n+K*K,.999999>I&&1E-6<I&&(I=Math.sqrt(I),J/=I,n/=I,K/=I)),I=0;I<m;++I)b[h+0]=J,b[h+1]=n,b[h+2]=K,h+=f}else e(a,c,f,h,m)}function f(a,c,d,e,f,h){var b=e.typedBuffer;e=e.typedBufferStride;var g=a.length;f*=e;if(null==h||1===h)if(4===d)for(d=0;d<g;++d){var m=4*a[d];b[f]=c[m];b[f+1]=c[m+1];b[f+2]=c[m+2];b[f+3]=c[m+3];f+=e}else{if(3===d)for(d=0;d<g;++d)m=3*a[d],b[f]=c[m],b[f+1]=c[m+1],b[f+2]=c[m+2],b[f+3]=255,f+=e}else if(4===d)for(d=
0;d<g;++d)for(var m=4*a[d],k=0;k<h;++k)b[f]=c[m],b[f+1]=c[m+1],b[f+2]=c[m+2],b[f+3]=c[m+3],f+=e;else if(3===d)for(d=0;d<g;++d)for(m=3*a[d],k=0;k<h;++k)b[f]=c[m],b[f+1]=c[m+1],b[f+2]=c[m+2],b[f+3]=255,f+=e}Object.defineProperty(a,"__esModule",{value:!0});a.writeDefaultAttributes=a.writeMultipliedColor=a.writeColor=a.writeNormal=a.writePosition=a.writeBufferMat4f=a.writeBufferMat3f=a.writeBufferVec4=a.writeBufferVec3=a.writeBufferVec2=void 0;a.writeBufferVec2=k;a.writeBufferVec3=e;a.writeBufferVec4=
c;a.writeBufferMat3f=function(a,c,d,e){var b=d.typedBuffer;d=d.typedBufferStride;var f=a.length;e*=d;for(var g=0;g<f;++g){for(var h=9*a[g],m=0;9>m;++m)b[e+m]=c[h+m];e+=d}};a.writeBufferMat4f=function(a,c,d,e){var b=d.typedBuffer;d=d.typedBufferStride;var f=a.length;e*=d;for(var g=0;g<f;++g){for(var h=16*a[g],m=0;16>m;++m)b[e+m]=c[h+m];e+=d}};a.writePosition=h;a.writeNormal=m;a.writeColor=f;a.writeMultipliedColor=function(a,c,d,e,f,h,m){var b=f.typedBuffer;f=f.typedBufferStride;var g=a.length;h*=f;
if(null==m||1===m)if(4===d)for(d=0;d<g;++d){var k=4*a[d];b[h]=c[k]*e[0];b[h+1]=c[k+1]*e[1];b[h+2]=c[k+2]*e[2];b[h+3]=c[k+3]*e[3];h+=f}else{if(3===d){var p=255*e[3];for(d=0;d<g;++d)k=3*a[d],b[h]=c[k]*e[0],b[h+1]=c[k+1]*e[1],b[h+2]=c[k+2]*e[2],b[h+3]=p,h+=f}}else if(4===d)for(d=0;d<g;++d)for(var k=4*a[d],l=0;l<m;++l)b[h]=c[k]*e[0],b[h+1]=c[k+1]*e[1],b[h+2]=c[k+2]*e[2],b[h+3]=c[k+3]*e[3],h+=f;else if(3===d)for(p=255*e[3],d=0;d<g;++d)for(k=3*a[d],l=0;l<m;++l)b[h]=c[k]*e[0],b[h+1]=c[k+1]*e[1],b[h+2]=c[k+
2]*e[2],b[h+3]=p,h+=f};a.writeDefaultAttributes=function(a,e,p,t,u,r){var b=0;for(e=e.fieldNames;b<e.length;b++){var g=e[b],w=a.vertexAttr[g],z=a.indices[g];if(w&&z)switch(g){case l.VertexAttrConstants.POSITION:l.assert(3===w.size);(g=u.getField(g,d.BufferViewVec3f))&&h(z,w.data,p,g,r);break;case l.VertexAttrConstants.NORMAL:l.assert(3===w.size);(g=u.getField(g,d.BufferViewVec3f))&&m(z,w.data,t,g,r);break;case l.VertexAttrConstants.UV0:l.assert(2===w.size);(g=u.getField(g,d.BufferViewVec2f))&&k(z,
w.data,g,r);break;case l.VertexAttrConstants.UVMAPSPACE:l.assert(4===w.size);(g=u.getField(g,d.BufferViewVec4f))&&c(z,w.data,g,r);break;case l.VertexAttrConstants.MEANVERTEXPOSITION:l.assert(3===w.size);(g=u.getField(g,d.BufferViewVec3f))&&h(z,w.data,p,g,r);break;case l.VertexAttrConstants.BOUND1:case l.VertexAttrConstants.BOUND2:case l.VertexAttrConstants.BOUND3:l.assert(3===w.size);(g=u.getField(g,d.BufferViewVec3f))&&h(z,w.data,p,g,r);break;case l.VertexAttrConstants.COLOR:l.assert(3===w.size||
4===w.size);(g=u.getField(g,d.BufferViewVec4u8))&&f(z,w.data,w.size,g,r);break;case l.VertexAttrConstants.SYMBOLCOLOR:l.assert(3===w.size||4===w.size);(g=u.getField(g,d.BufferViewVec4u8))&&f(z,w.data,w.size,g,r);break;case l.VertexAttrConstants.TANGENT:l.assert(4===w.size),(g=u.getField(g,d.BufferViewVec4f))&&c(z,w.data,g,r)}}}})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/screenSizePerspectiveUtils ../../lib/Util ../renderers/utils".split(" "),
function(n,a,d,l,k,e,c,h,m,f){function b(a,d,e,f,h,m){var k=t(d,e,x);c.setMin(w,a.getBBMin());c.setMax(w,a.getBBMax());l.isSome(h)&&h.applyToAabb(w);if(u(w,d,k,f)){var k=a.getPrimitiveIndices(),p=a.getIndices(),r=a.getPosition(),q=k?k.length:p.length/3;if(q>G&&(a=a.getChildren(),void 0!==a)){for(k=0;8>k;++k)void 0!==a[k]&&b(a[k],d,e,f,h,m);return}g(d,e,0,q,p,r,k,h,m)}}function g(a,b,c,d,e,f,g,h,m){var k,r,q;if(g){var u,t,v=f.data,w=f.offsetIdx;f=f.strideIdx;var x=a[0],z=a[1];a=a[2];var C=b[0]-x,E=
b[1]-z;for(b=b[2]-a;c<d;++c){var F=g[c],H=3*F;t=w+f*e[H++];var I=v[t++],G=v[t++];k=v[t];t=w+f*e[H++];var K=v[t++];r=v[t++];u=v[t];t=w+f*e[H];H=v[t++];q=v[t++];t=v[t];l.isSome(h)&&(k=h.applyToVertex(I,G,k),I=k[0],G=k[1],k=k[2],u=h.applyToVertex(K,r,u),K=u[0],r=u[1],u=u[2],t=h.applyToVertex(H,q,t),H=t[0],q=t[1],t=t[2]);K-=I;r-=G;u-=k;H-=I;q-=G;t-=k;var J=E*t-q*b,L=b*H-t*C,Q=C*q-H*E,n=K*J+r*L+u*Q;if(!(Math.abs(n)<=B)){I=x-I;G=z-G;k=a-k;J=I*J+G*L+k*Q;if(0<n){if(0>J||J>n)continue}else if(0<J||J<n)continue;
L=G*u-r*k;k=k*K-u*I;G=I*r-K*G;I=C*L+E*k+b*G;if(0<n){if(0>I||J+I>n)continue}else if(0<I||J+I<n)continue;G=(H*L+q*k+t*G)/n;0<=G&&(K=p(K,r,u,H,q,t,A),m(G,K,F))}}}else for(g=f.data,v=f.offsetIdx,w=f.strideIdx,f=a[0],x=a[1],z=a[2],a=b[0]-f,C=b[1]-x,E=b[2]-z,b=c,c*=3;b<d;++b)if(q=v+w*e[c++],I=g[q++],G=g[q++],k=g[q],q=v+w*e[c++],F=g[q++],K=g[q++],r=g[q],q=v+w*e[c++],u=g[q++],H=g[q++],q=g[q],l.isSome(h)&&(k=h.applyToVertex(I,G,k),I=k[0],G=k[1],k=k[2],r=h.applyToVertex(F,K,r),F=r[0],K=r[1],r=r[2],q=h.applyToVertex(u,
H,q),u=q[0],H=q[1],q=q[2]),F-=I,K-=G,r-=k,u-=I,H-=G,q-=k,n=C*q-H*E,J=E*u-q*a,L=a*H-u*C,t=F*n+K*J+r*L,!(Math.abs(t)<=B)){I=f-I;G=x-G;k=z-k;n=I*n+G*J+k*L;if(0<t){if(0>n||n>t)continue}else if(0<n||n<t)continue;J=G*r-K*k;k=k*F-r*I;G=I*K-F*G;I=a*J+C*k+E*G;if(0<t){if(0>I||n+I>t)continue}else if(0<I||n+I<t)continue;G=(u*J+H*k+q*G)/t;0<=G&&(F=p(F,K,r,u,H,q,A),m(G,F,b))}}function p(a,b,c,d,e,f,g){k.vec3.set(C,a,b,c);k.vec3.set(E,d,e,f);k.vec3.cross(g,C,E);k.vec3.normalize(g,g);return g}function t(a,b,c){return k.vec3.set(c,
1/(b[0]-a[0]),1/(b[1]-a[1]),1/(b[2]-a[2]))}function u(a,b,c,d){return r(a,b,c,d,Infinity)}function r(a,b,c,d,e){var f=(a[0]-d-b[0])*c[0],g=(a[3]+d-b[0])*c[0],h=Math.min(f,g),f=Math.max(f,g),g=(a[1]-d-b[1])*c[1],m=(a[4]+d-b[1])*c[1],f=Math.min(f,Math.max(g,m));if(0>f)return!1;h=Math.max(h,Math.min(g,m));if(h>f)return!1;g=(a[2]-d-b[2])*c[2];a=(a[5]+d-b[2])*c[2];f=Math.min(f,Math.max(g,a));if(0>f)return!1;h=Math.max(h,Math.min(g,a));return h>f?!1:h<e}function q(a,b){b=b?q(b):{};for(var c in a){var d=
a[c];d&&d.forEach&&(d=v(d));null==d&&c in b||(b[c]=d)}return b}function v(a){var b=[];a.forEach(function(a){return b.push(a)});return b}Object.defineProperty(a,"__esModule",{value:!0});a.colorMixModes=a.intersectDrapedRenderLineGeometry=a.updateParameters=a.copyParameters=a.bindScreenSizePerspective=a.verticalOffsetAtDistance=a.intersectAabbInvDirBefore=a.intersectAabbInvDir=a.computeInvDir=a.computeNormal=a.intersectTriangles=a.intersectTriangleGeometry=void 0;var w=c.create(),z=m.VertexAttrConstants;
a.intersectTriangleGeometry=function(a,c,d,e,h,k,p){c=f.isInstanceHidden(c);d=d.tolerance;c||(a.boundingInfo?(m.assert("triangle"===a.data.primitiveType),b(a.boundingInfo,e,h,d,k,p)):(d=a.getIndices(z.POSITION),a=a.getAttribute(z.POSITION),g(e,h,0,d.length/3,d,a,void 0,k,p)))};var x=e.vec3f64.create(),B=Math.pow(2,-52),A=e.vec3f64.create();a.intersectTriangles=g;var C=e.vec3f64.create(),E=e.vec3f64.create();a.computeNormal=p;a.computeInvDir=t;a.intersectAabbInvDir=u;a.intersectAabbInvDirBefore=r;
a.verticalOffsetAtDistance=function(a,b,c,e,f){var g=(c.screenLength||0)*a.pixelRatio;f&&(g=h.scale(g,e,b,f));return d.glClamp(g*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*b,c.minWorldLength||0,null!=c.maxWorldLength?c.maxWorldLength:Infinity)};a.bindScreenSizePerspective=function(a,b,c){if(a){var d=a.parameters;b.setUniform4f(c,d.divisor,d.offset,d.minPixelSize,a.paddingPixelsOverride)}};a.copyParameters=q;a.updateParameters=function(a,b){var c=!1,d;for(d in b){var e=b[d];void 0!==e&&(c=!0,Array.isArray(e)?
a[d]=e.slice():a[d]=e)}return c};a.intersectDrapedRenderLineGeometry=function(a,b,c,e,f){if(b.options.selectionMode){b=a.getAttribute(z.POSITION).data;var g=a.getAttribute(z.SIZE),h=c[0];c=c[1];a=(((g&&g.data[0])+e)/2+4)*a.screenToWorldRatio;e=Number.MAX_VALUE;for(g=0;g<b.length-5;g+=3){var m=b[g],k=b[g+1],p=h-m,l=c-k,m=b[g+3]-m,k=b[g+4]-k,r=d.clamp((m*p+k*l)/(m*m+k*k),0,1),p=m*r-p,l=k*r-l,l=p*p+l*l;l<e&&(e=l)}e<a*a&&f()}};a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var G=1E3})},"esri/geometry/support/aaBoundingBox":function(){define(["require",
"exports","../../core/maybe","../Extent","./aaBoundingRect"],function(n,a,d,l,k){function e(b){void 0===b&&(b=a.ZERO);return[b[0],b[1],b[2],b[3],b[4],b[5]]}function c(a,b,c,d,f,g,h){void 0===h&&(h=e());h[0]=a;h[1]=b;h[2]=c;h[3]=d;h[4]=f;h[5]=g;return h}function h(a){return a[0]>=a[3]?0:a[3]-a[0]}function m(a){return a[1]>=a[4]?0:a[4]-a[1]}function f(a){return a[2]>=a[5]?0:a[5]-a[2]}function b(a,b){return Math.max(b[0],a[0])<=Math.min(b[3],a[3])&&Math.max(b[1],a[1])<=Math.min(b[4],a[4])&&Math.max(b[2],
a[2])<=Math.min(b[5],a[5])}function g(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a}function p(a){return 6===a.length}Object.defineProperty(a,"__esModule",{value:!0});a.ZERO=a.NEGATIVE_INFINITY=a.POSITIVE_INFINITY=a.wrap=a.equals=a.isPoint=a.is=a.fromRect=a.toRect=a.empty=a.set=a.setMax=a.setMin=a.getMax=a.getMin=a.offset=a.intersectsClippingArea=a.intersects=a.contains=a.containsPointWithMargin=a.containsPoint=a.maximumDimension=a.size=a.center=a.diameter=a.height=a.depth=
a.width=a.allFinite=a.expandWithNestedArray=a.expandWithOffset=a.expandWithBuffer=a.expand=a.expandPointInPlace=a.fromMinMax=a.toExtent=a.fromExtent=a.fromValues=a.create=void 0;a.create=e;a.fromValues=c;a.fromExtent=function(a,b){void 0===b&&(b=e());b[0]=a.xmin;b[1]=a.ymin;b[2]=a.zmin;b[3]=a.xmax;b[4]=a.ymax;b[5]=a.zmax;return b};a.toExtent=function(a,b){return isFinite(a[2])||isFinite(a[5])?new l({xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],zmin:a[2],zmax:a[5],spatialReference:b}):new l({xmin:a[0],
xmax:a[3],ymin:a[1],ymax:a[4],spatialReference:b})};a.fromMinMax=function(a,b,c){void 0===c&&(c=e());c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=b[0];c[4]=b[1];c[5]=b[2];return c};a.expandPointInPlace=function(a,b){b[0]<a[0]&&(a[0]=b[0]);b[0]>a[3]&&(a[3]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[1]>a[4]&&(a[4]=b[1]);b[2]<a[2]&&(a[2]=b[2]);b[2]>a[5]&&(a[5]=b[2])};a.expand=function(a,b,c){void 0===c&&(c=a);p(b)?(c[0]=Math.min(a[0],b[0]),c[1]=Math.min(a[1],b[1]),c[2]=Math.min(a[2],b[2]),c[3]=Math.max(a[3],b[3]),c[4]=Math.max(a[4],
b[4]),c[5]=Math.max(a[5],b[5])):k.is(b)?(c[0]=Math.min(a[0],b[0]),c[1]=Math.min(a[1],b[1]),c[3]=Math.max(a[3],b[2]),c[4]=Math.max(a[4],b[3])):2===b.length?(c[0]=Math.min(a[0],b[0]),c[1]=Math.min(a[1],b[1]),c[3]=Math.max(a[3],b[0]),c[4]=Math.max(a[4],b[1])):3===b.length&&(c[0]=Math.min(a[0],b[0]),c[1]=Math.min(a[1],b[1]),c[2]=Math.min(a[2],b[2]),c[3]=Math.max(a[3],b[0]),c[4]=Math.max(a[4],b[1]),c[5]=Math.max(a[5],b[2]));return c};a.expandWithBuffer=function(a,b,c,d,e){void 0===c&&(c=0);void 0===d&&
(d=b.length/3);void 0===e&&(e=a);var f=a[0],g=a[1],h=a[2],m=a[3],k=a[4];a=a[5];for(var p=0;p<d;p++)f=Math.min(f,b[c+3*p]),g=Math.min(g,b[c+3*p+1]),h=Math.min(h,b[c+3*p+2]),m=Math.max(m,b[c+3*p]),k=Math.max(k,b[c+3*p+1]),a=Math.max(a,b[c+3*p+2]);e[0]=f;e[1]=g;e[2]=h;e[3]=m;e[4]=k;e[5]=a;return e};a.expandWithOffset=function(a,b,c,d,e){void 0===e&&(e=a);e[0]=Math.min(a[0],a[0]+b);e[3]=Math.max(a[3],a[3]+b);e[1]=Math.min(a[1],a[1]+c);e[4]=Math.max(a[4],a[4]+c);e[2]=Math.min(a[2],a[2]+d);e[5]=Math.max(a[5],
a[5]+d);return e};a.expandWithNestedArray=function(a,b,c,d){void 0===d&&(d=a);var e=b.length,f=a[0],g=a[1],h=a[2],m=a[3],k=a[4];a=a[5];if(c)for(c=0;c<e;c++){var p=b[c],f=Math.min(f,p[0]),g=Math.min(g,p[1]),h=Math.min(h,p[2]),m=Math.max(m,p[0]),k=Math.max(k,p[1]);a=Math.max(a,p[2])}else for(c=0;c<e;c++)p=b[c],f=Math.min(f,p[0]),g=Math.min(g,p[1]),m=Math.max(m,p[0]),k=Math.max(k,p[1]);d[0]=f;d[1]=g;d[2]=h;d[3]=m;d[4]=k;d[5]=a;return d};a.allFinite=function(a){for(var b=0;6>b;b++)if(!isFinite(a[b]))return!1;
return!0};a.width=h;a.depth=m;a.height=f;a.diameter=function(a){var b=h(a),c=f(a);a=m(a);return Math.sqrt(b*b+c*c+a*a)};a.center=function(a,b){void 0===b&&(b=[0,0,0]);b[0]=a[0]+h(a)/2;b[1]=a[1]+m(a)/2;b[2]=a[2]+f(a)/2;return b};a.size=function(a,b){void 0===b&&(b=[0,0,0]);b[0]=h(a);b[1]=m(a);b[2]=f(a);return b};a.maximumDimension=function(a){return Math.max(h(a),f(a),m(a))};a.containsPoint=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[2]>=a[2]&&b[0]<=a[3]&&b[1]<=a[4]&&b[2]<=a[5]};a.containsPointWithMargin=
function(a,b,c){return b[0]>=a[0]-c&&b[1]>=a[1]-c&&b[2]>=a[2]-c&&b[0]<=a[3]+c&&b[1]<=a[4]+c&&b[2]<=a[5]+c};a.contains=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[2]>=a[2]&&b[3]<=a[3]&&b[4]<=a[4]&&b[5]<=a[5]};a.intersects=b;a.intersectsClippingArea=function(a,c){return d.isNone(c)?!0:b(a,c)};a.offset=function(a,b,c,d,e){void 0===e&&(e=a);e[0]=a[0]+b;e[1]=a[1]+c;e[2]=a[2]+d;e[3]=a[3]+b;e[4]=a[4]+c;e[5]=a[5]+d;return e};a.getMin=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.getMax=function(a,
b){b[0]=a[3];b[1]=a[4];b[2]=a[5];return b};a.setMin=function(a,b,c){void 0===c&&(c=a);c[0]=b[0];c[1]=b[1];c[2]=b[2];c!==a&&(c[3]=a[3],c[4]=a[4],c[5]=a[5]);return c};a.setMax=function(a,b,c){void 0===c&&(c=a);c[3]=b[0];c[4]=b[1];c[5]=b[2];c!==a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2]);return a};a.set=g;a.empty=function(b){return b?g(b,a.NEGATIVE_INFINITY):e(a.NEGATIVE_INFINITY)};a.toRect=function(a,b){b||(b=k.create());b[0]=a[0];b[1]=a[1];b[2]=a[3];b[3]=a[4];return b};a.fromRect=function(a,b){a[0]=b[0];a[1]=
b[1];a[2]=Number.NEGATIVE_INFINITY;a[3]=b[2];a[4]=b[3];a[5]=Number.POSITIVE_INFINITY;return a};a.is=p;a.isPoint=function(a){return 0===h(a)&&0===m(a)&&0===f(a)};a.equals=function(a,b,c){if(d.isNone(a)||d.isNone(b))return a===b;if(!p(a)||!p(b))return!1;if(c)for(var e=0;e<a.length;e++){if(!c(a[e],b[e]))return!1}else for(e=0;e<a.length;e++)if(a[e]!==b[e])return!1;return!0};a.wrap=function(a,b,d,e,f,g){return c(a,b,d,e,f,g,t)};a.POSITIVE_INFINITY=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];
a.NEGATIVE_INFINITY=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity];a.ZERO=[0,0,0,0,0,0];var t=e()})},"esri/views/3d/webgl-engine/shaders/HUDMaterial.glsl":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/hud/AlignPixel.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/hud/HUDOcclusionPass.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../core/shaderLibrary/util/ColorConversion.glsl ../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v){function w(a,b){void 0===b&&(b=z);if(a.textureIsSignedDistanceField){var c=a.anchorPos;a=a.distanceFieldBoundingBox;var d=b;d[0]=c[0]*(a[2]-a[0])+a[0];d[1]=c[1]*(a[3]-a[1])+a[1]}else l.vec2.copy(b,a.anchorPos);return b}Object.defineProperty(a,"__esModule",{value:!0});a.calculateAnchorPosForRendering=a.HUDMaterial=a.build=void 0;a.build=function(a){var e=new v.ShaderBuilder,k=a.signedDistanceFieldEnabled;e.include(h.AlignPixel);e.include(m.HUD,a);e.include(c.Slice,
a);if(6===a.output)return e.include(f.HUDOcclusionPass,a),e;e.include(r.ScreenSizePerspective);e.fragment.include(u.RgbaFloatEncoding);e.fragment.include(t.ColorConversion);e.include(g.VisualVariables,a);e.varyings.add("vcolor","vec4");e.varyings.add("vtc","vec2");e.varyings.add("vsize","vec2");a.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float");e.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4");
k&&e.vertex.uniforms.add("outlineColor","vec4");a.screenSizePerspectiveEnabled&&e.vertex.uniforms.add("screenSizePerspective","vec4");(a.debugDrawBorder||a.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4");e.attributes.add("uv0","vec2");e.attributes.add("color","vec4");e.attributes.add("size","vec2");e.attributes.add("auxpos2","vec4");e.vertex.code.add(q.glsl(A||(A=d.__makeTemplateObject(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ",
"\n\n      ","\n\n      vec2 combinedSize \x3d inputSize * pixelRatio;\n      vec4 quadOffset \x3d vec4(0.0);\n\n      ","\n\n      ","\n    "],["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize \x3d inputSize * pixelRatio;\n      vec4 quadOffset \x3d vec4(0.0);\n\n      ",
"\n\n      ","\n    "])),a.screenSizePerspectiveEnabled?q.glsl(x||(x=d.__makeTemplateObject(["\n      inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "],["\n      inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):
q.glsl(B||(B=d.__makeTemplateObject(["\n      inputSize \x3d size;\n      vec2 screenOffsetScaled \x3d screenOffset;"],["\n      inputSize \x3d size;\n      vec2 screenOffsetScaled \x3d screenOffset;"]))),a.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":"",a.occlusionTestEnabled||a.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":"",a.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""));var l=q.glsl(C||(C=d.__makeTemplateObject(["\n      vec2 uv01 \x3d floor(uv0);\n      vec2 uv \x3d uv0 - uv01;\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "],
["\n      vec2 uv01 \x3d floor(uv0);\n      vec2 uv \x3d uv0 - uv01;\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "]))),w=k?q.glsl(E||(E=d.__makeTemplateObject(["\n  posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"],["\n  posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):q.glsl(G||(G=d.__makeTemplateObject(["\n  posProj +\x3d quadOffset;\n  if (inputSize.x \x3d\x3d size.x) {\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\n  }"],
["\n  posProj +\x3d quadOffset;\n  if (inputSize.x \x3d\x3d size.x) {\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\n  }"])));e.vertex.code.add(q.glsl(H||(H=d.__makeTemplateObject(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard \x3d vcolor.a \x3c ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (\x3d fill) and outline color (if applicable) are transparent\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',
"\n        gl_Position \x3d posProj;\n      }\n\n      vtc \x3d uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize \x3d inputSize;\n      ","\n    }\n    "],["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard \x3d vcolor.a \x3c ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (\x3d fill) and outline color (if applicable) are transparent\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',
"\n        gl_Position \x3d posProj;\n      }\n\n      vtc \x3d uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize \x3d inputSize;\n      ","\n    }\n    "])),a.occlusionTestEnabled?"if (visible) {":"",l,a.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;",q.glsl.float(p.symbolAlphaCutoff),k?"alphaDiscard \x3d alphaDiscard \x26\x26 outlineColor.a \x3c "+q.glsl.float(p.symbolAlphaCutoff)+";":"",w,a.debugDrawBorder?
"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":"",a.occlusionTestEnabled?q.glsl(F||(F=d.__makeTemplateObject(["} else { vtc \x3d vec2(0.0);\n        ",""],["} else { vtc \x3d vec2(0.0);\n        ",""])),a.debugDrawBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):""));e.fragment.uniforms.add("tex","sampler2D");k&&(e.fragment.uniforms.add("outlineColor","vec4"),e.fragment.uniforms.add("outlineSize","float"));l=a.debugDrawBorder?q.glsl(J||(J=d.__makeTemplateObject(["(isBorder \x3e 0.0 ? 0.0 : ",
")"],["(isBorder \x3e 0.0 ? 0.0 : ",")"])),q.glsl.float(p.defaultMaskAlphaCutoff)):q.glsl.float(p.defaultMaskAlphaCutoff);k=q.glsl(Q||(Q=d.__makeTemplateObject(["\n    ","\n\n    ","\n\n    ","\n  "],["\n    ","\n\n    ","\n\n    ","\n  "])),a.debugDrawBorder?q.glsl(I||(I=d.__makeTemplateObject(["\n      float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"],["\n      float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):
"",k?q.glsl(K||(K=d.__makeTemplateObject(["\n      vec4 fillPixelColor \x3d vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize \x3d 128.0;\n      const float texelSize \x3d 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\n      vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist \x3d d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor \x3d clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *\x3d fillAlphaFactor;\n\n      if (outlineSize \x3e 0.25) {\n        vec4 outlinePixelColor \x3d outlineColor;\n        float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor \x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *\x3d outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor \x3c ",
" ||\n          fillPixelColor.a + outlinePixelColor.a \x3c ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor \x3c ",
") {\n          discard;\n        }\n\n        gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "],["\n      vec4 fillPixelColor \x3d vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize \x3d 128.0;\n      const float texelSize \x3d 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\n      vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist \x3d d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor \x3d clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *\x3d fillAlphaFactor;\n\n      if (outlineSize \x3e 0.25) {\n        vec4 outlinePixelColor \x3d outlineColor;\n        float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor \x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *\x3d outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor \x3c ",
" ||\n          fillPixelColor.a + outlinePixelColor.a \x3c ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor \x3c ",
") {\n          discard;\n        }\n\n        gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),l,q.glsl.float(p.symbolAlphaCutoff),l):q.glsl(L||(L=d.__makeTemplateObject(["\n          vec4 texColor \x3d texture2D(tex, vtc, -0.5);\n          if (texColor.a \x3c ",") {\n            discard;\n          }\n          gl_FragColor \x3d texColor * premultiplyAlpha(vcolor);\n          "],
["\n          vec4 texColor \x3d texture2D(tex, vtc, -0.5);\n          if (texColor.a \x3c ",") {\n            discard;\n          }\n          gl_FragColor \x3d texColor * premultiplyAlpha(vcolor);\n          "])),l),a.debugDrawBorder?q.glsl(M||(M=d.__makeTemplateObject(["gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"],["gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):"");0===a.output&&e.fragment.code.add(q.glsl(R||(R=d.__makeTemplateObject(["\n    void main() {\n      ",
"\n    }\n    "],["\n    void main() {\n      ","\n    }\n    "])),k));4===a.output&&(e.include(b.OutputHighlight),e.fragment.code.add(q.glsl(N||(N=d.__makeTemplateObject(["\n    void main() {\n      ","\n      ","\n    }\n    "],["\n    void main() {\n      ","\n      ","\n    }\n    "])),k,a.binaryHighlightOcclusionEnabled?q.glsl(O||(O=d.__makeTemplateObject(["\n          if (voccluded \x3d\x3d 1.0) {\n            gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n          }"],
["\n          if (voccluded \x3d\x3d 1.0) {\n            gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();")));return e};(function(a){a.bindUniforms=function(a,b,c){a.setUniform4fv("materialColor",b.color);b.textureIsSignedDistanceField&&(0>=b.outlineColor[3]||0>=b.outlineSize?(a.setUniform4fv("outlineColor",e.vec4f64.ZEROS),a.setUniform1f("outlineSize",0)):(a.setUniform4fv("outlineColor",
b.outlineColor),a.setUniform1f("outlineSize",b.outlineSize)));a.setUniform2f("screenOffset",2*b.screenOffset[0]*c,2*b.screenOffset[1]*c);a.setUniform2fv("anchorPos",w(b))}})(a.HUDMaterial||(a.HUDMaterial={}));a.calculateAnchorPosForRendering=w;var z=k.vec2f64.create(),x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O,N})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("require exports tslib ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../shaderModules/interfaces".split(" "),
function(n,a,d,l,k,e,c){function h(a,e){if(e.slicePlaneEnabled){a.extensions.add("GL_OES_standard_derivatives");e.sliceEnabledForVertexPrograms&&(a.vertex.uniforms.add("slicePlaneOrigin","vec3"),a.vertex.uniforms.add("slicePlaneBasis1","vec3"),a.vertex.uniforms.add("slicePlaneBasis2","vec3"));a.fragment.uniforms.add("slicePlaneOrigin","vec3");a.fragment.uniforms.add("slicePlaneBasis1","vec3");a.fragment.uniforms.add("slicePlaneBasis2","vec3");var h=c.glsl(f||(f=d.__makeTemplateObject(["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel \x3d pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot \x3d dot(slicePlaneBasis1, rel);\n        float basis2Dot \x3d dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front \x3c 0.0\n          \x26\x26 factors.side0 \x3c 0.0\n          \x26\x26 factors.side1 \x3c 0.0\n          \x26\x26 factors.side2 \x3c 0.0\n          \x26\x26 factors.side3 \x3c 0.0;\n      }\n\n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) !\x3d 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() \x26\x26 sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "],
["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel \x3d pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot \x3d dot(slicePlaneBasis1, rel);\n        float basis2Dot \x3d dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front \x3c 0.0\n          \x26\x26 factors.side0 \x3c 0.0\n          \x26\x26 factors.side1 \x3c 0.0\n          \x26\x26 factors.side2 \x3c 0.0\n          \x26\x26 factors.side3 \x3c 0.0;\n      }\n\n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) !\x3d 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() \x26\x26 sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "]))),
m=c.glsl(b||(b=d.__makeTemplateObject(["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors \x3d calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH \x3d 1.0;\n        const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor \x3d (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "],
["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors \x3d calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH \x3d 1.0;\n        const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor \x3d (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "]))),
m=e.sliceHighlightDisabled?c.glsl(g||(g=d.__makeTemplateObject(["#define highlightSlice(_color_, _pos_) (_color_)"],["#define highlightSlice(_color_, _pos_) (_color_)"]))):c.glsl(p||(p=d.__makeTemplateObject(["\n        ","\n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "],["\n        ","\n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "])),m);e.sliceEnabledForVertexPrograms&&
a.vertex.code.add(h);a.fragment.code.add(h);a.fragment.code.add(m)}else h=c.glsl(t||(t=d.__makeTemplateObject(["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "],["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "]))),e.sliceEnabledForVertexPrograms&&a.vertex.code.add(h),a.fragment.code.add(h)}Object.defineProperty(a,
"__esModule",{value:!0});a.Slice=void 0;a.Slice=h;(function(a){a.bindUniformsWithOrigin=function(b,c,d){a.bindUniforms(b,c,d.slicePlane,d.origin)};a.bindUniforms=function(a,b,c,d){b.slicePlaneEnabled&&(l.isSome(c)?(d?(k.vec3.subtract(m,c.origin,d),a.setUniform3fv("slicePlaneOrigin",m)):a.setUniform3fv("slicePlaneOrigin",c.origin),a.setUniform3fv("slicePlaneBasis1",c.basis1),a.setUniform3fv("slicePlaneBasis2",c.basis2)):(a.setUniform3fv("slicePlaneBasis1",e.vec3f64.ZEROS),a.setUniform3fv("slicePlaneBasis2",
e.vec3f64.ZEROS),a.setUniform3fv("slicePlaneOrigin",e.vec3f64.ZEROS)))}})(h=a.Slice||(a.Slice={}));var m=e.vec3f64.create(),f,b,g,p,t})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define(["require","exports","tslib","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(n,a,d,l,k){function e(a,e){a.include(l.ScreenSizePerspective);a.attributes.add("position","vec3");a.attributes.add("normal","vec3");a.attributes.add("auxpos1","vec4");a.vertex.uniforms.add("proj",
"mat4");a.vertex.uniforms.add("view","mat4");a.vertex.uniforms.add("viewNormal","mat4");a.vertex.uniforms.add("viewport","vec4");a.vertex.uniforms.add("camPos","vec3");a.vertex.uniforms.add("polygonOffset","float");a.vertex.uniforms.add("cameraGroundRelative","float");a.vertex.uniforms.add("pixelRatio","float");a.vertex.uniforms.add("perDistancePixelRatio","float");a.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float");e.verticalOffsetEnabled&&a.vertex.uniforms.add("verticalOffset","vec4");
e.screenSizePerspectiveEnabled&&a.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4");a.vertex.uniforms.add("hudVisibilityTexture","sampler2D");a.vertex.defines.addFloat("SMALL_OFFSET_ANGLE",.984807753012208);a.vertex.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "],["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "]))));
a.vertex.code.add(k.glsl(h||(h=d.__makeTemplateObject(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign \x3d sign(pointGroundDistance);\n\n      if (pointGroundSign \x3d\x3d 0.0) {\n        pointGroundSign \x3d cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative \x3d cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset \x3e .0) {\n        float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor \x3d (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative \x3e 0.0) {\n          posView *\x3d factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /\x3d factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "],
["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign \x3d sign(pointGroundDistance);\n\n      if (pointGroundSign \x3d\x3d 0.0) {\n        pointGroundSign \x3d cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative \x3d cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset \x3e .0) {\n        float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor \x3d (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative \x3e 0.0) {\n          posView *\x3d factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /\x3d factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "]))));
a.vertex.code.add(k.glsl(m||(m=d.__makeTemplateObject(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera \x3d length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset \x3d distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset \x3d normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel +\x3d modelOffset;\n      posView +\x3d viewOffset;\n    }\n  "],
["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera \x3d length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset \x3d distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset \x3d normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel +\x3d modelOffset;\n      posView +\x3d viewOffset;\n    }\n  "]))));
a.vertex.code.add(k.glsl(g||(g=d.__makeTemplateObject(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset \x3d auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance \x3d auxpos1.w;\n\n      aux.posModel \x3d position;\n      aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal \x3d normal;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera \x3d length(aux.posView);\n\n      vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\n      float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle \x3d abs(cosAngle);\n\n      ",
"\n\n      ","\n\n      ","\n\n      float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "],["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset \x3d auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance \x3d auxpos1.w;\n\n      aux.posModel \x3d position;\n      aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal \x3d normal;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera \x3d length(aux.posView);\n\n      vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\n      float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle \x3d abs(cosAngle);\n\n      ",
"\n\n      ","\n\n      ","\n\n      float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),e.screenSizePerspectiveEnabled?e.verticalOffsetEnabled||1===e.screenCenterOffsetUnitsEnabled?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":
"":"",e.verticalOffsetEnabled?e.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":"",e.verticalOffsetEnabled?k.glsl(f||(f=d.__makeTemplateObject(["\n            float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset \x3d aux.vnormal * worldOffset;\n            aux.posModel +\x3d modelOffset;\n            vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView +\x3d viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance +\x3d worldOffset;"],
["\n            float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset \x3d aux.vnormal * worldOffset;\n            aux.posModel +\x3d modelOffset;\n            vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView +\x3d viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance +\x3d worldOffset;"]))):
"",1!==e.screenCenterOffsetUnitsEnabled?k.glsl(b||(b=d.__makeTemplateObject(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z !\x3d 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z !\x3d 0.0) {\n              aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\n            }\n          "],
["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z !\x3d 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z !\x3d 0.0) {\n              aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",
1===e.screenCenterOffsetUnitsEnabled?e.screenSizePerspectiveEnabled?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":"",1===e.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""));a.vertex.code.add(k.glsl(p||(p=d.__makeTemplateObject(["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\n      // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD \x3d 0.75\n        return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\n    }\n  "],
["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\n      // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD \x3d 0.75\n        return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\n    }\n  "]))))}
Object.defineProperty(a,"__esModule",{value:!0});a.HUD=void 0;a.HUD=e;(function(a){(function(a){a[a.OCCLUDED=0]="OCCLUDED";a[a.NOTOCCLUDED=1]="NOTOCCLUDED";a[a.BOTH=2]="BOTH";a[a.COUNT=3]="COUNT"})(a.TransparentRenderStyle||(a.TransparentRenderStyle={}));a.bindUniforms=function(b,c){b.setUniform1f("uRenderTransparentlyOccludedHUD",c.renderTransparentlyOccludedHUD===a.TransparentRenderStyle.OCCLUDED?1:c.renderTransparentlyOccludedHUD===a.TransparentRenderStyle.NOTOCCLUDED?0:.75)};a.bindVisibilityTexture=
function(a,b,c){b.setUniform1i("hudVisibilityTexture",1);a.bindTexture(c.hudVisibilityTexture,1);a.setActiveTexture(0)}})(e=a.HUD||(a.HUD={}));var c,h,m,f,b,g,p})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces","../../../materials/internal/MaterialUtil"],function(n,a,d,l,k){function e(a){a.vertex.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize \x3d 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding\n          nonZeroSize *\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "],
["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize \x3d 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding\n          nonZeroSize *\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "]))));a.vertex.code.add(l.glsl(h||
(h=d.__makeTemplateObject(["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "],["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "]))));a.vertex.code.add(l.glsl(m||(m=d.__makeTemplateObject(["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(\n        min(params.x / (distanceToCamera - params.y), 1.0),\n        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),\n        params.z,\n        params.w\n      );\n    }\n  "],
["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(\n        min(params.x / (distanceToCamera - params.y), 1.0),\n        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),\n        params.z,\n        params.w\n      );\n    }\n  "]))));a.vertex.code.add(l.glsl(f||(f=d.__makeTemplateObject(["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "],
["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "]))));a.vertex.code.add(l.glsl(b||(b=d.__makeTemplateObject(["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(\n        size,\n        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n      );\n    }\n  "],
["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(\n        size,\n        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n      );\n    }\n  "]))));a.vertex.code.add(l.glsl(g||(g=d.__makeTemplateObject(["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "],
["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "]))));a.vertex.code.add(l.glsl(p||(p=d.__makeTemplateObject(["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "],
["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "]))))}Object.defineProperty(a,"__esModule",{value:!0});a.ScreenSizePerspective=void 0;a.ScreenSizePerspective=e;(function(a){a.bindUniforms=function(a,b){b.screenSizePerspective&&(k.bindScreenSizePerspective(b.screenSizePerspective,a,"screenSizePerspective"),
k.bindScreenSizePerspective(b.screenSizePerspectiveAlignment||b.screenSizePerspective,a,"screenSizePerspectiveAlignment"))}})(e=a.ScreenSizePerspective||(a.ScreenSizePerspective={}));var c,h,m,f,b,g,p})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.HUDOcclusion=a.HUDOcclusionPass=void 0;a.HUDOcclusionPass=function(a){a.vertex.code.add(l.glsl(k||
(k=d.__makeTemplateObject(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) \x3e 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position \x3d posProjCenter;\n    gl_PointSize \x3d 1.0;\n  }\n  "],
["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) \x3e 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position \x3d posProjCenter;\n    gl_PointSize \x3d 1.0;\n  }\n  "]))));
a.fragment.uniforms.add("color","vec4");a.fragment.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n  void main() {\n    gl_FragColor \x3d color;\n  }\n  "],["\n  void main() {\n    gl_FragColor \x3d color;\n  }\n  "]))))};(function(a){a.bindUniforms=function(a){a.setUniform4f("color",1,1,1,1)}})(a.HUDOcclusion||(a.HUDOcclusion={}));var k,e})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],
function(n,a,d,l){function k(a){a.fragment.uniforms.add("depthTex","sampler2D");a.fragment.uniforms.add("highlightViewportPixelSz","vec4");a.fragment.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n    void outputHighlight() {\n      vec4 fragCoord \x3d gl_FragCoord;\n\n      float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z \x3e sceneDepth + 5e-7) {\n        gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "],
["\n    void outputHighlight() {\n      vec4 fragCoord \x3d gl_FragCoord;\n\n      float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z \x3e sceneDepth + 5e-7) {\n        gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "]))))}Object.defineProperty(a,"__esModule",{value:!0});a.OutputHighlight=void 0;a.OutputHighlight=k;
(function(a){a.bindOutputHighlight=function(a,c,d){a.bindTexture(d.highlightDepthTexture,5);c.setUniform1i("depthTex",5);c.setUniform4f("highlightViewportPixelSz",0,0,d.inverseViewport[0],d.inverseViewport[1])}})(k=a.OutputHighlight||(a.OutputHighlight={}));var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){function k(a,k){k.vvInstancingEnabled&&(k.vvSize||k.vvColor)&&
a.attributes.add("instanceFeatureAttribute","vec4");k.vvSize?(a.vertex.uniforms.add("vvSizeMinSize","vec3"),a.vertex.uniforms.add("vvSizeMaxSize","vec3"),a.vertex.uniforms.add("vvSizeOffset","vec3"),a.vertex.uniforms.add("vvSizeFactor","vec3"),a.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),a.vertex.uniforms.add("vvSymbolAnchor","vec3"),a.vertex.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "],
["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "])))),a.vertex.code.add(l.glsl(h||(h=d.__makeTemplateObject(["\n      const float eps \x3d 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale \x3d clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ",
"\n    "],["\n      const float eps \x3d 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale \x3d clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "])),k.vvInstancingEnabled?l.glsl(c||(c=d.__makeTemplateObject(["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"],
["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"]))):""))):a.vertex.code.add(l.glsl(m||(m=d.__makeTemplateObject(["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "],["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "]))));
k.vvColor?(a.vertex.defines.addInt("VV_COLOR_N",8),a.vertex.code.add(l.glsl(b||(b=d.__makeTemplateObject(["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value \x3d featureAttribute.y;\n        if (value \x3c\x3d values[0]) {\n          return colors[0];\n        }\n\n        for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n          if (values[i] \x3e\x3d value) {\n            float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ",
"\n    "],["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value \x3d featureAttribute.y;\n        if (value \x3c\x3d values[0]) {\n          return colors[0];\n        }\n\n        for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n          if (values[i] \x3e\x3d value) {\n            float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ",
"\n    "])),k.vvInstancingEnabled?l.glsl(f||(f=d.__makeTemplateObject(["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"],["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"]))):""))):a.vertex.code.add(l.glsl(g||(g=d.__makeTemplateObject(["\n      vec4 vvColor() { return vec4(1.0); }\n    "],["\n      vec4 vvColor() { return vec4(1.0); }\n    "]))))}Object.defineProperty(a,
"__esModule",{value:!0});a.VisualVariables=void 0;a.VisualVariables=k;(function(a){function b(a,b){b.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor));b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors))}a.bindUniforms=b;a.bindUniformsWithOpacity=function(a,c){b(a,c);c.vvOpacityEnabled&&
(a.setUniform1fv("vvOpacityValues",c.vvOpacityValues),a.setUniform1fv("vvOpacityOpacities",c.vvOpacityOpacities))};a.bindUniformsForSymbols=function(a,c){b(a,c);c.vvSizeEnabled&&(a.setUniform3fv("vvSymbolAnchor",c.vvSymbolAnchor),a.setUniformMatrix3fv("vvSymbolRotationMatrix",c.vvSymbolRotationMatrix))}})(k=a.VisualVariables||(a.VisualVariables={}));var e,c,h,m,f,b,g})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],
function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.DiscardOrAdjustAlpha=a.symbolAlphaCutoff=a.defaultMaskAlphaCutoff=void 0;a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;a.DiscardOrAdjustAlpha=function(a,f){var b=a.fragment;switch(f.alphaDiscardMode){case 0:b.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "]))));break;case 1:b.code.add(l.glsl(e||
(e=d.__makeTemplateObject(["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a \x3d 1.0;\n        }\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a \x3d 1.0;\n        }\n      "]))));break;case 2:b.uniforms.add("textureAlphaCutoff","float");b.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } else { color.a \x3d 1.0; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } else { color.a \x3d 1.0; } }\n      "]))));
break;case 3:a.fragment.uniforms.add("textureAlphaCutoff","float"),a.fragment.code.add(l.glsl(h||(h=d.__makeTemplateObject(["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } }\n      "]))))}};var k,e,c,h})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],
function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.RgbaFloatEncoding=void 0;a.RgbaFloatEncoding=function(a){a.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT \x3d\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat \x3d 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS \x3d vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0-\x3e1 back to 0-\x3e255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "],
["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT \x3d\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat \x3d 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS \x3d vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0-\x3e1 back to 0-\x3e255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "]))))};
var k})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/hud/HUDOcclusionPass.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./HUDMaterial.glsl ./HUDMaterial.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z){Object.defineProperty(a,"__esModule",{value:!0});a.HUDMaterialTechniqueConfiguration=a.HUDMaterialTechnique=void 0;p=function(a){function p(){return null!==a&&a.apply(this,arguments)||this}d.__extends(p,a);p.prototype.initializeProgram=function(a){var b=p.shader.get(),c=this.configuration,b=b.build({output:c.output,viewingMode:a.viewingMode,occlusionTestEnabled:c.occlusionTestEnabled,signedDistanceFieldEnabled:c.sdf,slicePlaneEnabled:c.slicePlaneEnabled,
sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:c.debugDrawBorder,binaryHighlightOcclusionEnabled:c.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:c.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:c.screenSizePerspective,verticalOffsetEnabled:c.verticalOffset,vvSize:c.vvSize,vvColor:c.vvColor,vvInstancingEnabled:!1});return new v(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),u.Default3D)};p.prototype.bindPass=function(a,d,g){b.View.bindProjectionMatrix(this.program,
g.camera.projectionMatrix);this.program.setUniform1f("cameraGroundRelative",g.camera.aboveGround?1:-1);this.program.setUniform1f("perDistancePixelRatio",Math.tan(g.camera.fovY/2)/(g.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",g.camera.viewInverseTransposeMatrix);this.program.setUniform1f("polygonOffset",d.shaderPolygonOffset);k.VerticalOffset.bindUniforms(this.program,d,g);f.ScreenSizePerspective.bindUniforms(this.program,d);this.program.setUniform1f("pixelRatio",g.camera.pixelRatio||
1);b.View.bindViewport(this.program,g);6===this.configuration.output?c.HUDOcclusion.bindUniforms(this.program):(e.HUD.bindUniforms(this.program,g),q.HUDMaterial.bindUniforms(this.program,d,g.camera.pixelRatio||1),m.VisualVariables.bindUniforms(this.program,d),this.configuration.occlusionTestEnabled&&e.HUD.bindVisibilityTexture(a,this.program,g));4===this.configuration.output&&h.OutputHighlight.bindOutputHighlight(a,this.program,g)};p.prototype.bindDraw=function(a){b.View.bindView(this.program,a);
b.View.bindCamPosition(this.program,a.origin,a.camera.viewInverseTransposeMatrix);l.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};p.prototype.initializePipeline=function(){return 4===this.configuration.output?z.makePipelineState({blending:w.separateBlendingParams(1,1,771,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},colorWrite:z.defaultColorWriteParams}):6===this.configuration.output?z.makePipelineState({depthTest:{func:515},
depthWrite:z.defaultDepthWriteParams,colorWrite:z.defaultColorWriteParams}):z.makePipelineState({blending:w.simpleBlendingParams(1,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:this.configuration.depthEnabled?515:519},depthWrite:this.configuration.depthEnabled?z.defaultDepthWriteParams:void 0,colorWrite:z.defaultColorWriteParams})};Object.defineProperty(p.prototype,"primitiveType",{get:function(){return 6===this.configuration.output?0:4},enumerable:!1,
configurable:!0});p.shader=new g.ReloadableShaderModule(r,function(){return new Promise(function(a,b){n(["./HUDMaterial.glsl"],a,b)})});return p}(p.ShaderTechnique);a.HUDMaterialTechnique=p;p=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.occlusionTestEnabled=!0;b.sdf=!1;b.vvSize=!1;b.vvColor=!1;b.verticalOffset=!1;b.screenSizePerspective=!1;b.screenCenterOffsetUnitsEnabled=0;b.debugDrawBorder=!0;b.binaryHighlightOcclusion=!0;b.slicePlaneEnabled=!1;b.polygonOffsetEnabled=
!1;b.depthEnabled=!0;return b}d.__extends(b,a);d.__decorate([t.parameter({count:7})],b.prototype,"output",void 0);d.__decorate([t.parameter()],b.prototype,"occlusionTestEnabled",void 0);d.__decorate([t.parameter()],b.prototype,"sdf",void 0);d.__decorate([t.parameter()],b.prototype,"vvSize",void 0);d.__decorate([t.parameter()],b.prototype,"vvColor",void 0);d.__decorate([t.parameter()],b.prototype,"verticalOffset",void 0);d.__decorate([t.parameter()],b.prototype,"screenSizePerspective",void 0);d.__decorate([t.parameter({count:2})],
b.prototype,"screenCenterOffsetUnitsEnabled",void 0);d.__decorate([t.parameter()],b.prototype,"debugDrawBorder",void 0);d.__decorate([t.parameter()],b.prototype,"binaryHighlightOcclusion",void 0);d.__decorate([t.parameter()],b.prototype,"slicePlaneEnabled",void 0);d.__decorate([t.parameter()],b.prototype,"polygonOffsetEnabled",void 0);d.__decorate([t.parameter()],b.prototype,"depthEnabled",void 0);return b}(t.ShaderTechniqueConfiguration);a.HUDMaterialTechniqueConfiguration=p})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define(["require",
"exports","tslib","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(n,a,d,l,k){function e(a,c){var e=a.vertex.code;c.verticalOffsetEnabled?(a.vertex.uniforms.add("verticalOffset","vec4"),c.screenSizePerspectiveEnabled&&(a.include(l.ScreenSizePerspective),a.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),e.add(k.glsl(p||(p=d.__makeTemplateObject(["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\n      ",
"\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "],["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\n      ",
"\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "])),1===c.viewingMode?k.glsl(m||(m=d.__makeTemplateObject(["vec3 worldNormal \x3d normalize(worldPos + localOrigin);"],
["vec3 worldNormal \x3d normalize(worldPos + localOrigin);"]))):k.glsl(f||(f=d.__makeTemplateObject(["vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);"],["vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);"]))),c.screenSizePerspectiveEnabled?k.glsl(b||(b=d.__makeTemplateObject(["\n          float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"],
["\n          float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"]))):k.glsl(g||(g=d.__makeTemplateObject(["\n          float verticalOffsetScreenHeight \x3d verticalOffset.x;"],["\n          float verticalOffsetScreenHeight \x3d verticalOffset.x;"])))))):e.add(k.glsl(t||(t=d.__makeTemplateObject(["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "],
["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "]))))}function c(a,b,c,d){void 0===d&&(d=h);d.screenLength=a.screenLength;d.perDistance=Math.tan(.5*b)/(.5*c);d.minWorldLength=a.minWorldLength;d.maxWorldLength=a.maxWorldLength;return d}Object.defineProperty(a,"__esModule",{value:!0});a.calculateVerticalOffsetFactors=a.VerticalOffset=void 0;a.VerticalOffset=e;(function(a){a.bindUniforms=function(a,b,d){b.verticalOffset&&(b=c(b.verticalOffset,d.camera.fovY,
d.camera.fullViewport[3]),a.setUniform4f("verticalOffset",b.screenLength*(d.camera.pixelRatio||1),b.perDistance,b.minWorldLength,b.maxWorldLength))}})(e=a.VerticalOffset||(a.VerticalOffset={}));a.calculateVerticalOffsetFactors=c;var h={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0},m,f,b,g,p,t})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define(["require","exports","tslib","../../../../core/accessorSupport/decorators","./Deconflictor"],function(n,a,d,l,k){Object.defineProperty(a,
"__esModule",{value:!0});a.LabelDeconflictor=void 0;n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.visibilityGroup=1;c.iconMarginFactor=0;c._lastDeconfliction=0;return c}d.__extends(c,a);Object.defineProperty(c.prototype,"viewState",{get:function(){return this.parent.viewState},enumerable:!1,configurable:!0});c.prototype.update=function(c){if(!this.parent.needsUpdate()){var d=performance.now();if(2===c.state||2E3<d-this._lastDeconfliction)a.prototype.update.call(this,c),
0===this.state&&(this._lastDeconfliction=d)}};c.prototype.enabledChanged=function(a,c){this.modifyGraphics(c,a.labelsEnabled)};c.prototype.getGraphicsLayers=function(a){return a.labelGraphics};d.__decorate([l.property({constructOnly:!0})],c.prototype,"parent",void 0);return c=d.__decorate([l.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],c)}(k.Deconflictor);a.LabelDeconflictor=n})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../layers/support/layerUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./graphicSymbolUtils ./labelPlacement ../../support/debugFlags ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../../support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E){Object.defineProperty(a,"__esModule",{value:!0});a.Labeler=void 0;var G=c.getLogger("esri.views.3d.layers.graphics.Labeler");n=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.idHint="__labeler";b._dirty=!1;b.labels=new Map;b.labelsToAdd=new Map;b.labelsToRemove=new Map;b.labelingContexts=[];return b}d.__extends(c,a);c.prototype.setup=function(){var a=this;this.handles||(this.handles=new e,this.handles.add([this.view.watch("state.camera",
function(){return a.setDirty()}),this.view.watch("pixelRatio",function(){return a.resetAllLabels()})]));this.textTextureAtlas||(this.textTextureAtlas=new C.default({idHint:this.idHint+"_atlas",view:this.view}),this.hudMaterialCollection=new x(this.view._stage),this.calloutMaterialCollection=new x(this.view._stage));this.handles.add(this.view.resourceController.scheduler.registerTask(E.Task.LABELER,function(b){return a.update(b)},function(){return a.needsUpdate()}))};c.prototype.dispose=function(){this.handles&&
(this.handles.destroy(),this.handles=null);this.textTextureAtlas&&(this.textTextureAtlas.dispose(),this.textTextureAtlas=null);this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null);this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelingContexts=[];this.labels.clear();this.labelsToAdd.clear();this.labelsToRemove.clear()};c.prototype.isActiveLabelingContext=function(a){return a.active&&
t.areLabelsVisible(a.layer)};c.prototype.activateLabelingContext=function(a){var b=this;a.labels.forEach(function(a,c){b.labels.set(c,a);a.graphics3DGraphic.setVisibilityFlag(0,!0,1)});a.active=!0};c.prototype.deactivateLabelingContext=function(a){var b=this;a.labels.forEach(function(a,c){a.graphics3DGraphic.setVisibilityFlag(0,!1,1);b.setLabelGraphicVisibility(a.graphics3DGraphic,!1);b.labels.delete(c)});a.active=!1};c.prototype.addLabelTextureToAtlas=function(a){for(var b=0,c=a.graphics3DGraphic.labelGraphics;b<
c.length;b++){var d=c[b];if(d._labelClass){var e=a.textRenderers[d._labelIndex];e&&this.textTextureAtlas.addTextTexture(e,d.stageObject)}}a.rendered=!0};c.prototype.removeLabelTextureFromAtlas=function(a){for(var b=0,c=a.graphics3DGraphic.labelGraphics;b<c.length;b++){var d=c[b];if(d._labelClass){var e=a.textRenderers[d._labelIndex];e&&this.textTextureAtlas.removeTextTexture(e,d.stageObject)}}a.rendered=!1};c.prototype.needsUpdate=function(){return this.view.ready&&this.isDirty};c.prototype.update=
function(a){this._updateLabels(a);!this._dirty&&this.deconflictor.needsUpdate()&&this.deconflictor.update(a)};c.prototype._updateLabels=function(a){var b=this;if(this._dirty){this._dirty=!1;for(var c=function(c){if(!d.isActiveLabelingContext(c))return"continue";if(!d.hasValidLabelClassContext(c)){if(d.hasInvalidLabelClassContext(c))return d.deactivateLabelingContext(c),"continue";d.createLabelClassContext(c);if(d.hasPendingLabelClassContext(c))return d._dirty=!0,"continue";if(!d.hasValidLabelClassContext(c))return"continue"}h.someMap(c.labelsToInitialize,
function(d,e){b.ensureGraphics3DResources(d)&&(b.labels.set(e,d),b.deconflictor.setDirty(),a.madeProgress());if(d.visible&&d.hasTextTextureResources||!d.visible&&d.hasGraphics3DResources)c.labelsToInitialize.delete(e),a.madeProgress();return a.done})&&(d._dirty=!0)},d=this,e=0,f=this.labelingContexts;e<f.length;e++)c(f[e]);this.labelsToRemove.forEach(function(a){return b.removeLabelTextureFromAtlas(a)});this.labelsToRemove.clear();this.labelsToAdd.forEach(function(a){return b.addLabelTextureToAtlas(a)});
this.labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};c.prototype.hasPendingLabelClassContext=function(a){return a.labelClassPromise&&!!a.labelClassAbortController};c.prototype.hasValidLabelClassContext=function(a){return a.labelClassContexts&&a.labelClassContexts.length};c.prototype.hasInvalidLabelClassContext=function(a){return null===a.labelClassContexts};c.prototype.createLabelClassContextAsync=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e,g,h,l,t=this;
return d.__generator(this,function(v){switch(v.label){case 0:return b=a.labelClassAbortController.signal,[4,a.layer.when()];case 1:v.sent();f.throwIfAborted(b);a.scaleVisibility&&a.scaleVisibility.updateScaleRangeActive();c=a.graphics3DCore;e=c.layer;g=e.labelingInfo&&e.labelingInfo.filter(function(a){return!!a.symbol});if(!g||0===g.length)return[2];h=Array(g.length);l=!1;return[4,k.forEach(g,function(e,g){return d.__awaiter(t,void 0,void 0,function(){var t,v,w,x;return d.__generator(this,function(d){switch(d.label){case 0:return t=
e.symbol,v=q.getGraphics3DSymbol(c.getOrCreateGraphics3DSymbol(t)),m.isNone(v)?(G.error("Failed to create Graphics3DSymbol for label"),[2]):[4,v.load()];case 1:d.sent();f.throwIfAborted(b);w=null;if(!u.isCalloutSupport(t)||!t.hasVisibleCallout())return[3,3];w=r.make(t,c.symbolCreationContext);return[4,w.load()];case 2:d.sent(),f.throwIfAborted(b),d.label=3;case 3:return[4,k.result(p.createLabelFunction(e,a.layer.fields.map(function(a){return a.toJSON()}),this.view.spatialReference))];case 4:return x=
d.sent(),f.throwIfAborted(b),!0===x.ok?h[g]={labelClass:e,labelFunction:x.value,graphics3DSymbol:v,graphics3DCalloutSymbolLayer:w,calloutSymbolLayerIndex:0,textRenderParameters:this.createTextRenderParameters(v.symbol)}:(G.error("Label expression failed to evaluate: "+x.error),l=!0),[2]}})})})];case 2:v.sent();f.throwIfAborted(b);if(l)return[2];a.labelClassContexts=h;return[2]}})})};c.prototype.createLabelClassContext=function(a){return d.__awaiter(this,void 0,void 0,function(){var b=this;return d.__generator(this,
function(c){a.labelClassPromise||(a.labelClassPromise=this.createLabelClassContextAsync(a).catch(function(b){if(f.isAbortError(b))throw b;a.labelClassContexts=null}).then(function(){a.labelClassAbortController=null;b.notifyChange("updating")}).catch(function(){}),this.notifyChange("updating"));return[2,a.labelClassPromise]})})};c.prototype.createTextRenderParameters=function(a){return(a=a.symbolLayers.getItemAt(0))&&"text"===a.type?A.default.fromSymbol(a,this.view.pixelRatio):null};c.prototype.destroyLabelClassContext=
function(a){for(var b=0,c=a.labelClassContexts;b<c.length;b++){var d=c[b];--d.graphics3DSymbol.referenced;d.graphics3DSymbol=null}b=a.labelClassAbortController;a.labelClassAbortController=f.createAbortController();b&&b.abort();a.labelClassContexts=[];a.labelClassPromise=null;this.notifyChange("updating")};c.prototype.createTextSymbolGraphic=function(a,b,c,d,e){a={text:a.text,centerOffset:c.centerOffset,translation:c.translation,elevationOffset:c.elevationOffset,screenOffset:c.screenOffset,anchor:c.anchor,
centerOffsetUnits:c.centerOffsetUnits,verticalOffset:c.verticalOffset,debugDrawBorder:w.LABELS_SHOW_BORDER,displayWidth:a.displayWidth,displayHeight:a.displayHeight};F.graphic=b;F.renderingInfo=null;F.layer=d;return e.createLabel(F,a,this.hudMaterialCollection,this.textTextureAtlas)};c.prototype.createLineCalloutGraphic=function(a,b,c,d,e){b={symbol:b,translation:d.translation,elevationOffset:d.elevationOffset,screenOffset:d.screenOffset,centerOffset:d.centerOffset,centerOffsetUnits:d.centerOffsetUnits,
materialCollection:this.calloutMaterialCollection};F.graphic=a;F.renderingInfo=b;F.layer=e;return c.createGraphics3DGraphic(F)};c.prototype.ensureGraphics3DResources=function(a){if(a.hasGraphics3DResources)return!1;var b=a.graphics3DGraphic;if(b.destroyed)return!1;this.ensureTextTextureResources(a);var c=a.labelingContext,d=c.labelClassContexts;if(!d||0===d.length||!c.emptySymbolLabelSupported&&0===b._graphics.length)return!1;for(var e=!1,f=b.graphic,g=c.layer,h=t.areLabelsVisible(c.layer),k=this.view._stage,
p=0;p<d.length;p++){var l=a.textRenderers[p];if(l){var r=d[p],q=r.graphics3DSymbol,w=null;q.symbol&&"label-3d"===q.symbol.type&&(w=q.symbol);var u=q.symbolLayers[0];if(u){var x=r.labelClass,q=v.get({graphics3DGraphic:b,labelSymbol:w,labelClass:x,disablePlacement:c.disablePlacement});if(!m.isNone(q)){u.setElevationInfoOverride(c.elevationInfoOverride);e=this.createTextSymbolGraphic(l,f,q,g,u);if(!e)return!1;e._labelClass=x;e._labelIndex=p;b.addLabelGraphic(e,k,c.stageLayer);b.setVisibilityFlag(0,h,
1);b.clearVisibilityFlag(1,1);b.setVisibilityFlag(3,!1,1);e=!0;(h=r.graphics3DCalloutSymbolLayer)&&q.hasLabelVerticalOffset&&(h.setElevationInfoOverride(c.elevationInfoOverride),f=this.createLineCalloutGraphic(f,w,h,q,g))&&(r.calloutSymbolLayerIndex=b.labelGraphics.length,b.addLabelGraphic(f,k,c.stageLayer));break}}}}c.scaleVisibility&&e&&c.scaleVisibility.updateGraphicLabelScaleVisibility(b);return a.hasGraphics3DResources=!0};c.prototype.destroyGraphics3DResources=function(a){for(var b=a.labelingContext.labelClassContexts,
c=0,d=a.graphics3DGraphic.labelGraphics;c<d.length;c++){var e=d[c];if(null!=e._labelClass){var f=b[e._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=f)f.onRemoveGraphic(e)}}a.graphics3DGraphic.clearLabelGraphics();a.hasGraphics3DResources=!1};c.prototype.ensureTextTextureResources=function(a){if(!a.hasTextTextureResources){var b=a.labelingContext,c=b.labelClassContexts;if(c&&0!==c.length){for(var d=a.graphics3DGraphic.graphic,e=0;e<c.length;e++){var f=c[e];a.textRenderers[e]=null;if(f.textRenderParameters){var h=
f.labelFunction,k=void 0;if("arcade"===h.type)try{var p=h.needsHydrationToEvaluate()?g.hydrateGraphic(d,b.layer):d,k=h.evaluate(p)}catch(P){k=null}else k=h.evaluate(d);m.isNone(k)||""===k||/^\s+$/.test(k)||(a.textRenderers[e]=new B.default(k,f.textRenderParameters))}}a.hasTextTextureResources=!0}}};c.prototype.destroyTextTextureResources=function(a){a.textRenderers=[];a.hasTextTextureResources=!1};c.prototype.addGraphic=function(a,b){var c={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,
rendered:!1,labelingContext:a,graphics3DGraphic:b,textRenderers:[]};b=b.graphic.uid;a.labels.set(b,c);a.labelsToInitialize.set(b,c);this.setDirty();this.deconflictor.setDirty()};c.prototype.removeGraphic=function(a,b){b=b.graphic.uid;var c=a.labels.get(b);c&&(this.destroyGraphic(c,b),a.labels.delete(b),a.labelsToInitialize.delete(b),this.setDirty(),this.deconflictor.setDirty())};c.prototype.destroyGraphic=function(a,b){this.labels.has(b)&&(this.labels.delete(b),this.labelsToAdd.delete(b),this.labelsToRemove.delete(b));
a.hasTextTextureResources&&(this.removeLabelTextureFromAtlas(a),this.destroyTextTextureResources(a));a.hasGraphics3DResources&&this.destroyGraphics3DResources(a)};c.prototype.labelingInfoChange=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g;return d.__generator(this,function(d){if(b){c=0;for(e=b;c<e.length;c++)if(f=e[c],g=a.labels.get(f))this.removeGraphic(a,g.graphics3DGraphic),this.addGraphic(a,g.graphics3DGraphic);return[2]}this.visibilityInfoChange(a);this.resetLabels(a);
return[2,this.createLabelClassContext(a)]})})};c.prototype.globalPropertyChanged=function(a,b){for(var c=function(c){var d=new Map;b.labels.forEach(function(a){a=a.graphics3DGraphic;d.set(a.graphic.uid,a)});m.unwrap(c.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(a,d,function(a){return a.labelGraphics[0]});c.graphics3DCalloutSymbolLayer&&c.graphics3DCalloutSymbolLayer.globalPropertyChanged(a,d,function(a){return a.labelGraphics[c.calloutSymbolLayerIndex]})},d=0,e=b.labelClassContexts;d<
e.length;d++)c(e[d])};c.prototype.visibilityInfoChange=function(a){var b=a.layer.labelsVisible;b&&!a.active&&this.activateLabelingContext(a);!b&&a.active&&this.deactivateLabelingContext(a);this.setDirty()};c.prototype.resetAllLabels=function(){for(var a=0,b=this.labelingContexts;a<b.length;a++)this.resetLabels(b[a])};c.prototype.resetLabels=function(a){var b=this;a.labels.forEach(function(c,d){b.destroyGraphic(c,d);c.visible=!1;c.rendered=!1;a.labelsToInitialize.set(d,c)});this.destroyLabelClassContext(a);
this.setDirty();this.deconflictor.setDirty()};c.prototype.findLabelingContext=function(a){for(var b=0,c=this.labelingContexts;b<c.length;b++){var d=c[b];if(d.graphics3DCore===a)return d}return null};c.prototype.addGraphicsOwner=function(a,b,c){var d=this,e=c&&c.emptySymbolLabelSupported||!1,g=c&&c.elevationInfoOverride||null;c=c&&c.disablePlacement||null;if(!this.findLabelingContext(a)){var h=a.layer,m={graphics3DCore:a,layer:h,scaleVisibility:b,emptySymbolLabelSupported:e,elevationInfoOverride:g,
disablePlacement:c,active:h.labelsVisible,labelClassPromise:null,labelClassAbortController:f.createAbortController(),labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new z(this.idHint+"_"+h.uid,{isPickable:!0},h.uid)};this.view._stage.add(0,m.stageLayer);this.view._stage.addToViewContent([m.stageLayer.id]);this.labelingContexts.push(m);this.setDirty();return{addGraphic:function(a){return d.addGraphic(m,a)},removeGraphic:function(a){return d.removeGraphic(m,a)},featureReductionChange:function(){},
layerLabelsEnabled:function(){return t.areLabelsVisible(m.layer)},labelingInfoChange:function(a){return d.labelingInfoChange(m,a)},elevationInfoChange:function(){return d.globalPropertyChanged("elevationInfo",m)},slicePlaneEnabledChange:function(){return d.globalPropertyChanged("slicePlaneEnabled",m)},visibilityInfoChange:function(){return d.visibilityInfoChange(m)},reset:function(){return d.resetLabels(m)},clear:function(){},processStageDirty:function(){return d.view._stage.processDirtyLayer(m.stageLayer.id)}}}};
c.prototype.removeGraphicsOwner=function(a){var b=this,c=this.findLabelingContext(a);c&&(a=this.labelingContexts.indexOf(c),this.labelingContexts.splice(a,1),c.labels.forEach(function(a){return b.removeGraphic(c,a.graphics3DGraphic)}),a=c.stageLayer.id,this.view._stage.removeFromViewContent([a]),this.view._stage.remove(0,a),c.stageLayer=null,this.setDirty())};c.prototype.setLabelGraphicVisibility=function(a,b){a=a.graphic.uid;var c=this.labels.get(a);c&&c.visible!==b&&(b&&!c.rendered?(this.labelsToAdd.set(a,
c),this.labelsToRemove.delete(a),c.hasTextTextureResources||c.labelingContext.labelsToInitialize.set(a,c)):!b&&c.rendered&&(this.labelsToRemove.set(a,c),this.labelsToAdd.delete(a)),c.visible=b,this.setDirty())};Object.defineProperty(c.prototype,"isDirty",{get:function(){return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.isDirty||this.deconflictor.needsUpdate()},enumerable:!1,configurable:!0});c.prototype.setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};
Object.defineProperty(c.prototype,"updating",{get:function(){var a=this;return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.updating||this.deconflictor.updating||this.labelingContexts.some(function(b){return a.hasPendingLabelClassContext(b)})},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"updatingProgress",{get:function(){var a=this;if(!this.updating||!this.textTextureAtlas)return 1;var b=0<this.labelingContexts.length?this.labelingContexts.reduce(function(b,c){return b+
(a.hasPendingLabelClassContext(c)?0:1)},0)/this.labelingContexts.length:1;return(this._dirty?0:.3)+(this.textTextureAtlas.updating?0:.1)+.1*b+.5*this.deconflictor.updatingProgress},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"test",{get:function(){var a=this;return{textTextureAtlas:this.textTextureAtlas,resetAllLabels:function(){return a.resetAllLabels()}}},enumerable:!1,configurable:!0});d.__decorate([b.property({constructOnly:!0})],c.prototype,"view",void 0);d.__decorate([b.property({constructOnly:!0})],
c.prototype,"deconflictor",void 0);d.__decorate([b.property()],c.prototype,"textTextureAtlas",void 0);d.__decorate([b.property({type:Boolean,readOnly:!0,dependsOn:["textTextureAtlas.updating","deconflictor.updating"]})],c.prototype,"updating",null);return c=d.__decorate([b.subclass("esri.views.3d.layers.graphics.Labeler")],c)}(l);a.Labeler=n;var F={graphic:null,renderingInfo:null,layer:null}})},"esri/layers/graphics/hydratedFeatures":function(){define("require exports ../../Graphic ../../core/compilerUtils ../../core/lang ../../core/maybe ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedFeatures".split(" "),
function(n,a,d,l,k,e,c,h,m){function f(a){return"declaredClass"in a}function b(a){return"declaredClass"in a}function g(a){return"declaredClass"in a}function p(a){return e.isNone(a)?null:f(a)?a:h.fromJSON(t(a))}function t(a){var b=a.spatialReference.toJSON();switch(a.type){case "point":return{x:a.x,y:a.y,z:a.z,m:a.m,spatialReference:b};case "polygon":var c=a.hasZ,d=a.hasM;return{rings:u(a.rings),hasZ:c,hasM:d,spatialReference:b};case "polyline":var e=a.paths,c=a.hasZ,d=a.hasM;return{paths:u(e),hasZ:c,
hasM:d,spatialReference:b};case "extent":var e=a.xmin,f=a.xmax,g=a.ymin,h=a.ymax,m=a.zmin,k=a.zmax,p=a.mmin,t=a.mmax,c=a.hasZ,d=a.hasM;return{xmin:e,xmax:f,ymin:g,ymax:h,zmin:m,zmax:k,mmin:p,mmax:t,hasZ:c,hasM:d,spatialReference:b};case "multipoint":return e=a.points,c=a.hasZ,d=a.hasM,{points:v(e)?r(e):e,hasZ:c,hasM:d,spatialReference:b};default:l.neverReached(a)}}function u(a){return q(a)?a.map(function(a){return r(a)}):a}function r(a){return a.map(function(a){return c.toArray(a)})}function q(a){for(var b=
0;b<a.length;b++){var c=a[b];if(0!==c.length)return v(c)}return!1}function v(a){return a.length&&(c.isFloat32Array(a[0])||c.isFloat64Array(a[0]))}Object.defineProperty(a,"__esModule",{value:!0});a.clonePoint=a.hydrateGeometry=a.hydrateGraphic=a.isHydratedGraphic=a.isHydratedPoint=a.isHydratedGeometry=void 0;a.isHydratedGeometry=f;a.isHydratedPoint=b;a.isHydratedGraphic=g;a.hydrateGraphic=function(a,b){if(!a)return null;if(g(a))return a;b=new d({layer:b,sourceLayer:b});b.visible=a.visible;b.symbol=
k.clone(a.symbol);b.attributes=k.clone(a.attributes);b.geometry=p(a.geometry);return b};a.hydrateGeometry=p;a.clonePoint=function(a,c){if(!a)return null;if(b(a)){if(null==c)return a.clone();if(b(c))return c.copy(a)}null!=c?(c.x=a.x,c.y=a.y,c.spatialReference=a.spatialReference,a.hasZ?(c.z=a.z,c.hasZ=a.hasZ):(c.z=null,c.hasZ=!1),a.hasM?(c.m=a.m,c.hasM=!0):(c.m=null,c.hasM=!1)):(c=m.makeDehydratedPoint(a.x,a.y,a.z,a.spatialReference),a.hasM&&(c.m=a.m,c.hasM=!0));return c}})},"esri/layers/graphics/dehydratedFeatures":function(){define("require exports ../../core/compilerUtils ../../core/has ../../core/maybe ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){function u(a,b,c){if(!a)return null;switch(b){case "point":return a={x:a.x,y:a.y,z:a.z,m:a.m,hasZ:null!=a.z,hasM:null!=a.m,type:"point",spatialReference:c};case "polyline":return a={paths:a.paths,hasZ:!!a.hasZ,hasM:!!a.hasM,type:"polyline",spatialReference:c};case "polygon":return a={rings:a.rings,hasZ:!!a.hasZ,hasM:!!a.hasM,type:"polygon",spatialReference:c};case "multipoint":return a={points:a.points,hasZ:!!a.hasZ,hasM:!!a.hasM,type:"multipoint",spatialReference:c}}}
function r(a){if(!a)return 0;var b=32,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];switch(typeof d){case "string":b+=z(d);break;default:case "number":b+=16}}return b}function q(a){if(k.isNone(a))return 0;var b=32;switch(a.type){case "point":b+=42;break;case "polyline":case "polygon":var c=0,f=2+(a.hasZ?1:0)+(a.hasM?1:0);a="polyline"===a.type?a.paths:a.rings;for(var g=0;g<a.length;g++)c+=a[g].length;b=b+(8*c*f+64)+128*c+34;b+=32*(a.length+1);break;case "multipoint":f=2+(a.hasZ?1:0)+(a.hasM?1:0);
c=a.points.length;b+=8*c*f+64;b+=128*c;b+=34;b+=32;break;case "extent":b+=98;a.hasM&&(b+=32);a.hasZ&&(b+=32);break;case "mesh":b+=e.estimateSize(a.vertexAttributes.position);b+=e.estimateSize(a.vertexAttributes.normal);b+=e.estimateSize(a.vertexAttributes.uv);b+=e.estimateSize(a.vertexAttributes.tangent);break;default:d.neverReached(a)}return b}function v(a,b){m.empty(b);"mesh"===a.type&&(a=a.extent);switch(a.type){case "point":b[0]=b[3]=a.x;b[1]=b[4]=a.y;a.hasZ&&(b[2]=b[5]=a.z);break;case "polyline":for(var c=
0;c<a.paths.length;c++)m.expandWithNestedArray(b,a.paths[c],a.hasZ);break;case "polygon":for(c=0;c<a.rings.length;c++)m.expandWithNestedArray(b,a.rings[c],a.hasZ);break;case "multipoint":m.expandWithNestedArray(b,a.points,a.hasZ);break;case "extent":b[0]=a.xmin;b[1]=a.ymin;b[3]=a.xmax;b[4]=a.ymax;null!=a.zmin&&(b[2]=a.zmin);null!=a.zmax&&(b[5]=a.zmax);break;default:d.neverReached(a)}}function w(a,b){f.empty(b);"mesh"===a.type&&(a=a.extent);switch(a.type){case "point":b[0]=b[2]=a.x;b[1]=b[3]=a.y;break;
case "polyline":for(var c=0;c<a.paths.length;c++)f.expandWithNestedArray(b,a.paths[c]);break;case "polygon":for(c=0;c<a.rings.length;c++)f.expandWithNestedArray(b,a.rings[c]);break;case "multipoint":f.expandWithNestedArray(b,a.points);break;case "extent":b[0]=a.xmin;b[1]=a.ymin;b[2]=a.xmax;b[3]=a.ymax;break;default:d.neverReached(a)}}Object.defineProperty(a,"__esModule",{value:!0});a.getObjectId=a.expandAABR=a.computeAABR=a.expandAABB=a.computeAABB=a.hasVertices=a.numVertices=a.estimateSize=a.estimateGeometryObjectSize=
a.estimateAttributesObjectSize=a.makeDehydratedPoint=a.fromJSONGeometry=a.fromFeatureSetJSON=a.isDehydratedPoint=a.DehydratedFeatureSetClass=a.isFeatureGeometry=a.hasGeometry=a.DehydratedFeatureClass=void 0;Object.defineProperty(a,"equals",{enumerable:!0,get:function(){return t.equals}});n=function(){return function(a,b,c){this.uid=a;this.geometry=b;this.attributes=c;this.visible=!0;this.centroid=this.objectId=null}}();a.DehydratedFeatureClass=n;a.hasGeometry=function(a){return k.isSome(a.geometry)};
a.isFeatureGeometry=function(a){return g.isFeatureGeometryType(a.type)};n=function(){return function(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null}}();a.DehydratedFeatureSetClass=n;a.isDehydratedPoint=function(a){return"point"===a.type};a.fromFeatureSetJSON=function(a){var e=g.featureGeometryTypeKebabDictionary.fromJSON(a.geometryType),
f=h.fromJSON(a.spatialReference),m=a.transform,k=a.features.map(function(g){var h=a.objectIdFieldName;g={uid:c.generateUID(),objectId:h&&g.attributes?g.attributes[h]:null,attributes:g.attributes,geometry:u(g.geometry,e,f),visible:!0};if((h=g.geometry)&&m)switch(h.type){case "point":g.geometry=b.unquantizePoint(m,h,h,h.hasZ,h.hasM);break;case "multipoint":g.geometry=b.unquantizeMultipoint(m,h,h,h.hasZ,h.hasM);break;case "polygon":g.geometry=b.unquantizePolygon(m,h,h,h.hasZ,h.hasM);break;case "polyline":g.geometry=
b.unquantizePolyline(m,h,h,h.hasZ,h.hasM);break;default:d.neverReached(h)}return g});return{geometryType:e,features:k,spatialReference:f,fields:a.fields?a.fields.map(function(a){return p.fromJSON(a)}):null,objectIdFieldName:a.objectIdFieldName,globalIdFieldName:a.globalIdFieldName,geohashFieldName:a.geohashFieldName,geometryProperties:a.geometryProperties,hasZ:a.hasZ,hasM:a.hasM,exceededTransferLimit:a.exceededTransferLimit,transform:null}};a.fromJSONGeometry=u;a.makeDehydratedPoint=function(a,b,
c,d){return{x:a,y:b,z:c,hasZ:null!=c,hasM:!1,spatialReference:d,type:"point"}};var z=l("esri-text-decoder")?function(a){return 32+a.length}:function(a){return 32*a.length};a.estimateAttributesObjectSize=r;a.estimateGeometryObjectSize=q;a.estimateSize=function(a){var b;b=32+r(a.attributes);return b=b+3+(8+q(a.geometry))};a.numVertices=function(a){if(k.isNone(a))return 0;switch(a.type){case "point":return 1;case "polyline":var b=0,c=0;for(a=a.paths;c<a.length;c++)b+=a[c].length;return b;case "polygon":c=
b=0;for(a=a.rings;c<a.length;c++)b+=a[c].length;return b;case "multipoint":return a.points.length;case "extent":return 2;case "mesh":return(b=a.vertexAttributes&&a.vertexAttributes.position)?b.length/3:0;default:d.neverReached(a)}};a.hasVertices=function(a){if(!a)return!1;switch(a.type){case "extent":case "point":return!0;case "polyline":var b=0;for(a=a.paths;b<a.length;b++)if(0<a[b].length)return!0;return!1;case "polygon":b=0;for(a=a.rings;b<a.length;b++)if(0<a[b].length)return!0;return!1;case "multipoint":return 0<
a.points.length;case "mesh":return a.vertexAttributes&&a.vertexAttributes.position&&0<a.vertexAttributes.position.length;default:d.neverReached(a)}};a.computeAABB=v;a.expandAABB=function(a,b){v(a,x);m.expand(b,x)};a.computeAABR=w;a.expandAABR=function(a,b){w(a,B);f.expand(b,B)};a.getObjectId=function(a,b){return null!=a.objectId?a.objectId:a.attributes&&b?a.attributes[b]:null};var x=m.create(),B=f.create()})},"esri/geometry/support/quantizationUtils":function(){define(["require","exports","./jsonUtils"],
function(n,a,d){function l(a,b){return Math.round((b-a.translate[0])/a.scale[0])}function k(a,b){return Math.round((a.translate[1]-b)/a.scale[1])}function e(a,b,c){for(var d=[],e,f,g,h,m=0;m<c.length;m++){var p=c[m];if(0<m){if(g=l(a,p[0]),h=k(a,p[1]),g!==e||h!==f)d.push(b(p,g-e,h-f)),e=g,f=h}else e=l(a,p[0]),f=k(a,p[1]),d.push(b(p,e,f))}return 0<d.length?d:null}function c(a,b,c,d){return e(a,c?d?G:E:d?E:C,b)}function h(a,b,c,d){var f=[];c=c?d?G:E:d?E:C;for(d=0;d<b.length;d++){var g=e(a,c,b[d]);g&&
3<=g.length&&f.push(g)}return f.length?f:null}function m(a,b,c,d){var f=[];c=c?d?G:E:d?E:C;for(d=0;d<b.length;d++){var g=e(a,c,b[d]);g&&2<=g.length&&f.push(g)}return f.length?f:null}function f(a,b){return b*a.scale[0]+a.translate[0]}function b(a,b){return a.translate[1]-b*a.scale[1]}function g(a,c,d){var e=Array(d.length);if(!d.length)return e;var g=a.scale,h=g[0],g=g[1],m=f(a,d[0][0]);a=b(a,d[0][1]);e[0]=c(d[0],m,a);for(var k=1;k<d.length;k++){var p=d[k],m=m+p[0]*h;a-=p[1]*g;e[k]=c(p,m,a)}return e}
function p(a,b,c){for(var d=Array(c.length),e=0;e<c.length;e++)d[e]=g(a,b,c[e]);return d}function t(a,b,c,d){return g(a,c?d?G:E:d?E:C,b)}function u(a,b,c,d){return p(a,c?d?G:E:d?E:C,b)}function r(a,b,c,d){return p(a,c?d?G:E:d?E:C,b)}function q(a,b,c){var d=c[0],e=d[0],d=d[1],f=Math.min(e,b[0]),g=Math.min(d,b[1]),h=Math.max(e,b[2]);b=Math.max(d,b[3]);for(var m=1;m<c.length;m++){var k=c[m],p=k[0],k=k[1],e=e+p,d=d+k;0>p&&(f=Math.min(f,e));0<p&&(h=Math.max(h,e));0>k?g=Math.min(g,d):0<k&&(b=Math.max(b,
d))}a[0]=f;a[1]=g;a[2]=h;a[3]=b;return a}function v(a,b){if(!b.length)return null;a[0]=a[1]=Number.POSITIVE_INFINITY;a[2]=a[3]=Number.NEGATIVE_INFINITY;for(var c=0;c<b.length;c++)q(a,a,b[c]);return a}function w(a,b,c,d,e){b.xmin=l(a,c.xmin);b.ymin=k(a,c.ymin);b.xmax=l(a,c.xmax);b.ymax=k(a,c.ymax);b!==c&&(d&&(b.zmin=c.zmin,b.zmax=c.zmax),e&&(b.mmin=c.mmin,b.mmax=c.mmax));return b}function z(a,b,d,e,f){b.points=c(a,d.points,e,f);return b}function x(a,b,c,d,e){b.x=l(a,c.x);b.y=k(a,c.y);b!==c&&(d&&(b.z=
c.z),e&&(b.m=c.m));return b}function B(a,b,c,d,e){a=h(a,c.rings,d,e);if(!a)return null;b.rings=a;return b}function A(a,b,c,d,e){a=m(a,c.paths,d,e);if(!a)return null;b.paths=a;return b}Object.defineProperty(a,"__esModule",{value:!0});a.unquantizePolyline=a.unquantizePolygon=a.unquantizePoint=a.unquantizeMultipoint=a.unquantizeExtent=a.quantizeGeometry=a.quantizePolyline=a.quantizePolygon=a.quantizePoint=a.quantizeMultipoint=a.quantizeExtent=a.getQuantizedBoundsRings=a.getQuantizedBoundsPaths=a.getQuantizedBoundsPoints=
a.getQuantizedBoundsCoordsArrayArray=a.getQuantizedBoundsCoordsArray=a.unquantizeRings=a.unquantizePaths=a.unquantizePoints=a.unquantizeBounds=a.unquantizeCoordsArrayArray=a.unquantizeCoordsArray=a.unquantizeY=a.unquantizeX=a.quantizePaths=a.quantizeRings=a.quantizePoints=a.quantizeBounds=a.quantizeY=a.quantizeX=a.equals=a.toQuantizationTransform=void 0;var C=function(a,b,c){return[b,c]},E=function(a,b,c){return[b,c,a[2]]},G=function(a,b,c){return[b,c,a[2],a[3]]};a.toQuantizationTransform=function(a){return a?
{originPosition:"upper-left"===a.originPosition?"upperLeft":"lower-left"===a.originPosition?"lowerLeft":a.originPosition,scale:[a.tolerance,a.tolerance],translate:[a.extent.xmin,a.extent.ymax]}:null};a.equals=function(a,b){if(a===b||null==a&&null==b)return!0;if(null==a||null==b)return!1;var c,d,e,f;a&&"upperLeft"===a.originPosition?(c=a.translate[0],d=a.translate[1],a=a.scale[0]):(c=a.extent.xmin,d=a.extent.ymax,a=a.tolerance);b&&"upperLeft"===b.originPosition?(e=b.translate[0],f=b.translate[1],b=
b.scale[0]):(e=b.extent.xmin,f=b.extent.ymax,b=b.tolerance);return c===e&&d===f&&a===b};a.quantizeX=l;a.quantizeY=k;a.quantizeBounds=function(a,b,c){b[0]=l(a,c[0]);b[3]=k(a,c[1]);b[2]=l(a,c[2]);b[1]=k(a,c[3]);return b};a.quantizePoints=c;a.quantizeRings=h;a.quantizePaths=m;a.unquantizeX=f;a.unquantizeY=b;a.unquantizeCoordsArray=g;a.unquantizeCoordsArrayArray=p;a.unquantizeBounds=function(a,c,d){return d?(c[0]=f(a,d[0]),c[1]=b(a,d[3]),c[2]=f(a,d[2]),c[3]=b(a,d[1]),c):[f(a,c[0]),b(a,c[3]),f(a,c[2]),
b(a,c[1])]};a.unquantizePoints=t;a.unquantizePaths=u;a.unquantizeRings=r;a.getQuantizedBoundsCoordsArray=q;a.getQuantizedBoundsCoordsArrayArray=v;a.getQuantizedBoundsPoints=function(a){var b=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return q(b,b,a)};a.getQuantizedBoundsPaths=function(a){return v([0,0,0,0],a)};a.getQuantizedBoundsRings=function(a){return v([0,0,0,0],a)};a.quantizeExtent=w;a.quantizeMultipoint=z;a.quantizePoint=x;a.quantizePolygon=
B;a.quantizePolyline=A;a.quantizeGeometry=function(a,b){return a&&b?d.isPoint(b)?x(a,{},b,!1,!1):d.isPolyline(b)?A(a,{},b,!1,!1):d.isPolygon(b)?B(a,{},b,!1,!1):d.isMultipoint(b)?z(a,{},b,!1,!1):d.isExtent(b)?w(a,{},b,!1,!1):null:null};a.unquantizeExtent=function(a,c,d,e,g){c.xmin=f(a,d.xmin);c.ymin=b(a,d.ymin);c.xmax=f(a,d.xmax);c.ymax=b(a,d.ymax);c!==d&&(e&&(c.zmin=d.zmin,c.zmax=d.zmax),g&&(c.mmin=d.mmin,c.mmax=d.mmax));return c};a.unquantizeMultipoint=function(a,b,c,d,e){b.points=t(a,c.points,d,
e);return b};a.unquantizePoint=function(a,c,d,e,g){c.x=f(a,d.x);c.y=b(a,d.y);c!==d&&(e&&(c.z=d.z),g&&(c.m=d.m));return c};a.unquantizePolygon=function(a,b,c,d,e){b.rings=r(a,c.rings,d,e);return b};a.unquantizePolyline=function(a,b,c,d,e){b.paths=u(a,c.paths,d,e);return b}})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["require","exports","../../core/compilerUtils","../../core/maybe"],function(n,a,d,l){function k(a,b){if(a===b)return!0;if(null==a||null==b||a.length!==b.length)return!1;
for(var c=0;c<a.length;c++){var d=a[c],e=b[c];if(d.length!==e.length)return!1;for(var f=0;f<d.length;f++)if(d[f]!==e[f])return!1}return!0}function e(a,b){if(a===b)return!0;if(null==a||null==b||a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(!k(a[c],b[c]))return!1;return!0}function c(a,b){return a===b||a&&b&&a.equals(b)}function h(a,b){if(a===b)return!0;if(l.isNone(a)||l.isNone(b)||a.type!==b.type)return!1;switch(a.type){case "point":return a=c(a.spatialReference,b.spatialReference)?a.x===
b.x&&a.y===b.y&&a.z===b.z&&a.m===b.m:!1,a;case "extent":return a=a.hasZ!==b.hasZ||a.hasM!==b.hasM?!1:c(a.spatialReference,b.spatialReference)?a.xmin===b.xmin&&a.ymin===b.ymin&&a.zmin===b.zmin&&a.xmax===b.xmax&&a.ymax===b.ymax&&a.zmax===b.zmax:!1,a;case "polyline":return a=a.hasZ!==b.hasZ||a.hasM!==b.hasM?!1:c(a.spatialReference,b.spatialReference)?e(a.paths,b.paths):!1,a;case "polygon":return a=a.hasZ!==b.hasZ||a.hasM!==b.hasM?!1:c(a.spatialReference,b.spatialReference)?e(a.rings,b.rings):!1,a;case "multipoint":return a=
a.hasZ!==b.hasZ||a.hasM!==b.hasM?!1:c(a.spatialReference,b.spatialReference)?k(a.points,b.points):!1,a;case "mesh":return!1;default:d.neverReached(a)}}function m(a,b){if(a===b)return!0;if(!a||!b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var e=c[d];if(a[e]!==b[e])return!1}return!0}Object.defineProperty(a,"__esModule",{value:!0});a.equals=void 0;a.equals=function(a,b){return a===b?!0:null!=a&&null!=b&&a.objectId===b.objectId&&h(a.geometry,
b.geometry)&&m(a.attributes,b.attributes)?!0:!1}})},"esri/layers/support/labelFormatUtils":function(){define("require exports tslib ../../core/Error ../../core/Logger ../../intl/date ../../intl/number ./FieldsIndex ./fieldUtils ./labelUtils ../../support/arcadeOnDemand @dojo/framework/shim/Promise".split(" "),function(n,a,d,l,k,e,c,h,m,f,b){function g(a,b){if(null==a)return"";var d=b.domain;if(d)if("codedValue"===d.type||"coded-value"===d.type)for(var f=0,d=d.codedValues;f<d.length;f++){var g=d[f];
if(g.code===a)return g.name}else if("range"===d.type&&(f=+a,g="range"in d?d.range[1]:d.maxValue,("range"in d?d.range[0]:d.minValue)<=f&&f<=g))return d.name;"date"===b.type||"esriFieldTypeDate"===b.type?a=e.formatDate(a,e.convertDateFormatToIntlOptions("short-date")):m.isNumericField(b)&&(a=c.formatNumber(+a));return a?a:""}Object.defineProperty(a,"__esModule",{value:!0});a.formatField=a.createLabelFunction=void 0;var p=k.getLogger("esri.layers.support.labelFormatUtils"),t={type:"simple",evaluate:function(){return null}},
u={getAttribute:function(a,b){return a.field(b)}};a.createLabelFunction=function(a,c,e){return d.__awaiter(this,void 0,void 0,function(){var k,r,q,v,A,C,E,G;return d.__generator(this,function(d){switch(d.label){case 0:if(!a||!a.symbol)return[2,t];k=a.where;r=f.getLabelExpression(a);return k?[4,new Promise(function(a,b){n(["../../core/sql/WhereClause"],a,b)})]:[3,2];case 1:return v=d.sent(),[3,3];case 2:v=null,d.label=3;case 3:return q=v,"arcade"!==r.type?[3,5]:[4,b.createLabelExpression(r.expression,
e,c)];case 4:return C=d.sent(),A={type:"arcade",evaluate:function(a){try{var b=C.evaluate({$feature:"attributes"in a?C.repurposeFeature(a):C.repurposeAdapter(a)});if(null!=b)return b.toString()}catch(I){p.error(new l("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:a,expression:r}))}return null},needsHydrationToEvaluate:function(){return null==f.getSingleFieldArcadeExpression(r.expression)}},[3,6];case 5:A={type:"simple",evaluate:function(a){return r.expression.replace(/{[^}]*}/g,
function(b){var d=b.slice(1,-1),d=m.getField(c,d);if(!d)return b;b=null;"attributes"in a?a&&a.attributes&&(b=a.attributes[d.name]):b=a.field(d.name);return null==b?"":g(b,d)})}},d.label=6;case 6:if(k){try{E=q.WhereClause.create(k,new h(c))}catch(H){return[2,t]}G=A.evaluate;A.evaluate=function(a){return E.testFeature(a,"attributes"in a?void 0:u)?G(a):null}}return[2,A]}})})};a.formatField=g})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require","exports",
"../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.make=void 0;var e=d.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");a.make=function(a,d){if(!l.isCalloutSupport(a))return e.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+a.type+"' does not support callouts"),null;if(!a.callout)return null;var f=c[a.callout.type];return f?
new f(a,d):(e.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+a.callout.type),null)};var c={line:k.default}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v){var w,z;Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DLineCalloutSymbolLayer=void 0;var x=q.VertexAttrConstants;n=function(a){function b(b,c){b=a.call(this,b,null,c,E)||this;b._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};b.ensureDrapedStatus(!1);return b}d.__extends(b,a);b.prototype.doLoad=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(a){this._material=new v(this.materialParameters,
this._getIdHint("_lineCallout_common"));this._context.stage.add(3,this._material);return[2]})})};b.prototype.destroy=function(){a.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)};b.prototype.perInstanceMaterialParameters=function(a){var b=this.materialParameters;b.screenOffset=a.screenOffset||[0,0];b.centerOffsetUnits=a.centerOffsetUnits||"world";return b};Object.defineProperty(b.prototype,"materialParameters",{get:function(){var a=
this.symbol,b=a.callout,c=k.isSome(b.color)?l.toUnitRGBA(b.color):[0,0,0,0];c[3]*=this._getLayerOpacity();var d=e.pt2px(b.size||0),f=null;if(a.verticalOffset)var f=a.verticalOffset,g=f.minWorldLength,h=f.maxWorldLength,f={screenLength:e.pt2px(f.screenLength),minWorldLength:g||0,maxWorldLength:null!=h?h:Infinity};b=k.isSome(b.border)&&k.isSome(b.border.color)?l.toUnitRGBA(b.border.color):null;g="object"===a.symbolLayers.getItemAt(0).type;return{color:c,size:d,verticalOffset:f,screenSizePerspective:this._context.screenSizePerspectiveEnabled?
this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:b,occlusionTest:!g,shaderPolygonOffset:g?0:void 0,depthHUDAlignStart:"label-3d"===a.type,slicePlaneEnabled:this._context.slicePlaneEnabled}},enumerable:!1,configurable:!0});b.prototype._defaultElevationInfoNoZ=function(){return C};b.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;var c=this.setGraphicElevationContext(a,new m.ElevationContext,b.elevationOffset||
0),d=b.symbol,e="on-the-ground"===this._elevationContext.mode&&("cim"===d.type||!d.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type}));if("label-3d"!==d.type&&e)return null;d=g.computeCentroid(a.geometry);return k.isNone(d)?null:this._createAs3DShape(d,c,b,"graphic"+a.uid,a.uid)};b.prototype.layerOpacityChanged=function(){this._material.setParameterValues(this.materialParameters);return!0};b.prototype.layerElevationInfoChanged=function(a,c,d){var e=this;d=h.elevationModeChangeUpdateType(b.elevationModeChangeTypes,
d,this._elevationContext.mode);if(d!==h.SymbolUpdateType.UPDATE)return d;a.forEach(function(a){var b=c(a);k.isSome(b)&&e.updateGraphicElevationContext(a.graphic,b)});return d};b.prototype.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};b.prototype.physicalBasedRenderingChanged=function(){return!0};b.prototype.pixelRatioChanged=function(){return!0};b.prototype.setGraphicElevationContext=function(b,c,d){void 0===d&&
(d=0);b=a.prototype.setGraphicElevationContext.call(this,b,c);b.addOffsetRenderUnits(d);return b};b.prototype.updateGraphicElevationContext=function(a,b){this.setGraphicElevationContext(a,b.elevationContext,b.metadata.elevationOffset);b.needsElevationUpdates=h.needsElevationUpdates2D(b.elevationContext.mode)};b.prototype.updateGeometry=function(a,b){return!1};b.prototype.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,estimated:!1,memory:t.emptySymbolComplexity.memory}};
b.prototype.createVertexData=function(a){var b,c=a.translation;a=a.centerOffset;if(!c&&!a)return B;c=c?{size:3,data:[c[0],c[1],c[2]]}:B[x.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:B[x.AUXPOS1];return b={},b[x.POSITION]=c,b[x.NORMAL]=B[x.NORMAL],b[x.AUXPOS1]=a,b};b.prototype.getOrCreateMaterial=function(a,b){var c=this.perInstanceMaterialParameters(a),d=v.uniqueMaterialIdentifier(c);if(d===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var e=
a.materialCollection.getMaterial(d);e||(e=new v(c,b+"_lineCallout_shared"),a.materialCollection.addMaterial(d,e));return{material:e,isUnique:!1}}e=new v(c,b+"_lineCallout_unique");return{material:e,isUnique:!0}};b.prototype._createAs3DShape=function(a,b,d,e,g){var m=new r.GeometryData(this.createVertexData(d),A,"point"),m=[new u(m,e)],k=this.getOrCreateMaterial(d,e);e=p.createStageObjectForHUD(this._context,a,m,[k.material],null,null,b,e,this._context.layer.uid,g);if(null===e)return null;g=new f(this,
e.object,m,k.isUnique?[k.material]:null,null,c.perObjectElevationAligner,b);g.metadata={elevationOffset:d.elevationOffset||0};g.alignedSampledElevation=e.sampledElevation;g.needsElevationUpdates=h.needsElevationUpdates2D(b.mode);p.extendPointGraphicElevationContext(g,a,this._context.elevationProvider);return g};b.elevationModeChangeTypes={definedChanged:h.SymbolUpdateType.UPDATE,staysOnTheGround:h.SymbolUpdateType.UPDATE,onTheGroundChanged:h.SymbolUpdateType.RECREATE};return b}(b.Graphics3DSymbolLayer);
a.Graphics3DLineCalloutSymbolLayer=n;var B=(w={},w[x.POSITION]={size:3,data:[0,0,0]},w[x.NORMAL]={size:3,data:[0,0,1]},w[x.AUXPOS1]={size:4,data:[0,0,0,1]},w);w=new Uint32Array([0]);var A=(z={},z[x.POSITION]=w,z[x.NORMAL]=w,z[x.AUXPOS1]=w,z),C={mode:"relative-to-ground",offset:0},E={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};a.default=n})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ./elevationAlignmentUtils ./graphicUtils ../support/uvUtils ../../support/debugFlags ../../support/projectionUtils ../../support/buffer/BufferView ../../webgl-engine/lib/Util".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){Object.defineProperty(a,"__esModule",{value:!0});a.iterativeUpdatesEnabled=a.updateThresholdInMeters=a.perLodInstanceElevationAligner=a.perObjectElevationAligner=a.perVertexElevationAligner=void 0;var r=u.VertexAttrConstants;a.perVertexElevationAligner=function(c,d,e,f){c=c.stageObject;v.spatialReference=e.spatialReference;for(var h=c.geometryRecords,k=h.length,p="absolute-height"!==d.mode,l=0,q=0;q<k;q++){var u=h[q].geometry,B=h[q].getShaderTransformation();
z[0]=B[12];z[1]=B[13];z[2]=B[14];u.invalidateBoundingInfo();for(var u=u.data.getVertexAttr(),A=u[r.POSITION],B=A.data,E=u.mapPos.data,G=A.size,A=B.length/G,F=0,H=0,n=!1,V=0,T=0;T<A;T++){v.x=E[H++];v.y=E[H++];v.z=E[H++];x[0]=B[F];x[1]=B[F+1];x[2]=B[F+2];var Y=m.evaluateElevationAlignmentAtPoint(v,e,d,f,p?C:null);p&&(V+=C.sampledElevation);w[0]=B[F]+z[0];w[1]=B[F+1]+z[1];w[2]=B[F+2]+z[2];f.setAltitude(Y,w);B[F]=w[0]-z[0];B[F+1]=w[1]-z[1];B[F+2]=w[2]-z[2];if(g.TESTS_DISABLE_UPDATE_THRESHOLDS)n=!0;else if(Y=
a.updateThresholdInMeters/f.unitInMeters,Math.abs(x[0]-B[F])>=Y||Math.abs(x[1]-B[F+1])>=Y||Math.abs(x[2]-B[F+2])>=Y)n=!0;F+=G}u[r.BOUND1]&&(E=u[r.BOUND1].data,G=u[r.BOUND2].data,F=u[r.BOUND3].data,b.createMapSpaceUVCoords(t.BufferViewVec4f.fromTypedArray(u[r.UVMAPSPACE].data),t.BufferViewVec3f64.fromTypedArray(B),f,t.BufferViewVec3f64.fromTypedArray(E),t.BufferViewVec3f64.fromTypedArray(G),t.BufferViewVec3f64.fromTypedArray(F)));l+=V/A;n&&c.geometryVertexAttrsUpdated(q)}return l/k};a.perObjectElevationAligner=
function(b,c,d,h){b=b.stageObject;var k=c.centerPointInElevationSR,r=0,t=0;if(b.metadata.usesVerticalDistanceToGround)r=m.evaluateElevationAlignmentAtPoint(k,d,c,h,C),f.updateVertexAttributeAuxpos1w(b,C.verticalDistanceToGround),t=C.sampledElevation;else{var v="absolute-height"!==c.mode,r=m.evaluateElevationAlignmentAtPoint(k,d,c,h,v?C:null);v&&(t=C.sampledElevation)}c=l.mat4.copy(q,b.objectTransformation);d=e.vec3.set(A,c[12],c[13],c[14]);g.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(w[0]=k.x,
w[1]=k.y,w[2]=r,p.computeLinearTransformation(k.spatialReference,w,c,h.spatialReference)&&(b.objectTransformation=c)):h.setAltitudeOfTransformation(r,c);h=a.updateThresholdInMeters/h.unitInMeters;if(Math.abs(c[12]-d[0])>=h||Math.abs(c[13]-d[1])>=h||Math.abs(c[14]-d[2])>=h)b.objectTransformation=c;return t};var q=k.mat4f64.create();a.perLodInstanceElevationAligner=function(b,c,f,h){var k=b.graphics3DSymbolLayer.lodRenderer;if(d.isNone(k))return 0;var l=c.centerPointInElevationSR,r=0,t=0,q="absolute-height"!==
c.mode,r=m.evaluateElevationAlignmentAtPoint(l,f,c,h,q?C:null);q&&(t=C.sampledElevation);c=k.instanceData;b=b.instanceIndex;f=B;c.getGlobalTransform(b,f);k=e.vec3.set(A,f[12],f[13],f[14]);g.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(w[0]=l.x,w[1]=l.y,w[2]=r,p.computeLinearTransformation(l.spatialReference,w,f,h.spatialReference)&&c.setGlobalTransform(b,f)):h.setAltitudeOfTransformation(r,f);h=a.updateThresholdInMeters/h.unitInMeters;(Math.abs(f[12]-k[0])>=h||Math.abs(f[13]-k[1])>=h||Math.abs(f[14]-
k[2])>=h)&&c.setGlobalTransform(b,f);return t};a.updateThresholdInMeters=.01;a.iterativeUpdatesEnabled=!0;var v=new h,w=c.vec3f64.create(),z=c.vec3f64.create(),x=c.vec3f64.create(),B=k.mat4f64.create(),A=c.vec3f64.create(),C={verticalDistanceToGround:0,sampledElevation:0}})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ./graphicUtils ../../support/ElevationProvider ../../support/projectionUtils".split(" "),
function(n,a,d,l,k,e,c,h,m){function f(a,b,c,e,f){var g=a.z||0;switch(c.mode){case "on-the-ground":return a=h.getElevationAtPoint(b,a,"ground")||0,f&&(f.verticalDistanceToGround=0,f.sampledElevation=a),a;case "relative-to-ground":return a=h.getElevationAtPoint(b,a,"ground")||0,c=c.geometryZWithOffset(g,e),f&&(f.verticalDistanceToGround=c,f.sampledElevation=a),c+a;case "relative-to-scene":return a=h.getElevationAtPoint(b,a,"scene")||0,c=c.geometryZWithOffset(g,e),f&&(f.verticalDistanceToGround=c,f.sampledElevation=
a),c+a;case "absolute-height":return c=c.geometryZWithOffset(g,e),f&&(a=h.getElevationAtPoint(b,a,"ground")||0,f.verticalDistanceToGround=c-a,f.sampledElevation=a),c;default:return d.neverReached(c.mode),0}}Object.defineProperty(a,"__esModule",{value:!0});a.SymbolUpdateType=a.applyElevationAlignmentForHUD=a.needsElevationUpdates3D=a.needsElevationUpdates2D=a.elevationModeChangeUpdateType=a.evaluateElevationAlignmentAtPoint=a.applyPerVertexElevationAlignment=void 0;a.applyPerVertexElevationAlignment=
function(a,b,c,d,e,f,h,k,p,l,t){var r=g[t.mode],q=0;if(m.bufferToBuffer(a,b,c,d,p.spatialReference,e,k)&&(r.requiresAlignment(t)?(q=r.applyElevationAlignmentBuffer(d,e,f,h,k,p,l,t),a=f,e=h):a=d,m.bufferToBuffer(a,p.spatialReference,e,f,l.spatialReference,h,k)))return q};a.evaluateElevationAlignmentAtPoint=f;a.elevationModeChangeUpdateType=function(a,c,d){return null==c||null==d?a.definedChanged:"on-the-ground"===c&&"on-the-ground"===d?a.staysOnTheGround:c===d||"on-the-ground"!==c&&"on-the-ground"!==
d?b.UPDATE:a.onTheGroundChanged};a.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};a.needsElevationUpdates3D=function(a){return"absolute-height"!==a};a.applyElevationAlignmentForHUD=function(a,b,d,e,g){d=f(b,d,g,e,t);c.updateVertexAttributeAuxpos1w(a,t.verticalDistanceToGround);g=t.sampledElevation;var h=l.mat4.copy(p,a.objectTransformation);u[0]=b.x;u[1]=b.y;u[2]=d;m.computeLinearTransformation(b.spatialReference,u,h,e.spatialReference)?a.objectTransformation=
h:console.warn("Could not locate symbol object properly, it might be misplaced");return g};var b;(function(a){a[a.NONE=0]="NONE";a[a.UPDATE=1]="UPDATE";a[a.RECREATE=2]="RECREATE"})(b=a.SymbolUpdateType||(a.SymbolUpdateType={}));var g={"absolute-height":{applyElevationAlignmentBuffer:function(a,b,c,d,e,f,g,h){f=h.calculateOffsetRenderUnits(g);h=h.featureExpressionInfoContext;b*=3;d*=3;for(g=0;g<e;++g){var m=a[b+1],k=a[b+2];c[d+0]=a[b+0];c[d+1]=m;c[d+2]=null==h?k+f:f;b+=3;d+=3}return 0},requiresAlignment:function(a){var b=
a.featureExpressionInfoContext;return 0!==a.meterUnitOffset||null!=b}},"on-the-ground":{applyElevationAlignmentBuffer:function(a,b,c,d,e,f){var g=0,h=f.spatialReference;b*=3;d*=3;for(var m=0;m<e;++m){var k=a[b+0],p=a[b+1],l=f.getElevation(k,p,a[b+2],h,"ground")||0,g=g+l;c[d+0]=k;c[d+1]=p;c[d+2]=l;b+=3;d+=3}return g/e},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(a,b,c,d,e,f,g,h){var m=0;g=h.calculateOffsetRenderUnits(g);h=h.featureExpressionInfoContext;
var k=f.spatialReference;b*=3;d*=3;for(var p=0;p<e;++p){var l=a[b+0],r=a[b+1],t=a[b+2],q=f.getElevation(l,r,t,k,"ground")||0,m=m+q;c[d+0]=l;c[d+1]=r;c[d+2]=null==h?t+q+g:q+g;b+=3;d+=3}return m/e},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(a,b,c,d,e,f,g,h){var m=0;g=h.calculateOffsetRenderUnits(g);h=h.featureExpressionInfoContext;var k=f.spatialReference;b*=3;d*=3;for(var p=0;p<e;++p){var l=a[b+0],r=a[b+1],t=a[b+2],q=f.getElevation(l,r,t,k,"scene")||
0,m=m+q;c[d+0]=l;c[d+1]=r;c[d+2]=null==h?t+q+g:q+g;b+=3;d+=3}return m/e},requiresAlignment:function(){return!0}}},p=k.mat4f64.create(),t={verticalDistanceToGround:0,sampledElevation:0},u=e.vec3f64.create()})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../support/pointUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q){function v(a){var b=a.paths[0];if(!b||0===b.length)return null;b=t.getPointOnPath(b,t.getPathLength(b)/2);return u.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference)}function w(a,b,c){c=c?a:r.clonePoint(a);return b&&a?q.pointToPoint(a,c,b)?c:null:c}function z(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)if(!z(a[b]))return!1;return!0}return null==a||0<=a}Object.defineProperty(a,"__esModule",{value:!0});a.namedAnchorToHUDMaterialAnchorPos=a.demResolutionForBoundingBox=
a.computeObjectRotation=a.isValidSize=a.validateSymbolLayerSize=a.computeObjectScale=a.overrideColor=a.mixinColorAndOpacity=a.updateVertexAttributeAuxpos1w=a.enlargeExtent=a.computeCentroid=void 0;a.computeCentroid=function(a,b){if("point"===a.type)return w(a,b,!1);if(r.isHydratedGeometry(a))switch(a.type){case "extent":return w(a.center,b,!1);case "polygon":return w(a.centroid,b,!1);case "polyline":return w(v(a),b,!0);case "mesh":return w(a.extent.center,b,!1)}else switch(a.type){case "extent":var c=
d.isFinite(a.zmin);a=u.makeDehydratedPoint(.5*(a.xmax+a.xmin),.5*(a.ymax+a.ymin),c?.5*(a.zmax+a.zmin):void 0,a.spatialReference);return w(a,b,!0);case "polygon":return(c=a.rings[0])&&0!==c.length?(c=p.ringsCentroid(a.rings,a.hasZ),a=u.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference)):a=null,w(a,b,!0);case "polyline":return w(v(a),b,!0)}};a.enlargeExtent=function(a,b,c,d){void 0===d&&(d=0);if(a){b||(b=g.create());var e=.5*a.width*(c-1);c=.5*a.height*(c-1);a.width<1E-7*a.height?e+=c/20:a.height<
1E-7*a.width&&(c+=e/20);m.vec4.set(b,a.xmin-e-d,a.ymin-c-d,a.xmax+e+d,a.ymax+c+d);return b}return null};a.updateVertexAttributeAuxpos1w=function(a,b){for(var c=0;c<a.geometries.length;++c){var d=a.geometries[c].data.vertexAttributes.auxpos1;d&&d.data[3]!==b&&(d.data[3]=b,a.geometryVertexAttrsUpdated(c))}};a.mixinColorAndOpacity=function(a,b){var c=f.vec4f64.clone(f.vec4f64.ONES);l.isSome(a)&&(c[0]=a[0],c[1]=a[1],c[2]=a[2]);l.isSome(b)?c[3]=b:l.isSome(a)&&3<a.length&&(c[3]=a[3]);return c};a.overrideColor=
function(a,b,c,d,e,f){void 0===f&&(f=[0,0,0,0]);for(var g=0;3>g;++g)l.isSome(a)&&null!=a[g]?f[g]=a[g]:l.isSome(c)&&null!=c[g]?f[g]=c[g]:f[g]=e[g];l.isSome(b)?f[3]=b:l.isSome(d)?f[3]=d:f[3]=e[3];return f};a.computeObjectScale=function(a,b,c,d){void 0===a&&(a=h.vec3f64.ONES);void 0===d&&(d=1);var e=Array(3);if(l.isNone(b)||l.isNone(c))e[0]=1,e[1]=1,e[2]=1;else{for(var f=void 0,g=0,m=2;0<=m;m--){var k=a[m],p=void 0,r=null!=k,t=0===m&&!f&&!r,q=c[m];"symbol-value"===k||t?p=0!==q?b[m]/q:1:r&&"proportional"!==
k&&isFinite(k)&&(p=0!==q?k/q:1);null!=p&&(f=e[m]=p,g=Math.max(g,Math.abs(p)))}for(m=2;0<=m;m--)null==e[m]?e[m]=f:0===e[m]&&(e[m]=.001*g)}for(m=2;0<=m;m--)e[m]/=d;return h.vec3f64.fromArray(e)};a.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]);return z(a)?null:"Symbol sizes may not be negative values"};a.isValidSize=z;a.computeObjectRotation=function(a,b,c,d){void 0===d&&(d=e.mat4f64.create());a=a||0;b=b||0;c=c||0;0!==a&&k.mat4.rotateZ(d,d,-a/180*Math.PI);0!==
b&&k.mat4.rotateX(d,d,b/180*Math.PI);0!==c&&k.mat4.rotateY(d,d,c/180*Math.PI);return d};a.demResolutionForBoundingBox=function(a,c){return null!=c.minDemResolution?c.minDemResolution:b.isPoint(a)?c.minDemResolutionForPoints:.01*b.maximumDimension(a)};a.namedAnchorToHUDMaterialAnchorPos={"bottom-left":c.vec2f64.fromValues(0,0),bottom:c.vec2f64.fromValues(.5,0),"bottom-right":c.vec2f64.fromValues(1,0),left:c.vec2f64.fromValues(0,.5),center:c.vec2f64.fromValues(.5,.5),right:c.vec2f64.fromValues(1,.5),
"top-left":c.vec2f64.fromValues(0,1),top:c.vec2f64.fromValues(.5,1),"top-right":c.vec2f64.fromValues(1,1)}})},"esri/views/3d/layers/support/uvUtils":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/SpatialReference ../../support/projectionUtils ../../support/buffer/BufferView ../../support/geometryUtils/plane".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){function g(a,b,c,d,f,g,h){e.vec3.set(a,b*f[0]+c*g[0]+d*h[0],b*f[1]+c*g[1]+d*h[1],b*f[2]+c*g[2]+d*h[2])}Object.defineProperty(a,"__esModule",{value:!0});a.createMapSpaceUVCoords=a.createMapSpaceUVCoordsDraped=void 0;a.createMapSpaceUVCoordsDraped=function(a,b,c,d){void 0===d&&(d=1);if(c.isGeographic){var e=new Float64Array(b.typedBuffer.length);m.bufferToBuffer(b.typedBuffer,c,0,e,h.WebMercator,0,b.count);b=f.BufferViewVec3f64.fromTypedArray(e);c=h.WebMercator}l.vec2.set(w,
Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(c=0;c<b.count;c++)b.getVec(c,t),w[0]=Math.min(w[0],t[0]),w[1]=Math.min(w[1],t[1]);c=w[1]%d;x[0]=w[0]-w[0]%d;x[1]=w[1]-c;for(c=0;c<b.count;c++)b.getVec(c,t),a.setValues(c,(t[0]-x[0])/d,(t[1]-x[1])/d,x[0]/d,x[1]/d)};a.createMapSpaceUVCoords=function(a,c,d,f,h,m,k){void 0===k&&(k=1);e.vec3.set(r,1,0,0);e.vec3.set(q,0,1,0);e.vec3.set(v,0,0,1);var I=p;e.vec3.set(J,0,0,0);for(var n=0;n<c.count-1;n++)c.getVec(n,t),e.vec3.add(J,J,t);e.vec3.scale(I,J,
1/(c.count-1));if(b.fromManyPointsSampleAt(c,u,0,Math.floor(c.count/3),Math.floor(2/3*c.count))){var K=u,I=r,n=q,Q=v;d.basisMatrixAtPosition(p,E);e.vec3.set(G,E[0],E[1],E[2]);e.vec3.set(F,E[4],E[5],E[6]);e.vec3.set(H,E[8],E[9],E[10]);d=b.normal(K);0>e.vec3.dot(d,H)&&e.vec3.scale(d,d,-1);e.vec3.copy(Q,d);Q=e.vec3.dot(d,F);K=e.vec3.dot(d,G);Math.abs(Q)<Math.abs(K)?(e.vec3.scaleAndAdd(I,G,d,-K),e.vec3.normalize(I,I),e.vec3.cross(n,I,d),e.vec3.normalize(n,n),e.vec3.scale(n,n,-1)):(e.vec3.scaleAndAdd(n,
F,d,-Q),e.vec3.normalize(n,n),e.vec3.cross(I,n,d),e.vec3.normalize(I,I))}l.vec2.set(w,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);l.vec2.set(z,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(I=0;I<c.count;I++)c.getVec(I,t),n=e.vec3.dot(r,t),d=e.vec3.dot(q,t),w[0]=Math.min(w[0],n),w[1]=Math.min(w[1],d),z[0]=Math.max(z[0],n),z[1]=Math.max(z[1],d);I=e.vec3.dot(v,p);g(B,w[0],w[1],I,r,q,v);g(A,z[0],w[1],I,r,q,v);g(C,w[0],z[1],I,r,q,v);I=w[1]%k;x[0]=w[0]-w[0]%k;x[1]=w[1]-I;for(I=0;I<c.count;I++)c.getVec(I,
t),a.setValues(I,(e.vec3.dot(r,t)-x[0])/k,(e.vec3.dot(q,t)-x[1])/k,x[0]/k,x[1]/k),f&&h&&m&&(f.setVec(I,B),h.setVec(I,A),m.setVec(I,C))};var p=c.vec3f64.create(),t=c.vec3f64.create(),u=b.create(),r=c.vec3f64.create(),q=c.vec3f64.create(),v=c.vec3f64.create(),w=k.vec2f64.create(),z=k.vec2f64.create(),x=k.vec2f64.create(),B=c.vec3f64.create(),A=c.vec3f64.create(),C=c.vec3f64.create(),E=d.mat4f64.create(),G=c.vec3f64.create(),F=c.vec3f64.create(),H=c.vec3f64.create(),J=c.vec3f64.create()})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require",
"exports","../../../../core/maybe","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.ElevationContext=void 0;n=function(){function a(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}Object.defineProperty(a.prototype,"featureExpressionInfoContext",{get:function(){return this._featureExpressionInfoContext},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"unit",{get:function(){return this._unit},set:function(a){this._unit=a;this._metersPerElevationInfoUnit=l.getMetersPerUnit(a)},enumerable:!1,configurable:!0});a.prototype.reset=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};
Object.defineProperty(a.prototype,"offsetMeters",{set:function(a){this._meterUnitOffset=a;this._renderUnitOffset=0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"offsetElevationInfoUnits",{set:function(a){this._meterUnitOffset=a*this._metersPerElevationInfoUnit;this._renderUnitOffset=0},enumerable:!1,configurable:!0});a.prototype.addOffsetRenderUnits=function(a){this._renderUnitOffset+=a};a.prototype.geometryZWithOffset=function(a,d){d=this.calculateOffsetRenderUnits(d);return null!=
this.featureExpressionInfoContext?d:a+d};a.prototype.calculateOffsetRenderUnits=function(a){var c=this._meterUnitOffset,d=this.featureExpressionInfoContext;null!=d&&(c+=k.execute(d)*this._metersPerElevationInfoUnit);return c/a.unitInMeters+this._renderUnitOffset};a.prototype.setFromElevationInfo=function(a){this.mode=a.mode;this.unit=a.unit||"meters";this.offsetElevationInfoUnits=d.unwrapOr(a.offset,0)};a.prototype.updateFeatureExpressionInfoContext=function(a,e,m){if(d.isNone(a))this._featureExpressionInfoContext=
null;else{var c=a&&a.arcade;c&&d.isSome(e)&&d.isSome(m)?(this._featureExpressionInfoContext=k.clone(a),k.setContextFeature(this._featureExpressionInfoContext,k.createFeature(c.modules,e,m))):this._featureExpressionInfoContext=a}};a.fromElevationInfo=function(c){var e=new a;d.isSome(c)&&e.setFromElevationInfo(c);return e};return a}();a.ElevationContext=n})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define("require exports tslib ../../../../core/Logger ../../../../layers/graphics/hydratedFeatures ../../../../support/arcadeOnDemand".split(" "),
function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.zeroContext=a.extractExpressionInfo=a.execute=a.setContextFeature=a.createFeature=a.createContext=a.createContextWithoutExpressionSupport=a.clone=void 0;var c=l.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");a.clone=function(a){return{cachedResult:a.cachedResult,arcade:a.arcade?{func:a.arcade.func,context:a.arcade.modules.arcadeUtils.createExecContext(null,{sr:a.arcade.context.spatialReference}),modules:a.arcade.modules}:
null}};a.createContextWithoutExpressionSupport=function(a){a=a&&a.expression;return"string"===typeof a&&(a="0"===a?0:null,null!=a)?{cachedResult:a}:null};a.createContext=function(a,c,f){return d.__awaiter(this,void 0,void 0,function(){var b,g,h,m,k;return d.__generator(this,function(d){switch(d.label){case 0:b=a&&a.expression;if("string"!==typeof b)return[2,null];g="0"===b?0:null;return null!=g?[2,{cachedResult:g}]:[4,e.loadArcade()];case 1:return h=d.sent(),m=h.arcadeUtils,k=m.createSyntaxTree(b),
m.dependsOnView(k)?(null!=f&&f.error("Expressions containing '$view' are not supported on ElevationInfo"),[2,{cachedResult:0}]):[2,{arcade:{func:m.createFunction(k),context:m.createExecContext(null,{sr:c}),modules:h}}]}})})};a.createFeature=function(a,c,d){return a.arcadeUtils.createFeature(c.attributes,c.geometry,d)};a.setContextFeature=function(a,d){null!=a&&null==a.cachedResult&&(d&&a.arcade?(d._geometry&&(d._geometry=k.hydrateGeometry(d._geometry)),a.arcade.modules.arcadeUtils.updateExecContext(a.arcade.context,
d)):c.errorOncePerTick("Arcade support required but not provided"))};a.execute=function(a){if(null!=a){if(null!=a.cachedResult)return a.cachedResult;var c=a.arcade,c=a.arcade.modules.arcadeUtils.executeFunction(c.func,c.context);"number"!==typeof c&&(c=a.cachedResult=0);return c}return 0};a.extractExpressionInfo=function(a,c){void 0===c&&(c=!1);var d=(a=a&&a.featureExpressionInfo)&&a.expression;c||"0"===d||(a=null);return a};a.zeroContext={cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports tslib ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./graphicUtils".split(" "),
function(n,a,d,l,k,e,c,h,m){function f(a){return a.isVisible?a.getParameters().transparent?1:2:0}n=function(){function a(b,c,d,e,f,g,h,m,k){this.uniqueGeometries=d;this.uniqueMaterials=e;this.uniqueTextures=f;this.elevationAligner=g;this.elevationContext=h;this._edgeState=m;this.type="object3d";this.stage=this.stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=b;this.stageObject=c;this.visibilityMode=null!=k?
k:a.VisibilityModes.HIDE_FACERANGE}Object.defineProperty(a.prototype,"isElevationSource",{get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)},enumerable:!1,configurable:!0});a.prototype.initialize=function(a,b){this.stageLayer=b;this.stage=a;if(this.uniqueMaterials)for(b=0;b<this.uniqueMaterials.length;b++)a.add(3,this.uniqueMaterials[b]);if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.add(2,this.uniqueGeometries[b]);if(this.uniqueTextures)for(b=
0;b<this.uniqueTextures.length;b++)a.add(4,this.uniqueTextures[b]);a.add(1,this.stageObject)};a.prototype.layerOpacityChanged=function(a,b){if(!l.isNone(this._edgeState)){for(var c=f(this._edgeState.baseMaterial),d=!1,e=0,g=this._edgeState.edgeMaterials;e<g.length;e++){var h=g[e];h.objectTransparency!==c&&(h.objectTransparency=c,d=!0)}d&&this.resetEdgeObject(b);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[a])}};a.prototype.slicePlaneEnabledChanged=function(a,
b){l.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:a},!b),this._edgeState.slicePlaneEnabled=a)};a.prototype.setVisibility=function(b){if(null!=this.stage){if(this._visible===b)return!1;(this._visible=b)?this._addedToStage?this.stageObject.setVisible(!0):(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===a.VisibilityModes.HIDE_FACERANGE?this.stageObject.setVisible(!1):
(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);if(l.isSome(this._edgeState)){var c=this.stage.renderView.ensureEdgeView();c.hasObject(this.stageObject)?c.updateObjectVisibility(this.stageObject,b):b&&this.addOrUpdateEdgeObject(c,!1)}return!0}};Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},enumerable:!1,configurable:!0});a.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var b=0;b<this.uniqueMaterials.length;b++)a.remove(3,
this.uniqueMaterials[b].id);if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.remove(2,this.uniqueGeometries[b].id);if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(4,this.uniqueTextures[b].id)}a.remove(1,this.stageObject.id);this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);a=this.stage.renderView.ensureEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this.stageObject.dispose();this._visible=
!1;this.stage=this.stageLayer=null};a.prototype.alignWithElevation=function(a,b,c,d){null!=this.elevationAligner&&(l.isSome(c)&&h.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedSampledElevation=a),this.resetEdgeObject(d))};a.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};a.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=e.vec3f64.create());return k.vec3.copy(a,
this.stageObject.getCenter(!0))};a.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=c.create());var b=this.stageObject;a||(a=c.create());c.setMin(a,b.getBBMin(!0));c.setMax(a,b.getBBMax(!0));return a};a.prototype.computeAttachmentOrigin=function(a){for(var b=0,c=this.stageObject.geometryRecords;b<c.length;b++)c[b].computeAttachmentOrigin(p)&&(k.vec3.transformMat4(p,p,this.stageObject.objectTransformation),k.vec3.add(a.render.origin,a.render.origin,p),a.render.num++)};a.prototype.getProjectedBoundingBox=
function(a,e,f,h,l){return d.__awaiter(this,void 0,void 0,function(){var r,q,v,u,w,z,F,H,n,I;return d.__generator(this,function(d){switch(d.label){case 0:r=this.getBoundingBoxObjectSpace(l);q=t;v=c.isPoint(r)?1:q.length;for(u=0;u<v;u++)w=q[u],g[0]=r[w[0]],g[1]=r[w[1]],g[2]=r[w[2]],k.vec3.transformMat4(g,g,this.stageObject.objectTransformation),b[3*u+0]=g[0],b[3*u+1]=g[1],b[3*u+2]=g[2];if(!a(b,0,v))return[2,null];c.empty(r);z=null;this.calculateRelativeScreenBounds&&(z=this.calculateRelativeScreenBounds());
for(u=0;u<3*v;u+=3){for(F=0;3>F;F++)r[F]=Math.min(r[F],b[u+F]),r[F+3]=Math.max(r[F+3],b[u+F]);z&&f.push({location:b.slice(u,u+3),screenSpaceBoundingRect:z})}if(!e||!e.service||"absolute-height"===this.elevationContext.mode)return[3,5];c.center(r,p);H="relative-to-scene"===this.elevationContext.mode?"scene":"ground";n=void 0;if(!e.useViewElevation)return[3,1];n=e.service.getElevation(p[0],p[1],H);return[3,4];case 1:return d.trys.push([1,3,,4]),I=m.demResolutionForBoundingBox(r,e),[4,e.service.queryElevation(p[0],
p[1],h,I,H)];case 2:return n=d.sent(),[3,4];case 3:return d.sent(),n=null,[3,4];case 4:c.offset(r,0,0,-this.alignedSampledElevation+n),d.label=5;case 5:return[2,r]}})})};a.prototype.addObjectState=function(a,b){0===a&&b.addObject(this.stageObject,this.stageObject.highlight());1===a&&b.addObject(this.stageObject,this.stageObject.occlude())};a.prototype.removeObjectState=function(a){a.removeObject(this.stageObject)};a.prototype.resetEdgeObject=function(a){if(!l.isNone(this._edgeState)){var b=this.stage.renderView.ensureEdgeView();
this._visible?this.addOrUpdateEdgeObject(b,a):b.removeObject(this.stageObject)}};a.prototype.addOrUpdateEdgeObject=function(a,b){var c=this._edgeState;if(!l.isNone(c)){for(var d=f(c.baseMaterial),e=0,g=c.edgeMaterials;e<g.length;e++)g[e].objectTransparency=d;a.addOrUpdateObject(this.stageObject,c.edgeMaterials,{slicePlaneEnabled:c.slicePlaneEnabled},!b,c.addObjectSettings)}};return a}();(function(a){a=a.VisibilityModes||(a.VisibilityModes={});a[a.REMOVE_OBJECT=0]="REMOVE_OBJECT";a[a.HIDE_FACERANGE=
1]="HIDE_FACERANGE"})(n||(n={}));var b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=e.vec3f64.create(),p=e.vec3f64.create(),t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return n})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./Loadable ./symbolComplexity".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q){function v(a,b){a=null!=a?b.attributes[a]:0;return null!=a&&isFinite(a)?a:0}Object.defineProperty(a,"__esModule",{value:!0});a.getAttributeValue=a.Graphics3DSymbolLayer=void 0;var w=c.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");n=function(a){function c(b,c,d,e){var f=a.call(this)||this;f._elevationInfoOverride=null;f.complexity=null;f.logger=w;f._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};f.symbol=b;f.symbolLayer=
c;f._context=d;f._renderPriority=e.renderPriority;f._renderPriorityStep=e.renderPriorityStep;f._elevationContext=new p.ElevationContext;f.complexity=f.computeComplexity();f._updateDrivenProperties(e.ignoreDrivers);f._updateElevationContext();return f}d.__extends(c,a);c.prototype.getCachedSize=function(){return null};Object.defineProperty(c.prototype,"extentPadding",{get:function(){return 0},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"needsDrivenTransparentPass",{get:function(){return this._drivenProperties.opacity&&
!this._drivenProperties.opacityAlwaysOpaque},enumerable:!1,configurable:!0});c.prototype._logGeometryCreationWarnings=function(a,b,c,d){var e="polygons"in a?a.polygons:null;d+=" geometry failed to be created";var f=null;a.projectionSuccess?!b.length||1===b.length&&!b[0].length?f=d+" (no "+c+" were defined)":Array.isArray(b)&&Array.isArray(b[0])?e&&0===e.length&&"rings"===c&&0<b.length&&2<b[0].length&&(f=d+" (filled "+c+" should use clockwise winding - try reversing the order of vertices)"):f=d+" ("+
c+" should be defined as a 2D array)":f=d+" (failed to project geometry to view spatial reference)";f&&w.warnOncePerTick(f)};c.prototype._validateGeometryType=function(a,b,c){if(k.includes(b,a.type))return!0;this.logger.warn("unsupported geometry type for "+c+(" symbol: "+a.type));return!1};c.prototype._validateGeometry=function(a){return"point"!==a.type||h.isFinite(a.x)&&h.isFinite(a.y)?!0:(w.warn("point coordinate is not a valid number, graphic skipped"),!1)};c.prototype._defaultElevationInfoNoZ=
function(){return z};c.prototype._defaultElevationInfoZ=function(){return x};c.prototype._updateElevationContext=function(){m.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):
this._elevationContext.reset()};c.prototype.getDefaultElevationInfo=function(a){return a.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};c.prototype.getGeometryElevationMode=function(a,b){void 0===b&&(b=this.getDefaultElevationInfo(a));return this._elevationContext.mode||b.mode};c.prototype.setElevationInfoOverride=function(a){this._elevationInfoOverride=a;this._updateElevationContext()};c.prototype.setGraphicElevationContext=function(a,b){var c=m.unwrap(a.geometry),d=this.getDefaultElevationInfo(c);
b.unit=null!=this._elevationContext.unit?this._elevationContext.unit:d.unit;b.mode=this.getGeometryElevationMode(c,d);b.offsetMeters=m.unwrapOr(this._elevationContext.meterUnitOffset,m.unwrapOr(d.offset,0));if(c=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===b.mode)b.mode="relative-to-ground",b.offsetMeters=0;b.updateFeatureExpressionInfoContext(c?t.zeroContext:this._elevationContext.featureExpressionInfoContext,a,this._context.layer);return b};c.prototype.prepareSymbolLayerPatch=
function(a){};c.prototype.updateGeometry=function(a,b){return!1};c.prototype.onRemoveGraphic=function(a){};c.prototype._updateDrivenProperties=function(a){var b={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};a||(a=this._context.renderer)&&"visualVariables"in a&&a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":b.color=!0;if(a.stops)for(var c=0;c<a.stops.length;c++){var d=a.stops[c].color;d&&(b.opacity=!0,1>d.a&&(b.opacityAlwaysOpaque=!1))}break;case "opacity":b.opacity=
!0;b.opacityAlwaysOpaque=!1;break;case "size":b.size=!0}});this._drivenProperties=b};c.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?1:a};c.prototype._getCombinedOpacity=function(a,b){void 0===b&&(b=B);var c=1;this.draped||(c*=this._getLayerOpacity());if(this._drivenProperties.opacity)return c;m.isSome(a)?c*=a.a:b.hasIntrinsicColor||(c=0);return c};
c.prototype._getCombinedOpacityAndColor=function(a,b){void 0===b&&(b=B);b=this._getCombinedOpacity(a,b);if(this._drivenProperties.color)return u.mixinColorAndOpacity(null,b);a=m.isSome(a)?l.toUnitRGB(a):f.vec3f64.ONES;return u.mixinColorAndOpacity(a,b)};c.prototype._getVertexOpacityAndColor=function(a,b,c){a=u.mixinColorAndOpacity(this._drivenProperties.color?a.color:null,this._drivenProperties.opacity?a.opacity:null);c&&(a[0]*=c,a[1]*=c,a[2]*=c,a[3]*=c);return b?new b(a):a};c.prototype._getIdHint=
function(a){void 0===a&&(a="");return this._context.layer.id+"_symbol"+a};c.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};c.prototype.computeComplexity=function(){return q.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};c.prototype.destroy=function(){this.abortLoad()};c.prototype.globalPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged(b,c);case "elevationInfo":return a=this._elevationContext.mode,this._updateElevationContext(),
this.layerElevationInfoChanged(b,c,a)===g.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(b,c);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return e.neverReachedSilent(a),!1}};c.prototype.updateGraphics3DGraphicElevationInfo=function(a,b,c){var d=this,e=g.SymbolUpdateType.UPDATE;a.forEach(function(a){var f=b(a);m.isSome(f)?(d.setGraphicElevationContext(a.graphic,
f.elevationContext),f.needsElevationUpdates=c(f.elevationContext.mode)):e=g.SymbolUpdateType.RECREATE});return e};c.prototype.applyRendererDiff=function(a,b){return!1};c.prototype.getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;var c=this._fastUpdates.visualVariables,d=c.size?v(c.size.field,a):0,e=c.color?v(c.color.field,a):0;a=c.opacity?v(c.opacity.field,a):0;return b.vec4f64.fromValues(d,e,a,0)};Object.defineProperty(c.prototype,"draped",{get:function(){return this._draped},
enumerable:!1,configurable:!0});c.prototype.ensureDrapedStatus=function(a){if(null==this._draped)return this._draped=a,!0;a!==this.draped&&w.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};return c}(r.Loadable);a.Graphics3DSymbolLayer=n;a.getAttributeValue=v;var z={mode:"on-the-ground",offset:0,unit:"meters"},x={mode:"absolute-height",offset:0,unit:"meters"},B={hasIntrinsicColor:!1};
a.default=n})},"esri/views/3d/layers/graphics/Loadable":function(){define(["require","exports","../../../../core/promiseUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.Loadable=void 0;n=function(){function a(){this._abortController=null;this._loadStatus=0;this.logger=this._loader=this._loadError=null}Object.defineProperty(a.prototype,"loadStatus",{get:function(){return this._loadStatus},enumerable:!1,configurable:!0});a.prototype.load=function(a,e){var c=this;if(1===this._loadStatus)return a&&
a(),this._loader;if(2===this._loadStatus)return e&&e(this._loadError),this._loader;this._loader||(this._abortController=d.createAbortController(),this._loader=this.doLoad(this._abortController.signal).then(function(){c._abortController=null;c._loadStatus=1},function(a){c._loadError=a;c._abortController=null;c._loadStatus=2;!d.isAbortError(a)&&c.logger&&a.message&&c.logger.warn(a.message);throw a;}));this._loader.then(a,e).catch(function(){});return this._loader};a.prototype.abortLoad=function(){this._abortController?
(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2);this._loader=null};return a}();a.Loadable=n})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("require exports tslib ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodResources".split(" "),function(n,a,d,l,k,e,c,h,m){function f(a){for(var b=
0,c=0,d=!1,e={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}},f=0;f<a.length;f++){var g=a[f];k.isNone(g)||(b+=g.primitivesPerFeature,c+=g.primitivesPerCoordinate,e.bytesPerFeature+=g.memory.bytesPerFeature,e.bytesPerFeatureLabel+=g.memory.bytesPerFeatureLabel,e.bytesPerCoordinate+=g.memory.bytesPerCoordinate,e.draped.bytesPerFeature+=g.memory.bytesPerFeature,e.draped.bytesPerFeatureLabel+=g.memory.bytesPerFeatureLabel,
e.draped.bytesPerCoordinate+=g.memory.bytesPerCoordinate,d=d||g.estimated)}return{primitivesPerFeature:b,primitivesPerCoordinate:c,estimated:d,memory:e}}function b(a,b){var c=g(a,b);switch(b.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,estimated:!1,memory:c};case "fill":return"mesh-3d"===a.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!1,memory:c}:k.isSome(b.outline)&&0<b.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,estimated:!1,
memory:c}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:c};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:c};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,estimated:!1,memory:c};case "object":return b.resource&&b.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,estimated:!0,memory:c}:d.__assign(d.__assign({},p(b.resource&&b.resource.primitive||e.defaultPrimitive)),{memory:c});case "path":var f=
a=0;switch(b.profile){case "circle":a=10;break;case "quad":a=4;break;default:l.neverReached(b.profile);return}switch(b.join){case "round":f=3;break;case "miter":case "bevel":f=1;break;default:l.neverReached(b.join);return}var h=2*a,f=a*f*2,m=-2*f-h;switch(b.cap){case "none":break;case "butt":case "square":m+=2*(a-1);break;case "round":m+=2*(4*a+a);break;default:l.neverReached(b.cap);return}return{primitivesPerFeature:m,primitivesPerCoordinate:f+h,estimated:!1,memory:c};case "text":case "icon":return{primitivesPerFeature:2,
primitivesPerCoordinate:0,estimated:!1,memory:c};default:l.neverReached(b)}}function g(b,c){b="point-3d"===b.type;switch(c.type){case "extrude":return c.edges&&0<c.edges.size?a.memoryEstimators.EXTRUDE_EDGES:a.memoryEstimators.EXTRUDE;case "fill":return k.isSome(c.outline)&&0<c.outline.size?a.memoryEstimators.FILL_OUTLINE:a.memoryEstimators.FILL;case "water":return a.memoryEstimators.FILL;case "line":return"round"===c.join?a.memoryEstimators.LINE_ROUND:a.memoryEstimators.LINE_MITER;case "path":switch(c.join){case "round":switch(c.profile){case "circle":return a.memoryEstimators.PATH_ROUND_CIRCLE;
case "quad":return a.memoryEstimators.PATH_ROUND_QUAD;default:l.neverReached(c.profile);return}case "miter":case "bevel":switch(c.profile){case "circle":return a.memoryEstimators.PATH_MITER_CIRCLE;case "quad":return a.memoryEstimators.PATH_MITER_QUAD;default:l.neverReached(c.profile);return}default:l.neverReached(c.join);return}case "object":return b?a.memoryEstimators.OBJECT_POINT:a.memoryEstimators.OBJECT_POLYGON;case "icon":case "text":return b?a.memoryEstimators.ICON_POINT:a.memoryEstimators.ICON_POLYGON;
default:l.neverReached(c)}}function p(a){var b=t[a];if(b)return b;b=c.primitiveLodResources(a,null,null);b={primitivesPerFeature:m.geometriesFromLodLevelResources(b.levels[0]).reduce(function(a,b){return a+b.data.getIndices(h.VertexAttrConstants.POSITION).length/3},0),primitivesPerCoordinate:0,estimated:!1};return t[a]=b}Object.defineProperty(a,"__esModule",{value:!0});a.memoryEstimators=a.defaultSymbolLayerMemoryComplexity=a.defaultSymbolLayerComplexity=a.totalSymbolComplexities=a.defaultSymbolComplexity=
a.emptySymbolComplexity=void 0;a.emptySymbolComplexity={primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};a.defaultSymbolComplexity=function(c){if("web-style"===c.type)return a.emptySymbolComplexity;var d=c.symbolLayers.toArray().map(function(a){return b(c,a)});return f(d)};a.totalSymbolComplexities=f;var t={};a.defaultSymbolLayerComplexity=b;a.defaultSymbolLayerMemoryComplexity=
g;a.memoryEstimators={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,
bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,
draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,
bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},
PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,
bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,
bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}}})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["require","exports","../../../../core/compilerUtils","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/GeometryUtil"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.primitiveLodResources=a.primitiveGeometryData=a.isValidPrimitive=
void 0;a.isValidPrimitive=function(a){switch(a){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};a.primitiveGeometryData=function(a){switch(a){case "sphere":return k.createPolySphereGeometry(.5,2,!0);case "cube":return k.createBoxGeometry(1);case "cylinder":return k.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return k.cgToGIS(k.createConeGeometry(1,.5,15,!1));case "inverted-cone":return k.cgToGIS(k.createConeGeometry(1,
.5,15,!0));case "tetrahedron":return k.cgToGIS(k.createTetrahedronGeometry(1));case "diamond":return k.cgToGIS(k.createDiamondGeometry(1));default:d.neverReached(a)}};a.primitiveLodResources=function(a,h,m){var c=function(a,c,d){void 0===d&&(d=!1);return{levels:a.map(function(a,b){var e=c(a.tesselation);d&&k.cgToGIS(e);return{components:[{geometry:new l(e,m+("_lod"+b)),material:h}],faceCount:e.indexCount/3,minScreenSpaceRadius:a.minScreenSpaceRadius}})}};switch(a){case "sphere":return c([{tesselation:0,
minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],function(a){return k.createPolySphereGeometry(.5,a,!0)});case "cube":return c([{tesselation:0,minScreenSpaceRadius:0}],function(){return k.createBoxGeometry(1)});case "cone":return c(e,function(a){return k.createConeGeometry(1,.5,a,!1)},!0);case "inverted-cone":return c(e,function(a){return k.createConeGeometry(1,.5,
a,!0)},!0);case "cylinder":return c(e,function(a){return k.createCylinderGeometry(1,.5,a,[0,0,1],[0,0,.5])});case "tetrahedron":return c([{tesselation:0,minScreenSpaceRadius:0}],function(){return k.createTetrahedronGeometry(1)},!0);case "diamond":return c([{tesselation:0,minScreenSpaceRadius:0}],function(){return k.createDiamondGeometry(1)},!0);default:d.neverReached(a)}};var e=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]})},
"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),function(n,a,d,l,k,e,c){return function(){function a(c,d,b){this._boundingInfo=null;this._id=a.__idGen.gen(d);this._data=c;this._boundingInfo=b}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0});
a.prototype.getIndices=function(a){return this.data.getIndices(a)};Object.defineProperty(a.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!1,configurable:!0});a.prototype.getAttribute=function(a){return this.data.getAttribute(a)};Object.defineProperty(a.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"boundingInfo",{get:function(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo},enumerable:!1,configurable:!0});a.prototype.computeAttachmentOrigin=function(a){return"triangle"===this.data.primitiveType?this.computeAttachmentOriginTriangles(a):this.computeAttachmentOriginPoints(a)};a.prototype.computeAttachmentOriginTriangles=function(a){var d=this.getIndices(c.VertexAttrConstants.POSITION),b=this.getAttribute(c.VertexAttrConstants.POSITION);
return l.computeAttachmentOriginTriangles(b,d,a)};a.prototype.computeAttachmentOriginPoints=function(a){var d=this.getIndices(c.VertexAttrConstants.POSITION),b=this.getAttribute(c.VertexAttrConstants.POSITION);return l.computeAttachmentOriginPoints(b,d,a)};a.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null};a.prototype._calculateBoundingInfo=function(){var a=this.data.getIndices(c.VertexAttrConstants.POSITION),f=this.data.getAttribute(c.VertexAttrConstants.POSITION),b="triangle"===
this.data.primitiveType?3:1;if(0===a.length)for(var a=new Uint32Array(b),g=0;g<b;++g)a[g]=g;g=a.length;e.assert(0===g%b,"Indexing error: "+g.toFixed(0)+" not divisible by "+b.toFixed(0));g=l.generateDefaultIndexArray(g/b);return new d(g,b,a,f)};a.__idGen=new k.IdGen;return a}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Util".split(" "),function(n,
a,d,l,k,e){n=function(){function a(c,d,f,b){this.primitiveIndices=c;this._numIndexPerPrimitive=d;this.indices=f;this._position=b;this.center=k.vec3f64.create();e.assert(1<=c.length);e.assert(0===f.length%this._numIndexPerPrimitive);e.assert(f.length>=c.length*this._numIndexPerPrimitive);e.assert(3===this._position.size||4===this._position.size);b=this._position;d=b.data;var g=b.offsetIdx,h=b.strideIdx;b=0;var m=c.length,u=g+h*f[this._numIndexPerPrimitive*c[b]];a.tmpIndices.clear();a.tmpIndices.push(u);
this.bbMin=k.vec3f64.fromValues(d[u],d[u+1],d[u+2]);for(this.bbMax=k.vec3f64.clone(this.bbMin);b<m;++b)for(var r=this._numIndexPerPrimitive*c[b],q=0;q<this._numIndexPerPrimitive;++q){u=g+h*f[r+q];a.tmpIndices.push(u);var v=d[u];this.bbMin[0]=Math.min(v,this.bbMin[0]);this.bbMax[0]=Math.max(v,this.bbMax[0]);v=d[u+1];this.bbMin[1]=Math.min(v,this.bbMin[1]);this.bbMax[1]=Math.max(v,this.bbMax[1]);v=d[u+2];this.bbMin[2]=Math.min(v,this.bbMin[2]);this.bbMax[2]=Math.max(v,this.bbMax[2])}l.vec3.lerp(this.center,
this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);c=this.bsRadius*this.bsRadius;for(b=0;b<a.tmpIndices.length;++b)u=a.tmpIndices.data[b],f=d[u]-this.center[0],g=d[u+1]-this.center[1],u=d[u+2]-this.center[2],h=f*f+g*g+u*u,h<=c||(h=Math.sqrt(h),m=.5*(h-this.bsRadius),this.bsRadius+=m,c=this.bsRadius*this.bsRadius,h=m/h,this.center[0]+=f*h,this.center[1]+=g*h,this.center[2]+=u*h);a.tmpIndices.clear()}a.prototype.getCenter=
function(){return this.center};a.prototype.getBSRadius=function(){return this.bsRadius};a.prototype.getBBMin=function(){return this.bbMin};a.prototype.getBBMax=function(){return this.bbMax};a.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};a.prototype.getIndices=function(){return this.indices};a.prototype.getPosition=function(){return this._position};a.prototype.getChildren=function(){if(this._children)return this._children;if(1<l.vec3.squaredDistance(this.bbMin,this.bbMax)){for(var c=
l.vec3.lerp(k.vec3f64.create(),this.bbMin,this.bbMax,.5),d=this.primitiveIndices.length,e=new Uint8Array(d),b=Array(8),g=0;8>g;++g)b[g]=0;for(var g=this._position,p=g.data,t=g.offsetIdx,u=g.strideIdx,g=0;g<d;++g){for(var r=0,q=this._numIndexPerPrimitive*this.primitiveIndices[g],v=t+u*this.indices[q],w=p[v],z=p[v+1],x=p[v+2],B=1;B<this._numIndexPerPrimitive;++B){var v=t+u*this.indices[q+B],A=p[v],C=p[v+1],v=p[v+2];A<w&&(w=A);C<z&&(z=C);v<x&&(x=v)}w<c[0]&&(r|=1);z<c[1]&&(r|=2);x<c[2]&&(r|=4);e[g]=r;
++b[r]}for(g=c=0;8>g;++g)0<b[g]&&++c;if(2>c)return;c=Array(8);for(g=0;8>g;++g)c[g]=0<b[g]?new Uint32Array(b[g]):void 0;for(g=0;8>g;++g)b[g]=0;for(g=0;g<d;++g)r=e[g],c[r][b[r]++]=this.primitiveIndices[g];this._children=Array(8);for(g=0;8>g;++g)void 0!==c[g]&&(this._children[g]=new a(c[g],this._numIndexPerPrimitive,this.indices,this._position))}return this._children};return a}();(n||(n={})).tmpIndices=new d({deallocator:null});return n})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["require",
"exports","../../../../../core/arrayUtils"],function(n,a,d){function l(a){var e=[];a.components.forEach(function(a){e.push(a.geometry)});return d.unique(e)}Object.defineProperty(a,"__esModule",{value:!0});a.computeFaceCount=a.geometriesFromLodResources=a.geometriesFromLodLevelResources=a.texturesFromLodResources=a.materialsFromLodResources=void 0;a.materialsFromLodResources=function(a){var e=[];a.levels.forEach(function(a){a.components.forEach(function(a){e.push(a.material)})});return d.unique(e)};
a.texturesFromLodResources=function(a){var e=[];a.levels.forEach(function(a){a.components.forEach(function(a){a.textures&&e.push.apply(e,a.textures)})});return d.unique(e)};a.geometriesFromLodLevelResources=l;a.geometriesFromLodResources=function(a){var e=[];a.levels.forEach(function(a){a.components.forEach(function(a){e.push(a.geometry)})});return d.unique(e)};a.computeFaceCount=function(a){var d=0;l(a).forEach(function(a){d+=a.data.indexCount/3});return d}})},"esri/views/3d/layers/graphics/pointUtils":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./elevationAlignmentUtils ./graphicUtils ../../support/pointUtils ../../webgl-engine/lib/Object3D".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p){Object.defineProperty(a,"__esModule",{value:!0});a.geometryToRenderInfo=a.placePointOnGeometry=a.extendPointGraphicElevationContext=a.createStageObjectForHUD=void 0;var t=k.vec3f64.create();a.createStageObjectForHUD=function(a,b,c,h,m,k,x,B,A,C,E){var r=c?c.length:0,q=a.clippingExtent;g.pointToVector(b,t,a.elevationProvider.spatialReference);if(d.isSome(q)&&!e.containsPoint(q,t))return null;g.pointToVector(b,t,a.renderCoordsHelper.spatialReference);q=a.localOriginFactory.getOrigin(t);
B=new p({castShadow:!1,metadata:{layerUid:A,graphicUid:C,usesVerticalDistanceToGround:!0},idHint:B});for(A=0;A<r;A++)B.addGeometry(c[A],h[A],m?m[A]:l.mat4f64.IDENTITY,k,q,E);a=f.applyElevationAlignmentForHUD(B,b,a.elevationProvider,a.renderCoordsHelper,x);return{object:B,sampledElevation:a}};a.extendPointGraphicElevationContext=function(a,b,c){a=a.elevationContext;c=c.spatialReference;g.pointToVector(b,t,c);a.centerPointInElevationSR=h.makeDehydratedPoint(t[0],t[1],b.hasZ?t[2]:0,c)};a.placePointOnGeometry=
function(a){switch(a.type){case "point":return a;case "polygon":case "extent":return b.computeCentroid(a);case "polyline":var d=a.paths[0];if(!d||0===d.length)break;d=c.getPointOnPath(d,c.getPathLength(d)/2);return h.makeDehydratedPoint(d[0],d[1],d[2],a.spatialReference);case "mesh":return a.extent.center}return null};a.geometryToRenderInfo=function(a,b,c,d,e){var f=new Float64Array(3*a.length),g=new Float64Array(f.length);a.forEach(function(a,b){f[3*b+0]=a[0];f[3*b+1]=a[1];f[3*b+2]=2<a.length?a[2]:
0});b=m.applyPerVertexElevationAlignment(f,b,0,g,0,f,0,f.length/3,c,d,e);return{numVertices:a.length,position:f,mapPosition:g,projectionSuccess:null!=b,sampledElevation:b}}})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ../shaders/LineCalloutTechnique".split(" "),function(n,
a,d,l,k,e,c,h,m,f,b){n=function(a){function c(d,e){e=a.call(this,e)||this;e.techniqueConfig=new b.LineCalloutTechniqueConfiguration;e.params=f.copyParameters(d,p);e._uniqueMaterialIdentifier=c.uniqueMaterialIdentifier(e.params);return e}d.__extends(c,a);Object.defineProperty(c.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!1,configurable:!0});c.prototype.dispose=function(){};c.prototype.getGLMaterial=function(a){return 0===a.output?new g(a):
void 0};c.prototype.getPassParameters=function(){return this.params};c.prototype.getTechniqueConfig=function(a){this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.depthHudEnabled=a;this.techniqueConfig.depthHudAlignStartEnabled=!!this.params.depthHUDAlignStart;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===
this.params.centerOffsetUnits?1:0;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;return this.techniqueConfig};c.prototype.intersect=function(){};c.prototype.createBufferWriter=function(){return new r};c.prototype.setParameterValues=function(a){f.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=c.uniqueMaterialIdentifier(this.params),this.parametersChanged())};c.prototype.getParameters=function(){return this.params};c.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||
[0,0],centerOffsetUnits:a.centerOffsetUnits||"world"})};return c}(c.Material);var g=function(a){function c(b){b=a.call(this,b)||this;b.isRenderSlot=!0;b.updateParameters();return b}d.__extends(c,a);c.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(b.LineCalloutTechnique,this.material.getTechniqueConfig(!1),this.technique);this.depthTechnique=this.techniqueRep.acquireAndReleaseExisting(b.LineCalloutTechnique,this.material.getTechniqueConfig(!0),this.depthTechnique)};
c.prototype.beginSlot=function(a){switch(a){case 20:return this.isRenderSlot=!0;case 21:return this.isRenderSlot=!1,!0}return!1};c.prototype.getTechnique=function(){return this.isRenderSlot?this.technique:this.depthTechnique};c.prototype.bind=function(a,b){var c=this.getTechnique();a.bindProgram(c.program);c.bindPass(a,this.material.getPassParameters(),b)};return c}(e.GLMaterial),p={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,
shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},t=k.newLayout().vec3f(h.VertexAttrConstants.POSITION).vec3f(h.VertexAttrConstants.NORMAL).vec2f(h.VertexAttrConstants.UV0).vec4f(h.VertexAttrConstants.AUXPOS1),u=[l.vec2f32.fromValues(0,0),l.vec2f32.fromValues(1,0),l.vec2f32.fromValues(0,1),l.vec2f32.fromValues(1,0),l.vec2f32.fromValues(1,1),l.vec2f32.fromValues(0,1)],r=function(){function a(){this.vertexBufferLayout=t}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return 6*a.indices[h.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d){m.writePosition(b.indices[h.VertexAttrConstants.POSITION],b.vertexAttr[h.VertexAttrConstants.POSITION].data,a.transformation,c.position,d,6);m.writeNormal(b.indices[h.VertexAttrConstants.NORMAL],b.vertexAttr[h.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,c.normal,d,6);m.writeBufferVec4(b.indices[h.VertexAttrConstants.AUXPOS1],b.vertexAttr[h.VertexAttrConstants.AUXPOS1].data,
c.auxpos1,d,6);for(a=0;a<u.length;++a)c.uv0.setVec(d+a,u[a])};return a}();return n})},"esri/core/libs/gl-matrix-2/vec2f32":function(){define(["require","exports","./factories/vec2f32"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.vec2f32=void 0;a.vec2f32=d})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["require","exports"],function(n,a){function d(){return new Float32Array(2)}function l(a,c){var d=new Float32Array(2);d[0]=a;d[1]=c;return d}function k(){return l(1,
1)}function e(){return l(1,0)}function c(){return l(0,1)}Object.defineProperty(a,"__esModule",{value:!0});a.UNIT_Y=a.UNIT_X=a.ONES=a.ZEROS=a.unitY=a.unitX=a.ones=a.zeros=a.createView=a.fromValues=a.clone=a.create=void 0;a.create=d;a.clone=function(a){var c=new Float32Array(2);c[0]=a[0];c[1]=a[1];return c};a.fromValues=l;a.createView=function(a,c){return new Float32Array(a,c,2)};a.zeros=function(){return d()};a.ones=k;a.unitX=e;a.unitY=c;a.ZEROS=d();a.ONES=k();a.UNIT_X=e();a.UNIT_Y=c()})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../materials/internal/MaterialUtil ./LineCallout.glsl ./LineCallout.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){Object.defineProperty(a,"__esModule",{value:!0});a.LineCalloutTechniqueConfiguration=a.LineCalloutTechnique=void 0;h=function(a){function h(){return null!==a&&a.apply(this,arguments)||this}d.__extends(h,a);h.prototype.initializeProgram=function(a){var b=h.shader.get(),c=this.configuration,b=b.build({occlusionTestEnabled:c.occlusionTestEnabled,verticalOffsetEnabled:c.verticalOffset,screenSizePerspectiveEnabled:c.screenSizePerspective,depthHudEnabled:c.depthHudEnabled,
depthHudAlignStartEnabled:c.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:c.screenCenterOffsetUnitsEnabled,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:a.viewingMode});return new t(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),f.Default3D)};h.prototype.bindPass=function(a,c,d){e.View.bindProjectionMatrix(this.program,d.camera.projectionMatrix);p.LineCallout.bindUniforms(this.program,c,d.camera.pixelRatio||
1);k.VerticalOffset.bindUniforms(this.program,c,d);this.program.setUniform1i("hudVisibilityTexture",0);a.bindTexture(d.hudVisibilityTexture,0);this.program.setUniform1f("cameraGroundRelative",d.camera.aboveGround?1:-1);this.program.setUniform1f("polygonOffset",c.shaderPolygonOffset);e.View.bindViewport(this.program,d);this.program.setUniform1f("perDistancePixelRatio",Math.tan(d.camera.fovY/2)/(d.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",d.camera.viewInverseTransposeMatrix);
this.program.setUniform2f("pixelToNDC",2/d.camera.fullViewport[2],2/d.camera.fullViewport[3]);this.program.setUniform1f("lineSize",Math.ceil(c.size)*(d.camera.pixelRatio||1));b.bindScreenSizePerspective(c.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")};h.prototype.bindDraw=function(a){e.View.bindView(this.program,a);e.View.bindCamPosition(this.program,a.origin,a.camera.viewInverseTransposeMatrix);l.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};h.prototype.initializePipeline=
function(){return this.configuration.depthHudEnabled?r.makePipelineState({depthTest:{func:513},depthWrite:u.defaultDepthWriteParams}):r.makePipelineState({blending:r.separateBlendingParams(1,770,771,771),depthTest:{func:513},colorWrite:r.defaultColorWriteParams})};h.shader=new c.ReloadableShaderModule(g,function(){return new Promise(function(a,b){n(["./LineCallout.glsl"],a,b)})});return h}(h.ShaderTechnique);a.LineCalloutTechnique=h;h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||
this;b.occlusionTestEnabled=!0;b.verticalOffset=!1;b.screenSizePerspective=!1;b.depthHudEnabled=!1;b.depthHudAlignStartEnabled=!1;b.screenCenterOffsetUnitsEnabled=0;b.slicePlaneEnabled=!1;return b}d.__extends(b,a);d.__decorate([m.parameter()],b.prototype,"occlusionTestEnabled",void 0);d.__decorate([m.parameter()],b.prototype,"verticalOffset",void 0);d.__decorate([m.parameter()],b.prototype,"screenSizePerspective",void 0);d.__decorate([m.parameter()],b.prototype,"depthHudEnabled",void 0);d.__decorate([m.parameter()],
b.prototype,"depthHudAlignStartEnabled",void 0);d.__decorate([m.parameter({count:2})],b.prototype,"screenCenterOffsetUnitsEnabled",void 0);d.__decorate([m.parameter()],b.prototype,"slicePlaneEnabled",void 0);return b}(m.ShaderTechniqueConfiguration);a.LineCalloutTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/LineCallout.glsl":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/hud/AlignPixel.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,a,d,l,k,e,c,h){function m(a,b,c){3===c.length?a.setUniform4f(b,c[0],c[1],c[2],1):a.setUniform4fv(b,c)}Object.defineProperty(a,"__esModule",{value:!0});a.LineCallout=a.build=void 0;a.build=function(a){var m=new h.ShaderBuilder;m.include(k.AlignPixel);m.include(e.HUD,a);m.include(l.Slice,a);m.attributes.add("uv0","vec2");m.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2");m.varyings.add("coverageSampling","vec4");m.varyings.add("lineSizes",
"vec2");m.vertex.code.add(c.glsl(q||(q=d.__makeTemplateObject(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint \x3d projectPositionHUD(projectAux);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ","\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView \x3d (view * vec4(position, 1.0)).xyz;\n      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n      vec4 startPoint \x3d proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\n    ",
"\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding \x3d 1.0 + borderSizeScaled;\n      vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\n\n      coverageSampling \x3d vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position \x3d projectedPosition;\n    }\n  "],
["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint \x3d projectPositionHUD(projectAux);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ","\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView \x3d (view * vec4(position, 1.0)).xyz;\n      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n      vec4 startPoint \x3d proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\n    ",
"\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding \x3d 1.0 + borderSizeScaled;\n      vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\n\n      coverageSampling \x3d vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position \x3d projectedPosition;\n    }\n  "])),
a.occlusionTestEnabled?c.glsl(f||(f=d.__makeTemplateObject(["\n      if (!testVisibilityHUD(endPoint)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"],["\n      if (!testVisibilityHUD(endPoint)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"]))):"",a.screenSizePerspectiveEnabled?c.glsl(b||(b=d.__makeTemplateObject(["\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "],
["\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "]))):c.glsl(g||(g=d.__makeTemplateObject(["\n      vec2 screenOffsetScaled \x3d screenOffset;\n        "],["\n      vec2 screenOffsetScaled \x3d screenOffset;\n        "]))),a.depthHudEnabled?a.depthHudAlignStartEnabled?c.glsl(p||
(p=d.__makeTemplateObject(["endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"],["endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"]))):c.glsl(t||(t=d.__makeTemplateObject(["startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"],["startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"]))):"",a.screenSizePerspectiveEnabled?c.glsl(u||(u=d.__makeTemplateObject(["\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "],
["\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "]))):c.glsl(r||(r=d.__makeTemplateObject(["\n      float lineSizeScaled \x3d lineSize;\n      float borderSizeScaled \x3d borderSize;\n        "],["\n      float lineSizeScaled \x3d lineSize;\n      float borderSizeScaled \x3d borderSize;\n        "])))));m.fragment.uniforms.add("color",
"vec4");m.fragment.uniforms.add("borderColor","vec4");m.fragment.code.add(c.glsl(z||(z=d.__makeTemplateObject(["\n    void main() {\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line\n      // blends on top of the border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage\n      // and the color alpha\n      float borderAlpha \x3d color.a * borderColor.a * coverage.y;\n      float colorAlpha \x3d color.a * coverage.x;\n\n      float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\n\n    ",
"\n  }\n  "],["\n    void main() {\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line\n      // blends on top of the border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage\n      // and the color alpha\n      float borderAlpha \x3d color.a * borderColor.a * coverage.y;\n      float colorAlpha \x3d color.a * coverage.x;\n\n      float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\n\n    ",
"\n  }\n  "])),a.depthHudEnabled?c.glsl(v||(v=d.__makeTemplateObject(["\n      if (finalAlpha \x3c 0.01) {\n        discard;\n      }\n      "],["\n      if (finalAlpha \x3c 0.01) {\n        discard;\n      }\n      "]))):c.glsl(w||(w=d.__makeTemplateObject(["\n      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n      // need to divide by finalAlpha). We avoid the division here by setting the\n      // appropriate blending function in the material.\n      vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n      gl_FragColor \x3d vec4(finalRgb, finalAlpha);\n      "],
["\n      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n      // need to divide by finalAlpha). We avoid the division here by setting the\n      // appropriate blending function in the material.\n      vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n      gl_FragColor \x3d vec4(finalRgb, finalAlpha);\n      "])))));return m};(function(a){a.bindUniforms=function(a,b,c){m(a,"color",b.color);a.setUniform1f("pixelRatio",c);a.setUniform2f("screenOffset",
b.screenOffset[0]*c,b.screenOffset[1]*c);null!==b.borderColor?(m(a,"borderColor",b.borderColor),a.setUniform1f("borderSize",c)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))}})(a.LineCallout||(a.LineCallout={}));var f,b,g,p,t,u,r,q,v,w,z})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["require","exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.getGraphics3DSymbol=void 0;
a.getGraphics3DSymbol=function(a){return a instanceof l?a.graphics3DSymbol:a instanceof d?a:null}})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports tslib ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./Loadable ./symbolComplexity".split(" "),function(n,a,d,l,k,e,c,h,m,f,b){var g={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(a){function f(b,
c,d){var e=a.call(this)||this;e._symbol=b;e._context=c;e._backgroundLayers=d;e._destroyed=!1;e.symbolLayers=[];e.referenced=0;e._extentPadding=0;return e}d.__extends(f,a);Object.defineProperty(f.prototype,"symbol",{get:function(){return this._symbol},set:function(a){this._symbol=a;if(this.symbolLayers)for(var b=0;b<a.symbolLayers.length;b++){var c=this.symbolLayers[b];k.isNone(c)||(c.symbol=a,c.symbolLayer=a.symbolLayers.items[b])}},enumerable:!1,configurable:!0});f.prototype.doLoad=function(a){return d.__awaiter(this,
void 0,void 0,function(){var b,c,f,h,p,t,u,A,C,E=this;return d.__generator(this,function(r){switch(r.label){case 0:b=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(b=this._backgroundLayers.concat(b));for(c=b.length;this.symbolLayers.length<b.length;)this.symbolLayers.push(null);this.symbolLayers.length=b.length;f=[];h=function(d){var h=b.getItemAt(d);if(!1===h.enabled)return"continue";g.renderPriority=1-(1+d)/c;g.renderPriorityStep=1/c;g.ignoreDrivers=h._ignoreDrivers;var k=
m.make(p.symbol,h,p._context,g);f.push(e.onAbortOrThrow(a,function(){E.symbolLayers[d]=null;k.destroy()}));p.symbolLayers[d]=k};p=this;for(t=0;t<c;t++)h(t);return[4,l.forEach(this.symbolLayers,function(a,b){return d.__awaiter(E,void 0,void 0,function(){return d.__generator(this,function(c){switch(c.label){case 0:if(!k.isSome(a))return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,a.load()];case 2:return c.sent(),this._extentPadding+=Math.max(this._extentPadding,a.extentPadding),[3,4];case 3:return c.sent(),
this.symbolLayers[b]=null,[3,4];case 4:return[2]}})})})];case 1:r.sent();u=0;for(A=f;u<A.length;u++)C=A[u],null===C||void 0===C?void 0:C.remove();f.length=0;e.throwIfAborted(a);if(this.symbolLayers.length&&!this.symbolLayers.some(function(a){return!!a}))throw Error();return[2]}})})};f.prototype.getSymbolLayerSize=function(a){a=this.symbolLayers[a];return k.isSome(a)?a.getCachedSize():null};Object.defineProperty(f.prototype,"extentPadding",{get:function(){return this._extentPadding},enumerable:!1,
configurable:!0});f.prototype.createGraphics3DGraphic=function(a,b){for(var d=a.graphic,e=Array(this.symbolLayers.length),f=0;f<this.symbolLayers.length;f++){var g=this.symbolLayers[f];e[f]=k.isSome(g)?g.createGraphics3DGraphic(a):null}return new c(d,b||this,e,a.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};Object.defineProperty(f.prototype,"complexity",{get:function(){return b.totalSymbolComplexities(this.symbolLayers.map(function(a){return k.get(a,
"complexity")}))},enumerable:!1,configurable:!0});f.prototype.globalPropertyChanged=function(a,b){for(var c=this.symbolLayers.length,d=function(c){var d=e.symbolLayers[c],f=function(a){a=a._graphics[c];return a instanceof h?a:null};if(k.isSome(d)&&!d.globalPropertyChanged(a,b,f))return{value:!1}},e=this,f=0;f<c;f++){var g=d(f);if("object"===typeof g)return g.value}return!0};f.prototype.applyRendererDiff=function(a,b){return 1!==this.loadStatus?!1:this.symbolLayers.reduce(function(c,d){return c&&(k.isNone(d)||
d.applyRendererDiff(a,b))},!0)};f.prototype.prepareSymbolPatch=function(a){if(2!==this.loadStatus&&"partial"===a.diff.type){var b=a.diff.diff;if(b.symbolLayers&&"partial"===b.symbolLayers.type){var c=b.symbolLayers.diff;this.symbolLayers.forEach(function(b,d){var e;if(!k.isNone(b)){var f=c[d];if(f){var g={diff:f,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};b.prepareSymbolLayerPatch(g);(e=a.symbolStatePatches).push.apply(e,g.symbolLayerStatePatches);g.graphics3DGraphicPatches.length&&a.graphics3DGraphicPatches.push(function(a,
b){var c=a._graphics[d];k.isSome(c)&&g.graphics3DGraphicPatches.forEach(function(a){return a(c,b)})})}}})}}};f.prototype.updateGeometry=function(a,b){for(var c=0;c<this.symbolLayers.length;c++){var d=this.symbolLayers[c];if(!k.isNone(d)){var e=a._graphics[c];if(k.isNone(e)||!d.updateGeometry(e,b))return!1}}return!0};f.prototype.onRemoveGraphic=function(a){for(var b=0;b<this.symbolLayers.length;b++){var c=this.symbolLayers[b];if(!k.isNone(c)){var d=a._graphics[b];if(k.isSome(d))c.onRemoveGraphic(d)}}};
f.prototype.getFastUpdateStatus=function(){var a=0,b=0,c=0;this.symbolLayers.forEach(function(d){k.isNone(d)||(0===d.loadStatus?a++:d.isFastUpdatesEnabled()?c++:b++)});return{loading:a,slow:b,fast:c}};f.prototype.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();for(var a=0,b=this.symbolLayers;a<b.length;a++){var c=b[a];k.isSome(c)&&c.destroy()}this.symbolLayers.length=0;this._destroyed=!0}};Object.defineProperty(f.prototype,
"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0});return f}(f.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports tslib ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q){var v=new e(Array,function(a){return g.set(a,g.ZERO)},null,10,5),w=p.create();return function(){function a(a,b,c,d,e){this._labelGraphics=[];this._auxiliaryGraphics=[];for(var f=Array(2),g=0;g<f.length;g++)f[g]=Array(4);this._visibilityFlags=f;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;this.isElevationSource=!1;++b.referenced;this.graphics3DSymbol=b;this.graphic=a;this._graphics=c;this._featureExpressionFeature=
e?r.createFeature(e,a,d):null;a=0;for(b=this._graphics;a<b.length;a++)c=b[a],k.isSome(c)&&(this.isElevationSource=this.isElevationSource||c.isElevationSource)}Object.defineProperty(a.prototype,"labelGraphics",{get:function(){return this._labelGraphics},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"extent",{get:function(){return this._extent},enumerable:!1,configurable:!0});a.prototype.initialize=function(a,b,c){var d=this;this._layer=b;this._stage=a;this.forEachSymbolLayerGraphic(function(e){e.initialize(a,
b,c);e.setVisibility(d.isVisible())})};a.prototype.destroy=function(){this.forEachSymbolLayerGraphic(function(a){return a.destroy()});this._auxiliaryGraphics=this._graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null};Object.defineProperty(a.prototype,"destroyed",{get:function(){return null==this._graphics},enumerable:!1,configurable:!0});a.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};a.prototype.addLabelGraphic=
function(a,b,c){this._labelGraphics.push(a);a.initialize(b,c);a.setVisibility(this.isVisible(1))};a.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._stage,this._layer),a.setVisibility(this.isVisible()))};Object.defineProperty(a.prototype,"isDraped",{get:function(){var a=!1;this.forEachSymbolLayerGraphic(function(b){"draped"===b.type&&(a=!0)});return a},enumerable:!1,configurable:!0});a.prototype.isVisible=function(a,b){void 0===a&&(a=0);for(var c=
0;c<=a;c++)for(var d=this._visibilityFlags[c],e=0;e<d.length;++e)if(!1===d[e]&&e!==b)return!1;return!0};a.prototype.hasVisibilityFlag=function(a,b){return null!=this._visibilityFlags[b][a]};a.prototype.setVisibilityFlag=function(a,b,c){var d=this.isVisible(c);this._visibilityFlags[c][a]=b;var e=this.isVisible(c);if(d===e)return!1;if(1===c)this.forEachLabelGraphic(function(a){return a.setVisibility(e)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(e)});var f=this.isVisible(1);
this.forEachLabelGraphic(function(a){return a.setVisibility(f)})}return!0};a.prototype.clearVisibilityFlag=function(a,b){void 0===b&&(b=0);return this.setVisibilityFlag(a,void 0,b)};a.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});return a};a.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=f.vec3f64.create());if(0===this._graphics.length)return m.vec3.set(a,0,0,0),a;var b=this._graphics[0];return k.isSome(b)?b.getCenterObjectSpace(a):
a};a.prototype.computeExtent=function(a){if(!this._extent){var b=this.graphic.geometry;if(k.isNone(b))return!1;this._extent=p.create();t.computeAABR(b,this._extent);b=b.spatialReference;if(!b.equals(a)&&!q.boundingRectToBoundingRect(this._extent,b,this._extent,a))return this._extent=null,!1}return!0};a.prototype.getAsOptimizedGeometry=function(a,b){if(this._optimizedGeometry.geometry&&this._optimizedGeometry.hasZ===a&&this._optimizedGeometry.hasM===b)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=
this._convertGraphicToOptimizedGeometry(this.graphic,a,b);this._optimizedGeometry.hasZ=a;this._optimizedGeometry.hasM=b;return this._optimizedGeometry.geometry};a.prototype._convertGraphicToOptimizedGeometry=function(a,c,d){a=a.geometry;if("mesh"===a.type||"extent"===a.type)a=b.fromExtent("mesh"===a.type?a.extent:a);return u.convertFromGeometry(a,c,d)};Object.defineProperty(a.prototype,"usedMemory",{get:function(){var a=this,b=t.estimateAttributesObjectSize(this.graphic.attributes);this.forEachSymbolLayerGraphic(function(c){var d=
c.graphics3DSymbolLayer.complexity;k.isNone(d)||(c="draped"===c.type?d.memory.draped:d.memory,b+=c.bytesPerFeature,c.bytesPerCoordinate&&(b+=t.numVertices(a.graphic.geometry)*c.bytesPerCoordinate))});return b},enumerable:!1,configurable:!0});a.prototype.computeAttachmentOrigin=function(){for(var a={render:{origin:f.vec3f64.create(),num:0},draped:{origin:h.vec2f64.create(),num:0}},b=0,d=this._graphics;b<d.length;b++){var e=d[b];k.isNone(e)||e.computeAttachmentOrigin(a)}a.render.num&&m.vec3.scale(a.render.origin,
a.render.origin,1/a.render.num);a.draped.num&&c.vec2.scale(a.draped.origin,a.draped.origin,1/a.draped.num);return a};a.prototype.getProjectedBoundingBox=function(a,b,c,e,f){return d.__awaiter(this,void 0,void 0,function(){var h=this;return d.__generator(this,function(m){switch(m.label){case 0:return f||(f={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),f.boundingBox?g.empty(f.boundingBox):f.boundingBox=g.empty(),f.requiresDrapedElevation=!1,[4,l.forEach(this._graphics,function(m){return d.__awaiter(h,
void 0,void 0,function(){var h,p,l;return d.__generator(this,function(d){switch(d.label){case 0:if(k.isNone(m))return[2];h="draped"===m.type?b:a;p=v.acquire();return[4,m.getProjectedBoundingBox(h,c,f.screenSpaceObjects,e,p)];case 1:return l=d.sent(),isFinite(l[2])&&isFinite(l[5])||(f.requiresDrapedElevation=!0),l&&g.expand(f.boundingBox,p),v.release(p),[2]}})})})];case 1:return m.sent(),g.allFinite(f.boundingBox)||p.allFinite(g.toRect(f.boundingBox,w))?[2,f]:[2,null]}})})};a.prototype.needsElevationUpdates=
function(){for(var a=0,b=this._graphics;a<b.length;a++){var c=b[a];if(k.isSome(c)&&("object3d"===c.type||"lod-instance"===c.type)&&c.needsElevationUpdates)return!0}a=0;for(b=this._labelGraphics;a<b.length;a++)if((c=b[a])&&c.needsElevationUpdates)return!0;return!1};a.prototype.alignWithElevation=function(a,b,c){var d=this;this.forEachRenderedGraphic(function(e){"object3d"!==e.type&&"lod-instance"!==e.type||e.alignWithElevation(a,b,d._featureExpressionFeature,c)})};a.prototype.addObjectStateSet=function(a,
b){this.forEachSymbolLayerGraphic(function(c){return c.addObjectState(a,b)})};a.prototype.removeObjectState=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeObjectState(a)})};a.prototype.forEachGraphicList=function(a,b){a.forEach(function(a){return a&&b(a)})};a.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};a.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,
a)};a.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return a}()})},"esri/layers/graphics/featureConversionUtils":function(){define("require exports ../../core/Error ../../core/Logger ../../geometry/support/jsonUtils ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),function(n,a,d,l,k,e,c,h){function m(a,b){return a?b?4:3:b?3:2}function f(a,b,c,d){if(a){if(c)return b&&d?ga:ca;if(b&&d)return ba}else if(b&&d)return ca;
return X}function b(a,b){return Math.round((b-a.translate[0])/a.scale[0])}function g(a,b){return Math.round((a.translate[1]-b)/a.scale[1])}function p(a,b){return b*a.scale[0]+a.translate[0]}function t(a,b){return a.translate[1]-b*a.scale[1]}function u(a){a=a.coords;return{x:a[0],y:a[1]}}function r(a,b){a.coords[0]=b.x;a.coords[1]=b.y;return a}function q(a){a=a.coords;return{x:a[0],y:a[1],z:a[2]}}function v(a,b){a.coords[0]=b.x;a.coords[1]=b.y;a.coords[2]=b.z;return a}function w(a){a=a.coords;return{x:a[0],
y:a[1],m:a[2]}}function z(a,b){a.coords[0]=b.x;a.coords[1]=b.y;a.coords[2]=b.m;return a}function x(a){a=a.coords;return{x:a[0],y:a[1],z:a[2],m:a[3]}}function B(a,b){a.coords[0]=b.x;a.coords[1]=b.y;a.coords[2]=b.z;a.coords[3]=b.m;return a}function A(a,b){return a&&b?B:a?v:b?z:r}function C(a,b,c,d,f){c=A(c,d);for(d=0;d<b.length;d++){var g=b[d],m=g.geometry,g=g.attributes,k=void 0;m&&(k=c(new h.default,m));a.push(new e.default(k,g,null,g[f]))}return a}function E(a,b,c,d){for(var e=0;e<b.length;e++){var f=
b[e],g=f.geometry,f=f.attributes,h=void 0;g&&(h=G(g,c,d));a.push({attributes:f,geometry:h})}return a}function G(a,b,c){if(!a)return null;for(var d=m(b,c),e=[],f=0;f<a.coords.length;f+=d){for(var g=[],h=0;h<d;h++)g.push(a.coords[f+h]);e.push(g)}return b?c?{points:e,hasZ:b,hasM:c}:{points:e,hasZ:b}:c?{points:e,hasM:c}:{points:e}}function F(a,b,c,d,f){c=m(c,d);for(d=0;d<b.length;d++){var g=b[d],k=g.geometry,g=g.attributes,p=void 0;k&&(p=H(new h.default,k,c));a.push(new e.default(p,g,null,g[f]))}return a}
function H(a,b,c){void 0===c&&(c=m(b.hasZ,b.hasM));a.lengths[0]=b.points.length;var d=a.coords,e=0,f=0;for(b=b.points;f<b.length;f++)for(var g=b[f],h=0;h<c;h++)d[e++]=g[h];return a}function J(a,b,c){if(!a)return null;var d=m(b,c),e=a.coords,f=[],g=0,h=0;for(a=a.lengths;h<a.length;h++){for(var k=a[h],p=[],l=0;l<k;l++){for(var t=[],r=0;r<d;r++)t.push(e[g++]);p.push(t)}f.push(p)}return b?c?{paths:f,hasZ:b,hasM:c}:{paths:f,hasZ:b}:c?{paths:f,hasM:c}:{paths:f}}function I(a,b,c,d,f){c=m(c,d);for(d=0;d<
b.length;d++){var g=b[d],k=g.geometry,g=g.attributes,p=void 0;k&&(p=K(new h.default,k,c));a.push(new e.default(p,g,null,g[f]))}return a}function K(a,b,c){void 0===c&&(c=m(b.hasZ,b.hasM));var d=a.lengths,e=a.coords,f=0,g=0;for(b=b.paths;g<b.length;g++){for(var h=b[g],k=0,p=h;k<p.length;k++)for(var l=p[k],t=0;t<c;t++)e[f++]=l[t];d.push(h.length)}return a}function L(a,b,c){if(!a)return null;var d=m(b,c),e=a.coords,f=[],g=0,h=0;for(a=a.lengths;h<a.length;h++){for(var k=a[h],p=[],l=0;l<k;l++){for(var t=
[],r=0;r<d;r++)t.push(e[g++]);p.push(t)}f.push(p)}return b?c?{rings:f,hasZ:b,hasM:c}:{rings:f,hasZ:b}:c?{rings:f,hasM:c}:{rings:f}}function M(a,b,c,d,f){for(var g=0;g<b.length;g++){var m=b[g],k=m.geometry,p=m.centroid,m=m.attributes,l=void 0;k&&(l=Q(new h.default,k,c,d));p?a.push(new e.default(l,m,r(new h.default,p),m[f])):a.push(new e.default(l,m,null,m[f]))}return a}function Q(a,b,c,d){void 0===c&&(c=b.hasZ);void 0===d&&(d=b.hasM);R(a,b.rings,c,d);return a}function R(a,b,c,d){c=m(c,d);d=a.lengths;
for(var e=a.coords,f=0,g=d.length=e.length=0;g<b.length;g++){for(var h=b[g],k=0,p=h;k<p.length;k++)for(var l=p[k],t=0;t<c;t++)e[f++]=l[t];d.push(h.length)}return a}function O(a,b,c,f,g,h){a.length=0;if(!c){for(c=0;c<b.length;c++)f=b[c],a.push(new e.default(null,f.attributes,null,f.attributes[h]));return a}switch(c){case "esriGeometryPoint":return C(a,b,f,g,h);case "esriGeometryMultipoint":return F(a,b,f,g,h);case "esriGeometryPolyline":return I(a,b,f,g,h);case "esriGeometryPolygon":return M(a,b,f,
g,h);default:T.error("convertToFeatureSet:unknown-geometry",new d("Unable to parse unknown geometry type '"+c+"'")),a.length=0}return a}function N(a,b,c,e){a=a&&("coords"in a?a:a.geometry);if(!a)return null;switch(b){case "esriGeometryPoint":return b=u,c&&e?b=x:c?b=q:e&&(b=w),b(a);case "esriGeometryMultipoint":return G(a,c,e);case "esriGeometryPolyline":return J(a,c,e);case "esriGeometryPolygon":return L(a,c,e);default:T.error("convertToGeometry:unknown-geometry",new d("Unable to parse unknown geometry type '"+
b+"'"))}}function S(a,b,c,e,f){a.length=0;switch(c){case "esriGeometryPoint":c=u;e&&f?c=x:e?c=q:f&&(c=w);for(e=0;e<b.length;e++){var g=b[e];f=g.geometry;g=g.attributes;f=f?c(f):null;a.push({attributes:g,geometry:f})}break;case "esriGeometryMultipoint":return E(a,b,e,f);case "esriGeometryPolyline":for(c=0;c<b.length;c++){var h=b[c],g=h.geometry,h=h.attributes,m=void 0;g&&(m=J(g,e,f));a.push({attributes:h,geometry:m})}break;case "esriGeometryPolygon":for(c=0;c<b.length;c++){var m=b[c],h=m.geometry,
g=m.attributes,k=m.centroid,m=void 0;h&&(m=L(h,e,f));k?(h=u(k),a.push({attributes:g,centroid:h,geometry:m})):a.push({attributes:g,geometry:m})}break;default:T.error("convertToFeatureSet:unknown-geometry",new d("Unable to parse unknown geometry type '"+c+"'"))}return a}function P(a,c,d,e,h,k,p,l){void 0===p&&(p=d);void 0===l&&(l=e);a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!c||!c.coords.length)return null;h=Y[h];var t=c.coords;c=c.lengths;var r=m(d,e),q=m(d&&p,
e&&l);d=f(d,e,p,l);if(!c.length)return d(a.coords,t,0,0,b(k,t[0]),g(k,t[1])),a.lengths.length&&(a.lengths.length=0),a.coords.length=r,a;for(var u,v=0,w,z=0,x=0;x<c.length;x++){var B=c[x];if(!(B<h)){var A=0;w=z;l=e=b(k,t[v]);u=p=g(k,t[v+1]);d(a.coords,t,w,v,l,u);A++;v+=r;w+=q;for(var C=1;C<B;C++,v+=r)if(l=b(k,t[v]),u=g(k,t[v+1]),l!==e||u!==p)d(a.coords,t,w,v,l-e,u-p),w+=q,A++,e=l,p=u;A>=h&&(a.lengths.push(A),z=w)}}a.coords.length=z;return a.coords.length?a:null}function U(a,b,c,d,e,f,g){for(var h=
d,m=0,k,p=f+c;p<g;p+=c){k=b[p];var l=b[p+1],t=b[g],r=b[g+1],q=b[f],u=b[f+1],v=t-q,w=r-u;if(0!==v||0!==w){var z=((k-q)*v+(l-u)*w)/(v*v+w*w);1<z?(q=t,u=r):0<z&&(q+=v*z,u+=w*z)}v=k-q;w=l-u;k=v*v+w*w;k>h&&(m=p,h=k)}h>d&&(m-f>c&&U(a,b,c,d,e,f,m),e(a,b,a.length,m,b[m],b[m+1]),g-m>c&&U(a,b,c,d,e,m,g))}function Z(a,b,c,d,e){var f=b.coords,g=b.lengths,h=c?d?ga:ca:d?ca:X;c=m(c,d);if(!f.length)return a!==b&&(a.lengths.length=0,a.coords.length=0),a;if(!g.length)return h(a.coords,f,0,0,p(e,f[0]),t(e,f[1])),a!==
b&&(a.lengths.length=0,a.coords.length=c),a;var k=e.scale;d=k[0];for(var k=k[1],l=0,r=0;r<g.length;r++){var q=g[r];a.lengths[r]=q;var u=p(e,f[l]),v=t(e,f[l+1]);h(a.coords,f,l,l,u,v);for(var l=l+c,w=1;w<q;w++,l+=c)u+=f[l]*d,v-=f[l+1]*k,h(a.coords,f,l,l,u,v)}a!==b&&(a.lengths.length=g.length,a.coords.length=f.length);return a}function V(a,b,c,d){for(var e=0,f=a[d*b],g=a[d*(b+1)],h=1;h<c;h++)var m=f+a[d*(b+h)],k=g+a[d*(b+h)+1],p=(m-f)*(k+g),f=m,g=k,e=e+p;return.5*e}Object.defineProperty(a,"__esModule",
{value:!0});a.deltaDecodeGeometry=a.deltaEncodeGeometry=a.getQuantizedArea=a.getSignedQuantizedRingArea=a.removeCollinearVectices=a.removeZMValues=a.unquantizeOptimizedGeometry=a.getQuantizedBoundsOptimizedGeometry=a.getBoundsOptimizedGeometry=a.generalizeOptimizedGeometry=a.quantizeOptimizedGeometry=a.quantizeOptimizedFeatureSet=a.unquantizeOptimizedFeatureSet=a.convertFromFeatureSet=a.convertToFeatureSet=a.convertToFeatures=a.convertToGeometry=a.convertFromGeometry=a.convertToFeature=a.convertFromGraphics=
a.convertFromFeatures=a.convertFromFeature=a.convertFromNestedArray=a.convertFromPolygon=a.convertToPolygon=a.convertFromPolyline=a.convertFromPolylineFeatures=a.convertToPolyline=a.convertFromMultipoint=a.convertFromMultipointFeatures=a.convertToMultipoint=a.convertToMultipointFeatures=a.convertFromPoint=a.convertFromPointFeatures=a.convertToPoint=a.unquantizeY=a.unquantizeX=a.quantizeY=a.quantizeX=void 0;var T=l.getLogger("esri.tasks.support.optimizedFeatureSet"),Y={esriGeometryPoint:0,esriGeometryPolyline:2,
esriGeometryPolygon:3,esriGeometryMultipoint:0},X=function(a,b,c,d,e,f){a[c]=e;a[c+1]=f},ca=function(a,b,c,d,e,f){a[c]=e;a[c+1]=f;a[c+2]=b[d+2]},ba=function(a,b,c,d,e,f){a[c]=e;a[c+1]=f;a[c+2]=b[d+3]},ga=function(a,b,c,d,e,f){a[c]=e;a[c+1]=f;a[c+2]=b[d+2];a[c+3]=b[d+3]};a.quantizeX=b;a.quantizeY=g;a.unquantizeX=p;a.unquantizeY=t;a.convertToPoint=function(a,b,c){return a?b?c?x(a):q(a):c?w(a):u(a):null};a.convertFromPointFeatures=C;a.convertFromPoint=function(a,b,c){void 0===c&&(c=A(null!=b.z,null!=
b.m));return c(a,b)};a.convertToMultipointFeatures=E;a.convertToMultipoint=G;a.convertFromMultipointFeatures=F;a.convertFromMultipoint=H;a.convertToPolyline=J;a.convertFromPolylineFeatures=I;a.convertFromPolyline=K;a.convertToPolygon=L;a.convertFromPolygon=Q;a.convertFromNestedArray=R;var ia=[],ha=[];a.convertFromFeature=function(a,b,c,d,e){ia[0]=a;a=O(ha,ia,b,c,d,e)[0];ia.length=ha.length=0;return a};a.convertFromFeatures=O;a.convertFromGraphics=function(a,b,c,e,f,g){var h=a.length;switch(c){case "esriGeometryPoint":C(a,
b,e,f,g);break;case "esriGeometryMultipoint":F(a,b,e,f,g);break;case "esriGeometryPolyline":I(a,b,e,f,g);break;case "esriGeometryPolygon":M(a,b,e,f,g);break;default:T.error("convertToFeatureSet:unknown-geometry",new d("Unable to parse unknown geometry type '"+c+"'"))}for(e=0;e<b.length;e++)a[e+h].geometryType=c,a[e+h].insertAfter=b[e].insertAfter,a[e+h].groupId=b[e].groupId;return a};a.convertToFeature=function(a,b,c,d){ha[0]=a;S(ia,ha,b,c,d);a=ia[0];ia.length=ha.length=0;return a};a.convertFromGeometry=
function(a,b,c){if(!a)return null;var e=new h.default;"hasZ"in a&&null==b&&(b=a.hasZ);"hasM"in a&&null==c&&(c=a.hasM);if(k.isPoint(a))return A(null!=b?b:null!=a.z,null!=c?c:null!=a.m)(e,a);if(k.isPolygon(a))return Q(e,a,b,c);if(k.isPolyline(a))return K(e,a,m(b,c));if(k.isMultipoint(a))return H(e,a,m(b,c));T.error("convertFromGeometry:unknown-geometry",new d("Unable to parse unknown geometry type '"+a+"'"))};a.convertToGeometry=N;a.convertToFeatures=S;a.convertToFeatureSet=function(a){var b=a.objectIdFieldName,
c=a.spatialReference,d=a.transform,e=a.fields,f=a.hasM,g=a.hasZ,h=a.geometryType,m=a.exceededTransferLimit,k=a.uniqueIdField,p=a.queryGeometry,l=a.queryGeometryType;a=S([],a.features,h,g,f);p=N(p,l,!1,!1);b={features:a,fields:e,geometryType:h,objectIdFieldName:b,spatialReference:c,uniqueIdField:k,queryGeometry:p};d&&(b.transform=d);m&&(b.exceededTransferLimit=m);f&&(b.hasM=f);g&&(b.hasZ=g);return b};a.convertFromFeatureSet=function(a,b){var e=new c.default,f=a.hasM,g=a.hasZ,h=a.features,m=a.objectIdFieldName,
k=a.spatialReference,p=a.geometryType,l=a.exceededTransferLimit,t=a.transform;if(a=a.fields)e.fields=a;e.geometryType=p;e.objectIdFieldName=m||b;e.spatialReference=k;if(!e.objectIdFieldName)return T.error(new d("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),e;h&&O(e.features,h,p,g,f,e.objectIdFieldName);l&&(e.exceededTransferLimit=l);f&&(e.hasM=f);g&&(e.hasZ=g);t&&(e.transform=t);return e};a.unquantizeOptimizedFeatureSet=function(a){var b=a.transform,c=a.hasM,d=a.hasZ;
if(!b)return a;for(var e=0,f=a.features;e<f.length;e++){var g=f[e];g.geometry&&Z(g.geometry,g.geometry,c,d,b);g.centroid&&Z(g.centroid,g.centroid,c,d,b)}a.transform=null;return a};a.quantizeOptimizedFeatureSet=function(a,b){var c=b.geometryType,d=b.features,e=b.hasM,f=b.hasZ;if(!a)return b;for(var g=0;g<d.length;g++){var m=d[g],k=m.weakClone();k.geometry=new h.default;P(k.geometry,m.geometry,e,f,c,a);m.centroid&&(k.centroid=new h.default,P(k.centroid,m.centroid,e,f,"esriGeometryPoint",a));d[g]=k}b.transform=
a;return b};a.quantizeOptimizedGeometry=P;a.generalizeOptimizedGeometry=function(a,b,c,d,e,g,h,k){void 0===h&&(h=c);void 0===k&&(k=d);a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!b||!b.coords.length)return null;e=Y[e];var p=b.coords;b=b.lengths;var l=m(c,d),t=m(c&&h,d&&k);c=f(c,d,h,k);if(!b.length)return c(a.coords,p,0,0,p[0],p[1]),a.lengths.length&&(a.lengths.length=0),a.coords.length=l,a;d=0;g*=g;for(h=0;h<b.length;h++){k=b[h];if(!(k<e)){var r=a.coords.length/
t,q=d,u=d+(k-1)*l;c(a.coords,p,a.coords.length,q,p[q],p[q+1]);U(a.coords,p,l,g,c,q,u);c(a.coords,p,a.coords.length,u,p[u],p[u+1]);q=a.coords.length/t-r;q>=e?a.lengths.push(q):a.coords.length=r*t}d+=k*l}return a.coords.length?a:null};a.getBoundsOptimizedGeometry=function(a,b,c,d){if(!b||!b.coords||!b.coords.length)return null;c=m(c,d);var e=d=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,g=Number.NEGATIVE_INFINITY;if(b&&b.coords){b=b.coords;for(var h=0;h<b.length;h+=c){var k=b[h],p=b[h+1];d=
Math.min(d,k);f=Math.max(f,k);e=Math.min(e,p);g=Math.max(g,p)}}a[0]=d;a[1]=e;a[2]=f;a[3]=g;return a};a.getQuantizedBoundsOptimizedGeometry=function(a,b,c,d){c=m(c,d);d=b.coords;var e=Number.POSITIVE_INFINITY,f=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY,k=0,p=0;for(b=b.lengths;p<b.length;p++)for(var l=b[p],t=d[k],r=d[k+1],e=Math.min(t,e),f=Math.min(r,f),g=Math.max(t,g),h=Math.max(r,h),k=k+c,q=1;q<l;q++,k+=c){var u=d[k],v=d[k+1],t=t+u,r=r+v;0>u&&(e=Math.min(e,t));
0<u&&(g=Math.max(g,t));0>v?f=Math.min(f,r):0<v&&(h=Math.max(h,r))}a[0]=e;a[1]=f;a[2]=g;a[3]=h;return a};a.unquantizeOptimizedGeometry=Z;a.removeZMValues=function(a,b,c,d,e,g){var h,k=m(c,d);c=f(c,d,e,g);d=b.coords;a.coords.length=0;a.lengths.length=0;(h=a.lengths).push.apply(h,b.lengths);for(b=0;b<d.length;b+=k)c(a.coords,d,a.coords.length,b,d[b],d[b+1]);return a};a.removeCollinearVectices=function(a,b,c,d,e){if(!b||!b.coords||!b.coords.length)return null;c=Y[c];var g=b.coords;b=b.lengths;var h=f(d,
e,d,e);d=m(d,e);for(var k=e=0,p=0,l=0,t=0;t<b.length;t++){var r=b[t],k=l;h(a.coords,g,k,e,g[e],g[e+1]);e+=d;var q=g[e],u=g[e+1],v=q,w=u,z=u/q,k=k+d;h(a.coords,g,k,e,v,w);e+=d;for(var x=2;x<r;x++){var q=g[e],u=g[e+1],B=u/q,A=z===B||!isFinite(z)&&!isFinite(B),z=A&&isFinite(B)?0<=z&&0<=B||0>=z&&0>=B:0<=w&&0<=u||0>=w&&0>=u;A&&z?(v+=q,w+=u):(v=q,w=u,k+=d);h(a.coords,g,k,e,v,w);e+=d;z=B}k+=d;r=(k-l)/d;r>=c&&(a.lengths[p]=r,l=k,p++)}a.coords.length>l&&(a.coords.length=l);a.lengths.length>p&&(a.lengths.length=
p);return a.coords.length&&a.lengths.length?a:null};a.getSignedQuantizedRingArea=V;a.getQuantizedArea=function(a,b){var c=a.coords;a=a.lengths;for(var d=0,e=0,f=0;f<a.length;f++)e+=V(c,d,a[f],b),d+=f;return Math.abs(e)};a.deltaEncodeGeometry=function(a,b){var c=a.clone(),d=a.coords;a=a.lengths;for(var e=0,f=0;f<a.length;f++){for(var g=a[f],h=d[b*e],m=d[b*e+1],k=1;k<g;k++){var p=d[b*(e+k)],l=d[b*(e+k)+1],m=l-m;c.coords[b*(e+k)]=p-h;c.coords[b*(e+k)+1]=m;h=p;m=l}e+=g}return c};a.deltaDecodeGeometry=
function(a,b){var c=a.clone(),d=a.coords;a=a.lengths;for(var e=0,f=0;f<a.length;f++){for(var g=a[f],h=d[b*e],m=d[b*e+1],k=1;k<g;k++)h+=d[b*(e+k)],m+=d[b*(e+k)+1],c.coords[b*(e+k)]=h,c.coords[b*(e+k)+1]=m;e+=g}return c}})},"esri/layers/graphics/OptimizedFeature":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d,e,c){void 0===a&&(a=null);void 0===d&&(d={});this.displayId=0;this.geohashIndexed=!1;this.geohashY=this.geohashX=
0;this.geometry=a;d&&(this.attributes=d);e&&(this.centroid=e);null!=c&&(this.objectId=c)}Object.defineProperty(a.prototype,"hasGeometry",{get:function(){return!(!this.geometry||!this.geometry.coords||!this.geometry.coords.length)},enumerable:!1,configurable:!0});a.prototype.weakClone=function(){var d=new a(this.geometry,this.attributes,this.centroid,this.objectId);d.displayId=this.displayId;d.geohashIndexed=this.geohashIndexed;d.geohashX=this.geohashX;d.geohashY=this.geohashY;return d};return a}();
a.default=n})},"esri/layers/graphics/OptimizedFeatureSet":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this.spatialReference=this.geometryType=this.geometryProperties=this.geohashFieldName=this.globalIdFieldName=this.objectIdFieldName=null;this.hasM=this.hasZ=!1;this.features=[];this.fields=[];this.transform=null;this.exceededTransferLimit=!1;this.queryGeometry=this.queryGeometryType=this.uniqueIdField=null}a.prototype.weakClone=
function(){var d=new a;d.objectIdFieldName=this.objectIdFieldName;d.globalIdFieldName=this.globalIdFieldName;d.geohashFieldName=this.geohashFieldName;d.geometryProperties=this.geometryProperties;d.geometryType=this.geometryType;d.spatialReference=this.spatialReference;d.hasZ=this.hasZ;d.hasM=this.hasM;d.features=this.features;d.fields=this.fields;d.transform=this.transform;d.exceededTransferLimit=this.exceededTransferLimit;d.uniqueIdField=this.uniqueIdField;d.queryGeometry=this.queryGeometry;d.queryGeometryType=
this.queryGeometryType;return d};return a}();a.default=n})},"esri/layers/graphics/OptimizedGeometry":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d,e){void 0===a&&(a=[]);void 0===d&&(d=[]);void 0===e&&(e=!1);this.lengths=a;this.coords=d;this.hasIndeterminateRingOrder=e}Object.defineProperty(a.prototype,"isPoint",{get:function(){return 0===this.lengths.length},enumerable:!1,configurable:!0});a.prototype.forEachVertex=
function(a){var d=0;this.lengths.length||a(this.coords[0],this.coords[1]);for(var e=0;e<this.lengths.length;e++){for(var c=this.lengths[e],h=0;h<c;h++)a(this.coords[2*(h+d)],this.coords[2*(h+d)+1]);d+=c}};a.prototype.clone=function(){return new a(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)};return a}();a.default=n})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){Object.defineProperty(a,"__esModule",{value:!0});a.setSymbolClass=a.make=void 0;var p=d.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");a.make=function(a,b,c,d){var e=u[a.type]&&u[a.type][b.type]||t[b.type];return e?new e(a,b,c,d):(p.error("GraphicsLayerFactory#make","unknown symbol type "+b.type),null)};var t={icon:k.default,object:h.default,line:e.default,path:m.default,fill:f.default,extrude:l.default,text:b.default,water:g.default};a.setSymbolClass=
function(a,b){t[a]=b};var u={"mesh-3d":{fill:c.default}}})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports tslib ../../../../core/Error ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/renderingInfoUtils ./elevationAlignmentUtils ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./polygonUtils ../support/edgeUtils ../../support/projectionUtils ../../support/buffer/BufferView ../../support/buffer/math/vec3 ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K){function L(a,c,d,e,f,g,h,m,k,p,l,t,r,q){var u=d.length/3,v=0;l+=2*e.count;var w=e.index,z=e.count,x=k,B=l;b.vec3.copy(Y,r);var A=0<t?1:-1,w=3*w,C=x;r=3*C;for(var E=x+z,x=3*E,G=0;G<z;++G)q&&(Y[0]=a[w+0],Y[1]=a[w+1],Y[2]=a[w+2],b.vec3.normalize(Y,Y)),f[r+0]=a[w+0],f[r+1]=a[w+1],f[r+2]=a[w+2],g[r+0]=c[w+0],g[r+1]=c[w+1],g[r+2]=c[w+2],h[r+0]=-A*Y[0],h[r+1]=-A*Y[1],h[r+2]=-A*Y[2],m[C]=0,f[x+0]=a[w+0]+t*Y[0],f[x+1]=a[w+1]+t*Y[1],f[x+
2]=a[w+2]+t*Y[2],g[x+0]=c[w+0],g[x+1]=c[w+1],g[x+2]=c[w+2],h[x+0]=A*Y[0],h[x+1]=A*Y[1],h[x+2]=A*Y[2],m[E]=t,r+=3,x+=3,w+=3,C+=1,E+=1;w=0;r=3*B;x=3*(B+u);r=3*(B+u);x=3*B;a=X;c=ca;0>t&&(a=ca,c=X);for(G=0;G<u;++G)p[r+0]=d[w+a[0]],p[r+1]=d[w+a[1]],p[r+2]=d[w+a[2]],p[x+0]=d[w+c[0]]+z,p[x+1]=d[w+c[1]]+z,p[x+2]=d[w+c[2]]+z,r+=3,x+=3,w+=3;k+=2*e.count;l=l+2*u-(2*e.count+2*u);Q(f,g,m,h,v,e.pathLengths[0],e.count,k,p,l,t);k+=4*e.pathLengths[0];l+=2*e.pathLengths[0];v+=e.pathLengths[0];for(d=1;d<e.pathLengths.length;++d)Q(f,
g,m,h,v,e.pathLengths[d],e.count,k,p,l,t),k+=4*e.pathLengths[d],l+=2*e.pathLengths[d],v+=e.pathLengths[d]}function M(a,b,c,d,e,f,g){d[f]=d[g];g*=3;f*=3;a[f+0]=a[g+0];a[f+1]=a[g+1];a[f+2]=a[g+2];b[f+0]=b[g+0];b[f+1]=b[g+1];b[f+2]=b[g+2];c[f+0]=e[0];c[f+1]=e[1];c[f+2]=e[2]}function Q(a,c,d,e,f,g,h,m,k,p,l){var t=f,r=f+1,q=f+h,u=f+h+1,v=m,w=m+1,z=m+2*g;m=m+2*g+1;0>l&&(t=f+h+1,u=f);p*=3;for(var x=0;x<g;++x){x===g-1&&(0<l?(r=f,u=f+h):(r=f,t=f+h));var B=a,A=t,C=r,E=q,G=O,A=3*A,C=3*C,E=3*E;b.vec3.set(N,
B[A++],B[A++],B[A++]);b.vec3.set(S,B[C++],B[C++],B[C++]);b.vec3.set(P,B[E++],B[E++],B[E++]);b.vec3.subtract(U,S,N);b.vec3.subtract(Z,P,N);b.vec3.cross(G,Z,U);b.vec3.normalize(G,G);M(a,c,e,d,O,v,t);M(a,c,e,d,O,w,r);M(a,c,e,d,O,z,q);M(a,c,e,d,O,m,u);k[p++]=v;k[p++]=z;k[p++]=m;k[p++]=v;k[p++]=m;k[p++]=w;t++;r++;q++;u++;v+=2;w+=2;z+=2;m+=2}}function R(a,c,d,e){a=a.stageObject;ba.spatialReference=d.spatialReference;for(var g=a.geometryRecords,h=g.length,k="absolute-height"!==c.mode,p=0,l=a.objectTransformation,
t=m.mat4.invert(f.mat4f64.create(),l),q=0;q<h;q++){var u=g[q].geometry;u.invalidateBoundingInfo();for(var v=u.data.getVertexAttr(),u=v[I.VertexAttrConstants.POSITION].data,w=v[I.VertexAttrConstants.SIZE].data,v=v.mapPos.data,z=u.length/3,x=0,B=0,A=!1,C=0,E=0;E<z;E++){ba.x=v[B];ba.y=v[B+1];ba.z=v[B+2];V[0]=u[x];V[1]=u[x+1];V[2]=u[x+2];var G=r.evaluateElevationAlignmentAtPoint(ba,d,c,e,k?ga:null);k&&(C+=ga.sampledElevation);b.vec3.set(T,u[x+0],u[x+1],u[x+2]);b.vec3.transformMat4(T,T,l);e.setAltitude(G+
w[x/3],T);b.vec3.transformMat4(T,T,t);u[x]=T[0];u[x+1]=T[1];u[x+2]=T[2];G=.01/e.unitInMeters;if(Math.abs(V[0]-u[x])>G||Math.abs(V[1]-u[x+1])>G||Math.abs(V[2]-u[x+2])>G)A=!0;B+=3;x+=3}A&&a.geometryVertexAttrsUpdated(q);p+=C/z}return p/h}Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DExtrudeSymbolLayer=void 0;n=function(a){function b(b,c,d,e){b=a.call(this,b,c,d,e)||this;b.ensureDrapedStatus(!1);return b}d.__extends(b,a);b.prototype.doLoad=function(){return d.__awaiter(this,void 0,void 0,
function(){var a,b,c,e,f,h;return d.__generator(this,function(d){if(!this._drivenProperties.size&&(a=x.validateSymbolLayerSize(this._getSymbolSize())))throw new l("graphics3dextrudesymbollayer:invalid-size",a);b=k.get(this.symbolLayer,"material","color");c=this._getCombinedOpacityAndColor(b);e=g.vec3f64.fromArray(c);f=c[3];h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:e,ambient:e,opacity:f,transparent:1>f||this.needsDrivenTransparentPass,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new K(h,this._getIdHint("_3dlinemat"));this._context.stage.add(3,this._material);return[2]})})};b.prototype.destroy=function(){a.prototype.destroy.call(this);this._material&&this._context.stage.remove(3,this._material.id)};b.prototype.createGraphics3DGraphic=function(a){var c=a.graphic;if(!this._validateGeometryType(c.geometry,b.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(c.geometry))return null;
var d="graphic"+c.uid,e=this._getVertexOpacityAndColor(a.renderingInfo,Float32Array,255),f=this.setGraphicElevationContext(c,new v.ElevationContext);return this._createAs3DShape(c,a.renderingInfo,e,f,d,c.uid)};b.prototype.layerOpacityChanged=function(a,b){var c=this,d=k.get(this.symbolLayer,"material","color"),d=this._getCombinedOpacity(d);this._material.setParameterValues({opacity:d,transparent:1>d||this.needsDrivenTransparentPass});var e=this._getLayerOpacity();a.forEach(function(a){a=b(a);k.isSome(a)&&
a.layerOpacityChanged(e,c._context.isAsync)});return!0};b.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,q.needsElevationUpdates3D)};b.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});a.forEach(function(a){a=b(a);k.isSome(a)&&a.slicePlaneEnabledChanged(c._context.slicePlaneEnabled,c._context.isAsync)});return!0};b.prototype.physicalBasedRenderingChanged=
function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};b.prototype.pixelRatioChanged=function(){return!0};b.prototype._getExtrusionSize=function(a){var b;a=a.size&&this._drivenProperties.size?null!==(b=u.getDriverAxisSizeValue(a.size,2))&&void 0!==b?b:0:this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};b.prototype._getSymbolSize=function(){var a;return null!==(a=this.symbolLayer.size)&&void 0!==a?a:1};
b.prototype._createAs3DShape=function(a,b,d,l,t,r){var u=B.geometryAsPolygon(a.geometry);if(k.isNone(u))return null;a=[];var v=[],z=[],A=p.create(),I=1===this._context.renderCoordsHelper.viewingMode,H=this._getExtrusionSize(b),n=g.vec3f64.create();I||this._context.renderCoordsHelper.worldUpAtPosition(null,n);b=B.geometryToRenderInfo(u,this._context.elevationProvider,this._context.renderCoordsHelper,l);this._logGeometryCreationWarnings(b,u.rings,"rings","ExtrudeSymbol3DLayer");if(0===u.rings.length||
!u.rings.some(function(a){return 0<a.length}))return null;var Q=x.computeCentroid(u);if(k.isNone(Q))return null;var K=f.mat4f64.create();C.computeLinearTransformation(u.spatialReference,[Q.x,Q.y,0],K,this._context.renderCoordsHelper.spatialReference);u=f.mat4f64.create();m.mat4.invert(u,K);Q=h.mat3f64.create();c.mat3.normalFromMat4(Q,u);for(var M=b.polygons,P=b.mapPosition,S=b.position,ga=S.length/3,Y=new Float64Array(18*ga),Z=new Float64Array(18*ga),ba=new Float64Array(18*ga),ga=new Float64Array(6*
ga),N=0,U=0;U<M.length;++U){var V=M[U],ha=V.count;if(this._context.clippingExtent&&(p.empty(A),p.expandWithBuffer(A,V.mapPosition),!p.intersectsClippingArea(A,this._context.clippingExtent)))continue;var ca=e.earcut(V.mapPosition,V.holeIndices,3);if(0!==ca.length){var X=new Uint32Array(6*ha+2*ca.length),T=6*ha,da=3*Y.BYTES_PER_ELEMENT,da=new E.BufferViewVec3f64(Y.buffer,N*da,da,(N+T)*da),O=3*Z.BYTES_PER_ELEMENT,O=new E.BufferViewVec3f64(Z.buffer,N*O,O,(N+T)*O),ia=new Float64Array(ba.buffer,3*N*ba.BYTES_PER_ELEMENT,
3*T),T=new Float64Array(ga.buffer,1*N*ga.BYTES_PER_ELEMENT,1*T);L(S,P,ca,V,da.typedBuffer,ia,O.typedBuffer,T,0,X,0,H,n,I);G.transformMat4(da,da,u);G.transformMat3(O,O,Q);N+=6*ha;V=this._createExtrudeGeometry(X,{positions:da.typedBuffer,elevation:ia,normals:O.typedBuffer,heights:T},d);V=new F(V,t+"path"+U);a.push(V);v.push(this._material);z.push(f.mat4f64.IDENTITY)}}if(0===a.length)return null;d=new J({geometries:a,materials:v,transformations:z,castShadow:!0,metadata:{layerUid:this._context.layer.uid,
graphicUid:r,isElevationSource:!0},idHint:t});d.objectTransformation=K;t=this._createEdgeMaterial();t=k.isSome(t)?{baseMaterial:this._material,edgeMaterials:[t],slicePlaneEnabled:this._context.slicePlaneEnabled}:null;a=new w(this,d,a,null,null,R,l,t);a.alignedSampledElevation=b.sampledElevation;a.needsElevationUpdates=q.needsElevationUpdates3D(l.mode);return a};b.prototype._createExtrudeGeometry=function(a,b,c){for(var d=a.length,e=new Uint32Array(d),f=0;f<d;f++)e[f]=0;d={};f={};d[I.VertexAttrConstants.POSITION]=
a;d[I.VertexAttrConstants.NORMAL]=a;d[I.VertexAttrConstants.COLOR]=e;f[I.VertexAttrConstants.POSITION]={size:3,data:b.positions};f[I.VertexAttrConstants.NORMAL]={size:3,data:b.normals};f[I.VertexAttrConstants.COLOR]={size:4,data:c};f[I.VertexAttrConstants.SIZE]={size:1,data:b.heights};b.elevation&&(f.mapPos={size:3,data:b.elevation},d.mapPos=a);return new H.GeometryData(f,d)};b.prototype._createEdgeMaterial=function(){var a={opacity:this._getLayerOpacity()};return A.createMaterial(this.symbolLayer,
a)};b.validGeometryTypes=["polygon","extent"];return b}(z.default);a.Graphics3DExtrudeSymbolLayer=n;var O=g.vec3f64.create(),N=g.vec3f64.create(),S=g.vec3f64.create(),P=g.vec3f64.create(),U=g.vec3f64.create(),Z=g.vec3f64.create(),V=g.vec3f64.create(),T=g.vec3f64.create(),Y=g.vec3f64.create(),X=[0,2,1],ca=[0,1,2],ba=t.makeDehydratedPoint(0,0,0,null),ga={verticalDistanceToGround:0,sampledElevation:0};a.default=n})},"esri/core/libs/earcut/earcut":function(){define(["require","exports"],function(n,a){function d(a,
b,d,e,f){var g;if(f===0<t(a,b,d,e))for(f=b;f<d;f+=e)g=c(f,a[f],a[f+1],g);else for(f=d-e;f>=b;f-=e)g=c(f,a[f],a[f+1],g);g&&v(g,g.next)&&(h(g),g=g.next);return g}function l(a,b){void 0===b&&(b=a);if(!a)return a;var c;do if(c=!1,a.steiner||!v(a,a.next)&&0!==g(a.prev,a,a.next))a=a.next;else{h(a);a=b=a.prev;if(a===a.next)break;c=!0}while(c||a!==b);return b}function k(a,c,d,f,m,t,q){void 0===q&&(q=0);if(a){!q&&t&&(a=b(a,f,m,t));for(var w=a;a.prev!==a.next;){var x=a.prev,B=a.next,A;if(t)A=e(a,f,m,t);else a:{A=
a;var C=A.prev,E=A,G=A.next;if(0<=g(C,E,G))A=!1;else{for(var F=A.next.next,n=F,H=0;F!==A.prev&&(0===H||F!==n);){H++;if(u(C.x,C.y,E.x,E.y,G.x,G.y,F.x,F.y)&&0<=g(F.prev,F,F.next)){A=!1;break a}F=F.next}A=!0}}if(A)c.push(x.index/d),c.push(a.index/d),c.push(B.index/d),h(a),w=a=B.next;else if(a=B,a===w){if(!q)k(l(a),c,d,f,m,t,1);else if(1===q){q=c;w=d;x=a;do B=x.prev,A=x.next.next,!v(B,A)&&p(B,x,x.next,A)&&r(B,A)&&r(A,B)&&(q.push(B.index/w),q.push(x.index/w),q.push(A.index/w),h(x),h(x.next),x=a=A),x=x.next;
while(x!==a);a=x;k(a,c,d,f,m,t,2)}else if(2===q)a:{q=a;do{for(w=q.next.next;w!==q.prev;){if(x=q.index!==w.index){x=q;B=w;A=void 0;if(A=x.next.index!==B.index&&x.prev.index!==B.index){A=void 0;b:{A=x;do{if(A.index!==x.index&&A.next.index!==x.index&&A.index!==B.index&&A.next.index!==B.index&&p(A,A.next,x,B)){A=!0;break b}A=A.next}while(A!==x);A=!1}A=!A}C=void 0;if(C=A&&r(x,B)&&r(B,x)){A=x;C=!1;E=(x.x+B.x)/2;B=(x.y+B.y)/2;do A.y>B!==A.next.y>B&&A.next.y!==A.y&&E<(A.next.x-A.x)*(B-A.y)/(A.next.y-A.y)+
A.x&&(C=!C),A=A.next;while(A!==x)}x=C}if(x){a=z(q,w);q=l(q,q.next);a=l(a,a.next);k(q,c,d,f,m,t);k(a,c,d,f,m,t);break a}w=w.next}q=q.next}while(q!==a)}break}}}}function e(a,b,c,d){var e=a.prev,f=a.next;if(0<=g(e,a,f))return!1;var h=e.x>a.x?e.x>f.x?e.x:f.x:a.x>f.x?a.x:f.x,m=e.y>a.y?e.y>f.y?e.y:f.y:a.y>f.y?a.y:f.y,k=q(e.x<a.x?e.x<f.x?e.x:f.x:a.x<f.x?a.x:f.x,e.y<a.y?e.y<f.y?e.y:f.y:a.y<f.y?a.y:f.y,b,c,d);b=q(h,m,b,c,d);c=a.prevZ;for(d=a.nextZ;c&&c.z>=k&&d&&d.z<=b;){if(c!==a.prev&&c!==a.next&&u(e.x,e.y,
a.x,a.y,f.x,f.y,c.x,c.y)&&0<=g(c.prev,c,c.next))return!1;c=c.prevZ;if(d!==a.prev&&d!==a.next&&u(e.x,e.y,a.x,a.y,f.x,f.y,d.x,d.y)&&0<=g(d.prev,d,d.next))return!1;d=d.nextZ}for(;c&&c.z>=k;){if(c!==a.prev&&c!==a.next&&u(e.x,e.y,a.x,a.y,f.x,f.y,c.x,c.y)&&0<=g(c.prev,c,c.next))return!1;c=c.prevZ}for(;d&&d.z<=b;){if(d!==a.prev&&d!==a.next&&u(e.x,e.y,a.x,a.y,f.x,f.y,d.x,d.y)&&0<=g(d.prev,d,d.next))return!1;d=d.nextZ}return!0}function c(a,b,c,d){a=new x(a,b,c);d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=
a):(a.prev=a,a.next=a);return a}function h(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function m(a){var b=a,c=a;do{if(b.x<c.x||b.x===c.x&&b.y<c.y)c=b;b=b.next}while(b!==a);return c}function f(a,b){var c=b,d=a.x,e=a.y,f=-Infinity,g;do{if(e<=c.y&&e>=c.next.y&&c.next.y!==c.y){var h=c.x+(e-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(h<=d&&h>f){f=h;if(h===d){if(e===c.y)return c;if(e===c.next.y)return c.next}g=c.x<c.next.x?c:c.next}}c=c.next}while(c!==
b);if(!g)return null;if(d===f)return g.prev;b=g;for(var h=g.x,m=g.y,k=Infinity,p,c=g.next;c!==b;)d>=c.x&&c.x>=h&&d!==c.x&&u(e<m?d:f,e,h,m,e<m?f:d,e,c.x,c.y)&&(p=Math.abs(e-c.y)/(d-c.x),(p<k||p===k&&c.x>g.x)&&r(c,a)&&(g=c,k=p)),c=c.next;return g}function b(a,c,d,e){for(var f=void 0;f!==a;f=f.next){f=f||a;null===f.z&&(f.z=q(f.x,f.y,c,d,e));if(f.prev.next!==f||f.next.prev!==f)return f.prev.next=f,f.next.prev=f,b(a,c,d,e);f.prevZ=f.prev;f.nextZ=f.next}a.prevZ.nextZ=null;a.prevZ=null;a:for(d=1;;){e=a;
f=void 0;c=a=null;for(var g=0;e;){g++;for(var f=e,h=0;h<d&&f;h++)f=f.nextZ;for(var m=d;0<h||0<m&&f;){var k=void 0;0===h?(k=f,f=f.nextZ,m--):0!==m&&f?e.z<=f.z?(k=e,e=e.nextZ,h--):(k=f,f=f.nextZ,m--):(k=e,e=e.nextZ,h--);c?c.nextZ=k:a=k;k.prevZ=c;c=k}e=f}c.nextZ=null;d*=2;if(2>g)break a}return a}function g(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function p(a,b,c,d){return v(a,b)&&v(c,d)||v(a,d)&&v(c,b)?!0:0<g(a,b,c)!==0<g(a,b,d)&&0<g(c,d,a)!==0<g(c,d,b)}function t(a,b,c,d){for(var e=0,f=
c-d;b<c;b+=d)e+=(a[f]-a[b])*(a[b+1]+a[f+1]),f=b;return e}function u(a,b,c,d,e,f,g,h){return 0<=(e-g)*(b-h)-(a-g)*(f-h)&&0<=(a-g)*(d-h)-(c-g)*(b-h)&&0<=(c-g)*(f-h)-(e-g)*(d-h)}function r(a,b){return 0>g(a.prev,a,a.next)?0<=g(a,b,a.next)&&0<=g(a,a.prev,b):0>g(a,b,a.prev)||0>g(a,a.next,b)}function q(a,b,c,d,e){a=32767*(a-c)*e;b=32767*(b-d)*e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&
1431655765)<<1}function v(a,b){return a.x===b.x&&a.y===b.y}function w(a,b){return a.x-b.x}function z(a,b){var c=new x(a.index,a.x,a.y),d=new x(b.index,b.x,b.y),e=a.next,f=b.prev;a.next=b;b.prev=a;c.next=e;e.prev=c;d.next=c;c.prev=d;f.next=d;d.prev=f;return d}Object.defineProperty(a,"__esModule",{value:!0});a.deviation=a.earcut=void 0;a.earcut=function(a,b,c){var e=b&&b.length,g=e?b[0]*c:a.length,h=d(a,0,g,c,!0),p=[];if(!h||h.next===h.prev)return p;var t,r,q;if(e){for(var e=[],u=0,v=b.length;u<v;u++){var x=
d(a,b[u]*c,u<v-1?b[u+1]*c:a.length,c,!1);x===x.next&&(x.steiner=!0);e.push(m(x))}e.sort(w);for(b=0;b<e.length;b++){u=e[b];v=h;if(v=f(u,v))u=z(v,u),l(u,u.next);h=l(h,h.next)}}if(a.length>80*c){t=q=a[0];r=e=a[1];for(b=c;b<g;b+=c)u=a[b],v=a[b+1],t=Math.min(t,u),r=Math.min(r,v),q=Math.max(q,u),e=Math.max(e,v);q=Math.max(q-t,e-r);q=0!==q?1/q:0}k(h,p,c,t,r,q);return p};a.deviation=function(a,b,c,d){var e=b&&b.length,f=Math.abs(t(a,0,e?b[0]*c:a.length,c));if(e)for(var e=0,g=b.length;e<g;e++)f-=Math.abs(t(a,
b[e]*c,e<g-1?b[e+1]*c:a.length,c));for(e=b=0;e<d.length;e+=3){var g=d[e]*c,h=d[e+1]*c,m=d[e+2]*c;b+=Math.abs((a[g]-a[m])*(a[h+1]-a[g+1])-(a[g]-a[h])*(a[m+1]-a[g+1]))}return 0===f&&0===b?0:Math.abs((b-f)/f)};var x=function(){return function(a,b,c){this.index=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}}()})},"esri/renderers/support/renderingInfoUtils":function(){define("require exports tslib ../../Color ../../core/maybe ../visualVariables/support/visualVariableUtils".split(" "),
function(n,a,d,l,k,e){function c(a,b){if(!a||a.symbol)return null;b=b&&b.renderer;return a&&k.isSome(b)&&b.getObservationRenderer?b.getObservationRenderer(a):b}function h(a,b){if(k.isSome(a.symbol))return a.symbol;var d=c(a,b);return k.isSome(d)?d.getSymbol(a,b):null}function m(a,b){return d.__awaiter(this,void 0,void 0,function(){var e;return d.__generator(this,function(f){if(k.isSome(a.symbol))return[2,a.symbol];e=c(a,b);return[2,k.isSome(e)&&e.getSymbolAsync(a,d.__assign(d.__assign({},b),{abortOptions:{signal:b.signal}}))]})})}
Object.defineProperty(a,"__esModule",{value:!0});a.getDriverAxisSizeValueAny=a.getDriverAxisSizeValue=a.getRenderingInfoAsync=a.getSymbolAsync=a.getRenderingInfo=a.getSymbol=a.getRenderer=void 0;a.getRenderer=c;a.getSymbol=h;a.getRenderingInfo=function(a,b){var d=c(a,b),f=h(a,b);if(!f)return null;f={renderer:d,symbol:f};if(k.isNone(d)||!("visualVariables"in d)||!d.visualVariables)return f;var m=["proportional","proportional","proportional"],l=0;for(a=e.getVisualVariableValues(d,a,b);l<a.length;l++)switch(d=
a[l],b=d.variable,d=d.value,b.type){case "color":f.color=d.toRgba();break;case "size":if("outline"===b.target)f.outlineSize=d;else switch(d=b.useSymbolValue?"symbol-value":d,b.axis){case "width":m[0]=d;break;case "depth":m[1]=d;break;case "height":m[2]=d;break;case "width-and-depth":m[0]=m[1]=d;break;default:m[0]=m[1]=m[2]=d}break;case "opacity":f.opacity=d;break;case "rotation":switch(b.axis){case "tilt":f.tilt=d;break;case "roll":f.roll=d;break;default:f.heading=d}}if("proportional"!==m[0]||"proportional"!==
m[1]||"proportional"!==m[2])f.size=m;return f};a.getSymbolAsync=m;a.getRenderingInfoAsync=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var f,h,k,u,r,q,v,w,z,x,B,A;return d.__generator(this,function(d){switch(d.label){case 0:return f=c(a,b),[4,m(a,b)];case 1:h=d.sent();if(!h)return[2,null];k={renderer:f,symbol:h};if(!(f&&"visualVariables"in f&&f.visualVariables))return[2,k];u=e.getVisualVariableValues(f,a,b);r=["proportional","proportional","proportional"];q=0;for(v=u;q<v.length;q++)w=
v[q],z=w.variable,x=w.value,"color"===z.type?k.color=l.toUnitRGBA(x):"size"===z.type?"outline"===z.target?k.outlineSize=x:(B=z.axis,A=z.useSymbolValue?"symbol-value":x,"width"===B?r[0]=A:"depth"===B?r[1]=A:"height"===B?r[2]=A:r[0]="width-and-depth"===B?r[1]=A:r[1]=r[2]=A):"opacity"===z.type?k.opacity=x:"rotation"===z.type&&"tilt"===z.axis?k.tilt=x:"rotation"===z.type&&"roll"===z.axis?k.roll=x:"rotation"===z.type&&(k.heading=x);if(isFinite(r[0])||isFinite(r[1])||isFinite(r[2]))k.size=r;return[2,k]}})})};
a.getDriverAxisSizeValue=function(a,b){void 0===b&&(b=0);a=a[b];return"number"===typeof a&&isFinite(a)?a:null};a.getDriverAxisSizeValueAny=function(a){for(var b=0;3>b;b++){var c=a[b];if("number"===typeof c)return isFinite(c)?c:0}return 0}})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("require exports ../../../../geometry ../../../../core/maybe ../../../../geometry/support/triangulationUtils ./elevationAlignmentUtils ../../support/projectionUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util".split(" "),
function(n,a,d,l,k,e,c,h,m,f){function b(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e],g=f.index,f=f.count;if(!(1>=f)){var h=3*g,m=h+3*f;d.push({index:g,count:f,position:b.subarray(h,m),mapPosition:c?c.subarray(h,m):void 0})}}return d}function g(a,b,c){for(var d=[],e=function(a,e,f,g){if(1>=e)return"continue";var h=3*a,m=h+3*e;f=f.map(function(b){return b-a});d.push({index:a,count:e,holeIndices:f,pathLengths:g,position:b.subarray(h,m),mapPosition:c?c.subarray(h,m):void 0})},f=0;f<a.length;f++){var g=
a[f];e(g.index,g.count,g.holeIndices,g.pathLengths)}return d}Object.defineProperty(a,"__esModule",{value:!0});a.geometryToRenderInfoDraped=a.geometryToRenderInfo=a.geometryAsPolygon=a.createWaterGeometryData=a.createColorGeometryData=void 0;a.createColorGeometryData=function(a){var b={},c={};c[f.VertexAttrConstants.POSITION]={size:3,data:a.attributeData.position};b[f.VertexAttrConstants.POSITION]=a.indices;if(l.isSome(a.attributeData.color)){var d=new Uint32Array(a.indices.length);c[f.VertexAttrConstants.COLOR]=
{size:4,data:a.attributeData.color};b[f.VertexAttrConstants.COLOR]=d}l.isSome(a.attributeData.uvMapSpace)&&(c[f.VertexAttrConstants.UVMAPSPACE]={size:4,data:a.attributeData.uvMapSpace},b[f.VertexAttrConstants.UVMAPSPACE]=a.indices);l.isSome(a.attributeData.bound1)&&(c[f.VertexAttrConstants.BOUND1]={size:3,data:a.attributeData.bound1},b[f.VertexAttrConstants.BOUND1]=a.indices);l.isSome(a.attributeData.bound2)&&(c[f.VertexAttrConstants.BOUND2]={size:3,data:a.attributeData.bound2},b[f.VertexAttrConstants.BOUND2]=
a.indices);l.isSome(a.attributeData.bound3)&&(c[f.VertexAttrConstants.BOUND3]={size:3,data:a.attributeData.bound3},b[f.VertexAttrConstants.BOUND3]=a.indices);l.isSome(a.attributeData.mapPosition)&&(c.mapPos={size:3,data:a.attributeData.mapPosition},b.mapPos=a.indices);return new m.GeometryData(c,b)};a.createWaterGeometryData=function(a){var b={},c={};c[f.VertexAttrConstants.POSITION]={size:3,data:a.attributeData.position};b[f.VertexAttrConstants.POSITION]=a.indices;c[f.VertexAttrConstants.UV0]={size:2,
data:a.attributeData.uv0};b[f.VertexAttrConstants.UV0]=a.indices;l.isSome(a.attributeData.mapPosition)&&(c.mapPos={size:3,data:a.attributeData.mapPosition},b.mapPos=a.indices);return new m.GeometryData(c,b)};a.geometryAsPolygon=function(a){switch(a.type){case "extent":if(a instanceof d.Extent)return d.Polygon.fromExtent(a);break;case "polygon":return a}return null};a.geometryToRenderInfo=function(a,c,d,f){var h=k.pathsToTriangulationInfo(a.rings,a.hasZ,1),m=new Float64Array(h.position.length);a=e.applyPerVertexElevationAlignment(h.position,
a.spatialReference,0,m,0,h.position,0,h.position.length/3,c,d,f);c=null!=a;return{position:h.position,mapPosition:m,polygons:g(h.polygons,h.position,m),outlines:b(h.outlines,h.position,m),projectionSuccess:c,sampledElevation:a}};a.geometryToRenderInfoDraped=function(a,d){var e=k.pathsToTriangulationInfo(a.rings,!1,1);a=c.bufferToBuffer(e.position,a.spatialReference,0,e.position,d,0,e.position.length/3);for(d=2;d<e.position.length;d+=3)e.position[d]=h.DRAPED_Z;return{position:e.position,polygons:g(e.polygons,
e.position),outlines:b(e.outlines,e.position),projectionSuccess:a}}})},"esri/geometry/support/triangulationUtils":function(){define(["require","exports","../../core/libs/earcut/earcut","./coordsUtils","./meshUtils/deduplicate"],function(n,a,d,l,k){function e(a,c,b){if(1===a.length)return a[0];c=new Float64Array(c);b=new Uint32Array(b);for(var d=0,e=0,f=0,h=0;h<a.length;h++){for(var m=a[h],k=0;k<m.position.length;k++)c[d++]=m.position[k];for(k=0;k<m.faces.length;k++)b[e++]=m.faces[k]+f;f=d/3}return{position:c,
faces:b}}function c(a,c,b){for(var d=a.length,e=Array(d),f=Array(d),m=Array(d),k=0,q=0,v=0,w=0,z=0;z<d;++z)w+=a[z].length;for(var w=new Float64Array(3*w),x=0,B=d-1;0<=B;B--){var A=a[B],C=1===b?!l.isClockwise(A,!1,!1):!1;if(C&&1!==d)e[k++]=A;else{for(var E=A.length,z=0;z<k;++z)E+=e[z].length;z={index:x,pathLengths:Array(k+1),count:E,holeIndices:Array(k)};z.pathLengths[0]=A.length;0<A.length&&(m[v++]={index:x,count:A.length});x=C?h(A,A.length-1,-1,w,x,A.length,c):h(A,0,1,w,x,A.length,c);for(A=0;A<k;++A)C=
e[A],z.holeIndices[A]=x,z.pathLengths[A+1]=C.length,0<C.length&&(m[v++]={index:x,count:C.length}),x=h(C,0,1,w,x,C.length,c);k=0;0<z.count&&(f[q++]=z)}}for(A=0;A<k;++A)C=e[A],0<C.length&&(m[v++]={index:x,count:C.length}),x=h(C,0,1,w,x,C.length,c);q<d&&(f.length=q);v<d&&(m.length=v);return{position:w,polygons:f,outlines:m}}function h(a,c,b,d,e,h,k){e*=3;for(var f=0;f<h;++f){var g=a[c];d[e++]=g[0];d[e++]=g[1];d[e++]=k?g[2]:0;c+=b}return e/3}Object.defineProperty(a,"__esModule",{value:!0});a.pathsToTriangulationInfo=
a.triangulate=void 0;a.triangulate=function(a){var f=c(a.rings,a.hasZ,1),b=[],g=0,h=0;a=function(a){var c=a.index,e=new Float64Array(f.position.buffer,3*c*f.position.BYTES_PER_ELEMENT,3*a.count);a=a.holeIndices.map(function(a){return a-c});a=new Uint32Array(d.earcut(e,a,3));b.push({position:e,faces:a});g+=e.length;h+=a.length};for(var m=0,l=f.polygons;m<l.length;m++)a(l[m]);a=e(b,g,h);m=k.default(a.position.buffer,6,{originalIndices:a.faces});a.position=new Float64Array(m.buffer);a.faces=m.indices;
return a};a.pathsToTriangulationInfo=c})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["require","exports","../../../core/mathUtils"],function(n,a,d){function l(a,c,h){var e=a.byteLength/(4*c),f=new Uint32Array(a,0,e*c);a=new Uint32Array(e);var b=h&&h.minReduction||0,g=h&&h.originalIndices||null,p=h&&h.componentOffsets||null,l=0;if(p)for(h=0;h<p.length-1;h++){var u=p[h+1]-p[h];u>l&&(l=u)}else l=e;var r=Math.floor(1.1*l)+1;if(null==k||k.length<2*r)k=new Uint32Array(d.nextHighestPowerOfTwo(2*
r));for(h=0;h<2*r;h++)k[h]=0;var l=0,q=(u=!!p&&!!g)?g.length:e,v=u?new Uint32Array(g.length):null,w=0!==b?Math.ceil(7.84*1.96/(b*b)*b*(1-b)):q,z=1,x=p?p[1]:q;for(h=0;h<q;h++){if(h===w){var B=1-l/h;if(B+1.96*Math.sqrt(B*(1-B)/h)<b)return null;w*=2}if(h===x){for(B=0;B<2*r;B++)k[B]=0;if(g)for(B=p[z-1];B<p[z];B++)v[B]=a[g[B]];x=p[++z]}for(var A=u?g[h]:h,B=A*c,C,E=C=0;E<c;E++)C=f[B+E]+C|0,C=C+(C<<11)+(C>>>2)|0;C>>>=0;for(var E=C%r,G=l;0!==k[2*E+1];){if(k[2*E]===C){var F=k[2*E+1]-1,n=F*c;a:{for(var J=0;J<
c;J++)if(f[B+J]!==f[n+J]){n=!1;break a}n=!0}if(n){G=a[F];break}}E++;E>=r&&(E-=r)}G===l&&(k[2*E]=C,k[2*E+1]=A+1,l++);a[A]=G}if(0!==b&&1-l/e<b)return null;if(u){for(h=p[z-1];h<v.length;h++)v[h]=a[g[h]];a=v}e=new Uint32Array(c*l);for(h=l=0;h<q;h++)if(a[h]===l){B=(u?g[h]:h)*c;b=f;p=B;r=e;v=l*c;w=c;for(z=0;z<w;z++)r[v+z]=b[p+z];l++}if(g&&!u){c=new Uint32Array(g.length);for(h=0;h<c.length;h++)c[h]=a[g[h]];a=c}return{buffer:e.buffer,indices:a,uniqueCount:l}}Object.defineProperty(a,"__esModule",{value:!0});
a.deduplicate=void 0;a.deduplicate=l;var k=null;a.default=l})},"esri/views/3d/terrain/OverlayRenderer":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/maybe ../../../core/PooledArray ../../../core/SetUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3f64 ../support/debugFlags ./OverlayRenderTarget ../webgl-engine/core/shaderTechnique/CommonUniformStore ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/AutoDisposable ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRep ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/RenderContext ../webgl-engine/lib/renderStats ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lighting/Lightsources ../webgl-engine/lighting/SceneLighting ../webgl-engine/materials/lineStippleUtils ../../webgl/Texture ../../webgl/Util".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R){Object.defineProperty(a,"__esModule",{value:!0});a.overlayRenderOccludedFlag=a.DRAPED_Z=a.OverlayRenderer=void 0;var O=e.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");n=function(e){function l(){var a=null!==e&&e.apply(this,arguments)||this;a._hasHighlights=!1;a._rendersOccluded=!1;a._hasWater=!1;a._lighting=new L.SceneLighting;a._localOrigins=new E;a._handles=new k;a._layerRenderers=new Map;a._sortedLayerRenderersDirty=
!1;a._sortedLayerRenderers=new f;a._stats=new H.RenderStatsAggregator;a._geometries=new Map;a._uniqueIdx=0;a.globalUnitScale=1;a.longitudeCyclical=null;return a}d.__extends(l,e);l.prototype.initialize=function(){var b=this;this._rctx=this.renderView.renderingContext;this._renderContext=new F(this._rctx,null,null,null,null,null);this._stippleTextureRepository=new M.StippleTextureRepository;this.waterTextureRepository=this.renderView.waterTextureRepository;this._shaderTechniqueRepository=new z.ShaderTechniqueRepository({rctx:this._rctx,
viewingMode:2,commonUniformStore:new w.CommonUniformStore,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository});g.init(this.waterTextureRepository,"loadingState",function(){return b.emitContentChanged()});this._materialRepository=new A(this.renderView.textureRepository,this._shaderTechniqueRepository);this._materialRepository.onMaterialChanged=function(c){0<(c.renderOccluded&a.overlayRenderOccludedFlag)!==b._rendersOccluded&&b.updateRendersOccluded();
b.emitContentChanged();b.notifyChange("updating")};this._compositingHelper=this.renderView.compositingHelper;this._lighting.set({lights:[new K.AmbientLight(r.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0});this._bindParameters={slot:null,highlightDepthTexture:C.createEmptyDepthTexture(this._rctx),camera:P,inverseViewport:u.vec2f64.create(),origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,
linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting}};l.prototype.dispose=function(){this._handles.destroy();this._layerRenderers.forEach(function(a){return a.dispose()});this._layerRenderers.clear();this._bindParameters.highlightDepthTexture.dispose();this._bindParameters.highlightDepthTexture=null;this._shaderTechniqueRepository.dispose();this._shaderTechniqueRepository=null};Object.defineProperty(l.prototype,
"updating",{get:function(){return this._sortedLayerRenderersDirty||c.someMap(this._layerRenderers,function(a){return a.updating})||this.waterTextureRepository.updating},enumerable:!1,configurable:!0});l.prototype.commitChanges=function(){var a=this,b=!1;this._layerRenderers.forEach(function(c,d){c.commitChanges()&&(b=!0);c.isEmpty&&(a._layerRenderers.delete(d),a._sortedLayerRenderersDirty=!0,a._handles.remove(d))});this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),b=!0);b&&(this.notifyChange("updating"),
this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())};l.prototype.addGeometries=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];null==e.origin&&(e.origin=this._localOrigins.getOrigin(e.center));e.uniqueName||(e.uniqueName="ov:"+this._uniqueIdx++);this._geometries.set(e.uniqueName,e)}this.ensureLayerRenderer(b).add(a);2===c&&this.notifyGraphicUpdate(a,b,2)};l.prototype.removeGeometries=function(a,b,c){for(var d=0;d<a.length;d++)this._geometries.delete(a[d].uniqueName);
if(d=this._layerRenderers.get(b))d.remove(a),2===c&&this.notifyGraphicUpdate(a,b,2)};l.prototype.updateGeometries=function(a,b,c){var d=this._layerRenderers.get(b);d?(d.modify(a,c),this.notifyUpdateGeometries(a,b,c)):O.warn("Attempted to update geometry for nonexistent layer")};l.prototype.notifyUpdateGeometries=function(a,b,c){this.notifyGraphicUpdate(a,b,4===c||2===c?2:1===c?1:0)};l.prototype.notifyGraphicUpdate=function(a,b,c){if(0!==c)for(var d=-1,e=0;e<a.length;e++){var f=a[e].data.graphicUid;
f!==d&&(b.notifyGraphicUpdate(f,c),d=f)}};l.prototype.updateHighlights=function(a,b){(b=this._layerRenderers.get(b))?b.modify(a,8):O.warn("Attempted to update highlights for nonexistent layer")};l.prototype.isEmpty=function(){return 0===this._geometries.size&&!q.OVERLAY_DRAW_DEBUG_TEXTURE};Object.defineProperty(l.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"hasWater",{get:function(){return this._hasWater},
enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"rendersOccluded",{get:function(){return this._rendersOccluded},enumerable:!1,configurable:!0});l.prototype.updateLogic=function(a){var b=!1;this._layerRenderers.forEach(function(c){c.updateLogic(a)&&(b=!0)});return b};l.prototype.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0};l.prototype.drawPass=function(b,c,d,e){var f=this;void 0===e&&(e=0);if(0===d.numViews)return!1;this._screenToWorldRatio=d.pixelRatio*Math.abs(d.views[0].extent[2]-
d.views[0].extent[0])/Math.abs(d.views[0].viewport[2]-d.views[0].viewport[0]);if(this.isEmpty()||4===b&&!this.hasHighlights||2===b&&!this.hasWater||!this.hasNonZeroSizedView(d))return!1;var g=d.width,h=d.height;if(!c.isValid())return!1;c.resize(g,h);var k=this._rctx;P.pixelRatio=d.pixelRatio||1;this._renderContext.pass=b;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToWorldRatioGlobalWM=this._screenToWorldRatio*this.globalUnitScale;c.bind(k);k.setClearColor(0,
0,0,0);k.clearSafe(16384);1===e&&(this._renderContext.renderOccludedMask=a.overlayRenderOccludedFlag);if(q.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==e)for(var p=0;p<d.numViews;p++)this.setViewParameters(d.views[p],P),this.drawDebugTexture(g,h,S[d.index%S.length]);0<this._layerRenderers.size&&this._sortedLayerRenderers.forEachSimple(function(a){var p=a.layerView;a=a.renderer;if(2!==e||!m.isSome(p)||0!==p.drapeSourceType){var l=m.isSome(p)&&m.isSome(p.fullOpacity)&&1>p.fullOpacity&&0===b;l&&(f.bindTemporaryFramebuffer(f._rctx,
g,h),k.clearSafe(16384));for(var r=0;r<d.numViews;r++)f.setViewParameters(d.views[r],P),a.draw(f._renderContext,f._bindParameters,f._stats);l&&m.isSome(f._temporaryRenderTarget)&&(c.bind(k),f._compositingHelper.composite(f._temporaryRenderTarget.getTexture(),2,m.unwrap(m.unwrap(p).fullOpacity)))}});k.bindFramebuffer(null);c.generateMipMap();this._renderContext.resetRenderOccludedMask();return!0};l.prototype.bindTemporaryFramebuffer=function(a,b,c){h.isNone(this._temporaryRenderTarget)&&(this._temporaryRenderTarget=
new v.OverlayRenderTarget(a,"temp",0,!1));this._temporaryRenderTarget.resize(b,c);this._temporaryRenderTarget.bind(a)};l.prototype.getStats=function(){return this._stats.getAggregatedStats()};l.prototype.hotReloadShaders=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(a){switch(a.label){case 0:return[4,this._shaderTechniqueRepository.hotReload()];case 1:return a.sent(),[2]}})})};l.prototype.intersect=function(a,b,c){var d=this,e=0;this._geometries.forEach(function(f){if(!c||
c(f)){d.intersectRenderGeometry(f,b,0,a,e);var g=d.longitudeCyclical;g&&(f.center[0]-f.bsRadius<g.min&&d.intersectRenderGeometry(f,b,g.range,a,e),f.center[0]+f.bsRadius>g.max&&d.intersectRenderGeometry(f,b,-g.range,a,e));e++}})};l.prototype.intersectRenderGeometry=function(a,b,c,d,e){var f=this,g=0;m.isSome(a.transformation)&&(c+=a.transformation[12],g=a.transformation[13]);U[0]=b[0]-c;U[1]=b[1]-g;U[2]=1;Z[0]=b[0]-c;Z[1]=b[1]-g;Z[2]=0;a.screenToWorldRatio=this._screenToWorldRatio;a.material.intersect(a,
null,a.getShaderTransformation(),d,U,Z,function(b,c,g){f.addIntersectionResult(g,a.material.renderPriority,e,d,a.data.layerUid,a.data.graphicUid)},a.calculateShaderTransformation,!0)};l.prototype.addIntersectionResult=function(a,b,c,d,e,f){var g={type:"external",metadata:{layerUid:e,graphicUid:f}};e=function(e){e.set(g,null,d.results.ground.dist,d.results.ground.normal,d.results.ground.transformation,b,null,null,a,c);e.intersector="OverlayRenderer"};(null==d.results.min.drapedLayerOrder||b>=d.results.min.drapedLayerOrder)&&
(null==d.results.min.dist||d.results.ground.dist<=d.results.min.dist)&&e(d.results.min);0!==d.options.store&&(null==d.results.max.drapedLayerOrder||b<d.results.max.drapedLayerOrder)&&(null==d.results.max.dist||d.results.ground.dist>d.results.max.dist)&&e(d.results.max);2===d.options.store&&(f=new G.IntersectorResult(d.ray),e(f),d.results.all.push(f))};l.prototype.stopAnimationsAtTime=function(a){this._sortedLayerRenderers.forEachSimple(function(b){return b.renderer.stopAnimationsAtTime(a)})};l.prototype.ensureLayerRenderer=
function(a){var b=this,c=this._layerRenderers.get(a);c||(c=new J.SortedRenderGeometryRenderer({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(a,c),this._sortedLayerRenderersDirty=!0,this._handles.add([a.watch("fullOpacity",function(){return b.emitContentChanged()}),g.init(c,"updating",function(){return b.notifyChange("updating")})],a));return c};l.prototype.updateSortedLayerRenderers=function(){var a=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=
!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var d=c.firstKeyOfMap(this._layerRenderers).view.allLayerViews,e=b.SetFromValues(c.valuesOfMap(this._layerRenderers));d.forEach(function(b){var c=a._layerRenderers.get(b);c&&(a._sortedLayerRenderers.push(new N(b,c)),e.delete(c))});e.forEach(function(b){a._sortedLayerRenderers.push(new N(null,b))})}};l.prototype.setViewParameters=function(a,b){b.viewport=a.viewport;var c=a.extent;t.mat4.ortho(b.projectionMatrix,0,c[2]-c[0],0,c[3]-
c[1],b.near,b.far);t.mat4.identity(b.viewMatrix);t.mat4.translate(b.viewMatrix,b.viewMatrix,[-a.extent[0],-a.extent[1],0]);b.setGLViewport(this._rctx);this._renderContext.camera=b;this._bindParameters.camera=b;this._bindParameters.inverseViewport[0]=1/b.fullViewport[2];this._bindParameters.inverseViewport[1]=1/b.fullViewport[3]};l.prototype.hasNonZeroSizedView=function(a){for(var b=0;b<a.numViews;b++){var c=a.views[b];if(c.extent[0]!==c.extent[2]&&c.extent[1]!==c.extent[3])return!0}return!1};l.prototype.emitContentChanged=
function(){if(this.onContentChanged)this.onContentChanged()};l.prototype.updateHasWater=function(){var a=c.someMap(this._layerRenderers,function(a){return a.hasWater});a!==this._hasWater&&(this._hasWater=a)};l.prototype.updateHasHighlights=function(){var a=c.someMap(this._layerRenderers,function(a){return a.hasHighlights});if(a!==this._hasHighlights&&(this._hasHighlights=a,this.onHasHighlightsChanged))this.onHasHighlightsChanged(this._hasHighlights)};l.prototype.updateRendersOccluded=function(){var a=
c.someMap(this._layerRenderers,function(a){return a.rendersOccluded});if(a!==this._rendersOccluded&&(this._rendersOccluded=a,this.onRendersOccludedChanged))this.onRendersOccludedChanged(this.rendersOccluded)};l.prototype.drawDebugTexture=function(a,b,c){var d=this._rctx;this.ensureDebugPatternResources(a,b);a=this._debugPatternProgram;d.bindProgram(a);d.setPipelineState(this._debugPatternPipelineState);a.setUniform4f("color",c[0],c[1],c[2],1);a.setUniform1i("tex",0);d.bindTexture(this._debugPatternTexture,
0);d.bindVAO(this._quadVAO);d.drawArrays(5,0,R.vertexCount(this._quadVAO,"geometry"))};l.prototype.ensureDebugPatternResources=function(a,b){if(!this._debugPatternTexture){for(var c=new Uint8Array(a*b*4),d=0,e=0;e<b;e++)for(var f=0;f<a;f++){var g=Math.floor(f/10),h=Math.floor(e/10);2>g||2>h||10*g>a-20||10*h>b-20?(c[d++]=255,c[d++]=255,c[d++]=255,c[d++]=255):(c[d++]=255,c[d++]=255,c[d++]=255,g&1&&h&1?c[d++]=f&1^e&1?0:255:c[d++]=g&1^h&1?0:128)}this._debugPatternTexture=new Q(this._rctx,{target:3553,
pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:b},c);a=new I.TextureTechniqueConfiguration;a.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(I.TextureTechnique,a,this._debugTextureTechnique);this._debugPatternProgram=this._debugTextureTechnique.program;this._debugPatternPipelineState=this._debugTextureTechnique.pipeline;this._quadVAO=C.createQuadVAO(this._rctx)}};Object.defineProperty(l.prototype,"test",{get:function(){return{layerRenderers:this._layerRenderers}},
enumerable:!1,configurable:!0});d.__decorate([x.autoDispose()],l.prototype,"_shaderTechniqueRepository",void 0);d.__decorate([x.autoDispose()],l.prototype,"_stippleTextureRepository",void 0);d.__decorate([p.property(),x.autoDispose()],l.prototype,"waterTextureRepository",void 0);d.__decorate([p.property()],l.prototype,"renderView",void 0);d.__decorate([p.property()],l.prototype,"globalUnitScale",void 0);d.__decorate([p.property({type:Boolean,readOnly:!0,dependsOn:["waterTextureRepository.updating"]})],
l.prototype,"updating",null);return l=d.__decorate([p.subclass("esri.views.3d.terrain.OverlayRenderer")],l)}(x.AutoDisposableMixin(l));a.OverlayRenderer=n;var N=function(){return function(a,b){this.layerView=a;this.renderer=b}}(),S=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],P=new B.default;P.near=1;P.far=1E4;P.relativeElevation=null;var U=r.vec3f64.create(),Z=r.vec3f64.create();a.DRAPED_Z=-2;a.overlayRenderOccludedFlag=4})},"esri/views/3d/terrain/OverlayRenderTarget":function(){define(["require","exports","../../webgl",
"../../webgl/Util"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.OverlayRenderTarget=void 0;n=function(){function a(a,c,h,m){this._renderTarget=null;this.id=c+"_"+ ++h;this._renderTarget=new d.FramebufferObject(a,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:m,maxAnisotropy:8,width:0,height:0})}a.prototype.dispose=function(){this._renderTarget.dispose();this._renderTarget=null};a.prototype.getTexture=
function(){return this._renderTarget?this._renderTarget.colorTexture:null};a.prototype.isValid=function(){return null!==this._renderTarget};a.prototype.resize=function(a,c){this._renderTarget.resize(a,c)};a.prototype.bind=function(a){a.bindFramebuffer(this._renderTarget)};a.prototype.generateMipMap=function(){this._renderTarget.colorTexture.descriptor.hasMipmap&&this._renderTarget.colorTexture.generateMipmap()};a.prototype.disposeRenderTargetMemory=function(){this._renderTarget&&this._renderTarget.resize(0,
0)};a.prototype.getGpuMemoryUsage=function(){var a=0;this._renderTarget&&(a+=l.getGpuMemoryUsage(this._renderTarget));return a};return a}();a.OverlayRenderTarget=n})},"esri/views/webgl":function(){define("require exports ./webgl/BufferObject ./webgl/FramebufferObject ./webgl/Program ./webgl/Renderbuffer ./webgl/RenderingContext ./webgl/ShaderCompiler ./webgl/Texture ./webgl/VertexArrayObject ./webgl/ProgramCache ./webgl/programUtils ./webgl/context-util".split(" "),function(n,a,d,l,k,e,c,h,m,f,b,
g,p){Object.defineProperty(a,"__esModule",{value:!0});a.Renderbuffer=a.ShaderCompiler=a.Program=a.FramebufferObject=a.VertexArrayObject=a.Texture=a.RenderingContext=a.BufferObject=void 0;a.BufferObject=d;a.FramebufferObject=l;a.Program=k;a.Renderbuffer=e;a.RenderingContext=c;a.ShaderCompiler=h;a.Texture=m;a.VertexArrayObject=f;Object.defineProperty(a,"ProgramCache",{enumerable:!0,get:function(){return b.ProgramCache}});Object.defineProperty(a,"createProgram",{enumerable:!0,get:function(){return g.createProgram}});
Object.defineProperty(a,"glslifyDefineMap",{enumerable:!0,get:function(){return g.glslifyDefineMap}});Object.defineProperty(a,"createContextOrErrorHTML",{enumerable:!0,get:function(){return p.createContextOrErrorHTML}})})},"esri/views/webgl/FramebufferObject":function(){define("require exports tslib ../../core/has ../../core/Logger ../../core/maybe ./Renderbuffer ./Texture".split(" "),function(n,a,d,l,k,e,c,h){var m=k.getLogger("esri.views.webgl.FrameBufferObject");return function(){function a(b,
f,m,k){var g,p;this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._colorAttachments=new Map;this._initialized=!1;this._context=b;this._desc=d.__assign({},f);this._id=a._nextId++;e.isSome(b.instanceCounter)&&b.instanceCounter.increment(4,this);if(m){var l=void 0;if(Array.isArray(m))for(g=0;g<m.length;g++){l=m[g];f=l.attachmentPoint;var l=l.texture,t=l instanceof h?l:new h(b,l),l=t.descriptor;this._colorAttachments.set(f,t);this._validateColorAttachmentPoint(f);this._validateTextureDimensions(l,
this._desc)}else m instanceof h?(l=m.descriptor,this._colorAttachments.set(36064,m)):(l=m,this._colorAttachments.set(36064,new h(b,m))),0!==(null===(g=this._desc)||void 0===g?void 0:g.colorTarget)&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),this._validateTextureDimensions(l,this._desc)}k instanceof c?(b=null!==(p=this._desc.depthStencilTarget)&&void 0!==p?p:3,2===b?this._stencilAttachment=k:1===b||3===b?this._depthAttachment=
k:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),a._validateBufferDimensions(k.descriptor,this._desc)):k&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),p=void 0,k instanceof h?(this._depthStencilTexture=k,p=this._depthStencilTexture.descriptor):(p=k,this._depthStencilTexture=
new h(this._context,p)),this._validateTextureDimensions(p,this._desc))}a.prototype.dispose=function(){if(this._context){var a=this._context,c=a.getBoundFramebufferObject();this._disposeColorAttachments();this._disposeDepthStencilAttachments();this._glName&&(a.gl.deleteFramebuffer(this._glName),this._glName=null);e.isSome(a.instanceCounter)&&a.instanceCounter.decrement(4,this);a.bindFramebuffer(c);this._context=null}};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){var a=this._colorAttachments.get(36064);return a&&a instanceof h?a:null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"colorAttachment",{get:function(){return this._colorAttachments.get(36064)},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"depthStencilAttachment",{get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._desc.width},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"height",{get:function(){return this._desc.height},enumerable:!1,configurable:!0});a.prototype.getColorTexture=function(a){return(a=this._colorAttachments.get(a))&&a instanceof h?a:null};a.prototype.attachColorTexture=function(a,c){void 0===c&&(c=36064);if(a){this._validateColorAttachmentPoint(c);this._validateTextureDimensions(a.descriptor,this._desc);this._disposeColorAttachments();if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,
c,b.TEXTURE_2D,a.glName,0)}this._colorAttachments.set(c,a)}};a.prototype.detachColorTexture=function(a){void 0===a&&(a=36064);var b=this._colorAttachments.get(a);if(b instanceof h){if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;c.framebufferTexture2D(c.FRAMEBUFFER,a,c.TEXTURE_2D,null,0)}this._colorAttachments.delete(a);return b}};a.prototype.attachDepthStencilTexture=function(a){if(a){var b=a.descriptor;34041!==b.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");
34042!==b.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");this._validateTextureDimensions(b,this._desc);this._desc.depthStencilTarget&&4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),
b=this._context.gl,b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,a.glName,0));this._depthStencilTexture=a}};a.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;this._context.gl.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};a.prototype.attachDepthStencilBuffer=function(b){if(b){var c=
b.descriptor;34041!==c.internalFormat&&33189!==c.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");a._validateBufferDimensions(c,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===c.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,c.framebufferRenderbuffer(c.FRAMEBUFFER,1===this._desc.depthStencilTarget?c.DEPTH_ATTACHMENT:c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,b.glName));this._depthAttachment=
b}};a.prototype.detachDepthStencilBuffer=function(){var a=this._context.gl,c=this._depthAttachment;c&&this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null));this._depthAttachment=null;return c};a.prototype.copyToTexture=function(a,c,d,e,f,h,m){(0>a||0>c||0>f||0>h)&&console.error("Offsets cannot be negative!");(0>=d||0>=e)&&console.error("Copy width and height must be greater than zero!");
var b=this._desc,g=m.descriptor;3553!==m.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(a+d>b.width||c+e>b.height||f+d>g.width||h+e>g.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");b=this._context;b.bindTexture(m);b.bindFramebuffer(this);b.gl.copyTexSubImage2D(3553,0,f,h,a,c,d,e)};a.prototype.readPixels=function(a,c,d,e,f,h,m){(0>=d||0>=e)&&console.error("Copy width and height must be greater than zero!");m||
console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,c,d,e,f,h,m)};a.prototype.resize=function(a,c){var b=this._desc;if(b.width!==a||b.height!==c)if(this._initialized){b.width=a;b.height=c;this._colorAttachments.forEach(function(b){b&&b.resize(a,c)});if(null!=this._depthStencilTexture)this._depthStencilTexture.resize(a,c);else if(this._depthAttachment||this._stencilAttachment)this._depthAttachment&&this._depthAttachment.resize(a,c),this._stencilAttachment&&
this._stencilAttachment.resize(a,c);this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null);this._initialized=!1}else b.width=a,b.height=c,this._colorAttachments.forEach(function(b){b&&b.resize(a,c)}),this._depthStencilTexture&&this._depthStencilTexture.resize(a,c)};a.prototype.initialize=function(){var a,d,e,f;if(this._initialized)return!1;var m=this._context,k=m.gl;this._glName&&k.deleteFramebuffer(this._glName);var l=k.createFramebuffer(),v=this._desc,w=null!==(a=
v.colorTarget)&&void 0!==a?a:1;a=null!==(d=v.width)&&void 0!==d?d:1;d=null!==(e=v.height)&&void 0!==e?e:1;k.bindFramebuffer(k.FRAMEBUFFER,l);0===this._colorAttachments.size&&(0===w?this._colorAttachments.set(36064,new h(m,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:v.width,height:v.height})):(e=new c(m,{internalFormat:32854,width:a,height:d}),this._colorAttachments.set(36064,e)));this._colorAttachments.forEach(function(a,b){a&&(a instanceof h?k.framebufferTexture2D(k.FRAMEBUFFER,
b,k.TEXTURE_2D,a.glName,0):k.framebufferRenderbuffer(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.RENDERBUFFER,a.glName))});e=null!==(f=v.depthStencilTarget)&&void 0!==f?f:0;switch(e){case 1:case 3:this._depthAttachment||(this._depthAttachment=new c(m,{internalFormat:1===v.depthStencilTarget?33189:34041,width:a,height:d}));k.framebufferRenderbuffer(k.FRAMEBUFFER,1===e?k.DEPTH_ATTACHMENT:k.DEPTH_STENCIL_ATTACHMENT,k.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=
new c(m,{internalFormat:36168,width:a,height:d}));k.framebufferRenderbuffer(k.FRAMEBUFFER,k.STENCIL_ATTACHMENT,k.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:this._depthStencilTexture||(m.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new h(m,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:a,height:d})),
k.framebufferTexture2D(k.FRAMEBUFFER,k.DEPTH_STENCIL_ATTACHMENT,k.TEXTURE_2D,this._depthStencilTexture.glName,0)}this._glName=l;return this._initialized=!0};a.prototype._disposeColorAttachments=function(){var a=this;this._colorAttachments.forEach(function(b,c){if(b instanceof h){if(a._initialized){a._context.bindFramebuffer(a);var d=a._context.gl;d.framebufferTexture2D(d.FRAMEBUFFER,c,d.TEXTURE_2D,null,0)}b.dispose()}else b instanceof WebGLRenderbuffer&&(d=a._context.gl,a._initialized&&(a._context.bindFramebuffer(a),
d.framebufferRenderbuffer(d.FRAMEBUFFER,c,d.RENDERBUFFER,null)),a._context.gl.deleteRenderbuffer(b))});this._colorAttachments.clear()};a.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&
(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};a._validateBufferDimensions=function(a,c){console.assert(0<=
a.width&&0<=a.height);void 0!==c.width&&0<=c.width&&void 0!==c.height&&0<=c.height?c.width===a.width&&c.height===a.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(c.width=a.width,c.height=a.height)};a.prototype._validateTextureDimensions=function(a,c){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==c.width&&0<=c.width&&void 0!==c.height&&0<=c.height?c.width===a.width&&c.height===a.height||console.error("Color attachment texture must match the framebuffer's!"):
(c.width=a.width,c.height=a.height)};a.prototype._validateColorAttachmentPoint=function(b){if(-1===a._MAX_COLOR_ATTACHMENTS){var c=this._context.capabilities.drawBuffers;a._MAX_COLOR_ATTACHMENTS=c?this._context.gl.getParameter(c.MAX_COLOR_ATTACHMENTS):1}b-=36064;b+1>a._MAX_COLOR_ATTACHMENTS&&m.error("esri.FrameBufferObject","illegal attachment point for color attachment: "+(b+1)+". Implementation supports up to "+a._MAX_COLOR_ATTACHMENTS+" color attachments")};a._nextId=0;a._MAX_COLOR_ATTACHMENTS=
-1;return a}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","../../core/maybe"],function(n,a,d){return function(){function a(k,e){this._context=k;this._desc=e;this._glName=null;this._id=-1;k=this._context.gl;d.isSome(this._context.instanceCounter)&&this._context.instanceCounter.increment(5,this);this._id=++a._nextId;this._glName=k.createRenderbuffer();this._context.bindRenderbuffer(this);k.renderbufferStorage(k.RENDERBUFFER,e.internalFormat,e.width,e.height)}Object.defineProperty(a.prototype,
"descriptor",{get:function(){return this._desc},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!1,configurable:!0});a.prototype.resize=function(a,d){var c=this._context.gl,e=this._desc;if(e.width!==a||e.height!==d)e.width=a,e.height=d,this._context.bindRenderbuffer(this),c.renderbufferStorage(c.RENDERBUFFER,e.internalFormat,
e.width,e.height)};a.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);this._context&&d.isSome(this._context.instanceCounter)&&this._context.instanceCounter.decrement(5,this);this._context=null};a._nextId=0;return a}()})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ../../core/maybe ./enums ./InstanceCounter ./renderState ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(n,
a,d,l,k,e,c,h,m){return function(){function a(a,d){var b=this;this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=
1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;
this._activeTextureUnit=0;this._textureUnitMap={};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=h.default(a)?"webgl2":"webgl";this.gl=a;a instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=m.loadCapabilities(a,d);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],width:a[2],height:a[3]};this._stateTracker=new c.StateTracker({setBlending:function(a){a?(b.setBlendingEnabled(!0),b.setBlendEquationSeparate(a.opRgb,
a.opAlpha),b.setBlendFunctionSeparate(a.srcRgb,a.dstRgb,a.srcAlpha,a.dstAlpha),a=a.color,b.setBlendColor(a.r,a.g,a.b,a.a)):b.setBlendingEnabled(!1)},setCulling:function(a){a?(b.setFaceCullingEnabled(!0),b.setCullFace(a.face),b.setFrontFace(a.mode)):b.setFaceCullingEnabled(!1)},setPolygonOffset:function(a){a?(b.setPolygonOffsetFillEnabled(!0),b.setPolygonOffset(a.factor,a.units)):b.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(a){a?(b.setDepthTestEnabled(!0),b.setDepthFunction(a.func)):b.setDepthTestEnabled(!1)},
setStencilTest:function(a){if(a){b.setStencilTestEnabled(!0);var c=a.function;b.setStencilFunction(c.func,c.ref,c.mask);a=a.operation;b.setStencilOp(a.fail,a.zFail,a.zPass)}else b.setStencilTestEnabled(!1)},setDepthWrite:function(a){a?(b.setDepthWriteEnabled(!0),b.setDepthRange(a.zNear,a.zFar)):b.setDepthWriteEnabled(!1)},setColorWrite:function(a){a?b.setColorMask(a.r,a.g,a.b,a.a):b.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(a){a?b.setStencilWriteMask(a.mask):b.setStencilWriteMask(0)}});
this.enforceState()}Object.defineProperty(a.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"parameters",{get:function(){if(!this._parameters){var a=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),
maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)}}return this._parameters},enumerable:!1,configurable:!0});a.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};l.isSome(this.instanceCounter)&&(this.instanceCounter.printResourceCount(),this.instanceCounter.destroy());
this._capabilities=this.gl=null};a.prototype.setPipelineState=function(a){this._stateTracker.setPipeline(a)};a.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=a,this._stateTracker.invalidateBlending())};a.prototype.setBlendColor=function(a,c,d,e){if(a!==this._blendColorState.r||c!==this._blendColorState.g||d!==this._blendColorState.b||e!==this._blendColorState.a)this.gl.blendColor(a,c,d,e),this._blendColorState.r=
a,this._blendColorState.g=c,this._blendColorState.b=d,this._blendColorState.a=e,this._stateTracker.invalidateBlending()};a.prototype.setBlendFunction=function(a,c){if(a!==this._blendFunctionState.srcRGB||c!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,c),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=c,this._blendFunctionState.dstAlpha=c,this._stateTracker.invalidateBlending()};a.prototype.setBlendFunctionSeparate=function(a,c,d,e){if(this._blendFunctionState.srcRGB!==
a||this._blendFunctionState.srcAlpha!==d||this._blendFunctionState.dstRGB!==c||this._blendFunctionState.dstAlpha!==e)this.gl.blendFuncSeparate(a,c,d,e),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=d,this._blendFunctionState.dstRGB=c,this._blendFunctionState.dstAlpha=e,this._stateTracker.invalidateBlending()};a.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=
a,this._stateTracker.invalidateBlending())};a.prototype.setBlendEquationSeparate=function(a,c){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==c)this.gl.blendEquationSeparate(a,c),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=c,this._stateTracker.invalidateBlending()};a.prototype.setColorMask=function(a,c,d,e){if(this._colorMaskState.r!==a||this._colorMaskState.g!==c||this._colorMaskState.b!==d||this._colorMaskState.a!==e)this.gl.colorMask(a,c,d,e),
this._colorMaskState.r=a,this._colorMaskState.g=c,this._colorMaskState.b=d,this._colorMaskState.a=e,this._stateTracker.invalidateColorWrite()};a.prototype.setClearColor=function(a,c,d,e){if(this._clearColor.r!==a||this._clearColor.g!==c||this._clearColor.b!==d||this._clearColor.a!==e)this.gl.clearColor(a,c,d,e),this._clearColor.r=a,this._clearColor.g=c,this._clearColor.b=d,this._clearColor.a=e};a.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):
this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a,this._stateTracker.invalidateCulling())};a.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=a,this._stateTracker.invalidatePolygonOffset())};a.prototype.setPolygonOffset=function(a,c){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==c)this._polygonOffset[0]=a,this._polygonOffset[1]=
c,this.gl.polygonOffset(a,c),this._stateTracker.invalidatePolygonOffset()};a.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a,this._stateTracker.invalidateCulling())};a.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a,this._stateTracker.invalidateCulling())};a.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),
this._scissorTestEnabled=a)};a.prototype.setScissorRect=function(a,c,d,e){if(this._scissorRect.x!==a||this._scissorRect.y!==c||this._scissorRect.width!==d||this._scissorRect.height!==e)this.gl.scissor(a,c,d,e),this._scissorRect.x=a,this._scissorRect.y=c,this._scissorRect.width=d,this._scissorRect.height=e};a.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=a,this._stateTracker.invalidateDepthTest())};
a.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};a.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a,this._stateTracker.invalidateDepthTest())};a.prototype.setDepthWriteEnabled=function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a,this._stateTracker.invalidateDepthWrite())};a.prototype.setDepthRange=function(a,c){if(this._depthRange.zNear!==a||this._depthRange.zFar!==
c)this.gl.depthRange(a,c),this._depthRange.zNear=a,this._depthRange.zFar=c,this._stateTracker.invalidateDepthWrite()};a.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a,this._stateTracker.invalidateStencilTest())};a.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=a)};a.prototype.setStencilFunction=function(a,
c,d){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==c||this._stencilFunction.mask!==d)this.gl.stencilFunc(a,c,d),this._stencilFunction.face=1032,this._stencilFunction.func=a,this._stencilFunction.ref=c,this._stencilFunction.mask=d,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilFunctionSeparate=function(a,c,d,e){if(this._stencilFunction.face!==a||this._stencilFunction.func!==c||this._stencilFunction.ref!==d||this._stencilFunction.mask!==e)this.gl.stencilFuncSeparate(a,
c,d,e),this._stencilFunction.face=a,this._stencilFunction.func=c,this._stencilFunction.ref=d,this._stencilFunction.mask=e,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=a,this._stateTracker.invalidateStencilWrite())};a.prototype.setStencilOp=function(a,c,d){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==c||this._stencilOperation.zPass!==d)this.gl.stencilOp(a,c,d),
this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=c,this._stencilOperation.zPass=d,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilOpSeparate=function(a,c,d,e){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==c||this._stencilOperation.zFail!==d||this._stencilOperation.zPass!==e)this.gl.stencilOpSeparate(a,c,d,e),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=c,this._stencilOperation.zFail=
d,this._stencilOperation.zPass=e,this._stateTracker.invalidateStencilTest()};a.prototype.setActiveTexture=function(a){var b=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(k.BASE_TEXTURE_UNIT+a),this._activeTextureUnit=a);return b};a.prototype.clear=function(a){a&&this.gl.clear(a)};a.prototype.clearSafe=function(a,c){void 0===c&&(c=255);a&&(a&16384&&this.setColorMask(!0,!0,!0,!0),a&256&&this.setDepthWriteEnabled(!0),a&1024&&this.setStencilWriteMask(c),this.gl.clear(a))};
a.prototype.drawArrays=function(a,c,d){this.gl.drawArrays(a,c,d)};a.prototype.drawElements=function(a,c,d,e){5123===d?this.gl.drawElements(a,c,d,e):5125===d&&this.gl.drawElements(a,c,d,e)};a.prototype.logIno=function(){};Object.defineProperty(a.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!1,configurable:!0});a.prototype.setViewport=function(a,c,d,e){var b=this._viewport;if(b.x!==a||b.y!==c||b.width!==d||b.height!==e)b.x=a,b.y=c,b.width=d,b.height=e,this.gl.viewport(a,
c,d,e)};a.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};a.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};a.prototype.bindTexture=function(b,c){void 0===c&&(c=0);-1===a._MAX_TEXTURE_IMAGE_UNITS&&(a._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));
(c>=a._MAX_TEXTURE_IMAGE_UNITS||0>c)&&console.error("Input texture unit is out of range of available units!");var d=this._textureUnitMap[c];this.setActiveTexture(c);null==b||null==b.glName?(null!=d&&(this.gl.bindTexture(d.descriptor.target,null),d.setBoundToUnit(c,!1)),this._textureUnitMap[c]=null):d&&d.id===b.id?b.applyChanges():(d&&d.setBoundToUnit(c,!1),this.gl.bindTexture(b.descriptor.target,b.glName),b.setBoundToUnit(c,!0),b.applyChanges(),this._textureUnitMap[c]=b)};a.prototype.bindFramebuffer=
function(a){l.isNone(a)?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null):this._activeFramebuffer!==a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a)};a.prototype.bindBuffer=function(b){b&&(34962===b.bufferType?this._activeVertexBuffer=a._bindBuffer(this.gl,b,b.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,b,b.bufferType,this._activeIndexBuffer))};a.prototype.bindRenderbuffer=function(a){var b=
this.gl;a||(b.bindRenderbuffer(b.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(b.bindRenderbuffer(b.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};a.prototype.unbindBuffer=function(b){34962===b?this._activeVertexBuffer=a._bindBuffer(this.gl,null,b,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,null,b,this._activeIndexBuffer)};a.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),
this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};a.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};a.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};a.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};a.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);
for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,
1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};a.prototype.enforceState=function(){var a=this.gl,c=this.capabilities.vao;c&&c.bindVertexArray(null);for(var d=0;d<this.parameters.maxVertexAttributes;d++)a.disableVertexAttribArray(d);
this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(c&&this._activeVertexArrayObject){if(c=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(c)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:
null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);a.bindRenderbuffer(a.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,
this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?
a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);a.lineWidth(1);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?a.enable(a.SCISSOR_TEST):
a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(c=0;c<this.parameters.maxTextureImageUnits;c++)a.activeTexture(k.BASE_TEXTURE_UNIT+c),a.bindTexture(3553,null),(d=this._textureUnitMap[c])&&
a.bindTexture(d.descriptor.target,d.glName);a.activeTexture(k.BASE_TEXTURE_UNIT+this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};a._bindBuffer=function(a,c,d,e){if(!c)return a.bindBuffer(d,null),null;if(e===c)return e;a.bindBuffer(d,c.glName);return c};a._MAX_TEXTURE_IMAGE_UNITS=-1;return a}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.BASE_TEXTURE_UNIT=
void 0;a.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.InstanceCounter=a.allInstanceCounters=void 0;a.allInstanceCounters=new Set;n=function(){function d(){this._current=[];this._max=[];for(this._allocations=new Map;6>this._current.length;)this._current.push(0),this._max.push(0);a.allInstanceCounters.add(this)}d.prototype.destroy=function(){a.allInstanceCounters.delete(this)};d.prototype.increment=
function(a,d){d=++this._current[a];this._max[a]=Math.max(d,this._max[a])};d.prototype.decrement=function(a,d){--this._current[a]};Object.defineProperty(d.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0});d.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._current[0]);console.log("Buffers: "+this._current[1]);
console.log("VAOs: "+this._current[2]);console.log("Programs: "+this._current[3]);console.log("Framebuffers: "+this._current[4]);console.log("Renderbuffers: "+this._current[5]);if(0<this._allocations.size){console.log(this._allocations.size+" live object allocations:");var a=new Map;this._allocations.forEach(function(d){var e;a.set(d,(null!==(e=a.get(d))&&void 0!==e?e:0)+1)});a.forEach(function(a,d){return console.log(a," : ",d)})}};return d}();a.InstanceCounter=n})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.default=function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./DrawBuffers ./Instancing ./isWebGL2Context ./LoseContext ./VertexArrayObjects".split(" "),function(n,a,d,l,k,e,c,h){function m(a,b,c,d,h){if(d&&e.default(a))return!0;if(b[c])return!1;for(b=0;b<h.length;b++)if(a.getExtension(h[b]))return!0;
return!1}Object.defineProperty(a,"__esModule",{value:!0});a.loadCapabilities=void 0;a.loadCapabilities=function(a,b){var f=b&&b.disabledExtensions||{},p=b&&b.debugWebGLExtensions||{},t,u,r,q,v,w,z,x,B,A,C=null,E=null,G=null,F=null;return{get drawBuffers(){A||(A=l.load(a,f));return A},get instancing(){t||(t=k.load(a));return t},get vao(){u||(u=h.load(a,f));return u},get compressedTextureS3TC(){if(!r)if(f.compressedTextureS3TC)r=null;else{var b=a.getExtension("WEBGL_compressed_texture_s3tc");r=b?{COMPRESSED_RGB_S3TC_DXT1:b.COMPRESSED_RGB_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT1:b.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:b.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:b.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}return r},get textureFilterAnisotropic(){if(!q)if(f.textureFilterAnisotropic)q=null;else{var b=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");q=b?{MAX_TEXTURE_MAX_ANISOTROPY:b.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:b.TEXTURE_MAX_ANISOTROPY_EXT}:
null}return q},get disjointTimerQuery(){v||(v=d.load(a,f));return v},get textureFloat(){if(!w)if(e.default(a))w={textureFloat:!0,textureFloatLinear:!f.textureFloatLinear&&!!a.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!f.textureHalfFloatLinear&&!!a.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:a.HALF_FLOAT};else if(a instanceof WebGLRenderingContext){var b=!f.textureHalfFloat&&a.getExtension("OES_texture_half_float");w={textureFloat:!f.textureFloat&&
!!a.getExtension("OES_texture_float"),textureFloatLinear:!f.textureFloatLinear&&!!a.getExtension("OES_texture_float_linear"),textureHalfFloat:!!b,textureHalfFloatLinear:!f.textureHalfFloatLinear&&!!a.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:b?b.HALF_FLOAT_OES:void 0}}else w=null;return w},get colorBufferFloat(){if(!z)if(e.default(a)){var b=!f.colorBufferFloat&&a.getExtension("EXT_color_buffer_half_float"),c=!f.colorBufferFloat&&a.getExtension("EXT_color_buffer_float");z=b||c?{textureFloat:!!c,
textureHalfFloat:!!b,R16F:a.R16F,RG16F:a.RG16F,RGBA16F:a.RGBA16F,R32F:a.R32F,RG32F:a.RG32F,RGBA32F:a.RGBA32F,R11F_G11F_B10F:a.R11F_G11F_B10F,RGB16F:a.RGB16F}:null}else a instanceof WebGLRenderingContext?(b=!f.colorBufferFloat&&a.getExtension("EXT_color_buffer_half_float"),c=!f.colorBufferFloat&&a.getExtension("WEBGL_color_buffer_float"),z=b||c?{textureFloat:!!c,textureHalfFloat:!!b,RGBA16F:b?b.RGBA16F_EXT:void 0,RGB16F:b?b.RGB16F_EXT:void 0,RGBA32F:c?c.RGBA32F_EXT:void 0}:null):z=null;return z},get blendMinMax(){if(!x)if(e.default(a))x=
{MIN:a.MIN,MAX:a.MAX};else if(f.blendMinMax)x=null;else{var b=a.getExtension("EXT_blend_minmax");x=b?{MIN:b.MIN_EXT,MAX:b.MAX_EXT}:null}return x},get depthTexture(){null===C&&(C=m(a,f,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return C},get standardDerivatives(){null===E&&(E=m(a,f,"standardDerivatives",!0,["OES_standard_derivatives"]));return E},get shaderTextureLOD(){null===G&&(G=m(a,f,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return G},
get fragDepth(){null===F&&(F=m(a,f,"fragDepth",!0,["EXT_frag_depth"]));return F},get loseContext(){B||(B=c.load(a,p));return B}}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.load=void 0;a.load=function(a,k){if(k.disjointTimerQuery)return null;var e=a.getExtension("EXT_disjoint_timer_query")||a.getExtension("EXT_disjoint_timer_query_webgl2");return e?d.default(a)?
{createQuery:function(){return a.createQuery()},resultAvailable:function(c){return a.getQueryParameter(c,a.QUERY_RESULT_AVAILABLE)},getResult:function(c){return a.getQueryParameter(c,a.QUERY_RESULT)},disjoint:function(){return a.getParameter(e.GPU_DISJOINT_EXT)},beginTimeElapsed:function(c){return a.beginQuery(e.TIME_ELAPSED_EXT,c)},endTimeElapsed:function(){return a.endQuery(e.TIME_ELAPSED_EXT)},createTimestamp:function(a){return e.queryCounterEXT(a,e.TIMESTAMP_EXT)},timestampBits:function(){return a.getQuery(e.TIMESTAMP_EXT,
e.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return e.createQueryEXT()},resultAvailable:function(a){return e.getQueryObjectEXT(a,e.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(a){return e.getQueryObjectEXT(a,e.QUERY_RESULT_EXT)},disjoint:function(){return a.getParameter(e.GPU_DISJOINT_EXT)},beginTimeElapsed:function(a){return e.beginQueryEXT(e.TIME_ELAPSED_EXT,a)},endTimeElapsed:function(){return e.endQueryEXT(e.TIME_ELAPSED_EXT)},createTimestamp:function(a){return e.queryCounterEXT(a,e.TIMESTAMP_EXT)},
timestampBits:function(){return e.getQueryEXT(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["require","exports","./isWebGL2Context"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.load=void 0;a.load=function(a,k){return k.disjointTimerQuery?null:d.default(a)?{drawBuffers:a.drawBuffers.bind(a),MAX_DRAW_BUFFERS:a.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:a.MAX_COLOR_ATTACHMENTS}:k.drawBuffers?null:(a=a.getExtension("WEBGL_draw_buffers"))?
{drawBuffers:a.drawBuffersWEBGL.bind(a),MAX_DRAW_BUFFERS:a.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:a.MAX_COLOR_ATTACHMENTS_WEBGL}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.load=void 0;a.load=function(a){return d.default(a)?{drawArraysInstanced:a.drawArraysInstanced.bind(a),drawElementsInstanced:a.drawElementsInstanced.bind(a),vertexAttribDivisor:a.vertexAttribDivisor.bind(a)}:
(a=a.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:a.drawArraysInstancedANGLE.bind(a),drawElementsInstanced:a.drawElementsInstancedANGLE.bind(a),vertexAttribDivisor:a.vertexAttribDivisorANGLE.bind(a)}:null}})},"esri/views/webgl/capabilities/LoseContext":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.load=void 0;a.load=function(a,l){var d=l.loseContext&&a.getExtension("WEBGL_lose_context");return d?{loseRenderingContext:function(){return d.loseContext()}}:
null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require","exports","./isWebGL2Context"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.load=void 0;a.load=function(a,k){return d.default(a)?{createVertexArray:a.createVertexArray.bind(a),deleteVertexArray:a.deleteVertexArray.bind(a),bindVertexArray:a.bindVertexArray.bind(a)}:k.vao?null:(a=a.getExtension("OES_vertex_array_object")||a.getExtension("MOZ_OES_vertex_array_object")||a.getExtension("WEBKIT_OES_vertex_array_object"))?
{createVertexArray:a.createVertexArrayOES.bind(a),deleteVertexArray:a.deleteVertexArrayOES.bind(a),bindVertexArray:a.bindVertexArrayOES.bind(a)}:null}})},"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(n,a){return function(){function a(a){this.readFile=a}a.prototype.resolveIncludes=function(a){return this.resolve(a)};a.prototype.resolve=function(a,d){var e=this;void 0===d&&(d=new Map);if(d.has(a))return d.get(a);var c=this.read(a);if(!c)throw Error("cannot find shader file "+
a);for(var h=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm,m=h.exec(c),f=[];null!=m;)f.push({path:m[1],start:m.index,length:m[0].length}),m=h.exec(c);var b=0,g="";f.forEach(function(a){g+=c.slice(b,a.start);g+=d.has(a.path)?"":e.resolve(a.path,d);b=a.start+a.length});g+=c.slice(b);d.set(a,g);return g};a.prototype.read=function(a){return this.readFile(a)};return a}()})},"esri/views/webgl/ProgramCache":function(){define(["require","exports","./programUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",
{value:!0});a.ProgramCache=void 0;n=function(){function a(a){this._programCacheByTemplate=new Map;this._rctx=a}a.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});this._programCacheByTemplate=null};a.prototype.getProgram=function(a,e){var c=this;this._programCacheByTemplate.has(a)||this.addProgramTemplate(a,function(e){return d.createProgram(c._rctx,a,e)});return this.getProgramTemplateInstance(a,e)};a.prototype.addProgramTemplate=
function(a,d){this._programCacheByTemplate.set(a,{constructor:d,programs:new Map})};a.prototype.getProgramTemplateInstance=function(a,d){if(a=this._programCacheByTemplate.get(a)){var c=d?JSON.stringify(d):"default";a.programs.has(c)||(d=a.constructor(d),a.programs.set(c,d));return a.programs.get(c)}return null};return a}();a.ProgramCache=n})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.createProgram=
a.glslifyDefineMap=void 0;a.glslifyDefineMap=function(a){var d="",e;for(e in a){var c=a[e];if("boolean"===typeof c)c&&(d+="#define "+e+"\n");else if("number"===typeof c)d+="#define "+e+" "+c.toFixed()+"\n";else if("object"===typeof c){var h=c.options,m=0,f;for(f in h)d+="#define "+h[f]+" "+(m++).toFixed()+"\n";d+="#define "+e+" "+h[c.value]+"\n"}}return d};a.createProgram=function(a,k,e,c){e=e||{};c=c||"";e="function"===typeof k.shaders?k.shaders(e):k.shaders;return new d(a,c+e.vertexShader,c+e.fragmentShader,
k.attributes)}})},"esri/views/3d/webgl-engine/core/shaderTechnique/CommonUniformStore":function(){define(["require","exports","../../../../../core/arrayUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.CommonUniformStore=void 0;n=function(){function a(){this._uniforms={proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}a.prototype.dispose=function(){this._uniforms=null};a.prototype.getPrograms=function(a){return this._uniforms[a]||[]};a.prototype.subscribeProgram=
function(a){for(var d in this._uniforms)a.hasUniform(d)&&this._uniforms[d].push(a)};a.prototype.unsubscribeProgram=function(a){for(var e in this._uniforms)d.removeUnordered(this._uniforms[e],a)};return a}();a.CommonUniformStore=n})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["require","exports","tslib","../../../../../core/maybe","../../../../../core/promiseUtils"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.ShaderTechniqueRepository=
void 0;var e=function(){return function(a){this.technique=a;this.refZeroFrame=this.refCount=0}}();n=function(){function a(a){this._context=a;this._perConstructorInstances=new Map;this._frameCounter=0;this._keepAliveFrameCount=1200}Object.defineProperty(a.prototype,"viewingMode",{get:function(){return this._context.viewingMode},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"constructionContext",{get:function(){return this._context},enumerable:!1,configurable:!0});a.prototype.dispose=
function(){this._perConstructorInstances.forEach(function(a){return a.forEach(function(a){return a.technique.dispose()})});this._perConstructorInstances.clear()};a.prototype.acquire=function(a,c){var d=c.key,b=this._perConstructorInstances.get(a);b||(b=new Map,this._perConstructorInstances.set(a,b));var g=b.get(d);void 0===g&&(g=new e(new a(this._context,c)),b.set(d,g));++g.refCount;return g.technique};a.prototype.acquireAndReleaseExisting=function(a,c,d){return l.isNone(d)?this.acquire(a,c):c.key===
d.key&&d instanceof a?d:(this.release(d),this.acquire(a,c))};a.prototype.release=function(a){a=this._perConstructorInstances.get(a.constructor).get(a.key);--a.refCount;0===a.refCount&&(a.refZeroFrame=this._frameCounter)};a.prototype.frameUpdate=function(){var a=this;this._frameCounter++;this._perConstructorInstances.forEach(function(c,d){c.forEach(function(b,d){0===b.refCount&&b.refZeroFrame+a._keepAliveFrameCount<a._frameCounter&&(b.technique.dispose(),c.delete(d))});0===c.size&&a._perConstructorInstances.delete(d)})};
a.prototype.getProgramsUsingUniform=function(a){return this._context.commonUniformStore.getPrograms(a)};a.prototype.hotReload=function(){return d.__awaiter(this,void 0,void 0,function(){var a,c=this;return d.__generator(this,function(e){switch(e.label){case 0:return a=[],this._perConstructorInstances.forEach(function(b,e){a.push(function(a,b){return d.__awaiter(c,void 0,void 0,function(){var c,e=this;return d.__generator(this,function(d){switch(d.label){case 0:return(c=b.shader)?[4,c.reload()]:[3,
2];case 1:d.sent(),a.forEach(function(a){a.technique.reload(e._context)}),d.label=2;case 2:return[2]}})})}(b,e))}),[4,k.all(a)];case 1:return e.sent(),[2]}})})};return a}();a.ShaderTechniqueRepository=n})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define("require exports ../../../../core/Logger ../../../../core/maybe ../core/shaderLibrary/ShaderOutputOptions ./Util".split(" "),function(n,a,d,l,k,e){var c=d.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep"),h=function(){function a(a){this.refCnt=
0;this.glMaterial=a}a.prototype.incRefCnt=function(){++this.refCnt};a.prototype.decRefCnt=function(){--this.refCnt;e.assert(0<=this.refCnt)};a.prototype.getRefCnt=function(){return this.refCnt};a.prototype.getGLMaterial=function(){return this.glMaterial};return a}();return function(){function a(a,b,c){this._textureRep=a;this._techniqueRep=b;this.onMaterialChanged=c;this._id2glMaterialRef=new Map}a.prototype.dispose=function(){this._textureRep.dispose()};a.prototype.acquire=function(a,b){this.ownMaterial(a);
var c=k.getShaderOutputID(a.id,b),d=this._id2glMaterialRef.get(c);null==d?(a=a.getGLMaterial({material:a,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:b}),d=new h(a),this._id2glMaterialRef.set(c,d)):a=d.getGLMaterial();d.incRefCnt();return a};a.prototype.release=function(a,b){a=k.getShaderOutputID(a.id,b);b=this._id2glMaterialRef.get(a);b.decRefCnt();0===b.getRefCnt()&&((b=b.getGLMaterial())&&b.dispose(),this._id2glMaterialRef.delete(a))};a.prototype.materialChanged=function(a){for(var b=
0,c=k.ShaderOutputTypes;b<c.length;b++){var d=c[b];5!==d.output&&6!==d.output&&(d=this._id2glMaterialRef.get(k.getShaderOutputID(a.id,d.output)))&&d.getGLMaterial()&&(d=d.getGLMaterial(),d.updateParameters&&d.updateParameters())}if(this.onMaterialChanged)this.onMaterialChanged(a)};a.prototype.ownMaterial=function(a){l.isSome(a.materialRepository)&&a.materialRepository!==this&&c.error("Material is already owned by a different material repository");a.materialRepository=this};return a}()})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":function(){define(["require",
"exports","../../../../../core/arrayUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.getShaderOutputID=a.ShaderOutputTypes=void 0;a.ShaderOutputTypes=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"}];a.getShaderOutputID=function(l,k){return l+"_"+d.find(a.ShaderOutputTypes,function(a){return a.output===k}).name}})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/SpatialReference ../../support/projectionUtils ./Geometry ./GeometryData ./Layer ./localOrigin ./Object3D ./Util ../materials/RibbonLineMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){var r=0;n=function(){function a(){this.ROOT_ORIGIN_ID="rg_root_"+r++;this._origins=new Map;this._gridSize=42E5}a.prototype.getOrigin=function(b){var c=this._origins.get(this.ROOT_ORIGIN_ID);if(null==c){if(d.isSome(a.testOrigin)){var e=a.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,g.fromValues(e[0],e[1],e[2],this.ROOT_ORIGIN_ID));return this.getOrigin(b)}e=g.fromValues(b[0]+Math.random()-.5,b[1]+Math.random()-.5,b[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);
this._origins.set(this.ROOT_ORIGIN_ID,e);return e}k.vec3.subtract(q,b,c.vec3);q[0]=Math.abs(q[0]);q[1]=Math.abs(q[1]);q[2]=Math.abs(q[2]);e=this._gridSize;if(q[0]<e&&q[1]<e&&q[2]<e)return c;var c=Math.round(b[0]/e),f=Math.round(b[1]/e);b=Math.round(b[2]/e);var h="rg_"+c+"/"+f+"/"+b,m=this._origins.get(h);m||(m=g.fromValues(c*e,f*e,b*e,h),this._origins.set(h,m));return m};a.prototype._drawOriginBox=function(a){var d=window.view,e=d._stage;if(null==this._object){this._material=new u({width:2,color:[0,
1,0,1]},"GridLocalOriginMaterial");e.add(3,this._material);var g=new b("GridLocalOrigin",{isPickable:!1});e.add(0,g);this._object=new p({idHint:"GridLocalOrigin",castShadow:!1});e.add(1,this._object);g.addObject(this._object);e.addToViewContent([g.id])}for(var k=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],r=k.length,q=new Float32Array(3*r),g=new Uint32Array(2*(r-1)),v=.5*this._gridSize,w=0;w<r;w++)q[3*w+0]=a[0]+(k[w]&1?v:-v),q[3*w+1]=a[1]+(k[w]&2?v:-v),q[3*w+2]=a[2]+(k[w]&4?v:-v),0<w&&(g[2*w+0]=w-1,g[2*
w+1]=w);h.bufferToBuffer(q,c.WebMercator,0,q,d.spatialReference,0,r);d={};d[t.VertexAttrConstants.POSITION]={size:3,data:q};q={};q[t.VertexAttrConstants.POSITION]=g;g=new f.GeometryData(d,q,"line");g=new m(g,"GridLocalOriginBox");e.add(2,g);this._object.addGeometry(g,this._material,l.mat4f64.IDENTITY);console.log(this._origins.size,a)};return a}();var q=e.vec3f64.create();(n||(n={})).testOrigin=null;return n})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports tslib ../../../../core/arrayUtils ../../../../core/Evented ../../../../core/libs/gl-matrix-2/vec3f64 ./IdGen ./Octree".split(" "),
function(n,a,d,l,k,e,c,h){return function(a){function f(b,c,d){var g=a.call(this)||this;g._parentStages=new Map;g._objects=new Set;g.id=f._idGen.gen(b);g.apiLayerUid=d;g.name=b;c=c||{};g.group=c.group||"";g.isVisible=null!=c.isVisible?c.isVisible:!0;g.isPickable=null!=c.isPickable?c.isPickable:!0;g.isSliceable=!1;g.translation=c.translation?e.vec3f64.clone(c.translation):e.vec3f64.create();return g}d.__extends(f,a);f.prototype.addParentStage=function(a){if(!this._parentStages.has(a)){var b=this.on("dirty",
function(b){a.notifyDirty(b.origin,b.dirtyType,b.subObject)});this._parentStages.set(a,b)}};f.prototype.removeParentStage=function(a){var b=this._parentStages.get(a);b&&(b.remove(),this._parentStages.delete(a));this.invalidateSpatialQueryAccelerator()};f.prototype.getName=function(){return this.name};f.prototype.getGroup=function(){return this.group};f.prototype.getTranslation=function(){return this.translation};f.prototype.getObjectIds=function(){return l.keysOfSet(this._objects,function(a){return a.id})};
f.prototype.getObjects=function(){return l.keysOfSet(this._objects)};f.prototype.addObject=function(a){this._objects.add(a);a.parentLayer=this;this.notifyDirty("layerObjectAdded",a);this._octree&&this._octree.add(a)};f.prototype.hasObject=function(a){return this._objects.has(a)};f.prototype.removeObject=function(a){if(!this._objects.delete(a))return!1;a.parentLayer=null;this.notifyDirty("layerObjectRemoved",a);this._octree&&this._octree.remove(a);return!0};f.prototype.notifyObjectBBChanged=function(a,
c){this._octree&&this._octree.update(a,c)};f.prototype.getSpatialQueryAccelerator=function(){!this._octree&&50<this._objects.size&&this._createOctree();return this._octree};f.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)};f.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)};f.prototype.notifyDirty=function(a,c,d,e){this.emit("dirty",{origin:e||this,dirtyType:a,subObject:c})};f.prototype._createOctree=
function(){this._octree=new h({getRadius:function(a){return a.getBSRadius()},getCenter:function(a){return a.getCenter()}});this._octree.add(l.keysOfSet(this._objects))};f._idGen=new c.IdGen;return f}(k)})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("require exports ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./Util".split(" "),function(n,a,d,l,k,e,c,h){function m(a,
b,c){c=c||a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c}function f(a,b,d){return!c.frustum.intersectsSphere(d.planes,c.sphere.wrap(b,a))}function b(a,b,c){if(!I.length)for(var d=0;8>d;++d)I.push({index:0,distance:0});for(d=0;8>d;++d){var e=r[d];I.data[d].index=d;I.data[d].distance=p(a,b,e)}I.sort(function(a,b){return a.distance-b.distance});c.clear();for(d=0;8>d;++d)c.push(I.data[d].index)}function g(a,b){for(var c=Infinity,d=null,e=0;8>e;++e){var f=p(a,b,q[e]);f<c&&(c=f,d=q[e])}return d}function p(a,
b,c){return b*(a[0]*c[0]+a[1]*c[1]+a[2]*c[2])}function t(a){if(Array.isArray(a))return a;w[0]=a;return w}n=function(){function a(a,b){this._objectToBoundingSphere=a;this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._objectCount=0;b&&(void 0!==b.maximumObjectsPerNode&&(this._maximumObjectsPerNode=b.maximumObjectsPerNode),void 0!==b.maximumDepth&&(this._maximumDepth=b.maximumDepth));this._root=new u(null,e.vec3f64.fromValues(0,0,0),0)}Object.defineProperty(a.prototype,
"center",{get:function(){return this._root.center},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"root",{get:function(){return this._root.node},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"maximumDepth",
{get:function(){return this._maximumDepth},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!1,configurable:!0});a.prototype.destroy=function(){this._degenerateObjects.clear();this._root=null;u.clearPool();w[0]=null;C.prune();I.prune();K.prune()};a.prototype.add=function(a,b){a=t(a);b=null==b?a.length:b;this._objectCount+=b;this._grow(a,b);for(var c=u.acquire(),d=0;d<b;d++){var e=a[d];this._isDegenerate(e)?this._degenerateObjects.add(e):
(c.init(this._root),this._add(e,c))}u.release(c)};a.prototype.remove=function(a,b){a=t(a);this._objectCount-=a.length;for(var c=u.acquire(),d=0;d<a.length;d++){var e=a[d],f=b||this._boundingSphereFromObject(e,E);this._isValidRadius(f.radius)?(c.init(this._root),this._remove(e,f,c)):this._degenerateObjects.delete(e)}u.release(c);this._shrink()};a.prototype.update=function(a,b){if(this._isValidRadius(b.radius)||!this._isDegenerate(a))this.remove(a,b),this.add(a)};a.prototype.forEachAlongRay=function(a,
b,d){var e=this,f=c.ray.wrap(a,b);this._forEachNode(this._root,function(a){if(!e._intersectsNode(f,a))return!1;a=a.node;a.terminals.forEachSimple(function(a){e._intersectsObject(f,a)&&d(a)});null!==a.residents&&a.residents.forEachSimple(function(a){e._intersectsObject(f,a)&&d(a)});return!0})};a.prototype.forEachAlongRayWithVerticalOffset=function(a,b,d,e){var f=this,g=c.ray.wrap(a,b);this._forEachNode(this._root,function(a){if(!f._intersectsNodeWithOffset(g,a,e))return!1;a=a.node;a.terminals.forEachSimple(function(a){f._intersectsObjectWithOffset(g,
a,e)&&d(a)});null!==a.residents&&a.residents.forEachSimple(function(a){f._intersectsObjectWithOffset(g,a,e)&&d(a)});return!0})};a.prototype.forEach=function(a){this._forEachNode(this._root,function(b){b=b.node;b.terminals.forEachSimple(a);null!==b.residents&&b.residents.forEachSimple(a);return!0});this._degenerateObjects.forEach(a)};a.prototype.forEachDegenerateObject=function(a){this._degenerateObjects.forEach(a)};a.prototype.findClosest=function(a,b,c,d,e){return this._findClosest(a,"front-to-back"===
b?1:-1,c,d,e)};a.prototype.forEachInDepthRange=function(a,b,c,d,e,f,g,h){this._forEachInDepthRange(a,b,"front-to-back"===c?1:-1,d,e,f,g,h)};a.prototype.forEachNode=function(a){this._forEachNode(this._root,function(b){return a(b.node,b.center,2*b.halfSize)})};a.prototype._intersectsNode=function(a,b){m(b.center,2*-b.halfSize,B);m(b.center,2*b.halfSize,A);return h.rayBoxTest(a.origin,a.direction,B,A)};a.prototype._intersectsNodeWithOffset=function(a,b,c){m(b.center,2*-b.halfSize,B);m(b.center,2*b.halfSize,
A);c.applyToMinMax(B,A);return h.rayBoxTest(a.origin,a.direction,B,A)};a.prototype._intersectsObject=function(a,b){var d=this._objectToBoundingSphere.getRadius(b);return 0<d?c.sphere.intersectsRay(c.sphere.wrap(d,this._objectToBoundingSphere.getCenter(b)),a):!0};a.prototype._intersectsObjectWithOffset=function(a,b,d){var e=this._objectToBoundingSphere.getRadius(b);return 0<e?c.sphere.intersectsRay(d.applyToBoundingSphere(e,this._objectToBoundingSphere.getCenter(b)),a):!0};a.prototype._forEachNode=
function(a,b){a=u.acquire().init(a);for(var c=[a];0!==c.length;){a=c.pop();if(b(a)&&!a.isLeaf())for(var d=0;d<a.node.children.length;d++)a.node.children[d]&&c.push(u.acquire().init(a).advance(d));u.release(a)}};a.prototype._forEachNodeDepthOrdered=function(a,c,d,e){void 0===e&&(e=1);a=u.acquire().init(a);var f=[a];for(b(d,e,K);0!==f.length;){a=f.pop();if(c(a)&&!a.isLeaf())for(d=7;0<=d;--d)e=K.data[d],e>=a.node.children.length||a.node.children[e]&&f.push(u.acquire().init(a).advance(e));u.release(a)}};
a.prototype._findClosest=function(a,b,c,d,e){var h=this,m=Infinity,l=Infinity,r=null,t=g(a,b),q=0,u=function(e){++q;if(!d||d(e)){var g=h._objectToBoundingSphere.getCenter(e),k=h._objectToBoundingSphere.getRadius(e);if(!c||!f(g,k,c)){var g=p(a,b,g),t=g-k;t<m&&(m=t,l=g+k,r=e)}}};this._forEachNodeDepthOrdered(this._root,function(d){if(null!=e&&q>=e||c&&f(d.center,d.halfSize*v,c))return!1;k.vec3.scale(x,t,d.halfSize);k.vec3.add(x,x,d.center);if(p(a,b,x)>l)return!1;d=d.node;d.terminals.forEachSimple(function(a){u(a)});
null!==d.residents&&d.residents.forEachSimple(function(a){u(a)});return!0},a,b);return r};a.prototype._forEachInDepthRange=function(a,b,c,d,e,h,m,l){var r=this,t=-Infinity,q=Infinity,u={setRange:function(a){1===c?(t=Math.max(t,a.near),q=Math.min(q,a.far)):(t=Math.max(t,-a.far),q=Math.min(q,-a.near))}};u.setRange(d);var w=p(b,c,a),z=g(b,c),A=g(b,-1*c),B=0,C=function(a){++B;if(!m||m(a)){var d=r._objectToBoundingSphere.getCenter(a),g=r._objectToBoundingSphere.getRadius(a),k=p(b,c,d)-w;k-g>q||k+g<t||
h&&f(d,g,h)||e(a,u)}};this._forEachNodeDepthOrdered(this._root,function(a){if(null!=l&&B>=l||h&&f(a.center,a.halfSize*v,h))return!1;k.vec3.scale(x,z,a.halfSize);k.vec3.add(x,x,a.center);if(p(b,c,x)-w>q)return!1;k.vec3.scale(x,A,a.halfSize);k.vec3.add(x,x,a.center);if(p(b,c,x)-w<t)return!1;a=a.node;a.terminals.forEachSimple(function(a){C(a)});null!==a.residents&&a.residents.forEachSimple(function(a){C(a)});return!0},b,c)};a.prototype._remove=function(a,b,c){C.clear();b=c.advanceTo(b,function(a,b){C.push(a.node);
C.push(b)})?c.node.terminals:c.node.residents;b.removeUnordered(a);if(0===b.length)for(a=C.length-2;0<=a&&this._purge(C.data[a],C.data[a+1]);a-=2);};a.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;for(var b=0;b<a.children.length;b++)if(a.children[b])return!1;return!0};a.prototype._purge=function(a,b){0<=b&&(a.children[b]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=new l({shrink:!0})),!0):!1};a.prototype._add=
function(a,b){b.advanceTo(this._boundingSphereFromObject(a,E))?b.node.terminals.push(a):(b.node.residents.push(a),b.node.residents.length>this._maximumObjectsPerNode&&b.depth<this._maximumDepth&&this._split(b))};a.prototype._split=function(a){var b=a.node.residents;a.node.residents=null;for(var c=0;c<b.length;c++){var d=u.acquire().init(a);this._add(b.data[c],d);u.release(d)}};a.prototype._grow=function(a,b){var c=this;0!==b&&(a=this._boundingSphereFromObjects(a,b,function(a,b){return c._boundingSphereFromObject(a,
b)},G),this._isValidRadius(a.radius)&&!this._fitsInsideTree(a)&&(this._nodeIsEmpty(this._root.node)?(k.vec3.copy(this._root.center,a.center),this._root.halfSize=1.25*a.radius):(b=u.acquire(),this._rootBoundsForRootAsSubNode(a,b),this._placingRootViolatesMaxDepth(b)?this._rebuildTree(a,b):this._growRootAsSubNode(b),u.release(b))))};a.prototype._rebuildTree=function(a,b){var c=this;k.vec3.copy(F.center,b.center);F.radius=b.halfSize;a=this._boundingSphereFromObjects([a,F],2,function(a){return a},H);
b=u.acquire().init(this._root);this._root.initFrom(null,a.center,1.25*a.radius);this._forEachNode(b,function(a){c.add(a.node.terminals.data,a.node.terminals.length);null!==a.node.residents&&c.add(a.node.residents.data,a.node.residents.length);return!0});u.release(b)};a.prototype._placingRootViolatesMaxDepth=function(a){var b=0;this._forEachNode(this._root,function(a){b=Math.max(b,a.depth);return!0});return b+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};a.prototype._rootBoundsForRootAsSubNode=
function(a,b){var c=a.radius,d=a.center;a=-Infinity;for(var e=this._root.center,f=this._root.halfSize,g=0;3>g;g++){var h=Math.max(0,Math.ceil((e[g]-f-(d[g]-c))/(2*f))),m=Math.max(0,Math.ceil((d[g]+c-(e[g]+f))/(2*f)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(h+m)*Math.LOG2E)));J[g].min=h;J[g].max=m}for(g=0;3>g;g++)h=J[g].min,m=J[g].max,c=(a-(h+m))/2,h+=Math.ceil(c),m+=Math.floor(c),z[g]=e[g]-f-h*f*2+(m+h)*f;return b.initFrom(null,z,a*f,0)};a.prototype._growRootAsSubNode=function(a){var b=this._root.node;
k.vec3.copy(G.center,this._root.center);G.radius=this._root.halfSize;this._root.init(a);a.advanceTo(G,null,!0);a.node.children=b.children;a.node.residents=b.residents;a.node.terminals=b.terminals};a.prototype._shrink=function(){for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);this._root.depth=0}};a.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,b=this._root.node.children,c=0,d=0;d<b.length&&null==
a;)c=d++,a=b[c];for(;d<b.length;)if(b[d++])return-1;return c};a.prototype._isDegenerate=function(a){a=this._objectToBoundingSphere.getRadius(a);return!this._isValidRadius(a)};a.prototype._isValidRadius=function(a){return!isNaN(a)&&-Infinity!==a&&Infinity!==a&&0<a};a.prototype._fitsInsideTree=function(a){var b=this._root.center,c=this._root.halfSize,d=a.center;return a.radius<=c&&d[0]>=b[0]-c&&d[0]<=b[0]+c&&d[1]>=b[1]-c&&d[1]<=b[1]+c&&d[2]>=b[2]-c&&d[2]<=b[2]+c};a.prototype._boundingSphereFromObject=
function(a,b){k.vec3.copy(b.center,this._objectToBoundingSphere.getCenter(a));b.radius=this._objectToBoundingSphere.getRadius(a);return b};a.prototype._boundingSphereFromObjects=function(a,b,c,d){if(1===b){var e=c(a[0],G);k.vec3.copy(d.center,e.center);d.radius=e.radius}else{B[0]=Infinity;B[1]=Infinity;B[2]=Infinity;A[0]=-Infinity;A[1]=-Infinity;A[2]=-Infinity;for(var f=0;f<b;f++)if(e=c(a[f],G),this._isValidRadius(e.radius)){var g=B,h=e.center,m=e.radius;g[0]=Math.min(g[0],h[0]-m);g[1]=Math.min(g[1],
h[1]-m);g[2]=Math.min(g[2],h[2]-m);g=A;h=e.center;e=e.radius;g[0]=Math.max(g[0],h[0]+e);g[1]=Math.max(g[1],h[1]+e);g[2]=Math.max(g[2],h[2]+e)}k.vec3.lerp(d.center,B,A,.5);d.radius=Math.max(A[0]-B[0],A[1]-B[1],A[2]-B[2])/2}return d};return a}();var u=function(){function a(a,b,c){void 0===c&&(c=0);this.center=e.vec3f64.create();this.initFrom(a,b,c,0)}a.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};a.prototype.initFrom=function(b,c,d,e){void 0===b&&(b=null);void 0===
d&&(d=this.halfSize);void 0===e&&(e=this.depth);this.node=b||a.createEmptyNode();c&&k.vec3.copy(this.center,c);this.halfSize=d;this.depth=e;return this};a.prototype.advance=function(b){var c=this.node.children[b];c||(c=a.createEmptyNode(),this.node.children[b]=c);this.node=c;this.halfSize/=2;this.depth++;b=r[b];this.center[0]+=b[0]*this.halfSize;this.center[1]+=b[1]*this.halfSize;this.center[2]+=b[2]*this.halfSize;return this};a.prototype.advanceTo=function(a,b,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(a))return b&&
b(this,-1),!0;if(this.isLeaf()&&!c)return b&&b(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var d=this._childIndex(a);b&&b(this,d);this.advance(d)}};a.prototype.isLeaf=function(){return null!=this.node.residents};a.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/2};a.prototype._childIndex=function(a){a=a.center;for(var b=this.center,c=0,d=0;3>d;d++)b[d]<a[d]&&(c|=1<<d);return c};a.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new l({shrink:!0}),
residents:new l({shrink:!0})}};a.acquire=function(){return a._pool.acquire()};a.release=function(b){a._pool.release(b)};a.clearPool=function(){a._pool.prune()};a._pool=new d(a);return a}(),r=[e.vec3f64.fromValues(-1,-1,-1),e.vec3f64.fromValues(1,-1,-1),e.vec3f64.fromValues(-1,1,-1),e.vec3f64.fromValues(1,1,-1),e.vec3f64.fromValues(-1,-1,1),e.vec3f64.fromValues(1,-1,1),e.vec3f64.fromValues(-1,1,1),e.vec3f64.fromValues(1,1,1)],q=[e.vec3f64.fromValues(-1,-1,-1),e.vec3f64.fromValues(-1,-1,1),e.vec3f64.fromValues(-1,
1,-1),e.vec3f64.fromValues(-1,1,1),e.vec3f64.fromValues(1,-1,-1),e.vec3f64.fromValues(1,-1,1),e.vec3f64.fromValues(1,1,-1),e.vec3f64.fromValues(1,1,1)],v=Math.sqrt(3),w=[null],z=e.vec3f64.create(),x=e.vec3f64.create(),B=e.vec3f64.create(),A=e.vec3f64.create(),C=new l,E={center:e.vec3f64.create(),radius:0},G={center:e.vec3f64.create(),radius:0},F={center:e.vec3f64.create(),radius:0},H={center:e.vec3f64.create(),radius:0},J=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],I=new l,K=new l;return n})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.fromValues=a.fromVector=void 0;a.fromVector=function(a,k){return{vec3:d.vec3f64.clone(a),id:k}};a.fromValues=function(a,k,e,c){return{vec3:d.vec3f64.fromValues(a,k,e),id:c}}})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports tslib ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./VisualVariableMaterialParameters ./internal/MaterialUtil ./renderers/utils ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechnique".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x){function B(a,b,c,d,e){for(var f=0;f<e;f++)c[d++]=a[b++];return d}function A(a,b,c){c=c?c[x.RibbonVertexAttributeConstants.POSITION]:null;return a.isClosed?c?2<c.length:6<b[x.RibbonVertexAttributeConstants.POSITION].data.length:!1}var C=l.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");n=function(a){function c(b,c){c=a.call(this,c)||this;c._vertexAttributeLocations=x.ribbonVertexAttributeLocations;c.techniqueConfig=new x.RibbonLineTechniqueConfiguration;
c.params=v.copyParameters(b,G);c.validateParams();c.params.transparent=1>c.params.color[3]||c.params.transparent;c.layout=c.createLayout();return c}d.__extends(c,a);c.prototype.isClosed=function(a,b){return this.params.isClosed?b?2<b.length:6<a.length:!1};c.prototype.dispose=function(){};c.prototype.setParameterValues=function(a){for(var b in a)"cap"===b?C.error("cap cannot be changed after creation"):"join"===b&&"round"===this.params[b]!==("round"===a[b])?C.error("join cannot be changed after creation"):
"stipplePattern"===b&&!!this.params[b]!==!!a[b]?C.error("stippledness cannot be changed after creation"):this.params[b]=a[b];this.validateParams();this.parametersChanged()};c.prototype.getParameters=function(){return this.params};c.prototype.getPassParameters=function(){return this.params};c.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;a=e.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=a;this.techniqueConfig.stippleIntegerRepeatsEnabled=a&&this.params.stippleIntegerRepeats;
this.techniqueConfig.stippleOffColorEnabled=a&&e.isSome(this.params.stippleOffColor);this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.roundJoins="round"===this.params.join;this.techniqueConfig.roundCaps="round"===this.params.cap;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;
this.techniqueConfig.vvColor=this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.innerColorEnabled=0<this.params.innerWidth&&e.isSome(this.params.innerColor);this.techniqueConfig.falloffEnabled=0<this.params.falloff;this.techniqueConfig.occluder=8===this.renderOccluded;return this.techniqueConfig};c.prototype.intersect=function(a,b,c,d,e,f,g,h,m){m?this.intersectDrapedLineGeometry(a,d,f,g):
this.intersectLineGeometry(a,b,c,d,this.params.width,g)};c.prototype.intersectDrapedLineGeometry=function(a,b,c,d){if(b.options.selectionMode){b=a.getAttribute(x.RibbonVertexAttributeConstants.POSITION).data;var e=a.getAttribute(x.RibbonVertexAttributeConstants.SIZE),f=this.params.width;this.params.vvSizeEnabled?(e=a.getAttribute(x.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE).data[0],f*=k.clamp(this.params.vvSizeOffset[0]+e*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])):
e&&(f*=e.data[0]);e=c[0];c=c[1];a=(f/2+4)*a.screenToWorldRatio;for(var f=Number.MAX_VALUE,g=0;g<b.length-5;g+=3){var h=b[g],m=b[g+1],p=e-h,l=c-m,h=b[g+3]-h,m=b[g+4]-m,r=k.clamp((h*p+m*l)/(h*h+m*m),0,1),p=h*r-p,l=m*r-l,l=p*p+l*l;l<f&&(f=l)}f<a*a&&d()}};c.prototype.intersectLineGeometry=function(a,c,d,e,f,g){if(e.options.selectionMode&&!w.isInstanceHidden(c))if(r.isTranslationMatrix(d)){var p=a.data,l=p.getVertexAttr();a=l[x.RibbonVertexAttributeConstants.POSITION].data;this.params.vvSizeEnabled?f*=
k.clamp(this.params.vvSizeOffset[0]+l[x.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0]):l[x.RibbonVertexAttributeConstants.SIZE]&&(f*=l[x.RibbonVertexAttributeConstants.SIZE].data[0]);var t=e.camera,q=Q;h.vec2.copy(q,e.point);f=f*t.pixelRatio/2+4*t.pixelRatio;m.vec3.set(Y[0],q[0]-f,q[1]+f,0);m.vec3.set(Y[1],q[0]+f,q[1]+f,0);m.vec3.set(Y[2],q[0]+f,q[1]-f,0);m.vec3.set(Y[3],q[0]-f,q[1]-f,0);for(var v=
0;4>v;v++)t.unprojectPoint(Y[v],X[v]);b.plane.fromPoints(t.eye,X[0],X[1],ca);b.plane.fromPoints(t.eye,X[1],X[2],ba);b.plane.fromPoints(t.eye,X[2],X[3],ga);b.plane.fromPoints(t.eye,X[3],X[0],ia);c=Number.MAX_VALUE;p=A(this.params,l,p.indices)?a.length-2:a.length-5;for(v=0;v<p;v+=3)if(I[0]=a[v]+d[12],I[1]=a[v+1]+d[13],I[2]=a[v+2]+d[14],l=(v+3)%a.length,K[0]=a[l]+d[12],K[1]=a[l+1]+d[13],K[2]=a[l+2]+d[14],!(0>b.plane.signedDistance(ca,I)&&0>b.plane.signedDistance(ca,K)||0>b.plane.signedDistance(ba,I)&&
0>b.plane.signedDistance(ba,K)||0>b.plane.signedDistance(ga,I)&&0>b.plane.signedDistance(ga,K)||0>b.plane.signedDistance(ia,I)&&0>b.plane.signedDistance(ia,K))){t.projectPoint(I,R);t.projectPoint(K,O);if(0>R[2]&&0<O[2]){m.vec3.subtract(L,I,K);var l=t.frustum,u=-b.plane.signedDistance(l.planes[4],I),l=u/m.vec3.dot(L,b.plane.normal(l.planes[4]));m.vec3.scale(L,L,l);m.vec3.add(I,I,L);t.projectPoint(I,R)}else if(0<R[2]&&0>O[2])m.vec3.subtract(L,K,I),l=t.frustum,u=-b.plane.signedDistance(l.planes[4],K),
l=u/m.vec3.dot(L,b.plane.normal(l.planes[4])),m.vec3.scale(L,L,l),m.vec3.add(K,K,L),t.projectPoint(K,O);else if(0>R[2]&&0>O[2])continue;R[2]=0;O[2]=0;l=b.lineSegment.distance2(b.lineSegment.fromPoints(R,O,P),q);l<c&&(c=l,m.vec3.copy(N,I),m.vec3.copy(S,K))}d=e.rayBeginPoint;e=e.rayEndPoint;c<f*f&&(a=Number.MAX_VALUE,b.lineSegment.closestLineSegmentPoint(b.lineSegment.fromPoints(N,S,P),b.lineSegment.fromPoints(d,e,U),M)&&(m.vec3.subtract(M,M,d),a=m.vec3.length(M),m.vec3.scale(M,M,1/a),a/=m.vec3.distance(d,
e)),g(a,M))}else C.error("intersection assumes a translation-only matrix")};c.prototype.computeAttachmentOrigin=function(a,b){var c=a.data;a="getVertexAttr"in c?c.getVertexAttr():"vertexAttr"in c?c.vertexAttr:null;if(!a)return null;var d=x.RibbonVertexAttributeConstants.POSITION,c="getVertexAttr"in c?c.indices:null;return p.computeAttachmentOriginLines(a[d],c?c[d]:null,c&&A(this.params,a,c),b)};c.prototype.createLayout=function(){var a=g.newLayout().vec3f(x.RibbonVertexAttributeConstants.POSITION).f32(x.RibbonVertexAttributeConstants.SUBDIVISIONFACTOR).vec2f(x.RibbonVertexAttributeConstants.UV0).vec3f(x.RibbonVertexAttributeConstants.AUXPOS1).vec3f(x.RibbonVertexAttributeConstants.AUXPOS2);
this.params.vvSizeEnabled?a.f32(x.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE):a.f32(x.RibbonVertexAttributeConstants.SIZE);this.params.vvColorEnabled?a.f32(x.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE):a.vec4f(x.RibbonVertexAttributeConstants.COLOR);this.params.vvOpacityEnabled&&a.f32(x.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE);return a};c.prototype.createBufferWriter=function(){return new F(this.layout,this.params)};c.prototype.getGLMaterial=function(a){return 0===
a.output||4===a.output?new E(a):void 0};c.prototype.validateParams=function(){"miter"!==this.params.join&&(this.params.miterLimit=0)};return c}(u.Material);var E=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}d.__extends(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(z.RibbonLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=function(a){return this.technique.configuration.occluder?
3===a||10===a||11===a:0===this.output?(this.targetSlot=this.technique.configuration.writeDepth?5:8,a===this.targetSlot):3===a};b.prototype._updateOccludeeState=function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype.ensureParameters=function(a){0===this.output&&this._updateOccludeeState(a)};b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPass(a,
this.material.getPassParameters(),b)};b.prototype.getPipelineState=function(a,b){return b?this.technique.occludeePipeline:this.technique.configuration.occluder?11===a?this.technique.occluderPipelineTransparent:10===a?this.technique.occluderPipelineOpaque:this.technique.occluderPipelineMaskWrite:this.technique.pipeline};return b}(t.GLMaterial),G=d.__assign({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,
slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1},q.Default),F=function(){function a(a,b){this.params=b;this.numJoinSubdivisions=0;this.vertexBufferLayout=a;switch(this.params.join){case "miter":case "bevel":this.numJoinSubdivisions=b.stipplePattern?1:0;break;case "round":this.numJoinSubdivisions=J}}a.prototype.isClosed=function(a){return A(this.params,a.vertexAttr,a.indices)};a.prototype.numCapSubdivisions=function(a){if(this.isClosed(a))return 0;
switch(this.params.cap){case "butt":return 0;case "square":return 1;case "round":return H}};a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){var b=2*this.numCapSubdivisions(a)+2,c=a.indices[x.RibbonVertexAttributeConstants.POSITION].length/2+1,d=this.isClosed(a),b=d?2:2*b,e=d?0:1,c=d?c:c-1;if(a.vertexAttr[x.RibbonVertexAttributeConstants.SUBDIVISIONS])for(a=a.vertexAttr[x.RibbonVertexAttributeConstants.SUBDIVISIONS].data;e<c;++e)b+=
4+2*a[e];else b+=(c-e)*(2*this.numJoinSubdivisions+4);return b+2};a.prototype.write=function(a,b,c,d){var e=this,f=Z,g=V,h=T,k=b.vertexAttr[x.RibbonVertexAttributeConstants.POSITION].data,p=b.indices&&b.indices[x.RibbonVertexAttributeConstants.POSITION],l=this.numCapSubdivisions(b);p&&p.length!==2*(k.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");p=null;b.vertexAttr[x.RibbonVertexAttributeConstants.SUBDIVISIONS]&&(p=b.vertexAttr[x.RibbonVertexAttributeConstants.SUBDIVISIONS].data);
var r=1,t=0;this.params.vvSizeEnabled?t=b.vertexAttr[x.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]:b.vertexAttr[x.RibbonVertexAttributeConstants.SIZE]&&(r=b.vertexAttr[x.RibbonVertexAttributeConstants.SIZE].data[0]);var q=[1,1,1,1],v=0;this.params.vvColorEnabled?v=b.vertexAttr[x.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE].data[0]:b.vertexAttr[x.RibbonVertexAttributeConstants.COLOR]&&(q=b.vertexAttr[x.RibbonVertexAttributeConstants.COLOR].data);var u=0;this.params.vvOpacityEnabled&&
(u=b.vertexAttr[x.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE].data[0]);var w=k.length/3;a=a.transformation;var z=new Float32Array(c.buffer);c=this.vertexBufferLayout.stride/4;var A=d*c;d=A;var C=function(a,b,c,d,f,g){z[A++]=b[0];z[A++]=b[1];z[A++]=b[2];z[A++]=d;z[A++]=f;z[A++]=g;z[A++]=a[0];z[A++]=a[1];z[A++]=a[2];z[A++]=c[0];z[A++]=c[1];z[A++]=c[2];e.params.vvSizeEnabled?z[A++]=t:z[A++]=r;e.params.vvColorEnabled?z[A++]=v:(z[A++]=q[0],z[A++]=q[1],z[A++]=q[2],z[A++]=q[3]);e.params.vvOpacityEnabled&&
(z[A++]=u)},A=A+c;m.vec3.set(g,k[0],k[1],k[2]);a&&m.vec3.transformMat4(g,g,a);if(b=this.isClosed(b)){var E=k.length-3;m.vec3.set(f,k[E],k[E+1],k[E+2]);a&&m.vec3.transformMat4(f,f,a)}else{m.vec3.copy(f,g);m.vec3.set(h,k[3],k[4],k[5]);a&&m.vec3.transformMat4(h,h,a);for(E=0;E<l;++E){var G=1-E/l;C(f,g,h,G,1,-4);C(f,g,h,G,1,4)}C(f,g,h,0,0,-4);C(f,g,h,0,0,4);m.vec3.copy(f,g);m.vec3.copy(g,h)}for(var n=b?w:w-1,E=b?0:1;E<n;E++){G=(E+1)%w*3;m.vec3.set(h,k[G+0],k[G+1],k[G+2]);a&&m.vec3.transformMat4(h,h,a);
C(f,g,h,0,1,-1);C(f,g,h,0,1,1);for(var F=p?p[E]:this.numJoinSubdivisions,I=0;I<F;++I)G=(I+1)/(F+1),C(f,g,h,G,1,-2),C(f,g,h,G,1,2);C(f,g,h,1,0,-2);C(f,g,h,1,0,2);m.vec3.copy(f,g);m.vec3.copy(g,h)}if(b)A=B(z,d+c,z,A,2*c);else for(C(f,g,h,0,1,-5),C(f,g,h,0,1,5),E=0;E<l;++E)G=(E+1)/l,C(f,g,h,G,1,-5),C(f,g,h,G,1,5);B(z,d+c,z,d,c);A=B(z,A-c,z,A,c)};return a}(),H=3,J=1,I=f.vec3f64.create(),K=f.vec3f64.create(),L=f.vec3f64.create(),M=f.vec3f64.create(),Q=f.vec3f64.create(),R=c.createRenderScreenPointArray3(),
O=c.createRenderScreenPointArray3(),N=f.vec3f64.create(),S=f.vec3f64.create(),P=b.lineSegment.create(),U=b.lineSegment.create(),Z=f.vec3f64.create(),V=f.vec3f64.create(),T=f.vec3f64.create(),Y=[c.createRenderScreenPointArray3(),c.createRenderScreenPointArray3(),c.createRenderScreenPointArray3(),c.createRenderScreenPointArray3()],X=[f.vec3f64.create(),f.vec3f64.create(),f.vec3f64.create(),f.vec3f64.create()],ca=b.plane.create(),ba=b.plane.create(),ga=b.plane.create(),ia=b.plane.create();return n})},
"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat3f64","../../../../core/libs/gl-matrix-2/vec3f32"],function(n,a,d,l){var k;(k||(k={})).Default={vvSizeEnabled:!1,vvSizeMinSize:l.vec3f32.fromValues(1,1,1),vvSizeMaxSize:l.vec3f32.fromValues(100,100,100),vvSizeOffset:l.vec3f32.fromValues(0,0,0),vvSizeFactor:l.vec3f32.fromValues(1,1,1),vvSizeValue:l.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,
0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:d.mat3f64.create()};return k})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports tslib ../../../../core/maybe ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/StencilUtils ./RibbonLine.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){Object.defineProperty(a,"__esModule",{value:!0});a.RibbonLineTechniqueConfiguration=a.RibbonLineTechnique=a.ribbonVertexAttributeLocations=a.RibbonVertexAttributeConstants=void 0;a.RibbonVertexAttributeConstants={POSITION:"position",SUBDIVISIONFACTOR:"subdivisionFactor",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",SUBDIVISIONS:"subdivisions",COLOR:"color",COLORFEATUREATTRIBUTE:"colorFeatureAttribute",SIZE:"size",SIZEFEATUREATTRIBUTE:"sizeFeatureAttribute",
OPACITYFEATUREATTRIBUTE:"opacityFeatureAttribute"};a.ribbonVertexAttributeLocations={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7};b=function(b){function g(a,c){c=b.call(this,a,c)||this;c.stipplePattern=null;c.stippleTextureBind=null;c.stippleTextureRepository=a.stippleTextureRepository;return c}d.__extends(g,b);g.prototype.initializeProgram=function(b){var c=g.shader.get(),d=this.configuration,c=c.build({output:d.output,
slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:d.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,stippleEnabled:d.stippleEnabled,stippleOffColorEnabled:d.stippleOffColorEnabled,stippleUVMaxEnabled:d.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:d.stippleIntegerRepeatsEnabled,roundCaps:d.roundCaps,roundJoins:d.roundJoins,vvColor:d.vvColor,vvSize:d.vvSize,vvInstancingEnabled:!0,vvOpacity:d.vvOpacity,falloffEnabled:d.falloffEnabled,innerColorEnabled:d.innerColorEnabled});
return new u(b.rctx,c.generateSource("vertex"),c.generateSource("fragment"),a.ribbonVertexAttributeLocations)};g.prototype.dispose=function(){b.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};g.prototype.bindPass=function(a,b,d){m.View.bindProjectionMatrix(this.program,d.camera.projectionMatrix);4===this.configuration.output&&c.OutputHighlight.bindOutputHighlight(a,this.program,d);this.program.setUniform1f("intrinsicWidth",
b.width);this.program.setUniform4fv("intrinsicColor",b.color);this.program.setUniform1f("miterLimit","miter"!==b.join?0:b.miterLimit);this.program.setUniform1f("nearPlane",d.camera.nearFar[0]);this.program.setUniform1f("pixelRatio",d.camera.pixelRatio);this.program.setUniform2f("screenSize",d.camera.fullViewport[2],d.camera.fullViewport[3]);h.VisualVariables.bindUniformsWithOpacity(this.program,b);if(this.stipplePattern!==b.stipplePattern){var e=b.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,
e);this.stipplePattern=e}this.configuration.stippleEnabled&&(a=k.isSome(this.stippleTextureBind)?this.stippleTextureBind(a,0)*d.camera.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/a),this.configuration.stippleOffColorEnabled&&(a=l.unwrap(b.stippleOffColor),this.program.setUniform4f("stippleOffColor",a[0],a[1],a[2],3<a.length?a[3]:1)));this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",b.falloff);this.configuration.innerColorEnabled&&
(this.program.setUniform4fv("innerColor",l.unwrapOr(b.innerColor,b.color)),this.program.setUniform1f("innerWidth",b.innerWidth*d.camera.pixelRatio))};g.prototype.bindDraw=function(a){m.View.bindView(this.program,a);e.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};g.prototype.initializePipeline=function(){var a=this.configuration,b=r.separateBlendingParams(770,1,771,771),c=a.polygonOffset&&q;a.occluder&&(this._occluderPipelineTransparent=r.makePipelineState({blending:b,polygonOffset:c,
depthTest:p.depthCompareAlways,depthWrite:null,colorWrite:r.defaultColorWriteParams,stencilWrite:null,stencilTest:p.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=r.makePipelineState({polygonOffset:c,depthTest:p.depthCompareAlways,depthWrite:null,colorWrite:r.defaultColorWriteParams,stencilWrite:p.stencilWriteMaskOff,stencilTest:p.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=r.makePipelineState({polygonOffset:c,depthTest:p.depthCompareLess,depthWrite:null,colorWrite:null,
stencilWrite:p.stencilWriteMaskOn,stencilTest:p.stencilToolMaskBaseParams}));if(0===a.output){var d=function(d){return r.makePipelineState({blending:b,polygonOffset:c,depthTest:p.depthCompareLess,depthWrite:!a.transparent&&a.writeDepth&&r.defaultDepthWriteParams,colorWrite:r.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?p.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?d?p.stencilToolMaskBaseParams:p.stencilBaseAllZerosParams:null})};this._occludeePipeline=d(!0);return d(!1)}return r.makePipelineState({polygonOffset:c,
depthTest:p.depthCompareLess,depthWrite:!a.transparent&&a.writeDepth&&r.defaultDepthWriteParams,colorWrite:r.defaultColorWriteParams})};Object.defineProperty(g.prototype,"occluderPipelineTransparent",{get:function(){return this._occluderPipelineTransparent},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"occluderPipelineOpaque",{get:function(){return this._occluderPipelineOpaque},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"occludeePipeline",{get:function(){return this._occludeePipeline},
enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"occluderPipelineMaskWrite",{get:function(){return this._occluderPipelineMaskWrite},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"primitiveType",{get:function(){return 5},enumerable:!1,configurable:!0});g.shader=new f.ReloadableShaderModule(t,function(){return new Promise(function(a,b){n(["./RibbonLine.glsl"],a,b)})});return g}(b.ShaderTechnique);a.RibbonLineTechnique=b;var q={factor:0,units:-4};b=function(a){function b(){var b=
null!==a&&a.apply(this,arguments)||this;b.output=0;b.occluder=!1;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.vertexColors=!1;b.transparent=!1;b.polygonOffset=!1;b.writeDepth=!1;b.stippleEnabled=!1;b.stippleOffColorEnabled=!1;b.stippleIntegerRepeatsEnabled=!1;b.roundCaps=!1;b.roundJoins=!1;b.vvSize=!1;b.vvColor=!1;b.vvOpacity=!1;b.falloffEnabled=!1;b.innerColorEnabled=!1;b.sceneHasOcludees=!1;return b}d.__extends(b,a);d.__decorate([g.parameter({count:7})],b.prototype,"output",void 0);d.__decorate([g.parameter()],
b.prototype,"occluder",void 0);d.__decorate([g.parameter()],b.prototype,"slicePlaneEnabled",void 0);d.__decorate([g.parameter()],b.prototype,"sliceHighlightDisabled",void 0);d.__decorate([g.parameter()],b.prototype,"vertexColors",void 0);d.__decorate([g.parameter()],b.prototype,"transparent",void 0);d.__decorate([g.parameter()],b.prototype,"polygonOffset",void 0);d.__decorate([g.parameter()],b.prototype,"writeDepth",void 0);d.__decorate([g.parameter()],b.prototype,"stippleEnabled",void 0);d.__decorate([g.parameter()],
b.prototype,"stippleOffColorEnabled",void 0);d.__decorate([g.parameter()],b.prototype,"stippleIntegerRepeatsEnabled",void 0);d.__decorate([g.parameter()],b.prototype,"roundCaps",void 0);d.__decorate([g.parameter()],b.prototype,"roundJoins",void 0);d.__decorate([g.parameter()],b.prototype,"vvSize",void 0);d.__decorate([g.parameter()],b.prototype,"vvColor",void 0);d.__decorate([g.parameter()],b.prototype,"vvOpacity",void 0);d.__decorate([g.parameter()],b.prototype,"falloffEnabled",void 0);d.__decorate([g.parameter()],
b.prototype,"innerColorEnabled",void 0);d.__decorate([g.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(g.ShaderTechniqueConfiguration);a.RibbonLineTechniqueConfiguration=b})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.stencilToolTransparentOccluderParams=a.stencilToolMaskOccluderParams=a.stencilToolMaskBaseParams=a.stencilBaseAllZerosParams=a.replaceBitWhenDepthTestPasses=a.renderWhenBitIsNotSet=
a.stencilWriteMaskOff=a.stencilWriteMaskOn=a.depthCompareAlways=a.depthCompareLess=void 0;a.depthCompareLess={func:513};a.depthCompareAlways={func:519};a.stencilWriteMaskOn={mask:255};a.stencilWriteMaskOff={mask:0};a.renderWhenBitIsNotSet=function(a){return{function:{func:517,ref:a,mask:a},operation:{fail:7680,zFail:7680,zPass:7680}}};a.replaceBitWhenDepthTestPasses=function(a){return{function:{func:519,ref:a,mask:a},operation:{fail:7680,zFail:7680,zPass:7681}}};a.stencilBaseAllZerosParams={function:{func:519,
ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}};a.stencilToolMaskBaseParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}};a.stencilToolMaskOccluderParams={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};a.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}})},"esri/views/3d/webgl-engine/shaders/RibbonLine.glsl":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../core/shaderLibrary/shading/LineStipple.glsl ../core/shaderLibrary/shading/PiUtils.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var n=new f.ShaderBuilder;n.extensions.add("GL_OES_standard_derivatives");n.include(c.PiUtils);n.include(k.RibbonVertexPosition,a);n.include(e.LineStipple,a);n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearPlane","float").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2");n.attributes.add("position","vec3");n.attributes.add("subdivisionFactor",
"float");n.attributes.add("uv0","vec2");n.attributes.add("auxpos1","vec3");n.attributes.add("auxpos2","vec3");n.varyings.add("vColor","vec4");n.varyings.add("vpos","vec3");var P=a.falloffEnabled,U=a.innerColorEnabled;U&&n.varyings.add("vLineDistance","float");P&&n.varyings.add("vLineDistanceNorm","float");a.falloffEnabled&&n.fragment.uniforms.add("falloff","float");a.innerColorEnabled&&(n.fragment.uniforms.add("innerColor","vec4"),n.fragment.uniforms.add("innerWidth","float"));n.vertex.code.add(m.glsl(b||
(b=d.__makeTemplateObject(["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s \x3d sin(a);\n\t\t\tfloat c \x3d cos(a);\n\t\t\tmat2 m \x3d mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"],["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s \x3d sin(a);\n\t\t\tfloat c \x3d cos(a);\n\t\t\tmat2 m \x3d mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"]))));
n.vertex.code.add(m.glsl(g||(g=d.__makeTemplateObject(["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc \x3d proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *\x3d screenSize / posNdc.w;\n      return posNdc;\n    }\n"],["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc \x3d proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *\x3d screenSize / posNdc.w;\n      return posNdc;\n    }\n"]))));
n.vertex.code.add(m.glsl(p||(p=d.__makeTemplateObject(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp \x3d nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z \x3e -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z \x3c -nearPlane) {\n            pos \x3d mix(prev, pos, interp(vnp, prev, pos));\n            next \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z \x3c -nearPlane) {\n            pos \x3d mix(pos, next, interp(vnp, pos, next));\n            prev \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z \x3e -nearPlane) {\n          prev \x3d mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z \x3e -nearPlane) {\n          next \x3d mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos \x3d projectAndScale(pos);\n      next \x3d projectAndScale(next);\n      prev \x3d projectAndScale(prev);\n    }\n"],
["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp \x3d nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z \x3e -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z \x3c -nearPlane) {\n            pos \x3d mix(prev, pos, interp(vnp, prev, pos));\n            next \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z \x3c -nearPlane) {\n            pos \x3d mix(pos, next, interp(vnp, pos, next));\n            prev \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z \x3e -nearPlane) {\n          prev \x3d mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z \x3e -nearPlane) {\n          next \x3d mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos \x3d projectAndScale(pos);\n      next \x3d projectAndScale(next);\n      prev \x3d projectAndScale(prev);\n    }\n"]))));
n.vertex.code.add(m.glsl(t||(t=d.__makeTemplateObject(["\n  void main(void) {\n    float coverage \x3d 1.0;\n    vpos \x3d position;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y \x3d\x3d 0.0) {\n      // Project out of clip space\n      gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex \x3d abs(abs(uv0.y)-3.0) \x3d\x3d 1.0;\n      bool isJoin \x3d abs(uv0.y)-3.0 \x3c 0.0;\n\n      float lineWidth \x3d getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth \x3c 1.0) {\n        coverage \x3d lineWidth;\n        lineWidth \x3d 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render \x3c 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth \x3d floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  \x3d view * vec4(position.xyz, 1.0);\n      vec4 prev \x3d view * vec4(auxpos1.xyz, 1.0);\n      vec4 next \x3d view * vec4(auxpos2.xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left \x3d (pos.xy - prev.xy);\n      vec2 right \x3d (next.xy - pos.xy);\n\n      float leftLen \x3d length(left);\n      float rightLen \x3d length(right);\n  "],
["\n  void main(void) {\n    float coverage \x3d 1.0;\n    vpos \x3d position;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y \x3d\x3d 0.0) {\n      // Project out of clip space\n      gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex \x3d abs(abs(uv0.y)-3.0) \x3d\x3d 1.0;\n      bool isJoin \x3d abs(uv0.y)-3.0 \x3c 0.0;\n\n      float lineWidth \x3d getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth \x3c 1.0) {\n        coverage \x3d lineWidth;\n        lineWidth \x3d 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render \x3c 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth \x3d floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  \x3d view * vec4(position.xyz, 1.0);\n      vec4 prev \x3d view * vec4(auxpos1.xyz, 1.0);\n      vec4 next \x3d view * vec4(auxpos2.xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left \x3d (pos.xy - prev.xy);\n      vec2 right \x3d (next.xy - pos.xy);\n\n      float leftLen \x3d length(left);\n      float rightLen \x3d length(right);\n  "]))));
a.stippleEnabled&&n.vertex.code.add(m.glsl(u||(u=d.__makeTemplateObject(["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos-\x3enext, otherwise use prev-\x3epos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo \x3d mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin \x3d stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection \x3d stippleSegmentInfo.zw;\n    "],
["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos-\x3enext, otherwise use prev-\x3epos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo \x3d mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin \x3d stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection \x3d stippleSegmentInfo.zw;\n    "]))));
n.vertex.code.add(m.glsl(r||(r=d.__makeTemplateObject(['\n    left \x3d (leftLen \x3e 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right \x3d (rightLen \x3e 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir \x3d vec2(0, 0);\n    vec2 joinDisplacementDir \x3d vec2(0, 0);\n    float displacementLen \x3d lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside \x3d ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir \x3d normalize(left + right);\n      joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\n        float nDotSeg \x3d dot(joinDisplacementDir, left);\n        displacementLen /\x3d length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside \x26\x26 (displacementLen \x3e miterLimit * lineWidth)) {\n    '],
['\n    left \x3d (leftLen \x3e 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right \x3d (rightLen \x3e 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir \x3d vec2(0, 0);\n    vec2 joinDisplacementDir \x3d vec2(0, 0);\n    float displacementLen \x3d lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside \x3d ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir \x3d normalize(left + right);\n      joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\n        float nDotSeg \x3d dot(joinDisplacementDir, left);\n        displacementLen /\x3d length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside \x26\x26 (displacementLen \x3e miterLimit * lineWidth)) {\n    ']))));
a.roundJoins?n.vertex.code.add(m.glsl(q||(q=d.__makeTemplateObject(["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen \x3c 0.001) {\n          startDir \x3d right;\n        }\n        else{\n          startDir \x3d left;\n        }\n        startDir \x3d normalize(startDir);\n        startDir \x3d PERPENDICULAR(startDir);\n\n        if (rightLen \x3c 0.001) {\n          endDir \x3d left;\n        }\n        else{\n          endDir \x3d right;\n        }\n        endDir \x3d normalize(endDir);\n        endDir \x3d PERPENDICULAR(endDir);\n\n        float rotationAngle \x3d acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir \x3d rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "],
["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen \x3c 0.001) {\n          startDir \x3d right;\n        }\n        else{\n          startDir \x3d left;\n        }\n        startDir \x3d normalize(startDir);\n        startDir \x3d PERPENDICULAR(startDir);\n\n        if (rightLen \x3c 0.001) {\n          endDir \x3d left;\n        }\n        else{\n          endDir \x3d right;\n        }\n        endDir \x3d normalize(endDir);\n        endDir \x3d PERPENDICULAR(endDir);\n\n        float rotationAngle \x3d acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir \x3d rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "])))):
n.vertex.code.add(m.glsl(v||(v=d.__makeTemplateObject(["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen \x3c 0.001) {\n          joinDisplacementDir \x3d right;\n        }\n        else if (rightLen \x3c 0.001) {\n          joinDisplacementDir \x3d left;\n        }\n        else {\n          joinDisplacementDir \x3d isStartVertex ? right : left;\n        }\n        joinDisplacementDir \x3d normalize(joinDisplacementDir);\n        joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n  "],
["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen \x3c 0.001) {\n          joinDisplacementDir \x3d right;\n        }\n        else if (rightLen \x3c 0.001) {\n          joinDisplacementDir \x3d left;\n        }\n        else {\n          joinDisplacementDir \x3d isStartVertex ? right : left;\n        }\n        joinDisplacementDir \x3d normalize(joinDisplacementDir);\n        joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n  "]))));n.vertex.code.add(m.glsl(w||
(w=d.__makeTemplateObject(["\n        displacementLen \x3d lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen \x3c 0.001) {\n      joinDisplacementDir \x3d right;\n    }\n    else if (rightLen \x3c 0.001) {\n      joinDisplacementDir \x3d left;\n    }\n    else {\n      joinDisplacementDir \x3d isStartVertex ? right : left;\n    }\n    joinDisplacementDir \x3d normalize(joinDisplacementDir);\n    joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n    displacementLen \x3d lineWidth;\n\n    capDisplacementDir \x3d isStartVertex ? -right : left;\n  "],
["\n        displacementLen \x3d lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen \x3c 0.001) {\n      joinDisplacementDir \x3d right;\n    }\n    else if (rightLen \x3c 0.001) {\n      joinDisplacementDir \x3d left;\n    }\n    else {\n      joinDisplacementDir \x3d isStartVertex ? right : left;\n    }\n    joinDisplacementDir \x3d normalize(joinDisplacementDir);\n    joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n    displacementLen \x3d lineWidth;\n\n    capDisplacementDir \x3d isStartVertex ? -right : left;\n  "]))));
a.roundCaps?n.vertex.code.add(m.glsl(z||(z=d.__makeTemplateObject(["\n    float angle \x3d subdivisionFactor*PI*0.5;\n    joinDisplacementDir *\x3d cos(angle);\n    capDisplacementDir *\x3d sin(angle);\n    "],["\n    float angle \x3d subdivisionFactor*PI*0.5;\n    joinDisplacementDir *\x3d cos(angle);\n    capDisplacementDir *\x3d sin(angle);\n    "])))):n.vertex.code.add(m.glsl(x||(x=d.__makeTemplateObject(["\n    capDisplacementDir *\x3d subdivisionFactor;\n    "],["\n    capDisplacementDir *\x3d subdivisionFactor;\n    "]))));
n.vertex.code.add(m.glsl(E||(E=d.__makeTemplateObject(["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos \x3d joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy +\x3d dpos;\n  "],["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos \x3d joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy +\x3d dpos;\n  "])),
P||U?m.glsl(B||(B=d.__makeTemplateObject(["float lineDist \x3d lineWidth * sign(uv0.y) * pos.w;"],["float lineDist \x3d lineWidth * sign(uv0.y) * pos.w;"]))):"",U?m.glsl(A||(A=d.__makeTemplateObject(["vLineDistance \x3d lineDist;"],["vLineDistance \x3d lineDist;"]))):"",P?m.glsl(C||(C=d.__makeTemplateObject(["vLineDistanceNorm \x3d lineDist / lineWidth;"],["vLineDistanceNorm \x3d lineDist / lineWidth;"]))):""));a.stippleEnabled&&(n.vertex.code.add(m.glsl(G||(G=d.__makeTemplateObject(["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec \x3d pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength \x3d length(stippleSegmentDirection);\n    "],
["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec \x3d pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength \x3d length(stippleSegmentDirection);\n    "])))),
a.stippleIntegerRepeatsEnabled&&n.vertex.code.add(m.glsl(F||(F=d.__makeTemplateObject(["\n      float numberOfPatternRepeats \x3d stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats \x3d max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax \x3d roundedNumberOfPatternRepeats;\n      "],["\n      float numberOfPatternRepeats \x3d stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats \x3d max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax \x3d roundedNumberOfPatternRepeats;\n      "])))),
n.vertex.code.add(m.glsl(H||(H=d.__makeTemplateObject(["\n      if (stippleSegmentDirectionLength \x3e\x3d 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength \x3d dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ","\n        stipplePatternUv \x3d projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv \x3d 1.0;\n        }\n      }\n    "],["\n      if (stippleSegmentDirectionLength \x3e\x3d 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength \x3d dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ",
"\n        stipplePatternUv \x3d projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv \x3d 1.0;\n        }\n      }\n    "])),a.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale \x3d roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale \x3d 1.0;")));n.vertex.code.add(m.glsl(J||(J=d.__makeTemplateObject(["\n      // Convert back into NDC\n      pos.xy \x3d pos.xy / screenSize * pos.w;\n\n      vColor \x3d getColor();\n      vColor.a *\x3d coverage;\n\n      gl_Position \x3d pos;\n    }\n  }\n  "],
["\n      // Convert back into NDC\n      pos.xy \x3d pos.xy / screenSize * pos.w;\n\n      vColor \x3d getColor();\n      vColor.a *\x3d coverage;\n\n      gl_Position \x3d pos;\n    }\n  }\n  "]))));n.include(l.Slice,a);n.fragment.uniforms.add("intrinsicColor","vec4");n.fragment.code.add(m.glsl(I||(I=d.__makeTemplateObject(["\n  void main() {\n    discardBySlice(vpos);\n    float stippleAlpha \x3d getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n    vec4 color \x3d intrinsicColor * vColor;\n  "],
["\n  void main() {\n    discardBySlice(vpos);\n    float stippleAlpha \x3d getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n    vec4 color \x3d intrinsicColor * vColor;\n  "]))));a.innerColorEnabled&&(n.fragment.uniforms.add("pixelRatio","float"),n.fragment.code.add(m.glsl(K||(K=d.__makeTemplateObject(["\n    float distToInner \x3d abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n    float innerAA \x3d clamp(0.5 - distToInner, 0.0, 1.0);\n    float innerAlpha \x3d innerColor.a + color.a * (1.0 - innerColor.a);\n    color \x3d mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n    "],
["\n    float distToInner \x3d abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n    float innerAA \x3d clamp(0.5 - distToInner, 0.0, 1.0);\n    float innerAlpha \x3d innerColor.a + color.a * (1.0 - innerColor.a);\n    color \x3d mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n    "])))));n.fragment.code.add(m.glsl(L||(L=d.__makeTemplateObject(["\n    vec4 finalColor \x3d blendStipple(color, stippleAlpha);\n  "],["\n    vec4 finalColor \x3d blendStipple(color, stippleAlpha);\n  "]))));a.falloffEnabled&&
n.fragment.code.add(m.glsl(M||(M=d.__makeTemplateObject(["\n    finalColor.a *\x3d pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n    "],["\n    finalColor.a *\x3d pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n    "]))));n.fragment.code.add(m.glsl(O||(O=d.__makeTemplateObject(["\n    if (finalColor.a \x3c ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "],["\n    if (finalColor.a \x3c ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),
m.glsl.float(h.symbolAlphaCutoff),0===a.output?m.glsl(Q||(Q=d.__makeTemplateObject(["gl_FragColor \x3d highlightSlice(finalColor, vpos);"],["gl_FragColor \x3d highlightSlice(finalColor, vpos);"]))):"",4===a.output?m.glsl(R||(R=d.__makeTemplateObject(["gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);"],["gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);"]))):""));return n};var b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.RibbonVertexPosition=void 0;a.RibbonVertexPosition=function(a,g){a.vertex.uniforms.add("intrinsicWidth","float");g.vvSize?(a.attributes.add("sizeFeatureAttribute","float"),a.vertex.uniforms.add("vvSizeMinSize","vec3"),a.vertex.uniforms.add("vvSizeMaxSize","vec3"),a.vertex.uniforms.add("vvSizeOffset","vec3"),a.vertex.uniforms.add("vvSizeFactor","vec3"),a.vertex.code.add(l.glsl(k||
(k=d.__makeTemplateObject(["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "],["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "]))))):(a.attributes.add("size","float"),a.vertex.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "],
["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "])))));g.vvOpacity?(a.attributes.add("opacityFeatureAttribute","float"),a.vertex.defines.addInt("VV_OPACITY_N",8),a.vertex.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "],
["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "]))))):
a.vertex.code.add(l.glsl(h||(h=d.__makeTemplateObject(["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "]))));g.vvColor?(a.attributes.add("colorFeatureAttribute","float"),a.vertex.defines.addInt("VV_COLOR_N",8),a.vertex.code.add(l.glsl(m||(m=d.__makeTemplateObject(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value \x3c\x3d vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "],
["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value \x3c\x3d vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "]))))):
(a.attributes.add("color","vec4"),a.vertex.code.add(l.glsl(f||(f=d.__makeTemplateObject(["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "])))))};var k,e,c,h,m,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.LineStipple=void 0;
a.LineStipple=function(a,f){a.defines.addFloat("STIPPLE_ALPHA_COLOR_DISCARD",.001);a.defines.addFloat("STIPPLE_ALPHA_HIGHLIGHT_DISCARD",.5);f.stippleEnabled?(a.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),f.stippleUVMaxEnabled&&a.varyings.add("stipplePatternUvMax","float"),a.varyings.add("stipplePatternUv","float"),a.fragment.uniforms.add("stipplePatternTexture","sampler2D"),f.stippleOffColorEnabled&&a.fragment.uniforms.add("stippleOffColor","vec4"),a.fragment.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped \x3d stipplePatternUv * gl_FragCoord.w;\n    ",
"\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"],["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped \x3d stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"])),f.stippleUVMaxEnabled?"stipplePatternUvClamped \x3d clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":"")),f.stippleOffColorEnabled?a.fragment.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "],
["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "])))):a.fragment.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha \x3c threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "],["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha \x3c threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "]))))):
a.fragment.code.add(l.glsl(h||(h=d.__makeTemplateObject(["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "],["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "]))))};var k,e,c,h})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.PiUtils=void 0;a.PiUtils=function(a){a.vertex.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    const float PI \x3d 3.141592653589793;\n  "],["\n    const float PI \x3d 3.141592653589793;\n  "]))));a.fragment.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n    const float PI \x3d 3.141592653589793;\n    const float LIGHT_NORMALIZATION \x3d 1.0 / PI;\n    const float INV_PI \x3d 0.3183098861837907;\n    const float HALF_PI \x3d 1.570796326794897;\n    "],
["\n    const float PI \x3d 3.141592653589793;\n    const float LIGHT_NORMALIZATION \x3d 1.0 / PI;\n    const float INV_PI \x3d 0.3183098861837907;\n    const float HALF_PI \x3d 1.570796326794897;\n    "]))))};var k,e})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports","./Camera"],function(n,a,d){return function(){function a(a,e,c,h,m,f){this.camera=null;this.lastFrameCamera=new d.default;this.slot=this.pass=0;this.highlightDepthTexture=null;this.renderOccludedMask=
13;this.hasOccludees=!1;this.rctx=a;this.offscreenRenderingHelper=e;this.scenelightingData=c;this.shadowMap=h;this.ssaoHelper=m;this.sliceHelper=f}a.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=13};Object.defineProperty(a.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!1,configurable:!0});return a}()})},"esri/views/3d/webgl-engine/lib/renderStats":function(){define(["require","exports"],function(n,a){function d(){return{triangles:0,drawCalls:0}}
Object.defineProperty(a,"__esModule",{value:!0});a.RenderStatsAggregator=a.addToRenderStats=a.makeNewRenderStats=void 0;a.makeNewRenderStats=d;a.addToRenderStats=function(a,d,e){e&&(e.drawCalls+=a,e.triangles+=d)};n=function(){function a(){this.materialRenderStats=new Map;this.reset()}a.prototype.getMaterialRenderStatsObject=function(a){var e=this.materialRenderStats.get(a);e||(e=d(),this.materialRenderStats.set(a,e));return e};a.prototype.getAggregatedStats=function(){var a={materialRenderers:{},
total:d()};this.materialRenderStats.forEach(function(d,c){a.materialRenderers[c]=d;a.total.drawCalls+=d.drawCalls;a.total.triangles+=d.triangles});return a};a.prototype.reset=function(){this.materialRenderStats.forEach(function(a){a.drawCalls=0;a.triangles=0})};return a}();a.RenderStatsAggregator=n})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ./Material ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.SortedRenderGeometryRenderer=void 0;var g=function(){return function(){}}();n=function(a){function p(){var b=null!==a&&a.apply(this,arguments)||this;b._pendingAddsRemoves=new Map;b._adds=new c;b._removes=new c;b._updates=new c({allocator:function(a){return a||new g},deallocator:function(a){a.renderGeometry=null;return a}});b._materialRenderers=new Map;b._sortedMaterialRenderers=new c;b._hasHighlights=!1;b._hasWater=
!1;return b}d.__extends(p,a);p.prototype.dispose=function(){this._adds.prune();this._removes.prune();this._updates.prune();this._materialRenderers&&(this._materialRenderers.forEach(function(a){return a.dispose()}),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear())};Object.defineProperty(p.prototype,"updating",{get:function(){return 0<this._pendingAddsRemoves.size||0<this._updates.length},enumerable:!1,configurable:!0});Object.defineProperty(p.prototype,"hasHighlights",{get:function(){return this._hasHighlights},
enumerable:!1,configurable:!0});Object.defineProperty(p.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!1,configurable:!0});Object.defineProperty(p.prototype,"rendersOccluded",{get:function(){return k.someMap(this._materialRenderers,function(a){return a.rendersOccluded})},enumerable:!1,configurable:!0});p.prototype.stopAnimationsAtTime=function(a){this._sortedMaterialRenderers.forEachSimple(function(b){return e.applySome(b.material.animation,function(b){return b.stopAtTime(a)})})};
Object.defineProperty(p.prototype,"isEmpty",{get:function(){return!this.updating&&0===this._materialRenderers.size},enumerable:!1,configurable:!0});p.prototype.commitChanges=function(){var a=this,c=!1;if(!this.updating)return!1;this.updateAddsRemoves();var d=!1,e=!1;f.splitRenderGeometryChangeSetByMaterial({numToAdd:this._adds.length,toAdd:this._adds.data,numToRemove:this._removes.length,toRemove:this._removes.data,numToUpdate:this._updates.length,toUpdate:this._updates.data}).forEach(function(f,
g){var h=a._materialRenderers.get(g);!h&&0<f.toAdd.length&&(h=new b(a.rctx,a.materialRepository,g),a._materialRenderers.set(g,h),e=d=c=!0);if(h){var m=d||h.hasHighlights,k=e||h.hasWater;h.modify(f);d=d||m!==h.hasHighlights;e=e||k!==h.hasWater;h.isEmpty&&(a._materialRenderers.delete(g),h.dispose(),c=!0)}});this._adds.clear();this._removes.clear();this._updates.clear();this._pendingAddsRemoves.clear();c&&this.updateSortedMaterialRenderers();d&&(this._hasHighlights=k.someMap(this._materialRenderers,
function(a){return a.hasHighlights}));e&&(this._hasWater=k.someMap(this._materialRenderers,function(a){return a.hasWater}));this.notifyChange("updating");return!0};p.prototype.add=function(a){for(var b=0===this._pendingAddsRemoves.size,c=0;c<a.length;c++)this._pendingAddsRemoves.set(a[c],0);b&&0<this._pendingAddsRemoves.size&&this.notifyChange("updating")};p.prototype.remove=function(a){for(var b=0===this._pendingAddsRemoves.size,c=0;c<a.length;c++){var d=a[c],e=this._pendingAddsRemoves.get(d);0===
e?this._pendingAddsRemoves.set(d,2):2!==e&&this._pendingAddsRemoves.set(d,1)}b&&0<this._pendingAddsRemoves.size&&this.notifyChange("updating")};p.prototype.modify=function(a,b){for(var c=0===this._updates.length,d=0;d<a.length;d++){var e=a[d],f=this._updates.pushNew();f.renderGeometry=e;f.updateType=b}c&&0<this._updates.length&&this.notifyChange("updating")};p.prototype.updateLogic=function(a){for(var b=!1,c=0;c<this._sortedMaterialRenderers.length;c++){var d=this._sortedMaterialRenderers.data[c].materialRenderer;
d.updateLogic&&d.updateLogic(a)&&(b=!0)}return b};p.prototype.draw=function(a,b,c){for(var d=0;d<this._sortedMaterialRenderers.length;d++){var e=this._sortedMaterialRenderers.data[d];if(m.materialPredicate(e.material,a)){var f=c.getMaterialRenderStatsObject(e.materialRenderer.type);e.materialRenderer.render(null,a,b,f)}}};p.prototype.updateSortedMaterialRenderers=function(){var a=this;this._sortedMaterialRenderers.clear();var b=0;this._materialRenderers.forEach(function(c,d){d.insertOrder=b++;a._sortedMaterialRenderers.push({material:d,
materialRenderer:c})});this._sortedMaterialRenderers.sort(function(a,b){var c=b.material.renderPriority-a.material.renderPriority;return 0!==c?c:a.material.insertOrder-b.material.insertOrder})};p.prototype.updateAddsRemoves=function(){var a=this;this._adds.clear();this._removes.clear();this._pendingAddsRemoves.forEach(function(b,c){switch(b){case 0:a._adds.push(c);break;case 1:a._removes.push(c)}});for(var b=0;b<this._updates.length;)this._pendingAddsRemoves.has(this._updates.data[b].renderGeometry)?
this._updates.removeUnorderedIndex(b):b++};Object.defineProperty(p.prototype,"test",{get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}},enumerable:!1,configurable:!0});d.__decorate([h.property()],p.prototype,"rctx",void 0);d.__decorate([h.property()],p.prototype,"materialRepository",void 0);d.__decorate([h.property()],p.prototype,"updating",null);return p=d.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],p)}(l);a.SortedRenderGeometryRenderer=
n})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["require","exports","./Util"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.splitRenderGeometryChangeSetByMaterial=void 0;a.splitRenderGeometryChangeSetByMaterial=function(a){for(var k=new Map,e=null,c=null,h=function(a){if(a===e)return c;var b=k.get(a);b||(b={toAdd:[],numToAdd:-1,toRemove:[],numToRemove:-1,toUpdate:[],numToUpdate:-1},k.set(a,b));e=a;return c=b},m=0;m<a.numToAdd;m++){var f=a.toAdd[m];if(1<=
d.getFirstObjectValue(f.data.indices).length){var b=h(f.material);b.toAdd.push(f)}}for(m=0;m<a.numToRemove;m++)f=a.toRemove[m],1<=d.getFirstObjectValue(f.data.indices).length&&(b=h(f.material),b.toRemove.push(f));for(m=0;m<a.numToUpdate;m++)f=a.toUpdate[m],1<=d.getFirstObjectValue(f.renderGeometry.data.indices).length&&(b=h(f.renderGeometry.material),b.toUpdate.push(f));return k}})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("require exports ../../../../../core/MapUtils ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/renderStats ../../lib/ResizableFloat32Array ../../lib/Util ../WaterGLMaterial ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v){function w(a,b,c,d){for(var e=new Map,f=b.vertexBufferLayout.stride/4,g=function(c,d){var g=c.origin,h=a.get(g.id),m=e.get(g.id);null==m&&(m={optimalCount:null==h?0:h.optimalCount,sparseCount:null==h?0:h.buffer.size,toAdd:[],toRemove:[],origin:g.vec3},e.set(g.id,m));g=b.elementCount(c.data)*f;d?(m.optimalCount+=g,m.sparseCount+=g,m.toAdd.push(c)):(m.optimalCount-=g,m.toRemove.push(c))},h=0;h<c.length;h++){var m=c[h];g(m,!0)}for(c=0;c<d.length;c++)m=d[c],
g(m,!1);return e}n=function(){function a(a,b,c){this.type="MergedRenderer";this._dataByOrigin=new Map;this._hasOccludees=this._hasHighlights=!1;this._rctx=a;this._material=c;this._materialRep=b;this._glMaterials=u.acquireMaterials(this._material,this._materialRep);this._bufferWriter=c.createBufferWriter()}a.prototype.dispose=function(){u.releaseMaterials(this._material,this._materialRep);this._dataByOrigin&&(this._dataByOrigin.forEach(function(a){a.vao.dispose(!0);a.vao=null}),this._dataByOrigin.clear(),
this._dataByOrigin=null);this._glMaterials&&(this._glMaterials.forEach(function(a){a&&a.dispose()}),this._glMaterials.clear(),this._glMaterials=null)};Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hasOccludees",{get:function(){return this._hasOccludees},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"hasWater",{get:function(){return!this.isEmpty&&l.someMap(this._glMaterials,function(a){return a instanceof p.WaterGLMaterial})},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"rendersOccluded",{get:function(){return!this.isEmpty&&1!==this._material.renderOccluded},enumerable:!1,configurable:!0});a.prototype.modify=function(a){this.updateGeometries(a.toUpdate);this.addAndRemoveGeometries(a.toAdd,a.toRemove);this.updateRenderCommands()};
a.prototype.addAndRemoveGeometries=function(a,b){var c=this,d=this._bufferWriter,e=d.vertexBufferLayout,f=e.stride/4,h=this._dataByOrigin,m=w(h,d,a,b);m.forEach(function(a,b){m.delete(b);var d=a.optimalCount,k=a.sparseCount,p=h.get(b);null==p&&(g.assert(0<d),p=c.createData(e,d,a.origin),h.set(b,p));if(0===d)p.vao.dispose(!0),p.vao=null,h.delete(b);else{var l=d<a.sparseCount/2;b=z;var r=p.buffer.size,t=p.buffer.array,d=p.buffer.resize(l?d:k,!1);l||d?c.removeAndRebuild(p,a.toRemove,f,t,b):0<a.toRemove.length?
(c.removeByErasing(p,a.toRemove,f,b),0<a.toAdd.length&&(b.end=r)):(b.begin=r,b.end=r);d=x;g.setMatrixTranslation3(d,-a.origin[0],-a.origin[1],-a.origin[2]);c.append(p,a.toAdd,f,d,b);a=p.vao.vertexBuffers.geometry;a.byteSize!==p.buffer.array.buffer.byteLength?a.setData(p.buffer.array):(d=b.begin,b=b.end,d<b&&(d*=4,a.setSubData(p.buffer.array,d,d,4*b)));p.drawCommandsDirty=!0}})};a.prototype.updateGeometries=function(a){for(var b=this._bufferWriter,c=b.vertexBufferLayout.stride/4,d=0;d<a.length;d++){var e=
a[d],f=e.updateType,e=e.renderGeometry,h=this._dataByOrigin.get(e.origin.id),m=h&&h.instances.get(e.uniqueName);if(!m)break;f&1&&(m.isVisible=e.instanceParameters.visible);if(f&9){var k=e.instanceParameters.visible;m.hasHighlights=!!e.instanceParameters.highlights&&k}f&16&&(m.hasOccludees=!!e.instanceParameters.occludees);f&6&&(f=h.buffer.array,k=h.vao,u.calculateTransformRelToOrigin(e,B,A),b.write({transformation:B,invTranspTransformation:A},e.data,b.vertexBufferLayout.createView(f.buffer),m.from),
g.assert(m.from+b.elementCount(e.data)===m.to,"material VBO layout has changed"),k.vertexBuffers.geometry.setSubData(f,m.from*c*4,m.from*c*4,m.to*c*4));h.drawCommandsDirty=!0}};a.prototype.updateRenderCommands=function(){this._dataByOrigin.forEach(function(a){a.hasHiddenInstances=l.someMap(a.instances,function(a){return!a.isVisible});a.hasHighlights=l.someMap(a.instances,function(a){return a.isVisible&&a.hasHighlights});a.hasOccludees=l.someMap(a.instances,function(a){return a.isVisible&&a.hasOccludees})});
this._hasHighlights=l.someMap(this._dataByOrigin,function(a){return a.hasHighlights});this._hasOccludees=l.someMap(this._dataByOrigin,function(a){return a.hasOccludees});var a=function(a){a.drawCommandsDefault=null;a.drawCommandsHighlight=null;a.drawCommandsOccludees=null;a.stats={default:0,highlight:0,occludees:0};if(0!==a.instances.size)if(a.hasOccludees||a.hasHighlights||a.hasHiddenInstances){var b=t.sortInstancesAccordingToRange(d.valuesOfMap(a.instances));a.drawCommandsDefault=[];a.drawCommandsHighlight=
[];a.drawCommandsOccludees=[];for(var c=0;c<b.length;c++){var e=b[c];e.isVisible&&(e.hasOccludees?t.addOrMerge(a.drawCommandsOccludees,e):t.addOrMerge(a.drawCommandsDefault,e),e.hasHighlights&&t.addOrMerge(a.drawCommandsHighlight,e))}b=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].count;return b/3};a.stats={default:b(a.drawCommandsDefault),highlight:b(a.drawCommandsHighlight),occludees:b(a.drawCommandsOccludees)}}else b=4*a.buffer.size/q.getStride(a.vao.layout.geometry),a.drawCommandsDefault=
[{first:0,count:b}],a.stats={default:b,highlight:0,occludees:0}};this._dataByOrigin.forEach(function(b){b.drawCommandsDirty&&(a(b),b.drawCommandsDirty=!1)})};a.prototype.updateLogic=function(a){return this._material.update(a)};a.prototype.render=function(a,b,c,d){var g=this,h=this._rctx,m=this._glMaterials.get(b.pass),p=4===b.pass,l=a;2===b.pass&&null===l&&(l=22);if(!m||2!==m.ensureResources(h)||null!=l&&!m.beginSlot(l)||p&&!this._hasHighlights)return!1;m.ensureParameters(c);var r=m.getTechnique(),
t=m.getPipelineState(l,!1);h.setPipelineState(t);m.bind(h,c);var q=!1;this._dataByOrigin.forEach(function(a){if(!(k.isNone(a.drawCommandsDefault)&&k.isNone(a.drawCommandsHighlight)&&k.isNone(a.drawCommandsOccludees)||p&&!a.hasHighlights)){c.origin=a.origin;r.bindDraw(c);r.ensureAttributeLocations(a.vao);h.bindVAO(a.vao);var b=r.primitiveType,v=p?a.drawCommandsHighlight:a.drawCommandsDefault,u=p?a.stats.highlight:a.stats.default;e.isSome(v)&&(g.renderCommands(h,b,v),f.addToRenderStats(v.length,u,d),
q=!0);p||(v=a.drawCommandsOccludees,e.isSome(v)&&(u=m.getPipelineState(l,!0),h.setPipelineState(u),g.renderCommands(h,b,v),h.setPipelineState(t),f.addToRenderStats(v.length,a.stats.occludees,d),q=!0))}});return q};a.prototype.renderCommands=function(a,b,c){for(var d=0;d<c.length;d++)a.drawArrays(b,c[d].first,c[d].count)};a.prototype.createData=function(a,c,d){return{instances:new Map,vao:new v(this._rctx,this._material.vertexAttributeLocations,{geometry:m.glLayout(a)},{geometry:r.createVertex(this._rctx,
35044)}),buffer:new b.ResizableFloat32Array(c),optimalCount:0,origin:d,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,stats:{default:0,highlight:0,occludees:0}}};a.prototype.removeAndRebuild=function(a,b,c,d,e){for(var f=0;f<b.length;f++){var g=b[f].uniqueName,h=a.instances.get(g);a.optimalCount-=(h.to-h.from)*c;a.instances.delete(g)}var m=0,k=a.buffer.array;e.begin=0;e.end=0;var p=-1,l=-1,
r=0;a.instances.forEach(function(a){var b=a.from*c,e=a.to*c,f=e-b;p!==l&&l!==b?(k.set(d.subarray(p,l),r),r+=l-p,p=b):-1===p&&(p=b);l=e;a.from=m/c;m+=f;a.to=m/c});p!==l&&k.set(d.subarray(p,l),r);e.end=m};a.prototype.removeByErasing=function(a,b,c,d){d.begin=Infinity;d.end=-Infinity;for(var e=-1,f=-1,g=0;g<b.length;g++){var h=b[g].uniqueName,m=a.instances.get(h),k=m.from*c,m=m.to*c;e!==f&&f!==k?(a.buffer.erase(e,f),e=k):-1===e&&(e=k);f=m;a.instances.delete(h);a.optimalCount-=m-k;k<d.begin&&(d.begin=
k);m>d.end&&(d.end=m)}e!==f&&a.buffer.erase(e,f)};a.prototype.append=function(a,b,d,f,h){for(var m=this._bufferWriter,k=0;k<b.length;k++){var p=b[k],l=e.isSome(p.transformation)?c.mat4.multiply(B,f,p.transformation):f;c.mat4.invert(A,l);c.mat4.transpose(A,A);var r=h.end;m.write({transformation:l,invTranspTransformation:A},p.data,m.vertexBufferLayout.createView(a.buffer.array.buffer),h.end/d);var l=m.elementCount(p.data)*d,q=r+l;g.assert(null==a.instances.get(p.uniqueName));var v=p.instanceParameters.visible,
r=new t.Instance(r/d,q/d,v,!!p.instanceParameters.highlights&&v,!!p.instanceParameters.occludees);a.instances.set(p.uniqueName,r);a.optimalCount+=l;h.end+=l}};Object.defineProperty(a.prototype,"test",{get:function(){return{material:this._material,glMaterials:this._glMaterials}},enumerable:!1,configurable:!0});return a}();var z={begin:0,end:0},x=h.mat4f64.create(),B=h.mat4f64.create(),A=h.mat4f64.create();return n})},"esri/views/3d/webgl-engine/lib/ResizableFloat32Array":function(){define(["require",
"exports","../../../../core/mathUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.ResizableFloat32Array=void 0;n=function(){function a(a){null==a?a=16:65536>a&&(a=d.nextHighestPowerOfTwo(a));this._array=new Float32Array(a);this._size=0}a.prototype.resize=function(a,d){this._size=a;if(this._size>this._array.length){for(a=this._array.length||1;a<this._size;)a*=2;var c=new Float32Array(a);d&&c.set(this._array);this._array=c;return!0}c=2*this._size;if(c<=this._array.length){for(a=
this._array.length;a>=c;)a=Math.floor(a/2);c=new Float32Array(a);d&&c.set(this._array.subarray(0,a));this._array=c;return!0}return!1};a.prototype.append=function(a){var d=this._size;this.resize(this._size+a.length,!0);this._array.set(a,d)};a.prototype.erase=function(a,d){for(;a<d;++a)this._array[a]=0};Object.defineProperty(a.prototype,"array",{get:function(){return this._array},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!1,
configurable:!0});return a}();a.ResizableFloat32Array=n})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("require exports tslib ../lib/GLMaterial ./WaterTechnique ./internal/MaterialUtil".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.WaterGLMaterial=void 0;n=function(a){function c(c){c=a.call(this,c)||this;c.updateParameters();return c}d.__extends(c,a);c.prototype.updateParameters=function(){this.params=e.copyParameters(this.material.getParameters());
this.technique=this.techniqueRep.acquireAndReleaseExisting(k.WaterTechnique,this.material.getTechniqueConfig(this.output),this.technique)};c.prototype.beginSlot=function(a){if(2===this.output)return 22===a;if(5===this.output)return null==a;if(4===this.output)return 3===a;var c=3;this.params.transparent&&(c=this.params.writeDepth?5:8);return a===c};c.prototype.setElapsedTimeUniform=function(a){a.setUniform1f("timeElapsed",.001*this.material.animation.time*this.params.animationSpeed)};c.prototype._updateShadowState=
function(a){a.shadowMappingEnabled!==this.params.receiveShadows&&(this.material.setParameterValues({receiveShadows:a.shadowMappingEnabled}),this.updateParameters())};c.prototype._updateSSRState=function(a){a.ssrEnabled!==this.params.ssrEnabled&&(this.material.setParameterValues({ssrEnabled:a.ssrEnabled}),this.updateParameters())};c.prototype.ensureResources=function(a){return this.technique.ensureResource(a)};c.prototype.ensureParameters=function(a){0===this.output&&(this._updateShadowState(a),this._updateSSRState(a))};
c.prototype.bind=function(a,c){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.params,c);2!==this.output&&0!==this.output||this.setElapsedTimeUniform(this.technique.program)};return c}(l.GLMaterial);a.WaterGLMaterial=n})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultTextureUnits ../lib/DefaultVertexAttributeLocations ../shaders/WaterSurface.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q){Object.defineProperty(a,"__esModule",{value:!0});a.WaterTechniqueConfiguration=a.WaterTechnique=void 0;b=function(a){function b(b,c){c=a.call(this,b,c)||this;c.waterTextureRepository=b.waterTextureRepository;return c}d.__extends(b,a);b.prototype.initializeProgram=function(a){var c=b.shader.get(),d=this.configuration,c=c.build({output:d.output,viewingMode:a.viewingMode,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,
receiveShadows:d.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:d.useSSR,highStepCount:!0});return new r(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),t.Default3D)};b.prototype.ensureResource=function(a){this.waterTextureRepository.ready||this.waterTextureRepository.updating||this.waterTextureRepository.loadTextures(a);return this.waterTextureRepository.ready?2:1};b.prototype.bindPass=function(a,b,d){m.View.bindProjectionMatrix(this.program,d.camera.projectionMatrix);
0===this.configuration.output&&(d.lighting.setUniforms(this.program,!1),c.ScreenSpaceReflections.bindUniforms(this.program,a,d));if(0===this.configuration.output||2===this.configuration.output)h.WaterDistortion.bindUniforms(this.program,b),this.waterTextureRepository.bindRepo(a);this.program.setUniform4fv("waterColor",b.color);4===this.configuration.output&&k.OutputHighlight.bindOutputHighlight(a,this.program,d)};b.prototype.bindDraw=function(a){m.View.bindView(this.program,a);0===this.configuration.output&&
(m.View.bindCamPosition(this.program,a.origin,a.camera.viewInverseTransposeMatrix),e.ReadShadowMap.bindUniforms(this.program,a,p.DefaultTextureUnits.SHADOW_MAP));0!==this.configuration.output&&4!==this.configuration.output||l.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};b.prototype.initializePipeline=function(){var a=this.configuration;return 2===a.output?q.makePipelineState({depthTest:{func:513},depthWrite:a.writeDepth&&q.defaultDepthWriteParams,colorWrite:q.defaultColorWriteParams}):
q.makePipelineState({blending:4!==a.output&&a.transparent?q.separateBlendingParams(770,1,771,771):null,depthTest:{func:513},depthWrite:a.writeDepth&&q.defaultDepthWriteParams,colorWrite:q.defaultColorWriteParams})};b.shader=new f.ReloadableShaderModule(u,function(){return new Promise(function(a,b){n(["../shaders/WaterSurface.glsl"],a,b)})});return b}(b.ShaderTechnique);a.WaterTechnique=b;b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.receiveShadows=!1;b.slicePlaneEnabled=
!1;b.transparent=!1;b.writeDepth=!1;b.useSSR=!1;b.isDraped=!1;return b}d.__extends(b,a);d.__decorate([g.parameter({count:7})],b.prototype,"output",void 0);d.__decorate([g.parameter()],b.prototype,"receiveShadows",void 0);d.__decorate([g.parameter()],b.prototype,"slicePlaneEnabled",void 0);d.__decorate([g.parameter()],b.prototype,"transparent",void 0);d.__decorate([g.parameter()],b.prototype,"writeDepth",void 0);d.__decorate([g.parameter()],b.prototype,"useSSR",void 0);d.__decorate([g.parameter()],
b.prototype,"isDraped",void 0);return b}(g.ShaderTechniqueConfiguration);a.WaterTechniqueConfiguration=b})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define(["require","exports","tslib","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(n,a,d,l,k){function e(a){a.fragment.include(l.RgbaFloatEncoding);a.fragment.uniforms.add("depthTex","sampler2D");a.fragment.uniforms.add("shadowMapNum","int");a.fragment.uniforms.add("shadowMapDistance",
"vec4");a.fragment.uniforms.add("shadowMapMatrix","mat4",4);a.fragment.uniforms.add("depthHalfPixelSz","float");a.fragment.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize \x3d depthHalfPixelSz;\n      vec4 distance \x3d shadowMapDistance;\n      float depth \x3d _linearDepth;\n\n      //choose correct cascade\n      int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\n\n      if (i \x3e\x3d shadowMapNum) { return 0.0; }\n\n      mat4 mat \x3d i \x3d\x3d 0 ? shadowMapMatrix[0] : i \x3d\x3d 1 ? shadowMapMatrix[1] : i \x3d\x3d 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv \x3d mat * vec4(_vpos, 1.0);\n      lv.xy /\x3d lv.w;\n\n      // vertex completely outside? -\x3e no shadow\n      vec3 lvpos \x3d 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z \x3e\x3d 1.0) { return 0.0; }\n      if (lvpos.x \x3c 0.0 || lvpos.x \x3e 1.0 || lvpos.y \x3c 0.0 || lvpos.y \x3e 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv \x3d vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize \x3d 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st \x3d fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "],
["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize \x3d depthHalfPixelSz;\n      vec4 distance \x3d shadowMapDistance;\n      float depth \x3d _linearDepth;\n\n      //choose correct cascade\n      int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\n\n      if (i \x3e\x3d shadowMapNum) { return 0.0; }\n\n      mat4 mat \x3d i \x3d\x3d 0 ? shadowMapMatrix[0] : i \x3d\x3d 1 ? shadowMapMatrix[1] : i \x3d\x3d 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv \x3d mat * vec4(_vpos, 1.0);\n      lv.xy /\x3d lv.w;\n\n      // vertex completely outside? -\x3e no shadow\n      vec3 lvpos \x3d 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z \x3e\x3d 1.0) { return 0.0; }\n      if (lvpos.x \x3c 0.0 || lvpos.x \x3e 1.0 || lvpos.y \x3c 0.0 || lvpos.y \x3e 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv \x3d vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize \x3d 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st \x3d fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "]))))}
Object.defineProperty(a,"__esModule",{value:!0});a.ReadShadowMap=void 0;a.ReadShadowMap=e;(function(a){a.bindUniforms=function(a,c,b){c.shadowMappingEnabled&&(c.shadowMap.bind(a,b),c.shadowMap.bindView(a,c.origin))};a.bindViewCustomOrigin=function(a,c,b){c.shadowMappingEnabled&&c.shadowMap.bindView(a,b)};a.bindView=function(a,c){c.shadowMappingEnabled&&c.shadowMap.bindView(a,c.origin)}})(e=a.ReadShadowMap||(a.ReadShadowMap={}));var c})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("require exports tslib ../output/ReadLinearDepth.glsl ./Reprojection.glsl ../../shaderModules/interfaces".split(" "),
function(n,a,d,l,k,e){function c(a,c){a.fragment.uniforms.add("nearFar","vec2");a.fragment.uniforms.add("depthMapView","sampler2D");a.fragment.uniforms.add("ssrViewMat","mat4");a.fragment.uniforms.add("invResolutionHeight","float");a.include(l.ReadLinearDepth);a.include(k.Reprojection);a.fragment.code.add(e.glsl(h||(h=d.__makeTemplateObject(["\n  const int maxSteps \x3d ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord \x3d  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /\x3d projectedCoord.w;\n    projectedCoord.xy \x3d projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos \x3d startPosition;\n    vec3 viewPosEnd \x3d startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart \x3d applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 \x3d viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 \x3d 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos +\x3d dir;\n\n    vec4 projectedCoordVanishingPoint \x3d applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd \x3d applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 \x3d viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 \x3d 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir \x3d (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint \x3d (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod \x3d min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength \x3d length(projectedCoordDir);\n    float maxSt \x3d float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP \x3d yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ \x3d yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk \x3d yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P \x3d projectedCoordStart.xy;\n    vec3 Q \x3d Q0;\n    float k \x3d k0;\n    float rayStartZ \x3d -startPosition.z; // estimated ray start depth value\n    float rayEndZ \x3d -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ \x3d -startPosition.z;\n    float rayDiffZ \x3d 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld \x3d 0.0;\n\n    // early outs\n    if (dot(normal, dir) \x3c 0.0 || dot(-viewDir, normal) \x3c 0.0)\n      return vec3(P, 0.0);\n\n    for(int i \x3d 0; i \x3c maxSteps-1; i++)\n    {\n      depth \x3d -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ \x3d prevEstimateZ;\n      dDepth \x3d -rayStartZ - depth;\n      rayEndZ \x3d (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ \x3d rayEndZ- rayStartZ;\n      prevEstimateZ \x3d rayEndZ;\n\n      if(-rayEndZ \x3e nearFar[1] || -rayEndZ \x3c nearFar[0] || P.y \x3c 0.0  || P.y \x3e 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth \x3e 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) \x3c 0.025/abs(k) + abs(rayDiffZ) \x26\x26 dDepth \x3e 0.0 \x26\x26 depth \x3e nearFar[0] \x26\x26 depth \x3c nearFar[1] \x26\x26 abs(P.y - projectedCoordStart.y) \x3e invResolutionHeight)\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P +\x3d dP;\n      Q.z +\x3d dQ.z;\n      k +\x3d dk;\n      rayDiffZOld \x3d rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "],
["\n  const int maxSteps \x3d ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord \x3d  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /\x3d projectedCoord.w;\n    projectedCoord.xy \x3d projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos \x3d startPosition;\n    vec3 viewPosEnd \x3d startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart \x3d applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 \x3d viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 \x3d 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos +\x3d dir;\n\n    vec4 projectedCoordVanishingPoint \x3d applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd \x3d applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 \x3d viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 \x3d 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir \x3d (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint \x3d (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod \x3d min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength \x3d length(projectedCoordDir);\n    float maxSt \x3d float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP \x3d yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ \x3d yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk \x3d yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P \x3d projectedCoordStart.xy;\n    vec3 Q \x3d Q0;\n    float k \x3d k0;\n    float rayStartZ \x3d -startPosition.z; // estimated ray start depth value\n    float rayEndZ \x3d -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ \x3d -startPosition.z;\n    float rayDiffZ \x3d 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld \x3d 0.0;\n\n    // early outs\n    if (dot(normal, dir) \x3c 0.0 || dot(-viewDir, normal) \x3c 0.0)\n      return vec3(P, 0.0);\n\n    for(int i \x3d 0; i \x3c maxSteps-1; i++)\n    {\n      depth \x3d -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ \x3d prevEstimateZ;\n      dDepth \x3d -rayStartZ - depth;\n      rayEndZ \x3d (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ \x3d rayEndZ- rayStartZ;\n      prevEstimateZ \x3d rayEndZ;\n\n      if(-rayEndZ \x3e nearFar[1] || -rayEndZ \x3c nearFar[0] || P.y \x3c 0.0  || P.y \x3e 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth \x3e 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) \x3c 0.025/abs(k) + abs(rayDiffZ) \x26\x26 dDepth \x3e 0.0 \x26\x26 depth \x3e nearFar[0] \x26\x26 depth \x3c nearFar[1] \x26\x26 abs(P.y - projectedCoordStart.y) \x3e invResolutionHeight)\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P +\x3d dP;\n      Q.z +\x3d dQ.z;\n      k +\x3d dk;\n      rayDiffZOld \x3d rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),
c.highStepCount?"150;":"75;"))}Object.defineProperty(a,"__esModule",{value:!0});a.ScreenSpaceReflections=void 0;a.ScreenSpaceReflections=c;(function(a){a.bindUniforms=function(a,b,c){c.ssrEnabled&&(a.setUniform1i("depthMapView",c.linearDepthTextureID),b.bindTexture(c.linearDepthTexture,c.linearDepthTextureID),a.setUniform2fv("nearFar",c.camera.nearFar),a.setUniformMatrix4fv("ssrViewMat",c.camera.viewMatrix),a.setUniform1f("invResolutionHeight",1/c.camera.height),k.Reprojection.bindUniforms(a,b,c))}})(c=
a.ScreenSpaceReflections||(a.ScreenSpaceReflections={}));var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["require","exports","tslib","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.ReadLinearDepth=void 0;a.ReadLinearDepth=function(a){a.fragment.include(l.RgbaFloatEncoding);a.fragment.code.add(k.glsl(e||(e=d.__makeTemplateObject(["\n    float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "],
["\n    float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "]))))};var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Reprojection.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){function k(a){a.fragment.uniforms.add("lastFrameColorMap","sampler2D");a.fragment.uniforms.add("reprojectionMat","mat4");a.fragment.uniforms.add("rpProjectionMat",
"mat4");a.fragment.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw \x3d rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord \x3d reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /\x3d reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "],["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw \x3d rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord \x3d reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /\x3d reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "]))))}
Object.defineProperty(a,"__esModule",{value:!0});a.Reprojection=void 0;a.Reprojection=k;(function(a){a.bindUniforms=function(a,c,d){a.setUniform1i("lastFrameColorMap",d.lastFrameColorTextureID);c.bindTexture(d.lastFrameColorTexture,d.lastFrameColorTextureID);a.setUniformMatrix4fv("reprojectionMat",d.reprojectionMat);a.setUniformMatrix4fv("rpProjectionMat",d.camera.projectionMatrix)}})(k=a.Reprojection||(a.Reprojection={}));var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define(["require",
"exports","tslib","./FoamRendering.glsl","../../shaderModules/interfaces"],function(n,a,d,l,k){function e(a){a.fragment.uniforms.add("texWaveNormal","sampler2D");a.fragment.uniforms.add("texWavePerturbation","sampler2D");a.fragment.uniforms.add("waveParams","vec4");a.fragment.uniforms.add("waveDirection","vec2");a.include(l.FoamIntensity);a.fragment.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n      const vec2  FLOW_JUMP \x3d vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress \x3d computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength \x3d waveParams[2];\n        float flowOffset \x3d waveParams[3];\n\n        vec2 flowVector \x3d textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress \x3d computeProgress(uv, time + phaseOffset);\n        float weight \x3d computeWeight(uv, time + phaseOffset);\n\n        vec2 result \x3d uv;\n        result -\x3d flowVector * (progress + flowOffset);\n        result +\x3d phaseOffset;\n        result +\x3d (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT \x3d 0.3737;\n      const float TIME_NOISE_STRENGTH \x3d 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength \x3d waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement \x3d time * -_waveDir;\n\n        float timeNoise \x3d sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A \x3d textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B \x3d textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal \x3d normalize(normal_A + normal_B);\n        mixNormal.xy *\x3d waveStrength;\n        mixNormal.z \x3d sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat \x3d waveParams[1];\n        vec3 normal \x3d getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  \x3d normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "],
["\n      const vec2  FLOW_JUMP \x3d vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress \x3d computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength \x3d waveParams[2];\n        float flowOffset \x3d waveParams[3];\n\n        vec2 flowVector \x3d textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress \x3d computeProgress(uv, time + phaseOffset);\n        float weight \x3d computeWeight(uv, time + phaseOffset);\n\n        vec2 result \x3d uv;\n        result -\x3d flowVector * (progress + flowOffset);\n        result +\x3d phaseOffset;\n        result +\x3d (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT \x3d 0.3737;\n      const float TIME_NOISE_STRENGTH \x3d 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength \x3d waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement \x3d time * -_waveDir;\n\n        float timeNoise \x3d sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A \x3d textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B \x3d textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal \x3d normalize(normal_A + normal_B);\n        mixNormal.xy *\x3d waveStrength;\n        mixNormal.z \x3d sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat \x3d waveParams[1];\n        vec3 normal \x3d getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  \x3d normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "]))))}
Object.defineProperty(a,"__esModule",{value:!0});a.WaterDistortion=void 0;a.WaterDistortion=e;(function(a){a.bindUniforms=function(a,c){a.setUniform1i("texWaveNormal",0);a.setUniform1i("texWavePerturbation",1);a.setUniform4f("waveParams",c.waveStrength,c.waveTextureRepeat,c.flowStrength,c.flowOffset);a.setUniform2f("waveDirection",c.waveDirection[0]*c.waveVelocity,c.waveDirection[1]*c.waveVelocity)}})(e=a.WaterDistortion||(a.WaterDistortion={}));var c})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.FoamColor=a.FoamIntensity=void 0;a.FoamIntensity=function(a){a.fragment.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor \x3d  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "],["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor \x3d  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "]))))};
a.FoamColor=function(a){a.fragment.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "],["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "]))))};
var k,e})},"esri/views/3d/webgl-engine/shaders/WaterSurface.glsl":function(){define("require exports tslib ../core/shaderLibrary/ForwardLinearDepth.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/NormalUtils.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/Water.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var C=new t.ShaderBuilder;C.include(e.Transform,{linearDepth:!1});C.attributes.add("position","vec3");C.attributes.add("uv0","vec2");C.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3");C.vertex.uniforms.add("waterColor","vec4");0===a.output&&(C.include(h.NormalUtils,a),C.include(l.ForwardLinearDepth,a),C.varyings.add("vuv","vec2"),C.varyings.add("vpos",
"vec3"),C.varyings.add("vnormal","vec3"),C.varyings.add("vtbnMatrix","mat3"),C.vertex.code.add(p.glsl(u||(u=d.__makeTemplateObject(["\n      void main(void) {\n        if (waterColor.a \x3c ",") {\n          // Discard this vertex\n          gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv \x3d uv0;\n        vpos \x3d position;\n\n        vnormal \x3d getLocalUp(vpos, localOrigin);\n        vtbnMatrix \x3d getTBNMatrix(vnormal);\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "],
["\n      void main(void) {\n        if (waterColor.a \x3c ",") {\n          // Discard this vertex\n          gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv \x3d uv0;\n        vpos \x3d position;\n\n        vnormal \x3d getLocalUp(vpos, localOrigin);\n        vtbnMatrix \x3d getTBNMatrix(vnormal);\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "])),p.glsl.float(g.symbolAlphaCutoff))),C.include(b.WaterDistortion,
a),C.include(k.Slice,a),a.receiveShadows&&C.include(m.ReadShadowMap,a),C.include(f.Water,a),C.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),C.fragment.code.add(p.glsl(q||(q=d.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp \x3d vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam \x3d getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n \x3d normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v \x3d -normalize(vpos - camPos);\n        vec3 l \x3d normalize(-lightingMainDirection);\n        float shadow \x3d ",
";\n        vec4 vPosView \x3d view*vec4(vpos, 1.0);\n        vec4 final \x3d vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor \x3d delinearizeGamma(final);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp \x3d vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam \x3d getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n \x3d normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v \x3d -normalize(vpos - camPos);\n        vec3 l \x3d normalize(-lightingMainDirection);\n        float shadow \x3d ",
";\n        vec4 vPosView \x3d view*vec4(vpos, 1.0);\n        vec4 final \x3d vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor \x3d delinearizeGamma(final);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "])),a.receiveShadows?p.glsl(r||(r=d.__makeTemplateObject(["1.0 - readShadowMap(vpos, linearDepth)"],["1.0 - readShadowMap(vpos, linearDepth)"]))):
"1.0")));2===a.output&&(C.include(h.NormalUtils,a),C.include(b.WaterDistortion,a),C.include(k.Slice,a),C.varyings.add("vpos","vec3"),C.varyings.add("vuv","vec2"),C.vertex.code.add(p.glsl(v||(v=d.__makeTemplateObject(["\n        void main(void) {\n          if (waterColor.a \x3c ",") {\n            // Discard this vertex\n            gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv \x3d uv0;\n          vpos \x3d position;\n\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],
["\n        void main(void) {\n          if (waterColor.a \x3c ",") {\n            // Discard this vertex\n            gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv \x3d uv0;\n          vpos \x3d position;\n\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])),p.glsl.float(g.symbolAlphaCutoff))),C.fragment.uniforms.add("timeElapsed","float"),C.fragment.code.add(p.glsl(w||(w=d.__makeTemplateObject(["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam \x3d getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz \x3d normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor \x3d vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "],
["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam \x3d getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz \x3d normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor \x3d vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "])))));5===a.output&&(C.varyings.add("vpos","vec3"),C.vertex.code.add(p.glsl(z||(z=d.__makeTemplateObject(["\n        void main(void) {\n          if (waterColor.a \x3c ",
") {\n            // Discard this vertex\n            gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos \x3d position;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          if (waterColor.a \x3c ",") {\n            // Discard this vertex\n            gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos \x3d position;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])),
p.glsl.float(g.symbolAlphaCutoff))),C.fragment.uniforms.add("waterColor","vec4"),C.fragment.code.add(p.glsl(x||(x=d.__makeTemplateObject(["\n        void main() {\n          gl_FragColor \x3d waterColor;\n        }\n    "],["\n        void main() {\n          gl_FragColor \x3d waterColor;\n        }\n    "])))));4===a.output&&(C.include(c.OutputHighlight),C.varyings.add("vpos","vec3"),C.vertex.code.add(p.glsl(B||(B=d.__makeTemplateObject(["\n      void main(void) {\n        if (waterColor.a \x3c ",
") {\n          // Discard this vertex\n          gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos \x3d position;\n        gl_Position \x3d transformPosition(proj, view, vpos);\n      }\n    "],["\n      void main(void) {\n        if (waterColor.a \x3c ",") {\n          // Discard this vertex\n          gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos \x3d position;\n        gl_Position \x3d transformPosition(proj, view, vpos);\n      }\n    "])),
p.glsl.float(g.symbolAlphaCutoff))),C.include(k.Slice,a),C.fragment.code.add(p.glsl(A||(A=d.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "])))));return C};var u,r,q,v,w,z,x,B,A})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["require","exports","tslib","../shaderModules/interfaces"],
function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.ForwardLinearDepth=void 0;a.ForwardLinearDepth=function(a,m){0===m.output&&m.receiveShadows?(a.varyings.add("linearDepth","float"),a.vertex.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n      void forwardLinearDepth() { linearDepth \x3d gl_Position.w; }\n    "],["\n      void forwardLinearDepth() { linearDepth \x3d gl_Position.w; }\n    "]))))):1===m.output||3===m.output?(a.varyings.add("linearDepth","float"),a.vertex.uniforms.add("uCameraNearFar",
"vec2"),a.vertex.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n      void forwardLinearDepth() {\n        linearDepth \x3d (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "],["\n      void forwardLinearDepth() {\n        linearDepth \x3d (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "]))))):a.vertex.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n      void forwardLinearDepth() {}\n    "],["\n      void forwardLinearDepth() {}\n    "]))))};
var k,e,c})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.NormalUtils=void 0;a.NormalUtils=function(a,f){1===f.viewingMode?a.vertex.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "])))):
a.vertex.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "]))));1===f.viewingMode?a.vertex.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],
["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "])))):a.vertex.code.add(l.glsl(h||(h=d.__makeTemplateObject(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d vec3(1.0, 0.0, 0.0);\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d vec3(1.0, 0.0, 0.0);\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "]))))};
var k,e,c,h})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("require exports tslib ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../../shaderModules/interfaces".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.Water=void 0;a.Water=function(a,p){a.include(e.PhysicallyBasedRendering,p);a.include(k.Gamma);a.include(l.FoamColor);p.ssrEnabled&&a.include(c.ScreenSpaceReflections,
p);a.fragment.code.add(h.glsl(m||(m=d.__makeTemplateObject(["\n    const vec3 fresnelSky \x3d  vec3(0.02, 1.0, 15.0); // f0, f0max, exp\n    const vec2 fresnelMaterial \x3d  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness \x3d 0.015;\n    const float foamIntensityExternal \x3d 1.7;\n    const float ssrIntensity \x3d 0.65;\n    const float ssrHeightFadeStart \x3d 300000.0;\n    const float ssrHeightFadeEnd \x3d 500000.0;\n    const float waterDiffusion \x3d 0.775;\n    const float waterSeeColorMod \x3d 0.8;\n    const float correctionViewingPowerFactor \x3d 0.4;\n\n    const vec3 skyZenitColor \x3d vec3(0.52, 0.68, 0.90);\n    const vec3 skyColor \x3d vec3(0.67, 0.79, 0.9);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta \x3d is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon \x3d the dominant color of the sky horizon\n    *   @parameter: cosTheta \x3d the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent \x3d pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n \x3d normal facing away from the surface\n    *   @parameter: v \x3d view direction facing away from the surface.\n    *   @parameter: l \x3d light direction facing away from the surface\n    *   @parameter: lightIntensity \x3d light intensity, currently between 0...PI\n    *   @parameter: localUp \x3d a normal for the general direction of the surface\n    *   @parameter: shadow \x3d the amount of shadow at this pixel (0 \x3d no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit \x3d 0.;\n      vec3 seaWaterColor \x3d linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h \x3d normalize(l + v);\n      shadingInfo.NdotL \x3d clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV \x3d clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN \x3d clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH \x3d clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH \x3d clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH \x3d clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV \x3d max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon \x3d linearizeGamma(skyColor);\n      vec3 skyZenit \x3d linearizeGamma(skyZenitColor);\n      vec3 skyColor \x3d getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL \x3d max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod \x3d 0.1 + upDotL * 0.9;\n      skyColor *\x3d daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier \x3d clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier \x3d fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky \x3d fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea \x3d seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular \x3d vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV \x3e 0.0 \x26\x26 upDotL \x3e 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun \x3d brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight \x3d lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular \x3d shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam \x3d vec3(0.0);\n      if(upDotV \x3e 0.0) {\n        foam \x3d foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "],
["\n    const vec3 fresnelSky \x3d  vec3(0.02, 1.0, 15.0); // f0, f0max, exp\n    const vec2 fresnelMaterial \x3d  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness \x3d 0.015;\n    const float foamIntensityExternal \x3d 1.7;\n    const float ssrIntensity \x3d 0.65;\n    const float ssrHeightFadeStart \x3d 300000.0;\n    const float ssrHeightFadeEnd \x3d 500000.0;\n    const float waterDiffusion \x3d 0.775;\n    const float waterSeeColorMod \x3d 0.8;\n    const float correctionViewingPowerFactor \x3d 0.4;\n\n    const vec3 skyZenitColor \x3d vec3(0.52, 0.68, 0.90);\n    const vec3 skyColor \x3d vec3(0.67, 0.79, 0.9);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta \x3d is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon \x3d the dominant color of the sky horizon\n    *   @parameter: cosTheta \x3d the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent \x3d pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n \x3d normal facing away from the surface\n    *   @parameter: v \x3d view direction facing away from the surface.\n    *   @parameter: l \x3d light direction facing away from the surface\n    *   @parameter: lightIntensity \x3d light intensity, currently between 0...PI\n    *   @parameter: localUp \x3d a normal for the general direction of the surface\n    *   @parameter: shadow \x3d the amount of shadow at this pixel (0 \x3d no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit \x3d 0.;\n      vec3 seaWaterColor \x3d linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h \x3d normalize(l + v);\n      shadingInfo.NdotL \x3d clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV \x3d clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN \x3d clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH \x3d clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH \x3d clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH \x3d clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV \x3d max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon \x3d linearizeGamma(skyColor);\n      vec3 skyZenit \x3d linearizeGamma(skyZenitColor);\n      vec3 skyColor \x3d getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL \x3d max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod \x3d 0.1 + upDotL * 0.9;\n      skyColor *\x3d daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier \x3d clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier \x3d fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky \x3d fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea \x3d seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular \x3d vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV \x3e 0.0 \x26\x26 upDotL \x3e 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun \x3d brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight \x3d lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular \x3d shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam \x3d vec3(0.0);\n      if(upDotV \x3e 0.0) {\n        foam \x3d foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "]))));
p.ssrEnabled?a.fragment.code.add(h.glsl(f||(f=d.__makeTemplateObject(["\n      // Convert the world position to view position\n      vec4 viewPosition \x3d vec4(positionView.xyz, 1.0);\n      vec3 viewDir \x3d normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate \x3d ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal \x3d normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp \x3d ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor \x3d pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected \x3d mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected \x3d normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate \x3d screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor \x3d vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z \x3e 0.0)\n      {\n        vec2 reprojectedCoordinate \x3d reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords \x3d smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod \x3d smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit \x3d waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor \x3d linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod \x3d  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "],
["\n      // Convert the world position to view position\n      vec4 viewPosition \x3d vec4(positionView.xyz, 1.0);\n      vec3 viewDir \x3d normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate \x3d ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal \x3d normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp \x3d ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor \x3d pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected \x3d mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected \x3d normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate \x3d screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor \x3d vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z \x3e 0.0)\n      {\n        vec2 reprojectedCoordinate \x3d reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords \x3d smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod \x3d smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit \x3d waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor \x3d linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod \x3d  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "])))):
a.fragment.code.add(h.glsl(b||(b=d.__makeTemplateObject(["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "],["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "]))))};var m,f,b})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.Gamma=void 0;a.Gamma=function(a){a.fragment.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    const float GAMMA \x3d 2.2;\n    const float INV_GAMMA \x3d 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "],["\n    const float GAMMA \x3d 2.2;\n    const float INV_GAMMA \x3d 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "]))))};
var k})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define("require exports tslib ./AnalyticalSkyModel.glsl ./PiUtils.glsl ../../shaderModules/interfaces".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.PhysicallyBasedRendering=void 0;a.PhysicallyBasedRendering=function(a,w){var v=a.fragment.code;a.include(k.PiUtils);if(3===w.pbrMode||4===w.pbrMode)v.add(e.glsl(c||(c=d.__makeTemplateObject(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent \x3d ",
";\n    "],["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent \x3d ",
";\n    "])),w.useCustomDTRExponentForWater?"2.2":"2.0")),v.add(e.glsl(h||(h=d.__makeTemplateObject(["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "],["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "])))),v.add(e.glsl(m||(m=d.__makeTemplateObject(["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 \x3d roughness * roughness;\n      float NdotH2 \x3d NdotH * NdotH;\n      float denom \x3d pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "],
["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 \x3d roughness * roughness;\n      float NdotH2 \x3d NdotH * NdotH;\n      float denom \x3d pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "])))),v.add(e.glsl(f||(f=d.__makeTemplateObject(["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "],["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "])))),
v.add(e.glsl(b||(b=d.__makeTemplateObject(["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F \x3d fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun \x3d normalDistributionWater(props.NdotH, roughness);\n      float V \x3d geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze \x3d mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  \x3d 1.2;\n      float dSunHaze \x3d normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "],
["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F \x3d fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun \x3d normalDistributionWater(props.NdotH, roughness);\n      float V \x3d geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze \x3d mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  \x3d 1.2;\n      float dSunHaze \x3d normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "]))));
else if(1===w.pbrMode||2===w.pbrMode)a.include(l.AnalyticalSkyModel),v.add(e.glsl(g||(g=d.__makeTemplateObject(["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "],
["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "])))),
v.add(e.glsl(p||(p=d.__makeTemplateObject(["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a \x3d NdotH * roughness;\n        float b \x3d roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "],["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a \x3d NdotH * roughness;\n        float b \x3d roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "])))),v.add(e.glsl(t||
(t=d.__makeTemplateObject(["\n    const vec4 c0 \x3d vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 \x3d vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 \x3d vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r \x3d roughness * c0 + c1;\n        float a004 \x3d min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "],["\n    const vec4 c0 \x3d vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 \x3d vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 \x3d vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r \x3d roughness * c0 + c1;\n        float a004 \x3d min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "])))),
v.add(e.glsl(u||(u=d.__makeTemplateObject(["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse \x3d evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular \x3d evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent \x3d inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg \x3d prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor \x3d inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent \x3d specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "],
["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse \x3d evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular \x3d evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent \x3d inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg \x3d prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor \x3d inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent \x3d specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "])))),
v.add(e.glsl(r||(r=d.__makeTemplateObject(["\n    float gamutMapChanel(float x, vec2 p){\n      return (x \x3c p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"],["\n    float gamutMapChanel(float x, vec2 p){\n      return (x \x3c p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"])))),v.add(e.glsl(q||(q=d.__makeTemplateObject(["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p \x3d vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x \x3d gamutMapChanel(inColor.x, p) ;\n      outColor.y \x3d gamutMapChanel(inColor.y, p) ;\n      outColor.z \x3d gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "],
["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p \x3d vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x \x3d gamutMapChanel(inColor.x, p) ;\n      outColor.y \x3d gamutMapChanel(inColor.y, p) ;\n      outColor.z \x3d gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "]))))};var c,h,m,f,b,g,p,t,u,r,q})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.AnalyticalSkyModel=void 0;a.AnalyticalSkyModel=function(a){a=a.fragment.code;a.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "]))));
a.add(l.glsl(e||(e=d.__makeTemplateObject(["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "],["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "]))));a.add(l.glsl(c||(c=d.__makeTemplateObject(["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 \x3d 1.0 - RdotNG * RdotNG;\n      float intRadTheta \x3d integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground \x3d RdotNG \x3c 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky \x3d 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "],
["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 \x3d 1.0 - RdotNG * RdotNG;\n      float intRadTheta \x3d integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground \x3d RdotNG \x3c 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky \x3d 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "]))))};
var k,e,c})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/mat4","../../../../../core/libs/gl-matrix-2/mat4f64"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.addOrMerge=a.sortInstancesAccordingToRange=a.Instance=void 0;n=function(){return function(a,e,c,h,m,f){this.from=a;this.to=e;this.isVisible=c;this.hasHighlights=h;this.hasOccludees=m;this.transformation=f;null!=f&&(this.transformationNormal=
l.mat4f64.clone(f),d.mat4.invert(this.transformationNormal,this.transformationNormal),d.mat4.transpose(this.transformationNormal,this.transformationNormal))}}();a.Instance=n;a.sortInstancesAccordingToRange=function(a){return a.sort(function(a,c){return a.from===c.from?a.to>c.to?1:a.to<c.to?-1:0:a.from>c.from?1:a.from<c.from?-1:0})};a.addOrMerge=function(a,d){if(0===a.length)a.push({first:d.from,count:d.to-d.from});else{var c=a[a.length-1],e;e=c.first+c.count>=d.from?!0:!1;e?c.count=d.from-c.first+
d.to-d.from:a.push({first:d.from,count:d.to-d.from})}}})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports tslib ../core/shaderLibrary/util/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,
"__esModule",{value:!0});a.TextureTechniqueConfiguration=a.TextureTechnique=void 0;e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype.initializeProgram=function(a){var c=b.shader.get().build();return new m(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),h.Default3D)};b.prototype.initializePipeline=function(){return this.configuration.hasAlpha?f.makePipelineState({blending:f.separateBlendingParams(770,1,771,771),colorWrite:f.defaultColorWriteParams}):
f.makePipelineState({colorWrite:f.defaultColorWriteParams})};b.shader=new k.ReloadableShaderModule(l,function(){return new Promise(function(a,b){n(["../core/shaderLibrary/util/TextureOnly.glsl"],a,b)})});return b}(e.ShaderTechnique);a.TextureTechnique=e;e=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.hasAlpha=!1;return b}d.__extends(b,a);d.__decorate([c.parameter()],b.prototype,"hasAlpha",void 0);return b}(c.ShaderTechniqueConfiguration);a.TextureTechniqueConfiguration=
e})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureOnly.glsl":function(){define("require exports tslib ../ScreenSpacePass ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(){var a=new e.ShaderBuilder;a.include(l.ScreenSpacePass);a.fragment.uniforms.add("tex","sampler2D");a.fragment.uniforms.add("color","vec4");a.fragment.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n    void main() {\n      vec4 texColor \x3d texture2D(tex, uv);\n      gl_FragColor \x3d texColor * color;\n    }\n  "],
["\n    void main() {\n      vec4 texColor \x3d texture2D(tex, uv);\n      gl_FragColor \x3d texColor * color;\n    }\n  "]))));return a};var c})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":function(){define(["require","exports","tslib","../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.ScreenSpacePass=void 0;a.ScreenSpacePass=function(a){a.attributes.add("position","vec2");a.varyings.add("uv","vec2");a.vertex.code.add(l.glsl(k||
(k=d.__makeTemplateObject(["\n    void main(void) {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      uv \x3d position * 0.5 + vec2(0.5);\n    }\n  "],["\n    void main(void) {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      uv \x3d position * 0.5 + vec2(0.5);\n    }\n  "]))))};var k})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","./SphericalHarmonics"],
function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.SceneLighting=void 0;var e=l.vec3f64.create();n=function(){function a(){this._renderLighting={main:{intensity:l.vec3f64.create(),direction:l.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldSunlight={direction:l.vec3f64.create(),ambient:{color:l.vec3f64.create(),intensity:0},diffuse:{color:l.vec3f64.create(),intensity:0}}}a.prototype.setLightDirectionUniform=function(a){a.setUniform3fv("lightingMainDirection",
this._renderLighting.main.direction)};a.prototype.setUniforms=function(a,c){void 0===c&&(c=!1);c?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",this._info.globalFactor);this.setLightDirectionUniform(a);a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",.4);c=this._renderLighting.sphericalHarmonics.sh;0===
this._shOrder?a.setUniform3f("lightingAmbientSH0",c.r[0],c.g[0],c.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",c.r[0],c.r[1],c.r[2],c.r[3]),a.setUniform4f("lightingAmbientSH_G",c.g[0],c.g[1],c.g[2],c.g[3]),a.setUniform4f("lightingAmbientSH_B",c.b[0],c.b[1],c.b[2],c.b[3])):2===this._shOrder&&(a.setUniform3f("lightingAmbientSH0",c.r[0],c.g[0],c.b[0]),a.setUniform4f("lightingAmbientSH_R1",c.r[1],c.r[2],c.r[3],c.r[4]),a.setUniform4f("lightingAmbientSH_G1",c.g[1],c.g[2],c.g[3],c.g[4]),
a.setUniform4f("lightingAmbientSH_B1",c.b[1],c.b[2],c.b[3],c.b[4]),a.setUniform4f("lightingAmbientSH_R2",c.r[5],c.r[6],c.r[7],c.r[8]),a.setUniform4f("lightingAmbientSH_G2",c.g[5],c.g[6],c.g[7],c.g[8]),a.setUniform4f("lightingAmbientSH_B2",c.b[5],c.b[6],c.b[7],c.b[8]))};a.prototype.set=function(a){this._info=a;k.combineLights(a.lights,this._shOrder,this._renderLighting);d.vec3.negate(this._oldSunlight.direction,this._renderLighting.main.direction);a=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*
this._renderLighting.sphericalHarmonics.sh.r[0]*a;this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*a;this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*a;this._oldSunlight.ambient.intensity=1;this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*a;this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*a;this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*a;
this._oldSunlight.diffuse.intensity=1;a=d.vec3.copy(e,this._oldSunlight.diffuse.color);d.vec3.scale(a,a,.4*this._info.globalFactor);d.vec3.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,a)};Object.defineProperty(a.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"old",{get:function(){return this._oldSunlight},enumerable:!1,configurable:!0});return a}();a.SceneLighting=n})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),
function(n,a,d,l,k,e,c){function h(a){return(a+1)*(a+1)}function m(a){return d.clamp(Math.floor(Math.sqrt(a)-1),0,2)}function f(a,b,c){var d=a[0],e=a[1];a=a[2];c=c||[];c.length=h(b);0<=b&&(c[0]=.28209479177);1<=b&&(c[1]=.4886025119*d,c[2]=.4886025119*a,c[3]=.4886025119*e);2<=b&&(c[4]=1.09254843059*d*e,c[5]=1.09254843059*e*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*d*a,c[8]=.54627421529*(d*d-e*e));return c}function b(a,b){a=h(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=
0;c<a;c++)b.r[c]=b.g[c]=b.b[c]=0;return b}function g(a,b){for(var c=m(b.r.length),d=0;d<a.length;d++){var g=a[d];l.vec3.negate(w,g.direction);f(w,c,q);e.elementwiseProduct(q,z);e.scalarProduct(q,g.intensity[0],v);e.add(b.r,v);e.scalarProduct(q,g.intensity[1],v);e.add(b.g,v);e.scalarProduct(q,g.intensity[2],v);e.add(b.b,v)}return b}function p(a,b){f(w,0,q);for(var c=0;c<a.length;c++){var d=a[c];b.r[0]+=q[0]*z[0]*d.intensity[0]*4*Math.PI;b.g[0]+=q[0]*z[0]*d.intensity[1]*4*Math.PI;b.b[0]+=q[0]*z[0]*
d.intensity[2]*4*Math.PI}return b}Object.defineProperty(a,"__esModule",{value:!0});a.combineLights=a.projectAmbientLights=a.projectFillLights=a.initSHCoefficients=a.computeCoefficients=a.orderFromNumberOfCoefficients=a.numberOfCoefficientsInBand=a.numberOfCoefficients=void 0;a.numberOfCoefficients=h;a.numberOfCoefficientsInBand=function(a){return 2*a+1};a.orderFromNumberOfCoefficients=m;a.computeCoefficients=f;a.initSHCoefficients=b;a.projectFillLights=g;a.projectAmbientLights=p;a.combineLights=function(a,
d,f){b(d,f.sphericalHarmonics.sh);l.vec3.set(f.main.intensity,0,0,0);var h=!1,m=t,k=u;d=r;m.length=0;k.length=0;for(var q=d.length=0;q<a.length;q++){var v=a[q];v instanceof c.MainLight&&!h?(l.vec3.copy(f.main.direction,v.direction),f.main.intensity[0]=v.intensity[0],f.main.intensity[1]=v.intensity[1],f.main.intensity[2]=v.intensity[2],f.main.castShadows=v.castShadows,h=!0):v instanceof c.MainLight||v instanceof c.FillLight?m.push(v):v instanceof c.AmbientLight?k.push(v):v instanceof c.SphericalHarmonicsLight&&
d.push(v)}g(m,f.sphericalHarmonics.sh);p(k,f.sphericalHarmonics.sh);for(a=0;a<d.length;a++)v=d[a],e.add(f.sphericalHarmonics.sh.r,v.sh.r),e.add(f.sphericalHarmonics.sh.g,v.sh.g),e.add(f.sphericalHarmonics.sh.b,v.sh.b)};var t=[],u=[],r=[],q=[0],v=[0],w=k.vec3f64.create(),z=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});
a.add=a.scalarProduct=a.elementwiseProduct=a.dotProduct=void 0;a.dotProduct=function(a,l){for(var d=0,e=0;e<a.length;e++)d+=a[e]*l[e];return d};a.elementwiseProduct=function(a,l,k){k=k||a;k.length=a.length;for(var d=0;d<a.length;d++)k[d]=a[d]*l[d];return k};a.scalarProduct=function(a,l,k){k=k||a;k.length=a.length;for(var d=0;d<a.length;d++)k[d]=a[d]*l;return k};a.add=function(a,l,k){k=k||a;k.length=a.length;for(var d=0;d<a.length;d++)k[d]=a[d]+l[d];return k}})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["require",
"exports","../../../../core/maybe","../../../webgl"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.createStipplePatternSimple=a.createStipplePattern=a.StippleTextureRepository=void 0;n=function(){function a(){this.cache=new Map}a.prototype.dispose=function(){this.cache.forEach(function(a){d.isSome(a.texture)&&(a.texture.dispose(),a.texture=null)});this.cache.clear()};a.prototype.acquire=function(a){if(d.isNone(a))return null;var c=this.patternId(a),e=this.cache.get(c);if(e)return e.refCount++,
e.bind;var m=this.patternToTextureData(a,2),f=m.length/2,b={refCount:1,texture:null,bind:function(a,c){d.isNone(b.texture)&&(b.texture=new l.Texture(a,{width:m.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},m));a.bindTexture(b.texture,c);return f}};this.cache.set(c,b);return b.bind};a.prototype.release=function(a){if(!d.isNone(a)){a=this.patternId(a);var c=this.cache.get(a);c&&(c.refCount--,0===c.refCount&&(d.isSome(c.texture)&&c.texture.dispose(),this.cache.delete(a)))}};
a.prototype.swap=function(a,c){c=this.acquire(c);this.release(a);return c};a.prototype.patternId=function(a){return a.join(",")};a.prototype.patternToTextureData=function(a,c){for(var d=a.reduce(function(a,b){return a+b})*c,d=new Uint8Array(d),e=!0,f=0,b=0;b<a.length;b++){for(var g=a[b],k=0;k<g*c;k++)d[f++]=e?255:0;e=!e}return d};return a}();a.StippleTextureRepository=n;a.createStipplePattern=function(a){return d.isNone(a)?a:a.slice()};a.createStipplePatternSimple=function(a){return[a,a]}})},"esri/views/3d/layers/support/edgeUtils":function(){define("require exports tslib ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),
function(n,a,d,l,k,e,c,h){function m(a,b){if(e.isNone(a))return null;var m=e.isSome(a.color)?h.vec4f64.fromArray(l.toUnitRGBA(a.color)):h.vec4f64.fromValues(0,0,0,0),p=c.pt2px(a.size),t=c.pt2px(a.extensionLength);switch(a.type){case "solid":return f(d.__assign({color:m,size:p,extensionLength:t},b));case "sketch":return a=d.__assign({color:m,size:p,extensionLength:t},b),d.__assign(d.__assign(d.__assign({},g),a),{type:"sketch"});default:k.neverReached(a)}}function f(a){return d.__assign(d.__assign(d.__assign({},
b),a),{type:"solid"})}Object.defineProperty(a,"__esModule",{value:!0});a.createSolidEdgeMaterial=a.createMaterialFromEdges=a.createMaterial=void 0;a.createMaterial=function(a,b){return m(a&&a.enabled&&a.edges||null,b)};a.createMaterialFromEdges=m;a.createSolidEdgeMaterial=f;var b={color:h.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},g={color:h.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2}})},"esri/views/3d/support/buffer/math/vec3":function(){define(["require",
"exports","./common"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.shiftRight=a.scale=a.transformMat3=a.transformMat4=void 0;a.transformMat4=function(a,k,e){if(a.count!==k.count)d.logger.error("source and destination buffers need to have the same number of elements");else{var c=a.count,h=e[0],m=e[1],f=e[2],b=e[4],g=e[5],p=e[6],l=e[8],u=e[9],r=e[10],q=e[12],v=e[13];e=e[14];var w=a.typedBuffer;a=a.typedBufferStride;var z=k.typedBuffer;k=k.typedBufferStride;for(var x=0;x<c;x++){var B=
x*a,A=x*k,C=z[A],E=z[A+1],A=z[A+2];w[B]=h*C+b*E+l*A+q;w[B+1]=m*C+g*E+u*A+v;w[B+2]=f*C+p*E+r*A+e}}};a.transformMat3=function(a,k,e){if(a.count!==k.count)d.logger.error("source and destination buffers need to have the same number of elements");else{var c=a.count,h=e[0],m=e[1],f=e[2],b=e[3],g=e[4],p=e[5],l=e[6],u=e[7];e=e[8];var r=a.typedBuffer;a=a.typedBufferStride;var q=k.typedBuffer;k=k.typedBufferStride;for(var v=0;v<c;v++){var w=v*a,z=v*k,x=q[z],B=q[z+1],z=q[z+2];r[w]=h*x+b*B+l*z;r[w+1]=m*x+g*B+
u*z;r[w+2]=f*x+p*B+e*z}}};a.scale=function(a,d,e){var c=Math.min(a.count,d.count),h=a.typedBuffer;a=a.typedBufferStride;var m=d.typedBuffer;d=d.typedBufferStride;for(var f=0;f<c;f++){var b=f*a,g=f*d;h[b]=e*m[g];h[b+1]=e*m[g+1];h[b+2]=e*m[g+2]}};a.shiftRight=function(a,d,e){var c=Math.min(a.count,d.count),h=a.typedBuffer;a=a.typedBufferStride;var m=d.typedBuffer;d=d.typedBufferStride;for(var f=0;f<c;f++){var b=f*a,g=f*d;h[b]=m[g]>>e;h[b+1]=m[g+1]>>e;h[b+2]=m[g+2]>>e}}})},"esri/views/3d/support/buffer/math/common":function(){define(["require",
"exports","../../../../../core/Logger"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.logger=void 0;a.logger=d.getLogger("esri.views.3d.support.buffer.math")})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/util/AlphaDiscard.glsl ../lib/GLMaterialTexture ../lib/intersectorUtils ../lib/Material ../lib/StencilUtils ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/RealisticTreeTechnique ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w){var z=p.assert;n=function(a){function b(c,d){d=a.call(this,d)||this;d.supportsEdges=!0;d.techniqueConfig=new r.DefaultMaterialTechniqueConfiguration;d.params=u.copyParameters(c,B);d.vertexBufferLayout=b.getVertexBufferLayout(d.params);d.instanceBufferLayout=c.instanced?b.getInstanceBufferLayout(d.params):null;return d}d.__extends(b,a);b.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};b.prototype.isVisible=function(){var b=
this.params;if(!a.prototype.isVisible.call(this)||0===b.layerOpacity)return!1;var c=b.instanced,d=b.vertexColors,e=b.symbolColors,c=!!c&&-1<c.indexOf("color"),f=b.vvColorEnabled,g="replace"===b.colorMixMode,h=0<b.opacity,b=b.externalColor&&0<b.externalColor[3];return d&&(c||f||e)?g?!0:h:d?g?b:h:c||f||e?g?!0:h:g?b:h};b.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)"instanced"===c&&z(a.instanced===b.instanced,"Can not change instanced attributes"),"textureId"===c&&z(b.textureId,
"Can only change texture of material that already has a texture"),"vertexColors"===c&&!0===a[c]&&a[c]!==b[c]&&z(b.vertexColors,"Can not enable vertex colors after DefaultMaterial creation"),b[c]=a[c];this.parametersChanged()};b.prototype.getParameters=function(){return this.params};b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.params.textureId;this.techniqueConfig.vertexTangents=
this.params.vertexTangents;this.techniqueConfig.instanced=!!this.params.instanced;this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled;
this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode;this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals?!0:!1;0===a&&(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.params.treeRendering||(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0),this.techniqueConfig.instancedColor=
!!this.params.instanced&&-1<this.params.instanced.indexOf("color"),this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,
this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic);return this.techniqueConfig};b.prototype.intersect=function(a,b,c,d,e,g,h){if(null!==this.params.verticalOffset){var m=d.camera;k.vec3.set(I,c[12],c[13],c[14]);c=null;switch(d.viewingMode){case 1:c=
k.vec3.normalize(H,I);break;case 2:c=k.vec3.copy(H,F)}var p=0;if(null!==this.params.verticalOffset){var l=k.vec3.subtract(K,I,m.eye),r=k.vec3.length(l),l=k.vec3.scale(l,l,1/r),t=null;this.params.screenSizePerspective&&(t=k.vec3.dot(c,l));p+=u.verticalOffsetAtDistance(m,r,this.params.verticalOffset,t,this.params.screenSizePerspective)}k.vec3.scale(c,c,p);k.vec3.transformMat3(J,c,d.transform.inverseRotation);e=k.vec3.subtract(E,e,J);g=k.vec3.subtract(G,g,J)}u.intersectTriangleGeometry(a,b,d,e,g,f.getVerticalOffsetObject3D(d.verticalOffset),
h)};b.prototype.getGLMaterial=function(a){if(0===a.output||1===a.output||2===a.output||3===a.output||4===a.output)return new x(a)};b.prototype.createBufferWriter=function(){return new A(this.vertexBufferLayout,this.instanceBufferLayout)};b.getVertexBufferLayout=function(a){var b=a.textureId||a.normalTextureId||a.metallicRoughnessTextureId||a.emissiveTextureId||a.occlusionTextureId,d=c.newLayout().vec3f("position").vec3f("normal");a.vertexTangents&&d.vec4f("tangent");b&&d.vec2f("uv0");a.vertexColors&&
d.vec4u8("color");a.symbolColors&&d.vec4u8("symbolColor");return d};b.getInstanceBufferLayout=function(a){var b=c.newLayout(),b=a.instancedDoublePrecision?b.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):b.mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&(b=b.vec4f("instanceColor"));a.instanced&&-1<a.instanced.indexOf("featureAttribute")&&(b=b.vec4f("instanceFeatureAttribute"));return b};return b}(b.Material);var x=function(a){function b(b){var c=
this,c=b.material,c=a.call(this,d.__assign(d.__assign({},b),c.getParameters()))||this;c.updateParameters();return c}d.__extends(b,a);b.prototype.updateParameters=function(){this.selectPipelines();this.selectSlot();var a=this.material.getParameters();this.updateTexture(a.textureId);this.technique=a.treeRendering?this.techniqueRep.acquireAndReleaseExisting(q.RealisticTreeTechnique,this.material.getTechniqueConfig(this.output),this.technique):this.techniqueRep.acquireAndReleaseExisting(r.DefaultMaterialTechnique,
this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.selectSlot=function(){this.slot=this.material.getParameters().transparent?this.material.getParameters().writeDepth?5:8:3};b.prototype.selectPipelines=function(){var a=this.material.getParameters(),b=0===this.output?a.transparent&&v.separateBlendingParams(770,1,771,771):null,c=function(c){return w.makePipelineState({blending:b,culling:C(a),depthTest:{func:513},depthWrite:a.writeDepth&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams,
stencilWrite:a.sceneHasOcludees?g.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?c?g.stencilToolMaskBaseParams:g.stencilBaseAllZerosParams:null})};this.pipelineState=c(!1);this.occludeePipelineState=c(!0)};b.prototype._updateShadowState=function(a){a.shadowMappingEnabled!==this.material.getParameters().shadowMappingEnabled&&(this.material.setParameterValues({shadowMappingEnabled:a.shadowMappingEnabled}),this.updateParameters())};b.prototype._updateOccludeeState=function(a){a.hasOccludees!==
this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype.ensureParameters=function(a){0===this.output&&(this._updateShadowState(a),this._updateOccludeeState(a))};b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getParameters(),b);this.bindTexture(a,this.technique.program)};b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getPipelineState=
function(a,b){return b?this.occludeePipelineState:this.pipelineState};return b}(m);(n||(n={})).COLOR_GAMMA=2.1;var B={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,
doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,
1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:l.mat3f64.create(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:h.defaultMaskAlphaCutoff,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},A=function(){function a(a,b){this.vertexBufferLayout=a;this.instanceBufferLayout=b}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices.position.length};a.prototype.write=
function(a,b,c,d){t.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,c,d)};return a}(),C=function(a){var b;b=a.cullFace?0!==a.cullFace:a.slicePlaneEnabled?!1:!a.transparent&&!a.doubleSided;return b&&{face:1===a.cullFace?1028:1029,mode:2305}},E=e.vec3f64.create(),G=e.vec3f64.create(),F=e.vec3f64.fromValues(0,0,1),H=e.vec3f64.create(),J=e.vec3f64.create(),I=e.vec3f64.create(),K=e.vec3f64.create();return n})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/vec3f64 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../materials/internal/MaterialUtil ./DefaultMaterial.glsl ../../../webgl/Program @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z){Object.defineProperty(a,"__esModule",{value:!0});a.DefaultMaterialTechniqueConfiguration=a.DefaultMaterialTechnique=void 0;u=function(a){function r(){return null!==a&&a.apply(this,arguments)||this}d.__extends(r,a);r.prototype.initializeProgram=function(a){var b=r.shader.get(),c=this.configuration,b=b.build({output:c.output,viewingMode:a.viewingMode,receiveShadows:c.receiveShadows,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:c.sliceHighlightDisabled,
sliceEnabledForVertexPrograms:!1,symbolColor:c.symbolColors,vvSize:c.vvSize,vvColor:c.vvColor,vvInstancingEnabled:!0,instanced:c.instanced,instancedColor:c.instancedColor,instancedDoublePrecision:c.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:c.usePBR?c.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:c.hasMetalnessAndRoughnessTexture,hasEmissionTexture:c.hasEmissionTexture,hasOcclusionTexture:c.hasOcclusionTexture,hasNormalTexture:c.hasNormalTexture,hasColorTexture:c.hasColorTexture,
receiveAmbientOcclusion:c.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:c.normalsTypeDerivate?3:0,doubleSidedMode:c.doubleSidedMode,vertexTangets:c.vertexTangents,attributeTextureCoordinates:c.hasMetalnessAndRoughnessTexture||c.hasEmissionTexture||c.hasOcclusionTexture||c.hasNormalTexture||c.hasColorTexture?1:0,textureAlphaPremultiplied:c.textureAlphaPremultiplied,attributeColor:c.vertexColors,screenSizePerspectiveEnabled:c.screenSizePerspective,verticalOffsetEnabled:c.verticalOffset,
offsetBackfaces:c.offsetBackfaces,doublePrecisionRequiresObfuscation:g.doublePrecisionRequiresObfuscation(a.rctx),alphaDiscardMode:c.alphaDiscardMode,supportsTextureAtlas:!1});return new z(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),q.Default3D)};r.prototype.bindPass=function(a,d,e){p.View.bindProjectionMatrix(this.program,e.camera.projectionMatrix);var f=this.configuration.output;0===f?(e.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",d.ambient),this.program.setUniform3fv("diffuse",
d.diffuse),this.program.setUniform4fv("externalColor",d.externalColor),this.program.setUniform1i("colorMixMode",v.colorMixModes[d.colorMixMode]),this.program.setUniform1f("opacity",d.opacity),this.program.setUniform1f("layerOpacity",d.layerOpacity),this.configuration.usePBR&&m.PhysicallyBasedRenderingParameters.bindUniforms(this.program,d,this.configuration.isSchematic)):1===f||3===f?this.program.setUniform2fv("nearFar",e.camera.nearFar):4===f&&h.OutputHighlight.bindOutputHighlight(a,this.program,
e);b.VisualVariables.bindUniformsForSymbols(this.program,d);c.VerticalOffset.bindUniforms(this.program,d,e);v.bindScreenSizePerspective(d.screenSizePerspective,this.program,"screenSizePerspectiveAlignment");2!==d.textureAlphaMode&&3!==d.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",d.textureAlphaCutoff)};r.prototype.bindDraw=function(a){var b=this.configuration.instancedDoublePrecision?l.vec3f64.fromValues(a.camera.viewInverseTransposeMatrix[3],a.camera.viewInverseTransposeMatrix[7],
a.camera.viewInverseTransposeMatrix[11]):a.origin;p.View.bindViewCustomOrigin(this.program,b,a.camera.viewMatrix);(0===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&p.View.bindCamPosition(this.program,b,a.camera.viewInverseTransposeMatrix);2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",
a.camera.viewInverseTransposeMatrix);this.configuration.instancedDoublePrecision&&e.InstancedDoublePrecision.bindCustomOrigin(this.program,b);k.Slice.bindUniforms(this.program,this.configuration,a.slicePlane,b);0===this.configuration.output&&f.ReadShadowMap.bindViewCustomOrigin(this.program,a,b)};r.prototype.initializePipeline=function(){return null};r.shader=new t.ReloadableShaderModule(w,function(){return new Promise(function(a,b){n(["./DefaultMaterial.glsl"],a,b)})});return r}(u.ShaderTechnique);
a.DefaultMaterialTechnique=u;u=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.alphaDiscardMode=1;b.doubleSidedMode=0;b.isSchematic=!1;b.vertexColors=!1;b.offsetBackfaces=!1;b.symbolColors=!1;b.vvSize=!1;b.vvColor=!1;b.verticalOffset=!1;b.receiveShadows=!1;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.receiveAmbientOcclusion=!1;b.screenSizePerspective=!1;b.textureAlphaPremultiplied=!1;b.hasColorTexture=!1;b.usePBR=!1;b.hasMetalnessAndRoughnessTexture=!1;
b.hasEmissionTexture=!1;b.hasOcclusionTexture=!1;b.hasNormalTexture=!1;b.instanced=!1;b.instancedColor=!1;b.instancedDoublePrecision=!1;b.vertexTangents=!1;b.normalsTypeDerivate=!1;return b}d.__extends(b,a);d.__decorate([r.parameter({count:7})],b.prototype,"output",void 0);d.__decorate([r.parameter({count:4})],b.prototype,"alphaDiscardMode",void 0);d.__decorate([r.parameter({count:3})],b.prototype,"doubleSidedMode",void 0);d.__decorate([r.parameter()],b.prototype,"isSchematic",void 0);d.__decorate([r.parameter()],
b.prototype,"vertexColors",void 0);d.__decorate([r.parameter()],b.prototype,"offsetBackfaces",void 0);d.__decorate([r.parameter()],b.prototype,"symbolColors",void 0);d.__decorate([r.parameter()],b.prototype,"vvSize",void 0);d.__decorate([r.parameter()],b.prototype,"vvColor",void 0);d.__decorate([r.parameter()],b.prototype,"verticalOffset",void 0);d.__decorate([r.parameter()],b.prototype,"receiveShadows",void 0);d.__decorate([r.parameter()],b.prototype,"slicePlaneEnabled",void 0);d.__decorate([r.parameter()],
b.prototype,"sliceHighlightDisabled",void 0);d.__decorate([r.parameter()],b.prototype,"receiveAmbientOcclusion",void 0);d.__decorate([r.parameter()],b.prototype,"screenSizePerspective",void 0);d.__decorate([r.parameter()],b.prototype,"textureAlphaPremultiplied",void 0);d.__decorate([r.parameter()],b.prototype,"hasColorTexture",void 0);d.__decorate([r.parameter()],b.prototype,"usePBR",void 0);d.__decorate([r.parameter()],b.prototype,"hasMetalnessAndRoughnessTexture",void 0);d.__decorate([r.parameter()],
b.prototype,"hasEmissionTexture",void 0);d.__decorate([r.parameter()],b.prototype,"hasOcclusionTexture",void 0);d.__decorate([r.parameter()],b.prototype,"hasNormalTexture",void 0);d.__decorate([r.parameter()],b.prototype,"instanced",void 0);d.__decorate([r.parameter()],b.prototype,"instancedColor",void 0);d.__decorate([r.parameter()],b.prototype,"instancedDoublePrecision",void 0);d.__decorate([r.parameter()],b.prototype,"vertexTangents",void 0);d.__decorate([r.parameter()],b.prototype,"normalsTypeDerivate",
void 0);return b}(r.ShaderTechniqueConfiguration);a.DefaultMaterialTechniqueConfiguration=u})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("require exports tslib ../../../../../../core/libs/gl-matrix-2/vec3f64 ../util/DoublePrecision.glsl ../../shaderModules/interfaces ../../../lib/doublePrecisionUtils".split(" "),function(n,a,d,l,k,e,c){function h(a,c){c.instanced&&c.instancedDoublePrecision&&(a.attributes.add("modelOriginHi","vec3"),
a.attributes.add("modelOriginLo","vec3"),a.attributes.add("model","mat3"),a.attributes.add("modelNormal","mat3"));c.instancedDoublePrecision&&(a.vertex.include(k.DoublePrecision,c),a.vertex.uniforms.add("viewOriginHi","vec3"),a.vertex.uniforms.add("viewOriginLo","vec3"));var f=[e.glsl(b||(b=d.__makeTemplateObject(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "],["\n    vec3 calculateVPos() {\n      ","\n    }\n    "])),c.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"),
e.glsl(p||(p=d.__makeTemplateObject(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "],["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),c.instancedDoublePrecision?e.glsl(g||(g=d.__makeTemplateObject(["\n          vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"],["\n          vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):
"return vpos;"),e.glsl(t||(t=d.__makeTemplateObject(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "],["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),c.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"),e.glsl(u||(u=d.__makeTemplateObject(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "],["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),c.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":
"return normalize((viewNormal * _normal).xyz);"),c.vertexTangets?e.glsl(r||(r=d.__makeTemplateObject(["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n\n    }\n    "],["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n\n    }\n    "])),c.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"):e.glsl(q||(q=d.__makeTemplateObject([""],[""])))];a.vertex.code.add(f[0]);a.vertex.code.add(f[1]);a.vertex.code.add(f[2]);2===c.output&&
a.vertex.code.add(f[3]);a.vertex.code.add(f[4])}Object.defineProperty(a,"__esModule",{value:!0});a.InstancedDoublePrecision=void 0;a.InstancedDoublePrecision=h;(function(a){var b=function(){return function(){}}();a.Uniforms=b;a.bindCustomOrigin=function(a,b){c.encodeDoubleArraySplit(b,m,f,3);a.setUniform3fv("viewOriginHi",m);a.setUniform3fv("viewOriginLo",f)}})(h=a.InstancedDoublePrecision||(a.InstancedDoublePrecision={}));var m=l.vec3f64.create(),f=l.vec3f64.create(),b,g,p,t,u,r,q})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define("require exports tslib ../../../../../../core/has ../../shaderModules/interfaces ../../../lib/WebGLDriverTest".split(" "),
function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.doublePrecisionRequiresObfuscation=a.DoublePrecision=void 0;a.DoublePrecision=function(a,e){a=a.code;e.doublePrecisionRequiresObfuscation?a.add(k.glsl(c||(c=d.__makeTemplateObject(["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n        vec3 e \x3d dpMinusFrc(t1, hiA);\n        vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "],
["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n        vec3 e \x3d dpMinusFrc(t1, hiA);\n        vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "])))):
a.add(k.glsl(h||(h=d.__makeTemplateObject(["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d hiA + hiB;\n        vec3 e \x3d t1 - hiA;\n        vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "],["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d hiA + hiB;\n        vec3 e \x3d t1 - hiA;\n        vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "]))))};
a.doublePrecisionRequiresObfuscation=function(a){return l("force-double-precision-obfuscation")?!0:e.testWebGLDriver(a).doublePrecisionRequiresObfuscation};var c,h})},"esri/views/3d/webgl-engine/lib/WebGLDriverTest":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3f64 ../../../webgl ./doublePrecisionUtils ./Util".split(" "),function(n,a,d,l,k,e,c){function h(a,d){var b=new k.FramebufferObject(a,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,
pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),f=k.BufferObject.createVertex(a,35044,new Uint16Array([0,0,1,0,0,1,1,1])),g=new k.VertexArrayObject(a,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:f}),h=l.vec3f64.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),m=l.vec3f64.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387);d=new k.Program(a,"\n\n  precision highp float;\n\n  attribute vec2 a_pos;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  "+
(d?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"")+"\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n    vec3 e \x3d dpMinusFrc(t1, hiA);\n    vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 \x3d hiA + hiB;\n    vec3 e \x3d t1 - hiA;\n    vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT \x3d\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat \x3d 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val \x3d dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color \x3d float2rgba(val.z / 25.0);\n\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ",
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",{a_pos:0});var v=new Float32Array(6);e.encodeDoubleArray(h,v,3);var w=new Float32Array(6);e.encodeDoubleArray(m,w,3);a.bindProgram(d);d.setUniform3f("u_highA",v[0],v[2],v[4]);d.setUniform3f("u_lowA",v[1],v[3],v[5]);d.setUniform3f("u_highB",w[0],w[2],w[4]);d.setUniform3f("u_lowB",w[1],w[3],w[5]);var v=a.getBoundFramebufferObject(),z=a.getViewport(),w=z.x,x=z.y,B=z.width,A=z.height;a.bindFramebuffer(b);
a.setViewport(0,0,1,1);a.bindVAO(g);a.drawArrays(5,0,4);z=new Uint8Array(4);b.readPixels(0,0,1,1,6408,5121,z);d.dispose();g.dispose(!1);f.dispose();b.dispose();a.setViewport(w,x,B,A);a.bindFramebuffer(v);a=(h[2]-m[2])/25;b=c.unpackFloatRGBA(z);return Math.abs(a-b)}Object.defineProperty(a,"__esModule",{value:!0});a.clearTestWebGLDriver=a.testWebGLDriver=void 0;var m=function(){function a(a){this.context=a;this._doublePrecisionRequiresObfuscation=null}Object.defineProperty(a.prototype,"doublePrecisionRequiresObfuscation",
{get:function(){if(d.isNone(this._doublePrecisionRequiresObfuscation)){var a=h(this.context,!1),b=h(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==a&&(0===b||5<a/b)}return this._doublePrecisionRequiresObfuscation},enumerable:!1,configurable:!0});return a}(),f=null;a.testWebGLDriver=function(a){if(d.isNone(f)||f.context!==a)f=new m(a);return f};a.clearTestWebGLDriver=function(a){d.isSome(f)&&f.context===a&&(f=null)}})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("require exports tslib ../../../../../../core/libs/gl-matrix-2/vec3f32 ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/interfaces".split(" "),
function(n,a,d,l,k,e){function c(a,c){var l=a.fragment,r=c.hasMetalnessAndRoughnessTexture||c.hasEmissionTexture||c.hasOcclusionTexture;1===c.pbrMode&&r&&a.include(k.VertexTextureCoordinates,c);2===c.pbrMode?l.code.add(e.glsl(h||(h=d.__makeTemplateObject(["\n      const vec3 mrr \x3d vec3(0.0, 0.6, 0.2);\n      const vec3 emission \x3d vec3(0.0);\n      float occlusion \x3d 1.0;\n\n      void applyPBRFactors() {}\n\n      float getBakedOcclusion() { return 1.0; }\n    "],["\n      const vec3 mrr \x3d vec3(0.0, 0.6, 0.2);\n      const vec3 emission \x3d vec3(0.0);\n      float occlusion \x3d 1.0;\n\n      void applyPBRFactors() {}\n\n      float getBakedOcclusion() { return 1.0; }\n    "])))):
(0===c.pbrMode&&l.code.add(e.glsl(m||(m=d.__makeTemplateObject(["\n      float getBakedOcclusion() { return 1.0; }\n  "],["\n      float getBakedOcclusion() { return 1.0; }\n  "])))),1===c.pbrMode&&(l.uniforms.add("emissionFactor","vec3"),l.uniforms.add("mrrFactors","vec3"),l.code.add(e.glsl(f||(f=d.__makeTemplateObject(["\n      vec3 mrr;\n      vec3 emission;\n      float occlusion;\n    "],["\n      vec3 mrr;\n      vec3 emission;\n      float occlusion;\n    "])))),c.hasMetalnessAndRoughnessTexture&&
(l.uniforms.add("texMetallicRoughness","sampler2D"),c.supportsTextureAtlas&&l.uniforms.add("texMetallicRoughnessSize","vec2"),l.code.add(e.glsl(b||(b=d.__makeTemplateObject(["\n      void applyMetallnessAndRoughness(TextureLookupParameter params) {\n        vec3 metallicRoughness \x3d textureLookup(texMetallicRoughness, params).rgb;\n\n        mrr[0] *\x3d metallicRoughness.b;\n        mrr[1] *\x3d metallicRoughness.g;\n      }"],["\n      void applyMetallnessAndRoughness(TextureLookupParameter params) {\n        vec3 metallicRoughness \x3d textureLookup(texMetallicRoughness, params).rgb;\n\n        mrr[0] *\x3d metallicRoughness.b;\n        mrr[1] *\x3d metallicRoughness.g;\n      }"]))))),
c.hasEmissionTexture&&(l.uniforms.add("texEmission","sampler2D"),c.supportsTextureAtlas&&l.uniforms.add("texEmissionSize","vec2"),l.code.add(e.glsl(g||(g=d.__makeTemplateObject(["\n      void applyEmission(TextureLookupParameter params) {\n        emission *\x3d textureLookup(texEmission, params).rgb;\n      }"],["\n      void applyEmission(TextureLookupParameter params) {\n        emission *\x3d textureLookup(texEmission, params).rgb;\n      }"]))))),c.hasOcclusionTexture?(l.uniforms.add("texOcclusion",
"sampler2D"),c.supportsTextureAtlas&&l.uniforms.add("texOcclusionSize","vec2"),l.code.add(e.glsl(p||(p=d.__makeTemplateObject(["\n      void applyOcclusion(TextureLookupParameter params) {\n        occlusion *\x3d textureLookup(texOcclusion, params).r;\n      }\n\n      float getBakedOcclusion() {\n        return occlusion;\n      }\n      "],["\n      void applyOcclusion(TextureLookupParameter params) {\n        occlusion *\x3d textureLookup(texOcclusion, params).r;\n      }\n\n      float getBakedOcclusion() {\n        return occlusion;\n      }\n      "]))))):
l.code.add(e.glsl(t||(t=d.__makeTemplateObject(["\n      float getBakedOcclusion() { return 1.0; }\n      "],["\n      float getBakedOcclusion() { return 1.0; }\n      "])))),l.code.add(e.glsl(u||(u=d.__makeTemplateObject(["\n    void applyPBRFactors() {\n      mrr \x3d mrrFactors;\n      emission \x3d emissionFactor;\n      occlusion \x3d 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "],["\n    void applyPBRFactors() {\n      mrr \x3d mrrFactors;\n      emission \x3d emissionFactor;\n      occlusion \x3d 1.0;\n      ",
"\n      ","\n      ","\n      ","\n    }\n  "])),r?"vtc.uv \x3d vuv0;":"",c.hasMetalnessAndRoughnessTexture?c.supportsTextureAtlas?"vtc.size \x3d texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":"",c.hasEmissionTexture?c.supportsTextureAtlas?"vtc.size \x3d texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",c.hasOcclusionTexture?c.supportsTextureAtlas?"vtc.size \x3d texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""))))}Object.defineProperty(a,
"__esModule",{value:!0});a.PhysicallyBasedRenderingParameters=a.PBRSchematicMRRValues=void 0;a.PBRSchematicMRRValues=l.vec3f32.fromValues(0,.6,.2);a.PhysicallyBasedRenderingParameters=c;(function(a){a.bindUniforms=function(a,b,c){void 0===c&&(c=!1);c||(a.setUniform3fv("mrrFactors",b.mrrFactors),a.setUniform3fv("emissionFactor",b.emissiveFactor))}})(c=a.PhysicallyBasedRenderingParameters||(a.PhysicallyBasedRenderingParameters={}));var h,m,f,b,g,p,t,u})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define("require exports tslib ./TextureCoordinateAttribute.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces".split(" "),
function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.VertexTextureCoordinates=void 0;a.VertexTextureCoordinates=function(a,b){a.include(l.TextureCoordinateAttribute,b);a.fragment.code.add(e.glsl(c||(c=d.__makeTemplateObject(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "],["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "])),b.supportsTextureAtlas?"vec2 size;":""));1===b.attributeTextureCoordinates&&a.fragment.code.add(e.glsl(h||
(h=d.__makeTemplateObject(["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "],["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "]))));2===b.attributeTextureCoordinates&&(a.include(k.TextureAtlasLookup),a.fragment.code.add(e.glsl(m||(m=d.__makeTemplateObject(["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "],
["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "])))))};var c,h,m})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.TextureCoordinateAttribute=void 0;a.TextureCoordinateAttribute=function(a,
m){1===m.attributeTextureCoordinates&&(a.attributes.add("uv0","vec2"),a.varyings.add("vuv0","vec2"),a.vertex.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n      }\n    "],["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n      }\n    "])))));2===m.attributeTextureCoordinates&&(a.attributes.add("uv0","vec2"),a.varyings.add("vuv0","vec2"),a.attributes.add("uvRegion","vec4"),a.varyings.add("vuvRegion","vec4"),a.vertex.code.add(l.glsl(e||
(e=d.__makeTemplateObject(["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n        vuvRegion \x3d uvRegion;\n      }\n    "],["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n        vuvRegion \x3d uvRegion;\n      }\n    "])))));0===m.attributeTextureCoordinates&&a.vertex.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n      void forwardTextureCoordinates() {}\n    "],["\n      void forwardTextureCoordinates() {}\n    "]))))};var k,e,c})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.TextureAtlasLookup=void 0;a.TextureAtlasLookup=function(a){a.extensions.add("GL_EXT_shader_texture_lod");a.extensions.add("GL_OES_standard_derivatives");a.fragment.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale \x3d atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas \x3d fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      vec2 dUVdx \x3d dFdx(textureCoordinates) * atlasScale;\n      vec2 dUVdy \x3d dFdy(textureCoordinates) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto \x3d dFdx(uvAtlas);\n        vec2 dUVdyAuto \x3d dFdy(uvAtlas);\n        float mipMapLevel \x3d calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "],
["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale \x3d atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas \x3d fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      vec2 dUVdx \x3d dFdx(textureCoordinates) * atlasScale;\n      vec2 dUVdy \x3d dFdy(textureCoordinates) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto \x3d dFdx(uvAtlas);\n        vec2 dUVdyAuto \x3d dFdy(uvAtlas);\n        float mipMapLevel \x3d calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "]))))};
var k})},"esri/views/3d/webgl-engine/shaders/DefaultMaterial.glsl":function(){define("require exports tslib ../core/shaderLibrary/ForwardLinearDepth.glsl ../core/shaderLibrary/Offset.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/PositionAttribute.glsl ../core/shaderLibrary/attributes/SymbolColor.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../core/shaderLibrary/shading/ComputeNormalTexture.glsl ../core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../core/shaderLibrary/util/HeaderComment.glsl ../core/shaderLibrary/util/MixExternalColor.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var n=new J.ShaderBuilder,Y=n.vertex.code,ba=n.fragment.code;n.include(G.HeaderComment,{name:"Default Material Shader",output:a.output});n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");n.include(f.PositionAttribute);n.varyings.add("vpos","vec3");n.include(C.VisualVariables,a);n.include(h.InstancedDoublePrecision,
a);n.include(u.VerticalOffset,a);0===a.output&&(n.include(m.NormalAttribute,a),n.include(c.Transform,{linearDepth:!1}),0===a.normalType&&a.offsetBackfaces&&n.include(k.Offset),n.include(q.ComputeNormalTexture,a),n.include(t.VertexNormal,a),a.instancedColor&&n.attributes.add("instanceColor","vec4"),n.varyings.add("localvpos","vec3"),n.include(g.TextureCoordinateAttribute,a),n.include(l.ForwardLinearDepth,a),n.include(b.SymbolColor,a),n.include(p.VertexColor,a),n.vertex.uniforms.add("externalColor",
"vec4"),n.varyings.add("vcolorExt","vec4"),Y.add(H.glsl(K||(K=d.__makeTemplateObject(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt \x3d externalColor;\n        ","\n        vcolorExt *\x3d vvColor();\n        vcolorExt *\x3d getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a \x3c ",") {\n          gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos \x3d calculateVPos();\n          localvpos \x3d vpos - view[3].xyz;\n          vpos \x3d subtractOrigin(vpos);\n          ",
"\n          vpos \x3d addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          ","\n        }\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt \x3d externalColor;\n        ","\n        vcolorExt *\x3d vvColor();\n        vcolorExt *\x3d getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a \x3c ",
") {\n          gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos \x3d calculateVPos();\n          localvpos \x3d vpos - view[3].xyz;\n          vpos \x3d subtractOrigin(vpos);\n          ","\n          vpos \x3d addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          ","\n        }\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),a.instancedColor?
"vcolorExt *\x3d instanceColor;":"",H.glsl.float(E.symbolAlphaCutoff),0===a.normalType?H.glsl(I||(I=d.__makeTemplateObject(["\n          vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));"],["\n          vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));"]))):"",a.vertexTangets?"vTangent \x3d dpTransformVertexTangent(tangent);":"",0===a.normalType&&a.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"")),n.include(e.Slice,a),n.include(w.EvaluateSceneLighting,
a),n.include(v.EvaluateAmbientOcclusion,a),n.include(E.DiscardOrAdjustAlpha,a),a.receiveShadows&&n.include(A.ReadShadowMap,a),n.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),a.hasColorTexture&&n.fragment.uniforms.add("tex","sampler2D"),n.include(B.PhysicallyBasedRenderingParameters,a),n.include(x.PhysicallyBasedRendering,a),n.fragment.include(F.MixExternalColor),n.include(z.Normals,a),
ba.add(H.glsl(T||(T=d.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        ","\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ",
"\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        ","\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ",
"\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "])),a.hasColorTexture?H.glsl(L||(L=d.__makeTemplateObject(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),a.textureAlphaPremultiplied?
"texColor.rgb /\x3d texColor.a;":""):H.glsl(M||(M=d.__makeTemplateObject(["vec4 texColor \x3d vec4(1.0);"],["vec4 texColor \x3d vec4(1.0);"]))),3===a.normalType?H.glsl(Q||(Q=d.__makeTemplateObject(["\n        vec3 normal \x3d screenDerivativeNormal(localvpos);"],["\n        vec3 normal \x3d screenDerivativeNormal(localvpos);"]))):H.glsl(R||(R=d.__makeTemplateObject(["\n        shadingParams.normalView \x3d vNormalWorld;\n        vec3 normal \x3d shadingNormal(shadingParams);"],["\n        shadingParams.normalView \x3d vNormalWorld;\n        vec3 normal \x3d shadingNormal(shadingParams);"]))),
1===a.pbrMode?"applyPBRFactors();":"",a.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":1===a.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;",a.attributeColor?H.glsl(O||(O=d.__makeTemplateObject(["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"],
["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):H.glsl(N||(N=d.__makeTemplateObject(["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "],
["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),a.hasNormalTexture?H.glsl(S||(S=d.__makeTemplateObject(["\n              mat3 tangentSpace \x3d ","\n              vec3 shadedNormal \x3d computeTextureNormal(tangentSpace, vuv0);"],["\n              mat3 tangentSpace \x3d ","\n              vec3 shadedNormal \x3d computeTextureNormal(tangentSpace, vuv0);"])),
a.vertexTangets?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal \x3d normal;",1===a.pbrMode||2===a.pbrMode?1===a.viewingMode?H.glsl(P||(P=d.__makeTemplateObject(["vec3 normalGround \x3d normalize(vpos + localOrigin);"],["vec3 normalGround \x3d normalize(vpos + localOrigin);"]))):H.glsl(U||(U=d.__makeTemplateObject(["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"],["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"]))):H.glsl(Z||(Z=d.__makeTemplateObject([""],
[""]))),1===a.pbrMode||2===a.pbrMode?H.glsl(V||(V=d.__makeTemplateObject(["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"],["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):
"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);")));n.include(r.DefaultMaterialAuxiliaryPasses,a);return n};var I,K,L,M,Q,R,O,N,S,P,U,Z,V,T})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["require","exports","tslib","../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.Offset=void 0;a.Offset=function(a){a.vertex.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert \x3d posWorld - camPosWorld;\n\n      bool isBackface \x3d dot(camToVert, normalWorld) \x3e 0.0;\n      if (isBackface) {\n        posClip.z +\x3d 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "],
["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert \x3d posWorld - camPosWorld;\n\n      bool isBackface \x3d dot(camToVert, normalWorld) \x3e 0.0;\n      if (isBackface) {\n        posClip.z +\x3d 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "]))))};var k})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["require","exports","tslib","../util/DecodeNormal.glsl",
"../../shaderModules/interfaces"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.NormalAttribute=void 0;a.NormalAttribute=function(a,f){0===f.normalType&&(a.attributes.add("normal","vec3"),a.vertex.code.add(k.glsl(e||(e=d.__makeTemplateObject(["\n      vec3 normalModel() {\n        return normal;\n      }\n    "],["\n      vec3 normalModel() {\n        return normal;\n      }\n    "])))));1===f.normalType&&(a.include(l.DecodeNormal),a.attributes.add("normalCompressed","vec2"),
a.vertex.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "],["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "])))));3===f.normalType&&(a.extensions.add("GL_OES_standard_derivatives"),a.fragment.code.add(k.glsl(h||(h=d.__makeTemplateObject(["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "],
["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "])))))};var e,c,h})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.DecodeNormal=void 0;a.DecodeNormal=function(a){var c=l.glsl(k||(k=d.__makeTemplateObject(["\n    vec3 decodeNormal(vec2 f) {\n      float z \x3d 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "],
["\n    vec3 decodeNormal(vec2 f) {\n      float z \x3d 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "])));a.fragment.code.add(c);a.vertex.code.add(c)};var k})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.PositionAttribute=void 0;a.PositionAttribute=function(a){a.attributes.add("position",
"vec3");a.vertex.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    vec3 positionModel() { return position; }\n  "],["\n    vec3 positionModel() { return position; }\n  "]))))};var k})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define(["require","exports","tslib","../../../collections/Component/Material/shader/DecodeSymbolColor.glsl","../../shaderModules/interfaces"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.SymbolColor=void 0;
a.SymbolColor=function(a,m){m.symbolColor?(a.include(l.DecodeSymbolColor),a.attributes.add("symbolColor","vec4"),a.varyings.add("colorMixMode","mediump float")):a.fragment.uniforms.add("colorMixMode","int");m.symbolColor?a.vertex.code.add(k.glsl(e||(e=d.__makeTemplateObject(["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode \x3d float(symbolColorMixMode) + 0.5;\n    }\n  "],
["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode \x3d float(symbolColorMixMode) + 0.5;\n    }\n  "])))):a.vertex.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "],["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "]))))};
var e,c})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["require","exports","tslib","../../../../core/shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.DecodeSymbolColor=void 0;a.DecodeSymbolColor=function(a){a.vertex.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha \x3d 0.0;\n\n      const float maxTint \x3d 85.0;\n      const float maxReplace \x3d 170.0;\n      const float scaleAlpha \x3d 3.0;\n\n      if (symbolColor.a \x3e maxReplace) {\n        colorMixMode \x3d ",
";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a \x3e maxTint) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a \x3e 0.0) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "],
["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha \x3d 0.0;\n\n      const float maxTint \x3d 85.0;\n      const float maxReplace \x3d 170.0;\n      const float scaleAlpha \x3d 3.0;\n\n      if (symbolColor.a \x3e maxReplace) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a \x3e maxTint) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a \x3e 0.0) {\n        colorMixMode \x3d ",
";\n        symbolAlpha \x3d scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),l.glsl.int(1),l.glsl.int(3),l.glsl.int(4),l.glsl.int(1)))};var k})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,
"__esModule",{value:!0});a.VertexColor=void 0;a.VertexColor=function(a,m){m.attributeColor?(a.attributes.add("color","vec4"),a.varyings.add("vColor","vec4"),a.vertex.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n      void forwardVertexColor() { vColor \x3d color; }\n    "],["\n      void forwardVertexColor() { vColor \x3d color; }\n    "])))),a.vertex.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n      void forwardNormalizedVertexColor() { vColor \x3d color * 0.003921568627451; }\n    "],["\n      void forwardNormalizedVertexColor() { vColor \x3d color * 0.003921568627451; }\n    "]))))):
a.vertex.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "],["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "]))))};var k,e,c})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("require exports tslib ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces".split(" "),function(n,a,d,l,k,e){function c(a,c){0===
c.normalType||1===c.normalType?(a.include(l.NormalAttribute,c),a.varyings.add("vNormalWorld","vec3"),a.varyings.add("vNormalView","vec3"),a.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),a.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),a.vertex.code.add(e.glsl(h||(h=d.__makeTemplateObject(["\n      void forwardNormal() {\n        vNormalWorld \x3d uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView \x3d uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "],
["\n      void forwardNormal() {\n        vNormalWorld \x3d uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView \x3d uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "]))))):2===c.normalType?(a.include(k.VertexPosition,c),a.varyings.add("vNormalWorld","vec3"),a.vertex.code.add(e.glsl(b||(b=d.__makeTemplateObject(["\n    void forwardNormal() {\n      vNormalWorld \x3d ","\n    }\n    "],["\n    void forwardNormal() {\n      vNormalWorld \x3d ","\n    }\n    "])),1===
c.viewingMode?e.glsl(m||(m=d.__makeTemplateObject(["normalize(vPositionWorldCameraRelative);"],["normalize(vPositionWorldCameraRelative);"]))):e.glsl(f||(f=d.__makeTemplateObject(["vec3(0.0, 0.0, 1.0);"],["vec3(0.0, 0.0, 1.0);"])))))):a.vertex.code.add(e.glsl(g||(g=d.__makeTemplateObject(["\n      void forwardNormal() {}\n    "],["\n      void forwardNormal() {}\n    "]))))}Object.defineProperty(a,"__esModule",{value:!0});a.VertexNormal=void 0;a.VertexNormal=c;(function(a){a.bindUniforms=function(a,
b){a.setUniformMatrix4fv("viewNormal",b)}})(c=a.VertexNormal||(a.VertexNormal={}));var h,m,f,b,g})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("require exports tslib ../../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../../core/libs/gl-matrix-2/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/interfaces".split(" "),function(n,a,d,l,k,e,c,h,m){function f(a,
e){a.include(c.PositionAttribute);a.vertex.include(h.DoublePrecision,e);a.varyings.add("vPositionWorldCameraRelative","vec3");a.varyings.add("vPosition_view","vec3");a.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3");a.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3");a.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3");a.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3");a.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3");a.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS",
"mat3");a.vertex.uniforms.add("uTransform_ProjFromView","mat4");a.vertex.code.add(m.glsl(b||(b=d.__makeTemplateObject(["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative \x3d positionWorldCameraRelative();\n      vPosition_view \x3d position_view();\n      gl_Position \x3d uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "],
["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative \x3d positionWorldCameraRelative();\n      vPosition_view \x3d position_view();\n      gl_Position \x3d uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "]))));
a.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3");a.fragment.code.add(m.glsl(g||(g=d.__makeTemplateObject(["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "],["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "]))))}Object.defineProperty(a,"__esModule",{value:!0});a.VertexPosition=void 0;a.VertexPosition=f;(function(a){var b=function(){return function(){this.worldFromModel_RS=
l.mat3f64.create();this.worldFromModel_TH=e.vec3f64.create();this.worldFromModel_TL=e.vec3f64.create()}}();a.ModelTransform=b;b=function(){return function(){this.worldFromView_TH=e.vec3f64.create();this.worldFromView_TL=e.vec3f64.create();this.viewFromCameraRelative_RS=l.mat3f64.create();this.projFromView=k.mat4f64.create()}}();a.ViewProjectionTransform=b;a.bindModelTransform=function(a,b){a.setUniformMatrix3fv("uTransform_WorldFromModel_RS",b.worldFromModel_RS);a.setUniform3fv("uTransform_WorldFromModel_TH",
b.worldFromModel_TH);a.setUniform3fv("uTransform_WorldFromModel_TL",b.worldFromModel_TL)};a.bindViewProjTransform=function(a,b){a.setUniform3fv("uTransform_WorldFromView_TH",b.worldFromView_TH);a.setUniform3fv("uTransform_WorldFromView_TL",b.worldFromView_TL);a.setUniformMatrix4fv("uTransform_ProjFromView",b.projFromView);a.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",b.viewFromCameraRelative_RS)}})(f=a.VertexPosition||(a.VertexPosition={}));var b,g})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("require exports tslib ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../../shaderModules/interfaces".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p){Object.defineProperty(a,"__esModule",{value:!0});a.DefaultMaterialAuxiliaryPasses=void 0;a.DefaultMaterialAuxiliaryPasses=function(a,n){var G=a.vertex.code,F=a.fragment.code;if(1===n.output||3===n.output)a.include(k.Transform,{linearDepth:!0}),a.include(c.TextureCoordinateAttribute,n),a.include(b.VisualVariables,n),a.include(m.OutputDepth,n),a.include(l.Slice,n),a.vertex.uniforms.add("nearFar","vec2"),a.varyings.add("depth","float"),n.hasColorTexture&&a.fragment.uniforms.add("tex",
"sampler2D"),G.add(p.glsl(t||(t=d.__makeTemplateObject(["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "])))),
a.include(g.DiscardOrAdjustAlpha,n),F.add(p.glsl(r||(r=d.__makeTemplateObject(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "],["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),n.hasColorTexture?p.glsl(u||(u=d.__makeTemplateObject(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):
""));2===n.output&&(a.include(k.Transform,{linearDepth:!1}),a.include(e.NormalAttribute,n),a.include(h.VertexNormal,n),a.include(c.TextureCoordinateAttribute,n),a.include(b.VisualVariables,n),n.hasColorTexture&&a.fragment.uniforms.add("tex","sampler2D"),a.vertex.uniforms.add("viewNormal","mat4"),a.varyings.add("vPositionView","vec3"),G.add(p.glsl(v||(v=d.__makeTemplateObject(["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        ","\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "],
["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        ","\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])),0===n.normalType?p.glsl(q||(q=d.__makeTemplateObject(["\n        vNormalWorld \x3d dpNormalView(vvLocalNormal(normalModel()));"],["\n        vNormalWorld \x3d dpNormalView(vvLocalNormal(normalModel()));"]))):
"")),a.include(l.Slice,n),a.include(g.DiscardOrAdjustAlpha,n),F.add(p.glsl(B||(B=d.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),n.hasColorTexture?p.glsl(w||(w=d.__makeTemplateObject(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],
["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",3===n.normalType?p.glsl(z||(z=d.__makeTemplateObject(["\n            vec3 normal \x3d screenDerivativeNormal(vPositionView);"],["\n            vec3 normal \x3d screenDerivativeNormal(vPositionView);"]))):p.glsl(x||(x=d.__makeTemplateObject(["\n            vec3 normal \x3d normalize(vNormalWorld);\n            if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;"],["\n            vec3 normal \x3d normalize(vNormalWorld);\n            if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;"]))))));
4===n.output&&(a.include(k.Transform,{linearDepth:!1}),a.include(c.TextureCoordinateAttribute,n),a.include(b.VisualVariables,n),n.hasColorTexture&&a.fragment.uniforms.add("tex","sampler2D"),G.add(p.glsl(A||(A=d.__makeTemplateObject(["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "],
["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])))),a.include(l.Slice,n),a.include(g.DiscardOrAdjustAlpha,n),a.include(f.OutputHighlight),F.add(p.glsl(E||(E=d.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "],
["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),n.hasColorTexture?p.glsl(C||(C=d.__makeTemplateObject(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"")))};var t,u,r,q,v,w,z,x,B,A,C,E})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["require",
"exports","tslib","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.OutputDepth=void 0;a.OutputDepth=function(a,m){a.fragment.include(l.RgbaFloatEncoding);3===m.output?(a.extensions.add("GL_OES_standard_derivatives"),a.fragment.code.add(k.glsl(e||(e=d.__makeTemplateObject(["\n      float _calculateFragDepth(const in float depth) {\n        // calc polygon offset\n        const float SLOPE_SCALE \x3d 2.0;\n        const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\n        float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n        float result \x3d depth + SLOPE_SCALE * m + BIAS;\n        return clamp(result, .0, .999999);\n      }\n\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_calculateFragDepth(_linearDepth));\n      }\n    "],
["\n      float _calculateFragDepth(const in float depth) {\n        // calc polygon offset\n        const float SLOPE_SCALE \x3d 2.0;\n        const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\n        float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n        float result \x3d depth + SLOPE_SCALE * m + BIAS;\n        return clamp(result, .0, .999999);\n      }\n\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_calculateFragDepth(_linearDepth));\n      }\n    "]))))):
1===m.output&&a.fragment.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_linearDepth);\n      }\n    "],["\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_linearDepth);\n      }\n    "]))))};var e,c})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define(["require","exports","tslib","../attributes/VertexTextureCoordinates.glsl","../../shaderModules/interfaces"],
function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.ComputeNormalTexture=void 0;a.ComputeNormalTexture=function(a,b){var f=a.fragment;f.uniforms.add("normalTexture","sampler2D");f.uniforms.add("normalTextureSize","vec2");b.vertexTangets?(a.attributes.add("tangent","vec4"),a.varyings.add("vTangent","vec4"),2===b.doubleSidedMode?f.code.add(k.glsl(e||(e=d.__makeTemplateObject(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent \x3d normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "],
["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent \x3d normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "])))):f.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d vTangent.w;\n        vec3 tangent \x3d normalize(vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "],
["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d vTangent.w;\n        vec3 tangent \x3d normalize(vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "]))))):(a.extensions.add("GL_OES_standard_derivatives"),f.code.add(k.glsl(h||(h=d.__makeTemplateObject(['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 \x3d dFdx(pos);\n      vec3 Q2 \x3d dFdy(pos);\n\n      vec2 stx \x3d dFdx(st);\n      vec2 sty \x3d dFdy(st);\n\n      float det \x3d stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T \x3d stx.t * Q2 - sty.t * Q1; // compute tangent\n      T \x3d T - normal * dot(normal, T); // orthogonalize tangent\n      T *\x3d inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B \x3d sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  '],
['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 \x3d dFdx(pos);\n      vec3 Q2 \x3d dFdy(pos);\n\n      vec2 stx \x3d dFdx(st);\n      vec2 sty \x3d dFdy(st);\n\n      float det \x3d stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T \x3d stx.t * Q2 - sty.t * Q1; // compute tangent\n      T \x3d T - normal * dot(normal, T); // orthogonalize tangent\n      T *\x3d inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B \x3d sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  '])))));
0!==b.attributeTextureCoordinates&&(a.include(l.VertexTextureCoordinates,b),f.code.add(k.glsl(m||(m=d.__makeTemplateObject(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv \x3d uv;\n      ","\n      vec3 rawNormal \x3d textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "],["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv \x3d uv;\n      ","\n      vec3 rawNormal \x3d textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),
b.supportsTextureAtlas?"vtc.size \x3d normalTextureSize;":"")))};var e,c,h,m})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.EvaluateAmbientOcclusion=void 0;a.EvaluateAmbientOcclusion=function(a,h){a=a.fragment;h.receiveAmbientOcclusion?(a.uniforms.add("ssaoTex","sampler2D"),a.uniforms.add("viewportPixelSz","vec4"),
a.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n      }\n    "],["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n      }\n    "]))))):
a.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "],["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "]))))};var k,e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("require exports tslib ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./EvaluateMainLighting.glsl ./PhysicallyBasedRendering.glsl ./PiUtils.glsl ./ReadShadowMap.glsl ../../shaderModules/interfaces".split(" "),
function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.EvaluateSceneLighting=void 0;a.EvaluateSceneLighting=function(a,n){var C=a.fragment;a.include(e.EvaluateMainLighting);a.include(k.EvaluateAmbientOcclusion,n);0!==n.pbrMode&&a.include(c.PhysicallyBasedRendering,n);a.include(l.EvaluateAmbientLighting,n);n.receiveShadows&&a.include(m.ReadShadowMap,n);C.uniforms.add("lightingGlobalFactor","float");C.uniforms.add("ambientBoostFactor","float");a.include(h.PiUtils);C.code.add(f.glsl(b||
(b=d.__makeTemplateObject(["\n    const float GAMMA_SRGB \x3d 2.1;\n    const float INV_GAMMA_SRGB \x3d 0.4761904;\n    ","\n  "],["\n    const float GAMMA_SRGB \x3d 2.1;\n    const float INV_GAMMA_SRGB \x3d 0.4761904;\n    ","\n  "])),0===n.pbrMode?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"));if(n.useOldSceneLightInterface)C.code.add(f.glsl(g||(g=d.__makeTemplateObject(["\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot \x3d -0.5;\n        float dotRange \x3d 1.0 - minDot;\n        float dotNormalization \x3d 0.66; // guessed \x26 hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight \x3d calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC \x3d pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\n      totalLight \x3d min(totalLight, vec3(PI));\n      vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor \x3d pow(outColor, vec3(INV_GAMMA_SRGB));\n\n      return outColor;\n    }\n  "],
["\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot \x3d -0.5;\n        float dotRange \x3d 1.0 - minDot;\n        float dotNormalization \x3d 0.66; // guessed \x26 hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight \x3d calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC \x3d pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\n      totalLight \x3d min(totalLight, vec3(PI));\n      vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor \x3d pow(outColor, vec3(INV_GAMMA_SRGB));\n\n      return outColor;\n    }\n  "]))));
else if(1===n.viewingMode?C.code.add(f.glsl(p||(p=d.__makeTemplateObject(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld \x3d normalize(vPosWorld);\n        float vndl \x3d -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "],["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld \x3d normalize(vPosWorld);\n        float vndl \x3d -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))):
C.code.add(f.glsl(t||(t=d.__makeTemplateObject(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "],["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))),C.code.add(f.glsl(u||
(u=d.__makeTemplateObject(["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "],["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "])))),
0===n.pbrMode||4===n.pbrMode)C.code.add(f.glsl(r||(r=d.__makeTemplateObject(["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting \x3d evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting \x3d calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        vec3 baseColorLinear \x3d pow(baseColor, vec3(GAMMA_SRGB));\n\n        // physically correct BRDF normalizes by PI\n        vec3 totalLight \x3d mainLighting + ambientLighting + additionalLight;\n        totalLight \x3d min(totalLight, vec3(PI));\n        vec3 outColor \x3d vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor \x3d pow(outColor, vec3(INV_GAMMA_SRGB));\n\n        return outColor;\n      }\n      "],
["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting \x3d evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting \x3d calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        vec3 baseColorLinear \x3d pow(baseColor, vec3(GAMMA_SRGB));\n\n        // physically correct BRDF normalizes by PI\n        vec3 totalLight \x3d mainLighting + ambientLighting + additionalLight;\n        totalLight \x3d min(totalLight, vec3(PI));\n        vec3 outColor \x3d vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor \x3d pow(outColor, vec3(INV_GAMMA_SRGB));\n\n        return outColor;\n      }\n      "]))));
else if(1===n.pbrMode||2===n.pbrMode)C.code.add(f.glsl(q||(q=d.__makeTemplateObject(["\n      const float fillLightIntensity \x3d 0.25;\n      const float horizonLightDiffusion \x3d 0.4;\n      const float additionalAmbientIrradianceFactor \x3d 0.02;\n\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection \x3d -viewDir;\n        vec3 mainLightDirection \x3d -lightingMainDirection;\n        vec3 h \x3d normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL \x3d clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV \x3d clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH \x3d clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH \x3d clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG \x3d clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView \x3d normalize(reflect(viewDirection, normal));\n        inputs.RdotNG \x3d clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear \x3d pow(albedo, vec3(GAMMA_SRGB));\n        inputs.ssao \x3d ssao;\n\n        inputs.metalness \x3d mrr[0];\n        inputs.roughness \x3d clamp(mrr[1] * mrr[1], 0.001, 0.99);\n      "],
["\n      const float fillLightIntensity \x3d 0.25;\n      const float horizonLightDiffusion \x3d 0.4;\n      const float additionalAmbientIrradianceFactor \x3d 0.02;\n\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection \x3d -viewDir;\n        vec3 mainLightDirection \x3d -lightingMainDirection;\n        vec3 h \x3d normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL \x3d clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV \x3d clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH \x3d clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH \x3d clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG \x3d clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView \x3d normalize(reflect(viewDirection, normal));\n        inputs.RdotNG \x3d clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear \x3d pow(albedo, vec3(GAMMA_SRGB));\n        inputs.ssao \x3d ssao;\n\n        inputs.metalness \x3d mrr[0];\n        inputs.roughness \x3d clamp(mrr[1] * mrr[1], 0.001, 0.99);\n      "])))),
C.code.add(f.glsl(v||(v=d.__makeTemplateObject(["\n        inputs.f0 \x3d (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 \x3d vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 \x3d 1.0\n        inputs.diffuseColor \x3d inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "],["\n        inputs.f0 \x3d (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 \x3d vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 \x3d 1.0\n        inputs.diffuseColor \x3d inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "])))),
C.code.add(f.glsl(w||(w=d.__makeTemplateObject(["\n        vec3 ambientDir \x3d vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\n        ambientDir \x3d ambientDir !\x3d vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\n\n        inputs.NdotAmbDir \x3d abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  \x3d inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent \x3d inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent \x3d calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    \x3d ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface \x3d GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "],
["\n        vec3 ambientDir \x3d vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\n        ambientDir \x3d ambientDir !\x3d vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\n\n        inputs.NdotAmbDir \x3d abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  \x3d inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent \x3d inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent \x3d calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    \x3d ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface \x3d GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "])))),
C.code.add(f.glsl(z||(z=d.__makeTemplateObject(["\n        vec3 horizonRingDir \x3d inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH \x3d normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon \x3d dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  \x3d normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent \x3d normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent \x3d calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    \x3d  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface \x3d GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance \x3d ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);\n        "],
["\n        vec3 horizonRingDir \x3d inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH \x3d normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon \x3d dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  \x3d normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent \x3d normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent \x3d calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    \x3d  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface \x3d GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance \x3d ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);\n        "])))),
C.code.add(f.glsl(A||(A=d.__makeTemplateObject(["\n        vec3 reflectedColorComponent \x3d evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent \x3d inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent \x3d pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear \x3d reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "],["\n        vec3 reflectedColorComponent \x3d evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent \x3d inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent \x3d pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear \x3d reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ",
"\n        return outColor;\n      }\n    "])),2===n.pbrMode?f.glsl(x||(x=d.__makeTemplateObject(["vec3 outColor \x3d pow(outColorLinear - 0.005 * inputs.averageAmbientRadiance, vec3(INV_GAMMA_SRGB));"],["vec3 outColor \x3d pow(outColorLinear - 0.005 * inputs.averageAmbientRadiance, vec3(INV_GAMMA_SRGB));"]))):f.glsl(B||(B=d.__makeTemplateObject(["vec3 outColor \x3d pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"],["vec3 outColor \x3d pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"])))))};
var b,g,p,t,u,r,q,v,w,z,x,B,A})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.EvaluateAmbientLighting=void 0;a.EvaluateAmbientLighting=function(a,f){a=a.fragment;var b=void 0!==f.lightingSphericalHarmonicsOrder?f.lightingSphericalHarmonicsOrder:2;0===b?(a.uniforms.add("lightingAmbientSH0","vec3"),a.code.add(l.glsl(k||
(k=d.__makeTemplateObject(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):1===b?(a.uniforms.add("lightingAmbientSH_R",
"vec4"),a.uniforms.add("lightingAmbientSH_G","vec4"),a.uniforms.add("lightingAmbientSH_B","vec4"),a.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 \x3d vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight \x3d vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],
["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 \x3d vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight \x3d vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):2===b&&(a.uniforms.add("lightingAmbientSH0",
"vec3"),a.uniforms.add("lightingAmbientSH_R1","vec4"),a.uniforms.add("lightingAmbientSH_G1","vec4"),a.uniforms.add("lightingAmbientSH_B1","vec4"),a.uniforms.add("lightingAmbientSH_R2","vec4"),a.uniforms.add("lightingAmbientSH_G2","vec4"),a.uniforms.add("lightingAmbientSH_B2","vec4"),a.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 \x3d vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 \x3d vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],
["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 \x3d vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 \x3d vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "])))),
1!==f.pbrMode&&2!==f.pbrMode||a.code.add(l.glsl(h||(h=d.__makeTemplateObject(["\n        const vec3 skyTransmittance \x3d vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight \x3d 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *\x3d (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "],["\n        const vec3 skyTransmittance \x3d vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight \x3d 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *\x3d (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "])))))};
var k,e,c,h})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.EvaluateMainLighting=void 0;a.EvaluateMainLighting=function(a){a=a.fragment;a.uniforms.add("lightingMainDirection","vec3");a.uniforms.add("lightingMainIntensity","vec3");a.uniforms.add("lightingFixedFactor","float");a.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal \x3d clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "],
["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal \x3d clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "]))))};var k})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],
function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.Normals=void 0;a.Normals=function(a,f){a=a.fragment;a.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "],["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "]))));1===f.doubleSidedMode?a.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) \x3e 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "],
["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) \x3e 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "])))):2===f.doubleSidedMode?a.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "],["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "])))):
a.code.add(l.glsl(h||(h=d.__makeTemplateObject(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "],["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "]))))};var k,e,c,h})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl":function(){define(["require","exports","tslib","../../../../../../core/has","../../shaderModules/interfaces"],
function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.HeaderComment=void 0;a.HeaderComment=function(a,h){k.glsl(e||(e=d.__makeTemplateObject(["\n  /*\n  *  ","\n  *  ","\n  */\n  "],["\n  /*\n  *  ","\n  *  ","\n  */\n  "])),h.name,0===h.output?"RenderOutput: Color":1===h.output?"RenderOutput: Depth":3===h.output?"RenderOutput: Shadow":2===h.output?"RenderOutput: Normal":4===h.output?"RenderOutput: Highlight":"")};var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["require",
"exports","tslib","./ColorConversion.glsl","../../shaderModules/interfaces"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.MixExternalColor=void 0;a.MixExternalColor=function(a){a.include(l.ColorConversion);a.code.add(k.glsl(e||(e=d.__makeTemplateObject(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed \x3d internalColor * textureColor;\n      vec3 allMixed \x3d internalMixed * externalColor;\n\n      if (mode \x3d\x3d ",
") {\n        return allMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn \x3d rgb2v(internalMixed);\n        vec3 hsvTint \x3d rgb2hsv(externalColor);\n        vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed \x3d internalOpacity * textureOpacity;\n      float allMixed \x3d internalMixed * externalOpacity;\n\n      if (mode \x3d\x3d ",
") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "],["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed \x3d internalColor * textureColor;\n      vec3 allMixed \x3d internalMixed * externalColor;\n\n      if (mode \x3d\x3d ",
") {\n        return allMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn \x3d rgb2v(internalMixed);\n        vec3 hsvTint \x3d rgb2hsv(externalColor);\n        vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed \x3d internalOpacity * textureOpacity;\n      float allMixed \x3d internalMixed * externalOpacity;\n\n      if (mode \x3d\x3d ",
") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "])),k.glsl.int(1),k.glsl.int(2),k.glsl.int(3),k.glsl.int(2),k.glsl.int(3)))};var e})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports tslib ../core/shaderLibrary/default/RealisticTree.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../lib/DefaultVertexAttributeLocations ./DefaultMaterialTechnique ../../../webgl/Program @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m){Object.defineProperty(a,"__esModule",{value:!0});a.RealisticTreeTechnique=void 0;h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype.initializeProgram=function(a){var d=b.shader.get(),e=this.configuration,d=d.build({output:e.output,viewingMode:a.viewingMode,receiveShadows:e.receiveShadows,slicePlaneEnabled:e.slicePlaneEnabled,sliceHighlightDisabled:e.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:e.symbolColors,
vvSize:e.vvSize,vvColor:e.vvColor,vvInstancingEnabled:!0,instanced:e.instanced,instancedColor:e.instancedColor,instancedDoublePrecision:e.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:e.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:e.hasColorTexture,receiveAmbientOcclusion:e.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangets:!1,attributeTextureCoordinates:e.hasColorTexture?
1:0,textureAlphaPremultiplied:e.textureAlphaPremultiplied,attributeColor:e.vertexColors,screenSizePerspectiveEnabled:e.screenSizePerspective,verticalOffsetEnabled:e.verticalOffset,offsetBackfaces:e.offsetBackfaces,doublePrecisionRequiresObfuscation:k.doublePrecisionRequiresObfuscation(a.rctx),alphaDiscardMode:e.alphaDiscardMode,supportsTextureAtlas:!1});return new m(a.rctx,d.generateSource("vertex"),d.generateSource("fragment"),c.Default3D)};b.shader=new e.ReloadableShaderModule(l,function(){return new Promise(function(a,
b){n(["../core/shaderLibrary/default/RealisticTree.glsl"],a,b)})});return b}(h.DefaultMaterialTechnique);a.RealisticTreeTechnique=h})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/RealisticTree.glsl":function(){define("require exports tslib ../ForwardLinearDepth.glsl ../Offset.glsl ../Slice.glsl ../Transform.glsl ../attributes/InstancedDoublePrecision.glsl ../attributes/NormalAttribute.glsl ../attributes/PositionAttribute.glsl ../attributes/SymbolColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexColor.glsl ../attributes/VerticalOffset.glsl ./DefaultMaterialAuxiliaryPasses.glsl ../shading/EvaluateAmbientOcclusion.glsl ../shading/EvaluateSceneLighting.glsl ../shading/PhysicallyBasedRendering.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/ReadShadowMap.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/MixExternalColor.glsl ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var n=new E.ShaderBuilder,P=n.vertex.code,U=n.fragment.code;n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");n.include(f.PositionAttribute);n.varyings.add("vpos","vec3");n.include(x.VisualVariables,a);n.include(h.InstancedDoublePrecision,a);n.include(t.VerticalOffset,a);0===a.output&&(n.include(m.NormalAttribute,
a),n.include(c.Transform,{linearDepth:!1}),a.offsetBackfaces&&n.include(k.Offset),a.instancedColor&&n.attributes.add("instanceColor","vec4"),n.varyings.add("vNormalWorld","vec3"),n.varyings.add("localvpos","vec3"),n.include(g.TextureCoordinateAttribute,a),n.include(l.ForwardLinearDepth,a),n.include(b.SymbolColor,a),n.include(p.VertexColor,a),n.vertex.uniforms.add("externalColor","vec4"),n.varyings.add("vcolorExt","vec4"),P.add(C.glsl(G||(G=d.__makeTemplateObject(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt \x3d externalColor;\n          ",
"\n          vcolorExt *\x3d vvColor();\n          vcolorExt *\x3d getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a \x3c ",") {\n            gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos \x3d calculateVPos();\n            localvpos \x3d vpos - view[3].xyz;\n            vpos \x3d subtractOrigin(vpos);\n            vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));\n            vpos \x3d addVerticalOffset(vpos, localOrigin);\n            gl_Position \x3d transformPosition(proj, view, vpos);\n            ",
"\n          }\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "],["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt \x3d externalColor;\n          ","\n          vcolorExt *\x3d vvColor();\n          vcolorExt *\x3d getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a \x3c ",") {\n            gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos \x3d calculateVPos();\n            localvpos \x3d vpos - view[3].xyz;\n            vpos \x3d subtractOrigin(vpos);\n            vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));\n            vpos \x3d addVerticalOffset(vpos, localOrigin);\n            gl_Position \x3d transformPosition(proj, view, vpos);\n            ",
"\n          }\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),a.instancedColor?"vcolorExt *\x3d instanceColor;":"",C.glsl.float(B.symbolAlphaCutoff),a.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"")),n.include(e.Slice,a),n.include(q.EvaluateSceneLighting,a),n.include(r.EvaluateAmbientOcclusion,a),n.include(B.DiscardOrAdjustAlpha,a),a.receiveShadows&&n.include(z.ReadShadowMap,a),n.fragment.uniforms.add("camPos",
"vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),n.fragment.uniforms.add("view","mat4"),a.hasColorTexture&&n.fragment.uniforms.add("tex","sampler2D"),n.include(w.PhysicallyBasedRenderingParameters,a),n.include(v.PhysicallyBasedRendering,a),n.fragment.include(A.MixExternalColor),U.add(C.glsl(O||(O=d.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 viewDirection \x3d normalize(vpos - camPos);\n        ",
"\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "],
["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 viewDirection \x3d normalize(vpos - camPos);\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor \x3d max(ambient, diffuse);\n        ",
"\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "])),a.hasColorTexture?C.glsl(F||(F=d.__makeTemplateObject(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),a.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""):C.glsl(H||(H=d.__makeTemplateObject(["vec4 texColor \x3d vec4(1.0);"],
["vec4 texColor \x3d vec4(1.0);"]))),1===a.pbrMode?"applyPBRFactors();":"",a.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":1===a.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;",a.attributeColor?C.glsl(J||(J=d.__makeTemplateObject(["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"],
["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):C.glsl(I||(I=d.__makeTemplateObject(["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "],
["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),C.glsl(K||(K=d.__makeTemplateObject(["\n        vec3 shadedNormal \x3d normalize(vNormalWorld);\n        albedo_ *\x3d 1.2;\n        vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff \x3d vColor.r;\n        float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight +\x3d backLightFactor * lightingMainIntensity;"],
["\n        vec3 shadedNormal \x3d normalize(vNormalWorld);\n        albedo_ *\x3d 1.2;\n        vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff \x3d vColor.r;\n        float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight +\x3d backLightFactor * lightingMainIntensity;"]))),
1===a.pbrMode||2===a.pbrMode?1===a.viewingMode?C.glsl(L||(L=d.__makeTemplateObject(["vec3 normalGround \x3d normalize(vpos + localOrigin);"],["vec3 normalGround \x3d normalize(vpos + localOrigin);"]))):C.glsl(M||(M=d.__makeTemplateObject(["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"],["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"]))):C.glsl(Q||(Q=d.__makeTemplateObject([""],[""]))),1===a.pbrMode||2===a.pbrMode?C.glsl(R||(R=d.__makeTemplateObject(["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"],
["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);")));n.include(u.DefaultMaterialAuxiliaryPasses,a);return n};var G,F,H,J,I,K,L,M,
Q,R,O})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../support/pointUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O,N,S,P,U,Z){function V(a){return b.isSome(a)?"cross"===a||"x"===a:!1}Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DIconSymbolLayer=void 0;var T=u.mat4f64.create(),Y=q.vec3f64.fromValues(0,0,1),X=[.25,.25,.75,.75],ca=[64,64];u=function(a){function v(b,c,d,e){b=a.call(this,b,c,d,e)||this;b._cimLayers=null;b._cimSymbolMaterials=new Map;b._cimSymbolTextures=new Map;b._cimMaterialParametersInfo=null;b._cimRequiredFields=
null;b._cimScaleFactorOrFunction=null;b._size=null;b._symbolTextureRatio=1;b._outlineSize=0;b._texture=null;b._releaseTexture=null;b._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return b}d.__extends(v,a);v.prototype.getCachedSize=function(){return{size:this._getIconSize()}};v.prototype.doLoad=function(a){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g;return d.__generator(this,function(d){switch(d.label){case 0:this._validateOrThrow();c=this._prepareMaterialParameters();
e=this._getPrimitive();if(!b.isSome(e))return[3,1];this._prepareResourcesPrimitive(c,e);return[3,5];case 1:return f=B.getIconHref(this.symbol,this.symbolLayer),(g=t.dataComponents(f))&&"application/json"===g.mediaType?[4,this._prepareResourcesCIM(c,JSON.parse(g.data),a)]:[3,3];case 2:return d.sent(),[3,5];case 3:return[4,this._prepareResourcesHref(c,f,a)];case 4:d.sent(),d.label=5;case 5:return[2]}})})};v.prototype._validateOrThrow=function(){if(!this._drivenProperties.size){var a=K.validateSymbolLayerSize(this._getIconSize());
if(a)throw new h("graphics3diconsymbollayer:invalid-size",a);}};v.prototype._getIconSize=function(){var a=this.symbolLayer,a=Math.round(null!=a.size?p.pt2px(a.size):16);return this._drivenProperties.size?Math.max(a,64):a};v.prototype._generateTextureCIM=function(a){var b=this._getGraphicHash(a),c=""===b?null:this._cimSymbolTextures.get(b);c||(a=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,a,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,
null),this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",a.anchorPosition),c=new U(a.imageData,"symbol",{width:a.imageData.width,height:a.imageData.height,powerOfTwoResizeMode:2}),this._cimSymbolTextures.set(b,c),this._context.stage.add(4,c));return c};v.prototype._computeSize=function(a,b){a=a.width/a.height;return 1<a?[b,Math.round(b/a)]:[Math.round(b*a),b]};v.prototype._prepareMaterialParameters=function(){var a={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},
b=this.symbol;if(b&&"point-3d"===b.type&&b.hasVisibleVerticalOffset()){var b=b.verticalOffset,c=b.minWorldLength,d=b.maxWorldLength;a.verticalOffset={screenLength:p.pt2px(b.screenLength),minWorldLength:c||0,maxWorldLength:null!=d?d:Infinity}}this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);a.occlusionTest=!0;a.slicePlaneEnabled=this._context.slicePlaneEnabled;return a};v.prototype._prepareResourcesPrimitive=function(a,
b){var d=this,e=this._getOutlineSize();if(V(b)&&0===e)throw Error("Nothing to render");this._outlineSize=e;a.color=this._getFillColor();a.outlineColor=this._getOutlineColor();a.outlineSize=this._outlineSize;var f=this._context.sharedResources.textures.fromData(b,function(){var a;switch(b){case "circle":a=M.createCircle(128,64);break;case "square":a=M.createSquare(128,64);break;case "kite":a=M.createKite(128,64);break;case "cross":a=M.createCross(128,64);break;case "x":a=M.createX(128,64);break;case "triangle":a=
M.createTriangle(128,64);break;default:c.neverReached(b)}return new U(a,"sdf_"+b,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})});this._texture=f.texture;this._releaseTexture=function(){return d._context.sharedResources.textures.release(f.uid)};a.textureIsSignedDistanceField=!0;a.distanceFieldBoundingBox=X;a.textureId=this._texture.id;e=this._getIconSize();this._size=[e,e];this._symbolTextureRatio=2;this._createMaterialAndAddToStage(a,this._context.stage)};v.prototype._prepareResourcesHref=
function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var f,k,p,l,r,q,v,u,w=this;return d.__generator(this,function(d){switch(d.label){case 0:if(!m("esri-canvas-svg-support")&&t.isSVG(b))throw f="IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)",new h("graphics3diconsymbollayer:unsupported-image-format",f);this._outlineSize=this._getOutlineSize();a.color=this._getFillColor();a.outlineColor=this._getOutlineColor();a.outlineSize=this._outlineSize;a.textureIsSignedDistanceField=
!1;k=this._getIconSize();p=k*this._context.layerView.view.pixelRatio;return[4,e.result(this._context.sharedResources.textures.fromUrl(b,p,{signal:c}))];case 1:l=d.sent();if(!1===l.ok)throw g.throwIfAbortError(l.error),f="Failed to load (Request for icon resource failed: "+b+")",new h("graphics3diconsymbollayer:request-failed",f);r=l.value;q=r.uid;v=r.texture;this._releaseTexture=function(){return w._context.sharedResources.textures.release(q)};u=v.params;this._size=this._computeSize(u,k);a.textureId=
v.id;this._createMaterialAndAddToStage(a,this._context.stage);return[2]}})})};v.prototype._prepareResourcesCIM=function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var e,f,h,m,p,l,r,t,q,v,u,w;return d.__generator(this,function(d){switch(d.label){case 0:return e=new k.CIMSymbol({data:b}),this._context.sharedResources.cimSymbolRasterizer?[3,2]:[4,new Promise(function(a,b){n(["../../../../symbols/cim/CIMSymbolRasterizer"],a,b)})];case 1:f=d.sent().CIMSymbolRasterizer,g.throwIfAborted(c),
this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new f(this._context.renderCoordsHelper.spatialReference,!0)),d.label=2;case 2:return h=this._context.layer.fields?this._context.layer.fields.map(function(a){return a.toJSON()}):null,m=this,[4,this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(e,h,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:c})];
case 3:m._cimLayers=d.sent();if(!this._context.renderer||"dictionary"!==this._context.renderer.type||!this._context.renderer.scaleExpression)return[3,6];r=this._context.renderer;if(!isNaN(r.scaleExpression))return[3,5];t=r.scaleExpression;return[4,z.createRendererExpression(t,this._context.layer.spatialReference,h)];case 4:return q=d.sent(),l=function(a,b,c){a=A.default(q,a,{$view:c},"esriGeometryPoint",b);return null!==a?a:1},[3,6];case 5:p=Number(r.scaleExpression),d.label=6;case 6:this._cimScaleFactorOrFunction=
p||l||1;if(this._context.renderer)return[3,7];u=[];return[3,9];case 7:return[4,this._context.renderer.getRequiredFields(this._context.layer.fields)];case 8:u=d.sent(),d.label=9;case 9:return v=u,g.throwIfAborted(c),w=this._context.layer.fieldsIndex,this._cimRequiredFields=v.map(function(a){return w.get(a).name}),this._cimMaterialParametersInfo=a,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=
0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1,[2]}})})};v.prototype._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||x.defaultPrimitive};v.prototype._getOutlineSize=function(){var a=0,a=this.symbolLayer;if(b.isSome(a.outline)&&null!=a.outline.size)return Math.max(p.pt2px(a.outline.size),0);a=this._getPrimitive();a=V(a)?1.5:0;return Math.max(a,0)};v.prototype._getOutlineColor=
function(){var a=this._getLayerOpacity(),c=b.get(this.symbolLayer,"outline","color");if(b.isSome(c)){var d=l.toUnitRGB(c);return[d[0],d[1],d[2],c.a*a]}return[0,0,0,0]};v.prototype._getFillColor=function(){if(V(this._getPrimitive()))return C.TRANSPARENT_UNIT;var a=b.isNone(this._getPrimitive()),c=b.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(c,{hasIntrinsicColor:a})};v.prototype._getAnchorPos=function(a,b){return"relative"===a?r.vec2f64.fromValues((b.x||0)+.5,-(b.y||
0)+.5):a in K.namedAnchorToHUDMaterialAnchorPos?K.namedAnchorToHUDMaterialAnchorPos[a]:K.namedAnchorToHUDMaterialAnchorPos.center};v.prototype._createMaterialAndAddToStage=function(a,b){this._fastUpdates=this._cimLayers?{enabled:!1}:Q.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&f.mixin(a,this._fastUpdates.materialParameters);if(this._cimLayers){var c=this._cimSymbolMaterials.get(a.textureId);c||(c=new Z.default(a,this._getIdHint("_icon")),
this._cimSymbolMaterials.set(a.textureId,c),b.add(3,c));return c}this._material=new Z.default(a,this._getIdHint("_icon"));b.add(3,this._material);return this._material};v.prototype._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(function(a){a.setParameterValues({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0})}),this.layerOpacityChanged())};v.prototype.destroy=function(){var c=this;a.prototype.destroy.call(this);
this._forEachMaterial(function(a){c._context.stage.remove(3,a.id)});b.isSome(this._material)&&(this._material=null);this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(function(a){c._context.stage.remove(4,a.id)});this._cimSymbolTextures.clear();this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)};v.prototype._getScaleFactor=function(a,b){if(this._drivenProperties.size&&a.size){for(var c=0;3>c;c++){var d=a.size[c];d&&"symbol-value"!==d&&"proportional"!==d&&(a.size[c]=
p.pt2px(d))}if("symbol-value"===a.size[0])return 1;if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}return 1};v.prototype.createGraphics3DGraphic=function(a){var c=a.renderingInfo,e=a.graphic,f,g;if(this._cimLayers){if(!this._cimLayers.length)return null;var h=this._generateTextureCIM(e);g=d.__assign({textureId:h.id},this._cimMaterialParametersInfo);g=this._createMaterialAndAddToStage(g,this._context.stage);f=[h.params.width,h.params.height]}else f=this._size,
g=b.unwrap(this._material);if(!this._validateGeometry(e.geometry))return null;h=L.placePointOnGeometry(e.geometry);if(b.isNone(h))return this.logger.warn("unsupported geometry type for icon symbol: "+e.geometry.type),null;var m="graphic"+e.uid,k=this._getVertexOpacityAndColor(c),p=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(p=this._getScaleFactor(c,f[0]>f[1]?f[0]:f[1]));p*=this._symbolTextureRatio;c=[f[0]*p,f[1]*p];f=this.setGraphicElevationContext(e,new F.ElevationContext);
this.ensureDrapedStatus("on-the-ground"===f.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(e,h,g,k,c,a.layer.uid):this._createAs3DShape(e,h,g,k,c,f,m,e.uid)};v.prototype.layerOpacityChanged=function(){var a=this._getFillColor(),b=this._getOutlineColor();this._forEachMaterial(function(c){c.setParameterValues({color:a});c.setParameterValues({outlineColor:b})});return!0};v.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;
c=G.elevationModeChangeUpdateType(v.elevationModeChangeTypes,c,d);if(c!==G.SymbolUpdateType.UPDATE)return c;var e=G.needsElevationUpdates2D(d)||"absolute-height"===d;return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};v.prototype.slicePlaneEnabledChanged=function(){var a=this;this.draped||this._forEachMaterial(function(b){b.setParameterValues({slicePlaneEnabled:a._context.slicePlaneEnabled})});return!0};v.prototype.physicalBasedRenderingChanged=function(){return!0};v.prototype.pixelRatioChanged=
function(){return this._getPrimitive()?!0:!1};v.prototype.applyRendererDiff=function(a,c){for(var d in a.diff)switch(d){case "visualVariables":if(Q.updateFastSymbolUpdatesState(this._fastUpdates,c,this._fastVisualVariableConvertOptions()))b.isSome(this._material)&&this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};v.prototype._defaultElevationInfoNoZ=function(){return ba};v.prototype._createAs3DShape=function(a,b,c,d,e,f,g,h){var m=
this,k=this.getFastUpdateAttrValues(a);a=k?function(a){return Q.evaluateModelTransform(m._fastUpdates.materialParameters,k,a)}:null;d=S.createPointGeometry(Y,null,d,e,ga,null,k);d=[new N(d,g)];g=L.createStageObjectForHUD(this._context,b,d,[c],null,null,f,g,this._context.layer.uid,h,a);if(null===g)return null;var p=new J(this,g.object,d,null,null,E.perObjectElevationAligner,f);p.alignedSampledElevation=g.sampledElevation;p.needsElevationUpdates=G.needsElevationUpdates2D(f.mode)||"absolute-height"===
f.mode;p.getScreenSize=this._createScreenSizeGetter(e,a);p.calculateRelativeScreenBounds=function(a){return c.calculateRelativeScreenBounds(p.getScreenSize(),1,a)};L.extendPointGraphicElevationContext(p,b,this._context.elevationProvider);return p};v.prototype._createAsOverlay=function(a,c,d,e,f,g){var h=this;d.renderPriority=this._renderPriority;var m=q.vec3f64.create();R.pointToVector(c,m,this._context.overlaySR);m[2]=O.DRAPED_Z;c=this._context.clippingExtent;if(b.isSome(c)&&!w.containsPoint(c,m))return null;
var k=this.getFastUpdateAttrValues(a);c=k?function(a){return Q.evaluateModelTransform(h._fastUpdates.materialParameters,k,a)}:null;e=S.createPointGeometry(Y,m,e,f,null,null,k);e=new P(e);e.material=d;e.center=m;e.bsRadius=0;e.data.layerUid=g;e.data.graphicUid=a.uid;e.calculateShaderTransformation=c;var p=new H(this,[e],null);p.getScreenSize=this._createScreenSizeGetter(f,c);p.calculateRelativeScreenBounds=function(a){return d.calculateRelativeScreenBounds(p.getScreenSize(),1,a)};return p};v.prototype._createScreenSizeGetter=
function(a,b){var c=this._outlineSize+2;if(this._fastUpdates.enabled){var d=a[0]/this._symbolTextureRatio,e=a[1]/this._symbolTextureRatio;return function(a){void 0===a&&(a=r.vec2f64.create());var f=b(T);a[0]=f[0]*d+c;a[1]=f[5]*e+c;return a}}var f=a[0]/this._symbolTextureRatio+c,g=a[1]/this._symbolTextureRatio+c;return function(a){void 0===a&&(a=r.vec2f64.create());a[0]=f;a[1]=g;return a}};v.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],
b=q.vec3f64.fromValues(a,a,a),c=p.px2pt(1),a=a*c,a=q.vec3f64.fromValues(a,a,a);return{modelSize:b,symbolSize:a,unitInMeters:c,transformation:{anchor:q.vec3f64.ZEROS,scale:q.vec3f64.ONES,rotation:q.vec3f64.ZEROS}}};v.prototype._getGraphicHash=function(a){for(var b="",c=0,d=this._cimRequiredFields;c<d.length;c++)var e=d[c],b=b+(e+a.attributes[e]);return b};v.prototype._forEachMaterial=function(a){b.isSome(this._material)&&a(this._material);this._cimSymbolMaterials.forEach(a)};v.PRIMITIVE_SIZE=ca;v.elevationModeChangeTypes=
{definedChanged:G.SymbolUpdateType.UPDATE,staysOnTheGround:G.SymbolUpdateType.NONE,onTheGroundChanged:G.SymbolUpdateType.RECREATE};return v}(I.default);a.Graphics3DIconSymbolLayer=u;var ba={mode:"relative-to-ground",offset:0},ga=v.vec4f64.fromValues(0,0,0,1);a.default=u})},"esri/symbols/support/utils":function(){define("require exports tslib ../../Color ../../symbols ../../core/asyncUtils ../../core/compilerUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../core/libs/gl-matrix-2/vec3f64 ./gfxUtils ./Symbol3DMaterial @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p){function t(a,b){if(null==b)return a;a=a.toRgba();a[3]*=b;return new l(a)}function u(a,b,c){if(a=a.symbolLayers){var d=function(a){a=m.isSome(a)?a:null;b=b||a||null!=c&&C;return t(b,c)};a.forEach(function(a){if("object"!==a.type||null==a.resource.href||b)if("water"===a.type)a.color=d(a.color);else{var e=m.isSome(a.material)?a.material.color:null,e=d(e);m.isNone(a.material)?a.material=new p.default({color:e}):a.material.color=e;null!=c&&"outline"in a&&m.isSome(a.outline)&&
m.isSome(a.outline.color)&&(a.outline.color=t(a.outline.color,c))}})}}function r(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,f=this;return d.__generator(this,function(g){switch(g.label){case 0:return(c=a.symbolLayers)?[4,e.forEach(c,function(a){return d.__awaiter(f,void 0,void 0,function(){return d.__generator(this,function(c){return[2,q(a,b)]})})})]:[2];case 1:return g.sent(),[2]}})})}function q(a,e){return d.__awaiter(this,void 0,void 0,function(){var f;return d.__generator(this,
function(d){switch(d.label){case 0:f=a.type;switch(f){case "extrude":return[3,1];case "icon":return[3,2];case "line":return[3,2];case "text":return[3,2];case "path":return[3,3];case "object":return[3,4];case "fill":return[3,6];case "water":return[3,6]}return[3,7];case 1:return a.size="number"===typeof e[2]?e[2]:0,[3,8];case 2:return d=v(e),m.isSome(d)&&(a.size=d),[3,8];case 3:return d=z(e,b.vec3f64.ONES,[a.width,void 0,a.height]),a.width=B(e[0],a.width,1,d),a.height=B(e[2],a.height,1,d),[3,8];case 4:return[4,
w(a,e)];case 5:return d.sent(),[3,8];case 6:return[3,8];case 7:c.neverReached(a),d.label=8;case 8:return[2]}})})}function v(a){for(var b=0;b<a.length;b++){var c=a[b];if("number"===typeof c)return c}return null}function w(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g;return d.__generator(this,function(d){switch(d.label){case 0:return[4,x(a)];case 1:return c=d.sent(),e=c.resourceSize,f=c.symbolSize,g=z(b,e,f),a.width=B(b[0],f[0],e[0],g),a.depth=B(b[1],f[1],e[1],g),a.height=B(b[2],
f[2],e[2],g),[2]}})})}function z(a,b,c){for(var d=0;3>d;d++){var e=a[d];switch(e){case "symbol-value":return null!=c[d]?c[d]/b[d]:1;case "proportional":break;default:if(e&&b[d])return e/b[d]}}return 1}function x(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e,f,g,h,m,k;return d.__generator(this,function(d){switch(d.label){case 0:return[4,new Promise(function(a,b){n(["./symbolLayerUtils"],a,b)})];case 1:return b=d.sent(),[4,b.computeObjectLayerResourceSize(a,10)];case 2:c=d.sent();e=
a.width;f=a.height;g=a.depth;h=[e,g,f];m=1;for(k=0;3>k;k++)if(null!=h[k]){m=h[k]/c[k];break}for(k=0;3>k;k++)null==h[k]&&(h[k]=c[k]*m);return[2,{resourceSize:c,symbolSize:h}]}})})}function B(a,b,c,d){switch(a){case "proportional":return c*d;case "symbol-value":return null!=b?b:c;default:return a}}Object.defineProperty(a,"__esModule",{value:!0});a.applyRotationToSymbol=a.applySizesToSymbol=a.applyColorToSymbol=a.applyOpacityToColor=a.getIconHref=a.isVolumetricSymbol=a.getSymbolOutlineSize=void 0;var A=
/\/resource\/(.*?)\.svg$/,C=new l("white");a.getSymbolOutlineSize=function(a){if(!a)return 0;if(k.isSymbol3D(a)){var b=a.symbolLayers&&a.symbolLayers.length;b?(a=a.symbolLayers.getItemAt(b-1),a="outline"in a?m.get(a,"outline","size"):void 0):a=void 0;return m.isSome(a)?a:0}return(a=g.getStroke(a))&&f.px2pt(a.width)||0};a.isVolumetricSymbol=function(a){if(!a||!a.symbolLayers)return!1;switch(a.type){case "point-3d":return a.symbolLayers.some(function(a){return"object"===a.type});case "line-3d":return a.symbolLayers.some(function(a){return"path"===
a.type});case "polygon-3d":return a.symbolLayers.some(function(a){return"object"===a.type||"extrude"===a.type});default:return!1}};a.getIconHref=function(a,b){b=b.resource.href;return!h("esri-canvas-svg-support")&&a.styleOrigin&&A.test(b)?b.replace(A,"/resource/png/$1.png"):b};a.applyOpacityToColor=t;a.applyColorToSymbol=function(a,b,c){if(a&&(b||null!=c))if(b&&(b=new l(b)),k.isSymbol3D(a))u(a,b,c);else if(k.isSymbol2D(a)){if(b=b||a.color)a.color=t(b,c);null!=c&&"outline"in a&&a.outline&&a.outline.color&&
(a.outline.color=t(a.outline.color,c))}};a.applySizesToSymbol=function(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(d){if(!a||!b)return[2];if(k.isSymbol3D(a))return[2,r(a,b)];if(k.isSymbol2D(a)&&(d=v(b),!m.isNone(d)))switch(a.type){case "simple-marker":a.size=d;break;case "picture-marker":var e=a.width/a.height;1<e?(a.width=d,a.height=d*e):(a.width=d*e,a.height=d);break;case "simple-line":a.width=d;break;case "text":a.font.size=d;break;case "simple-fill":case "picture-fill":break;
case "cim":break;default:c.neverReached(a)}return[2]})})};a.applyRotationToSymbol=function(a,b,c){a&&null!=b&&(k.isSymbol3D(a)?(a=a.symbolLayers)&&a.forEach(function(a){if(a&&"object"===a.type)switch(c){case "tilt":a.tilt=b;break;case "roll":a.roll=b;break;default:a.heading=b}}):!k.isSymbol2D(a)||"simple-marker"!==a.type&&"picture-marker"!==a.type&&"text"!==a.type||(a.angle=b))}})},"esri/symbols/support/gfxUtils":function(){define("require exports ../../assets ../../Color ../../request ../../core/ItemCache ../../core/promiseUtils ../../core/screenUtils ./cimSymbolUtils".split(" "),
function(n,a,d,l,k,e,c,h,m){function f(a){if(!a)return null;var b;switch(a.type){case "simple-fill":case "picture-fill":case "simple-marker":b=f(a.outline);break;case "simple-line":var c=h.pt2px(a.width);"none"!==a.style&&0!==c&&(b={color:a.color,style:u(a.style),width:c,cap:a.cap,join:"miter"===a.join?h.pt2px(a.miterLimit):a.join});break;default:b=null}return b}Object.defineProperty(a,"__esModule",{value:!0});a.defaultThematicColor=a.getStroke=a.getPatternUrlWithColor=a.getFill=a.getSVGBaselineShift=
a.getSVGBaseline=a.getSVGAlign=void 0;var b=d.getAssetUrl("esri/symbols/patterns/"),g={left:"start",center:"middle",right:"end",justify:"start"},p={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},t=new e(1E3);a.getSVGAlign=function(a){return a=(a=a.horizontalAlignment)&&g[a.toLowerCase()]||"middle"};a.getSVGBaseline=function(a){return(a=a.verticalAlignment)&&p[a.toLowerCase()]||"alphabetic"};a.getSVGBaselineShift=function(a){return"bottom"===a.verticalAlignment?
"super":null};a.getFill=function(a){var c=a.style,d=null;if(a)switch(a.type){case "simple-marker":"cross"!==c&&"x"!==c&&(d=a.color);break;case "simple-fill":"solid"===c?d=a.color:"none"!==c&&(d={type:"pattern",x:0,y:0,src:b+c+".png",width:5,height:5});break;case "picture-fill":d={type:"pattern",src:a.url,width:h.pt2px(a.width)*a.xscale,height:h.pt2px(a.height)*a.yscale,x:h.pt2px(a.xoffset),y:h.pt2px(a.yoffset)};break;case "text":d=a.color;break;case "cim":d=m.getCIMSymbolColor(a)}return d};a.getPatternUrlWithColor=
function(a,b){var d=a+"-"+b;return void 0!==t.get(d)?c.resolve(t.get(d)):k(a,{responseType:"image"}).then(function(a){a=a.data;var c=a.naturalWidth,e=a.naturalHeight,f=document.createElement("canvas");f.width=c;f.height=e;var g=f.getContext("2d");g.fillStyle=b;g.fillRect(0,0,c,e);g.globalCompositeOperation="destination-in";g.drawImage(a,0,0);a=f.toDataURL();t.put(d,a);return a})};a.getStroke=f;var u=function(){var a={};return function(b){if(a[b])return a[b];var c=b.replace(/-/g,"");return a[b]=c}}();
a.defaultThematicColor=new l([128,128,128])})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(n,a,d){return function(){function a(a,e){this._storage=new d.MemCacheStorage;this._storage.maxSize=a;e&&this._storage.registerRemoveFunc("",e)}a.prototype.put=function(a,d){this._storage.put(a,d,1,1)};a.prototype.pop=function(a){return this._storage.pop(a)};a.prototype.get=function(a){return this._storage.get(a)};a.prototype.clear=function(){this._storage.clearAll()};
a.prototype.destroy=function(){this._storage.clearAll()};return a}()})},"esri/symbols/support/cimSymbolUtils":function(){define(["require","exports","../../Color","../cim/utils"],function(n,a,d,l){function k(a){var b=l.toCIMSymbolJSON(a);if("CIMTextSymbol"===b.type)return b.height;a=0;if(b.symbolLayers)for(var c=0,b=b.symbolLayers;c<b.length;c++){var d=b[c];l.isCIMMarker(d)&&d.size>a?a=d.size:l.isCIMStroke(d)&&d.width>a?a=d.width:l.isCIMFill(d)}return a}function e(a,b,d){if("CIMTextSymbol"===a.type)a.height*=
b;else{if(d&&a.effects){d=0;for(var f=a.effects;d<f.length;d++)m(f[d],b)}if(a.symbolLayers)for(d=0,a=a.symbolLayers;d<a.length;d++)switch(f=a[d],f.type){case "CIMPictureMarker":case "CIMVectorMarker":c(f,b);break;case "CIMPictureStroke":case "CIMSolidStroke":f.width*=b;break;case "CIMPictureFill":f.height*=b;f.offsetX*=b;f.offsetY*=b;break;case "CIMHatchFill":e(f.lineSymbol,b,!0),f.offsetX*=b,f.offsetY*=b,f.separation*=b}}}function c(a,b){a.markerPlacement&&h(a.markerPlacement,b);a.offsetX*=b;a.offsetY*=
b;a.anchorPoint&&"Absolute"===a.anchorPointUnits&&(a.anchorPoint={x:a.anchorPoint.x*b,y:a.anchorPoint.y*b});a.size*=b;if("CIMVectorMarker"===a.type&&a.markerGraphics)for(var c=0,d=a.markerGraphics;c<d.length;c++){var f=d[c];a.scaleSymbolsProportionally||e(f.symbol,b,!0)}}function h(a,b){l.isCIMMarkerStrokePlacement(a)&&(a.offset*=b);switch(a.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":a.customEndingOffset*=b;a.offsetAlongLine*=b;if(a.placementTemplate&&
a.placementTemplate.length){var c=a.placementTemplate.map(function(a){return a*b});a.placementTemplate=c}break;case "CIMMarkerPlacementAlongLineVariableSize":a.maxRandomOffset*=b;a.placementTemplate&&a.placementTemplate.length&&(c=a.placementTemplate.map(function(a){return a*b}),a.placementTemplate=c);break;case "CIMMarkerPlacementOnLine":a.startPointOffset*=b;break;case "CIMMarkerPlacementAtExtremities":a.offsetAlongLine*=b;break;case "CIMMarkerPlacementAtRatioPositions":a.beginPosition*=b;a.endPosition*=
b;break;case "CIMMarkerPlacementPolygonCenter":a.offsetX*=b;a.offsetY*=b;break;case "CIMMarkerPlacementInsidePolygon":a.offsetX*=b,a.offsetY*=b,a.stepX*=b,a.stepY*=b}}function m(a,b){switch(a.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":a.width*=b;break;case "CIMGeometricEffectBuffer":a.size*=b;break;case "CIMGeometricEffectCut":a.beginCut*=b;a.endCut*=b;a.middleCut*=b;break;case "CIMGeometricEffectDashes":a.customEndingOffset*=b;a.offsetAlongLine*=b;if(a.dashTemplate&&a.dashTemplate.length){var c=
a.dashTemplate.map(function(a){return a*b});a.dashTemplate=c}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":a.length*=b;break;case "CIMGeometricEffectMove":a.offsetX*=b;a.offsetY*=b;break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":a.offset*=b;break;case "CIMGeometricEffectRegularPolygon":a.radius*=b;break;case "CIMGeometricEffectTaperedPolygon":a.fromWidth*=b;a.length*=b;a.toWidth*=b;break;case "CIMGeometricEffectWave":a.amplitude*=
b,a.period*=b}}function f(a,c){var d;d="CIMTextSymbol"===a.type?a.symbol:a;a="CIMPolygonSymbol"===a.type;if(d.symbolLayers){var e=0;for(d=d.symbolLayers;e<d.length;e++){var g=d[e];if(!(g.colorLocked||a&&(l.isCIMStroke(g)||l.isCIMMarker(g)&&g.markerPlacement&&l.isCIMMarkerStrokePlacement(g.markerPlacement))))switch(g.type){case "CIMVectorMarker":g.markerGraphics.forEach(function(a){f(a.symbol,c)});break;case "CIMSolidStroke":case "CIMSolidFill":b(c,g.color);break;case "CIMHatchFill":f(g.lineSymbol,
c)}}}}function b(a,b){for(var c=0;c<a.length;c++)if(a[c].join(".")===b.join("."))return;a.push(b)}function g(a,b){var c;c="CIMTextSymbol"===a.type?a.symbol:a;a="CIMPolygonSymbol"===a.type?!0:!1;if(c.symbolLayers){var d=0;for(c=c.symbolLayers;d<c.length;d++){var e=c[d];if(!(e.colorLocked||a&&(l.isCIMStroke(e)||l.isCIMMarker(e)&&e.markerPlacement&&l.isCIMMarkerStrokePlacement(e.markerPlacement)))){var f=b.toArray(0);switch(e.type){case "CIMVectorMarker":e.markerGraphics.forEach(function(a){g(a.symbol,
b)});break;case "CIMSolidStroke":case "CIMSolidFill":e.color=f;break;case "CIMHatchFill":g(e.lineSymbol,b)}}}}}Object.defineProperty(a,"__esModule",{value:!0});a.applyCIMSymbolRotation=a.getCIMSymbolRotation=a.applyCIMSymbolColor=a.getCIMSymbolColor=a.scaleCIMMarker=a.scaleCIMSymbolTo=a.getCIMSymbolSize=void 0;a.getCIMSymbolSize=k;a.scaleCIMSymbolTo=function(a,b){var c=l.toCIMSymbolJSON(a);a=k(a);if(0===a)if("CIMTextSymbol"===c.type)c.height=b;else{if(c.symbolLayers)for(a=0,c=c.symbolLayers;a<c.length;a++){var d=
c[a];switch(d.type){case "CIMPictureMarker":case "CIMVectorMarker":d.size=b;break;case "CIMPictureStroke":case "CIMSolidStroke":d.width=b}}}else e(c,b/a,!1)};a.scaleCIMMarker=c;a.getCIMSymbolColor=function(a){a=l.toCIMSymbolJSON(a);var b=[];f(a,b);return b.length?new d(l.fromCIMColor(b[0])):null};a.applyCIMSymbolColor=function(a,b){b instanceof d||(b=new d(b));a=l.toCIMSymbolJSON(a);g(a,b)};a.getCIMSymbolRotation=function(a){a=l.toCIMSymbolJSON(a);return"CIMTextSymbol"===a.type||"CIMPointSymbol"===
a.type?a.angle||0:0};a.applyCIMSymbolRotation=function(a,b){a=l.toCIMSymbolJSON(a);if("CIMTextSymbol"===a.type)a.angle=b;else if("CIMPointSymbol"===a.type&&a.symbolLayers)for(var c=b-(a.angle||0),d=0,e=a.symbolLayers;d<e.length;d++){var f=e[d];if(l.isCIMMarker(f)){var g=f.rotation||0,g=f.rotateClockwise?g-c:g+c;f.rotation=g}a.angle=b}}})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(n,a){function d(a,d){"string"!==typeof a&&(a=String(a));switch(d){case "LowerCase":return a.toLowerCase();
case "Allcaps":return a.toUpperCase();default:return a}}Object.defineProperty(a,"__esModule",{value:!0});a.isCIMMarkerStrokePlacement=a.isCIMFill=a.isCIMStroke=a.isCIMMarker=a.toCIMSymbolJSON=a.fromCIMColor=a.resampleHermite=a._adjustTextCase=a.createLabelOverrideFunction=a.colorToArray=a.evaluateValueOrFunction=void 0;a.evaluateValueOrFunction=function(a,d,e,c){return"function"===typeof a?a(d,e,c):a};a.colorToArray=function(a){return[a.r,a.g,a.b,a.a]};a.createLabelOverrideFunction=function(a,k,e){var c=
function(a){for(var b=a.length;b--;)if(-1===" /-,\n".indexOf(a.charAt(b)))return!1;return!0},h=[],m=0,f=-1;do f=k.indexOf("[",m),f>=m&&(f>m&&(m=k.substr(m,f-m),h.push([m,null,c(m)])),m=f+1,f=k.indexOf("]",m),f>=m&&(f>m&&(m=k.substr(m,f-m),(m=a[m])&&h.push([null,m,!1])),m=f+1));while(-1!==f);m<k.length-1&&(m=k.substr(m),h.push([m,null,c(m)]));return function(a){for(var b="",c=null,f=0;f<h.length;f++){var m=h[f],k=m[0],l=m[1],m=m[2];if(k)m?c=k:(c&&(b+=c,c=null),b+=k);else if(k=a.attributes[l])c&&(b+=
c,c=null),b+=k}return d(b,e)}};a._adjustTextCase=d;a.resampleHermite=function(a,d,e,c,h,m,f){void 0===f&&(f=!0);var b=d/h;e/=m;for(var g=Math.ceil(b/2),k=Math.ceil(e/2),l=0;l<m;l++)for(var u=0;u<h;u++){for(var r=4*(u+(f?m-l-1:l)*h),q=0,v=0,w=0,z=0,x=0,B=0,A=0,C=(l+.5)*e,n=Math.floor(l*e);n<(l+1)*e;n++)for(var G=Math.abs(C-(n+.5))/k,F=(u+.5)*b,G=G*G,H=Math.floor(u*b);H<(u+1)*b;H++){var J=Math.abs(F-(H+.5))/g,q=Math.sqrt(G+J*J);-1<=q&&1>=q&&(q=2*q*q*q-3*q*q+1,0<q&&(J=4*(H+n*d),A+=q*a[J+3],w+=q,255>
a[J+3]&&(q=q*a[J+3]/250),z+=q*a[J],x+=q*a[J+1],B+=q*a[J+2],v+=q))}c[r]=z/v;c[r+1]=x/v;c[r+2]=B/v;c[r+3]=A/w}};a.fromCIMColor=function(a){return a?{r:a[0],g:a[1],b:a[2],a:a[3]/255}:{r:0,g:0,b:0,a:0}};a.toCIMSymbolJSON=function(a){var d;return null===(d=a.data)||void 0===d?void 0:d.symbol};a.isCIMMarker=function(a){return"CIMVectorMarker"===a.type||"CIMPictureMarker"===a.type||"CIMBarChartMarker"===a.type||"CIMCharacterMarker"===a.type||"CIMPieChartMarker"===a.type||"CIMStackedBarChartMarker"===a.type};
a.isCIMStroke=function(a){return"CIMGradientStroke"===a.type||"CIMPictureStroke"===a.type||"CIMSolidStroke"===a.type};a.isCIMFill=function(a){return"CIMGradientFill"===a.type||"CIMHatchFill"===a.type||"CIMPictureFill"===a.type||"CIMSolidFill"===a.type||"CIMWaterFill"===a.type};a.isCIMMarkerStrokePlacement=function(a){return"CIMMarkerPlacementAlongLineRandomSize"===a.type||"CIMMarkerPlacementAlongLineSameSize"===a.type||"CIMMarkerPlacementAlongLineVariableSize"===a.type||"CIMMarkerPlacementAtExtremities"===
a.type||"CIMMarkerPlacementAtMeasuredUnits"===a.type||"CIMMarkerPlacementAtRatioPositions"===a.type||"CIMMarkerPlacementOnLine"===a.type||"CIMMarkerPlacementOnVertices"===a.type}})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define("require exports tslib ../../../core/Error ../../../core/Logger ../../../geometry/support/quantizationUtils".split(" "),function(n,a,d,l,k,e){function c(a){var c={};switch(a){case "esriGeometryPoint":return function(a,d,f,h){return e.unquantizePoint(d,
c,a,f,h)};case "esriGeometryPolygon":return function(a,d,f,h){return e.unquantizePolygon(d,c,a,f,h)};case "esriGeometryPolyline":return function(a,d,f,h){return e.unquantizePolyline(d,c,a,f,h)};case "esriGeometryMultipoint":return function(a,d,f,h){return e.unquantizeMultipoint(d,c,a,f,h)};default:return k.getLogger("esri.views.2d.support.arcadeOnDemand").error(new l("mapview-arcade","Unable to handle geometryType: "+a)),function(a){return a}}}Object.defineProperty(a,"__esModule",{value:!0});a.default=
function(a,e,b,g,l){if(a.referencesGeometry()&&l){var f=l.transform,m=l.hasZ;l=l.hasM;h.has(g)||h.set(g,c(g));g=h.get(g)(e.geometry,f,m,l);e=d.__assign(d.__assign({},e),{geometry:g})}e=a.repurposeFeature(e);try{return a.evaluate(d.__assign(d.__assign({},b),{$feature:e}))}catch(r){return k.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",r),null}};var h=new Map})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec4f64"],
function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.WHITE_UNIT=a.TRANSPARENT_UNIT=a.SUSPEND_RESUME_EXTENT_OPTIMISM=a.defaultIconElevationOffset=void 0;a.defaultIconElevationOffset=1;a.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;a.TRANSPARENT_UNIT=d.vec4f64.ZEROS;a.WHITE_UNIT=d.vec4f64.ONES})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils".split(" "),
function(n,a,d,l,k,e,c,h){n=function(){function a(a,b,c){this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=c;this.type="draped";this.stage=null;this._addedToStage=this._visible=!1;this._layerView=null;this.isElevationSource=!1}a.prototype.initialize=function(a,b,c){this.stage=a;this._layerView=c;this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer};a.prototype.setVisibility=function(a){if(null!=this.stage){if(this._visible!==a){if((this._visible=a)&&
!this._addedToStage)return this._addedToStage=!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,1),!0;if(!a&&!this._addedToStage)return!1;a=0;for(var b=this.renderGeometries;a<b.length;a++)b[a].instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1);return!0}return!1}};a.prototype.destroy=function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,
4);this._visible=this._addedToStage=!1;this.stage=null};a.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};a.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=k.vec3f64.create());return l.vec3.set(a,0,0,0)};a.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=e.create());return e.empty(a)};a.prototype.addObjectState=function(a,b){var c=this;0===a&&(this.renderGeometries.forEach(function(a){var d=a.addHighlight();
b.addRenderGeometry(a,d,c)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))};a.prototype.removeObjectState=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};a.prototype.removeRenderGeometryObjectState=function(a,b){a.removeHighlight(b);this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)};a.prototype.computeAttachmentOrigin=function(a){for(var c=0,d=this.renderGeometries;c<
d.length;c++)d[c].computeAttachmentOrigin(b)&&(a.draped.origin[0]+=b[0],a.draped.origin[1]+=b[1],a.draped.num++)};a.prototype.getProjectedBoundingBox=function(a,c,f,g,k){return d.__awaiter(this,void 0,void 0,function(){var l,p,r,q;return d.__generator(this,function(d){switch(d.label){case 0:e.empty(k);for(l=0;l<this.renderGeometries.length;l++)p=this.renderGeometries[l],this._getRenderGeometryProjectedBoundingRect(p,a,m,f),e.expand(k,m);if(!c)return[3,5];e.center(k,b);r=void 0;q=h.demResolutionForBoundingBox(k,
c);d.label=1;case 1:return d.trys.push([1,3,,4]),[4,c.service.queryElevation(b[0],b[1],g,q,"ground")];case 2:return r=d.sent(),[3,4];case 3:return d.sent(),r=null,[3,4];case 4:null!=r&&(k[2]=Math.min(k[2],r),k[5]=Math.max(k[5],r)),d.label=5;case 5:return[2,k]}})})};a.prototype._getRenderGeometryProjectedBoundingRect=function(a,b,c,d){if(this.boundingBox)e.set(f,this.boundingBox);else{var g=a.center;a=a.bsRadius;f[0]=g[0]-a;f[1]=g[1]-a;f[2]=g[2]-a;f[3]=g[0]+a;f[4]=g[1]+a;f[5]=g[2]+a}b(f,0,2);this.calculateRelativeScreenBounds&&
d.push({location:e.center(f),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return e.toRect(f,c)};return a}();var m=c.create(),f=e.create(),b=k.vec3f64.create();return n})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["require","exports","../../../../core/compilerUtils","../../webgl-engine/lib/Util"],function(n,a,d,l){function k(a,b){var c=new Uint8Array(4*a*a),d=a/2-.5;b/=2;for(var e=0;e<a;e++)for(var f=0;f<a;f++){var g=f+a*e,h=f-d,m=e-d,h=Math.sqrt(h*h+m*m)-b,
h=h/a+.5;l.packFloatRGBA(h,c,4*g)}return c}function e(a,c){return b(a,c,!1)}function c(a,c){return b(a,c,!0)}function h(a,b){return g(a,b,!1)}function m(a,b){return g(a,b,!0)}function f(a,b){for(var c=new Uint8Array(4*a*a),d=Math.sqrt(1.25),e=(a-b)/2,f=0;f<a;f++)for(var g=0;g<a;g++){var h=(g-e)/b,m=(f-e+.75)/b;l.packFloatRGBA(Math.max(-(1*h+-.5*m)/d,(1*(h-1)+-.5*-m)/d,-m)*b/a+.5,c,4*(f*a+g))}return c}function b(a,b,c){c&&(b/=Math.SQRT2);for(var d=new Uint8Array(4*a*a),e=0;e<a;e++)for(var f=0;f<a;f++){var g=
f-.5*a+.25,h=-e+.5*a-.75,m=e*a+f;if(c)var k=(g+h)/Math.SQRT2,h=(h-g)/Math.SQRT2,g=k;g=Math.max(Math.abs(g),Math.abs(h))-.5*b;g=g/a+.5;l.packFloatRGBA(g,d,4*m)}return d}function g(a,b,c){c&&(b*=Math.SQRT2);b*=.5;for(var d=new Uint8Array(4*a*a),e=0;e<a;e++)for(var f=0;f<a;f++){var g=f-.5*a,h=-e+.5*a-1,m=e*a+f;if(c)var k=(g+h)/Math.SQRT2,h=(h-g)/Math.SQRT2,g=k;k=void 0;g=Math.abs(g);h=Math.abs(h);k=g>h?g>b?Math.sqrt((g-b)*(g-b)+h*h):h:h>b?Math.sqrt(g*g+(h-b)*(h-b)):g;k=k/a+.5;l.packFloatRGBA(k,d,4*m)}return d}
Object.defineProperty(a,"__esModule",{value:!0});a.createTriangle=a.createX=a.createCross=a.createKite=a.createSquare=a.createCircle=a.createType=void 0;a.createType=function(a,b,g){switch(a){case "circle":return k(b,g);case "square":return e(b,g);case "cross":return h(b,g);case "x":return m(b,g);case "kite":return c(b,g);case "triangle":return f(b,g);default:return d.neverReached(a),k(b,g)}};a.createCircle=k;a.createSquare=e;a.createKite=c;a.createCross=h;a.createX=m;a.createTriangle=f})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../renderers/support/utils ../../support/debugFlags".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){function p(a){return null!==a&&void 0!==a}function t(a){return"number"===typeof a}function u(a){return"string"===typeof a}function r(a,b){a&&a.push(b)}function q(a,c,d,e,f){var g=a.minSize,h=a.maxSize;if(a.expression)return r(f,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=e.symbolSize[d],c.minSize[d]=a,c.maxSize[d]=a,c.offset[d]=c.minSize[d],c.factor[d]=0,c.type[d]=1,!0;if(p(a.field)){if(p(a.stops)){if(2===a.stops.length&&
t(a.stops[0].size)&&t(a.stops[1].size))return v(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,c,d),c.type[d]=1,!0;r(f,"Could not convert size info: stops only supported with 2 elements");return!1}if(t(g)&&t(h)&&p(a.minDataValue)&&p(a.maxDataValue))return v(g,h,a.minDataValue,a.maxDataValue,c,d),c.type[d]=1,!0;if(null!=b.meterIn[a.valueUnit])return c.minSize[d]=-Infinity,c.maxSize[d]=Infinity,c.offset[d]=0,c.factor[d]=1/b.meterIn[a.valueUnit],c.type[d]=1,!0;if("unknown"===a.valueUnit)return r(f,
"Could not convert size info: proportional size not supported"),!1;r(f,"Could not convert size info: scale-dependent size not supported");return!1}if(!p(a.field)){if(a.stops&&a.stops[0]&&t(a.stops[0].size))return c.minSize[d]=a.stops[0].size,c.maxSize[d]=a.stops[0].size,c.offset[d]=c.minSize[d],c.factor[d]=0,c.type[d]=1,!0;if(t(g))return c.minSize[d]=g,c.maxSize[d]=g,c.offset[d]=g,c.factor[d]=0,c.type[d]=1,!0}r(f,"Could not convert size info: unsupported variant of sizeInfo");return!1}function v(a,
b,c,d,e,f){d=0<Math.abs(d-c)?(b-a)/(d-c):0;e.minSize[f]=0<d?a:b;e.maxSize[f]=0<d?b:a;e.offset[f]=a-c*d;e.factor[f]=d}function w(a,b,c,d){if(a.normalizationField||a.valueRepresentation)return r(d,"Could not convert size info: unsupported property"),null;var e=a.field;if(null!=e&&!u(e))return r(d,"Could not convert size info: field is not a string"),null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=
a.field;else if(a.field!==b.size.field)return r(d,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(e=q(a,b.size,0,c,d))?b:null;case "height":return(e=q(a,b.size,2,c,d))?b:null;case "depth":return(e=q(a,b.size,1,c,d))?b:null;case "width-and-depth":return(e=q(a,b.size,0,c,d))&&q(a,b.size,1,c,d),e?b:null;case null:case void 0:case "all":return(e=(e=(e=q(a,b.size,0,c,d))&&q(a,b.size,1,c,d))&&q(a,b.size,2,c,d))?b:null;default:return r(d,'Could not convert size info: unknown axis "'+
a.axis+'""'),null}}function z(a,b,c){for(var d=0;3>d;++d){var e=b.unitInMeters;1===a.type[d]&&(e*=b.modelSize[d],a.type[d]=2);a.minSize[d]/=e;a.maxSize[d]/=e;a.offset[d]/=e;a.factor[d]/=e}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return r(c,"No size axis contains a valid size or scale"),!1;for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[b],a.maxSize[d]=a.maxSize[b],a.offset[d]=a.offset[b],a.factor[d]=a.factor[b],a.type[d]=a.type[b]);return!0}function x(a,
b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function B(a,b,c){if(a.normalizationField)return r(c,"Could not convert color info: unsupported property"),null;if(u(a.field))if(a.stops){if(8<a.stops.length)return r(c,"Could not convert color info: too many color stops"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c=a.stops;for(a=0;8>a;++a){var d=c[Math.min(a,c.length-1)];b.color.values[a]=d.value;
x(b.color.colors,a,d.color)}}else return r(c,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length)for(c=a.stops&&0<=a.stops.length&&a.stops[0].color,b.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a=0;8>a;a++)b.color.values[a]=Infinity,x(b.color.colors,a,c);else return r(c,"Could not convert color info: no field and no colors/stops"),null;return b}function A(a,b,c){if(a.normalizationField)return r(c,
"Could not convert opacity info: unsupported property"),null;if(u(a.field))if(a.stops){if(8<a.stops.length)return r(c,"Could not convert opacity info: too many opacity stops"),null;b.opacity={field:a.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};c=a.stops;for(a=0;8>a;++a){var d=c[Math.min(a,c.length-1)];b.opacity.values[a]=d.value;b.opacity.opacityValues[a]=d.opacity}}else return r(c,"Could not convert opacity info: missing stops or opacities"),null;else if(a.stops&&0<=a.stops.length)for(c=
a.stops&&0<=a.stops.length&&a.stops[0].opacity,b.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},a=0;8>a;a++)b.opacity.values[a]=Infinity,b.opacity.opacityValues[a]=c;else return r(c,"Could not convert opacity info: no field and no opacities/stops"),null;return b}function C(a,b,c){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;b.type[c]=1}function E(a,b,c){if(!u(a.field))return r(c,"Could not convert rotation info: field is not a string"),
null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return r(c,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return C(a,b.rotation,0),b;case "roll":return C(a,b.rotation,1),b;case null:case void 0:case "heading":return C(a,b.rotation,2),b;default:return r(c,'Could not convert rotation info: unknown axis "'+a.axis+'""'),
null}}function G(a,b,c){if(!a)return null;var e=!b.supportedTypes||!!b.supportedTypes.size,f=!b.supportedTypes||!!b.supportedTypes.color,g=!b.supportedTypes||!!b.supportedTypes.rotation,h=!!b.supportedTypes&&!!b.supportedTypes.opacity,m=a.reduce(function(a,m){if(!a)return a;if(m.valueExpression)return r(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(m.type){case "size":return e?w(m,a,b,c):a;case "color":return f?B(m,a,c):a;case "opacity":return h?A(m,a,c):null;
case "rotation":return g?E(m,a,c):a;default:return d.neverReached(m),null}},{size:null,color:null,opacity:null,rotation:null});return 0<a.length&&m&&!m.size&&!m.color&&!m.opacity&&!m.rotation||m&&m.size&&!z(m.size,b,c)?null:m}function F(a,b,c){if(!!a!==!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function H(a,b){var d={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,
vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},f=a&&null!=a.size;a&&a.size?(d.vvSizeEnabled=!0,d.vvSizeMinSize=a.size.minSize,d.vvSizeMaxSize=a.size.maxSize,d.vvSizeOffset=a.size.offset,d.vvSizeFactor=a.size.factor):a&&f&&(d.vvSizeValue=b.transformation.scale);if(a&&f){d.vvSymbolAnchor=b.transformation.anchor;d.vvSymbolRotationMatrix=e.mat3f64.create();
c.mat4.identity(I);var g=b.transformation.rotation[2],f=b.transformation.rotation[0],m=b.transformation.rotation[1];b=I;void 0===b&&(b=h.mat4f64.create());g=g||0;f=f||0;m=m||0;0!==g&&c.mat4.rotateZ(b,b,-g/180*Math.PI);0!==f&&c.mat4.rotateX(b,b,f/180*Math.PI);0!==m&&c.mat4.rotateY(b,b,m/180*Math.PI);k.mat3.fromMat4(d.vvSymbolRotationMatrix,I)}a&&a.color&&(d.vvColorEnabled=!0,d.vvColorValues=a.color.values,d.vvColorColors=a.color.colors);a&&a.opacity&&(d.vvOpacityEnabled=!0,d.vvOpacityValues=a.opacity.values,
d.vvOpacityOpacities=a.opacity.opacityValues);return d}Object.defineProperty(a,"__esModule",{value:!0});a.evaluateModelTransformScale=a.evaluateModelTransform=a.getMaterialParams=a.updateFastSymbolUpdatesState=a.initFastSymbolUpdatesState=a.convertVisualVariables=void 0;a.convertVisualVariables=G;a.initFastSymbolUpdatesState=function(a,b){return!a||g.DISABLE_FAST_UPDATES?{enabled:!1}:(a=G(a.visualVariables,b))?{enabled:!0,visualVariables:a,materialParameters:H(a,b),requiresShaderTransformation:a&&
null!=a.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(a,b,c){if(!b||!a.enabled)return!1;var d=a.visualVariables;b=G(b.visualVariables,c);if(!(b&&F(d.size,b.size,"size")&&F(d.color,b.color,"color")&&F(d.rotation,b.rotation,"rotation")&&F(d.opacity,b.opacity,"opacity")))return!1;a.visualVariables=b;a.materialParameters=H(b,c);a.requiresShaderTransformation=b&&null!=b.size;return!0};a.getMaterialParams=H;var J;(function(a){var b=h.mat4f64.create(),d=f.vec3f64.create();a.evaluateModelTransform=
function(a,e,f){if(!a.vvSizeEnabled)return f;c.mat4.copy(b,f);f=a.vvSymbolRotationMatrix;c.mat4.set(I,f[0],f[1],f[2],0,f[3],f[4],f[5],0,f[6],f[7],f[8],0,0,0,0,1);c.mat4.multiply(b,b,I);for(f=0;3>f;++f)d[f]=l.clamp(a.vvSizeOffset[f]+e[0]*a.vvSizeFactor[f],a.vvSizeMinSize[f],a.vvSizeMaxSize[f]);c.mat4.scale(b,b,d);c.mat4.translate(b,b,a.vvSymbolAnchor);return b};a.evaluateModelTransformScale=function(a,b,c){if(!b.vvSizeEnabled)return m.vec3.set(a,1,1,1);for(var d=0;3>d;++d)a[d]=l.clamp(b.vvSizeOffset[d]+
c[0]*b.vvSizeFactor[d],b.vvSizeMinSize[d],b.vvSizeMaxSize[d]);return a}})(J||(J={}));var I=h.mat4f64.create();a.evaluateModelTransform=J.evaluateModelTransform;a.evaluateModelTransformScale=J.evaluateModelTransformScale})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../support/mathUtils ./geometryDataUtils ./Object3DStateSet ./Util ../materials/renderers/utils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p){return function(){function a(a,b,d,e,f,g,h){this.uniqueName=null;this.shaderTransformationDirty=!0;this.data=a.toRenderData();this.boundingInfo=b;this.material=d;this.origin=null;this.center=c.vec3f64.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=f;e&&this.updateTransformation(e,g);this.castShadow=h;this.instanceParameters={highlights:null,occludees:null,visible:!0}}a.prototype.updateTransformation=function(a,b){this.transformation=
a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,b,this.center)};a.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};a.prototype.getBoundingSphere=function(a,b,c){b=b||m.maxScale(a);e.vec3.transformMat4(c,this.boundingInfo.getCenter(),a);return this.boundingInfo.getBSRadius()*b};Object.defineProperty(a.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!1,configurable:!0});a.prototype.getShaderTransformation=
function(){if(!this.calculateShaderTransformation)return d.unwrapOr(this.transformation,h.IDENTITY);this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=k.mat4f64.create()),l.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(d.unwrapOr(this.transformation,h.IDENTITY))),this.shaderTransformationDirty=!1);return this.shaderTransformation};a.prototype.computeAttachmentOrigin=function(a){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,
a)?(d.isSome(this.transformation)&&e.vec3.transformMat4(a,a,this.transformation),!0):!1;var b=this.getIndices(g.VertexAttrConstants.POSITION),c=this.getAttribute(g.VertexAttrConstants.POSITION);return f.computeAttachmentOriginTriangles(c,b,a)?(d.isSome(this.transformation)&&e.vec3.transformMat4(a,a,this.transformation),!0):!1};a.prototype.getIndices=function(a){return"indices"in this.data?this.data.indices[a]:null};a.prototype.getAttribute=function(a){return"vertexAttr"in this.data?this.data.vertexAttr[a]:
null};a.prototype.addHighlight=function(){var a=b.generateObject3DStateId(0),c=this.instanceParameters;c.highlights=p.addObject3DStateID(c.highlights,a);return a};a.prototype.removeHighlight=function(a){var b=this.instanceParameters;b.highlights=p.removeObject3DStateID(b.highlights,a)};return a}()})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports tslib ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestUtils ../../support/imageUtils ./DDSUtil ./glUtil3D ./IdGen ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B){return function(){function a(b,c,d){this.data=b;this.loadingController=this.loadingPromise=this.powerOfTwoStretchInfo=this.glTexture=null;this.events=new e;this.data=b;this.id=a.idGen.gen(c);this.params=d||{};this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.params.wrap=this.params.wrap||{s:10497,t:10497};this.params.powerOfTwoResizeMode=
this.params.powerOfTwoResizeMode||1;this.estimatedTexMemRequired=a.estimateTexMemRequired(this.data,this.params);this.startPreload()}a.prototype.startPreload=function(){var a=this.data;m.isNone(a)||(a instanceof HTMLVideoElement?this.startPreloadVideoElement(a):a instanceof HTMLImageElement&&this.startPreloadImageElement(a))};a.prototype.startPreloadVideoElement=function(a){g.isBlobProtocol(a.src)||"auto"===a.preload&&a.crossOrigin||(a.preload="auto",a.crossOrigin="anonymous",a.src=a.src)};a.prototype.startPreloadImageElement=
function(a){g.isDataProtocol(a.src)||g.isBlobProtocol(a.src)||a.crossOrigin||(a.crossOrigin="anonymous",a.src=a.src)};a.getDataDimensions=function(a){return a instanceof HTMLVideoElement?{width:a.videoWidth,height:a.videoHeight}:a};a.estimateTexMemRequired=function(c,d){if(m.isNone(c))return 0;if(b.isArrayBuffer(c)||b.isUint8Array(c))return c.byteLength;c=c instanceof Image||c instanceof ImageData||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement?a.getDataDimensions(c):d;return(d.mipmap?
4/3:1)*c.width*c.height*(d.components||4)||0};a.prototype.dispose=function(){this.data=void 0};Object.defineProperty(a.prototype,"width",{get:function(){return this.params.width},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this.params.height},enumerable:!1,configurable:!0});a.prototype.createDescriptor=function(a){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?
9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.mipmap&&!this.params.disableAnisotropy?a.parameters.maxMaxAnisotropy:void 0}};a.prototype.load=function(c,d){if(m.isSome(this.glTexture))return this.glTexture;if(m.isSome(this.loadingPromise))return this.loadingPromise;var e=this.data;if(m.isNone(e))return this.glTexture=new z(c,this.createDescriptor(c),null),c.bindTexture(this.glTexture),this.glTexture;if("string"===typeof e)return this.loadFromURL(c,
d,e);if(e instanceof Image)return this.loadFromImageElement(c,d,e);if(e instanceof HTMLVideoElement)return this.loadFromVideoElement(c,d,e);if(e instanceof ImageData||e instanceof HTMLCanvasElement)return this.loadFromImage(c,e,d);if((b.isArrayBuffer(e)||b.isUint8Array(e))&&this.params.encoding===a.DDS_ENCODING)return this.loadFromDDSData(c,e);if(b.isUint8Array(e))return this.loadFromPixelData(c,e);if(b.isArrayBuffer(e))return this.loadFromPixelData(c,new Uint8Array(e));l.neverReachedSilent(e);return null};
Object.defineProperty(a.prototype,"requiresFrameUpdates",{get:function(){return this.data instanceof HTMLVideoElement},enumerable:!1,configurable:!0});a.prototype.frameUpdate=function(a,b,c){if(!(this.data instanceof HTMLVideoElement)||m.isNone(this.glTexture)||2>this.data.readyState||c===this.data.currentTime)return c;if(m.isSome(this.powerOfTwoStretchInfo)){var d=this.powerOfTwoStretchInfo;c=d.framebuffer;var e=d.vao,d=d.sourceTexture;d.setData(this.data);this.drawStretchedTexture(a,b,c,e,d,this.glTexture)}else b=
this.data,a=b.width,b=b.height,e=this.glTexture.descriptor,c=e.width,e=e.height,a!==c||b!==e?this.glTexture.updateData(0,0,0,Math.min(a,c),Math.min(b,e),this.data):this.glTexture.setData(this.data);this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap();return this.data.currentTime};a.prototype.loadFromDDSData=function(a,b){this.glTexture=u.createDDSTexture(a,this.createDescriptor(a),b,this.params.mipmap);a.bindTexture(this.glTexture);return this.glTexture};a.prototype.loadFromPixelData=
function(a,b){v.assert(0<this.params.width&&0<this.params.height);var c=this.createDescriptor(a);c.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408;c.width=this.params.width;c.height=this.params.height;this.glTexture=new z(a,c,b);a.bindTexture(this.glTexture);return this.glTexture};a.prototype.loadAsync=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e,g=this;return d.__generator(this,function(d){this.loadingController=b=f.createAbortController();
this.loadingPromise=c=a(b.signal);e=function(){g.loadingController===b&&(g.loadingController=null);g.loadingPromise===c&&(g.loadingPromise=null)};c.then(e,e);return[2,c]})})};a.prototype.loadFromURL=function(a,b,c){var e=this;return this.loadAsync(function(f){return d.__awaiter(e,void 0,void 0,function(){var e;return d.__generator(this,function(d){switch(d.label){case 0:return[4,t.requestImage(c,{signal:f})];case 1:return e=d.sent(),[2,this.loadFromImage(a,e,b)]}})})})};a.prototype.loadFromImageElement=
function(a,b,c){var e=this;return c.complete?this.loadFromImage(a,c,b):this.loadAsync(function(f){return d.__awaiter(e,void 0,void 0,function(){var e;return d.__generator(this,function(d){switch(d.label){case 0:return[4,p.loadImageAsync(c,c.src,!1,f)];case 1:return e=d.sent(),[2,this.loadFromImage(a,e,b)]}})})})};a.prototype.loadFromVideoElement=function(a,b,c){return 2<=c.readyState?this.loadFromImage(a,c,b):this.loadFromVideoElementAsync(a,b,c)};a.prototype.loadFromVideoElementAsync=function(a,
b,c){var d=this;return this.loadAsync(function(e){return f.create(function(g,h){var l=function(){c.removeEventListener("loadeddata",p);c.removeEventListener("error",r);m.isSome(q)&&q.remove()},p=function(){2<=c.readyState&&(l(),g(d.loadFromImage(a,c,b)))},r=function(a){l();h(a||new k("Failed to load video"))};c.addEventListener("loadeddata",p);c.addEventListener("error",r);var q=f.onAbort(e,function(){return r(f.createAbortError())})})})};a.prototype.loadFromImage=function(b,c,d){var e=a.getDataDimensions(c);
this.params.width=e.width;this.params.height=e.height;var f=this.createDescriptor(b);f.pixelFormat=3===this.params.components?6407:6408;if(this.requiresPowerOfTwo(b,f)&&(!h.isPowerOfTwo(e.width)||!h.isPowerOfTwo(e.height)))return this.glTexture=this.makePowerOfTwoTexture(b,c,e,f,d),b.bindTexture(this.glTexture),this.glTexture;f.width=e.width;f.height=e.height;this.glTexture=new z(b,f,c);b.bindTexture(this.glTexture);return this.glTexture};a.prototype.requiresPowerOfTwo=function(a,b){var c="number"===
typeof b.wrapMode?33071===b.wrapMode:33071===b.wrapMode.s&&33071===b.wrapMode.t;return!B.default(a.gl)&&(b.hasMipmap||!c)};a.prototype.makePowerOfTwoTexture=function(a,b,d,e,f){var g=d.width;d=d.height;var h=c.nextHighestPowerOfTwo(g),m=c.nextHighestPowerOfTwo(d);e.width=h;e.height=m;var k;switch(this.params.powerOfTwoResizeMode){case 2:e.textureCoordinateScaleFactor=[g/h,d/m];k=new z(a,e);k.updateData(0,0,0,g,d,b);break;case 1:case null:case void 0:k=this.stretchToPowerOfTwo(a,b,e,f);break;default:l.neverReached(this.params.powerOfTwoResizeMode)}e.hasMipmap&&
k.generateMipmap();return k};a.prototype.stretchToPowerOfTwo=function(a,b,c,d){var e=new z(a,c),f=new w(a,{colorTarget:0,depthStencilTarget:0},e);b=new z(a,{target:3553,pixelFormat:c.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!c.flipped,maxAnisotropy:8,preMultiplyAlpha:c.preMultiplyAlpha},b);c=r.createQuadVAO(a);this.drawStretchedTexture(a,d,f,c,b,e);this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:c,sourceTexture:b,framebuffer:f}:(c.dispose(!0),b.dispose(),f.detachColorTexture(),
a.bindFramebuffer(null),f.dispose());return e};a.prototype.drawStretchedTexture=function(a,b,c,d,e,f){a.bindFramebuffer(c);c=a.getViewport();a.setViewport(0,0,f.descriptor.width,f.descriptor.height);f=b.program;a.bindProgram(f);f.setUniform4f("color",1,1,1,1);f.setUniform1i("tex",0);a.bindTexture(e,0);a.bindVAO(d);a.setPipelineState(b.pipeline);a.drawArrays(5,0,x.vertexCount(d,"geometry"));a.bindFramebuffer(null);a.setViewport(c.x,c.y,c.width,c.height)};a.prototype.unload=function(){if(m.isSome(this.powerOfTwoStretchInfo)){var a=
this.powerOfTwoStretchInfo,b=a.framebuffer,c=a.sourceTexture;a.vao.dispose(!0);c.dispose();b.dispose();this.powerOfTwoStretchInfo=this.glTexture=null}m.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);m.isSome(this.loadingController)&&(a=this.loadingController,this.loadingPromise=this.loadingController=null,a.abort());this.events.emit("unloaded")};a.idGen=new q.IdGen;a.DDS_ENCODING="image/vnd-ms.dds";return a}()})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require",
"exports","../../../../core/Logger","../../../../core/mathUtils","../../../webgl/Texture"],function(n,a,d,l,k){function e(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function c(a,c){var d=new Int32Array(a,0,31);if(542327876!==d[0])return h.error("Invalid magic number in DDS header"),null;if(!(d[20]&4))return h.error("Unsupported format, must contain a FourCC code"),null;var e=d[21],g;switch(e){case m:e=8;g=33776;break;case f:e=16;g=33778;break;case b:e=
16;g=33779;break;default:return h.error("Unsupported FourCC code:",String.fromCharCode(e&255,e>>8&255,e>>16&255,e>>24&255)),null}var k=1,p=d[4],w=d[3];if(0!==(p&3)||0!==(w&3))h.warn("Rounding up compressed texture size to nearest multiple of 4."),p=p+3&-4,w=w+3&-4;var z=p,x=w;d[2]&131072&&!1!==c&&(k=Math.max(1,d[7]));1===k||l.isPowerOfTwo(p)&&l.isPowerOfTwo(w)||(h.warn("Ignoring mipmaps of non power of two sized compressed texture."),k=1);for(var B=d[1]+4,A=[],C=0;C<k;++C)d=(p+3>>2)*(w+3>>2)*e,c=
new Uint8Array(a,B,d),A.push(c),B+=d,p=Math.max(1,p>>1),w=Math.max(1,w>>1);return{textureData:{type:"compressed",levels:A},internalFormat:g,width:z,height:x}}Object.defineProperty(a,"__esModule",{value:!0});a.createDDSTextureData=a.createDDSTexture=void 0;var h=d.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),m=e("DXT1"),f=e("DXT3"),b=e("DXT5");a.createDDSTexture=function(a,b,d,e){var f=c(d,e);d=f.textureData;e=f.internalFormat;var g=f.width,f=f.height;b.samplingMode=1<d.levels.length?9987:9729;
b.hasMipmap=1<d.levels.length;b.internalFormat=e;b.width=g;b.height=f;b=new k(a,b,d);a.bindTexture(b);return b};a.createDDSTextureData=c})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./lineUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E){Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DLineSymbolLayer=void 0;n=function(a){function n(b,c,d,e){b=a.call(this,b,c,d,e)||this;b._uniformSize=1;return b}d.__extends(n,a);n.prototype.doLoad=function(){return d.__awaiter(this,void 0,void 0,function(){var a;return d.__generator(this,function(b){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,
0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?z.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size){a=null!=this.symbolLayer.size?this.symbolLayer.size:h.px2pt(1);if(0>a)throw new e("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=a}return[2]})})};
n.prototype.getMaterialParameters=function(a){var b=c.get(this.symbolLayer,"material","color"),b=this._getCombinedOpacityAndColor(b);a={width:1,color:b,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:this.symbolLayer.cap||"butt",transparent:1>b[3]||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:a,stipplePattern:this.symbolLayer.stipplePattern?C.createStipplePattern(this.symbolLayer.stipplePattern.map(h.pt2px)):null,stippleOffColor:this.symbolLayer.stippleOffColor?
l.toUnitRGBA(this.symbolLayer.stippleOffColor):null,stippleIntegerRepeats:!0};this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(a.width=h.pt2px(1)):(b=null!=this.symbolLayer.size?this.symbolLayer.size:h.px2pt(1),a.width=h.pt2px(b));return this._fastUpdates&&this._fastUpdates.visualVariables?d.__assign(d.__assign({},a),this._fastUpdates.materialParameters):a};Object.defineProperty(n.prototype,"lineMaterial",{get:function(){c.isNone(this._lineMaterial)&&
(this._lineMaterial=new E(this.getMaterialParameters(!1),this._getIdHint("_ribbonlinemat")),this._context.stage.add(3,this._lineMaterial));return this._lineMaterial},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"ringMaterial",{get:function(){c.isNone(this._ringMaterial)&&(this._ringMaterial=new E(this.getMaterialParameters(!0),this._getIdHint("_ribbonlinemat")),this._context.stage.add(3,this._ringMaterial));return this._ringMaterial},enumerable:!1,configurable:!0});n.prototype.destroy=
function(){a.prototype.destroy.call(this);c.isSome(this._lineMaterial)&&(this._context.stage.remove(3,this._lineMaterial.id),this._lineMaterial=null);c.isSome(this._ringMaterial)&&(this._context.stage.remove(3,this._ringMaterial.id),this._ringMaterial=null)};n.prototype.getDrivenSize=function(a){return this._drivenProperties.size&&a.size?h.pt2px(g.getDriverAxisSizeValueAny(a.size)):1};n.prototype.getSizeFeatureAttributeData=function(a){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?
v.getAttributeValue(this._fastUpdates.visualVariables.size.field,a):null};n.prototype.getDrivenColor=function(a){var b=f.vec4f64.fromValues(1,1,1,1);this._drivenProperties.color&&a.color&&(b[0]=a.color[0],b[1]=a.color[1],b[2]=a.color[2],0<a.color.length&&(b[3]=a.color[3]));this._drivenProperties.opacity&&a.opacity&&(b[3]=a.opacity);return b};n.prototype.getColorFeatureAttributeData=function(a){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?v.getAttributeValue(this._fastUpdates.visualVariables.color.field,
a):null};n.prototype.getOpacityFeatureAttributeData=function(a){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?v.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,a):null};n.prototype.createGraphics3DGraphic=function(a){var b=a.graphic,c=b.geometry;if(!this._validateGeometryType(b.geometry,n.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(c))return null;var c="graphic"+b.uid,d=this.setGraphicElevationContext(b,new u.ElevationContext);
this.ensureDrapedStatus("on-the-ground"===d.mode);return this.draped?this._createAsOverlay(a,this._context.layer.uid):this._createAs3DShape(a,d,c,b.uid)};n.prototype.applyRendererDiff=function(a,b){for(var d in a.diff)switch(d){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,b,this._vvConvertOptions))c.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters),c.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters);
else return!1;break;default:return!1}return!0};n.prototype.layerOpacityChanged=function(){c.isSome(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial);c.isSome(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial);return!0};n.prototype.updateMaterialLayerOpacity=function(a){var b=a.getParameters().color,d=c.get(this.symbolLayer,"material","color"),d=this._getCombinedOpacity(d);a.setParameterValues({color:[b[0],b[1],b[2],d],transparent:1>d||this.needsDrivenTransparentPass})};
n.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=t.elevationModeChangeUpdateType(n.elevationModeChangeTypes,c,d);if(c!==t.SymbolUpdateType.UPDATE)return c;var e=t.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};n.prototype.slicePlaneEnabledChanged=function(){c.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});c.isSome(this._ringMaterial)&&
this._ringMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};n.prototype.physicalBasedRenderingChanged=function(){return!0};n.prototype.pixelRatioChanged=function(){return!0};n.prototype._getGeometryAsPolygonOrPolyline=function(a){switch(a.type){case "extent":if(a instanceof k.Extent)return k.Polygon.fromExtent(a);break;case "polygon":case "polyline":return a}return null};n.prototype._createAs3DShape=function(a,d,e,f){var g=this._getGeometryAsPolygonOrPolyline(a.graphic.geometry),
h="polygon"===g.type?g.rings:g.paths,k=[],l=[],r=[],v=b.create(),u=w.geometryToRenderInfo(g,this._context.elevationProvider,this._context.renderCoordsHelper,d);this._logGeometryCreationWarnings(u,h,"polygon"===g.type?"rings":"paths","LineSymbol3DLayer");for(h=0;h<u.lines.length;h++){var z=u.lines[h],A=z.position,z=z.mapPosition;if(c.isSome(this._context.clippingExtent)&&(b.empty(v),b.expandWithBuffer(v,z),!b.intersectsClippingArea(v,this._context.clippingExtent)))continue;A=this._createGeometryData(a,
A,z,g.type);A=new x(A,e+"path"+h);k.push(A);l.push("polygon"===g.type?this.ringMaterial:this.lineMaterial);r.push(m.mat4f64.IDENTITY)}if(0===k.length)return null;a=new B({geometries:k,materials:l,transformations:r,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:f},idHint:e});k=new q(this,a,k,null,null,p.perVertexElevationAligner,d);k.alignedSampledElevation=u.sampledElevation;k.needsElevationUpdates=t.needsElevationUpdates2D(d.mode);return k};n.prototype._createGeometryData=function(a,
b,c,d){var e=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;return w.createGeometryData({removeDuplicateStartEnd:"polygon"===d?1:0,uniformSize:this._uniformSize,attributeData:{position:b,mapPosition:c,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this.getDrivenSize(a.renderingInfo),color:e?null:this.getDrivenColor(a.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(a.graphic),colorFeature:this.getColorFeatureAttributeData(a.graphic),opacityFeature:this.getOpacityFeatureAttributeData(a.graphic)}})};
n.prototype._createAsOverlay=function(a,c){var d=a.graphic,e=this._getGeometryAsPolygonOrPolyline(d.geometry),f="polygon"===e.type?e.rings:e.paths,g="polygon"===e.type?this.ringMaterial:this.lineMaterial;g.renderPriority=this._renderPriority;var h=[],m=b.create(),k=b.empty(),l=w.geometryToRenderInfoDraped(e,this._context.overlaySR);this._logGeometryCreationWarnings(l,f,"polygon"===e.type?"rings":"paths","LineSymbol3DLayer");if(0<f.length){f=l.lines;for(l=0;l<f.length;++l){var p=f[l];b.empty(m);b.expandWithBuffer(m,
p.position);b.intersectsClippingArea(m,this._context.clippingExtent)&&(b.expand(k,m),p=this._createGeometryData(a,p.position,null,e.type),p=new A(p),p.data.layerUid=c,p.data.graphicUid=d.uid,p.material=g,p.center=[.5*(m[0]+m[3]),.5*(m[1]+m[4]),0],p.bsRadius=.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1])),h.push(p))}return new r(this,h,k)}return null};n.validGeometryTypes=["polyline","polygon","extent"];n.elevationModeChangeTypes={definedChanged:t.SymbolUpdateType.RECREATE,staysOnTheGround:t.SymbolUpdateType.NONE,
onTheGroundChanged:t.SymbolUpdateType.RECREATE};return n}(v.Graphics3DSymbolLayer);a.Graphics3DLineSymbolLayer=n;a.default=n})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/triangulationUtils ./constants ./elevationAlignmentUtils ../../support/projectionUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryData ../../webgl-engine/shaders/RibbonLineTechnique".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){function u(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e],g=f.count;1>=g||(f=3*f.index,g=f+3*g,d.push({position:b.subarray(f,g),mapPosition:c?c.subarray(f,g):void 0}))}return d}Object.defineProperty(a,"__esModule",{value:!0});a.geometryToRenderInfoDraped=a.geometryToRenderInfo=a.createGeometryData=void 0;a.createGeometryData=function(a){for(var b={},c={},f=a.attributeData.position,g=a.removeDuplicateStartEnd,h=f.length,u=f[0]===f[h-3]&&f[1]===f[h-2]&&f[2]===
f[h-1]&&1===g,g=f.length/3-(u?1:0),h=new Uint32Array(2*(g-1)),f=u?k.slice(f,0,f.length-3):f,w=u=0;w<g-1;w++)h[u++]=w,h[u++]=w+1;c[t.RibbonVertexAttributeConstants.POSITION]={size:3,data:f,offsetIdx:0,strideIdx:3};b[t.RibbonVertexAttributeConstants.POSITION]=h;g=new Uint32Array(b[t.RibbonVertexAttributeConstants.POSITION].length);h=a.attributeData.mapPosition;l.isNone(h)||(b.mapPos=b[t.RibbonVertexAttributeConstants.POSITION],c.mapPos={size:3,data:h,offsetIdx:0,strideIdx:3});l.isSome(a.attributeData.colorFeature)||
(c[t.RibbonVertexAttributeConstants.COLOR]={size:4,data:l.unwrapOr(a.attributeData.color,m.WHITE_UNIT),offsetIdx:0,strideIdx:4},b[t.RibbonVertexAttributeConstants.COLOR]=g);l.isSome(a.attributeData.sizeFeature)||(c[t.RibbonVertexAttributeConstants.SIZE]={size:1,data:new Float32Array([l.unwrapOr(a.attributeData.size,1)]),offsetIdx:0,strideIdx:1},b[t.RibbonVertexAttributeConstants.SIZE]=g);h=a.attributeData.colorFeature;l.isNone(h)||(c[t.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE]={size:1,
data:new Float32Array([h]),offsetIdx:0,strideIdx:1},b[t.RibbonVertexAttributeConstants.COLOR]=g);h=a.attributeData.sizeFeature;l.isNone(h)||(c[t.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]={size:1,data:new Float32Array([h]),offsetIdx:0,strideIdx:1},b[t.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]=g);h=a.attributeData.opacityFeature;l.isNone(h)||(c[t.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]={size:1,data:new Float32Array([h]),offsetIdx:0,strideIdx:1},b[t.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]=
g);if("round"===a.join){g=c[t.RibbonVertexAttributeConstants.POSITION].data;h=g.length/3;f=new Float32Array(h);u=r;w=q;e.vec3.set(u,0,0,0);a=l.unwrapOr(a.uniformSize,1);for(var n=-1;n<h;++n){var H=0>n?h+n:n,J=(n+1)%h;e.vec3.set(w,g[3*J+0]-g[3*H+0],g[3*J+1]-g[3*H+1],g[3*J+2]-g[3*H+2]);e.vec3.normalize(w,w);0<=n&&(H=1*(Math.PI-d.acosClamped(e.vec3.dot(u,w)))*v*(1.863798+-2.0062872/Math.pow(1+a/18.2313,.8856294)),f[n]=Math.max(Math.floor(H),0));e.vec3.scale(u,w,-1)}c[t.RibbonVertexAttributeConstants.SUBDIVISIONS]=
{size:1,data:f,offsetIdx:0,strideIdx:1};b[t.RibbonVertexAttributeConstants.SUBDIVISIONS]=b[t.RibbonVertexAttributeConstants.POSITION]}return new p.GeometryData(c,b,"line")};a.geometryToRenderInfo=function(a,b,c,d){var e=h.pathsToTriangulationInfo("polygon"===a.type?a.rings:a.paths,a.hasZ,"polygon"===a.type?1:0),g=e.position,e=e.outlines,m=new Float64Array(g.length);a=f.applyPerVertexElevationAlignment(g,a.spatialReference,0,m,0,g,0,g.length/3,b,c,d);b=null!=a;return{lines:b?u(e,g,m):[],projectionSuccess:b,
sampledElevation:a}};a.geometryToRenderInfoDraped=function(a,c){var d=h.pathsToTriangulationInfo("polygon"===a.type?a.rings:a.paths,!1,"polygon"===a.type?1:0),e=d.position,d=d.outlines;a=b.bufferToBuffer(e,a.spatialReference,0,e,c,0,e.length/3);for(c=2;c<e.length;c+=3)e[c]=g.DRAPED_Z;return{lines:a?u(d,e):[],projectionSuccess:a}};var r=c.vec3f64.create(),q=c.vec3f64.create(),v=4/Math.PI})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q){Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DMeshFillSymbolLayer=void 0;var R=L.VertexAttrConstants;n=function(a){function h(b,c,d,e){b=a.call(this,b,c,d,e)||this;b._materials=new Map;b._textures=new Map;b.ensureDrapedStatus(!1);return b}d.__extends(h,a);h.prototype.doLoad=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(a){G.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=
new Q({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=new Q({color:[0,1,1,1]},"debugFAceNormal"));return[2]})})};h.prototype.destroy=function(){var b=this;a.prototype.destroy.call(this);this._materials.forEach(function(a){b._context.stage.remove(3,a.material.id)});this._textures.forEach(function(a){b._context.stage.remove(4,a.id)});this._materials.clear();this._textures.clear()};h.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,
h.validGeometryTypes,"fill on mesh-3d")||!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,d=this.setGraphicElevationContext(b,new x.ElevationContext);return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};h.prototype.layerOpacityChanged=function(a,b){var c=this,d=this._getLayerOpacity();this._materials.forEach(function(a){a.material.setParameterValues({layerOpacity:d});var b=a.material.getParameters();c._setMaterialTransparentParameter(b,a);a.material.setParameterValues({transparent:b.transparent})});
a.forEach(function(a){a=b(a);e.isSome(a)&&a.layerOpacityChanged(d,c._context.isAsync)});return!0};h.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,z.needsElevationUpdates3D)};h.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;this._materials.forEach(function(a){a.material.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});a.forEach(function(a){a=b(a);e.isSome(a)&&a.slicePlaneEnabledChanged(c._context.slicePlaneEnabled,
c._context.isAsync)});return!0};h.prototype.physicalBasedRenderingChanged=function(){var a=this;this._materials.forEach(function(b){var c=b.material.getParameters().isSchematic;b.material.setParameterValues({usePBR:a._usePBR(c)})});return!0};h.prototype.pixelRatioChanged=function(){return!0};h.prototype._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};h.prototype._colorOrTextureUid=function(a){return a?a instanceof l?a.toHex():a.contentHash:
"-"};h.prototype._materialPropertiesDefault=function(a,b){var c=this._requiresSymbolVertexColors(),d=!!a.vertexAttributes.color;a=!!a.vertexAttributes.tangent;return{hasSymbolVertexColors:c,hasVertexColors:d,hasVertexTangents:a,uid:"vc:"+d+",vt:"+a+",vct"+b+",svc:"+c}};h.prototype._materialProperties=function(a,b,c){a=this._materialPropertiesDefault(a,c);if(!b.material)return a;var d=b.material;c=d.color;var e=d.colorTexture,f=d.normalTexture,g=d.doubleSided,h=d.alphaCutoff,d=d.alphaMode,m=this._colorOrTextureUid(c),
k=this._colorOrTextureUid(e),l=this._colorOrTextureUid(f);a.color=c;a.colorTexture=e;a.normalTexture=f;a.uid=a.uid+",cmuid:"+m+",ctmuid:"+k+",ntmuid:"+l+",ds:"+g+",ac:"+h+",am:"+d;b.material instanceof r&&(h=b.material,b=h.metallic,c=h.roughness,e=h.metallicRoughnessTexture,f=h.emissiveColor,g=h.emissiveTexture,h=h.occlusionTexture,d=this._colorOrTextureUid(e),m=this._colorOrTextureUid(f),k=this._colorOrTextureUid(g),l=this._colorOrTextureUid(h),a.metallic=b,a.roughness=c,a.metallicRoughnessTexture=
e,a.emissiveColor=f,a.emissiveTexture=g,a.occlusionTexture=h,a.uid=a.uid+",mrm:"+b+",mrr:"+c+",mrt:"+d+",emuid:"+m+",etmuid:"+k+",otmuid:"+l);return a};h.prototype._setInternalColorValueParameters=function(a,b){b.diffuse=l.toUnitRGB(a);b.opacity=a.a};h.prototype._getLoadableTextureResource=function(a){return a.data?a.data:a.url};h.prototype._getInternalTextureId=function(a,b){var c=this._getLoadableTextureResource(a);if(c){var d=a.contentHash,e=this._textures.get(d);e||(e=new K(c,b+"_"+d+"_tex",{mipmap:!0,
wrap:this._castTextureWrap(a.wrap),noUnpackFlip:!0,preMultiplyAlpha:!0}),this._textures.set(d,e),this._context.stage.add(4,e));return e.id}};h.prototype._castTextureWrap=function(a){void 0===a&&(a="repeat");return"string"===typeof a?(a=this._castTextureWrapIndividual(a),{s:a,t:a}):{s:this._castTextureWrapIndividual(a.horizontal),t:this._castTextureWrapIndividual(a.vertical)}};h.prototype._castTextureWrapIndividual=function(a){switch(a){case "clamp":return 33071;case "mirror":return 33648;default:return 10497}};
h.prototype._setInternalMaterialParameters=function(a,b,c){a.color&&this._setInternalColorValueParameters(a.color,c);a.colorTexture&&(c.textureId=this._getInternalTextureId(a.colorTexture,b));a.normalTexture&&(c.normalTextureId=this._getInternalTextureId(a.normalTexture,b));a.emissiveColor&&(c.emissiveFactor=l.toUnitRGB(a.emissiveColor));a.emissiveTexture&&(c.emissiveTextureId=this._getInternalTextureId(a.emissiveTexture,b));a.occlusionTexture&&(c.occlusionTextureId=this._getInternalTextureId(a.occlusionTexture,
b));a.metallicRoughnessTexture&&(c.metallicRoughnessTextureId=this._getInternalTextureId(a.metallicRoughnessTexture,b))};h.prototype._setExternalMaterialParameters=function(a){var b=this._drivenProperties.color,c=e.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;b?a.externalColor=p.vec4f64.ONES:(b=e.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,e.isSome(b)?a.externalColor=l.toUnitRGBA(b):(c=null,a.externalColor=p.vec4f64.ONES));c&&(a.colorMixMode=
c);a.castShadows=!!this.symbolLayer.castShadows};h.prototype._hasTransparentVertexColors=function(a){a=a.vertexAttributes.color;if(!a)return!1;for(var b=3;b<a.length;b+=4)if(255!==a[b])return!0;return!1};h.prototype._getOrCreateMaterial=function(a,b){var c=b.material&&b.material.color,d=b.material&&b.material.colorTexture,e=b.material&&"blend"===b.material.alphaMode,c=!(b.material&&"opaque"===b.material.alphaMode)&&(this._hasTransparentVertexColors(a)||c&&1>c.a||d&&d.transparent||e);a=this._materialProperties(a,
b,c);if(d=this._materials.get(a.uid))return d.material;var c={material:null,isComponentTransparent:c,alphaMode:b.material?b.material.alphaMode:"opaque"},d=this._getIdHint(),e=null==a.metallicRoughnessTexture&&null==a.metallic&&null==a.roughness,f={usePBR:this._usePBR(e),isSchematic:e,vertexColors:a.hasVertexColors,symbolColors:a.hasSymbolVertexColors,vertexTangents:a.hasVertexTangents,ambient:g.vec3f64.ZEROS,diffuse:g.vec3f64.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,
textureAlphaPremultiplied:!0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};e||(f.mrrFactors=[null!=a.metallic?a.metallic:1,null!=a.roughness?a.roughness:1,.5]);b.material&&(f.doubleSided=b.material.doubleSided,f.cullFace=b.material.doubleSided?0:2,f.textureAlphaCutoff=b.material.alphaCutoff);this._setInternalMaterialParameters(a,d,f);this._setExternalMaterialParameters(f);this._setMaterialTransparentParameter(f,c);b=new M(f,d+"_"+
a.uid+"_mat");c.material=b;this._materials.set(a.uid,c);this._context.stage.add(3,b);return b};h.prototype._usePBR=function(a){return a?this._context.physicalBasedRenderingEnabled:!0};h.prototype._setMaterialTransparentParameter=function(a,b){a.transparent=this.needsDrivenTransparentPass||b.isComponentTransparent||1>a.layerOpacity||1>a.opacity||a.externalColor&&1>a.externalColor[3];a.textureAlphaMode="auto"===b.alphaMode?a.transparent?3:1:"opaque"===b.alphaMode?1:"mask"===b.alphaMode?2:0};h.prototype._addDebugNormals=
function(a,c,d,e){var g,h,m,k,l=c.length,p=a.spatialReference.isGeographic?20015077/180:1,r=.1*Math.max(a.extent.width*p,a.extent.height*p,a.extent.zmax-a.extent.zmin),q=[],t=[];a=[];for(var p=[],v=0;v<l;v++)for(var u=c[v],w=u.data.getAttribute(R.POSITION),z=u.data.getAttribute(R.NORMAL),x=u.data.getIndices(R.POSITION),u=u.data.getIndices(R.NORMAL),w=w.data,z=z.data,A=0;A<x.length;A++){for(var B=3*x[A],n=3*u[A],C=0;3>C;C++)q.push(w[B+C]);for(C=0;3>C;C++)q.push(w[B+C]+z[n+C]*r);t.push(t.length);t.push(t.length);
if(0===A%3){this._calculateFaceNormal(w,x,A,U);this._getFaceVertices(w,x,A,N,S,P);b.vec3.add(N,N,S);b.vec3.add(N,N,P);b.vec3.scale(N,N,1/3);for(C=0;3>C;C++)a.push(N[C]);for(C=0;3>C;C++)a.push(N[C]+U[C]*r);p.push(p.length);p.push(p.length)}}l=(g={},g[R.POSITION]={data:new Float64Array(q),size:3},g);g=(h={},h[R.POSITION]=new Uint32Array(t),h);h=new J.GeometryData(l,g,"line");h=new H(h,"debugVertexNormal");c.push(h);d.push(this._debugVertexNormalMaterial);e.push(f.mat4f64.clone(e[0]));l=(m={},m[R.POSITION]=
{data:new Float64Array(a),size:3},m);g=(k={},k[R.POSITION]=new Uint32Array(p),k);h=new J.GeometryData(l,g,"line");h=new H(h,"debugFaceNormal");c.push(h);d.push(this._debugFaceNormalMaterial);e.push(f.mat4f64.clone(e[0]))};h.prototype._createAs3DShape=function(a,b,c,d,f){a=a.geometry;if("mesh"!==a.type)return null;var g=this._createGeometryInfo(a,b,d);if(!g)return null;b=g.geometries;var h=g.materials,m=g.transformations,g=g.objectTransformation;G.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,
b,h,m);f=new I({geometries:b,materials:h,transformations:m,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:f},idHint:d});f.objectTransformation=g;d=w.perObjectElevationAligner;m=this._createEdgeMaterial();h=e.isSome(m)?{baseMaterial:h[0],edgeMaterials:[m],addObjectSettings:{mergeGeometries:!0},slicePlaneEnabled:this._context.slicePlaneEnabled}:null;b=new B(this,f,b,null,null,d,c,h);b.needsElevationUpdates=z.needsElevationUpdates3D(c.mode);c=a.extent.center.clone();c.z=0;b.elevationContext.centerPointInElevationSR=
c;b.alignedSampledElevation=d(b,b.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper);return b};h.prototype._createComponentNormals=function(a,b,c,d){var e=c.shading||"flat";switch(e){case "source":return this._createComponentNormalsSource(a,b,c,d);case "flat":return this._createComponentNormalsFlat(a,d);case "smooth":return this._createComponentNormalsSmooth(a,d);default:k.neverReached(e)}};h.prototype._createComponentNormalsSource=function(a,c,d,e){if(!c)return this._createComponentNormalsFlat(a,
e);var f=!1;if(!d.trustSourceNormals)for(d=0;d<e.length;d+=3){this._calculateFaceNormal(a,e,d,U);for(var g=0;3>g;g++){var h=3*e[d+g];N[0]=c[h+0];N[1]=c[h+1];N[2]=c[h+2];0>b.vec3.dot(U,N)&&(c[h+0]=-c[h+0],c[h+1]=-c[h+1],c[h+2]=-c[h+2],f=!0)}}return{normals:c,indices:e,didFlipNormals:f}};h.prototype._createComponentNormalsFlat=function(a,b){for(var c=new Float32Array(b.length),d=new Uint32Array(3*b.length),e=0;e<b.length;e+=3)for(var f=this._calculateFaceNormal(a,b,e,U),g=0;3>g;g++)c[e+g]=f[g],d[e+
g]=e/3;return{normals:c,indices:d,didFlipNormals:!1}};h.prototype._createComponentNormalsSmooth=function(a,c){for(var d={},e=0;e<c.length;e+=3)for(var f=this._calculateFaceNormal(a,c,e,U),h=0;3>h;h++){var m=c[e+h],k=d[m];k||(k={normal:g.vec3f64.create(),count:0},d[m]=k);b.vec3.add(k.normal,k.normal,f);k.count++}a=new Float32Array(3*c.length);f=new Uint32Array(3*c.length);for(e=0;e<c.length;e++){m=c[e];k=d[m];1!==k.count&&(b.vec3.normalize(k.normal,k.normal),k.count=1);for(h=0;3>h;h++)a[3*e+h]=k.normal[h];
f[e]=e}return{normals:a,indices:f,didFlipNormals:!1}};h.prototype._getFaceVertices=function(a,b,c,d,e,f){var g=3*b[c+0],h=3*b[c+1];b=3*b[c+2];d[0]=a[g+0];d[1]=a[g+1];d[2]=a[g+2];e[0]=a[h+0];e[1]=a[h+1];e[2]=a[h+2];f[0]=a[b+0];f[1]=a[b+1];f[2]=a[b+2]};h.prototype._calculateFaceNormal=function(a,c,d,e){this._getFaceVertices(a,c,d,N,S,P);b.vec3.subtract(S,S,N);b.vec3.subtract(P,P,N);b.vec3.cross(N,S,P);b.vec3.normalize(e,N);return e};h.prototype._getOrCreateComponents=function(a){return a.components?
a.components:Y};h.prototype._createPositionBuffer=function(a){var b=a.vertexAttributes.position,c=new Float64Array(b.length);F.bufferToBuffer(a.vertexAttributes.position,a.spatialReference,0,c,this._context.renderCoordsHelper.spatialReference,0,b.length/3);return c};h.prototype._createNormalBuffer=function(a,b){var c=a.vertexAttributes.normal;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var d=a.vertexAttributes.position,e=new Float32Array(c.length);return v.projectNormalToECEF(c,
d,b,a.spatialReference,e)};h.prototype._createTangentBuffer=function(a,b){var c=a.vertexAttributes.tangent;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var d=a.vertexAttributes.position,e=new Float32Array(c.length);return v.projectTangentToECEF(c,d,b,a.spatialReference,e)};h.prototype._createColorBuffer=function(a){return a.vertexAttributes.color};h.prototype._createSymbolColorBuffer=function(a){if(this._requiresSymbolVertexColors()){a=this._getVertexOpacityAndColor(a);
var b=E.parseColorMixMode(e.get(this.symbolLayer,"material","colorMixMode")),c=new Uint8Array(4);E.encodeSymbolColor(a,b,c);return c}return null};h.prototype._createColorIndices=function(a){a=new Uint32Array(a.length);for(var b=0;b<a.length;b++)a[b]=0;return a};h.prototype._createBuffers=function(a,b){var c=a.vertexAttributes&&a.vertexAttributes.position;if(!c)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal,e=a.vertexAttributes.uv,
f=a.vertexAttributes.tangent;if(d&&d.length!==c.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(f&&f.length/4!==c.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(e&&e.length/2!==c.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;c=this._createPositionBuffer(a);
d=this._createColorBuffer(a);b=this._createSymbolColorBuffer(b);var f=this._createNormalBuffer(a,c),g=this._createTangentBuffer(a,c);a=this._transformCenterLocal(a,c,f);return{positionBuffer:c,normalBuffer:f,tangentBuffer:g,uvBuffer:e,colorBuffer:d,symbolColorBuffer:b,objectTransformation:a}};h.prototype._transformCenterLocal=function(a,d,e){var g=a.extent.center,h=this._context.renderCoordsHelper.spatialReference;O[0]=g.x;O[1]=g.y;O[2]=0;g=f.mat4f64.create();F.computeLinearTransformation(a.spatialReference,
O,g,h);m.mat4.invert(Z,g);for(a=0;a<d.length;a+=3)N[0]=d[a+0],N[1]=d[a+1],N[2]=d[a+2],b.vec3.transformMat4(N,N,Z),d[a+0]=N[0],d[a+1]=N[1],d[a+2]=N[2];if(e)for(c.mat3.fromMat4(V,g),c.mat3.transpose(V,V),a=0;a<e.length;a+=3)N[0]=e[a+0],N[1]=e[a+1],N[2]=e[a+2],b.vec3.transformMat3(N,N,V),e[a+0]=N[0],e[a+1]=N[1],e[a+2]=N[2];return g};h.prototype._validateFaces=function(a,b){a=a.vertexAttributes.position.length/3;if(b=b.faces){for(var c=-1,d=0;d<b.length;d++){var e=b[d];e>c&&(c=e)}if(a<=c)return this.logger.warn("Vertex index "+
c+" is out of bounds of the mesh position buffer"),!1}else if(0!==a%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};h.prototype._getOrCreateFaces=function(a,b){if(b.faces)return b.faces;a=new Uint32Array(a.vertexAttributes.position.length/3);for(b=0;b<a.length;b++)a[b]=b;return a};h.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var b=
a.vertexAttributes&&a.vertexAttributes.position;if(!b)return!1;var c=this._context.elevationProvider.spatialReference,d=b.length/3;a.spatialReference.equals(c)||(b=new Float64Array(b.length),F.bufferToBuffer(a.vertexAttributes.position,a.spatialReference,0,b,c,0,d));t.empty(T);t.expandWithBuffer(T,b,0,d);return!t.intersectsClippingArea(T,this._context.clippingExtent)};h.prototype._createGeometryInfo=function(a,b,c){var d,e;if(!q.canProject(a,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),
null;if(this._isOutsideClippingArea(a))return null;var g=this._createBuffers(a,b);if(!g)return null;b=g.positionBuffer;for(var h=g.uvBuffer,m=g.colorBuffer,k=g.symbolColorBuffer,l=g.normalBuffer,p=g.tangentBuffer,g=g.objectTransformation,r=[],t=[],v=[],u=!1,w=0,z=this._getOrCreateComponents(a);w<z.length;w++){var x=z[w];if(!this._validateFaces(a,x))return null;var A=this._getOrCreateFaces(a,x);if(0!==A.length){var B=this._createComponentNormals(b,l,x,A);B.didFlipNormals&&(u=!0);var n=(d={},d[R.POSITION]=
{size:3,data:b},d[R.NORMAL]={size:3,data:B.normals},d),B=(e={},e[R.POSITION]=A,e[R.NORMAL]=B.indices,e);m&&(n[R.COLOR]={size:4,data:m},B[R.COLOR]=A);k&&(n[R.SYMBOLCOLOR]={size:4,data:k},B[R.SYMBOLCOLOR]=this._createColorIndices(A));a.vertexAttributes.uv&&(n[R.UV0]={size:2,data:h},B[R.UV0]=A);a.vertexAttributes.tangent&&(n[R.TANGENT]={size:4,data:p},B[R.TANGENT]=A);A=new J.GeometryData(n,B);A=new H(A,c+"_mesh");r.push(A);t.push(f.mat4f64.create());v.push(this._getOrCreateMaterial(a,x))}}u&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:r,transformations:t,materials:v,objectTransformation:g}};h.prototype._createEdgeMaterial=function(){var a={opacity:this._getLayerOpacity()};return C.createMaterial(this.symbolLayer,a)};h.validGeometryTypes=["mesh"];return h}(A.default);a.Graphics3DMeshFillSymbolLayer=n;var O=g.vec3f64.create(),N=g.vec3f64.create(),S=g.vec3f64.create(),P=g.vec3f64.create(),U=g.vec3f64.create(),Z=f.mat4f64.create(),V=h.mat3f64.create(),T=t.create(),Y=[new u];a.default=n})},"esri/geometry/support/MeshComponent":function(){define("require exports tslib ../../core/Accessor ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){var g=e.getLogger("esri.geometry.support.MeshComponent");return function(a){function e(b){b=a.call(this,b)||this;b.faces=null;b.material=null;b.shading="source";b.trustSourceNormals=!1;return b}d.__extends(e,a);l=e;e.from=function(a){return h.ensureClass(l,a)};e.prototype.castFaces=function(a){return b.castArray(a,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},g)};e.prototype.castMaterial=function(a){return a&&"object"===typeof a&&("metallic"in a||"roughness"in
a||"metallicRoughnessTexture"in a)?h.ensureClass(f,a):h.ensureClass(m,a)};e.prototype.clone=function(){return new l({faces:k.clone(this.faces),shading:this.shading,material:k.clone(this.material),trustSourceNormals:this.trustSourceNormals})};e.prototype.cloneWithDeduplication=function(a,b){return new l({faces:k.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(a,b):null,trustSourceNormals:this.trustSourceNormals})};var l;d.__decorate([c.property({json:{write:!0}})],
e.prototype,"faces",void 0);d.__decorate([c.cast("faces")],e.prototype,"castFaces",null);d.__decorate([c.property({type:m,json:{write:!0}})],e.prototype,"material",void 0);d.__decorate([c.cast("material")],e.prototype,"castMaterial",null);d.__decorate([c.property({type:String,json:{write:!0}})],e.prototype,"shading",void 0);d.__decorate([c.property({type:Boolean})],e.prototype,"trustSourceNormals",void 0);return e=l=d.__decorate([c.subclass("esri.geometry.support.MeshComponent")],e)}(l)})},"esri/geometry/support/MeshMaterial":function(){define("require exports tslib ../../Color ../../core/JSONSupport ../../core/lang ../../core/maybe ../../core/accessorSupport/decorators ./MeshTexture".split(" "),
function(n,a,d,l,k,e,c,h,m){return function(a){function b(b){b=a.call(this,b)||this;b.color=null;b.colorTexture=null;b.normalTexture=null;b.alphaMode="auto";b.alphaCutoff=.5;b.doubleSided=!0;return b}d.__extends(b,a);f=b;b.prototype.clone=function(){return this.cloneWithDeduplication(null,new Map)};b.prototype.cloneWithDeduplication=function(a,b){var d=c.isSome(a)?a.get(this):null;if(d)return d;b=new f(this.clonePropertiesWithDeduplication(b));c.isSome(a)&&a.set(this,b);return b};b.prototype.clonePropertiesWithDeduplication=
function(a){return{color:e.clone(this.color),colorTexture:this.colorTexture?this.colorTexture.cloneWithDeduplication(a):null,normalTexture:this.normalTexture?this.normalTexture.cloneWithDeduplication(a):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}};var f;d.__decorate([h.property({type:l,json:{write:!0}})],b.prototype,"color",void 0);d.__decorate([h.property({type:m,json:{write:!0}})],b.prototype,"colorTexture",void 0);d.__decorate([h.property({type:m,json:{write:!0}})],
b.prototype,"normalTexture",void 0);d.__decorate([h.property({json:{write:!0}})],b.prototype,"alphaMode",void 0);d.__decorate([h.property({json:{write:!0}})],b.prototype,"alphaCutoff",void 0);d.__decorate([h.property({json:{write:!0}})],b.prototype,"doubleSided",void 0);return b=f=d.__decorate([h.subclass("esri.geometry.support.MeshMaterial")],b)}(k.JSONSupport)})},"esri/geometry/support/MeshTexture":function(){define("require exports tslib @dojo/framework/shim/WeakMap ../../core/compilerUtils ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../support/persistableUrlUtils ../../views/support/screenshotUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f){var b=new l.default,g=0;return function(a){function e(b){b=a.call(this,b)||this;b.wrap="repeat";return b}d.__extends(e,a);l=e;Object.defineProperty(e.prototype,"url",{get:function(){return this._get("url")||null},set:function(a){this._set("url",a);a&&this._set("data",null)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"data",{get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)},enumerable:!1,
configurable:!0});e.prototype.writeData=function(a,b,c,d){a instanceof HTMLImageElement?a={type:"image-element",src:m.toJSON(a.src,d),crossOrigin:a.crossOrigin}:a instanceof HTMLCanvasElement?(a=a.getContext("2d").getImageData(0,0,a.width,a.height),a={type:"canvas-element",imageData:this.encodeImageData(a)}):a=a instanceof HTMLVideoElement?{type:"video-element",src:m.toJSON(a.src,d),autoplay:a.autoplay,loop:a.loop,muted:a.muted,crossOrigin:a.crossOrigin,preload:a.preload}:{type:"image-data",imageData:this.encodeImageData(a)};
b[c]=a};e.prototype.readData=function(a){switch(a.type){case "image-element":var b=new Image;b.src=a.src;b.crossOrigin=a.crossOrigin;return b;case "canvas-element":return a=this.decodeImageData(a.imageData),b=document.createElement("canvas"),b.width=a.width,b.height=a.height,b.getContext("2d").putImageData(a,0,0),b;case "image-data":return this.decodeImageData(a.imageData);case "video-element":return b=document.createElement("video"),b.src=a.src,b.crossOrigin=a.crossOrigin,b.autoplay=a.autoplay,b.loop=
a.loop,b.muted=a.muted,b.preload=a.preload,b;default:k.neverReached(a)}};Object.defineProperty(e.prototype,"transparent",{get:function(){var a=this.data,b=this.url;return a instanceof HTMLCanvasElement?this.imageDataContainsTransparent(a.getContext("2d").getImageData(0,0,a.width,a.height)):a instanceof ImageData?this.imageDataContainsTransparent(a):b&&(a=b.substr(b.length-4,4).toLowerCase(),b=b.substr(0,15).toLocaleLowerCase(),".png"===a||"data:image/png;"===b)?!0:!1},set:function(a){null!=a?this._override("transparent",
a):this._clearOverride("transparent")},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"contentHash",{get:function(){var a=this,c="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?this.wrap.horizontal+"/"+this.wrap.vertical:"",d=function(b){void 0===b&&(b="");return"d:"+b+",t:"+a.transparent+",w:"+c};if(null!=this.url)return d(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return d(this.data.src);b.has(this.data)||
b.set(this.data,++g);return d(b.get(this.data))}return d()},enumerable:!1,configurable:!0});e.prototype.clone=function(){return new l({url:this.url,data:this.data,wrap:this.cloneWrap()})};e.prototype.cloneWithDeduplication=function(a){var b=a.get(this);if(b)return b;b=new l({url:this.url,data:this.data,wrap:this.cloneWrap()});a.set(this,b);return b};e.prototype.cloneWrap=function(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};e.prototype.encodeImageData=
function(a){for(var b="",c=0;c<a.data.length;c++)b+=String.fromCharCode(a.data[c]);return{data:btoa(b),width:a.width,height:a.height}};e.prototype.decodeImageData=function(a){for(var b=atob(a.data),c=new Uint8ClampedArray(b.length),d=0;d<b.length;d++)c[d]=b.charCodeAt(d);return f.wrapImageData(c,a.width,a.height)};e.prototype.imageDataContainsTransparent=function(a){for(var b=3;b<a.data.length;b+=4)if(255!==a.data[b])return!0;return!1};e.from=function(a){return"string"===typeof a?new l({url:a}):a instanceof
HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData||a instanceof HTMLVideoElement?new l({data:a}):h.ensureClass(l,a)};var l;d.__decorate([c.property({type:String,json:{write:m.write}})],e.prototype,"url",null);d.__decorate([c.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),c.property()],e.prototype,"data",null);d.__decorate([c.writer("data")],e.prototype,"writeData",null);d.__decorate([c.reader("data")],e.prototype,"readData",null);d.__decorate([c.property({type:Boolean,
dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],e.prototype,"transparent",null);d.__decorate([c.property({json:{write:!0}})],e.prototype,"wrap",void 0);d.__decorate([c.property({readOnly:!0,dependsOn:["url","data","wrap","transparent"]})],e.prototype,"contentHash",null);return e=l=d.__decorate([c.subclass("esri.geometry.support.MeshTexture")],e)}(e.JSONSupport)})},"esri/views/support/screenshotUtils":function(){define(["require",
"exports","tslib","../../core/compilerUtils","../../core/mathUtils"],function(n,a,d,l,k){function e(a,c){var d=a||{},e=d.format,g=d.quality,h=d.rotation,d=d.disableSlice,p=b(a,c.padding),q;q=c.width-p.left-p.right;c=c.height-p.top-p.bottom;p={x:0,y:0,width:q,height:c};if(a&&a.area){null!=a.area.x&&(p.x=Math.floor(a.area.x));null!=a.area.y&&(p.y=Math.floor(a.area.y));var t=null!=a.area.width?Math.floor(a.area.width):null,v=null!=a.area.height?Math.floor(a.area.height):null;p.width=q-p.x;p.height=c-
p.y;null!=t&&null!=v?(p.width=Math.min(p.width,t),p.height=Math.min(p.height,v)):null==t&&null!=v?(t=Math.min(p.width,t),p.height*=t/p.width,p.width=t):null!=t&&null==v&&(t=Math.min(p.height,v),p.width*=t/p.height,p.height=t)}p=f(p,a);t=Math.floor(Math.max(p.x,0));v=Math.floor(Math.max(p.y,0));q={x:t,y:v,width:Math.floor(Math.min(p.width,q-t)),height:Math.floor(Math.min(p.height,c-v))};c=q.width/q.height;p=p.width/p.height;p!==c&&(p>c?(c=Math.floor(q.width/p),q={x:q.x,y:Math.floor(q.y+(q.height-c)/
2),width:q.width,height:c}):(c=Math.floor(q.height*p),q={x:Math.floor(q.x+(q.width-c)/2),y:q.y,width:c,height:q.height}));p=m(a,q);c=p.width;p=p.height;a:switch(e){case "png":case "jpg":case "jpeg":break a;case null:case void 0:e=u;break a;default:l.neverReached(e),e=u}t=r[e];g=k.clamp(null!=g?g:t,0,100);return{format:e,quality:g,area:q,width:c,height:p,rotation:h,disableSlice:!!d,ignoreBackground:!(!a||!a.ignoreBackground),ignorePadding:!(!a||!a.ignorePadding)}}function c(a,b){return a.toDataURL(t[b.format],
b.quality/100)}function h(a,b,c){c||(g||(g=document.createElement("canvas"),g.width=1,g.height=1),c=g);return c.getContext("2d").createImageData(a,b)}function m(a,b){if(!a)return b;var c=a.width;a=a.height;if(null!=c&&null!=a)return{width:Math.floor(c),height:Math.floor(a)};if(null==c&&null==a)return b;b=b.width/b.height;return null==a?{width:Math.floor(c),height:Math.floor(c/b)}:{width:Math.floor(a*b),height:Math.floor(a)}}function f(a,b){if(!b||null==b.width||null==b.height)return a;b=b.width/b.height;
var c=a.width/a.height;if(c===b)return a;if(c<b)return b=Math.floor(a.height*b),a.x-=(b-a.width)/2,a.width=b,a;b=Math.floor(a.width/b);a.y-=(b-a.height)/2;a.height=b;return a}function b(a,b){return!b||a&&a.ignorePadding?q:b}Object.defineProperty(a,"__esModule",{value:!0});a.screenshotSuperSampleSettings=a.resampleHermite=a.wrapImageData=a.createEmptyImageData=a.toDataUrl=a.encodeResult=a.toRenderSettings=a.completeUserSettings=void 0;a.completeUserSettings=e;a.toRenderSettings=function(a,c){var d=
e(a,c),f=d.area,g=d.width/f.width,h=b(d,c.padding),m=h.left+h.right,k=h.top+h.bottom;return{framebufferWidth:Math.floor((c.width-m)*g+m),framebufferHeight:Math.floor((c.height-k)*g+k),region:{x:Math.floor(f.x*g)+h.left,y:Math.floor(f.y*g)+h.top,width:d.width,height:d.height},format:d.format,quality:d.quality,rotation:d.rotation,pixelRatio:g,layers:a&&a.layers?a.layers:[],disableSlice:d.disableSlice,ignoreBackground:d.ignoreBackground,ignorePadding:d.ignorePadding}};a.encodeResult=function(a,b,d,e){if(e.premultipliedAlpha)for(var f=
a.data,g=f.length,h=0;h<g;h+=4){var m=f[h+3];0<m&&(m/=255,f[h+0]/=m,f[h+1]/=m,f[h+2]/=m)}d.width=a.width;d.height=a.height;f=d.getContext("2d");f.putImageData(a,0,0);e.flipY&&(f.save(),f.globalCompositeOperation="copy",f.scale(1,-1),f.translate(0,-f.canvas.height),f.drawImage(f.canvas,0,0),f.restore());a=f.getImageData(0,0,a.width,a.height);b=c(d,b);d.width=0;d.height=0;return{dataUrl:b,data:a}};a.toDataUrl=c;a.createEmptyImageData=function(a,b,c){if(!a||!b)throw Error("Cannot construct image data without dimensions");
if(p)try{return new ImageData(a,b)}catch(x){p=!1}return h(a,b,c)};a.wrapImageData=function(a,b,c,d){if(!b||!c)throw Error("Cannot construct image data without dimensions");if(p)try{return new ImageData(a,b,c)}catch(B){p=!1}b=h(b,c,d);b.data.set(a,0);return b};a.resampleHermite=function(a,b,c,d,e,f,g,h){void 0===d&&(d=0);void 0===e&&(e=0);void 0===f&&(f=a.width-d);void 0===g&&(g=a.height-e);void 0===h&&(h=!1);var m=a.data,k=b.width,l=b.height,p=b.data;f/=k;g/=l;var r=Math.ceil(f/2),q=Math.ceil(g/2);
a=a.width;for(var t=0;t<l;t++)for(var v=0;v<k;v++){for(var u=4*(v+(h?l-t-1:t)*k),w=0,x=0,z=0,A=0,B=0,n=0,C=(t+.5)*g,E=Math.floor(t*g);E<(t+1)*g;E++)for(var T=Math.abs(C-(E+.5))/q,Y=(v+.5)*f,T=T*T,X=Math.floor(v*f);X<(v+1)*f;X++){var ca=Math.abs(Y-(X+.5))/r,ca=Math.sqrt(T+ca*ca);if(!(1<=ca)){var ca=2*ca*ca*ca-3*ca*ca+1,ba=4*(d+X+(e+E)*a),n=n+ca*m[ba+3],x=x+ca;!c&&255>m[ba+3]&&(ca=ca*m[ba+3]/255);z+=ca*m[ba];A+=ca*m[ba+1];B+=ca*m[ba+2];w+=ca}}p[u]=z/w;p[u+1]=A/w;p[u+2]=B/w;p[u+3]=n/x}return b};a.screenshotSuperSampleSettings=
function(a,c,e){if(!c)return a;c=a.framebufferWidth;var f=a.framebufferHeight,g=a.pixelRatio,h=a.region;e=b(a,e);var m=e.left+e.right,k=e.top+e.bottom,l=c-m,p=f-k,r=Math.min(8,Math.min((2048-m)/l,(2048-k)/p));return 1.5>r?a:d.__assign(d.__assign({},a),{framebufferWidth:Math.round(l*r)+m,framebufferHeight:Math.round(p*r)+k,pixelRatio:g*r,resample:{region:{x:Math.round((h.x-e.left)*r)+e.left,y:Math.round((h.y-e.top)*r)+e.top,width:Math.round(h.width*r),height:Math.round(h.height*r)},width:c,height:f}})};
var g=null,p=!0,t={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},u="jpg",r={png:100,jpg:98,jpeg:98},q={top:0,right:0,bottom:0,left:0}})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("require exports tslib ../../Color ../../core/maybe ../../core/accessorSupport/decorators ./MeshMaterial ./MeshTexture".split(" "),function(n,a,d,l,k,e,c,h){return function(a){function c(b){b=a.call(this,b)||this;b.emissiveColor=null;b.emissiveTexture=null;b.occlusionTexture=null;b.metallic=
1;b.roughness=1;b.metallicRoughnessTexture=null;return b}d.__extends(c,a);b=c;c.prototype.clone=function(){return this.cloneWithDeduplication(null,new Map)};c.prototype.cloneWithDeduplication=function(a,c){var d=k.isSome(a)?a.get(this):null;if(d)return d;c=new b(this.clonePropertiesWithDeduplication(c));k.isSome(a)&&a.set(this,c);return c};c.prototype.clonePropertiesWithDeduplication=function(b){return d.__assign(d.__assign({},a.prototype.clonePropertiesWithDeduplication.call(this,b)),{emissiveColor:this.emissiveColor?
this.emissiveColor.clone():null,emissiveTexture:this.emissiveTexture?this.emissiveTexture.cloneWithDeduplication(b):null,occlusionTexture:this.occlusionTexture?this.occlusionTexture.cloneWithDeduplication(b):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?this.metallicRoughnessTexture.cloneWithDeduplication(b):null})};var b;d.__decorate([e.property({type:l,json:{write:!0}})],c.prototype,"emissiveColor",void 0);d.__decorate([e.property({type:h,
json:{write:!0}})],c.prototype,"emissiveTexture",void 0);d.__decorate([e.property({type:h,json:{write:!0}})],c.prototype,"occlusionTexture",void 0);d.__decorate([e.property({type:Number,json:{write:!0},range:{min:0,max:1}})],c.prototype,"metallic",void 0);d.__decorate([e.property({type:Number,json:{write:!0},range:{min:0,max:1}})],c.prototype,"roughness",void 0);d.__decorate([e.property({type:h,json:{write:!0}})],c.prototype,"metallicRoughnessTexture",void 0);return c=b=d.__decorate([e.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],
c)}(c)})},"esri/geometry/support/MeshVertexAttributes":function(){define("require exports tslib ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),function(n,a,d,l,k,e,c){function h(a,b,c,d){var e=b.loggerTag;b=b.stride;return 0!==a.length%b?(d.error(e,"Invalid array length, expected a multiple of "+b),new c([])):a}function m(a,b,c,d,e){if(!a)return a;if(a instanceof b)return h(a,d,b,e);for(var f=0;f<c.length;f++)if(a instanceof c[f])return h(new b(a),
d,b,e);if(Array.isArray(a))return h(new b(a),d,b,e);c=c.map(function(a){return"'"+a.name+"'"});e.error("Failed to set property, expected one of "+c+", but got "+a.constructor.name);return new b([])}function f(a,b,c){for(var d=Array(a.length),e=0;e<a.length;e++)d[e]=a[e];b[c]=d}Object.defineProperty(a,"__esModule",{value:!0});a.castArray=a.MeshVertexAttributes=void 0;var b=e.getLogger("esri.geometry.support.MeshVertexAttributes");n=function(a){function e(b){b=a.call(this,b)||this;b.color=null;b.position=
new Float64Array(0);b.uv=null;b.normal=null;b.tangent=null;return b}d.__extends(e,a);g=e;e.prototype.castColor=function(a){return m(a,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},b)};e.prototype.castPosition=function(a){a&&a instanceof Float32Array&&b.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return m(a,Float64Array,[Float32Array],{loggerTag:".position\x3d",
stride:3},b)};e.prototype.castUv=function(a){return m(a,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},b)};e.prototype.castNormal=function(a){return m(a,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},b)};e.prototype.castTangent=function(a){return m(a,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},b)};e.prototype.clone=function(){var a={position:k.clone(this.position),uv:k.clone(this.uv),normal:k.clone(this.normal),tangent:k.clone(this.tangent),color:k.clone(this.color)};
return new g(a)};var g;d.__decorate([c.property({json:{write:f}})],e.prototype,"color",void 0);d.__decorate([c.cast("color")],e.prototype,"castColor",null);d.__decorate([c.property({nonNullable:!0,json:{write:f}})],e.prototype,"position",void 0);d.__decorate([c.cast("position")],e.prototype,"castPosition",null);d.__decorate([c.property({json:{write:f}})],e.prototype,"uv",void 0);d.__decorate([c.cast("uv")],e.prototype,"castUv",null);d.__decorate([c.property({json:{write:f}})],e.prototype,"normal",
void 0);d.__decorate([c.cast("normal")],e.prototype,"castNormal",null);d.__decorate([c.property({json:{write:f}})],e.prototype,"tangent",void 0);d.__decorate([c.cast("tangent")],e.prototype,"castTangent",null);return e=g=d.__decorate([c.subclass("esri.geometry.support.MeshVertexAttributes")],e)}(l.JSONSupport);a.MeshVertexAttributes=n;a.castArray=m;a.default=n})},"esri/geometry/support/meshUtils/projection":function(){define("require exports ../../../core/Logger ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../views/3d/support/projectionUtils ../../../views/3d/support/buffer/BufferView".split(" "),
function(n,a,d,l,k,e,c,h,m,f){function b(a,b,d,e,f,g){if(b){var h=d.count;if(f.isWGS84)for(f=0;f<h;f++)e.getVec(f,p),b.getVec(f,t),m.computeLinearTransformation(m.SphericalECEFSpatialReference,p,u,m.SphericalECEFSpatialReference),l.mat3.fromMat4(r,u),1===a&&l.mat3.transpose(r,r),c.vec3.transformMat3(t,t,r),g.setVec(f,t);else for(f=0;f<h;f++){e.getVec(f,p);b.getVec(f,t);m.computeLinearTransformation(m.SphericalECEFSpatialReference,p,u,m.SphericalECEFSpatialReference);l.mat3.fromMat4(r,u);var k=m.webMercator.y2lat(d.get(f,
1)),k=Math.cos(k);0===a&&(k=1/k);r[0]*=k;r[1]*=k;r[2]*=k;r[3]*=k;r[4]*=k;r[5]*=k;1===a&&l.mat3.transpose(r,r);c.vec3.transformMat3(t,t,r);c.vec3.normalize(t,t);g.setVec(f,t)}return g}}Object.defineProperty(a,"__esModule",{value:!0});a.projectTangentFromECEF=a.projectTangentToECEF=a.transformBufferInPlace=a.projectFromECEF=a.projectToECEF=a.projectNormalFromECEF=a.projectNormalToECEF=void 0;var g=d.getLogger("esri.geometry.support.meshUtils.normalProjection");a.projectNormalToECEF=function(a,c,d,e,
h){if(!e.isWebMercator&&!e.isWGS84)return g.error("Cannot convert PCS spatial reference buffer to ECEF"),h;b(0,f.BufferViewVec3f.fromTypedArray(a),f.BufferViewVec3f64.fromTypedArray(c),f.BufferViewVec3f64.fromTypedArray(d),e,f.BufferViewVec3f.fromTypedArray(h));return h};a.projectNormalFromECEF=function(a,c,d,e,h){if(!e.isWebMercator&&!e.isWGS84)return g.error("Cannot convert to PCS spatial reference buffer from ECEF"),h;b(1,f.BufferViewVec3f.fromTypedArray(a),f.BufferViewVec3f64.fromTypedArray(c),
f.BufferViewVec3f64.fromTypedArray(d),e,f.BufferViewVec3f.fromTypedArray(h));return h};a.projectToECEF=function(a,b,c){m.bufferToBuffer(a,b,0,c,m.SphericalECEFSpatialReference,0,a.length/3);return c};a.projectFromECEF=function(a,b,c){m.bufferToBuffer(a,m.SphericalECEFSpatialReference,0,b,c,0,a.length/3);return b};a.transformBufferInPlace=function(a,b,d){void 0===d&&(d=!1);if(a)for(var e=0;e<a.length;e+=3){for(var f=0;3>f;f++)p[f]=a[e+f];c.vec3.transformMat4(p,p,b);d&&c.vec3.normalize(p,p);for(f=0;3>
f;f++)a[e+f]=p[f]}};a.projectTangentToECEF=function(a,c,d,e,h){if(!e.isWebMercator&&!e.isWGS84)return g.error("Cannot convert PCS spatial reference buffer to ECEF"),h;b(0,f.BufferViewVec3f.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT),f.BufferViewVec3f64.fromTypedArray(c),f.BufferViewVec3f64.fromTypedArray(d),e,f.BufferViewVec3f.fromTypedArray(h,4*Float32Array.BYTES_PER_ELEMENT));for(c=3;c<a.length;c+=4)h[c]=a[c];return h};a.projectTangentFromECEF=function(a,c,d,e,h){if(!e.isWebMercator&&!e.isWGS84)return g.error("Cannot convert to PCS spatial reference buffer from ECEF"),
h;b(1,f.BufferViewVec3f.fromTypedArray(a,16),f.BufferViewVec3f64.fromTypedArray(c),f.BufferViewVec3f64.fromTypedArray(d),e,f.BufferViewVec3f.fromTypedArray(h,16));for(c=3;c<a.length;c+=4)h[c]=a[c];return h};var p=h.vec3f64.create(),t=h.vec3f64.create(),u=e.mat4f64.create(),r=k.mat3f64.create()})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/maybe"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});
a.encodeSymbolColor=a.parseColorMixMode=void 0;a.parseColorMixMode=function(a){switch(a){case "multiply":return 1;case "ignore":return 2;case "replace":return 3;case "tint":return 4;default:return 1}};a.encodeSymbolColor=function(a,f,b){if(l.isNone(a)||2===f)b[0]=255,b[1]=255,b[2]=255,b[3]=255;else{var g=d.clamp(Math.round(a[3]*e),0,e);f=0===g||4===f?0:3===f?c:h;b[0]=d.clamp(Math.round(a[0]*k),0,k);b[1]=d.clamp(Math.round(a[1]*k),0,k);b[2]=d.clamp(Math.round(a[2]*k),0,k);b[3]=g+f}};var k=255,e=85,
c=e,h=2*e})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports tslib ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/BufferView ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/utils ../shaders/NativeLineTechnique".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z){var x=l.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");n=function(a){function b(b,c){c=a.call(this,c)||this;c.techniqueConfig=new z.NativeLineTechniqueConfiguration;c.params=v.copyParameters(b,C);return c}d.__extends(b,a);b.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)b[c]=a[c];this.parametersChanged()};b.prototype.getParameters=function(){return this.params};b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=
a;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.transparent=1>this.params.color[3]||1>this.params.width;a=k.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=a;this.techniqueConfig.stippleOffColorEnabled=a&&k.isSome(this.params.stippleOffColor);this.techniqueConfig.stippleIntegerRepeatsEnabled=a&&this.params.stippleIntegerRepeats;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;
return this.techniqueConfig};b.prototype.getPassParameters=function(){return this.params};b.prototype.intersect=function(a,b,c,d,e,f,g,h,m){m?v.intersectDrapedRenderLineGeometry(a,d,f,1,g):this.intersectLineGeometry(a,b,c,d,g)};b.prototype.intersectLineGeometry=function(a,b,d,e,g){if(e.options.selectionMode&&!w.isInstanceHidden(b))if(u.isTranslationMatrix(d)){b=a.data.getVertexAttr().position.data;var m=e.camera,k=R;c.vec2.copy(k,e.point);h.vec3.set(O[0],k[0]-2,k[1]+2,0);h.vec3.set(O[1],k[0]+2,k[1]+
2,0);h.vec3.set(O[2],k[0]+2,k[1]-2,0);h.vec3.set(O[3],k[0]-2,k[1]-2,0);for(var l=0;4>l;l++)m.unprojectPoint(O[l],N[l]);f.plane.fromPoints(m.eye,N[0],N[1],S);f.plane.fromPoints(m.eye,N[1],N[2],P);f.plane.fromPoints(m.eye,N[2],N[3],U);f.plane.fromPoints(m.eye,N[3],N[0],Z);a=Number.MAX_VALUE;for(l=0;l<b.length-5;l+=3)if(E[0]=b[l]+d[12],E[1]=b[l+1]+d[13],E[2]=b[l+2]+d[14],G[0]=b[l+3]+d[12],G[1]=b[l+4]+d[13],G[2]=b[l+5]+d[14],!(0>f.plane.signedDistance(S,E)&&0>f.plane.signedDistance(S,G)||0>f.plane.signedDistance(P,
E)&&0>f.plane.signedDistance(P,G)||0>f.plane.signedDistance(U,E)&&0>f.plane.signedDistance(U,G)||0>f.plane.signedDistance(Z,E)&&0>f.plane.signedDistance(Z,G))){m.projectPoint(E,J);m.projectPoint(G,I);if(0>J[2]&&0<I[2]){h.vec3.subtract(F,E,G);var p=m.frustum,r=-f.plane.signedDistance(p.planes[4],E),p=r/h.vec3.dot(F,f.plane.normal(p.planes[4]));h.vec3.scale(F,F,p);h.vec3.add(E,E,F);m.projectPoint(E,J)}else if(0<J[2]&&0>I[2])h.vec3.subtract(F,G,E),p=m.frustum,r=-f.plane.signedDistance(p.planes[4],G),
p=r/h.vec3.dot(F,f.plane.normal(p.planes[4])),h.vec3.scale(F,F,p),h.vec3.add(G,G,F),m.projectPoint(G,I);else if(0>J[2]&&0>I[2])continue;J[2]=0;I[2]=0;p=f.lineSegment.distance2(f.lineSegment.fromPoints(J,I,M),k);p<a&&(a=p,h.vec3.copy(K,E),h.vec3.copy(L,G))}d=e.rayBeginPoint;e=e.rayEndPoint;4>a&&(a=Number.MAX_VALUE,f.lineSegment.closestLineSegmentPoint(f.lineSegment.fromPoints(K,L,M),f.lineSegment.fromPoints(d,e,Q),H)&&(h.vec3.subtract(H,H,d),a=h.vec3.length(H),h.vec3.scale(H,H,1/a),a/=h.vec3.distance(d,
e)),g(a,H))}else x.error("intersection assumes a translation-only matrix")};b.prototype.computeAttachmentOrigin=function(a,b){a=a.data;return(a="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null)?g.computeAttachmentOriginLines(a[u.VertexAttrConstants.POSITION],null,!1,b):null};b.prototype.createBufferWriter=function(){var a=this.params.vertexColors?q.PositionColorLayout:q.PositionLayout;return k.isNone(this.params.stipplePattern)?new q.DefaultBufferWriter(a):new A(a.clone().vec3f(u.VertexAttrConstants.AUXPOS1))};
b.prototype.getGLMaterial=function(a){return 0===a.output||4===a.output?new B(a):void 0};return b}(t.Material);var B=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}d.__extends(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(z.NativeLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=function(a){return 3===a};b.prototype._updateOccludeeState=function(a){a.hasOccludees!==
this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype.ensureParameters=function(a){0===this.output&&this._updateOccludeeState(a)};b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters(),b)};b.prototype.getPipelineState=function(a,b){return b?this.technique.opaqueOccludeeState:this.technique.pipeline};return b}(p.GLMaterial),A=
function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[u.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d){r.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,c,d);this.writeAuxpos1(a,b,c,d)};a.prototype.writeAuxpos1=function(a,c,d,e){var f=d.getField(u.VertexAttrConstants.AUXPOS1,b.BufferViewVec3f);d=c.indices[u.VertexAttrConstants.POSITION];
c=c.vertexAttr[u.VertexAttrConstants.POSITION].data;a=a.transformation;var g=f.typedBufferStride,f=f.typedBuffer;e*=g;for(var h=0;h<d.length;h+=2)for(var m=3*d[h],k=c[m],l=c[m+1],p=c[m+2],m=a[0]*k+a[4]*l+a[8]*p+a[12],r=a[1]*k+a[5]*l+a[9]*p+a[13],k=a[2]*k+a[6]*l+a[10]*p+a[14],l=0;2>l;++l)f[e]=m,f[e+1]=r,f[e+2]=k,e+=g};return a}(),C={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1},E=m.vec3f64.create(),
G=m.vec3f64.create(),F=m.vec3f64.create(),H=m.vec3f64.create(),J=e.createRenderScreenPointArray3(),I=e.createRenderScreenPointArray3(),K=m.vec3f64.create(),L=m.vec3f64.create(),M=f.lineSegment.create(),Q=f.lineSegment.create(),R=m.vec3f64.create(),O=[e.createRenderScreenPointArray3(),e.createRenderScreenPointArray3(),e.createRenderScreenPointArray3(),e.createRenderScreenPointArray3()],N=[m.vec3f64.create(),m.vec3f64.create(),m.vec3f64.create(),m.vec3f64.create()],S=f.plane.create(),P=f.plane.create(),
U=f.plane.create(),Z=f.plane.create();return n})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["require","exports","../../../support/buffer/InterleavedLayout","../../lib/Util","./bufferWriterUtils"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.DefaultBufferWriter=a.PositionColorMapSpaceUVBoundsLayout=a.PositionColorMapSpaceUVLayout=a.PositionColorLayout=a.PositionUVLayout=a.PositionLayout=void 0;a.PositionLayout=d.newLayout().vec3f(l.VertexAttrConstants.POSITION);
a.PositionUVLayout=d.newLayout().vec3f(l.VertexAttrConstants.POSITION).vec2f(l.VertexAttrConstants.UV0);a.PositionColorLayout=d.newLayout().vec3f(l.VertexAttrConstants.POSITION).vec4u8(l.VertexAttrConstants.COLOR);a.PositionColorMapSpaceUVLayout=d.newLayout().vec3f(l.VertexAttrConstants.POSITION).vec4u8(l.VertexAttrConstants.COLOR).vec4f(l.VertexAttrConstants.UVMAPSPACE).vec3f(l.VertexAttrConstants.MEANVERTEXPOSITION);a.PositionColorMapSpaceUVBoundsLayout=d.newLayout().vec3f(l.VertexAttrConstants.POSITION).vec4u8(l.VertexAttrConstants.COLOR).vec4f(l.VertexAttrConstants.UVMAPSPACE).vec3f(l.VertexAttrConstants.BOUND1).vec3f(l.VertexAttrConstants.BOUND2).vec3f(l.VertexAttrConstants.BOUND3);
n=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[l.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,d,e,f){k.writeDefaultAttributes(d,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,e,f)};return a}();a.DefaultBufferWriter=n})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports tslib ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ./NativeLine.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){Object.defineProperty(a,"__esModule",{value:!0});a.NativeLineTechniqueConfiguration=a.NativeLineTechnique=void 0;m=function(a){function f(b,c){c=a.call(this,b,c)||this;c.stipplePattern=null;c.stippleTextureBind=null;c.stippleTextureRepository=b.stippleTextureRepository;return c}d.__extends(f,a);f.prototype.initializeProgram=function(a){var c=f.shader.get(),d=this.configuration,c=c.build({output:d.output,attributeColor:d.vertexColors,slicePlaneEnabled:d.slicePlaneEnabled,
sliceHighlightDisabled:d.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,stippleEnabled:d.stippleEnabled,stippleOffColorEnabled:d.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:d.stippleIntegerRepeatsEnabled});return new t(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),b.Default3D)};f.prototype.dispose=function(){a.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=
null};f.prototype.bindPass=function(a,b,d){c.View.bindProjectionMatrix(this.program,d.camera.projectionMatrix);if(this.stipplePattern!==b.stipplePattern){var f=b.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,f);this.stipplePattern=f}this.configuration.stippleEnabled&&(f=l.isSome(this.stippleTextureBind)?this.stippleTextureBind(a,0)*d.camera.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",
1/f),this.program.setUniform2f("ndcToPixel",d.camera.fullViewport[2]/2,d.camera.fullViewport[3]/2));this.program.setUniform4fv("constantColor",b.color);this.program.setUniform1f("alphaCoverage",Math.min(1,b.width*d.camera.pixelRatio));this.configuration.stippleOffColorEnabled&&(b=l.unwrap(b.stippleOffColor),this.program.setUniform4f("stippleOffColor",b[0],b[1],b[2],3<b.length?b[3]:1));4===this.configuration.output&&e.OutputHighlight.bindOutputHighlight(a,this.program,d)};f.prototype.bindDraw=function(a){c.View.bindView(this.program,
a);k.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};f.prototype.initializePipeline=function(){var a=this.configuration,b=u.separateBlendingParams(770,1,771,771),c=function(b,c,d){void 0===c&&(c=null);void 0===d&&(d=null);return u.makePipelineState({blending:c,depthTest:g.depthCompareLess,depthWrite:d,colorWrite:u.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?g.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?b?g.stencilToolMaskBaseParams:g.stencilBaseAllZerosParams:
null})};return 0===a.output?(this._occludeeState=c(!0,a.transparent||a.stippleEnabled?b:null,u.defaultDepthWriteParams),c(!1,a.transparent||a.stippleEnabled?b:null,u.defaultDepthWriteParams)):c(!1)};Object.defineProperty(f.prototype,"primitiveType",{get:function(){return 1},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!1,configurable:!0});f.shader=new h.ReloadableShaderModule(p,function(){return new Promise(function(a,
b){n(["./NativeLine.glsl"],a,b)})});return f}(m.ShaderTechnique);a.NativeLineTechnique=m;m=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.vertexColors=!1;b.transparent=!1;b.stippleEnabled=!1;b.stippleOffColorEnabled=!1;b.stippleIntegerRepeatsEnabled=!1;b.sceneHasOcludees=!1;return b}d.__extends(b,a);d.__decorate([f.parameter({count:7})],b.prototype,"output",void 0);d.__decorate([f.parameter()],b.prototype,"slicePlaneEnabled",
void 0);d.__decorate([f.parameter()],b.prototype,"sliceHighlightDisabled",void 0);d.__decorate([f.parameter()],b.prototype,"vertexColors",void 0);d.__decorate([f.parameter()],b.prototype,"transparent",void 0);d.__decorate([f.parameter()],b.prototype,"stippleEnabled",void 0);d.__decorate([f.parameter()],b.prototype,"stippleOffColorEnabled",void 0);d.__decorate([f.parameter()],b.prototype,"stippleIntegerRepeatsEnabled",void 0);d.__decorate([f.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(f.ShaderTechniqueConfiguration);
a.NativeLineTechniqueConfiguration=m})},"esri/views/3d/webgl-engine/shaders/NativeLine.glsl":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/LineStipple.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(n,a,d,l,k,e,c,h,
m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var v=new b.ShaderBuilder;v.include(k.Transform,{linearDepth:!1});v.include(e.VertexColor,a);v.include(h.LineStipple,a);v.vertex.uniforms.add("proj","mat4").add("view","mat4");v.attributes.add("position","vec3");v.varyings.add("vpos","vec3");v.vertex.code.add(f.glsl(g||(g=d.__makeTemplateObject(["\n    void main(void) {\n      vpos \x3d position;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n  "],
["\n    void main(void) {\n      vpos \x3d position;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n  "]))));a.stippleEnabled&&(v.attributes.add("auxpos1","vec3"),v.vertex.uniforms.add("ndcToPixel","vec2"),v.vertex.code.add(f.glsl(p||(p=d.__makeTemplateObject(["\n    vec4 vpos2 \x3d transformPosition(proj, view, auxpos1);\n    float lineSegmentPixelSize \x3d length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv \x3d lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ",
"\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *\x3d gl_Position.w;\n    "],["\n    vec4 vpos2 \x3d transformPosition(proj, view, auxpos1);\n    float lineSegmentPixelSize \x3d length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv \x3d lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ","\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *\x3d gl_Position.w;\n    "])),
a.stippleIntegerRepeatsEnabled?"stipplePatternUv \x3d floor(stipplePatternUv + 0.5);":"")));v.vertex.code.add(f.glsl(t||(t=d.__makeTemplateObject(["\n  }\n  "],["\n  }\n  "]))));4===a.output&&v.include(c.OutputHighlight);v.include(l.Slice,a);v.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float");v.fragment.code.add(f.glsl(q||(q=d.__makeTemplateObject(["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color \x3d ",";\n\n    float stippleAlpha \x3d getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n    vec4 finalColor \x3d blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);\n\n    if (finalColor.a \x3c ",
") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "],["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color \x3d ",";\n\n    float stippleAlpha \x3d getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n    vec4 finalColor \x3d blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);\n\n    if (finalColor.a \x3c ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),a.attributeColor?"vColor":"constantColor",f.glsl.float(m.symbolAlphaCutoff),
0===a.output?f.glsl(u||(u=d.__makeTemplateObject(["gl_FragColor \x3d highlightSlice(finalColor, vpos);"],["gl_FragColor \x3d highlightSlice(finalColor, vpos);"]))):"",4===a.output?f.glsl(r||(r=d.__makeTemplateObject(["outputHighlight();"],["outputHighlight();"]))):""));return v};var g,p,t,u,r,q})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../core/lang ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../support/pointUtils ../../support/projectionUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M){Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DObjectSymbolLayer=void 0;n=function(a){function m(b,c,d,e){b=a.call(this,b,c,d,e)||this;b._resources=null;b._optionalFields=[];b._instanceIndexToGraphicUid=new Map;b.ensureDrapedStatus(!1);return b}d.__extends(m,a);m.prototype.getCachedSize=function(){var a=e.isSome(this._resources)?this._resources.symbolSize:[1,1,1];return{width:a[0],depth:a[1],height:a[2]}};m.prototype.doLoad=
function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e,f,g;return d.__generator(this,function(d){switch(d.label){case 0:b=this._getIdHint("_objectmat");if(!this._drivenProperties.size&&(c=x.validateSymbolLayerSize(this.symbolLayer)))throw Error();e=this.symbolLayer;if(!this.isPrimitive)return[3,1];f=e.resource?e.resource.primitive:t.defaultPrimitive;this._resources=this._createResourcesForPrimitive(f,b);return[3,3];case 1:return g=this,[4,this._createResourcesForUrl(e.resource.href,
a)];case 2:g._resources=d.sent(),d.label=3;case 3:return this.complexity=this.computeComplexity(),[2]}})})};Object.defineProperty(m.prototype,"extentPadding",{get:function(){return e.isSome(this._resources)?this._resources.extentPadding:0},enumerable:!1,configurable:!0});Object.defineProperty(m.prototype,"isPrimitive",{get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)},enumerable:!1,configurable:!0});Object.defineProperty(m.prototype,"lodRenderer",{get:function(){return e.get(this._resources,
"lodRenderer")},enumerable:!1,configurable:!0});m.prototype.setMaterialTransparencyParams=function(a,b){void 0===b&&(b=e.get(this.symbolLayer,"material","color"));b=this._getCombinedOpacity(b);a.transparent=1>b||this.needsDrivenTransparentPass;a.opacity=b;return a};m.prototype._createResourcesForPrimitive=function(a,d){if(!E.isValidPrimitive(a))throw Error("Unknown object symbol primitive: "+a);var h=this.symbolLayer,m=p.create(u.objectSymbolLayerPrimitiveBoundingBox(a)),r=b.vec3f64.fromArray(p.size(m)),
q=b.vec3f64.fromArray(u.objectSymbolLayerSizeWithResourceSize(r,h)),t=f.vec3.length(q),v={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:b.vec3f64.ONES,diffuse:b.vec3f64.ONES,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},w=v.usePBR;this.setMaterialTransparencyParams(v);var x=this.symbol;if("point-3d"===x.type&&x.verticalOffset){var x=
x.verticalOffset,z=x.minWorldLength,A=x.maxWorldLength;v.verticalOffset={screenLength:c.pt2px(x.screenLength),minWorldLength:z||0,maxWorldLength:null!=A?A:Infinity};v.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(v.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?v.externalColor=g.vec4f64.ONES:(h=e.isSome(h.material)&&h.material.color,h=e.isSome(h)?l.toUnitRGBA(h):g.vec4f64.ONES,v.externalColor=h);this._fastUpdates=F.initFastSymbolUpdatesState(this._context.renderer,
this._fastVisualVariableConvertOptions(m,q,r,e.none));this._fastUpdates.enabled?(k.mixin(v,this._fastUpdates.materialParameters),v.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(v.instanced.push("color"),this._optionalFields.push("color"));v=new M(v,d);d=E.primitiveLodResources(a,v,d);if(!d)throw Error("Unknown object symbol primitive: "+a);a=L.materialsFromLodResources(d).map(function(a){return{opacity:1,transparent:a.getParameters().transparent}});
v=this._createStageResources(d,w);h=this._createLodRenderer(d);return{lodResources:d,lodRenderer:h,stageResources:v,symbolSize:q,extentPadding:t,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:a,physicalBasedRenderingEnabled:w,resourceBoundingBox:m,resourceSize:r,dispose:e.none,pivotOffset:e.none}};m.prototype._createResourcesForUrl=function(a,g){return d.__awaiter(this,void 0,void 0,function(){var h,m,l,r,q,t,v,w,x,z,n,C,I,E,G,H,K,J,P,Q,S,M,Z,V,R,U,y,N,O,Ha=this;return d.__generator(this,
function(d){switch(d.label){case 0:return h=["transformation"],m={instanced:h,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},l={materialParamsMixin:m,streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache},this._fastUpdates=F.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(e.none,e.none,e.none,e.none)),this._fastUpdates.enabled?(k.mixin(l.materialParamsMixin,
this._fastUpdates.materialParameters),h.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.push("color"),this._optionalFields.push("color")),r=this.symbol,"point-3d"===r.type&&r.verticalOffset&&(q=r.verticalOffset,t=q.screenLength,v=q.minWorldLength,w=q.maxWorldLength,l.materialParamsMixin.verticalOffset={screenLength:c.pt2px(t),minWorldLength:v||0,maxWorldLength:null!=w?w:Infinity},l.materialParamsMixin.castShadows=!1),l.signal=g,l.usePBR=this._context.physicalBasedRenderingEnabled,
x=l.usePBR,[4,A.fetch(a,l)];case 1:return z=d.sent(),n=z.isEsriSymbolResource,C=z.isWosr,I=z.remove,E=B.makeLodResources(z.lods),B.fillEstimatedMinScreenSpaceRadius(E),E.levels.sort(function(a,b){return a.minScreenSpaceRadius-b.minScreenSpaceRadius}),E.levels[0].minScreenSpaceRadius=Math.min(2,E.levels[0].minScreenSpaceRadius),G=this._context,H=this.symbolLayer.material,K=this._getExternalColorParameters(H),J=e.get(this.symbolLayer,"material","color"),P=this._getCombinedOpacity(J,{hasIntrinsicColor:!0}),
Q=this.needsDrivenTransparentPass,S=L.materialsFromLodResources(E),M=L.materialsFromLodResources(E).map(function(a){a=a.getParameters();return{opacity:a.opacity||1,transparent:a.transparent}}),S.forEach(function(a){var b=a.getParameters();a.setParameterValues(K);var c=b.opacity*P;a.setParameterValues({opacity:c,transparent:1>c||Q||b.transparent});G.screenSizePerspectiveEnabled&&a.setParameterValues({screenSizePerspective:G.sharedResources.screenSizePerspectiveSettings})}),Z=z.referenceBoundingBox,
V=b.vec3f64.fromArray(p.size(Z)),R=b.vec3f64.fromArray(E.levels[0].pivotOffset),U=b.vec3f64.fromArray(u.objectSymbolLayerSizeWithResourceSize(V,this.symbolLayer)),y=f.vec3.length(U),F.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(Z,U,V,R))&&S.forEach(function(a){return a.setParameterValues(Ha._fastUpdates.materialParameters)}),N=this._createStageResources(E,x),O=this._createLodRenderer(E),[2,{lodResources:E,lodRenderer:O,stageResources:N,
symbolSize:U,extentPadding:y,isEsriSymbolResource:n,isWosr:C,originalMaterialParameters:M,physicalBasedRenderingEnabled:x,resourceBoundingBox:Z,resourceSize:V,dispose:I,pivotOffset:R}]}})})};m.prototype._createStageResources=function(a,b){var c=this._context.stage,d=L.materialsFromLodResources(a);b!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();for(b=0;b<d.length;b++)c.add(3,d[b]);b=L.texturesFromLodResources(a);for(var e=0;e<b.length;e++)c.add(4,b[e]);a=L.geometriesFromLodResources(a);
for(e=0;e<a.length;e++)c.add(2,a[e]);return{materials:d,textures:b,geometries:a}};m.prototype._createLodRenderer=function(a){var b=this,c=this._context.stage;a=new K.LodRenderer(a,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:function(a){return b._instanceIndexToGraphicUid.get(a)},notifyGraphicUpdate:function(a,c){return b._context.notifyGraphicUpdate(b._instanceIndexToGraphicUid.get(a),c)}},this._fastUpdates.enabled?{applyTransform:function(a,c,d){a.getFeatureAttribute(c,N);h.mat4.copy(d,
F.evaluateModelTransform(b._fastUpdates.materialParameters,N,d))},scaleFactor:function(a,c,d){c.getFeatureAttribute(d,N);return F.evaluateModelTransformScale(a,b._fastUpdates.materialParameters,N)}}:null);a.slicePlane=this._context.slicePlaneEnabled;c.addRenderPlugin(a.slots,a);return a};m.prototype._getExternalColorParameters=function(a){var b={};this._drivenProperties.color?b.externalColor=g.vec4f64.ONES:e.isSome(a)&&e.isSome(a.color)?b.externalColor=l.toUnitRGBA(a.color):(b.externalColor=g.vec4f64.ONES,
b.colorMixMode="ignore");return b};m.prototype.destroy=function(){a.prototype.destroy.call(this);var b=this._context.stage;if(e.isSome(this._resources)){b.removeRenderPlugin(this._resources.lodRenderer);this._resources.lodRenderer.destroy();for(var c=this._resources.stageResources,d=0,f=c.materials;d<f.length;d++)b.remove(3,f[d].id);d=0;for(f=c.textures;d<f.length;d++)b.remove(4,f[d].id);d=0;for(c=c.geometries;d<c.length;d++)b.remove(2,c[d].id);e.isSome(this._resources.dispose)&&this._resources.dispose()}this._resources=
null};m.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;var c=C.placePointOnGeometry(b.geometry);if(e.isNone(c))return this.logger.warn("unsupported geometry type for icon symbol: "+b.geometry.type),null;var d=this.setGraphicElevationContext(b,new v.ElevationContext);return this._createAs3DShape(b,c,a.renderingInfo,d,b.uid)};m.prototype.notifyDestroyGraphicLayer=function(a){this._instanceIndexToGraphicUid.delete(a.instanceIndex)};m.prototype.graphicLayerToGraphicId=
function(){return 0};m.prototype.layerOpacityChanged=function(){if(e.isNone(this._resources))return!0;for(var a=this._drivenProperties.opacity,b=!this.isPrimitive,c=this._resources.stageResources.materials,d=this._resources.originalMaterialParameters,f=0;f<c.length;f++){var g=c[f],h=e.get(this.symbolLayer,"material","color"),m=d[f],h=this._getCombinedOpacity(h,{hasIntrinsicColor:b})*m.opacity;g.setParameterValues({opacity:h,transparent:1>h||a||m.transparent})}return!0};m.prototype.layerElevationInfoChanged=
function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,q.needsElevationUpdates3D)};m.prototype.slicePlaneEnabledChanged=function(){if(e.isNone(this._resources))return!0;this._resources.lodRenderer.slicePlane=this._context.slicePlaneEnabled;for(var a=0,b=this._resources.stageResources.materials;a<b.length;a++)b[a].setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};m.prototype.physicalBasedRenderingChanged=function(){if(e.isNone(this._resources))return!0;for(var a=
this._resources,b=a.isEsriSymbolResource,c=a.isWosr,d=0,a=a.stageResources.materials;d<a.length;d++){var f=a[d];this.isPrimitive?f.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):b&&!c&&f.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1})}return!0};m.prototype.pixelRatioChanged=function(){return!0};m.prototype.applyRendererDiff=function(a,b){if(e.isNone(this._resources))return!0;var c=this._resources,d=c.stageResources.materials,
f=c.lodRenderer,g=c.resourceBoundingBox,h=c.symbolSize,m=c.resourceSize,c=c.pivotOffset,k;for(k in a.diff)switch(k){case "visualVariables":if(F.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions(g,h,m,c))){a=0;for(var l=d;a<l.length;a++)l[a].setParameterValues(this._fastUpdates.materialParameters);f.notifyShaderTransformationChanged()}else return!1;break;default:return!1}return!0};m.prototype.computeComplexity=function(){if(e.isNone(this._resources))return a.prototype.computeComplexity.call(this);
var b=L.geometriesFromLodLevelResources(this._resources.lodResources.levels[0]).reduce(function(a,b){return a+b.data.getIndices(I.VertexAttrConstants.POSITION).length},0)/3,c=G.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer);return{primitivesPerFeature:b,primitivesPerCoordinate:0,estimated:!1,memory:c}};m.prototype.hasLodRenderer=function(){return e.isSome(this._resources)};m.prototype._createAs3DShape=function(a,b,c,d,f){if(!this.hasLodRenderer()||e.isNone(this._resources))return null;
a=this.getFastUpdateAttrValues(a);var g=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?x.mixinColorAndOpacity(c.color,c.opacity):null,h=this._context.clippingExtent;H.pointToVector(b,Q,this._context.elevationProvider.spatialReference);if(e.isSome(h)&&!p.containsPoint(h,Q))return null;var h=this._requiresTerrainElevation(d),m=this._computeGlobalTransform(b,d,O,h?S:null);c=this._computeLocalTransform(this._resources,this.symbolLayer,c,R);var k=this._resources.lodRenderer.instanceData,l=k.addInstance();
this._instanceIndexToGraphicUid.set(l,f);k.setLocalTransform(l,c,!1);k.setGlobalTransform(l,m);a&&k.setFeatureAttribute(l,a);g&&k.setColor(l,g);f=new w(this,l,r.perLodInstanceElevationAligner,d);h&&(f.alignedSampledElevation=S.sampledElevation);f.needsElevationUpdates=q.needsElevationUpdates3D(d.mode);C.extendPointGraphicElevationContext(f,b,this._context.elevationProvider);return f};m.prototype._computeGlobalTransform=function(a,b,c,d){b=q.evaluateElevationAlignmentAtPoint(a,this._context.elevationProvider,
b,this._context.renderCoordsHelper,d);Q[0]=a.x;Q[1]=a.y;Q[2]=b;J.computeLinearTransformation(a.spatialReference,Q,c,this._context.renderCoordsHelper.spatialReference);return c};m.prototype._computeLocalTransform=function(a,b,c,d){h.mat4.identity(d);this._applyObjectRotation(c,!1,d);this._applyObjectRotation(b,!0,d);this._applyObjectScale(a,c,d);this._applyAnchor(a,b,d);return d};m.prototype._applyObjectScale=function(a,b,c){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||
(a=x.computeObjectScale(this._drivenProperties.size&&b.size?b.size:a.symbolSize,a.symbolSize,a.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||h.mat4.scale(c,c,a))};m.prototype.prepareSymbolLayerPatch=function(a){if("partial"===a.diff.type){var b=a.diff.diff;this._preparePatchTransform(a,b);this._preparePatchColor(a,b)}};m.prototype.updateGeometry=function(a,b){if(e.isNone(this._resources))return!0;var c=b&&C.placePointOnGeometry(b);if(e.isNone(c))return!1;
b=this.getGeometryElevationMode(b);if(a.elevationContext.mode!==b)return!1;b=this._requiresTerrainElevation(a.elevationContext);this._computeGlobalTransform(c,a.elevationContext,O,b?S:null);b&&(a.alignedSampledElevation=S.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(a.instanceIndex,O,!0);C.extendPointGraphicElevationContext(a,c,this._context.elevationProvider);return!0};m.prototype._preparePatchTransform=function(a,c){var d=this;if((c.heading||c.tilt||c.roll||c.width||
c.height||c.depth||c.anchor||c.anchorPosition)&&!e.isNone(this._resources)){var f=function(a,b,c){return e.unwrapOr(null!=a&&"complete"===a.type?a.newValue:b,c)},g=f(c.heading,this.symbolLayer.heading,0),h=f(c.tilt,this.symbolLayer.tilt,0),m=f(c.roll,this.symbolLayer.roll,0),k=f(c.width,this.symbolLayer.width,void 0),l=f(c.height,this.symbolLayer.height,void 0),p=f(c.depth,this.symbolLayer.depth,void 0),r=f(c.anchor,this.symbolLayer.anchor,void 0),f=f(c.anchorPosition,this.symbolLayer.anchorPosition,
void 0);delete c.heading;delete c.tilt;delete c.roll;delete c.width;delete c.height;delete c.depth;delete c.anchor;delete c.anchorPosition;var q={heading:g,tilt:h,roll:m,anchor:r,anchorPosition:f},t=this._resources;1===this.loadStatus&&a.symbolLayerStatePatches.push(function(){t.symbolSize=b.vec3f64.fromArray(u.objectSymbolLayerSizeWithResourceSize(t.resourceSize,{width:k,height:l,depth:p,isPrimitive:d.symbolLayer.isPrimitive}))});a.graphics3DGraphicPatches.push(function(a,b){b=d._computeLocalTransform(t,
q,b,R);t.lodRenderer.instanceData.setLocalTransform(a.instanceIndex,b,!0)})}};m.prototype._preparePatchColor=function(a,b){var c=this;if(b.material&&"partial"===b.material.type&&(b=b.material.diff,b.color&&"complete"===b.color.type&&null!=b.color.newValue&&null!=b.color.oldValue)){var d=b.color.newValue,f=e.isSome(d)?l.toUnitRGBA(d):g.vec4f64.ONES;delete b.color;var h=this._resources;e.isNone(h)||a.graphics3DGraphicPatches.push(function(a){c._hasPerInstanceColor()?(h.lodRenderer.instanceData.setColor(a.instanceIndex,
f),a=c.setMaterialTransparencyParams({},d)):a=c.setMaterialTransparencyParams({externalColor:f},d);for(var b=0,e=h.stageResources.materials;b<e.length;b++)e[b].setParameterValues(a)})}};m.prototype._requiresTerrainElevation=function(a){return"absolute-height"!==a.mode};m.prototype._applyObjectRotation=function(a,b,c){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&b))return x.computeObjectRotation(a.heading,a.tilt,a.roll,c)};m.prototype._computeAnchor=function(a,c,
d){var g=b.vec3f64.create();switch(d.anchor){case "center":f.vec3.copy(g,p.center(a));f.vec3.negate(g,g);break;case "top":c=p.center(a);f.vec3.set(g,-c[0],-c[1],-a[5]);break;case "bottom":c=p.center(a);f.vec3.set(g,-c[0],-c[1],-a[2]);break;case "relative":c=p.center(a);a=p.size(a);d=(d=d.anchorPosition)?b.vec3f64.fromValues(d.x,d.y,d.z):b.vec3f64.ZEROS;f.vec3.multiply(g,a,d);f.vec3.add(g,g,c);f.vec3.negate(g,g);break;default:e.isSome(c)?f.vec3.negate(g,c):f.vec3.copy(g,b.vec3f64.ZEROS)}return g};
m.prototype._applyAnchor=function(a,b,c){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(a=this._computeAnchor(a.resourceBoundingBox,a.pivotOffset,b))&&h.mat4.translate(c,c,a)};m.prototype._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};m.prototype._fastVisualVariableConvertOptions=function(a,c,d,f){var g=e.isSome(a)?b.vec3f64.fromArray(p.size(a)):b.vec3f64.ONES;a=e.isSome(a)?this._computeAnchor(a,f,this.symbolLayer):
b.vec3f64.ZEROS;f=this._context.renderCoordsHelper.unitInMeters;d=x.computeObjectScale(e.isSome(c)?c:void 0,c,d,f);var h=b.vec3f64.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:g,symbolSize:e.isSome(c)?c:b.vec3f64.ONES,unitInMeters:f,transformation:{anchor:a,scale:d,rotation:h}}};return m}(z.default);a.Graphics3DObjectSymbolLayer=n;var Q=b.vec3f64.create(),R=m.mat4f64.create(),O=m.mat4f64.create(),N=g.vec4f64.create(),S={verticalDistanceToGround:0,
sampledElevation:0};a.default=n})},"esri/symbols/support/symbolLayerUtils3D":function(){define(["require","exports","../../core/compilerUtils","../../core/libs/gl-matrix-2/vec3f64","../../geometry/support/aaBoundingBox"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.objectSymbolLayerPrimitiveBoundingBox=a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_TETRAHEDRON=a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_UNIT_CYLINDER=a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_UNIT_CUBE=a.objectSymbolLayerSizeWithResourceSize=
void 0;a.objectSymbolLayerSizeWithResourceSize=function(a,c){var d=c.width,e=c.depth,f=c.height;c=c.isPrimitive?10:1;if(null==d&&null==f&&null==e)return[c*a[0],c*a[1],c*a[2]];for(var d=l.vec3f64.fromValues(d,e,f),b,e=0;3>e;e++)if(f=d[e],null!=f){b=f/a[e];break}for(e=0;3>e;e++)null==d[e]&&(d[e]=a[e]*b);return d};a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_UNIT_CUBE=k.fromValues(-.5,-.5,-.5,.5,.5,.5);a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_UNIT_CYLINDER=k.fromValues(-.5,-.5,0,.5,.5,1);a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_TETRAHEDRON=
k.fromValues(-.5,-.5,0,.5,.5,.5);a.objectSymbolLayerPrimitiveBoundingBox=function(e){switch(e){case "sphere":case "cube":case "diamond":return a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_UNIT_CUBE;case "cylinder":case "cone":case "inverted-cone":return a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_UNIT_CYLINDER;case "tetrahedron":return a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_TETRAHEDRON;default:d.neverReached(e)}}})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/Object3DStateSet".split(" "),
function(n,a,d,l,k,e,c,h,m,f){n=function(){function a(a,b,c,d){this.graphics3DSymbolLayer=a;this.instanceIndex=b;this.elevationAligner=c;this.elevationContext=d;this.type="lod-instance";this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}a.prototype.initialize=function(){};a.prototype.setVisibility=function(a){var b=this.lodRenderer.instanceData;return a!==b.getVisible(this.instanceIndex)?(b.setVisible(this.instanceIndex,a),!0):!1};a.prototype.destroy=function(){null!=
this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};a.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(h.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedSampledElevation=a))};a.prototype.getBSRadius=function(){var a=this.lodRenderer;return a.baseBoundingSphere.radius*a.instanceData.getCombinedMaxScaleFactor(this.instanceIndex)};
a.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=e.vec3f64.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,u);return k.vec3.transformMat4(a,this.lodRenderer.baseBoundingSphere.center,u)};a.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=c.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,u);var b=this.lodRenderer.baseBoundingBox;c.empty(a);for(var d=0;8>d;++d)k.vec3.set(g,0===(d&1)?b[0]:b[3],0===(d&2)?
b[1]:b[4],0===(d&4)?b[2]:b[5]),k.vec3.transformMat4(g,g,u),c.expandPointInPlace(a,g);return a};a.prototype.computeAttachmentOrigin=function(a){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,u);a.render.origin[0]+=u[12];a.render.origin[1]+=u[13];a.render.origin[2]+=u[14];a.render.num++};a.prototype.getProjectedBoundingBox=function(a,e,f,h,l){return d.__awaiter(this,void 0,void 0,function(){var r,q,v,w,x,z,n,J,I;return d.__generator(this,function(d){switch(d.label){case 0:r=this.getBoundingBoxObjectSpace(l);
q=t;v=c.isPoint(r)?1:q.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,u);for(w=0;w<v;w++)x=q[w],g[0]=r[x[0]],g[1]=r[x[1]],g[2]=r[x[2]],k.vec3.transformMat4(g,g,u),b[3*w+0]=g[0],b[3*w+1]=g[1],b[3*w+2]=g[2];if(!a(b,0,v))return[2,null];c.empty(r);z=null;this.calculateRelativeScreenBounds&&(z=this.calculateRelativeScreenBounds());for(w=0;w<3*v;w+=3){for(n=0;3>n;n++)r[n]=Math.min(r[n],b[w+n]),r[n+3]=Math.max(r[n+3],b[w+n]);z&&f.push({location:b.slice(w,w+3),screenSpaceBoundingRect:z})}if(!e)return[3,
5];c.center(r,p);if("absolute-height"===this.elevationContext.mode)return[3,5];J=void 0;I=m.demResolutionForBoundingBox(r,e);d.label=1;case 1:return d.trys.push([1,3,,4]),[4,e.service.queryElevation(p[0],p[1],h,I,"ground")];case 2:return J=d.sent(),[3,4];case 3:return d.sent(),J=null,[3,4];case 4:null!=J&&c.offset(r,0,0,-this.alignedSampledElevation+J),d.label=5;case 5:return[2,r]}})})};a.prototype.addObjectState=function(a,b){var c=this;0===a&&(a=f.generateObject3DStateId(a),this.addHighlightId(a),
b.addExternal(function(a){c.removeHighlightId(a)},a))};a.prototype.removeObjectState=function(a){this.highlights&&this.highlights.forEach(function(b){return a.remove(b)})};a.prototype.addHighlightId=function(a){this.highlights=this.highlights||new Set;this.highlights.add(a);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};a.prototype.removeHighlightId=function(a){this.highlights&&(this.highlights.delete(a),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this.highlights.size),
0===this.highlights.size&&(this.highlights=null))};Object.defineProperty(a.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!1,configurable:!0});return a}();var b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=e.vec3f64.create(),p=e.vec3f64.create(),t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],u=l.mat4f64.create();return n})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["require","exports","../../webgl-engine/lib/lodRendering/LodResources"],
function(n,a,d){function l(a){var c=[];a.stageResources.geometries.forEach(function(d,e){c.push({material:a.stageResources.materials[e],geometry:d,textures:a.stageResources.textures})});return{components:c,minScreenSpaceRadius:a.lodThreshold,pivotOffset:a.pivotOffset}}function k(a,h){void 0===h&&(h=e);a=d.computeFaceCount(a);return Math.sqrt(a/(h*Math.PI))}Object.defineProperty(a,"__esModule",{value:!0});a.fillEstimatedMinScreenSpaceRadius=a.estimateMinScreenSpaceRadius=a.makeLodResources=a.makeLodLevelResources=
void 0;a.makeLodLevelResources=l;a.makeLodResources=function(a){return{levels:a.map(function(a){return l(a)})}};a.estimateMinScreenSpaceRadius=k;a.fillEstimatedMinScreenSpaceRadius=function(a){a.levels.forEach(function(a){a.minScreenSpaceRadius||(a.minScreenSpaceRadius=k(a))})};var e=.05})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports tslib ../../../../core/devEnvironmentUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../support/buffer/BufferView ../../support/buffer/math ../../support/buffer/utils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A){function C(a){var b=a.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return b?{fileType:"gltf",url:b[1],specifiedLodIndex:null!=b[4]?Number(b[4]):null}:a.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:a,specifiedLodIndex:null}:{fileType:"unknown",url:a,specifiedLodIndex:null}}function E(a,b,f,h){var m=a.model,l=c.mat3f64.create(),p=[],r=new Map,t=new Map;m.lods.forEach(function(a,c){if(void 0===h||c===h){var n=0,C={name:a.name,stageResources:{textures:[],
materials:[],geometries:[]},lodThreshold:k.isSome(a.lodThreshold)?a.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:g.empty()};p.push(C);a.parts.forEach(function(c){var h=c.material+(c.attributes.normal?"_normal":"")+(c.attributes.color?"_color":"")+(c.attributes.texCoord0?"_texCoord0":"")+(c.attributes.tangent?"_tangent":""),p=m.materials.get(c.material),I=k.isSome(c.attributes.texCoord0),E=k.isSome(c.attributes.normal);if(!r.has(h)){if(I){if(k.isSome(p.textureColor)&&!t.has(p.textureColor)){var F=
m.textures.get(p.textureColor),H=d.__assign(d.__assign({},F.parameters),{preMultiplyAlpha:!0});t.set(p.textureColor,new B(F.data,p.textureColor,H))}k.isSome(p.textureNormal)&&!t.has(p.textureNormal)&&(F=m.textures.get(p.textureNormal),H=d.__assign(d.__assign({},F.parameters),{preMultiplyAlpha:!0}),t.set(p.textureNormal,new B(F.data,p.textureNormal,H)));k.isSome(p.textureOcclusion)&&!t.has(p.textureOcclusion)&&(F=m.textures.get(p.textureOcclusion),H=d.__assign(d.__assign({},F.parameters),{preMultiplyAlpha:!0}),
t.set(p.textureOcclusion,new B(F.data,p.textureOcclusion,H)));k.isSome(p.textureEmissive)&&!t.has(p.textureEmissive)&&(F=m.textures.get(p.textureEmissive),H=d.__assign(d.__assign({},F.parameters),{preMultiplyAlpha:!0}),t.set(p.textureEmissive,new B(F.data,p.textureEmissive,H)));k.isSome(p.textureMetallicRoughness)&&!t.has(p.textureMetallicRoughness)&&(F=m.textures.get(p.textureMetallicRoughness),H=d.__assign(d.__assign({},F.parameters),{preMultiplyAlpha:!0}),t.set(p.textureMetallicRoughness,new B(F.data,
p.textureMetallicRoughness,H)))}var J=A.COLOR_GAMMA,F=Math.pow(p.color[0],1/J),H=Math.pow(p.color[1],1/J),K=Math.pow(p.color[2],1/J),P=Math.pow(p.emissiveFactor[0],1/J),Q=Math.pow(p.emissiveFactor[1],1/J),J=Math.pow(p.emissiveFactor[2],1/J);r.set(h,new A(d.__assign(d.__assign(d.__assign({},b),{transparent:"BLEND"===p.alphaMode,textureAlphaMode:G(p.alphaMode),textureAlphaCutoff:p.alphaCutoff,diffuse:[F,H,K],ambient:[F,H,K],opacity:p.opacity,doubleSided:p.doubleSided,doubleSidedType:"winding-order",
cullFace:p.doubleSided?0:2,vertexColors:!!c.attributes.color,vertexTangents:!!c.attributes.tangent,normals:E?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:k.isSome(p.textureColor)&&I?t.get(p.textureColor).id:void 0,colorMixMode:p.colorMixMode,normalTextureId:k.isSome(p.textureNormal)&&I?t.get(p.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:k.isSome(p.textureOcclusion)&&I?t.get(p.textureOcclusion).id:void 0,emissiveTextureId:k.isSome(p.textureEmissive)&&
I?t.get(p.textureEmissive).id:void 0,metallicRoughnessTextureId:k.isSome(p.textureMetallicRoughness)&&I?t.get(p.textureMetallicRoughness).id:void 0,emissiveFactor:[P,Q,J],mrrFactors:[p.metallicFactor,p.roughnessFactor,b.mrrFactors[2]],isSchematic:!1}),f),h))}a:{E=c.indices||c.attributes.position.count;switch(c.primitiveType){case 4:F=u.trianglesToTriangles(E);break a;case 5:F=u.triangleStripToTriangles(E);break a;case 6:F=u.triangleFanToTriangles(E);break a}F=void 0}H={};K={};E=c.attributes.position.count;
P=w.createBuffer(q.BufferViewVec3f,E);v.vec3.transformMat4(P,c.attributes.position,c.transform);K.position={data:P.typedBuffer,size:P.elementCount};H.position=F;k.isSome(c.attributes.normal)&&(P=w.createBuffer(q.BufferViewVec3f,E),e.mat3.normalFromMat4(l,c.transform),v.vec3.transformMat3(P,c.attributes.normal,l),K.normal={data:P.typedBuffer,size:P.elementCount},H.normal=F);k.isSome(c.attributes.tangent)&&(P=w.createBuffer(q.BufferViewVec4f,E),e.mat3.normalFromMat4(l,c.transform),v.vec4.transformMat3(P,
c.attributes.tangent,l),K.tangent={data:P.typedBuffer,size:P.elementCount},H.tangent=F);k.isSome(c.attributes.texCoord0)&&(P=w.createBuffer(q.BufferViewVec2f,E),w.vec2.normalizeIntegerBuffer(P,c.attributes.texCoord0),K.uv0={data:P.typedBuffer,size:P.elementCount},H.uv0=F);k.isSome(c.attributes.color)&&(P=w.createBuffer(q.BufferViewVec4u8,E),4===c.attributes.color.elementCount?c.attributes.color instanceof q.BufferViewVec4f?v.vec4.scale(P,c.attributes.color,255):c.attributes.color instanceof q.BufferViewVec4u8?
w.vec4.copy(P,c.attributes.color):c.attributes.color instanceof q.BufferViewVec4u16&&v.vec4.scale(P,c.attributes.color,1/256):(w.vec4.fill(P,255,255,255,255),Q=new q.BufferViewVec3u8(P.buffer,0,4),c.attributes.color instanceof q.BufferViewVec3f?v.vec3.scale(Q,c.attributes.color,255):c.attributes.color instanceof q.BufferViewVec3u8?w.vec3.copy(Q,c.attributes.color):c.attributes.color instanceof q.BufferViewVec3u16&&v.vec3.scale(Q,c.attributes.color,1/256)),K.color={data:P.typedBuffer,size:P.elementCount},
H.color=F);c=new z(new x.GeometryData(K,H),"gltf_"+a.name+"_"+n++);C.stageResources.geometries.push(c);C.stageResources.materials.push(r.get(h));I&&(k.isSome(p.textureColor)&&C.stageResources.textures.push(t.get(p.textureColor)),k.isSome(p.textureNormal)&&C.stageResources.textures.push(t.get(p.textureNormal)),k.isSome(p.textureOcclusion)&&C.stageResources.textures.push(t.get(p.textureOcclusion)),k.isSome(p.textureEmissive)&&C.stageResources.textures.push(t.get(p.textureEmissive)),k.isSome(p.textureMetallicRoughness)&&
C.stageResources.textures.push(t.get(p.textureMetallicRoughness)));C.numberOfVertices+=E;h=c.boundingInfo;g.expand(C.boundingBox,h.getBBMin());g.expand(C.boundingBox,h.getBBMax())})}});return p}function G(a){switch(a){case "BLEND":return 0;case "MASK":return 2;case "OPAQUE":return 1;default:return 0}}Object.defineProperty(a,"__esModule",{value:!0});a.gltfToEngineResources=a.parseUrl=a.fetch=void 0;a.fetch=function(a,c){return d.__awaiter(this,void 0,void 0,function(){var e,g,v,u,x,z,A,B,n,F,G,H;return d.__generator(this,
function(I){switch(I.label){case 0:return e=C(l.adjustStaticAGOUrl(a)),"wosr"!==e.fileType?[3,2]:[4,c.cache?c.cache.loadWOSR(e.url,c):r.load(e.url,c)];case 1:return g=I.sent(),v=r.processLoadResult(g,c),[2,{lods:[v],referenceBoundingBox:v.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:g.remove}];case 2:return[4,c.cache?c.cache.loadGLTF(e.url,c):t.load(new p.DefaultLoadingContext(c.streamDataRequester),e.url,c)];case 3:u=I.sent();x=k.get(u.model.meta,"ESRI_proxyEllipsoid");if(u.meta.isEsriSymbolResource&&
k.isSome(x)&&-1!==u.meta.uri.indexOf("/RealisticTrees/"))a:{I=u;for(var P=x,J=0;J<I.model.lods.length;++J){var K=I.model.lods[J];I.customMeta.esriTreeRendering=!0;for(var Q=0,K=K.parts;Q<K.length;Q++){var S=K[Q],L=S.attributes.normal;if(k.isNone(L))break a;for(var M=S.attributes.position,R=M.count,Z=b.vec3f64.create(),U=b.vec3f64.create(),N=b.vec3f64.create(),O=w.createBuffer(q.BufferViewVec4u8,R),ja=w.createBuffer(q.BufferViewVec3f,R),pa=h.mat4.invert(m.mat4f64.create(),S.transform),na=0;na<R;na++){M.getVec(na,
U);L.getVec(na,Z);f.vec3.transformMat4(U,U,S.transform);f.vec3.subtract(N,U,P.center);f.vec3.divide(N,N,P.radius);var va=N[2],za=f.vec3.length(N),za=Math.min(.45+.55*za*za,1);f.vec3.divide(N,N,P.radius);f.vec3.transformMat4(N,N,pa);f.vec3.normalize(N,N);J+1!==I.model.lods.length&&1<I.model.lods.length&&(-1<va?f.vec3.lerp(N,N,Z,.2):f.vec3.lerp(N,N,Z,Math.min(-4*va-3.8,1)));ja.setVec(na,N);O.set(na,0,255*za);O.set(na,1,255*za);O.set(na,2,255*za);O.set(na,3,255)}S.attributes.normal=ja;S.attributes.color=
O}}}z=u.meta.isEsriSymbolResource?{usePBR:c.usePBR,isSchematic:!1,treeRendering:u.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:!0,isSchematic:!1,mrrFactors:[0,1,.5]};A=d.__assign(d.__assign({},c.materialParamsMixin),{treeRendering:u.customMeta.esriTreeRendering});if(null!=e.specifiedLodIndex)return B=E(u,z,A,e.specifiedLodIndex),n=B[0].boundingBox,0!==e.specifiedLodIndex&&(F=E(u,z,A,0),n=F[0].boundingBox),[2,{lods:B,referenceBoundingBox:n,isEsriSymbolResource:u.meta.isEsriSymbolResource,
isWosr:!1,remove:u.remove}];G=E(u,z,A);H=G[0].boundingBox;return[2,{lods:G,referenceBoundingBox:H,isEsriSymbolResource:u.meta.isEsriSymbolResource,isWosr:!1,remove:u.remove}]}})})};a.parseUrl=C;a.gltfToEngineResources=E})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("require exports tslib ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),function(n,a,d,l,k,e,c,h,m){Object.defineProperty(a,
"__esModule",{value:!0});a.DefaultLoadingContext=void 0;n=function(){function a(a){this.streamDataRequester=a}a.prototype.loadJSON=function(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){return[2,this.load("json",a,b)]})})};a.prototype.loadBinary=function(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){return m.isDataProtocol(a)?(h.throwIfAborted(b),[2,m.dataToArrayBuffer(a)]):[2,this.load("binary",a,b)]})})};
a.prototype.loadImage=function(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){return[2,this.load("image",a,b)]})})};a.prototype.load=function(a,b,m){return d.__awaiter(this,void 0,void 0,function(){var g;return d.__generator(this,function(d){switch(d.label){case 0:return c.isNone(this.streamDataRequester)?[4,l(b,{responseType:f[a]})]:[3,2];case 1:return[2,d.sent().data];case 2:return[4,k.result(this.streamDataRequester.request(b,a,m))];case 3:g=d.sent();
if(!0===g.ok)return[2,g.value];h.throwIfAbortError(g.error);throw new e("","Request for resource failed: "+g.error);}})})};return a}();a.DefaultLoadingContext=n;var f={image:"image",binary:"array-buffer",json:"json"}})},"esri/views/3d/glTF/loader":function(){define("require exports tslib ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),function(n,a,d,l,k,e,c,h,m){function f(a){var b=null;a.json.nodes.forEach(function(a){a=
a.extras;l.isSome(a)&&(a.ESRI_proxyEllipsoid||a.ESRI_lod)&&(b=a)});return b}function b(a,b){return d.__awaiter(this,void 0,void 0,function(){function c(f,g){return d.__awaiter(this,void 0,void 0,function(){var h,m,k,l,p,r,t,q,v;return d.__generator(this,function(d){switch(d.label){case 0:h=e.nodes[f];m=a.getNodeTransform(f);u.warnUnsupportedIf(null!=h.weights,"Morph targets are not supported.");if(null==h.mesh)return[3,4];k=e.meshes[h.mesh];l=0;p=k.primitives;d.label=1;case 1:if(!(l<p.length))return[3,
4];r=p[l];return[4,b(r,m,g,k.name)];case 2:d.sent(),d.label=3;case 3:return l++,[3,1];case 4:t=0,q=h.children||[],d.label=5;case 5:if(!(t<q.length))return[3,8];v=q[t];return[4,c(v,g)];case 6:d.sent(),d.label=7;case 7:return t++,[3,5];case 8:return[2]}})})}var e,f,g,h,m,l,p,r,t,q;return d.__generator(this,function(b){switch(b.label){case 0:e=a.json,f=e.scenes[e.scene||0],g=f.nodes,h=1<g.length,m=0,l=g,b.label=1;case 1:if(!(m<l.length))return[3,4];p=l[m];r=e.nodes[p];t=[c(p,0)];r.extensions&&r.extensions.MSFT_lod&&
Array.isArray(r.extensions.MSFT_lod.ids)&&!h&&(q=r.extensions.MSFT_lod.ids,t.push.apply(t,q.map(function(a,b){return c(a,b+1)})));return[4,k.all(t)];case 2:b.sent(),b.label=3;case 3:return m++,[3,1];case 4:return[2]}})})}function g(a,b,c){var d=function(b){var d=c+"_tex_"+(b&&b.id)+(b&&b.name?"_"+b.name:"");if(b&&!a.textures.has(d)){var e=h.makeTextureSource(b.data,{wrap:{s:p(b.wrapS),t:p(b.wrapT)},mipmap:r.some(function(a){return a===b.minFilter}),noUnpackFlip:!0});a.textures.set(d,e)}return d},
e=c+"_mat_"+b.id+"_"+b.name;a.materials.has(e)||(b=h.makeMaterialParameters({color:[b.color[0],b.color[1],b.color[2]],opacity:b.color[3],alphaMode:b.alphaMode,alphaCutoff:b.alphaCutoff,doubleSided:b.doubleSided,colorMixMode:b.ESRI_externalColorMixMode,textureColor:b.colorTexture?d(b.colorTexture):void 0,textureNormal:b.normalTexture?d(b.normalTexture):void 0,textureOcclusion:b.occlusionTexture?d(b.occlusionTexture):void 0,textureEmissive:b.emissiveTexture?d(b.emissiveTexture):void 0,textureMetallicRoughness:b.metallicRoughnessTexture?
d(b.metallicRoughnessTexture):void 0,emissiveFactor:[b.emissiveFactor[0],b.emissiveFactor[1],b.emissiveFactor[2]],metallicFactor:b.metallicFactor,roughnessFactor:b.roughnessFactor}),a.materials.set(e,b));return e}function p(a){if(33071===a||33648===a||10497===a)return a;u.error("Unexpected TextureSampler WrapMode: "+a)}Object.defineProperty(a,"__esModule",{value:!0});a.load=void 0;var t=0;a.load=function(a,c,h){void 0===h&&(h={});return d.__awaiter(this,void 0,void 0,function(){var k,p,r,v,w=this;
return d.__generator(this,function(x){switch(x.label){case 0:return[4,m.Resource.load(a,u,c,h)];case 1:return k=x.sent(),p="gltf_"+t++,r={lods:[],materials:new Map,textures:new Map,meta:f(k)},v=!(!k.json.asset.extras||"symbolResource"!==k.json.asset.extras.ESRI_type),[4,b(k,function(a,b,c,f){return d.__awaiter(w,void 0,void 0,function(){var m,t,v,w,x,z,A,B,n,C,I;return d.__generator(this,function(d){switch(d.label){case 0:m=void 0!==a.mode?a.mode:4;a:switch(m){case 4:case 5:case 6:t=m;break a;default:t=
null}return l.isNone(t)?(u.warnUnsupported("Unsupported primitive mode ("+q[m]+"). Skipping primitive."),[2]):k.hasPositions(a)?[4,k.getMaterial(a,h)]:(u.warn("Skipping primitive without POSITION vertex attribute."),[2]);case 1:return v=d.sent(),x={transform:e.mat4f64.clone(b)},z={},[4,k.getPositionData(a,h)];case 2:return x.attributes=(z.position=d.sent(),z.normal=null,z.texCoord0=null,z.color=null,z.tangent=null,z),[4,k.getIndexData(a,h)];case 3:w=(x.indices=d.sent(),x.primitiveType=t,x.material=
g(r,v,p),x);if(!k.hasNormals(a))return[3,5];A=w.attributes;return[4,k.getNormalData(a,h)];case 4:A.normal=d.sent(),d.label=5;case 5:if(!k.hasTangents(a))return[3,7];B=w.attributes;return[4,k.getTangentData(a,h)];case 6:B.tangent=d.sent(),d.label=7;case 7:if(!k.hasTextureCoordinates(a))return[3,9];n=w.attributes;return[4,k.getTextureCoordinates(a,h)];case 8:n.texCoord0=d.sent(),d.label=9;case 9:if(!k.hasVertexColors(a))return[3,11];C=w.attributes;return[4,k.getVertexColors(a,h)];case 10:C.color=d.sent(),
d.label=11;case 11:return I=null,l.isSome(r.meta)&&l.isSome(r.meta.ESRI_lod)&&"screenSpaceRadius"===r.meta.ESRI_lod.metric&&(I=r.meta.ESRI_lod.thresholds[c]),r.lods[c]=r.lods[c]||{parts:[],name:f,lodThreshold:I},r.lods[c].parts.push(w),[2]}})})})];case 2:return x.sent(),[2,{model:r,meta:{isEsriSymbolResource:v,uri:k.uri},customMeta:{}}]}})})};var u=new c.DefaultErrorContext,r=[9987,9985],q="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ")})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["require",
"exports","../../../core/Error","../../../core/Logger"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.DefaultErrorContext=void 0;var k=l.getLogger("esri.views.3d.glTF");n=function(){function a(){}a.prototype.error=function(a){throw new d("gltf-loader-error",a);};a.prototype.errorUnsupported=function(a){throw new d("gltf-loader-unsupported-feature",a);};a.prototype.errorUnsupportedIf=function(a,d){a&&this.errorUnsupported(d)};a.prototype.assert=function(a,d){a||this.error(d)};
a.prototype.warn=function(a){k.warn(a)};a.prototype.warnUnsupported=function(a){this.warn("[Unsupported Feature] "+a)};a.prototype.warnUnsupportedIf=function(a,d){a&&this.warnUnsupported(d)};return a}();a.DefaultErrorContext=n})},"esri/views/3d/glTF/LoaderResult":function(){define(["require","exports","tslib"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.makeTextureSource=a.makeMaterialParameters=void 0;a.makeMaterialParameters=function(a){void 0===a&&(a={});return d.__assign({color:[1,
1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},a)};a.makeTextureSource=function(a,k){void 0===k&&(k={});return{data:a,parameters:d.__assign({wrap:d.__assign({s:10497,t:10497},k.wrap),noUnpackFlip:!0,mipmap:!1},k)}}})},"esri/views/3d/glTF/internal/Resource":function(){define("require exports tslib ../../../../core/compilerUtils ../../../../core/promiseUtils ../../../../core/string ../../../../core/urlUtils ../../../../core/urlUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ./BinaryStreamReader ./fillDefaults ./pathUtils ../../support/buffer/BufferView ../../support/buffer/utils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v){function w(a){switch(a.componentType){case 5120:return new q.BufferViewVec2i8(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5121:return new q.BufferViewVec2u8(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5122:return new q.BufferViewVec2i16(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5123:return new q.BufferViewVec2u16(a.raw,a.byteOffset,a.byteStride,a.byteOffset+
a.byteStride*a.entryCount);case 5125:return new q.BufferViewVec2u32(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5126:return new q.BufferViewVec2f(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);default:l.neverReached(a.componentType)}}function z(a){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(b){return[2,k.create(function(b,c){var d=new Blob([a]),e=new FileReader;e.onload=function(){b(JSON.parse(e.result))};
e.onerror=function(a){c(a)};e.readAsText(d)})]})})}function x(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){return[2,k.create(function(c,d){var e=new Blob([a],{type:b}),f=URL.createObjectURL(e),g=new Image;g.addEventListener("load",function(){URL.revokeObjectURL(f);"decode"in g?g.decode().then(function(){return c(g)},function(){return c(g)}):c(g)});g.addEventListener("error",function(a){URL.revokeObjectURL(f);d(a)});g.src=f})]})})}var B;Object.defineProperty(a,
"__esModule",{value:!0});a.Resource=void 0;n=function(){function a(a,b,c,d,e){this.context=a;this.errorContext=b;this.uri=c;this.json=d;this.glbBuffer=e;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=r.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();b.errorUnsupportedIf(null==d.scenes,"Scenes must be defined.");b.errorUnsupportedIf(null==d.meshes,"Meshes must be defined");
b.errorUnsupportedIf(null==d.nodes,"Nodes must be defined.");this.computeNodeParents()}a.load=function(b,c,f,g){return d.__awaiter(this,void 0,void 0,function(){var m,k,l,p,r,t;return d.__generator(this,function(d){switch(d.label){case 0:if(h.isDataProtocol(f)){m=h.dataComponents(f);if("model/gltf-binary"!==m.mediaType)try{return k=JSON.parse(m.isBase64?atob(m.data):m.data),[2,new a(b,c,f,k)]}catch(Z){}l=h.dataToArrayBuffer(f);if(a.isGLBData(l))return[2,this.fromGLBData(b,c,f,l)]}return e.endsWith(f,
".gltf")?[4,b.loadJSON(f,g)]:[3,2];case 1:return p=d.sent(),[2,new a(b,c,f,p)];case 2:return[4,b.loadBinary(f,g)];case 3:return r=d.sent(),a.isGLBData(r)?[2,this.fromGLBData(b,c,f,r)]:[4,b.loadJSON(f,g)];case 4:return t=d.sent(),[2,new a(b,c,f,t)]}})})};a.isGLBData=function(a){a=new t.BinaryStreamReader(a);return 4<=a.remainingBytes()&&1179937895===a.readUint32()};a.fromGLBData=function(b,c,e,f){return d.__awaiter(this,void 0,void 0,function(){var g;return d.__generator(this,function(d){switch(d.label){case 0:return[4,
a.parseGLBData(c,f)];case 1:return g=d.sent(),[2,new a(b,c,e,g.json,g.binaryData)]}})})};a.parseGLBData=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g,h,m,k,l,p;return d.__generator(this,function(d){switch(d.label){case 0:c=new t.BinaryStreamReader(b),a.assert(12<=c.remainingBytes(),"GLB binary data is insufficiently large."),e=c.readUint32(),f=c.readUint32(),g=c.readUint32(),a.assert(1179937895===e,"Magic first 4 bytes do not fit to expected GLB value."),a.assert(b.byteLength>=
g,"GLB binary data is smaller than header specifies."),a.errorUnsupportedIf(2!==f,"An unsupported GLB container version was detected. Only version 2 is supported."),h=0,d.label=1;case 1:if(!(8<=c.remainingBytes()))return[3,5];l=c.readUint32();p=c.readUint32();if(0!==h)return[3,3];a.assert(1313821514===p,"First GLB chunk must be JSON.");a.assert(0<=l,"No JSON data found.");return[4,z(c.readUint8Array(l))];case 2:return m=d.sent(),[3,4];case 3:1===h?(a.errorUnsupportedIf(5130562!==p,"Second GLB chunk expected to be BIN."),
k=c.readUint8Array(l)):a.warnUnsupported("More than 2 GLB chunks detected. Skipping."),d.label=4;case 4:return h+=1,[3,1];case 5:return m||a.error("No GLB JSON chunk detected."),[2,{json:m,binaryData:k}]}})})};a.prototype.getBuffer=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g;return d.__generator(this,function(d){switch(d.label){case 0:return c=this.json.buffers[a],e=this.errorContext,null==c.uri?(e.assert(null!=this.glbBuffer,"GLB buffer not present"),[2,this.glbBuffer]):
(f=this.bufferCache.get(a))?[3,2]:[4,this.context.loadBinary(this.resolveUri(c.uri),b)];case 1:g=d.sent(),f=new Uint8Array(g),this.bufferCache.set(a,f),e.assert(f.byteLength===c.byteLength,"Buffer byte lengths should match."),d.label=2;case 2:return[2,f]}})})};a.prototype.getAccessor=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g,h,m,k,l;return d.__generator(this,function(d){switch(d.label){case 0:return c=this.json.accessors[a],e=this.errorContext,e.errorUnsupportedIf(null==
c.bufferView,"Some accessor does not specify a bufferView."),e.errorUnsupportedIf(c.type in["MAT2","MAT3","MAT4"],"AttributeType "+c.type+" is not supported"),f=this.json.bufferViews[c.bufferView],[4,this.getBuffer(f.buffer,b)];case 1:return g=d.sent(),h=G[c.type],m=F[c.componentType],k=h*m,l=f.byteStride||k,[2,{raw:g.buffer,byteStride:l,byteOffset:g.byteOffset+(f.byteOffset||0)+(c.byteOffset||0),entryCount:c.count,isDenselyPacked:l===k,componentCount:h,componentByteSize:m,componentType:c.componentType,
min:c.min,max:c.max,normalized:!!c.normalized}]}})})};a.prototype.getIndexData=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c;return d.__generator(this,function(d){switch(d.label){case 0:return null==a.indices?[2,null]:[4,this.getAccessor(a.indices,b)];case 1:c=d.sent();if(c.isDenselyPacked)switch(c.componentType){case 5121:return[2,new Uint8Array(c.raw,c.byteOffset,c.entryCount)];case 5123:return[2,new Uint16Array(c.raw,c.byteOffset,c.entryCount)];case 5125:return[2,new Uint32Array(c.raw,
c.byteOffset,c.entryCount)]}else switch(c.componentType){case 5121:return[2,v.scalar.makeDense(this.wrapAccessor(q.BufferViewUint8,c))];case 5123:return[2,v.scalar.makeDense(this.wrapAccessor(q.BufferViewUint16,c))];case 5125:return[2,v.scalar.makeDense(this.wrapAccessor(q.BufferViewUint32,c))]}return[2,void 0]}})})};a.prototype.getPositionData=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e;return d.__generator(this,function(d){switch(d.label){case 0:return c=this.errorContext,
c.errorUnsupportedIf(null==a.attributes.POSITION,"No POSITION vertex data found."),[4,this.getAccessor(a.attributes.POSITION,b)];case 1:return e=d.sent(),c.errorUnsupportedIf(5126!==e.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+H[e.componentType]),c.errorUnsupportedIf(3!==e.componentCount,"POSITION vertex attribute must have 3 components, but found "+e.componentCount.toFixed()),[2,this.wrapAccessor(q.BufferViewVec3f,e)]}})})};a.prototype.getNormalData=function(a,
b){return d.__awaiter(this,void 0,void 0,function(){var c,e;return d.__generator(this,function(d){switch(d.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.NORMAL,"No NORMAL vertex data found."),[4,this.getAccessor(a.attributes.NORMAL,b)];case 1:return e=d.sent(),c.errorUnsupportedIf(5126!==e.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+H[e.componentType]),c.errorUnsupportedIf(3!==e.componentCount,"NORMAL vertex attribute must have 3 components, but found "+
e.componentCount.toFixed()),[2,this.wrapAccessor(q.BufferViewVec3f,e)]}})})};a.prototype.getTangentData=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e;return d.__generator(this,function(d){switch(d.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.TANGENT,"No TANGENT vertex data found."),[4,this.getAccessor(a.attributes.TANGENT,b)];case 1:return e=d.sent(),c.errorUnsupportedIf(5126!==e.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+
H[e.componentType]),c.errorUnsupportedIf(4!==e.componentCount,"TANGENT vertex attribute must have 4 components, but found "+e.componentCount.toFixed()),[2,new q.BufferViewVec4f(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount)]}})})};a.prototype.getTextureCoordinates=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e;return d.__generator(this,function(d){switch(d.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found."),
[4,this.getAccessor(a.attributes.TEXCOORD_0,b)];case 1:e=d.sent();c.errorUnsupportedIf(2!==e.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+e.componentCount.toFixed());if(5126===e.componentType)return[2,this.wrapAccessor(q.BufferViewVec2f,e)];c.errorUnsupportedIf(!e.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return[2,w(e)]}})})};a.prototype.getVertexColors=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,
e;return d.__generator(this,function(d){switch(d.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.COLOR_0,"No COLOR_0 vertex data found."),[4,this.getAccessor(a.attributes.COLOR_0,b)];case 1:e=d.sent();c.errorUnsupportedIf(4!==e.componentCount&&3!==e.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+e.componentCount.toFixed());if(4===e.componentCount){if(5126===e.componentType)return[2,this.wrapAccessor(q.BufferViewVec4f,e)];if(5121===e.componentType)return[2,
this.wrapAccessor(q.BufferViewVec4u8,e)];if(5123===e.componentType)return[2,this.wrapAccessor(q.BufferViewVec4u16,e)]}else if(3===e.componentCount){if(5126===e.componentType)return[2,this.wrapAccessor(q.BufferViewVec3f,e)];if(5121===e.componentType)return[2,this.wrapAccessor(q.BufferViewVec3u8,e)];if(5123===e.componentType)return[2,this.wrapAccessor(q.BufferViewVec3u16,e)]}c.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+H[e.componentType]);return[2,void 0]}})})};a.prototype.hasPositions=
function(a){return void 0!==a.attributes.POSITION};a.prototype.hasNormals=function(a){return void 0!==a.attributes.NORMAL};a.prototype.hasVertexColors=function(a){return void 0!==a.attributes.COLOR_0};a.prototype.hasTextureCoordinates=function(a){return void 0!==a.attributes.TEXCOORD_0};a.prototype.hasTangents=function(a){return void 0!==a.attributes.TANGENT};a.prototype.getMaterial=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g,h,m,k,l,p,r,t;return d.__generator(this,
function(d){switch(d.label){case 0:c=this.errorContext;if(e=this.materialCache.get(a.material))return[3,15];f=null!=a.material?u.material(this.json.materials[a.material]):u.material();g=f.pbrMetallicRoughness;h=this.hasVertexColors(a);m=void 0;if(!g.baseColorTexture)return[3,2];c.errorUnsupportedIf(0!==(g.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported.");return[4,this.getTexture(g.baseColorTexture.index,b)];case 1:m=d.sent(),d.label=2;case 2:k=void 0;if(!f.normalTexture)return[3,
5];if(0===(f.normalTexture.texCoord||0))return[3,3];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture.");return[3,5];case 3:return[4,this.getTexture(f.normalTexture.index,b)];case 4:k=d.sent(),d.label=5;case 5:l=void 0;if(!f.occlusionTexture)return[3,8];if(0===(f.occlusionTexture.texCoord||0))return[3,6];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture.");return[3,8];case 6:return[4,this.getTexture(f.occlusionTexture.index,b)];
case 7:l=d.sent(),d.label=8;case 8:p=void 0;if(!f.emissiveTexture)return[3,11];if(0===(f.emissiveTexture.texCoord||0))return[3,9];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture.");return[3,11];case 9:return[4,this.getTexture(f.emissiveTexture.index,b)];case 10:p=d.sent(),d.label=11;case 11:r=void 0;if(!g.metallicRoughnessTexture)return[3,14];if(0===(g.metallicRoughnessTexture.texCoord||0))return[3,12];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture.");
return[3,14];case 12:return[4,this.getTexture(g.metallicRoughnessTexture.index,b)];case 13:r=d.sent(),d.label=14;case 14:t=null!=a.material?a.material:-1,e={alphaMode:f.alphaMode,alphaCutoff:f.alphaCutoff,color:g.baseColorFactor,doubleSided:!!f.doubleSided,colorTexture:m,normalTexture:k,name:f.name,id:t,occlusionTexture:l,emissiveTexture:p,emissiveFactor:f.emissiveFactor,metallicFactor:g.metallicFactor,roughnessFactor:g.roughnessFactor,metallicRoughnessTexture:r,vertexColors:h,ESRI_externalColorMixMode:f.extras.ESRI_externalColorMixMode},
d.label=15;case 15:return[2,e]}})})};a.prototype.getTexture=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g,h,m,k,l;return d.__generator(this,function(d){switch(d.label){case 0:c=this.errorContext;e=this.json.textures[a];f=u.textureSampler(null!=e.sampler?this.json.samplers[e.sampler]:{});c.errorUnsupportedIf(null==e.source,"Source is expected to be defined for a texture.");g=this.json.images[e.source];if(h=this.textureCache.get(a))return[3,6];m=void 0;return g.uri?[4,this.context.loadImage(this.resolveUri(g.uri),
b)]:[3,2];case 1:return m=d.sent(),[3,5];case 2:return c.errorUnsupportedIf(null==g.bufferView,"Image bufferView must be defined."),c.errorUnsupportedIf(null==g.mimeType,"Image mimeType must be defined."),k=this.json.bufferViews[g.bufferView],[4,this.getBuffer(k.buffer,b)];case 3:return l=d.sent(),c.errorUnsupportedIf(null!=k.byteStride,"byteStride not supported for image buffer"),[4,x(new Uint8Array(l.buffer,l.byteOffset+(k.byteOffset||0),k.byteLength),g.mimeType)];case 4:m=d.sent(),d.label=5;case 5:h=
{data:m,wrapS:f.wrapS,wrapT:f.wrapT,minFilter:f.minFilter,name:g.name,id:a},this.textureCache.set(a,h),d.label=6;case 6:return[2,h]}})})};a.prototype.getNodeTransform=function(a){if(void 0===a)return C;var c=this.nodeTransformCache.get(a);if(!c){var c=this.getNodeTransform(this.getNodeParent(a)),d=this.json.nodes[a];if(d.matrix)c=f.mat4.multiply(b.mat4f64.create(),c,d.matrix);else if(d.translation||d.rotation||d.scale)c=b.mat4f64.clone(c),d.translation&&f.mat4.translate(c,c,d.translation),d.rotation&&
(E[3]=g.quat.getAxisAngle(E,d.rotation),f.mat4.rotate(c,c,E[3],E)),d.scale&&f.mat4.scale(c,c,d.scale);this.nodeTransformCache.set(a,c)}return c};a.prototype.wrapAccessor=function(a,b){return new a(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*(b.entryCount-1)+b.componentByteSize*b.componentCount)};a.prototype.resolveUri=function(a){return c.makeAbsolute(a,this.baseUri)};a.prototype.getNodeParent=function(a){return this.nodeParentMap.get(a)};a.prototype.checkVersionSupported=function(){var a=
m.Version.parse(this.json.asset.version,"glTF");A.validate(a)};a.prototype.checkRequiredExtensionsSupported=function(){var a=this.json,b=this.errorContext;a.extensionsRequired&&0!==a.extensionsRequired.length&&b.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+a.extensionsRequired.join(", "))};a.prototype.computeNodeParents=function(){var a=this;this.json.nodes.forEach(function(b,c){b.children&&b.children.forEach(function(b){a.nodeParentMap.set(b,c)})})};
return a}();a.Resource=n;var A=new m.Version(2,0,"glTF"),C=f.mat4.fromXRotation(b.mat4f64.create(),Math.PI/2),E=p.quatf64.create(),G={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},F=(B={},B[5120]=1,B[5121]=1,B[5122]=2,B[5123]=2,B[5126]=4,B[5125]=4,B),H={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"}})},"esri/core/Version":function(){define(["require","exports","./Error"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.Version=void 0;n=function(){function a(a,
d,c){void 0===c&&(c="");this.major=a;this.minor=d;this._context=c}a.prototype.lessThan=function(a,d){return this.major<a||a===this.major&&this.minor<d};a.prototype.since=function(a,d){return!this.lessThan(a,d)};a.prototype.validate=function(a){if(this.major!==a.major)throw new d((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:a});};a.prototype.clone=function(){return new a(this.major,
this.minor,this._context)};a.parse=function(k,e){void 0===e&&(e="");var c=k.split("."),h=c[0],c=c[1],m=/^\s*\d+\s*$/;if(!h||!h.match||!h.match(m))throw new d((e&&e+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:k});if(!c||!c.match||!c.match(m))throw new d((e&&e+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:k});k=parseInt(h,10);h=parseInt(c,10);return new a(k,h,e)};return a}();a.Version=n})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.BinaryStreamReader=void 0;n=function(){function a(a){this.data=a;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}a.prototype.readUint32=function(){var a=this.offset4;this.offset4+=1;return this.dataUint32[a]};a.prototype.readUint8Array=function(a){var d=4*this.offset4;this.offset4+=a/4;return new Uint8Array(this.data,d,a)};a.prototype.remainingBytes=function(){return this.data.byteLength-
4*this.offset4};return a}();a.BinaryStreamReader=n})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["require","exports","tslib","../../../../core/compilerUtils"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.textureSampler=a.material=void 0;var k={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},e={pbrMetallicRoughness:k,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},c={ESRI_externalColorMixMode:"tint"};a.material=function(a){void 0===
a&&(a={});var f=d.__assign(d.__assign({},k),a.pbrMetallicRoughness),b=d.__assign(d.__assign({},c),a.extras);switch(b.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:l.neverReached(b.ESRI_externalColorMixMode),b.ESRI_externalColorMixMode="tint"}return d.__assign(d.__assign(d.__assign({},e),a),{pbrMetallicRoughness:f,extras:b})};var h={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};a.textureSampler=function(a){return d.__assign(d.__assign({},
h),a)}})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.splitURI=void 0;a.splitURI=function(a){var d,k;a.replace(/^(.*\/)?([^/]*)$/,function(a,c,h){d=c||"";k=h||"";return""});return{dirPart:d,filePart:k}}})},"esri/views/3d/support/buffer/utils":function(){define("require exports ./types ./utils/mat3 ./utils/mat4 ./utils/scalar ./utils/vec2 ./utils/vec3 ./utils/vec4".split(" "),function(n,a,d,l,k,e,c,
h,m){Object.defineProperty(a,"__esModule",{value:!0});a.createBuffer=a.mat4=a.mat3=a.vec4=a.vec3=a.vec2=a.scalar=void 0;a.mat3=l;a.mat4=k;a.scalar=e;a.vec2=c;a.vec3=h;a.vec4=m;a.createBuffer=function(a,b){return new a(new ArrayBuffer(b*a.ElementCount*d.elementTypeSize(a.ElementType)))}})},"esri/views/3d/support/buffer/utils/mat3":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.copy=void 0;a.copy=function(a,l,k){var d=a.typedBuffer;a=a.typedBufferStride;
var c=l.typedBuffer,h=l.typedBufferStride;l=k?k.count:l.count;var m=(k&&k.dstIndex?k.dstIndex:0)*a;k=(k&&k.srcIndex?k.srcIndex:0)*h;for(var f=0;f<l;++f){for(var b=0;9>b;++b)d[m+b]=c[k+b];m+=a;k+=h}}})},"esri/views/3d/support/buffer/utils/mat4":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.copy=void 0;a.copy=function(a,l,k){var d=a.typedBuffer;a=a.typedBufferStride;var c=l.typedBuffer,h=l.typedBufferStride;l=k?k.count:l.count;var m=(k&&k.dstIndex?
k.dstIndex:0)*a;k=(k&&k.srcIndex?k.srcIndex:0)*h;for(var f=0;f<l;++f){for(var b=0;16>b;++b)d[m+b]=c[k+b];m+=a;k+=h}}})},"esri/views/3d/support/buffer/utils/scalar":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.makeDense=a.copy=void 0;a.copy=function(a,l,k){var d=a.typedBuffer;a=a.typedBufferStride;var c=l.typedBuffer,h=l.typedBufferStride;l=k?k.count:l.count;var m=(k&&k.dstIndex?k.dstIndex:0)*a;k=(k&&k.srcIndex?k.srcIndex:0)*h;for(var f=0;f<
l;++f)d[m]=c[k],m+=a,k+=h};a.makeDense=function(a,l){var d=a.count;l||(l=new a.TypedArrayConstructor(d));for(var e=0;e<d;e++)l[e]=a.get(e);return l}})},"esri/views/3d/support/buffer/utils/vec2":function(){define(["require","exports","../types"],function(n,a,d){function l(a,d,c){var e=a.typedBuffer;a=a.typedBufferStride;var m=d.typedBuffer,f=d.typedBufferStride;d=c?c.count:d.count;var b=(c&&c.dstIndex?c.dstIndex:0)*a;c=(c&&c.srcIndex?c.srcIndex:0)*f;for(var g=0;g<d;++g)e[b]=m[c],e[b+1]=m[c+1],b+=a,
c+=f}Object.defineProperty(a,"__esModule",{value:!0});a.normalizeIntegerBuffer=a.copy=void 0;a.copy=l;a.normalizeIntegerBuffer=function(a,e,c){var h=a.typedBuffer,m=a.typedBufferStride,f=e.typedBuffer,b=e.typedBufferStride,g=c?c.count:e.count,k=(c&&c.dstIndex?c.dstIndex:0)*m,t=(c&&c.srcIndex?c.srcIndex:0)*b;if(d.isInteger(e.elementType))if(c=d.maximumValue(e.elementType),d.isSigned(e.elementType))for(e=0;e<g;++e)h[k]=Math.max(f[t]/c,-1),h[k+1]=Math.max(f[t+1]/c,-1),k+=m,t+=b;else for(e=0;e<g;++e)h[k]=
f[t]/c,h[k+1]=f[t+1]/c,k+=m,t+=b;else l(a,e,c);return a}})},"esri/views/3d/support/buffer/utils/vec3":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.copy=void 0;a.copy=function(a,l,k){var d=a.typedBuffer;a=a.typedBufferStride;var c=l.typedBuffer,h=l.typedBufferStride;l=k?k.count:l.count;var m=(k&&k.dstIndex?k.dstIndex:0)*a;k=(k&&k.srcIndex?k.srcIndex:0)*h;for(var f=0;f<l;++f)d[m]=c[k],d[m+1]=c[k+1],d[m+2]=c[k+2],m+=a,k+=h}})},"esri/views/3d/support/buffer/utils/vec4":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.fill=a.copy=void 0;a.copy=function(a,l,k){var d=a.typedBuffer;a=a.typedBufferStride;var c=l.typedBuffer,h=l.typedBufferStride;l=k?k.count:l.count;var m=(k&&k.dstIndex?k.dstIndex:0)*a;k=(k&&k.srcIndex?k.srcIndex:0)*h;for(var f=0;f<l;++f)d[m]=c[k],d[m+1]=c[k+1],d[m+2]=c[k+2],d[m+3]=c[k+3],m+=a,k+=h};a.fill=function(a,l,k,e,c,h){var d=a.typedBuffer,f=a.typedBufferStride;a=h?h.count:a.count;h=(h&&h.dstIndex?h.dstIndex:0)*f;for(var b=
0;b<a;++b)d[h]=l,d[h+1]=k,d[h+2]=e,d[h+3]=c,h+=f}})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["require","exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(n,a,d,l){function k(a){return l.generateDefaultIndexArray(a)}Object.defineProperty(a,"__esModule",{value:!0});a.triangleFanToTriangles=a.triangleStripToTriangles=a.trianglesToTriangles=a.linearIndexArray=void 0;a.linearIndexArray=k;a.trianglesToTriangles=function(a){return"number"===
typeof a?k(a):d.isUint16Array(a)||d.isUint8Array(a)?new Uint32Array(a):a};a.triangleStripToTriangles=function(a){var c="number"===typeof a?a:a.length;if(3>c)return new Uint32Array(0);var c=c-2,d=new Uint32Array(3*c);if("number"===typeof a)for(var e=0,f=0;f<c;f+=1)0===f%2?(d[e++]=f,d[e++]=f+1):(d[e++]=f+1,d[e++]=f),d[e++]=f+2;else for(f=e=0;f<c;f+=1){if(0===f%2)var b=a[f],g=a[f+1],k=a[f+2];else b=a[f+1],g=a[f],k=a[f+2];d[e++]=b;d[e++]=g;d[e++]=k}return d};a.triangleFanToTriangles=function(a){var c=
"number"===typeof a?a:a.length;if(3>c)return new Uint32Array(0);var c=c-2,d=new Uint32Array(3*c);if("number"===typeof a){for(var e=0,f=0;f<c;++f)d[e++]=0,d[e++]=f+1,d[e++]=f+2;return d}for(var b=a[0],g=a[1],f=e=0;f<c;++f){var k=a[f+2];d[e++]=b;d[e++]=g;g=d[e++]=k}return d}})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("require exports tslib ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/lang ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../support/imageUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v){function w(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e;return d.__generator(this,function(d){switch(d.label){case 0:return(c=m.isSome(b)&&b.streamDataRequester)?[2,z(a,c,b)]:[4,k.result(l(a,m.unwrap(b)))];case 1:e=d.sent();if(!0===e.ok)return[2,e.value.data];f.throwIfAbortError(e.error);x(e.error);return[2,void 0]}})})}function z(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var e;return d.__generator(this,function(d){switch(d.label){case 0:return[4,
k.result(b.request(a,"json",c))];case 1:e=d.sent();if(!0===e.ok)return[2,e.value];f.throwIfAbortError(e.error);x(e.error.details.url);return[2,void 0]}})})}function x(a){throw new e("","Request for object resource failed: "+a);}function B(a){var b=p.empty();a.forEach(function(a){a=a.boundingInfo;p.expand(b,a.getBBMin());p.expand(b,a.getBBMax())});return b}function A(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,g,h,k,l,p,r;return d.__generator(this,function(d){switch(d.label){case 0:c=
[];e=function(d){var e=a[d],g=e.images[0].data;if(!g)return E.warn("Externally referenced texture data is not yet supported"),"continue";var g=e.encoding+";base64,"+g,h="/textureDefinitions/"+d,k={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0};d=m.isSome(b)&&b.disableTextures?f.resolve(null):t.requestImage(g,b);c.push(d.then(function(a){return{refId:h,image:a,params:k,alphaChannelUsage:"rgba"===e.channels?e.alphaChannelUsage||"transparency":"none"}}))};for(g in a)e(g);return[4,f.all(c)];
case 1:h=d.sent();k={};l=0;for(p=h;l<p.length;l++)r=p[l],k[r.refId]=r;return[2,k]}})})}function C(a){switch(a){case "mask":return 2;case "maskAndTransparency":return 3;case "none":return 1;case "transparency":return 0;default:return 0}}Object.defineProperty(a,"__esModule",{value:!0});a.createTextureResources=a.processLoadResult=a.load=void 0;var E=h.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");a.load=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e;return d.__generator(this,
function(d){switch(d.label){case 0:return[4,w(a,b)];case 1:return c=d.sent(),[4,A(c.textureDefinitions,b)];case 2:return e=d.sent(),[2,{resource:c,textures:e}]}})})};a.processLoadResult=function(a,d){var e,f,h=[],k=[],l=[],p=[],t=a.resource,w=b.Version.parse(t.version||"1.0","wosr");G.validate(w);var w=t.model.name,x=t.model.geometries,z=t.materialDefinitions;a=a.textures;for(var A=0,n=new Map,F=0;F<x.length;F++){var H=x[F];f=H;var T=f.params,Y=T.topology;e=!0;T.vertexAttributes||(E.warn("Geometry must specify vertex attributes"),
e=!1);switch(T.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:Y=T.faces;if(!Y)E.warn("Indexed geometries must specify faces"),e=!1;else if(T.vertexAttributes){var X=void 0;for(X in T.vertexAttributes)(T=Y[X])&&T.values?(null!=T.valueType&&"UInt32"!==T.valueType&&(E.warn("Unsupported indexed geometry indices type '"+T.valueType+"', only UInt32 is currently supported"),e=!1),null!=T.valuesPerElement&&1!==T.valuesPerElement&&(E.warn("Unsupported indexed geometry values per element '"+
T.valuesPerElement+"', only 1 is currently supported"),e=!1)):(E.warn("Indexed geometry does not specify face indices for '"+X+"' attribute"),e=!1)}break;default:E.warn("Unsupported topology '"+Y+"'"),e=!1}f.params.material||(E.warn("Geometry requires material"),e=!1);f=f.params.vertexAttributes;T=void 0;for(T in f)f[T].values||(E.warn("Geometries with externally defined attributes are not yet supported"),e=!1);if(e){f=H.params;e=f.material;f=f.texture;var Y=H.params.vertexAttributes,T={},ca;for(ca in Y)X=
Y[ca],T[ca]={data:X.values,size:X.valuesPerElement};Y={};if("PerAttributeArray"===H.params.topology){for(var H=T.position.data.length/T.position.size,X=new Uint32Array(H),ba=0;ba<H;ba++)X[ba]=ba;var H=X,ga;for(ga in T)Y[ga]=H}else{var H=H.params.faces,ia;for(ia in H)Y[ia]=new Uint32Array(H[ia].values)}(H=a&&a[f])&&!n.has(f)&&(X=new q(H.image,w,H.params),p.push(X),n.set(f,X));X=(X=n.get(f))?X.id:void 0;ba=l[e]?l[e][f]:null;if(!ba){ba=e.substring(e.lastIndexOf("/")+1);ba=z[ba].params;1===ba.transparency&&
(ba.transparency=0);var ha=H&&H.alphaChannelUsage,ha=0<ba.transparency||"transparency"===ha||"maskAndTransparency"===ha,H={ambient:g.vec3f64.fromArray(ba.diffuse),diffuse:g.vec3f64.fromArray(ba.diffuse),opacity:1-(ba.transparency||0),transparent:ha,textureAlphaMode:H?C(H.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:X,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:ba.externalColorMixMode||"tint",textureAlphaPremultiplied:!0};m.isSome(d)&&d.materialParamsMixin&&c.mixin(H,
d.materialParamsMixin);ba=new v(H,w);l[e]||(l[e]={});l[e][f]=ba}k.push(ba);e=new u(new r.GeometryData(T,Y),w);A+=Y.position?Y.position.length:0;h.push(e)}}return{name:w,stageResources:{textures:p,materials:k,geometries:h},pivotOffset:t.model.pivotOffset,boundingBox:B(h),numberOfVertices:A,lodThreshold:null}};a.createTextureResources=A;var G=new b.Version(1,2,"wosr")})},"esri/views/3d/support/buffer/math":function(){define(["require","exports","./math/vec3","./math/vec4"],function(n,a,d,l){Object.defineProperty(a,
"__esModule",{value:!0});a.vec4=a.vec3=void 0;a.vec3=d;a.vec4=l})},"esri/views/3d/support/buffer/math/vec4":function(){define(["require","exports","./common"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.shiftRight=a.scale=a.transformMat3=a.transformMat4=void 0;a.transformMat4=function(a,k,e){if(a.count!==k.count)d.logger.error("source and destination buffers need to have the same number of elements");else{var c=a.count,h=e[0],m=e[1],f=e[2],b=e[3],g=e[4],l=e[5],t=e[6],u=e[7],
r=e[8],q=e[9],v=e[10],w=e[11],z=e[12],x=e[13],B=e[14];e=e[15];var A=a.typedBuffer;a=a.typedBufferStride;var n=k.typedBuffer;k=k.typedBufferStride;for(var E=0;E<c;E++){var G=E*a,F=E*k,H=n[F],J=n[F+1],I=n[F+2],F=n[F+3];A[G]=h*H+g*J+r*I+z*F;A[G+1]=m*H+l*J+q*I+x*F;A[G+2]=f*H+t*J+v*I+B*F;A[G+3]=b*H+u*J+w*I+e*F}}};a.transformMat3=function(a,k,e){if(a.count!==k.count)d.logger.error("source and destination buffers need to have the same number of elements");else{var c=a.count,h=e[0],m=e[1],f=e[2],b=e[3],g=
e[4],l=e[5],t=e[6],u=e[7];e=e[8];var r=a.typedBuffer;a=a.typedBufferStride;var q=k.typedBuffer;k=k.typedBufferStride;for(var v=0;v<c;v++){var w=v*a,z=v*k,x=q[z],B=q[z+1],A=q[z+2],z=q[z+3];r[w]=h*x+b*B+t*A;r[w+1]=m*x+g*B+u*A;r[w+2]=f*x+l*B+e*A;r[w+3]=z}}};a.scale=function(a,d,e){var c=Math.min(a.count,d.count),h=a.typedBuffer;a=a.typedBufferStride;var m=d.typedBuffer;d=d.typedBufferStride;for(var f=0;f<c;f++){var b=f*a,g=f*d;h[b]=e*m[g];h[b+1]=e*m[g+1];h[b+2]=e*m[g+2];h[b+3]=e*m[g+3]}};a.shiftRight=
function(a,d,e){var c=Math.min(a.count,d.count),h=a.typedBuffer;a=a.typedBufferStride;var m=d.typedBuffer;d=d.typedBufferStride;for(var f=0;f<c;f++){var b=f*a,g=f*d;h[b]=m[g]>>e;h[b+1]=m[g+1]>>e;h[b+2]=m[g+2]>>e;h[b+3]=m[g+3]>>e}}})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../../../geometry/support/aaBoundingBox ../../../support/debugFlags ../../../support/buffer/glUtil ../../core/shaderLibrary/output/OutputHighlight.glsl ../Camera ../DefaultVertexAttributeLocations ../intersectorUtils ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E){function G(a,b,c,d){B.encodeDoubleVec3(a.modelOrigin,b,c.modelOriginHi,c.modelOriginLo,d);c.model.copyFrom(d,a.model,b);c.modelNormal.copyFrom(d,a.modelNormal,b);a.color&&c.color&&c.color.copyFrom(d,a.color,b);a.featureAttribute&&c.featureAttribute&&c.featureAttribute.copyFrom(d,a.featureAttribute,b)}Object.defineProperty(a,"__esModule",{value:!0});a.lodRenderers=a.LodRenderer=a.LodLevelData=a.LodComponentData=a.setLevelSelectorFactory=void 0;
var F=function(a){var b=a.baseBoundingSphere.radius;a=a.levels.map(function(a){return a.minScreenSpaceRadius});return new v.LevelSelector(b,a)};a.setLevelSelectorFactory=function(a){F=a};var H=function(){function a(a,b){var c=a.rctx,d=b.geometry;b=b.material;var e=d.data.toRenderData();this.materialRep=a.materialRep;b.setParameterValues({instancedDoublePrecision:!0});a=b.createBufferWriter();var g=a.vertexBufferLayout,h=a.elementCount(e),m=a.allocate(h);a.write({},e,m,0);this.geometry=d;this.material=
b;this.glMaterials=B.acquireMaterials(b,this.materialRep);this.vertexBufferLayout=g;this.vbo=A.createVertex(c,35044,m.buffer);this.vao=new E(c,p.Default3D,{geometry:f.glLayout(g)},{geometry:this.vbo});this.vertexCount=h}a.prototype.destroy=function(){B.releaseMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};Object.defineProperty(a.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!1,configurable:!0});a.prototype.intersect=function(a,b,c,d,e,f){var g=this.geometry.id,h=e.toString();this.material.intersect(this.geometry,null,a.transform.transform,a,c,d,function(c,d,m,k){if(0<=c&&(null==b||b(a.rayBeginPoint,a.rayEndPoint,c))){var l={type:"external",metadata:{layerUid:f.layerUid,graphicUid:f.graphicUid(e)}};if(null==a.results.min.drapedLayerOrder||k>=a.results.min.drapedLayerOrder)if(null==a.results.min.dist||
c<a.results.min.dist)a.results.min.set(l,h,c,d,a.transform.transform,k,null,g,m),a.results.min.intersector="LodRenderer";0!==a.options.store&&(null==a.results.max.drapedLayerOrder||k>=a.results.max.drapedLayerOrder)&&(null==a.results.max.dist||c>a.results.max.dist)&&(a.results.max.set(l,h,c,d,a.transform.transform,k,null,g,m),a.results.min.intersector="LodRenderer");if(2===a.options.store){var p=new t.IntersectorResult(a.results.min.ray);p.set(l,h,c,d,a.transform.transform,k,null,g,m);p.intersector=
"LodRenderer";a.results.all.push(p)}}})};return a}();a.LodComponentData=H;var J=function(){function a(a,b){var c=this;this.components=[];this.minScreenSpaceRadius=b.minScreenSpaceRadius;b.components.forEach(function(b){c.components.push(new H(a,b))})}a.prototype.destroy=function(){this.components.forEach(function(a){a.destroy()})};a.prototype.intersect=function(a,b,c,d,e,f){this.components.forEach(function(g){g.intersect(a,b,c,d,e,f)})};Object.defineProperty(a.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var a=
h.empty();this.components.forEach(function(b){h.expand(a,b.boundingInfo.bbMin);h.expand(a,b.boundingInfo.bbMax)});this._boundingBox=a}return this._boundingBox},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var a=this.boundingBox,b=e.vec3f64.create();h.center(a,b);this._boundingSphere={center:b,radius:.5*h.diameter(a)}}return this._boundingSphere},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",
{get:function(){return this.components.reduce(function(a,b){return a+b.triangleCount},0)},enumerable:!1,configurable:!0});return a}();a.LodLevelData=J;n=function(){function c(b,c,d,e){var h=this;this.type="Lod";this.isGround=!1;this._inverseViewport=l.vec2f64.create();this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._enableLevelSelection=!0;this._lastCamera=new g.default;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=
!1;this.canRender=!0;this._symbol=b;this._optionalFields=c;this._metadata=d;this._instanceBufferLayout=z.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:c});this._glInstanceBufferLayout=f.glLayout(this._instanceBufferLayout,{divisor:1});this._instanceData=new r.InstanceData(this._optionalFields,e);this._instanceData.on("instance-added",function(){h.requestUpdateCycle()});this._instanceData.on("instance-removed",function(){h.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",
function(a){h.requestUpdateCycle();h._metadata.notifyGraphicUpdate(a.index,2)});this._instanceData.on("instance-visibility-changed",function(a){h.requestUpdateCycle(!0);h._metadata.notifyGraphicUpdate(a.index,1)});this._instanceData.on("instance-highlight-changed",function(){h.requestUpdateCycle(!0)});this._enableLevelSelection=1<this._symbol.levels.length;a.lodRenderers.push(this)}c.prototype.destroy=function(){a.lodRenderers.splice(a.lodRenderers.indexOf(this),1)};Object.defineProperty(c.prototype,
"levels",{get:function(){return this._levels},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"baseBoundingBox",{get:function(){return this._levels[this._levels.length-1].boundingBox},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"baseBoundingSphere",{get:function(){return this._levels[this._levels.length-1].boundingSphere},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"baseMaterial",{get:function(){return this._levels[this._levels.length-
1].components[0].material},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"slicePlane",{get:function(){return this._slicePlane},set:function(a){this._slicePlane=a},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"intersectionHandlerId",{get:function(){return this._metadata.layerUid},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,
"memoryUsage",{get:function(){var a={cpu:0,gpu:0};this._renderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});this._highlightRenderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});return a},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"renderStats",{get:function(){var a=this,b=this._instanceData.size,c=[];this._levels.forEach(function(b,d){d=a._renderInstanceData[d].size+a._highlightRenderInstanceData[d].size;b=b.triangleCount;
c.push({renderedInstances:d,renderedTriangles:d*b,trianglesPerInstance:b})});return{totalInstances:b,renderedInstances:c.reduce(function(a,b){return a+b.renderedInstances},0),renderedTriangles:c.reduce(function(a,b){return a+b.renderedTriangles},0),levels:c}},enumerable:!1,configurable:!0});c.prototype.initializeRenderContext=function(a){var b=this;this._initContext=a;var c=a.rctx;this._symbol.levels.forEach(function(d){b._levels.push(new J(a,d));b._renderInstanceData.push(new w.RenderInstanceData(c,
b._instanceBufferLayout));b._highlightRenderInstanceData.push(new w.RenderInstanceData(c,b._instanceBufferLayout))});this._levelSelector=F(this)};c.prototype.uninitializeRenderContext=function(){this.invalidateOctree();this._levels.forEach(function(a){a.destroy()});this._renderInstanceData.forEach(function(a){a.destroy()});this._highlightRenderInstanceData.forEach(function(a){a.destroy()})};Object.defineProperty(c.prototype,"slots",{get:function(){return[4,6]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,
"needsHighlight",{get:function(){return 0<this._highlightRenderInstanceData.reduce(function(a,b){return a+b.size},0)},enumerable:!1,configurable:!0});c.prototype.prepareRender=function(a){this.runUpdates(a)};c.prototype.render=function(a){var b=this,c=a.rctx,d=4===a.slot?3:6===a.slot?5:null;if(d){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(a.pass))return!1;var e=a.camera;this._inverseViewport[0]=1/e.fullViewport[2];this._inverseViewport[1]=1/e.fullViewport[3];var f={slot:d,
origin:[0,0,0],camera:e,inverseViewport:this._inverseViewport,shadowMap:a.shadowMap,shadowMappingEnabled:!!a.shadowMap&&a.shadowMap.enabled,ssaoEnabled:!!a.ssaoHelper&&a.ssaoHelper.enabled,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,slicePlane:a.sliceHelper&&a.sliceHelper.plane,hudVisibilityTexture:a.offscreenRenderingHelper?a.offscreenRenderingHelper.hudVisibilityTexture:null,highlightDepthTexture:a.offscreenRenderingHelper?a.offscreenRenderingHelper.depthTexture:null,hasOccludees:!1,
linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrEnabled:!1,lighting:a.scenelightingData};c.bindVAO();for(var c=function(c){var e=a.isHighlightPass?g._highlightRenderInstanceData[c]:g._renderInstanceData[c];g._levels[c].components.forEach(function(g){b.renderComponent(a,d,f,e,g,c)})},g=this,e=0;e<this._levels.length;++e)c(e);return!0}};c.prototype.intersect=function(a,b,c,d){var f=this;if(this.baseMaterial.isVisible()){var g=
e.vec3f64.create();k.vec3.subtract(g,d,c);var h=function(e){f._instanceData.getCombinedModelTransform(e,L);a.transform.set(L);k.vec3.transformMat4(M,c,a.transform.inverse);k.vec3.transformMat4(Q,d,a.transform.inverse);var g=f._instanceData.getState(e),h=f._instanceData.getLodLevel(e);u.assert(g&r.StateFlags.ACTIVE,"invalid instance state");u.assert(0<=h&&h<f._levels.length,"invaid lod level");f._levels[h].intersect(a,b,M,Q,e,f._metadata)};this.baseMaterial.getParameters().verticalOffset?this.octree.forEach(h):
this.octree.forEachAlongRay(c,g,h)}};c.prototype.queryDepthRange=function(a){return this.queryDepthRangeOctree(a)};c.prototype.notifyShaderTransformationChanged=function(){this.invalidateOctree()};c.prototype.requestUpdateCycle=function(a){void 0===a&&(a=!1);this._updateCyclesWithStaticCamera=-1;a&&(this._needFullCycle=!0);this.needsUpdates&&this._initContext.requestRender()};Object.defineProperty(c.prototype,"needsUpdates",{get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera},
enumerable:!1,configurable:!0});c.prototype.runUpdates=function(a){if(!m.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var b=a.equals(this._lastCamera);this._lastCamera.copyFrom(a);b||this.requestUpdateCycle()}b=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(a,b);this.needsUpdates&&this._initContext.requestRender()}};Object.defineProperty(c.prototype,"octree",{get:function(){this._octree||(this._octree=this.buildOctree());return this._octree},
enumerable:!1,configurable:!0});c.prototype.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};c.prototype.buildOctree=function(){for(var a=new q.InstanceOctree(this._instanceData,this.baseBoundingSphere),b=this._instanceData,b=b.view?b.view.state:null,c=0;c<this._instanceData.capacity;++c)b.get(c)&r.StateFlags.ACTIVE&&a.addInstance(c);return a};c.prototype.queryDepthRangeOctree=function(a){var b=a.eye,c=a.viewForward,d=this.octree.findClosest(c,"front-to-back",
a.frustum),e=this.octree.findClosest(c,"back-to-front",a.frustum);return null!=d&&null!=e?(this._instanceData.view.boundingSphere.getVec(d,K),k.vec3.subtract(K,K,b),d=k.vec3.dot(K,c)-K[3],this._instanceData.view.boundingSphere.getVec(e,K),k.vec3.subtract(K,K,b),b=k.vec3.dot(K,c)+K[3],{near:Math.max(a.near,d),far:Math.min(a.far,b)}):{near:Infinity,far:-Infinity}};c.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._renderInstanceData.forEach(function(a){a.startUpdateCylce()});
this._highlightRenderInstanceData.forEach(function(a){a.startUpdateCylce()});this.needsUpdates&&this._initContext.requestRender()};c.prototype.updateInstances=function(a,b){var c=this._enableLevelSelection,d=this._levelSelector;d.updateCamera(a);this._renderInstanceData.forEach(function(a){a.beginUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.beginUpdate()});a=this._instanceData;var e=this._instanceData.view,f=a.capacity,g=this._instanceIndex;b=Math.min(a.size,b);for(var h=0;h<
b;++h){0===g&&this.startUpdateCycle();var m=e.state.get(g),k=0;if(m&r.StateFlags.ALLOCATED){var l=e.lodLevel.get(g);m&r.StateFlags.ACTIVE&&this._renderInstanceData[l].freeTail();m&r.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[l].freeTail();if(m&r.StateFlags.REMOVE)a.freeInstance(g);else if(m&r.StateFlags.VISIBLE){l=0;c&&(e.modelOrigin.getVec(g,I),l=d.selectLevel(I,a.getCombinedMedianScaleFactor(g)));k=m&~(r.StateFlags.ACTIVE|r.StateFlags.HIGHLIGHT_ACTIVE|r.StateFlags.TRANSFORM_CHANGED);
if(0<=l){var p=this._renderInstanceData[l],t=p.allocateHead();G(e,g,p.view,t);k|=r.StateFlags.ACTIVE;m&r.StateFlags.HIGHLIGHT&&(p=this._highlightRenderInstanceData[l],t=p.allocateHead(),G(e,g,p.view,t),k|=r.StateFlags.HIGHLIGHT_ACTIVE)}e.state.set(g,k);e.lodLevel.set(g,l)}else k=m&~(r.StateFlags.ACTIVE|r.StateFlags.HIGHLIGHT_ACTIVE|r.StateFlags.TRANSFORM_CHANGED),e.state.set(g,k);this._octree&&(l=!!(m&r.StateFlags.ACTIVE),k=!!(k&r.StateFlags.ACTIVE),!l&&k?this._octree.addInstance(g):l&&!k?this._octree.removeInstance(g):
l&&k&&m&r.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(g),this._octree.addInstance(g)));g=(g+1)%f}else g=(g+1)%f,b++}this._instanceIndex=g;this._renderInstanceData.forEach(function(a){a.endUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.endUpdate()})};c.prototype.renderComponent=function(a,c,d,e,f,g){var h=f.glMaterials.get(a.pass);if(h&&h.beginSlot(c)&&0!==e.size){var k=a.rctx,l=k.capabilities.instancing;h.ensureParameters(d);var r=h.getTechnique();c=h.getPipelineState(c);
k.setPipelineState(c);h.bind(k,d);k.bindVAO(f.vao);r.ensureAttributeLocations(f.vao);h=r.program;a.isHighlightPass&&b.OutputHighlight.bindOutputHighlight(k,h,d);r.bindDraw(d);m.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===a.pass&&(h.setUniform4fv("externalColor",R[Math.min(g,R.length-1)]),h.setUniform1i("colorMixMode",x.colorMixModes.replace));a=e.capacity;d=e.headIndex;g=e.tailIndex;var h=e.firstIndex,t=this._glInstanceBufferLayout;c=function(a,b){C.bindVertexBufferLayout(k,p.Default3D,e.buffer,
t,a);l.drawArraysInstanced(r.primitiveType,0,f.vertexCount,b-a);C.unbindVertexBufferLayout(k,p.Default3D,e.buffer,t)};f.material.getParameters().transparent&&null!=h?d>g?(u.assert(h>=g&&h<=d,"invalid firstIndex"),c(h,d),c(g,h)):d<g&&(h<=d?(u.assert(0<=h&&h<=d,"invalid firstIndex"),c(h,d),c(g,a),c(0,h)):(u.assert(h>=g&&h<=a,"invalid firstIndex"),c(h,a),c(0,d),c(g,h))):d>g?c(g,d):d<g&&(c(0,d),c(g,a));k.bindVAO(null)}};return c}();a.LodRenderer=n;a.lodRenderers=[];var I=e.vec3f64.create(),K=c.vec4f64.create(),
L=d.mat4f64.create(),M=e.vec3f64.create(),Q=e.vec3f64.create(),R=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]]})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("require exports tslib ../../../../../core/Evented ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/InterleavedLayout ../Util".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){Object.defineProperty(a,"__esModule",{value:!0});a.InstanceData=a.View=a.StateFlags=void 0;var u;(function(a){a[a.ALLOCATED=1]="ALLOCATED";a[a.ACTIVE=2]="ACTIVE";a[a.VISIBLE=4]="VISIBLE";a[a.HIGHLIGHT=8]="HIGHLIGHT";a[a.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";a[a.REMOVE=32]="REMOVE";a[a.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(u=a.StateFlags||(a.StateFlags={}));var r=function(){return function(a){this.localTransform=a.getField("localTransform",g.BufferViewMat4f64);
this.globalTransform=a.getField("globalTransform",g.BufferViewMat4f64);this.modelOrigin=a.getField("modelOrigin",g.BufferViewVec3f64);this.model=a.getField("model",g.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",g.BufferViewMat3f);this.modelScaleFactors=a.getField("modelScaleFactors",g.BufferViewVec2f);this.boundingSphere=a.getField("boundingSphere",g.BufferViewVec4f64);this.color=a.getField("color",g.BufferViewVec4f);this.featureAttribute=a.getField("featureAttribute",g.BufferViewVec4f);
this.state=a.getField("state",g.BufferViewUint8);this.lodLevel=a.getField("lodLevel",g.BufferViewUint8)}}();a.View=r;n=function(a){function e(b,c){var d=a.call(this)||this;d._capacity=0;d._size=0;d._next=0;var e=p.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");0<=b.indexOf("color")&&(e=e.vec4f("color"));0<=b.indexOf("featureAttribute")&&(e=e.vec4f("featureAttribute"));
e=e.u8("state").u8("lodLevel").alignTo(8);d._layout=e;d._shaderTransformation=c;return d}d.__extends(e,a);Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"view",{get:function(){return this._view},
enumerable:!1,configurable:!0});e.prototype.addInstance=function(){this._size+1>this._capacity&&this.grow();var a=this.findSlot();this._view.state.set(a,u.ALLOCATED);this._size++;this.emit("instance-added",{index:a});return a};e.prototype.removeInstance=function(a){var b=this._view.state;t.assert(0<=a&&a<this._capacity&&b.get(a)&u.ALLOCATED,"invalid instance handle");this.getStateFlag(a,u.ACTIVE)?this.setStateFlags(a,u.REMOVE):this.freeInstance(a);this.emit("instance-removed",{index:a})};e.prototype.freeInstance=
function(a){var b=this._view.state;t.assert(0<=a&&a<this._capacity&&b.get(a)&u.ALLOCATED,"invalid instance handle");b.set(a,0);this._size--};e.prototype.setLocalTransform=function(a,b,c){void 0===c&&(c=!0);this._view.localTransform.setMat(a,b);c&&this.updateModelTransform(a)};e.prototype.getLocalTransform=function(a,b){this._view.localTransform.getMat(a,b)};e.prototype.setGlobalTransform=function(a,b,c){void 0===c&&(c=!0);this._view.globalTransform.setMat(a,b);c&&this.updateModelTransform(a)};e.prototype.getGlobalTransform=
function(a,b){this._view.globalTransform.getMat(a,b)};e.prototype.updateModelTransform=function(a){var d=this._view,e=w,f=z;d.localTransform.getMat(a,x);d.globalTransform.getMat(a,B);var g=c.mat4.multiply(B,B,x);m.vec3.set(e,g[12],g[13],g[14]);d.modelOrigin.setVec(a,e);k.mat3.fromMat4(f,g);d.model.setMat(a,f);e=b.scaleFromMatrix(w,g);e.sort();d.modelScaleFactors.set(a,0,e[1]);d.modelScaleFactors.set(a,1,e[2]);k.mat3.invert(f,f);k.mat3.transpose(f,f);d.modelNormal.setMat(a,f);this.setStateFlags(a,
u.TRANSFORM_CHANGED);this.emit("instance-transform-changed",{index:a})};e.prototype.getModelTransform=function(a,b){var c=this._view;c.model.getMat(a,z);c.modelOrigin.getVec(a,w);b[0]=z[0];b[1]=z[1];b[2]=z[2];b[3]=0;b[4]=z[3];b[5]=z[4];b[6]=z[5];b[7]=0;b[8]=z[6];b[9]=z[7];b[10]=z[8];b[11]=0;b[12]=w[0];b[13]=w[1];b[14]=w[2];b[15]=1};e.prototype.applyShaderTransformation=function(a,b){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b)};e.prototype.getCombinedModelTransform=
function(a,b){this.getModelTransform(a,b);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b);return b};e.prototype.getCombinedLocalTransform=function(a,b){this._view.localTransform.getMat(a,b);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b);return b};e.prototype.getCombinedMaxScaleFactor=function(a){var b=this._view.modelScaleFactors.get(a,1);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(w,this,a),b*=Math.max(a[0],
a[1],a[2]));return b};e.prototype.getCombinedMedianScaleFactor=function(a){var b=this._view.modelScaleFactors.get(a,0);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(w,this,a),a.sort(),b*=a[1]);return b};e.prototype.getModel=function(a,b){this._view.model.getMat(a,b)};e.prototype.setFeatureAttribute=function(a,b){this._view.featureAttribute.setVec(a,b)};e.prototype.getFeatureAttribute=function(a,b){this._view.featureAttribute.getVec(a,b)};e.prototype.setColor=function(a,b){this._view.color.setVec(a,
b)};e.prototype.getColor=function(a,b){this._view.color.getVec(a,b)};e.prototype.setVisible=function(a,b){b!==this.getVisible(a)&&(this.setStateFlag(a,u.VISIBLE,b),this.emit("instance-visibility-changed",{index:a}))};e.prototype.getVisible=function(a){return this.getStateFlag(a,u.VISIBLE)};e.prototype.setHighlight=function(a,b){b!==this.getHighlight(a)&&(this.setStateFlag(a,u.HIGHLIGHT,b),this.emit("instance-highlight-changed",{index:a}))};e.prototype.getHighlight=function(a){return this.getStateFlag(a,
u.HIGHLIGHT)};e.prototype.getState=function(a){return this._view.state.get(a)};e.prototype.getLodLevel=function(a){return this._view.lodLevel.get(a)};e.prototype.countFlags=function(a){for(var b=0,c=0;c<this._capacity;++c)this.getState(c)&a&&++b;return b};e.prototype.setStateFlags=function(a,b){var c=this._view.state;b|=c.get(a);c.set(a,b)};e.prototype.clearStateFlags=function(a,b){var c=this._view.state;b=c.get(a)&~b;c.set(a,b)};e.prototype.setStateFlag=function(a,b,c){c?this.setStateFlags(a,b):
this.clearStateFlags(a,b)};e.prototype.getStateFlag=function(a,b){return!!(this._view.state.get(a)&b)};e.prototype.grow=function(){var a=Math.max(q,Math.floor(this._capacity*v)),b=this._layout.createBuffer(a);if(this._buffer){var c=new Uint8Array(this._buffer.buffer);(new Uint8Array(b.buffer)).set(c)}this._capacity=a;this._buffer=b;this._view=new r(this._buffer)};e.prototype.findSlot=function(){for(var a=this._view.state,b=this._next;a.get(b)&u.ALLOCATED;)b=(b+1)%this._capacity;this._next=(b+1)%this._capacity;
return b};return e}(l);a.InstanceData=n;var q=1024,v=2,w=f.vec3f64.create(),z=e.mat3f64.create(),x=h.mat4f64.create(),B=h.mat4f64.create()})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("require exports tslib ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../Octree".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.InstanceOctree=
void 0;n=function(a){function f(b,c){var d=a.call(this,{getCenter:function(a){var b=d._instanceData.view.boundingSphere,c=d._tmpCenter;c[0]=b.get(a,0);c[1]=b.get(a,1);c[2]=b.get(a,2);return c},getRadius:function(a){return d._instanceData.view.boundingSphere.get(a,3)}},{maximumDepth:25})||this;d._tmpCenter=e.vec3f64.create();d._tmpMat4=l.mat4f64.create();d._instanceData=b;d._boundingSphere=c;return d}d.__extends(f,a);f.prototype.addInstance=function(a){var b=this._instanceData.view.boundingSphere,
d=this._instanceData.getCombinedModelTransform(a,this._tmpMat4),e=k.vec3.transformMat4(this._tmpCenter,this._boundingSphere.center,d),d=this._boundingSphere.radius*c.maxScale(d);b.set(a,0,e[0]);b.set(a,1,e[1]);b.set(a,2,e[2]);b.set(a,3,d);this.add(a)};f.prototype.removeInstance=function(a){this.remove(a)};return f}(h);a.InstanceOctree=n})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["require","exports","../Camera"],function(n,a,d){Object.defineProperty(a,"__esModule",
{value:!0});a.LevelSelector=void 0;n=function(){function a(a,e){this.thresholdScale=1;this._camera=new d.default;this._worldSpaceRadius=a;this._thresholds=e.map(function(a){return a})}a.prototype.updateCamera=function(a){this._camera.copyFrom(a)};a.prototype.selectLevel=function(a,d){a=this._camera.computeScreenPixelSizeAt(a);d=this._worldSpaceRadius*d/a;a=this._thresholds;for(var c=-1,e=0;e<a.length;++e)d>=a[e]*this.thresholdScale&&(c=e);return c};return a}();a.LevelSelector=n})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["require",
"exports","../../../support/buffer/BufferView","../Util","./BackedBufferObject"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.RenderInstanceData=a.View=void 0;var e=function(){return function(a){this.modelOriginHi=a.getField("modelOriginHi",d.BufferViewVec3f);this.modelOriginLo=a.getField("modelOriginLo",d.BufferViewVec3f);this.model=a.getField("model",d.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",d.BufferViewMat3f);this.color=a.getField("instanceColor",d.BufferViewVec4f);
this.featureAttribute=a.getField("instanceFeatureAttribute",d.BufferViewVec4f)}}();a.View=e;n=function(){function a(a,b){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=a;this._instanceBufferLayout=b;this._elementSize=b.stride;this._capacity=1}a.prototype.destroy=function(){this._buffer&&this._buffer.destroy()};Object.defineProperty(a.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"view",{get:function(){return this._view},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){var a=this._headIndex,b=this._tailIndex;return a>=b?a-b:a+this._capacity-b},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"firstIndex",{get:function(){return this._firstIndex},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!1,configurable:!0});a.prototype.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};a.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0};a.prototype.beginUpdate=function(){l.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};a.prototype.endUpdate=function(){l.assert(this._updating,
"not updating");this.size<m*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};a.prototype.allocateHead=function(){l.assert(this._updating,"not updating");this.isFull&&this.grow();var a=this.headIndex;this._captureFirstIndex&&(this._firstIndex=a,this._captureFirstIndex=!1);this.incrementHead();l.assert(this._headIndex!==this._tailIndex,"invalid pointers");return a};a.prototype.freeTail=
function(){l.assert(this._updating,"not updating");l.assert(0<this.size,"invalid size");var a=this._tailIndex===this._firstIndex;this.incrementTail();a&&(this._firstIndex=this._tailIndex)};a.prototype.grow=function(){this.resize(Math.max(c,Math.floor(this._capacity*h)))};a.prototype.shrink=function(){b&&this.resize(Math.max(c,Math.floor(this._capacity*f)))};a.prototype.resize=function(a){l.assert(this._updating,"not updating");if(a!==this._capacity){var b=new k(this._rctx,34962,35044,this._elementSize,
a);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var c=this.size,d=this.compactInstances(b);l.assert(d===c,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=d;this._prevHeadIndex=0}this._resized=!0;this._capacity=a;this._buffer=b;this._view=new e(this._instanceBufferLayout.createView(this._buffer.array))}};a.prototype.compactInstances=function(a){var b=this._headIndex,c=this._tailIndex;return c<b?
(this._buffer.copyRange(c,b,a),b-c):c>b?(this._buffer.copyRange(c,this._capacity,a),0<b&&this._buffer.copyRange(0,b,a,this._capacity-c),b+(this._capacity-c)):0};a.prototype.incrementHead=function(a){void 0===a&&(a=1);this._headIndex=(this._headIndex+a)%this._capacity};a.prototype.incrementTail=function(a){void 0===a&&(a=1);this._tailIndex=(this._tailIndex+a)%this._capacity};a.prototype.transferRange=function(a,b){a<b?this._buffer.transferRange(a,b):a>b&&(0<b&&this._buffer.transferRange(0,b),this._buffer.transferRange(a,
this._capacity))};return a}();a.RenderInstanceData=n;var c=1024,h=2,m=.3,f=.5,b=!0})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["require","exports","../../../../webgl/BufferObject"],function(n,a,d){return function(){function a(a,e,c,h,m){this._elementSize=h;this._buffer=new d(a,e,c);this.resize(m)}a.prototype.destroy=function(){this._buffer.dispose()};Object.defineProperty(a.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"array",{get:function(){return this._array},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this._buffer},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!1,configurable:!0});
a.prototype.copyRange=function(a,d,c,h){void 0===h&&(h=0);a=new Uint8Array(this.array,a*this.elementSize,(d-a)*this.elementSize);(new Uint8Array(c.array,h*this.elementSize)).set(a)};a.prototype.transferAll=function(){this._buffer.setData(this._array)};a.prototype.transferRange=function(a,d){a*=this._elementSize;this._buffer.setSubData(this._array,a,a,d*this._elementSize)};a.prototype.resize=function(a){var d=a*this._elementSize,c=new ArrayBuffer(d);this._array&&(a>=this._capacity?(new Uint8Array(c)).set(new Uint8Array(this._array)):
(new Uint8Array(c)).set((new Uint8Array(this._array)).subarray(0,a*this._elementSize)));this._array=c;this._buffer.setData(d);this._capacity=a};return a}()})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports tslib ../../../../core/Error ../../../../core/lang ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H){function J(a,c,d){switch(c){case "world":for(var f=0,g=a.vertices;f<g.length;f++)c=g[f],b.vec3.add(O,c.pos,a.offset),d.worldUpAtPosition(O,R),c.setFrameFromUpVector(R),c.computeRotationAxisAndAngleFromUpVector();break;case "path":for(b.vec3.add(O,a.vertices[0].pos,a.offset),d.worldUpAtPosition(O,R),G.computeMinimumRotationTangentFrame(a,R),d=0,a=a.vertices;d<a.length;d++){c=a[d];f=e.sign(b.vec3.dot(c.frame.right,c.vRight));b.vec3.cross(c.rotationFrame.up,
c.vRight,c.vLeft);b.vec3.scale(c.rotationFrame.up,c.rotationFrame.up,f);b.vec3.normalize(c.rotationFrame.up,c.rotationFrame.up);var g=b.vec3.dot(c.rotationFrame.up,c.frame.up),m=b.vec3.dot(c.rotationFrame.up,c.frame.right);b.vec3.scale(O,c.frame.up,-m);b.vec3.scale(N,c.frame.right,g);b.vec3.add(O,O,N);b.vec3.normalize(c.rotationFrame.right,O);G.vertexSpaceToProfileSpace(c.rotationRight,c.frame,c.rotationFrame.right);b.vec3.negate(O,c.vLeft);c.rotationAngle=-f*(Math.PI-e.acosClamped(b.vec3.dot(O,c.vRight)));
0<Math.abs(c.rotationAngle)&&(f=e.reciprocalClamped(Math.cos(.5*c.rotationAngle)),h.mat2.set(c.miterStretch,1+(f-1)*c.rotationRight[0]*c.rotationRight[0],(f-1)*c.rotationRight[0]*c.rotationRight[1],(f-1)*c.rotationRight[0]*c.rotationRight[1],1+(f-1)*c.rotationRight[1]*c.rotationRight[1]));c.maxStretchDistance=Math.abs(Math.min(c.vLeftLength,c.vRightLength)*e.reciprocalClamped(Math.cos(.5*(Math.PI-c.rotationAngle))))}}}function I(a,b,c){switch(a){case "symbol-value":return c;case "proportional":return b;
default:return a}}function K(a,c,d,e){a=a.stageObject;var f=a.geometryRecords,g=f.length,h=0;M.spatialReference=d.spatialReference;L.spatialReference=e.spatialReference;for(var m=0;m<g;m++){var k=f[m].geometry,l=k.metadata,p=l.pathGeometry,t=p.builder.path;Q.spatialReference=l.geometrySR;for(var q=t,v=c,u=d,w=e,x=0,z=0,A=q.vertices;z<A.length;z++){var B=A[z];M.x=B.posES[0];M.y=B.posES[1];M.z=B.posES[2];var n=r.evaluateElevationAlignmentAtPoint(M,u,v,w,S),x=x+S.sampledElevation;b.vec3.add(R,B.pos,
q.offset);w.setAltitude(n,R);b.vec3.subtract(B.pos,R,q.offset)}q.updatePathVertexInformation();h+=x/q.vertices.length;"world"!==t.upVector&&J(t,l.upVectorAlignment,e);p.onPathChanged();k.invalidateBoundingInfo();a.geometryVertexAttrsUpdated(m)}return h/g}Object.defineProperty(a,"__esModule",{value:!0});a.NUM_CIRCLE_PROFILE_SUBDIVISIONS=a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=a.NUM_ROUND_JOIN_SUBDIVISIONS=a.Graphics3DPathSymbolLayer=void 0;n=function(e){function g(a,b,c,d){a=e.call(this,a,b,c,d)||this;
a._intrinsicSize=f.vec2f64.fromValues(1,1);a.upVectorAlignment="path";a.stencilWidth=.1;a.ensureDrapedStatus(!1);return a}d.__extends(g,e);g.prototype.doLoad=function(){return d.__awaiter(this,void 0,void 0,function(){var b,e,f,g,h,r,t,q,v,u,w,z,A,n;return d.__generator(this,function(d){b=c.isSome(this.symbolLayer.width)?this.symbolLayer.width:c.isSome(this.symbolLayer.height)?this.symbolLayer.height:this.symbolLayer.size;e=c.isSome(this.symbolLayer.height)?this.symbolLayer.height:b;this._vvConvertOptions=
{modelSize:[1,1,1],symbolSize:[b,1,e],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?B.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};f=this.symbolLayer.anchor||"center";this.upVectorAlignment="path";
"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");g=this.symbolLayer.profile||"circle";switch(g){default:this._profile=G.Profile.circle(a.NUM_CIRCLE_PROFILE_SUBDIVISIONS);break;case "quad":this._profile=G.Profile.rect()}h=[0,0];"center"!==f&&(h={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[f],this._profile.translate(h[0],h[1]));r=this.symbolLayer.join||"simple";switch(r){case "round":this._extruder=new G.MiterExtruder(0,a.NUM_ROUND_JOIN_SUBDIVISIONS);break;case "bevel":this._extruder=
new G.MiterExtruder(0,1);break;case "miter":this._extruder=new G.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new G.SimpleExtruder}t=this.symbolLayer.cap||"butt";switch(t){case "none":this._startCap=new G.NoCapBuilder;this._endCap=new G.NoCapBuilder;break;default:this._startCap=new G.TriangulationCapBuilder(this._profile,0);this._endCap=new G.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new G.TriangulationCapBuilder(this._profile,-.5);this._endCap=new G.TriangulationCapBuilder(this._profile,
.5,!0);break;case "round":q="quad"===g?!0:!1,this._startCap=new G.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:q,subdivisions:a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS}),this._endCap=new G.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:q,subdivisions:a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS})}v=this._getIdHint();u=c.get(this.symbolLayer,"material","color");w=this._getCombinedOpacityAndColor(u);z=p.vec3f64.fromArray(w);A=w[3];n={diffuse:z,ambient:z,opacity:A,transparent:1>A||
this.needsDrivenTransparentPass,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:"none"===t?0:void 0,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(m.vec2.set(this._intrinsicSize,b,e),!x.isValidSize(this._intrinsicSize[0])||!x.isValidSize(this._intrinsicSize[1])))throw new l("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||
m.vec2.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates.enabled?(k.mixin(n,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new H(n,v+"_pathmat")):(n.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new F(n,v+"_pathmat"));this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(3,
this._material);return[2]})})};g.prototype.destroy=function(){e.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)};g.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,g.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,d=this.setGraphicElevationContext(b,new v.ElevationContext);return this._createAs3DShape(b,a.renderingInfo,
d,c,b.uid)};g.prototype.layerOpacityChanged=function(){var a=c.get(this.symbolLayer,"material","color"),a=this._getCombinedOpacity(a);this._material.setParameterValues({opacity:a,transparent:1>a||this.needsDrivenTransparentPass});return!0};g.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,q.needsElevationUpdates3D)};g.prototype.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};g.prototype.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};g.prototype.pixelRatioChanged=function(){return!0};g.prototype.applyRendererDiff=function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(B.updateFastSymbolUpdatesState(this._fastUpdates,b,this._vvConvertOptions))this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};
g.prototype.getVertexData=function(a){for(var b=0,c=a.paths,d=[],e=a.spatialReference,f=this._context.elevationProvider.spatialReference,g=this._context.renderCoordsHelper.spatialReference,h=0;h<c.length;h++)var m=c[h],b=b+m.length;for(var h=new Float64Array(3*b),k=new Float64Array(3*b),l=new Float64Array(3*b),p=0,r=0;r<c.length;r++){m=c[r];d.push({index:p,numVertices:m.length});for(var t=0;t<m.length;t++){var q=m[t];h[p++]=q[0];h[p++]=q[1];h[p++]=a.hasZ?q[2]:0}}a=!0;e.equals(f)?this._copyVertices(h,
0,k,0,b):a=A.bufferToBuffer(h,e,0,k,f,0,b);f.equals(g)?this._copyVertices(k,0,l,0,b):A.bufferToBuffer(k,f,0,l,g,0,b);return{pathVertexDataInfos:d,vertexDataGS:h,vertexDataES:k,vertexDataRS:l,projectionSuccess:a,terrainElevation:0}};g.prototype._copyVertices=function(a,b,c,d,e){b*=3;d*=3;for(var f=0;f<e;++f)c[d++]=a[b++],c[d++]=a[b++],c[d++]=a[b++]};g.prototype._createAs3DShape=function(a,d,e,f,g){var h=a.geometry,m=[],k=[],l=[],p=h.spatialReference,v=this._context.elevationProvider.spatialReference,
u=t.create(),x=this._context.renderCoordsHelper;Q.spatialReference=p;M.spatialReference=v;h=this.getVertexData(h);if(!h.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0<h.pathVertexDataInfos.length){for(v=0;v<h.pathVertexDataInfos.length;++v){var A=h.pathVertexDataInfos[v],B=A.index,A=A.numVertices;if(2>A)this.logger.warn("PathSymbol3DLayer geometry failed to be created (paths should contain at least 2 vertices)");
else{if(c.isSome(this._context.clippingExtent)&&(t.empty(u),t.expandWithBuffer(u,h.vertexDataES,3*B,A),!t.intersectsClippingArea(u,this._context.clippingExtent)))continue;for(var n=[],F=B;F<B+3*A;){var H=F++,P=F++,S=F++,L=new G.PathVertex;b.vec3.set(L.posGS,h.vertexDataGS[H],h.vertexDataGS[P],h.vertexDataGS[S]);b.vec3.set(L.posES,h.vertexDataES[H],h.vertexDataES[P],h.vertexDataES[S]);M.x=L.posES[0];M.y=L.posES[1];M.z=L.posES[2];var Y=r.evaluateElevationAlignmentAtPoint(M,this._context.elevationProvider,
e,x,null);b.vec3.set(R,h.vertexDataRS[H],h.vertexDataRS[P],h.vertexDataRS[S]);x.setAltitude(Y,R);b.vec3.set(L.pos,R[0],R[1],R[2]);n.push(L)}B=new G.Path(n);J(B,this.upVectorAlignment,this._context.renderCoordsHelper);B=new G.Builder(B,this._profile,this._extruder,this._startCap,this._endCap);A=null;this._fastUpdates.enabled?(F=this._fastUpdates.visualVariables,A=F.size?z.getAttributeValue(F.size.field,a):0,n=F.color?z.getAttributeValue(F.color.field,a):0,F=F.opacity?z.getAttributeValue(F.opacity.field,
a):0,A=new G.FastUpdatePathGeometry(B,A,n,F)):(A=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(A[0]*=I(d.size[0],"symbol-value"===d.size[2]?this.symbolLayer.height||0:d.size[2],this.symbolLayer.width||0),A[1]*=I(d.size[2],"symbol-value"===d.size[0]?this.symbolLayer.width||0:d.size[0],this.symbolLayer.height||0)),n=null,this._drivenProperties.color&&(n=d.color),this._drivenProperties.opacity&&null!=d.opacity&&(n=n?[n[0],n[1],n[2],d.opacity]:[1,1,1,d.opacity]),B=new G.StaticPathGeometry(B),
B.bake(A),n&&B.bakeVertexColors(n),A=B);B=A.createGeometryData();B=new C(B,f+"path"+v);B.metadata={pathGeometry:A,geometrySR:p,upVectorAlignment:this.upVectorAlignment,stencilWidth:this.stencilWidth};m.push(B);k.push(this._material);l.push(A.xform)}}a={layerUid:this._context.layer.uid,graphicUid:g};if(0<m.length)return f=new E({geometries:m,materials:k,transformations:l,castShadow:!0,metadata:a,idHint:f}),m=new w(this,f,m,null,null,K,e),m.alignedSampledElevation=h.terrainElevation,m.needsElevationUpdates=
q.needsElevationUpdates3D(e.mode),m}else this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};g.validGeometryTypes=["polyline"];return g}(z.Graphics3DSymbolLayer);a.Graphics3DPathSymbolLayer=n;var L=u.makeDehydratedPoint(0,0,0,null),M=u.makeDehydratedPoint(0,0,0,null),Q=u.makeDehydratedPoint(0,0,0,null),R=p.vec3f64.create(),O=g.vec3f32.create(),N=g.vec3f32.create();a.NUM_ROUND_JOIN_SUBDIVISIONS=3;a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.NUM_CIRCLE_PROFILE_SUBDIVISIONS=
10;var S={verticalDistanceToGround:0,sampledElevation:0};a.default=n})},"esri/core/libs/gl-matrix-2/mat2":function(){define(["require","exports","./math/mat2"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.mat2=void 0;a.mat2=d})},"esri/core/libs/gl-matrix-2/math/mat2":function(){define(["require","exports","./common"],function(n,a,d){function l(a,c,d){var e=c[0],f=c[1],b=c[2];c=c[3];var g=d[0],h=d[1],k=d[2];d=d[3];a[0]=e*g+b*h;a[1]=f*g+c*h;a[2]=e*k+b*d;a[3]=f*k+c*d;return a}function k(a,
c,d){a[0]=c[0]-d[0];a[1]=c[1]-d[1];a[2]=c[2]-d[2];a[3]=c[3]-d[3];return a}Object.defineProperty(a,"__esModule",{value:!0});a.sub=a.mul=a.multiplyScalarAndAdd=a.multiplyScalar=a.equals=a.exactEquals=a.subtract=a.add=a.LDU=a.frob=a.str=a.fromScaling=a.fromRotation=a.scale=a.rotate=a.multiply=a.determinant=a.adjoint=a.invert=a.transpose=a.set=a.identity=a.copy=void 0;a.copy=function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];return a};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a};a.set=
function(a,c,d,m,f){a[0]=c;a[1]=d;a[2]=m;a[3]=f;return a};a.transpose=function(a,c){if(a===c){var d=c[1];a[1]=c[2];a[2]=d}else a[0]=c[0],a[1]=c[2],a[2]=c[1],a[3]=c[3];return a};a.invert=function(a,c){var d=c[0],e=c[1],f=c[2];c=c[3];var b=d*c-f*e;if(!b)return null;b=1/b;a[0]=c*b;a[1]=-e*b;a[2]=-f*b;a[3]=d*b;return a};a.adjoint=function(a,c){var d=c[0];a[0]=c[3];a[1]=-c[1];a[2]=-c[2];a[3]=d;return a};a.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};a.multiply=l;a.rotate=function(a,c,d){var e=c[0],
f=c[1],b=c[2];c=c[3];var g=Math.sin(d);d=Math.cos(d);a[0]=e*d+b*g;a[1]=f*d+c*g;a[2]=e*-g+b*d;a[3]=f*-g+c*d;return a};a.scale=function(a,c,d){var e=c[1],f=c[2],b=c[3],g=d[0];d=d[1];a[0]=c[0]*g;a[1]=e*g;a[2]=f*d;a[3]=b*d;return a};a.fromRotation=function(a,c){var d=Math.sin(c);c=Math.cos(c);a[0]=c;a[1]=d;a[2]=-d;a[3]=c;return a};a.fromScaling=function(a,c){a[0]=c[0];a[1]=0;a[2]=0;a[3]=c[1];return a};a.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],
2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};a.LDU=function(a,c,d,m){a[2]=m[2]/m[0];d[0]=m[0];d[1]=m[1];d[3]=m[3]-a[2]*d[1];return[a,c,d]};a.add=function(a,c,d){a[0]=c[0]+d[0];a[1]=c[1]+d[1];a[2]=c[2]+d[2];a[3]=c[3]+d[3];return a};a.subtract=k;a.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]};a.equals=function(a,c){var e=a[0],m=a[1],f=a[2];a=a[3];var b=c[0],g=c[1],k=c[2];c=c[3];return Math.abs(e-b)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(b))&&Math.abs(m-
g)<=d.EPSILON*Math.max(1,Math.abs(m),Math.abs(g))&&Math.abs(f-k)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(a-c)<=d.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};a.multiplyScalar=function(a,c,d){a[0]=c[0]*d;a[1]=c[1]*d;a[2]=c[2]*d;a[3]=c[3]*d;return a};a.multiplyScalarAndAdd=function(a,c,d,m){a[0]=c[0]+d[0]*m;a[1]=c[1]+d[1]*m;a[2]=c[2]+d[2]*m;a[3]=c[3]+d[3]*m;return a};a.mul=l;a.sub=k})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("require exports tslib ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/mat2f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./GeometryData ./GeometryUtil ./Util ../materials/PathTechnique ../materials/internal/MaterialUtil".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v){var w;(function(a){function w(){return{up:g.vec3f64.create(),right:g.vec3f64.create()}}a.makeFrame=w;a.profileSpaceToVertexSpace=function(a,b,c){a[0]=c[0]*b.right[0]+c[1]*b.up[0];a[1]=c[0]*b.right[1]+c[1]*b.up[1];a[2]=c[0]*b.right[2]+c[1]*b.up[2]};a.vertexSpaceToProfileSpace=function(a,c,d){m.vec2.set(a,b.vec3.dot(d,c.right),b.vec3.dot(d,c.up))};var n=function(){function a(){this.pos=g.vec3f64.create();this.posES=g.vec3f64.create();this.posGS=g.vec3f64.create();
this.vRight=g.vec3f64.create();this.vLeft=g.vec3f64.create();this.frame=w();this.rotationFrame=w();this.rotationRight=f.vec2f64.create();this.rotationAngle=0;this.miterStretch=e.mat2f64.create()}a.prototype.setFrameFromUpVector=function(a){b.vec3.copy(this.frame.up,a);b.vec3.add(E,this.vLeft,this.vRight);b.vec3.normalize(E,E);b.vec3.scale(C,this.frame.up,b.vec3.dot(E,this.frame.up));b.vec3.subtract(H,E,C);b.vec3.normalize(H,H);b.vec3.cross(this.frame.right,H,this.frame.up)};a.prototype.computeRotationAxisAndAngleFromUpVector=
function(){b.vec3.copy(this.rotationFrame.up,this.frame.up);b.vec3.copy(this.rotationFrame.right,this.frame.right);m.vec2.set(this.rotationRight,1,0);b.vec3.scale(C,this.frame.up,b.vec3.dot(this.frame.up,this.vLeft));b.vec3.subtract(C,this.vLeft,C);b.vec3.negate(C,C);b.vec3.normalize(C,C);b.vec3.scale(E,this.frame.up,b.vec3.dot(this.frame.up,this.vRight));b.vec3.subtract(E,this.vRight,E);b.vec3.normalize(E,E);b.vec3.cross(G,this.rotationFrame.up,this.vLeft);this.rotationAngle=l.sign(b.vec3.dot(G,
this.vRight))*(Math.PI-l.acosClamped(b.vec3.dot(C,E)));if(0<Math.abs(this.rotationAngle)){var a=l.reciprocalClamped(Math.cos(.5*this.rotationAngle));k.mat2.set(this.miterStretch,1+(a-1),0,0,1)}this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return a}();a.PathVertex=n;n=function(){function a(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=[];this.uvIndices=this.uvs=null}a.prototype.addVertex=
function(a,b){this.vertices.push(f.vec2f64.clone(a));this.vertexNormals.push(f.vec2f64.clone(b));return this.vertices.length-1};a.prototype.addUV=function(a){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(a);return this.uvs.length-1};a.prototype.addPole=function(a,b){void 0===b&&(b=null);this.poles.push({position:f.vec2f64.clone(a),normal:b?f.vec2f64.clone(b):null});return this.poles.length-1};a.prototype.addSegment=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=null);this.vertexIndices.push(a.v0);
this.vertexIndices.push(a.v1);b&&(this.uvIndices.push(b.v0),this.uvIndices.push(b.v1));c&&(this.poleIndices.push(c.v0),this.poleIndices.push(c.v1))};Object.defineProperty(a.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!1,configurable:!0});a.prototype.hasUV=function(){return null!=this.uvs};a.prototype.translate=function(a,b){for(var c=0,d=this.vertices;c<d.length;c++){var e=d[c];e[0]+=a;e[1]+=b}c=0;for(d=this.poles;c<d.length;c++)e=d[c],e.position[0]+=a,e.position[1]+=
b};a.circle=function(b){void 0===b&&(b=20);var c=new a,d={v0:0,v1:0};c.addPole(f.vec2f64.fromValues(0,0));for(var e=0;e<b;++e){var g=2*e*Math.PI/b,h=Math.cos(g),m=Math.sin(g),g=f.vec2f64.fromValues(.5*h,.5*m),h=f.vec2f64.fromValues(h,m);c.addVertex(g,h);c.addUV(e/b)}c.addUV(1);for(e=0;e<b-1;++e)h={v0:e,v1:e+1},c.addSegment(h,h,d);c.addSegment({v0:b-1,v1:0},{v0:b-1,v1:b},d);return c};a.rect=function(){var b=new a,c=f.vec2f64.fromValues(-.5,-.5),d=f.vec2f64.fromValues(.5,-.5),e=f.vec2f64.fromValues(.5,
.5),g=f.vec2f64.fromValues(-.5,.5),h=f.vec2f64.fromValues(0,-1),m=f.vec2f64.fromValues(1,0),k=f.vec2f64.fromValues(0,1),l=f.vec2f64.fromValues(-1,0);b.addUV(0);b.addUV(1);b.addPole(f.vec2f64.fromValues(0,.5),k);b.addPole(f.vec2f64.fromValues(0,.5));b.addPole(f.vec2f64.fromValues(0,-.5));b.addPole(f.vec2f64.fromValues(0,-.5),h);var p={v0:0,v1:1};b.addVertex(c,h);b.addVertex(d,h);b.addSegment({v0:0,v1:1},p,{v0:3,v1:3});b.addVertex(d,m);b.addVertex(e,m);b.addSegment({v0:2,v1:3},p,{v0:2,v1:1});b.addVertex(e,
k);b.addVertex(g,k);b.addSegment({v0:4,v1:5},p,{v0:0,v1:0});b.addVertex(g,l);b.addVertex(c,l);b.addSegment({v0:6,v1:7},p,{v0:1,v1:2});return b};return a}();a.Profile=n;n=function(){function a(a){this.vertices=[];this.offset=g.vec3f64.create();this.xform=h.mat4f64.create();this.vertices=a;b.vec3.copy(this.offset,this.vertices[Math.floor((a.length-1)/2)].pos);a=0;for(var d=this.vertices;a<d.length;a++){var e=d[a];b.vec3.subtract(e.pos,e.pos,this.offset)}c.mat4.translate(this.xform,this.xform,this.offset);
this.updatePathVertexInformation()}a.prototype.updatePathVertexInformation=function(){var a=this.vertices.length,c=this.vertices[0];c.index=0;b.vec3.set(c.vLeft,0,0,0);c.vLeftLength=0;b.vec3.subtract(c.vRight,this.vertices[1].pos,c.pos);c.vRightLength=b.vec3.length(c.vRight);b.vec3.normalize(c.vRight,c.vRight);for(var d=c,e=1;e<a;++e)c=this.vertices[e],c.index=e,b.vec3.copy(c.vLeft,d.vRight),c.vLeftLength=d.vRightLength,e<a-1?(b.vec3.subtract(c.vRight,this.vertices[e+1].pos,c.pos),c.vRightLength=
b.vec3.length(c.vRight),b.vec3.normalize(c.vRight,c.vRight)):(b.vec3.copy(c.vRight,c.vLeft),c.vRightLength=c.vLeftLength),d=c};return a}();a.Path=n;a.computeMinimumRotationTangentFrame=function(a,c){var d=null,e=a.vertices.length,f=g.vec3f64.create(),h=g.vec3f64.create(),m=g.vec3f64.create(),k=g.vec3f64.create(),l=g.vec3f64.create(),r=g.vec3f64.create(),t=p.plane.create(),q=a.vertices[0];b.vec3.copy(h,c);b.vec3.set(f,0,1,0);u.makeOrthoBasisDirUpFallback(q.vRight,h,f,f,m,h,.99619469809);b.vec3.copy(q.frame.up,
h);b.vec3.copy(q.frame.right,m);d=q;for(c=1;c<e;++c){q=a.vertices[c];b.vec3.add(l,q.vLeft,q.vRight);var v=b.vec3.length(l);0<v?(v=1/Math.sqrt(v),l[0]*=v,l[1]*=v,l[2]*=v):(l[0]=q.vRight[0],l[1]=q.vRight[1],l[2]=q.vRight[2]);b.vec3.add(r,d.pos,d.frame.up);p.plane.fromPositionAndNormal(q.pos,l,t);p.plane.intersectRay(t,p.ray.wrap(r,q.vLeft),k)?(b.vec3.subtract(k,k,q.pos),b.vec3.normalize(h,k),b.vec3.cross(m,l,h),b.vec3.normalize(m,m)):u.makeOrthoBasisDirUpFallback(l,d.frame.up,d.frame.right,f,m,h,.99619469809);
b.vec3.copy(q.frame.up,h);b.vec3.copy(q.frame.right,m);d=q}};n=function(){return function(){}}();a.Extruder=n;n=function(){function a(){}a.prototype.numProfilesPerJoin=function(){return 1};a.prototype.extrude=function(a,b,c){for(var d=0;d<b.vertices.length;++d)c(a.index,a.frame,b.vertices[d],b.vertexNormals[d],!1)};return a}();a.SimpleExtruder=n;n=function(){function a(a,b){void 0===a&&(a=.8*Math.PI);void 0===b&&(b=1);this.cutoffAngle=a;this.numBendSubdivisions=b}a.prototype.numProfilesPerJoin=function(){return this.numBendSubdivisions+
1};a.prototype.extrude=function(a,d,e){var f=J;if(Math.abs(a.rotationAngle)>=this.cutoffAngle)for(var g=0;g<this.numBendSubdivisions+1;++g){c.mat4.identity(I);c.mat4.rotate(I,I,.5*-a.rotationAngle+g*a.rotationAngle/this.numBendSubdivisions,a.rotationFrame.up);var h=f,k=a.frame,l=I;b.vec3.transformMat4(h.up,k.up,l);b.vec3.transformMat4(h.right,k.right,l);for(h=0;h<d.vertices.length;++h)k=m.vec2.dot(d.vertices[h],a.rotationRight),(k=0<=k*a.rotationAngle)?e(a.index,f,d.vertices[h],d.vertexNormals[h],
!1):(m.vec2.transformMat2(x,d.vertices[h],a.miterStretch),e(a.index,a.frame,x,d.vertexNormals[h],!0))}else for(g=0;g<this.numBendSubdivisions+1;++g)for(h=0;h<d.vertices.length;++h)k=m.vec2.dot(d.vertices[h],a.rotationRight),k=0<=k*a.rotationAngle,m.vec2.transformMat2(x,d.vertices[h],a.miterStretch),e(a.index,a.frame,x,d.vertexNormals[h],k?!1:!0)};return a}();a.MiterExtruder=n;var K={generateUV:!1},n=function(){function a(){}a.prototype.rebuildConnectingProfileGeometry=function(a,b,c){for(var d=0;d<
b.vertices.length;++d)c(a.index,a.frame,b.vertices[d],b.vertexNormals[d],0,0)};return a}();a.CapBuilder=n;var R=function(a){function b(){return a.call(this)||this}d.__extends(b,a);b.prototype.getNumVertices=function(){return 0};b.prototype.getNumIndices=function(){return 0};b.prototype.rebuildCapGeometry=function(){};b.prototype.buildTopology=function(){};return b}(n);a.NoCapBuilder=R;R=function(a){function b(b,c,d){void 0===c&&(c=0);void 0===d&&(d=!1);var e=a.call(this)||this;e.profile=b;e.profilePlaneOffset=
c;e.flip=d;return e}d.__extends(b,a);b.prototype.getNumVertices=function(){return this.profile.vertices.length};b.prototype.getNumIndices=function(){return 3*this.profile.numSegments};b.prototype.rebuildConnectingProfileGeometry=function(a,b,c){for(var d=0;d<b.vertices.length;++d)c(a.index,a.frame,b.vertices[d],b.vertexNormals[d],this.profilePlaneOffset,0)};b.prototype.rebuildCapGeometry=function(a,b){var c=B;m.vec2.set(c,0,0);for(var d=this.flip?1:-1,e=0;e<this.profile.vertices.length;++e)b(a.index,
a.frame,this.profile.vertices[e],c,this.profilePlaneOffset,d)};b.prototype.buildTopology=function(a,b){a=this.vertexBufferStart+this.profile.vertexIndices[0];for(var c=1;c<this.profile.numSegments;++c){var d=this.vertexBufferStart+this.profile.vertexIndices[2*c+0],e=this.vertexBufferStart+this.profile.vertexIndices[2*c+1];this.flip?b(e,d,a):b(a,d,e)}};return b}(n);a.TriangulationCapBuilder=R;n=function(a){function b(b){var c=a.call(this)||this;c.flip=!1;c.sign=0;c.breakNormals=!1;c.numSegments=3;
c.profile=b.profile;c.flip=b.flip;c.sign=c.flip?1:-1;c.breakNormals=b.breakNormals;c.numSegments=b.subdivisions;return c}d.__extends(b,a);b.prototype.getNumVertices=function(){var a=0,a=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(a+=this.profile.vertices.length);return a+=this.profile.poles.length};b.prototype.getNumIndices=function(){var a;a=0+2*this.profile.numSegments*(this.numSegments-1);for(var b=0;b<this.profile.numSegments;++b)a=this.profile.poleIndices[this.profile.vertexIndices[2*
b+0]]===this.profile.poleIndices[this.profile.vertexIndices[2*b+1]]?a+1:a+2;return 3*a};b.prototype.rebuildCapGeometry=function(a,b){var c=a.frame,d=.5*this.sign,e=x,f=B;m.vec2.set(f,0,0);for(var g=0;g<this.profile.poles.length;++g){var h=this.profile.poles[g];h.normal?b(a.index,c,h.position,h.normal,d,0):b(a.index,c,h.position,f,d,this.sign)}if(this.breakNormals)for(g=0;g<this.profile.vertices.length;++g)b(a.index,c,this.profile.vertices[g],this.profile.vertexNormals[g],0,0);for(g=0;g<this.numSegments-
1;++g)for(var h=(1-(g+1)/this.numSegments)*Math.PI*.5,k=Math.sin(h),l=Math.cos(h),p=0;p<this.profile.vertices.length;++p)h=this.profile.poles[this.profile.poleIndices[p]],m.vec2.subtract(e,this.profile.vertices[p],h.position),m.vec2.scale(e,e,k),h.normal?(m.vec2.add(e,e,h.position),b(a.index,c,e,h.normal,d*l,0)):(m.vec2.normalize(f,e),m.vec2.scale(f,f,k),m.vec2.add(e,e,h.position),b(a.index,c,e,f,d*l,this.sign*l))};b.prototype.buildTopology=function(a,b){a=this.breakNormals?this.vertexBufferStart+
this.profile.poles.length:this.firstProfileVertexIndex;for(var c=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length,d=0;d<this.profile.numSegments;++d){for(var e=this.profile.vertexIndices[2*d+0],f=this.profile.vertexIndices[2*d+1],g=this.vertexBufferStart+this.profile.poleIndices[e],h=this.vertexBufferStart+this.profile.poleIndices[f],m=a+e,k=a+f,l=0;l<this.numSegments-1;++l){var p=c+l*this.profile.vertices.length+
e,r=c+l*this.profile.vertices.length+f;this.flip?(b(p,k,m),b(k,p,r)):(b(m,k,p),b(r,p,k));m=p;k=r}this.flip?(b(g,k,m),g!==h&&b(g,h,k)):(b(m,k,g),g!==h&&b(k,h,g))}};return b}(n);a.RoundCapBuilder=n;n=function(){function a(a,b,c,d,e,f){void 0===f&&(f=K);this.options=f;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=b;this.path=a;this.extruder=c;this.startCap=d;this.endCap=e;a=this.path.vertices.length-
2;this.numExtrusionProfiles=c.numProfilesPerJoin()*a+2;this.numNormalsTotal=this.numVerticesTotal=b.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;b=this.startCap.getNumVertices();this.numVerticesTotal+=b;this.numNormalsTotal+=b;this.endCap.vertexBufferStart=this.numVerticesTotal;b=this.endCap.getNumVertices();this.numVerticesTotal+=b;this.numNormalsTotal+=b;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*
this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this.rebuildGeometry();this.buildTopology()}a.prototype.emitVertex=function(a,b,c,d,e){this.profileRightAxisData[4*this._extrusionVertexCount+
0]=b.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=b.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=b.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=b.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=b.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=b.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=c[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=c[1];this.profileVertexAndNormalData[4*
this._extrusionVertexCount+2]=d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=a;e?(a=this.path.vertices[a],this.profileRightAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[0]*a.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[1]*a.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};
a.prototype.emitCapVertex=function(a,b,c,d,e,f){this.profileRightAxisData[4*this._extrusionVertexCount+0]=b.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=b.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=b.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=b.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=b.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=b.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+
0]=c[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=c[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=a;this.profileRightAxisData[4*this._extrusionVertexCount+3]=e;this.profileUpAxisData[4*this._extrusionVertexCount+3]=f;++this._extrusionVertexCount};a.prototype.emitTriangle=function(a,b,c){this.vertexIndices[3*this._triangleCount+0]=a;this.vertexIndices[3*
this._triangleCount+1]=b;this.vertexIndices[3*this._triangleCount+2]=c;this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[a];this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[b];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[c];this.normalIndices[3*this._triangleCount+0]=a;this.normalIndices[3*this._triangleCount+1]=b;this.normalIndices[3*this._triangleCount+2]=c;++this._triangleCount};a.prototype.rebuildGeometry=function(){for(var a=this,b=
function(b,c,d,e,f){return a.emitVertex(b,c,d,e,f)},c=function(b,c,d,e,f,g){return a.emitCapVertex(b,c,d,e,f,g)},d=this._extrusionVertexCount=0,e=this.path.vertices;d<e.length;d++){var f=e[d];this.originData[3*f.index+0]=f.pos[0];this.originData[3*f.index+1]=f.pos[1];this.originData[3*f.index+2]=f.pos[2]}this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,c);for(d=1;d<this.path.vertices.length-1;++d)this.extruder.extrude(this.path.vertices[d],this.profile,b);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-
1],this.profile,c);this.startCap.rebuildCapGeometry(this.path.vertices[0],c);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],c);if(this.profile.hasUV()&&this.options.generateUV)for(d=0;d<this.profile.uvs.length;++d)this.uvData[2*d+0]=this.profile.uvs[d],this.uvData[2*d+1]=0};a.prototype.buildTopology=function(){var a=this,b=function(b,c,d){return a.emitTriangle(b,c,d)};this._triangleCount=0;var c=this.profile.vertices.length,d=this.profile.numSegments,e=this.numExtrusionProfiles-
1,f=d*e*6;this.startCap.indexBufferStart=f;this.startCap.firstProfileVertexIndex=0;f+=this.startCap.getNumIndices();this.endCap.indexBufferStart=f;this.endCap.firstProfileVertexIndex=c*(this.numExtrusionProfiles-1);f+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(f);this.normalIndices=new Uint32Array(f);this.pathVertexIndices=new Uint32Array(f);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(f));for(f=0;f<d;++f)for(var g=this.profile.vertexIndices[2*
f],h=this.profile.vertexIndices[2*f+1],m=0;m<e;++m){var k=m*c+g,l=(m+1)*c+h,p=m*c+h;b(k,(m+1)*c+g,l);b(k,l,p)}this.startCap.buildTopology(this.path.vertices[0],b);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],b)};a.prototype.onPathChanged=function(){this.rebuildGeometry()};return a}();a.Builder=n;n=function(){function a(a){this.builder=a}Object.defineProperty(a.prototype,"xform",{get:function(){return this.builder.path.xform},enumerable:!1,configurable:!0});a.prototype.onPathChanged=
function(){this.builder.onPathChanged()};return a}();a.PathGeometry=n;var O=function(a){function c(b){b=a.call(this,b)||this;b.vertexAttributePosition=null;b.vertexAttributeNormal=null;b.vertexAttributeColor=null;b.vertexAttributePosition=new Float32Array(3*b.builder.numVerticesTotal);b.vertexAttributeNormal=new Float32Array(3*b.builder.numNormalsTotal);b.vertexAttributeColor=new Uint8Array(4);b.vertexAttributeColor[0]=255;b.vertexAttributeColor[1]=255;b.vertexAttributeColor[2]=255;b.vertexAttributeColor[3]=
255;return b}d.__extends(c,a);c.prototype.bakeVertexColors=function(a){this.vertexAttributeColor[0]=255*a[0];this.vertexAttributeColor[1]=255*a[1];this.vertexAttributeColor[2]=255*a[2];this.vertexAttributeColor[3]=255*(3<a.length?a[3]:1)};c.prototype.bake=function(a){this.size=a;for(var c=0;c<this.builder.numVerticesTotal;++c){var d=this.builder.pathVertexData[c],e=0===d||d===this.builder.path.vertices.length-1,f=z;b.vec3.set(f,this.builder.originData[3*d+0],this.builder.originData[3*d+1],this.builder.originData[3*
d+2]);var g=C,h=x,d=E,k=G,p=F,r=0,q=0;b.vec3.set(k,this.builder.profileRightAxisData[4*c+0],this.builder.profileRightAxisData[4*c+1],this.builder.profileRightAxisData[4*c+2]);b.vec3.set(p,this.builder.profileUpAxisData[4*c+0],this.builder.profileUpAxisData[4*c+1],this.builder.profileUpAxisData[4*c+2]);m.vec2.set(h,this.builder.profileVertexAndNormalData[4*c+0]*a[0],this.builder.profileVertexAndNormalData[4*c+1]*a[1]);if(e)b.vec3.cross(d,p,k),r=this.builder.profileRightAxisData[4*c+3]*a[0],q=this.builder.profileUpAxisData[4*
c+3];else{var e=B,t=A;m.vec2.set(e,this.builder.profileRightAxisData[4*c+3],this.builder.profileUpAxisData[4*c+3]);var v=m.vec2.length(e);m.vec2.normalize(e,e);var u=m.vec2.dot(h,e);if(Math.abs(u)>v){m.vec2.set(t,-e[1],e[0]);var w=m.vec2.dot(h,t);m.vec2.scale(e,e,v*l.sign(u));m.vec2.scale(t,t,w);m.vec2.add(h,e,t)}b.vec3.set(d,0,0,0)}b.vec3.set(g,k[0]*h[0]+p[0]*h[1],k[1]*h[0]+p[1]*h[1],k[2]*h[0]+p[2]*h[1]);this.vertexAttributePosition[3*c+0]=f[0]+g[0]+d[0]*r;this.vertexAttributePosition[3*c+1]=f[1]+
g[1]+d[1]*r;this.vertexAttributePosition[3*c+2]=f[2]+g[2]+d[2]*r;f=x;m.vec2.set(f,this.builder.profileVertexAndNormalData[4*c+2],this.builder.profileVertexAndNormalData[4*c+3]);this.vertexAttributeNormal[3*c+0]=k[0]*f[0]+p[0]*f[1]+d[0]*q;this.vertexAttributeNormal[3*c+1]=k[1]*f[0]+p[1]*f[1]+d[1]*q;this.vertexAttributeNormal[3*c+2]=k[2]*f[0]+p[2]*f[1]+d[2]*q}};c.prototype.createGeometryData=function(){var a={};a[r.VertexAttrConstants.POSITION]=this.builder.vertexIndices;a[r.VertexAttrConstants.NORMAL]=
this.builder.normalIndices;this.vertexAttributeColor&&(a[r.VertexAttrConstants.COLOR]=new Uint32Array(a[r.VertexAttrConstants.POSITION].length));var b={};b[r.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition};b[r.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal};this.vertexAttributeColor&&(b[r.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor});return new t.GeometryData(b,a,"triangle")};c.prototype.onPathChanged=function(){a.prototype.onPathChanged.call(this);
this.bake(this.size)};c.prototype.intersect=function(a,b,c){var d=this.builder.vertexIndices;v.intersectTriangles(a,b,0,d.length/3,d,{size:3,offsetIdx:0,strideIdx:3,data:this.vertexAttributePosition},void 0,void 0,c)};return c}(n);a.StaticPathGeometry=O;n=function(a){function b(b,c,d,e){var f=a.call(this,b)||this;f.sizeAttributeValue=c;f.colorAttributeValue=d;f.opacityAttributeValue=e;f.vvData=null;f.baked=new O(b);f.vvData=new Float32Array(4*f.builder.path.vertices.length);for(b=0;b<f.builder.path.vertices.length;++b)f.vvData[4*
b+0]=c,f.vvData[4*b+1]=d,f.vvData[4*b+2]=e,f.vvData[4*b+3]=0===b||b===f.builder.path.vertices.length-1?1:0;return f}d.__extends(b,a);b.prototype.createGeometryData=function(){var a={};a[q.PathVertexAttrConstants.POSITION]=this.builder.pathVertexIndices;a[q.PathVertexAttrConstants.PROFILERIGHT]=this.builder.vertexIndices;a[q.PathVertexAttrConstants.PROFILEUP]=this.builder.vertexIndices;a[q.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL]=this.builder.vertexIndices;a[q.PathVertexAttrConstants.FEATUREVALUE]=
this.builder.pathVertexIndices;var b={};b[q.PathVertexAttrConstants.POSITION]={size:3,data:this.builder.originData};b[q.PathVertexAttrConstants.PROFILERIGHT]={size:4,data:this.builder.profileRightAxisData};b[q.PathVertexAttrConstants.PROFILEUP]={size:4,data:this.builder.profileUpAxisData};b[q.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL]={size:4,data:this.builder.profileVertexAndNormalData};b[q.PathVertexAttrConstants.FEATUREVALUE]={size:4,data:this.vvData};return new t.GeometryData(b,a,"triangle")};
return b}(n);a.FastUpdatePathGeometry=n})(w||(w={}));var z=g.vec3f64.create(),x=f.vec2f64.create(),B=f.vec2f64.create(),A=f.vec2f64.create(),C=g.vec3f64.create(),E=g.vec3f64.create(),G=g.vec3f64.create(),F=g.vec3f64.create(),H=g.vec3f64.create(),J=w.makeFrame(),I=h.mat4f64.create();return w})},"esri/core/libs/gl-matrix-2/mat2f64":function(){define(["require","exports","./factories/mat2f64"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.mat2f64=void 0;a.mat2f64=d})},"esri/core/libs/gl-matrix-2/factories/mat2f64":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.createView=a.fromValues=a.clone=a.create=void 0;a.create=function(){return[1,0,0,1]};a.clone=function(a){return[a[0],a[1],a[2],a[3]]};a.fromValues=function(a,l,k,e){return[a,l,k,e]};a.createView=function(a,l){return new Float64Array(a,l,4)}})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/StencilUtils ../shaders/Path.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){Object.defineProperty(a,"__esModule",{value:!0});a.PathTechniqueConfiguration=a.PathTechnique=a.pathVertexAttributeLocations=a.PathVertexAttrConstants=void 0;a.PathVertexAttrConstants={POSITION:"position",PROFILERIGHT:"profileRight",PROFILEUP:"profileUp",PROFILEVERTEXANDNORMAL:"profileVertexAndNormal",FEATUREVALUE:"featureValue"};a.pathVertexAttributeLocations={position:0,profileRight:1,profileUp:2,profileVertexAndNormal:3,featureValue:4};f=function(b){function f(){return null!==
b&&b.apply(this,arguments)||this}d.__extends(f,b);f.prototype.initializeProgram=function(b){var c=f.shader.get(),d=this.configuration,c=c.build({output:d.output,viewingMode:b.viewingMode,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:d.receiveShadows,vvSize:d.vvSize,vvColor:d.vvColor,vvInstancingEnabled:!0,vvOpacity:d.vvOpacity,useOldSceneLightInterface:!1,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:d.receiveSSAO,
doubleSidedMode:d.doubleSidedMode});return new t(b.rctx,c.generateSource("vertex"),c.generateSource("fragment"),a.pathVertexAttributeLocations)};f.prototype.bindPass=function(a,b,c){h.View.bindProjectionMatrix(this.program,c.camera.projectionMatrix);this.program.setUniform3fv("size",b.size);0===this.configuration.output?(c.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("size",b.size),this.program.setUniform3fv("ambient",b.ambient),this.program.setUniform3fv("diffuse",b.diffuse),
this.program.setUniform3fv("specular",b.specular),this.program.setUniform1f("opacity",b.opacity)):1!==this.configuration.output&&3!==this.configuration.output||h.View.bindNearFar(this.program,c.camera.nearFar);k.setVVUniforms(this.program,b)};f.prototype.bindDraw=function(a){h.View.bindView(this.program,a);l.Slice.bindUniformsWithOrigin(this.program,this.configuration,a);0===this.configuration.output&&(h.View.bindCamPosition(this.program,a.origin,a.camera.viewInverseTransposeMatrix),c.ReadShadowMap.bindView(this.program,
a));2===this.configuration.output&&e.VertexNormal.bindUniforms(this.program,a.camera.viewInverseTransposeMatrix)};f.prototype.initializePipeline=function(){var a=this.configuration,b=function(b){return u.makePipelineState({blending:b,culling:(a.slicePlaneEnabled?!1:!a.transparent&&0!==a.doubleSidedMode)&&{face:1028,mode:2305},depthTest:{func:513},depthWrite:u.defaultDepthWriteParams,colorWrite:u.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?g.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?
g.stencilBaseAllZerosParams:null})};return 0===a.output?b(a.transparent&&u.separateBlendingParams(770,1,771,771)):b(null)};f.shader=new m.ReloadableShaderModule(p,function(){return new Promise(function(a,b){n(["../shaders/Path.glsl"],a,b)})});return f}(f.ShaderTechnique);a.PathTechnique=f;f=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.doubleSidedMode=0;b.receiveShadows=!1;b.receiveSSAO=!1;b.vvSize=!1;b.vvColor=!1;b.vvOpacity=!1;b.slicePlaneEnabled=!1;b.shadowMap=
!1;b.transparent=!1;b.sceneHasOcludees=!1;return b}d.__extends(c,a);d.__decorate([b.parameter({count:7})],c.prototype,"output",void 0);d.__decorate([b.parameter({count:3})],c.prototype,"doubleSidedMode",void 0);d.__decorate([b.parameter()],c.prototype,"receiveShadows",void 0);d.__decorate([b.parameter()],c.prototype,"receiveSSAO",void 0);d.__decorate([b.parameter()],c.prototype,"vvSize",void 0);d.__decorate([b.parameter()],c.prototype,"vvColor",void 0);d.__decorate([b.parameter()],c.prototype,"vvOpacity",
void 0);d.__decorate([b.parameter()],c.prototype,"slicePlaneEnabled",void 0);d.__decorate([b.parameter()],c.prototype,"shadowMap",void 0);d.__decorate([b.parameter()],c.prototype,"transparent",void 0);d.__decorate([b.parameter()],c.prototype,"sceneHasOcludees",void 0);return c}(b.ShaderTechniqueConfiguration);a.PathTechniqueConfiguration=f})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define(["require","exports","tslib","./PositionAttribute.glsl",
"../../shaderModules/interfaces"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.setVVUniforms=a.PathVertexPosition=void 0;a.PathVertexPosition=function(a,v){a.attributes.add("featureValue","vec4");a.vertex.code.add(k.glsl(e||(e=d.__makeTemplateObject(["\n  bool isCapVertex() {\n    return featureValue.w \x3d\x3d 1.0;\n  }\n  "],["\n  bool isCapVertex() {\n    return featureValue.w \x3d\x3d 1.0;\n  }\n  "]))));a.vertex.uniforms.add("size","vec3");v.vvSize?(a.vertex.uniforms.add("vvSizeMinSize",
"vec3"),a.vertex.uniforms.add("vvSizeMaxSize","vec3"),a.vertex.uniforms.add("vvSizeOffset","vec3"),a.vertex.uniforms.add("vvSizeFactor","vec3"),a.vertex.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n    vec2 getSize() {\n      return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n    }\n    "],["\n    vec2 getSize() {\n      return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n    }\n    "]))))):a.vertex.code.add(k.glsl(h||
(h=d.__makeTemplateObject(["\n    vec2 getSize(){\n      return size.xy;\n    }\n    "],["\n    vec2 getSize(){\n      return size.xy;\n    }\n    "]))));v.vvOpacity?(a.vertex.defines.addInt("VV_OPACITY_N",8),a.vertex.code.add(k.glsl(m||(m=d.__makeTemplateObject(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    vec4 applyOpacity(vec4 color) {\n      float value \x3d featureValue.z;\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vec4( color.xyz, vvOpacityOpacities[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n        }\n      }\n\n      return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);\n    }\n    "],
["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    vec4 applyOpacity(vec4 color) {\n      float value \x3d featureValue.z;\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vec4( color.xyz, vvOpacityOpacities[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n        }\n      }\n\n      return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);\n    }\n    "]))))):
a.vertex.code.add(k.glsl(f||(f=d.__makeTemplateObject(["\n    vec4 applyOpacity(vec4 color){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity(vec4 color){\n      return color;\n    }\n    "]))));v.vvColor?(a.vertex.defines.addInt("VV_COLOR_N",8),a.vertex.code.add(k.glsl(b||(b=d.__makeTemplateObject(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 getColor() {\n      float value \x3d featureValue.y;\n      if (value \x3c\x3d vvColorValues[0]) {\n        return applyOpacity(vvColorColors[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n        }\n      }\n\n      return applyOpacity(vvColorColors[VV_COLOR_N - 1]);\n    }\n    "],
["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 getColor() {\n      float value \x3d featureValue.y;\n      if (value \x3c\x3d vvColorValues[0]) {\n        return applyOpacity(vvColorColors[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n        }\n      }\n\n      return applyOpacity(vvColorColors[VV_COLOR_N - 1]);\n    }\n    "]))))):
a.vertex.code.add(k.glsl(g||(g=d.__makeTemplateObject(["\n    vec4 getColor(){\n      return applyOpacity(vec4(1, 1, 1, 1));\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(vec4(1, 1, 1, 1));\n    }\n    "]))));a.include(l.PositionAttribute);a.attributes.add("profileRight","vec4");a.attributes.add("profileUp","vec4");a.attributes.add("profileVertexAndNormal","vec4");a.vertex.code.add(k.glsl(p||(p=d.__makeTemplateObject(["\n  vec3 calculateVPos() {\n    vec2 size \x3d getSize();\n    vec3 origin \x3d position;\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileVertex \x3d profileVertexAndNormal.xy * size;\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n    float positionOffsetAlongProfilePlaneNormal \x3d 0.0;\n    float normalOffsetAlongProfilePlaneNormal \x3d 0.0;\n    "],
["\n  vec3 calculateVPos() {\n    vec2 size \x3d getSize();\n    vec3 origin \x3d position;\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileVertex \x3d profileVertexAndNormal.xy * size;\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n    float positionOffsetAlongProfilePlaneNormal \x3d 0.0;\n    float normalOffsetAlongProfilePlaneNormal \x3d 0.0;\n    "]))));a.vertex.code.add(k.glsl(t||(t=d.__makeTemplateObject(["\n    if(!isCapVertex()) {\n      vec2 rotationRight \x3d vec2(profileRight.w, profileUp.w);\n      float maxDistance \x3d length(rotationRight);\n  "],
["\n    if(!isCapVertex()) {\n      vec2 rotationRight \x3d vec2(profileRight.w, profileUp.w);\n      float maxDistance \x3d length(rotationRight);\n  "]))));a.vertex.code.add(k.glsl(u||(u=d.__makeTemplateObject(["\n      rotationRight \x3d maxDistance \x3e 0.0 ? normalize(rotationRight) : vec2(0, 0);\n\n      // decompose vertex into rotationRight and rotationUp\n      // limit rotation right component to maxDistance\n      // and reassemble profile vertex from rotationRight and rotationUp\n      float rx \x3d dot(profileVertex, rotationRight);\n      if (abs(rx) \x3e maxDistance) {\n        // NB: we do the tangent by x\x3d-y and y\x3dx\n        vec2 rotationUp \x3d vec2(-rotationRight.y, rotationRight.x);\n        float ry \x3d dot(profileVertex, rotationUp);\n        profileVertex \x3d rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n      }\n    }else{\n       positionOffsetAlongProfilePlaneNormal \x3d profileRight.w * size[0];\n       normalOffsetAlongProfilePlaneNormal \x3d profileUp.w;\n    }\n\n    vec3 offset \x3d right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\n\n    return origin + offset; // localPosition\n  }\n  "],
["\n      rotationRight \x3d maxDistance \x3e 0.0 ? normalize(rotationRight) : vec2(0, 0);\n\n      // decompose vertex into rotationRight and rotationUp\n      // limit rotation right component to maxDistance\n      // and reassemble profile vertex from rotationRight and rotationUp\n      float rx \x3d dot(profileVertex, rotationRight);\n      if (abs(rx) \x3e maxDistance) {\n        // NB: we do the tangent by x\x3d-y and y\x3dx\n        vec2 rotationUp \x3d vec2(-rotationRight.y, rotationRight.x);\n        float ry \x3d dot(profileVertex, rotationUp);\n        profileVertex \x3d rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n      }\n    }else{\n       positionOffsetAlongProfilePlaneNormal \x3d profileRight.w * size[0];\n       normalOffsetAlongProfilePlaneNormal \x3d profileUp.w;\n    }\n\n    vec3 offset \x3d right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\n\n    return origin + offset; // localPosition\n  }\n  "]))));
a.vertex.code.add(k.glsl(r||(r=d.__makeTemplateObject(["\n  vec3 localNormal() {\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n\n    vec3 normal \x3d right * profileNormal.x + up * profileNormal.y;\n\n    if(isCapVertex()) {\n      normal +\x3d forward * profileUp.w;\n    }\n\n    return normal;\n  }\n  "],["\n  vec3 localNormal() {\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n\n    vec3 normal \x3d right * profileNormal.x + up * profileNormal.y;\n\n    if(isCapVertex()) {\n      normal +\x3d forward * profileUp.w;\n    }\n\n    return normal;\n  }\n  "]))))};
a.setVVUniforms=function(a,b){b.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor));b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors));b.vvOpacityEnabled&&(a.setUniform1fv("vvOpacityValues",b.vvOpacityValues),a.setUniform1fv("vvOpacityOpacities",b.vvOpacityOpacities))};var e,c,
h,m,f,b,g,p,t,u,r})},"esri/views/3d/webgl-engine/shaders/Path.glsl":function(){define("require exports tslib ../core/shaderLibrary/ForwardLinearDepth.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/output/OutputDepth.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/NormalUtils.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var n=new r.ShaderBuilder;n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");n.varyings.add("vpos","vec3");n.include(c.PathVertexPosition,a);0===a.output&&(n.include(e.Transform,{linearDepth:!1}),a.receiveShadows&&n.include(t.ReadShadowMap,a),n.include(l.ForwardLinearDepth,a),n.varyings.add("vnormal","vec3"),n.varyings.add("vcolor",
"vec4"),n.vertex.code.add(u.glsl(q||(q=d.__makeTemplateObject(["\n      void main() {\n        vpos \x3d calculateVPos();\n        vnormal \x3d normalize(localNormal());\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n\n        forwardLinearDepth();\n\n        vcolor \x3d getColor();\n      }\n    "],["\n      void main() {\n        vpos \x3d calculateVPos();\n        vnormal \x3d normalize(localNormal());\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n\n        forwardLinearDepth();\n\n        vcolor \x3d getColor();\n      }\n    "])))),
n.include(k.Slice,a),n.include(b.EvaluateSceneLighting,a),n.include(f.EvaluateAmbientOcclusion,a),a.receiveShadows&&n.include(t.ReadShadowMap,a),n.include(g.Normals,a),n.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),n.fragment.code.add(u.glsl(v||(v=d.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        shadingParams.normalView \x3d vnormal;\n        vec3 normal \x3d shadingNormal(shadingParams);\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n    "],
["\n      void main() {\n        discardBySlice(vpos);\n\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        shadingParams.normalView \x3d vnormal;\n        vec3 normal \x3d shadingNormal(shadingParams);\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n    "])))),
a.receiveShadows?n.fragment.code.add(u.glsl(w||(w=d.__makeTemplateObject(["\n        float shadow \x3d readShadowMap(vpos, linearDepth);\n      "],["\n        float shadow \x3d readShadowMap(vpos, linearDepth);\n      "])))):1===a.viewingMode?n.fragment.code.add(u.glsl(z||(z=d.__makeTemplateObject(["\n        float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n      "],["\n        float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n      "])))):n.fragment.code.add(u.glsl(x||
(x=d.__makeTemplateObject(["\n        float shadow \x3d 0.0;\n      "],["\n        float shadow \x3d 0.0;\n      "])))),n.fragment.code.add(u.glsl(B||(B=d.__makeTemplateObject(["\n        vec3 albedo \x3d vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n        float combinedOpacity \x3d vcolor.a * opacity;\n        albedo +\x3d 0.25 * specular; // don't completely ignore specular for now\n\n        vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n        gl_FragColor \x3d vec4(shadedColor, combinedOpacity);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "],
["\n        vec3 albedo \x3d vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n        float combinedOpacity \x3d vcolor.a * opacity;\n        albedo +\x3d 0.25 * specular; // don't completely ignore specular for now\n\n        vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n        gl_FragColor \x3d vec4(shadedColor, combinedOpacity);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "])))));
if(1===a.output||3===a.output)n.include(e.Transform,{linearDepth:!0}),n.vertex.uniforms.add("nearFar","vec2"),n.varyings.add("depth","float"),n.vertex.code.add(u.glsl(A||(A=d.__makeTemplateObject(["\n        void main() {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        }\n    "],["\n        void main() {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        }\n    "])))),
n.include(k.Slice,a),n.include(h.OutputDepth,a),n.fragment.uniforms.add("timeElapsed","float"),n.fragment.code.add(u.glsl(C||(C=d.__makeTemplateObject(["\n        void main() {\n          discardBySlice(vpos);\n          outputDepth(depth);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n          outputDepth(depth);\n        }\n    "]))));2===a.output&&(n.include(e.Transform,{linearDepth:!1}),n.include(p.NormalUtils,a),n.vertex.uniforms.add("viewNormal","mat4"),n.varyings.add("vnormal",
"vec3"),n.vertex.code.add(u.glsl(E||(E=d.__makeTemplateObject(["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          vnormal \x3d normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          vnormal \x3d normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),
n.include(k.Slice,a),n.fragment.uniforms.add("waterColor","vec4"),n.fragment.code.add(u.glsl(G||(G=d.__makeTemplateObject(["\n        void main() {\n          discardBySlice(vpos);\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n        }\n    "])))));
4===a.output&&(n.include(e.Transform,{linearDepth:!1}),n.include(p.NormalUtils,a),n.vertex.uniforms.add("viewNormal","mat4"),n.varyings.add("vnormal","vec3"),n.vertex.code.add(u.glsl(F||(F=d.__makeTemplateObject(["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),
n.include(k.Slice,a),n.include(m.OutputHighlight),n.fragment.code.add(u.glsl(H||(H=d.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "])))));return n};var q,v,w,z,x,B,A,C,E,G,F,H})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("require exports tslib ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./PathTechnique ./VisualVariableMaterialParameters ./internal/bufferWriterUtils ./internal/MaterialUtil ./internal/MaterialUtil".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){var q=b.assert;n=function(a){function b(c,d){d=a.call(this,d)||this;d.supportsEdges=!0;d._vertexAttributeLocations=g.pathVertexAttributeLocations;d.techniqueConfig=new g.PathTechniqueConfiguration;d.params=r.copyParameters(c,w);d.vertexBufferLayout=b.getVertexBufferLayout(d.params);return d}d.__extends(b,a);b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.vvColor=
this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;0===a&&(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=
this.params.receiveShadows,this.techniqueConfig.receiveSSAO=this.params.receiveSSAO);return this.techniqueConfig};b.prototype.getPassParameters=function(){return this.params};b.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};b.prototype.isVisible=function(){var b=this.params;return a.prototype.isVisible.call(this)?0<b.opacity:!1};b.prototype.setParameterValues=function(a){u.updateParameters(this.params,a)&&this.parametersChanged()};b.prototype.getParameters=function(){return this.params};
b.prototype.intersect=function(a,b,c,d,e,f,g){if(a.metadata){b=a.metadata.pathGeometry;c=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){var h=this.params.vvSizeOffset,m=this.params.vvSizeFactor,p=this.params.vvSizeMinSize,t=this.params.vvSizeMaxSize,q=b.sizeAttributeValue;c[0]*=l.clamp(h[0]+q*m[0],p[0],t[0]);c[1]*=l.clamp(h[2]+q*m[2],p[2],t[2])}h=Math.max(c[0],c[1]);a=k.fromValues(a.boundingInfo.bbMin[0]-h,a.boundingInfo.bbMin[1]-h,a.boundingInfo.bbMin[2]-h,a.boundingInfo.bbMax[0]+
h,a.boundingInfo.bbMax[1]+h,a.boundingInfo.bbMax[2]+h);h=[f[0]-e[0],f[1]-e[1],f[2]-e[2]];m=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]);r.intersectAabbInvDir(a,e,[m/h[0],m/h[1],m/h[2]],d.tolerance)&&(b.baked.size&&b.baked.size[0]===c[0]&&b.baked.size[1]===c[1]||b.baked.bake(c),b.baked.intersect(e,f,g))}};b.prototype.computeAttachmentOrigin=function(a,b){a=a.data;return(a="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null)?h.computeAttachmentOriginLines(a[g.PathVertexAttrConstants.POSITION],
null,!1,b):null};b.prototype.createBufferWriter=function(){return new z(this.vertexBufferLayout)};b.prototype.getGLMaterial=function(a){if(0===a.output||1===a.output||2===a.output||4===a.output||3===a.output&&this.params.castShadows)return new v(a)};b.getVertexBufferLayout=function(a){var b=c.newLayout().vec3f(g.PathVertexAttrConstants.POSITION).vec4f(g.PathVertexAttrConstants.PROFILERIGHT).vec4f(g.PathVertexAttrConstants.PROFILEUP).vec4f(g.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL);if(a.vvColorEnabled||
a.vvSizeEnabled||a.vvOpacityEnabled)b=b.vec4f(g.PathVertexAttrConstants.FEATUREVALUE);return b};return b}(f.Material);var v=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}d.__extends(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(g.PathTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=function(a){return a===(this.technique.configuration.transparent?5:3)};b.prototype._updateOccludeeState=
function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype._updateShadowState=function(a){a.shadowMappingEnabled!==this.technique.configuration.receiveShadows&&(this.material.setParameterValues({receiveShadows:a.shadowMappingEnabled}),this.updateParameters())};b.prototype.ensureParameters=function(a){0===this.output&&(this._updateShadowState(a),this._updateOccludeeState(a))};
b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters(),b)};return b}(m.GLMaterial),w=d.__assign({size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1},p.Default),z=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return a.indices[g.PathVertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d){var f=function(a){if(a in b.vertexAttr){var f=b.vertexAttr[a],g=b.indices[a];q(4===f.size);var h=c.getField(a,e.BufferViewVec4f);if(h)t.writeBufferVec4(g,f.data,h,d);else throw Error("unable to acquire view for "+a);}};f(g.PathVertexAttrConstants.PROFILERIGHT);f(g.PathVertexAttrConstants.PROFILEUP);f(g.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL);this.vertexBufferLayout.hasField(g.PathVertexAttrConstants.FEATUREVALUE)&&
f(g.PathVertexAttrConstants.FEATUREVALUE);t.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,c,d)};return a}();return n})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../support/patternUtils ../support/uvUtils ../../support/buffer/BufferView ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J){Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DPolygonFillSymbolLayer=void 0;n=function(a){function u(b,c,d,e){b=a.call(this,b,c,d,e)||this;b._needsUV=!1;b._hasOutline=!1;return b}d.__extends(u,a);u.prototype.doLoad=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(a){return[2]})})};u.prototype.ensureMaterials=function(){this.ensureFillMaterial();this.ensureOutlineMaterial()};
u.prototype.ensureFillMaterial=function(){if(!k.isSome(this._material)){var a=k.get(this.symbolLayer,"material","color"),a=this._getCombinedOpacityAndColor(a);this._material=w.createMaterial(this.symbolLayer,{color:a,transparent:1>a[3]||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped,idHint:this._getIdHint()});this._needsUV=this._material instanceof H;this._context.stage.add(3,this._material)}};u.prototype.ensureOutlineMaterial=
function(){var a=this.symbolLayer.outline;if(!k.isSome(this._outlineMaterial)&&this._isValidOutline(a)){this._hasOutline=!0;var b;b=e.pt2px(a.size);var c=a.stipplePattern?G.createStipplePattern(a.stipplePattern.map(e.pt2px)):null,a=a.stippleOffColor?l.toUnitRGBA(a.stippleOffColor):null;b=1.5<b?new J({width:b,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:c,stippleIntegerRepeats:!0,stippleOffColor:a},this._getIdHint("_outline_ribbonlinemat")):
new F({color:this._getOutlineColor(),slicePlaneEnabled:this._context.slicePlaneEnabled,width:b,stipplePattern:c,stippleIntegerRepeats:!0,stippleOffColor:a},this._getIdHint("_outline_nativelinemat"));this._outlineMaterial=b;this._context.stage.add(3,this._outlineMaterial)}};u.prototype._isValidOutline=function(a){return k.isSome(a)&&a.size&&0<a.size&&k.isSome(a.color)};u.prototype.destroy=function(){a.prototype.destroy.call(this);k.isSome(this._material)&&(this._context.stage.remove(3,this._material.id),
this._material=null);k.isSome(this._outlineMaterial)&&(this._context.stage.remove(3,this._outlineMaterial.id),this._outlineMaterial=null)};u.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,u.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid;a=this._getVertexOpacityAndColor(a.renderingInfo,Uint8Array,255);var d=this.setGraphicElevationContext(b,new g.ElevationContext);this.ensureDrapedStatus("on-the-ground"===
d.mode);this.ensureMaterials();return this.draped?this._createAsOverlay(b,a,c):this._createAs3DShape(b,a,d,c)};u.prototype.layerOpacityChanged=function(){if(k.isSome(this._material)){var a=this._material.getParameters().color,b=k.get(this.symbolLayer,"material","color"),b=this._getCombinedOpacity(b);this._material.setParameterValues({color:[a[0],a[1],a[2],b],transparent:1>b||this.needsDrivenTransparentPass})}k.isSome(this._outlineMaterial)&&(a=this._outlineMaterial.getParameters().color,this._outlineMaterial.setParameterValues({color:[a[0],
a[1],a[2],this._getOutlineOpacity()]}));return!0};u.prototype.layerElevationInfoChanged=function(a,c,d){var e=this._elevationContext.mode;d=b.elevationModeChangeUpdateType(u.elevationModeChangeTypes,d,e);if(d!==b.SymbolUpdateType.UPDATE)return d;var f=b.needsElevationUpdates2D(e);return this.updateGraphics3DGraphicElevationInfo(a,c,function(){return f})};u.prototype.slicePlaneEnabledChanged=function(){k.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
k.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};u.prototype.physicalBasedRenderingChanged=function(){return!0};u.prototype.pixelRatioChanged=function(){return!0};u.prototype._createAs3DShape=function(a,c,d,e){var g=v.geometryAsPolygon(a.geometry);if(k.isNone(g))return null;K.renderData=v.geometryToRenderInfo(g,this._context.elevationProvider,this._context.renderCoordsHelper,d);K.idHint=e;K.color=c;c=K.renderData.position.length/
3;this._needsUV&&(K.uvMapSpace=new Float32Array(4*c),K.bound1=new Float64Array(3*c),K.bound2=new Float64Array(3*c),K.bound3=new Float64Array(3*c));K.outNum=0;K.outGeometries=[];K.outTransforms=[];K.outMaterials=[];this._createAs3DShapeFill(K);this._hasOutline&&this._createAs3DShapeOutline(K);this._logGeometryCreationWarnings(K.renderData,g.rings,"rings","FillSymbol3DLayer");if(0===K.outNum)return null;this._needsUV&&z.createMapSpaceUVCoords(x.BufferViewVec4f.fromTypedArray(K.uvMapSpace),x.BufferViewVec3f64.fromTypedArray(K.renderData.position),
this._context.layerView.view.renderCoordsHelper,x.BufferViewVec3f64.fromTypedArray(K.bound1),x.BufferViewVec3f64.fromTypedArray(K.bound2),x.BufferViewVec3f64.fromTypedArray(K.bound3));a=new A({geometries:K.outGeometries,materials:K.outMaterials,transformations:K.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:a.uid},idHint:e});a=new t(this,a,K.outGeometries,null,null,f.perVertexElevationAligner,d);a.alignedSampledElevation=K.renderData.sampledElevation;a.needsElevationUpdates=
b.needsElevationUpdates2D(d.mode);return a};u.prototype._createAs3DShapeFill=function(a){for(var b=0,d=a.renderData.polygons;b<d.length;b++){var e=d[b],f=e.position,g=e.mapPosition,l=e.holeIndices,p=e.index,e=e.count;if(k.isSome(this._context.clippingExtent)&&(m.empty(I),m.expandWithBuffer(I,g),!m.intersectsClippingArea(I,this._context.clippingExtent)))continue;l=c.earcut(g,l,3);0!==l.length&&(l=new Uint32Array(l),f=v.createColorGeometryData({indices:l,attributeData:{position:f,color:a.color,mapPosition:g,
uvMapSpace:this._needsUV?new Float32Array(a.uvMapSpace.buffer,4*p*a.uvMapSpace.BYTES_PER_ELEMENT,4*e):null,bound1:this._needsUV?new Float64Array(a.bound1.buffer,3*p*a.bound1.BYTES_PER_ELEMENT,3*e):null,bound2:this._needsUV?new Float64Array(a.bound2.buffer,3*p*a.bound2.BYTES_PER_ELEMENT,3*e):null,bound3:this._needsUV?new Float64Array(a.bound3.buffer,3*p*a.bound3.BYTES_PER_ELEMENT,3*e):null}}),f=new B(f,a.idHint),a.outGeometries.push(f),a.outMaterials.push(k.unwrap(this._material)),a.outTransforms.push(h.mat4f64.IDENTITY),
a.outNum++)}};u.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var b=a.renderData.outlines,c=this._outlineMaterial instanceof F,d=0;d<b.length;++d){var e=b[d],f=e.mapPosition,e=e.position;if(k.isSome(this._context.clippingExtent)&&(m.empty(I),m.expandWithBuffer(I,f),!m.intersectsClippingArea(I,this._context.clippingExtent)))continue;var f=q.createGeometryData({removeDuplicateStartEnd:c?0:1,attributeData:{position:e,mapPosition:f}}),g=f.vertexAttributes[E.VertexAttrConstants.POSITION];
g.data===e&&(g.data=new Float64Array(e));e=new B(f,a.idHint+"outline"+d);a.outGeometries.push(e);a.outMaterials.push(k.unwrap(this._outlineMaterial));a.outTransforms.push(h.mat4f64.IDENTITY);a.outNum++}};u.prototype._createAsOverlay=function(a,b,c){var d=v.geometryAsPolygon(a.geometry);if(k.isNone(d))return null;k.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;k.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);L.renderData=
v.geometryToRenderInfoDraped(d,this._context.overlaySR);L.idHint=c;L.color=b;b=L.renderData.position.length/3;this._needsUV&&(L.uvMapSpace=new Float32Array(4*b));L.outNum=0;L.outGeometries=[];L.outBoundingBox=m.empty();L.layerUid=this._context.layer.uid;L.graphicsUid=a.uid;this._createAsOverlayFill(L);this._hasOutline&&this._createAsOverlayOutline(L);this._logGeometryCreationWarnings(L.renderData,d.rings,"rings","FillSymbol3DLayer");if(0===L.outNum)return null;this._needsUV&&z.createMapSpaceUVCoordsDraped(x.BufferViewVec4f.fromTypedArray(L.uvMapSpace),
x.BufferViewVec3f64.fromTypedArray(L.renderData.position),this._context.overlaySR);return 0<L.outNum?new p(this,L.outGeometries,L.outBoundingBox):null};u.prototype._createAsOverlayFill=function(a){for(var b=0,d=a.renderData.polygons;b<d.length;b++){var e=d[b],f=e.position,g=e.holeIndices,h=e.index,e=e.count;m.empty(I);m.expandWithBuffer(I,f);m.intersectsClippingArea(I,this._context.clippingExtent)&&(g=c.earcut(f,g,3),0!==g.length&&(m.expand(a.outBoundingBox,I),g=new Uint32Array(g),f=v.createColorGeometryData({indices:g,
attributeData:{position:f,color:a.color,uvMapSpace:this._needsUV?new Float32Array(a.uvMapSpace.buffer,4*h*a.uvMapSpace.BYTES_PER_ELEMENT,4*e):null}}),f=new C(f),f.data.layerUid=a.layerUid,f.data.graphicUid=a.graphicsUid,f.material=k.unwrap(this._material),h=I,f.center=[.5*(h[0]+h[3]),.5*(h[1]+h[4]),0],f.bsRadius=.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1])),a.outGeometries.push(f),a.outNum++))}};u.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var b=a.renderData.outlines,
c=0;c<b.length;++c){var d=b[c].position;m.empty(I);m.expandWithBuffer(I,d);if(m.intersectsClippingArea(I,this._context.clippingExtent)){m.expand(a.outBoundingBox,I);d=q.createGeometryData({removeDuplicateStartEnd:this._outlineMaterial instanceof F?0:1,attributeData:{position:d}});d=new C(d);d.data.layerUid=a.layerUid;d.data.graphicUid=a.graphicsUid;d.material=k.unwrap(this._outlineMaterial);var e=I;d.center=[.5*(e[0]+e[3]),.5*(e[1]+e[4]),0];d.bsRadius=.5*Math.sqrt((e[3]-e[0])*(e[3]-e[0])+(e[4]-e[1])*
(e[4]-e[1]));a.outGeometries.push(d);a.outNum++}}};u.prototype._getOutlineOpacity=function(){var a=k.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(k.isSome(a)?a.a:0)};u.prototype._getOutlineColor=function(){var a=k.get(this.symbolLayer,"outline","color"),b=this._getOutlineOpacity();return r.mixinColorAndOpacity(k.isSome(a)?l.toUnitRGB(a):null,b)};Object.defineProperty(u.prototype,"test",{get:function(){var a=this;return{createAsOverlay:function(b,c,d){return a._createAsOverlay(b,
c,d)},createAs3DShape:function(b,c,d,e){return a._createAs3DShape(b,c,d,e)}}},enumerable:!1,configurable:!0});u.validGeometryTypes=["polyline","polygon","extent"];u.elevationModeChangeTypes={definedChanged:b.SymbolUpdateType.RECREATE,staysOnTheGround:b.SymbolUpdateType.NONE,onTheGroundChanged:b.SymbolUpdateType.RECREATE};return u}(u.default);a.Graphics3DPolygonFillSymbolLayer=n;var I=m.create(),K={idHint:null,renderData:null,color:null,uvMapSpace:null,bound1:null,bound2:null,bound3:null,outNum:0,
outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},L={idHint:null,renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};a.default=n})},"esri/views/3d/layers/support/patternUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec4f64 ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial".split(" "),
function(n,a,d,l,k,e,c){function h(a,b,d){if(l.isSome(a)){if("none"===a.style||"solid"===a.style)return"none"===a.style&&(b.color=k.vec4f64.fromValues(0,0,0,0),b.transparent=!0),new e(b,d.idHint+"_colormat");b.style=m(a.style);b.draped=d.isDraped;return new c(b,d.idHint+"_patternmat")}return new e(b,d.idHint+"_colormat")}function m(a){switch(a){case "horizontal":return 0;case "vertical":return 1;case "cross":return 2;case "forward-diagonal":return 3;case "backward-diagonal":return 4;case "diagonal-cross":return 5;
default:d.neverReached(a)}}Object.defineProperty(a,"__esModule",{value:!0});a.parsePatternStyle=a.createMaterialFromPattern=a.createMaterial=void 0;a.createMaterial=function(a,b,c){return h(a&&a.pattern||null,b,c)};a.createMaterialFromPattern=h;a.parsePatternStyle=m})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports tslib ../lib/GLMaterial ../lib/Material ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/MaterialUtil ../shaders/ColorMaterialTechnique".split(" "),
function(n,a,d,l,k,e,c,h,m){n=function(a){function g(c,d){d=a.call(this,d)||this;d.supportsEdges=!0;d.techniqueConfig=new m.ColorMaterialTechniqueConfiguration;d.params=h.copyParameters(c,b);return d}d.__extends(g,a);g.prototype.setParameterValues=function(a){c.updateParameters(this.params,a)&&this.parametersChanged()};g.prototype.getParameters=function(){return this.params};g.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.cullFace=this.params.cullFace;
this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;return this.techniqueConfig};g.prototype.getPassParameters=function(){return this.params};g.prototype.intersect=function(a,b,c,d,e,f,
g){h.intersectTriangleGeometry(a,b,d,e,f,void 0,g)};g.prototype.getGLMaterial=function(a){return 0===a.output||4===a.output?new f(a):void 0};g.prototype.createBufferWriter=function(){return new e.DefaultBufferWriter(e.PositionColorLayout)};return g}(k.Material);var f=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}d.__extends(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(m.ColorMaterialTechnique,this.material.getTechniqueConfig(this.output),
this.technique)};b.prototype.beginSlot=function(a){return 4===this.output?3===a:a===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)};b.prototype._updateOccludeeState=function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype.ensureParameters=function(a){0===this.output&&this._updateOccludeeState(a)};b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);
this.technique.bindPass(a,this.material.getPassParameters(),b)};b.prototype.getPipelineState=function(a,b){return b?this.technique.opaqueOccludeeState:this.technique.pipeline};return b}(l.GLMaterial),b={color:[1,1,1,1],transparent:!1,writeDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1};return n})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ./ColorMaterial.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){Object.defineProperty(a,"__esModule",{value:!0});a.ColorMaterialTechniqueConfiguration=a.ColorMaterialTechnique=void 0;h=function(a){function h(){return null!==a&&a.apply(this,arguments)||this}d.__extends(h,a);h.prototype.initializeProgram=function(a){var b=h.shader.get(),c=this.configuration,b=b.build({output:c.output,attributeColor:c.vertexColors,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:c.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});
return new p(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),f.Default3D)};h.prototype.bindPass=function(a,b,c){e.View.bindProjectionMatrix(this.program,c.camera.projectionMatrix);this.program.setUniform4fv("eColor",b.color);4===this.configuration.output&&k.OutputHighlight.bindOutputHighlight(a,this.program,c)};h.prototype.bindDraw=function(a){e.View.bindView(this.program,a);l.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};h.prototype.initializePipeline=function(){var a=
function(a){return 0!==a&&{face:1===a?1028:1029,mode:2305}},c=this.configuration,d=t.separateBlendingParams(770,1,771,771),e=0===c.output?c.transparent&&d:null,d=function(d){return t.makePipelineState({blending:e,polygonOffset:c.polygonOffset&&u,culling:a(c.cullFace),depthTest:b.depthCompareLess,depthWrite:c.writeDepth&&t.defaultDepthWriteParams,colorWrite:t.defaultColorWriteParams,stencilWrite:c.sceneHasOcludees?b.stencilWriteMaskOn:null,stencilTest:c.sceneHasOcludees?d?b.stencilToolMaskBaseParams:
b.stencilBaseAllZerosParams:null})};this._occludeeState=d(!0);return d(!1)};Object.defineProperty(h.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!1,configurable:!0});h.shader=new c.ReloadableShaderModule(g,function(){return new Promise(function(a,b){n(["./ColorMaterial.glsl"],a,b)})});return h}(h.ShaderTechnique);a.ColorMaterialTechnique=h;var u={factor:1,units:1};h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.cullFace=
0;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.vertexColors=!1;b.transparent=!1;b.polygonOffset=!1;b.writeDepth=!0;b.sceneHasOcludees=!1;return b}d.__extends(b,a);d.__decorate([m.parameter({count:7})],b.prototype,"output",void 0);d.__decorate([m.parameter({count:3})],b.prototype,"cullFace",void 0);d.__decorate([m.parameter()],b.prototype,"slicePlaneEnabled",void 0);d.__decorate([m.parameter()],b.prototype,"sliceHighlightDisabled",void 0);d.__decorate([m.parameter()],b.prototype,"vertexColors",
void 0);d.__decorate([m.parameter()],b.prototype,"transparent",void 0);d.__decorate([m.parameter()],b.prototype,"polygonOffset",void 0);d.__decorate([m.parameter()],b.prototype,"writeDepth",void 0);d.__decorate([m.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(m.ShaderTechniqueConfiguration);a.ColorMaterialTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/ColorMaterial.glsl":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var r=new f.ShaderBuilder;r.include(k.Transform,{linearDepth:!1});r.include(e.VertexColor,a);r.vertex.uniforms.add("proj","mat4").add("view","mat4");r.attributes.add("position","vec3");r.varyings.add("vpos","vec3");r.vertex.code.add(m.glsl(b||(b=d.__makeTemplateObject(["\n    void main(void) {\n      vpos \x3d position;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n    }\n  "],
["\n    void main(void) {\n      vpos \x3d position;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n    }\n  "]))));r.include(l.Slice,a);r.fragment.uniforms.add("eColor","vec4");4===a.output&&r.include(c.OutputHighlight);r.fragment.code.add(m.glsl(t||(t=d.__makeTemplateObject(["\n  void main() {\n    discardBySlice(vpos);\n    vec4 color \x3d ","\n\n    if (color.a \x3c ",") {\n      discard;\n    }\n\n    ","\n    ",";\n  }\n  "],["\n  void main() {\n    discardBySlice(vpos);\n    vec4 color \x3d ",
"\n\n    if (color.a \x3c ",") {\n      discard;\n    }\n\n    ","\n    ",";\n  }\n  "])),a.attributeColor?"vColor * eColor;":"eColor;",m.glsl.float(h.symbolAlphaCutoff),0===a.output?m.glsl(g||(g=d.__makeTemplateObject(["gl_FragColor \x3d highlightSlice(color, vpos);"],["gl_FragColor \x3d highlightSlice(color, vpos);"]))):"",4===a.output?m.glsl(p||(p=d.__makeTemplateObject(["outputHighlight();"],["outputHighlight();"]))):""));return r};var b,g,p,t})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("require exports tslib ../lib/GLMaterial ../lib/Material ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/MaterialUtil ../shaders/PatternTechnique".split(" "),
function(n,a,d,l,k,e,c,h,m){n=function(a){function g(c,d){d=a.call(this,d)||this;d.supportsEdges=!0;d.techniqueConfig=new m.PatternTechniqueConfiguration;d.params=h.copyParameters(c,b);return d}d.__extends(g,a);g.prototype.setParameterValues=function(a){c.updateParameters(this.params,a)&&this.parametersChanged()};g.prototype.getParameters=function(){return this.params};g.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.cullFace=this.params.cullFace;this.techniqueConfig.vertexColors=
this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.style=this.params.style;this.techniqueConfig.patternSpacing=this.params.patternSpacing;this.techniqueConfig.lineWidth=this.params.lineWidth;this.techniqueConfig.draped=this.params.draped;return this.techniqueConfig};g.prototype.getPassParameters=function(){return this.params};
g.prototype.intersect=function(a,b,c,d,e,f,g){h.intersectTriangleGeometry(a,b,d,e,f,void 0,g)};g.prototype.getGLMaterial=function(a){return 0===a.output||4===a.output?new f(a):void 0};g.prototype.createBufferWriter=function(){return new e.DefaultBufferWriter(e.PositionColorMapSpaceUVBoundsLayout)};return g}(k.Material);var f=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}d.__extends(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(m.PatternTechnique,
this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=function(a){return 4===this.output?3===a:a===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)};b.prototype._updateOccludeeState=function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype.ensureParameters=function(a){0===this.output&&this._updateOccludeeState(a)};
b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters(),b)};b.prototype.getPipelineState=function(a,b){return b?this.technique.opaqueOccludeeState:this.technique.pipeline};return b}(l.GLMaterial),b={color:[1,1,1,1],writeDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,style:2,patternSpacing:10,lineWidth:1,draped:!0};return n})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ./Pattern.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){Object.defineProperty(a,"__esModule",{value:!0});a.PatternTechniqueConfiguration=a.PatternTechnique=void 0;h=function(a){function h(){return null!==a&&a.apply(this,arguments)||this}d.__extends(h,a);h.prototype.initializeProgram=function(a){var b=h.shader.get(),c=this.configuration,b=b.build({output:c.output,attributeColor:c.vertexColors,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:c.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,style:c.style,
patternSpacing:c.patternSpacing,lineWidth:c.lineWidth,draped:c.draped});return new p(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),f.Default3D)};h.prototype.bindPass=function(a,b,c){e.View.bindProjectionMatrix(this.program,c.camera.projectionMatrix);this.program.setUniform4fv("matColor",b.color);this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/c.screenToWorldRatioGlobalWM),this.program.setUniform1f("texelSize",1/c.camera.pixelRatio)):(this.program.setUniform1f("worldToScreenPerDistanceRatio",
1/c.camera.perScreenPixelRatio),this.program.setUniform3fv("viewForward",c.camera.viewForward));4===this.configuration.output&&k.OutputHighlight.bindOutputHighlight(a,this.program,c)};h.prototype.bindDraw=function(a){e.View.bindView(this.program,a);e.View.bindCamPosition(this.program,a.origin,a.camera.viewInverseTransposeMatrix);l.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};h.prototype.initializePipeline=function(){var a=function(a){return 0!==a&&{face:1===a?1028:1029,mode:2305}},
c=this.configuration,d=t.separateBlendingParams(770,1,771,771),e=0===c.output?c.transparent&&d:null,d=function(d){return t.makePipelineState({blending:e,polygonOffset:c.polygonOffset&&u,culling:a(c.cullFace),depthTest:b.depthCompareLess,depthWrite:c.writeDepth&&t.defaultDepthWriteParams,colorWrite:t.defaultColorWriteParams,stencilWrite:c.sceneHasOcludees?b.stencilWriteMaskOn:null,stencilTest:c.sceneHasOcludees?d?b.stencilToolMaskBaseParams:b.stencilBaseAllZerosParams:null})};this._occludeeState=d(!0);
return d(!1)};Object.defineProperty(h.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!1,configurable:!0});h.shader=new c.ReloadableShaderModule(g,function(){return new Promise(function(a,b){n(["./Pattern.glsl"],a,b)})});return h}(h.ShaderTechnique);a.PatternTechnique=h;var u={factor:1,units:1};h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.cullFace=0;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.vertexColors=!1;
b.transparent=!0;b.polygonOffset=!1;b.writeDepth=!0;b.sceneHasOcludees=!1;return b}d.__extends(b,a);d.__decorate([m.parameter({count:7})],b.prototype,"output",void 0);d.__decorate([m.parameter({count:3})],b.prototype,"cullFace",void 0);d.__decorate([m.parameter()],b.prototype,"slicePlaneEnabled",void 0);d.__decorate([m.parameter()],b.prototype,"sliceHighlightDisabled",void 0);d.__decorate([m.parameter()],b.prototype,"vertexColors",void 0);d.__decorate([m.parameter()],b.prototype,"transparent",void 0);
d.__decorate([m.parameter()],b.prototype,"polygonOffset",void 0);d.__decorate([m.parameter()],b.prototype,"writeDepth",void 0);d.__decorate([m.parameter()],b.prototype,"sceneHasOcludees",void 0);d.__decorate([m.parameter({count:6})],b.prototype,"style",void 0);d.__decorate([m.parameter()],b.prototype,"patternSpacing",void 0);d.__decorate([m.parameter()],b.prototype,"lineWidth",void 0);d.__decorate([m.parameter()],b.prototype,"draped",void 0);return b}(m.ShaderTechniqueConfiguration);a.PatternTechniqueConfiguration=
h})},"esri/views/3d/webgl-engine/shaders/Pattern.glsl":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(n,a,d,l,k,e,c,h,m,f){function b(a){function b(b){return a.draped?m.glsl(G||(G=d.__makeTemplateObject(["coverage(vuv.",
", texelSize)"],["coverage(vuv.",", texelSize)"])),b):m.glsl(F||(F=d.__makeTemplateObject(["sample(vuv.",")"],["sample(vuv.",")"])),b)}switch(a.style){case 3:case 0:return b("y");case 4:case 1:return b("x");case 5:case 2:return m.glsl(H||(H=d.__makeTemplateObject(["\n        1.0 - (1.0 - ",") * (1.0 - ",")\n      "],["\n        1.0 - (1.0 - ",") * (1.0 - ",")\n      "])),b("x"),b("y"));default:return"0.0"}}Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var n=new f.ShaderBuilder;
a.draped||n.extensions.add("GL_OES_standard_derivatives");n.include(k.Transform,{linearDepth:!1});n.include(e.VertexColor,a);n.vertex.uniforms.add("proj","mat4");n.vertex.uniforms.add("view","mat4");a.draped?n.vertex.uniforms.add("worldToScreenRatio","float"):(n.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),n.vertex.uniforms.add("camPos","vec3"),n.vertex.uniforms.add("viewForward","vec3"),n.attributes.add("bound1","vec3"),n.attributes.add("bound2","vec3"),n.attributes.add("bound3",
"vec3"));n.attributes.add("position","vec3");n.attributes.add("uvMapSpace","vec4");n.varyings.add("vpos","vec3");n.varyings.add("vuv","vec2");var F=3===a.style||4===a.style||5===a.style;F&&n.vertex.code.add(m.glsl(g||(g=d.__makeTemplateObject(["\n      const mat2 rotate45 \x3d mat2(",", ",",\n                                 ",", ",");\n    "],["\n      const mat2 rotate45 \x3d mat2(",", ",",\n                                 ",", ",");\n    "])),m.glsl.float(.70710678118),m.glsl.float(-.70710678118),
m.glsl.float(.70710678118),m.glsl.float(.70710678118)));a.draped||(n.vertex.code.add(m.glsl(p||(p=d.__makeTemplateObject(["\n      vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {\n        float projectedLength \x3d dot(halfVector, point - center) / dot(halfVector, halfVector);\n        return center + halfVector * clamp(projectedLength, -1.0, 1.0);\n      }\n    "],["\n      vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {\n        float projectedLength \x3d dot(halfVector, point - center) / dot(halfVector, halfVector);\n        return center + halfVector * clamp(projectedLength, -1.0, 1.0);\n      }\n    "])))),
n.vertex.code.add(m.glsl(t||(t=d.__makeTemplateObject(["\n      vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {\n        float d \x3d dot(planeNormal, planePoint);\n        float t \x3d (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);\n\n        return rayOrigin + t * rayDir;\n      }\n    "],["\n      vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {\n        float d \x3d dot(planeNormal, planePoint);\n        float t \x3d (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);\n\n        return rayOrigin + t * rayDir;\n      }\n    "])))),
n.vertex.code.add(m.glsl(u||(u=d.__makeTemplateObject(["\n      float boundingRectDistanceToCamera() {\n        vec3 halfU \x3d (bound2 - bound1) * 0.5;\n        vec3 halfV \x3d (bound3 - bound1) * 0.5;\n        vec3 center \x3d bound1 + halfU + halfV;\n        vec3 n \x3d normalize(cross(halfU, halfV));\n\n        vec3 viewDir \x3d viewForward;\n\n        float viewAngle \x3d dot(viewDir, n);\n        float minViewAngle \x3d ",";\n\n        if (abs(viewAngle) \x3c minViewAngle) {\n          // view direction is (almost) parallel to plane -\x3e clamp it to min angle\n          float normalComponent \x3d sign(viewAngle) * minViewAngle - viewAngle;\n          viewDir \x3d normalize(viewDir + normalComponent * n);\n        }\n\n        // intersect view direction with infinite plane that contains bounding rect\n        vec3 planeProjected \x3d intersectRayPlane(viewDir, camPos, n, center);\n\n        // clip to bounds by projecting to u and v line segments individually\n        vec3 uProjected \x3d projectPointToLineSegment(center, halfU, planeProjected);\n        vec3 vProjected \x3d projectPointToLineSegment(center, halfV, planeProjected);\n\n        // use to calculate the closest point to camera on bounding rect\n        vec3 closestPoint \x3d uProjected + vProjected - center;\n\n        return length(closestPoint - camPos);\n      }\n    "],
["\n      float boundingRectDistanceToCamera() {\n        vec3 halfU \x3d (bound2 - bound1) * 0.5;\n        vec3 halfV \x3d (bound3 - bound1) * 0.5;\n        vec3 center \x3d bound1 + halfU + halfV;\n        vec3 n \x3d normalize(cross(halfU, halfV));\n\n        vec3 viewDir \x3d viewForward;\n\n        float viewAngle \x3d dot(viewDir, n);\n        float minViewAngle \x3d ",";\n\n        if (abs(viewAngle) \x3c minViewAngle) {\n          // view direction is (almost) parallel to plane -\x3e clamp it to min angle\n          float normalComponent \x3d sign(viewAngle) * minViewAngle - viewAngle;\n          viewDir \x3d normalize(viewDir + normalComponent * n);\n        }\n\n        // intersect view direction with infinite plane that contains bounding rect\n        vec3 planeProjected \x3d intersectRayPlane(viewDir, camPos, n, center);\n\n        // clip to bounds by projecting to u and v line segments individually\n        vec3 uProjected \x3d projectPointToLineSegment(center, halfU, planeProjected);\n        vec3 vProjected \x3d projectPointToLineSegment(center, halfV, planeProjected);\n\n        // use to calculate the closest point to camera on bounding rect\n        vec3 closestPoint \x3d uProjected + vProjected - center;\n\n        return length(closestPoint - camPos);\n      }\n    "])),
m.glsl.float(.08715574274))));n.vertex.code.add(m.glsl(v||(v=d.__makeTemplateObject(["\n    vec2 scaledUV() {\n      vec2 uv \x3d uvMapSpace.xy ",";\n      vec2 uvCellOrigin \x3d uvMapSpace.zw ",";\n\n      ","\n\n      vec2 uvOffset \x3d mod(uvCellOrigin * ratio, ",");\n      return uvOffset + (uv * ratio);\n    }\n  "],["\n    vec2 scaledUV() {\n      vec2 uv \x3d uvMapSpace.xy ",";\n      vec2 uvCellOrigin \x3d uvMapSpace.zw ",";\n\n      ","\n\n      vec2 uvOffset \x3d mod(uvCellOrigin * ratio, ",
");\n      return uvOffset + (uv * ratio);\n    }\n  "])),F?" * rotate45":"",F?" * rotate45":"",a.draped?m.glsl(r||(r=d.__makeTemplateObject(["\n            float ratio \x3d worldToScreenRatio;\n          "],["\n            float ratio \x3d worldToScreenRatio;\n          "]))):m.glsl(q||(q=d.__makeTemplateObject(["\n            float distanceToCamera \x3d boundingRectDistanceToCamera();\n            float ratio \x3d worldToScreenPerDistanceRatio / distanceToCamera;\n\n            // Logarithmically discretize ratio to avoid jittering\n            float step \x3d 0.1;\n            ratio \x3d log(ratio);\n            ratio \x3d ceil(ratio / step) * step;\n            ratio \x3d exp(ratio);\n          "],
["\n            float distanceToCamera \x3d boundingRectDistanceToCamera();\n            float ratio \x3d worldToScreenPerDistanceRatio / distanceToCamera;\n\n            // Logarithmically discretize ratio to avoid jittering\n            float step \x3d 0.1;\n            ratio \x3d log(ratio);\n            ratio \x3d ceil(ratio / step) * step;\n            ratio \x3d exp(ratio);\n          "]))),m.glsl.float(a.patternSpacing)));n.vertex.code.add(m.glsl(w||(w=d.__makeTemplateObject(["\n    void main(void) {\n      vuv \x3d scaledUV();\n      vpos \x3d position;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n    }\n  "],
["\n    void main(void) {\n      vuv \x3d scaledUV();\n      vpos \x3d position;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n    }\n  "]))));n.include(l.Slice,a);n.fragment.uniforms.add("matColor","vec4");a.draped&&n.fragment.uniforms.add("texelSize","float");4===a.output&&n.include(c.OutputHighlight);0===a.output&&(n.fragment.code.add(m.glsl(z||(z=d.__makeTemplateObject(["\n      const float lineWidth \x3d ",";\n      const float spacing \x3d ",
";\n      const float spacingINV \x3d ",";\n\n      float coverage(float p, float txlSize) {\n        p \x3d mod(p, spacing);\n\n        float halfTxlSize \x3d txlSize / 2.0;\n\n        float start \x3d p - halfTxlSize;\n        float end \x3d p + halfTxlSize;\n\n        float coverage \x3d (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;\n        coverage -\x3d min(lineWidth, mod(start, spacing));\n        coverage -\x3d max(lineWidth - mod(end, spacing), 0.0);\n\n        return coverage / txlSize;\n      }\n    "],
["\n      const float lineWidth \x3d ",";\n      const float spacing \x3d ",";\n      const float spacingINV \x3d ",";\n\n      float coverage(float p, float txlSize) {\n        p \x3d mod(p, spacing);\n\n        float halfTxlSize \x3d txlSize / 2.0;\n\n        float start \x3d p - halfTxlSize;\n        float end \x3d p + halfTxlSize;\n\n        float coverage \x3d (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;\n        coverage -\x3d min(lineWidth, mod(start, spacing));\n        coverage -\x3d max(lineWidth - mod(end, spacing), 0.0);\n\n        return coverage / txlSize;\n      }\n    "])),
m.glsl.float(a.lineWidth),m.glsl.float(a.patternSpacing),m.glsl.float(1/a.patternSpacing))),a.draped||n.fragment.code.add(m.glsl(x||(x=d.__makeTemplateObject(["\n        const int maxSamples \x3d 5;\n\n        float sample(float p) {\n          vec2 dxdy \x3d abs(vec2(dFdx(p), dFdy(p)));\n          float fwidth \x3d dxdy.x + dxdy.y;\n\n          ivec2 samples \x3d 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));\n          vec2 invSamples \x3d 1.0 / vec2(samples);\n\n          float accumulator \x3d 0.0;\n\n          for (int j \x3d 0; j \x3c maxSamples; j++) {\n            if(j \x3e\x3d samples.y) {\n              break;\n            }\n\n            for (int i \x3d 0; i \x3c maxSamples; i++) {\n              if(i \x3e\x3d samples.x) {\n                break;\n              }\n\n              vec2 step \x3d vec2(i,j) * invSamples - 0.5;\n              accumulator +\x3d coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);\n            }\n          }\n\n          accumulator /\x3d float(samples.x * samples.y);\n          return accumulator;\n        }\n      "],
["\n        const int maxSamples \x3d 5;\n\n        float sample(float p) {\n          vec2 dxdy \x3d abs(vec2(dFdx(p), dFdy(p)));\n          float fwidth \x3d dxdy.x + dxdy.y;\n\n          ivec2 samples \x3d 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));\n          vec2 invSamples \x3d 1.0 / vec2(samples);\n\n          float accumulator \x3d 0.0;\n\n          for (int j \x3d 0; j \x3c maxSamples; j++) {\n            if(j \x3e\x3d samples.y) {\n              break;\n            }\n\n            for (int i \x3d 0; i \x3c maxSamples; i++) {\n              if(i \x3e\x3d samples.x) {\n                break;\n              }\n\n              vec2 step \x3d vec2(i,j) * invSamples - 0.5;\n              accumulator +\x3d coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);\n            }\n          }\n\n          accumulator /\x3d float(samples.x * samples.y);\n          return accumulator;\n        }\n      "])))));
n.fragment.code.add(m.glsl(E||(E=d.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n      vec4 color \x3d ","\n      color \x3d highlightSlice(color, vpos);\n\n      ","\n\n      if (color.a \x3c ",") {\n        discard;\n      }\n\n      ","\n      ","\n    }\n  "],["\n    void main() {\n      discardBySlice(vpos);\n      vec4 color \x3d ","\n      color \x3d highlightSlice(color, vpos);\n\n      ","\n\n      if (color.a \x3c ",") {\n        discard;\n      }\n\n      ","\n      ",
"\n    }\n  "])),a.attributeColor?"vColor * matColor;":"matColor;",0===a.output?m.glsl(B||(B=d.__makeTemplateObject(["color.a *\x3d ",";"],["color.a *\x3d ",";"])),b(a)):"",m.glsl.float(h.symbolAlphaCutoff),0===a.output?m.glsl(A||(A=d.__makeTemplateObject(["gl_FragColor \x3d color;"],["gl_FragColor \x3d color;"]))):"",4===a.output?m.glsl(C||(C=d.__makeTemplateObject(["outputHighlight();"],["outputHighlight();"]))):""));return n};var g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports tslib ../../../../core/Error ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B){function A(a,b,c){a&&a.forEach(function(a){var d=b(a);k.isSome(d)&&c(d,a.graphic)})}Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DTextSymbolLayer=void 0;var C=[0,0,1];n=function(a){function t(b,c,d,f){b=a.call(this,b,c,d,f)||this;b._geometryDataPool=new e(v.GeometryData,function(a,b,c){var d=b.translation;c=k.isSome(c)?[c.displayWidth,c.displayHeight]:[0,0];b=b.centerOffset;0===a.indexCount?w.createPointGeometry(C,d,null,c,b,[0,
0],null,a):w.updatePointGeometry(null,d,null,c,b,null,null,a)});b._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};b.ensureDrapedStatus(!1);return b}d.__extends(t,a);t.prototype.doLoad=function(){return d.__awaiter(this,void 0,void 0,function(){var a;return d.__generator(this,function(b){if(!this._drivenProperties.size&&(a=u.validateSymbolLayerSize(this.symbolLayer.size)))throw new l("graphics3dtextsymbollayer:invalid-size",a);this._createTextRenderParameters();return[2]})})};
t.prototype._createTextRenderParameters=function(){this._textRenderParameters=z.default.fromSymbol(this.symbolLayer,this._context.layerView.view.pixelRatio)};t.prototype.destroy=function(){a.prototype.destroy.call(this);this._geometryDataPool.destroy()};t.prototype.createGraphics3DGraphic=function(a){a=a.graphic;var b=r.placePointOnGeometry(a.geometry);if(k.isNone(b))return this.logger.warn("unsupported geometry type for text symbol: "+a.geometry.type),null;var c=this.symbolLayer.text;if(!c)return null;
var d=m.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(a,b,c,d)};t.prototype.onRemoveGraphic=function(a){this._geometryDataPool.release(a.stageObject.geometries[0].data)};t.prototype.createLabel=function(a,b,c,d){a=a.graphic;var e=r.placePointOnGeometry(a.geometry);if(k.isNone(e))return this.logger.warn("unsupported geometry type for label: "+a.geometry.type),null;var f=b.text;return!f||/^\s+$/.test(f)?null:this._createAs3DShape(a,
e,f,b,b,c,d)};t.prototype.setGraphicElevationContext=function(b,c,d){void 0===d&&(d=0);b=a.prototype.setGraphicElevationContext.call(this,b,c);b.addOffsetRenderUnits(d);return b};t.prototype.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};t.prototype.layerElevationInfoChanged=function(a,c){var d=this;A(a,c,function(a,b){d.updateGraphicElevationContext(b,a)});return b.SymbolUpdateType.UPDATE};t.prototype.slicePlaneEnabledChanged=
function(a,b){var c=this;A(a,b,function(a){var b=0;for(a=a.stageObject.geometryRecords;b<a.length;b++)a[b].material.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});return!0};t.prototype.physicalBasedRenderingChanged=function(){return!0};t.prototype.pixelRatioChanged=function(){return!1};t.prototype.updateGraphicElevationContext=function(a,c){this.setGraphicElevationContext(a,c.elevationContext,c.metadata.elevationOffset);c.needsElevationUpdates=b.needsElevationUpdates2D(c.elevationContext.mode)||
"absolute-height"===c.elevationContext.mode};t.prototype._defaultElevationInfoNoZ=function(){return E};t.prototype._createAs3DShape=function(a,d,e,m,l,t,v){void 0===l&&(l=G);var w=this.setGraphicElevationContext(a,new g.ElevationContext,l.elevationOffset),z=this._context.layer.id+"_label_"+a.uid,A="polyline"===k.get(a.geometry,"type"),n=a.uid;a=this._context.stage.renderView.renderingContext;var C=u.namedAnchorToHUDMaterialAnchorPos[l.anchor in u.namedAnchorToHUDMaterialAnchorPos?l.anchor:"center"];
a=k.isNone(v)?new x(a,e,this._textRenderParameters,z):null;C={occlusionTest:!0,screenOffset:l.screenOffset,anchorPos:C,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:l.centerOffsetUnits,debugDrawBorder:l.debugDrawBorder,drawInSecondSlot:!0};k.isSome(a)&&(C.textureId=a.id,C.texCoordScale=a.texcoordScale);k.isSome(v)&&(C.textureId=v.textureId);if(k.isSome(m)&&k.isSome(m.verticalOffset)){m=m.verticalOffset;v=m.minWorldLength;var F=m.maxWorldLength;C.verticalOffset={screenLength:c.pt2px(m.screenLength),
minWorldLength:v||0,maxWorldLength:null!=F?F:Infinity}}this._context.screenSizePerspectiveEnabled&&(m=this._context.sharedResources,v=m.screenSizePerspectiveSettings,C.screenSizePerspective=m.screenSizePerspectiveSettingsLabels.overridePadding(this._textRenderParameters.haloSize),C.screenSizePerspectiveAlignment=v);A&&(C.shaderPolygonOffset=1E-4);C.slicePlaneEnabled=this._context.slicePlaneEnabled;A=null;k.isSome(t)?(m=JSON.stringify(C),A=t.getMaterial(m),null==A&&(A=new B.default(C,z),t.addMaterial(m,
A))):A=new B.default(C,z);A=[A];C=this._geometryDataPool.acquire(l,a);C=[new q(C,z)];z=r.createStageObjectForHUD(this._context,d,C,A,null,null,w,z,this._context.layer.uid,n);if(null===z)return null;n=f.perObjectElevationAligner;t=new p(this,z.object,C,k.isNone(t)?A:null,k.isSome(a)?[a]:null,n,w);t.alignedSampledElevation=z.sampledElevation;t.needsElevationUpdates=b.needsElevationUpdates2D(w.mode)||"absolute-height"===w.mode;var w=k.isSome(a)?a:l,E=w.displayWidth,H=w.displayHeight;t.getScreenSize=
function(a){void 0===a&&(a=h.vec2f64.create());a[0]=E;a[1]=H;return a};t.metadata={labelText:e,elevationOffset:l.elevationOffset};r.extendPointGraphicElevationContext(t,d,this._context.elevationProvider);return t};return t}(t.default);a.Graphics3DTextSymbolLayer=n;var E={mode:"relative-to-ground",offset:0},G={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};
a.default=n})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("require exports ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.TextRenderParameters=void 0;n=function(){function a(a){this.definition=a;this.key=JSON.stringify(a);this.haloSize=Math.round(a.halo.size);this.fillStyle=this.colorToRGBA(a.color);this.haloStyle=
this.colorToRGB(a.halo.color)}a.prototype.colorToRGB=function(a){return"rgb("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"};a.prototype.colorToRGBA=function(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"};a.fromSymbol=function(c,m){void 0===m&&(m=1);var f=l.get(c,"material","color"),f=l.isSome(f)?d.toUnitRGBA(f):e.ZEROS,b=c.halo,g=null!=c.size?k.pt2px(c.size):12;c={family:c.font&&c.font.family?c.font.family:"sans-serif",weight:c.font&&
c.font.weight?c.font.weight:"normal",style:c.font&&c.font.style?c.font.style:"normal"};b=l.isSome(b)&&l.isSome(b.color)&&0<b.size?{size:k.pt2px(b.size),color:d.toUnitRGBA(b.color)}:{size:0,color:e.ZEROS};return new a({size:g,color:f,font:c,halo:b,pixelRatio:m})};return a}();a.TextRenderParameters=n;a.default=n})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ./TextRenderer ./Texture ../../../webgl/Texture ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(n,a,d,l,k,e,c,h,m){var f={canvas:null};return function(){function a(a,b,c,f){this._idHint=f;this._glTexture=null;this.events=new d;this._requiresPowerOfTwo=!m.default(a.gl);this._renderer=new e.default(b,c)}Object.defineProperty(a.prototype,"id",{get:function(){null==this._id&&(this._id=c.idGen.gen(this._idHint));return this._id},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._renderer.renderedWidth},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"height",{get:function(){return this._renderer.renderedHeight},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"textureWidth",{get:function(){var a=this.width;return this._requiresPowerOfTwo?l.nextHighestPowerOfTwo(a):a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"textureHeight",{get:function(){var a=this.height;return this._requiresPowerOfTwo?l.nextHighestPowerOfTwo(a):a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"displayWidth",{get:function(){return this._renderer.displayWidth},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"displayHeight",{get:function(){return this._renderer.displayHeight},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"texcoordScale",{get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"requiresFrameUpdates",{get:function(){return!1},enumerable:!1,configurable:!0});a.prototype.createDescriptor=
function(a){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:a.parameters.maxMaxAnisotropy}};a.prototype.load=function(a){if(k.isSome(this._glTexture))return this._glTexture;var b=e.getTextHelperCanvas(f,this.textureWidth,this.textureHeight),c=b.getContext("2d");c.save();this._renderer.render(c,0,this.textureHeight-this._renderer.renderedHeight);this._glTexture=new h(a,this.createDescriptor(a),b);c.restore();
return this._glTexture};a.prototype.unload=function(){k.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);this.events.emit("unloaded")};return a}()})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["require","exports","../../../../core/maybe","./TextRenderParameters"],function(n,a,d,l){function k(a,c,d){a.canvas||(a.canvas=document.createElement("canvas"));a.canvas.width=c;a.canvas.height=d;return a.canvas}Object.defineProperty(a,"__esModule",{value:!0});
a.getTextHelperCanvas=a.TextRenderer=void 0;n=function(){function a(a,b,c){void 0===c&&(c=2048);this.text=a;this.maxSize=c;this._displayWidth=this._renderPixelRatio=null;this.parameters=b instanceof l.default?b:new l.default(b);this.key=this.parameters.key+"--"+a;this.textLines=a.split(/\r?\n/);this.lineHeight=this.computeLineHeight()}Object.defineProperty(a.prototype,"displayWidth",{get:function(){d.isNone(this._displayWidth)&&(this._displayWidth=this.computeTextWidth());return this._displayWidth},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"displayHeight",{get:function(){return this.lineHeight*this.textLines.length},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"renderedWidth",{get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"renderedHeight",{get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"renderedLineHeight",{get:function(){return Math.round(this.lineHeight*this.renderPixelRatio)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"renderedFontSize",{get:function(){return this.parameters.definition.size*this.renderPixelRatio},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"renderedHaloSize",{get:function(){return this.parameters.haloSize*this.renderPixelRatio},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"renderPixelRatio",{get:function(){if(d.isNone(this._renderPixelRatio)){var a=
this.parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(a,Math.min(this.maxSize/(this.displayWidth*a),this.maxSize/(this.displayHeight*a))):a}return this._renderPixelRatio},enumerable:!1,configurable:!0});a.prototype.render=function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=0);var d=this.renderedLineHeight,f=this.renderedHaloSize,g=a.textAlign,h=this.renderedWidth,g=("center"===g?.5*h:"right"===g?h:0)+f,h=f+e;a.save();0<f&&this.renderHalo(a,g,h,b,c);this.setFontProperties(a,
this.renderedFontSize);c+=h;b+=g;f=0;for(g=this.textLines;f<g.length;f++)h=g[f],a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",a.fillText(h,b,c),a.globalCompositeOperation="source-over",a.fillStyle=this.parameters.fillStyle,a.fillText(h,b,c),c+=d;a.restore()};a.prototype.renderHalo=function(a,b,c,d,e){var g=this.renderedWidth,h=this.renderedHeight,l=k(m,Math.max(g,f),Math.max(h,f)),p=l.getContext("2d");p.clearRect(0,0,g,h);this.setFontProperties(p,this.renderedFontSize);p.fillStyle=
this.parameters.haloStyle;p.strokeStyle=this.parameters.haloStyle;var r=3>this.renderedHaloSize;p.lineJoin=r?"miter":"round";r?this.renderHaloEmulated(p,b,c):this.renderHaloNative(p,b,c);a.globalAlpha=this.parameters.definition.halo.color[3];a.drawImage(l,0,0,g,h,d,e,g,h);a.globalAlpha=1};a.prototype.renderHaloEmulated=function(a,b,d){for(var e=this.renderedLineHeight,f=this.renderedHaloSize,g=0,h=this.textLines;g<h.length;g++){for(var m=h[g],k=0,l=c;k<l.length;k++){var p=l[k];a.fillText(m,b+f*p[0],
d+f*p[1])}d+=e}};a.prototype.renderHaloNative=function(a,b,c){for(var d=this.renderedLineHeight,e=this.renderedHaloSize,f=0,g=this.textLines;f<g.length;f++){for(var h=g[f],m=2*e,k=0;5>k;k++)a.lineWidth=(.6+.1*k)*m,a.strokeText(h,b,c);c+=d}};a.prototype.setFontProperties=function(a,b){var c=this.parameters.definition.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family+", sans-serif";a.textAlign="left";a.textBaseline="top"};a.prototype.computeTextWidth=function(){var a=k(m,f,f).getContext("2d");this.setFontProperties(a,
this.parameters.definition.size);for(var b=0,c=0,d=this.textLines;c<d.length;c++)b=Math.max(b,a.measureText(d[c]).width);c=this.parameters.definition.font;if("italic"===c.style||"oblique"===c.style||"string"===typeof c.weight&&("bold"===c.weight||"bolder"===c.weight)||"number"===typeof c.weight&&600<c.weight)b+=.3*a.measureText("A").width;b+=2*this.parameters.haloSize;return Math.round(b)};a.prototype.computeLineHeight=function(){return Math.ceil(1.275*this.parameters.definition.size+2*this.parameters.haloSize)+
e};return a}();a.TextRenderer=n;for(var e=1,c=[],h=0;360>h;h+=22.5)c.push([Math.cos(Math.PI*h/180),Math.sin(Math.PI*h/180)]);a.getTextHelperCanvas=k;var m={canvas:null},f=512;a.default=n})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/math/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G){Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DWaterSymbolLayer=void 0;n=function(a){function z(b,c,d,e){return a.call(this,b,c,d,e)||this}d.__extends(z,a);z.prototype.doLoad=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(a){return[2]})})};z.prototype.destroy=function(){a.prototype.destroy.call(this);k.isSome(this._material)&&(this._context.stage.remove(3,this._material.id),
this._material=null)};z.prototype.createGraphics3DGraphic=function(a){a=a.graphic;if(!this._validateGeometryType(a.geometry,z.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(a.geometry))return null;var b="graphic"+a.uid,c=this.setGraphicElevationContext(a,new q.ElevationContext);this.ensureDrapedStatus("on-the-ground"===c.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(a,b):this._createAs3DShape(a,c,b,a.uid)};z.prototype.ensureMaterial=function(){if(!k.isSome(this._material)){var a=
d.__assign({},G.defaultWaterMaterialParameters),b=this.symbolLayer.color;k.isSome(b)&&(a.color=l.toUnitRGBA(b));b=this._getCombinedOpacity(b,{hasIntrinsicColor:!0});a.color=[a.color[0],a.color[1],a.color[2],b];a.transparent=1>b||this.needsDrivenTransparentPass;a.waveDirection=k.isSome(this.symbolLayer.waveDirection)?z.headingVectorFromAngle(this.symbolLayer.waveDirection):f.vec2f64.fromValues(0,0);b=G.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];a.waveStrength=b.waveStrength;
a.waveTextureRepeat=b.textureRepeat;a.waveVelocity=b.waveVelocity;a.flowStrength=b.perturbationStrength;a.slicePlaneEnabled=this._context.slicePlaneEnabled;a.isDraped=this.draped;this._material=new E.WaterMaterial(a,"water");this._context.stage.add(3,this._material)}};z.prototype.layerOpacityChanged=function(){if(k.isNone(this._material))return!0;var a=this._material.getParameters().color,b=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameterValues({color:[a[0],
a[1],a[2],b],transparent:1>b||this.needsDrivenTransparentPass});return!0};z.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=r.elevationModeChangeUpdateType(z.elevationModeChangeTypes,c,d);if(c!==r.SymbolUpdateType.UPDATE)return c;var e=r.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};z.prototype.slicePlaneEnabledChanged=function(){k.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};z.prototype.physicalBasedRenderingChanged=function(){return!0};z.prototype.pixelRatioChanged=function(){return!0};z.prototype._createAs3DShape=function(a,b,c,d){a=x.geometryAsPolygon(a.geometry);if(k.isNone(a))return null;K.renderData=x.geometryToRenderInfo(a,this._context.elevationProvider,this._context.renderCoordsHelper,b);var e=K.renderData.position.length/3;K.uvCoords=new Float64Array(2*e);K.idHint=c;K.outNum=0;K.outGeometries=[];K.outTransforms=[];K.outMaterials=[];this._create3DShapeGeometries(K);
this._logGeometryCreationWarnings(K.renderData,a.rings,"rings","WaterSymbol3DLayer");if(0===K.outNum)return null;this._createUVCoordsFromVertices(K.uvCoords,K.renderData.mapPosition,e,this._context.elevationProvider.spatialReference);c=new A({geometries:K.outGeometries,materials:K.outMaterials,transformations:K.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:d},idHint:c});c=new w(this,c,K.outGeometries,null,null,u.perVertexElevationAligner,b);c.alignedSampledElevation=
K.renderData.sampledElevation;c.needsElevationUpdates=r.needsElevationUpdates2D(b.mode);return c};z.prototype._createUVCoordsFromVertices=function(a,c,d,f){f=e.getMetersPerUnitForSR(f);t.empty(H);for(var g=0;g<d;g++)m.vec2.set(J,c[3*g+0],c[3*g+1]),t.expandPointInPlace(H,J);b.vec4.scale(H,H,f);g=H[1]%z.unitSizeOfTexture;F[0]=H[0]-H[0]%z.unitSizeOfTexture;F[1]=H[1]-g;for(g=0;g<d;g++)a[2*g+0]=(c[3*g+0]*f-F[0])/z.unitSizeOfTexture,a[2*g+1]=(c[3*g+1]*f-F[1])/z.unitSizeOfTexture};z.prototype._create3DShapeGeometries=
function(a){for(var b=a.uvCoords,d=0,e=a.renderData.polygons;d<e.length;d++){var f=e[d],g=f.count,m=f.index,l=f.position,r=f.mapPosition,f=f.holeIndices;if(k.isSome(this._context.clippingExtent)&&(p.empty(I),p.expandWithBuffer(I,r),!p.intersectsClippingArea(I,this._context.clippingExtent)))continue;f=c.earcut(r,f,3);0!==f.length&&(f=new Uint32Array(f),g=new Float64Array(b.buffer,2*m*b.BYTES_PER_ELEMENT,2*g),l=x.createWaterGeometryData({indices:f,attributeData:{position:l,uv0:g,mapPosition:r}}),l=
new B(l,a.idHint),a.outGeometries.push(l),a.outMaterials.push(k.unwrap(this._material)),a.outTransforms.push(h.mat4f64.IDENTITY),a.outNum++)}};z.prototype._createAsOverlay=function(a,b){var c=x.geometryAsPolygon(a.geometry);if(k.isNone(c))return null;k.unwrap(this._material).renderPriority=this._renderPriority;L.renderData=x.geometryToRenderInfoDraped(c,this._context.overlaySR);L.idHint=b;b=L.renderData.position.length/3;L.uvCoords=new Float64Array(2*b);L.outNum=0;L.outGeometries=[];L.outBoundingBox=
p.empty();L.layerUid=this._context.layer.uid;L.graphicsUid=a.uid;this._createAsOverlayWater(L);this._logGeometryCreationWarnings(L.renderData,c.rings,"rings","WaterSymbol3DLayer");if(0===L.outNum)return null;this._createUVCoordsFromVertices(L.uvCoords,L.renderData.position,b,this._context.overlaySR);return 0<L.outNum?new v(this,L.outGeometries,L.outBoundingBox):null};z.prototype._createAsOverlayWater=function(a){for(var b=a.uvCoords,d=0,e=a.renderData.polygons;d<e.length;d++){var f=e[d],g=f.position,
h=f.holeIndices,m=f.index,f=f.count;p.empty(I);p.expandWithBuffer(I,g);p.intersectsClippingArea(I,this._context.clippingExtent)&&(p.expand(a.outBoundingBox,I),h=c.earcut(g,h,3),0!==h.length&&(h=new Uint32Array(h),m=new Float64Array(b.buffer,2*m*b.BYTES_PER_ELEMENT,2*f),g=x.createWaterGeometryData({indices:h,attributeData:{position:g,uv0:m}}),g=new C(g),g.data.layerUid=a.layerUid,g.data.graphicUid=a.graphicsUid,g.material=k.unwrap(this._material),m=I,g.center=[.5*(m[0]+m[3]),.5*(m[1]+m[4]),0],g.bsRadius=
.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1])),a.outGeometries.push(g),a.outNum++))}};z.headingVectorFromAngle=function(a){var b=f.vec2f64.create();a=g.toRadian(a);b[0]=Math.sin(a);b[1]=Math.cos(a);return b};Object.defineProperty(z.prototype,"test",{get:function(){var a=this;return{create3DShape:function(b){return a._createAs3DShape(b.graphic,b.elevationContext,b.idHint,b.graphicUid)},ensureMaterial:function(){return a.ensureMaterial()}}},enumerable:!1,configurable:!0});z.validGeometryTypes=
["polyline","polygon","extent"];z.unitSizeOfTexture=100;z.elevationModeChangeTypes={definedChanged:r.SymbolUpdateType.RECREATE,staysOnTheGround:r.SymbolUpdateType.NONE,onTheGroundChanged:r.SymbolUpdateType.RECREATE};return z}(z.default);a.Graphics3DWaterSymbolLayer=n;var F=f.vec2f64.create(),H=t.create(),J=f.vec2f64.create(),I=p.create(),K={idHint:null,renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},L={idHint:null,renderData:null,
uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};a.default=n})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("require exports tslib ../lib/AnimationTimer ../lib/Material ./WaterGLMaterial ./WaterTechnique ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/waterMaterialUtils".split(" "),function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.WaterMaterial=void 0;n=function(a){function g(b,
d){d=a.call(this,d)||this;d.animation=new l.AnimationTimer;d.techniqueConfig=new c.WaterTechniqueConfiguration;d.params=m.copyParameters(b,f.defaultWaterMaterialParameters);return d}d.__extends(g,a);g.prototype.setParameterValues=function(a){this.params=d.__assign(d.__assign({},this.params),a);this.parametersChanged()};g.prototype.getParameters=function(){return this.params};g.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.writeDepth=this.params.writeDepth;
this.techniqueConfig.receiveShadows=this.params.receiveShadows;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.useSSR=this.params.ssrEnabled;this.techniqueConfig.isDraped=this.params.isDraped;return this.techniqueConfig};g.prototype.update=function(a){this.animation.enabled=Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*Math.min(a.camera.relativeElevation,a.camera.distance)<b;this.animation.advance(a.dt);
return this.animation.enabled};g.prototype.intersect=function(a,b,c,d,e,f,g){m.intersectTriangleGeometry(a,b,d,e,f,void 0,g)};g.prototype.getGLMaterial=function(a){if(0===a.output&&this.params.isDraped)return a.output=5,new e.WaterGLMaterial(a);switch(a.output){case 0:case 2:case 4:return new e.WaterGLMaterial(a)}};g.prototype.createBufferWriter=function(){return new h.DefaultBufferWriter(h.PositionUVLayout)};return g}(k.Material);a.WaterMaterial=n;var b=35E3})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["require",
"exports","../../../../core/maybe","../../../../layers/support/timeUtils"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.AnimationTimer=void 0;n=function(){function a(a){void 0===a&&(a=!0);this.enabled=a;this._time=0}Object.defineProperty(a.prototype,"time",{get:function(){return d.isSome(this._forcedTime)?this._forcedTime:l.Milliseconds(this._time)},enumerable:!1,configurable:!0});a.prototype.advance=function(a){this.enabled&&(this._time+=a)};a.prototype.stopAtTime=function(a){this._forcedTime=
a};return a}();a.AnimationTimer=n})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2f64"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.wavePresets=a.defaultWaterMaterialParameters=void 0;a.defaultWaterMaterialParameters={waveStrength:.06,waveTextureRepeat:32,waveDirection:d.vec2f64.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,
0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1};a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,
perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,
waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}}})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define("require exports tslib ../../../../core/maybe ./Loadable ./symbolComplexity".split(" "),function(n,a,d,l,k,e){return function(a){function c(c,d){var b=a.call(this)||this;b.symbol=c;b.convert=d;b.graphics3DSymbol=null;b.referenced=
0;return b}d.__extends(c,a);c.prototype.getSymbolLayerSize=function(a){return l.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(a):null};Object.defineProperty(c.prototype,"extentPadding",{get:function(){return l.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0},enumerable:!1,configurable:!0});c.prototype.doLoad=function(a){return d.__awaiter(this,void 0,void 0,function(){var c;return d.__generator(this,function(b){switch(b.label){case 0:return[4,this.symbol.fetchSymbol({signal:a})];
case 1:return c=b.sent(),c.id=this.symbol.id,this.graphics3DSymbol=this.convert(c),[4,this.graphics3DSymbol.load()];case 2:return b.sent(),[2]}})})};c.prototype.createGraphics3DGraphic=function(a){return l.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(a,this):null};Object.defineProperty(c.prototype,"complexity",{get:function(){return l.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:e.emptySymbolComplexity},enumerable:!1,configurable:!0});c.prototype.globalPropertyChanged=
function(a,c){return l.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.globalPropertyChanged(a,c):!1};c.prototype.applyRendererDiff=function(a,c){return l.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(a,c):!1};c.prototype.prepareSymbolPatch=function(a){l.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(a)};c.prototype.updateGeometry=function(a,c){return l.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.updateGeometry(a,c):!1};c.prototype.onRemoveGraphic=
function(){};c.prototype.getFastUpdateStatus=function(){return l.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};c.prototype.destroy=function(){l.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;this.abortLoad()};Object.defineProperty(c.prototype,"destroyed",{get:function(){return void 0===this.graphics3DSymbol},enumerable:!1,configurable:!0});return c}(k.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){function p(a){a=b.getGraphics3DSymbol(a.graphics3DGraphic.graphics3DSymbol);return k.isSome(a)?a.symbol.symbolLayers.getItemAt(0):null}function t(a,b){var c=b.graphics3DGraphic.graphic.geometry;if(k.isNone(c))return null;if(k.isSome(b.disablePlacement))return(c=b.labelClass.labelPlacement)?(z.warnOncePerTick(u(a.placement,b.disablePlacement.logEntityDescription)),r(b)):a;var e=c.type;switch(e){case "polyline":case "polygon":case "extent":case "multipoint":if(c=b.labelClass.labelPlacement)return z.warnOncePerTick(u(a.placement,
"'"+e+"' geometries")),r(b);break;case "point":case "mesh":break;default:d.neverReached(e)}return a}function u(a,b){return"the requested label placement '"+a+"' is currently unsupported for "+b+" in SceneView"}function r(a){var b=a.graphics3DGraphic.graphic.geometry;if(k.isNone(b))return null;b=b.type;switch(b){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return a=p(a),k.isSome(a)&&"extrude"===a.type?x["above-center"]:
{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return x["above-center"];case "mesh":return x["above-center"];default:d.neverReached(b)}}function q(a,b,d){d=d.graphics3DGraphic._graphics[0];d=k.isSome(d)?d.getBoundingBoxObjectSpace(G):G;d=h.vec3f64.fromValues(d[3]-d[0],d[4]-d[1],d[5]-d[2]);a.centerOffset[0]=Math.sqrt(d[0]*d[0]+d[1]*d[1])/2*b.normalizedOffset[0];var e=a.translation[2],f=d[2]/2*b.normalizedOffset[1];a.translation[2]=0;a.elevationOffset=e+f;d=c.vec3.length(d);
a.centerOffset[2]=d/2*b.normalizedOffset[2]}function v(a){var c=a.labelClass.labelPlacement,d=a.labelSymbol,e=a.graphics3DGraphic,f=b.getGraphics3DSymbol(e.graphics3DSymbol),f=k.isSome(f)?f.symbol:null;a=x[c]||r(a);if("point-3d"===f.type&&f.supportsCallout()&&f.hasVisibleVerticalOffset()&&!e.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:w(f.verticalOffset),anchor:null,normalizedOffset:null};if(d&&d.hasVisibleVerticalOffset()&&("point-3d"!==f.type||!f.supportsCallout()||!f.verticalOffset||
e.isDraped)){a:switch(a.placement){case "above-center":e=!0;break a;default:e=!1}return e?{placement:"above-center",verticalOffset:w(d.verticalOffset),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(z.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+c+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}
function w(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,maxWorldLength:a.maxWorldLength}}Object.defineProperty(a,"__esModule",{value:!0});a.get=void 0;var z=l.getLogger("esri.views.3d.layers.graphics.labelPlacement");a.get=function(a){var b=v(a);if(k.isNone(b))return null;var c;if(b.anchor)c=b;else{c=a.labelClass.labelPlacement;var d=x[c],l=d||r(a);c&&!d&&z.warnOncePerTick("the requested label placement '"+c+"' is not currently supported in SceneView");c=t(l,a)}if(k.isNone(c))return null;
d=!!b.hasLabelVerticalOffset;b={anchor:c.anchor,verticalOffset:b.verticalOffset,screenOffset:e.vec2f64.create(),centerOffset:m.vec4f64.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:h.vec3f64.create(),elevationOffset:0,hasLabelVerticalOffset:d};d=a.graphics3DGraphic.graphic.geometry;if(k.isNone(d))a=null;else{switch(d.type){case "point":d=p(a);if(!k.isNone(d))switch(a.graphics3DGraphic.getCenterObjectSpace(b.translation),d.type){case "icon":case "text":l=a.graphics3DGraphic;d=l._graphics[0];
d=k.isSome(d)?d.getScreenSize():null;!l.isDraped&&k.isSome(d)?(l=void 0,void 0===l&&(l=E),a=a.graphics3DGraphic._graphics[0],(a=k.isSome(a)?a.stageObject.geometryRecords[0].material:null)&&a instanceof g.default?(a=a.getParameters().anchorPos,l[0]=2*(a[0]-.5),l[1]=2*(a[1]-.5)):(l[0]=0,l[1]=0),a=l,C[0]=d[0]/2*(c.normalizedOffset[0]-a[0]),C[1]=d[1]/2*(c.normalizedOffset[1]-a[1]),b.screenOffset[0]=C[0],b.hasLabelVerticalOffset?(b.centerOffset[1]=C[1],b.centerOffsetUnits="screen"):b.screenOffset[1]=C[1]):
b.hasLabelVerticalOffset||"center"===b.anchor||(x[a.labelClass.labelPlacement]&&z.warnOncePerTick("the requested placement '"+c.placement+"' is currently unsupported for draped graphics"),b.anchor="center");break;case "object":q(b,c,a)}break;case "polygon":d=p(a);if(!k.isNone(d))switch(d.type){case "extrude":d=a.graphics3DGraphic._graphics[0],k.isSome(d)&&d.getBoundingBoxObjectSpace(G),f.center(G,b.translation),b.translation[2]=f.height(G)/2,q(b,c,a)}break;case "mesh":q(b,c,a)}a=b}return a};var x=
{"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},
"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},B={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],
"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};n=function(a){var b=x[a];B[a].forEach(function(a){x[a]=b})};for(var A in B)n(A);Object.freeze&&(Object.freeze(x),Object.keys(x).forEach(function(a){Object.freeze(x[a]);Object.freeze(x[a].normalizedOffset)}));var C=[0,0],E=[0,0],G=f.create()})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require",
"exports"],function(n,a){return function(){function a(a){this.materials={};this.stage=a}a.prototype.getMaterial=function(a){return this.materials[a]};a.prototype.addMaterial=function(a,d){this.materials[a]=d;this.stage.add(3,d)};a.prototype.dispose=function(){for(var a in this.materials)this.stage.remove(3,this.materials[a].id);this.materials={}};return a}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators ./Texture ../../../support/Scheduler ../../../webgl/Texture".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){Object.defineProperty(a,"__esModule",{value:!0});a.TextTextureAtlas=void 0;n=function(a){function l(b){b=a.call(this,b)||this;b.events=new k;b.glTexture=null;b.dirty=!1;b.needsClear=!1;b.elementsToAddOrUpdate=new Map;b.elementsToRemove=new Map;b.elementsToRender=new Map;b.elements=new Map;b.stageObjects=new Map;return b}d.__extends(l,a);q=l;l.prototype.initialize=function(){this.id=f.idGen.gen(this.idHint);this.stage=this.view._stage;this.canvas=this.create2DCanvas();
this.ctx=this.canvas.getContext("2d");this.stage.add(4,this);var a=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(a);this.update2DCanvasSize();this.resetAtlasCursor()};l.prototype.unload=function(){h.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);this.events.emit("unloaded")};Object.defineProperty(l.prototype,"width",{get:function(){return this.atlas.size.width},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"height",
{get:function(){return this.atlas.size.height},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"requiresFrameUpdates",{get:function(){return!1},enumerable:!1,configurable:!0});l.prototype.createDescriptor=function(a){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:a.parameters.maxMaxAnisotropy}};l.prototype.load=function(a){var c=this;if(h.isSome(this.glTexture))return this.glTexture;this.glTexture=
new g(a,this.createDescriptor(a),this.canvas);this.frameWorker=this.view.resourceController.scheduler.registerTask(b.Task.TEXT_TEXTURE_ATLAS,function(a){return c.run(a,!0)},function(){return c.dirty});this.setDirty();return this.glTexture};l.prototype.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAddOrUpdate=this.elements=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.glTexture&&(this.stage.remove(4,this.id),this.glTexture=null);this.canvas.width=
0;this.canvas.height=0;this.ctx=this.canvas=null};l.prototype.create2DCanvas=function(){var a=document.createElement("canvas");a.setAttribute("id","canvas2d");a.setAttribute("style","display:none");a.setAttribute("width",(512).toString());a.setAttribute("height",(512).toString());return a};l.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};l.prototype.createAtlasRegion=function(a){void 0===
a&&(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};l.prototype.computeAtlasResolution=function(a,b){a=Math.max(a,b);a=c.nextHighestPowerOfTwo(a+256);return a=Math.min(a,4096)};l.prototype.resizeAtlas=function(a,b){b=b||a;var c=this.atlas;c.size.width=a;c.size.height=b;h.isSome(this.glTexture)&&this.glTexture.resize(a,b);this.update2DCanvasSize()};l.prototype.resetAtlasCursor=function(){var a=this.atlas;a.cursor.x=p;a.cursor.y=p+t;a.lineHeight=0;this.needsClear=!0};l.prototype.getAtlasUsage=
function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};l.prototype.getExpectedAtlasUsage=function(){var a=this.elementsToRemove.size,b=this.elementsToAddOrUpdate.size,c=this.elements.size;return this.getAtlasUsage()/c*(c+b-a)};l.prototype.addAtlasElement=function(a,b,c,d){var e=this.atlas,f=a.textRenderer,g=f.renderedWidth,h=f.renderedHeight,m=f.displayWidth,f=f.displayHeight;a.placement.offset.x=e.cursor.x;a.placement.offset.y=e.cursor.y;a.placement.size.width=
g;a.placement.size.height=h;a.placement.size.displayWidth=m;a.placement.size.displayHeight=f;a.placement.uvMinMax=[a.placement.offset.x/e.size.width,1-(a.placement.offset.y+h)/e.size.height,(a.placement.offset.x+g)/e.size.width,1-a.placement.offset.y/e.size.height];e.cursor.x+=c;e.lineHeight=Math.max(e.lineHeight,d);this.elements.set(b,a)};l.prototype.removeAtlasElement=function(a){if(a&&this.elements.has(a.textId)){var b=a.placement.offset,c=a.placement.size;this.ctx.clearRect(b.x,b.y,c.width,c.height);
this.elements.delete(a.textId)}};l.prototype.ensureStageObjects=function(a){var b=this.stageObjects.get(a);if(b)return b;b=new Set;this.stageObjects.set(a,b);return b};l.prototype.addStageObject=function(a,b){this.ensureStageObjects(a).add(b)};l.prototype.removeStageObject=function(a,b){(a=this.stageObjects.get(a))&&a.delete(b)&&(b.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,0]),b.geometryVertexAttrsUpdated(0))};l.prototype._processAddition=function(a,b){var c=this.atlas,d=a.textId,
e=a.textRenderer.renderedWidth+p,f=a.textRenderer.renderedHeight+p+t;if(c.cursor.x+e<c.size.width&&c.cursor.y+f<c.size.height)this.addAtlasElement(a,d,e,f),this.elementsToRender.set(d,a),this.elementsToAddOrUpdate.delete(d);else if(c.cursor.y+f+c.lineHeight<c.size.height)c.cursor.x=p,c.cursor.y+=c.lineHeight,c.lineHeight=0,this.addAtlasElement(a,d,e,f),this.elementsToRender.set(d,a),this.elementsToAddOrUpdate.delete(d);else{a=this.getExpectedAtlasUsage();(d=.85<a&&4096>c.size.width)&&this.resizeAtlas(2*
c.size.width,2*c.size.height);if(!b||!d&&.95<a&&4096===c.size.width)return this.processRemovals(),0;this.repack();return 1}return 0};l.prototype.processRemovals=function(){var a=this;this.elementsToRemove.forEach(function(b,c){var d=a.stageObjects.get(c);d&&0!==d.size||a.removeAtlasElement(b);d&&0===d.size&&a.stageObjects.delete(c)});this.elementsToRemove.clear()};l.prototype.repack=function(){var a=this;this.processRemovals();this.elements.forEach(function(b,c){b.rendered=!1;a.elementsToAddOrUpdate.set(c,
b)});this.elements.clear();this.resetAtlasCursor();this.elementsToRender.clear()};l.prototype.processRenderingRequest=function(a){this.ctx.clearRect(a.placement.offset.x,a.placement.offset.y,a.placement.size.width,a.placement.size.height);a.textRenderer.render(this.ctx,a.placement.offset.x,a.placement.offset.y);var b=this.stageObjects.get(a.textId);b&&b.forEach(function(b){b.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(a.placement.uvMinMax);b.geometries[0].data.vertexAttributes.size.data=
new Float32Array([a.placement.size.displayWidth,a.placement.size.displayHeight]);b.geometryVertexAttrsUpdated(0)});a.rendered=!0};l.prototype.run=function(a,c){var d=this;if(this.glTexture){var f=!1;e.someMap(this.elementsToAddOrUpdate,function(a,b){return(a=d.elements.get(b))&&a.rendered?((a=d.stageObjects.get(b))&&a.forEach(function(a){var c=a.geometries[0].data.vertexAttributes,e=d.elements.get(b);c.uv0.data=new Float32Array(e.placement.uvMinMax);c.size.data=new Float32Array([e.placement.size.displayWidth,
e.placement.size.displayHeight]);a.geometryVertexAttrsUpdated(0)}),d.elementsToAddOrUpdate.delete(b),!1):1===d._processAddition(d.elementsToAddOrUpdate.get(b),c)?f=!0:!1});if(f)this.run(b.noBudget,!1);else{var g=!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);e.someMap(this.elementsToRender,function(b,c){d.processRenderingRequest(b);d.elementsToRender.delete(c);g=!0;a.madeProgress();return a.done});g&&h.isSome(this.glTexture)&&
this.glTexture.setData(this.canvas);this.dirty=0<this.elementsToRender.size;this.dirty||(q.test.orderedRepackingEnabled&&this.repackOrdered(),this.notifyChange("updating"))}}};l.prototype.addTextTexture=function(a,b){var c=a.key;this.elementsToAddOrUpdate.has(c)||this.elementsToAddOrUpdate.set(c,{textId:c,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:a,rendered:!1});this.addStageObject(c,b);this.elementsToRemove.delete(c);this.setDirty()};
l.prototype.removeTextTexture=function(a,b){a=a.key;this.elementsToRemove.set(a,this.elements.get(a));this.removeStageObject(a,b)};Object.defineProperty(l.prototype,"textureId",{get:function(){return this.id},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"isDirty",{get:function(){return this.dirty},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"updating",{get:function(){return this.dirty&&!!this.frameWorker},enumerable:!1,configurable:!0});l.prototype.setDirty=
function(){this.dirty||(this.dirty=!0,this.notifyChange("updating"))};l.prototype.repackOrdered=function(){if(0!==this.elements.size){var a=[];this.elements.forEach(function(b,c){return a.push({element:b,key:c})});for(var b=!0,c=0;c<a.length-1;c++)if(0<a[c].key.localeCompare(a[c+1].key)){b=!1;break}if(!b||this.elementsToRemove.size){a.sort(function(a,b){return a.key.localeCompare(b.key)});this.elements.clear();for(b=0;b<a.length;b++)c=a[b],this.elements.set(c.key,c.element);this.repack();this.setDirty()}}};
Object.defineProperty(l.prototype,"test",{get:function(){var a=this;return{elements:this.elements,stageObjects:this.stageObjects,elementsToRemove:this.elementsToRemove,atlas:this.atlas,resizeAtlas:function(b,c){return a.resizeAtlas(b,c)},run:function(b,c){return a.run(b,c)}}},enumerable:!1,configurable:!0});var q;l.test={orderedRepackingEnabled:!1};d.__decorate([m.property({constructOnly:!0})],l.prototype,"idHint",void 0);d.__decorate([m.property({constructOnly:!0})],l.prototype,"view",void 0);d.__decorate([m.property({type:Boolean,
readOnly:!0})],l.prototype,"updating",null);return l=q=d.__decorate([m.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],l)}(l);a.TextTextureAtlas=n;var p=2,t=2;a.default=n})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("require exports tslib ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,
"__esModule",{value:!0});a.test=a.ObjectResourceCache=void 0;n=function(){function a(){this.gltfCache=new Map;this.wosrCache=new Map;this.evictHandles=new l}a.prototype.loadGLTF=function(a,b){return this.fromCache(this.gltfCache,"gltf:"+a,function(b){return m.load(new h.DefaultLoadingContext(b.streamDataRequester),a,b)},b)};a.prototype.loadWOSR=function(a,b){return this.fromCache(this.wosrCache,"wosr:"+a+":"+b.disableTextures,function(b){return f.load(a,b)},b)};a.prototype.destroy=function(){this.evictHandles.destroy();
this.gltfCache.clear();this.wosrCache.clear()};Object.defineProperty(a.prototype,"size",{get:function(){return this.wosrCache.size+this.gltfCache.size},enumerable:!1,configurable:!0});a.prototype.fromCache=function(a,b,f,g){var h=this;return c.create(function(m,k){if(c.isAborted(g))k(c.createAbortError());else{var l=c.onAbort(g,function(){h.remove(a,b);k(c.createAbortError())}),p=a.get(b);if(p)h.evictHandles.remove(b),p.refCount++,p.item.then(m,k);else{var p=c.createAbortController(),r=d.__assign(d.__assign({},
g),{signal:p.signal}),t={refCount:1,abortController:p,item:f(r).then(function(c){t.abortController=null;c.remove=function(){return h.remove(a,b)};return c})};a.set(b,t);t.item.then(function(a){e.isSome(l)&&l.remove();m(a)},function(a){e.isSome(l)&&l.remove();k(a)})}}})};a.prototype.remove=function(a,c){var d=a.get(c);d&&(d.refCount--,0===d.refCount&&this.evictHandles.add(k.timeoutHandle(function(){a.delete(c);e.isSome(d.abortController)&&d.abortController.abort()},b),c))};return a}();a.ObjectResourceCache=
n;var b=1E4;a.test={overrideEvictDelay:function(a){b=a;return{remove:function(){b=1E4}}}}})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){Object.defineProperty(a,"__esModule",{value:!0});a.FeatureTileTree3D=void 0;var r=c.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");n=function(a){function c(b){b=a.call(this,b)||this;b.tiles=new k;b.tileSize=512;b._idToTile=new Map;b._handles=new e;b._clients=new Set;b._dirty=!1;b._newTiles=new h;return b}d.__extends(c,a);Object.defineProperty(c.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():
null},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))r.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this._setDirty())}},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||
!this.tilingScheme)return null;var a=b.create();t.toBoundingRect(this.filterExtent,a,this.tilingScheme.spatialReference);return a},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&(this._set("suspended",a),this._setDirty())},enumerable:!1,
configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return this._dirty||!!this._pendingTiles},enumerable:!1,configurable:!0});c.prototype.initialize=function(){var a=this;this._handles.add(this.watch(["tilingScheme","tileSize"],function(){return a._reset()},!0));this._handles.add(m.init(this,["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"],function(){return a._setDirty()},!0));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(u.Task.FEATURE_TILE_TREE,
function(b){return a._update(b)},function(){return a.updating}))};c.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this._handles&&(this._handles.destroy(),this._handles=null)};c.prototype.addClient=function(){var a=this,b=q++;this._clients.add(b);1===this._clients.size&&this._setDirty();return{remove:function(){return a._removeClient(b)}}};c.prototype._removeClient=function(a){this._clients.delete(a);this._hasClients||this._clear()};Object.defineProperty(c.prototype,
"_hasClients",{get:function(){return 0<this._clients.size},enumerable:!1,configurable:!0});c.prototype._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this._update(u.noBudget))};c.prototype._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};c.prototype._update=function(a){this._dirty=!1;this._pendingTiles||(this._startUpdate(),this._frameWorker&&
(this._frameWorker.task=u.Task.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(a);!this._pendingTiles&&this._frameWorker&&(this._frameWorker.task=u.Task.FEATURE_TILE_TREE);this.notifyChange("updating")};c.prototype._startUpdate=function(){if(!this.suspended)if(this.tilingScheme){this._tileMeasurements||(this._tileMeasurements=new p.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:w}));var a=this.cameraOnSurface.location;
this._tileMeasurements.begin(this.viewState.camera,this.focus?this.focus.locationOnSurface:a,a.z);this._pendingTiles=this._getRootTiles()}else this._clear()};c.prototype._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};c.prototype._getRootTiles=function(){var a=this;return this.rootTileIds.map(function(b){return new g.FeatureTileDescriptor3D(b[0],b[1],b[2],a.tilingScheme)})};c.prototype._purgeHorizonTiles=function(a){a.sort(function(a,b){a=
a.measures.screenRect;b=b.measures.screenRect;return a[1]+a[3]-(b[1]+b[3])});b.empty(v);for(var c=0;c<a.length;c++)if(b.expand(v,a.data[c].measures.screenRect),b.height(v)>w)return a.data.slice(c,a.length);return[]};c.prototype._subdivideTilesForView=function(a){var c;if(this._pendingTiles){for(;0<this._pendingTiles.length&&!a.done;){var d=this._pendingTiles.pop();a.madeProgress();if(!this.filterExtentRect||b.intersects(this.filterExtentRect,d.extent))this._tileMeasurements.updateTile(d),0!==d.measures.visibility&&
(d.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(d.lij[0]+1),(c=this._pendingTiles).push.apply(c,d.getChildren())):this._newTiles.push(d))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};c.prototype._updateTiles=function(a){for(var b=this,c=0,d=this.tiles.items;c<d.length;c++)d[c].used=!1;a=a.filter(function(a){var c=b._idToTile.get(a.id);c?(c.copyMeasurementsFrom(a),c.used=
!0):b._idToTile.set(a.id,a);return!c});c=this.tiles.items.filter(function(a){return a.used?!1:(b._idToTile.delete(a.id),!0)});this.tiles.removeMany(c);this.tiles.addMany(a);this.sortTiles()};c.prototype.sortTiles=function(){this.tiles.sort(function(a,b){return a.measures.visibility!==b.measures.visibility?2===a.measures.visibility?-1:1:a.measures.distance-b.measures.distance});this.tiles.forEach(function(a,b){return a.loadPriority=b})};d.__decorate([f.property({constructOnly:!0})],c.prototype,"scheduler",
void 0);d.__decorate([f.property({constructOnly:!0})],c.prototype,"renderCoordsHelper",void 0);d.__decorate([f.property({constructOnly:!0})],c.prototype,"tilingSchemeOwner",void 0);d.__decorate([f.property({constructOnly:!0})],c.prototype,"cameraOnSurface",void 0);d.__decorate([f.property({constructOnly:!0})],c.prototype,"focus",void 0);d.__decorate([f.property({constructOnly:!0})],c.prototype,"viewState",void 0);d.__decorate([f.property()],c.prototype,"tiles",void 0);d.__decorate([f.property()],
c.prototype,"tileSize",void 0);d.__decorate([f.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],c.prototype,"tilingScheme",null);d.__decorate([f.property()],c.prototype,"filterExtent",null);d.__decorate([f.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],c.prototype,"filterExtentRect",null);d.__decorate([f.property({readOnly:!0,dependsOn:["filterExtentRect"]})],c.prototype,"rootTileIds",null);d.__decorate([f.property({value:!1})],c.prototype,"suspended",null);
d.__decorate([f.property({readOnly:!0})],c.prototype,"updating",null);return c=d.__decorate([f.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],c)}(l);a.FeatureTileTree3D=n;var q=0,v=b.create(),w=10;a.default=n})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require","exports","../../../../geometry/support/aaBoundingRect"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.FeatureTileDescriptor3D=void 0;n=function(){function a(a,e,c,h){void 0===
h&&(h=null);this.lij=[0,0,0];this.extent=d.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screenRect:d.create(),distance:0,shouldSplit:!1};this.used=!1;h&&this.acquire(a,e,c,h)}a.prototype.acquire=function(d,e,c,h){this.tilingScheme=h;this.id=a.id(d,e,c);this.lij[0]=d;this.lij[1]=e;this.lij[2]=c;h.getExtent(d,e,c,this.extent);this.resolution=h.resolutionAtLevel(d)};a.prototype.release=function(){this.tilingScheme=null};a.prototype.getChildren=function(d){var e=this.lij[0]+
1,c=2*this.lij[1],h=2*this.lij[2];if(!d)return[new a(e,c,h,this.tilingScheme),new a(e,c+1,h,this.tilingScheme),new a(e,c,h+1,this.tilingScheme),new a(e,c+1,h+1,this.tilingScheme)];d[0].acquire(e,c,h,this.tilingScheme);d[1].acquire(e,c+1,h,this.tilingScheme);d[2].acquire(e,c,h+1,this.tilingScheme);d[3].acquire(e,c+1,h+1,this.tilingScheme);return d};a.prototype.copyMeasurementsFrom=function(a){this.measures.visibility=a.measures.visibility;this.measures.shouldSplit=a.measures.shouldSplit;this.measures.distance=
a.measures.distance;d.set(a.measures.screenRect,this.measures.screenRect)};a.id=function(a,d,c){return a+"/"+d+"/"+c};return a}();a.FeatureTileDescriptor3D=n;a.default=n})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../support/geometryUtils ../../webgl-engine/lib/Camera".split(" "),
function(n,a,d,l,k,e,c,h,m){Object.defineProperty(a,"__esModule",{value:!0});a.FeatureTileMeasurements3D=void 0;n=function(){function a(a){this.camera=new m.default;this.pointOfInterestInMap=[0,0];this.screenRect=e.create();this.tileSize=a.tileSize;this.maxVerticalScreenSize=a.maxVerticalScreenSize;this.renderCoordsHelper=a.renderCoordsHelper;this.tilingScheme=a.tilingScheme;this.visibility=new c.FeatureTileVisibility3D({renderCoordsHelper:a.renderCoordsHelper})}a.prototype.begin=function(a,b,c){this.camera.copyFrom(a);
this.z=c;this.pointOfInterestInMap[0]=b.x;this.pointOfInterestInMap[1]=b.y;e.fromValues(0,0,a.fullWidth,a.fullHeight,this.screenRect);this.visibility.begin(this.camera,c)};a.prototype.end=function(){this.visibility.end()};a.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a);this.updateDistanceMeasure(a)};a.prototype.updateDistanceMeasure=function(a){a.measures.distance=e.distance(a.extent,this.pointOfInterestInMap)};
a.prototype.updateScreenMeasure=function(a){var b=g,c=1<<b,d=a.measures.screenRect;e.empty(d);for(var f=0,h=a.lij[0]+b,m=a.lij[1]<<b,b=a.lij[2]<<b,k=this.tileSizeWithBias(a),k=k*k,l=!1,p=0;p<c;p++){for(var r=0;r<c&&!(l=this.computeScreenArea(a,h,m+p,b+r,d),f+=l.area,l=f>k&&e.height(d)>this.maxVerticalScreenSize);r++);if(l)break}a.measures.shouldSplit=f>k};a.prototype.tileSizeWithBias=function(a){return 1===a.measures.visibility?this.tileSize*p:this.tileSize};a.prototype.computeScreenArea=function(a,
c,d,g,m){var k=t.points;this.projectToScreen(c,d,g,1===a.measures.visibility,k);e.empty(f);for(a=0;4>a;a++)e.expandPointInPlace(f,k[a]);e.expand(m,f);e.intersection(f,this.screenRect,b);t.screenOverlap=e.area(b)/e.area(f);t.area=h.triangle.areaPoints2d(k[0],k[1],k[2])+h.triangle.areaPoints2d(k[0],k[2],k[3]);return t};a.prototype.projectToScreen=function(a,b,c,d,e){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,b,c,u);this.toRenderCoords(u,0,3,q[0]);this.toRenderCoords(u,2,3,q[1]);
this.toRenderCoords(u,2,1,q[2]);this.toRenderCoords(u,0,1,q[3]);d&&(this.projectToPlane(q,this.camera.frustum.planes[4]),this.projectToPlane(q,this.camera.frustum.planes[3]),this.projectToPlane(q,this.camera.frustum.planes[2]));for(a=0;4>a;a++)this.camera.projectPoint(q[a],w),this.camera.renderToScreen(w,e[a])};a.prototype.projectToPlane=function(a,b){for(var c=0;4>c;c++)v[c]=h.plane.signedDistance(b,a[c]);c=Math.max(v[0],v[1],v[2],v[3]);if(0<c)for(b=l.vec3.scale(r,h.plane.normal(b),-c),c=0;4>c;c++)l.vec3.add(a[c],
a[c],b)};a.prototype.toRenderCoords=function(a,b,c,d){r[0]=a[b];r[1]=a[c];r[2]=this.z;this.renderCoordsHelper.toRenderCoords(r,this.tilingScheme.spatialReference,d);return d};return a}();a.FeatureTileMeasurements3D=n;var f=e.create(),b=e.create(),g=2,p=5,t={points:[d.createScreenPointArray(),d.createScreenPointArray(),d.createScreenPointArray(),d.createScreenPointArray()],area:0,screenOverlap:0},u=e.create(),r=k.vec3f64.create(),q=[k.vec3f64.create(),k.vec3f64.create(),k.vec3f64.create(),k.vec3f64.create()],
v=[0,0,0,0],w=d.createRenderScreenPointArray3();a.default=n})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils".split(" "),function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.FeatureTileVisibility3D=
void 0;n=function(){function a(a){this.surfaceElevation=0;this.cache=new Map;a=a.renderCoordsHelper;this.frustum=new h.Frustum({renderCoordsHelper:a});this.extendedFrustum=new h.Frustum({renderCoordsHelper:a});this.intersector=new m.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}a.prototype.begin=function(a,b){this.surfaceElevation=b;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>b;this.frustum.update(a);this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,
b)};a.prototype.end=function(){this.cache.clear()};a.prototype.calculate=function(a){if(this.allTilesInvisible)return 0;var c=1===this.renderCoordsHelper.viewingMode&&a.lij[0]>=b&&a.lij[0]<g,d=this.getOrCalculateSingleTileVisibility(a,!c);return 0!==d&&c?this.calculateAggregatedChildrenVisibility(a):d};a.prototype.shortenFrustumFarPlane=function(a){for(var b=a.mutablePoints,c=0,d=h.Frustum.nearFarLineIndices;c<d.length;c++){var e=d[c],f=e[1],e=b[e[0]];k.vec3.subtract(u,b[f],e);k.vec3.scale(u,u,t);
k.vec3.add(b[f],e,u)}a.updatePoints(b)};a.prototype.calculateAggregatedChildrenVisibility=function(a){var b=0,c=this.cache.get(a.id);if(null!=c)return c;c=v.acquire();a.getChildren(c);for(var d=0;d<c.length;d++){var e=this.calculate(c[d]);if(0!==e&&(b=e,2===e))break}v.release(c);this.cache.set(a.id,b);return b};a.prototype.getOrCalculateSingleTileVisibility=function(a,b){var c=this.cache.get(a.id);if(null!=c)return c;c=this.calculateSingleTileVisibility(a);b&&this.cache.set(a.id,c);return c};a.prototype.calculateSingleTileVisibility=
function(a){if(!this.aboveGround&&1===this.renderCoordsHelper.viewingMode&&a.lij[0]<p){if(0===this.calculateSingleTileVisibilitySided(a,!1))return this.calculateSingleTileVisibilitySided(a,!0)}else return this.calculateSingleTileVisibilitySided(a,this.aboveGround)};a.prototype.calculateSingleTileVisibilitySided=function(a,b){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,b);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?this.intersector.isVisibleInFrustum(this.frustum,
!0)?2:1:0};a.prototype.updateExtendedFrustum=function(a,b){var c=this.renderCoordsHelper;this.extendedFrustum.update(a);this.shortenFrustumFarPlane(this.extendedFrustum);var e=this.renderCoordsHelper.worldUpAtPosition(a.eye,u);this.aboveGround||k.vec3.negate(e,e);e=d.acosClamped(-k.vec3.dot(e,a.viewForward));this.allTilesInvisible=e>(Math.PI+a.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=e>a.fovY/2)){a=this.extendedFrustumParameters(b);b=this.extendedFrustum.mutablePoints;for(e=0;4>
e;e++){var g=a.pointIndices[e],h=b[g],m=c.getAltitude(h);if(a.needsAltitudeAdjustment(m)){this.renderCoordsHelper.worldUpAtPosition(h,u);switch(g){case 4:case 7:case 0:case 3:f.plane.projectVector(this.extendedFrustum.planes[0],u,u);break;case 5:case 6:case 1:case 2:f.plane.projectVector(this.extendedFrustum.planes[1],u,u)}k.vec3.scale(u,u,a.direction);this.renderCoordsHelper.intersectInfiniteManifold(f.ray.wrap(h,u),a.zWithMargin,h)}}this.extendedFrustum.updatePoints(b);f.plane.fromPoints(b[0],b[1],
b[2],r);f.plane.fromPoints(b[1],b[2],b[3],q);0>k.vec3.dot(f.plane.normal(r),f.plane.normal(q))&&(c=this.extendedFrustum.mutablePoints,this.aboveGround?(a=[c[1],c[0]],c[0]=a[0],c[1]=a[1]):(a=[c[2],c[3]],c[3]=a[0],c[2]=a[1]),this.extendedFrustum.updatePoints(c))}};a.prototype.extendedFrustumParameters=function(a){return this.aboveGround?this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};a.prototype.extendedFrustumParametersAboveSurface=function(a,b){var c=
a-b;return{zWithMargin:c,pointIndices:h.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:function(a){return a>c}}};a.prototype.extendedFrustumParametersBelowSurface=function(a,b){var c=a+b;return{zWithMargin:c,pointIndices:h.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<c}}};return a}();a.FeatureTileVisibility3D=n;var b=2,g=6,p=12,t=.95,u=e.vec3f64.create(),r=f.plane.create(),q=f.plane.create(),v=new l(Array,function(a){4!==a.length&&(a[0]=
new c.FeatureTileDescriptor3D,a[1]=new c.FeatureTileDescriptor3D,a[2]=new c.FeatureTileDescriptor3D,a[3]=new c.FeatureTileDescriptor3D)},function(a){a[0].release();a[1].release();a[2].release();a[3].release()});a.default=n})},"esri/views/3d/state/Frustum":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/mathUtils ../support/geometryUtils/frustum".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});
a.Frustum=void 0;n=function(){function a(a){this.frustum=e.create();this.lines=Array(12);this.origin=l.vec3f64.create();this.direction=l.vec3f64.create();this._altitude=null;this.renderCoordsHelper=a?a.renderCoordsHelper:null;for(a=0;12>a;a++)this.lines[a]={origin:null,direction:l.vec3f64.create(),endpoint:null}}Object.defineProperty(a.prototype,"planes",{get:function(){return this.frustum.planes},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"points",{get:function(){return this.frustum.points},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"mutablePoints",{get:function(){return this.frustum.points},enumerable:!1,configurable:!0});a.prototype.update=function(a){e.fromMatrix(a.viewMatrix,a.projectionMatrix,this.frustum);d.vec3.copy(this.origin,a.eye);d.vec3.copy(this.direction,a.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);this.updateLines()};a.prototype.updatePoints=function(a){for(var c=0;c<this.frustum.points.length;c++)d.vec3.copy(this.frustum.points[c],
a[c]);e.recomputePlanes(this.frustum);this.updateLines()};Object.defineProperty(a.prototype,"altitude",{get:function(){return this._altitude},enumerable:!1,configurable:!0});a.prototype.intersectsSphere=function(a){return e.intersectsSphere(this.frustum.planes,a)};a.prototype.intersectsRay=function(a){return e.intersectsRay(this.frustum.planes,a)};a.prototype.intersectsLineSegment=function(a,c){return e.intersectsLineSegment(this.frustum.planes,a,c)};a.prototype.intersectsPoint=function(a){return e.intersectsPoint(this.frustum.planes,
a)};a.prototype.updateLines=function(){for(var a=this.frustum.points,c=0;4>c;c++){var d=c,b=c+4;this.updateLine(this.lines[c],a[d],a[b]);this.updateLine(this.lines[c+4],a[d],3===c?a[0]:a[d+1]);this.updateLine(this.lines[c+8],a[b],3===c?a[4]:a[b+1])}};a.prototype.updateLine=function(a,c,d){a.origin=c;a.endpoint=d;k.directionFromTo(a.direction,c,d)};a.planePointIndices=e.planePointIndices;a.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return a}();a.Frustum=n;a.default=n})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../core/compilerUtils ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/geodesicConstants ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){Object.defineProperty(a,"__esModule",{value:!0});a.FrustumExtentIntersection=void 0;n=.5*Math.PI;var r=n/Math.PI*180,q=n*b.earthRadius,v=.9*b.earthRadius;b=function(){function a(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:h.vec3f64.create(),direction:h.vec3f64.create()};for(a=0;4>a;a++)this.extent[a]={origin:h.vec3f64.create(),direction:h.vec3f64.create(),cap:{next:null,direction:h.vec3f64.create()}},
this.planes[a]=g.plane.create();this.planes[4]=g.plane.create();this.planes[5]=g.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}a.prototype.update=function(a,b,d,e){void 0===e&&(e=!0);var f=this.extent;this.toRenderBoundingExtent(a,b,d);c.vec3.add(this.center.origin,f[0].origin,f[2].origin);c.vec3.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);e||c.vec3.scale(this.center.direction,this.center.direction,
-1);for(d=0;4>d;d++){var h=f[d];this.renderCoordsHelper.worldUpAtPosition(h.origin,h.direction);var m=f[3===d?0:d+1];h.cap.next=m.origin;t.directionFromTo(h.cap.direction,h.origin,m.origin);g.plane.fromVectorsAndPoint(h.direction,h.cap.direction,h.origin,this.planes[d]);e||c.vec3.scale(h.direction,h.direction,-1)}g.plane.fromVectorsAndPoint(f[0].cap.direction,f[1].cap.direction,f[0].origin,this.planes[4]);e?g.plane.negate(this.planes[4],this.planes[5]):(g.plane.copy(this.planes[4],this.planes[5]),
g.plane.negate(this.planes[4],this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));this.maxSpanSpatialReference=b};a.prototype.isVisibleInFrustum=function(a,b){void 0===b&&(b=!1);if(null==a)return!1;if(1===this.renderCoordsHelper.viewingMode){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?r:q))return!0;if(a.altitude>=v)return this.isVisibleInFrustumGlobal(a)}if(0===this.maxSpan){var c=this.extent[0];return!b&&a.intersectsRay(g.ray.wrap(c.origin,c.direction))?
!0:!1}for(var d=0;d<this.extent.length;d++)if(c=this.extent[d],!b&&a.intersectsRay(g.ray.wrap(c.origin,c.direction))||a.intersectsLineSegment(g.lineSegment.fromPoints(c.origin,c.cap.next,C),c.cap.direction))return!0;b=b?this.planes:this.planesWithoutFar;for(d=0;d<a.lines.length;d++)if(c=a.lines[d],p.frustumLineSegment(b,c.origin,c.endpoint,c.direction))return!0;return!1};a.prototype.toRenderBoundingExtentGlobal=function(a,b,d){f.center(a,z);z[2]=d;u.computeLinearTransformation(b,z,x,this.renderCoordsHelper.spatialReference);
k.mat4.invert(B,x);m.empty(A);for(var e=0,g=w;e<g.length;e++)for(var h=g[e],p=h.x0,r=h.x1,t=h.y0,h=h.y1,q=0;5>q;q++){var v=q/4;z[0]=l.lerp(a[p],a[r],v);z[1]=l.lerp(a[t],a[h],v);z[2]=d;u.vectorToVector(z,b,z,this.renderCoordsHelper.spatialReference);c.vec3.transformMat4(z,z,B);m.expandPointInPlace(A,z)}c.vec3.set(this.extent[0].origin,A[0],A[1],A[2]);c.vec3.set(this.extent[1].origin,A[3],A[1],A[2]);c.vec3.set(this.extent[2].origin,A[3],A[4],A[2]);c.vec3.set(this.extent[3].origin,A[0],A[4],A[2]);for(q=
0;4>q;++q)c.vec3.transformMat4(this.extent[q].origin,this.extent[q].origin,x)};a.prototype.toRenderBoundingExtentLocal=function(a,b){c.vec3.set(this.extent[0].origin,a[0],a[1],b);c.vec3.set(this.extent[1].origin,a[2],a[1],b);c.vec3.set(this.extent[2].origin,a[2],a[3],b);c.vec3.set(this.extent[3].origin,a[0],a[3],b)};a.prototype.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(a,b,c);break;case 2:this.toRenderBoundingExtentLocal(a,
c);break;default:d.neverReached(this.renderCoordsHelper.viewingMode)}};a.prototype.isVisibleInFrustumGlobal=function(a){if(0>c.vec3.dot(this.center.direction,a.direction))return!0;for(var b=0;4>b;b++)if(0>c.vec3.dot(this.extent[b].direction,a.direction))return!0;return!1};return a}();a.FrustumExtentIntersection=b;var w=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],z=h.vec3f64.create(),x=e.mat4f64.create(),B=e.mat4f64.create(),A=m.create(),C=g.lineSegment.create();
a.default=b})},"esri/views/3d/support/extentUtils":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec3f64","./projectionUtils"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.toBoundingRect=a.projectToBoundingBox=void 0;a.projectToBoundingBox=function(a,c,d){if(null==a)return!1;var e;k[0]=null!=a.xmin?a.xmin:0;k[1]=null!=a.ymin?a.ymin:0;k[2]=null!=a.zmin?a.zmin:0;e=l.bufferToBuffer(k,a.spatialReference,0,c,d,0,1);k[0]=null!=a.xmax?a.xmax:0;k[1]=null!=
a.ymax?a.ymax:0;k[2]=null!=a.zmax?a.zmax:0;e=e&&l.bufferToBuffer(k,a.spatialReference,0,c,d,3,1);null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.zmin&&(c[2]=-Infinity);null==a.xmax&&(c[3]=Infinity);null==a.ymax&&(c[4]=Infinity);null==a.zmax&&(c[5]=Infinity);return e};a.toBoundingRect=function(a,c,d){if(null==a)return!1;var e;k[0]=null!=a.xmin?a.xmin:0;k[1]=null!=a.ymin?a.ymin:0;k[2]=null!=a.zmin?a.zmin:0;e=l.bufferToBuffer(k,a.spatialReference,0,k,d,0,1);c[0]=k[0];c[1]=k[1];
k[0]=null!=a.xmax?a.xmax:0;k[1]=null!=a.ymax?a.ymax:0;k[2]=null!=a.zmax?a.zmax:0;e=e&&l.bufferToBuffer(k,a.spatialReference,0,k,d,0,1);c[2]=k[0];c[3]=k[1];null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.xmax&&(c[2]=Infinity);null==a.ymax&&(c[3]=Infinity);return e};var k=d.vec3f64.create()})},"esri/views/3d/state/ViewState":function(){define("require exports tslib ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/accessorSupport/watch ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/geodesicConstants ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function l(){var b=a.call(this)||this;b._propertiesPool=new u.default({camera:r.default},b);b._lastSeenCameraProjectionValues=new r.default;b.events=new k;b.mode=1;b._cameraChanged=!1;b.updateQueue=[];b.processingUpdates=!1;return b}d.__extends(l,a);l.prototype.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new u.default({camera:r.default},this)};
l.prototype.init=function(a,b){this.viewingMode=a;this._set("spatialReference",b);a=1===this.mode?new r.default(m.vec3f64.fromValues(4*f.earthRadius,0,0),m.vec3f64.fromValues(f.earthRadius,0,0),m.vec3f64.fromValues(0,0,1)):new r.default(m.vec3f64.fromValues(0,0,100),m.vec3f64.fromValues(0,0,0),m.vec3f64.fromValues(0,1,0));this.camera=a;this._set("constraints",new g.default({mode:this.mode}))};Object.defineProperty(l.prototype,"animation",{get:function(){return this.cameraController instanceof p.AnimationController&&
e.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){var b=this;a!==q&&q.copyFrom(a);q.markViewDirty();q.computeUp(this.mode);v.camera=q;this.events.emit("before-camera-change",v);a=this._get("camera");this.cameraProjectionChanged(this._lastSeenCameraProjectionValues,q)&&(this._lastSeenCameraProjectionValues.copyFrom(q),w.camera=
this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",w));if(!a||!a.equals(q))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(q)),this._cameraChanged=!a||!a.almostEquals(q))var c=h.afterDispatch(function(){b._cameraChanged=!1;c.remove()})},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"isLocal",{get:function(){return 2===
this.mode},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"viewingMode",{set:function(a){this._set("mode","global"===a?1:2)},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"navigating",{get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"stationary",{get:function(){return!this._cameraChanged&&!this.navigating},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,
"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var b=this;this.stopActiveCameraController()?(a&&(a.watch("state",function(c){if(c===t.State.Finished||c===t.State.Stopped)b._set("cameraController",null),b.updateCamera(function(b){return a.onControllerEnd(b)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=t.State.Rejected)},enumerable:!1,configurable:!0});l.prototype.switchCameraController=function(a){this.cameraController=
a;return a.state!==t.State.Rejected};l.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};l.prototype.updateCamera=function(a){this.updateQueue.push(a);this.processUpdateQueue()};l.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.shift();q.copyFrom(this._get("camera"));a(q);this.camera=q;this.processingUpdates=!1;this.processUpdateQueue()}};
l.prototype.cameraProjectionChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==b.padding[3]?!0:!1};d.__decorate([c.property({readOnly:!0,type:b,dependsOn:["cameraController"]})],l.prototype,"animation",null);d.__decorate([c.property({type:r.default})],
l.prototype,"camera",null);d.__decorate([c.property({readOnly:!0})],l.prototype,"constraints",void 0);d.__decorate([c.property({readOnly:!0})],l.prototype,"events",void 0);d.__decorate([c.property({readOnly:!0,dependsOn:["isLocal"]})],l.prototype,"isGlobal",null);d.__decorate([c.property({readOnly:!0,dependsOn:["mode"]})],l.prototype,"isLocal",null);d.__decorate([c.property({readOnly:!0})],l.prototype,"mode",void 0);d.__decorate([c.property({constructOnly:!0})],l.prototype,"spatialReference",void 0);
d.__decorate([c.property({readOnly:!0,dependsOn:["cameraController"]})],l.prototype,"navigating",null);d.__decorate([c.property({readOnly:!0,dependsOn:["navigating","_cameraChanged"]})],l.prototype,"stationary",null);d.__decorate([c.property()],l.prototype,"_cameraChanged",void 0);d.__decorate([c.property()],l.prototype,"cameraController",null);return l=d.__decorate([c.subclass("esri.views.3d.state.ViewState")],l)}(l);a.default=n;var q=new r.default,v={camera:null},w={camera:null}})},"esri/views/3d/support/PropertiesPool":function(){define(["require",
"exports","../../../core/ReentrantObjectPool","../../../core/accessorSupport/watch"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.PropertiesPool=void 0;n=function(){function a(a,c){var e=this;this.owner=c;this.properties={};this.afterDispatchHandle=null;for(var m in a)c=new d.ReentrantObjectPool(a[m],null,null,2,2),this.properties[m]={pool:c,acquired:[]};this.afterDispatchHandle=l.afterDispatch(function(){return e.release()})}a.prototype.destroy=function(){this.afterDispatchHandle&&
(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(var a in this.properties){for(var c=this.properties[a],d=0,m=c.acquired;d<m.length;d++){var f=m[d];l.isValueInUse(f)||c.pool.release(f)}c.pool.destroy();c.pool=null;c.acquired=null}this.owner=this.properties=null};a.prototype.get=function(a){var c=this.owner._get(a);a=this.properties[a];var d=a.pool.acquire();for(a.acquired.push(d);d===c;)a.acquired.push(d),d=a.pool.acquire();return d};a.prototype.release=function(){for(var a in this.properties){for(var c=
this.properties[a],d=0,m=0,f=c.acquired;m<f.length;m++){var b=f[m];l.isValueInUse(b)?c.acquired[d++]=b:c.pool.release(b)}c.acquired.length=d}};return a}();a.PropertiesPool=n;a.default=n})},"esri/views/3d/state/ViewStateManager":function(){define("require exports tslib ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/scheduling ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H){Object.defineProperty(a,"__esModule",{value:!0});a.ViewStateManager=void 0;var J=h.getLogger("esri.views.3d.state.ViewStateManager");n=function(a){function e(b){b=a.call(this,b)||this;b.propertiesPool=new G.default({frustum:B.default},b);b.handles=new c;b.cameraSetByUser=!1;b.internalSetOrder=[];b.gotoOperation=null;b.ready=!1;b.updateDevicePixelRatio=null;return b}d.__extends(e,a);Object.defineProperty(e.prototype,"camera",{get:function(){if(!this.ready)return this._get("camera");
var a=E.internalToExternal(this.view,this.view.state.camera),b=this._get("camera");return a&&b&&a.equals(b)?b:a},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(E.externalToInternal(this.view,a),{applyConstraints:!1})||J.error("#camera\x3d","Invalid camera",a)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",
a)||(a?this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.update():J.error("#center\x3d","Invalid center",a):J.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):J.error("#center\x3d","Center may not be null or undefined"))},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"extent",
{get:function(){return this.ready?E.toExtent(this.view,this.view.state.camera,this.view.pointsOfInterest.centerOnContent.renderLocation):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||J.error("#extent\x3d","Invalid extent",a):J.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+
")",a):J.error("#extent\x3d","Extent may not be null or undefined"))},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,
"scale",{get:function(){if(!this.ready)return this._get("scale");var a=this.view.pointsOfInterest.centerOnContent;return E.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||J.error("#scale\x3d","Invalid scale",a)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var a=this.view.state.camera,
b=a.padding,c=a.pixelRatio,a=this._get("padding"),d=Math.round(b[0]/c),e=Math.round(b[1]/c),f=Math.round(b[2]/c),b=Math.round(b[3]/c);return null!=a&&a.top===d&&a.right===e&&a.bottom===f&&a.left===b?a:{top:d,right:e,bottom:f,left:b}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(this.paddingToArray(a,this.view.state.camera.pixelRatio,R),this.view.state.updateCamera(function(a){return a.padding=R}))},enumerable:!1,configurable:!0});e.prototype.paddingToArray=function(a,b,c){a?t.vec4.set(c,
a.top||0,a.right||0,a.bottom||0,a.left||0):t.vec4.set(c,0,0,0,0);for(a=0;4>a;a++)c[a]=Math.round(c[a]*b)};Object.defineProperty(e.prototype,"screenCenter",{get:function(){var a=this.padding;return b.createScreenPoint((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"viewpoint",{get:function(){return this.ready?F.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",
a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),{applyConstraints:!a.camera})||J.error("#viewpoint\x3d","Invalid viewpoint",a);else{var b=a.camera?a.camera.position:a.targetGeometry,b=b&&b.spatialReference;J.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(b?b.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else J.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,
"zoom",{get:function(){return this.ready?E.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||J.error("#zoom\x3d","Invalid zoom",a)},enumerable:!1,configurable:!0});e.prototype.initialize=function(){var a=this;this.handles.add([this.view.state.watch("camera",function(b){return a.cameraChangedSync(b)},!0),g.on(this.view,"state.events","before-camera-change",function(b){return a.updateElevation(b.camera)})]);
g.once(this.view.state,"camera",function(b){return a.updateElevation(b)},!0);this.handles.add(f.addFrameTask({prepare:function(){return a.prepareFrame()}}));this.handles.add(this.view.state.watch("cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(O)}));this.handles.add(g.on(this.view,"state.events","camera-projection-changed",function(){return a.notifyChange("scale")}))};e.prototype.destroy=function(){this.deinit();this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&
(this.propertiesPool.destroy(),this.propertiesPool=null)};e.prototype.init=function(){var a=this;this.constraintsManager=new x.default({view:this.view});this.prepareFrame();var b=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(var c=0;c<b.length;c++){var d=b[c];this.set(d.name,d.value)}this.cameraSetByUser||((b=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(b)?this.setInitialView(b):2===this.view.state.mode&&this.handles.add(g.whenOnce(this.view.basemapTerrain,
"ready",function(){a.handles.remove(O);a.setInitialView(a.view.groundExtent)}),O))};e.prototype.deinit=function(){this.cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(O),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};e.prototype.goTo=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c;
return d.__generator(this,function(e){c=d.__assign({animate:!0},b);this.gotoOperation=m.isSome(this.gotoOperation)?this.gotoOperation.goTo(a,c):new A.GoToOperation(a,c,this.view);return[2,this.gotoOperation]})})};e.prototype.debugSetCameraOnContent=function(){this.setStateCamera(z.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};e.prototype.step=function(a){var b=this.view.state,c=b&&this.view.state.cameraController;c&&(b.updateCamera(function(b){c.stepController(a,b)}),c.steppingFinished&&
c.finishController())};e.prototype.cancelGoToOperation=function(){m.isSome(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)};e.prototype.getInitialProperties=function(){for(var a=new Set,b=[],c=0,d=K;c<d.length;c++){var e=d[c],f=e.propertyName,e=e.overrides,g=a.has(f),h=this._isOverridden(f);!g&&h&&b.push({name:f,value:this._get(f)});this._clearOverride(f);(g||h)&&e.forEach(function(b){return a.add(b)})}return b};e.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser)if(a instanceof
l)this.setStateCamera(E.externalToInternal(this.view,a),{applyConstraints:!1});else if(a instanceof k)if(a.targetGeometry instanceof r){var b=E.fromExtent(this.view,a.targetGeometry,0,.5,0);this.setStateCamera(E.externalToInternal(this.view,b),{applyConstraints:!0})}else b={applyConstraints:!a.camera},a=this.viewpointToCamera(a),this.setStateCamera(a,b);else b=E.fromExtent(this.view,a,0,.5,0),this.setStateCamera(E.externalToInternal(this.view,b),{applyConstraints:!0})};e.prototype.updatePropertyBeforeReady=
function(a,b){if(!this.ready){this._override(a,b);var c=this.internalSetOrder.indexOf(a);-1!==c&&(this.internalSetOrder=this.internalSetOrder.splice(c,1));b&&(this.internalSetOrder.push(a),-1!==I.indexOf(a)&&this._override("hasInitialView",!0));return!0}return!1};e.prototype.isCompatible=function(a){return a?a instanceof k?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof l?this.isCompatible(a.position):a.spatialReference&&v.canProject(a.spatialReference,this.view.spatialReference):
!1};e.prototype.getPreservingHeadingTilt=function(a){void 0===a&&(a=L);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};e.prototype.centerPointAtDistanceToCamera=function(a,b,c){void 0===c&&(c=Q);var d=this.getPreservingHeadingTilt();return(a=E.getObserverForPointAtDistance(this.view,d.heading,d.tilt,a,b,1))?(c.copyFrom(this.view.state.camera),c.eye=a.eye,c.center=a.center,c.up=a.up,c):null};e.prototype.centerToCamera=function(a){var b=
this.view.pointsOfInterest.centerOnContent;b.update();return this.centerPointAtDistanceToCamera(a,b.distance)};e.prototype.extentToCamera=function(a){var b=this.getPreservingHeadingTilt();a=E.fromExtent(this.view,a,b.heading,b.tilt,1,M);return E.externalToInternal(this.view,a)};e.prototype.scaleToCamera=function(a){if(null==a)return null;var b=this.view.pointsOfInterest.centerOnContent;b.update();var c=b.renderLocation;a=E.scaleToDistance(this.view,a,b.location.latitude);return this.centerPointAtDistanceToCamera(c,
a)};e.prototype.zoomToCamera=function(a){return this.scaleToCamera(E.zoomToScale(this.view,a))};e.prototype.viewpointToCamera=function(a){return(a=F.toCamera(this.view,a))?E.externalToInternal(this.view,a):null};e.prototype.setStateCamera=function(a,b){var c=this;if(!a||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;b.doNotCancelGoToOperation||this.cancelGoToOperation();this.view.state.updateCamera(function(d){b.positionAndOrientationOnly?(d.eye=a.eye,d.center=a.center,
d.up=a.up):d.copyFrom(a);b.applyConstraints&&w.applyAll(c.view,d)});b.applyConstraints||(this.view.state.cameraController=new C.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};e.prototype.prepareFrame=function(){var a=this.view,b=a.container,c=a.canvas;if(b&&c){m.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var a=this.view.pixelRatio,d=Math.round(b.clientWidth*a),b=Math.round(b.clientHeight*a);if(0!==d&&0!==b){if(c.width!==d||c.height!==b)c.width=
d,c.height=b;this.view.state&&(c=this.view.state.camera,c.fullWidth!==d||c.fullHeight!==b||c.pixelRatio!==a)&&(Q.copyFrom(c),Q.pixelRatio!==a&&(this.paddingToArray(this.padding,a,R),Q.padding=R),Q.fullWidth=d,Q.fullHeight=b,Q.pixelRatio=a,this.view.state.camera=Q)}}};e.prototype.updateElevation=function(a){var b=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,c=this.view.renderCoordsHelper.getAltitude(a.eye),b=b?z.surfaceElevationBelowEye(this.view,a):0;a.relativeElevation=c-b};
e.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};d.__decorate([p.property({type:l,dependsOn:["view.state.camera","ready"]})],e.prototype,"camera",null);d.__decorate([p.property({type:q,dependsOn:["view.pointsOfInterest.centerOnContent.location","ready"]})],e.prototype,"center",null);d.__decorate([p.property({type:r,dependsOn:["view.state.camera","ready","view.pointsOfInterest.centerOnContent.location"]})],e.prototype,"extent",null);d.__decorate([p.property({readOnly:!0,
dependsOn:["view.state.camera","ready"]})],e.prototype,"frustum",null);d.__decorate([p.property({readOnly:!0,dependsOn:["view.map.initialViewProperties?.viewpoint"]})],e.prototype,"hasInitialView",null);d.__decorate([p.property({readOnly:!0,type:Boolean})],e.prototype,"ready",void 0);d.__decorate([p.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],type:Number})],e.prototype,"scale",null);d.__decorate([p.property({dependsOn:["view.state.camera","ready"]})],e.prototype,
"padding",null);d.__decorate([p.property({readOnly:!0,dependsOn:["view.width","view.height","padding"]})],e.prototype,"screenCenter",null);d.__decorate([p.property({constructOnly:!0})],e.prototype,"view",void 0);d.__decorate([p.property({type:k,dependsOn:["camera","ready"]})],e.prototype,"viewpoint",null);d.__decorate([p.property({type:Number,dependsOn:["scale"]})],e.prototype,"zoom",null);d.__decorate([p.property({constructOnly:!0})],e.prototype,"updateDevicePixelRatio",void 0);return e=d.__decorate([p.subclass("esri.views.3d.state.ViewStateManager")],
e)}(e);a.ViewStateManager=n;var I="camera viewpoint extent scale center zoom".split(" "),K=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],L={heading:0,tilt:0},M=new l,Q=new H.default,R=u.vec4f64.create(),O="pending-initial-view";a.default=n})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p){Object.defineProperty(a,"__esModule",{value:!0});a.ConstraintsManager=void 0;n=function(a){function l(b){var c=a.call(this,b)||this;c._handles=new k;c.nearFarHeuristic=g.createNearFarHeuristic(b.view.state.mode,b.view.basemapTerrain,b.view.renderCoordsHelper.spatialReference);return c}d.__extends(l,a);l.prototype.initialize=function(){var a=this;this._handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a._clipDistanceNearFarChanged()}),
this.view.watch("constraints.clipDistance.mode",function(){return a._updateNearFar()}),this.view.state.events.on("before-camera-change",function(b){return a._updateCameraNearFar(b.camera)}),this.view.watch("dataExtent",function(){return a._updateNearFar()},!0),this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a._updateAltitude()},!0),this.view.watch("constraints.tilt.max",function(){return a._updateTiltMax()},!0),this.view.watch("constraints.tilt.mode",function(){return a._updateTilt()},
!0),this.view.watch("state.camera",function(){return a._updateTiltAutoMax()},!0),this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],function(){return a._updateCollision()},!0)]);this.view.state.isLocal&&this._handles.add(h.init(this.view,"dataExtent",function(b){return a._updateLocalSurfaceDistance(b)}));this._updateNearFar();2!==this.view.state.mode&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new p.default({view:this.view}))};
l.prototype.destroy=function(){this._handles=c.destroyMaybe(this._handles);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};l.prototype._clipDistanceNearFarChanged=function(){var a=this,b=this.view.constraints&&this.view.constraints.clipDistance;b&&"auto"!==b.mode&&this.view.state.updateCamera(function(c){a._updateCameraNearFarManual(c,b);return!0})};l.prototype._updateNearFar=function(){var a=this;this.view.state.updateCamera(function(b){a._updateCameraNearFar(b);
return!0})};l.prototype._updateCameraNearFar=function(a){var b=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(b?b.mode:"auto")?this._updateCameraNearFarManual(a,b):this._updateCameraNearFarAuto(a,b)};l.prototype._updateCameraNearFarAuto=function(a,c){this.nearFarHeuristic.compute(a.eye,a.center,this.view.dataExtent,b.surfaceElevationBelowEye(this.view,a),a);c&&c.autoUpdate(a.near,a.far)};l.prototype._updateCameraNearFarManual=function(a,b){b&&(a.near=b.near,a.far=b.far)};l.prototype._updateCollision=
function(){var a=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,b=this.view.constraints&&this.view.constraints.collision.enabled,a=a?"stay-above"===a.type:b,b=this.view.state.constraints.collision;a!==b.enabled&&((b.enabled=a)&&this._reapplyConstraints(8),(a=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==a.mode||this._updateTiltAuto())};l.prototype._updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=
a&&2!==this.view.state.mode?{min:a.min,max:a.max}:null;this._reapplyConstraints()};l.prototype._updateTiltMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this._updateTiltManual(a),this._reapplyConstraints())};l.prototype._updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this._updateTiltManual(a):this._updateTiltAuto();this._reapplyConstraints()};l.prototype._updateTiltManual=function(a){var b=this.view.state.constraints;
b.tilt=b.createConstantMaxTilt(e.deg2rad(a.max))};l.prototype._updateTiltAuto=function(){var a=this.view.state.constraints;a.tilt=a.createDefaultTilt();this._updateTiltAutoMax()};l.prototype._updateTiltAutoMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var b=this.view.state.constraints;b.tilt&&(b=b.tilt(this.view.state.camera.distance).max,a.autoUpdate(e.rad2deg(b)))}};l.prototype._updateLocalSurfaceDistance=function(a){var b=Math.max(a.width,a.height);
0>=b||(a.hasZ&&(b=Math.max(b,a.zmax-a.zmin)),a=this.view.state,b=3*b/Math.atan(a.camera.fov/2),b!==a.constraints.distance&&(a.constraints.distance=b))};l.prototype._reapplyConstraints=function(a){var b=this;void 0===a&&(a=15);this.view.state.updateCamera(function(c){return f.applyAll(b.view,c,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})})};d.__decorate([m.property({constructOnly:!0})],l.prototype,"view",void 0);d.__decorate([m.property({readOnly:!0})],
l.prototype,"surfaceCollisionConstraint",void 0);return l=d.__decorate([m.subclass("esri.views.3d.state.ConstraintsManager")],l)}(l);a.ConstraintsManager=n;a.default=n})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../core/mathUtils ../../../core/mathUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/geodesicConstants".split(" "),function(n,a,d,l,k,e,c,h){function m(a,b,c,d){c=p/c;a/
b>c?(d.far=a,d.near=d.far/b):(d.near=c,d.far=d.near*b);return d}Object.defineProperty(a,"__esModule",{value:!0});a.createNearFarHeuristic=void 0;a.createNearFarHeuristic=function(a,c,d){return 1===a?new b:new f(c,d)};var f=function(){function a(a,b){this.elevationProvider=a;this.unitInMeters=k.getMetersPerUnitForSR(b)}a.prototype.compute=function(a,b,c,f,k){k||(k={near:0,far:0});var p=a[2]*this.unitInMeters,v=p;f=p-f;var w=this.elevationProvider?this.elevationProvider.elevationBounds:null;w&&(p=0<=
f?v-this.unitInMeters*w.min:this.unitInMeters*w.max-v);v=Math.max(c.xmax-c.xmin,c.ymax-c.ymin,4*Math.max(c.xmax-c.xmin,c.ymax-c.ymin));e.vec3.subtract(q,b,a);r[0]=0<q[0]?c.xmax:c.xmin;r[1]=0<q[1]?c.ymax:c.ymin;r[2]=0<q[2]?v/2:-v/2;e.vec3.subtract(r,r,a);e.vec3.normalize(q,q);a=1.1*e.vec3.dot(r,q)*this.unitInMeters;b=Math.sqrt(p*(p+2*h.earthRadius));c=Math.max(c.xmax-c.xmin,c.ymax-c.ymin);w=c*u*this.unitInMeters;p=d.clamp((p-w)/(c*t*this.unitInMeters-w),0,1);p=l.lerp(b,a,p*p*p);p*=Math.max(Math.log(Math.abs(f)),
1);p=Math.min(p,Math.max(34064E4,v));p/=this.unitInMeters;return m(p,g,this.unitInMeters,k)};return a}(),b=function(){function a(){}a.prototype.compute=function(a,b,c,f,g){g||(g={near:0,far:0});a=e.vec3.length(a)-h.earthRadius;a=Math.max(Math.abs(a-f),Math.abs(a));f=Math.sqrt(a*(a+2*(h.earthRadius+Math.min(0,f))));a=d.clamp(2E4-(Math.log(a)-7.983)/9.011*19E3,1E3,2E4);return m(1.2*f,a,1,g)};return a}(),g=2E4,p=2,t=.001,u=1E-4,r=c.vec3f64.create(),q=c.vec3f64.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.SurfaceCollisionConstraint=void 0;n=function(a){function f(b){b=a.call(this,b)||this;b.handles=new k;return b}d.__extends(f,a);f.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}))};f.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};f.prototype.handleElevationChangeEvent=function(a){this.view.state.cameraController||
h.eyeWithinExtent(this.view,this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};f.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(b){c.applySurfaceCollisionConstraint(a.view,b,1)})};d.__decorate([e.property({constructOnly:!0})],f.prototype,"view",void 0);return f=d.__decorate([e.subclass("esri.views.3d.state.ElevationCollisionConstraint")],f)}(l);a.SurfaceCollisionConstraint=n;a.default=n})},"esri/views/3d/state/GoToOperation":function(){define("require exports ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../camera/constraintUtils ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils ../../animation/easing".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){Object.defineProperty(a,"__esModule",{value:!0});a.GoToOperation=void 0;n=function(){function a(a,b,d){var f=this;this.target=a;this.options=b;this.view=d;this.state="pending";this.animationController=this.abortController=null;this.promise=c.create(function(a,b){f.resolveCallback=a;f.rejectCallback=b;a=c.createAbortController();if(e.isSome(f.options.signal))c.onAbort(f.options.signal,function(){f.abort()});f.abortController=a;f.waitForReady()})}a.prototype.then=
function(a,b){return this.promise.then(a,b)};a.prototype.catch=function(a){return this.promise.catch(a)};a.prototype.resolve=function(a){this.state="finished";return this.resolveCallback(a)};a.prototype.reject=function(a){this.state="finished";return this.rejectCallback(a)};a.prototype.goTo=function(b,c){switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":c.animate&&this.options.animate?this.reject(new k("AbortError")):this.abort()}return new a(b,
c,this.view)};a.prototype.waitForReady=function(){var a=this;this.state="wait-for-ready";this.view.stateManager.view.ready?this.createViewPoint():h.whenOnce(this.view.stateManager.view,"ready",this.abortController.signal).then(function(){a.createViewPoint()},function(b){a.reject(b)})};a.prototype.createViewPoint=function(){var a=this;"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this.getAnimationController():null,p.create(this.view.stateManager.view,
this.target,this.abortController.signal).then(function(b){"finished"!==a.state&&(b=a.getCameraFromViewpoint(b),e.isNone(b)||(a.options.animate?e.isNone(a.animationController)||a.startAnimation(b,a.animationController):(a.view.stateManager.setStateCamera(b.camera,{applyConstraints:!b.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),a.resolve())))},function(b){a.reject(b)}))};a.prototype.internalAnimateOptions=function(a){var b={};a&&(null!=a.speedFactor&&(b.speedFactor=
a.speedFactor),null!=a.duration&&(b.duration=a.duration/1E3),null!=a.maxDuration&&(b.maxDuration=a.maxDuration/1E3),null!=a.easing&&(b.easing="string"===typeof a.easing?t.named[a.easing]:a.easing));return b};a.prototype.getCameraFromViewpoint=function(a){var b=!!(this.target instanceof l&&this.target.camera||this.target instanceof d),c=a.camera;if(!this.view.stateManager.isCompatible(c))return a=(a=c.position)&&a.spatialReference,this.reject(new k("GotoAnimation:incompatible-spatialreference","Resulting camera has an incompatible spatial reference (camera: "+
(a?a.wkid:"none")+", view: "+this.view.stateManager.view.spatialReference.wkid+")",{camera:c})),null;c=g.externalToInternal(this.view.stateManager.view,c);return c?{viewpoint:a,camera:c,isFullySpecified:b}:(this.reject(new k("GotoAnimation:invalid-camera","Resulting camera is invalid")),null)};a.prototype.startAnimation=function(a,c){var d=this;this.state="wait-for-animation-finish";var g=c.viewAnimation;if(e.isNone(g))this.reject(new k("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));
else{g.update(a.viewpoint,"running");var h=function(){return d.view.stateManager.view.state.cameraController===c&&e.isSome(c.viewAnimation)&&c.viewAnimation.target===a.viewpoint&&c.active};if(h()){var l;a.isFullySpecified?(l=new b.SurfaceCollisionCorrectionController({view:this.view.stateManager.view,desiredCamera:a.camera}),m.applySurfaceCollisionConstraint(this.view.stateManager.view,a.camera,1)):m.applyAll(this.view.stateManager.view,a.camera);c.begin(a.camera,this.internalAnimateOptions(this.options));
var p=function(){var b=d.view.stateManager.view.state.cameraController;l&&(b&&b.active?b instanceof f.PointToPointAnimationController&&e.isSome(b.viewAnimation)&&b.viewAnimation.target===a.viewpoint&&(d.view.stateManager.view.state.cameraController=l):e.isSome(c.viewAnimation)&&c.viewAnimation.target===a.viewpoint&&"finished"===c.state&&(d.view.stateManager.view.state.cameraController=l))};g.when(p,function(a){e.isNone(d.view.stateManager.view.state)||(p(),h()&&d.reject(a))});c.asyncResult={resolve:function(){d.resolve()},
reject:function(a){e.isNone(d.view.stateManager.view.state)||h()&&d.reject(a)}}}}};a.prototype.getAnimationController=function(){var a,b=null,b=this.view.stateManager.view.state.cameraController;b instanceof f.PointToPointAnimationController&&(b.updateStateFromViewAnimation(),b.active&&(a=b,b=a.viewAnimation));return null!=a||(a=new f.PointToPointAnimationController({view:this.view.stateManager.view,mode:"animation"}),b=a.viewAnimation,this.view.stateManager.view.state.switchCameraController(a))?
a:(e.isSome(b)&&b.stop(),this.reject(new k("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)};a.prototype.abort=function(){switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":this.reject(new k("AbortError"));break;case "wait-for-animation-finish":e.isSome(this.animationController)&&this.view.stateManager.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),
this.reject(new k("AbortError"))}};return a}();a.GoToOperation=n})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports tslib ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.SurfaceCollisionCorrectionController=void 0;n=function(a){function f(b){b=a.call(this,
b)||this;b.handles=new l;return b}d.__extends(f,a);Object.defineProperty(f.prototype,"desiredCamera",{set:function(a){this._set("desiredCamera",a.clone())},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"canStop",{get:function(){return!0},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!1,configurable:!0});f.prototype.onControllerStart=function(){var a=this;this.state=
h.State.Running;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}));this.applyCorrection()};f.prototype.onControllerEnd=function(){this.handles.removeAll()};f.prototype.stepController=function(){};f.prototype.handleElevationChangeEvent=function(a){c.eyeWithinExtent(this.view,this.desiredCamera,a.extent,a.spatialReference)&&this.applyCorrection()};f.prototype.applyCorrection=function(){var a=this;this.view.state.updateCamera(function(b){b.copyViewFrom(a.desiredCamera);
e.applySurfaceCollisionConstraint(a.view,b,1)||a.constraintEnabled||(a.state=h.State.Stopped)})};d.__decorate([k.property({constructOnly:!0})],f.prototype,"view",void 0);d.__decorate([k.property({constructOnly:!0})],f.prototype,"desiredCamera",null);return f=d.__decorate([k.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],f)}(h.CameraController);a.SurfaceCollisionCorrectionController=n})},"esri/views/3d/support/viewpointUtils":function(){define("require exports tslib ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/compilerUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ./geometryUtils ./mathUtils ./pointUtils ./projectionUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F){function H(a){return 360-E.cyclicalDeg.normalize(a)}function J(a){return E.cyclicalDeg.normalize(360-a)}function I(a,b){a&&a.resolver&&(null==b?a.resolver.reject():a.resolver.resolve(b));return b}function K(a,b,c,d){if(!b)return I(d);var e=a.spatialReference||k.SpatialReference.WGS84;if(b.camera){a=b.get("camera.position.spatialReference");if(!z.canProject(a,e))return I(d);b=b.camera.clone();a.equals(e)||(b.position=z.project(b.position,
e));return I(d,b)}var f=b.get("targetGeometry.spatialReference");if(f&&!z.canProject(f,e))return I(d);e=B.internalToExternal(a,a.state.camera);f=1;null!=b.rotation&&(e.heading=H(b.rotation),f=0);null!=c&&(e.tilt=c);if("point"===b.targetGeometry.type){c=b.targetGeometry;var g=void 0,h=b.targetGeometry.clone(),g=null!=b.scale?B.scaleToDistance(a,b.scale,c.latitude):a.state.camera.distance;return B.fromCenterDistance(a,h,g,e,f,d)}return B.fromExtent(a,b.targetGeometry.extent,e.heading,e.tilt,f,d)}function L(a,
b){return null==b.scale&&null!=b.zoom?B.zoomToScale(a,b.zoom):b.scale}function M(a,b){var c=!1;null!=b.heading?(a.heading=b.heading,c=!0):null!=b.rotation&&(a.heading=H(b.rotation),c=!0);null!=b.tilt&&(a.tilt=b.tilt,c=!0);null!=b.fov&&(a.fov=b.fov);return c}function Q(a,b,c){var d=a.spatialReference||k.SpatialReference.WGS84;b=b||B.externalToInternal(a,c.camera);c.targetGeometry=G.vectorToPoint(b.center,a.renderSpatialReference,d);c.scale=B.computeScale(a,b);c.rotation=J(c.camera.heading);return c}
function R(a,b,c){if(b){if(!z.canProject(b.spatialReference,a.spatialReference))throw new f("viewpointutils:incompatible-spatialreference","Spatial reference ("+(b.spatialReference?b.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:b});var d=[];if(!b.hasZ&&a.basemapTerrain){var e=void 0;switch(b.type){case "point":e=b;break;case "multipoint":case "polyline":case "mesh":e=b.extent.center;break;case "extent":e=b.center;break;case "polygon":e=
b.centroid;break;default:m.neverReached(b)}e&&z.canProject(e,a.basemapTerrain.spatialReference)?X[2]=A.getElevationAtPoint(a.elevationProvider,e)||0:X[2]=0}(0,pa[b.type])(b,function(a){d.push(a[0],a[1],a[2])},X);var g=d.length/3;if(0!==g&&(e=Array(d.length),F.bufferToBuffer(d,b.spatialReference,0,e,a.spatialReference,0,g)))for(b.hasZ&&(c.hasZ=!0),a=0;a<e.length;a+=3)b.hasZ?(X[0]=e[a+0],X[1]=e[a+1],X[2]=e[a+2]):(X[0]=e[a+0],X[1]=e[a+1]),v.expand(c.boundingBox,X)}}function O(a,c,e,f){return d.__awaiter(this,
void 0,void 0,function(){var g,m,k,l,p,r;return d.__generator(this,function(d){switch(d.label){case 0:return[4,h.result(a.whenViewForGraphic(c))];case 1:g=d.sent();if(!1===g.ok||b.isNone(g.value)||!("whenGraphicBounds"in g.value))return R(a,c.geometry,f),[2];m=g.value;return[4,h.result(m.whenGraphicBounds(c,{minDemResolution:e}))];case 2:k=d.sent();if(!1===k.ok)return R(a,c.geometry,f),[2];l=k.value;p=l.screenSpaceObjects;r=l.boundingBox;v.expand(f.boundingBox,r);p&&p.forEach(function(a){f.screenSpaceObjects.push(a)});
isFinite(r[2])&&(f.hasZ=!0);return[2]}})})}function N(a,b,c,f){return d.__awaiter(this,void 0,void 0,function(){var h,m;return d.__generator(this,function(d){switch(d.label){case 0:return Array.isArray(b)&&2===b.length&&(h=b[0],m=b[1],"number"===typeof h&&"number"===typeof m)?(ja.x=h,ja.y=m,ja.z=void 0,ja.spatialReference=a.spatialReference.isGeographic?a.spatialReference:k.SpatialReference.WGS84,R(a,ja,f),[2]):b&&"function"===typeof b.map?[4,g.eachAlways(b.map(function(b){return N(a,b,c,f)}))]:[3,
2];case 1:return d.sent(),[2];case 2:if(!(b instanceof k.BaseGeometry))return[3,3];R(a,b,f);return[3,5];case 3:return b instanceof e?[4,O(a,b,c,f)]:[3,5];case 4:d.sent(),d.label=5;case 5:return[2]}})})}function S(a,b,c,e,f){return d.__awaiter(this,void 0,void 0,function(){var g,h,m;return d.__generator(this,function(d){switch(d.label){case 0:if(b.camera)return[2,P(a,b.camera,f)];f.scale=b.scale;f.rotation=b.rotation;f.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;f.camera=null;null!=
c.heading?f.rotation=J(c.heading):null!=c.rotation&&(f.rotation=c.rotation);g=L(a,c);null!=g&&(f.scale=g);h=B.createAsyncContext(e);K(a,f,c.tilt,h);m=f;return[4,h.resolver.promise];case 1:return m.camera=d.sent(),[2,f]}})})}function P(a,b,c){c.camera=b.clone();c.camera.fov=a.camera.fov;b=a.spatialReference;var d=c.camera.position.spatialReference;if(!z.canProject(d,b))return null;d.equals(b)||(c.camera.position=z.project(c.camera.position,b));return Q(a,null,c)}function U(a,b,c,e,g){return d.__awaiter(this,
void 0,void 0,function(){var h,m,l,p,t,q;return d.__generator(this,function(d){switch(d.label){case 0:if(!c)throw new f("createfromcenter","invalid point");g.targetGeometry=c.clone();h=x.cameraOnContentAlongViewDirection(a);if(b.position){d=g.targetGeometry;var u=h,v=a.renderSpatialReference;G.pointToVector(b.position,da,v);G.pointToVector(d,fa,v);g.targetGeometry=new k.Point(d);g.camera.position=new k.Point(b.position);r.vec3.subtract(ha,fa,da);B.directionToHeadingTilt(a,da,ha,u.up,g.camera);g.scale=
B.distanceToScale(a,r.vec3.distance(da,fa),g.targetGeometry.latitude);g.rotation=J(g.camera.heading);return[2,g]}b.zoomFactor&&(m=h.distance/b.zoomFactor,l=r.vec3.scale(X,h.viewForward,-m),r.vec3.add(h.eye,h.center,l),h.markViewDirty(),g.scale=B.distanceToScale(a,m,c.latitude));B.internalToExternal(a,h,g.camera);p=M(g.camera,b)?0:1;if(b.zoomFactor)return[3,2];g.scale=L(a,b);null==g.scale&&(G.pointToVector(c,X,a.renderSpatialReference),C.frustum.intersectsPoint(h.frustum.planes,X)?g.scale=B.distanceToScale(a,
r.vec3.distance(h.eye,X),c.latitude):g.scale=B.computeScale(a,h));t=B.createAsyncContext(e);B.fromCenterScale(a,g.targetGeometry,g.scale,g.camera,p,t);q=g;return[4,t.resolver.promise];case 1:q.camera=d.sent(),d.label=2;case 2:return[2,g]}})})}function Z(a,b,c,e){return d.__awaiter(this,void 0,void 0,function(){var f,g;return d.__generator(this,function(d){f=x.cameraOnContentAlongViewDirection(a);g=G.vectorToPoint(f.center,a.renderSpatialReference,a.spatialReference,ja);return[2,U(a,b,g,c,e)]})})}
function V(a,b,c,e,f){return d.__awaiter(this,void 0,void 0,function(){var g,h,m,k;return d.__generator(this,function(d){switch(d.label){case 0:return f.targetGeometry=c.clone(),g=x.cameraOnContentAlongViewDirection(a),B.internalToExternal(a,g,f.camera),h=M(f.camera,b)?0:1,m=B.createAsyncContext(e),B.fromExtent(a,c,f.camera.heading,f.camera.tilt,h,m),k=f,[4,m.resolver.promise];case 1:return k.camera=d.sent(),[2,f]}})})}function T(a,b,c,e,f,g,h){return d.__awaiter(this,void 0,void 0,function(){var m,
k,l,t,q;return d.__generator(this,function(d){switch(d.label){case 0:h.targetGeometry=c.clone();d=m=x.cameraOnContentAlongViewDirection(a);var u=0;c.hasZ?u=c.z:a.basemapTerrain&&(u=A.getElevationAtPoint(a.elevationProvider,c));r.vec3.set(X,c.x,c.y,u);F.computeLinearTransformation(a.spatialReference,X,ca,a.renderSpatialReference);p.mat3.fromMat4(ba,ca);p.mat3.transpose(ba,ba);v.empty(ga);for(var w=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],z=0;z<w.length;z++){var n=w[z],C=e[n[2]];
isFinite(C)||(C=u);r.vec3.set(X,e[n[0]],e[n[1]],C);F.vectorToVector(X,a.spatialReference,X,a.renderSpatialReference);v.expand(ga,r.vec3.transformMat3(X,X,ba))}u=v.width(ga);w=v.height(ga);z=v.depth(ga);n=1/Math.tan(d.fovY/2);k=Math.max(.5*Math.sqrt(u*u+z*z)*Math.max(n,1/Math.tan(d.fovX/2))+.5*w,.5*w*n+.5*Math.max(u,z))/f;B.internalToExternal(a,m,h.camera);l=M(h.camera,b)?0:1;h.scale=B.distanceToScale(a,k,h.targetGeometry.latitude);t=B.createAsyncContext(g);B.fromCenterScale(a,h.targetGeometry,h.scale,
h.camera,l,t);q=h;return[4,t.resolver.promise];case 1:return q.camera=d.sent(),[2,h]}})})}function Y(a){a&&(a.rotation=J(a.camera.heading));return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=a.fromCamera=a.fromInternalCamera=a.toCamera=a.headingToRotation=a.rotationToHeading=void 0;a.rotationToHeading=H;a.headingToRotation=J;a.toCamera=K;a.fromInternalCamera=function(a,b,d){d||(d=new c({camera:new l}));B.internalToExternal(a,b,d.camera);return Q(a,b,d)};a.fromCamera=function(a,b,d){d||
(d=new c);d.camera=b.clone();return Q(a,null,d)};a.create=function(a,b,e){return d.__awaiter(this,void 0,void 0,function(){var g,h,m,p,t,q,u,z,n,A,C,E,F;return d.__generator(this,function(d){switch(d.label){case 0:if(b&&a.spatialReference){d={target:null};if("declaredClass"in b||Array.isArray(b))d.target=b;else{for(var H in b)d[H]=b[H];b.center&&!d.target&&(d.target=b.center)}g=d}else g=null;if(!g)throw new f("viewpointutils-create:no-target","Missing target for creating viewpoint");h=new c({camera:new l({fov:a.camera.fov})});
return g.target instanceof c?[4,S(a,g.target,g,e,h)]:[3,2];case 1:return m=d.sent(),[2,Y(m)];case 2:if(g.target instanceof l)return[2,Y(P(a,g.target,h))];p=null!=g.scale||null!=g.zoom;if(!(g.target instanceof k.Extent))return[3,6];t=g.target.xmin===g.target.xmax||g.target.ymin===g.target.ymax;if(!p&&!t)return[3,4];q=Y;return[4,U(a,g,g.target.center,e,h)];case 3:return[2,q.apply(void 0,[d.sent()])];case 4:return u=Y,[4,V(a,g,g.target,e,h)];case 5:return[2,u.apply(void 0,[d.sent()])];case 6:return z=
{boundingBox:v.empty(),hasZ:!1,screenSpaceObjects:[]},n=p?B.scaleToResolution(a,L(a,g)):void 0,[4,N(a,g.target,n,z)];case 7:d.sent();if(!isFinite(z.boundingBox[0]))return[3,11];v.center(z.boundingBox,X);ja.x=X[0];ja.y=X[1];ja.z=X[2];ja.spatialReference=a.spatialReference;t=void 0;isFinite(ja.z)&&z.hasZ?t=v.isPoint(z.boundingBox):(ja.z=void 0,t=w.isPoint(v.toRect(z.boundingBox,ia)));if(!p&&!t)return[3,9];A=Y;return[4,U(a,g,ja,e,h)];case 8:return[2,A.apply(void 0,[d.sent()])];case 9:H=z.screenSpaceObjects;
if(H.length){d=Number.NEGATIVE_INFINITY;for(var I=0;I<H.length;I++){var G=H[I].screenSpaceBoundingRect;d=Math.max(d,Math.abs(G[0]),Math.abs(G[1]),Math.abs(G[2]),Math.abs(G[3]))}C=.66-d/Math.min(a.width,a.height)*2}else C=.66;E=Y;return[4,T(a,g,ja,z.boundingBox,C,e,h)];case 10:return[2,E.apply(void 0,[d.sent()])];case 11:if(g.position)return H=g,d=h,I=x.cameraOnContentAlongViewDirection(a),r.vec3.copy(ha,I.viewForward),B.directionToHeadingTilt(a,I.eye,ha,I.up,ka),d.camera.position=new k.Point(H.position),
d.camera.heading=null!=H.heading?H.heading:ka.heading,d.camera.tilt=null!=H.tilt?H.tilt:ka.tilt,H=Q(a,null,d),[2,Y(H)];F=Y;return[4,Z(a,g,e,h)];case 12:return[2,F.apply(void 0,[d.sent()])]}})})};var X=q.vec3f64.create(),ca=u.mat4f64.create(),ba=t.mat3f64.create(),ga=v.create(),ia=w.create(),ha=q.vec3f64.create(),da=q.vec3f64.create(),fa=q.vec3f64.create(),ka={heading:0,tilt:0},ja=new k.Point,pa={point:function(a,b,c){c[0]=a.x;c[1]=a.y;a.hasZ&&(c[2]=a.z);b(c)},polygon:function(a,b,c){for(var d=a.hasZ,
e=0;e<a.rings.length;e++)for(var f=a.rings[e],g=0;g<f.length;g++)c[0]=f[g][0],c[1]=f[g][1],d&&(c[2]=f[g][2]),b(c)},polyline:function(a,b,c){for(var d=a.hasZ,e=0;e<a.paths.length;e++)for(var f=a.paths[e],g=0;g<f.length;g++)c[0]=f[g][0],c[1]=f[g][1],d&&(c[2]=f[g][2]),b(c)},multipoint:function(a,b,c){var d=a.points;a=a.hasZ;for(var e=0;e<d.length;e++)c[0]=d[e][0],c[1]=d[e][1],a&&(c[2]=d[e][2]),b(c)},extent:function(a,b,c){a.hasZ?(b(r.vec3.set(c,a.xmin,a.ymin,a.zmin)),b(r.vec3.set(c,a.xmax,a.ymin,a.zmin)),
b(r.vec3.set(c,a.xmin,a.ymax,a.zmin)),b(r.vec3.set(c,a.xmax,a.ymax,a.zmin)),b(r.vec3.set(c,a.xmin,a.ymin,a.zmax)),b(r.vec3.set(c,a.xmax,a.ymin,a.zmax)),b(r.vec3.set(c,a.xmin,a.ymax,a.zmax)),b(r.vec3.set(c,a.xmax,a.ymax,a.zmax))):(b(r.vec3.set(c,a.xmin,a.ymin,c[2])),b(r.vec3.set(c,a.xmax,a.ymin,c[2])),b(r.vec3.set(c,a.xmin,a.ymax,c[2])),b(r.vec3.set(c,a.xmax,a.ymax,c[2])))},mesh:function(a,b,c){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)b(r.vec3.set(c,a[d+0],a[d+
1],a[d+2]))}}})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("require exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/stack ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils".split(" "),function(n,a,d,l,k,e,c,h,m,f,b){function g(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];b&&!b(e)||
c.push(e)}return c}function p(a){t||(t=new f.Intersector(a));t.viewingMode=a;return t}Object.defineProperty(a,"__esModule",{value:!0});a.SceneIntersectionHelper=void 0;n=function(){function a(a,b,c){this.viewingMode=a;this.layerProvider=b;this.view=c;this.externalIntersectionHandlers=new l;this.tolerance=f.Intersector.DEFAULT_TOLERANCE;this.tmpRay=h.ray.create();this.validateHUDIntersector=new f.Intersector(this.viewingMode);this.validateHUDIntersector.options.hud=!1}a.prototype.intersectScreen=function(a,
b){return this.intersectRay(this.getPickRay(a,this.tmpRay),p(this.viewingMode),b)};a.prototype.intersectScreenFreePointFallback=function(a,b){return this.intersectRayFreePointFallback(this.getPickRay(a,this.tmpRay),b)};a.prototype.intersectRayFreePointFallback=function(a,b){return this.intersectRay(a,p(this.viewingMode),b)||this.intersectRayFreePointLocal(a,b)};a.prototype.intersectRay=function(a,b,c,d){b.options.selectionMode=!1;b.options.store=0;this.computeIntersection(a,b,d);return b.results.min?
b.results.min.getIntersectionPoint(c):!1};a.prototype.getCenterRayWithSubpixelOffset=function(a,b,c,d){void 0===c&&(c=.5);void 0===d&&(d=.5);a.getRenderCenter(q,c,d);q[0]+=.0466;q[1]-=.0123;return h.ray.fromRenderAtEye(a,q,b)};a.prototype.intersectIntersectorScreen=function(a,b,c){this.computeIntersection(this.getPickRay(a,this.tmpRay),b,c)};a.prototype.intersectToolIntersectorScreen=function(a,b,c){a=this.getPickRay(a,this.tmpRay);this.intersectToolIntersectorRay(a,b,c)};a.prototype.intersectToolIntersectorRay=
function(a,b,c){b.options.selectionMode=!0;this.computeIntersection(a,b,c);var d=b.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.isOpaque()||d.hasIntersectionPoint&&"TerrainRenderer"!==d.intersector||(b.options.selectionMode=!1,this.computeIntersection(a,b,c))};a.prototype.setTolerance=function(a){void 0===a&&(a=f.Intersector.DEFAULT_TOLERANCE);this.tolerance=a};a.prototype.addIntersectionHandler=function(a){this.externalIntersectionHandlers.push(a);this.externalIntersectionHandlers.sort(function(a,
b){return"Terrain"===a.type?1:"Terrain"===b.type?-1:0})};a.prototype.removeIntersectionHandler=function(a){this.externalIntersectionHandlers.removeUnordered(a);this.externalIntersectionHandlers.sort(function(a,b){return"Terrain"===a.type?1:"Terrain"===b.type?-1:0})};a.prototype.getPickRay=function(a,b){void 0===b&&(b=h.ray.create());return h.ray.fromScreen(this.view.state.camera,a,b)};a.prototype.intersectRayFreePointLocal=function(a,b){if(2!==this.viewingMode)return!1;var c=this.view.dataExtent,
d=Math.max(c.xmax-c.xmin,c.ymax-c.ymin,8*Math.max(c.xmax-c.xmin,c.ymax-c.ymin));if(0===d)return e.vec3.add(b,a.origin,e.vec3.normalize(m.sv3d.get(),a.direction)),!0;var f=this.view.state.camera,g=Math.max(0,c.xmin-f.eye[0],f.eye[0]-c.xmax),c=Math.max(0,c.ymin-f.eye[1],f.eye[1]-c.ymax),f=d/Math.max(1,Math.pow(Math.max(0,Math.log(d/(Math.abs(f.relativeElevation)+Number.MIN_VALUE))),2)),f=Math.max(f,Math.min(Math.sqrt(g*g+c*c),d)),d=e.vec3.scale(m.sv3d.get(),a.direction,f/e.vec3.length(a.direction));
e.vec3.add(b,a.origin,d);return!0};a.prototype.intersectElevationFromScreen=function(a,b,c){void 0===c&&(c=0);return this.intersectElevation(this.getPickRay(a,this.tmpRay),b,c)};a.prototype.intersectElevation=function(a,c,g){void 0===g&&(g=0);var h=d.isSome(c)?c.mode:"absolute-height",l=d.isSome(c)?d.unwrapOr(c.offset,0):0,p="on-the-ground"!==h?l+g:0;c=p/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===h)return this.view.renderCoordsHelper.intersectManifold(a,p,r)?(g=this.view.computeMapPointFromVec3d(r),
g.z-=l,g):null;var l=this.view.state.camera,t=k.castRenderScreenPointArray3(m.sv3d.get());l.projectPoint(a.origin,t);var p=this.prepareFilters(null,u),q=this.view.slicePlane,v=d.isSome(q)?b.sliceFilterPredicate(q):null,w=new f.Intersector(this.viewingMode);w.options.store=0;w.options.verticalOffset=c;c=a.origin;a=e.vec3.add(m.sv3d.get(),c,a.direction);w.reset(c,a);w.point=t;w.camera=l;w.filterPredicate=null;switch(h){case "relative-to-scene":w.intersect(p.layers,t,l,this.tolerance,null,function(a){return a.metadata&&
a.metadata.isElevationSource});this.externalIntersectionHandlers.forEachSimple(function(a){"I3S"!==a.type&&"Terrain"!==a.type||a.intersect(w,a.slicePlane?v:null,w.rayBeginPoint,w.rayEndPoint,t)});break;case "on-the-ground":case "relative-to-ground":this.externalIntersectionHandlers.forEachSimple(function(a){a.isGround&&a.intersect(w,a.slicePlane?v:null,w.rayBeginPoint,w.rayEndPoint,t)})}return w.results.min.getIntersectionPoint(r)?(h=this.view.computeMapPointFromVec3d(r),h.z=g,h):null};a.prototype.computeIntersection=
function(a,c,f){var g=this,h=this.view.state.camera,l=k.castRenderScreenPointArray3(m.sv3d.get());h.projectPoint(a.origin,l);var p=this.prepareFilters(f,u);c.options.selectOpaqueTerrainOnly=!f||!("include"in f||"exclude"in f);var r=a.origin,t=e.vec3.add(m.sv3d.get(),a.origin,a.direction);c.reset(r,t);c.intersect(p.layers,l,h,this.tolerance);a=this.view.slicePlane;var q=d.isSome(a)?b.sliceFilterPredicate(a):null;c.intersect(p.sliceableLayers,l,h,this.tolerance,q);var v=f&&(f.requiresGroundFeedback||
f.enableDraped);this.externalIntersectionHandlers.forEachSimple(function(a){c.options.isFiltered=!p.filterLayerUid(a.intersectionHandlerId);(a.isGround&&v||!c.options.isFiltered)&&a.intersect(c,a.slicePlane?q:null,r,t,l)});a=m.sv3d.get();if(f&&f.enableDraped&&c.results.ground.getIntersectionPoint(a)){f=this.view.basemapTerrain.overlayManager.renderer;var w=this.view.renderCoordsHelper.spatialReference,n=m.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(a,n,this.view.spatialReference);n[2]=
this.view.elevationProvider.getElevation(a[0],a[1],a[2],w,"ground")||0;f.intersect(c,n,p.filterRenderGeometry)}c.sortResults();a=c.results.hud;if(a.hasIntersectionPoint){var z=k.castRenderScreenPointArray3(m.sv3d.get()),x=m.sv3d.get(),Q=m.sv3d.get();this.unprojectHUDResultRay(a.center,z,x,Q);f=e.vec3.distance(a.center,x)/e.vec3.distance(x,Q)*.99;this.validateHUDIntersector.reset(x,Q);this.validateHUDIntersector.intersect(p.layers,z,h,this.tolerance);this.validateHUDIntersector.intersect(p.sliceableLayers,
z,h,this.tolerance,q);this.externalIntersectionHandlers.forEachSimple(function(a){p.filterLayerUid(a.intersectionHandlerId)&&a.intersect(g.validateHUDIntersector,a.slicePlane?q:null,x,Q,z)});h=this.validateHUDIntersector.results.min;if(null==h.dist||f<=h.dist)c.results.min.copyFrom(a),c.results.all.splice(0,0,a)}};a.prototype.prepareFilters=function(a,b){var c=[],d=[];this.layerProvider.forEachLayer(function(a){a.isPickable&&(a.isSliceable?d:c).push(a)});b.include=a&&a.include;b.exclude=a&&a.exclude;
b.layers.length=0;b.sliceableLayers.length=0;g(c,b.filterLayer,b.layers);g(d,b.filterLayer,b.sliceableLayers);return b};a.prototype.unprojectHUDResultRay=function(a,b,c,d){var e=this.view.state.camera;e.projectPoint(a,b);a=k.castRenderScreenPointArray3(m.sv3d.get());a[0]=b[0];a[1]=b[1];a[2]=0;e.unprojectPoint(a,c);a[2]=1;e.unprojectPoint(a,d)};return a}();a.SceneIntersectionHelper=n;var t,u={include:null,exclude:null,layers:[],sliceableLayers:[],filterLayer:function(a){return u.filterLayerUid(a.apiLayerUid)},
filterLayerUid:function(a){var b=u.include,c=u.exclude;return d.isNone(a)?null==b&&null==c:(null==b||b.has(a))&&(null==c||!c.has(a))},filterRenderGeometry:function(a){return u.filterLayerUid(a.data.layerUid)}},r=c.vec3f64.create(),q=k.createRenderScreenPointArray()})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports tslib ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../layers/graphics/ElevationQuery".split(" "),
function(n,a,d,l,k,e,c,h,m){function f(a,c,d,e,f,h,m){for(var b=0;b<c.length;b++){var g=c[b].getElevation(d,e,f,h,m);null!=g&&(a=null!=a?Math.max(g,a):g)}return a}Object.defineProperty(a,"__esModule",{value:!0});a.CombinedElevationProvider=void 0;n=function(a){function b(b){b=a.call(this,b)||this;b.im=[];b.ground=[];b.scene=[];b.handles=new Map;return b}d.__extends(b,a);b.prototype.destroy=function(){this._elevationQuery=e.destroyMaybe(this._elevationQuery)};Object.defineProperty(b.prototype,"elevationQuery",
{get:function(){var a=this;e.isNone(this._elevationQuery)&&(this._elevationQuery=new m.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,function(){return a.view.map&&a.view.map.ground},{maximumAutoTileRequests:4}));return this._elevationQuery},enumerable:!1,configurable:!0});b.prototype.getElevation=function(a,b,c,d,e){var g;g=f(null,this.im,a,b,c,d,e);null==g&&(g=f(g,this.ground,a,b,c,d,e));"scene"===e&&(g=f(g,this.scene,a,b,c,d,e));return g};b.prototype.queryElevation=
function(a,b,d,e,g,h,m){var k=this;void 0===h&&(h=null);void 0===m&&(m=0);var l=c.createResolver();this.elevationQuery.queryElevation(a,b,h,m).then(function(c){"scene"===g&&(c=f(c,k.scene,a,b,d,e,g));l.resolve(c)}).catch(function(f){c.isAbortError(f)?l.reject(f):l.resolve(k.getElevation(a,b,d,e,g))});return l.promise};b.prototype.register=function(a,b){var c=this;this.handles.set(b,b.on("elevation-change",function(a){return c.emit("elevation-change",a)}));this[a].push(b)};b.prototype.unregister=function(a){this.handles.has(a)&&
(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=[this.im,this.ground,this.scene];b<c.length;b++){var d=c[b],e=d.indexOf(a);-1<e&&d.splice(e,1)}};d.__decorate([h.property({constructOnly:!0})],b.prototype,"view",void 0);d.__decorate([h.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],b.prototype,"spatialReference",void 0);return b=d.__decorate([h.subclass("esri.views.3d.support.CombinedElevationProvider")],b)}(k.EventedMixin(l));a.CombinedElevationProvider=
n})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports tslib ../../../../geometry ../../../../core/arrayUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../support/Scheduler".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.ElevationQuery=a.ViewElevationProvider=void 0;n=function(){function a(a,b){this.spatialReference=a;this.view=b}a.prototype.getElevation=function(a,b,c){return this.view.elevationProvider.getElevation(a,
b,0,this.spatialReference,c)};a.prototype.queryElevation=function(a,b,c,e,h){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(d){return[2,this.view.elevationProvider.queryElevation(a,b,0,this.spatialReference,h,c,e)]})})};return a}();a.ViewElevationProvider=n;n=function(){function a(a,b,c,e){var f=this;this.spatialReference=b;this._getElevationQueryProvider=c;this._queries=[];this._queryOptions=d.__assign(d.__assign({},e),{ignoreInvisibleLayers:!0});this._frameTask=
a.registerTask(h.Task.ELEVATION_QUERY,function(){return f._update()},function(){return 0<f._queries.length})}a.prototype.destroy=function(){this._frameTask.remove()};a.prototype.queryElevation=function(a,b,d,e){var f=this;void 0===e&&(e=0);return c.create(function(g,h){var m={x:a,y:b,minDemResolution:e,result:{resolve:g,reject:h},signal:d};f._queries.push(m);c.onAbort(d,function(){k.remove(f._queries,m);h(c.createAbortError())})})};a.prototype._update=function(){var a=this._queries;this._queries=
[];var b=this._getElevationQueryProvider();if(b){var g=a.map(function(a){return[a.x,a.y]}),h=a.reduce(function(a,b){return Math.min(a,b.minDemResolution)},Infinity),g=new l.Multipoint({points:g,spatialReference:this.spatialReference}),m=1<a.length&&a.some(function(a){return!!a.signal})?c.createAbortController():null,k=e.isSome(m)?m.signal:a[0].signal;if(e.isSome(m)){var r=0;a.forEach(function(b){return c.onAbort(b.signal,function(){r++;b.result.reject(c.createAbortError());r===a.length&&m.abort()})})}h=
d.__assign(d.__assign({},this._queryOptions),{minDemResolution:h,signal:k});b.queryElevation(g,h).then(function(b){a.forEach(function(a,d){e.isSome(a.signal)&&a.signal.aborted?a.result.reject(c.createAbortError()):a.result.resolve(b.geometry.points[d][2])})}).catch(function(b){a.forEach(function(a){return a.result.reject(b)})})}else a.forEach(function(a){return a.result.reject()})};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{update:function(){return 0<a._queries.length&&
a._update()}}},enumerable:!1,configurable:!0});return a}();a.ElevationQuery=n})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/has"],function(n,a,d){function l(){var a=!!d("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},
uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:a?.8:1,polylineLodFactor:a?1.2:1.5},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeDuration:0},point:{lodFactor:1},
integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:a},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!d("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!1,memoryLimit:a?600:750,additionalCacheMemory:a?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:a?
1.2:2,polylineLodFactor:a?1.2:2},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!d("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,memoryLimit:a?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:a?null:4096,
maximumPixelRatio:a?1:null}}}n=function(){function a(){}a.isValidProfile=function(d){return d in a.profiles};a.getDefaultProfile=function(){return d("trident")||d("esri-iPhone")?"low":"medium"};a.apply=function(d,c){d=a.profiles[d];c.graphics3D.maxTotalNumberOfFeatures=d.graphics3D.maxTotalNumberOfFeatures;c.graphics3D.maxTotalNumberOfPrimitives=d.graphics3D.maxTotalNumberOfPrimitives;c.graphics3D.polygonLodFactor=d.graphics3D.polygonLodFactor;c.graphics3D.polylineLodFactor=d.graphics3D.polylineLodFactor;
c.sceneService["3dObject"].lodFactor=d.sceneService["3dObject"].lodFactor;c.sceneService["3dObject"].lodCrossfadeDuration=d.sceneService["3dObject"].lodCrossfadeDuration;c.sceneService.point.lodFactor=d.sceneService.point.lodFactor;c.sceneService.integratedMesh.lodFactor=d.sceneService.integratedMesh.lodFactor;c.sceneService.pointCloud.lodFactor=d.sceneService.pointCloud.lodFactor;c.sceneService.uncompressedTextureDownsamplingEnabled=d.sceneService.uncompressedTextureDownsamplingEnabled;c.tiledSurface.lodBias=
d.tiledSurface.lodBias;c.tiledSurface.angledSplitBias=d.tiledSurface.angledSplitBias;c.tiledSurface.reduceTileLevelDifferences=d.tiledSurface.reduceTileLevelDifferences;c.tiledSurface.textureFadeDuration=d.tiledSurface.textureFadeDuration;c.antialiasingEnabled=d.antialiasingEnabled;c.physicallyBasedRenderingEnabled=d.physicalBasedRenderingEnabled;c.memoryLimit=d.memoryLimit;c.additionalCacheMemory=d.additionalCacheMemory;c.frameRate=d.frameRate;c.maximumRenderResolution=d.maximumRenderResolution;
c.maximumPixelRatio=d.maximumPixelRatio};a.debug={reset:function(){var d=l(),c;for(c in d)a.profiles[c]=d[c]}};return a}();(n||(n={})).profiles=l();return n})},"esri/views/3d/support/HighlightOptions":function(){define("require exports tslib ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4f32".split(" "),function(n,a,d,l,k,e,c,h){return function(a){function f(){var b=null!==a&&a.apply(this,arguments)||this;b.color=
new l([0,255,255]);b.haloColor=null;b.haloOpacity=1;b.fillOpacity=.25;return b}d.__extends(f,a);f.toEngineOptions=function(a){var b=l.toUnitRGBA(a.color),c=e.isSome(a.haloColor)?l.toUnitRGBA(a.haloColor):b;return{color:h.vec4f32.fromValues(b[0],b[1],b[2],b[3]),haloColor:h.vec4f32.fromValues(c[0],c[1],c[2],c[3]),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};d.__decorate([c.property({type:l})],f.prototype,"color",void 0);
d.__decorate([c.property({type:l})],f.prototype,"haloColor",void 0);d.__decorate([c.property()],f.prototype,"haloOpacity",void 0);d.__decorate([c.property()],f.prototype,"fillOpacity",void 0);return f=d.__decorate([c.subclass("esri.views.3d.support.HighlightOptions")],f)}(k)})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["require","exports","./factories/vec4f32"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.vec4f32=void 0;a.vec4f32=d})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["require",
"exports"],function(n,a){function d(){return new Float32Array(4)}function l(a,b,c,d){var e=new Float32Array(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e}function k(){return l(1,1,1,1)}function e(){return l(1,0,0,0)}function c(){return l(0,1,0,0)}function h(){return l(0,0,1,0)}function m(){return l(0,0,0,1)}Object.defineProperty(a,"__esModule",{value:!0});a.UNIT_W=a.UNIT_Z=a.UNIT_Y=a.UNIT_X=a.ONES=a.ZEROS=a.unitW=a.unitZ=a.unitY=a.unitX=a.ones=a.zeros=a.createView=a.fromValues=a.clone=a.create=void 0;a.create=
d;a.clone=function(a){var b=new Float32Array(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=l;a.createView=function(a,b){return new Float32Array(a,b,4)};a.zeros=function(){return d()};a.ones=k;a.unitX=e;a.unitY=c;a.unitZ=h;a.unitW=m;a.ZEROS=d();a.ONES=k();a.UNIT_X=e();a.UNIT_Y=c();a.UNIT_Z=h();a.UNIT_W=m()})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports tslib ../../../geometry ../../../core/asyncUtils ../../../core/Error ../../../core/unitUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),
function(n,a,d,l,k,e,c,h,m){Object.defineProperty(a,"__esModule",{value:!0});a.MapCoordsHelper=void 0;n=function(){function a(a,d,e){void 0===e&&(e=null);this.spatialReference=d;this.unitInMeters=c.getMetersPerUnitForSR(this.spatialReference);this._geometryServicePromise=k.result(this.loadGeometryService(a,e))}a.prototype.loadGeometryService=function(a,c){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(b){switch(b.label){case 0:if(c)return[2,c];b.label=1;case 1:return b.trys.push([1,
3,,4]),[4,h.create(a&&a.get("portalItem"))];case 2:return[2,b.sent()];case 3:throw b.sent(),new e("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");case 4:return[2]}})})};a.prototype.awaitGeometryService=function(){return d.__awaiter(this,void 0,void 0,function(){var a;return d.__generator(this,function(b){switch(b.label){case 0:return[4,this._geometryServicePromise];case 1:a=b.sent();if(!0===a.ok)return[2,a.value];throw a.error;}})})};a.prototype.toGeographic=
function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e,f,h,k,v,w=this;return d.__generator(this,function(d){switch(d.label){case 0:return[4,this.awaitGeometryService()];case 1:return b=d.sent(),c=!0,Array.isArray(a[0])&&"number"!==typeof a[0]?e=a:(e=[a],c=!1),f=e.map(function(a){return a instanceof l.Point?a:new l.Point(a,w.spatialReference)}),h=new m({geometries:f,outSpatialReference:l.SpatialReference.WGS84}),[4,b.project(h)];case 2:return k=d.sent(),v=k.map(function(a){return"point"===
a.type?[a.x,a.y]:void 0}),[2,c?v:v[0]]}})})};return a}();a.MapCoordsHelper=n;a.default=n})},"esri/portal/support/geometryServiceUtils":function(){define("require exports tslib ../../config ../../core/Error ../Portal ../../tasks/support/ProjectParameters @dojo/framework/shim/Promise".split(" "),function(n,a,d,l,k,e,c){function h(a,c){void 0===a&&(a=null);return d.__awaiter(this,void 0,void 0,function(){var b,f;return d.__generator(this,function(d){switch(d.label){case 0:return l.geometryServiceUrl?
[4,new Promise(function(a,b){n(["../../tasks/GeometryService"],a,b)})]:[3,2];case 1:return b=d.sent(),[2,new b({url:l.geometryServiceUrl})];case 2:if(!a)throw new k("internal:geometry-service-url-not-configured");f="portal"in a?a.portal||e.getDefault():a;return[4,f.load({signal:c})];case 3:return d.sent(),f.helperServices&&f.helperServices.geometry&&f.helperServices.geometry.url?[4,new Promise(function(a,b){n(["../../tasks/GeometryService"],a,b)})]:[3,5];case 4:return b=d.sent(),[2,new b({url:f.helperServices.geometry.url})];
case 5:throw new k("internal:geometry-service-url-not-configured");}})})}Object.defineProperty(a,"__esModule",{value:!0});a.projectGeometry=a.create=void 0;a.create=h;a.projectGeometry=function(a,e,b,g){void 0===b&&(b=null);return d.__awaiter(this,void 0,void 0,function(){var f,m,l;return d.__generator(this,function(d){switch(d.label){case 0:return[4,h(b,g)];case 1:return f=d.sent(),m=new c,m.geometries=[a],m.outSpatialReference=e,[4,f.project(m,{signal:g})];case 2:if((l=d.sent())&&Array.isArray(l)&&
1===l.length)return[2,l[0]];throw new k("internal:geometry-service-projection-failed");}})})}})},"esri/tasks/support/ProjectParameters":function(){define("require exports tslib ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/jsonUtils".split(" "),function(n,a,d,l,k,e,c){var h=k.getLogger("esri.tasks.support.ProjectParameters");return function(a){function f(b){b=a.call(this,b)||this;b.geometries=null;b.outSpatialReference=null;b.transformation=
null;b.transformForward=null;return b}d.__extends(f,a);Object.defineProperty(f.prototype,"outSR",{get:function(){h.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");return this.outSpatialReference},set:function(a){h.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");this.outSpatialReference=a},enumerable:!1,configurable:!0});f.prototype.toJSON=function(){var a=this.geometries.map(function(a){return a.toJSON()}),d=this.geometries[0],e={};e.outSR=
this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());e.inSR=d.spatialReference.wkid||JSON.stringify(d.spatialReference.toJSON());e.geometries=JSON.stringify({geometryType:c.getJsonType(d),geometries:a});this.transformation&&(e.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&(e.transformForward=this.transformForward);return e};d.__decorate([e.property()],f.prototype,"geometries",void 0);d.__decorate([e.property({json:{read:{source:"outSR"}}})],
f.prototype,"outSpatialReference",void 0);d.__decorate([e.property({json:{read:!1}})],f.prototype,"outSR",null);d.__decorate([e.property()],f.prototype,"transformation",void 0);d.__decorate([e.property()],f.prototype,"transformForward",void 0);return f=d.__decorate([e.subclass("esri.tasks.support.ProjectParameters")],f)}(l.JSONSupport)})},"esri/views/3d/support/QualitySettings":function(){define(["require","exports","tslib","../../../core/Accessor","../../../core/accessorSupport/decorators"],function(n,
a,d,l,k){var e=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.minTotalNumberOfFeatures=2E3;b.maxTotalNumberOfFeatures=5E4;b.maxTotalNumberOfPrimitives=17E5;b.polygonLodFactor=1;b.polylineLodFactor=1;return b}d.__extends(b,a);d.__decorate([k.property()],b.prototype,"minTotalNumberOfFeatures",void 0);d.__decorate([k.property()],b.prototype,"maxTotalNumberOfFeatures",void 0);d.__decorate([k.property()],b.prototype,"maxTotalNumberOfPrimitives",void 0);d.__decorate([k.property()],
b.prototype,"polygonLodFactor",void 0);d.__decorate([k.property()],b.prototype,"polylineLodFactor",void 0);return b=d.__decorate([k.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],b)}(l),c=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.lodFactor=1;return b}d.__extends(b,a);d.__decorate([k.property()],b.prototype,"lodFactor",void 0);return b=d.__decorate([k.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],b)}(l),h=function(a){function b(){var b=
null!==a&&a.apply(this,arguments)||this;b.lodCrossfadeDuration=0;return b}d.__extends(b,a);d.__decorate([k.property()],b.prototype,"lodCrossfadeDuration",void 0);return b=d.__decorate([k.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],b)}(c),m=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b["3dObject"]=new h;b.point=new c;b.integratedMesh=new c;b.pointCloud=new c;b.uncompressedTextureDownsamplingEnabled=!1;return b}d.__extends(b,a);d.__decorate([k.property({type:h})],
b.prototype,"3dObject",void 0);d.__decorate([k.property({type:c})],b.prototype,"point",void 0);d.__decorate([k.property({type:c})],b.prototype,"integratedMesh",void 0);d.__decorate([k.property({type:c})],b.prototype,"pointCloud",void 0);d.__decorate([k.property()],b.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return b=d.__decorate([k.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],b)}(l),f=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;
b.lodBias=0;b.angledSplitBias=1;b.reduceTileLevelDifferences=!0;b.textureFadeDuration=500;return b}d.__extends(b,a);d.__decorate([k.property()],b.prototype,"lodBias",void 0);d.__decorate([k.property()],b.prototype,"angledSplitBias",void 0);d.__decorate([k.property()],b.prototype,"reduceTileLevelDifferences",void 0);d.__decorate([k.property()],b.prototype,"textureFadeDuration",void 0);return b=d.__decorate([k.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],b)}(l);return function(a){function b(){var b=
null!==a&&a.apply(this,arguments)||this;b.graphics3D=new e;b.sceneService=new m;b.tiledSurface=new f;b.antialiasingEnabled=!0;b.physicallyBasedRenderingEnabled=!1;return b}d.__extends(b,a);d.__decorate([k.property({type:e})],b.prototype,"graphics3D",void 0);d.__decorate([k.property({type:m})],b.prototype,"sceneService",void 0);d.__decorate([k.property({type:f})],b.prototype,"tiledSurface",void 0);d.__decorate([k.property()],b.prototype,"antialiasingEnabled",void 0);d.__decorate([k.property()],b.prototype,
"physicallyBasedRenderingEnabled",void 0);d.__decorate([k.property()],b.prototype,"memoryLimit",void 0);d.__decorate([k.property()],b.prototype,"additionalCacheMemory",void 0);d.__decorate([k.property()],b.prototype,"frameRate",void 0);d.__decorate([k.property()],b.prototype,"maximumRenderResolution",void 0);d.__decorate([k.property()],b.prototype,"maximumPixelRatio",void 0);return b=d.__decorate([k.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],b)}(l)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/compilerUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../geometry/SpatialReference ../../../geometry/support/geodesicConstants ../../../layers/graphics/dehydratedFeatures ./geometryUtils ./pointUtils ./projectionUtils ./stack ./geometryUtils/coordinateSystem".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){Object.defineProperty(a,"__esModule",{value:!0});a.RenderCoordsHelper=void 0;n=function(){function a(a,b,c,d){this.viewingMode=a;this.spatialReference=b;this.unitInMeters=c;this.coordinateSystem=d;this._coordinateSystem=u.create(d)}Object.defineProperty(a.prototype,"extent",{set:function(a){a&&u.setExtent(this.coordinateSystem,a,this.coordinateSystem)},enumerable:!1,configurable:!0});a.prototype.getAltitude=function(a){return u.altitudeAt(this.coordinateSystem,
a)};a.prototype.setAltitude=function(a,b){u.setAltitudeAt(this.coordinateSystem,b,a,b)};a.prototype.setAltitudeOfTransformation=function(a,b){u.setAltitudeOfTransformation(this.coordinateSystem,b,a,b)};a.prototype.worldUpAtPosition=function(a,b){return u.normalAt(this.coordinateSystem,a,b)};a.prototype.worldBasisAtPosition=function(a,b,c){return u.axisAt(this.coordinateSystem,a,b,c)};a.prototype.basisMatrixAtPosition=function(a,b){var c=this.worldBasisAtPosition(a,0,t.sv3d.get()),d=this.worldBasisAtPosition(a,
1,t.sv3d.get());a=this.worldBasisAtPosition(a,2,t.sv3d.get());e.mat4.set(b,c[0],c[1],c[2],0,d[0],d[1],d[2],0,a[0],a[1],a[2],0,0,0,0,1);return b};a.prototype.intersectManifoldClosestSilhouette=function(a,b,c){u.elevate(this.coordinateSystem,b,this._coordinateSystem);u.intersectRayClosestSilhouette(this._coordinateSystem,a,c);return c};a.prototype.intersectManifold=function(a,b,d){u.elevate(this.coordinateSystem,b,this._coordinateSystem);b=t.sv3d.get();return u.intersectRay(this._coordinateSystem,a,
b)?(c.vec3.copy(d,b),!0):!1};a.prototype.intersectInfiniteManifold=function(a,d,e){if(1===this.viewingMode)return this.intersectManifold(a,d,e);u.elevate(this.coordinateSystem,d,this._coordinateSystem);d=this._coordinateSystem.value;var f=t.sv3d.get();return b.plane.intersectRay(d.plane,a,f)?(c.vec3.copy(e,f),!0):!1};a.prototype.toRenderCoords=function(a,b,c){return f.isDehydratedPoint(a)?g.pointToVector(a,b,this.spatialReference):p.vectorToVector(a,b,c,this.spatialReference)};a.prototype.fromRenderCoords=
function(a,b,c){return f.isDehydratedPoint(b)?g.vectorToDehydratedPoint(a,this.spatialReference,b,c):b instanceof h?g.vectorToPoint(a,this.spatialReference,b):p.vectorToVector(a,this.spatialReference,b,l.unwrap(c))};a.createGlobal=function(c){var d=u.fromValues(b.sphere,b.sphere.fromValues(m.earthRadius,[0,0,0]));return new a(1,c,1,d)};a.createLocal=function(c){var d=u.fromValues(b.boundedPlane,b.boundedPlane.fromValues([0,0,0],[r,0,0],[0,r,0])),e=k.getMetersPerUnitForSR(c);return new a(2,c,e,d)};
a.createMode=function(b,c){switch(b){case 2:return a.createLocal(c);case 1:return a.createGlobal(c);default:d.neverReached(b)}};return a}();a.RenderCoordsHelper=n;var r=Math.pow(2,50)})},"esri/views/3d/support/ResourceController":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/scheduling ../../../core/accessorSupport/decorators ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,
"__esModule",{value:!0});a.newResourceController=a.ResourceControllerMain=void 0;var g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.updating=!1;return b}d.__extends(b,a);d.__decorate([c.property({readOnly:!0})],b.prototype,"updating",void 0);return b=d.__decorate([c.subclass("esri.views.3d.support.ResourceController")],b)}(l);a.ResourceControllerMain=g;a.newResourceController=function(a,b){void 0===b&&(b=function(){return performance.now()});return new p.ResourceController({view:a,
now:b})};var p;(function(a){var l=function(a){function g(){var b=null!==a&&a.apply(this,arguments)||this;b._scheduler=null;b._memoryController=null;b._streamDataLoader=null;b._cameraChangeTime=0;b._handles=new k;b._frameTask=null;return b}d.__extends(g,a);g.prototype.initialize=function(){var a=this;this._cameraChangeTime=this.now();this._scheduler=b.newScheduler(this.now);this._memoryController=m.newMemoryController(this.view);this._streamDataLoader=new f.default;this._streamDataLoader.setup(h.maxDownloadSlots,
h.downloadSlotsPerClient,this._scheduler);this._handles.add([this.view.watch("state.camera",function(b,c){return a._cameraChangedHandler(b,c)},!0),this.view.watch("stationary",function(){return a._stationaryChangedHandler()}),this._memoryController.events.on("updating-changed",function(){return a.notifyChange("updating")})]);this._frameTask=e.addFrameTask({update:function(b){return a.frame(b)}})};g.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),
this._frameTask=null);this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=null);this._memoryController.destroy();this._memoryController=null;this._scheduler.destroy();this._scheduler=null};Object.defineProperty(g.prototype,"updating",{get:function(){return!!(this._memoryController&&this._memoryController.updating||this._streamDataLoader&&this._streamDataLoader.updating)},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"scheduler",{get:function(){return this._scheduler},
enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"memoryController",{get:function(){return this._memoryController},enumerable:!1,configurable:!0});g.prototype.createStreamDataRequester=function(a){var b=this._streamDataLoader;return{request:function(c,d,e){return b.request(c,d,a,e)},get busy(){return b.busy}}};g.prototype.frame=function(a){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(a.deltaTime/1E3),!this._scheduler))return;this._scheduler.state=
this.state;this._scheduler.updateBudget(a)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};g.prototype._cameraChangedHandler=function(a,b){a&&b&&a.almostEquals(b)||(this._cameraChangeTime=this._scheduler.now,this._scheduler.state=this.state)};g.prototype._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};Object.defineProperty(g.prototype,"state",{get:function(){var a=this.view;return a.animation?
0:a.interacting||this._scheduler.now-this._cameraChangeTime<=p?1:2},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"test",{get:function(){var a=this;return{getQueueStats:function(b){return a._streamDataLoader.test.loadQueue.getStatsForType(b)},state:this.state}},enumerable:!1,configurable:!0});d.__decorate([c.property({constructOnly:!0})],g.prototype,"view",void 0);d.__decorate([c.property({constructOnly:!0})],g.prototype,"now",void 0);d.__decorate([c.property()],g.prototype,"_streamDataLoader",
void 0);d.__decorate([c.property({readOnly:!0,dependsOn:["_streamDataLoader.updating"]})],g.prototype,"updating",null);return g=d.__decorate([c.subclass("esri.views.3d.support.ResourceController")],g)}(g);a.ResourceController=l;var p=300})(p||(p={}))})},"esri/views/3d/support/index":function(){define(["require","exports","../../../core/MapUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.maxDownloadSlots=a.downloadSlotsPerClient=void 0;a.downloadSlotsPerClient=d.MapFromValues([[0,
15],[1,15],[2,20],[3,5]]);a.maxDownloadSlots=30})},"esri/views/3d/support/MemoryController":function(){define("require exports ../../../core/Evented ../../../core/Logger ../../../core/MemCache ../layers/support/MemoryManagedLayerView".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.newMemoryController=void 0;var c=l.getLogger("esri.views.3d.support.MemoryController");a.newMemoryController=function(a){return new h(a)};var h=function(){function a(a){this._view=a;
this.events=new d;this.minQuality=.1;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new k.MemCacheStorage;this._numQualityChanges=0;this._updating=!1}a.prototype.destroy=function(){this.events=null};a.prototype.getMemCache=function(a,b){return new k.MemCache(a,this._cacheStorage,b)};Object.defineProperty(a.prototype,"maxMemory",{get:function(){return this._maxMemory},
set:function(a){null!=a&&0<a&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<a&&this._updateQuality(1),this._maxMemory=a)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"additionalCacheMemory",{set:function(a){null!=a&&0<=a&&(this._additionalCacheMemory=a)},enumerable:!1,configurable:!0});a.prototype.disableMemCache=function(){this._additionalCacheMemory=-4096};Object.defineProperty(a.prototype,"memoryFactor",{get:function(){return this._quality},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"updating",{get:function(){return this._updating},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"usedMemory",{get:function(){return this._memoryUsed},enumerable:!1,configurable:!0});a.prototype.resetStableQuality=function(){this._stableQuality=0};a.prototype.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var a=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=
this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(a){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=
!1,a=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,a=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this.updating!==a&&(this._updating=a,this.events.emit("updating-changed",this.updating))}};a.prototype._updateQuality=function(a){a=Math.min(Math.max(a,this.minQuality),1);if(a===this._quality)return!1;this._quality=
a;this.events.emit("quality-changed",this._quality);++this._numQualityChanges;return!0};a.prototype._layersUpdating=function(){return this._view.allLayerViews.some(function(a){return!!a.updating})};a.prototype._updateMemory=function(){var a=this,b=0,d=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(b+=this._view.basemapTerrain.getUsedMemory());var h=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;h&&(b+=h.getUsedMemory());this._view.allLayerViews&&
this._view.allLayerViews.forEach(function(c){if(e.isMemoryManagedLayerView(c)){var f=c.ignoresMemoryFactor()?a._quality:1;b+=c.getUsedMemory()*f;d+=c.getUnloadedMemory()*f}});var m=null==this._warnMemoryUsage||Math.round(10*b)!==Math.round(10*this._warnMemoryUsage),h=1048576*this._maxMemory;if(b>h&&m){this._warnMemoryUsage=b;var m=function(a){return(a/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},k=Math.round(100*this._quality);c.warn("Memory Limit exceeded! Limit: "+m(h)+" Current: "+
m(b)+" Projected: "+m(b+d)+" Quality: "+k+"%")}this._memoryUsed=b/h;this._memoryPredicted=(b+d)/h;this._cacheStorage.maxSize=Math.max(0,h-b+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};Object.defineProperty(a.prototype,"test",{get:function(){return{cacheStorage:this._cacheStorage,numQualityChanges:this._numQualityChanges}},enumerable:!1,configurable:!0});return a}()})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require","exports"],
function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.isMemoryManagedLayerView=void 0;a.isMemoryManagedLayerView=function(a){return"function"===typeof a.getUsedMemory}})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports tslib ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./AsyncWorkerQueue ./StreamDataLoaderTask ../webgl-engine/lib/Util ../../../views/support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){function r(a){if(2>a.byteLength)return"unknown";a=new Uint8Array(a,0,a.byteLength);return 137===a[0]&&80===a[1]?"image/png":71===a[0]&&73===a[1]?"image/gif":66===a[0]&&77===a[1]?"image/bmp":255===a[0]&&216===a[1]?"image/jpeg":"unknown"}Object.defineProperty(a,"__esModule",{value:!0});a.ImageWithType=a.StreamDataLoader=void 0;n=function(a){function k(){var b=null!==a&&a.apply(this,arguments)||this;b.tasks=new Map;b.onLoadQueue=[];b.doneQueue=[];b.updating=!1;
return b}d.__extends(k,a);k.prototype.setup=function(a,b,c){var d=this;this.loadQueue=new g.AsyncWorkerQueue(function(a,b){return d.startLoading(a,b)},function(a,b){return d.doneLoadingCallback(a,b)},a,b);c&&(this.taskHandle=c.registerTask(u.Task.STREAM_DATA_LOADER,function(a){return d.update(a)},function(){return 0<d.doneQueue.length||0<d.onLoadQueue.length}))};k.prototype.destroy=function(){this.taskHandle&&(this.taskHandle.remove(),this.taskHandle=null);this.tasks.forEach(function(a){a.abortController&&
a.abortController.abort()});this.loadQueue.clear();this.tasks=this.doneQueue=this.onLoadQueue=this.loadQueue=null};Object.defineProperty(k.prototype,"busy",{get:function(){return this.loadQueue.busy},enumerable:!1,configurable:!0});k.prototype.request=function(a,b,c,d){var e=this;void 0===d&&(d={});var g=f.createResolver();g.__signal=m.isSome(d)?d.signal:null;var h=this.createOrUpdateTask(a,b,c,d,g);f.onAbort(d,function(){return e.cancelRequest(h,g)});return g.promise};k.prototype.createTask=function(a,
b,c,d,e,f){a=new p.default(a,b,c,d,e);this.updateTask(a,f);this.tasks.set(e,a);1===this.tasks.size&&this._set("updating",!0);this.loadQueue.push(a);return a};k.prototype.cancelRequest=function(a,b){e.removeUnordered(a.resolvers,b);b.reject(f.createAbortError());0===a.resolvers.length&&(2===a.status&&(a.status=4,this.loadQueue.cancel(a),a.abortController.abort(),a.request=null,a.abortController=null),a.status=4,this.tasks.delete(a.key),0===this.tasks.size&&this._set("updating",!1))};k.prototype.taskKey=
function(a,b,c){return a+":"+b+":"+c};k.prototype.updateTask=function(a,b){a.resolvers.push(b)};k.prototype.createOrUpdateTask=function(a,b,c,d,e){var f=m.isSome(d)&&d.uid||a,f=this.taskKey(f,b,c),g=this.tasks.get(f);return g?(this.updateTask(g,e),g):this.createTask(a,d,b,c,f,e)};k.prototype.doneLoadingCallback=function(a,b){this.loadQueue&&(t.assert(2===a.status),a.status=3,this.taskHandle?this.doneQueue.push({task:a,err:b}):this.doneLoading(a,b))};k.prototype.update=function(a){for(;!a.done&&0<
this.onLoadQueue.length;){var b=this.onLoadQueue.shift();f.throwIfAborted(b.task.abortController);b.task.abortController=null;b.callback(b.task);a.madeProgress()}for(;!a.done&&0<this.doneQueue.length;)b=this.doneQueue.shift(),3!==b.task.status&&(b.err=b.err||f.createAbortError()),this.doneLoading(b.task,b.err),a.madeProgress()};k.prototype.doneLoading=function(a,b){for(var d=a.result instanceof HTMLImageElement?0:a.resolvers.length,e=0,g=a.resolvers;e<g.length;e++){var m=g[e];if(b)f.isAbortError(b)?
m.reject(b):m.reject(new c("stream-data-loader:request-error","Failed to request resource at '"+a.url+"'. "+b,{url:a.url,error:b}));else{--d;var k=0>=d?a.result:h.clone(a.result);m.resolve(k)}}this.tasks.delete(a.key);0===this.tasks.size&&this._set("updating",!1)};k.prototype.startLoading=function(a,b){var c=this;if(4===a.status)return!1;a.startTime=performance.now();a.status=2;var e,g;switch(a.docType){case "binary":g="array-buffer";e=0;break;case "image":g="image";break;case "image+type":g="array-buffer";
break;default:g="json"}a.abortController=f.createAbortController();var h=a.abortController.signal;a.request=l(a.url,d.__assign(d.__assign({},a.options),{responseType:g,timeout:e,signal:h}));var m=function(){},k=function(d){a.duration=performance.now()-a.startTime;a.size=d instanceof ArrayBuffer?d.byteLength:a.size||0;a.result=d;c.taskHandle?c.onLoadQueue.push({callback:b,task:a}):(a.abortController=null,b(a))},p=function(c){2===a.status&&b(a,c);m()};if("image+type"!==a.docType)return a.request.then(function(a){return k(a.data)},
p),!0;a.request.then(function(b){b=b.data;var c=r(b);g="image";a.size=b.byteLength;if("unknown"===c)a.request=l(a.url,{responseType:g,timeout:e,signal:h}),a.request.then(function(a){return k(a.data)},p);else{b=new Blob([b],{type:c});var d=window.URL.createObjectURL(b);m=function(){return window.URL.revokeObjectURL(d)};a.request=l(d,{responseType:g,timeout:e,signal:h});a.request.then(function(a){return k(new q(a.data,c,m))},p)}},p);return!0};Object.defineProperty(k.prototype,"test",{get:function(){return{loadQueue:this.loadQueue}},
enumerable:!1,configurable:!0});d.__decorate([b.property({readOnly:!0})],k.prototype,"updating",void 0);return k=d.__decorate([b.subclass("esri.views.3d.support.StreamDataLoader")],k)}(k);a.StreamDataLoader=n;var q=function(){function a(a,b,c){this.image=a;this.type=b;this.release=c}Object.defineProperty(a.prototype,"isOpaque",{get:function(){return"image/jpeg"===this.type},enumerable:!1,configurable:!0});return a}();a.ImageWithType=q;a.default=n})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["require",
"exports","../webgl-engine/lib/Util"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.AsyncWorkerQueue=a.BaseTask=void 0;n=function(){return function(a){this.clientType=a;this._cancelled=!1;this.duration=this.size=0}}();a.BaseTask=n;n=function(){function a(a,d,c,h){var e=this;this._workerFunc=a;this._callbackFunc=d;this._maxTotalNumWorkers=c;this._type2id=new Map;this._tasks=[];this._typeNumWorkers=[];this._typeWorkerQuota=[];this._typeStatistics=[];this._totalNumWorkers=0;h.forEach(function(a,
b){e._type2id.set(b,e._tasks.length);e._tasks.push([]);e._typeNumWorkers.push(0);e._typeStatistics.push({requests:0,size:0,duration:0,speed:0});e._typeWorkerQuota.push(a)})}Object.defineProperty(a.prototype,"numTypes",{get:function(){return this._tasks.length},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"busy",{get:function(){return this._totalNumWorkers>=this._maxTotalNumWorkers},enumerable:!1,configurable:!0});a.prototype.push=function(a){var d=this,c=this._type2id.get(a.clientType);
this._totalNumWorkers<this._maxTotalNumWorkers?(this._typeNumWorkers[c]++,this._totalNumWorkers++,this._workerFunc(a,function(a,c){return d._taskCallback(a,c)})):this._tasks[c].push(a)};a.prototype.getStatsForType=function(a){a=this._type2id.get(a);return{quota:this._typeWorkerQuota[a],workers:this._typeNumWorkers[a],queueSize:this._tasks[a].length,requestStats:this._typeStatistics[a]}};a.prototype.cancel=function(a){this._taskFinished(a);a._cancelled=!0};a.prototype.clear=function(){for(var a=0;a<
this._tasks.length;a++)this._tasks[a]=[]};a.prototype._taskFinished=function(a){var e=this._type2id.get(a.clientType);this._typeNumWorkers[e]--;this._totalNumWorkers--;this._typeStatistics[e].requests++;this._typeStatistics[e].size+=a.size||0;this._typeStatistics[e].duration+=a.duration||0;this._typeStatistics[e].speed=0<this._typeStatistics[e].duration?this._typeStatistics[e].size/this._typeStatistics[e].duration:0;d.assert(0<=this._typeNumWorkers[e]);this._next()};a.prototype._next=function(){for(var a=
0;a<this.numTypes;++a){if(this._typeNumWorkers[a]<this._typeWorkerQuota[a]&&this._processQueue(a))return;++a}for(a=0;a<this.numTypes&&!this._processQueue(a);++a);};a.prototype._processQueue=function(a){for(var d=this;0<this._tasks[a].length;)if(this._workerFunc(this._tasks[a].shift(),function(a,e){return d._taskCallback(a,e)}))return this._typeNumWorkers[a]++,this._totalNumWorkers++,!0;return!1};a.prototype._taskCallback=function(a,d){a._cancelled||(this._callbackFunc(a,d),this._taskFinished(a))};
Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{set workerFunc(d){a._workerFunc=d}}},enumerable:!1,configurable:!0});return a}();a.AsyncWorkerQueue=n})},"esri/views/3d/support/StreamDataLoaderTask":function(){define(["require","exports","tslib","./AsyncWorkerQueue"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function e(c,d,e,f,b){f=a.call(this,f)||this;f.url=c;f.options=d;f.docType=e;f.key=b;f.result=null;f.status=1;f.request=null;f.abortController=
null;f.resolvers=[];f.startTime=0;return f}d.__extends(e,a);return e}(l.BaseTask);a.default=n})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["require","exports","../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(n,a,d,l,k){return function(){return function(a){var c=this;this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];var e=a.resourceController.memoryController;
this.totalMemory=1048576*e.maxMemory;this.usedMemory=Math.round(e.usedMemory*this.totalMemory);this.quality=e.memoryFactor;this.load=a.resourceController.scheduler.load;this.terrainMemory=a.basemapTerrain?a.basemapTerrain.getUsedMemory():0;this.edgesMemory=(e=a._stage&&a._stage.renderView&&a._stage.renderView.edgeView)?e.getUsedMemory():0;a.allLayerViews.items.forEach(function(e){(d.isMemoryManagedLayerView(e)||k.isSurfaceLayerView(e))&&c.layerPerformanceInfos.push(new l(e,a))});this.layerPerformanceInfos.sort(function(a,
c){return c.memory-a.memory})}}()})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["require","exports","../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(n,a,d,l){return function(){return function(a,e){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=a.layer;this.memory=l.isSurfaceLayerView(a)?e.basemapTerrain.getUsedMemoryForLayerView(a):a.getUsedMemory();d.isPerformanceInfoLayerView(a)&&
(a=a.performanceInfo,this.displayedNumberOfFeatures=a.displayedNumberOfFeatures,this.maximumNumberOfFeatures=a.maximumNumberOfFeatures,this.totalNumberOfFeatures=a.totalNumberOfFeatures)}}()})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.isPerformanceInfoLayerView=void 0;a.isPerformanceInfoLayerView=function(a){return"performanceInfo"in a}})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../core/maybe ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./RasterTile ./terrainUtilsPlanar ./terrainUtilsSpherical ./TileTexture".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){function p(a){return"imagery-tile"===a.type||"wcs"===a.type}function t(a){return a&&"esri.views.3d.layers.ImageryTileLayerView3D"===a.declaredClass}function u(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function r(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function q(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function v(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===
a.declaredClass}function w(a,b,c,d){return z[2===d||"planar"===d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,c,b)}Object.defineProperty(a,"__esModule",{value:!0});a.test=a.getTiledLayerInfo=a.checkIfTileInfoSupportedForView=a.useFetchTileForLayer=a.releaseTileData=a.isRasterTileRenderInfo=a.isTextureTileRenderInfo=a.isVectorTileRenderInfo=a.isImageryTileRenderInfo=a.isSurfaceLayerView=a.isElevationLayerView=a.isWMTSLayerView=a.isVectorTileLayerView=a.isTileLayerView=a.isImageryTileLayerView=
a.isProjectableRasterLayer=a.isVectorTileLayer=a.getLayerWithExtentRange=a.autoUpdateSkirtsVisibility=a.weakAssert=void 0;var z={planar:f,spherical:b};a.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};var x=80/180*Math.PI,B=110/180*Math.PI;a.autoUpdateSkirtsVisibility=function(a,b,c,d){var e=z[a.manifold],f=e.isInsideExtent(a,b);f?c=a.getElevation(b[0],b[1],b[1],c):(c=a.elevationBounds,c=.5*(c.min+c.max));c=b[2]-c;d=Math.abs(c)<d?0:0>c?-1:1;f||(e.isInsideExtent(a,b,1.2)?(b=e.tiltToExtentEdge(a,
b),b>x&&b<B&&(d=0)):d=0);a.skirtScale=d};a.getLayerWithExtentRange=function(a){return t(a)?{fullExtent:a.fullExtent,minScale:a.layer.minScale,maxScale:a.layer.maxScale,tilemapCache:null}:a.layer};a.isVectorTileLayer=function(a){return a&&a instanceof e};a.isProjectableRasterLayer=p;a.isImageryTileLayerView=t;a.isTileLayerView=u;a.isVectorTileLayerView=r;a.isWMTSLayerView=q;a.isElevationLayerView=v;a.isSurfaceLayerView=function(a){return a&&(u(a)||t(a)||v(a)||r(a)||q(a))};a.isImageryTileRenderInfo=
function(a){return a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof m.default};a.isVectorTileRenderInfo=function(a){return a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof c.VectorTile};a.isTextureTileRenderInfo=function(a){return a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof g.TileTexture};a.isRasterTileRenderInfo=function(a){a=a&&a.sourceLayerInfo&&a.sourceLayerInfo.data;return a instanceof HTMLImageElement||a instanceof h.ImageWithType||a instanceof HTMLCanvasElement||a instanceof
ImageData};a.releaseTileData=function(a){!d.isSome(a)||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData||a.release();return null};a.useFetchTileForLayer=function(a){return a.fetchTile&&!(a.fetchTile===k.prototype.fetchTile||a.fetchTile===l.prototype.fetchTile)};a.checkIfTileInfoSupportedForView=w;a.getTiledLayerInfo=function(b,c,d){var e,f;if("wmts"===b.type){if(b=b.activeLayer){var g=b.tileMatrixSet;if(g)e=g.tileInfo,f=g.fullExtent;else if(b=b.tileMatrixSets)if(b=
b.find(function(a){return null==w(a.tileInfo,a.fullExtent,c,d)}))return{tileInfo:b.tileInfo,fullExtent:b.fullExtent}}}else f=p(b)?b.getCompatibleFullExtent(c):b.fullExtent,e="vector-tile"!==b.type||a.test.force512VTL?p(b)?b.getCompatibleTileInfo(c,f):b.tileInfo:b.compatibleTileInfo256;return e&&f&&null==w(e,f,c,d)?{tileInfo:e,fullExtent:f}:{tileInfo:null,fullExtent:null}};a.test={force512VTL:!1}})},"esri/layers/ElevationLayer":function(){define("require exports tslib ../request ../core/deprecate ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/HeightModelInfo ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./support/commonProperties ./support/LercDecoder @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z){var x=c.getLogger("esri.layers.ElevationLayer");return function(a){function c(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.copyright=null;b.heightModelInfo=null;b.path=null;b.opacity=1;b.operationalLayerType="ArcGISTiledElevationServiceLayer";b.sourceJSON=null;b.type="elevation";b.url=null;b.version=null;b._lercDecoder=z.acquireInstance();return b}d.__extends(c,a);c.prototype.normalizeCtorArgs=function(a,b){return"string"===
typeof a?d.__assign({url:a},b):a};c.prototype.destroy=function(){z.releaseInstance(this._lercDecoder);this._lercDecoder=null};Object.defineProperty(c.prototype,"minScale",{get:function(){},set:function(a){this.constructed&&x.warn(this.declaredClass+".minScale support has been removed (since 4.5)")},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"maxScale",{get:function(){},set:function(a){this.constructed&&x.warn(this.declaredClass+".maxScale support has been removed (since 4.5)")},
enumerable:!1,configurable:!0});c.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=9.3);return a};c.prototype.load=function(a){var b=this,c=h.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(a){for(var b=0;b<a.typeKeywords.length;b++)if("elevation 3d layer"===a.typeKeywords[b].toLowerCase())return!0;throw new e("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",
{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});}},a).then(function(){return b._fetchImageService(c)},function(){return b._fetchImageService(c)}));return f.resolve(this)};c.prototype.fetchTile=function(a,b,c,d){var e=this;void 0===d&&(d={});null!=d&&"number"===typeof d&&(k.deprecated(x,"Passing 'noDataValue' directly as a parameter",{replacement:"use { noDataValue } options object instead",version:"4.12"}),d={noDataValue:d});var f={responseType:"array-buffer",signal:d.signal},
g={noDataValue:d.noDataValue,returnFileInfo:!0};return this.load().then(function(){return e._fetchTileAvailability(a,b,c,d)}).then(function(){return l(e.getTileUrl(a,b,c),f)}).then(function(a){return e._lercDecoder.decode(a.data,g,d.signal)}).then(function(a){return{values:a.pixelData,width:a.width,height:a.height,maxZError:a.fileInfo.maxZError,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue}})};c.prototype.getTileUrl=function(a,c,e){var f=!this.tilemapCache&&this.supportsBlankTile,
f=b.objectToQuery(d.__assign(d.__assign({},this.parsedUrl.query),{blankTile:f?!1:null}));return this.parsedUrl.path+"/tile/"+a+"/"+c+"/"+e+(f?"?"+f:"")};c.prototype.queryElevation=function(a,b){var c=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).query(c,a,b)})};c.prototype.createElevationSampler=function(a,b){var c=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).createSampler(c,a,b)})};c.prototype._fetchTileAvailability=
function(a,b,c,d){return this.tilemapCache?this.tilemapCache.fetchAvailability(a,b,c,d):f.resolve("unknown")};c.prototype._fetchImageService=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c;return d.__generator(this,function(e){switch(e.label){case 0:if(this.sourceJSON)return[2,this.sourceJSON];b={query:d.__assign({f:"json"},this.parsedUrl.query),responseType:"json",signal:a};return[4,l(this.parsedUrl.path,b)];case 1:return c=e.sent(),c.ssl&&(this.url=this.url.replace(/^http:/i,
"https:")),this.sourceJSON=c.data,this.read(c.data,{origin:"service",url:this.parsedUrl}),[2]}})})};c.prototype._importElevationQuery=function(){return new Promise(function(a,b){n(["./support/ElevationQuery"],a,b)})};d.__decorate([g.property({json:{read:{source:"copyrightText"}}})],c.prototype,"copyright",void 0);d.__decorate([g.property({readOnly:!0,type:p})],c.prototype,"heightModelInfo",void 0);d.__decorate([g.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],c.prototype,
"path",void 0);d.__decorate([g.property({type:["show","hide"]})],c.prototype,"listMode",void 0);d.__decorate([g.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],c.prototype,"minScale",null);d.__decorate([g.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],c.prototype,"maxScale",null);d.__decorate([g.property({json:{read:!1,
write:!1,origins:{"web-document":{read:!1,write:!1}}}})],c.prototype,"opacity",void 0);d.__decorate([g.property({type:["ArcGISTiledElevationServiceLayer"]})],c.prototype,"operationalLayerType",void 0);d.__decorate([g.property()],c.prototype,"sourceJSON",void 0);d.__decorate([g.property({json:{read:!1},value:"elevation",readOnly:!0})],c.prototype,"type",void 0);d.__decorate([g.property(w.url)],c.prototype,"url",void 0);d.__decorate([g.property()],c.prototype,"version",void 0);d.__decorate([g.reader("version",
["currentVersion"])],c.prototype,"readVersion",null);return c=d.__decorate([g.subclass("esri.layers.ElevationLayer")],c)}(u.ArcGISCachedService(r.ArcGISService(q.OperationalLayer(v.PortalLayer(m.MultiOriginJSONMixin(t))))))})},"esri/layers/mixins/ArcGISCachedService":function(){define("require exports tslib ../../geometry ../../core/accessorSupport/decorators ../support/serviceTileInfoProperty ../support/TilemapCache".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});
a.ArcGISCachedService=void 0;a.ArcGISCachedService=function(a){return function(a){function f(){var b=null!==a&&a.apply(this,arguments)||this;b.copyright=null;b.minScale=0;b.maxScale=0;b.spatialReference=null;b.tileInfo=null;b.tilemapCache=null;return b}d.__extends(f,a);f.prototype.readMinScale=function(a,c){return null!=c.minLOD&&null!=c.maxLOD?a:0};f.prototype.readMaxScale=function(a,c){return null!=c.minLOD&&null!=c.maxLOD?a:0};Object.defineProperty(f.prototype,"supportsBlankTile",{get:function(){return 10.2<=
this.version},enumerable:!1,configurable:!0});f.prototype.readTilemapCache=function(a,d){return d.capabilities&&-1<d.capabilities.indexOf("Tilemap")?new c.TilemapCache({layer:this}):null};d.__decorate([k.property({json:{read:{source:"copyrightText"}}})],f.prototype,"copyright",void 0);d.__decorate([k.property()],f.prototype,"minScale",void 0);d.__decorate([k.reader("service","minScale")],f.prototype,"readMinScale",null);d.__decorate([k.property()],f.prototype,"maxScale",void 0);d.__decorate([k.reader("service",
"maxScale")],f.prototype,"readMaxScale",null);d.__decorate([k.property({type:l.SpatialReference})],f.prototype,"spatialReference",void 0);d.__decorate([k.property({readOnly:!0,dependsOn:["version"]})],f.prototype,"supportsBlankTile",null);d.__decorate([k.property(e.serviceTileInfoProperty)],f.prototype,"tileInfo",void 0);d.__decorate([k.property()],f.prototype,"tilemapCache",void 0);d.__decorate([k.reader("service","tilemapCache",["capabilities"])],f.prototype,"readTilemapCache",null);d.__decorate([k.property()],
f.prototype,"version",void 0);return f=d.__decorate([k.subclass("esri.layers.mixins.ArcGISCachedService")],f)}(a)}})},"esri/layers/support/serviceTileInfoProperty":function(){define(["require","exports","tslib","./TileInfo"],function(n,a,d,l){function k(a,c,h,m){if(!a)return null;h=c.minScale;var e=c.maxScale,b=c.minLOD,g=c.maxLOD;if(null!=b&&null!=g)return m&&m.ignoreMinMaxLOD?l.fromJSON(a):l.fromJSON(d.__assign(d.__assign({},a),{lods:a.lods.filter(function(a){a=a.level;return null!=a&&a>=b&&a<=
g})}));if(0!==h&&0!==e){var k=h?Math.round(1E4*h)/1E4:Infinity,t=e?Math.round(1E4*e)/1E4:-Infinity;return l.fromJSON(d.__assign(d.__assign({},a),{lods:a.lods.filter(function(a){a=Math.round(1E4*a.scale)/1E4;return a<=k&&a>=t})}))}return l.fromJSON(a)}Object.defineProperty(a,"__esModule",{value:!0});a.readServiceTileInfo=a.serviceTileInfoProperty=void 0;a.serviceTileInfoProperty={type:l,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:k}}}}};a.readServiceTileInfo=
k})},"esri/layers/support/TilemapCache":function(){define("require exports tslib ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){Object.defineProperty(a,"__esModule",{value:!0});a.TilemapCache=void 0;var q=h.getLogger("esri.layers.support.TilemapCache");
n=function(a){function h(b){b=a.call(this,b)||this;b._handles=new c;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2097152;b.request=l;b._prefetchingEnabled=!0;return b}d.__extends(h,a);k=h;h.prototype.initialize=function(){var a=this;this._tilemapCache=new m(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],function(){return a._initializeTilemapDefinition()}),t.init(this,"layer.tileInfo.lods",function(b){return a._initializeAvailableLevels(b)},
!0)]);this._initializeTilemapDefinition()};h.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};h.prototype.castLevels=function(a){return 2>=a?(q.error("Minimum levels for Tilemap is 3, but got ",a),3):a};Object.defineProperty(h.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!1,configurable:!0});h.prototype.fetchTilemap=function(a,c,f,g){var h=this;if(!this._availableLevels[a])return b.reject(new e("tilemap-cache:level-unavailable","Level "+
a+" is unavailable in the service"));var m=this._tmpTilemapDefinition;if(a=this._tilemapFromCache(a,c,f,m))return b.resolve(a);var k=g&&g.signal;g=d.__assign(d.__assign({},g),{signal:null});return b.create(function(a,c){b.onAbort(k,function(){return c(b.createAbortError())});var d=r.tilemapDefinitionId(m),e=h._pendingTilemapRequests[d];if(!e){var e=r.Tilemap.fromDefinition(m,g).then(function(a){h._tilemapCache.put(d,a,a.byteSize);return a}),f=function(){return delete h._pendingTilemapRequests[d]};
h._pendingTilemapRequests[d]=e;e.then(f,f)}e.then(a,c)})};h.prototype.getAvailability=function(a,b,c){return this._availableLevels[a]?(a=this._tilemapFromCache(a,b,c,this._tmpTilemapDefinition))?a.getAvailability(b,c):"unknown":"unavailable"};h.prototype.getAvailabilityUpsample=function(a,b,c,d){d.level=a;d.row=b;d.col=c;a=this.layer.tileInfo;for(a.updateTileInfo(d);;)if(b=this.getAvailability(d.level,d.row,d.col),"unavailable"===b){if(!a.upsampleTile(d))return"unavailable"}else return b};h.prototype.fetchAvailability=
function(a,c,d,f){return this._availableLevels[a]?this.fetchTilemap(a,c,d,f).catch(function(a){return a}).then(function(f){if(f instanceof r.Tilemap)return f=f.getAvailability(c,d),"unavailable"===f?b.reject(new e("tile-map:tile-unavailable","Tile is not available",{level:a,row:c,col:d})):f;if(b.isAbortError(f))throw f;return"unknown"}):b.reject(new e("tilemap-cache:level-unavailable","Level "+a+" is unavailable in the service"))};h.prototype.fetchAvailabilityUpsample=function(a,c,d,e,f){var g=this;
e.level=a;e.row=c;e.col=d;var h=this.layer.tileInfo;h.updateTileInfo(e);var m=this.fetchAvailability(a,c,d,f).catch(function(a){if(b.isAbortError(a))throw a;if(h.upsampleTile(e))return g.fetchAvailabilityUpsample(e.level,e.row,e.col,e);throw a;});this._fetchAvailabilityUpsamplePrefetch(e.id,a,c,d,f,m);return m};h.prototype._fetchAvailabilityUpsamplePrefetch=function(a,c,e,f,h,m){return d.__awaiter(this,void 0,void 0,function(){var l,p,r,t,q,u,v,w,n,x;return d.__generator(this,function(z){switch(z.label){case 0:if(!this._prefetchingEnabled)return[2];
l="prefetch-"+a;if(this._handles.has(l))return[2];p=b.createAbortController();m.then(function(){return p.abort()},function(){return p.abort()});r=!1;t={remove:function(){r||(r=!0,p.abort())}};this._handles.add(t,l);z.label=1;case 1:return z.trys.push([1,3,,4]),[4,g.waitTicks(10,p.signal)];case 2:return z.sent(),[3,4];case 3:return z.sent(),[3,4];case 4:r||(r=!0,this._handles.remove(l));if(b.isAborted(p))return[2];q={id:a,level:c,row:e,col:f};u=d.__assign(d.__assign({},h),{signal:p.signal});v=this.layer.tileInfo;
w=function(a){var b=n.fetchAvailability(q.level,q.row,q.col,u);k._prefetches.push(b);a=function(){k._prefetches.removeUnordered(b)};b.then(a,a)};n=this;for(x=0;k._prefetches.length<k._maxPrefetch&&v.upsampleTile(q);++x)w(x);return[2]}})})};h.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var a=this.layer.parsedUrl,b=a.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:a.path,query:b?p.objectToQuery(b):null,tileServers:this.layer.tileServers,request:this.request,
type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};h.prototype._tilemapFromCache=function(a,b,c,d){d.level=a;d.row=b-b%this.size;d.col=c-c%this.size;a=r.tilemapDefinitionId(d);return this._tilemapCache.get(a)};h.prototype._initializeAvailableLevels=function(a){var b=this;this._availableLevels={};a&&a.forEach(function(a){return b._availableLevels[a.level]=!0})};Object.defineProperty(h.prototype,"test",{get:function(){var a=this;return{get prefetchingEnabled(){return a._prefetchingEnabled},
set prefetchingEnabled(b){a._prefetchingEnabled=b},hasTilemap:function(b,c,d){return!!a._tilemapFromCache(b,c,d,a._tmpTilemapDefinition)}}},enumerable:!1,configurable:!0});var k;h._maxPrefetch=4;h._prefetches=new f({initialSize:k._maxPrefetch});d.__decorate([u.property({constructOnly:!0,type:Number})],h.prototype,"levels",void 0);d.__decorate([u.cast("levels")],h.prototype,"castLevels",null);d.__decorate([u.property({readOnly:!0,dependsOn:["levels"],type:Number})],h.prototype,"size",null);d.__decorate([u.property({constructOnly:!0,
type:Number})],h.prototype,"cacheByteSize",void 0);d.__decorate([u.property({constructOnly:!0})],h.prototype,"layer",void 0);d.__decorate([u.property({constructOnly:!0})],h.prototype,"request",void 0);return h=k=d.__decorate([u.subclass("esri.layers.support.TilemapCache")],h)}(k);a.TilemapCache=n})},"esri/layers/support/Tilemap":function(){define("require exports tslib ../../request ../../core/arrayUtils ../../core/Error ../../core/lang".split(" "),function(n,a,d,l,k,e,c){function h(a){var c;"vector-tile"===
a.service.type?c=a.service.url+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height:(c=a.service.tileServers,c=(c&&c.length?c[a.row%c.length]:a.service.url)+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height);(a=a.service.query)&&(c=c+"?"+a);return c}Object.defineProperty(a,"__esModule",{value:!0});a.tilemapDefinitionUrl=a.tilemapDefinitionId=a.Tilemap=void 0;n=function(){function a(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=
40}a.prototype.getAvailability=function(a,b){if("unknown"!==this._allAvailability)return this._allAvailability;a=(a-this.location.top)*this.location.width+(b-this.location.left);b=a>>3;var c=this._tileAvailabilityBitSet;return 0>b||b>c.length?"unknown":c[b]&1<<a%8?"available":"unavailable"};a.prototype._updateFromData=function(a){for(var b=!0,c=!0,d=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),e=0,f=0;f<a.length;f++){var h=f%8;a[f]?(c=!1,d[e]|=1<<h):b=!1;7===h&&++e}c?this._allAvailability=
"unavailable":b?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=d,this.byteSize+=d.length)};a.fromDefinition=function(c,b){var f=c.service.request||l,m=c.row,t=c.col,u=c.width,r=c.height,q={query:{f:"json"}};b=b?d.__assign(d.__assign({},q),b):q;return f(h(c),b).then(function(a){return a.data}).catch(function(a){if(a&&a.details&&422===a.details.httpStatus)return{location:{top:m,left:t,width:u,height:r},valid:!0,data:k.constant(u*r,0)};throw a;}).then(function(b){if(b.location&&
(b.location.top!==m||b.location.left!==t||b.location.width!==u||b.location.height!==r))throw new e("tilemap:location-mismatch","Tilemap response for different location than requested",{response:b,definition:{top:m,left:t,width:u,height:r}});return a.fromJSON(b)})};a.fromJSON=function(d){a.validateJSON(d);var b=new a;b.location=Object.freeze(c.clone(d.location));b._updateFromData(d.data);return Object.freeze(b)};a.validateJSON=function(a){if(!a||!a.location)throw new e("tilemap:missing-location","Location missing from tilemap response");
if(!1===a.valid)throw new e("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new e("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new e("tilemap:data-mismatch","Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new e("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return a}();a.Tilemap=n;a.tilemapDefinitionId=function(a){return a.level+"/"+
a.row+"/"+a.col+"/"+a.width+"/"+a.height};a.tilemapDefinitionUrl=h;a.default=n})},"esri/layers/support/LercDecoder":function(){define("require exports tslib ../../core/promiseUtils ../../views/3d/support/WorkerHandle @dojo/framework/shim/Promise".split(" "),function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.releaseInstance=a.acquireInstance=void 0;var e=function(a){function c(c){var b=a.call(this,"LercWorker","_decode",c,{strategy:"dedicated"})||this;b.scheduler=c;return b}d.__extends(c,
a);c.prototype.decode=function(a,b,c){return a&&0!==a.byteLength?this.invoke({buffer:a,options:b},c):l.resolve(null)};c.prototype.getTransferList=function(a){return[a.buffer]};return c}(k.WorkerHandle),c=new Map;a.acquireInstance=function(a){var d=c.get(a);d||(d={instance:new e(a),ref:0},c.set(a,d));++d.ref;return d.instance};a.releaseInstance=function(a){if(null!=a){a=a.scheduler;var d=c.get(a);d&&0>=--d.ref&&(d.instance.destroy(),c.delete(a))}}})},"esri/views/3d/support/WorkerHandle":function(){define("require exports tslib ../../../core/Logger ../../../core/promiseUtils ../../../core/workers".split(" "),
function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.WorkerHandle=void 0;var c=l.getLogger("esri.views.3d.support.WorkerHandle");n=function(){function a(a,f,b,g){var h=this;void 0===g&&(g={});this._methodName=f;this._promise=e.open(a,d.__assign(d.__assign({},g),{scheduler:b})).then(function(a){void 0===h._thread?(h._thread=a,h._promise=null):a.close()});this._promise.catch(function(b){return c.error("Failed to initialize "+a+" worker: "+b)})}a.prototype.destroy=function(){this._thread&&
(this._thread.close(),this._thread=null);this._promise=null};a.prototype.invoke=function(a,c){var b=this;void 0===c&&(c=null);if(this._thread){var d=this.getTransferList(a);return this._thread.invoke(this._methodName,a,{transferList:d,signal:c})}return this._promise?this._promise.then(function(){k.throwIfAborted(c);return b.invoke(a,c)}):k.reject(null)};a.prototype.broadcast=function(a,c){var b=this;return this._thread?k.all(this._thread.broadcast(c,a)).then(function(){}):this._promise?this._promise.then(function(){return b.broadcast(a,
c)}):k.reject()};Object.defineProperty(a.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0});return a}();a.WorkerHandle=n})},"esri/layers/TileLayer":function(){define("require exports tslib ../geometry ../request ../core/Error ../core/HandleOwner ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayerUrl ./support/arcgisLayerUrl ./support/commonProperties ./support/Sublayer".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F){var H="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");return function(a){function c(){for(var b=
[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.listMode="show";b.isReference=null;b.operationalLayerType="ArcGISTiledMapServiceLayer";b.resampling=!0;b.sourceJSON=null;b.spatialReference=null;b.path=null;b.sublayers=null;b.type="tile";b.url=null;return b}d.__extends(c,a);c.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?d.__assign({url:a},b):a};c.prototype.load=function(a){var b=this,c=h.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},
a).then(function(){return b._fetchService(c)},function(){return b._fetchService(c)}));return f.resolve(this)};Object.defineProperty(c.prototype,"attributionDataUrl",{get:function(){return this._getDefaultAttribution(this._getMapName(this.parsedUrl.path.toLowerCase()))},enumerable:!1,configurable:!0});c.prototype.readSpatialReference=function(a,b){return(a=a||b.tileInfo&&b.tileInfo.spatialReference)&&l.SpatialReference.fromJSON(a)};c.prototype.writeSublayers=function(a,b,c,e){if(this.loaded&&a){a=
a.slice().reverse().flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray();var f=[],g=d.__assign({writeSublayerStructure:!1},e);a.forEach(function(a){a=a.write({},g);f.push(a)});f.some(function(a){return 1<Object.keys(a).length})&&(b.layers=f)}};Object.defineProperty(c.prototype,"tileServers",{get:function(){return this._getDefaultTileServers(this.parsedUrl.path)},enumerable:!1,configurable:!0});c.prototype.castTileServers=function(a){return Array.isArray(a)?a.map(function(a){return b.urlToObject(a).path}):
null};c.prototype.fetchTile=function(a,b,c,d){void 0===d&&(d={});var e=d.signal,f=d.timestamp;a=this.getTileUrl(a,b,c);e={responseType:"image",signal:e};null!=f&&(e.query={_ts:d.timestamp});return k(a,e).then(function(a){return a.data})};c.prototype.getTileUrl=function(a,c,e){var f=!this.tilemapCache&&this.supportsBlankTile,f=b.objectToQuery(d.__assign(d.__assign(d.__assign({},this.parsedUrl.query),{blankTile:f?!1:null}),this.customParameters)),g=this.tileServers;return(g&&g.length?g[c%g.length]:
this.parsedUrl.path)+"/tile/"+a+"/"+c+"/"+e+(f?"?"+f:"")};c.prototype._fetchService=function(a){var b=this;return f.create(function(c,f){if(b.sourceJSON){if(null!=b.sourceJSON.bandCount&&null!=b.sourceJSON.pixelSizeX)throw new e("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");c({data:b.sourceJSON})}else{if(!b.parsedUrl)throw new e("tile-layer:undefined-url","layer's url is not defined");var g=E.parse(b.parsedUrl.path);if(g&&"ImageServer"===g.serverType)throw new e("tile-layer:unsupported-url",
"use ImageryTileLayer to open a tiled image service");k(b.parsedUrl.path,{query:d.__assign(d.__assign({f:"json"},b.parsedUrl.query),b.customParameters),responseType:"json",signal:a}).then(c,f)}}).then(function(c){c.ssl&&(b.url=b.url.replace(/^http:/i,"https:"));b.sourceJSON=c.data;b.read(c.data,{origin:"service",url:b.parsedUrl});if(10.1===b.version&&!E.isHostedAgolService(b.url))return b._fetchServerVersion(b.url,a).then(function(a){b.read({currentVersion:a})}).catch(function(){})})};c.prototype._fetchServerVersion=
function(a,b){if(!C.isArcGISUrl(a))return f.reject();a=a.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return k(a,{query:d.__assign({f:"json"},this.customParameters),responseType:"json",signal:b}).then(function(a){if(a.data&&a.data.currentVersion)return a.data.currentVersion;throw new e("tile-layer:version-not-available");})};c.prototype._getMapName=function(a){return(a=a.match(/^(?:https?:)?\/\/(server|services)\.arcgisonline\.com\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&a[2]};c.prototype._getDefaultAttribution=
function(a){if(a){var c;a=a.toLowerCase();for(var d=0,e=H.length;d<e;d++)if(c=H[d],-1<c.toLowerCase().indexOf(a))return b.makeAbsolute("//static.arcgis.com/attribution/"+c)}};c.prototype._getDefaultTileServers=function(a){var b=-1!==a.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),c=-1!==a.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return b||c?[a,a.replace(b?/server\.arcgisonline/i:/services\.arcgisonline/i,b?"services.arcgisonline":"server.arcgisonline")]:[]};d.__decorate([g.property({readOnly:!0,
dependsOn:["parsedUrl"]})],c.prototype,"attributionDataUrl",null);d.__decorate([g.property({type:["show","hide","hide-children"]})],c.prototype,"listMode",void 0);d.__decorate([g.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],c.prototype,"isReference",void 0);d.__decorate([g.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],c.prototype,"operationalLayerType",void 0);d.__decorate([g.property({type:Boolean})],c.prototype,"resampling",
void 0);d.__decorate([g.property()],c.prototype,"sourceJSON",void 0);d.__decorate([g.property({type:l.SpatialReference})],c.prototype,"spatialReference",void 0);d.__decorate([g.reader("spatialReference",["spatialReference","tileInfo"])],c.prototype,"readSpatialReference",null);d.__decorate([g.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],c.prototype,"path",void 0);d.__decorate([g.property({readOnly:!0})],c.prototype,"sublayers",void 0);d.__decorate([g.writer("sublayers",
{layers:{type:[F]}})],c.prototype,"writeSublayers",null);d.__decorate([g.property({json:{read:!1,write:!1}})],c.prototype,"popupEnabled",void 0);d.__decorate([g.property({dependsOn:["parsedUrl"]})],c.prototype,"tileServers",null);d.__decorate([g.cast("tileServers")],c.prototype,"castTileServers",null);d.__decorate([g.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0);d.__decorate([g.property(G.url)],c.prototype,"url",void 0);return c=d.__decorate([g.subclass("esri.layers.TileLayer")],
c)}(q.BlendLayer(A.SublayersOwner(B.ScaleRangeLayer(x.RefreshableLayer(w.OperationalLayer(z.PortalLayer(t.ArcGISCachedService(u.ArcGISMapService(r.ArcGISService(m.MultiOriginJSONMixin(c.HandleOwnerMixin(v.CustomParametersMixin(p)))))))))))))})},"esri/layers/mixins/ArcGISMapService":function(){define("require exports tslib ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.ArcGISMapService=void 0;a.ArcGISMapService=function(a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.capabilities=void 0;b.copyright=null;b.fullExtent=null;b.legendEnabled=!0;b.spatialReference=null;b.version=null;return b}d.__extends(b,a);b.prototype.readCapabilities=function(a,b){var c=b.capabilities&&b.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});if(!c)return{operations:{supportsQuery:!1,
supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};a=this.type;var d=-1!==c.indexOf("query"),e=-1!==c.indexOf("map"),f=!!b.exportTilesAllowed,c=-1!==c.indexOf("tilemap"),g="tile"!==a&&!!b.supportsDynamicLayers,h="tile"!==a&&(!b.tileInfo||g),m="tile"!==a&&(!b.tileInfo||g);return{operations:{supportsQuery:d,supportsExportMap:e,supportsExportTiles:f,supportsTileMap:c},exportMap:e?{supportsSublayersChanges:"tile"!==a,supportsDynamicLayers:g,supportsSublayerVisibility:h,
supportsSublayerDefinitionExpression:m}:null,exportTiles:f?{maxExportTilesCount:+b.maxExportTilesCount}:null}};b.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=b.hasOwnProperty("capabilities")||b.hasOwnProperty("tables")?10:b.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return a};b.prototype.fetchSublayerInfo=function(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){switch(c.label){case 0:return[4,this.fetchAllLayersAndTables(b)];case 1:return c.sent(),
[2,this._allLayersAndTablesMap.get(a)]}})})};b.prototype.fetchAllLayersAndTables=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c=this;return d.__generator(this,function(f){switch(f.label){case 0:return[4,this.load(a)];case 1:return f.sent(),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=l(e.urlToObject(this.url).path+"/layers",{responseType:"json",query:d.__assign({f:"json"},this.customParameters)}).then(function(a){c._allLayersAndTablesMap=new Map;for(var b=
0,d=a.data.layers;b<d.length;b++){var e=d[b];c._allLayersAndTablesMap.set(e.id,e)}return{result:a.data}},function(a){return{error:a}})),[4,this._allLayersAndTablesPromise];case 2:b=f.sent();k.throwIfAborted(a);if("result"in b)return[2,b.result];throw b.error;}})})};d.__decorate([c.property({readOnly:!0})],b.prototype,"capabilities",void 0);d.__decorate([c.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],b.prototype,"readCapabilities",
null);d.__decorate([c.property({json:{read:{source:"copyrightText"}}})],b.prototype,"copyright",void 0);d.__decorate([c.property({type:h})],b.prototype,"fullExtent",void 0);d.__decorate([c.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],b.prototype,"id",void 0);d.__decorate([c.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],b.prototype,"legendEnabled",void 0);d.__decorate([c.property(f.popupEnabled)],
b.prototype,"popupEnabled",void 0);d.__decorate([c.property({type:m})],b.prototype,"spatialReference",void 0);d.__decorate([c.property()],b.prototype,"version",void 0);d.__decorate([c.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],b.prototype,"readVersion",null);return b=d.__decorate([c.subclass("esri.layers.mixins.ArcGISMapService")],b)}(a)}})},"esri/layers/mixins/CustomParametersMixin":function(){define(["require","exports","tslib","../../core/accessorSupport/decorators"],
function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.CustomParametersMixin=void 0;a.CustomParametersMixin=function(a){return function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);d.__decorate([l.property({json:{write:!0,origins:{"web-scene":{write:!1}}}})],c.prototype,"customParameters",void 0);return c=d.__decorate([l.subclass("esri.layers.mixins.CustomParametersMixin")],c)}(a)}})},"esri/layers/mixins/SublayersOwner":function(){define("require exports tslib ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ../support/Sublayer ../support/sublayerUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){function p(a,c){var d=[],e={};if(!a)return d;a.forEach(function(a){var f=new b;f.read(a,c);e[f.id]=f;null!=a.parentLayerId&&-1!==a.parentLayerId?(a=e[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(f)):d.unshift(f)});return d}function t(a,b){a&&a.forEach(function(a){b(a);a.sublayers&&a.sublayers.length&&t(a.sublayers,b)})}Object.defineProperty(a,"__esModule",{value:!0});a.SublayersOwner=a.forEachSublayer=void 0;var u=c.getLogger("esri.layers.TileLayer"),
r=l.ofType(b);a.forEachSublayer=t;a.SublayersOwner=function(a){return function(a){function c(){for(var b,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];var e=a.apply(this,c)||this;e.allSublayers=new k({root:e,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return a.sublayers}});e.sublayersSourceJSON=(b={},b[2]={},b[3]={},b[4]={},b[5]={},b);e.watch("sublayers",function(a,b){return e._handleSublayersChange(a,b)},!0);return e}d.__extends(c,a);c.prototype.readSublayers=function(a,
b){if(b&&a){var c=this.sublayersSourceJSON,d=m.nameToId(b.origin);2>d||(c[d]={context:b,visibleLayers:a.visibleLayers||c[d].visibleLayers,layers:a.layers||c[d].layers},2<d||(this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers),b=this.createSublayersForOrigin("web-document"),a=b.sublayers,b=b.origin,c=f.getProperties(this),c.setDefaultOrigin(b),this._set("sublayers",new r(a)),c.setDefaultOrigin("user")))}};c.prototype.findSublayerById=function(a){return this.allSublayers.find(function(b){return b.id===
a})};c.prototype.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};c.prototype.createSublayersForOrigin=function(a){var b="web-document"===a?m.nameToId("web-map"):m.nameToId(a),c=2;a=this.sublayersSourceJSON[2].layers;for(var d=this.sublayersSourceJSON[2].context,e=null,f=0,h=[3,4,5].filter(function(a){return a<=b});f<h.length;f++){var k=h[f],l=this.sublayersSourceJSON[k];g.isSublayerOverhaul(l.layers)&&(c=k,a=l.layers,d=l.context,l.visibleLayers&&(e={visibleLayers:l.visibleLayers,
context:l.context}))}for(var q=null,f=0,h=[3,4,5].filter(function(a){return a>c&&a<=b});f<h.length;f++){var u=this.sublayersSourceJSON[h[f]],k=u.layers,l=u.visibleLayers,u=u.context;k&&(q={layers:k,context:u});l&&(e={visibleLayers:l,context:u})}a=p(a,d);var v=new Map,w=new Set;if(q)for(d=0,f=q.layers;d<f.length;d++)h=f[d],v.set(h.id,h);if(e)for(d=0,f=e.visibleLayers;d<f.length;d++)w.add(f[d]);t(a,function(a){q&&a.read(v.get(a.id),q.context);e&&a.read({defaultVisibility:w.has(a.id)},e.context)});return{origin:m.idToName(c),
sublayers:new r({items:a})}};c.prototype.read=function(b,c){a.prototype.read.call(this,b,c);this.readSublayers(b,c)};c.prototype._handleSublayersChange=function(a,b){var c=this;b&&(b.forEach(function(a){a.parent=null;a.layer=null}),this.handles.remove("sublayers-owner"));a&&(a.forEach(function(a){a.parent=c;a.layer=c}),this.handles.add([a.on("after-add",function(a){a=a.item;a.parent=c;a.layer=c}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})],"sublayers-owner"),"tile"===this.type&&
this.handles.add(a.on("before-changes",function(a){u.error(new e("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:c}));a.preventDefault()}),"sublayers-owner"))};d.__decorate([h.property({readOnly:!0})],c.prototype,"allSublayers",void 0);d.__decorate([h.property({readOnly:!0,type:l.ofType(b)})],c.prototype,"serviceSublayers",void 0);d.__decorate([h.property({value:null,type:r,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],c.prototype,
"sublayers",void 0);d.__decorate([h.property({readOnly:!0})],c.prototype,"sublayersSourceJSON",void 0);return c=d.__decorate([h.subclass("esri.layers.mixins.SublayersOwner")],c)}(a)}})},"esri/layers/support/Sublayer":function(){define("require exports tslib ../../geometry ../../PopupTemplate ../../renderers ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ./FeatureType ./Field ./FieldsIndex ./fieldUtils ./LabelClass ./source/DataLayerSource ./source/MapLayerSource ../../support/popupUtils ../../tasks/support/Query @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K){function L(a){return a&&"esriSMS"===a.type}function M(a,b,c){return{ignoreOrigin:!0,enabled:c&&c.writeSublayerStructure||!1}}function Q(a,b,c){return{ignoreOrigin:!0,enabled:c?c.writeSublayerStructure||this.originIdOf(b)>=x.nameToId(c.origin):!1}}var R=u.getLogger("esri.layers.support.Sublayer"),O=0,N=new Set;N.add("layer");N.add("parent");N.add("loaded");N.add("loadStatus");N.add("loadError");N.add("loadWarnings");return function(a){function b(b){b=
a.call(this,b)||this;b.capabilities=void 0;b.fields=null;b.fullExtent=null;b.globalIdField=null;b.legendEnabled=!0;b.objectIdField=null;b.popupEnabled=!0;b.popupTemplate=null;b.sourceJSON=null;b.title=null;b.typeIdField=null;b.types=null;return b}d.__extends(b,a);g=b;b.prototype.load=function(a){return d.__awaiter(this,void 0,void 0,function(){var b=this;return d.__generator(this,function(e){this.addResolvingPromise(function(){return d.__awaiter(b,void 0,void 0,function(){var b,e,g,h,m;return d.__generator(this,
function(k){switch(k.label){case 0:if(!this.layer&&!this.url)throw new f("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});b=null;return!this.layer||2<this.originIdOf("url")||"data-layer"===(null===(h=this.source)||void 0===h?void 0:h.type)?[4,c(this.url,d.__assign({responseType:"json",query:{f:"json"}},a))]:[3,2];case 1:return e=k.sent(),b=e.data,[3,4];case 2:return g=this.id,"map-layer"===(null===(m=this.source)||void 0===m?void 0:m.type)&&(g=this.source.mapLayerId),
[4,this.layer.fetchSublayerInfo(g,a)];case 3:b=k.sent(),k.label=4;case 4:return b&&(this.sourceJSON=b,this.read({layerDefinition:b},{origin:"service"})),[2]}})})}());return[2,this]})})};b.prototype.readCapabilities=function(a,b){b=b.layerDefinition||b;a=(a=b.capabilities||a)?a.toLowerCase().split(",").map(function(a){return a.trim()}):[];return{exportMap:{supportsModification:!!b.canModifyLayer},operations:{supportsQuery:-1!==a.indexOf("query")}}};Object.defineProperty(b.prototype,"definitionExpression",
{set:function(a){this._setAndNotifyLayer("definitionExpression",a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"fieldsIndex",{get:function(){return new E(this.fields||[])},enumerable:!1,configurable:!0});b.prototype.readGlobalIdFieldFromService=function(a,b){b=b.layerDefinition||b;if(b.globalIdField)return b.globalIdField;if(b.fields)for(a=0,b=b.fields;a<b.length;a++){var c=b[a];if("esriFieldTypeGlobalID"===c.type)return c.name}};Object.defineProperty(b.prototype,"id",{get:function(){var a=
this._get("id");return null==a?O++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"labelingInfo",{set:function(a){this._setAndNotifyLayer("labelingInfo",a)},enumerable:!1,configurable:!0});b.prototype.writeLabelingInfo=function(a,b,c,d){a&&a.length&&
(b.layerDefinition={drawingInfo:{labelingInfo:a.map(function(a){return a.write({},d)})}})};Object.defineProperty(b.prototype,"labelsVisible",{set:function(a){this._setAndNotifyLayer("labelsVisible",a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"layer",{set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(function(b){return b.layer=a})},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"listMode",{set:function(a){this._set("listMode",a)},
enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"minScale",{set:function(a){this._setAndNotifyLayer("minScale",a)},enumerable:!1,configurable:!0});b.prototype.readMinScale=function(a,b){return b.minScale||b.layerDefinition&&b.layerDefinition.minScale||0};Object.defineProperty(b.prototype,"maxScale",{set:function(a){this._setAndNotifyLayer("maxScale",a)},enumerable:!1,configurable:!0});b.prototype.readMaxScale=function(a,b){return b.maxScale||b.layerDefinition&&b.layerDefinition.maxScale||
0};b.prototype.readObjectIdFieldFromService=function(a,b){b=b.layerDefinition||b;if(b.objectIdField)return b.objectIdField;if(b.fields)for(a=0,b=b.fields;a<b.length;a++){var c=b[a];if("esriFieldTypeOID"===c.type)return c.name}};Object.defineProperty(b.prototype,"opacity",{set:function(a){this._setAndNotifyLayer("opacity",a)},enumerable:!1,configurable:!0});b.prototype.readOpacity=function(a,b){a=b.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};b.prototype.writeOpacity=
function(a,b,c,d){b.layerDefinition={drawingInfo:{transparency:100-100*a}}};b.prototype.writeParent=function(a,b){b.parentLayerId=this.parent&&this.parent!==this.layer?this.parent.id:-1};Object.defineProperty(b.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"renderer",{set:function(a){if(a)for(var b=0,c=a.getSymbols();b<c.length;b++)if(h.isSymbol3D(c[b])){R.warn("Sublayer renderer should use 2D symbols");
break}this._setAndNotifyLayer("renderer",a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"source",{get:function(){return this._get("source")||new J.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"sublayers",{set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)},enumerable:!1,configurable:!0});b.prototype.castSublayers=function(a){return z.default(m.ofType(g),
a)};b.prototype.writeSublayers=function(a,b,c){this.get("sublayers.length")&&(b[c]=this.sublayers.map(function(a){return a.id}).toArray().reverse())};b.prototype.readTypeIdField=function(a,b){b=b.layerDefinition||b;if(a=b.typeIdField)if(b=G.getField(b.fields,a))return b.name;return null};Object.defineProperty(b.prototype,"url",{get:function(){var a,b,c=null!==(b=null===(a=this.layer)||void 0===a?void 0:a.parsedUrl)&&void 0!==b?b:this._lastParsedUrl;a=this.source;if(!c)return null;this._lastParsedUrl=
c;if("map-layer"===(null===a||void 0===a?void 0:a.type))return c.path+"/"+a.mapLayerId;a={layer:JSON.stringify({source:this.source})};return c.path+"/dynamicLayer?"+v.objectToQuery(a)},set:function(a){a?this._override("url",a):this._clearOverride("url")},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"visible",{set:function(a){this._setAndNotifyLayer("visible",a)},enumerable:!1,configurable:!0});b.prototype.writeVisible=function(a,b,c,d){b[c]=this.getAtOrigin("defaultVisibility",
"service")||a};b.prototype.clone=function(){var a=B.getProperties(this).store,b=new g;B.getProperties(b).store=a.clone(N);this.url;b._lastParsedUrl=this._lastParsedUrl;return b};b.prototype.createPopupTemplate=function(a){return I.createPopupTemplate(this,a)};b.prototype.createQuery=function(){return new K({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};b.prototype.createFeatureLayer=function(){var a,b;return d.__awaiter(this,void 0,void 0,function(){var c,e,f;return d.__generator(this,
function(d){switch(d.label){case 0:if(this.hasOwnProperty("sublayers"))return[2,null];c=null===(a=this.layer)||void 0===a?void 0:a.parsedUrl;return[4,new Promise(function(a,b){n(["../FeatureLayer"],a,b)})];case 1:return e=d.sent(),f=new e({url:c.path}),c&&this.source&&("map-layer"===this.source.type?f.layerId=this.source.mapLayerId:f.dynamicDataSource=this.source),null!=this.layer.refreshInterval&&(f.refreshInterval=this.layer.refreshInterval),this.definitionExpression&&(f.definitionExpression=this.definitionExpression),
2<this.originIdOf("labelingInfo")&&(f.labelingInfo=p.clone(this.labelingInfo)),0<this.originIdOf("labelsVisible")&&(f.labelsVisible=this.labelsVisible),0<this.originIdOf("legendEnabled")&&(f.legendEnabled=this.legendEnabled),0<this.originIdOf("visible")&&(f.visible=this.visible),0<this.originIdOf("minScale")&&(f.minScale=this.minScale),0<this.originIdOf("maxScale")&&(f.maxScale=this.maxScale),0<this.originIdOf("opacity")&&(f.opacity=this.opacity),0<this.originIdOf("popupTemplate")&&(f.popupTemplate=
p.clone(this.popupTemplate)),2<this.originIdOf("renderer")&&(f.renderer=p.clone(this.renderer)),"data-layer"===(null===(b=this.source)||void 0===b?void 0:b.type)&&(f.dynamicDataSource=this.source.clone()),0<this.originIdOf("title")&&(f.title=this.title),[2,f]}})})};b.prototype.getFeatureType=function(a){var b=this.typeIdField;if(!b||!a)return null;var c=a.attributes?a.attributes[b]:void 0;if(null==c)return null;var d=null;this.types.some(function(a){var b=a.id;if(null==b)return!1;b.toString()===c.toString()&&
(d=a);return!!d});return d};b.prototype.getFieldDomain=function(a,b){return(b=this.getFeatureType(b&&b.feature))&&(b=b.domains&&b.domains[a])&&"inherited"!==b.type?b:this._getLayerDomain(a)};b.prototype.queryFeatures=function(a,b){var c=this;void 0===a&&(a=this.createQuery());return this.load().then(function(){if(!c.get("capabilities.operations.supportsQuery"))throw new f("Sublayer.queryFeatures","this layer doesn't support queries.");return q.all([new Promise(function(a,b){n(["../../tasks/operations/query"],
a,b)}),new Promise(function(a,b){n(["../../tasks/support/FeatureSet"],a,b)})])}).then(function(d){var e=d[0].executeQuery,f=d[1];return e(c.url,K.from(a),c.layer?c.layer.spatialReference:null,b).then(function(a){return f.fromJSON(a.data)})}).then(function(a){a&&a.features&&a.features.forEach(function(a){a.sourceLayer=c});return a})};b.prototype.toExportImageJSON=function(){var a=this,b,c={id:this.id,source:null===(b=this.source)||void 0===b?void 0:b.toJSON()};this.definitionExpression&&(c.definitionExpression=
this.definitionExpression);var d=["renderer","labelingInfo","opacity","labelsVisible"].reduce(function(b,c){b[c]=a.originIdOf(c);return b},{});Object.keys(d).some(function(a){return 2<=d[a]})&&(b=c.drawingInfo={},2<=d.renderer&&(b.renderer=this.renderer?this.renderer.toJSON():null),2<=d.labelsVisible&&(b.showLabels=this.labelsVisible),this.labelsVisible&&2<=d.labelingInfo&&(b.labelingInfo=this.labelingInfo?this.labelingInfo.map(function(a){return a.write({},{origin:"service"})}):null,b.showLabels=
!0),2<=d.opacity&&(b.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(b.renderer));return c};b.prototype._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,function(a){a.color||"esriSMSX"!==a.style&&"esriSMSCross"!==a.style||(a.color=a.outline&&a.outline.color?a.outline.color:[0,0,0,0])})};b.prototype._forEachSimpleMarkerSymbols=function(a,b){if(a){var c=0,d="uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:[];for(;c<d.length;c++){var e=
d[c];L(e.symbol)&&b(e.symbol)}"symbol"in a&&L(a.symbol)&&b(a.symbol);"defaultSymbol"in a&&L(a.defaultSymbol)&&b(a.defaultSymbol)}};b.prototype._setAndNotifyLayer=function(a,b){var c=this.layer,d=this._get(a),e,f;switch(a){case "definitionExpression":e="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":e="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":e="supportsDynamicLayers",f="supportsModification"}var g=
B.getProperties(this).getDefaultOrigin();if("service"!==g){if(e&&!1===this.get("layer.capabilities.exportMap."+e)){this._logLockedError(a,"capability not available 'layer.capabilities.exportMap."+e+"'");return}if(f&&!1===this.get("capabilities.exportMap."+f)){this._logLockedError(a,"capability not available 'capabilities.exportMap."+f+"'");return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,b),"service"!==
g&&d!==b&&c&&c.emit&&c.emit("sublayer-update",{propertyName:a,target:this}))};b.prototype._handleSublayersChange=function(a,b){var c=this;b&&(b.forEach(function(a){a.parent=null;a.layer=null}),this.handles.removeAll());a&&(a.forEach(function(a){a.parent=c;a.layer=c.layer}),this.handles.add([a.on("after-add",function(a){a=a.item;a.parent=c;a.layer=c.layer}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null}),a.on("before-changes",function(a){var b=c.get("layer.capabilities.exportMap.supportsSublayersChanges");
null==b||b||(R.error(new f("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:c,layer:c.layer})),a.preventDefault())})]))};b.prototype._logLockedError=function(a,b){R.error(new f("sublayer:locked","Property '"+a+"' can't be changed on Sublayer from the layer '"+this.layer.id+"'",{reason:b,sublayer:this,layer:this.layer}))};b.prototype._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};var g;b.test={isSublayerStructureOverridePolicy:function(a){return a===
M}};d.__decorate([w.property({readOnly:!0})],b.prototype,"capabilities",void 0);d.__decorate([w.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],b.prototype,"readCapabilities",null);d.__decorate([w.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression",overridePolicy:Q}}})],b.prototype,"definitionExpression",null);d.__decorate([w.property({type:[C],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],
b.prototype,"fields",void 0);d.__decorate([w.property({readOnly:!0,dependsOn:["fields"]})],b.prototype,"fieldsIndex",null);d.__decorate([w.property({type:l.Extent,json:{read:{source:"layerDefinition.extent"}}})],b.prototype,"fullExtent",void 0);d.__decorate([w.property({type:String})],b.prototype,"globalIdField",void 0);d.__decorate([w.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],b.prototype,"readGlobalIdFieldFromService",null);d.__decorate([w.property({type:Number,
json:{write:{ignoreOrigin:!0}}})],b.prototype,"id",null);d.__decorate([w.property({value:null,type:[F],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:M}}})],b.prototype,"labelingInfo",null);d.__decorate([w.writer("labelingInfo")],b.prototype,"writeLabelingInfo",null);d.__decorate([w.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",
overridePolicy:M}}})],b.prototype,"labelsVisible",null);d.__decorate([w.property({value:null})],b.prototype,"layer",null);d.__decorate([w.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:Q}}})],b.prototype,"legendEnabled",void 0);d.__decorate([w.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],b.prototype,"listMode",null);d.__decorate([w.property({type:Number,
value:0,json:{write:{overridePolicy:M}}})],b.prototype,"minScale",null);d.__decorate([w.reader("minScale",["minScale","layerDefinition.minScale"])],b.prototype,"readMinScale",null);d.__decorate([w.property({type:Number,value:0,json:{write:{overridePolicy:M}}})],b.prototype,"maxScale",null);d.__decorate([w.reader("maxScale",["maxScale","layerDefinition.maxScale"])],b.prototype,"readMaxScale",null);d.__decorate([w.property({type:String})],b.prototype,"objectIdField",void 0);d.__decorate([w.reader("service",
"objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],b.prototype,"readObjectIdFieldFromService",null);d.__decorate([w.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:M}}})],b.prototype,"opacity",null);d.__decorate([w.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],b.prototype,"readOpacity",null);d.__decorate([w.writer("opacity")],b.prototype,"writeOpacity",null);d.__decorate([w.property({json:{type:Number,
write:{target:"parentLayerId",allowNull:!0,overridePolicy:M}}})],b.prototype,"parent",void 0);d.__decorate([w.writer("parent")],b.prototype,"writeParent",null);d.__decorate([w.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(a,b){return!b.disablePopup}},write:{target:"disablePopup",overridePolicy:Q,writer:function(a,b,c){b[c]=!a}}}})],b.prototype,"popupEnabled",void 0);d.__decorate([w.property({type:k,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:Q}}})],
b.prototype,"popupTemplate",void 0);d.__decorate([w.property({readOnly:!0,dependsOn:["fields","title"]})],b.prototype,"defaultPopupTemplate",null);d.__decorate([w.property({types:e.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:M},origins:{"web-scene":{types:e.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:M}}}}})],b.prototype,"renderer",null);d.__decorate([w.property({types:{key:"type",base:null,typeMap:{"data-layer":H.DataLayerSource,
"map-layer":J.MapLayerSource}},cast:function(a){if(a){if("mapLayerId"in a)return z.ensureClass(J.MapLayerSource,a);if("dataSource"in a)return z.ensureClass(H.DataLayerSource,a)}return a},json:{name:"layerDefinition.source",write:{overridePolicy:M}}})],b.prototype,"source",null);d.__decorate([w.property()],b.prototype,"sourceJSON",void 0);d.__decorate([w.property({value:null,json:{type:[z.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:M}}})],b.prototype,"sublayers",null);d.__decorate([w.cast("sublayers")],
b.prototype,"castSublayers",null);d.__decorate([w.writer("sublayers")],b.prototype,"writeSublayers",null);d.__decorate([w.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:Q}}})],b.prototype,"title",void 0);d.__decorate([w.property({type:String})],b.prototype,"typeIdField",void 0);d.__decorate([w.reader("typeIdField",["layerDefinition.typeIdField"])],b.prototype,"readTypeIdField",null);d.__decorate([w.property({type:[A],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],
b.prototype,"types",void 0);d.__decorate([w.property({type:String,dependsOn:["layer","source"],json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:function(){return{enabled:this._isOverridden("url")}}}}})],b.prototype,"url",null);d.__decorate([w.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:M}}})],b.prototype,"visible",null);d.__decorate([w.writer("visible")],b.prototype,"writeVisible",null);return b=g=d.__decorate([w.subclass("esri.layers.support.Sublayer")],
b)}(b.HandleOwnerMixin(r.MultiOriginJSONMixin(g.IdentifiableMixin(t))))})},"esri/layers/support/sublayerUtils":function(){define(["require","exports"],function(n,a){function d(a,d){if(!a||!a.length)return!0;d=d.slice().reverse().flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).map(function(a){return a.id}).toArray();if(a.length>d.length)return!1;for(var e=0,c=d.length,h=0;h<a.length;h++){for(var m=a[h].id;e<c&&d[e]!==m;)e++;if(e>=c)return!1}return!0}Object.defineProperty(a,"__esModule",
{value:!0});a.isSublayerOverhaul=a.isExportDynamic=a.shouldWriteSublayerStructure=void 0;a.shouldWriteSublayerStructure=function(a,k,e){return k.flatten(function(a){return a.sublayers}).length!==a.length||a.some(function(a){return a.originIdOf("minScale")>e||a.originIdOf("maxScale")>e||a.originIdOf("renderer")>e||a.originIdOf("labelingInfo")>e||a.originIdOf("opacity")>e||a.originIdOf("labelsVisible")>e||a.originIdOf("source")>e})?!0:!d(a,k)};a.isExportDynamic=function(a,k,e){return a.some(function(a){var c=
a.source;return!(!c||"map-layer"===c.type&&c.mapLayerId===a.id&&(!c.gdbVersion||c.gdbVersion===e.gdbVersion))||2<a.originIdOf("renderer")||2<a.originIdOf("labelingInfo")||2<a.originIdOf("opacity")||2<a.originIdOf("labelsVisible")})?!0:!d(a,k)};a.isSublayerOverhaul=function(a){return!!a&&a.some(function(a){return null!=a.minScale||a.layerDefinition&&null!=a.layerDefinition.minScale})}})},"esri/layers/VectorTileLayer":function(){define("require exports tslib ../request ../core/Error ../core/global ../core/lang ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/SpriteSource ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/2d/engine/vectorTiles/SchemaHelper ../views/2d/engine/vectorTiles/tileInfoUtils ../views/2d/engine/vectorTiles/style/StyleRepository".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J){return function(a){function h(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b._spriteSourceMap=new Map;b.currentStyleInfo=null;b.style=null;b.isReference=null;b.operationalLayerType="VectorTileLayer";b.type="vector-tile";b.url=null;return b}d.__extends(h,a);h.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?d.__assign({url:a},b):a};h.prototype.destroy=function(){this._spriteSourceMap.clear()};
h.prototype.prefetchResources=function(a){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(b){switch(b.label){case 0:return[4,this.loadSpriteSource(e.devicePixelRatio||1,a)];case 1:return b.sent(),[2]}})})};h.prototype.load=function(a){var b=this,c=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},a).then(function(){return d.__awaiter(b,void 0,void 0,function(){var b,c;return d.__generator(this,function(e){switch(e.label){case 0:if(!this.portalItem||
!this.portalItem.id)return[2];b=this.portalItem.itemUrl+"/resources/styles/root.json";return[4,l(b,d.__assign(d.__assign({},a),{query:{f:"json"}}))];case 1:return c=e.sent(),c.data&&this.read({url:b},G.createForItem(this.portalItem)),[2]}})})}).then(function(){return b._loadStyle(a)},function(){return b._loadStyle(a)});this.addResolvingPromise(c);return m.resolve(this)};Object.defineProperty(h.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&b.urlToObject(a.serviceUrl))?
this._getDefaultAttribution(a.path):null},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"capabilities",{get:function(){var a=this._getPrimarySource();return a?a.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"fullExtent",{get:function(){var a=this._getPrimarySource();return a?a.fullExtent:null},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"parsedUrl",
{get:function(){return this.serviceUrl?f.urlToObject(this.serviceUrl):null},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&
this.currentStyleInfo.styleUrl||null},enumerable:!1,configurable:!0});h.prototype.writeStyleUrl=function(a,c){a&&b.isProtocolRelative(a)&&(a="https:"+a);c.styleUrl=a};Object.defineProperty(h.prototype,"tileIndexType",{get:function(){var a=this._getPrimarySource();return a?a.type:""},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"tileIndexUrl",{get:function(){var a=this._getPrimarySource();return a?a.tileMapURL:""},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,
"tileInfo",{get:function(){var a=[],b;for(b in this.sourceNameToSource)a.push(this.sourceNameToSource[b]);b=this._getPrimarySource().tileInfo;if(1<a.length)for(var c=0;c<a.length;c++)H.areSchemasOverlapping(b,a[c].tileInfo)&&(b=H.unionTileInfos(b,a[c].tileInfo));return b},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"tilemapCache",{get:function(){var a=this._getPrimarySource();return a?a.capabilities.operations.supportsTileMap?a.tilemapCache:null:null},enumerable:!1,configurable:!0});
Object.defineProperty(h.prototype,"tileServers",{get:function(){var a=this._getPrimarySource();return a?a.tileServers:[]},enumerable:!1,configurable:!0});h.prototype.readVersion=function(a,b){return b.version?parseFloat(b.version):parseFloat(b.currentVersion)};Object.defineProperty(h.prototype,"compatibleTileInfo256",{get:function(){return F.create256x256CompatibleTileInfo(this.tileInfo)},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"compatibleTileInfo512",{get:function(){return F.create512x512CompatibleTileInfo(this.tileInfo)},
enumerable:!1,configurable:!0});h.prototype.loadSpriteSource=function(a,b){void 0===a&&(a=1);return d.__awaiter(this,void 0,void 0,function(){var c;return d.__generator(this,function(d){switch(d.label){case 0:if(this._spriteSourceMap.has(a))return[3,2];c=new B.default(this.styleRepository.sprite,a);return[4,c.load(b)];case 1:d.sent(),this._spriteSourceMap.set(a,c),d.label=2;case 2:return[2,m.resolve(this._spriteSourceMap.get(a))]}})})};h.prototype.loadStyle=function(a,b){return d.__awaiter(this,void 0,
void 0,function(){var c,e,f,g=this;return d.__generator(this,function(d){c=a||this.style||this.url;if(this._loadingPromise&&"string"===typeof c&&this.url===c&&!m.isAborted(this._abortController))return[2,this._loadingPromise];(e=this._abortController)&&e.abort();f=m.createAbortController();this._loadingPromise=m.create(function(a,d){var e={signal:f.signal};g._spriteSourceMap.clear();g._getSourceAndStyle(c,e).then(a,d);m.onAbort(b,function(){f.abort()})});this._abortController=f;return[2,this._loadingPromise]})})};
h.prototype.getStyleLayerId=function(a){return this.styleRepository.getStyleLayerId(a)};h.prototype.getPaintProperties=function(a){return c.clone(this.styleRepository.getPaintProperties(a))};h.prototype.setPaintProperties=function(a,b){var c=this.styleRepository.isPainterDataDriven(a),d=this.styleRepository.setPaintProperties(a,b),e=this.styleRepository.isPainterDataDriven(a);this.emit("paint-change",{layer:d,paint:b});(c||e)&&this.emit("layout-change",{layer:d,layout:this.styleRepository.getLayoutProperties(a),
symbols:!1})};h.prototype.getLayoutProperties=function(a){return c.clone(this.styleRepository.getLayoutProperties(a))};h.prototype.setLayoutProperties=function(a,b){a=this.styleRepository.setLayoutProperties(a,b);this.emit("layout-change",{layer:a,layout:b})};h.prototype.getTileUrl=function(a,b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};h.prototype.write=function(b,c){return c&&c.origin&&
!this.styleUrl?(c.messages&&c.messages.push(new k("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):a.prototype.write.call(this,b,c)};h.prototype._getSourceAndStyle=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c;return d.__generator(this,function(d){switch(d.label){case 0:if(!a)throw Error("invalid style!");return[4,E.loadMetadata(a,b)];case 1:return c=d.sent(),this._set("currentStyleInfo",
{serviceUrl:c.serviceUrl,styleUrl:c.styleUrl,spriteUrl:c.spriteUrl,glyphsUrl:c.glyphsUrl,style:c.style,layerDefinition:c.layerDefinition}),"string"===typeof a?(this.url=a,this.style=null):(this.url=null,this.style=a),this._set("sourceNameToSource",c.sourceNameToSource),this._set("primarySourceName",c.primarySourceName),this._set("styleRepository",new J(c.style,c)),this.read(c.layerDefinition,{origin:"service"}),[2]}})})};h.prototype._getDefaultAttribution=function(a){var c=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);
if(c&&(a=c[3]&&c[3].toLowerCase()))for(var c=c[2]||"",d=0,e="OpenStreetMap_v2 OpenStreetMap_Export_v2 OpenStreetMap_FTS_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84".split(" ");d<e.length;d++){var f=e[d];if(-1<f.toLowerCase().indexOf(a))return b.normalize("//static.arcgis.com/attribution/Vector"+c+"/"+f)}};h.prototype._getPrimarySource=function(){return this.sourceNameToSource&&this.primarySourceName in this.sourceNameToSource?
this.sourceNameToSource[this.primarySourceName]:null};h.prototype._loadStyle=function(a){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(b){return this._loadingPromise?[2,this._loadingPromise]:[2,this.loadStyle(null,a)]})})};d.__decorate([g.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],h.prototype,"attributionDataUrl",null);d.__decorate([g.property({type:["show","hide"]})],h.prototype,"listMode",void 0);d.__decorate([g.property({json:{read:!1},readOnly:!0,
dependsOn:["sourceNameToSource","primarySourceName"]})],h.prototype,"capabilities",null);d.__decorate([g.property({readOnly:!0})],h.prototype,"currentStyleInfo",void 0);d.__decorate([g.property({json:{read:!1},readOnly:!0,type:p,dependsOn:["sourceNameToSource","primarySourceName"]})],h.prototype,"fullExtent",null);d.__decorate([g.property()],h.prototype,"style",void 0);d.__decorate([g.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],h.prototype,
"isReference",void 0);d.__decorate([g.property({type:["VectorTileLayer"]})],h.prototype,"operationalLayerType",void 0);d.__decorate([g.property({readOnly:!0,dependsOn:["serviceUrl"]})],h.prototype,"parsedUrl",null);d.__decorate([g.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],h.prototype,"serviceUrl",null);d.__decorate([g.property({type:t,dependsOn:["tileInfo"],readOnly:!0})],h.prototype,"spatialReference",null);d.__decorate([g.property({readOnly:!0})],h.prototype,"styleRepository",void 0);
d.__decorate([g.property({readOnly:!0})],h.prototype,"sourceNameToSource",void 0);d.__decorate([g.property({readOnly:!0})],h.prototype,"primarySourceName",void 0);d.__decorate([g.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],h.prototype,"styleUrl",null);d.__decorate([g.writer(["portal-item","web-document"],"styleUrl")],h.prototype,"writeStyleUrl",null);d.__decorate([g.property({json:{read:!1},
readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],h.prototype,"tileIndexType",null);d.__decorate([g.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],h.prototype,"tileIndexUrl",null);d.__decorate([g.property({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:A,dependsOn:["sourceNameToSource","primarySourceName"]})],h.prototype,"tileInfo",null);d.__decorate([g.property({json:{read:!1},readOnly:!0,type:C.TilemapCache,dependsOn:["sourceNameToSource",
"primarySourceName"]})],h.prototype,"tilemapCache",null);d.__decorate([g.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],h.prototype,"tileServers",null);d.__decorate([g.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],h.prototype,"type",void 0);d.__decorate([g.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],h.prototype,"url",void 0);d.__decorate([g.property({readOnly:!0})],
h.prototype,"version",void 0);d.__decorate([g.reader("version",["version","currentVersion"])],h.prototype,"readVersion",null);d.__decorate([g.property({readOnly:!0,dependsOn:["tileInfo"]})],h.prototype,"compatibleTileInfo256",null);d.__decorate([g.property({readOnly:!0,dependsOn:["tileInfo"]})],h.prototype,"compatibleTileInfo512",null);return h=d.__decorate([g.subclass("esri.layers.VectorTileLayer")],h)}(v.BlendLayer(x.ScaleRangeLayer(r.ArcGISCachedService(q.ArcGISService(w.OperationalLayer(z.PortalLayer(h.MultiOriginJSONMixin(u))))))))})},
"esri/layers/support/SpriteSource":function(){define("require exports tslib ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/promiseUtils".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});var m=c.getLogger("esri.layers.support.SpriteSource");n=function(){function a(a,c){this.baseURL=a;this.devicePixelRatio=c;this._isRetina=!1;this._spritesData={};this.height=this.width=this.image=null;this.loadStatus="not-loaded"}Object.defineProperty(a.prototype,
"spriteNames",{get:function(){var a=[],c;for(c in this._spritesData)a.push(c);a.sort();return a},enumerable:!1,configurable:!0});a.prototype.getSpriteInfo=function(a){return this._spritesData[a]};a.prototype.load=function(a){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(b){switch(b.label){case 0:if(!this.baseURL)return this.loadStatus="failed",[2];this.loadStatus="loading";b.label=1;case 1:return b.trys.push([1,3,,4]),[4,this._loadSprites(a)];case 2:return b.sent(),
this.loadStatus="loaded",[3,4];case 3:return b.sent(),this.loadStatus="failed",[3,4];case 4:return[2]}})})};a.prototype._loadSprites=function(a){var b=this;this._isRetina=1.15<this.devicePixelRatio?!0:!1;var c=this.baseURL,f=this._isRetina?"@2x":"",u=""+c+f+".png";return h.all([l(c+f+".json",a),l(u,d.__assign({responseType:"image"},a))]).then(function(a){var d=a[0];a=a[1];var f=Object.keys(d.data);if(!f||0===f.length||1===f.length&&"_ssl"===f[0]||!a||!a.data)return b._spritesData=b.image=null,b.width=
b.height=0,h.resolve(null);b._spritesData=d.data;d=a.data;a=Math.max(e("esri-webgl-max-texture-size"),4096);if(d.width>a||d.height>a)throw d="Sprite resource for style "+c+" is bigger than the maximum allowed of "+a+" pixels}",m.error(d),new k("SpriteSource",d);b.width=d.width;b.height=d.height;a=document.createElement("canvas");f=a.getContext("2d");a.width=d.width;a.height=d.height;f.drawImage(d,0,0,d.width,d.height);d=f.getImageData(0,0,d.width,d.height);d=new Uint8Array(d.data);for(f=0;f<d.length;f+=
4)a=d[f+3]/255,d[f]*=a,d[f+1]*=a,d[f+2]*=a;b.image=d})};return a}();a.default=n})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports tslib ../../config ../../request ../../core/promiseUtils ../../core/urlUtils ../../views/2d/engine/vectorTiles/style/VectorTileSource".split(" "),function(n,a,d,l,k,e,c,h){function m(a){a&&(a=c.getOrigin(a),t&&-1===t.indexOf(a)&&t.push(a))}function f(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var b=void 0,d=0;d<a.length;++d)c.isProtocolRelative(a[d])?
b&&(b=b.split("://")[0]+":"+a[d].trim()):b=c.isAbsolute(a[d])?a[d]:c.join(b,a[d]);return c.removeTrailingSlash(b)}function b(a,b,f,h,l){return d.__awaiter(this,void 0,void 0,function(){var r,t,q,u,v,w;return d.__generator(this,function(n){switch(n.label){case 0:e.throwIfAborted(l);if("string"!==typeof f)return[3,2];u=c.normalize(f);m(u);v=c.urlToObject(u);return[4,k(v.path,d.__assign({query:{f:"json"},responseType:"json"},l))];case 1:return q=n.sent(),t=r=u,[3,3];case 2:q={data:f},r=f.jsonUrl||null,
t=h,n.label=3;case 3:return w=q.data,q.ssl&&(r&&(r=r.replace(/^http:/i,"https:")),t&&(t=t.replace(/^http:/i,"https:"))),w.sources?(a.styleUrl=r||null,[2,g(a,w,t,l)]):w.sources?[2,e.reject("You must specify the URL or the JSON for a service or for a style.")]:a.sourceUrl?[2,p(a,w,t,!1,b,l)]:(a.sourceUrl=r||null,[2,p(a,w,t,!0,b,l)])}})})}function g(a,g,h,k){return d.__awaiter(this,void 0,void 0,function(){var l,p,r,t,q,u;return d.__generator(this,function(d){switch(d.label){case 0:l=h?c.removeFile(h):
c.appBaseUrl;a.styleBase=l;a.style=g;a.styleUrl&&m(a.styleUrl);p=[];if(!g.sources||!g.sources.esri)return[3,3];r=g.sources.esri;return r.url?[4,b(a,"esri",f(l,r.url),void 0,k)]:[3,2];case 1:return d.sent(),[3,3];case 2:p.push(b(a,"esri",r,l,k)),d.label=3;case 3:t=0;for(q=Object.keys(g.sources);t<q.length;t++)u=q[t],"esri"!==u&&"vector"===g.sources[u].type&&(g.sources[u].url?p.push(b(a,u,f(l,g.sources[u].url),void 0,k)):p.push(b(a,u,g.sources[u],l,k)));return[4,e.all(p)];case 4:return d.sent(),[2]}})})}
function p(a,g,k,l,p,t){return d.__awaiter(this,void 0,void 0,function(){var r,q,u,v;return d.__generator(this,function(d){r=k?c.removeTrailingSlash(k)+"/":c.appBaseUrl;d=r;if(g.hasOwnProperty("tileInfo"))q=g;else{for(var n={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},w=78271.51696400007,z=2.958287637957775E8,x=[],B=g.hasOwnProperty("minzoom")?parseFloat(g.minzoom):0,A=g.hasOwnProperty("maxzoom")?parseFloat(g.maxzoom):
22,C=0;C<=A;C++)C>=B&&x.push({level:C,scale:z,resolution:w}),w/=2,z/=2;w=0;for(z=g.tiles;w<z.length;w++)m(f(d,z[w]));q={capabilities:"TilesOnly",initialExtent:n,fullExtent:n,minScale:0,maxScale:0,tiles:g.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:x,spatialReference:{wkid:102100}}}}u=new h(p,r,q);if(!l&&a.primarySourceName in a.sourceNameToSource){v=a.sourceNameToSource[a.primarySourceName];if(!v.isCompatibleWith(u))return[2,e.resolve()];
null!=u.fullExtent&&(null!=v.fullExtent?v.fullExtent.union(u.fullExtent):v.fullExtent=u.fullExtent.clone());v.tileInfo.lods.length<u.tileInfo.lods.length&&(v.tileInfo=u.tileInfo)}l?(a.sourceBase=r,a.source=g,a.validatedSource=q,a.primarySourceName=p,a.sourceUrl&&m(a.sourceUrl)):m(r);a.sourceNameToSource[p]=u;return a.style?[2]:null==g.defaultStyles?[2,e.reject()]:"string"===typeof g.defaultStyles?[2,b(a,"",f(r,g.defaultStyles,"root.json"),void 0,t)]:[2,b(a,"",g.defaultStyles,f(r,"root.json"),t)]})})}
Object.defineProperty(a,"__esModule",{value:!0});a.loadMetadata=void 0;var t=l.defaults&&l.defaults.io.corsEnabledServers;a.loadMetadata=function(a,e){return d.__awaiter(this,void 0,void 0,function(){var g,h,k,l,p,r;return d.__generator(this,function(d){switch(d.label){case 0:return g={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:""},h="string"===typeof a?[a,null]:[null,a.jsonUrl],k=h[0],l=h[1],p=k?
c.urlToObject(k):null,[4,b(g,"esri",a,l,e)];case 1:return d.sent(),r={layerDefinition:g.validatedSource,url:k,parsedUrl:p,serviceUrl:g.sourceUrl,style:g.style,styleUrl:g.styleUrl,spriteUrl:g.style.sprite&&f(g.styleBase,g.style.sprite),glyphsUrl:g.style.glyphs&&f(g.styleBase,g.style.glyphs),sourceNameToSource:g.sourceNameToSource,primarySourceName:g.primarySourceName},m(r.spriteUrl),m(r.glyphsUrl),[2,r]}})})}})},"esri/views/2d/engine/vectorTiles/style/VectorTileSource":function(){define("require exports ../../../../../core/lang ../../../../../core/promiseUtils ../../../../../core/urlUtils ../../../../../geometry/Extent ../../../../../layers/support/serviceTileInfoProperty ../../../../../layers/support/TilemapCache ../TileIndex".split(" "),
function(n,a,d,l,k,e,c,h,m){return function(){function a(a,f,l){this.tileMapURL="";this.fullExtent=this.tileIndex=this.capabilities=this.tileInfo=this.parsedUrl=this.tilemapCache=null;this.name=a;if(this.sourceUrl=f)this.parsedUrl=k.urlToObject(this.sourceUrl);a=d.clone(l);var b=a.tiles;f&&b.forEach(function(a,c){k.isAbsolute(a)||(b[c]=k.join(f,a))});this.tileServers=b;l.tileMap&&(this.tileMapURL=k.join(f,l.tileMap));var g=l.capabilities&&l.capabilities.split(",").map(function(a){return a.toLowerCase().trim()}),
p=!!l.exportTilesAllowed,g=!!g&&-1!==g.indexOf("tilemap"),q=p&&l.hasOwnProperty("maxExportTilesCount")?l.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:p,supportsTileMap:g},exportTiles:p?{maxExportTilesCount:+q}:null};this.tileInfo=c.readServiceTileInfo(a.tileInfo,a,null,{ignoreMinMaxLOD:!0});g&&(this.type="vector-tile",this.tilemapCache=new h.TilemapCache({layer:this}),this.tileIndex=new m(this.tilemapCache));this.fullExtent=e.fromJSON(l.fullExtent)}a.prototype.getRefKey=
function(a,c){return this.tileIndex?this.tileIndex.dataKey(a,c):l.resolve(a)};a.prototype.getSourceTileUrl=function(a,c,d){var b=this.tileServers[c%this.tileServers.length];return b=b.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,c.toString()).replace(/\{x\}/gi,d.toString())};a.prototype.isCompatibleWith=function(a){var b=this.tileInfo;a=a.tileInfo;if(!b.spatialReference.equals(a.spatialReference)||!b.origin.equals(a.origin)||Math.round(b.dpi)!==Math.round(a.dpi))return!1;b=b.lods;a=a.lods;for(var c=
Math.min(b.length,a.length),d=0;d<c;d++){var e=b[d],f=a[d];if(e.level!==f.level||Math.round(e.scale)!==Math.round(f.scale))return!1}return!0};return a}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["require","exports","../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(n,a,d,l,k){return function(){function a(a){if(a instanceof l.TilemapCache)this._tilemapCache=a;else if(a&&"index"in a)this._tilemap=a.index;else throw Error("Invalid tilemap!");
}a.prototype.dataKey=function(a,e){if(this._tilemapCache){var c=a.level,f=a.row,b=a.col,g=new k(a);return this._tilemapCache.fetchAvailabilityUpsample(c,f,b,g,e).then(function(){return g}).catch(function(a){if(d.isAbortError(a))throw a;return null})}return this._getIndexedDataKey(a)};a.prototype.forEach=function(a,d,e,f,b){this._callback=b;this._maxLevel=d+a;this._forEach(this._tilemap,d,e,f)};a.prototype._forEach=function(a,d,e,f){0!==a&&(this._callback(d,e,f),d!==this._maxLevel&&"object"===typeof a&&
(this._forEach(a[0],d+1,2*e,2*f),this._forEach(a[1],d+1,2*e,2*f+1),this._forEach(a[2],d+1,2*e+1,2*f),this._forEach(a[3],d+1,2*e+1,2*f+1)))};a.prototype._getIndexedDataKey=function(a){var c=[a];if(0>a.level||0>a.row||0>a.col||0<a.row>>a.level||0<a.col>>a.level)return d.resolve(null);for(;0!==a.level;)a=new k(a.level-1,a.row>>1,a.col>>1,a.world),c.push(a);a=this._tilemap;var e=c.pop(),f,b;if(1===a)return d.resolve(e);for(;c.length;)if(f=c.pop(),b=(f.col&1)+((f.row&1)<<1),a){if(0===a[b]){e=null;break}if(1===
a[b]){e=f;break}e=f;a=a[b]}return d.resolve(e)};return a}()})},"esri/views/2d/tiling/TileKey":function(){define(["require","exports","../../../core/ObjectPool"],function(n,a,d){return function(){function a(a,d,c,h){this.set(a,d,c,h)}a.getId=function(a,d,c,h){return"object"===typeof a?a.level+"/"+a.row+"/"+a.col+"/"+a.world:a+"/"+d+"/"+c+"/"+h};Object.defineProperty(a.prototype,"key",{get:function(){return this},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this.toString()},
set:function(a){this.set(a)},enumerable:!1,configurable:!0});a.prototype.acquire=function(a,d,c,h){this.set(a,d,c,h)};a.prototype.contains=function(a){var d=a.level-this.level;return this.row===a.row>>d&&this.col===a.col>>d&&this.world===a.world};a.prototype.equals=function(a){return this.level===a.level&&this.row===a.row&&this.col===a.col&&this.world===a.world};a.prototype.clone=function(){return new a(this)};a.prototype.release=function(){this.world=this.col=this.row=this.level=0};a.prototype.set=
function(a,d,c,h){null==a?this.world=this.col=this.row=this.level=0:"object"===typeof a?(this.level=a.level||0,this.row=a.row||0,this.col=a.col||0,this.world=a.world||0):"string"===typeof a?(a=a.split("/"),d=a[1],c=a[2],h=a[3],this.level=parseFloat(a[0]),this.row=parseFloat(d),this.col=parseFloat(c),this.world=parseFloat(h)):(this.level=+a,this.row=+d,this.col=+c,this.world=+h||0);return this};a.prototype.toString=function(){return this.level+"/"+this.row+"/"+this.col+"/"+this.world};a.prototype.getParentKey=
function(){return 0>=this.level?null:new a(this.level-1,this.row>>1,this.col>>1,this.world)};a.prototype.getChildKeys=function(){var d=this.level+1,e=this.row<<1,c=this.col<<1,h=this.world;return[new a(d,e,c,h),new a(d,e,c+1,h),new a(d,e+1,c,h),new a(d,e+1,c+1,h)]};a.prototype.compareRowMajor=function(a){return this.row<a.row?-1:this.row>a.row?1:this.col<a.col?-1:this.col>a.col?1:0};a.pool=new d(a,null,null,25,50);return a}()})},"esri/portal/support/jsonContext":function(){define(["require","exports",
"../../core/urlUtils","../Portal"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.createForItem=void 0;a.createForItem=function(a){return{origin:"portal-item",url:d.urlToObject(a.itemUrl),portal:a.portal||l.getDefault(),portalItem:a,readResourcePaths:[]}}})},"esri/views/2d/engine/vectorTiles/SchemaHelper":function(){define(["require","exports","../../../../layers/support/LOD","../../../../layers/support/TileInfo"],function(n,a,d,l){return function(){function a(a,c){this.lockedSchemaPixelSize=
a;this.isGCS=c}a.prototype.getLevelRowColumn=function(a){return this.isGCS?[a[0],a[1]>>1,a[2]>>1]:256===this.lockedSchemaPixelSize&&0<a[0]?[a[0]-1,a[1]>>1,a[2]>>1]:a};a.prototype.adjustLevel=function(a){return this.isGCS?a:256===this.lockedSchemaPixelSize?0<a?a-1:0:a};a.prototype.getShift=function(a,c){var d=0,e=0;if(256===this.lockedSchemaPixelSize||this.isGCS)a[2]%2&&(d=c),a[1]%2&&(e=c);return[d,e]};a.prototype.getScale=function(a){if(this.isGCS){if(512===this.lockedSchemaPixelSize)return 4}else if(256===
this.lockedSchemaPixelSize&&0===a)return 1;return 2};a.create256x256CompatibleTileInfo=function(a){if(!a)return null;if(256===a.size[0]&&256===a.size[1])return a;for(var c=a.spatialReference.isGeographic,e=[],m=a.lods.length,f=0;f<m;f++){var b=a.lods[f];e.push(new d({level:b.level,scale:b.scale,resolution:c?b.resolution:2*b.resolution}))}return new l({size:[256,256],dpi:a.dpi,format:a.format,compressionQuality:a.compressionQuality,origin:a.origin,spatialReference:a.spatialReference,lods:e})};a.create512x512CompatibleTileInfo=
function(a){if(!a||256===a.size[0]||256===a.size[1])return null;for(var c=[],e=a.lods.length,m=0;m<e;m++){var f=a.lods[m];c.push(new d({level:f.level,scale:f.scale,resolution:.5*f.resolution}))}return new l({size:[512,512],dpi:a.dpi,format:a.format,compressionQuality:a.compressionQuality,origin:a.origin,spatialReference:a.spatialReference,lods:c})};return a}()})},"esri/views/2d/engine/vectorTiles/tileInfoUtils":function(){define(["require","exports","../../../../layers/support/TileInfo"],function(n,
a,d){Object.defineProperty(a,"__esModule",{value:!0});a.unionTileInfos=a.areSchemasOverlapping=void 0;a.areSchemasOverlapping=function(a,d){if(a===d)return!0;if(!a&&null!=d||null!=a&&!d||!a.spatialReference.equals(d.spatialReference)||a.dpi!==d.dpi)return!1;var e=a.origin,c=d.origin;if(1E-6<=Math.abs(e.x-c.x)||1E-6<=Math.abs(e.y-c.y))return!1;a.lods[0].scale>d.lods[0].scale?(e=a,a=d):e=d;for(d=e.lods[0].scale;d>=a.lods[a.lods.length-1].scale-1E-6;d/=2)if(1E-6>Math.abs(d-a.lods[0].scale))return!0;
return!1};a.unionTileInfos=function(a,k){if(a===k)return a;if(!a&&null!=k)return k;if(null!=a&&!k)return a;var e=a.size[0],c=a.format,h=a.dpi,m={x:a.origin.x,y:a.origin.y},f=a.spatialReference.toJSON(),b=a.lods[0].scale>k.lods[0].scale?a.lods[0]:k.lods[0];a=(a.lods[a.lods.length-1].scale<=k.lods[k.lods.length-1].scale?a.lods[a.lods.length-1]:k.lods[k.lods.length-1]).scale;k=[];for(var g=b.scale,b=b.resolution,l=0;g>a;)k.push({level:l,resolution:b,scale:g}),l++,g/=2,b/=2;return new d({size:[e,e],dpi:h,
format:c||"pbf",origin:m,lods:k,spatialReference:f})}})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["require","exports","../../../../../core/has","./StyleLayer"],function(n,a,d,l){return function(){function a(d,c){this.backgroundBucketIds=[];this._layerByName={};this.styleJSON=d;this.version=parseFloat(d.version);this.sprite=c?c.spriteUrl:d.sprite;this.glyphs=c?c.glyphsUrl:d.glyphs;if(this.layers=(d.layers||[]).map(a._create))for(d=void 0,c=0;c<this.layers.length;c++)d=
this.layers[c],this._layerByName[d.id.toLowerCase()]=d,0===d.type&&this.backgroundBucketIds.push(c);this._identifyRefLayers()}a.prototype.isPainterDataDriven=function(a){return(a=this._layerByName[a.toLowerCase()])?a.isPainterDataDriven():!1};a.prototype.getStyleLayerId=function(a){return a>=this.layers.length?null:this.layers[a].id};a.prototype.getLayoutProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?a.layout:null};a.prototype.getPaintProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?
a.paint:null};a.prototype.setPaintProperties=function(d,c){d=this._layerByName[d.toLowerCase()];if(!d)return"";var e=this.layers.indexOf(d);this.styleJSON.layers[e].paint=c;c=a._recreateLayer({id:d.id,type:d.typeName,source:d.source,sourceLayer:d["source-layer"],minzoom:d.minzoom,maxzoom:d.maxzoom,filter:d.filter,layout:d.layout,paint:c},d);this.layers[e]=c;this._layerByName[d.id.toLowerCase()]=c;return d.id};a.prototype.setLayoutProperties=function(d,c){d=this._layerByName[d.toLowerCase()];if(!d)return"";
var e=this.layers.indexOf(d);this.styleJSON.layers[e].layout=c;c=a._recreateLayer({id:d.id,type:d.typeName,source:d.source,sourceLayer:d["source-layer"],minzoom:d.minzoom,maxzoom:d.maxzoom,filter:d.filter,layout:c,paint:d.paint},d);this.layers[e]=c;this._layerByName[d.id.toLowerCase()]=c;return d.id};a.prototype._identifyRefLayers=function(){for(var a=[],c=[],d=0,m=0,f=this.layers;m<f.length;m++){var b=f[m];if(1===b.type){var g=b,k=b.source+"|"+b.sourceLayer,k=k+("|"+JSON.stringify(b.layout&&b.layout.visibility)),
k=k+("|"+JSON.stringify(b.minzoom)),k=k+("|"+JSON.stringify(b.maxzoom)),k=k+("|"+JSON.stringify(b.filter));if(g.hasDataDrivenFill||g.hasDataDrivenOutline)k+="|"+JSON.stringify(d);a.push({key:k,layer:b})}2===b.type&&(g=b,k=b.source+"|"+b.sourceLayer,k+="|"+JSON.stringify(b.layout&&b.layout.visibility),k+="|"+JSON.stringify(b.minzoom),k+="|"+JSON.stringify(b.maxzoom),k+="|"+JSON.stringify(b.filter),k+="|"+JSON.stringify(b.layout&&b.layout["line-cap"]),k+="|"+JSON.stringify(b.layout&&b.layout["line-join"]),
g.hasDataDrivenLine&&(k+="|"+JSON.stringify(d)),c.push({key:k,layer:b}));++d}this._assignRefLayers(a);this._assignRefLayers(c)};a.prototype._assignRefLayers=function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var c,d,e=a.length,f=0;f<e;f++){var b=a[f];if(b.key===c)b.layer.refLayerId=d;else if(c=b.key,d=b.layer.id,1===b.layer.type&&!b.layer.getPaintProperty("fill-outline-color"))for(var g=f+1;g<e;g++){var k=a[g];if(k.key===c){if(k.layer.getPaintProperty("fill-outline-color")){a[f]=
k;a[g]=b;d=k.layer.id;break}}else break}}};a._create=function(a,c,d){c=1-1/(d.length+1)*(1+c);switch(a.type){case "background":return new l.BackgroundStyleLayer(0,a,c);case "fill":return new l.FillStyleLayer(1,a,c);case "line":return new l.LineStyleLayer(2,a,c);case "symbol":return new l.SymbolStyleLayer(3,a,c);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new l.CircleStyleLayer(4,a,c)}throw Error("Unknown vector tile layer");};a._recreateLayer=function(a,
c){switch(a.type){case "background":return new l.BackgroundStyleLayer(0,a,c.z);case "fill":return new l.FillStyleLayer(1,a,c.z);case "line":return new l.LineStyleLayer(2,a,c.z);case "symbol":return new l.SymbolStyleLayer(3,a,c.z);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new l.CircleStyleLayer(4,a,c.z)}};return a}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("require exports tslib ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.TextLayout=a.IconLayout=a.CircleStyleLayer=a.SymbolStyleLayer=a.LineStyleLayer=a.FillStyleLayer=a.BackgroundStyleLayer=a.StyleLayer=void 0;n=function(){function a(a,b,c){this.type=a;this.typeName=b.type;this.id=b.id;this.source=b.source;this.sourceLayer=b["source-layer"];this.minzoom=b.minzoom;this.maxzoom=b.maxzoom;this.filter=b.filter;this.layout=b.layout;this.paint=b.paint;this.z=c;switch(a){case 0:this._layoutDefinition=
k.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=k.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=k.StyleDefinition.fillLayoutDefinition;this._paintDefinition=k.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=k.StyleDefinition.lineLayoutDefinition;this._paintDefinition=k.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=k.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=k.StyleDefinition.symbolPaintDefinition;
break;case 4:this._layoutDefinition=k.StyleDefinition.circleLayoutDefinition,this._paintDefinition=k.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}a.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=l.createFilter(this.filter)};a.prototype.getLayoutProperty=function(a){return this._layoutProperties[a]};a.prototype.getPaintProperty=function(a){return this._paintProperties[a]};
a.prototype.getLayoutValue=function(a,b,c){var d,e=this._layoutProperties[a];e&&(d=e.getValue(b,c));var f=this._layoutDefinition[a];void 0===d&&(d=f["default"]);"enum"===f.type?d=f.values.indexOf(d):"array"===f.type&&"enum"===f.value&&(d=d.map(function(a){return f.values.indexOf(a)}));return d};a.prototype.getPaintValue=function(a,b,c){var d,e=this._paintProperties[a];e&&(d=e.getValue(b,c));a=this._paintDefinition[a];void 0===d&&(d=a["default"]);"enum"===a.type&&(d=a.values.indexOf(d));return d};
a.prototype.isPainterDataDriven=function(){var a=this._paintProperties;if(a)for(var b in a)if(a[b].isDataDriven)return!0;return!1};a.prototype._parseLayout=function(a){var b={},c;for(c in a){var d=this._layoutDefinition[c];d&&(b[c]=new e(d,a[c]))}return b};a.prototype._parsePaint=function(a){var b={},c;for(c in a){var d=this._paintDefinition[c];d&&(b[c]=new e(d,a[c]))}return b};return a}();a.StyleLayer=n;var h=function(a){function c(b,c,d){return a.call(this,b,c,d)||this}d.__extends(c,a);return c}(n);
a.BackgroundStyleLayer=h;h=function(a){function c(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("fill-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("fill-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;b.hasDataDrivenFill=b.hasDataDrivenColor||b.hasDataDrivenOpacity;c=b.getPaintProperty("fill-outline-color");b.outlineUsesFillColor=!c;b.hasDataDrivenOutlineColor=c?c.isDataDriven:!1;b.hasDataDrivenOutline=(c?b.hasDataDrivenOutlineColor:b.hasDataDrivenColor)||b.hasDataDrivenOpacity;
return b}d.__extends(c,a);return c}(n);a.FillStyleLayer=h;h=function(a){function e(b,d,e){b=a.call(this,b,d,e)||this;e=b.getPaintProperty("line-color");b.hasDataDrivenColor=e?e.isDataDriven:!1;e=b.getPaintProperty("line-opacity");b.hasDataDrivenOpacity=e?e.isDataDriven:!1;e=b.getPaintProperty("line-width");b.hasDataDrivenWidth=e?e.isDataDriven:!1;b.hasDataDrivenLine=b.hasDataDrivenColor||b.hasDataDrivenOpacity||b.hasDataDrivenWidth;d=d.paint["line-width"];d||(d=k.StyleDefinition.linePaintDefinition["line-width"].default);
b.isThinLine=!b.hasDataDrivenWidth&&"number"===typeof d&&d<c.THIN_LINE_THRESHOLD;return b}d.__extends(e,a);return e}(n);a.LineStyleLayer=h;h=function(a){function c(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("icon-color");b.hasDataDrivenIconColor=c?c.isDataDriven:!1;c=b.getPaintProperty("icon-opacity");b.hasDataDrivenIconOpacity=c?c.isDataDriven:!1;c=b.getLayoutProperty("icon-size");b.hasDataDrivenIconSize=c?c.isDataDriven:!1;b.hasDataDrivenIcon=b.hasDataDrivenIconColor||b.hasDataDrivenIconOpacity||
b.hasDataDrivenIconSize;c=b.getPaintProperty("text-color");b.hasDataDrivenTextColor=c?c.isDataDriven:!1;c=b.getPaintProperty("text-opacity");b.hasDataDrivenTextOpacity=c?c.isDataDriven:!1;c=b.getLayoutProperty("text-size");b.hasDataDrivenTextSize=c?c.isDataDriven:!1;b.hasDataDrivenText=b.hasDataDrivenTextColor||b.hasDataDrivenTextOpacity||b.hasDataDrivenTextSize;return b}d.__extends(c,a);return c}(n);a.SymbolStyleLayer=h;n=function(a){function c(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("circle-radius");
b.hasDataDrivenRadius=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-width");b.hasDataDrivenStrokeWidth=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-color");b.hasDataDrivenStrokeColor=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-opacity");b.hasDataDrivenStrokeOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-blur");
b.hasDataDrivenBlur=c?c.isDataDriven:!1;return b}d.__extends(c,a);return c}(n);a.CircleStyleLayer=n;n=function(){return function(a,c,b,d){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",c,d);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",c,d);this.keepUpright=a.getLayoutValue("icon-keep-upright",c,d);this.offset=a.getLayoutValue("icon-offset",c,d);this.optional=a.getLayoutValue("icon-optional",c,d);this.padding=a.getLayoutValue("icon-padding",c,d);this.rotate=a.getLayoutValue("icon-rotate",
c,d);this.rotationAlignment=a.getLayoutValue("icon-rotation-alignment",c,d);this.size=a.getLayoutValue("icon-size",c,d);2===this.rotationAlignment&&(this.rotationAlignment=b?0:1)}}();a.IconLayout=n;n=function(){return function(a,c,b,d){this.allowOverlap=a.getLayoutValue("text-allow-overlap",c,d);this.anchor=a.getLayoutValue("text-anchor",c,d);this.fontArray=a.getLayoutValue("text-font",c,d);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",c,d);this.justify=a.getLayoutValue("text-justify",
c,d);this.keepUpright=a.getLayoutValue("text-keep-upright",c,d);this.letterSpacing=a.getLayoutValue("text-letter-spacing",c,d);this.lineHeight=a.getLayoutValue("text-line-height",c,d);this.maxAngle=a.getLayoutValue("text-max-angle",c,d);this.maxWidth=a.getLayoutValue("text-max-width",c,d);this.offset=a.getLayoutValue("text-offset",c,d);this.optional=a.getLayoutValue("text-optional",c,d);this.padding=a.getLayoutValue("text-padding",c,d);this.rotate=a.getLayoutValue("text-rotate",c,d);this.rotationAlignment=
a.getLayoutValue("text-rotation-alignment",c,d);this.size=a.getLayoutValue("text-size",c,d);this.transform=a.getLayoutValue("text-transform",c,d);this.writingMode=a.getLayoutValue("text-writing-mode",c,d);2===this.rotationAlignment&&(this.rotationAlignment=b?0:1)}}();a.TextLayout=n})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["require","exports","../expression/expression"],function(n,a,d){return function(){function a(a){this._expression=a}a.prototype.filter=function(a,d){if(!this._expression)return!0;
try{return this._expression.evaluate(a,d)}catch(c){return console.log(c.message),!0}};a.createFilter=function(k){if(!k)return null;this.isLegacyFilter(k)&&(k=this.convertLegacyFilter(k));try{var e=d.createExpression(k);return new a(e)}catch(c){return console.log(c.message),null}};a.isLegacyFilter=function(a){if(!Array.isArray(a)||0===a.length)return!0;switch(a[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===a.length&&"string"===typeof a[1]&&!Array.isArray(a[2]);
case "in":return 3<=a.length&&"string"===typeof a[1]&&!Array.isArray(a[2]);case "!in":return!0;case "any":case "all":for(var d=1;d<a.length;d++)if(!this.isLegacyFilter(a[1]))return!1;return!0;case "none":return!0;case "has":return 2===a.length&&("$id"===a[1]||"$type"===a[1]);case "!has":return!0;default:return!1}};a.convertLegacyFilter=function(d){if(!Array.isArray(d)||0===d.length)return!0;var e=d[0];if(1===d.length)return"any"!==e;switch(e){case "\x3d\x3d":return a.convertComparison("\x3d\x3d",
d[1],d[2]);case "!\x3d":return a.negate(a.convertComparison("\x3d\x3d",d[1],d[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return a.convertComparison(e,d[1],d[2]);case "in":return a.convertIn(d[1],d.slice(2));case "!in":return a.negate(a.convertIn(d[1],d.slice(2)));case "any":case "all":case "none":return a.convertCombining(e,d.slice(1));case "has":return a.convertHas(d[1]);case "!has":return a.negate(a.convertHas(d[1]));default:throw Error("Unexpected legacy filter.");}};a.convertComparison=
function(a,d,c){switch(d){case "$type":return[a,["geometry-type"],c];case "$id":return[a,["id"],c];default:return[a,["get",d],c]}};a.convertIn=function(a,d){switch(a){case "$type":return["in",["geometry-type"],["literal",d]];case "$id":return["in",["id"],["literal",d]];default:return["in",["get",a],["literal",d]]}};a.convertHas=function(a){switch(a){case "$type":return!0;case "$id":return["has-id"];default:return["has",a]}};a.convertCombining=function(a,d){return[a].concat(d.map(this.convertLegacyFilter))};
a.negate=function(a){return["!",a]};return a}()})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define(["require","exports","./definition"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.createExpression=void 0;a.createExpression=function(a){if(null===a||"string"===typeof a||"boolean"===typeof a||"number"===typeof a)a=["literal",a];if(!Array.isArray(a)||0===a.length)throw Error("Expression must be a non empty array");var k=a[0];if("string"!==typeof k)throw Error("First element of expression must be a string");
var e=d.ops[k];if(void 0===e)throw Error('Invalid expression operator "'+k+'"');if(!e)throw Error('Unimplemented expression operator "'+k+'"');return e.parse(a)}})},"esri/views/2d/engine/vectorTiles/expression/definition":function(){define("require exports ./color ./data ./decision ./interpolate ./lookup ./math ./string ./types".split(" "),function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.ops=void 0;a.ops={array:f.Assert,"boolean":f.Assert,collator:null,format:null,
literal:f.Literal,image:null,number:f.Assert,"number-format":null,object:f.Assert,string:f.Assert,"to-boolean":f.Coerce,"to-color":f.Coerce,"to-number":f.Coerce,"to-string":f.Coerce,"typeof":f.TypeOf,accumulated:null,"feature-state":null,"geometry-type":l.GeomType,id:l.ID,"line-progress":null,properties:l.Properties,at:c.At,get:c.Get,has:c.Has,"in":c.In,"index-of":c.IndexOf,length:c.Length,slice:c.Slice,"!":k.NOT,"!\x3d":k.NE,"\x3c":k.LT,"\x3c\x3d":k.LE,"\x3d\x3d":k.EQ,"\x3e":k.GT,"\x3e\x3d":k.GE,
all:k.ALL,any:k.ANY,"case":k.Case,coalesce:k.Coalesce,match:k.Match,within:null,interpolate:e.Interpolate,"interpolate-hcl":e.Interpolate,"interpolate-lab":e.Interpolate,step:e.Step,let:null,"var":null,concat:m.Concat,downcase:m.String,"is-supported-script":null,"resolved-locale":null,upcase:m.String,rgb:d.Rgb,rgba:d.Rgba,"to-rgba":d.ToRgba,"-":h.Sub,"*":h.Mul,"/":h.Div,"%":h.Mod,"^":h.Pow,"+":h.Add,abs:h.Calculate,acos:h.Calculate,asin:h.Calculate,atan:h.Calculate,ceil:h.Calculate,cos:h.Calculate,
e:h.Calculate,floor:h.Calculate,ln:h.Calculate,ln2:h.Calculate,log10:h.Calculate,log2:h.Calculate,max:h.Calculate,min:h.Calculate,pi:h.Calculate,round:h.Calculate,sin:h.Calculate,sqrt:h.Calculate,tan:h.Calculate,zoom:l.Zoom,"heatmap-density":null,"has-id":c.HasID,none:k.NONE}})},"esri/views/2d/engine/vectorTiles/expression/color":function(){define(["require","exports","../../../../../Color","./expression"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.ToRgba=a.Rgba=a.Rgb=void 0;
var k=function(){function a(a){this.args=a}a.parse=function(c){if(4!==c.length)throw Error('"rgb" expects 3 arguments.');c=c.slice(1).map(function(a){return l.createExpression(a)});return new a(c)};a.prototype.evaluate=function(a,d){var c=this.args[1].evaluate(a,d),e=this.args[2].evaluate(a,d);a=this.args[3].evaluate(a,d);return"rgb("+Math.round(c)+","+Math.round(e)+","+Math.round(a)+")"};return a}();a.Rgb=k;n=function(){function a(a){this.args=a}a.parse=function(a){if(5!==a.length)throw Error('"rgba" expects 4 arguments.');
a=a.slice(1).map(function(a){return l.createExpression(a)});return new k(a)};a.prototype.evaluate=function(a,d){var c=this.args[1].evaluate(a,d),e=this.args[2].evaluate(a,d),b=this.args[3].evaluate(a,d);a=this.args[4].evaluate(a,d);return"rgb("+Math.round(c)+","+Math.round(e)+","+Math.round(b)+","+a+")"};return a}();a.Rgba=n;n=function(){function a(a){this.color=a}a.parse=function(c){if(2!==c.length)throw Error('"to-rgba" expects 1 argument.');c=l.createExpression(c[1]);return new a(c)};a.prototype.evaluate=
function(a,e){return(new d(this.color.evaluate(a,e))).toRgba()};return a}();a.ToRgba=n})},"esri/views/2d/engine/vectorTiles/expression/data":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.Zoom=a.Properties=a.GeomType=a.ID=void 0;n=function(){function a(){}a.parse=function(d){if(1<d.length)throw Error('"id" does not expect arguments');return new a};a.prototype.evaluate=function(a,d){return a.id};return a}();a.ID=n;n=function(){function a(){}
a.parse=function(d){if(1<d.length)throw Error('"geometry-type" does not expect arguments');return new a};a.prototype.evaluate=function(a,d){switch(a.type){case 0:return"Unknown";case 1:return"Point";case 2:return"LineString";case 3:return"Polygon"}};return a}();a.GeomType=n;n=function(){function a(){}a.parse=function(d){if(1<d.length)throw Error('"properties" does not expect arguments');return new a};a.prototype.evaluate=function(a,d){return a.values};return a}();a.Properties=n;n=function(){function a(){}
a.parse=function(d){if(1<d.length)throw Error('"zoom" does not expect arguments');return new a};a.prototype.evaluate=function(a,d){return d};return a}();a.Zoom=n})},"esri/views/2d/engine/vectorTiles/expression/decision":function(){define(["require","exports","tslib","./expression"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.Match=a.Coalesce=a.Case=a.NONE=a.ANY=a.ALL=a.NOT=a.GE=a.GT=a.LE=a.LT=a.NE=a.EQ=void 0;var k=function(){function a(a,d,e){this.lhs=a;this.rhs=d;this.compare=
e}a.parse=function(c,d){if(3!==c.length&&4!==c.length)throw Error('"'+c[0]+'" expects 2 or 3 arguments');if(4===c.length)throw Error('"'+c[0]+'" collator not supported');return new a(l.createExpression(c[1]),l.createExpression(c[2]),d)};a.prototype.evaluate=function(a,d){return this.compare(this.lhs.evaluate(a,d),this.rhs.evaluate(a,d))};return a}();n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.parse=function(a){return k.parse(a,function(a,c){return a===
c})};return c}(k);a.EQ=n;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.parse=function(a){return k.parse(a,function(a,c){return a!==c})};return c}(k);a.NE=n;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.parse=function(a){return k.parse(a,function(a,c){return a<c})};return c}(k);a.LT=n;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.parse=function(a){return k.parse(a,
function(a,c){return a<=c})};return c}(k);a.LE=n;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.parse=function(a){return k.parse(a,function(a,c){return a>c})};return c}(k);a.GT=n;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.parse=function(a){return k.parse(a,function(a,c){return a>=c})};return c}(k);a.GE=n;n=function(){function a(a){this.arg=a}a.parse=function(c){if(2!==c.length)throw Error('"!" expects 1 argument');
return new a(l.createExpression(c[1]))};a.prototype.evaluate=function(a,d){return!this.arg.evaluate(a,d)};return a}();a.NOT=n;n=function(){function a(a){this.args=a}a.parse=function(c){for(var d=[],e=1;e<c.length;e++)d.push(l.createExpression(c[e]));return new a(d)};a.prototype.evaluate=function(a,d){for(var c=0,e=this.args;c<e.length;c++)if(!e[c].evaluate(a,d))return!1;return!0};return a}();a.ALL=n;n=function(){function a(a){this.args=a}a.parse=function(c){for(var d=[],e=1;e<c.length;e++)d.push(l.createExpression(c[e]));
return new a(d)};a.prototype.evaluate=function(a,d){for(var c=0,e=this.args;c<e.length;c++)if(e[c].evaluate(a,d))return!0;return!1};return a}();a.ANY=n;n=function(){function a(a){this.args=a}a.parse=function(c){for(var d=[],e=1;e<c.length;e++)d.push(l.createExpression(c[e]));return new a(d)};a.prototype.evaluate=function(a,d){for(var c=0,e=this.args;c<e.length;c++)if(e[c].evaluate(a,d))return!1;return!0};return a}();a.NONE=n;n=function(){function a(a,d){this.args=a;this.fallback=d}a.parse=function(c){if(4>
c.length)throw Error('"case" expects at least 3 arguments');if(1===c.length%2)throw Error('"case" expects an odd number of arguments');for(var d=[],e=1;e<c.length-1;e+=2)d.push({condition:l.createExpression(c[e]),output:l.createExpression(c[e+1])});return new a(d,l.createExpression(c[c.length-1]))};a.prototype.evaluate=function(a,d){for(var c=0,e=this.args;c<e.length;c++){var b=e[c];if(b.condition.evaluate(a,d))return b.output.evaluate(a,d)}return this.fallback.evaluate(a,d)};return a}();a.Case=n;
n=function(){function a(a){this.args=a}a.parse=function(c){if(2>c.length)throw Error('"coalesce" expects at least 1 argument');for(var d=[],e=1;e<c.length;e++)d.push(l.createExpression(c[e]));return new a(d)};a.prototype.evaluate=function(a,d){for(var c=0,e=this.args;c<e.length;c++){var b=e[c].evaluate(a,d);if(null!==b)return b}return null};return a}();a.Coalesce=n;n=function(){function a(a,d,e,f){this.input=a;this.labels=d;this.outputs=e;this.fallback=f}a.parse=function(c){if(3>c.length)throw Error('"match" expects at least 3 arguments');
if(0===c.length%2)throw Error('"case" expects an even number of arguments');for(var d=l.createExpression(c[1]),e=[],f={},b,g=2;g<c.length-1;g+=2){var k=c[g];Array.isArray(k)||(k=[k]);for(var t=0;t<k.length;t++){var u=k[t],r=typeof u;if("string"!==r&&"number"!==r)throw Error('"match" requires string or number literal as labels');if(!b)b=r;else if(r!==b)throw Error('"match" requires labels to have the same type');f[u]=e.length}e.push(l.createExpression(c[g+1]))}return new a(d,f,e,l.createExpression(c[c.length-
1]))};a.prototype.evaluate=function(a,d){var c=this.input.evaluate(a,d);return(this.outputs[this.labels[c]]||this.fallback).evaluate(a,d)};return a}();a.Match=n})},"esri/views/2d/engine/vectorTiles/expression/interpolate":function(){define("require exports ../../../../../Color ../../../unitBezier ../GeometryUtils ./expression".split(" "),function(n,a,d,l,k,e){function c(a){return a>z?Math.pow(a,1/3):a/w+q}function h(a){return a>v?a*a*a:w*(a-q)}function m(a){return 255*(.0031308>=a?12.92*a:1.055*Math.pow(a,
1/2.4)-.055)}function f(a){a/=255;return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)}function b(a){var b=f(a.r),d=f(a.g),e=f(a.b),g=c((.4124564*b+.3575761*d+.1804375*e)/.95047),h=c((.2126729*b+.7151522*d+.072175*e)/1),b=c((.0193339*b+.119192*d+.9503041*e)/1.08883);return{l:116*h-16,a:500*(g-h),b:200*(h-b),alpha:a.a}}function g(a){var b=(a.l+16)/116,c=isNaN(a.a)?b:b+a.a/500,e=isNaN(a.b)?b:b-a.b/200,b=1*h(b),c=.95047*h(c),e=1.08883*h(e);return new d([m(3.2404542*c-1.5371385*b-.4985314*e),m(-.969266*
c+1.8760108*b+.041556*e),m(.0556434*c-.2040259*b+1.0572252*e),a.alpha])}function p(a,b,c){return{l:k.interpolate(a.l,b.l,c),a:k.interpolate(a.a,b.a,c),b:k.interpolate(a.b,b.b,c),alpha:k.interpolate(a.alpha,b.alpha,c)}}function t(a){var c=b(a),d=c.a,e=c.b,f=Math.atan2(e,d)*B;return{h:0>f?f+360:f,c:Math.sqrt(d*d+e*e),l:c.l,alpha:a.a}}function u(a){var b=a.h*x,c=a.c;return g({l:a.l,a:Math.cos(b)*c,b:Math.sin(b)*c,alpha:a.alpha})}function r(a,b,c){var d=a.h,e=b.h-d;return{h:d+c*(180<e||-180>e?e-360*Math.round(e/
360):e),c:k.interpolate(a.c,b.c,c),l:k.interpolate(a.l,b.l,c),alpha:k.interpolate(a.alpha,b.alpha,c)}}Object.defineProperty(a,"__esModule",{value:!0});a.Step=a.Interpolate=void 0;var q=4/29,v=6/29,w=3*v*v,z=v*v*v,x=Math.PI/180,B=180/Math.PI;n=function(){function a(a,b,c,d){this.operator=a;this.input=b;this.stops=c;this.interpolation=d}a.parse=function(b){if(5>b.length)throw Error('"'+b[0]+'" expects at least 4 arguments.');var c=b[1];if(!Array.isArray(c)||0===c.length)throw Error('"'+b[0]+'" expects an interpolation type expression.');
switch(c[0]){case "linear":break;case "exponential":if("number"!==typeof c[1])throw Error('"'+b[0]+'" expects a numeric base for exponential interpolation.');break;case "cubic-bezier":if(5!==c.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.");for(var d=1;5>d;d++){var f=c[d];if("number"!==typeof f||0>f||1<f)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.");}break;default:throw Error('"'+
b[0]+'" unknown interpolation type "'+c[0]+'".');}if(1!==b.length%2)throw Error('"'+b[0]+'" expects an even number of arguments.');for(var f=e.createExpression(b[2]),g=[],d=3;d<b.length;d+=2){var h=b[d];if("number"!==typeof h)throw Error('"'+b[0]+'" requires stop inputs as literal numbers.');if(g.length&&g[g.length-1][0]>=h)throw Error('"'+b[0]+'" requires strictly ascending stop inputs.');g.push([h,e.createExpression(b[d+1])])}return new a(b[0],f,g,c)};a.prototype.evaluate=function(c,d){var e=this.stops;
if(1===e.length)return e[0][1].evaluate(c,d);var f=this.input.evaluate(c,d);if(f<=e[0][0])return e[0][1].evaluate(c,d);if(f>=e[e.length-1][0])return e[e.length-1][1].evaluate(c,d);for(var h=0;++h<e.length&&!(f<e[h][0]););var m=a.interpolationRatio(this.interpolation,f,e[h-1][0],e[h][0]),f=e[h-1][1].evaluate(c,d),l=e[h][1].evaluate(c,d);return"interpolate"===this.operator?Array.isArray(f)?f.map(function(a,b){return k.interpolate(a,l[b],m)}):k.interpolate(f,l,m):"interpolate-hcl"===this.operator?u(r(t(f),
t(l),m)):g(p(b(f),b(l),m))};a.interpolationRatio=function(b,c,d,e){var f=0;"exponential"===b[0]?f=a.exponentialInterpolationRatio(c,b[1],d,e):"linear"===b[0]?f=a.exponentialInterpolationRatio(c,1,d,e):"cubic-bezier"===b[0]&&(f=l.unitBezier(b[1],b[2],b[3],b[4])(a.exponentialInterpolationRatio(c,1,d,e),1E-5));return f};a.exponentialInterpolationRatio=function(a,b,c,d){d-=c;if(0===d)return 0;a-=c;return 1===b?a/d:(Math.pow(b,a)-1)/(Math.pow(b,d)-1)};return a}();a.Interpolate=n;n=function(){function a(a,
b){this.input=a;this.stops=b}a.parse=function(b){if(5>b.length)throw Error('"step" expects at least 4 arguments.');if(1!==b.length%2)throw Error('"step" expects an even number of arguments.');var c=e.createExpression(b[1]),d=[];d.push([-Infinity,e.createExpression(b[2])]);for(var f=3;f<b.length;f+=2){var g=b[f];if("number"!==typeof g)throw Error('"step" requires stop inputs as literal numbers.');if(d.length&&d[d.length-1][0]>=g)throw Error('"step" requires strictly ascending stop inputs.');d.push([g,
e.createExpression(b[f+1])])}return new a(c,d)};a.prototype.evaluate=function(a,b){var c=this.stops;if(1===c.length)return c[0][1].evaluate(a,b);for(var d=this.input.evaluate(a,b),e=0;++e<c.length&&!(d<c[e][0]););return this.stops[e-1][1].evaluate(a,b)};return a}();a.Step=n})},"esri/views/2d/unitBezier":function(){define(["require","exports"],function(n,a){function d(a,d,c,h){function e(a,c){var d,e,h,m;h=a;for(e=0;8>e;e++){m=((g*h+b)*h+f)*h-a;if(Math.abs(m)<c)return h;d=(3*g*h+2*b)*h+f;if(1E-6>Math.abs(d))break;
h-=m/d}d=0;e=1;h=a;if(h<d)return d;if(h>e)return e;for(;d<e;){m=((g*h+b)*h+f)*h;if(Math.abs(m-a)<c)break;a>m?d=h:e=h;h=.5*(e-d)+d}return h}var f=3*a,b=3*(c-a)-f,g=1-f-b,k=3*d,l=3*(h-d)-k,u=1-k-l;return function(a,b){void 0===b&&(b=1E-6);a=e(a,b);return((u*a+l)*a+k)*a}}Object.defineProperty(a,"__esModule",{value:!0});a.parse=a.easingFunctions=a.unitBezier=void 0;a.unitBezier=d;var l=/^cubic-bezier\((.*)\)/;a.easingFunctions={};a.parse=function(k){var e=a.easingFunctions[k]||null;!e&&(k=l.exec(k))&&
(k=k[1].split(",").map(function(a){return parseFloat(a.trim())}),4!==k.length||k.some(function(a){return isNaN(a)})||(e=d.apply(d,k)));return e};a.easingFunctions.ease=d(.25,.1,.25,1);a.easingFunctions.linear=d(0,0,1,1);a.easingFunctions.easeIn=a.easingFunctions["ease-in"]=d(.42,0,1,1);a.easingFunctions.easeOut=a.easingFunctions["ease-out"]=d(0,0,.58,1);a.easingFunctions.easeInOut=a.easingFunctions["ease-in-out"]=d(.42,0,.58,1)})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["require",
"exports"],function(n,a){function d(a,d){a%=d;return 0<=a?a:a+d}Object.defineProperty(a,"__esModule",{value:!0});a.between=a.interpolate=a.sqr=a.log2=a.degToByte=a.radToByte=a.positiveMod=a.C_SQRT2_INV=a.C_SQRT2=a.C_DEG_TO_RAD=a.C_DEG_TO_256=a.C_256_TO_RAD=a.C_RAD_TO_256=a.C_PI_BY_2=a.C_2PI=a.C_PI=a.C_INFINITY=void 0;a.C_INFINITY=Number.POSITIVE_INFINITY;a.C_PI=Math.PI;a.C_2PI=2*a.C_PI;a.C_PI_BY_2=a.C_PI/2;a.C_RAD_TO_256=128/a.C_PI;a.C_256_TO_RAD=a.C_PI/128;a.C_DEG_TO_256=256/360;a.C_DEG_TO_RAD=a.C_PI/
180;a.C_SQRT2=1.414213562;a.C_SQRT2_INV=1/a.C_SQRT2;var l=1/Math.LN2;a.positiveMod=d;a.radToByte=function(k){return d(k*a.C_RAD_TO_256,256)};a.degToByte=function(k){return d(k*a.C_DEG_TO_256,256)};a.log2=function(a){return Math.log(a)*l};a.sqr=function(a){return a*a};a.interpolate=function(a,d,c){return a*(1-c)+d*c};a.between=function(a,d,c){return a>=d&&a<=c||a>=c&&a<=d}})},"esri/views/2d/engine/vectorTiles/expression/lookup":function(){define(["require","exports","./expression"],function(n,a,d){Object.defineProperty(a,
"__esModule",{value:!0});a.HasID=a.Slice=a.Length=a.IndexOf=a.In=a.Has=a.Get=a.At=void 0;n=function(){function a(a,d){this.index=a;this.array=d}a.parse=function(k){if(3!==k.length)throw Error('"at" expects 2 arguments.');var e=d.createExpression(k[1]);k=d.createExpression(k[2]);return new a(e,k)};a.prototype.evaluate=function(a,d){var c=this.index.evaluate(a,d);a=this.array.evaluate(a,d);if(0>c||c>=a.length)throw Error('"at" index out of bounds.');if(c!==Math.floor(c))throw Error('"at" index must be an integer.');
return a[c]};return a}();a.At=n;n=function(){function a(a,d){this.key=a;this.obj=d}a.parse=function(k){var e;switch(k.length){case 2:return e=d.createExpression(k[1]),new a(e);case 3:return e=d.createExpression(k[1]),k=d.createExpression(k[2]),new a(e,k);default:throw Error('"get" expects 1 or 2 arguments');}};a.prototype.evaluate=function(a,d){var c=this.key.evaluate(a,d);return this.obj?this.obj.evaluate(a,d)[c]:a.values[c]};return a}();a.Get=n;n=function(){function a(a,d){this.key=a;this.obj=d}
a.parse=function(k){var e;switch(k.length){case 2:return e=d.createExpression(k[1]),new a(e);case 3:return e=d.createExpression(k[1]),k=d.createExpression(k[2]),new a(e,k);default:throw Error('"has" expects 1 or 2 arguments');}};a.prototype.evaluate=function(a,d){var c=this.key.evaluate(a,d);return this.obj?(a=this.obj.evaluate(a,d),c in a):void 0!==a.values[c]};return a}();a.Has=n;n=function(){function a(a,d){this.key=a;this.vals=d}a.parse=function(k){if(3!==k.length)throw Error('"in" expects 2 arguments');
return new a(d.createExpression(k[1]),d.createExpression(k[2]))};a.prototype.evaluate=function(a,d){var c=this.key.evaluate(a,d);return-1!==this.vals.evaluate(a,d).indexOf(c)};return a}();a.In=n;n=function(){function a(a,d,c){this.item=a;this.array=d;this.from=c}a.parse=function(k){if(3>k.length||4<k.length)throw Error('"index-of" expects 3 or 4 arguments.');var e=d.createExpression(k[1]),c=d.createExpression(k[2]);return 4===k.length?(k=d.createExpression(k[3]),new a(e,c,k)):new a(e,c)};a.prototype.evaluate=
function(a,d){var c=this.item.evaluate(a,d),e=this.array.evaluate(a,d);if(this.from){a=this.from.evaluate(a,d);if(a!==Math.floor(a))throw Error('"index-of" index must be an integer.');return e.indexOf(c,a)}return e.indexOf(c)};return a}();a.IndexOf=n;n=function(){function a(a){this.arg=a}a.parse=function(k){if(2!==k.length)throw Error('"length" expects 2 arguments.');k=d.createExpression(k[1]);return new a(k)};a.prototype.evaluate=function(a,d){a=this.arg.evaluate(a,d);if("string"===typeof a||Array.isArray(a))return a.length;
throw Error('"length" expects string or array.');};return a}();a.Length=n;n=function(){function a(a,d,c){this.array=a;this.from=d;this.to=c}a.parse=function(k){if(3>k.length||4<k.length)throw Error('"slice" expects 2 or 3 arguments.');var e=d.createExpression(k[1]),c=d.createExpression(k[2]);return 4===k.length?(k=d.createExpression(k[3]),new a(e,c,k)):new a(e,c)};a.prototype.evaluate=function(a,d){var c=this.array.evaluate(a,d),e=this.from.evaluate(a,d);if(0>e||e>=c.length)throw Error('"slice" index out of bounds.');
if(e!==Math.floor(e))throw Error('"slice" index must be an integer.');if(this.to){a=this.to.evaluate(a,d);if(0>a||a>=c.length)throw Error('"slice" index out of bounds.');if(a!==Math.floor(a))throw Error('"slice" index must be an integer.');return c.slice(e,a)}return c.slice(e)};return a}();a.Slice=n;n=function(){function a(){}a.parse=function(d){if(1!==d.length)throw Error('"has-id" expects no arguments');return new a};a.prototype.evaluate=function(a,d){return void 0!==a.id};return a}();a.HasID=n})},
"esri/views/2d/engine/vectorTiles/expression/math":function(){define(["require","exports","tslib","./expression"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.Calculate=a.Add=a.Pow=a.Mod=a.Div=a.Mul=a.Sub=void 0;var k=function(){function a(a,d){this.args=a;this.calculate=d}a.parse=function(c,d){c=c.slice(1).map(function(a){return l.createExpression(a)});return new a(c,d)};a.prototype.evaluate=function(a,d){var c;this.args&&(c=this.args.map(function(c){return c.evaluate(a,d)}));
return this.calculate(c)};return a}();n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.parse=function(a){switch(a.length){case 2:return k.parse(a,function(a){return-a[0]});case 3:return k.parse(a,function(a){return a[0]-a[1]});default:throw Error('"-" expects 1 or 2 arguments');}};return c}(k);a.Sub=n;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.parse=function(a){return k.parse(a,function(a){for(var c=1,b=
0;b<a.length;b++)c*=a[b];return c})};return c}(k);a.Mul=n;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.parse=function(a){if(3===a.length)return k.parse(a,function(a){return a[0]/a[1]});throw Error('"/" expects 2 arguments');};return c}(k);a.Div=n;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.parse=function(a){if(3===a.length)return k.parse(a,function(a){return a[0]%a[1]});throw Error('"%" expects 2 arguments');
};return c}(k);a.Mod=n;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.parse=function(a){if(3===a.length)return k.parse(a,function(a){return Math.pow(a[0],a[1])});throw Error('"^" expects 1 or 2 arguments');};return c}(k);a.Pow=n;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.parse=function(a){return k.parse(a,function(a){for(var c=0,b=0;b<a.length;b++)c+=a[b];return c})};return c}(k);a.Add=n;n=function(){function a(a,
d){this.args=a;this.calculate=d}a.parse=function(c){var d=c.slice(1).map(function(a){return l.createExpression(a)});return new a(d,a.ops[c[0]])};a.prototype.evaluate=function(a,d){var c;this.args&&(c=this.args.map(function(c){return c.evaluate(a,d)}));return this.calculate(c)};a.ops={abs:function(a){return Math.abs(a[0])},acos:function(a){return Math.acos(a[0])},asin:function(a){return Math.asin(a[0])},atan:function(a){return Math.atan(a[0])},ceil:function(a){return Math.ceil(a[0])},cos:function(a){return Math.cos(a[0])},
e:function(){return Math.E},floor:function(a){return Math.floor(a[0])},ln:function(a){return Math.log(a[0])},ln2:function(){return Math.LN2},log10:function(a){return Math.log(a[0])/Math.LN10},log2:function(a){return Math.log(a[0])/Math.LN2},max:function(a){return Math.max.apply(Math,a)},min:function(a){return Math.min.apply(Math,a)},pi:function(){return Math.PI},round:function(a){return Math.round(a[0])},sin:function(a){return Math.sin(a[0])},sqrt:function(a){return Math.sqrt(a[0])},tan:function(a){return Math.tan(a[0])}};
return a}();a.Calculate=n})},"esri/views/2d/engine/vectorTiles/expression/string":function(){define(["require","exports","./expression"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.String=a.Concat=void 0;n=function(){function a(a){this.args=a}a.parse=function(k){return new a(k.slice(1).map(function(a){return d.createExpression(a)}))};a.prototype.evaluate=function(a,d){return this.args.map(function(c){return c.evaluate(a,d)}).join("")};return a}();a.Concat=n;n=function(){function a(a,
d){this.arg=a;this.calculate=d}a.parse=function(k){if(2!==k.length)throw Error(k[0]+" expects 1 argument.");var e=d.createExpression(k[1]);return new a(e,a.ops[k[0]])};a.prototype.evaluate=function(a,d){return this.calculate(this.arg.evaluate(a,d))};a.ops={downcase:function(a){return a.toLowerCase()},upcase:function(a){return a.toUpperCase()}};return a}();a.String=n})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["require","exports","../../../../../Color","./expression"],
function(n,a,d,l){function k(a,c){return{kind:"array",itemType:a,n:c}}function e(a){if("array"===a.kind){var b=e(a.itemType);return"number"===typeof a.n?"array\x3c"+b+", "+a.n+"\x3e":"value"===a.itemType.kind?"array":"array\x3c"+b+"\x3e"}return a.kind}function c(b){if(null===b)return a.NullType;if("string"===typeof b)return a.StringType;if("boolean"===typeof b)return a.BooleanType;if("number"===typeof b)return a.NumberType;if(b instanceof d)return a.ColorType;if(Array.isArray(b)){for(var e=void 0,
f=0;f<b.length;f++){var h=c(b[f]);if(e){if(e!==h){e=a.ValueType;break}}else e=h}return k(e||a.ValueType,b.length)}return a.ObjectType}function h(a,c){if("error"===a.kind)return null;if("array"===c.kind){if("array"===a.kind&&(0===a.n&&"value"===a.itemType.kind||!h(a.itemType,c.itemType))&&("number"!==typeof c.n||c.n===a.n))return null}else{if(c.kind===a.kind)return null;if("value"===c.kind)for(var b=0,d=f;b<d.length;b++)if(!h(d[b],a))return null}return"Expected "+e(c)+" but found "+e(a)+" instead."}
function m(a){var b=typeof a;return null===a?"":"string"===b||"number"===b||"boolean"===b?String(a):a instanceof d?a.toString():JSON.stringify(a)}Object.defineProperty(a,"__esModule",{value:!0});a.TypeOf=a.Literal=a.Coerce=a.Assert=a.valueToString=a.typeToString=a.array=a.ErrorType=a.ValueType=a.ObjectType=a.ColorType=a.BooleanType=a.StringType=a.NumberType=a.NullType=void 0;a.NullType={kind:"null"};a.NumberType={kind:"number"};a.StringType={kind:"string"};a.BooleanType={kind:"boolean"};a.ColorType=
{kind:"color"};a.ObjectType={kind:"object"};a.ValueType={kind:"value"};a.ErrorType={kind:"error"};a.array=k;var f=[a.NullType,a.NumberType,a.StringType,a.BooleanType,a.ColorType,a.ObjectType,k(a.ValueType)];a.typeToString=e;a.valueToString=m;n=function(){function b(a,b){this.type=a;this.args=b}b.parse=function(c){var d=c[0];if(2>c.length)throw Error(d+" expects at least one argument.");var e=1,f;if("array"===d){if(2<c.length){switch(c[1]){case "string":f=a.StringType;break;case "number":f=a.NumberType;
break;case "boolean":f=a.BooleanType;break;default:throw Error('"array" type argument must be string, number or boolean');}e++}else f=a.ValueType;d=void 0;if(3<c.length){d=c[2];if(null!==d&&("number"!==typeof d||0>d||d!==Math.floor(d)))throw Error('"array" length argument must be a positive integer literal');e++}f=k(f,d)}else switch(d){case "string":f=a.StringType;break;case "number":f=a.NumberType;break;case "boolean":f=a.BooleanType;break;case "object":f=a.ObjectType}for(d=[];e<c.length;e++){var g=
l.createExpression(c[e]);d.push(g)}return new b(f,d)};b.prototype.evaluate=function(a,b){for(var d=0,e=this.args;d<e.length;d++){var f=e[d].evaluate(a,b);if(!h(c(f),this.type))return f}return null};return b}();a.Assert=n;n=function(){function b(a,b){this.type=a;this.args=b}b.parse=function(a){var c=a[0];if("to-boolean"===c||"to-string"===c){if(2!==a.length)throw Error(c+" expects one argument.");}else if(2>a.length)throw Error(c+" expects at least one argument.");for(var c=b.types[c],d=[],e=1;e<a.length;e++){var f=
l.createExpression(a[e]);d.push(f)}return new b(c,d)};b.prototype.evaluate=function(b,c){if(this.type===a.BooleanType)return!!this.args[0].evaluate(b,c);if(this.type===a.StringType)return m(this.args[0].evaluate(b,c));if(this.type===a.NumberType){for(var e=0,f=this.args;e<f.length;e++){var g=f[e],g=g.evaluate(b,c);if(null===g)return 0;g=Number(g);if(!isNaN(g))return g}return null}if(this.type===a.ColorType){e=0;for(f=this.args;e<f.length;e++){g=f[e];g=g.evaluate(b,c);if(g instanceof d)return g;if("string"===
typeof g)return d.fromString(g);if(Array.isArray(g)&&(3===g.length||4===g.length))return d.fromArray(g)}return null}};b.types={"to-boolean":a.BooleanType,"to-color":a.ColorType,"to-number":a.NumberType,"to-string":a.StringType};return b}();a.Coerce=n;n=function(){function a(a){this.val=a}a.parse=function(b){if(2!==b.length)throw Error('"literal" expects 1 argument');return new a(b[1])};a.prototype.evaluate=function(a,b){return this.val};return a}();a.Literal=n;n=function(){function a(a){this.arg=
a}a.parse=function(b){if(2!==b.length)throw Error('"typeof" expects 1 argument');return new a(l.createExpression(b[1]))};a.prototype.evaluate=function(a,b){return e(c(this.arg.evaluate(a,b)))};return a}();a.TypeOf=n})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.StyleDefinition=void 0;n=function(){function a(){}a.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible",
"none"],default:"visible"}};a.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};a.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};a.symbolLayoutDefinition={visibility:{type:"enum",
values:["visible","none"],default:"visible"},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,
0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"text-field":{type:"string"},"text-font":{type:"array",
value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:"center"},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",
length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:["horizontal"]}};a.circleLayoutDefinition=
{visibility:{type:"enum",values:["visible","none"],default:"visible"}};a.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};a.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},
"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};a.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},
"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1}};a.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",
value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map",
"viewport"],default:"map"}};a.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};a.circlePaintDefinition=
{"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",
values:["map","viewport"],default:"map"}};return a}();a.StyleDefinition=n})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define("require exports ../../../../../Color ../GeometryUtils ../expression/definition ../expression/expression".split(" "),function(n,a,d,l,k,e){return function(){function a(c,d){this.isDataDriven=!1;var f;switch(c.type){case "number":f=!0;break;case "color":f=!0;d=a._parseColor(d);break;case "array":f="number"===c.value;break;default:f=!1}null==d&&(d=c.default);
if(Array.isArray(d)&&0<d.length&&k.ops[d[0]])try{var b=e.createExpression(d);this.getValue=this._buildExpression(b,c);this.isDataDriven=!0}catch(u){console.log(u.message),this.getValue=this._buildSimple(c.default)}else{f&&"interval"===d.type&&(f=!1);if(b=d&&d.stops&&0<d.stops.length)for(var g=0,h=d.stops;g<h.length;g++){var m=h[g];m[1]=this._validate(m[1],c)}if(this.isDataDriven=d?!!d.property:!1)if(void 0!==d.default&&(d.default=this._validate(d.default,c)),b)switch(d.type){case "identity":this.getValue=
this._buildIdentity(d,c);break;case "categorical":this.getValue=this._buildCategorical(d,c);break;default:this.getValue=f?this._buildInterpolate(d,c):this._buildInterval(d,c)}else this.getValue=this._buildIdentity(d,c);else b?this.getValue=f?this._buildZoomInterpolate(d):this._buildZoomInterval(d):(d=this._validate(d,c),this.getValue=this._buildSimple(d))}}a.prototype._validate=function(a,c){if("number"===c.type){if(a<c.minimum)return c.minimum;if(a>c.maximum)return c.maximum}return a};a.prototype._buildSimple=
function(a){return function(){return a}};a.prototype._buildExpression=function(a,c){return function(d,b){try{return a.evaluate(b,d)}catch(g){return console.log(g.message),c.default}}};a.prototype._buildIdentity=function(c,d){var e=this;return function(b,f){var g;f&&(g=f.values[c.property],"color"===d.type&&(g=a._parseColor(g)));void 0===g&&(g=c.default);return void 0!==g?e._validate(g,d):d.default}};a.prototype._buildCategorical=function(a,c){var d=this;return function(b,e){var f;e&&(f=e.values[a.property]);
f=d._categorical(f,a.stops);return void 0!==f?f:void 0!==a.default?a.default:c.default}};a.prototype._buildInterval=function(a,c){var d=this;return function(b,e){var f;e&&(f=e.values[a.property]);return"number"===typeof f?d._interval(f,a.stops):void 0!==a.default?a.default:c.default}};a.prototype._buildInterpolate=function(a,c){var d=this;return function(b,e){var f;e&&(f=e.values[a.property]);return"number"===typeof f?d._interpolate(f,a.stops,a.base||1):void 0!==a.default?a.default:c.default}};a.prototype._buildZoomInterpolate=
function(a){var c=this;return function(d){return c._interpolate(d,a.stops,a.base||1)}};a.prototype._buildZoomInterval=function(a){var c=this;return function(d){return c._interval(d,a.stops)}};a.prototype._categorical=function(a,c){for(var d=c.length,b=0;b<d;b++)if(c[b][0]===a)return c[b][1]};a.prototype._interval=function(a,c){for(var d=c.length,b=0,e=0;e<d;e++)if(c[e][0]<=a)b=e;else break;return c[b][1]};a.prototype._interpolate=function(a,c,d){for(var b,e,f=c.length,h=0;h<f;h++){var m=c[h];if(m[0]<=
a)b=m;else{e=m;break}}if(b&&e){h=e[0]-b[0];a-=b[0];d=1===d?a/h:(Math.pow(d,a)-1)/(Math.pow(d,h)-1);if(Array.isArray(b[1])){b=b[1];e=e[1];a=[];for(h=0;h<b.length;h++)a.push(l.interpolate(b[h],e[h],d));return a}return l.interpolate(b[1],e[1],d)}if(b)return b[1];if(e)return e[1]};a._isEmpty=function(a){for(var c in a)if(a.hasOwnProperty(c))return!1;return!0};a._parseColor=function(c){if(Array.isArray(c))return c;if("string"===typeof c){if(c=new d(c),!this._isEmpty(c))return d.toUnitRGBA(c)}else return c&&
c.default&&(c.default=a._parseColor(c.default)),c&&c.stops&&(c.stops=c.stops.map(function(c){return[c[0],a._parseColor(c[1])]})),c};return a}()})},"esri/views/2d/engine/webgl/definitions":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.SPRITE_PADDING=a.MAX_GPU_UPLOADS_PER_FRAME=a.VTL_HIGH_RES_CUTOFF=a.VTL_TEXTURE_BINDING_UNIT_GLYPHS=a.VTL_TEXTURE_BINDING_UNIT_SPRITES=a.HITTEST_SEARCH_SIZE=a.THIN_LINE_THRESHOLD=a.EFFECT_FLAG_0=a.FILTER_FLAG_0=
a.HIGHLIGHT_FLAG=a.MAX_FILTERS=a.ATTRIBUTE_DATA_DD1=a.ATTRIBUTE_DATA_DD0=a.ATTRIBUTE_DATA_VV=a.ATTRIBUTE_DATA_ANIMATION=a.ATTRIBUTE_DATA_FILTER_FLAGS=a.TEXTURE_BINDING_RENDERER_1=a.TEXTURE_BINDING_RENDERER_0=a.TEXTURE_BINDING_HIGHLIGHT_1=a.TEXTURE_BINDING_HIGHLIGHT_0=a.TEXTURE_BINDING_ATTRIBUTE_DATA_3=a.TEXTURE_BINDING_ATTRIBUTE_DATA_2=a.TEXTURE_BINDING_ATTRIBUTE_DATA_1=a.TEXTURE_BINDING_ATTRIBUTE_DATA_0=a.TEXTURE_BINDING_BITMAP=a.TEXTURE_BINDING_GLYPH_ATLAS=a.TEXTURE_BINDING_SPRITE_ATLAS=a.ATTRIBUTE_STORE_TEXTURE_SIZE=
a.AVERAGE_GLYPH_MOSAIC_ITEM=a.TEXT_PLACEMENT_PADDING=a.GLYPH_SIZE=a.HEURISTIC_GLYPHS_PER_FEATURE=a.HEURISTIC_GLYPHS_PER_LINE=a.COLLISION_PLACEMENT_PADDING=a.COLLISION_TILE_BOX_SIZE=a.COLLISION_BOX_PADDING=a.COLLISION_EARLY_REJECT_BUCKET_SIZE=a.COLLISION_MAX_ZOOM_DELTA=a.MAGIC_LABEL_LINE_HEIGHT=a.DOT_DENSITY_MAX_FIELDS=a.COLLISION_BUCKET_SIZE=a.DEBUG_LABELS=a.ANGLE_FACTOR_256=a.RASTER_TILE_SIZE=a.TILE_SIZE=a.PICTURE_FILL_COLOR=a.EXTRUDE_SCALE=a.NAN_MAGIC_NUMBER=a.WEBGL_MAX_INNER_STOPS=a.WEBGL_MAX_STOPS=
void 0;a.WEBGL_MAX_STOPS=8;a.WEBGL_MAX_INNER_STOPS=a.WEBGL_MAX_STOPS-2;a.NAN_MAGIC_NUMBER=1E-30;a.EXTRUDE_SCALE=64;a.PICTURE_FILL_COLOR=4294967295;a.TILE_SIZE=512;a.RASTER_TILE_SIZE=256;a.ANGLE_FACTOR_256=256/360;a.DEBUG_LABELS=!1;a.COLLISION_BUCKET_SIZE=128;a.DOT_DENSITY_MAX_FIELDS=8;a.MAGIC_LABEL_LINE_HEIGHT=29;a.COLLISION_MAX_ZOOM_DELTA=1;a.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;a.COLLISION_BOX_PADDING=16;a.COLLISION_TILE_BOX_SIZE=a.TILE_SIZE/a.COLLISION_BUCKET_SIZE;a.COLLISION_PLACEMENT_PADDING=
8;a.HEURISTIC_GLYPHS_PER_LINE=50;a.HEURISTIC_GLYPHS_PER_FEATURE=10;a.GLYPH_SIZE=24;a.TEXT_PLACEMENT_PADDING=8;a.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};a.ATTRIBUTE_STORE_TEXTURE_SIZE=1024;a.TEXTURE_BINDING_SPRITE_ATLAS=0;a.TEXTURE_BINDING_GLYPH_ATLAS=0;a.TEXTURE_BINDING_BITMAP=0;a.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1;a.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2;a.TEXTURE_BINDING_ATTRIBUTE_DATA_2=3;a.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4;a.TEXTURE_BINDING_HIGHLIGHT_0=5;
a.TEXTURE_BINDING_HIGHLIGHT_1=6;a.TEXTURE_BINDING_RENDERER_0=5;a.TEXTURE_BINDING_RENDERER_1=6;a.ATTRIBUTE_DATA_FILTER_FLAGS=0;a.ATTRIBUTE_DATA_ANIMATION=1;a.ATTRIBUTE_DATA_VV=2;a.ATTRIBUTE_DATA_DD0=3;a.ATTRIBUTE_DATA_DD1=3;a.MAX_FILTERS=2;a.HIGHLIGHT_FLAG=1;a.FILTER_FLAG_0=2;a.EFFECT_FLAG_0=4;a.THIN_LINE_THRESHOLD=2.5;a.HITTEST_SEARCH_SIZE=24;a.VTL_TEXTURE_BINDING_UNIT_SPRITES=5;a.VTL_TEXTURE_BINDING_UNIT_GLYPHS=6;a.VTL_HIGH_RES_CUTOFF=1.15;a.MAX_GPU_UPLOADS_PER_FRAME=2;a.SPRITE_PADDING=2})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f32 ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),
function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.VectorTile=void 0;n=function(a){function f(b,c,d,e){d=a.call(this,b,d,e,[4096,4096])||this;d._referenced=0;d._hasSymbolBuckets=!1;d._memoryUsedByLayerData=0;d.layerData={};d.layerCount=0;d.status="loading";d.allSymbolsFadingOut=!1;d.lastOpacityUpdate=0;d.symbols=new Map;d.isCoverage=!1;d.neededForCoverage=!1;d.decluttered=!1;d.invalidating=!1;d._referenced=1;d.styleLayers=c;d.id=b.id;d.transforms.tileUnitsToPixels=k.mat3f32.create();
return d}d.__extends(f,a);Object.defineProperty(f.prototype,"hasSymbolBuckets",{get:function(){return this._hasSymbolBuckets},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"isFading",{get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<c.FADE_DURATION},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"isHoldingForFade",{get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<
c.FADE_DURATION)},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"wasRequested",{get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status},enumerable:!1,configurable:!0});f.prototype.setData=function(a){this.changeDataImpl(a);this.requestRender();this.ready();this.invalidating=!1};f.prototype.hasData=function(){return 0<this.layerCount};f.prototype.dispose=function(){f._destroyRenderBuckets(this.layerData);this.layerData={};this._memoryUsedByLayerData=
this.layerCount=0;this.destroy()};f.prototype.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};f.prototype.reference=function(){++this._referenced};Object.defineProperty(f.prototype,"referenced",{get:function(){return this._referenced},enumerable:!1,configurable:!0});f.prototype.getMemoryUsage=function(){return this._memoryUsedByLayerData/(this._referenced||1)};f.prototype.changeDataImpl=function(a){f._destroyRenderBuckets(this.layerData);this.layerData={};
this._memoryUsedByLayerData=this.layerCount=0;if(a){a=f._createRenderBuckets(a);for(var b in a)this.layerData[b]&&(this._memoryUsedByLayerData-=this.layerData[b].memoryUsed,this.layerData[b].destroy(),this.layerData[b]=null,this.layerCount--),this._memoryUsedByLayerData+=a[b].memoryUsed,this.layerData[b]=a[b],this.layerCount++}a=new Map;this._hasSymbolBuckets=!1;for(var c in this.layerData){b=parseInt(c,10);var d=this.layerData[b];3===d.type&&(a.set(b,d.symbols),this._hasSymbolBuckets=!0)}this.symbols=
a;this.emit("symbols-changed")};f.prototype.attachWithContext=function(a){this.stage={context:a,trashDisplayObject:function(a){a.processDetach()},untrashDisplayObject:function(){return!1}}};f.prototype.setTransform=function(b,c){a.prototype.setTransform.call(this,b,c);var d=c/(b.resolution*b.pixelRatio);c=this.size[0]/this.coordRange[0]*d;var d=this.size[1]/this.coordRange[1]*d,e=b.toScreen([0,0],this.coords),f=e[0],e=e[1],g=this.transforms.tileUnitsToPixels;l.mat3.identity(g);l.mat3.translate(g,
g,[f,e]);l.mat3.rotate(g,g,Math.PI*b.rotation/180);l.mat3.scale(g,g,[c,d,1])};f._destroyRenderBuckets=function(a){var b=new Set,c;for(c in a){var d=a[c];b.has(d)||(d.destroy(),b.add(d))}};f._createRenderBuckets=function(a){var b={},c=0;for(a=a.buckets;c<a.length;c++){var d=a[c],f=void 0;switch((new Uint32Array(d))[0]){case 1:f=new e.FillRenderBucket(d);break;case 2:f=new e.LineRenderBucket(d);break;case 3:f=new e.SymbolRenderBucket(d);break;case 4:f=new e.CircleRenderBucket(d)}for(var d=0,h=f.layerIndices;d<
h.length;d++)b[h[d]]=f}return b};return f}(h.TiledDisplayObject);a.VectorTile=n})},"esri/core/libs/gl-matrix-2/mat3f32":function(){define(["require","exports","./factories/mat3f32"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.mat3f32=void 0;a.mat3f32=d})},"esri/core/libs/gl-matrix-2/factories/mat3f32":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.createView=a.fromValues=a.clone=a.create=void 0;a.create=function(){var a=
new Float32Array(9);a[0]=1;a[4]=1;a[8]=1;return a};a.clone=function(a){var d=new Float32Array(9);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];return d};a.fromValues=function(a,l,k,e,c,h,m,f,b){var d=new Float32Array(9);d[0]=a;d[1]=l;d[2]=k;d[3]=e;d[4]=c;d[5]=h;d[6]=m;d[7]=f;d[8]=b;return d};a.createView=function(a,l){return new Float32Array(a,l,9)}})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("require exports tslib ../../../../core/maybe ../../../webgl ./decluttering/config ./decluttering/util".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.CircleRenderBucket=a.SymbolRenderBucket=a.FillRenderBucket=a.LineRenderBucket=a.RenderBucketBase=void 0;n=function(){function a(a){this.layerIndices=[];this.isDestroyed=!1;this.data=a;this.memoryUsed=a.byteLength;var b=1;a=new Uint32Array(a);this.layerIndices=[];for(var c=a[b++],d=0;d<c;d++)this.layerIndices[d]=a[b++];this.bufferDataOffset=b}Object.defineProperty(a.prototype,"isPreparedForRendering",{get:function(){return l.isNone(this.data)},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"offset",{get:function(){return this.bufferDataOffset},enumerable:!1,configurable:!0});a.prototype.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};a.prototype.prepareForRendering=function(a,b){l.isNone(this.data)||(this.doPrepareForRendering(a,b,this.data,this.bufferDataOffset),this.data=null)};return a}();a.RenderBucketBase=n;var h=function(a){function c(b){var c=a.call(this,b)||this;c.type=2;c.lineIndexStart=
0;c.lineIndexCount=0;var d=c.bufferDataOffset;b=new Uint32Array(b);c.lineIndexStart=b[d++];c.lineIndexCount=b[d++];c.isLineDataDriven=!!b[d++];c.bufferDataOffset=d;return c}d.__extends(c,a);c.prototype.hasData=function(){return 0<this.lineIndexCount};c.prototype.triangleCount=function(){return this.lineIndexCount/3};c.prototype.doDestroy=function(){l.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();l.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();l.isSome(this.lineIndexBuffer)&&
this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=null;this.memoryUsed=0};c.prototype.doPrepareForRendering=function(a,d,e,f){e=new Uint32Array(e);var b=new Int32Array(e.buffer),g=e[f++];this.lineVertexBuffer=k.BufferObject.createVertex(a,35044,new Int32Array(b.buffer,4*f,g));f+=g;b=e[f++];this.lineIndexBuffer=k.BufferObject.createIndex(a,35044,new Uint32Array(e.buffer,4*f,b));f+=b;this.lineVertexArrayObject=new k.VertexArrayObject(a,d.getProgramAttributes(3),
this.isLineDataDriven?c.lineVertexAttributesDD:c.lineVertexAttributes,{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};c.lineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]};c.lineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,
normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};return c}(n);a.LineRenderBucket=h;h=function(a){function c(b){var c=a.call(this,b)||this;c.type=1;c.fillIndexStart=0;c.fillIndexCount=0;
c.outlineIndexStart=0;c.outlineIndexCount=0;var d=c.bufferDataOffset;b=new Uint32Array(b);c.fillIndexStart=b[d++];c.fillIndexCount=b[d++];c.outlineIndexStart=b[d++];c.outlineIndexCount=b[d++];c.isFillDataDriven=!!b[d++];c.isOutlineDataDriven=!!b[d++];c.bufferDataOffset=d;return c}d.__extends(c,a);c.prototype.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};c.prototype.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};c.prototype.doDestroy=function(){l.isSome(this.fillVertexArrayObject)&&
this.fillVertexArrayObject.dispose();l.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();l.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;l.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();l.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();l.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=
this.outlineVertexArrayObject=null;this.memoryUsed=0};c.prototype.doPrepareForRendering=function(a,d,e,f){e=new Uint32Array(e);var b=new Int32Array(e.buffer),g=e[f++];this.fillVertexBuffer=k.BufferObject.createVertex(a,35044,new Int32Array(b.buffer,4*f,g));f+=g;g=e[f++];this.fillIndexBuffer=k.BufferObject.createIndex(a,35044,new Uint32Array(e.buffer,4*f,g));f+=g;g=e[f++];this.outlineVertexBuffer=k.BufferObject.createVertex(a,35044,new Int32Array(b.buffer,4*f,g));f+=g;b=e[f++];this.outlineIndexBuffer=
k.BufferObject.createIndex(a,35044,new Uint32Array(e.buffer,4*f,b));f+=b;this.fillVertexArrayObject=new k.VertexArrayObject(a,d.getProgramAttributes(1),this.isFillDataDriven?c.fillVertexAttributesDD:c.fillVertexAttributes,{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new k.VertexArrayObject(a,d.getProgramAttributes(2),this.isOutlineDataDriven?c.outlineVertexAttributesDD:c.outlineVertexAttributes,{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};c.fillVertexAttributes=
{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};c.fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]};c.outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,
offset:6,stride:8,normalized:!1,divisor:0}]};c.outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:12,normalized:!0,divisor:0}]};return c}(n);a.FillRenderBucket=h;h=function(a){function f(b){var d=a.call(this,b)||this;d.type=3;d.iconPerPageElementsMap=
new Map;d.glyphPerPageElementsMap=new Map;d.symbolInstances=[];d.isIconSDF=!1;d.opacityChanged=!1;d.lastOpacityUpdate=0;d.symbols=[];var f=d.bufferDataOffset,h=new Uint32Array(b),m=new Int32Array(b);b=new Float32Array(b);d.isIconSDF=!!h[f++];d.isIconDataDriven=!!h[f++];d.isTextDataDriven=!!h[f++];for(var k=h[f++],l=0;l<k;l++){var v=h[f++],n=h[f++],z=h[f++];d.iconPerPageElementsMap.set(v,[n,z])}k=h[f++];for(l=0;l<k;l++)v=h[f++],n=h[f++],z=h[f++],d.glyphPerPageElementsMap.set(v,[n,z]);v=h[f++];n=h[f++];
d.iconOpacity=new Int32Array(v);d.textOpacity=new Int32Array(n);if(!e.DECLUTTER_TILES){for(l=0;l<v;l++)d.iconOpacity[l]=-1;for(l=0;l<n;l++)d.textOpacity[l]=-1;d.opacityChanged=!0}f=c.deserializeSymbols(h,m,b,f,d.symbols);d.bufferDataOffset=f;return d}d.__extends(f,a);f.prototype.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};f.prototype.triangleCount=function(){var a=0;this.iconPerPageElementsMap.forEach(function(b){a+=b[1]});this.glyphPerPageElementsMap.forEach(function(b){a+=
b[1]});return a/3};f.prototype.doDestroy=function(){l.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();l.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();l.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();l.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;l.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();l.isSome(this.textVertexBuffer)&&
this.textVertexBuffer.dispose();l.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();l.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};f.prototype.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var a=l.unwrap(this.iconOpacity),c=l.unwrap(this.iconOpacityBuffer);0<a.length&&a.byteLength===c.size&&c.setSubData(a);a=l.unwrap(this.textOpacity);
c=l.unwrap(this.textOpacityBuffer);0<a.length&&a.byteLength===c.size&&c.setSubData(a)}};f.prototype.doPrepareForRendering=function(a,c,d,e){d=new Uint32Array(d);var b=new Int32Array(d.buffer),g=d[e++];this.iconVertexBuffer=k.BufferObject.createVertex(a,35044,new Int32Array(b.buffer,4*e,g));e+=g;g=d[e++];this.iconIndexBuffer=k.BufferObject.createIndex(a,35044,new Uint32Array(d.buffer,4*e,g));e+=g;g=d[e++];this.textVertexBuffer=k.BufferObject.createVertex(a,35044,new Int32Array(b.buffer,4*e,g));e+=
g;b=d[e++];this.textIndexBuffer=k.BufferObject.createIndex(a,35044,new Uint32Array(d.buffer,4*e,b));e+=b;this.iconOpacityBuffer=k.BufferObject.createVertex(a,35044,l.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=k.BufferObject.createVertex(a,35044,l.unwrap(this.textOpacity).buffer);this.iconVertexArrayObject=new k.VertexArrayObject(a,c.getProgramAttributes(4),this.isIconDataDriven?f.vertexAttributesDD:f.vertexAttributes,{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);
this.textVertexArrayObject=new k.VertexArrayObject(a,c.getProgramAttributes(6),this.isTextDataDriven?f.vertexAttributesDD:f.vertexAttributes,{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};f.vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},
{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],opacity:[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}]};f.vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,
stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}],opacity:[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}]};return f}(n);a.SymbolRenderBucket=h;n=function(a){function c(b){var c=a.call(this,b)||this;c.type=4;c.circleIndexStart=0;c.circleIndexCount=0;var d=c.bufferDataOffset;b=new Uint32Array(b);c.circleIndexStart=b[d++];
c.circleIndexCount=b[d++];c.bufferDataOffset=d;return c}d.__extends(c,a);c.prototype.hasData=function(){return 0<this.circleIndexCount};c.prototype.triangleCount=function(){return this.circleIndexCount/3};c.prototype.doDestroy=function(){l.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();l.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();l.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=
null;this.memoryUsed=0};c.prototype.doPrepareForRendering=function(a,d,e,f){e=new Uint32Array(e);var b=new Int32Array(e.buffer),g=e[f++];this.circleVertexBuffer=k.BufferObject.createVertex(a,35044,new Int32Array(b.buffer,4*f,g));f+=g;b=e[f++];this.circleIndexBuffer=k.BufferObject.createIndex(a,35044,new Uint32Array(e.buffer,4*f,b));f+=b;this.circleVertexArrayObject=new k.VertexArrayObject(a,d.getProgramAttributes(5),c.circleVertexAttributes,{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};
c.circleVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,normalized:!0,divisor:0},{name:"a_data",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};return c}(n);a.CircleRenderBucket=n})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,
"__esModule",{value:!0});a.FADE_DURATION=a.DECLUTTER_BUDGET=a.COLLISION_GRID_CELL_SIZE=a.DECLUTTER_TILES=void 0;a.DECLUTTER_TILES=!0;a.COLLISION_GRID_CELL_SIZE=32;a.DECLUTTER_BUDGET=1.5;a.FADE_DURATION=200})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["require","exports","../../../../../core/maybe","./core"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.writeOpacityToBuffers=a.deserializeSymbols=a.GridIndex=a.tileCoordChange=a.TileForest=a.TileGraph=
a.TileNode=void 0;var k=function(){return function(a){this.tile=a;this.parent=null;this.children=new Set}}();a.TileNode=k;var e=function(){function a(){this.nodes=new Map;this.roots=new Set}a.prototype.create=function(a){var c=this,d=new k(a),b,e=[];this.nodes.forEach(function(a){c._canConnectDirectly(d,a)&&e.push(a);!b&&c._canConnectDirectly(a,d)&&(b=a)});if(b){for(var h=0;h<e.length;h++){var l=e[h];b.children.delete(l);d.children.add(l);l.parent=d}b.children.add(d);d.parent=b}else for(this.roots.add(d),
h=0;h<e.length;h++)l=e[h],d.children.add(l),l.parent=d,this.roots.delete(l);this.nodes.set(a.key.id,d);return d};a.prototype.destroy=function(a){var c=this;d.isSome(a.parent)?(a.parent.children.delete(a),a.children.forEach(function(c){d.isSome(a.parent)&&a.parent.children.add(c)})):this.roots.delete(a);a.children.forEach(function(d){(d.parent=a.parent)||c.roots.add(d)});this.nodes.delete(a.tile.key.id)};a.prototype.clear=function(){this.roots.clear();this.nodes.clear()};a.prototype._canConnectDirectly=
function(a,c){var d=c.tile.key,b=d.level,e=d.row,d=d.col;for(c=c.tile.key.world;0<b;){b--;e>>=1;d>>=1;if(a.tile.key.level===b&&a.tile.key.row===e&&a.tile.key.col===d&&a.tile.key.world===c)return!0;if(this.nodes.has(b+"/"+e+"/"+d+"/"+c))break}return!1};return a}();a.TileGraph=e;n=function(){function a(){this._tileGraph=new e;this._tileArray=null}a.prototype.has=function(a){return this.hasKey(a.key.id)};a.prototype.getAll=function(){var a=this;this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(function(c){a._tileArray.push(c.tile)}));
return this._tileArray};a.prototype.getRoots=function(){var a=[];this._tileGraph.roots.forEach(function(c){a.push(c.tile)});return a};a.prototype.getParent=function(a){a=this._tileGraph.nodes.get(a.key.id);return d.isSome(a.parent)&&a.parent.tile};a.prototype.getChildren=function(a){var c=[];this._tileGraph.nodes.get(a.key.id).children.forEach(function(a){c.push(a.tile)});return c};a.prototype.get=function(a){return this._tileGraph.nodes.get(a).tile};a.prototype.hasKey=function(a){return this._tileGraph.nodes.has(a)};
a.prototype.removeKey=function(a){a=this._tileGraph.nodes.get(a);this._tileGraph.destroy(a);this._tileArray=null};a.prototype.forEach=function(a){this._tileGraph.nodes.forEach(function(c,d){return a(c.tile,d)})};a.prototype.add=function(a){this._tileGraph.create(a);this._tileArray=null};a.prototype.remove=function(a){a=this._tileGraph.nodes.get(a.key.id);this._tileGraph.destroy(a);this._tileArray=null};a.prototype.clear=function(){this._tileGraph.clear();this._tileArray=[]};return a}();a.TileForest=
n;a.tileCoordChange=function(a,d,e,f,b,g){e-=b;if(0<=e)return(d>>e)+(f-(g<<e))*(a>>e);e=-e;return d-(g-(f<<e))*(a>>e)<<e};n=function(){function a(a,c,d){this._rows=Math.ceil(c/d);this._columns=Math.ceil(a/d);this._cellSize=d;this.cells=Array(this._rows);for(a=0;a<this._rows;a++)for(this.cells[a]=Array(this._columns),c=0;c<this._columns;c++)this.cells[a][c]=[]}a.prototype.getCell=function(a,c){c=Math.min(Math.max(Math.floor(c/this._cellSize),0),this._rows-1);a=Math.min(Math.max(Math.floor(a/this._cellSize),
0),this._columns-1);return this.cells[c]&&this.cells[c][a]||null};a.prototype.getCellSpan=function(a,c,d,b){return[Math.min(Math.max(Math.floor(a/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(c/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(d/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(b/this._cellSize),0),this.rows-1)]};Object.defineProperty(a.prototype,"cellSize",{get:function(){return this._cellSize},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"columns",{get:function(){return this._columns},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"rows",{get:function(){return this._rows},enumerable:!1,configurable:!0});return a}();a.GridIndex=n;a.deserializeSymbols=function(a,d,e,f,b){for(var c=d[f++],h=0;h<c;h++){var k=new l.VTLSymbol;k.xTile=d[f++];k.yTile=d[f++];k.hash=d[f++];k.priority=d[f++];for(var m=d[f++],r=0;r<m;r++){var q=d[f++],v=d[f++],n=d[f++],z=d[f++],x=!!d[f++],B=d[f++],A=e[f++],C=e[f++],E=d[f++],G=d[f++];k.colliders.push({xTile:q,
yTile:v,dxPixels:n,dyPixels:z,hard:x,partIndex:B,width:E,height:G,minLod:A,maxLod:C})}m=a[f++];for(r=0;r<m;r++)k.textVertexRanges.push([a[f++],a[f++]]);m=a[f++];for(r=0;r<m;r++)k.iconVertexRanges.push([a[f++],a[f++]]);b.push(k)}return f};a.writeOpacityToBuffers=function(a,d,e){a.symbols.forEach(function(c,b){b=a.layerData[b];if(3===b.type){for(var f=0;f<c.length;f++){var h=c[f],k=h.unique,m=void 0;if(h.selectedForRendering){var l=k.parts[0],m=l.startOpacity,l=l.targetOpacity;a.allSymbolsFadingOut=
a.allSymbolsFadingOut&&0===l;m=e?Math.floor(127*m)|l<<7:l?255:0;m|=m<<24|m<<16|m<<8}else m=0;for(var q=0,v=h.iconVertexRanges;q<v.length;q++)for(var l=v[q],n=l[0],z=l[1],l=n;l<n+z;l+=4)b.iconOpacity[l/4]=m;h.selectedForRendering?(k=k.parts[1],m=k.startOpacity,l=k.targetOpacity,a.allSymbolsFadingOut=a.allSymbolsFadingOut&&0===l,m=e?Math.floor(127*m)|l<<7:l?255:0,m|=m<<24|m<<16|m<<8):m=0;k=0;for(h=h.textVertexRanges;k<h.length;k++)for(l=h[k],q=l[0],v=l[1],l=q;l<q+v;l+=4)b.textOpacity[l/4]=m}b.lastOpacityUpdate=
d;b.opacityChanged=!0}})}})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.VTLUniqueSymbol=a.VTLSymbol=void 0;n=function(){return function(){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[]}}();a.VTLSymbol=n;n=function(){return function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},
{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1;this.visible=!0}}();a.VTLUniqueSymbol=n})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define("require exports tslib ../../../../core/has ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f32 ../DisplayObject ../../tiling/TileKey".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.TiledDisplayObject=void 0;n=function(a){function c(b,c,d,f){void 0===f&&(f=
d);var g=a.call(this)||this;g.triangleCountReportedInDebug=0;g.transforms={dvs:e.mat3f32.create(),tileMat3:e.mat3f32.create()};g.triangleCount=0;g.key=new h(b);g.bounds=c;g.size=d;g.coordRange=f;return g}d.__extends(c,a);c.prototype.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};Object.defineProperty(c.prototype,"coords",{get:function(){return this._coords},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"bounds",{get:function(){return this._bounds},
set:function(a){this._coords=[a[0],a[3]];this._bounds=a},enumerable:!1,configurable:!0});c.prototype.setTransform=function(a,c){c/=a.resolution*a.pixelRatio;var b=this.transforms.tileMat3,d=a.toScreenNoRotation([0,0],this.coords);k.mat3.set(b,this.size[0]/this.coordRange[0]*c,0,0,0,this.size[1]/this.coordRange[1]*c,0,d[0],d[1],1);k.mat3.multiply(this.transforms.dvs,a.displayViewMat3,b)};return c}(c.DisplayObject);a.TiledDisplayObject=n})},"esri/views/2d/engine/DisplayObject":function(){define(["require",
"exports","tslib","../../../core/Evented","../../../core/has"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.DisplayObject=void 0;var e=1/k("mapview-transitions-duration");n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c._clips=null;c.computedVisible=!0;c.computedOpacity=1;c.fadeTransitionEnabled=!1;c.inFadeTransition=!1;c._isReady=!1;c._opacity=1;c._stage=null;c._visible=!0;return c}d.__extends(c,a);Object.defineProperty(c.prototype,"clips",{get:function(){return this._clips},
set:function(a){this._clips=a;this.requestRender()},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"isReady",{get:function(){return this._isReady},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==a&&(this._opacity=Math.min(1,Math.max(a,0)),this.requestRender())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"stage",{get:function(){return this._stage},set:function(a){if(this._stage!==
a){var c=this._stage;(this._stage=a)?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):c.trashDisplayObject(this)}},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible!==a&&(this._visible=a,this.requestRender())},enumerable:!1,configurable:!0});c.prototype.setTransform=function(a){};c.prototype.processRender=function(a){this.stage&&(this.updateTransitionProperties(a.deltaTime),this.computedVisible&&
this.doRender(a))};c.prototype.requestRender=function(){this.stage&&this.stage.requestRender()};c.prototype.processDetach=function(){this.onDetach();this.emit("detach")};c.prototype.updateTransitionProperties=function(a){if(this.fadeTransitionEnabled){var c=this.visible?this.opacity:0,b=this.computedOpacity;b===c?this.computedVisible=this.visible:(a*=e,this.computedOpacity=b>c?Math.max(c,b-a):Math.min(c,b+a),this.computedVisible=0<this.computedOpacity,c=c===this.computedOpacity,this.inFadeTransition=
!c,c||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=this.visible};c.prototype.onAttach=function(){};c.prototype.onDetach=function(){};c.prototype.doRender=function(a){};c.prototype.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};return c}(l);a.DisplayObject=n})},"esri/views/3d/terrain/RasterTile":function(){define(["require","exports","../../../core/maybe","../../webgl/rasterUtils"],function(n,a,d,l){Object.defineProperty(a,
"__esModule",{value:!0});var k={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};n=function(){function a(a,d,e,f){void 0===e&&(e=null);void 0===f&&(f=null);this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=this._transformGrid=null;this.scale=
1;this.offset=[0,0];this.opacity=1;this.lij=a;this.source=d;this.width=e||d.width;this.height=f||d.height}Object.defineProperty(a.prototype,"source",{get:function(){return this._source},set:function(a){this._source=a;this._rasterTexture&&(this._rasterTexture.dispose(),this._memoryUsed=this._rasterTexture=null)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"symbolizerParameters",{get:function(){return this._symbolizerParameters||k},set:function(a){this._symbolizerParameters=a},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"bandIds",{get:function(){return this._bandIds},set:function(a){var c=this;d.isSome(a)&&0<a.length?this._bandIds&&a.every(function(a,d){return c._bandIds[d]?a===c._bandIds[d]:!1})||(this._bandIds=a,this._dirty=!0):this._bandIds=null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"interpolation",{get:function(){return this._interpolation},set:function(a){this._interpolation=a;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===
a?9729:9728)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"transformGrid",{get:function(){return this._transformGrid},set:function(a){this._transformGrid=a;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=null)},enumerable:!1,configurable:!0});a.prototype.bind=function(a){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;this._rasterTexture&&!this._dirty||this._updateRasterTexture(a,this.bandIds);
this._rasterTexture&&(this._updateColormapTexture(a),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=l.createTransformTexture(a,this.transformGrid)));return!0};a.prototype.getUniforms=function(){var a=l.getBasicGridUniforms(this.scale,this.offset),d=this.symbolizerParameters,e=l.getCommonUniforms(this.transformGrid,[this.width,this.height],[this.source.width,this.source.height],this.opacity),d=d.colormap?l.getColormapUniforms(d.colormap,d.colormapOffset):null,f="stretch"===
this.symbolizerParameters.type?l.getStretchUniforms(this.symbolizerParameters):null,b="hillshade"===this.symbolizerParameters.type?l.getShadedReliefUniforms(this.symbolizerParameters):null;return{basic:a,common:e,colormap:d,stretch:f,hillshade:b}};a.prototype.getTextures=function(){if(!this._rasterTexture)return null;var a=[],d=[];this._transformGridTexture&&(d.push(this._transformGridTexture),a.push("u_transformGrid"));this._rasterTexture&&(d.push(this._rasterTexture),a.push("u_image"));this._colormapTexture&&
(d.push(this._colormapTexture),a.push("u_colormap"));return{names:a,textures:d}};a.prototype.getMemoryUsage=function(){if(d.isNone(this._memoryUsed)){var a=this.getTextures();if(null==a)return 0;this._memoryUsed=a.textures.map(function(a){return a.descriptor.width*a.descriptor.height*4}).reduce(function(a,c){return a+c})}return this._memoryUsed};a.prototype.release=function(){this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null);this._transformGridTexture&&(this._transformGridTexture.dispose(),
this._transformGridTexture=null);this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null);this.rawPixelData=this.transformGrid=this.source=null;return!0};a.prototype._updateRasterTexture=function(a,e){var c=this.source?this.source.extractBands(e):null;if(c&&c.pixels&&0<c.pixels.length){e=d.isNone(e)&&d.isNone(this.bandIds)||d.isSome(e)&&d.isSome(this.bandIds)&&e.join("")===this.bandIds.join("");if(this._rasterTexture){if(e)return;this._rasterTexture.dispose();this._rasterTexture=
null}this._rasterTexture=l.createRasterTexture(a,c,this.interpolation||"nearest")}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)};a.prototype._updateColormapTexture=function(a){var c=this._colormap,d=this.symbolizerParameters.colormap;if(!d)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!c)this._colormapTexture=l.createColormapTexture(a,d),this._colormap=d;else if(d.length!==c.length||d.some(function(a,
b){return a!==c[b]}))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=l.createColormapTexture(a,d),this._colormap=d};return a}();a.default=n})},"esri/views/webgl/rasterUtils":function(){define(["require","exports","../webgl"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.setTextures=a.setUniforms=a.getUniformLocationInfos=a.getShadedReliefUniforms=a.getStretchUniforms=a.getBasicGridUniforms=a.getColormapUniforms=a.getCommonUniforms=
a.createColormapTexture=a.createTransformTexture=a.createFrameBuffer=a.createRasterTexture=void 0;a.createRasterTexture=function(a,k,e,c){void 0===e&&(e="nearest");void 0===c&&(c=!1);var h=!(c&&"u8"===k.pixelType);c=h?5126:5121;h=null==k.pixels||0===k.pixels.length?null:h?k.getAsRGBAFloat():k.getAsRGBA();return new d.Texture(a,{width:k.width,height:k.height,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:"bilinear"===e||"cubic"===e?9729:9728,dataType:c,wrapMode:33071,flipped:!1},h)};
a.createFrameBuffer=function(a,k,e,c){c=new d.Texture(a,{width:k,height:e,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:9728,dataType:c?5121:5126,wrapMode:33071,flipped:!1});return new d.FramebufferObject(a,{colorTarget:0,depthStencilTarget:3,width:k,height:e},c)};a.createTransformTexture=function(a,k){for(var e=4*k.size[0],c=k.size[1],h={width:e,height:c,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5126,samplingMode:9728,wrapMode:33071,flipped:!1},e=new Float32Array(e*
c*4),m=c=0;m<k.coefficients.length;m++)e[c++]=k.coefficients[m],2===m%3&&(e[c++]=1);return new d.Texture(a,h,e)};a.createColormapTexture=function(a,k){return new d.Texture(a,{width:k.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1},k)};a.getCommonUniforms=function(a,d,e,c,h,m){void 0===c&&(c=1);void 0===h&&(h=!0);void 0===m&&(m=!1);return{u_flipY:h,u_isFloatTexture:m,u_applyTransform:a?!0:!1,u_opacity:c,u_transformSpacing:a?
a.spacing:null,u_transformGridSize:a?a.size:null,u_targetImageSize:d,u_srcImageSize:e}};a.getColormapUniforms=function(a,d){return{u_colormapOffset:d||0,u_colormapMaxIndex:a?a.length/4-1:null}};a.getBasicGridUniforms=function(a,d){return{u_scale:a,u_offset:d}};a.getStretchUniforms=function(a){return{u_bandCount:a.bandCount,u_minOutput:a.outMin,u_maxOutput:a.outMax,u_minCutOff:a.minCutOff,u_maxCutOff:a.maxCutOff,u_factor:a.factor,u_useGamma:a.useGamma,u_gamma:a.gamma,u_gammaCorrection:a.gammaCorrection}};
a.getShadedReliefUniforms=function(a){return{u_hillshadeType:a.hillshadeType,u_sinZcosAs:a.sinZcosAs,u_sinZsinAs:a.sinZsinAs,u_cosZs:a.cosZs,u_weights:a.weights,u_factor:a.factor,u_minValue:a.minValue,u_maxValue:a.maxValue}};a.getUniformLocationInfos=function(a,d){a=a.gl;d=d.glName;for(var e=a.getProgramParameter(d,a.ACTIVE_UNIFORMS),c=new Map,h,k=0;k<e;k++)(h=a.getActiveUniform(d,k))&&c.set(h.name,{location:a.getUniformLocation(d,h.name),info:h});return c};a.setUniforms=function(a,d,e){Object.keys(e).forEach(function(c){var h=
d.get(c)||d.get(c+"[0]");if(h){var k=e[c];if(null!==h&&null!=k)switch(h=h.info,h.type){case 5126:1<h.size?a.setUniform1fv(c,k):a.setUniform1f(c,k);break;case 35664:a.setUniform2fv(c,k);break;case 35665:a.setUniform3fv(c,k);break;case 35666:a.setUniform4fv(c,k);break;case 35675:a.setUniformMatrix3fv(c,k);break;case 35676:a.setUniformMatrix4fv(c,k);break;case 5124:1<h.size?a.setUniform1iv(c,k):a.setUniform1i(c,k);break;case 35670:a.setUniform1i(c,k?1:0);break;case 35667:case 35671:a.setUniform2iv(c,
k);break;case 35668:case 35672:a.setUniform3iv(c,k);break;case 35669:case 35673:a.setUniform4iv(c,k)}}})};a.setTextures=function(a,d,e,c){e.length===c.length&&(c.some(function(a){return null==a})||e.some(function(a){return null==a})||e.forEach(function(e,k){d.setUniform1i(e,k);a.bindTexture(c[k],k)}))}})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ./TerrainConst ./TilingScheme".split(" "),
function(n,a,d,l,k,e,c,h){function m(a,c,d,e){l.vec3.copy(f,d);f[e]=c[e];e=l.vec3.subtract(f,f,c);var g=l.vec3.subtract(b,a,c),g=l.vec3.dot(g,e),h=l.vec3.dot(e,e);c=0>=g?c:h<=g?d:l.vec3.add(f,c,l.vec3.scale(e,e,g/h));a=l.vec3.subtract(f,a,c);return Math.PI/2-Math.atan(a[2]/Math.sqrt(a[0]*a[0]+a[1]*a[1]))}Object.defineProperty(a,"__esModule",{value:!0});a.checkIfTileInfoSupportedForViewSR=a.tiltToExtentEdge=a.tiltOnEdge=a.isInsideExtent=void 0;var f=k.vec3f64.create(),b=k.vec3f64.create(),g=k.vec3f64.create(),
p=k.vec3f64.create();a.isInsideExtent=function(a,b,c){void 0===c&&(c=0);a=a.extent;return 0===c?e.containsPoint(a,b):e.containsPointWithMargin(a,b,c*Math.min(a[2]-a[0],a[3]-a[1]))};a.tiltOnEdge=m;a.tiltToExtentEdge=function(a,b){var c=a.elevationBounds;a=a.extent;c=.5*(c.min+c.max);g[0]=a[0];g[1]=a[1];g[2]=c;p[0]=a[2];p[1]=a[3];p[2]=c;a=c=Infinity;b[0]<g[0]?c=m(b,g,p,0):b[0]>p[0]&&(c=m(b,p,g,0));b[1]<g[1]?a=m(b,g,p,1):b[1]>p[1]&&(a=m(b,p,g,1));return Math.min(c,a)};a.checkIfTileInfoSupportedForViewSR=
function(a,b,f){if(a.spatialReference.isGeographic)return new d("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var g=h.checkUnsupported(a);if(g)return g;var k=a.lods,g=k[0].resolution*Math.pow(2,k[0].level),m=[g*a.size[0],g*a.size[1]],l=[a.origin.x,a.origin.y];f=e.fromExtent(f);var p=e.create();h.computeRowColExtent(f,m,l,p);m=(p[2]-p[0])*(p[3]-p[1]);m>c.MAX_ROOT_TILES?(k=k[0].scale*Math.pow(2,k[0].level),g=Math.max((f[3]-f[1])/a.size[1],
(f[2]-f[0])/a.size[0])*k/g,f=Math.floor(Math.log(g)/Math.log(10)),g=Math.ceil(g/Math.pow(10,f))*Math.pow(10,f),g=new d("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(k).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+g.toLocaleString()+".",{level0Scale:k,suggestedLevel0Scale:g,requiredNumRootTiles:m,allowedNumRootTiles:c.MAX_ROOT_TILES})):g=null;return g?g:b&&!a.spatialReference.equals(b)?new d("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require","exports","../../../core/Error","../support/projectionUtils","./TilingScheme"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.checkIfTileInfoSupportedForViewSR=a.tiltToExtentEdge=a.isInsideExtent=void 0;a.isInsideExtent=function(){return!0};a.tiltToExtentEdge=function(){return 0};a.checkIfTileInfoSupportedForViewSR=
function(a,c){var e=a.lods.length-1;if(a.spatialReference.isWebMercator){if(!k.makeWebMercatorAuxiliarySphere(e).compatibleWith(a))return new d("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(l.canProjectToWGS84ComparableLonLat(a.spatialReference)){if(!k.makeGCSWithTileSize(a.spatialReference,a.size[0],e).compatibleWith(a))return a.spatialReference.isWGS84?new d("tilingscheme:incompatible-global-wgs84",
"The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new d("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new d("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(c&&!a.spatialReference.equals(c))return new d("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}})},
"esri/views/3d/terrain/TileTexture":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.TileTexture=void 0;n=function(){function a(a){this._texture=a;this._refCount=1}a.prototype.retain=function(){++this._refCount};a.prototype.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};Object.defineProperty(a.prototype,"texture",{get:function(){return this._texture},enumerable:!1,configurable:!0});a.prototype.generateMipmap=
function(){this._texture.generateMipmap()};Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._texture.descriptor},enumerable:!1,configurable:!0});return a}();a.TileTexture=n})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.SharedSymbolResources=
void 0;n=function(){function a(a){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=this.screenSizePerspectiveHandles=null;this.viewState=a.viewState;this.stage=a.stage;this.pointsOfInterest=a.pointsOfInterest;this.objectResourceCache=a.objectResourceCache;this.streamDataRequester=a.resourceController.createStreamDataRequester(3);this.textures=new k.default(this.streamDataRequester,a.stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}},a.resourceController.scheduler);
this.screenSizePerspectiveSettings=e.getSettings(a.viewingMode);this.screenSizePerspectiveSettingsLabels=e.getLabelSettings(a.viewingMode)}a.prototype.destroy=function(){this.textures.destroy();this.streamDataRequester=this.textures=null};a.prototype.addGraphicsOwner=function(a){var c=this;if(!a)return{remove:function(){}};this.graphicsOwners.push(a);var b="layer"in a?a.watch("layer.screenSizePerspectiveEnabled",function(){return c.updateScreenSizePerspectiveEnabled()}):null;this.updateScreenSizePerspectiveEnabled();
return{remove:function(){b&&(b.remove(),d.removeUnordered(c.graphicsOwners,a),c.updateScreenSizePerspectiveEnabled())}}};a.prototype.updateScreenSizePerspectiveEnabled=function(){var a=this,c=this.graphicsOwners.some(function(a){return!0===a.get("layer.screenSizePerspectiveEnabled")});c&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new l,c=function(){return a.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",
c,!0),this.viewState.events.on("camera-projection-changed",c)]),this.updateScreenSizePerspectiveSettings()):!c&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};a.prototype.updateScreenSizePerspectiveSettings=function(){c.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;c.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(c);this.screenSizePerspectiveSettingsLabels.update(c);this.stage.renderView.setNeedsRender()};
return a}();a.SharedSymbolResources=n;var c={distance:0,fovY:0};a.default=n})},"esri/views/3d/support/TextureCollection":function(){define("require exports tslib ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ../webgl-engine/lib/Texture ../../support/Scheduler".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.TextureCollection=void 0;n=function(){function a(a,b,c,d){this._streamDataRequester=a;this._stage=b;this._textureOptions=c;this._textureRequests=
new Map;this._frameTask=l.isSome(d)?d.registerTask(h.Task.TEXTURE_UNLOAD,function(){},function(){return!1}):new h.TestTaskHandle}a.prototype.destroy=function(){var a=this;this._frameTask.remove();this._textureRequests.forEach(function(b){return a.releaseTextureRequest(b)});this._textureRequests.clear()};a.prototype.fromUrl=function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var e,f,g,h,m,v=this;return d.__generator(this,function(d){k.throwIfAborted(c);e=l.isSome(c)&&c.signal;f=this.makeUid(a,
b);g=this._textureRequests.get(f);g||(h=k.createAbortController(),m=this._streamDataRequester.request(a,"image",{uid:f,signal:h.signal}),g={referenceCount:0,texture:null,textureAsync:null,abortController:h},this._textureRequests.set(f,g),g.textureAsync=m.then(function(c){c=v.createTexture(a,c,b);g.texture=c;g.abortController=null;v.addToStage(c);return{uid:f,texture:c}},function(a){g.abortController=null;throw a;}));g.referenceCount++;return[2,k.create(function(a,b){k.onAbort(e,function(){b(k.createAbortError())});
g.textureAsync.then(a,b)}).catch(function(a){v.release(f);throw a;})]})})};a.prototype.fromData=function(a,b){a=this.makeUid(a);var c=this._textureRequests.get(a);c||(c={referenceCount:0,texture:b(),textureAsync:null,abortController:null},this.addToStage(c.texture),this._textureRequests.set(a,c));c.referenceCount++;return{uid:a,texture:c.texture}};a.prototype.release=function(a){var b=this;if(this._textureRequests){var c=this._textureRequests.get(a);c?(1>c.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+
a),c.referenceCount--,1>c.referenceCount&&this._frameTask.schedule(function(){return b.releaseNow(a)})):console.warn("TextureCollection: texture doesn't exist: '"+a+"'")}};Object.defineProperty(a.prototype,"test",{get:function(){return{textureRequests:this._textureRequests}},enumerable:!1,configurable:!0});a.prototype.releaseNow=function(a){if(this._textureRequests){var b=this._textureRequests.get(a);!b||0<b.referenceCount||(this.releaseTextureRequest(b),this._textureRequests.delete(a))}};a.prototype.releaseTextureRequest=
function(a){a.texture?this.removeFromStage(a.texture):a.abortController&&(a.abortController.abort(),a.abortController=null)};a.prototype.createTexture=function(a,b,g){e.isSVG(a)&&(g||0===b.width&&0===b.height)&&(a=b.width?b.height/b.width:1,g=g||64,1<a?(b.width=Math.round(g/a),b.height=g):(b.width=g,b.height=Math.round(g*a)));g=d.__assign(d.__assign({},this._textureOptions),{width:b.width,height:b.height,powerOfTwoResizeMode:2});return new c(b,"symbol",g)};a.prototype.addToStage=function(a){this._stage.add(4,
a)};a.prototype.removeFromStage=function(a){this._stage.remove(4,a.id)};a.prototype.makeUid=function(a,b){return null!=b?a+"."+b+"px":a};return a}();a.TextureCollection=n;a.default=n})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Handles ../../../../core/SetUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils ../../../support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x){Object.defineProperty(a,"__esModule",{value:!0});a.PointsOfInterest=void 0;n=function(a){function b(b){b=a.call(this,b)||this;b.handles=new k;b.surfaceAltitudeAtCenter=0;b.surfaceAltitudeAtCenterDirty=!0;b.surfaceAltitudeAtCenterWithContent=0;b.surfaceAltitudeAtCenterWithContentDirty=!0;b.propertiesPool=new f.PropertiesPool({renderPointOfView:B},b);b.renderPointOfView=m.vec3f64.create();return b}d.__extends(b,a);b.prototype.initialize=function(){var a=
this,b=this.view,c=b.state,f=b.basemapTerrain,h=b.renderCoordsHelper,b=b.map;this.surfaceIntersector=new w.Intersector(c.mode);this.surfaceIntersector.options.backfacesTerrain=c.isGlobal?!1:!0;this.surfaceIntersector.options.invisibleTerrain=!1;this.contentIntersector=new w.Intersector(c.mode);this.contentIntersectorOptions={exclude:e.SetFromValues([z.TERRAIN_ID])};var k=function(){return a.estimateSurfaceAltitudeAtCenter()},m={state:c,scheduler:this.view.resourceController.scheduler,surface:f,renderCoordsHelper:h};
this._set("centerOnSurfaceInfrequent",new p.default(d.__assign(d.__assign({},m),{task:x.Task.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:k})));this._set("centerOnSurfaceFrequent",new p.default(d.__assign(d.__assign({},m),{task:x.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:k})));this._set("centerOnContent",new p.default(d.__assign(d.__assign({},m),{task:x.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:function(){return a.estimateSurfaceAltitudeAtCenterWithContent()}})));
this._set("cameraOnSurface",new g.default(d.__assign(d.__assign({},m),{task:x.Task.POINT_OF_INTEREST_INFREQUENT,map:b})));this._set("surfaceGeometryUpdates",new v.default(d.__assign(d.__assign({},m),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})));this._set("contentGeometryUpdates",new t.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:h}));this._set("surfaceOrigin",new q.default({view:this.view}));this._set("focus",new r.default({state:c,
surface:f,renderCoordsHelper:h,centerOnSurface:this.centerOnSurfaceFrequent}));r.setupFocusDebugGraphic(this.view.graphics);this.handles.add([c.watch("camera",function(b){return a.cameraChanged(b)},!0),f.watch("extent",function(){return a.updateCenterPointsOfInterest()}),this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}),this.contentGeometryUpdates.events.on("request-update",function(){return a.updateCenterOnContent()})]);this.cameraChanged(this.view.state.camera);
this.centerOnContent.update();this.centerOnSurfaceFrequent.update();this.centerOnSurfaceInfrequent.update();this.cameraOnSurface.update()};b.prototype.destroy=function(){u.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};Object.defineProperty(b.prototype,"updating",{get:function(){return!!(this.surfaceGeometryUpdates&&this.surfaceGeometryUpdates.updating||this.centerOnContent&&this.centerOnContent.updating||
this.centerOnSurfaceInfrequent&&this.centerOnSurfaceInfrequent.updating||this.centerOnSurfaceFrequent&&this.centerOnSurfaceFrequent.updating||this.cameraOnSurface&&this.cameraOnSurface.updating||this.focus&&this.focus.updating)},enumerable:!1,configurable:!0});b.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;var a=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,
C);this.view.sceneIntersectionHelper.intersectRay(a,this.contentIntersector,A,this.contentIntersectorOptions)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(A):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter(a);return this.surfaceAltitudeAtCenterWithContent};b.prototype.estimateSurfaceAltitudeAtCenter=function(a){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=
!1;var b=this.view.state.camera;a||(a=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(b,C));var c=a.origin,d=h.vec3.add(A,a.origin,a.direction);this.surfaceIntersector.resetWithRay(a);this.surfaceIntersector.intersect(null,null,b);this.view.basemapTerrain.intersect(this.surfaceIntersector,null,c,d);this.surfaceIntersector.results.min.getIntersectionPoint(A)&&(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(A));return this.surfaceAltitudeAtCenter};b.prototype.cameraChanged=
function(a){this.updateCenterPointsOfInterest();a=a.eye;h.vec3.exactEquals(this.renderPointOfView,a)||this._set("renderPointOfView",h.vec3.copy(this.propertiesPool.get("renderPointOfView"),a))};b.prototype.updateCenterPointsOfInterest=function(){this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.updateRenderLocation();this.centerOnSurfaceInfrequent.updateRenderLocation();this.cameraOnSurface.updateRenderLocation();this.focus.updateRenderLocation();
this.centerOnContent.updateRenderLocation()};b.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0;this.centerOnContent.updateRenderLocation()};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{update:function(){a.surfaceGeometryUpdates.update();a.centerOnSurfaceFrequent.update();a.centerOnSurfaceInfrequent.update()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}},enumerable:!1,configurable:!0});d.__decorate([c.property({readOnly:!0})],
b.prototype,"centerOnContent",void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"centerOnSurfaceFrequent",void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"centerOnSurfaceInfrequent",void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"cameraOnSurface",void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"focus",void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"renderPointOfView",void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"surfaceOrigin",
void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"contentGeometryUpdates",void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"surfaceGeometryUpdates",void 0);d.__decorate([c.property({constructOnly:!0})],b.prototype,"view",void 0);d.__decorate([c.property({readOnly:!0,dependsOn:"surfaceGeometryUpdates.updating centerOnContent.updating centerOnSurfaceInfrequent.updating centerOnSurfaceFrequent.updating cameraOnSurface.updating focus.updating".split(" ")})],b.prototype,"updating",
null);return b=d.__decorate([c.subclass("esri.views.3d.support.PointsOfInterest")],b)}(l);a.PointsOfInterest=n;var B=Array,A=m.vec3f64.create(),C=b.create();a.default=n})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports tslib ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../PropertiesPool ./PointOfInterest".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.CameraOnSurface=void 0;var g=Array;n=function(a){function b(b){b=a.call(this,b)||this;b._dirty=!1;b._propertiesPool=new f.default({location:m,renderLocation:g},b);b._estimatedSurfaceAltitude=0;b._pendingElevationQueryController=null;b.renderLocation=h.vec3f64.create();return b}d.__extends(b,a);b.prototype.initialize=function(){var a=this;this.handles.add(this.scheduler.registerTask(this.task,function(){return a._measureSurfaceAltitude()},
function(){return a._needsUpdate()}));this._measureSurfaceAltitude();if(this.map){var b=function(){return a._setDirty()};this.handles.add([k.on(this.map,"ground.layers","change",b,b,b)])}};b.prototype.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};Object.defineProperty(b.prototype,"location",{get:function(){var a=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);
return a},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return this._dirty||null!=this._pendingElevationQueryController},enumerable:!1,configurable:!0});b.prototype.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};b.prototype.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};b.prototype._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};b.prototype._needsUpdate=
function(){return!this._pendingElevationQueryController&&this._dirty};b.prototype._cancelPendingRequest=function(){var a=this._pendingElevationQueryController;a&&(this._pendingElevationQueryController=null,a.abort(),this.notifyChange("updating"))};b.prototype._measureSurfaceAltitude=function(){var a=this;this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,t,this.state.spatialReference);
var b=l.createAbortController();this.map.ground.queryElevation(t,{signal:b.signal}).then(function(b){return a._updateSurfaceAltitude(b.geometry.z)}).catch(function(b){l.isAbortError(b)||a._updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a._pendingElevationQueryController===b&&(a._pendingElevationQueryController=null,a.notifyChange("updating"));b=null});this._pendingElevationQueryController=b}else this._updateSurfaceAltitude(0)};b.prototype._updateSurfaceAltitude=function(a){this._estimatedSurfaceAltitude!==
a&&(this._estimatedSurfaceAltitude=a,this._updateRenderLocation())};b.prototype._updateRenderLocation=function(){c.vec3.copy(p,this.state.camera.eye);this.renderCoordsHelper.setAltitude(this._estimatedSurfaceAltitude,p);c.vec3.exactEquals(this._get("renderLocation"),p)||this._set("renderLocation",c.vec3.copy(this._propertiesPool.get("renderLocation"),p))};d.__decorate([e.property({constructOnly:!0})],b.prototype,"scheduler",void 0);d.__decorate([e.property({constructOnly:!0})],b.prototype,"task",
void 0);d.__decorate([e.property({readOnly:!0,dependsOn:["renderLocation"]})],b.prototype,"location",null);d.__decorate([e.property({constructOnly:!0})],b.prototype,"map",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"renderLocation",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"updating",null);return b=d.__decorate([e.subclass("esri.views.3d.support.CameraOnSurface")],b)}(b.PointOfInterest);a.CameraOnSurface=n;var p=h.vec3f64.create(),t=new m;a.default=n})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.PointOfInterest=void 0;n=function(a){function h(c){c=a.call(this,c)||this;c.handles=new k;return c}d.__extends(h,a);h.prototype.destroy=function(){c.default(this,"handles")};d.__decorate([e.property({constructOnly:!0})],h.prototype,"renderCoordsHelper",void 0);d.__decorate([e.property({constructOnly:!0})],h.prototype,"surface",void 0);d.__decorate([e.property({constructOnly:!0})],h.prototype,"state",void 0);return h=d.__decorate([e.subclass("esri.views.3d.support.PointOfInterest")],
h)}(l);a.PointOfInterest=n;a.default=n})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(n,a,d){function l(a){for(var e=[],c=1;c<arguments.length;c++)e[c-1]=arguments[c];if(a instanceof d&&a.destroyed)try{throw Error("instance is already destroyed");}catch(f){console.warn(f.stack)}else for(c=0;c<e.length;c++){var h=e[c];if(!(h in a))throw Error("Property '"+h+"' does not exist and cannot be disposed");var k=a[h];
k&&("function"===typeof k.destroy?k.destroy():"function"===typeof k.dispose?k.dispose():"function"===typeof k.remove&&k.remove());a instanceof d&&h in a.__accessor__.metadatas?a._set(h,null):a[h]=null}}Object.defineProperty(a,"__esModule",{value:!0});a.disposeMembers=void 0;a.disposeMembers=l;a.default=l})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports tslib ../../../../core/mathUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../../../../geometry/support/geodesicConstants ../debugFlags ../PropertiesPool ./PointOfInterest".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){Object.defineProperty(a,"__esModule",{value:!0});a.CenterOnSurface=void 0;var p=Array;n=function(a){function g(d){d=a.call(this,d)||this;d._propertiesPool=new b.default({location:h,renderLocation:p},d);d._currentSurfaceAltitude=0;d._latestSurfaceAltitude=0;d.distance=0;d.renderLocation=c.vec3f64.create();d.updating=!1;return d}d.__extends(g,a);g.prototype.initialize=function(){var a=this;this._frameWorker=this.scheduler.registerTask(this.task,function(){return a._measureSurfaceAltitude()},
function(){return a.updating});this._measureSurfaceAltitude()};g.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this._propertiesPool.destroy();this._propertiesPool=null};Object.defineProperty(g.prototype,"location",{get:function(){var a=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!1,configurable:!0});g.prototype.updateRenderLocation=function(){this._set("updating",
!0);this._updateRenderLocation()};g.prototype.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};Object.defineProperty(g.prototype,"estimatedSurfaceAltitude",{get:function(){return this._latestSurfaceAltitude},enumerable:!1,configurable:!0});g.prototype._measureSurfaceAltitude=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this._set("updating",!1)};g.prototype._updateRenderLocation=function(){var a=u,b=this.calculateSurfaceIntersection(this._currentSurfaceAltitude,
a),c=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!b&&c&&(b=this.calculateSurfaceIntersection(this._latestSurfaceAltitude,a))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);c=r;b&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,c)&&(e.vec3.copy(a,c),this._currentSurfaceAltitude=this._latestSurfaceAltitude);b?(b=e.vec3.distance(this.state.camera.eye,a),b!==this._get("distance")&&this._set("distance",b)):(b=this.state.camera,e.vec3.scale(a,b.viewForward,this._get("distance")),
e.vec3.add(a,a,b.eye));e.vec3.exactEquals(this._get("renderLocation"),a)||this._set("renderLocation",e.vec3.copy(this._propertiesPool.get("renderLocation"),a))};g.prototype.calculateSurfaceIntersection=function(a,b){var c=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(c.ray,a,b))return!1;if(this.state.isGlobal){a=m.earthRadius+a;var d=e.vec3.squaredLength(c.eye),f=d<a*a,g=e.vec3.distance(c.eye,b);f&&g>m.earthRadius/4&&(e.vec3.scale(b,c.viewForward,a-Math.sqrt(d)),e.vec3.add(b,b,c.eye))}else if(c=
this.surface.ready&&this.surface.extent)b[0]=l.clamp(b[0],c[0],c[2]),b[1]=l.clamp(b[1],c[1],c[3]);return!0};g.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,b){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this._latestSurfaceAltitude,b)){var c=this.state.camera.eye;a=e.vec3.distance(c,a);b=e.vec3.distance(c,b);if(f.TESTS_DISABLE_UPDATE_THRESHOLDS||Math.abs(b-a)/a>t)return!0}return!1};d.__decorate([k.property({constructOnly:!0})],
g.prototype,"scheduler",void 0);d.__decorate([k.property({constructOnly:!0})],g.prototype,"task",void 0);d.__decorate([k.property({readOnly:!0})],g.prototype,"distance",void 0);d.__decorate([k.property({constructOnly:!0})],g.prototype,"estimateSurfaceAltitudeAtCenter",void 0);d.__decorate([k.property({readOnly:!0,dependsOn:["renderLocation"]})],g.prototype,"location",null);d.__decorate([k.property({readOnly:!0})],g.prototype,"renderLocation",void 0);d.__decorate([k.property({readOnly:!0})],g.prototype,
"updating",void 0);return g=d.__decorate([k.subclass("esri.views.3d.support.CenterOnSurface")],g)}(g.PointOfInterest);a.CenterOnSurface=n;var t=.05,u=c.vec3f64.create(),r=c.vec3f64.create();a.default=n})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require","exports","../../../../core/Evented","../../../../core/Handles"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.ContentGeometryUpdates=void 0;n=function(){function a(a){var c=this;this.handles=
new l;this.events=new d;this.contentLayerViews=a.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",function(a){return c.layerViewsChanged(a)}));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}a.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};a.prototype.layerViewsChanged=function(a){var c=this;a.added.forEach(function(a){"esri.views.3d.layers.SceneLayerView3D"===a.declaredClass&&
c.handles.add(a.on("visible-geometry-changed",function(){return c.contentChanged()}),a.uid)});a.removed.forEach(function(a){return c.handles.remove(a.uid)})};a.prototype.contentChanged=function(){this.events.emit("request-update",k)};return a}();a.ContentGeometryUpdates=n;var k={};a.default=n})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("require exports tslib ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../debugFlags ../debugUtils ../geometryUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){Object.defineProperty(a,"__esModule",{value:!0});a.setupFocusDebugGraphic=a.Focus=void 0;var r=Array;n=function(a){function g(b){b=a.call(this,b)||this;b._propertiesPool=new t.default({locationOnSurface:f,renderLocationOnSurface:r},b);b.centerOnSurface=null;return b}d.__extends(g,a);g.prototype.destroy=function(){this._propertiesPool.destroy();this._propertiesPool=null;k.isSome(x)&&(x.remove(),x=null)};Object.defineProperty(g.prototype,"locationOnSurface",{get:function(){var a=
this._propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,a,this.state.spatialReference);return a},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"renderLocationOnSurface",{get:function(){var a=this.centerOnSurface.renderLocation,c=this.renderCoordsHelper,d=this.calculateScreenHorizontalEdgeOnSurface(z);h.vec3.subtract(q,a,this.state.camera.eye);h.vec3.normalize(q,q);c.worldUpAtPosition(a,v);var e=Math.abs(Math.acos(h.vec3.dot(v,
q))-.5*Math.PI),c=this._propertiesPool.get("renderLocationOnSurface"),e=1-l.clamp(e/(.5*Math.PI),0,1);h.vec3.lerp(c,a,d,e*e*e);k.isSome(x)&&(b.SHOW_POI?x.showPoint(c,this.renderCoordsHelper.spatialReference):x.remove());return c},enumerable:!1,configurable:!0});g.prototype.calculateScreenHorizontalEdgeOnSurface=function(a){var b=this.state.camera,c=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),d=this.renderCoordsHelper.getAltitude(b.eye)>=c,f=b.getRenderCenter(e.createRenderScreenPointArray3());
f[1]=d?b.padding[2]:b.fullHeight-b.padding[0];b.unprojectPoint(f,w);h.vec3.subtract(w,w,b.eye);d=h.vec3.normalize(w,w);if(this.renderCoordsHelper.intersectManifold(p.ray.wrap(b.eye,d),c,a))return a;h.vec3.copy(a,b.eye);this.renderCoordsHelper.setAltitude(c,a);return a};g.prototype.updateRenderLocation=function(){};d.__decorate([c.property({constructOnly:!0})],g.prototype,"centerOnSurface",void 0);d.__decorate([c.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],g.prototype,"locationOnSurface",
null);d.__decorate([c.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],g.prototype,"renderLocationOnSurface",null);d.__decorate([c.property({readOnly:!0,aliasOf:"centerOnSurface.updating"})],g.prototype,"updating",void 0);return g=d.__decorate([c.subclass("esri.views.3d.support.CenterOnSurface")],g)}(u.PointOfInterest);a.Focus=n;a.setupFocusDebugGraphic=function(a){k.isSome(x)&&x.remove();x=new g.GraphicsHandle(a,"green")};var q=m.vec3f64.create(),v=m.vec3f64.create(),w=m.vec3f64.create(),
z=m.vec3f64.create(),x;a.default=n})},"esri/views/3d/support/debugUtils":function(){define("require exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/maybe".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.GraphicsHandle=void 0;var c={red:[255,0,0],green:[0,255,0],blue:[0,0,255]};n=function(){function a(a,d){this.graphics=a;this._symbol=new k.SimpleMarkerSymbol({color:c[d],outline:{color:[255,255,255],width:2}})}a.prototype.showPoint=function(a,
c){this.remove();a=new d.Point({x:a[0],y:a[1],z:a[2],spatialReference:c});this._graphic=new l({geometry:a,symbol:this._symbol});this.graphics.add(this._graphic)};a.prototype.remove=function(){e.isSome(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)};return a}();a.GraphicsHandle=n})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.StableSurfaceCenter=void 0;n=function(a){function g(b){b=a.call(this,b)||this;b.location=null;b._updateController=null;b._handles=new k;return b}d.__extends(g,a);Object.defineProperty(g.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=m.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!1,configurable:!0});g.prototype.initialize=function(){var a=
this;this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],function(){return a._update()}),c.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};g.prototype.destroy=function(){this._handles.destroy()};g.prototype._update=function(){var a=this;this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var c=
b.center(this.surfaceView.extent),c=new f({x:c[0],y:c[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=e.createAbortController(),this.surface.queryElevation(c,{noDataValue:0,signal:this._updateController.signal}).then(function(b){a._updateController=null;a._set("location",b.geometry)}).catch(function(a){e.isAbortError(a)||a&&"elevation-query:invalid-layer"===a.name||console.error("StableSurfaceCenter failed to update: ",
a)})):this._set("location",c)}else this._set("location",null)};d.__decorate([h.property({constructOnly:!0})],g.prototype,"view",void 0);d.__decorate([h.property({readOnly:!0,aliasOf:"view.map.ground"})],g.prototype,"surface",void 0);d.__decorate([h.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],g.prototype,"surfaceView",void 0);d.__decorate([h.property({readOnly:!0})],g.prototype,"location",void 0);d.__decorate([h.property({readOnly:!0,dependsOn:["location"]})],g.prototype,"renderLocation",
null);return g=d.__decorate([h.subclass("esri.views.3d.terrain.StableSurfaceCenter")],g)}(l);a.StableSurfaceCenter=n;a.default=n})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),function(n,a,d,l,k,
e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.SurfaceGeometryUpdates=void 0;n=function(a){function h(){var b=null!==a&&a.apply(this,arguments)||this;b.handles=new e;b._tileGeometryUpdateExtent=m.empty();b._tileGeometryUpdateSpatialReference=null;b.events=new k;b.updating=!1;return b}d.__extends(h,a);h.prototype.initialize=function(){var a=this;this.handles.add([this.surface.on("elevation-change",function(b){return a._tileGeometryChanged(b)}),this.scheduler.registerTask(f.Task.SURFACE_GEOMETRY_UPDATES,
function(){return a.update()},function(){return a.updating})])};h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};h.prototype.update=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",b),m.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};h.prototype._tileGeometryChanged=function(a){this._tileGeometryUpdateSpatialReference=a.spatialReference;
m.expand(this._tileGeometryUpdateExtent,a.tile.extent);this._set("updating",!0)};h.prototype._furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaces[0],b=1;b<this.centerOnSurfaces.length;b++){var c=this.centerOnSurfaces[b];c.distance>a.distance&&(a=c)}return a};h.prototype._centerIntersectsExtent=function(a,b){var c=this.state.camera.eye,d=t,e=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(c,g,b);this.renderCoordsHelper.fromRenderCoords(e.renderLocation,p,b);
g[0]<p[0]?(d[0]=g[0],d[2]=p[0]):(d[0]=p[0],d[2]=g[0]);g[1]<p[1]?(d[1]=g[1],d[3]=p[1]):(d[1]=p[1],d[3]=g[1]);return m.intersects(d,a)};d.__decorate([c.property({constructOnly:!0})],h.prototype,"state",void 0);d.__decorate([c.property({constructOnly:!0})],h.prototype,"centerOnSurfaces",void 0);d.__decorate([c.property({constructOnly:!0})],h.prototype,"renderCoordsHelper",void 0);d.__decorate([c.property({constructOnly:!0})],h.prototype,"scheduler",void 0);d.__decorate([c.property({constructOnly:!0})],
h.prototype,"surface",void 0);d.__decorate([c.property({readOnly:!0})],h.prototype,"updating",void 0);return h=d.__decorate([c.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],h)}(l);a.SurfaceGeometryUpdates=n;var b={},g=h.vec3f64.create(),p=h.vec3f64.create(),t=m.empty();a.default=n})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports tslib ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/decluttering/jobsUtil ../layers/ElevationLayerView3D ../support/debugFlags ../support/extentUtils ../support/geometryUtils ../support/pointUtils ../support/projectionUtils ./ElevationBounds ./ElevationData ./OverlayManager ./PlanarPatch ./SphericalPatch ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./Tile ./tileUtils ./UpsampleInfo ../../support/Scheduler @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O,N,S,P,U,Z,V,T,Y,X,ca){function ba(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function ga(a){return a.isLeaf?!1:a.children[0].shouldRender||a.children[1].shouldRender||a.children[2].shouldRender||a.children[3].shouldRender||ga(a.children[0])||ga(a.children[1])||ga(a.children[2])||ga(a.children[3])}var ia=f.getLogger("esri.views.3d.terrain.TerrainSurface");a=function(a){function f(b){b=a.call(this,b)||this;b._clippingExtent=
null;b._dataExtent=null;b._elevationBounds=new M.ElevationBounds;b._rootExtent=A.create();b._iteratorPool=new g(Y.IteratorPreorder);b._postorderIterator=new Y.IteratorPostorder;b.pendingUpdates=!1;b._asyncWorkItems=0;b._visible=!1;b._usedMemory=ha;b._isUpdating=!1;b._viewChangeUpdateDirty=!1;b._overlayOpacity=1;b._eyePosRenderSR=x.vec3f64.create();b._eyePosSurfaceSR=x.vec3f64.create();b._splitLimits=new T.SplitLimits;b._snapLevel=Infinity;b._frustum=I.frustum.create();b._viewProjectionMatrix=w.mat4f64.create();
b._layerViews=[[],[]];b._layerIndexByLayerViewId=[new Map,new Map];b._basemapLayerViewHandles=new Map;b._handles=new m;b._allTiles=new p;b._upsampleInfoPool=new g(X.UpsampleInfo);b._visibleLevels=new p({deallocator:null});b._getElevationData={spatialReference:null,rootTiles:null};b.maxTextureScale=1.2;b.rootTiles=null;b.backgroundImage=U.DEFAULT_TILE_BACKGROUND;b.backgroundColor=null;b._layerViewsDirty=!1;return b}d.__extends(f,a);f.prototype.initialize=function(){var a=this;this._stage=this.view._stage;
this._lercDecoder=E.acquireInstance(this.view.resourceController.scheduler);this._tilePool="planar"===this.manifold?new g(O.PlanarPatch):new g(N.SphericalPatch);this._upsampleMapCache=this.view.resourceController.memoryController.getMemCache("esri.views.3d.terrain.upsample",function(a){return a.unloadMapData()});this._set("overlayManager",new R.OverlayManager({terrainSurface:this,view:this.view}));this._handles.add([this.watch("overlayManager.hasHighlights",function(b){return a._renderer.setNeedsHighlight(b)}),
this.watch("overlayManager.rendersOccluded",function(b){return a._renderer.setRenderOccludedOverlay(b)})],"overlayManager");this._renderer=new Z({manifold:this.manifold,overlayRenderer:this.overlayManager.renderer});this._renderer.install(this.view._stage);this._handles.add([u.init(this,"baseOpacity",function(b){a._handleLayerViewChanges();a._updateBaseOpacity(b)},!0),u.init(this,"_background",function(){a._handleLayerViewChanges();a._renderer.setTileBackground(a._background)},!0),this.view.watch("pointsOfInterest",
function(b){return a._renderer.pointsOfInterest=b}),u.whenTrue(H,"TERRAIN_DEBUG_POPUP",function(){(new Promise(function(a,b){n(["./support/TerrainDebugPopupOpener"],a,b)})).then(function(b){var c=new b.TerrainDebugPopupOpener({surface:a});u.whenFalseOnce(H,"TERRAIN_DEBUG_POPUP",function(){return c.destroy()})})})]);var b={layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,spatialReference:this.view.spatialReference};this.extentHelper="spherical"===this.manifold?new S.SurfaceExtentHelperGlobal(b):
new S.SurfaceExtentHelperLocal(b);this._handles.add(u.init(this.extentHelper,"stencilEnabledExtents",function(b){return a._renderer.setStencilEnabledLayerExtents(b)}),"extentHelper");b=this.view.defaultsFromMap?new c({root:this.view.map,rootCollectionNames:this.view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(a){return a.layers}}):this.view.map.allLayers;b=new P({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",
b);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",function(){return a._updateTilingSchemeAndExtent()},!0),this.tilingSchemeLogic.watch("extent",function(){return a._updateTilingSchemeAndExtent()},!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(0);this._mapDataRequester=this.view.resourceController.createStreamDataRequester(1);this._frameTask=this.view.resourceController.scheduler.registerTask(ca.Task.TERRAIN_SURFACE,
function(b){return a._update(b)},function(){return a.updating});this.view.resourceController.memoryController.events.on("quality-changed",function(){return a._viewChangeUpdate()});this._handles.add([this.view.on("resize",function(){return a._viewChangeUpdate()}),this.view.watch("state.camera",function(){return a._viewChangeUpdate()},!0),this.view.watch("qualitySettings.tiledSurface.lodBias",function(){return a._viewChangeUpdate()}),u.init(this.view,"qualitySettings.tiledSurface.textureFadeDuration",
function(b){return a._renderer.textureFadingEnabled=0<b}),this.view.watch("lodSnapping",function(){return a._viewChangeUpdate()}),this.view.watch("clippingArea",function(){return a._clippingChanged()})]);this._handles.add(this.view.allLayerViews.on("after-changes",function(){return a._layerViewsDirty=!0}));this._layerViewsDirty=!0;this._handleLayerViewChanges();this._updateClippingExtent();this.notifyChange("extent")};f.prototype.destroy=function(){var a=this;this._frameTask.remove();this._handles.destroy();
E.releaseInstance(this._lercDecoder);this._lercDecoder=null;this._removeAllTiles();this._upsampleMapCache.destroy();this._upsampleMapCache=null;this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;this._basemapLayerViewHandles.forEach(function(b,c){return a._unregisterTiledLayerView(c)});this._mapDataRequester=this._elevationDataRequester=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._tilePool.destroy();
this._tilePool=null;T.pruneAgents();this._renderer.uninstall(this._stage);this._renderer.destroy();this._renderer=null;this._iteratorPool.destroy();this._iteratorPool=null;this._set("view",null);this._stage=null;this._upsampleInfoPool.destroy();this._upsampleInfoPool=null};Object.defineProperty(f.prototype,"renderer",{get:function(){return this._renderer},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"frustum",{get:function(){return this._frustum},enumerable:!1,configurable:!0});
Object.defineProperty(f.prototype,"snapLevel",{get:function(){return Math.round(this._snapLevel)},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"upsampleInfoPool",{get:function(){return this._upsampleInfoPool},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"upsampleMapCache",{get:function(){return this._upsampleMapCache},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!1,
configurable:!0});Object.defineProperty(f.prototype,"updating",{get:function(){return!(!(this.pendingUpdates||0<this._asyncWorkItems||this._renderer.updating||this.overlayManager.updating||this._layerViewsDirty||this._frameTask.updating)||!this.ready||this.suspended)},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=
a;this._set("renderOrder",a)},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"skirtScale",{get:function(){return this._renderer.skirtScale},set:function(a){this._renderer.skirtScale=a},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"spatialReference",{get:function(){var a=this.tilingScheme&&this.tilingScheme.spatialReference||null;return this._getElevationData.spatialReference=a},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"_background",
{get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"slicePlaneEnabled",{set:function(a){this._renderer.slicePlane=a;this._set("slicePlaneEnabled",a)},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOverground=a);this._set("velvetOverground",a)},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,
"visible",{set:function(a){a!==this._visible&&(this._visible=a,this._renderer.setVisibility(a),this.suspended=!a)},enumerable:!1,configurable:!0});f.prototype.isOpaque=function(){return this._renderer.opaque};Object.defineProperty(f.prototype,"suspended",{set:function(a){this._set("suspended",a);this._viewChangeUpdate()},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"lodSnapping",{get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?0:1},enumerable:!1,
configurable:!0});f.prototype.intersect=function(a,b,c,d){this._renderer.intersect(a,b,c,d)};f.prototype.getElevation=function(a,b,c,d){var e=this._getElevationData.rootTiles;if(!e||!e.length||0===e[0].layerInfo[0].length)return null;var f=da;f[0]=a;f[1]=b;f[2]=c;if(!L.vectorToVector(f,d,f,this._getElevationData.spatialReference))return ia.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(b=0;b<e.length;b++)if(a=e[b],a.containsPoint(f)){for(;a&&
!a.rendered&&!a.isLeaf;)e=0,f[0]>.5*(a.extent[0]+a.extent[2])&&(e+=1),f[1]<.5*(a.extent[1]+a.extent[3])&&(e+=2),a=a.children[e];if(e=(e=a.renderData)&&e.geometryState?e.geometryState.samplerData:null)return Q.ElevationData.sample(f[0],f[1],e);break}return null};Object.defineProperty(f.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!1,configurable:!0});f.prototype.getScale=function(a){if(this.tilingScheme){if(!K.pointToVector(a,da,this.spatialReference))return ia.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),
null;var b=this.rootTiles;if(b)for(var c=0;c<b.length;c++)if(a=b[c],a.containsPoint(da)){for(;null!=a.children[0];)b=0,da[0]>a.children[0].extent[2]&&(b+=1),da[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.level)}}return 1E100};f.prototype.queryVisibleScaleRange=function(a,b,c,d){b=b?this.tilingScheme.levelAtScale(b):0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var e=this.lodBias;this._renderer.queryVisibleLevelRange(a,b+e,c+e,d)};f.prototype._updateBaseOpacity=
function(a){var b=this._renderer.opaque;this._renderer.opaque=1<=a;this._renderer.isTransparent=this.allTransparentSurfaceLayers();this._updateTileTextures(b!==this._renderer.opaque)};f.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,b=a&&!A.equals(a,this._dataExtent);b&&(this._dataExtent?A.set(this._dataExtent,a):this._dataExtent=A.create(a));var a=this.tilingSchemeLogic.tilingScheme,c=a!==this.tilingScheme;c&&(V.weakAssert(!!a,"tiling scheme cannot be reset to undefined"),
this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",a),this._updateClippingExtent(),a&&(this._updateTiledLayers(),this._renderer.setTileSize(a.pixelSize),this.overlayManager.setSpatialReference(a.spatialReference,"spherical"===this.manifold)));(b||c)&&this._updateRootTiles()};f.prototype._acquireTile=function(a,b,c,d){var e=this._tilePool.acquire();ka[0]=a;ka[1]=b;ka[2]=c;e.init(ka,d,this);return e};f.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,
c=this.tilingScheme;if(b&&c){var d=fa,f=c.rootTilesInExtent(b,d,5*U.MAX_ROOT_TILES),g=function(b){b=a._acquireTile(0,b[1],b[2],null);2===b.shouldSplit(a._splitLimits,a._eyePosRenderSR,a.lodSnapping)&&b.setPendingUpdate(2);a._loadTile(b);return b};if(this.rootTiles){if(f.length>U.MAX_ROOT_TILES){ia.warn(U.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var b=this.rootTiles.map(function(a){return a.lij}),h=e.difference(b,f,ba);if(0<h.removed.length||0<h.added.length){var k=this.rootTiles.filter(function(b){return-1<
e.findIndex(h.removed,ba.bind(null,b.lij))?(a._purgeTile(b),!1):!0});h.added.forEach(function(a){return k.push(g(a))});this._setRootTiles(k)}}else f.length>U.MAX_ROOT_TILES&&(ia.warn(U.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),f=c.rootTilesInExtent(b,d,U.MAX_ROOT_TILES)),this._setRootTiles(f.map(function(a){return g(a)}));A.equals(d,this._rootExtent)||(this._rootExtent=A.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setOverlayPlacementDirty();
this.notifyChange("ready")}};f.prototype._setRootTiles=function(a){this._set("rootTiles",a);this._allTiles.clear();if(a){var b=this._iteratorPool.acquire();for(b.reset(a);!b.done;)this._allTiles.push(b.next());this._iteratorPool.release(b)}this._getElevationData.rootTiles=a;this._renderer.setRootTiles(this.rootTiles);this._updateTiles(a)};f.prototype._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};f.prototype._viewChangeUpdate=
function(){this._stage&&!this.suspended&&this.tilingScheme&&this._visible&&(this._isUpdating?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this.updateOverlayOpacity(),this._updateTiles(this.rootTiles)))};f.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.resetPendingUpdate(32)&&this._updateTileGeometry(a)};f.prototype._updateTiles=function(a){if(a){var b=this._iteratorPool.acquire();
b.reset(a);var c;Y.hasVisibleSiblings(a)?(a=this._elevationBounds.min,c=this._elevationBounds.max):(a=Infinity,c=-Infinity);for(;!b.done;){var d=b.next();this._updateClippingStatus(d);d.updateVisibility();d.setPendingUpdate(16);if(d.visible){d.updateScreenDepth(this._viewProjectionMatrix);d.renderData&&(a=Math.min(d.elevationBounds[0],a),c=Math.max(d.elevationBounds[1],c));var e=d.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(2===e){d.resetPendingUpdate(8);d.isLeaf&&(d.setPendingUpdate(2),
b.skipSubtree());continue}d.resetPendingUpdate(2)&&d.updateAgentSuspension();4===e&&d.updateAgents(0)}b.skipSubtree();if(!d.isLeaf){d.setPendingUpdate(8);d.resetPendingUpdate(2);e=this._iteratorPool.acquire();e.resetOne(d);for(d=e.next();!e.done;d=e.next())this._updateClippingStatus(d),d.updateVisibility(),d.visible&&d.updateScreenDepth(this._viewProjectionMatrix);this._iteratorPool.release(e)}}this._iteratorPool.release(b);this.pendingUpdates=!0;isFinite(a)&&isFinite(c)&&(this._elevationBounds.min!==
a||this._elevationBounds.max!==c)&&(this._elevationBounds.min=a,this._elevationBounds.max=c,this.emit("elevation-bounds-change",null))}};f.prototype._updateViewDependentParameters=function(){var a=this.view.state.camera,b=Math.tan(.5*a.fovX),c=Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,e=Math.pow(2,-this.lodBias)*a.pixelRatio;this._splitLimits.aboveGround=a.aboveGround;this._splitLimits.fovX=b;this._splitLimits.fovY=c;this._splitLimits.relativeWidthLimit=d/a.width*this.maxTextureScale*e;this._splitLimits.relativeHeightLimit=
d/a.height*this.maxTextureScale*e;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;I.frustum.copy(a.frustum,this._frustum);v.mat4.multiply(this._viewProjectionMatrix,a.projectionMatrix,a.viewMatrix);z.vec3.copy(this._eyePosRenderSR,a.eye);L.vectorToVector(this._eyePosRenderSR,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};f.prototype._updateSnapLevel=function(){if(1!==this.lodSnapping){var a=
this._findSnapLevel();if(!(.1>Math.abs(this._snapLevel-a))){var b=this.snapLevel;this._snapLevel=a;b!==this.snapLevel&&this._updateTiles(this.rootTiles)}}};f.prototype._findSnapLevel=function(){if(0>=this._visibleLevels.length)return this._snapLevel;var a=this._visibleLevels,c=Math.round(a.length*(Math.abs(this.view.camera.tilt-90)/90*.4+.3));if(c>=a.length)return this._snapLevel;a.sort(function(a,b){return a-b});for(var d=0,e=c;e<a.length;++e)d+=a.getItemAt(e);e=a.getItemAt(Math.round(.95*a.length)-
1);return b.clamp(d/(a.length-c),e-1,this._splitLimits.maxLod)};f.prototype._updateSkirts=function(){var a=this.view.state.camera;V.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this.spatialReference,this.view.state.constraints.collision.enabled?0:1.11*a.near)};f.prototype._updateRenderData=function(a){a.rendered&&!a.shouldRender&&(ga(a)?this._loadChildren(a):a.isLeaf&&a.parent&&a.parent.shouldRender&&this._loadParent(a))};f.prototype._updateTileGeometry=function(a){a.updateVisibility();this._renderer.updateTileGeometry(a);
this._elevationUpdate(a);this._usedMemory=ha};f.prototype._elevationUpdate=function(a){pa.spatialReference=this.spatialReference;pa.tile=a;pa.extent=a.extent;this.emit("elevation-change",pa);A.containsPoint(a.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};f.prototype._update=function(a){var b=this;this._handleLayerViewChanges();this._isUpdating=!0;this._mergeAndSplit(a);a.run(function(){return b._updateElevation(a)});a.run(function(){return b._updateTextures(a)});this._isUpdating=!1;this._runViewChangeUpdateIfDirty()};
f.prototype._mergeAndSplit=function(a){var b=this;if(!this.suspended&&this.pendingUpdates){this.pendingUpdates=!1;for(var c=this._eyePosRenderSR,d=0,e=!1,f=0===this.lodSnapping?function(a){var d=a.shouldSplit(b._splitLimits,c,1);a.visible&&2!==d&&a.parent&&2===a.parent.shouldSplit(b._splitLimits,c,1)&&(1===d?b._visibleLevels.fill(a.level+1,4):b._visibleLevels.push(a.level))}:function(){};!a.done;){this._visibleLevels.clear();var g=!this._allTiles.some(function(c){d+=c.usedMemory;f(c);c.resetPendingUpdate(8)?
(b._mergeTile(c),e=!0,a.madeProgress()):c.resetPendingUpdate(2)&&(b._splitTile(c),e=!0,a.madeProgress());c.resetPendingUpdate(16)&&(b._updateRenderData(c),a.madeProgress());b.pendingUpdates=b.pendingUpdates||c.updating;return a.done});e&&(this.pendingUpdates=!0,e=!1,Y.sortTiles(this._renderer.renderOrder,this._allTiles));if(g){this._updateSnapLevel();this._usedMemory=d;break}this.pendingUpdates=!0}this._visibleLevels.clear()}};f.prototype._updateElevation=function(a){var b=this;this._allTiles.some(function(c){c.resetPendingUpdate(32)&&
(b._updateTileGeometry(c),a.madeProgress());return a.done});return a.hasProgressed};f.prototype._updateTextures=function(a){var b=this;this._allTiles.some(function(c){c.resetPendingUpdate(64)&&(b._renderer.updateTileTexture(c),b._usedMemory=ha,a.madeProgress());return a.done});return a.hasProgressed};f.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=A.create(),b=null;J.toBoundingRect(this.view.clippingArea,a,this.spatialReference)&&(b=a);if(A.equals(b,this._clippingExtent))return!1;
this._clippingExtent=b;this._renderer.clippingExtent=b;this.notifyChange("extent");this.updateTileOverlayParams();this.overlayManager.setOverlayPlacementDirty();return!0};f.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};Object.defineProperty(f.prototype,"lodBias",{get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*U.MAX_MEMORY_LOD_BIAS},enumerable:!1,configurable:!0});f.prototype._getLodBiasCorrectedScale=
function(a){var c=this.tilingScheme.levels;a=b.clamp(a-this.lodBias,0,c.length-1);var d=a-Math.floor(a);return c[Math.floor(a)].scale*(1-d)+c[Math.ceil(a)].scale*d};f.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){return a._purgeTile(b)}),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.visible=!1};f.prototype._purgeChildTiles=function(a){if(a.isLeaf)return!1;var b=this._purgeTile(a.children[0]),b=this._purgeTile(a.children[1])||
b,b=this._purgeTile(a.children[2])||b,b=this._purgeTile(a.children[3])||b;a.unsetChildren();return b};f.prototype._purgeTile=function(a){var b=this._purgeChildTiles(a)||a.rendered;this._allTiles.removeUnordered(a);a.unload(this._renderer);this._tilePool.release(a);return b};f.prototype._splitTile=function(a){V.weakAssert(a.isLeaf,"tile that is already split should not be split again!");var b=a.level+1,c=2*a.lij[1],d=2*a.lij[2];a.setChildren(this._createTile(b,c,d,a),this._createTile(b,c,d+1,a),this._createTile(b,
c+1,d,a),this._createTile(b,c+1,d+1,a));a.setPendingUpdate(16);a.updateAgentSuspension();this._allTiles.pushArray(a.children);this.pendingUpdates=!0;this._emitTileScaleChange(a,b);return a.children[0].hasPendingUpdate(2)||a.children[1].hasPendingUpdate(2)||a.children[2].hasPendingUpdate(2)||a.children[3].hasPendingUpdate(2)};f.prototype._emitTileScaleChange=function(a,b){void 0===b&&(b=a.level);na.spatialReference=this.spatialReference;na.extent=a.extent;na.scale=this._getLodBiasCorrectedScale(b);
this.emit("scale-change",na)};f.prototype._createTile=function(a,b,c,d){V.weakAssert(!!d,"_createTile sanity check");a=this._acquireTile(a,b,c,d);a.updateClippingStatus(this._clippingExtent);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),2===a.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&a.setPendingUpdate(2));return a};f.prototype._mergeTile=function(a){V.weakAssert(!a.hasPendingUpdate(2),"_mergeTile sanity check");this._purgeChildTiles(a)&&(V.weakAssert(!a.renderData,
"_mergeTile sanity check"),this._loadTile(a));this.pendingUpdates=!0;this._emitTileScaleChange(a)};f.prototype._loadChildren=function(a){V.weakAssert(a.rendered,"parent should be rendered");a.unload(this._renderer);this._loadTile(a.children[0]);this._loadTile(a.children[1]);this._loadTile(a.children[2]);this._loadTile(a.children[3])};f.prototype._loadParent=function(a){a=a.parent;this._unloadChildren(a);this._loadTile(a)};f.prototype._unloadChildren=function(a){a.isLeaf||(this._unloadChildren(a.children[0]),
a.children[0].unload(this._renderer),this._unloadChildren(a.children[1]),a.children[1].unload(this._renderer),this._unloadChildren(a.children[2]),a.children[2].unload(this._renderer),this._unloadChildren(a.children[3]),a.children[3].unload(this._renderer))};f.prototype._loadTile=function(a){a.load(this._renderer);a.setPendingUpdate(16);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setTileParameters(a,a.renderData,this._overlayOpacity);this._elevationUpdate(a)};f.prototype._elevationDataArrived=
function(a,b,c){c=new Q.ElevationData(a.lij,a.extent,c);a.dataArrived(b,0,c);c=[a];a=a.level;var d=this._iteratorPool.acquire();for(d.reset(c);!d.done;){var e=d.next();e.findElevationBoundsForLayer(b,a);e.computeElevationBounds()}this._iteratorPool.release(d);this._updateTiles(c)};f.prototype._handleLayerViewChanges=function(){var a=this;if(this._layerViewsDirty){for(var b=this._layerViewsDirty=!1,c=new Set,d=-1,e=0,f=this.view.allLayerViews.items;e<f.length;e++){var g=f[e];c.add(g.uid);if(V.isSurfaceLayerView(g))if(this._basemapLayerViewHandles.has(g.uid)){var h=
this.layerClassFromLayerView(g),g=this._layerIndexByLayerViewId[h].get(g.uid);g<d&&(b=!0);d=g}else this._registerTiledLayerView(g),g.layer.loaded&&(b=!0)}this._basemapLayerViewHandles.forEach(function(d,e){c.has(e)||(a._unregisterTiledLayerView(e),b=!0)});b&&this._updateTiledLayers();this._renderer.isTransparent=this.allTransparentSurfaceLayers()}};f.prototype.allTransparentSurfaceLayers=function(){for(var a=0===this.view.map.ground.opacity,b=0,c=this.view.allLayerViews.items;b<c.length;b++){var d=
c[b];if(V.isSurfaceLayerView(d)&&!V.isElevationLayerView(d)&&!C.isBaseLayer(d.layer)&&0!==d.fullOpacity){a=!1;break}}return a};f.prototype.layerClassFromLayerView=function(a){return V.isElevationLayerView(a)?0:1};f.prototype._registerTiledLayerView=function(a){var b=this,c=[],d=this.layerClassFromLayerView(a);c.push(a.watch("suspended",function(){return b._updateTiledLayers()}));c.push(a.watch("fullOpacity",function(){return b._updateTileTextures(!1)}));c.push(a.layer.watch("scaleRangeId",function(){return b._restartAllAgents(d)}));
a.on("data-changed",function(){var c=b._layerIndexByLayerViewId[d].get(a.uid);null!=c&&b._invalidateLayerData(c,d)});this._basemapLayerViewHandles.set(a.uid,c)};f.prototype._unregisterTiledLayerView=function(a){var b=this._basemapLayerViewHandles.get(a);if(b){for(var c=0;c<b.length;c++)b[c].remove();this._basemapLayerViewHandles.delete(a)}};f.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme&&!this.view.suspended){var b=this.view.allLayerViews,c=[[],[]],d=null,e=A.empty();b.forEach(function(b){var f=
b.layer;if(f&&!b.suspended&&V.isSurfaceLayerView(b)){var g=b.fullExtent;g?a.tilingScheme.compatibleWith(b.tileInfo)?(A.expand(e,g),f=a.layerClassFromLayerView(b),1===f&&(g=b.displayLevelRange,Infinity!==g.maxLevel&&(null===d||g.maxLevel>d)&&(d=g.maxLevel)),c[f].push(b)):ia.warn("Terrain: tiling scheme of layer "+f.id+" is incompatible with other tiled layers, will not be drawn"):ia.warn("Terrain: Map or elevation layer does not have fullExtent: "+f.id)}});for(b=0;2>b;b++){var f=this._layerViews[b],
g=c[b];g.reverse();var h=g.length,k=f.length!==h,m=Array(h),l=Array(f.length);this._layerIndexByLayerViewId[b].clear();for(var p=0;p<h;p++){this._layerIndexByLayerViewId[b].set(g[p].uid,p);var r=f.indexOf(g[p]);m[p]=r;p!==r&&(k=!0);-1<r&&(l[r]=p)}if(k){f=this._postorderIterator;for(f.reset(this.rootTiles);!f.done;)f.next().modifyLayers(l,m,b);this._layerViews[b]=g;this._restartAllAgents(b);this._updateTiles(this.rootTiles)}}this.tilingScheme.ensureMaxLod(d)&&this._viewChangeUpdate()}};f.prototype._restartAllAgents=
function(a){var b=this._postorderIterator;for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.restartAgents(a);0===a&&c.computeElevationBounds()}};f.prototype._hasFixedExtent=function(){return!!this._clippingExtent};f.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};f.prototype.numLayers=function(a){return this._layerViews[a].length};f.prototype._updateTileTextures=function(a){var b=this;this._allTiles.forEachSimple(function(c){c.updateAgents(1);a?b.renderer.updateTileTexture(c):
c.updateRenderData(1)});this._renderer.isTransparent=this.allTransparentSurfaceLayers()};f.prototype._invalidateLayerData=function(a,b){this._allTiles.forEachSimple(function(c){return c.removeLayerAgent(a,b)});this._allTiles.forEachSimple(function(c){return c.invalidateLayerData(a,b)})};f.prototype.requestRender=function(a){void 0===a&&(a=1);this.renderer.setNeedsRender(a)};f.prototype.requestTileData=function(a,b,c,e){var f=this,g=this.layerViewByIndex(b,c);b=g.layer;if(!b.tilemapCache||V.isVectorTileLayerView(g))return this._requestTileData(a,
c,g,e);++this._asyncWorkItems;return b.tilemapCache.fetchAvailability(a.lij[0],a.lij[1],a.lij[2],d.__assign(d.__assign({},e),{timeout:6E3})).then(function(){return--f._asyncWorkItems}).catch(function(b){--f._asyncWorkItems;t.isAbortError(b)||f._dataMissing(a,c,g,{notInTilemap:!0});throw b;}).then(function(){return f._frameTask.schedule(function(){return f._requestTileData(a,c,g,e)},e.signal)})};f.prototype._requestTileData=function(a,b,c,d){return 0===b?this._requestElevationTileData(a,c,d):this._requestMapTileData(a,
c,d)};f.prototype._requestElevationTileData=function(a,b,c){var d=this;if(V.isElevationLayerView(b)){var e=function(e){--d._asyncWorkItems;if(!t.isAborted(c)){var f=d._layerIndexByLayerViewId[0].get(b.uid);null==f?ia.warn("TerrainSurface: received data from unknown layer %d %s",0,a.lij.toString()):(d._usedMemory=ha,d.pendingUpdates=!0,d._elevationDataArrived(a,f,e))}},f=function(c){--d._asyncWorkItems;t.isAbortError(c)||(d._dataMissing(a,0,b,c),d.pendingUpdates=!0)};++this._asyncWorkItems;if(V.useFetchTileForLayer(b.layer))return b.layer.fetchTile(a.lij[0],
a.lij[1],a.lij[2],{noDataValue:U.ELEVATION_NODATA_VALUE,signal:c.signal}).then(function(a){t.isAborted(c)?(ia.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),f(t.createAbortError())):e(a)},f);var g=b.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);return this._elevationDataRequester.request(g,"binary",c).then(function(a){return d._lercDecoder.decode(a,{noDataValue:U.ELEVATION_NODATA_VALUE},c.signal)}).then(function(a){e({values:a.pixelData,
width:a.width,height:a.height,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue})},f)}V.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};f.prototype._requestMapTileData=function(a,b,c){var d=this;if(b instanceof F)return t.reject();++this._asyncWorkItems;var e=function(e){return d._frameTask.schedule(function(){--d._asyncWorkItems;d.pendingUpdates=!0;t.isAborted(c)?V.releaseTileData(e):d._dataArrived(a,1,b,e)},c.signal).catch(f)},f=function(e){return d._frameTask.schedule(function(){--d._asyncWorkItems;
t.isAborted(c)||(d._dataMissing(a,1,b,e),d.pendingUpdates=!0)})};if(V.isVectorTileLayerView(b)){var g=b.schemaHelper.getLevelRowColumn(a.lij);return b.tileHandler.getVectorTile(g[0],g[1],g[2],c).then(function(a){a.neededForCoverage=!0;a.transforms.tileUnitsToPixels=q.mat3f32.fromValues(.125,0,0,0,.125,0,0,0,1);G.declutterSingleTile(a);e(a)},f)}if(V.isImageryTileLayerView(b))return b.fetchTile(a.lij[0],a.lij[1],a.lij[2],c).then(e,f);if(V.useFetchTileForLayer(b.layer)&&V.isTileLayerView(b))return b.layer.fetchTile(a.lij[0],
a.lij[1],a.lij[2],c).then(function(a){t.isAborted(c)?(ia.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),f(t.createAbortError())):e(a)},f);g=b.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);null!=b.refreshInterval&&b.refreshTimestamp&&(g+=(-1<g.indexOf("?")?"\x26":"?")+"_ts\x3d"+b.refreshTimestamp);return this._mapDataRequester.request(g,b.hasMixedImageFormats?"image+type":"image",c).then(e,f)};f.prototype._dataArrived=
function(a,b,c,d){c=this._layerIndexByLayerViewId[b].get(c.uid);null!=c?a.dataArrived(c,b,d):ia.warn("TerrainSurface: received data from unknown layer")};f.prototype._dataMissing=function(a,b,c,d){c=this._layerIndexByLayerViewId[b].get(c.uid);null!=c?a.dataMissing(c,b,d):ia.warn("TerrainSurface: received data from unknown layer")};f.prototype.updateTileOverlayParams=function(){var a=this;this.rootTiles&&(this._allTiles.forEachSimple(function(b){b.renderData&&a.overlayManager&&a.overlayManager.setTileParameters(b,
b.renderData,a._overlayOpacity)}),this._renderer.setNeedsRender())};f.prototype.updateOverlayOpacity=function(){if(this.overlayManager){var a=this.overlayManager.updateOpacity(this._eyePosSurfaceSR[2]);isNaN(a)||a===this._overlayOpacity||(this._allTiles.forEachSimple(function(b){return b.renderData&&(b.renderData.overlayOpacity=a)}),this._overlayOpacity=a,this._renderer.setNeedsRender())}};f.prototype.getStats=function(){var a={numNodes:this._allTiles.length,numLeaves:0,numVisible:0,numRendered:0,
numRenderedPerLevel:[],numLoadedPerLevel:[]};this._allTiles.forEachSimple(function(b){b.isLeaf&&a.numLeaves++;var c=b.level;b.renderData&&(a.numLoadedPerLevel[c]=(a.numLoadedPerLevel[c]||0)+1);b.visible&&(a.numVisible++,b.rendered&&(a.numRenderedPerLevel[c]=(a.numRenderedPerLevel[c]||0)+1,a.numRendered++))});return a};f.prototype.getUsedMemory=function(){var a=this;if(!this.tilingScheme)return 0;this._usedMemory===ha&&(this._usedMemory=0,this._allTiles.forEachSimple(function(b){return a._usedMemory+=
b.usedMemory}));return this._usedMemory};f.prototype.getUsedMemoryForLayerView=function(a){var b=0,c=this.layerClassFromLayerView(a),d=this._layerIndexByLayerViewId[c].get(a.uid);this._allTiles.forEachSimple(function(a){return b+=a.getUsedMemoryForLayer(c,d)});return b};f.prototype.getTile=function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return e.find(this.rootTiles,function(a){return a.lij[1]===b[1]&&a.lij[2]===b[2]});a=Math.pow(2,b[0]);var c=Math.floor(b[1]/a),d=Math.floor(b[2]/
a),f;this.rootTiles.some(function(a){return a.lij[1]===c&&a.lij[2]===d?(f=a,!0):!1});if(f){for(a=1<<b[0]-1;f.lij[0]<b[0];){var g=b[1]&a?2:0;0<(b[2]&a)&&g++;if(!f.children[g])return null;f=f.children[g];a>>=1}V.weakAssert(f.lij[0]===b[0]&&f.lij[1]===b[1]&&f.lij[2]===b[2],"not the right tile?");return f}return null};f.prototype.getRenderedTiles=function(){ja.clear();this._allTiles.forEachSimple(function(a){a.visible&&a.rendered&&ja.push(a)});Y.sortTiles(this.renderOrder,ja);return ja.toArray()};Object.defineProperty(f.prototype,
"test",{get:function(){var a=this;return{renderer:this._renderer,lercDecoder:this._lercDecoder,mergeTile:function(b){return a._mergeTile(b)},updateTiles:function(b){return a._updateTiles(b)},getTiles:function(){return a._allTiles.toArray()}}},enumerable:!1,configurable:!0});d.__decorate([r.property()],f.prototype,"_renderer",void 0);d.__decorate([r.property()],f.prototype,"pendingUpdates",void 0);d.__decorate([r.property()],f.prototype,"_asyncWorkItems",void 0);d.__decorate([r.property()],f.prototype,
"_frameTask",void 0);d.__decorate([r.property({constructOnly:!0})],f.prototype,"view",void 0);d.__decorate([r.aliasOf("_renderer.cullBackFaces")],f.prototype,"cullBackFaces",void 0);d.__decorate([r.property({readOnly:!0})],f.prototype,"extent",null);d.__decorate([r.property({readOnly:!0,dependsOn:"ready suspended pendingUpdates _asyncWorkItems _renderer.updating _layerViewsDirty overlayManager.updating _frameTask.updating".split(" ")})],f.prototype,"updating",null);d.__decorate([r.property({aliasOf:"view.map.ground.opacity"})],
f.prototype,"baseOpacity",void 0);d.__decorate([r.property({readOnly:!0})],f.prototype,"overlayManager",void 0);d.__decorate([r.property({constructOnly:!0})],f.prototype,"manifold",void 0);d.__decorate([r.property()],f.prototype,"maxTextureScale",void 0);d.__decorate([r.property({readOnly:!0})],f.prototype,"ready",null);d.__decorate([r.property({value:1})],f.prototype,"renderOrder",null);d.__decorate([r.property({readOnly:!0})],f.prototype,"rootTiles",void 0);d.__decorate([r.property({readOnly:!0,
dependsOn:["tilingScheme.spatialReference"]})],f.prototype,"spatialReference",null);d.__decorate([r.property()],f.prototype,"backgroundImage",void 0);d.__decorate([r.property({type:l,aliasOf:"view.map.ground.surfaceColor"})],f.prototype,"backgroundColor",void 0);d.__decorate([r.property({dependsOn:["backgroundColor","backgroundImage"]})],f.prototype,"_background",null);d.__decorate([r.property({value:!1})],f.prototype,"slicePlaneEnabled",null);d.__decorate([r.property({readOnly:!0})],f.prototype,
"tilingScheme",void 0);d.__decorate([r.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],f.prototype,"tilingSchemeLocked",void 0);d.__decorate([r.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],f.prototype,"tilingSchemeDone",void 0);d.__decorate([r.property({readOnly:!0})],f.prototype,"tilingSchemeLogic",void 0);d.__decorate([r.property({value:!0})],f.prototype,"velvetOverground",null);d.__decorate([r.aliasOf("_renderer.wireframe")],f.prototype,"wireframe",
void 0);d.__decorate([r.property({value:!1})],f.prototype,"suspended",null);d.__decorate([r.property({readOnly:!0,dependsOn:["view.qualitySettings.tiledSurface.reduceTileLevelDifferences"]})],f.prototype,"lodSnapping",null);d.__decorate([r.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],f.prototype,"textureFadeDuration",void 0);d.__decorate([r.property()],f.prototype,"_layerViewsDirty",void 0);d.__decorate([r.aliasOf("_renderer.renderPatchBorders")],f.prototype,
"renderPatchBorders",void 0);d.__decorate([r.aliasOf("_renderer.renderingDisabled")],f.prototype,"renderingDisabled",void 0);return f=d.__decorate([r.subclass("esri.views.3d.terrain.TerrainSurface")],f)}(h.EventedMixin(k));var ha=-1,da=B.vec4f64.create(),fa=A.create(),ka=[0,0,0],ja=new p,pa={spatialReference:null,tile:null,extent:null,context:"ground"},na={spatialReference:null,extent:null,scale:0};return a})},"esri/views/2d/engine/vectorTiles/decluttering/jobsUtil":function(){define("require exports ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.declutterSingleTile=void 0;a.declutterSingleTile=function(a){var h=new c.TileForest,f=new e.SymbolRepository(4096,h,function(){var a=new d.VTLUniqueSymbol;a.show=!1;a.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1});a.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1});return a}),b=new k.SymbolDeclutterer(h,f,function(b,c,d){return new l.CollisionJob(b,c,d,a.styleLayers.layers,a.key.level,0)},function(a,
b){c.writeOpacityToBuffers(a,b,!1)});h.add(a);f.addTile(a);b.setScreenSize(512,512);b.continue(Infinity)}})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/mat3f32","./config","./util"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.CollisionJob=void 0;n=function(){function a(a,e,m,f,b,g){this._symbols=a;this._layers=f;this._zoom=b;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=
new Map;this._allNeededMatrices=new Map;this._gridIndex=new k.GridIndex(e,m,l.COLLISION_GRID_CELL_SIZE);this._si=Math.sin(Math.PI*g/180);this._co=Math.cos(Math.PI*g/180);for(e=0;e<a.length;e++)for(m=0,f=a[e].symbols;m<f.length;m++)b=f[m],this._allNeededMatrices.has(b.tile)||this._allNeededMatrices.set(b.tile,d.mat3f32.clone(b.tile.transforms.tileUnitsToPixels))}a.prototype.work=function(a){for(var c=this._gridIndex,d=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,
this._currentSymbolCursor=0)for(var e=this._symbols[this._currentLayerCursor],b=this._getProperties(e.layerIndex);this._currentSymbolCursor<e.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-d>a)return!1;var g=e.symbols[this._currentSymbolCursor];if(g.unique.show){for(var k=g,l=this._si,u=this._co,r=this._allNeededMatrices.get(g.tile),q=this._zoom,v=b.iconRotationAlignment,n=b.textRotationAlignment,z=b.iconTranslate,x=b.iconTranslateAnchor,B=b.textTranslate,
A=b.textTranslateAnchor,C=0,E=0,G=k.colliders;E<G.length;E++){var F=G[E],H=0===F.partIndex?z:B,J=H[0],H=H[1],I=0===F.partIndex?x:A,K=F.minLod<=q&&q<=F.maxLod,C=C+(K?0:1);F.enabled=K;F.xScreen=F.xTile*r[0]+F.yTile*r[3]+r[6];F.yScreen=F.xTile*r[1]+F.yTile*r[4]+r[7];0===I?(F.xScreen+=u*J-l*H,F.yScreen+=l*J+u*H):(F.xScreen+=J,F.yScreen+=H);1===(0===F.partIndex?v:n)?(F.dxScreen=F.dxPixels,F.dyScreen=F.dyPixels):(F.dxScreen=u*(F.dxPixels+F.width/2)-l*(F.dyPixels+F.height/2)-F.width/2,F.dyScreen=l*(F.dxPixels+
F.width/2)+u*(F.dyPixels+F.height/2)-F.height/2)}0<k.colliders.length&&C===k.colliders.length&&(k.unique.show=!1);k=g.unique;if(k.show){v=b.iconAllowOverlap;l=b.iconIgnorePlacement;n=b.textAllowOverlap;u=b.textIgnorePlacement;z=0;for(x=g.colliders;z<x.length;z++)if(r=x[z],r.enabled&&(q=k.parts[r.partIndex],q.show)){if(B=!(r.partIndex?n:v))a:{B=r.xScreen+r.dxScreen;A=r.yScreen+r.dyScreen;C=B+r.width;E=A+r.height;H=c.getCellSpan(B,A,C,E);G=H[0];F=H[2];J=H[3];for(H=H[1];H<=J;H++)for(I=G;I<=F;I++)for(var K=
0,L=c.cells[H][I];K<L.length;K++){var M=L[K],Q=M.xScreen+M.dxScreen,R=M.yScreen+M.dyScreen,O=Q+M.width,M=R+M.height;if(!(C<Q||B>O||E<R||A>M)){B=!0;break a}}B=!1}B&&(r.hard?k.show=!1:q.show=!1)}if(k.show)for(v=0,g=g.colliders;v<g.length;v++)if(r=g[v],r.enabled&&(r.partIndex?!u:!l)&&(q=k.parts[r.partIndex],q.show))for(q=r.xScreen+r.dxScreen,n=r.yScreen+r.dyScreen,x=this._gridIndex.getCellSpan(q,n,q+r.width,n+r.height),q=x[0],n=x[2],z=x[3],x=x[1];x<=z;x++)for(B=q;B<=n;B++)this._gridIndex.cells[x][B].push(r)}}}return!0};
a.prototype._getProperties=function(a){var c=this._styleProps.get(a);if(c)return c;var c=this._zoom,d=this._layers[a],e=1===d.getLayoutValue("symbol-placement",c),b=d.getLayoutValue("icon-rotation-alignment",c);2===b&&(b=e?0:1);var g=d.getLayoutValue("text-rotation-alignment",c);2===g&&(g=e?0:1);var e=d.getPaintValue("icon-translate",c),k=d.getPaintValue("icon-translate-anchor",c),l=d.getPaintValue("text-translate",c),u=d.getPaintValue("text-translate-anchor",c),c={iconAllowOverlap:d.getLayoutValue("icon-allow-overlap",
c),iconIgnorePlacement:d.getLayoutValue("icon-ignore-placement",c),textAllowOverlap:d.getLayoutValue("text-allow-overlap",c),textIgnorePlacement:d.getLayoutValue("text-ignore-placement",c),iconRotationAlignment:b,textRotationAlignment:g,iconTranslateAnchor:k,iconTranslate:e,textTranslateAnchor:u,textTranslate:l};this._styleProps.set(a,c);return c};return a}();a.CollisionJob=n})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["require","exports","./config"],function(n,
a,d){function l(a,d){return a.priority-d.priority}Object.defineProperty(a,"__esModule",{value:!0});a.SymbolDeclutterer=void 0;n=function(){function a(a,c,d,k){this._tileForest=a;this._symbolRepository=c;this._createCollisionJob=d;this._assignTileSymbolsOpacity=k;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}Object.defineProperty(a.prototype,"running",{get:function(){return this._running},
enumerable:!1,configurable:!0});a.prototype.setScreenSize=function(a,c){this._screenWidth===a&&this._screenHeight===c||this.restart();this._screenWidth=a;this._screenHeight=c};a.prototype.restart=function(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0};a.prototype.continue=function(a){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var c=
performance.now();if(!this._selectionJob.work(a))return!1;this._selectionJobCompleted=!0;a=Math.max(0,a-(performance.now()-c));if(0===a)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){c=performance.now();if(!this._collisionJob.work(a))return!1;this._collisionJobCompleted=!0;a=Math.max(0,a-(performance.now()-c));if(0===a)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());
if(!this._opacityJobCompleted){c=performance.now();if(!this._opacityJob.work(a))return!1;this._opacityJobCompleted=!0;a=Math.max(0,a-(performance.now()-c));if(0===a)return!1}this._running=!1;return!0};a.prototype._createSelectionJob=function(){var a=this._symbolRepository.uniqueSymbols,c=[],d=0,k=0,f,b,g,p=function(a){a.selectedForRendering=!1;if(!g||!b){var c=a.tile;if(a.unique.visible&&(!f||c.isCoverage||c.neededForCoverage&&!b)){f=a;if(c.neededForCoverage||c.isCoverage)g=!0;c.isCoverage&&(b=!0)}}};
return{work:function(e){for(var h,m=performance.now();k<a.length;k++,d=0){var q=a[k];c[k]=c[k]||{layerIndex:q.layerIndex,symbols:[]};for(var t=c[k];d<q.uniqueSymbols.length;d++){h=q.uniqueSymbols[d];if(99===d%100&&performance.now()-m>e)return!1;f=null;g=b=!1;h.tileSymbols.forEach(p);f.selectedForRendering=!0;if(g){t.symbols.push(f);h.show=!0;var n=0;for(h=h.parts;n<h.length;n++)h[n].show=!0}else h.show=!1}}for(e=0;e<c.length;e++)t=c[e],t.symbols.sort(l);return!0},get sortedSymbols(){return c.sort(function(a,
b){return b.layerIndex-a.layerIndex})}}};a.prototype._createOpacityJob=function(){function a(b,e){b.symbols.forEach(function(a){for(var b=0;b<a.length;b++)for(var c=a[b].unique,f=0,g=c.parts;f<g.length;f++){var h=g[f];h.startOpacity+=(e-h.startTime)/d.FADE_DURATION*(.5<h.targetOpacity?1:-1);h.startOpacity=Math.min(Math.max(h.startOpacity,0),1);h.startTime=e;h.targetOpacity=c.show&&h.show?1:0}});c(b,e);var f=0;for(b=h.getChildren(b);f<b.length;f++)a(b[f],e)}var c=this._assignTileSymbolsOpacity,h=this._tileForest,
k=h.getRoots(),f=0;return{work:function(b){for(var c=performance.now();f<k.length;f++){if(performance.now()-c>b)return!1;var d=k[f],e=performance.now();a(d,e)}return!0}}};return a}();a.SymbolDeclutterer=n})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["require","exports","../../../../../core/maybe","./util"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.SymbolRepository=void 0;n=function(){function a(a,c,d){this.tileCoordRange=a;this._tileForest=
c;this._createUnique=d;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}Object.defineProperty(a.prototype,"uniqueSymbols",{get:function(){d.isNone(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray},enumerable:!1,configurable:!0});a.prototype.addTile=function(a,c){var d=this;void 0===c&&(c=!0);this._uniqueSymbolLayerArray=null;c?(c={flatLatestSymbols:null,indexedLatestSymbols:null},this._tiles.set(a,c)):(c=
this._tiles.get(a),this._removeSymbols(c.flatLatestSymbols));var e=a.symbols;e.forEach(function(b){for(var c=0;c<b.length;c++)b[c].tile=a});var f=new Map;e.forEach(function(a,c){var b=a.length;if(32<=b){var e=d.tileCoordRange;do e/=2,b/=4;while(8<b&&64<e);b=new l.GridIndex(d.tileCoordRange,d.tileCoordRange,e);f.set(c,b);for(c=0;c<a.length;c++)e=a[c],b.getCell(e.xTile,e.yTile).push(e)}});c.flatLatestSymbols=e;c.indexedLatestSymbols=f;this._addSymbols(a.key,e)};a.prototype.removeTile=function(a){this._uniqueSymbolLayerArray=
null;this._removeSymbols(a.symbols);this._tiles.delete(a)};a.prototype._removeSymbols=function(a){var c=this;a.forEach(function(a,d){for(var e=0;e<a.length;e++){for(var b=a[e],g=b.unique,h=g.tileSymbols,k=h.length-1,m=0;m<k;m++)if(h[m]===b){h[m]=h[k];break}h.length=k;0===k&&(h=c._uniqueSymbolsReferences.get(d),h.delete(g),0===h.size&&c._uniqueSymbolsReferences.delete(d));b.unique=null;b.tile=null}})};a.prototype._addSymbols=function(a,c){var e=this;if(0!==c.size){for(var k=0,f=this._tileForest.getRoots();k<
f.length;k++){var b=f[k];b.key.world===a.world&&(b.key.level!==a.level||b.key.equals(a))&&this._matchSymbols(b,a,c)}c.forEach(function(a,b){for(var c=0;c<a.length;c++){var f=a[c];if(d.isNone(f.unique)){var g=e._createUnique();f.unique=g;g.tileSymbols.push(f);f=e._uniqueSymbolsReferences.get(b);f||(f=new Set,e._uniqueSymbolsReferences.set(b,f));f.add(g)}}})}};a.prototype._matchSymbols=function(a,c,d){var e=this;if(a.key.level>c.level){var f=a.key.level-c.level;if(a.key.row>>f!==c.row||a.key.col>>f!==
c.col)return}if(c.level>a.key.level&&(f=c.level-a.key.level,c.row>>f!==a.key.row||c.col>>f!==a.key.col))return;if(c.equals(a.key))for(var b=0,g=this._tileForest.getChildren(a);b<g.length;b++)f=g[b],this._matchSymbols(f,c,d);else{var h=new Map;d.forEach(function(b,d){for(var f=[],g=0;g<b.length;g++){var k=b[g],m=l.tileCoordChange(e.tileCoordRange,k.xTile,c.level,c.col,a.key.level,a.key.col),p=l.tileCoordChange(e.tileCoordRange,k.yTile,c.level,c.row,a.key.level,a.key.row);0<=m&&m<e.tileCoordRange&&
0<=p&&p<e.tileCoordRange&&f.push({symbol:k,xTransformed:m,yTransformed:p})}b=[];g=a.key.level<c.level?1:1<<a.key.level-c.level;k=e._tiles.get(a);if(m=k.flatLatestSymbols.get(d))for(var p=k.indexedLatestSymbols.get(d),t=0;t<f.length;t++){for(var k=f[t],u=!1,n=void 0,C=k.xTransformed,E=k.yTransformed,n=p?p.getCell(C,E):m,k=k.symbol,G=k.hash,F=0;F<n.length;F++){var H=n[F];if(G===H.hash&&Math.abs(C-H.xTile)<=g&&Math.abs(E-H.yTile)<=g){u=H.unique;k.unique=u;u.tileSymbols.push(k);u=!0;break}}u||b.push(k)}0<
b.length&&h.set(d,b)});d=0;for(b=this._tileForest.getChildren(a);d<b.length;d++)f=b[d],this._matchSymbols(f,c,h)}};a.prototype._createUniqueSymbolLayerArray=function(){var a=Array(this._uniqueSymbolsReferences.size),c=0;this._uniqueSymbolsReferences.forEach(function(d,e){var f=[];d.forEach(function(a){f.push(a)});a[c]={layerIndex:e,uniqueSymbols:f};c++});return a};return a}();a.SymbolRepository=n})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports tslib ../../../core/Error ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./LayerView3D ./TiledLayerView3D ./support/tiledLayerUtils ../../layers/LayerView".split(" "),
function(n,a,d,l,k,e,c,h,m,f){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype.initialize=function(){var a=this.get("view.map.allLayers"),a=a&&a.includes(this.layer),b=this.get("view.map.ground.layers"),b=b&&b.includes(this.layer);a&&!b&&(a=new l("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(k.reject(a)));this._addTilingSchemeMatchPromise();this.addResolvingPromise(m.checkArcGISServiceVersionCompatibility(this.layer))};
d.__decorate([e.property({readOnly:!0,aliasOf:"layer.fullExtent"})],b.prototype,"fullExtent",void 0);d.__decorate([e.property()],b.prototype,"layer",void 0);d.__decorate([e.property({readOnly:!0,aliasOf:"layer.tileInfo"})],b.prototype,"tileInfo",void 0);return b=d.__decorate([e.subclass("esri.views.3d.layers.ElevationLayerView3D")],b)}(h.TiledLayerView3D(c.LayerView3D(f)))})},"esri/views/3d/layers/LayerView3D":function(){define("require exports tslib ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/heightModelInfoUtils".split(" "),
function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.LayerView3D=void 0;a.LayerView3D=function(a){return function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.slicePlaneEnabled=!1;c.supportsHeightUnitConversion=!1;return c}d.__extends(c,a);c.prototype.postscript=function(c){a.prototype.postscript.call(this,c);e.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};c.prototype._validateHeightModelInfo=function(){return d.__awaiter(this,
void 0,void 0,function(){var a,b;return d.__generator(this,function(c){switch(c.label){case 0:return a=l.whenFalseOnce(this.view.defaultsFromMap,"isHeightModelInfoSearching"),this.handles.add(a),[4,a];case 1:c.sent();if(b=e.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw b;return[2]}})})};d.__decorate([k.property()],c.prototype,"view",void 0);d.__decorate([k.property()],c.prototype,"slicePlaneEnabled",void 0);return c=d.__decorate([k.subclass("esri.views.3d.layers.LayerView3D")],
c)}(a)}})},"esri/views/3d/layers/TiledLayerView3D":function(){define("require exports tslib ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./support/layerViewUpdatingProperties ../terrain/terrainUtils".split(" "),function(n,a,d,l,k,e,c,h,m){Object.defineProperty(a,"__esModule",{value:!0});a.TiledLayerView3D=void 0;a.TiledLayerView3D=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,
a);Object.defineProperty(b.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"isOpaque",{get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"dataLevelRange",{get:function(){var a=this.tileInfo.lods;return this.levelRangeFromScaleRange(a[0].scale,a[a.length-1].scale)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"displayLevelRange",
{get:function(){var a=this.tileInfo.lods,a=this.levelRangeFromScaleRange(this.layer.minScale||a[0].scale,this.layer.maxScale||a[a.length-1].scale);this.layer.maxScale&&a.maxLevel++;return a},enumerable:!1,configurable:!0});b.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,c)};b.prototype._addTilingSchemeMatchPromise=function(){var a=this,b=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);b?this.addResolvingPromise(k.reject(b)):(b=e.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){var b=
a._getTileInfoCompatibilityError(a.tileInfo,a.view.basemapTerrain.tilingScheme);if(b)throw b;}),this.addResolvingPromise(b))};b.prototype._getTileInfoSupportError=function(a,b){if(a=m.checkIfTileInfoSupportedForView(a,b,this.view.spatialReference,this.view.basemapTerrain.manifold)){b={layer:this.layer,error:a};var c=void 0;switch(a.name){case "tilingscheme:local-gcs-not-supported":c=new l("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",b);break;
case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":c=new l("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",b);break;default:c=new l("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",b)}return c}return null};b.prototype._getTileInfoCompatibilityError=function(a,b){return b.compatibleWith(a)?null:new l("layerview:tiling-scheme-incompatible",
"The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};b.prototype.levelRangeFromScaleRange=function(a,b){var c={minLevel:0,maxLevel:Infinity},d=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!d)return c;var e=d.levels[0],d=function(a){a=Math.log(e.scale/a)/Math.LN2;return 1E-9>.5-Math.abs(.5-a%1)?Math.round(a):Math.ceil(a)};null!=a&&0<a&&(c.minLevel=Math.max(0,d(a)));null!=b&&0<b&&(c.maxLevel=Math.max(0,d(b)));return c};b.prototype.isUpdating=
function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};d.__decorate([c.property({readOnly:!0})],b.prototype,"imageFormatIsOpaque",null);d.__decorate([c.property({readOnly:!0,dependsOn:["view.basemapTerrain.updating"]})],b.prototype,"updating",void 0);d.__decorate([c.property(h.updatingProgress)],b.prototype,"updatingProgress",void 0);d.__decorate([c.property(h.updatingProgressValue)],b.prototype,"updatingProgressValue",void 0);d.__decorate([c.property({readOnly:!0})],
b.prototype,"fullExtent",void 0);d.__decorate([c.property({readOnly:!0,dependsOn:["fullOpacity","imageFormatIsOpaque"]})],b.prototype,"isOpaque",null);d.__decorate([c.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme"]})],b.prototype,"dataLevelRange",null);d.__decorate([c.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme","layer.minScale","layer.maxScale"]})],b.prototype,"displayLevelRange",null);d.__decorate([c.property()],b.prototype,"layer",
void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"tileInfo",void 0);return b=d.__decorate([c.subclass("esri.views.3d.layers.TiledLayerView3D")],b)}(a)}})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.updatingProgress=a.updatingProgressValue=void 0;a.updatingProgressValue={value:.5,readOnly:!0};a.updatingProgress={dependsOn:["updating","updatingProgressValue"],readOnly:!0,
value:.5,get:function(){return this.updating?this.updatingProgressValue:1}}})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.checkArcGISServiceVersionCompatibility=void 0;var c=l.getLogger("esri.views.3d.layers.support.tiledLayerUtils");a.checkArcGISServiceVersionCompatibility=
function(a){if(!e.isHostedAgolService(a.url)){if(10.22>a.version)return a=new d("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+a.version,{minVersion:10.22,detectedVersion:a.version}),k.reject(a);10.22!==a.version||e.isHostedSecuredProxyService(a.url,a.get("portalItem.id"))||c.warnOnce("ArcGIS server version 10.2.2 needs the following patch installed in order for map layers to work properly: https://support.esri.com/en/download/2146");
return k.resolve()}}})},"esri/views/3d/terrain/ElevationBounds":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.ElevationBounds=void 0;n=function(){function a(a,d){void 0===a&&(a=0);void 0===d&&(d=0);this.min=a;this.max=d;this.level=0;this.hasNoDataValues=!1}a.prototype.copyFrom=function(a){this.min=a.min;this.max=a.max;this.level=a.level;this.hasNoDataValues=a.hasNoDataValues};return a}();a.ElevationBounds=n})},"esri/views/3d/terrain/ElevationData":function(){define(["require",
"exports","../../../core/mathUtils","../support/mathUtils","./TerrainConst"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.ElevationData=void 0;n=function(){function a(a,d,e){this.samplerData=null;this.level=a[0];this.i=a[1];this.j=a[2];this.extent=d;a=e.noDataValue;for(var c=e.values,b=Infinity,g=-Infinity,h=!0,k=!1,m=0;m<c.length;m++){var l=c[m];l!==a?(b=l<b?l:b,g=l>g?l:g,h=!1):k=!0}h&&(g=b=0);this.samplerData={pixelData:e.values,width:e.width,height:e.height,noDataValue:a,
safeWidth:.99999999*(e.width-1),dx:(e.width-1)/(d[2]-d[0]),dy:(e.width-1)/(d[3]-d[1]),x0:d[0],y1:d[3]};this.bounds=[b,-3E38<g?g:0];this.hasNoDataValues=k}a.prototype.release=function(){this.bounds=this.samplerData=null};a.prototype.computeMinMaxValue=function(a,d,e,f){f.min=Infinity;f.max=-Infinity;f.hasNoDataValues=!1;a-=this.level;if(0>=a)return f;var b=Math.pow(2,a);if(Math.floor(d/b)!==this.i||Math.floor(e/b)!==this.j)return f;var c=Infinity,h=-Infinity,m=this.samplerData.width,u=this.samplerData.pixelData,
r=.5*k.ELEVATION_NODATA_VALUE;a=(m-1)/b;e=(e-this.j*b)*a;var q=(d-this.i*b)*a;if(1>a){var n=Math.floor(e),w=Math.floor(q),z=n+w*m;d=u[z];var b=u[z+1],x=u[z+m],z=u[z+m+1];if(d+b+x+z<r)return c=e-n,r=q-w,h=l.bilerp(d,b,x,z,c,r),m=l.bilerp(d,b,x,z,c+a,r),u=l.bilerp(d,b,x,z,c,r+a),a=l.bilerp(d,b,x,z,c+a,r+a),f.min=Math.min(h,m,u,a),f.max=Math.max(h,m,u,a),f;e=n;q=w;a=1}else e=Math.floor(e),q=Math.floor(q),a=Math.ceil(a);for(d=e;d<=e+a;d++)for(b=q;b<=q+a;b++)z=d+b*m,x=u[z],x<r?(c=Math.min(c,x),h=Math.max(h,
x)):f.hasNoDataValues=!0;f.min=c;f.max=h;return f};a.sample=function(a,e,m){for(var c=0;c<m.length;c++){var b=m[c];if(b){var g=b.safeWidth,h=b.width,l=b.pixelData,u=d.clamp(b.dy*(b.y1-e),0,g),b=d.clamp(b.dx*(a-b.x0),0,g),g=Math.floor(u),r=Math.floor(b),q=g*h+r,n=q+h,w=l[q],h=l[n],q=l[q+1],l=l[n+1];if(w+h+q+l<.5*k.ELEVATION_NODATA_VALUE)return u-=g,b-=r,a=w+(q-w)*b,a+(h+(l-h)*b-a)*u}}return null};return a}();a.ElevationData=n})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/mathUtils ../../../core/maybe ../../../core/scheduling ../../../core/unitUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../../geometry/support/geodesicConstants ../../../layers/support/timeUtils ../state/utils/viewUtils ../support/animationUtils ../support/debugFlags ../support/debugUtils ../support/geometryUtils ../support/mathUtils ../support/projectionUtils ./Overlay ./OverlayRenderer ../webgl-engine/lib/Intersector ../webgl-engine/lib/localOrigin ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M){function Q(a,b){for(var c=A.TESTS_DISABLE_UPDATE_THRESHOLDS?0:1E-5*Math.max(a[2]-a[0],a[3]-a[1],b[2]-b[0],b[3]-b[1]),d=0;4>d;d++)if(Math.abs(b[d]-a[d])>c)return!0;return!1}Object.defineProperty(a,"__esModule",{value:!0});a.OverlayManager=void 0;var R=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],O;n=function(a){function l(){var b=null!==
a&&a.apply(this,arguments)||this;b._handles=new k;b._overlaySR=null;b._renderSR=null;b._overlaySREqualsRenderSR=!0;b._drapeSources=new Map;b._drapeTargets=new Set;b._overlays=null;b._drapeSourceTypes=[0,0];b._drapeTargetTypes=[0,0];b._renderedAltitude=0;b._placementDirty=!1;b._drawTexturesDirty=!1;b._drawTexturesAnimateDirty=!1;b._layerViewsDirty=!0;b._hasUnusedRenderTargets=!1;b._isSpherical=!1;b._longitudeCyclical=null;b._latestOriginId=0;b._maxResolution=e("esri-mobile")?2048:4096;b._animationTimeLast=
0;b._forceAnimation=!1;return b}d.__extends(l,a);Object.defineProperty(l.prototype,"updating",{get:function(){return this.needsUpdate()||this.renderer.updating},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"hasHighlights",{get:function(){return this.renderer.hasHighlights},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"rendersOccluded",{get:function(){return this.renderer.rendersOccluded},enumerable:!1,configurable:!0});l.prototype.initialize=function(){var a=
this;this._stage=this.view._stage;this.renderer=new J.OverlayRenderer({renderView:this._stage.renderView,globalUnitScale:this.view.state.isGlobal?b.getMetersPerUnitForSR(this._overlaySR):1});this._drapeTargetTypes[0]++;this.renderer.onHasHighlightsChanged=function(){a.setDrawTexturesDirty();a.notifyChange("hasHighlights")};this.renderer.onRendersOccludedChanged=function(){a.setDrawTexturesDirty();a.notifyChange("rendersOccluded")};this.renderer.onContentChanged=function(){a.setDrawTexturesDirty()};
this.groundIntersector=new I.Intersector(this.view.state.mode);this.groundIntersector.options.backfacesTerrain=!0;this.groundIntersector.options.invisibleTerrain=!0;this.groundIntersector.options.hud=!1;this._handles.add([this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],function(){return a.setOverlayPlacementDirty()}),this.terrainSurface.on("elevation-change",function(){return a.setOverlayPlacementDirty()}),this.view.allLayerViews.on("after-changes",
function(){return a._layerViewsDirty=!0}),this.view.on("resize",function(){return a.setOverlayPlacementDirty()}),f.addFrameTask({preRender:function(b){a.renderer.commitChanges();a._updateLayerViews();a.hasOverlays()&&(a._dispatchRendererUpdate(b),a._drawOverlayTextures());a._hasUnusedRenderTargets&&a._collectUnusedRenderTargetMemory()}}),this.view.resourceController.scheduler.registerTask(M.Task.OVERLAY_MANAGER,function(){return a.updateOverlays()},function(){return a.needsUpdate()}),this.view._stage.renderView.events.on("force-camera-for-screenshot",
function(b){a.updateOverlays(b);a._drawOverlayTextures()})]);this._updateLayerViews()};l.prototype.destroy=function(){var a=this;this._drapeSources.forEach(function(b,c){return a._unregisterDrapeSource(c)});this._drapeTargets.forEach(function(b,c){return a._unregisterDrapeTarget(c)});this._drapeTargetTypes[0]--;this._disposeOverlays();this.renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=null);m.isSome(O)&&(O.remove(),O=null)};l.prototype.hasOverlays=function(){return!!this._overlays};
l.prototype.setSpatialReference=function(a,c){this._overlaySR=a;this._longitudeCyclical=null;if(a){this._renderSR=this.view.renderSpatialReference;this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR);if(this._isSpherical=c)this._longitudeCyclical=a.isWebMercator?new G.Cyclical(-2.0037508342787E7,2.0037508342787E7):new G.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical;this.renderer&&(this.renderer.globalUnitScale=c?b.getMetersPerUnitForSR(this._overlaySR):
1)}else this._disposeOverlays();this.notifyChange("updating")};l.prototype.getGpuMemoryUsage=function(){return this._overlays[0].getGpuMemoryUsage()+this._overlays[1].getGpuMemoryUsage()};l.prototype._updateLayerViews=function(){var a=this;if(this._layerViewsDirty){for(var b=new Set,c=0,d=this.view.allLayerViews.items;c<d.length;c++){var e=d[c];b.add(e.uid);"drapeSourceType"in e&&!this._drapeSources.has(e)&&this._registerDrapeSource(e);"drapeTargetType"in e&&!this._drapeTargets.has(e)&&this._registerDrapeTarget(e)}this._drapeSources.forEach(function(c,
d){b.has(d.uid)||a._unregisterDrapeSource(d)});this._drapeTargets.forEach(function(c){b.has(c.uid)||a._unregisterDrapeTarget(c)});this.renderer.updateLayerOrder();this.setDrawTexturesDirty();this._layerViewsDirty=!1}};l.prototype._registerDrapeSource=function(a){var b=this,c=a.on("draped-data-change",function(){return b.setOverlayContentDirty()});this._drapeSourceTypes[a.drapeSourceType]++;this._drapeSources.set(a,[c]);this._overlays&&a.setDrapingExtent&&this._overlays.forEach(function(c,d){return b._updateDrapeSource(a,
d,c)});this.setOverlayContentDirty()};l.prototype._updateDrapeSource=function(a,b,c){a.setDrapingExtent&&a.setDrapingExtent(b,c.extent,this._overlaySR,c.resolution,c.renderLocalOrigin,c.pixelRatio)};l.prototype._unregisterDrapeSource=function(a){if(this._drapeSources.has(a)){var b=this._drapeSources.get(a);b&&b.forEach(function(a){return a.remove()});this._drapeSourceTypes[a.drapeSourceType]--;this._drapeSources.delete(a);this.setOverlayContentDirty()}};l.prototype._registerDrapeTarget=function(a){this._drapeTargets.add(a);
this._updateDrapeTarget(a);this._drapeTargetTypes[a.drapeTargetType]++};l.prototype._updateDrapeTarget=function(a){var b=this;this._overlays&&this._overlays.forEach(function(c,d){var e=c.renderTargets,f=b.needsColorWithoutRasterImage()?e.colorWithoutRasterImage:b.hasDrapedFeatures()?e.color:null,g=e.highlight,e=e.water;a.setDrapingTextures(d,c.extent,f&&f.valid?f.fbo.getTexture():null,g.valid?g.fbo.getTexture():null,e.valid?e.fbo.getTexture():null)})};l.prototype._unregisterDrapeTarget=function(a){this._drapeTargets.delete(a);
this._drapeTargetTypes[a.drapeTargetType]--};l.prototype.setOverlayContentDirty=function(){this.setOverlayPlacementDirty();this.setDrawTexturesDirty()};l.prototype.setOverlayPlacementDirty=function(){this._placementDirty=!0;this.notifyChange("updating")};l.prototype.updateOverlays=function(a){void 0===a&&(a=this.view.state.camera);if(this._overlaySR){this._updateLayerViews();var b;b=c.nextHighestPowerOfTwo(Math.max(a.fullWidth,a.fullHeight)+256);var d=Math.min(b,this._maxResolution);this._computeOverlayExtents(a,
b,U);b=v.width(U.inner)/v.width(U.outer);this._overlays||(this._overlays=[new H.Overlay(this._stage.renderView.renderingContext,0),new H.Overlay(this._stage.renderView.renderingContext,1)]);a=this._updateOverlay(0,U.inner,d,1);d=this._updateOverlay(1,U.outer,d,b);if(a||d)this.terrainSurface.updateTileOverlayParams(),this.setDrawTexturesDirty();this._placementDirty=!1;this.terrainSurface.updateOverlayOpacity();this.notifyChange("updating")}};l.prototype._updateOverlay=function(a,b,c,d){var e=this,
f=this._overlays[a];if(!Q(b,f.extent)&&c===f.resolution&&f.pixelRatio===d)return!1;v.set(f.extent,b);f.resolution=c;f.pixelRatio=d;b=v.center(f.extent);f.renderLocalOrigin=K.fromValues(b[0],b[1],0,"OV_"+this._latestOriginId++);this._drapeSources.forEach(function(b,c){return e._updateDrapeSource(c,a,f)});return!0};l.prototype.needsUpdate=function(){return(this._placementDirty||this._layerViewsDirty)&&(0<this._drapeSources.size||0<this.view.graphics.length||A.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._overlaySR&&
!this._get("suspended")&&this.terrainSurface.ready};l.prototype.updateOpacity=function(a){return this._overlays?this._getAltitudeBasedOpacity(a,this._renderedAltitude):1};l.prototype._getAltitudeBasedOpacity=function(a,b){return 3.5*a<b?Math.sqrt(c.clamp((a-b/10)/(b/3.5-b/10),0,1)):1};l.prototype.setTileParameters=function(a,b,c){if(this._overlays){var d=this._overlays[0],e=this._overlays[1];a=v.intersection(a.extent,a.surface.extent,Z);this._rectInsideRect(a,d.extent)?(this._setTileOverlayData(a,
d,b.overlays[0]),b.overlays[1].overlay=null):this._rectanglesOverlap(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._setTileOverlayData(a,e,b.overlays[1])):(this._rectanglesOverlap(a,e.extent)?this._setTileOverlayData(a,e,b.overlays[0]):b.overlays[0].overlay=null,b.overlays[1].overlay=null)}else b.overlays[0].overlay=null,b.overlays[1].overlay=null;b.overlayOpacity=void 0!==c?c:1};l.prototype.overlayPixelSizeInMapUnits=function(a){if(!this._overlays)return 0;var b=this._overlays[0],
c=this._overlays[1];a=this._pointIsInExtent(a,b.extent)?b:c;return(a.extent[2]-a.extent[0])/a.resolution};l.prototype._setTileOverlayData=function(a,b,c){var d=b.extent;c.texScale[0]=(a[2]-a[0])/(d[2]-d[0]);c.texScale[1]=(a[3]-a[1])/(d[3]-d[1]);var e=a[0];if(this._longitudeCyclical){var e=this._longitudeCyclical.minimalMonotonic(d[0],e),f=this._longitudeCyclical.minimalMonotonic(d[0],a[2]);e>f&&(e=f-(a[2]-a[0]))}c.texOffset[0]=(e-d[0])/(d[2]-d[0]);c.texOffset[1]=(a[1]-d[1])/(d[3]-d[1]);c.overlay=
b};l.prototype._disposeOverlays=function(){this._overlays&&(this._overlays.forEach(function(a){return a.dispose()}),this._overlays=null)};l.prototype.hotReloadShaders=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(a){switch(a.label){case 0:return L.removeLoadedShaderModules(),[4,this.renderer.hotReloadShaders()];case 1:return a.sent(),this.updateOverlays(),this.needsUpdate(),[2]}})})};l.prototype.stopAnimationsAtTime=function(a){this.renderer.stopAnimationsAtTime(a);
this._forceAnimation=!0};l.prototype._dispatchRendererUpdate=function(a){var b=z.Milliseconds(a.time-this._animationTimeLast);b<B.DESIRED_DRAPED_ANIMATION_MS&&!this._forceAnimation||(this._animationTimeLast=a.time,this.renderer.updateLogic({dt:b,camera:this._stage.getCamera()})&&(this._drawTexturesAnimateDirty=!0))};l.prototype.setDrawTexturesDirty=function(){this._overlays?this._drawTexturesDirty=!0:this.setOverlayPlacementDirty()};l.prototype._intersectGroundFromView=function(a,b,c,d){c=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(a,
T,b,c);b=c.origin;c=t.vec3.add(P,c.origin,c.direction);this.groundIntersector.reset(b,c);this.groundIntersector.intersect([],null,a);this.view.basemapTerrain.intersect(this.groundIntersector,null,b,c);return this.groundIntersector.results.min.getIntersectionPoint(d)};l.prototype._findHorizonBasedPointOfInterest=function(a,b,d){var e=.5,f=this.view.renderCoordsHelper.getAltitude(b),g=this.view.renderCoordsHelper.getAltitude(a.eye),h=g>f;"global"===this.view.viewingMode?(e=u.vec3f64.clone(a.eye),t.vec3.normalize(e,
e),t.vec3.negate(e,e),f=c.asinClamped((w.earthRadius+f)/(w.earthRadius+f+Math.abs(g-f))),g=c.acosClamped(Math.abs(t.vec3.dot(a.viewForward,e))),e=c.clamp((f-(g-.5*a.fovY))/a.fovY,0,1),f=c.clamp((-f-(g-.5*a.fovY))/a.fovY,0,1),e=1===e&&0===f?.5:f+.55*(e-f),h||(e=1-e)):(e=q.vec4f64.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0),e=r.vec4.transformMat4(e,e,a.projectionMatrix)[1],e=c.clamp(.5+.5*e,0,1),e=1===e||0===e?.5:h?.55*e:1-.55*(1-e));return this._intersectGroundFromView(a,.5,
e,d)?t.vec3.sqrDist(d,a.eye)<t.vec3.sqrDist(b,a.eye):!1};l.prototype._computeOverlayExtents=function(a,b,c){var d=this.terrainSurface.extent,e=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,f=u.vec3f64.create();this._findHorizonBasedPointOfInterest(a,e,f)||t.vec3.copy(f,e);this._renderedAltitude=this.view.renderCoordsHelper.getAltitude(a.eye);var g=t.vec3.distance(a.eye,f),e=x.viewAngle(this.view.renderCoordsHelper,e,a.eye),e=Math.PI/2-Math.abs(e-Math.PI/2);A.OVERLAY_SHOW_CENTER?
(m.isNone(O)&&(O=new C.GraphicsHandle(this.view.graphics,"red")),O.showPoint(f,this._renderSR)):m.isSome(O)&&O.remove();this._overlaySREqualsRenderSR||F.vectorToVector(f,this._renderSR,f,this._overlaySR);var g=b*a.perRenderPixelRatio*g/2,k=!1,l=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(g/=Math.cos(F.webMercator.y2lat(f[1])),l=this.terrainSurface.extent[3]):(k=!0,g/=w.metersPerDegree,l=90),g>=l&&(g=l,f[1]=0,this._overlaySR.isWebMercator&&(f[0]=0)));var q=1;k&&(q=1/Math.max(.2,Math.cos(Math.abs(h.deg2rad(f[1])))),
180<g*q&&(q=180/g));var k=Math.log(2)/12,g=Math.exp(Math.round(Math.log(g)/k)*k),k=g*q,n=.5*b/(32*k);b=.5*b/(32*g);f[0]=Math.round(f[0]*n)/n;f[1]=Math.round(f[1]*b)/b;b=c.inner;b[0]=f[0]-k;b[1]=f[1]-g;b[2]=f[0]+k;b[3]=f[1]+g;this._isSpherical&&this._shiftExtentToFitBounds(b,Infinity,l);c=c.outer;v.set(c,b);6*k>d[2]-d[0]?v.set(c,d):e<=.25*Math.PI?(c[0]-=k,c[1]-=g,c[2]+=k,c[3]+=g):(F.vectorToVector(a.eye,this._renderSR,P,this._overlaySR),p.vec2.subtract(S,f,P),a=-Math.atan2(S[1],S[0])+.125*Math.PI,
0>a&&(a+=2*Math.PI),r.vec4.scale(S,R[Math.floor(a/(.25*Math.PI))],2*g),S[0]*=q,S[2]*=q,r.vec4.add(c,c,S));this._isSpherical&&(c[0]=this._longitudeCyclical.clamp(c[0]),c[2]=this._longitudeCyclical.clamp(c[2]),c[1]=Math.max(c[1],-l),c[3]=Math.min(c[3],l));!this._isSpherical&&d&&(a=v.intersection(b,d,Z),d=v.intersection(c,d,V),v.contains(a,d)&&(c[2]=c[0],c[3]=c[1]))};l.prototype._drawOverlayTextures=function(){var a=this;if(this._drawTexturesDirty||this._drawTexturesAnimateDirty){var b=this._drawOverlay(0),
c=this._drawOverlay(1);0!==b&&0!==c||this.terrainSurface.updateTileOverlayParams();this._collectUnusedRenderTargetMemory();this._drapeTargets.forEach(function(b){return a._updateDrapeTarget(b)});this._drawTexturesDirty?(this._drawTexturesAnimateDirty=this._drawTexturesDirty=!1,this.terrainSurface.requestRender(),this.terrainSurface.pendingUpdates=!0):(this._drawTexturesAnimateDirty=!1,this.terrainSurface.requestRender(0))}};l.prototype._setupGeometryViewsCyclical=function(a,b,c){this._setupGeometryViewsDirect(a,
b,c);var d=.001*this._longitudeCyclical.range;if(b[0]-d<=this._longitudeCyclical.min){var e=a.views[a.numViews++];r.vec4.set(e.viewport,0,0,c,c);v.offset(b,this._longitudeCyclical.range,0,e.extent)}b[2]+d>=this._longitudeCyclical.max&&(e=a.views[a.numViews++],r.vec4.set(e.viewport,0,0,c,c),v.offset(b,-this._longitudeCyclical.range,0,e.extent))};l.prototype._setupGeometryViewsDirect=function(a,b,c){a.numViews=1;a=a.views[0];v.set(a.extent,b);r.vec4.set(a.viewport,0,0,c,c)};l.prototype._drawOverlay=
function(a){var b=this._overlays[a],c=b.computeRenderTargetValidityBitfield(),d=b.extent,e=b.resolution,f=b.pixelRatio;this._longitudeCyclical?this._setupGeometryViewsCyclical(N,d,e):this._setupGeometryViewsDirect(N,d,e);N.width=e;N.height=e;N.pixelRatio=f*this.view.state.camera.pixelRatio;N.index=a;b.drawRenderTargets(this.renderer,N,this.needsColorWithoutRasterImage());a=b.computeRenderTargetValidityBitfield();return c^a?0:1};l.prototype.needsColorWithoutRasterImage=function(){return 0<this._drapeSourceTypes[0]&&
0<this._drapeSourceTypes[1]&&0<this._drapeTargetTypes[1]};l.prototype.hasDrapedFeatures=function(){return 0<this._drapeSourceTypes[1]};l.prototype._collectUnusedRenderTargetMemory=function(){var a=performance.now();this._hasUnusedRenderTargets=!1;for(var b=0,c=this._overlays;b<c.length;b++)this._hasUnusedRenderTargets=c[b].collectUnusedMemory(a)||this._hasUnusedRenderTargets};l.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||
this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):v.intersects(a,b)};l.prototype._rectInsideRect=function(a,b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:v.contains(b,a)};l.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];
var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};l.prototype._shiftExtentToFitBounds=function(a,b,c){var d=0,e=0;a[0]<-b?d=a[0]+b:a[2]>b&&(d=b-a[2]);a[1]<-c?e=a[1]+c:a[3]>c&&(e=c-a[3]);v.offset(a,d,e)};Object.defineProperty(l.prototype,"test",{get:function(){return{overlays:this._overlays,renderer:this.renderer}},enumerable:!1,configurable:!0});d.__decorate([g.property()],l.prototype,"renderer",void 0);d.__decorate([g.property()],l.prototype,"view",void 0);d.__decorate([g.property()],l.prototype,
"terrainSurface",void 0);d.__decorate([g.property({readOnly:!0,aliasOf:"terrainSurface.suspended"})],l.prototype,"suspended",void 0);d.__decorate([g.property({readOnly:!0,dependsOn:["terrainSurface.ready","suspended","renderer.updating"]})],l.prototype,"updating",null);d.__decorate([g.property({type:Boolean})],l.prototype,"hasHighlights",null);d.__decorate([g.property({type:Boolean})],l.prototype,"rendersOccluded",null);return l=d.__decorate([g.subclass("esri.views.3d.terrain.OverlayManager")],l)}(l);
a.OverlayManager=n;var N={width:0,height:0,pixelRatio:0,views:[{viewport:v.create(),extent:v.create()},{viewport:v.create(),extent:v.create()},{viewport:v.create(),extent:v.create()}],numViews:0,index:0},S=q.vec4f64.create(),P=u.vec3f64.create(),U={inner:v.create(),outer:v.create()},Z=v.create(),V=v.create(),T=E.ray.create()})},"esri/views/3d/support/animationUtils":function(){define(["require","exports","../../../layers/support/timeUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});
a.DESIRED_DRAPED_ANIMATION_MS=a.DESIRED_DRAPED_ANIMATION_FPS=a.DESIRED_ANIMATION_MS=a.DESIRED_ANIMATION_FPS=void 0;a.DESIRED_ANIMATION_FPS=25;a.DESIRED_ANIMATION_MS=d.Milliseconds(1E3/a.DESIRED_ANIMATION_FPS);a.DESIRED_DRAPED_ANIMATION_FPS=20;a.DESIRED_DRAPED_ANIMATION_MS=d.Milliseconds(1E3/a.DESIRED_DRAPED_ANIMATION_FPS)})},"esri/views/3d/terrain/Overlay":function(){define(["require","exports","../../../geometry/support/aaBoundingRect","./OverlayRenderTarget","../webgl-engine/lib/localOrigin"],function(n,
a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.Overlay=void 0;n=function(){function a(a,c){this.extent=d.create();this.resolution=0;this.renderLocalOrigin=k.fromValues(0,0,0,"O");this.pixelRatio=1;this.renderTargets={color:{fbo:new l.OverlayRenderTarget(a,"overlay",c,!0),valid:!1,lastUsed:Infinity},colorWithoutRasterImage:{fbo:new l.OverlayRenderTarget(a,"overlayWithoutRasterImage",c,!0),valid:!1,lastUsed:Infinity},highlight:{fbo:new l.OverlayRenderTarget(a,"overlayHighlight",c,!1),valid:!1,
lastUsed:Infinity},water:{fbo:new l.OverlayRenderTarget(a,"overlayWaterMask",c,!0),valid:!1,lastUsed:Infinity},occluded:{fbo:new l.OverlayRenderTarget(a,"overlayOccluded",c,!0),valid:!1,lastUsed:Infinity}}}a.prototype.dispose=function(){this.renderTargets.color.fbo.dispose();this.renderTargets.colorWithoutRasterImage.fbo.dispose();this.renderTargets.highlight.fbo.dispose();this.renderTargets.water.fbo.dispose();this.renderTargets.occluded.fbo.dispose()};a.prototype.drawRenderTargets=function(a,c,
d){var b=this.renderTargets;b.color.valid=a.drawPass(0,b.color.fbo,c);b.highlight.valid=a.drawPass(4,b.highlight.fbo,c);b.water.valid=a.drawPass(2,b.water.fbo,c);b.occluded.valid=a.drawPass(0,b.occluded.fbo,c,1);b.colorWithoutRasterImage.valid=d&&a.drawPass(0,b.colorWithoutRasterImage.fbo,c,2)};a.prototype.computeRenderTargetValidityBitfield=function(){var a=this.renderTargets;return+a.color.valid|+a.colorWithoutRasterImage.valid<<1|+a.highlight.valid<<2|+a.water.valid<<3|+a.occluded.valid<<4};a.prototype.validateUsage=
function(a,c){if(a.valid)a.lastUsed=c;else if(c-a.lastUsed>e)a.fbo.disposeRenderTargetMemory(),a.lastUsed=Infinity;else if(Infinity>a.lastUsed)return!0;return!1};a.prototype.collectUnusedMemory=function(a){var c=!1,c=this.validateUsage(this.renderTargets.color,a)||c,c=this.validateUsage(this.renderTargets.colorWithoutRasterImage,a)||c,c=this.validateUsage(this.renderTargets.highlight,a)||c,c=this.validateUsage(this.renderTargets.occluded,a)||c;return c=this.validateUsage(this.renderTargets.water,
a)||c};a.prototype.getGpuMemoryUsage=function(){return this.renderTargets.color.fbo.getGpuMemoryUsage()+this.renderTargets.colorWithoutRasterImage.fbo.getGpuMemoryUsage()+this.renderTargets.highlight.fbo.getGpuMemoryUsage()+this.renderTargets.water.fbo.getGpuMemoryUsage()+this.renderTargets.occluded.fbo.getGpuMemoryUsage()};return a}();a.Overlay=n;var e=1E3})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["require","exports","../../../../core/global"],function(n,a,d){Object.defineProperty(a,
"__esModule",{value:!0});a.removeLoadedShaderModules=void 0;a.removeLoadedShaderModules=function(){var a,k=null===(a=d.require)||void 0===a?void 0:a.modules;if(k){a=0;for(var e=Object.keys(k);a<e.length;a++){var c=e[a];-1!==c.search(".glsl")&&delete k[c]}}}})},"esri/views/3d/terrain/PlanarPatch":function(){define("require exports tslib ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ../support/geometryUtils ./PatchGeometryFactory ./Tile".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,
"__esModule",{value:!0});a.PlanarPatch=void 0;n=function(a){function f(b,c,d){var e=a.call(this,f.NumSubdivisionsAtLevel)||this;void 0!==b&&e.init(b,c,d);return e}d.__extends(f,a);f.prototype.init=function(b,c,d){a.prototype.init.call(this,b,c,d);this._edgeLen=this.extent[2]-this.extent[0];this._edgeLen2=this._edgeLen*this._edgeLen;this.centerAtSeaLevel[0]=l.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=l.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};
f.prototype.updateRadiusAndCenter=function(){this._updateCenter();var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,c=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._radius=Math.sqrt(a*a+c*c)};f.prototype._isVisible=function(){return this.intersectsClippingArea&&e.frustum.intersectsAABB(this.surface.frustum.planes,k.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))};f.prototype.createGeometry=function(a,d){c.createPlanarGlobePatch(a,
this.extent,d,this.renderData);this.setMemoryDirty()};f.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];return f}(h.Tile);a.PlanarPatch=n})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/geodesicConstants ../support/buffer/BufferPool ../support/buffer/InterleavedLayout ./ElevationData ./TerrainConst ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){function q(a,b,c,d){var e=0<(c&2),f=b+(d?1024:0)+(e?2048:0),g=C.get(f);if(!g){var g=b-1,h=b-1,k=b*b,m=2*g+2*h,l=g*h*6,p=6*m,r=6*(2*g+h-1);d&&(l*=2,p*=2,r*=2);for(var m=65536<k+m?new Uint32Array(l+p):new Uint16Array(l+p),q=0,t=0,u=l,n,v,w,x,B=0,I=0;I<=h;I++){e&&(B=0===I?r:I===h?-r:0);for(var u=u+B,H=0;H<=g;H++)w=z(H,I,g,h),-1<w&&(x=0===I&&H!==g?1:H===g&&I!==h?g+1:I===h&&0!==H?-1:0===H&&0!==I?-(g+1):0,0!==x&&(n=q,v=k+w,w=k+(0===H&&1===I?0:w+1),x=q+x,d?(m[u+
0]=n,m[u+1]=v,m[u+2]=v,m[u+3]=w,m[u+4]=w,m[u+5]=n,m[u+6]=w,m[u+7]=x,m[u+8]=x,m[u+9]=n,m[u+10]=n,m[u+11]=w,u+=12):(m[u+0]=n,m[u+1]=v,m[u+2]=w,m[u+3]=w,m[u+4]=x,m[u+5]=n,u+=6))),++q,H<g&&I<h&&(n=I*(g+1)+H,v=n+1,w=v+(g+1),x=w-1,d?(m[t+0]=n,m[t+1]=v,m[t+2]=v,m[t+3]=w,m[t+4]=w,m[t+5]=n,m[t+6]=w,m[t+7]=x,m[t+8]=x,m[t+9]=n,m[t+10]=n,m[t+11]=w,t+=12):(m[t+0]=n,m[t+1]=v,m[t+2]=w,m[t+3]=w,m[t+4]=x,m[t+5]=n,t+=6));u-=B}g=new A(m,l,p);C.set(f,g)}a.indices=g.values;a.numSurfaceIndices=g.numSurfaceIndices;a.numSkirtIndices=
g.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function v(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&(d[3]=a);b<d[1]&&(d[1]=b);b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function w(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function z(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(a,"__esModule",{value:!0});a.intersectSkirts=a.createPlanarGlobePatch=a.createSphericalGlobePatch=a.releaseGeometry=a.clearCaches=
a.PatchGeometry=void 0;var x=g.newLayout().vec3f(u.VertexAttrConstants.POSITION).vec2f(u.VertexAttrConstants.UV0),B=new b.BufferPool(function(a){return x.createBuffer(a)},function(a){return a.count});n=function(){return function(){this.vertexAttributes=this.indices=null;this.boundingBox=m.empty();this.skirtLength=this.numVertsPerRow=this.numWithoutSkirtIndices=this.numSkirtIndices=this.numSurfaceIndices=0;this.uvOffsetAndScale=h.vec4f64.create()}}();a.PatchGeometry=n;var A=function(){return function(a,
b,c){this.values=a;this.numSurfaceIndices=b;this.numSkirtIndices=c}}();a.clearCaches=function(){B.clear();C.clear()};a.releaseGeometry=function(a){B.release(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};a.createSphericalGlobePatch=function(a,b,e,g,h,k,l){var r=h[0],u=h[1],n=h[2];h=h[3];var x=.1*f.earthRadius*(h-u),A=a.numVertsPerRow-1,C=a.numVertsPerRow-1,I=a.numVertsPerRow*a.numVertsPerRow,E=B.acquire(I+(2*A+2*C)),Q=E.position.typedBuffer,K=E.uv0.typedBuffer,L=g.geometryInfo.boundingBox;
m.empty(L);var S=b[2]-b[0],M=b[3]-b[1],R=n-r,n=e[0],N=e[1];e=e[2];for(var O=0;O<=A;O++){var pa=O/A,na=r+pa*R;G[O]=Math.sin(na);F[O]=Math.cos(na);H[O]=pa;J[O]=b[0]+pa*S}r=k&&!!(l&1);S=k&&!!(l&2);for(na=R=0;na<=C;na++){var va=na/C,O=d.lerp(u,h,va),za=Math.cos(O),ya=Math.sin(O),ua=void 0;k?(ua=f.halfEarthRadius*Math.log((1+ya)/(1-ya)),va=(ua-b[1])/M):ua=180*O/Math.PI;for(O=0;O<=A;O++){var pa=H[O],oa=G[O],ta=F[O],ma=f.earthRadius;a.samplerData&&(ma+=p.ElevationData.sample(J[O],ua,a.samplerData)||0);ta=
ta*za*ma-n;oa=oa*za*ma-N;ma=ya*ma-e;v(ta,oa,ma,L);var qa=t.GEOMETRY_VERTEX_STRIDE*R;Q[qa+0]=ta;Q[qa+1]=oa;Q[qa+2]=ma;K[qa+0]=pa;K[qa+1]=va;qa=z(O,na,A,C);if(-1<qa){var qa=t.GEOMETRY_VERTEX_STRIDE*(I+qa),aa=r&&0===na?-1:S&&na===C?1:0,ta=0===aa?ta:-n,oa=0===aa?oa:-N,ma=0===aa?ma:f.earthRadius*aa-e;Q[qa+0]=ta;Q[qa+1]=oa;Q[qa+2]=ma;K[qa+0]=0===aa?w(pa,va):pa;K[qa+1]=0===aa?x:va;0!==aa&&v(ta,oa,ma,L)}++R}}g.geometryInfo.numVertsPerRow=a.numVertsPerRow;g.geometryInfo.vertexAttributes=E;g.geometryInfo.skirtLength=
x;c.vec4.set(g.geometryInfo.uvOffsetAndScale,0,0,1,1);q(g.geometryInfo,a.numVertsPerRow,k?l:0,a.wireframe)};a.createPlanarGlobePatch=function(a,b,d,e){var f=b[0],g=b[1],h=b[2]-f,k=b[3]-g,l=a.clippingArea,r=l?Math.max(0,(l[0]-b[0])/h):0,u=l?Math.max(0,(l[1]-b[1])/k):0,n=l?Math.min(1,(l[2]-b[0])/h):1;b=l?Math.min(1,(l[3]-b[1])/k):1;var x=n>r?1/(n-r):1,A=b>u?1/(b-u):1,C=-r*x,I=-u*A,H=.1*h,F=a.numVertsPerRow-1,E=a.numVertsPerRow-1,G=a.numVertsPerRow*a.numVertsPerRow,Q=B.acquire(G+(2*F+2*E)),K=Q.position.typedBuffer,
J=Q.uv0.typedBuffer,L=e.geometryInfo.boundingBox;m.empty(L);for(var M=0,R=0;R<=E;R++){var za=R/E,ya=I+za*A,za=g+za*k;l&&(za<l[1]?(za=l[1],ya=0):za>l[3]&&(za=l[3],ya=1));for(var ua=0;ua<=F;ua++){var oa=ua/F,ta=C+oa*x,oa=f+oa*h;l&&(oa<l[0]?(oa=l[0],ta=0):oa>l[2]&&(oa=l[2],ta=1));var ma=a.samplerData?p.ElevationData.sample(oa,za,a.samplerData)||0:0,oa=oa-d[0],qa=za-d[1],ma=ma-d[2];v(oa,qa,ma,L);var aa=t.GEOMETRY_VERTEX_STRIDE*M;K[aa+0]=oa;K[aa+1]=qa;K[aa+2]=ma;J[aa+0]=ta;J[aa+1]=ya;aa=z(ua,R,F,F);-1<
aa&&(aa=t.GEOMETRY_VERTEX_STRIDE*(G+aa),K[aa+0]=oa,K[aa+1]=qa,K[aa+2]=ma,J[aa+0]=w(ta,ya),J[aa+1]=H);++M}}e.geometryInfo.numVertsPerRow=a.numVertsPerRow;e.geometryInfo.vertexAttributes=Q;e.geometryInfo.skirtLength=H;c.vec4.set(e.geometryInfo.uvOffsetAndScale,r,u,n-r,b-u);q(e.geometryInfo,a.numVertsPerRow,0,a.wireframe)};var C=new Map,E=Math.pow(2,-52);a.intersectSkirts=function(a,b,c,d,e,f,g,h,m){var p,q,t,u=f.position;f=f.uv0;var n=a[0],v=a[1];a=a[2];var w=b[0]-n,x=b[1]-v;b=b[2]-a;d*=3;for(c*=3;c<
d;c+=3){var z=e[c],B=e[c+1],A=e[c+2],C=u.get(z,0),H=u.get(z,1);p=u.get(z,2);var F=u.get(B,0),G=u.get(B,1);q=u.get(B,2);var Q=u.get(A,0),J=u.get(A,1);t=u.get(A,2);z=f.get(z,0);B=f.get(B,0);A=f.get(A,0);2<=z&&(k.vec3.set(I,C,H,p),g(I),C+=I[0],H+=I[1],p+=I[2]);2<=B&&(k.vec3.set(I,F,G,q),g(I),F+=I[0],G+=I[1],q+=I[2]);2<=A&&(k.vec3.set(I,Q,J,t),g(I),Q+=I[0],J+=I[1],t+=I[2]);l.isSome(h)&&(p=h.applyToVertex(C,H,p),C=p[0],H=p[1],p=p[2],q=h.applyToVertex(F,G,q),F=q[0],G=q[1],q=q[2],t=h.applyToVertex(Q,J,t),
Q=t[0],J=t[1],t=t[2]);F-=C;G-=H;q-=p;Q-=C;J-=H;t-=p;var z=x*t-J*b,B=b*Q-t*w,L=w*J-Q*x,A=F*z+G*B+q*L,C=n-C,S=v-H,M=a-p,H=S*q-G*M;p=M*F-q*C;var R=C*G-F*S;if(A>E){C=C*z+S*B+M*L;if(0>C||C>A)continue;z=w*H+x*p+b*R;if(0>z||C+z>A)continue}else if(A<-E){C=C*z+S*B+M*L;if(0<C||C<A)continue;z=w*H+x*p+b*R;if(0<z||C+z<A)continue}else continue;H=(Q*H+J*p+t*R)/A;0<=H&&(p=r.computeNormal(F,G,q,Q,J,t,K),m(H,p))}};var G=Array(t.MAX_PATCH_TESSELATION+1),F=Array(t.MAX_PATCH_TESSELATION+1),H=Array(t.MAX_PATCH_TESSELATION+
1),J=Array(t.MAX_PATCH_TESSELATION+1),I=e.vec3f64.create(),K=e.vec3f64.create()})},"esri/views/3d/support/buffer/BufferPool":function(){define(["require","exports","../../../../core/PooledArray"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.BufferPool=void 0;n=function(){function a(a,d){this._factoryCallback=a;this._lengthCallback=d;this._pool=new Map}a.prototype.acquire=function(d){if(!a.test.disabled){var e=this._pool.get(d);if(e&&0!==e.length)return e.pop()}try{return this._factoryCallback(d)}catch(h){var e=
window.performance&&window.performance.memory,c="";e&&(c="\n  totalJSHeapSize: "+e.totalJSHeapSize+", usedJSHeapSize: "+e.usedJSHeapSize+", jsHeapSizeLimit: "+e.jsHeapSizeLimit);console.log("Array allocation of size "+d+" failed: "+h+c);throw h;}};a.prototype.release=function(k){if(!a.test.disabled){var e=this._lengthCallback(k),c=this._pool.get(e);c||(c=new d({shrink:!0}),this._pool.set(e,c));c.push(k)}};a.prototype.clear=function(){this._pool.clear()};Object.defineProperty(a.prototype,"test",{get:function(){return{size:this._pool.size}},
enumerable:!1,configurable:!0});a.test={disabled:!1};return a}();a.BufferPool=n})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/ObjectPool ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./tileUtils ../../webgl/Util".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G){function F(a){a.dispose();a instanceof q.default?Q.release(a):a instanceof v.default&&M.release(a)}Object.defineProperty(a,"__esModule",{value:!0});a.pruneAgents=a.Tile=a.SplitLimits=void 0;var H=x.weakAssert,J=f.vec3f64.create(),I=f.vec3f64.create(),K=f.vec3f64.create(),L=g.vec4f64.create();n=function(){return function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=
!0}}();a.SplitLimits=n;n=function(){function a(a){this._numSubdivisionAtLevel=a;this.lij=[0,0,0];this._children=[null,null,null,null];this._dirty=!0;this._previouslyRendered=!1;this.extent=p.create();this._elevationBounds=h.vec2f64.create();this.layerInfo=Array(2);this.extentInRadians=p.create();this.centerAtSeaLevel=f.vec3f64.create();this._center=[f.vec3f64.create(),f.vec3f64.create(),f.vec3f64.create()];this.up=f.vec3f64.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=
null;this._maxTesselation=0;this._usedMemory=O;this._curvatureHeight=this._radius=this._edgeLen2=this._edgeLen=this.renderOrder=this._screenDepth=this._mapDataRefCount=this._mapTileMemory=0}Object.defineProperty(a.prototype,"usedMemory",{get:function(){this._usedMemory===O&&this._updateMemoryUsed();return this._usedMemory+(this.isCached?0:this.mapTileMemory)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"cachedMemory",{get:function(){return this.isCached?this.mapTileMemory:0},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"mapTileMemory",{get:function(){this._usedMemory===O&&this._updateMemoryUsed();for(var a=this._mapTileMemory,b=0,c=this.layerInfo[1];b<c.length;b++){var d=c[b].data;d instanceof t.VectorTile&&(a+=d.getMemoryUsage())}return a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isCached",{get:function(){return!this.shouldRender&&0>=this._mapDataRefCount},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"maxTesselation",{get:function(){return this._maxTesselation},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"numSubdivisionsAtLevel",{get:function(){return this._numSubdivisionAtLevel},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isWithinClippingArea",{get:function(){return this._isWithinClippingArea},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"intersectsClippingArea",{get:function(){return this._intersectsClippingArea},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"clippingArea",{get:function(){return this._clippingArea},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"surface",{get:function(){return this._surface},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"level",{get:function(){return this.lij[0]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"edgeLen",{get:function(){return this._edgeLen},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"screenDepth",{get:function(){return this._screenDepth},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"visible",{get:function(){if(this._dirty){var a=this._isVisible();a!==this._visible&&(this._visible=a,this.updateAgentSuspension(),this.surface.emit("tiles-visibility-changed"),this.surface.renderer.setNeedsRender());this._dirty=!1}return this._visible},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"rendered",{get:function(){var a=!!this.renderData;a!==this._previouslyRendered&&(this.surface.emit("tiles-visibility-changed"),
this._previouslyRendered=a,this.surface.renderer.setNeedsRender());return a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"shouldRender",{get:function(){if(!this.visible)return!1;if(0===this.surface.lodSnapping){var a=this.level-this._surface.snapLevel;if(0===a)return!0;if(1===a)return!1}return this.isLeaf},enumerable:!1,configurable:!0});a.prototype.init=function(a,b,d){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];d.tilingScheme.getExtent(a[0],a[1],a[2],this.extent);d.tilingScheme.convertExtentToRadians(this.extent,
this.extentInRadians);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;d.upsampleMapCache.pop(E.tile2str(this));this._radius=this._edgeLen2=this._edgeLen=0;this.vlevel=a?a[0]:0;b&&b._elevationBounds?c.vec2.copy(this._elevationBounds,b.elevationBounds):c.vec2.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=b;this.unsetChildren();this._surface=
d;this.updateVisibility();for(a=0;2>a;a++){b=d.numLayers(a);var e=this.layerInfo[a];this.layerInfo[a]?e.length=b:(e=Array(b),this.layerInfo[a]=e);for(var f=0;f<b;f++)e[f]=A.TilePerLayerInfo.makeEmptyLayerInfo(a,this._surface.upsampleInfoPool,e[f]),0===a&&this.findElevationBoundsForLayer(f,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(d.tilingScheme.pixelSize,z.MAX_PATCH_TESSELATION)};a.prototype.release=function(){H(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(E.tile2str(this));
for(var a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++)c[b].dispose();this._surface=this._parent=null;this._usedMemory=O};a.prototype.refMapData=function(){++this._mapDataRefCount;this.isCached||this._surface.upsampleMapCache.pop(E.tile2str(this))};a.prototype.unrefMapData=function(){--this._mapDataRefCount;if(this.isCached){var a=this.cachedMemory;0<a&&(this._surface.upsampleMapCache.put(E.tile2str(this),this,a),this.setMemoryDirty())}};a.prototype.setMemoryDirty=function(){this._usedMemory=
O};Object.defineProperty(a.prototype,"cpuImageMemorySize",{get:function(){var a=this._surface.tilingScheme.pixelSize;return a*a*4},enumerable:!1,configurable:!0});a.prototype._updateMemoryUsed=function(){this._mapTileMemory=this._usedMemory=0;for(var a=this.cpuImageMemorySize,b=0,c=this.layerInfo[1];b<c.length;b++){var d=c[b],d=d.data;d instanceof C.TileTexture?this._mapTileMemory+=G.getGpuMemoryUsage(d.texture):d instanceof HTMLImageElement||d instanceof u.ImageWithType?this._mapTileMemory+=a:d instanceof
w.default&&(this._mapTileMemory+=d.getMemoryUsage())}b=0;for(c=this.layerInfo[0];b<c.length;b++)d=c[b],this._usedMemory+=d.data?a:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,a=this.renderData.textureDescriptor)&&(this._mapTileMemory+=G.getGpuMemoryUsage(a));this.isCached&&this._surface.upsampleMapCache.updateSize(E.tile2str(this),this,this.cachedMemory)};a.prototype.getUsedMemoryForLayer=function(a,b){b=this.layerInfo[a][b];if(!b||!b.data)return 0;if(1===a&&
!this.isCached){a=b.data;if(a instanceof C.TileTexture)return G.getGpuMemoryUsage(a.texture);if(a instanceof HTMLImageElement||a instanceof u.ImageWithType)return this.cpuImageMemorySize;if(a instanceof t.VectorTile||a instanceof w.default)return a.getMemoryUsage()}else if(0===a)return this.cpuImageMemorySize;return 0};a.prototype.updateScreenDepth=function(a){m.vec3.copy(L,this._center[0]);L[3]=1;b.vec4.transformMat4(L,L,a);this._screenDepth=0>L[2]?0:L[2]/L[3]};a.prototype.shouldSplit=function(a,
b,c){var d=this,e=this.level;m.vec3.subtract(J,this._center[0],b);var f=m.vec3.squaredLength(J),g=0;m.vec3.subtract(I,this._center[1],b);var h=m.vec3.squaredLength(I);h<f&&(f=h,g=1);m.vec3.subtract(I,this._center[2],b);h=m.vec3.squaredLength(I);h<f&&(f=h,g=2);if(this._edgeLen2>f&&e<a.maxLod)return 2;h=function(){var b=e+Math.ceil(-l.log2(a.relativeWidthLimit/r));return b!==d.vlevel?(d.vlevel=b,4):1};if(0===c&&1===this._surface.snapLevel-e)return e>=a.maxLod?h():2;c=Math.sqrt(f);var k=m.vec3.dot(this.up,
J),f=this._elevationBounds[1]-this._elevationBounds[0],p=f/this.edgeLen;if(a.aboveGround&&0<k&&.001>p&&0<k/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-p)return 0;var r=this._edgeLen/(a.fovX*c*2);return r<a.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,4):0:e>=a.maxLod?h():6<e&&(m.vec3.subtract(I,this._center[g],b),m.vec3.scale(K,this.up,k),m.vec3.subtract(K,K,I),h=m.vec3.squaredLength(K),h>this._radius*this._radius&&(m.vec3.scale(K,K,this._radius/Math.sqrt(h)),
m.vec3.add(K,K,this._center[g]),m.vec3.subtract(K,b,K),Math.min(1,(Math.abs(m.vec3.dot(K,this.up))+.5*f+this._curvatureHeight)/m.vec3.length(K))*(this._edgeLen/(a.fovY*c*2))<.1/a.angledSplitBias*a.relativeHeightLimit))?0:2};a.prototype.setChildren=function(a,b,c,d){H(!!(a&&b&&c&&d),"Null child passed");this._children[0]=a;this._children[1]=b;this._children[2]=c;this._children[3]=d};a.prototype.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=
null};a.prototype.load=function(a){this.refMapData();for(var b=0;2>b;b++)this.layerInfo[b]&&this._createOrUpdateAgents(0,b);a.loadTile(this)};a.prototype.unload=function(a){a.unloadTile(this);for(a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++){var d=c[b];d.loadingAgent&&d.loadingAgent!==B.TILE_AGENT_DONE&&(F(d.loadingAgent),d.loadingAgent=null);d.pendingUpdates=0}this.resetPendingUpdate(32);this.resetPendingUpdate(64);this.unrefMapData()};a.prototype.unloadMapData=function(){for(var a=
0,b=this.layerInfo[1];a<b.length;a++){var c=b[a];c.loadingAgent&&c.loadingAgent!==B.TILE_AGENT_DONE&&(F(c.loadingAgent),c.loadingAgent=null);c.pendingUpdates=0}this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};a.prototype.updateClippingStatus=function(a){if(p.equals(a,this._clippingArea))return!1;var b=this._intersectsClippingArea,c=this._isWithinClippingArea;a?(this._intersectsClippingArea=this.intersectsExtent(a),this._isWithinClippingArea=this.isWithinExtent(a)):this._isWithinClippingArea=
this._intersectsClippingArea=!0;this._clippingArea=a;this.updateVisibility();a=c&&this._isWithinClippingArea;b=!c&&!b&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||a||b||this.setPendingUpdate(32);return!0};a.prototype.updateVisibility=function(){this._dirty=!0;this._surface.pendingUpdates=!0};a.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};a.prototype.hasLayerData=function(a,b){a=this.layerInfo[b][a];return!(!a||!a.data||a.dataInvalidated)};Object.defineProperty(a.prototype,
"updating",{get:function(){if(this.hasPendingUpdates)return!0;for(var a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++){var d=c[b];if(d.loadingAgent&&d.loadingAgent!==B.TILE_AGENT_DONE&&d.loadingAgent.updating)return!0}return!1},enumerable:!1,configurable:!0});a.prototype.isSuspended=function(a){return this.hasPendingUpdate(2)?!0:0===a?!1:!this.visible};Object.defineProperty(a.prototype,"hasPendingUpdates",{get:function(){return 0!==this._pendingUpdates},enumerable:!1,configurable:!0});
a.prototype.hasPendingUpdate=function(a){return(this._pendingUpdates&a)===a};a.prototype.setPendingUpdate=function(a){this._pendingUpdates|=a;this._surface.pendingUpdates=!0};a.prototype.resetPendingUpdate=function(a){return this.hasPendingUpdate(a)?(this._pendingUpdates&=~a,!0):!1};a.prototype.requestLayerData=function(a,b,c){z.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",
this.lij.toString(),c.tile.lij.toString(),b,a),!0;d.waitingAgents.push(c);if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),c.dataArrived(this),!0;if(d.requestPromise)return!0;d.requestAbort=e.createAbortController();var f=this._surface.requestTileData(this,a,b,d.requestAbort);if(!f)return d.requestAbort=null,!1;a=function(){d.requestPromise===f&&(d.requestPromise=null,d.requestAbort=
null)};d.requestPromise=f;f.then(a,a);return!!d.requestPromise};Object.defineProperty(a.prototype,"isLeaf",{get:function(){return null==this._children[0]},enumerable:!1,configurable:!0});a.prototype.hasLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};a.prototype.findByLij=function(a){return this.hasLij(a)?this:this.isLeaf?null:(a=this._children[0].findByLij(a)||this._children[1].findByLij(a)||this._children[2].findByLij(a)||this._children[3].findByLij(a))?a:null};
a.prototype.distanceToSquared=function(a){return m.vec3.squaredLength(m.vec3.subtract(K,this._center[0],a))};a.prototype.containsPoint=function(a){var b=this.extent;return a[0]>=b[0]&&a[1]>=b[1]&&a[0]<=b[2]&&a[1]<=b[3]};a.prototype.unrequestLayerData=function(a,b,c){z.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var e=this.layerInfo[b][a],f=e.waitingAgents;c=null!=d.removeUnordered(f,c);H(c,"agent has not requested this piece of map data");
1>f.length&&(e.abortRequest(),z.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),b,a),this._updateMemoryUsed())};a.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0;this._updateMemoryUsed()};a.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile "+this.lij.toString()+" layer "+b+"/"+a+" error "+
c);a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing();a.waitingAgents.length=0;this._updateMemoryUsed()};a.prototype.updateRenderData=function(a){switch(a){case 1:return this.updateTexture();case 0:return this.updateGeometry()}};a.prototype.updateTexture=function(){this.renderData&&this.setPendingUpdate(64)};a.prototype.updateGeometry=function(){this.setPendingUpdate(32);for(var a=0,b=this.layerInfo[0];a<b.length;a++)b[a].pendingUpdates|=
32};a.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)};a.prototype.computeElevationBounds=function(){c.vec2.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);for(var a=!0,b=0,d=this.layerInfo[0];b<d.length;b++){var e=d[b];e.elevationBounds&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],e.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],e.elevationBounds.max),e.elevationBounds.hasNoDataValues||
(a=!1))}a&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0));this.updateRadiusAndCenter()};a.prototype._updateCenter=function(){m.vec3.scale(K,this.up,.5*(this._elevationBounds[0]+this._elevationBounds[1]));m.vec3.add(this._center[0],this.centerAtSeaLevel,K);m.vec3.scale(K,this.up,this._elevationBounds[0]);m.vec3.add(this._center[1],this.centerAtSeaLevel,K);m.vec3.scale(K,this.up,this._elevationBounds[1]);m.vec3.add(this._center[2],
this.centerAtSeaLevel,K)};a.prototype.findElevationBoundsForLayer=function(a,b){var c=this.layerInfo[0][a];if(!c.elevationBounds||c.elevationBounds.level<b)if(b=this._surface.layerViewByIndex(a,0),b=x.getLayerWithExtentRange(b),E.fallsWithinLayer(this,b,!1)){b=R;var d=!1;if(c.data){var e=c.data;b.min=e.bounds[0];b.max=e.bounds[1];b.hasNoDataValues=e.hasNoDataValues;b.level=this.lij[0];d=!0}else{for(var f=0,g=void 0,e=void 0,h=this._parent;h&&(!e||f<z.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&!(f=this.vlevel-
h.level,g=e||g,e=h.layerInfo[0][a].data,!e&&g&&f>=z.ELEVATION_DESIRED_RESOLUTION_LEVEL);h=h._parent);if(e=e||g)e.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],b),Infinity!==b.min&&(b.level=e.level,d=!0)}d&&(c.elevationBounds||(c.elevationBounds=new r.ElevationBounds),c.elevationBounds.copyFrom(b))}};a.prototype.modifyLayers=function(a,b,c){for(var d=this.layerInfo[c],e=0;e<d.length;e++){var f=d[e];f.loadingAgent&&f.loadingAgent!==B.TILE_AGENT_DONE&&(F(f.loadingAgent),f.loadingAgent=null);
f.waitingAgents.length=0}if(1===c)for(e=0;e<d.length;++e)void 0===a[e]&&d[e].dispose();a=b.length;f=Array(a);for(e=0;e<a;e++){var g=b[e];f[e]=-1<g?d[g]:A.TilePerLayerInfo.makeEmptyLayerInfo(c,this._surface.upsampleInfoPool)}this.layerInfo[c]=f;this._updateMemoryUsed()};a.prototype.restartAgents=function(a){this.renderData&&(this._createOrUpdateAgents(0,a),this.updateRenderData(a))};a.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];
d.loadingAgent===B.TILE_AGENT_DONE&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};a.prototype.updateAgentSuspension=function(){for(var a=0;2>a;a++)for(var b=this.isSuspended(a),c=0,d=this.layerInfo[a];c<d.length;c++){var e=d[c];e.loadingAgent&&e.loadingAgent!==B.TILE_AGENT_DONE&&(e.loadingAgent.setSuspension(b),e.loadingAgent===B.TILE_AGENT_DONE&&this.updateRenderData(a))}};a.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==B.TILE_AGENT_DONE&&
a.loadingAgent.dispose();a.loadingAgent=null};a.prototype.agentDone=function(a,b){var c=this.layerInfo[b][a];c.loadingAgent=B.TILE_AGENT_DONE;c.data||c.upsampleInfo||this._createOrUpdateAgents(a+1,b)};a.prototype._createOrUpdateAgents=function(a,b){for(var c=this.isSuspended(b),d=this.layerInfo[b];a<d.length;++a){var e=d[a],f=!1,g=this._surface.layerViewByIndex(a,b),h=x.getLayerWithExtentRange(g);if(e.loadingAgent)E.fallsWithinLayer(this,h,!1)?(e.loadingAgent!==B.TILE_AGENT_DONE&&(z.TILE_LOADING_DEBUGLOG&&
console.log(E.tile2str(this),"update suspended",c),e.loadingAgent.setSuspension(c)),e.loadingAgent!==B.TILE_AGENT_DONE&&(f=e.loadingAgent.update(),z.TILE_LOADING_DEBUGLOG&&console.log(E.tile2str(this),"update"))):e.dispose();else if(E.fallsWithinLayer(this,h,!1)){var f=e,h=a,k=b,m=c,l=0===k?Q.acquire():M.acquire();l.init(this,h,k,m);f.loadingAgent=l;f=e.loadingAgent.startLoading();z.TILE_LOADING_DEBUGLOG&&console.log(E.tile2str(this),"start");f?e.loadingAgent===B.TILE_AGENT_DONE&&(z.TILE_LOADING_DEBUGLOG&&
console.log(E.tile2str(this),"done"),this.setPendingUpdate(32)):(F(e.loadingAgent),e.loadingAgent=B.TILE_AGENT_DONE,z.TILE_LOADING_DEBUGLOG&&console.log(E.tile2str(this),"done"))}e.loadingAgent===B.TILE_AGENT_DONE&&this.updateRenderData(b);if(f&&g.isOpaque)break}};a.prototype.isWithinExtent=function(a){var b=this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};a.prototype.intersectsExtent=function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};Object.defineProperty(a.prototype,
"test",{get:function(){return{cachedMemory:this.cachedMemory}},enumerable:!1,configurable:!0});return a}();a.Tile=n;a.pruneAgents=function(){M.prune(0);Q.prune(0)};var M=new k(v.default),Q=new k(q.default),R=new r.ElevationBounds,O=-1})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["require","exports","tslib","./TerrainConst","./TileAgent"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;
c._scaleRangeEnabled=!1;return c}d.__extends(c,a);Object.defineProperty(c.prototype,"_desiredMinLevelDelta",{get:function(){return l.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"_loadingLevelDelta",{get:function(){return 0},enumerable:!1,configurable:!0});return c}(k.TileAgent);a.default=n})},"esri/views/3d/terrain/TileAgent":function(){define("require exports tslib ../../../core/maybe ./TerrainConst ./terrainUtils ./tileUtils".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.TILE_AGENT_DONE=a.TileAgent=void 0;var h=Error("Abstract method called on TileAgent");n=function(){function a(){}Object.defineProperty(a.prototype,"updating",{get:function(){return!!this._tileRequested},enumerable:!1,configurable:!0});a.prototype.init=function(a,b,c,d){this.tile=a;this._layerIdx=b;this._layerClass=c;this._suspended=d;this._tileLayerInfo=a.getLayerInfo(b,c);this._tileRequested=null;a=this._findAncestorWithData();
this._setUpsampleTile(a)};a.prototype.startLoading=function(){return this._requestNext()};a.prototype.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null};a.prototype.setSuspension=function(a){a!==this._suspended&&((this._suspended=a)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||
this.update())};a.prototype.update=function(){var a=this._findAncestorWithData();this._setUpsampleTile(a);return this._requestNext()};a.prototype.dataArrived=function(a){this._setUpsampleTile(a);this._tileRequested=null;a===this.tile?this.tile.updateRenderData(this._layerClass):this._requestNext()};a.prototype.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};a.prototype._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);
this.dispose()};a.prototype._requestNext=function(){if(this._suspended)return!0;var a=this._findNextDownload();k.TILE_LOADING_DEBUGLOG&&console.log(c.tile2str(this.tile),"next",c.tile2str(a));if(this._tileRequested){if(a===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}a?a.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=a):this._agentDone();return!!this._tileRequested};a.prototype._findNextDownload=
function(){for(var a=this._layerIdx,b=this._layerClass,d=this.tile.surface.layerViewByIndex(a,b),h=e.getLayerWithExtentRange(d),m=d.dataLevelRange,d=m.minLevel,m=m.maxLevel,u=this._desiredMinLevelDelta,r=this._loadingLevelDelta+u,q=this._scaleRangeEnabled?c.fallsWithinLayer:function(){return!0},n,w=this.tile,z=0,x=this._tileLayerInfo.upsampleInfo,x=x?x.tile.level:-1,B=l.get(h,"tilemapCache");w&&q(w,h,!1)&&w.level>=d;){var A=w.level,C=w.layerInfo[b][a];if(C.data&&z>=u){A>x&&this._setUpsampleTile(w);
C.dataInvalidated&&(n=w);break}if((l.isNone(B)||"unavailable"!==B.getAvailability(w.lij[0],w.lij[1],w.lij[2]))&&A<=m&&!C.data&&!C.dataMissing){if(!n||0===A%k.LOADING_LEVEL_MODULO||this.tile.level-n.level<u)n=w;if(z>=r)break}w=w.parent;z++}n&&this.tile.level-n.level<u&&this._tileLayerInfo.upsampleInfo&&(n=null);return n};a.prototype._findAncestorWithData=function(){for(var a=this.tile.vlevel,b=this._desiredMinLevelDelta,c,d=this.tile;d;d=d.parent)if(d.hasLayerData(this._layerIdx,this._layerClass)){if(a-
d.level>=b)return d;c=d}return c};a.prototype._setUpsampleTile=function(a){this._tileLayerInfo.setUpsampleInfo(this.tile,a);this.tile.updateRenderData(this._layerClass)};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{findNextDownload:function(){return a._findNextDownload()},tileLayerInfo:this._tileLayerInfo}},enumerable:!1,configurable:!0});return a}();a.TileAgent=n;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);Object.defineProperty(c.prototype,
"_desiredMinLevelDelta",{get:function(){throw h;},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"_loadingLevelDelta",{get:function(){throw h;},enumerable:!1,configurable:!0});return c}(n);a.TILE_AGENT_DONE=new n})},"esri/views/3d/terrain/tileUtils":function(){define(["require","exports","../../../core/maybe","../../../core/PooledArray"],function(n,a,d,l){function k(a){return a?a[0]+"/"+a[1]+"/"+a[2]:"null"}function e(a,c){c(a);if(!a.isLeaf){var d=0;for(a=a.children;d<a.length;d++)e(a[d],
c)}}function c(a,c,d){a=a.screenDepth;c=c.screenDepth;return a<c?-d:a>c?d:0}Object.defineProperty(a,"__esModule",{value:!0});a.tilesAreRelated=a.hasVisibleSiblings=a.computeUpsampleInfo=a.compareTiles=a.sortTiles=a.fallsWithinLayer=a.traverseTilesPreorder=a.tile2str=a.lij2str=a.IteratorPostorder=a.IteratorPreorder=void 0;n=function(){function a(){this.q=new l;this._last=null}Object.defineProperty(a.prototype,"done",{get:function(){return 0===this.q.length&&(!this._last||this._last.isLeaf)},enumerable:!1,
configurable:!0});a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null};a.prototype.reset=function(a){this.q.clear();a&&this.q.pushArray(a);this._last=null};a.prototype.skipSubtree=function(){this._last=null};a.prototype.next=function(){this._last&&!this._last.isLeaf&&this.q.pushArray(this._last.children);return this._last=this.q.pop()};return a}();a.IteratorPreorder=n;n=function(){function a(){this.q=new l}Object.defineProperty(a.prototype,"done",{get:function(){return 0===
this.q.length},enumerable:!1,configurable:!0});a.prototype.reset=function(a){this.q.clear();if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a){var c=this.q.data[a];c.isLeaf||this.q.pushArray(c.children)}};a.prototype.next=function(){return this.q.pop()};return a}();a.IteratorPostorder=n;a.lij2str=k;a.tile2str=function(a){return a?k(a.lij):"null"};a.traverseTilesPreorder=function(a,c){if(Array.isArray(a))for(var d=0;d<a.length;d++)e(a[d],c);else e(a,c)};a.fallsWithinLayer=function(a,c,e){if(d.isNone(c))return!1;
var b=c.fullExtent,f=a.extent;if(e){if(f[0]<b.xmin||f[1]<b.ymin||f[2]>b.xmax||f[3]>b.ymax)return!1}else if(b.xmin>f[2]||b.ymin>f[3]||b.xmax<f[0]||b.ymax<f[1])return!1;a=a.surface.tilingScheme.levels[a.lij[0]].scale;return 0<c.minScale&&a>1.00000001*c.minScale||0<c.maxScale&&a<.99999999*c.maxScale?!1:!0};a.sortTiles=function(a,d){d.sort(function(d,b){return c(d,b,a)})};a.compareTiles=c;a.computeUpsampleInfo=function(a,c,d){for(var b=1,e=0,f=0;a!==c;)if(b*=.5,e*=.5,f*=.5,a.lij[2]&1&&(e+=.5),0===(a.lij[1]&
1)&&(f+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of upsampleTile");d.init(c,e,f,b)};a.hasVisibleSiblings=function(a){for(var c=0;c<a.length;c++){var d=a[c],b=d.parent;if(b)for(var e=0;4>e;e++){var h=b.children[e];if(h&&h!==d&&h.visible)return!0}}return!1};a.tilesAreRelated=function(a,c){if(!a||!c)return!1;var d=a[0]<c[0],b=d?a:c;a=d?c:a;c=a[0]-b[0];if(0===c)return!1;c=1<<c;return Math.floor(a[1]/c)===b[1]&&Math.floor(a[2]/c)===b[2]}})},"esri/views/3d/terrain/MapTileAgent":function(){define(["require",
"exports","tslib","./TileAgent"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function e(){var c=a.call(this)||this;c._scaleRangeEnabled=!0;return c}d.__extends(e,a);Object.defineProperty(e.prototype,"_desiredMinLevelDelta",{get:function(){return 0},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"_loadingLevelDelta",{get:function(){return 8},enumerable:!1,configurable:!0});return e}(l.TileAgent);a.default=n})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define(["require",
"exports","./terrainUtils","./TileAgent","./tileUtils"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.TilePerLayerInfo=void 0;n=function(){function a(a,d){this._pool=d;this.waitingAgents=[];this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(a)}a.prototype.init=function(a){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();
this.requestAbort=this.requestPromise=this.loadingAgent=null;this.pendingUpdates=0;0===a&&(this.elevationBounds=null)};a.prototype.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};a.prototype.abortRequest=function(){this.requestPromise&&(this.requestAbort.abort(),this.requestAbort=this.requestPromise=null)};a.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==l.TILE_AGENT_DONE&&this.loadingAgent.dispose();this.loadingAgent=null;
this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this.disposeData()};a.prototype.disposeData=function(){this.data=d.releaseTileData(this.data)};Object.defineProperty(a.prototype,"upsampleInfo",{get:function(){return this._upsampleInfo},enumerable:!1,configurable:!0});a.prototype._unsetUpsampleInfo=function(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};a.prototype.setUpsampleInfo=function(a,d){if(a===
d||null==d)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===d)return;this._upsampleInfo.tile.unrefMapData()}d.refMapData();k.computeUpsampleInfo(a,d,this._upsampleInfo)}};a.makeEmptyLayerInfo=function(c,d,e){return e?(e.init(c),e):new a(c,d)};return a}();a.TilePerLayerInfo=n})},"esri/views/3d/terrain/SphericalPatch":function(){define("require exports tslib ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/geodesicConstants ../support/geometryUtils ../support/projectionUtils ../support/geometryUtils/plane ./PatchGeometryFactory ./Tile".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){Object.defineProperty(a,"__esModule",{value:!0});a.SphericalPatch=void 0;n=function(a){function g(b,c,d){var f=a.call(this,p)||this;f.obb=Array(8);f.isWebMercator=!1;for(var g=0;8>g;g++)f.obb[g]=e.vec3f64.create();void 0!==b&&f.init(b,c,d);return f}d.__extends(g,a);g.prototype.init=function(b,d,f){a.prototype.init.call(this,b,d,f);this.isWebMercator=f.tilingScheme.spatialReference.isWebMercator;d=this.extentInRadians[0];f=this.extentInRadians[1];var g=this.extentInRadians[2],
h=this.extentInRadians[3];b=b[0];var p=l.lerp(f,h,.5),r=l.lerp(d,g,.5);this._edgeLen=(g-d)*Math.cos(0===b?0:Math.min(Math.abs(f),Math.abs(h)))*c.earthRadius;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=c.earthRadius-Math.sqrt(c.earthRadius*c.earthRadius-this._edgeLen2/4);m.wgs84ComparableLonLatToECEF(this.centerAtSeaLevel,r,p,0);d=e.vec3f64.fromArray(this.centerAtSeaLevel);k.vec3.normalize(d,d);this.up=d;this._updateOBB();this.updateRadiusAndCenter()};g.prototype.updateRadiusAndCenter=
function(){if(0===this.lij[0])k.vec3.set(this._center[0],0,0,0),k.vec3.set(this._center[1],0,0,0),k.vec3.set(this._center[2],0,0,0),this._radius=c.earthRadius+this.elevationBounds[1];else{this._updateCenter();var a=Math.max(k.vec3.squaredDistance(this._center[0],this.obb[0]),k.vec3.squaredDistance(this._center[0],this.obb[1]));this._radius=Math.sqrt(a)}};g.prototype._isVisible=function(){if(!this.intersectsClippingArea)return!1;var a=this.surface.frustum.planes;if(10>this.lij[0])return h.frustum.intersectsSphere(a,
h.sphere.wrap(this._radius,this._center[0]));for(var b=this.obb,c=0;6>c;c++){var d=a[c];4===c&&(d=f.copy(d,t),t[3]-=this.surface.view.state.camera.near);for(var e=void 0,e=0;8>e&&!f.isPointOutside(d,b[e]);e++);if(8===e)return!1}return!0};g.prototype.computeElevationBounds=function(){a.prototype.computeElevationBounds.call(this);this._updateOBB()};g.prototype.createGeometry=function(a,c){var d=this._isPole(this.lij[1],this.lij[0]);b.createSphericalGlobePatch(a,this.extent,c,this.renderData,this.extentInRadians,
this.isWebMercator,d);this.setMemoryDirty()};g.prototype._updateOBB=function(){for(var a=this.extentInRadians,b=this.obb,d=0;2>d;d++){var e=this.elevationBounds[d],f=4*d;m.wgs84ComparableLonLatToECEF(b[f++],a[0],a[1],e);m.wgs84ComparableLonLatToECEF(b[f++],a[0],a[3],e);m.wgs84ComparableLonLatToECEF(b[f++],a[2],a[3],e);m.wgs84ComparableLonLatToECEF(b[f++],a[2],a[1],e)}this.isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(k.vec3.set(b[1],0,0,c.earthRadius),k.vec3.set(b[2],0,0,c.earthRadius),
k.vec3.set(b[5],0,0,c.earthRadius),k.vec3.set(b[6],0,0,c.earthRadius)):1===a&&(k.vec3.set(b[0],0,0,-c.earthRadius),k.vec3.set(b[3],0,0,-c.earthRadius),k.vec3.set(b[4],0,0,-c.earthRadius),k.vec3.set(b[7],0,0,-c.earthRadius)))};g.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};return g}(g.Tile);a.SphericalPatch=n;var p=[128,64,32,16,16,8,8,4],t=f.create()})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){function p(a,b){a&&!a.spatialReference.equals(b)&&(a=m.canProject(a.spatialReference,b)?m.project(a,b):null);return a}Object.defineProperty(a,"__esModule",{value:!0});a.SurfaceExtentHelperLocal=a.SurfaceExtentHelperGlobal=void 0;n=function(a){function b(b){b=a.call(this,b)||this;b._handles=new k;return b}d.__extends(b,a);b.prototype.initialize=function(){var a=this;this._handles.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};
b.prototype.destroy=function(){this._handles.destroy();this._handles=null};Object.defineProperty(b.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},
enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!1,configurable:!0});b.prototype._computeStencilEnabledExtents=function(a,b){var c=[],d=0;for(a=a.items;d<a.length;d++){var e=a[d].layer;"IntegratedMeshLayer"===
e.operationalLayerType&&null!=b&&(e=p(e.fullExtent,b),null!=e&&c.push(h.fromExtent(e)))}return c};d.__decorate([c.property({readOnly:!0})],b.prototype,"layerViewsExtent",null);d.__decorate([c.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],b.prototype,"tiledLayersExtent",null);d.__decorate([c.property({readOnly:!0,dependsOn:["spatialReference"]})],b.prototype,"stencilEnabledExtents",null);d.__decorate([c.property()],b.prototype,"spatialReference",null);d.__decorate([c.property()],
b.prototype,"tilingScheme",null);d.__decorate([c.property()],b.prototype,"defaultTiledLayersExtent",void 0);d.__decorate([c.property({constructOnly:!0})],b.prototype,"layers",void 0);d.__decorate([c.property({constructOnly:!0})],b.prototype,"layerViews",void 0);return b=d.__decorate([c.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],b)}(l);l=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}d.__extends(e,a);e.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};
e.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};e.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?b.WEBMERCATOR_WORLD_EXTENT:b.GEOGRAPHIC_WORLD_EXTENT};d.__decorate([c.property({dependsOn:["spatialReference"]})],e.prototype,"layerViewsExtent",void 0);return e=d.__decorate([c.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],e)}(n);a.SurfaceExtentHelperGlobal=l;n=function(a){function b(){return null!==a&&a.apply(this,arguments)||
this}d.__extends(b,a);b.prototype.initialize=function(){var a=this;this._handles.add([this.layers.on("change",function(b){return a._handleLayersChanged(b)}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};b.prototype._handleLayersChanged=function(a){for(var b=this,c=0,d=a.removed;c<d.length;c++)this._handles.remove(d[c].uid);c=0;for(a=a.added;c<a.length;c++)d=a[c],this._handles.add(e.init(d,"loaded",function(){return b.notifyChange("tiledLayersExtent")}),d.uid)};
b.prototype._computeLayerViewsExtent=function(){var a=h.empty(),b=this.spatialReference;this.layerViews.forEach(function(c){c.isResolved()&&(c=p("fullExtentInLocalViewSpatialReference"in c&&c.fullExtentInLocalViewSpatialReference||c.layer.fullExtent,b))&&h.expand(a,c)});var c=h.allFinite(a)?a:null,d=this._get("layerViewsExtent");return h.equals(c,d)?d:c};b.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var b=this.spatialReference,c=h.empty();this.layers.forEach(function(d){if(d.loaded&&
f.isTiledLayer(d)){var e=g.getTiledLayerInfo(d,b,2),k=e.tileInfo,e=e.fullExtent;k&&g.isProjectableRasterLayer(d)&&e?h.expand(c,e):k&&a.compatibleWith(k)&&e&&e.spatialReference.equals(b)&&h.expand(c,e)}});this.defaultTiledLayersExtent&&h.expand(c,this.defaultTiledLayersExtent);var d=h.allFinite(c)?c:null,e=this._get("tiledLayersExtent");return h.equals(d,e)?e:d};return b=d.__decorate([c.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],b)}(n);a.SurfaceExtentHelperLocal=n})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../layers/support/layerUtils ../support/projectionUtils ./terrainUtils ./TilingScheme".split(" "),
function(n,a,d,l,k,e,c,h,m,f){return function(a){function b(b){b=a.call(this,b)||this;b._changeHandles=new k;return b}d.__extends(b,a);b.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};b.prototype.destroy=function(){this._changeHandles.destroy();
this._changeHandles=null};b.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var b;this.layers.some(function(d){return!c.isTiledLayer(d)||d.isRejected()?!1:!d.isFulfilled()||m.getTiledLayerInfo(d,a.viewSpatialReference,a.manifold).tileInfo?(b=d,"vector-tile"!==d.type&&!m.isProjectableRasterLayer(d)):!1});if(b)if(b.isResolved()){var d=m.getTiledLayerInfo(b,this.viewSpatialReference,this.manifold).tileInfo,d=new f(d);this._set("tilingSchemeDone",
!0);this._lockTilingScheme(d)}else this._updateWhen(b);else this._set("tilingSchemeDone",!0)}};b.prototype._updateWhen=function(a){var b=this,c=a.when().catch(function(a){return a}).then(function(){c===b._waitTask&&b._update()});this._waitTask=c};b.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var c=a.levels.length-1;a.spatialReference.isWebMercator?a=f.makeWebMercatorAuxiliarySphere(c):h.canProjectToWGS84ComparableLonLat(a.spatialReference)&&(a=f.makeGCSWithTileSize(a.spatialReference,
a.pixelSize,c))}this.tilingSchemeLocked=!0;this.tilingScheme=a;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return b._updateTiledLayerExtent()}))};b.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};b.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold){var a=this.extentHelper.spatialReference;
a.isWebMercator?this.tilingScheme=f.WebMercatorAuxiliarySphere:h.canProjectToWGS84ComparableLonLat(a)&&(this.tilingScheme=f.makeGCSWithTileSize(a,256));this.extent=this.extentHelper.layerViewsExtent}else if(a=this.extentHelper.layerViewsExtent)this.tilingScheme=f.fromExtent(a,this.extentHelper.spatialReference),this.extent=a};d.__decorate([e.property()],b.prototype,"tilingScheme",void 0);d.__decorate([e.property()],b.prototype,"extent",void 0);d.__decorate([e.property({value:!1})],b.prototype,"tilingSchemeLocked",
void 0);d.__decorate([e.property({readOnly:!0,value:!1})],b.prototype,"tilingSchemeDone",void 0);d.__decorate([e.property({constructOnly:!0})],b.prototype,"viewSpatialReference",void 0);d.__decorate([e.property({constructOnly:!0})],b.prototype,"layers",void 0);d.__decorate([e.property({constructOnly:!0})],b.prototype,"extentHelper",void 0);d.__decorate([e.property({constructOnly:!0})],b.prototype,"manifold",void 0);return b=d.__decorate([e.subclass("esri.views.3d.terrain.SurfaceTilingSchemeLogic")],
b)}(l)})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports tslib ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/imageUtils ../support/buffer/BufferView ./OverlayRenderer ./PatchGeometryFactory ./PatchRenderData ./TileRenderer ./tileUtils ../webgl-engine/core/shaderLibrary/Slice.glsl ../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/tracer ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L){function M(a,b,c){t.vec4.set(c,a[0]*b[2]+b[0],a[1]*b[3]+b[1],a[2]*b[2],a[3]*b[3])}var Q=r.create(),R=u.vec4f64.create(),O=u.vec4f64.create(),N=u.vec4f64.create(),S=function(){return function(){this.extent=u.vec4f64.create();this.maxLevel=this.minLevel=0;this.callback=null}}();n=function(a){function k(b){b=a.call(this,b)||this;b.type="Terrain";b.isGround=!0;b.tileSize=256;b.rctx=null;b._isTransparent=!1;b.renderDataPool=new c(x.PatchRenderData);
b.patchGroups=new h({allocator:function(a){return a||{root:null,origin:null,patches:new h}},deallocator:function(a){a.root=null;a.origin=null;a.patches.clear();return a}});b.patchGroupsDirty=!0;b.patchGroupsMap=new Map;b.tileIterator=new A.IteratorPreorder;b.highestVisibleLODTile=null;b.visible=!0;b._opaque=!0;b._skirtScale=1;b._velvetOverground=!0;b.castShadows=!0;b._ssrEnabled=!1;b.emptyTex=null;b.tileRenderer=null;b.tileBackgroundInitialized=!1;b.tileBackgroundUpdating=!1;b.stencilEnabledLayerExtents=
[];b.numTrianglesRendered=0;b.numTilesRendered=0;b.numTilesCulled=0;b.numOriginsRendered=0;b.clippingExtent=null;b.needsHighlight=!1;b.renderOccludedFlags=1;b.visibleScaleRangeQueries=new h({initialSize:10});b.visibleScaleRangeQueriesInvPtr=0;b.visibleScaleRangeQueryQueue=new h({initialSize:30});b.visibleScaleRangeQueryPool=new c(S);return b}d.__extends(k,a);k.prototype.destroy=function(){z.clearCaches()};k.prototype.install=function(a){a.addRenderPlugin([2,7,9],this)};k.prototype.uninstall=function(a){a.removeRenderPlugin(this)};
Object.defineProperty(k.prototype,"updating",{get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"canRender",{get:function(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"renderingDisabled",{set:function(a){this._set("renderingDisabled",!!a);this.setNeedsRender()},enumerable:!1,configurable:!0});
Object.defineProperty(k.prototype,"opaque",{get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled},set:function(a){this._opaque!==a&&(this._opaque=a,this.setNeedsRender())},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"needsLinearDepth",{get:function(){return this.overlayRenderer.hasWater},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"isTransparent",{get:function(){return this._isTransparent},set:function(a){this._isTransparent!==
a&&(this._isTransparent=a,this.setNeedsRender())},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"skirtScale",{get:function(){return this._skirtScale},set:function(a){a!==this._skirtScale&&(this._skirtScale=a,this.setNeedsRender())},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"renderPatchBorders",{get:function(){return!!this.shaderTechniqueConfig.tileBorders},set:function(a){this.shaderTechniqueConfig.tileBorders!==a&&(this.shaderTechniqueConfig.tileBorders=
a,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"cullBackFaces",{get:function(){return this.shaderTechniqueConfig.backfaceCullingEnabled},set:function(a){this.shaderTechniqueConfig.backfaceCullingEnabled!==a&&(this.shaderTechniqueConfig.backfaceCullingEnabled=a,this.notifyChange("cullBackFaces"),this.setNeedsRender())},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"renderOrder",{set:function(a){this._set("renderOrder",
a);this.setNeedsRender()},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"velvetOverground",{set:function(a){this._velvetOverground!==a&&(this._velvetOverground=a,this.setNeedsRender())},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"intersectionHandlerId",{get:function(){return H.TERRAIN_ID},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"slicePlane",{get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},set:function(a){this.shaderTechniqueConfig.slicePlaneEnabled!==
a&&(this.shaderTechniqueConfig.slicePlaneEnabled=a,this.setNeedsRender())},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"textureFadingEnabled",{set:function(a){this.shaderTechniqueConfig.textureFadingEnabled!==a&&(this.shaderTechniqueConfig.textureFadingEnabled=a,this.setNeedsRender())},enumerable:!1,configurable:!0});k.prototype.setDebugScreenSizePerspective=function(a){this.shaderTechniqueConfig.screenSizePerspective!==a&&(this.shaderTechniqueConfig.screenSizePerspective=a,
this.setNeedsRender())};k.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};k.prototype.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};k.prototype.setRenderOccludedOverlay=function(a){this.renderOccludedFlags=a?w.overlayRenderOccludedFlag:1;this.setNeedsRender()};k.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=a;this.setNeedsRender()};k.prototype.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=
a);this.setNeedsRender()};k.prototype.loadTile=function(a){a.renderData||(a.renderData=this.renderDataPool.acquire(),a.renderData.init(a),a.renderData.localOrigin=this._getLocalOriginOfTile(a));this.updateTileGeometry(a);this.updateTileTexture(a)};k.prototype.queryVisibleLevelRange=function(a,b,c,d){var e=this.visibleScaleRangeQueryPool.acquire();t.vec4.copy(e.extent,a);e.minLevel=b?b:-Number.MAX_VALUE;e.maxLevel=null!=c?c:Number.MAX_VALUE;e.callback=d;this.visibleScaleRangeQueryQueue.push(e);this.setNeedsRender()};
k.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(a),this.setNeedsRender(),a.resetPendingUpdate(64))};k.prototype.updateTileGeometry=function(a){for(var b=0,c=a.layerInfo[0];b<c.length;b++)c[b].pendingUpdates&=-33;a.resetPendingUpdate(32);a.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()};k.prototype.unloadTile=function(a){a.renderData&&(this.releaseTileGeometry(a.renderData),a.renderData.clear(),
a.renderData=null,a.setMemoryDirty(),this.setNeedsRender())};k.prototype._getLocalOriginOfTile=function(a){var b=Math.max(0,7*Math.floor((a.lij[0]-3)/7));if("spherical"===this.manifold&&0===b)return p.vec3f64.ZEROS;for(;a.parent&&a.lij[0]>b;)a=a.parent;return a.centerAtSeaLevel};k.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};k.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,
numOriginsRendered:this.numOriginsRendered}};Object.defineProperty(k.prototype,"wireframe",{set:function(a){var b=this;this._get("wireframe")!==a&&(this._set("wireframe",a),this.rootTiles&&(A.traverseTilesPreorder(this.rootTiles,function(c){c.renderData&&c.renderData.updateGeometry(b.rctx,a)}),this.setNeedsRender()))},enumerable:!1,configurable:!0});k.prototype.setNeedsRender=function(a){void 0===a&&(a=1);this.patchGroupsDirty=!0;this.initContext.requestRender(a)};k.prototype.setTileBackground=function(a){this.tileBackground=
a;this._updateTileBackground()};k.prototype.initializeRenderContext=function(a){this.initContext=a;this.rctx=a.rctx;this.shaderTechniques=a.shaderTechniqueRep;this.shaderTechniqueConfig=new L.TerrainTechniqueConfiguration;this.tileRenderer=new B(this.rctx,this.tileSize,this.shaderTechniques);this.tileBackground&&this._updateTileBackground();this.emptyTex=F.createEmptyTexture(this.rctx)};k.prototype.uninitializeRenderContext=function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);
this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};k.prototype.intersect=function(a,c,d,f){if(this.rootTiles&&(!a.options.selectOpaqueTerrainOnly||!a.options.selectionMode||this._opaque)){var h=Z,k=V;g.vec3.subtract(h,f,d);g.vec3.set(k,1/h[0],1/h[1],1/h[2]);var m=a.results.min,l=a.results.max,p=a.results.ground,q=0===a.options.store,t=!!a.results.ground.target,u=null,n=this.clippingExtent,w=this.tileIterator;w.reset(this.rootTiles);for(var x=H.getVerticalOffsetTerrain(a.verticalOffset),
B=function(){var B=w.next();if(null===B.renderData||t&&C._useStencilForTile(B))return"continue";if(a.options.invisibleTerrain){if(!B.visible&&n&&!B.intersectsExtent(n))return"continue"}else if(!B.visible)return"continue";var I=B.renderData.geometryInfo,F=B.renderData.localOrigin,E=-C._skirtScale*I.skirtLength;r.set(Q,I.boundingBox);e.isSome(x)&&(x.localOrigin=F,x.applyToAabb(Q));if(0!==E){var G=B.up;r.expandWithOffset(Q,E*G[0],E*G[1],E*G[2])}g.vec3.subtract(T,d,F);if(!K.intersectAabbInvDirBefore(Q,
T,k,a.tolerance,q&&null!=m.dist?m.dist:Infinity))return"continue";var J=function(a,c,d,e){a.set(void 0,A.tile2str(c),d,e,b.mat4f64.IDENTITY,void 0);a.intersector=X;a.target={type:"external",metadata:{tile:c}}},G=function(b,k){0<=b&&(a.options.backfacesTerrain||0>g.vec3.dot(k,h))&&(a.options.invisibleTerrain||!a.options.selectionMode||null==c||c(d,f,b))&&((null==p.dist||b<p.dist)&&J(p,B,b,k),a.options.isFiltered||(2===a.options.store&&(e.isNone(u)?(u=new H.IntersectorResult(a.ray),J(u,B,b,k),a.results.all.push(u)):
b<u.dist&&J(u,B,b,k)),(null==m.dist||b<m.dist)&&J(m,B,b,k),0!==a.options.store&&(null==l.dist||b>l.dist)&&J(l,B,b,k)))},L=Y;g.vec3.subtract(L,f,F);var F=I.indices,M=I.vertexAttributes,R={data:M.getField("position",v.BufferViewVec3f).typedBuffer,size:3,offsetIdx:0,strideIdx:M.stride/4},I=I.numWithoutSkirtIndices/3;K.intersectTriangles(T,L,0,I,F,R,null,x,G);0!==E&&z.intersectSkirts(T,L,I,F.length/3,F,M,"spherical"===C.manifold?function(a){return g.vec3.scale(a,a,E/g.vec3.length(a))}:function(a){return g.vec3.set(a,
0,0,E)},x,G)},C=this;!w.done;)B()}};k.prototype.render=function(a){if(9===a.slot){if(0===(a.renderOccludedMask&w.overlayRenderOccludedFlag))return!1}else if(a.slot!==(this.opaque?2:7))return!1;I.trace("# BEGIN RENDER TERRAIN");var b=a.pass,c=1===a.scenelightingData.globalFactor,d=this._updatePatchGroups();switch(b){case 0:b=a.shadowMap&&a.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==b&&(this.shaderTechniqueConfig.receiveShadows=b);b=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?
2:1;this.shaderTechniqueConfig.overlayMode!==b&&(this.shaderTechniqueConfig.overlayMode=b);this._renderMaterialPass(a,0,d,9===a.slot?"occluded":"colorAndWater");break;case 3:this.castShadows&&c&&this._renderAuxiliaryPass(a,3,d,"none");break;case 1:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(a,1,d,"none");break;case 2:this._renderAuxiliaryPass(a,2,d,"none");break;case 4:this.needsHighlight&&(this._renderAuxiliaryPass(a,4,d,"highlight"),a.rctx.clearSafe(256))}I.trace("# END RENDER TERRAIN");
0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender();return!0};k.prototype._renderMaterialPass=function(a,b,c,d){var e=this,f=a.rctx,h=a.camera;this._ssrEnabled=a.ssrParams.ssrEnabled;this._setTerrainTechnique(b,"occluded"===d);var k=this.shaderTechnique.program;a.rctx.bindProgram(k);f.bindProgram(k);"colorAndWater"===d&&a.ssrParams&&(a.ssrParams.lastFrameColorTextureID=9,a.ssrParams.linearDepthTextureID=8,E.ScreenSpaceReflections.bindUniforms(k,f,a.ssrParams));a.shadowMap&&a.shadowMap.bind(k,
7);a.ssaoHelper&&a.ssaoHelper.setUniforms(k,6);k.setUniform1i("tex",0);k.setUniform1i("texNext",1);this._bindOverlayUniforms(k);k.setUniformMatrix4fv("viewNormal",h.viewInverseTransposeMatrix);G.View.bindProjectionMatrix(k,h.projectionMatrix);a.scenelightingData.setUniforms(k,!0);b=h.viewMatrix;g.vec3.set(U,b[12],b[13],b[14]);g.vec3.normalize(U,U);k.setUniform3fv("viewDirection",U);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();
this.opaque?this._renderPatchGroups(a,k,c,d):a.offscreenRenderingHelper.renderToTargets(function(){return e._renderPatchGroups(a,k,c,d)},a.offscreenRenderingHelper.tmpColor,a.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries()};k.prototype._renderAuxiliaryPass=function(a,b,c,d){this._setTerrainTechnique(b,"occluded"===d);b=this.shaderTechnique.program;a.rctx.bindProgram(b);if(4===a.pass){var e=a.offscreenRenderingHelper;a.rctx.bindTexture(e.depthTexture,6);b.setUniform1i("depthTex",
6);b.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height)}else b.setUniformMatrix4fv("viewNormal",a.camera.viewInverseTransposeMatrix),1!==a.pass&&3!==a.pass||b.setUniform2fv("nearFar",a.camera.nearFar);this._renderPatchGroupsAuxiliary(a,b,c,d)};k.prototype._updateTileBackground=function(){var a=this;if(this.tileRenderer){this.tileBackgroundUpdating=!0;var b=function(){a.tileBackgroundInitialized=!0;a.tileBackgroundUpdating=!1;a.rootTiles&&A.traverseTilesPreorder(a.rootTiles,function(b){a.tileRenderer.updateTileTexture(b);
a.setNeedsRender()});a.setNeedsRender()};if("string"===typeof this.tileBackground){var c=this.tileBackground;q.requestImage(c).then(function(d){c===a.tileBackground&&a.tileRenderer&&(a.tileRenderer.setBackground(d),b())})}else{var d=this.tileBackground?l.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(d);b()}}};k.prototype._updatePatchGroups=function(){var a=this,b=this.patchGroups;if(!this.patchGroupsDirty)return b;this.highestVisibleLODTile=null;this._renderCollectOrigins(b);
if(0!==this.renderOrder){for(var c=0;c<b.length;c++)A.sortTiles(this.renderOrder,b.data[c].patches);b.sort(function(b,c){var d=a.renderOrder;b=0===b.patches.length?-d:0===c.patches.length?d:A.compareTiles(b.patches.data[0],c.patches.data[0],d);return b})}this.patchGroupsDirty=!1;return b};k.prototype._renderCollectOrigins=function(a){var b=this.rootTiles,c="spherical"===this.manifold;a.clear();for(var d=0;d<b.length;d++){var e=b[d],f=a.pushNew();f.root=e;f.origin=c?p.vec3f64.ZEROS:e.centerAtSeaLevel;
f.patches.clear();this._renderCollectOriginsForRoot(a,f)}a.filterInPlace(function(a){return 0<a.patches.length})};k.prototype._renderCollectOriginsForRoot=function(a,b){var c=this.tileIterator;c.resetOne(b.root);var d=this.patchGroupsMap;d.clear();for(d.set(b.origin,b);!c.done;){b=c.next();var e=b.renderData;if(e&&!b.visible)this.numTilesCulled++,c.skipSubtree();else{if(0===b.lij[0]%7){var f=a.pushNew();f.root=b;f.origin=b.centerAtSeaLevel;d.set(b.centerAtSeaLevel,f);f.patches.clear()}if(!b.rendered)this.numTilesCulled++;
else if(e){(f=d.get(e.localOrigin))&&f.patches.push(b);if(!this.highestVisibleLODTile||b.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=b;c.skipSubtree()}}}};k.prototype._scaleQueriesForTile=function(a){var b=a.extent;a=a.lij[0];for(var c=0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],e=d.extent;a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(c,this.visibleScaleRangeQueriesInvPtr-
1),this.visibleScaleRangeQueriesInvPtr--):c++}};k.prototype._useStencilForTile=function(a){for(var b=0,c=this.stencilEnabledLayerExtents;b<c.length;b++)if(a.intersectsExtent(c[b]))return!0;return!1};k.prototype._renderPatchGroupsAuxiliary=function(a,b,c,d){this.shaderTechnique.bindPipelineState(a.rctx);var e=0<this.stencilEnabledLayerExtents.length;b.setUniformMatrix4fv("proj",a.camera.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);"none"!==d&&this._bindOverlayUniforms(b);for(var f=
0;f<c.length;f++){var g=c.data[f];this._bindViewForPatchGroup(b,g,a.camera.eye,a.camera.viewMatrix);for(var h=0;h<g.patches.length;h++)this._renderPatch(a.rctx,b,g.patches.data[h],4,e,d)}a.rctx.bindVAO(null)};k.prototype._renderPatchGroups=function(a,b,c,d){var f=a.rctx,g=a.camera,h=g.viewMatrix;this.shaderTechnique.bindPipelineState(f);if(this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){var k=J.getSettings("spherical"===this.manifold?1:2);k.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,
fovY:g.fovY});K.bindScreenSizePerspective(k,b,"screenSizePerspective")}var k=0<this.stencilEnabledLayerExtents.length,m="occluded"===d;m&&(f.bindTexture(this.emptyTex,0),b.setUniform1f("blend",1),b.setUniform4fv("texOffsetAndScale",u.vec4f64.ZEROS));b.setUniform1f("skirtScale",m?0:this._skirtScale);for(var l=this.wireframe?1:4,p=0;p<c.length;p++){var r=c.data[p],q=r.patches;if(0!==q.length)for(this._bindViewForPatchGroup(b,r,g.eye,h),C.Slice.bindUniforms(b,this.shaderTechnique.configuration,a.sliceHelper&&
a.sliceHelper.plane,r.origin),a.shadowMap&&a.shadowMap.bindView(b,r.origin),this.numOriginsRendered++,r=0;r<q.length;r++){var t=q.data[r],n=t.renderData.textureReference;if(!e.isNone(n)){I.trace("# RENDER TILE "+A.tile2str(t)+", screenDepth:"+t.screenDepth);if(!m){this._scaleQueriesForTile(t);M(t.renderData.geometryInfo.uvOffsetAndScale,n.offsetAndScale,N);b.setUniform4fv("texOffsetAndScale",N);f.bindTexture(n.texture.texture,0);var n=t.renderData.textureFadeFactor,v=1>n?t.renderData.nextTextureReference:
null;this.shaderTechniqueConfig.textureFadingEnabled&&e.isSome(v)?(M(t.renderData.geometryInfo.uvOffsetAndScale,v.offsetAndScale,N),b.setUniform1f("textureFadeFactor",n),b.setUniform4fv("nextTexOffsetAndScale",N),f.bindTexture(v.texture.texture,1)):(b.setUniform1f("textureFadeFactor",1),f.bindTexture(this.emptyTex,1));t.renderData.textureIsFading&&this.setNeedsRender();b.setUniform1f("opacity",t.renderData.opacity)}n=this._renderPatch(f,b,t,l,k,d);t.renderOrder=this.numTilesRendered;this.numTilesRendered++;
this.numTrianglesRendered+=n/3}}}f.bindVAO(null)};k.prototype._renderPatch=function(a,b,c,d,e,f){"none"!==f&&(this._bindOverlayTextures(b,c.renderData.overlays,f),b.setUniform1f("overlayOpacity",c.renderData.overlayOpacity));e&&(this._useStencilForTile(c)?this.stencilShaderTechnique.bindPipelineState(a):this.shaderTechnique.bindPipelineState(a));e=0===this._skirtScale?c.renderData.geometryInfo.numWithoutSkirtIndices:c.renderData.vao.indexBuffer.size;a.bindVAO(c.renderData.vao);b.assertCompatibleVertexAttributeLocations(c.renderData.vao);
a.drawElements(d,e,c.renderData.vao.indexBuffer.indexType,0);return e};k.prototype._bindViewForPatchGroup=function(a,b,c,d){a.setUniform3fv("origin",b.origin);f.mat4.translate(P,d,b.origin);a.setUniformMatrix4fv("view",P);a.setUniform3f("camPos",c[0]-b.origin[0],c[1]-b.origin[1],c[2]-b.origin[2])};k.prototype._bindOverlayUniforms=function(a){a.setUniform1i("ovInnerColorTex",2);a.setUniform1i("ovOuterColorTex",3);a.setUniform1i("ovInnerWaterTex",4);a.setUniform1i("ovOuterWaterTex",5)};k.prototype._bindOverlayTextures=
function(a,b,c){for(var d=0;2>d;d++){var e=2*d,f=b[d];if(f.overlay){var g="colorAndWater"===c?f.overlay.renderTargets.color:"highlight"===c?f.overlay.renderTargets.highlight:f.overlay.renderTargets.occluded,h="colorAndWater"===c?f.overlay.renderTargets.water:null;R[e]=f.texOffset[0];R[e+1]=f.texOffset[1];O[e]=f.texScale[0];O[e+1]=f.texScale[1];e=g.fbo.getTexture();this.rctx.bindTexture(e,2+d);h?(h=h.fbo.getTexture(),this.rctx.bindTexture(h,4+d)):this.rctx.bindTexture(this.emptyTex,4+d)}else R[e]=
0,R[e+1]=0,O[e]=0,O[e+1]=0,this.rctx.bindTexture(this.emptyTex,2+d),this.rctx.bindTexture(this.emptyTex,4+d)}a.setUniform4fv("overlayTexOffset",R);a.setUniform4fv("overlayTexScale",O)};k.prototype._setTerrainTechnique=function(a,b){this.shaderTechniqueConfig.output=a;0===a&&(this.shaderTechniqueConfig.atmosphere="spherical"===this.manifold&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled);this.shaderTechniqueConfig.renderOccluded=b;this.shaderTechniqueConfig.stencilEnabled=
!1;this.shaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(L.TerrainTechnique,this.shaderTechniqueConfig,this.shaderTechnique);this.shaderTechniqueConfig.stencilEnabled=!0;this.stencilShaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(L.TerrainTechnique,this.shaderTechniqueConfig,this.stencilShaderTechnique)};k.prototype.releaseTileGeometry=function(a){a.releaseGeometry()&&this.setNeedsRender();this.renderDataPool.release(a)};k.prototype._prepareScaleRangeQueries=function(){for(var a=
this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&0<b.length;){var c=b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=a.length};k.prototype._processScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};Object.defineProperty(k.prototype,"test",{get:function(){return{tileRenderer:this.tileRenderer}},
enumerable:!1,configurable:!0});d.__decorate([m.property()],k.prototype,"tileBackgroundInitialized",void 0);d.__decorate([m.property()],k.prototype,"tileBackgroundUpdating",void 0);d.__decorate([m.property({constructOnly:!0})],k.prototype,"manifold",void 0);d.__decorate([m.property({constructOnly:!0})],k.prototype,"overlayRenderer",void 0);d.__decorate([m.property({readOnly:!0,dependsOn:["tileBackgroundInitialized","tileBackgroundUpdating"]})],k.prototype,"updating",null);d.__decorate([m.property({value:!1})],
k.prototype,"renderingDisabled",null);d.__decorate([m.property()],k.prototype,"renderPatchBorders",null);d.__decorate([m.property()],k.prototype,"cullBackFaces",null);d.__decorate([m.property({value:1})],k.prototype,"renderOrder",null);d.__decorate([m.property()],k.prototype,"wireframe",null);return k=d.__decorate([m.subclass("esri.views.3d.terrain.TerrainRenderer")],k)}(k);var P=b.mat4f64.create(),U=p.vec3f64.create(),Z=p.vec3f64.create(),V=p.vec3f64.create(),T=p.vec3f64.create(),Y=p.vec3f64.create(),
X="TerrainRenderer";return n})},"esri/views/3d/terrain/PatchRenderData":function(){define("require exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../geometry/support/aaBoundingBox ../support/buffer/glUtil ./PatchGeometryFactory ./PatchGeometryFactory ./TerrainConst ./TextureFader ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q){Object.defineProperty(a,"__esModule",{value:!0});a.PatchRenderData=void 0;n=function(){function a(){var a=this;this.overlayTexOffset=c.vec2f64.create();this.geometryInfo=new b.PatchGeometry;this._textureRef=new p.default(function(){return a.tile.surface.textureFadeDuration})}a.prototype.init=function(a){this.tile=a;this.clear();a=this.geometryInfo;a.indices=null;a.vertexAttributes=null;h.empty(a.boundingBox);a.numSurfaceIndices=0;a.numSkirtIndices=0;a.numWithoutSkirtIndices=
0;a.numVertsPerRow=0;this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1};this.opacity=1;if(this.overlays){a=0;for(var b=this.overlays;a<b.length;a++){var c=b[a];c.overlay=null;e.vec2.set(c.texScale,1,1);e.vec2.set(c.texOffset,0,0)}}else for(this.overlays=[null,null],a=0;2>a;a++)this.overlays[a]={overlay:null,texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};a.prototype.clear=function(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear()};
a.prototype.updateGeometry=function(a,b){if(!this._updateGeometryState(b))return!1;this._releaseGeometry();this._createGeometry(a);return!0};a.prototype.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},!0):!1};a.prototype.ensureTexture=function(a,b){k.isSome(this._texture)&&this._texture.descriptor.width!==a&&this.releaseTexture();this._texture||(this._texture=b(),this.tile.setMemoryDirty());return this._texture};
a.prototype.releaseTexture=function(){k.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};a.prototype._updateGeometryState=function(a){var b=this._getElevationInfo(),c=this.tile.level,e=8>c?this.tile.numSubdivisionsAtLevel[c]+1:2;b.samplerData&&(e=this.tile.maxTesselation,e=l.clamp((e>>Math.max(c-b.maxTileLevel,g.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-c)))+1,2,e+1));c=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)c=
null;var f=this.geometryState,h=!1;f.numVertsPerRow!==e&&(f.numVertsPerRow=e,h=!0);b.changed&&(f.samplerData=b.samplerData,h=!0);d.equals(f.clippingArea,c)||(f.clippingArea=c,h=!0);f.wireframe!==a&&(f.wireframe=a,h=!0);return h};a.prototype._createGeometry=function(a){this.tile.createGeometry(this.geometryState,this.localOrigin);var b=this.geometryInfo.vertexAttributes,c=this.geometryInfo.indices,d=a.gl;this._vao=new q(a,u.Default3D,{geometry:m.glLayout(b.layout)},{geometry:r.createVertex(a,d.STATIC_DRAW,
b.buffer)},r.createIndex(a,d.STATIC_DRAW,c))};a.prototype._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;f.releaseGeometry(this.geometryInfo);return!0};Object.defineProperty(a.prototype,"vao",{get:function(){return this._vao},enumerable:!1,configurable:!0});a.prototype.setTextureReference=function(a,b,c,d,e){void 0===e&&(e=0);a!==this._texture&&this.releaseTexture();this._textureRef.push(a,b,c,d,e)};Object.defineProperty(a.prototype,"textureReference",{get:function(){return this._textureRef.current},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"nextTextureReference",{get:function(){return this._textureRef.next},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"textureFadeFactor",{get:function(){return this._textureRef.fadeFactor},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"textureIsFading",{get:function(){return this._textureRef.isFading},enumerable:!1,configurable:!0});a.prototype._getElevationInfo=function(){for(var a=this.geometryState.samplerData,
b=this.tile.layerInfo[0],c=b.length,d=Array(c),e=0,f=0,g=!1,h=0;h<c;h++){var k=b[h];if(k.upsampleInfo){var k=k.upsampleInfo.tile,m=k.layerInfo[0][h].data,m=m&&m.samplerData;a&&a[e]===m||(g=!0);d[e++]=m;f=Math.max(f,k.lij[0])}else k.data&&(m=this.tile.surface.layerViewByIndex(h,0),t.fallsWithinLayer(this.tile,m.layer,!1)&&(m=k.data,a&&a[e]===m.samplerData||(g=!0),d[e++]=m.samplerData,f=this.tile.lij[0]))}a&&a.length!==e&&(g=!0);0<e?d.length=e:d=null;return{changed:g,samplerData:d,maxTileLevel:f}};
Object.defineProperty(a.prototype,"estimatedGeometryMemoryUsage",{get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"textureDescriptor",{get:function(){return k.isSome(this._texture)?this._texture.descriptor:null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"test",{get:function(){return{hasTexture:null!=this._texture}},enumerable:!1,configurable:!0});return a}();
a.PatchRenderData=n})},"esri/views/3d/terrain/TextureFader":function(){define(["require","exports","../../../core/maybe","../../../core/libs/gl-matrix-2/vec4f64"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.TextureReference=void 0;n=function(){function a(a){this._getFadeDuration=a;this._delayedTime=this._fadeStart=0}a.prototype.clear=function(){this._current=d.destroyMaybe(this._current);this._next=d.destroyMaybe(this._next);this._waiting=d.destroyMaybe(this._waiting);this._delayed=
d.destroyMaybe(this._delayed)};Object.defineProperty(a.prototype,"current",{get:function(){if(d.isNone(this._current))return null;if(!this._isFading){var a=this._delayed||this._waiting||this._next||this._current;a!==this._current&&(this._current=null,this.clear(),this._current=a)}a=performance.now();d.isSome(this._delayed)&&a>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null);d.isSome(this._next)&&a-this._fadeStart>=this._fadeDuration&&(d.destroyMaybe(this._current),this._current=
this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=a);return this._current},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"fadeFactor",{get:function(){if(d.isNone(this._next))return 1;var a=performance.now()-this._fadeStart,e=this._fadeDuration;return a>e?0:1-a/e},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isFading",{get:function(){return d.isSome(this._next)||
d.isSome(this._delayed)},enumerable:!1,configurable:!0});a.prototype.push=function(a,e,m,f,b){void 0===b&&(b=0);this._delayed=d.destroyMaybe(this._delayed);a=d.isSome(a)?new k(a,e,m,f):null;this._push(a,b)};a.prototype._push=function(a,e){this._isFading||this.clear();if(d.isNone(this._current))this._current=a;else{var c=performance.now();0!==e?(this._delayed=a,this._delayedTime=c+e):d.isNone(this._next)?(this._next=a,this._fadeStart=c):d.isNone(a)||(d.destroyMaybe(this._waiting),this._waiting=a)}};
Object.defineProperty(a.prototype,"_fadeDuration",{get:function(){return d.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"_isFading",{get:function(){return 0<this._getFadeDuration()},enumerable:!1,configurable:!0});return a}();a.default=n;var k=function(){function a(a,d,e,f){this.texture=a;a.retain();this.offsetAndScale=l.vec4f64.fromValues(d,e,f,f)}a.prototype.destroy=function(){this.texture.release()};
return a}();a.TextureReference=k})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../layers/support/layerUtils ../../webgl ../../2d/engine/vectorTiles/tileRendererHelper3D ../support/StreamDataLoader ./BlendLayersTechnique ./RasterColorizerTechnique ./terrainUtils ./terrainUtils ./TileTexture ./support/FBOPool ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/rasterUtils ../../webgl/Util".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z){function x(a,b,c){c.layerIndex=b;var d=a.layerInfo[1][b];return d.data?(k.vec2.set(c.offset,0,0),c.tile=a,c.scale=1,c.sourceLod=a.lij,c.sourceLayerInfo=d,c):(a=d.upsampleInfo)?(b=a.tile.layerInfo[1][b],c.tile=a.tile,k.vec2.copy(c.offset,a.offset),c.scale=a.scale,c.sourceLod=a.tile.lij,c.sourceLayerInfo=b,c):null}var B=[],A={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0};return function(){function a(a,c,d){this._rctx=
a;this.tileSize=c;this._blackTex=this._backgroundTexture=null;this._vectorTileHelper=new m.VectorTileRendererHelper3D;this._rctx.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy);this._vaoQuad=v.createQuadVAO(this._rctx,q.Pos2Tex);a=new b.BlendLayersTechniqueConfiguration;a.mode=2;this._blendLayersTechnique=d.acquireAndReleaseExisting(b.BlendLayersTechnique,a,this._blendLayersTechnique);a.mode=1;this._applyOpacityTechnique=d.acquireAndReleaseExisting(b.BlendLayersTechnique,
a,this._applyOpacityTechnique);this._techniqueRep=d;this._blackTex=new u.TileTexture(v.createColorTexture(this._rctx,[0,0,0,1]));this._fboPool=new r.FBOPool(this._rctx)}a.prototype.dispose=function(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);l.isSome(this._backgroundTexture)&&(this._backgroundTexture.release(),this._backgroundTexture=null);this._blackTex&&(this._blackTex.release(),this._blackTex=null);this._blendLayersTechnique&&
(this._blendLayersTechnique.dispose(),this._blendLayersTechnique=null);this._applyOpacityTechnique&&(this._applyOpacityTechnique.dispose(),this._applyOpacityTechnique=null);this._rasterColorizerTechnique&&(this._rasterColorizerTechnique.dispose(),this._rasterColorizerTechnique=null);this._vectorTileHelper&&(this._vectorTileHelper.dispose(),this._vectorTileHelper=null)};a.prototype.updateTileTexture=function(a){for(var b=a.layerInfo[1],e=0;e<b.length;e++)b[e].pendingUpdates&=-65;if(a.renderData){for(var f=
a.surface,g=f.baseOpacity,h=0,e=0,k=this.tileSize,m=!1,r=f.view.pixelRatio,q=b.length,t=0;t<b.length&&!m;t++){var u=f.layerViewByIndex(t,1),n=u.fullOpacity;B[t]=n;c.isBaseLayer(u.layer)&&q>=b.length&&(q=t);if(0!==n){++e;var v=x(a,t,A);v&&(p.isVectorTileLayerView(u)?k=Math.max(k,this.tileSize*r):1===g&&1===n&&(u.isOpaque||this._dataToTexture(v)&&l.isSome(v.sourceLayerInfo.data)&&v.sourceLayerInfo.data.descriptor.isOpaque)&&(m=!0),++h)}}this._cleanupFBOPool(r,b.length);g=k;k=d.nextHighestPowerOfTwo(g);
b=k*k;f=g*g;b===f?k=g:(g=k/2,k=b-f<f-g*g?k:g);b=k/this.tileSize;--t;if(0===h){h=0;if(a.surface.view.layerViewManager.updating||0<e)h=5E3;this._backgroundTexture&&l.isNone(a.renderData.textureReference)&&(h=0);this._useBackgroundTexture(a,h)}else 1===h&&m?this._useLayerTexture(a,t):this._composeMapLayers(a,t,q,m,B,k,b)}};a.prototype.setBackground=function(a){l.isSome(this._backgroundTexture)&&this._backgroundTexture.release();this._backgroundTexture=a instanceof HTMLImageElement?this._buildTexture(a):
new u.TileTexture(v.createColorTexture(this._rctx,a))};a.prototype._buildTexture=function(a){if(l.isNone(a))return null;var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},c=this._rctx,d;if("number"===typeof a)b.width=b.height=a,d=new u.TileTexture(new h.Texture(c,b));else if(a instanceof f.ImageWithType)b.isOpaque=a.isOpaque,d=new u.TileTexture(new h.Texture(c,b,a.image)),a.release();else try{d=new u.TileTexture(new h.Texture(c,
b,a))}catch(J){d=new u.TileTexture(v.createEmptyTexture(c)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}c.bindTexture(d.texture);d.generateMipmap();return d};a.prototype._drawQuad=function(a){this._rctx.bindVAO(this._vaoQuad);a.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(5,0,z.vertexCount(this._vaoQuad,"geometry"))};a.prototype._drawRasterData=function(a,b,c,d,e){void 0===e&&(e=1);if(!l.isNone(b)){var f=this._rctx,
g=a.program;f.setPipelineState(a.pipeline);f.bindProgram(g);f.bindTexture(b,0);g.setUniform1i("tex",0);g.setUniform1f("scale",c);g.setUniform2f("offset",d[0],d[1]);g.setUniform1f("opacity",e);this._drawQuad(g)}};a.prototype._drawImageryTileData=function(a,b){void 0===b&&(b=1);var c=a.sourceLayerInfo.data;if(!l.isNone(c)&&c.source){a.tile.surface.layerViewByIndex(a.layerIndex,1).ensureSymbolizerParameters(c);var d=this._getRasterColorizerTechnique(c.symbolizerParameters.type,!!c.symbolizerParameters.colormap),
e=this._rctx,f=d.program;e.setPipelineState(d.pipeline);e.bindProgram(f);c.bind(e)&&(c.opacity=b,c.scale=a.scale,c.offset=a.offset,a=c.getTextures(),w.setTextures(e,f,a.names,a.textures),c=c.getUniforms(),d.bindPass(e,c),this._drawQuad(f),e.bindVAO())}};a.prototype._getRasterColorizerTechnique=function(a,b){a=["stretch","lut","hillshade"].indexOf(a);this._rasterColorizerConfig||(this._rasterColorizerConfig=new g.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),
this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.colorizerType=a;this._rasterColorizerConfig.applyColormap=b;return this._rasterColorizerTechnique=this._techniqueRep.acquireAndReleaseExisting(g.RasterColorizerTechnique,this._rasterColorizerConfig,this._rasterColorizerTechnique)};a.prototype._drawVectorData=function(a,b,c,d,e,f,g){var h=b.sourceLayerInfo.data;if(l.isNone(h))return g;var k=this._rctx,m=b.tile.surface.layerViewByIndex(b.layerIndex,1),p;k.setPipelineState(a.pipeline);
var r=1>d;r?(p=this._fboPool.acquire(e),k.bindFramebuffer(p),k.setClearColor(1,1,1,0),k.clearSafe(16640)):g&&k.clearSafe(256);this._vectorTileHelper.render(k,b.sourceLod,h,m.painter,m.layer.styleRepository,m.schemaHelper,Math.round(1/b.scale),b.offset,this.tileSize,c);return r?(k.bindFramebuffer(f),this._drawRasterData(a,p.colorTexture,1,[0,0],d),this._fboPool.release(p),g):!0};a.prototype._useBackgroundTexture=function(a,b){a.renderData.opacity=a.surface.baseOpacity;a.renderData.setTextureReference(this._backgroundTexture,
0,0,1,b)};a.prototype._useLayerTexture=function(a,b){a.renderData.opacity=a.surface.baseOpacity;b=x(a,b,A);if(this._dataToTexture(b)){var c=b.offset;a.renderData.setTextureReference(b.sourceLayerInfo.data,c[0],c[1],b.scale)}};a.prototype._composeMapLayers=function(a,b,c,d,f,g,h){var k=this,m=a.renderData.ensureTexture(g,function(){return k._buildTexture(g)});if(!l.isNone(m)){var r=this._rctx,q=this._fboPool.acquire(g);r.bindFramebuffer(q);r.setViewport(0,0,g,g);r.setClearColor(0,0,0,0);r.setClearDepth(1);
r.clearSafe(16640);var t=!1;!d&&l.isSome(this._backgroundTexture)&&this._drawRasterData(this._blendLayersTechnique,this._backgroundTexture.texture,1,e.vec2f64.ZEROS);d=a.surface.baseOpacity;for(var u=!1;0<=b;b--){var n=x(a,b,A);n&&(b<c&&1>d&&!u&&(this._drawRasterData(this._applyOpacityTechnique,this._blackTex.texture,1,e.vec2f64.ZEROS,d),u=!0),0!==f[b]&&(p.isVectorTileRenderInfo(n)?t=this._drawVectorData(this._blendLayersTechnique,n,h,f[b],g,q,t):p.isImageryTileRenderInfo(n)?this._drawImageryTileData(n,
f[b]):this._dataToTexture(n)&&l.isSome(n.sourceLayerInfo.data)&&this._drawRasterData(this._blendLayersTechnique,n.sourceLayerInfo.data.texture,n.scale,n.offset,f[b])))}r.bindTexture(m.texture);c=m.descriptor;r.gl.copyTexImage2D(r.gl.TEXTURE_2D,0,c.pixelFormat,0,0,c.width,c.height,0);m.generateMipmap();r.bindFramebuffer(null);this._fboPool.release(q);a.renderData.opacity=u?1:d;a.renderData.setTextureReference(m,0,0,1)}};a.prototype._dataToTexture=function(a){t.isRasterTileRenderInfo(a)&&this._rasterDataToTexture(a);
return p.isTextureTileRenderInfo(a)};a.prototype._rasterDataToTexture=function(a){var b=a.sourceLayerInfo;b.data=this._buildTexture(b.data);a.tile.setMemoryDirty()};a.prototype._cleanupFBOPool=function(a,b){if(a!==this._lastPixelRatio||b!==this._lastNumLayers)this._fboPool.clear(),this._lastPixelRatio=a,this._lastNumLayers=b};Object.defineProperty(a.prototype,"test",{get:function(){return{backgroundTexture:this._backgroundTexture}},enumerable:!1,configurable:!0});return a}()})},"esri/views/2d/engine/vectorTiles/tileRendererHelper3D":function(){define(["require",
"exports","../../../../geometry","../../../../Viewpoint","../../ViewState"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.VectorTileRendererHelper3D=void 0;n=function(){function a(){this.renderParams={context:null,drawPhase:1,state:new k({viewpoint:new l({targetGeometry:new d.Point(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerId:-1,painter:null,glyphMosaic:null,
spriteMosaic:null,driverTestResult:null,profiler:null,renderingOptions:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1}}a.prototype.dispose=function(){this.renderParams=null};a.prototype.render=function(a,d,e,f,b,g,k,l,u,r){var c=g.adjustLevel(d[0]),h=this.renderParams;h.context=a;h.painter=f;h.glyphMosaic=f.glyphMosaic;h.spriteMosaic=f.spriteMosaic;h.pixelRatio=r;h.displayLevel=c;h.requiredLevel=c;f.setContext(a);r=g.getScale(d[0]);
g=g.getShift(d,k*r);d=g[0];g=g[1];r=.125*k*r/u;c=e.transforms.dvs;c[0]=r;c[4]=-r;c[6]=-1-d-l[0]*k*2;c[7]=1+g+(1-l[1])*k*2-2;h.state.size[0]=u;h.state.size[1]=u;e.stage||e.attachWithContext(a);e.triangleCount=0;f.drawTile(h,e,b)};return a}();a.VectorTileRendererHelper3D=n})},"esri/views/2d/ViewState":function(){define("require exports tslib ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df32 ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f32 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f32 ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v){var w=[0,0];return function(a){function e(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];c=a.apply(this,c)||this;c._viewpoint2D={center:r.vec2f64.create(),rotation:0,scale:0,spatialReference:null};c.center=[0,0];c.extent=new l.Extent;c.id=0;c.inverseTransform=b.mat2df64.create();c.resolution=0;c.rotation=0;c.scale=0;c.transform=b.mat2df64.create();c.transformNoRotation=b.mat2df64.create();c.displayMat3=p.mat3f32.create();c.displayViewMat3=
p.mat3f32.create();c.viewMat3=p.mat3f32.create();c.viewMat2d=f.mat2df32.create();c.worldScreenWidth=0;c.size=[0,0];return c}d.__extends(e,a);n=e;Object.defineProperty(e.prototype,"pixelRatio",{set:function(a){this._set("pixelRatio",a);this._update()},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"size",{set:function(a){this._set("size",a);this._update()},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"viewpoint",{set:function(a){if(a){var b=this._viewpoint2D,
c=a.targetGeometry;b.center[0]=c.x;b.center[1]=c.y;b.rotation=a.rotation;b.scale=a.scale;b.spatialReference=c.spatialReference}this._update()},enumerable:!1,configurable:!0});e.prototype.copy=function(a){var b=this.size,c=this.viewpoint;c&&b?(this.viewpoint=v.copy(c,a.viewpoint),this._set("size",t.vec2.copy(b,a.size))):(this.viewpoint=a.viewpoint.clone(),this._set("size",[a.size[0],a.size[1]]));this._set("pixelRatio",a.pixelRatio);return this};e.prototype.clone=function(){return new n({size:this.size,
viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};e.prototype.toMap=function(a,b,c){if(q.isVec2(b))return t.vec2.transformMat2d(a,b,this.inverseTransform);w[0]=b;w[1]=c;return t.vec2.transformMat2d(a,w,this.inverseTransform)};e.prototype.toScreen=function(a,b,c){if(q.isVec2(b))return t.vec2.transformMat2d(a,b,this.transform);w[0]=b;w[1]=c;return t.vec2.transformMat2d(a,w,this.transform)};e.prototype.toScreenNoRotation=function(a,b,c){if(q.isVec2(b))return t.vec2.transformMat2d(a,b,this.transformNoRotation);
w[0]=b;w[1]=c;return t.vec2.transformMat2d(a,w,this.transformNoRotation)};e.prototype.getScreenTransform=function(a,b){var c=this._viewpoint2D.center,d=this._get("pixelRatio")||1,e=this._get("size");v.getMatrix(a,c,e,b,0,d);return a};e.prototype._update=function(){var a=this._viewpoint2D,b=a.center,c=a.spatialReference,d=a.scale,e=a.rotation,a=this._get("pixelRatio")||1,f=this._get("size"),p=new k({targetGeometry:new l.Point(b[0],b[1],c),scale:d,rotation:e});this._set("viewpoint",p);if(f&&c&&d)return this.resolution=
v.getResolution(p),this.rotation=e,this.scale=d,this.spatialReference=c,t.vec2.copy(this.center,b),g.mat3.set(this.displayMat3,0!==f[0]?2/f[0]:0,0,0,0,0!==f[1]?-2/f[1]:0,0,-1,1,1),d=g.mat3.identity(this.viewMat3),b=u.vec2f32.fromValues(f[0]/2,f[1]/2),c=u.vec2f32.fromValues(-f[0]/2,-f[1]/2),e=h.common.toRadian(e),g.mat3.translate(d,d,b),g.mat3.rotate(d,d,e),g.mat3.translate(d,d,c),g.mat3.multiply(this.displayViewMat3,this.displayMat3,d),d=m.mat2d.identity(this.viewMat2d),m.mat2d.translate(d,d,b),m.mat2d.rotate(d,
d,e),m.mat2d.translate(d,d,c),v.getExtent(this.extent,p,f),v.getTransform(this.transform,p,f,a),m.mat2d.invert(this.inverseTransform,this.transform),v.getTransformNoRotation(this.transformNoRotation,p,f,a),this.worldScreenWidth=v.getWorldScreenWidth(this.spatialReference,this.resolution),this._set("id",this.id+1),this};var n;d.__decorate([c.property({readOnly:!0})],e.prototype,"id",void 0);d.__decorate([c.property({value:1,json:{write:!0}})],e.prototype,"pixelRatio",null);d.__decorate([c.property({json:{write:!0}})],
e.prototype,"size",null);d.__decorate([c.property({type:k,json:{write:!0}})],e.prototype,"viewpoint",null);return e=n=d.__decorate([c.subclass("esri.views.2d.ViewState")],e)}(e.JSONSupport)})},"esri/core/libs/gl-matrix-2/common":function(){define(["require","exports","./math/common"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.common=void 0;a.common=d})},"esri/core/libs/gl-matrix-2/mat2d":function(){define(["require","exports","./math/mat2d"],function(n,a,d){Object.defineProperty(a,
"__esModule",{value:!0});a.mat2d=void 0;a.mat2d=d})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["require","exports","./common"],function(n,a,d){function l(a,c,d){var e=c[0],f=c[1],b=c[2],g=c[3],h=c[4];c=c[5];var k=d[0],l=d[1],r=d[2],q=d[3],n=d[4];d=d[5];a[0]=e*k+b*l;a[1]=f*k+g*l;a[2]=e*r+b*q;a[3]=f*r+g*q;a[4]=e*n+b*d+h;a[5]=f*n+g*d+c;return a}function k(a,c,d){a[0]=c[0]-d[0];a[1]=c[1]-d[1];a[2]=c[2]-d[2];a[3]=c[3]-d[3];a[4]=c[4]-d[4];a[5]=c[5]-d[5];return a}Object.defineProperty(a,
"__esModule",{value:!0});a.sub=a.mul=a.equals=a.exactEquals=a.multiplyScalarAndAdd=a.multiplyScalar=a.subtract=a.add=a.frob=a.str=a.fromTranslation=a.fromScaling=a.fromRotation=a.translate=a.scale=a.rotate=a.multiply=a.determinant=a.invert=a.set=a.identity=a.copy=void 0;a.copy=function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];return a};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};a.set=function(a,c,d,k,f,b,g){a[0]=c;a[1]=d;a[2]=k;a[3]=f;a[4]=b;
a[5]=g;return a};a.invert=function(a,c){var d=c[0],e=c[1],f=c[2],b=c[3],g=c[4];c=c[5];var k=d*b-e*f;if(!k)return null;k=1/k;a[0]=b*k;a[1]=-e*k;a[2]=-f*k;a[3]=d*k;a[4]=(f*c-b*g)*k;a[5]=(e*g-d*c)*k;return a};a.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};a.multiply=l;a.rotate=function(a,c,d){var e=c[0],f=c[1],b=c[2],g=c[3],h=c[4];c=c[5];var k=Math.sin(d);d=Math.cos(d);a[0]=e*d+b*k;a[1]=f*d+g*k;a[2]=e*-k+b*d;a[3]=f*-k+g*d;a[4]=h;a[5]=c;return a};a.scale=function(a,c,d){var e=c[1],f=c[2],b=c[3],
g=c[4],h=c[5],k=d[0];d=d[1];a[0]=c[0]*k;a[1]=e*k;a[2]=f*d;a[3]=b*d;a[4]=g;a[5]=h;return a};a.translate=function(a,c,d){var e=c[0],f=c[1],b=c[2],g=c[3],h=c[4];c=c[5];var k=d[0];d=d[1];a[0]=e;a[1]=f;a[2]=b;a[3]=g;a[4]=e*k+b*d+h;a[5]=f*k+g*d+c;return a};a.fromRotation=function(a,c){var d=Math.sin(c);c=Math.cos(c);a[0]=c;a[1]=d;a[2]=-d;a[3]=c;a[4]=0;a[5]=0;return a};a.fromScaling=function(a,c){a[0]=c[0];a[1]=0;a[2]=0;a[3]=c[1];a[4]=0;a[5]=0;return a};a.fromTranslation=function(a,c){a[0]=1;a[1]=0;a[2]=
0;a[3]=1;a[4]=c[0];a[5]=c[1];return a};a.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};a.add=function(a,c,d){a[0]=c[0]+d[0];a[1]=c[1]+d[1];a[2]=c[2]+d[2];a[3]=c[3]+d[3];a[4]=c[4]+d[4];a[5]=c[5]+d[5];return a};a.subtract=k;a.multiplyScalar=function(a,c,d){a[0]=c[0]*d;a[1]=c[1]*d;a[2]=c[2]*d;a[3]=c[3]*d;a[4]=c[4]*d;
a[5]=c[5]*d;return a};a.multiplyScalarAndAdd=function(a,c,d,k){a[0]=c[0]+d[0]*k;a[1]=c[1]+d[1]*k;a[2]=c[2]+d[2]*k;a[3]=c[3]+d[3]*k;a[4]=c[4]+d[4]*k;a[5]=c[5]+d[5]*k;return a};a.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]};a.equals=function(a,c){var e=a[0],k=a[1],f=a[2],b=a[3],g=a[4];a=a[5];var l=c[0],t=c[1],u=c[2],r=c[3],q=c[4];c=c[5];return Math.abs(e-l)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(l))&&Math.abs(k-t)<=d.EPSILON*Math.max(1,
Math.abs(k),Math.abs(t))&&Math.abs(f-u)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(u))&&Math.abs(b-r)<=d.EPSILON*Math.max(1,Math.abs(b),Math.abs(r))&&Math.abs(g-q)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(q))&&Math.abs(a-c)<=d.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};a.mul=l;a.sub=k})},"esri/core/libs/gl-matrix-2/mat2df32":function(){define(["require","exports","./factories/mat2df32"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.mat2df32=void 0;a.mat2df32=d})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["require",
"exports"],function(n,a){function d(a,d,e,c){var h=d[c];d=d[c+1];a[c]=e[0]*h+e[2]*d+e[4];a[c+1]=e[1]*h+e[3]*d+e[5]}Object.defineProperty(a,"__esModule",{value:!0});a.transformMany=a.transform=a.createView=a.fromValues=a.clone=a.create=void 0;a.create=function(){var a=new Float32Array(6);a[0]=1;a[3]=1;return a};a.clone=function(a){var d=new Float32Array(6);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];return d};a.fromValues=function(a,d,e,c,h,m){var f=new Float32Array(6);f[0]=a;f[1]=
d;f[2]=e;f[3]=c;f[4]=h;f[5]=m;return f};a.createView=function(a,d){return new Float32Array(a,d,6)};a.transform=d;a.transformMany=function(a,k,e,c,h,m){void 0===c&&(c=0);void 0===h&&(h=0);void 0===m&&(m=2);for(h=h||k.length/m;c<h;c++)d(a,k,e,c*m)}})},"esri/core/libs/gl-matrix-2/mat2df64":function(){define(["require","exports","./factories/mat2df64"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.mat2df64=void 0;a.mat2df64=d})},"esri/core/libs/gl-matrix-2/factories/mat2df64":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.createView=a.fromValues=a.clone=a.create=void 0;a.create=function(){return[1,0,0,1,0,0]};a.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5]]};a.fromValues=function(a,l,k,e,c,h){return[a,l,k,e,c,h]};a.createView=function(a,l){return new Float64Array(a,l,6)}})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["require","exports"],function(n,a){function d(a){return a instanceof Float32Array&&2<=a.length}function l(a){return Array.isArray(a)&&
2<=a.length}Object.defineProperty(a,"__esModule",{value:!0});a.isVec2=a.isVec2f64=a.isVec2f32=void 0;a.isVec2f32=d;a.isVec2f64=l;a.isVec2=function(a){return d(a)||l(a)}})},"esri/views/2d/viewpointUtils":function(){define("require exports tslib ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/promiseUtils ../../core/unitUtils ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/geodesicConstants ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../../geometry/support/webMercatorUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x){function B(a,b,c,d){return d&&c&&!d.equals(c)&&z.canProject(d,c)&&d.isWebMercator?(d.isWebMercator?(c=b[1],89.99999<c?c=89.99999:-89.99999>c&&(c=-89.99999),c=Math.sin(m.common.toRadian(c)),a=g.vec2.set(a,m.common.toRadian(b[0])*v.earthRadius,.5*v.earthRadius*Math.log((1+c)/(1-c)))):(c=m.common.toDegree(b[0]/v.earthRadius),a=g.vec2.set(a,c-360*Math.floor((c+180)/360),m.common.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*b[1]/v.earthRadius))))),a):
g.vec2.copy(a,b)}function A(a){return a.wkid?a:a.spatialReference||q.WGS84}function C(a,b){return b.type?g.vec2.set(a,b.x,b.y):g.vec2.copy(a,b)}function E(a,b){return Math.max(a.width/b[0],a.height/b[1])*R(a.spatialReference)}function G(a,b,f,g){return d.__awaiter(this,void 0,void 0,function(){var h,m,l,p,q,n,v,w,x,B,A,C,I,H,F,E,Q,K,J,L,M,R,S,aa,P,O,N,y;return d.__generator(this,function(d){switch(d.label){case 0:if(!a||Array.isArray(a)&&!a.length)return[2,null];k.isCollection(a)&&(a=a.toArray());
if(!Array.isArray(a)||!a.length||"object"!==typeof a[0])return[3,7];m=a.every(function(a){return"attributes"in a});l=a.some(function(a){return!a.geometry});p=a;if(!(m&&l&&b&&b.allLayerViews))return[3,2];q=new Map;n=0;for(v=a;n<v.length;n++)w=v[n],x=w.layer,B=q.get(x)||[],A=w.attributes[x.objectIdField],null!=A&&B.push(A),q.set(x,B);C=[];q.forEach(function(a,c){var d=b.allLayerViews.find(function(a){return a.layer.id===c.id});if("queryFeatures"in d){var e=c.createQuery();e.objectIds=a;e.returnGeometry=
!0;C.push(d.queryFeatures(e))}});return[4,c.all(C)];case 1:I=d.sent();H=[];F=0;for(E=I;F<E.length;F++)if((Q=E[F])&&Q.features&&Q.features.length)for(K=0,J=Q.features;K<J.length;K++)w=J[K],e.isSome(w.geometry)&&H.push(w.geometry);p=H;d.label=2;case 2:L=0,M=p,d.label=3;case 3:if(!(L<M.length))return[3,6];R=M[L];return[4,G(R,b,f,g)];case 4:g=d.sent(),d.label=5;case 5:return L++,[3,3];case 6:return[2,g];case 7:if(!Array.isArray(a)||2!==a.length||"number"!==typeof a[0]||"number"!==typeof a[1])return[3,
8];h=new r(a);return[3,12];case 8:if(!(a instanceof u))return[3,9];h=a;return[3,12];case 9:if(!("geometry"in a))return[3,12];if(!a.geometry)return[3,10];h=a.geometry;return[3,12];case 10:if(!a.layer)return[3,12];S=a.layer;aa=b.allLayerViews.find(function(a){return a.layer.id===S.id});if(!("queryFeatures"in aa))return[3,12];P=S.createQuery();P.objectIds=[a.attributes[S.objectIdField]];P.returnGeometry=!0;return[4,aa.queryFeatures(P)];case 11:O=d.sent(),h=e.get(O,"features",0,"geometry"),d.label=12;
case 12:if(e.isNone(h))return[2,null];N="point"===h.type?new t({xmin:h.x,ymin:h.y,xmax:h.x,ymax:h.y,spatialReference:h.spatialReference}):h.extent;if(!N)return[2,null];y=z.canProject(N,f);if(!N.spatialReference.equals(f)&&y)N=z.project(N,f);else if(!y)return[2,null];g=g?g.union(N):N.clone();return[2,g]}})})}function F(a){if(a&&(!Array.isArray(a)||"number"!==typeof a[0])&&("object"===typeof a||Array.isArray(a)&&"object"===typeof a[0])){if("layer"in a&&a.layer&&a.layer.minScale&&a.layer.maxScale){var b=
a.layer;return{min:b.minScale,max:b.maxScale}}if(Array.isArray(a)&&a.length&&a.every(function(a){return"layer"in a})){for(var c=0,d=0,e=0;e<a.length;e++)(b=a[e].layer)&&b.minScale&&b.maxScale&&(c=b.minScale<c?b.minScale:c,d=b.maxScale>d?b.maxScale:d);return c&&d?{min:c,max:d}:null}}}function H(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g,h,k,m,q,u,n,v,w,I,H,Q,K,J,L,M,R;return d.__generator(this,function(d){switch(d.label){case 0:if(!a||!b)return[2,new l({targetGeometry:new r,
scale:0,rotation:0})];c=b.spatialReference;e=b.constraints;f=b.padding;g=b.viewpoint;h=b.size;k=f?h[0]-f.left-f.right:h[0];m=f?h[1]-f.top-f.bottom:h[1];q=[k,m];u=null;a instanceof l?u=a:a.viewpoint?u=a.viewpoint:a.target&&"esri.Viewpoint"===a.target.declaredClass&&(u=a.target);n=null;if(!u||!u.targetGeometry)return[3,1];n=u.targetGeometry;return[3,10];case 1:if(!(a instanceof t))return[3,2];n=a;return[3,10];case 2:return a||a&&("center"in a||"extent"in a||"target"in a)?[4,G(a.center,b,c)]:[3,10];
case 3:return(I=d.sent())?[3,5]:[4,G(a.extent,b,c)];case 4:I=d.sent(),d.label=5;case 5:return(w=I)?[3,7]:[4,G(a.target,b,c)];case 6:w=d.sent(),d.label=7;case 7:return(v=w)?[3,9]:[4,G(a,b,c)];case 8:v=d.sent(),d.label=9;case 9:n=v,d.label=10;case 10:!n&&g&&g.targetGeometry?n=g.targetGeometry:!n&&b.extent&&(n=b.extent);H=A(n);c||(c=A(b.spatialReference||b.extent||n));if(!x.canProject(n,c)&&H&&!H.equals(c))return[2,null];Q=C(p.vec2f64.create(),n.center?n.center:n);K=new r(B(Q,Q,H,c),c);J=null;J=u&&u.targetGeometry&&
"point"===u.targetGeometry.type?u.scale:a.hasOwnProperty("scale")&&a.scale?a.scale:a.hasOwnProperty("zoom")&&-1!==a.zoom&&e&&e.effectiveLODs?e.zoomToScale(a.zoom):Array.isArray(n)||"point"===n.type||"extent"===n.type&&0===n.width&&0===n.height?b.extent&&z.canProject(b.extent,c)?E(z.project(b.extent,c),q):b.extent?E(b.extent,q):g.scale:z.canProject(n.extent,c)?E(z.project(n.extent,c),q):E(n.extent,q);if(L=F(a))L.min&&L.min>J?J=L.min:L.max&&L.max<J&&(J=L.max);M=0;u?M=u.rotation:a.hasOwnProperty("rotation")?
M=a.rotation:g&&(M=g.rotation);R=new l({targetGeometry:K,scale:J,rotation:M});e&&(R=e.fit(R),e.constrainByGeometry(R),e.rotationEnabled||(R.rotation=M));return[2,R]}})})}function J(a,b){var c=a.targetGeometry,d=b.targetGeometry;c.x=d.x;c.y=d.y;c.spatialReference=d.spatialReference;a.scale=b.scale;a.rotation=b.rotation;return a}function I(a,b,c){return c?g.vec2.set(a,.5*(b[0]-c.right+c.left),.5*(b[1]-c.bottom+c.top)):g.vec2.scale(a,b,.5)}function K(b,c,d,e){a.getTransform(b,c,d,e);return f.mat2d.invert(b,
b)}function L(a,b,c){var d=Q(b);b=Math.abs(Math.cos(d));d=Math.abs(Math.sin(d));return g.vec2.set(a,Math.round(c[1]*d+c[0]*b),Math.round(c[1]*b+c[0]*d))}function M(a){var b=a.scale;a=a.targetGeometry.spatialReference;a=w.isValid(a)?1/(39.37*h.getMetersPerUnitForSR(a)*96):1;return b*a}function Q(a){return m.common.toRadian(a.rotation)||0}function R(a){return w.isValid(a)?39.37*h.getMetersPerUnitForSR(a)*96:1}function O(a){return a.isWrappable?(a=w.getInfo(a),a.valid[1]-a.valid[0]):0}Object.defineProperty(a,
"__esModule",{value:!0});a.translateBy=a.toScreen=a.toMap=a.padAndScaleAndRotateBy=a.scaleAndRotateBy=a.scaleTo=a.scaleBy=a.rotateTo=a.rotateBy=a.resize=a.pixelSize=a.centerAt=a.removePadding=a.addPadding=a.angleBetween=a.createAsync=a.getWorldScreenWidth=a.getWorldWidth=a.getTransformNoRotation=a.getTransform=a.getMatrix=a.getResolutionToScaleFactor=a.getResolution=a.getPaddingMapTranslation=a.getPaddingScreenTranslation=a.getOuterSize=a.getOuterExtent=a.setExtent=a.getExtent=a.getAnchor=a.copy=
a.create=a.extentToScale=void 0;var N=180/Math.PI;a.extentToScale=E;a.create=H;a.copy=J;a.getAnchor=I;a.getExtent=function(){var a=p.vec2f64.create();return function(b,c,d){var e=c.targetGeometry;C(a,e);c=.5*M(c);b.xmin=a[0]-c*d[0];b.ymin=a[1]-c*d[1];b.xmax=a[0]+c*d[0];b.ymax=a[1]+c*d[1];b.spatialReference=e.spatialReference;return b}}();a.setExtent=function(b,c,d,e,f){a.centerAt(b,c,d.center);b.scale=E(d,e);f&&f.constraints&&f.constraints.constrain(b);return b};a.getOuterExtent=function(){var a=
p.vec2f64.create(),b=p.vec2f64.create();return function(c,d,e){C(a,d.targetGeometry);L(b,d,e);e=.5*M(d);c.set({xmin:a[0]-e*b[0],ymin:a[1]-e*b[1],xmax:a[0]+e*b[0],ymax:a[1]+e*b[1],spatialReference:d.targetGeometry.spatialReference});return c}}();a.getOuterSize=L;a.getPaddingScreenTranslation=function(){var a=p.vec2f64.create();return function(b,c,d){return g.vec2.sub(b,g.vec2.scale(b,c,.5),I(a,c,d))}}();a.getPaddingMapTranslation=function(){var c=b.mat2df64.create(),d=p.vec2f64.create();return function(b,
e,h,k){var m=M(e);e=Q(e);g.vec2.set(d,m,m);f.mat2d.fromScaling(c,d);f.mat2d.rotate(c,c,e);f.mat2d.translate(c,c,a.getPaddingScreenTranslation(d,h,k));f.mat2d.translate(c,c,[0,k.top-k.bottom]);return g.vec2.set(b,c[4],c[5])}}();a.getResolution=M;a.getResolutionToScaleFactor=R;a.getMatrix=function(){var a=p.vec2f64.create(),b=p.vec2f64.create(),c=p.vec2f64.create();return function(d,e,h,k,m,l){g.vec2.negate(a,e);g.vec2.scale(b,h,.5*l);g.vec2.set(c,1/k*l,-1/k*l);f.mat2d.identity(d);f.mat2d.translate(d,
d,b);m&&f.mat2d.rotate(d,d,m);f.mat2d.scale(d,d,c);f.mat2d.translate(d,d,a);return d}}();a.getTransform=function(){var b=p.vec2f64.create();return function(c,d,e,f){var g=M(d),h=Q(d);C(b,d.targetGeometry);return a.getMatrix(c,b,e,g,h,f)}}();a.getTransformNoRotation=function(){var b=p.vec2f64.create();return function(c,d,e,f){var g=M(d);C(b,d.targetGeometry);return a.getMatrix(c,b,e,g,0,f)}}();a.getWorldWidth=O;a.getWorldScreenWidth=function(a,b){return Math.round(O(a)/b)};a.createAsync=function(a,
b){return H(a,b)};a.angleBetween=function(){var a=p.vec2f64.create(),b=p.vec2f64.create(),c=[0,0,0];return function(d,e,f){g.vec2.subtract(a,d,e);g.vec2.normalize(a,a);g.vec2.subtract(b,d,f);g.vec2.normalize(b,b);g.vec2.cross(c,a,b);d=Math.acos(g.vec2.dot(a,b)/(g.vec2.length(a)*g.vec2.length(b)))*N;0>c[2]&&(d=-d);isNaN(d)&&(d=0);return d}}();a.addPadding=function(){var b=p.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;J(c,d);a.getPaddingMapTranslation(b,d,e,f);g.x+=b[0];g.y+=b[1];
return c}}();a.removePadding=function(){var b=p.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;J(c,d);a.getPaddingMapTranslation(b,d,e,f);g.x-=b[0];g.y-=b[1];return c}}();a.centerAt=function(){var a=p.vec2f64.create();return function(b,c,d){J(b,c);c=b.targetGeometry;var e=A(d),f=A(c);C(a,d);B(a,a,e,f);c.x=a[0];c.y=a[1];return b}}();a.pixelSize=function(a){return M(a)};a.resize=function(){var b=p.vec2f64.create();return function(c,d,e,f,h){h||(h="center");g.vec2.sub(b,e,f);g.vec2.scale(b,
b,.5);e=b[0];f=b[1];switch(h){case "center":g.vec2.set(b,0,0);break;case "left":g.vec2.set(b,-e,0);break;case "top":g.vec2.set(b,0,f);break;case "right":g.vec2.set(b,e,0);break;case "bottom":g.vec2.set(b,0,-f);break;case "top-left":g.vec2.set(b,-e,f);break;case "bottom-left":g.vec2.set(b,-e,-f);break;case "top-right":g.vec2.set(b,e,f);break;case "bottom-right":g.vec2.set(b,e,-f)}a.translateBy(c,d,b);return c}}();a.rotateBy=function(a,b,c){J(a,b);a.rotation+=c;return a};a.rotateTo=function(a,b,c){J(a,
b);a.rotation=c;return a};a.scaleBy=function(){var b=p.vec2f64.create();return function(c,d,e,f,h){J(c,d);isNaN(e)||0===e||(a.toMap(b,f,d,h),c.scale=d.scale*e,a.toScreen(b,b,c,h),a.translateBy(c,c,g.vec2.set(b,b[0]-f[0],f[1]-b[1])));return c}}();a.scaleTo=function(a,b,c){J(a,b);a.scale=c;return a};a.scaleAndRotateBy=function(){var b=p.vec2f64.create();return function(c,d,e,f,h,k){J(c,d);isNaN(e)||0===e||(a.toMap(b,h,d,k),c.scale=d.scale*e,c.rotation+=f,a.toScreen(b,b,c,k),a.translateBy(c,c,g.vec2.set(b,
b[0]-h[0],h[1]-b[1])));return c}}();a.padAndScaleAndRotateBy=function(){var b=p.vec2f64.create(),c=p.vec2f64.create();return function(d,e,f,h,k,m,l){a.getPaddingScreenTranslation(c,m,l);g.vec2.add(b,k,c);return h?a.scaleAndRotateBy(d,e,f,h,b,m):a.scaleBy(d,e,f,b,m)}}();a.toMap=function(){var a=b.mat2df64.create();return function(b,c,d,e){return g.vec2.transformMat2d(b,c,K(a,d,e,1))}}();a.toScreen=function(){var c=b.mat2df64.create();return function(b,d,e,f){return g.vec2.transformMat2d(b,d,a.getTransform(c,
e,f,1))}}();a.translateBy=function(){var a=p.vec2f64.create(),c=b.mat2df64.create();return function(b,d,e){J(b,d);var h=M(d),k=b.targetGeometry;f.mat2d.fromRotation(c,Q(d));f.mat2d.scale(c,c,p.vec2f64.fromValues(h,h));g.vec2.transformMat2d(a,e,c);k.x+=a[0];k.y+=a[1];return b}}()})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports tslib ../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.BlendLayersTechniqueConfiguration=a.BlendLayersTechnique=void 0;e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype.initializeProgram=function(a){var c=b.shader.get().build();return new m(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),h.Default3D)};b.prototype.initializePipeline=function(){var a=2===this.configuration.mode?f.simpleBlendingParams(1,771):
1===this.configuration.mode?f.simpleBlendingParams(0,770):null;return f.makePipelineState({blending:a,colorWrite:f.defaultColorWriteParams})};b.shader=new k.ReloadableShaderModule(l,function(){return new Promise(function(a,b){n(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],a,b)})});return b}(e.ShaderTechnique);a.BlendLayersTechnique=e;e=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.mode=0;return b}d.__extends(b,a);d.__decorate([c.parameter({count:3})],b.prototype,
"mode",void 0);return b}(c.ShaderTechniqueConfiguration);a.BlendLayersTechniqueConfiguration=e})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendLayers.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces","../../shaderModules/ShaderBuilder"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(){var a=new k.ShaderBuilder;a.attributes.add("position","vec2");a.attributes.add("uv0","vec2");a.vertex.uniforms.add("scale",
"float");a.vertex.uniforms.add("offset","vec2");a.varyings.add("uv","vec2");a.vertex.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n    void main(void) {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      uv \x3d uv0 * scale + offset;\n    }\n  "],["\n    void main(void) {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      uv \x3d uv0 * scale + offset;\n    }\n  "]))));a.fragment.uniforms.add("tex","sampler2D");a.fragment.uniforms.add("opacity","float");a.fragment.code.add(l.glsl(c||
(c=d.__makeTemplateObject(["\n    void main() {\n      vec4 color \x3d texture2D(tex, uv);\n\n      // Note: output in pre-multiplied alpha for correct alpha compositing\n      gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\n    }\n  "],["\n    void main() {\n      vec4 color \x3d texture2D(tex, uv);\n\n      // Note: output in pre-multiplied alpha for correct alpha compositing\n      gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\n    }\n  "]))));return a};var e,c})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports tslib ../../../core/maybe ../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/rasterUtils ../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){Object.defineProperty(a,"__esModule",{value:!0});a.RasterColorizerTechniqueConfiguration=a.RasterColorizerTechnique=void 0;c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);Object.defineProperty(c.prototype,"uniformLocationInfos",{get:function(){this._uniformLocationInfos||(this._uniformLocationInfos=b.getUniformLocationInfos(this._context,this.program));return this._uniformLocationInfos},enumerable:!1,configurable:!0});c.prototype.initializeProgram=
function(a){var b=c.shader.get(),d=this.configuration,b=b.build({output:d.colorizerType,applyColormap:d.applyColormap});this._context=a.rctx;return new f(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),m.Default3D)};c.prototype.initializePipeline=function(){var a=2===this.configuration.mode?g.simpleBlendingParams(1,771):1===this.configuration.mode?g.simpleBlendingParams(0,770):null;return g.makePipelineState({blending:a,colorWrite:g.defaultColorWriteParams})};c.prototype.bindPass=function(a,
c){b.setUniforms(this.program,this.uniformLocationInfos,c.basic);b.setUniforms(this.program,this.uniformLocationInfos,c.common);l.isSome(c.colormap)&&b.setUniforms(this.program,this.uniformLocationInfos,c.colormap);0===this.configuration.colorizerType&&l.isSome(c.stretch)?b.setUniforms(this.program,this.uniformLocationInfos,c.stretch):2===this.configuration.colorizerType&&l.isSome(c.hillshade)&&b.setUniforms(this.program,this.uniformLocationInfos,c.hillshade)};c.shader=new e.ReloadableShaderModule(k,
function(){return new Promise(function(a,b){n(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],a,b)})});return c}(c.ShaderTechnique);a.RasterColorizerTechnique=c;c=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.mode=2;b.colorizerType=0;b.applyColormap=!0;return b}d.__extends(b,a);d.__decorate([h.parameter({count:3})],b.prototype,"mode",void 0);d.__decorate([h.parameter({count:3})],b.prototype,"colorizerType",void 0);d.__decorate([h.parameter()],b.prototype,
"applyColormap",void 0);return b}(h.ShaderTechniqueConfiguration);a.RasterColorizerTechniqueConfiguration=c})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl":function(){define("require exports tslib ./BasicGrid.glsl ./Colormap.glsl ./Common.glsl ../util/ColorConversion.glsl ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),function(n,a,d,l,k,e,c,h,m){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var n=new m.ShaderBuilder;
n.include(l.BasicGrid);n.include(e.Common);n.include(k.Colormap);0===a.output?(a=a.applyColormap,n.fragment.uniforms.add("u_bandCount","int"),n.fragment.uniforms.add("u_minCutOff","float",3),n.fragment.uniforms.add("u_maxCutOff","float",3),n.fragment.uniforms.add("u_factor","float",3),n.fragment.uniforms.add("u_minOutput","float"),n.fragment.uniforms.add("u_maxOutput","float"),n.fragment.uniforms.add("u_useGamma","bool"),n.fragment.uniforms.add("u_gamma","float",3),n.fragment.uniforms.add("u_gammaCorrection",
"float",3),n.fragment.code.add(h.glsl(b||(b=d.__makeTemplateObject(["\n      float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\n        // clamp values\n        if (val \x3e\x3d maxCutOff) {\n          return maxOutput;\n        } else if (val \x3c\x3d minCutOff) {\n          return minOutput;\n        }\n\n        // stretch a single value based on whether to use gamma\n        float stretchedVal;\n        if (useGamma) {\n          float tempf \x3d 1.0;\n          float outRange \x3d maxOutput - minOutput;\n          float relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\n          if (gamma \x3e 1.0) {\n            tempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n          }\n          stretchedVal \x3d (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n        } else {\n          stretchedVal \x3d minOutput + (val - minCutOff) * factor;\n        }\n        return stretchedVal;\n      }\n    "],
["\n      float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\n        // clamp values\n        if (val \x3e\x3d maxCutOff) {\n          return maxOutput;\n        } else if (val \x3c\x3d minCutOff) {\n          return minOutput;\n        }\n\n        // stretch a single value based on whether to use gamma\n        float stretchedVal;\n        if (useGamma) {\n          float tempf \x3d 1.0;\n          float outRange \x3d maxOutput - minOutput;\n          float relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\n          if (gamma \x3e 1.0) {\n            tempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n          }\n          stretchedVal \x3d (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n        } else {\n          stretchedVal \x3d minOutput + (val - minCutOff) * factor;\n        }\n        return stretchedVal;\n      }\n    "])))),
a=a?h.glsl(g||(g=d.__makeTemplateObject(["gl_FragColor \x3d colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);"],["gl_FragColor \x3d colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);"]))):h.glsl(p||(p=d.__makeTemplateObject(["gl_FragColor \x3d vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;"],["gl_FragColor \x3d vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;"]))),n.fragment.code.add(h.glsl(t||(t=d.__makeTemplateObject(["\n      void main() {\n        vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n        if (isOutside(pixelLocation)) {\n          gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        vec4 currentPixel \x3d getPixel(pixelLocation);\n        if (currentPixel.a \x3d\x3d 0.0) {\n          gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        if (u_bandCount \x3d\x3d 1) {\n          float grayVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n          ",
"\n        } else {\n          float redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n          float greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\n          float blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\n          gl_FragColor \x3d vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n        }\n      }\n    "],
["\n      void main() {\n        vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n        if (isOutside(pixelLocation)) {\n          gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        vec4 currentPixel \x3d getPixel(pixelLocation);\n        if (currentPixel.a \x3d\x3d 0.0) {\n          gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        if (u_bandCount \x3d\x3d 1) {\n          float grayVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n          ",
"\n        } else {\n          float redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n          float greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\n          float blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\n          gl_FragColor \x3d vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n        }\n      }\n    "])),
a))):1===a.output?n.fragment.code.add(h.glsl(f||(f=d.__makeTemplateObject(["\n      void main() {\n        // get pixel location\n        vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n        if (isOutside(pixelLocation)) {\n          gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        vec4 currentPixel \x3d getPixel(pixelLocation);\n        // apply colormap we use float texture here\n        gl_FragColor \x3d colormap(currentPixel, true);\n      }\n    "],
["\n      void main() {\n        // get pixel location\n        vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n        if (isOutside(pixelLocation)) {\n          gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        vec4 currentPixel \x3d getPixel(pixelLocation);\n        // apply colormap we use float texture here\n        gl_FragColor \x3d colormap(currentPixel, true);\n      }\n    "])))):2===a.output&&(a=a.applyColormap,n.fragment.uniforms.add("u_hillshadeType",
"int"),n.fragment.uniforms.add("u_sinZcosAs","float",6),n.fragment.uniforms.add("u_sinZsinAs","float",6),n.fragment.uniforms.add("u_cosZs","float",6),n.fragment.uniforms.add("u_weights","float",6),n.fragment.uniforms.add("u_factor","vec2"),n.fragment.uniforms.add("u_applyColormap","bool"),n.fragment.uniforms.add("u_minValue","float"),n.fragment.uniforms.add("u_maxValue","float"),n.fragment.uniforms.add("u_srcImageSize","vec2"),n.fragment.include(c.ColorConversion),n.fragment.code.add(h.glsl(u||(u=
d.__makeTemplateObject(["\n  vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\n    val \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\n    vec4 rgb \x3d colormap(vec4(val, val, val, 1.0), false);\n    vec3 hsv \x3d rgb2hsv(rgb.xyz);\n    hsv.z \x3d hillshade;\n    return vec4(hsv2rgb(hsv) * alpha, alpha);\n  }\n"],["\n  vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\n    val \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\n    vec4 rgb \x3d colormap(vec4(val, val, val, 1.0), false);\n    vec3 hsv \x3d rgb2hsv(rgb.xyz);\n    hsv.z \x3d hillshade;\n    return vec4(hsv2rgb(hsv) * alpha, alpha);\n  }\n"])))),
n.fragment.code.add(h.glsl(r||(r=d.__makeTemplateObject(["\n    float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\n      if (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\n        return 0.0;\n      }  else {\n        return e;\n      }\n    }\n  "],["\n    float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\n      if (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\n        return 0.0;\n      }  else {\n        return e;\n      }\n    }\n  "])))),
a=a?h.glsl(q||(q=d.__makeTemplateObject(["gl_FragColor \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);"],["gl_FragColor \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);"]))):h.glsl(v||(v=d.__makeTemplateObject(["\n       hillshade *\x3d alpha;\n       gl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n       "],["\n       hillshade *\x3d alpha;\n       gl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n       "]))),n.fragment.code.add(h.glsl(w||
(w=d.__makeTemplateObject(["\n    void main() {\n      vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n      if (isOutside(pixelLocation)) {\n        gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n      }\n\n      vec4 currentPixel \x3d getPixel(pixelLocation);\n      if (currentPixel.a \x3d\x3d 0.0) {\n        gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n      }\n\n      //mirror edge pixels\n      vec2 axy \x3d vec2(-1.0, -1.0);\n      vec2 bxy \x3d vec2(0.0, -1.0);\n      vec2 cxy \x3d vec2(1.0, -1.0);\n      vec2 dxy \x3d vec2(-1.0, 0.0);\n      vec2 fxy \x3d vec2(1.0, 0.0);\n      vec2 gxy \x3d vec2(-1.0, 1.0);\n      vec2 hxy \x3d vec2(0.0, 1.0);\n      vec2 ixy \x3d vec2(1.0, 1.0);\n      vec2 onePixel \x3d 1.0 / u_srcImageSize;\n      if (pixelLocation.s \x3c onePixel.s) {\n        axy[0] \x3d 1.0;\n        dxy[0] \x3d 1.0;\n        gxy[0] \x3d 1.0;\n      }\n      if (pixelLocation.t \x3c onePixel.t) {\n        axy[1] \x3d 1.0;\n        bxy[1] \x3d 1.0;\n        cxy[1] \x3d 1.0;\n      }\n      if (pixelLocation.s \x3e 1.0 - onePixel.s) {\n        cxy[0] \x3d -1.0;\n        fxy[0] \x3d -1.0;\n        ixy[0] \x3d -1.0;\n      }\n      if (pixelLocation.t \x3e 1.0 - onePixel.t) {\n        gxy[1] \x3d -1.0;\n        hxy[1] \x3d -1.0;\n        ixy[1] \x3d -1.0;\n      }\n\n      // calculate hillshade\n      vec4 va \x3d texture2D(u_image, pixelLocation + onePixel * axy);\n      vec4 vb \x3d texture2D(u_image, pixelLocation + onePixel * bxy);\n      vec4 vc \x3d texture2D(u_image, pixelLocation + onePixel * cxy);\n      vec4 vd \x3d texture2D(u_image, pixelLocation + onePixel * dxy);\n      vec4 ve \x3d texture2D(u_image, pixelLocation);\n      vec4 vf \x3d texture2D(u_image, pixelLocation + onePixel * fxy);\n      vec4 vg \x3d texture2D(u_image, pixelLocation + onePixel * gxy);\n      vec4 vh \x3d texture2D(u_image, pixelLocation + onePixel * hxy);\n      vec4 vi \x3d texture2D(u_image, pixelLocation + onePixel * ixy);\n\n      // calculate the rate of z change along the x, y, and diagonal direction\n      float dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;\n      float dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;\n      float dzd \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\n      float hillshade \x3d 0.0;\n\n      // traditional single light source\n      if (u_hillshadeType \x3d\x3d 0){\n        float cosDelta \x3d u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\n        float z \x3d (u_cosZs[0] + cosDelta) / dzd;\n        if (z \x3c 0.0)  z \x3d 0.0;\n        hillshade \x3d z;\n      } else {\n        // multi-directional with 6 light sources\n        for (int k \x3d 0; k \x3c 6; k++) {\n        float cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\n        float z \x3d (u_cosZs[k] + cosDelta) / dzd;\n        if (z \x3c 0.0) z \x3d 0.0;\n        hillshade \x3d hillshade + z * u_weights[k];\n        if (k \x3d\x3d 5) break;\n        }\n      }\n\n      // set color\n      float alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\n      alpha *\x3d u_opacity;\n      ",
"\n    }\n  "],["\n    void main() {\n      vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n      if (isOutside(pixelLocation)) {\n        gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n      }\n\n      vec4 currentPixel \x3d getPixel(pixelLocation);\n      if (currentPixel.a \x3d\x3d 0.0) {\n        gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n      }\n\n      //mirror edge pixels\n      vec2 axy \x3d vec2(-1.0, -1.0);\n      vec2 bxy \x3d vec2(0.0, -1.0);\n      vec2 cxy \x3d vec2(1.0, -1.0);\n      vec2 dxy \x3d vec2(-1.0, 0.0);\n      vec2 fxy \x3d vec2(1.0, 0.0);\n      vec2 gxy \x3d vec2(-1.0, 1.0);\n      vec2 hxy \x3d vec2(0.0, 1.0);\n      vec2 ixy \x3d vec2(1.0, 1.0);\n      vec2 onePixel \x3d 1.0 / u_srcImageSize;\n      if (pixelLocation.s \x3c onePixel.s) {\n        axy[0] \x3d 1.0;\n        dxy[0] \x3d 1.0;\n        gxy[0] \x3d 1.0;\n      }\n      if (pixelLocation.t \x3c onePixel.t) {\n        axy[1] \x3d 1.0;\n        bxy[1] \x3d 1.0;\n        cxy[1] \x3d 1.0;\n      }\n      if (pixelLocation.s \x3e 1.0 - onePixel.s) {\n        cxy[0] \x3d -1.0;\n        fxy[0] \x3d -1.0;\n        ixy[0] \x3d -1.0;\n      }\n      if (pixelLocation.t \x3e 1.0 - onePixel.t) {\n        gxy[1] \x3d -1.0;\n        hxy[1] \x3d -1.0;\n        ixy[1] \x3d -1.0;\n      }\n\n      // calculate hillshade\n      vec4 va \x3d texture2D(u_image, pixelLocation + onePixel * axy);\n      vec4 vb \x3d texture2D(u_image, pixelLocation + onePixel * bxy);\n      vec4 vc \x3d texture2D(u_image, pixelLocation + onePixel * cxy);\n      vec4 vd \x3d texture2D(u_image, pixelLocation + onePixel * dxy);\n      vec4 ve \x3d texture2D(u_image, pixelLocation);\n      vec4 vf \x3d texture2D(u_image, pixelLocation + onePixel * fxy);\n      vec4 vg \x3d texture2D(u_image, pixelLocation + onePixel * gxy);\n      vec4 vh \x3d texture2D(u_image, pixelLocation + onePixel * hxy);\n      vec4 vi \x3d texture2D(u_image, pixelLocation + onePixel * ixy);\n\n      // calculate the rate of z change along the x, y, and diagonal direction\n      float dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;\n      float dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;\n      float dzd \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\n      float hillshade \x3d 0.0;\n\n      // traditional single light source\n      if (u_hillshadeType \x3d\x3d 0){\n        float cosDelta \x3d u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\n        float z \x3d (u_cosZs[0] + cosDelta) / dzd;\n        if (z \x3c 0.0)  z \x3d 0.0;\n        hillshade \x3d z;\n      } else {\n        // multi-directional with 6 light sources\n        for (int k \x3d 0; k \x3c 6; k++) {\n        float cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\n        float z \x3d (u_cosZs[k] + cosDelta) / dzd;\n        if (z \x3c 0.0) z \x3d 0.0;\n        hillshade \x3d hillshade + z * u_weights[k];\n        if (k \x3d\x3d 5) break;\n        }\n      }\n\n      // set color\n      float alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\n      alpha *\x3d u_opacity;\n      ",
"\n    }\n  "])),a)));return n};var f,b,g,p,t,u,r,q,v,w})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.BasicGrid=void 0;a.BasicGrid=function(a){a.attributes.add("position","vec2");a.attributes.add("uv0","vec2");a.vertex.uniforms.add("u_scale","float");a.vertex.uniforms.add("u_offset","vec2");a.varyings.add("v_texcoord","vec2");
a.vertex.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    void main(void) {\n      v_texcoord \x3d uv0 * u_scale + u_offset;\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n    }\n  "],["\n    void main(void) {\n      v_texcoord \x3d uv0 * u_scale + u_offset;\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n    }\n  "]))))};var k})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,
a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.Colormap=void 0;a.Colormap=function(a){a.fragment.uniforms.add("u_colormap","sampler2D");a.fragment.uniforms.add("u_colormapOffset","float");a.fragment.uniforms.add("u_colormapMaxIndex","float");a.fragment.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    vec4 colormap(vec4 currentPixel, bool isFloat) {\n      // colormap is only applicable to integer data but could be already normalized to 0-1 float\n      float clrIndex \x3d isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;\n      vec4 result;\n      // handle no data and out of range pixels\n      if (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_colormapMaxIndex) {\n        result \x3d vec4(0.0, 0.0, 0.0, 0.0);\n      } else {\n        // colormap lookup\n        vec2 clrPosition \x3d vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\n        vec4 color \x3d texture2D(u_colormap, clrPosition);\n        result \x3d vec4(color.rgb, 1.0) * color.a * u_opacity;\n      }\n      return result;\n    }\n  "],
["\n    vec4 colormap(vec4 currentPixel, bool isFloat) {\n      // colormap is only applicable to integer data but could be already normalized to 0-1 float\n      float clrIndex \x3d isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;\n      vec4 result;\n      // handle no data and out of range pixels\n      if (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_colormapMaxIndex) {\n        result \x3d vec4(0.0, 0.0, 0.0, 0.0);\n      } else {\n        // colormap lookup\n        vec2 clrPosition \x3d vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\n        vec4 color \x3d texture2D(u_colormap, clrPosition);\n        result \x3d vec4(color.rgb, 1.0) * color.a * u_opacity;\n      }\n      return result;\n    }\n  "]))))};
var k})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define(["require","exports","tslib","./Projection.glsl","../../shaderModules/interfaces"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.Common=void 0;a.Common=function(a){a.include(l.Projection);a.fragment.uniforms.add("u_image","sampler2D");a.fragment.uniforms.add("u_isFloatTexture","bool");a.fragment.uniforms.add("u_flipY","bool");a.fragment.uniforms.add("u_applyTransform","bool");a.fragment.uniforms.add("u_opacity",
"float");a.fragment.code.add(k.glsl(e||(e=d.__makeTemplateObject(["\n    vec2 getPixelLocation(vec2 coords) {\n      vec2 targetLocation \x3d u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n      if (!u_applyTransform) {\n        return targetLocation;\n      }\n      return projectPixelLocation(targetLocation);\n    }\n\n    bool isOutside(vec2 coords){\n      if (coords.t\x3e1.00001 ||coords.t\x3c-0.00001 || coords.s\x3e1.00001 ||coords.s\x3c-0.00001) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n\n    vec4 getPixel(vec2 pixelLocation) {\n      return texture2D(u_image, pixelLocation);\n    }\n  "],
["\n    vec2 getPixelLocation(vec2 coords) {\n      vec2 targetLocation \x3d u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n      if (!u_applyTransform) {\n        return targetLocation;\n      }\n      return projectPixelLocation(targetLocation);\n    }\n\n    bool isOutside(vec2 coords){\n      if (coords.t\x3e1.00001 ||coords.t\x3c-0.00001 || coords.s\x3e1.00001 ||coords.s\x3c-0.00001) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n\n    vec4 getPixel(vec2 pixelLocation) {\n      return texture2D(u_image, pixelLocation);\n    }\n  "]))))};
var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.Projection=void 0;a.Projection=function(a){a.fragment.uniforms.add("u_transformGrid","sampler2D");a.fragment.uniforms.add("u_transformSpacing","vec2");a.fragment.uniforms.add("u_transformGridSize","vec2");a.fragment.uniforms.add("u_targetImageSize","vec2");a.fragment.code.add(l.glsl(k||
(k=d.__makeTemplateObject(["\n    vec2 projectPixelLocation(vec2 coords) {\n      // pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]\n      vec2 index_image \x3d floor(coords * u_targetImageSize);\n\n      // pixel's corresponding cell index in transform grid\n      // each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle\n      vec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\n      vec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\n\n      // correspoding position in transform grid cell, cell center coordinates\n      vec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\n      vec2 srcLocation;\n      // pixel's corresponding transform cell location, center cell coordinates\n      vec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\n\n      // use lower triangle or upper triangle\n      if (pos.s \x3c\x3d pos.t) {\n        vec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\n        vec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\n        srcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\n        srcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n      } else {\n        vec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\n        vec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\n        srcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\n        srcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n      }\n      return srcLocation;;\n    }\n  "],
["\n    vec2 projectPixelLocation(vec2 coords) {\n      // pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]\n      vec2 index_image \x3d floor(coords * u_targetImageSize);\n\n      // pixel's corresponding cell index in transform grid\n      // each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle\n      vec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\n      vec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\n\n      // correspoding position in transform grid cell, cell center coordinates\n      vec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\n      vec2 srcLocation;\n      // pixel's corresponding transform cell location, center cell coordinates\n      vec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\n\n      // use lower triangle or upper triangle\n      if (pos.s \x3c\x3d pos.t) {\n        vec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\n        vec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\n        srcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\n        srcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n      } else {\n        vec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\n        vec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\n        srcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\n        srcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n      }\n      return srcLocation;;\n    }\n  "]))))};
var k})},"esri/views/3d/terrain/support/FBOPool":function(){define(["require","exports","../../../../core/ObjectPool","../../../webgl/FramebufferObject"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.FBOPool=void 0;n=function(){function a(a){this.renderingContext=a;this._pools=new Map}a.prototype.acquire=function(a){return this.getPool(a).acquire()};a.prototype.release=function(a){this.getPool(a.width).release(a)};a.prototype.clear=function(){this._pools.forEach(function(a){a.destroy()});
this._pools.clear()};a.prototype.getPool=function(a){var c=this._pools.get(a);c||(c=l.bind(l,this.renderingContext,{colorTarget:0,depthStencilTarget:1,width:a,height:a}),c=new d(c),this._pools.set(a,c));return c};return a}();a.FBOPool=n})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.request=a.instrumentContext=a.end=a.trace=a.begin=
a.setEnabled=a.enabled=void 0;var k=null,e=[];a.enabled=!1;a.setEnabled=function(c){a.enabled=c};a.begin=function(){a.enabled&&(k=[])};a.trace=function(c){a.enabled&&null!=k&&k.push(c)};a.end=function(){if(a.enabled){var c=k;k=null;c&&(e.forEach(function(a){return a(c)}),e.length=0);return c}return null};a.instrumentContext=function(c){return a.enabled?l.default(c)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),c):d.makeDebugContext(c,void 0,function(c,e){a.enabled&&k&&k.push("gl."+
c+"("+d.glFunctionArgsToString(c,e)+")")}):c};a.request=function(a){e.push(a)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function n(a){if(null==m){m={};f={};for(var b in a)"number"==typeof a[b]&&(m[a[b]]=b,f[b]=a[b])}}function a(){if(null==m)throw"WebGLDebugUtils.init(ctx) not called";}function d(b){a();var c=m[b];return void 0!==c?"gl."+c:"/*UNKNOWN WebGL ENUM*/ 0x"+b.toString(16)+""}function l(a,c,e,k){a=h[a];if(void 0!==a&&(a=a[c],void 0!==a&&a[e])){if("object"===
typeof a[e]&&void 0!==a[e].enumBitwiseOr){c=a[e].enumBitwiseOr;e=0;a=[];for(var b=0;b<c.length;++b){var g=f[c[b]];0!==(k&g)&&(e|=g,a.push(d(g)))}return e===k?a.join(" | "):d(k)}return d(k)}return null===k?"null":void 0===k?"undefined":k.toString()}function k(a,c,d){a.__defineGetter__(d,function(){return c[d]});a.__defineSetter__(d,function(a){c[d]=a})}function e(a,c,f,h){function b(a,b){return function(){f&&f(b,arguments);var d=a[b].apply(a,arguments),e=h.getError();0!=e&&(g[e]=!0,c(e,b,arguments));
return d}}h=h||a;n(a);c=c||function(a,b,c){for(var e="",f=c.length,g=0;g<f;++g)e+=(0==g?"":", ")+l(b,f,g,c[g]);a="WebGL error "+d(a)+" in "+b+"("+e+")";window.console&&window.console.error?window.console.error(a):window.console&&window.console.log&&window.console.log(a)};var g={},m={},p;for(p in a)if("function"==typeof a[p])if("getExtension"!=p)m[p]=b(a,p);else{var t=b(a,p);m[p]=function(){var b=t.apply(a,arguments);return e(b,c,f,h)}}else k(m,a,p);m.getError=function(){for(var b in g)if(g.hasOwnProperty(b)&&
g[b])return g[b]=!1,b;return a.NO_ERROR};return m}function c(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);for(var d=0;d<b;++d)a.disableVertexAttribArray(d),a.vertexAttribPointer(d,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(d,0);a.deleteBuffer(c);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(d=0;d<b;++d)a.activeTexture(a.TEXTURE0+d),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,
null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,
a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,
0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var h={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},
texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},
bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},
blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},m=null,f=null;return{init:n,mightBeEnum:function(b){a();return void 0!==m[b]},glEnumToString:d,glFunctionArgToString:l,glFunctionArgsToString:function(a,
c){for(var b="",d=c.length,e=0;e<d;++e)b+=(0==e?"":", ")+l(a,d,e,c[e]);return b},makeDebugContext:e,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function d(){for(var a=Object.keys(J),b=0;b<a.length;++b)delete J[a]}function e(){++G;A||E==G&&a.loseContext()}function f(a,b){var c=a[b];return function(){e();if(!A)return c.apply(a,arguments)}}function h(a){return{statusMessage:a,preventDefault:function(){F=!0}}}function m(a){for(var b in a)"function"==
typeof a[b]?n[b]=f(a,b):k(n,a,b);n.getError=function(){e();if(!A)for(var a;a=l.getError();)J[a]=!0;for(a in J)if(J[a])return delete J[a],a;return n.NO_ERROR};var c="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(b=0;b<c.length;++b){var d=c[b];n[d]=function(b){return function(){e();if(A)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=B;C.push(c);return c}}(a[d])}c="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(b=0;b<c.length;++b)d=c[b],n[d]=function(b){return function(){e();return A?null:b.apply(a,arguments)}}(n[d]);c="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(b=0;b<c.length;++b)d=c[b],n[d]=function(b){return function(){e();return A?!1:b.apply(a,arguments)}}(n[d]);n.checkFramebufferStatus=function(b){return function(){e();return A?n.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(n.checkFramebufferStatus);n.getAttribLocation=function(b){return function(){e();
return A?-1:b.apply(a,arguments)}}(n.getAttribLocation);n.getVertexAttribOffset=function(b){return function(){e();return A?0:b.apply(a,arguments)}}(n.getVertexAttribOffset);n.isContextLost=function(){return A};return n}var l,n,z=[],x=[];n={};var B=1,A=!1,C=[],E=0,G=0,F=!1,H=0,J={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=l){if(l)throw"got different context";l=c;n=m(l)}return n}return c}}(a.getContext);(function(a){var c=a.addEventListener;
a.addEventListener=function(d,e,f){switch(d){case "webglcontextlost":z.push(b(e));break;case "webglcontextrestored":x.push(b(e));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!A){A=!0;E=0;for(++B;l.getError(););d();J[l.CONTEXT_LOST_WEBGL]=!0;var b=h("context lost"),c=z.slice();setTimeout(function(){for(var d=0;d<c.length;++d)c[d](b);0<=H&&setTimeout(function(){a.restoreContext()},H)},0)}};a.restoreContext=function(){A&&x.length&&setTimeout(function(){if(!F)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<C.length;++a){var b=C[a];b instanceof WebGLBuffer?l.deleteBuffer(b):b instanceof WebGLFramebuffer?l.deleteFramebuffer(b):b instanceof WebGLProgram?l.deleteProgram(b):b instanceof WebGLRenderbuffer?l.deleteRenderbuffer(b):b instanceof WebGLShader?l.deleteShader(b):b instanceof WebGLTexture&&l.deleteTexture(b)}c(l);A=!1;G=0;F=!1;for(var a=x.slice(),b=h("context restored"),d=0;d<a.length;++d)a[d](b)},0)};a.loseContextInNCalls=function(a){if(A)throw"You can not ask a lost contet to be lost";
E=G+a};a.getNumCalls=function(){return G};a.setRestoreTimeout=function(a){H=a};return a},resetToInitialState:c}})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports tslib ../core/shaderLibrary/terrain/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.TerrainTechniqueConfiguration=a.TerrainTechnique=void 0;e=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);c.prototype.initializeProgram=function(a){var b=c.shader.get(),d=this.configuration,b=b.build({overlayMode:d.overlayMode,output:d.output,viewingMode:a.viewingMode,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:d.textureFadingEnabled&&
!d.renderOccluded,receiveShadows:d.receiveShadows&&!d.renderOccluded,receiveAmbientOcclusion:!1,useOldSceneLightInterface:!0,atmosphere:d.atmosphere,tileBorders:d.tileBorders,screenSizePerspective:d.screenSizePerspective,pbrMode:0,ssrEnabled:d.ssrEnabled,highStepCount:!1});return new f(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),h.Default3D)};c.prototype.initializePipeline=function(){var a=this.configuration,c=a.backfaceCullingEnabled&&!a.renderOccluded;return b.makePipelineState({blending:a.renderOccluded?
b.simpleBlendingParams(1,771):null,culling:c&&b.backFaceCullingParams,depthTest:!a.renderOccluded&&{func:513},depthWrite:!a.renderOccluded&&b.defaultDepthWriteParams,colorWrite:b.defaultColorWriteParams,stencilTest:a.stencilEnabled?m.renderWhenBitIsNotSet(1):null})};c.shader=new k.ReloadableShaderModule(l,function(){return new Promise(function(a,b){n(["../core/shaderLibrary/terrain/Terrain.glsl"],a,b)})});return c}(e.ShaderTechnique);a.TerrainTechnique=e;e=function(a){function b(){var b=null!==a&&
a.apply(this,arguments)||this;b.output=0;b.overlayMode=0;b.atmosphere=!1;b.receiveShadows=!1;b.slicePlaneEnabled=!1;b.backfaceCullingEnabled=!1;b.stencilEnabled=!1;b.textureFadingEnabled=!1;b.renderOccluded=!1;b.ssrEnabled=!1;b.tileBorders=!1;b.screenSizePerspective=!1;return b}d.__extends(b,a);d.__decorate([c.parameter({count:7})],b.prototype,"output",void 0);d.__decorate([c.parameter({count:3})],b.prototype,"overlayMode",void 0);d.__decorate([c.parameter()],b.prototype,"atmosphere",void 0);d.__decorate([c.parameter()],
b.prototype,"receiveShadows",void 0);d.__decorate([c.parameter()],b.prototype,"slicePlaneEnabled",void 0);d.__decorate([c.parameter()],b.prototype,"backfaceCullingEnabled",void 0);d.__decorate([c.parameter()],b.prototype,"stencilEnabled",void 0);d.__decorate([c.parameter()],b.prototype,"textureFadingEnabled",void 0);d.__decorate([c.parameter()],b.prototype,"renderOccluded",void 0);d.__decorate([c.parameter()],b.prototype,"ssrEnabled",void 0);d.__decorate([c.parameter()],b.prototype,"tileBorders",
void 0);d.__decorate([c.parameter()],b.prototype,"screenSizePerspective",void 0);return b}(c.ShaderTechniqueConfiguration);a.TerrainTechniqueConfiguration=e})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Terrain.glsl":function(){define("require exports tslib ../Slice.glsl ../Transform.glsl ../attributes/VertexTangent.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/EvaluateSceneLighting.glsl ../shading/NormalUtils.glsl ./Overlay.glsl ./Skirts.glsl ./TerrainTexture.glsl ../util/HeaderComment.glsl ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var n=new r.ShaderBuilder;n.include(t.HeaderComment,{name:"Terrain Shader",output:a.output});n.include(g.Skirts);n.attributes.add("position","vec3");n.attributes.add("uv0","vec2");n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float");if(0===a.output){n.include(k.Transform,{linearDepth:!1});n.include(f.NormalUtils,a);n.include(p.TerrainTexture,
a);var T=0!==a.overlayMode,Y=2===a.overlayMode;T&&n.include(b.Overlay,{pbrMode:3,useCustomDTRExponentForWater:!1,ssrEnabled:a.ssrEnabled,highStepCount:a.highStepCount});Y&&n.include(e.VertexTangent,a);n.varyings.add("vnormal","vec3");n.varyings.add("vpos","vec3");n.vertex.uniforms.add("viewNormal","mat4");a.receiveShadows&&n.varyings.add("linearDepth","float");a.tileBorders&&n.varyings.add("vuv","vec2");a.atmosphere&&(n.vertex.uniforms.add("lightingMainDirection","vec3"),n.varyings.add("wnormal",
"vec3"),n.varyings.add("wlight","vec3"));a.screenSizePerspective&&(n.vertex.uniforms.add("screenSizePerspective","vec4"),n.varyings.add("screenSizeDistanceToCamera","float"),n.varyings.add("screenSizeCosAngle","float"));n.vertex.code.add(u.glsl(C||(C=d.__makeTemplateObject(["\n      void main(void) {\n        vpos \x3d position;\n        vnormal \x3d getLocalUp(vpos, origin);\n\n        vec2 uv \x3d uv0;\n        vpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\n        ","\n        ","\n        ",
"\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        ","\n        forwardTextureCoordinates(uv);\n        ","\n        ","\n      }\n    "],["\n      void main(void) {\n        vpos \x3d position;\n        vnormal \x3d getLocalUp(vpos, origin);\n\n        vec2 uv \x3d uv0;\n        vpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\n        ","\n        ","\n        ","\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        ","\n        forwardTextureCoordinates(uv);\n        ",
"\n        ","\n      }\n    "])),a.atmosphere?u.glsl(q||(q=d.__makeTemplateObject(["\n        wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n        wlight \x3d (view  * vec4(-lightingMainDirection, 1.0)).xyz;"],["\n        wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n        wlight \x3d (view  * vec4(-lightingMainDirection, 1.0)).xyz;"]))):"",a.tileBorders?u.glsl(v||(v=d.__makeTemplateObject(["vuv \x3d uv;"],["vuv \x3d uv;"]))):"",a.screenSizePerspective?
u.glsl(w||(w=d.__makeTemplateObject(["\n        vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\n        screenSizeDistanceToCamera \x3d length(viewPos);\n        vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n        screenSizeCosAngle \x3d abs(viewSpaceNormal.z);"],["\n        vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\n        screenSizeDistanceToCamera \x3d length(viewPos);\n        vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n        screenSizeCosAngle \x3d abs(viewSpaceNormal.z);"]))):
"",a.receiveShadows?u.glsl(z||(z=d.__makeTemplateObject(["linearDepth \x3d gl_Position.w;"],["linearDepth \x3d gl_Position.w;"]))):"",T?u.glsl(x||(x=d.__makeTemplateObject(["setOverlayVTC(uv);"],["setOverlayVTC(uv);"]))):"",Y?u.glsl(B||(B=d.__makeTemplateObject(["forwardVertexTangent(vnormal);"],["forwardVertexTangent(vnormal);"]))):u.glsl(A||(A=d.__makeTemplateObject([""],[""])))));n.extensions.add("GL_OES_standard_derivatives");n.extensions.add("GL_EXT_shader_texture_lod");n.include(l.Slice,a);
n.include(m.EvaluateSceneLighting,a);n.fragment.uniforms.add("camPos","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4").add("opacity","float");a.screenSizePerspective&&n.fragment.uniforms.add("screenSizePerspective","vec4");Y&&(n.fragment.uniforms.add("ovInnerWaterTex","sampler2D"),n.fragment.uniforms.add("ovOuterWaterTex","sampler2D"),n.fragment.uniforms.add("view","mat4"));n.fragment.code.add(u.glsl(E||(E=d.__makeTemplateObject(["\n      const vec3 ambient \x3d vec3(0.2, 0.2, 0.2);\n      const vec3 diffuse \x3d vec3(0.8, 0.8, 0.8);\n      const float diffuseHardness \x3d 2.5;\n      const float sliceOpacity \x3d 0.2;\n\n      float lum(vec3 c) {\n        float max \x3d max(max(c.r, c.g), c.b);\n        float min \x3d min(min(c.r, c.g), c.b);\n        return (min + max) * 0.5;\n      }\n      "],
["\n      const vec3 ambient \x3d vec3(0.2, 0.2, 0.2);\n      const vec3 diffuse \x3d vec3(0.8, 0.8, 0.8);\n      const float diffuseHardness \x3d 2.5;\n      const float sliceOpacity \x3d 0.2;\n\n      float lum(vec3 c) {\n        float max \x3d max(max(c.r, c.g), c.b);\n        float min \x3d min(min(c.r, c.g), c.b);\n        return (min + max) * 0.5;\n      }\n      "]))));a.atmosphere&&n.fragment.code.add(u.glsl(G||(G=d.__makeTemplateObject(["\n      vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n        vec3 surfaceColor   \x3d vec3(0.0);\n        vec3 fuzzySpecColor \x3d vec3(1.0);\n        vec3 subColor       \x3d vec3(0.0);\n        float rollOff       \x3d 1.0;\n\n        vec3 Ln \x3d normalize(lightPos);\n        vec3 Nn \x3d normalize(normal);\n        vec3 Hn \x3d normalize(view + Ln);\n\n        float ldn \x3d dot(Ln, Nn);\n        float diffComp \x3d max(0.0, ldn);\n        // clamp necessary here because values might cause flickering: #21549\n        float vdn \x3d clamp(1.0 - dot(view, Nn), 0.0, 1.0);\n        float ndv \x3d dot(view, Ln);\n\n        vec3 diffContrib \x3d surfaceColor * diffComp;\n        float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n        vec3 subContrib \x3d subLamb * subColor;\n        vec3 vecColor \x3d vec3(vdn);\n\n        vec3 diffuseContrib \x3d (subContrib + diffContrib);\n        vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\n\n        return (diffContrib + specularContrib) * rollOff;\n      }\n      "],
["\n      vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n        vec3 surfaceColor   \x3d vec3(0.0);\n        vec3 fuzzySpecColor \x3d vec3(1.0);\n        vec3 subColor       \x3d vec3(0.0);\n        float rollOff       \x3d 1.0;\n\n        vec3 Ln \x3d normalize(lightPos);\n        vec3 Nn \x3d normalize(normal);\n        vec3 Hn \x3d normalize(view + Ln);\n\n        float ldn \x3d dot(Ln, Nn);\n        float diffComp \x3d max(0.0, ldn);\n        // clamp necessary here because values might cause flickering: #21549\n        float vdn \x3d clamp(1.0 - dot(view, Nn), 0.0, 1.0);\n        float ndv \x3d dot(view, Ln);\n\n        vec3 diffContrib \x3d surfaceColor * diffComp;\n        float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n        vec3 subContrib \x3d subLamb * subColor;\n        vec3 vecColor \x3d vec3(vdn);\n\n        vec3 diffuseContrib \x3d (subContrib + diffContrib);\n        vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\n\n        return (diffContrib + specularContrib) * rollOff;\n      }\n      "]))));
n.fragment.code.add(u.glsl(Q||(Q=d.__makeTemplateObject(["\n      void main() {\n        ","\n        float vndl \x3d dot(normalize(vnormal), -lightingMainDirection);\n        float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n        vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\n\n        float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        vec4 tileColor \x3d getTileColor() * opacity;\n        ",
"\n        if (rejectBySlice(vpos)) {\n          tileColor *\x3d sliceOpacity;\n        }\n        vec3 atm \x3d vec3(0.0);\n        ","\n        vec3 albedo \x3d atm + tileColor.rgb;\n        vec3 normal \x3d normalize(vnormal);\n\n        // heuristic shading function used in the old terrain, now used to add ambient lighting\n        float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n        gl_FragColor \x3d vec4(evaluateSceneLightingExt(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n        ",
"\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "],["\n      void main() {\n        ","\n        float vndl \x3d dot(normalize(vnormal), -lightingMainDirection);\n        float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n        vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\n\n        float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        vec4 tileColor \x3d getTileColor() * opacity;\n        ",
"\n        if (rejectBySlice(vpos)) {\n          tileColor *\x3d sliceOpacity;\n        }\n        vec3 atm \x3d vec3(0.0);\n        ","\n        vec3 albedo \x3d atm + tileColor.rgb;\n        vec3 normal \x3d normalize(vnormal);\n\n        // heuristic shading function used in the old terrain, now used to add ambient lighting\n        float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n        gl_FragColor \x3d vec4(evaluateSceneLightingExt(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n        ",
"\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "])),a.receiveShadows?u.glsl(F||(F=d.__makeTemplateObject(["float shadow \x3d readShadowMap(vpos, linearDepth);"],["float shadow \x3d readShadowMap(vpos, linearDepth);"]))):u.glsl(H||(H=d.__makeTemplateObject(["float shadow \x3d 0.0;"],["float shadow \x3d 0.0;"]))),T?u.glsl(J||(J=d.__makeTemplateObject(["\n            vec4 overlayColorOpaque \x3d getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n            vec4 overlayColor \x3d overlayOpacity * overlayColorOpaque;\n            vec4 groundColor \x3d tileColor;\n            tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;"],
["\n            vec4 overlayColorOpaque \x3d getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n            vec4 overlayColor \x3d overlayOpacity * overlayColorOpaque;\n            vec4 groundColor \x3d tileColor;\n            tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;"]))):"",a.atmosphere?u.glsl(I||(I=d.__makeTemplateObject(["\n            float ndotl \x3d max(0.0, min(1.0, vndl));\n            atm \x3d atmosphere(wlight, wnormal, -viewDirection);\n            atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n            atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n            atm *\x3d tileColor.a; // premultiply with tile alpha"],
["\n            float ndotl \x3d max(0.0, min(1.0, vndl));\n            atm \x3d atmosphere(wlight, wnormal, -viewDirection);\n            atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n            atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n            atm *\x3d tileColor.a; // premultiply with tile alpha"]))):"",Y?u.glsl(K||(K=d.__makeTemplateObject(["\n            vec4 overlayWaterMask \x3d getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);\n            float waterNormalLength \x3d length(overlayWaterMask);\n            if (waterNormalLength \x3e 0.95) {\n              mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, vnormal);\n              vec4 waterOverlayColor \x3d vec4(overlayColor.w \x3e 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);\n              vec4 viewPosition \x3d view*vec4(vpos, 1.0);\n              vec4 waterColorLinear \x3d getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix, viewPosition.xyz);\n              vec4 waterColorNonLinear \x3d delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));\n              // un-gamma the ground color to mix in linear space\n              gl_FragColor \x3d mix(groundColor, waterColorNonLinear, waterColorLinear.w);\n            }"],
["\n            vec4 overlayWaterMask \x3d getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);\n            float waterNormalLength \x3d length(overlayWaterMask);\n            if (waterNormalLength \x3e 0.95) {\n              mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, vnormal);\n              vec4 waterOverlayColor \x3d vec4(overlayColor.w \x3e 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);\n              vec4 viewPosition \x3d view*vec4(vpos, 1.0);\n              vec4 waterColorLinear \x3d getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix, viewPosition.xyz);\n              vec4 waterColorNonLinear \x3d delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));\n              // un-gamma the ground color to mix in linear space\n              gl_FragColor \x3d mix(groundColor, waterColorNonLinear, waterColorLinear.w);\n            }"]))):
"",a.screenSizePerspective?u.glsl(L||(L=d.__makeTemplateObject(["\n          float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n          if (perspectiveScale \x3c\x3d 0.25) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n          }\n          else if (perspectiveScale \x3c\x3d 0.5) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n          }\n          else if (perspectiveScale \x3e\x3d 0.99) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n          }\n          else {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n          }"],
["\n          float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n          if (perspectiveScale \x3c\x3d 0.25) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n          }\n          else if (perspectiveScale \x3c\x3d 0.5) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n          }\n          else if (perspectiveScale \x3e\x3d 0.99) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n          }\n          else {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n          }"]))):
"",a.tileBorders?u.glsl(M||(M=d.__makeTemplateObject(["\n            vec2 dVuv \x3d fwidth(vuv);\n            vec2 edgeFactors \x3d smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));\n            float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);"],["\n            vec2 dVuv \x3d fwidth(vuv);\n            vec2 edgeFactors \x3d smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));\n            float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);"]))):
""))}if(1===a.output||3===a.output)n.include(k.Transform,{linearDepth:!0}),n.include(c.OutputDepth,{output:a.output}),n.include(f.NormalUtils,a),n.varyings.add("linearDepth","float"),n.vertex.uniforms.add("nearFar","vec2"),n.vertex.code.add(u.glsl(R||(R=d.__makeTemplateObject(["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vec3 vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\n\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);\n        }\n    "],
["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vec3 vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\n\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);\n        }\n    "])))),n.fragment.code.add(u.glsl(O||(O=d.__makeTemplateObject(["\n        void main() {\n          outputDepth(linearDepth);\n        }\n    "],["\n        void main() {\n          outputDepth(linearDepth);\n        }\n    "]))));
2===a.output&&(n.include(k.Transform,{linearDepth:!1}),n.include(f.NormalUtils,a),n.varyings.add("vnormal","vec3"),n.varyings.add("vpos","vec3"),n.vertex.uniforms.add("viewNormal","mat4"),n.vertex.code.add(u.glsl(N||(N=d.__makeTemplateObject(["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vpos \x3d applySkirts(uv, position, normal, skirtScale);\n\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          vnormal \x3d normalize((viewNormal * vec4(normal, 1.0)).xyz);\n        }\n    "],
["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vpos \x3d applySkirts(uv, position, normal, skirtScale);\n\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          vnormal \x3d normalize((viewNormal * vec4(normal, 1.0)).xyz);\n        }\n    "])))),n.fragment.code.add(u.glsl(S||(S=d.__makeTemplateObject(["\n        void main() {\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) {\n            normal \x3d -normal;\n          }\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 0.0);\n        }\n    "],
["\n        void main() {\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) {\n            normal \x3d -normal;\n          }\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 0.0);\n        }\n    "])))));4===a.output&&(n.include(k.Transform,{linearDepth:!1}),n.include(f.NormalUtils,a),n.include(b.Overlay,{pbrMode:0}),n.vertex.code.add(u.glsl(P||(P=d.__makeTemplateObject(["\n          void main() {\n            vec3 vnormal \x3d getLocalUp(position, origin);\n            vec2 uv \x3d uv0;\n            vec3 vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\n            setOverlayVTC(uv);\n\n            gl_Position \x3d transformPosition(proj, view, vpos);\n          }\n      "],
["\n          void main() {\n            vec3 vnormal \x3d getLocalUp(position, origin);\n            vec2 uv \x3d uv0;\n            vec3 vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\n            setOverlayVTC(uv);\n\n            gl_Position \x3d transformPosition(proj, view, vpos);\n          }\n      "])))),n.include(h.OutputHighlight),n.fragment.code.add(u.glsl(U||(U=d.__makeTemplateObject(["\n        void main() {\n          vec4 overlayColor \x3d getCombinedOverlayColor();\n\n          if (overlayColor.a \x3d\x3d 0.0) {\n            gl_FragColor \x3d vec4(0.0);\n            return;\n          }\n\n          outputHighlight();\n        }\n      "],
["\n        void main() {\n          vec4 overlayColor \x3d getCombinedOverlayColor();\n\n          if (overlayColor.a \x3d\x3d 0.0) {\n            gl_FragColor \x3d vec4(0.0);\n            return;\n          }\n\n          outputHighlight();\n        }\n      "])))));return n};var q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O,N,S,P,U})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,
a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.VertexTangent=void 0;a.VertexTangent=function(a,m){a.varyings.add("tbnTangent","vec3");a.varyings.add("tbnBiTangent","vec3");1===m.viewingMode?a.vertex.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n      void forwardVertexTangent(vec3 n) {\n        tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n        tbnBiTangent \x3d normalize(cross(n, tbnTangent));\n      }\n    "],["\n      void forwardVertexTangent(vec3 n) {\n        tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n        tbnBiTangent \x3d normalize(cross(n, tbnTangent));\n      }\n    "])))):
a.vertex.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n      void forwardVertexTangent(vec3 n) {\n        tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n        tbnBiTangent \x3d normalize(cross(n, tbnTangent));\n      }\n    "],["\n      void forwardVertexTangent(vec3 n) {\n        tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n        tbnBiTangent \x3d normalize(cross(n, tbnTangent));\n      }\n    "]))));a.fragment.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n      mat3 getTBNMatrix(vec3 n) {\n        return mat3(tbnTangent, tbnBiTangent, n);\n      }\n    "],
["\n      mat3 getTBNMatrix(vec3 n) {\n        return mat3(tbnTangent, tbnBiTangent, n);\n      }\n    "]))))};var k,e,c})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("require exports tslib ../shading/EvaluateMainLighting.glsl ../shading/Water.glsl ../../shaderModules/interfaces".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.Overlay=void 0;a.Overlay=function(a,g){3!==g.pbrMode&&4!==g.pbrMode||a.include(k.Water,g);a.vertex.uniforms.add("overlayTexOffset",
"vec4");a.vertex.uniforms.add("overlayTexScale","vec4");a.varyings.add("vtcOverlay","vec4");a.vertex.code.add(e.glsl(c||(c=d.__makeTemplateObject(["\n    void setOverlayVTC(in vec2 uv) {\n      vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n    }\n  "],["\n    void setOverlayVTC(in vec2 uv) {\n      vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n    }\n  "]))));a.fragment.uniforms.add("ovInnerColorTex","sampler2D");a.fragment.uniforms.add("ovOuterColorTex",
"sampler2D");a.fragment.uniforms.add("overlayOpacity","float");a.fragment.code.add(e.glsl(h||(h=d.__makeTemplateObject(["\n    vec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {\n      // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\n      // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\n      // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\n      vec4 color0 \x3d texture2D(ov0Tex, texCoords.xy);\n      vec4 color1 \x3d texture2D(ov1Tex, texCoords.zw);\n\n      float valid0 \x3d float((texCoords.x \x3e\x3d 0.0) \x26\x26 (texCoords.x \x3c\x3d 1.0) \x26\x26 (texCoords.y \x3e\x3d 0.0) \x26\x26 (texCoords.y \x3c\x3d 1.0));\n      float valid1 \x3d float((texCoords.z \x3e\x3d 0.0) \x26\x26 (texCoords.z \x3c\x3d 1.0) \x26\x26 (texCoords.w \x3e\x3d 0.0) \x26\x26 (texCoords.w \x3c\x3d 1.0));\n\n      // Pick color0 if valid, otherwise color1 if valid, otherwise vec4(0)\n      return mix(color1 * valid1, color0, valid0);\n    }\n  "],
["\n    vec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {\n      // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\n      // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\n      // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\n      vec4 color0 \x3d texture2D(ov0Tex, texCoords.xy);\n      vec4 color1 \x3d texture2D(ov1Tex, texCoords.zw);\n\n      float valid0 \x3d float((texCoords.x \x3e\x3d 0.0) \x26\x26 (texCoords.x \x3c\x3d 1.0) \x26\x26 (texCoords.y \x3e\x3d 0.0) \x26\x26 (texCoords.y \x3c\x3d 1.0));\n      float valid1 \x3d float((texCoords.z \x3e\x3d 0.0) \x26\x26 (texCoords.z \x3c\x3d 1.0) \x26\x26 (texCoords.w \x3e\x3d 0.0) \x26\x26 (texCoords.w \x3c\x3d 1.0));\n\n      // Pick color0 if valid, otherwise color1 if valid, otherwise vec4(0)\n      return mix(color1 * valid1, color0, valid0);\n    }\n  "]))));
a.fragment.code.add(e.glsl(m||(m=d.__makeTemplateObject(["\n    vec4 getCombinedOverlayColor() {\n      return overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n    }\n  "],["\n    vec4 getCombinedOverlayColor() {\n      return overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n    }\n  "]))));if(3===g.pbrMode||4===g.pbrMode)a.include(l.EvaluateMainLighting),a.fragment.code.add(e.glsl(f||(f=d.__makeTemplateObject(["\n    vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\n       float shadow, vec3 localUp, mat3 tbn, vec3 position) {\n\n      // reproject normal from 0...1 \x3d\x3e -1...1\n      // and project it to worldspace.\n      vec3 n \x3d normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\n      vec3 v \x3d vposEyeDir;\n      vec3 l \x3d normalize(-lightingMainDirection);\n      vec3 final \x3d getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position);\n\n      // the terrain renderer assumes a premultiplied color output without gamma.\n      return vec4(final, colorInput.w);\n    }\n    "],
["\n    vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\n       float shadow, vec3 localUp, mat3 tbn, vec3 position) {\n\n      // reproject normal from 0...1 \x3d\x3e -1...1\n      // and project it to worldspace.\n      vec3 n \x3d normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\n      vec3 v \x3d vposEyeDir;\n      vec3 l \x3d normalize(-lightingMainDirection);\n      vec3 final \x3d getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position);\n\n      // the terrain renderer assumes a premultiplied color output without gamma.\n      return vec4(final, colorInput.w);\n    }\n    "]))))};
var c,h,m,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.Skirts=void 0;a.Skirts=function(a){a.vertex.code.add(l.glsl(k||(k=d.__makeTemplateObject(['\n    vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n      float skirtLength \x3d 0.0;\n\n      if (uv.x \x3e\x3d 2.0) {\n        skirtLength \x3d uv.y * skirtScale;\n        // decode original uv-coordinates (see "encodeSkirtPos")\n        vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\n        uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n      }\n\n      return vpos - vnormal * skirtLength;\n    }\n    '],
['\n    vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n      float skirtLength \x3d 0.0;\n\n      if (uv.x \x3e\x3d 2.0) {\n        skirtLength \x3d uv.y * skirtScale;\n        // decode original uv-coordinates (see "encodeSkirtPos")\n        vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\n        uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n      }\n\n      return vpos - vnormal * skirtLength;\n    }\n    ']))))};var k})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.TerrainTexture=void 0;a.TerrainTexture=function(a,g){a.varyings.add("vtc","vec2");a.vertex.uniforms.add("texOffsetAndScale","vec4");a.fragment.uniforms.add("tex","sampler2D");g.textureFadingEnabled&&(a.vertex.uniforms.add("nextTexOffsetAndScale","vec4"),a.varyings.add("nvtc","vec2"),a.fragment.uniforms.add("texNext","sampler2D"),a.fragment.uniforms.add("textureFadeFactor","float"));
a.vertex.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n  void forwardTextureCoordinates(in vec2 uv) {\n    vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n    ","\n  }\n  "],["\n  void forwardTextureCoordinates(in vec2 uv) {\n    vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n    ","\n  }\n  "])),g.textureFadingEnabled?l.glsl(k||(k=d.__makeTemplateObject(["nvtc \x3d uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;"],["nvtc \x3d uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;"]))):
l.glsl(e||(e=d.__makeTemplateObject([""],[""])))));a.fragment.code.add(l.glsl(f||(f=d.__makeTemplateObject(["\n  vec4 getTileColor() {\n    ","\n  }\n  "],["\n  vec4 getTileColor() {\n    ","\n  }\n  "])),g.textureFadingEnabled?l.glsl(h||(h=d.__makeTemplateObject(["return textureFadeFactor \x3c 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);"],["return textureFadeFactor \x3c 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);"]))):
l.glsl(m||(m=d.__makeTemplateObject(["return texture2D(tex, vtc);"],["return texture2D(tex, vtc);"])))))};var k,e,c,h,m,f})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.UpsampleInfo=void 0;n=function(){function a(){this.offset=d.vec2f64.create();this.scale=0;this.tile=null}a.prototype.init=function(a,d,c,h){this.tile=a;this.offset[0]=d;this.offset[1]=c;this.scale=
h};a.prototype.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return a}();a.UpsampleInfo=n})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports tslib ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./lib/AutoDisposable ./lib/GeometryRecord ./lighting/Lightsources ./parts/Model ./parts/RenderView".split(" "),function(n,a,d,l,k,e,c,h,m,f,
b,g,p){function t(a){return"function"===typeof a.addParentStage&&"function"===typeof a.removeParentStage}Object.defineProperty(a,"__esModule",{value:!0});a.Stage=void 0;n=function(a){function l(b){b=a.call(this,b)||this;b.model=new g.Model;b._viewContent=[];b._mainLightDirection=h.vec3f64.fromValues(0,1,0);return b}d.__extends(l,a);q=l;l.prototype.initialize=function(){this._set("renderView",new p.RenderView(this));this.setLighting({lights:[new b.MainLight(h.vec3f64.fromValues(.7,.7,.7)),new b.AmbientLight(h.vec3f64.fromValues(.3,
.3,.3))],groundLightingFactor:.5,globalFactor:.5})};l.prototype.destroy=function(){f.pool.prune(0);this.dispose()};Object.defineProperty(l.prototype,"dirty",{get:function(){return this.model.getDirtySet().hasDirtyGeometryRecords()},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"mainLightDirection",{get:function(){return this._mainLightDirection},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"lighting",{get:function(){return this._lighting},enumerable:!1,configurable:!0});
l.prototype.setLighting=function(a){c.vec3.set(this._mainLightDirection,0,0,0);for(var d=0,e=a.lights;d<e.length;d++){var f=e[d];if(f instanceof b.MainLight){c.vec3.negate(this._mainLightDirection,f.direction);break}}this._lighting=a;this.renderView.setNeedsRender()};l.prototype.stopAnimationsAtTime=function(a){this.getAll(3).forEach(function(b){k.applySome(b.animation,function(b){return b.stopAtTime(a)})});this.renderView.setNeedsRender()};l.prototype.add=function(a,b){this.model.add(a,b);t(b)&&
b.addParentStage(this);this.renderView.setNeedsRender()};l.prototype.remove=function(a,b){this.renderView.setNeedsRender();a=this.model.remove(a,b);t(a)&&a.removeParentStage(this);return a};l.prototype.notifyDirty=function(a,b,c){this.model.notifyDirty(a,b,c);this.renderView.setNeedsRender()};l.prototype.processDirty=function(){var a=this.model.getDirtySet();if(a.hasDirtyGeometryRecords()){q.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo());var b=a.commitLayers(this._viewContent);
0<b[0].length+b[1].length+b[2].length&&this.renderView.modify(b[0],b[1],b[2]);q.DebugSettings.logDirtySet&&(console.log("RGs add: "+b[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+b[1].map(function(a){return a.uniqueName})));a.commit();this.renderView.setNeedsRender()}};l.prototype.processDirtyLayer=function(a){a=this.model.getDirtySet().commitLayers([a]);0<a[0].length+a[1].length+a[2].length&&this.renderView.modify(a[0],a[1],a[2]);this.renderView.setNeedsRender()};l.prototype.getContent=
function(a,b){return this.model.get(a,b)};l.prototype.getAll=function(a){return this.model.getAll(a)};l.prototype.getCount=function(a){return this.model.getAll(a).size};l.prototype.getCamera=function(){return this.renderView.getCamera()};l.prototype.setCamera=function(a){this.renderView.setCamera(a)};l.prototype.getLayers=function(){return this.model.getAll(0)};l.prototype.getViewContent=function(){return this._viewContent.slice(0)};l.prototype.addToViewContent=function(a){for(var b=[],c=0;c<a.length;c++)-1===
this._viewContent.indexOf(a[c])&&b.push(a[c]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.renderView.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,b))};l.prototype.removeFromViewContent=function(a){this.processDirty();for(var b=this.model.getDirtySet(),c=this._viewContent,d=[],e=0;e<a.length;e++){var f=c.indexOf(a[e]);-1<f&&(c[f]=c[c.length-1],c.pop(),d.push(a[e]))}a=b.getResidentRenderGeometriesFilteredByLayers(d);
this.renderView.modify([],a,[])};l.prototype.addRenderPlugin=function(a,b){"intersect"in b&&this.sceneIntersectionHelper.addIntersectionHandler(b);this.renderView.renderPlugins.add(a,b)};l.prototype.removeRenderPlugin=function(a){"intersect"in a&&this.sceneIntersectionHelper.removeIntersectionHandler(a);this.renderView.renderPlugins.remove(a)};l.prototype.getCombinedStats=function(){return{renderView:this.renderView.getCombinedStats(),model:this.model.getStats()}};var q;l.DebugSettings={endFrameContentValidation:!1,
logDirtySet:!1};d.__decorate([e.property({constructOnly:!0})],l.prototype,"scheduler",void 0);d.__decorate([e.property({constructOnly:!0})],l.prototype,"options",void 0);d.__decorate([e.property({constructOnly:!0})],l.prototype,"sceneIntersectionHelper",void 0);d.__decorate([e.property({constructOnly:!0})],l.prototype,"viewingMode",void 0);d.__decorate([e.property({constructOnly:!0})],l.prototype,"container",void 0);d.__decorate([m.autoDispose(),e.property()],l.prototype,"renderView",void 0);return l=
q=d.__decorate([e.subclass("esri.views.3d.webgl-engine.Stage")],l)}(m.AutoDisposableMixin(l));a.Stage=n})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports ../../support/mathUtils ../lib/localOrigin ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.Model=void 0;var h=c.assert,m=c.logWithBase;n=function(){function a(){this.dirtySet=new k(this);this._id2origin={};this._content=Array(5);
for(var a=0;5>a;++a)this._content[a]=new Map}a.prototype.getAll=function(a){a=this._content[a];h(void 0!==a);return a};a.prototype.get=function(a,c){return this.getAll(a).get(c)};a.prototype.add=function(a,c){var b=this._content[a];h(void 0!==b);var d=c.id;h(!b.has(d),"Model/Stage already contains object to be added");b.set(d,c);0===a&&this.notifyDirty(c,"layerAdded")};a.prototype.remove=function(a,c){var b=this._content[a];h(void 0!==b);var d=b.get(c);h(void 0!==d,"Model/Stage doesn't contain object to be removed");
b.delete(c);4===a&&d.unload();0===a&&this.notifyDirty(d,"layerRemoved");return d};a.prototype.getDirtySet=function(){return this.dirtySet};a.prototype.notifyDirty=function(a,c,d){this.dirtySet.handleUpdate(a,c,d)};a.prototype.getOrigin=function(a,c,d){void 0===d&&(d=10);var b=0;c=c*d/1E4;1<c&&(b=Math.ceil(m(c,2)));c=1E4*Math.pow(2,b);d=Math.round(a[0]/c);var e=Math.round(a[1]/c);a=Math.round(a[2]/c);var b=b+"_"+d+"_"+e+"_"+a,f=this._id2origin[b];null==f&&(f=l.fromValues(d*c,e*c,a*c,b),this._id2origin[b]=
f);return f};a.prototype.getGeometryRenderGeometries=function(a,c,f){var b=c.geometry,g=a.getCombinedStaticTransformation(c),h=d.maxScale(g),k=c.origin;a=new e(b.data,b.boundingInfo,c.material,g,c.shaderTransformation,h,a.castShadow);a.uniqueName=c.id;a.origin=k||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=c.instanceParameters;f.push(a)};a.prototype.updateRenderGeometryTransformation=function(a,c,d){a=a.getCombinedStaticTransformation(c,d.transformation);d.updateTransformation(a);a=this.getOrigin(d.center,
d.bsRadius);return d.origin!==a};a.prototype.getStats=function(){for(var a={},c=0;5>c;++c)a[c]=this.getAll(c).size;return{contentTypes:a,dirtySet:this.dirtySet.formatDebugInfo()}};a.prototype.validateObject=function(a){a=a.geometryRecords;for(var b=0;b<a.length;++b){var c=a[b];h(null!=this.get(2,c.geometry.id));h(null!=this.get(3,c.material.id))}};a.prototype.validateLayer=function(a){a=a.getObjects();for(var b=0;b<a.length;++b){var c=this.get(1,a[b].id);h(null!=c)}};return a}();a.Model=n})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define(["require",
"exports","../../../../core/arrayUtils","../../../../core/MapUtils","./Util"],function(n,a,d,l,k){return function(){function a(a){this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this._model=a}Object.defineProperty(a.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"residentObjectCount",{get:function(){var a=0;this._residentGeomRecords.forEach(function(c){a+=c.size});return a},enumerable:!1,
configurable:!0});a.prototype.hasDirtyGeometryRecords=function(){return l.someMap(this._dirtyGeomRecords,function(a){return l.someMap(a,function(a){return a&&0<a.size})})};a.prototype.handleUpdate=function(a,d,e){k.assert(this[d],"ModelDirtySet doesn't know how to process "+d);return this[d](a,e)};a.prototype.shaderTransformationChanged=function(a){var c=this;(a=this._residentGeomRecords.get(a.id))&&a.forEach(function(a,d){(d=c._model.get(1,d))&&d.hasVolativeTransformation()&&a.forEach(function(a){var b=
0;for(a=a[1];b<a.length;b++)a[b].shaderTransformationChanged()})})};a.prototype.commit=function(){return this.commitLayers(d.keysOfMap(this._dirtyGeomRecords))};a.prototype.commitLayers=function(a){for(var c=this,d=[],e=[],b=[],g=function(f){var g=a[f];f=l._dirtyGeomRecords.get(g);if(!f)return"continue";f.forEach(function(a,f){var h=c._ensureGeomRecord(g,f);a.forEach(function(a,g){var m=a[0],l=a[1];a=a[2];var p=!1;if(l&2){var r=h.get(g);if(r){r=r[1];if(a&4)for(var q=c._model.get(1,f),n=0;n<r.length;n++){var t=
r[n];if(c._model.updateRenderGeometryTransformation(q,m,t)){p=!0;break}}if(!p)for(q=0;q<r.length;q++)t=r[q],b.push({renderGeometry:t,updateType:a})}else k.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l&4||p)(r=h.get(g))?e.push.apply(e,r[1]):4===l&&k.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),r&&h.delete(g);if(l&1||p)l=[m,[]],q=c._model.get(1,f),c._model.getGeometryRenderGeometries(q,m,l[1]),d.push.apply(d,l[1]),h.set(g,l)});0===h.size&&
c._residentGeomRecords.get(g).delete(f)});0===l._residentGeomRecords.get(g).size&&l._residentGeomRecords.delete(g);l._dirtyGeomRecords.delete(g)},l=this,n=0;n<a.length;n++)g(n);return[d,e,b]};a.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(d.keysOfMap(this._residentGeomRecords))};a.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var c=[],d=0;d<a.length;d++){var e=this._residentGeomRecords.get(a[d]);e&&e.forEach(function(a){a.forEach(function(a){c.push.apply(c,
a[1])})})}return c};a.prototype._objectStateChanged=function(a,d,e,f){if(null!=e)this._componentPropertyChanged(d,e,f,a);else{e=0;for(var b=d.geometryRecords;e<b.length;e++)this._componentPropertyChanged(d,b[e],f,a)}};a.prototype.visibilityChanged=function(a,d,e){this._objectStateChanged(1,a,d,e)};a.prototype.highlightChanged=function(a,d,e){this._objectStateChanged(8,a,d,e)};a.prototype.occlusionChanged=function(a,d,e){this._objectStateChanged(16,a,d,e)};a.prototype.vertexAttrsUpdated=function(a,
d,e){this._updateOrCreateDirtyRecord(a,d,e,2,0,0,2,5,2)};a.prototype.layerAdded=function(a){for(var c=a.getObjects(),d=0;d<c.length;d++)this.layerObjectAdded(a,c[d])};a.prototype.layerRemoved=function(a){for(var c=a.getObjects(),d=0;d<c.length;d++)this.layerObjectRemoved(a,c[d])};a.prototype.layerObjectAdded=function(a,d){a=a.id;for(var c=d.geometryRecords,e=0;e<c.length;e++)this.objGeometryAdded(d,c[e],a)};a.prototype.layerObjectRemoved=function(a,d){a=a.id;for(var c=d.geometryRecords,e=0;e<c.length;e++)this.objGeometryRemoved(d,
c[e],a)};a.prototype.layObjectReplaced=function(a,d){this.layerObjectRemoved(a,d[0]);this.layerObjectAdded(a,d[1])};a.prototype.objTransformation=function(a,d){var c=this;d=d||this._getParentLayerId(a);this._ensureGeomRecord(d,a.id).forEach(function(e){c._updateOrCreateDirtyRecord(a,e[0],d,2,0,0,2,5,4)})};a.prototype.objGeometryAdded=function(a,d,e){this._updateOrCreateDirtyRecord(a,d,e,1,4,0,0,0)};a.prototype.objGeometryRemoved=function(a,d,e){this._updateOrCreateDirtyRecord(a,d,e,4,1,2,0,0)};a.prototype._componentPropertyChanged=
function(a,d,e,f){this._updateOrCreateDirtyRecord(a,d,e,2,0,0,2,5,f)};a.prototype._updateOrCreateDirtyRecord=function(a,d,e,f,b,g,l,n,u){e=e||this._getParentLayerId(a);var c=d.id;a=this._ensureDirtyRecord(e,a.id);(e=a.get(c))?(d=e[1],d&b?a.delete(c):d&g?(e[1]=f,e[2]=u):d&l?e[2]|=u:d&n||k.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):a.set(c,[d,f,u])};a.prototype._ensureGeomRecord=function(a,d){var c=this._residentGeomRecords.get(a);c||(c=new Map,this._residentGeomRecords.set(a,
c));a=c.get(d);a||(a=new Map,c.set(d,a));return a};a.prototype._ensureDirtyRecord=function(a,d){var c=this._dirtyGeomRecords.get(a);c||(c=new Map,this._dirtyGeomRecords.set(a,c));a=c.get(d);a||(a=new Map,c.set(d,a));return a};a.prototype._getParentLayerId=function(a){return a.parentLayer.id};a.prototype.formatDebugInfo=function(){var a=["ADD","UPD",void 0,"REM"],d="";this._dirtyGeomRecords.forEach(function(c,e){c.forEach(function(b,c){0<d.length&&(d+="\n");d+=e+"."+c;var f=[];b.forEach(function(a){var b=
a[1];f[b]||(f[b]=[]);f[b].push(a[0].geometry.id)});for(b=0;b<f.length;b++)if(f[b])for(d+=" "+a[b-1]+": ",c=0;c<f[b].length;c++)d+=f[b][c]+", "})});return d};return a}()})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/timeUtils ../../support/animationUtils ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/CommonUniformStore ../core/shaderTechnique/ShaderTechniqueRepository ../lib/AutoDisposable ../lib/CompositingHelper ../lib/GLMaterialRep ../lib/Renderer ../lib/TextureRepository ../lib/tracer ../lib/WebGLDriverTest ../materials/lineStippleUtils ../materials/internal/WaterTextureRepository ./requireUtils ./ScreenshotManager ../../../webgl/context-util ../../../webgl/RenderingContext".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J){Object.defineProperty(a,"__esModule",{value:!0});a.RenderView=void 0;var I=c.getLogger("esri.views.3d.webgl-engine.parts.View");n=function(a){function c(b){var c=a.call(this,{})||this;c._stage=b;c.events=new k;c._stippleTextureRepository=new C.StippleTextureRepository;c.waterTextureRepository=new E.WaterTextureRepository;c._commonUniformStore=new u.CommonUniformStore;c._componentObjectCollection=null;c._needsUpdate=!0;c._needsRender=
!0;c._idleSuspend=!0;c._logicUpdateLast=0;c._stats={renderTimeTotal:0,renderTimeLast:0,frameCount:0};c._container=c._stage.container;c._initializeContext(c._stage.options);f.init(c.waterTextureRepository,"loadingState",function(){return c.setNeedsRender()});c._shaderTechniqueRepository=new r.ShaderTechniqueRepository({rctx:c._rctx,viewingMode:c._stage.options.viewingMode,commonUniformStore:c._commonUniformStore,stippleTextureRepository:c._stippleTextureRepository,waterTextureRepository:c.waterTextureRepository});
c._textureRepository=new x.TextureRepository(c._stage.scheduler,c._stage.getAll(4),c._shaderTechniqueRepository,c._rctx);c._textureRepository.events.on("changed",function(a){return c.setNeedsRender(a)});c._materialRepository=new w(c._textureRepository,c._shaderTechniqueRepository,function(){return c.setNeedsRender()});c._compositingHelper=new v.default(c._rctx,c._shaderTechniqueRepository);b=c._container.getBoundingClientRect();c._renderer=new z.default(c._materialRepository,c._textureRepository,
c._shaderTechniqueRepository,c._rctx,c._compositingHelper,function(a){void 0===a&&(a=1);return c.setNeedsRender(a)},[b.width,b.height],c._stage);c._screenshotManager=new F.ScreenshotManager(c._rctx,function(a,b,d){return c._render(a,b,d)},function(){return c.setNeedsRender()},c._stage.options.screenshot.renderOverlay,function(a){return c.events.emit("force-camera-for-screenshot",a)});c._registerFrameTask();return c}d.__extends(c,a);c.prototype.normalizeCtorArgs=function(){return{}};c.prototype.dispose=
function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._shaderTechniqueRepository.dispose();this._shaderTechniqueRepository=null;A.clearTestWebGLDriver(this._rctx);a.prototype.dispose.call(this);this._rctx=null};c.prototype.getCombinedStats=function(){var a=this._rctx.gl;return d.__assign(d.__assign({},this._stats),{scene:this._renderer.getStats(),textureMemory:void 0!==a.getUsedTextureMemory?
a.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==a.getUsedRenderbufferMemory?a.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==a.getUsedVBOMemory?a.getUsedVBOMemory():void 0})};c.prototype.setNeedsRender=function(a){void 0===a&&(a=1);1===a?this._needsUpdate||(this._needsUpdate=!0,this.notifyChange("updating")):this._needsRender=!0};Object.defineProperty(c.prototype,"canRender",{get:function(){return this._renderer.canRender},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,
"needsUpdate",{get:function(){return this._needsUpdate},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return this.needsUpdate||this._renderer.updating||0<this._textureRepository.loadingCount||this.waterTextureRepository.updating||this._stage.dirty},enumerable:!1,configurable:!0});c.prototype.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};Object.defineProperty(c.prototype,"edgeView",{get:function(){return this._renderer.edgeView},enumerable:!1,
configurable:!0});Object.defineProperty(c.prototype,"textureRepository",{get:function(){return this._textureRepository},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"compositingHelper",{get:function(){return this._compositingHelper},enumerable:!1,configurable:!0});c.prototype.setRenderParameters=function(a){this.setNeedsRender();void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._renderer.setRenderParams(a)};Object.defineProperty(c.prototype,"renderingContext",{get:function(){return this._rctx},
enumerable:!1,configurable:!0});c.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:!1};c.prototype.modify=function(a,b,c){this._renderer.modify(a,a.length,b,b.length,c,c.length)};c.prototype.setCamera=function(a){this._renderer.camera=a};c.prototype.getCamera=function(){return this._renderer.camera};c.prototype.getCanvas=function(){return this._canvas};c.prototype.takeScreenshot=function(a){return this._screenshotManager.takeScreenshot(a)};
Object.defineProperty(c.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"test",{get:function(){return{renderer:this._renderer}},enumerable:!1,configurable:!0});c.prototype.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()};c.prototype.hotReloadShaders=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(a){switch(a.label){case 0:return G.removeLoadedShaderModules(),
[4,this._shaderTechniqueRepository.hotReload()];case 1:return a.sent(),this.setNeedsRender(),[2]}})})};c.prototype._registerFrameTask=function(){var a=this,b={viewCamera:this._renderer.camera,frameHasSlicePlane:!1};this._frameTask=m.addFrameTask({preRender:function(b){B.begin();var c=!1;a._stage.processDirty();var d=g.Milliseconds(b.time-a._logicUpdateLast);d>p.DESIRED_ANIMATION_MS&&(c=a._renderer.updateLogic({camera:a._renderer.camera,dt:d}),a._logicUpdateLast=b.time);c&&a.setNeedsRender(0)},render:function(){(a.needsUpdate||
a._needsRender||!a._idleSuspend)&&a.canRender&&(a._needsRender=!1,a._needsUpdate=!1,a._render(null,a._renderer.camera,!1))},postRender:function(){a.notifyChange("updating");B.end()},update:function(){b.viewCamera=a._renderer.camera;b.frameHasSlicePlane=a._renderer.hasSlicePlane;a._textureRepository.update();a._screenshotManager.update(b)}})};c.prototype._initializeContext=function(a){this._canvas=a.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style",
"width: 100%; height:100%; display:block;");var b=B.instrumentContext(H.createContextOrErrorHTML(this._canvas,{alpha:a.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==a.stencil?!0:a.stencil,powerPreference:"high-performance"},a.renderContext));this._rctx=new J(b,{disabledExtensions:a.deactivatedWebGLExtensions||{},debugWebGLExtensions:a.debugWebGLExtensions||{}});null!=this._rctx.parameters.maxMaxAnisotropy&&(this._rctx.parameters.maxMaxAnisotropy=Math.min(this._rctx.parameters.maxMaxAnisotropy,
8));this._loadShaderOnlyExtensions(this._rctx);!a.alpha&&this._rctx.contextAttributes.alpha&&I.error("WebGL context has alpha channel even though no alpha channel was requested");!this._rctx.contextAttributes.alpha&&11<=e("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas)};c.prototype._render=function(a,b,c){this._renderer.setLighting(this._stage.lighting);this._renderer.render(a,b,c,this._stage.mainLightDirection)};c.prototype._loadShaderOnlyExtensions=
function(a){a=a.capabilities;a.standardDerivatives;a.shaderTextureLOD;a.textureFloat};Object.defineProperty(c.prototype,"componentObjectCollection",{get:function(){h.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=new t.ComponentObjectCollection(this._renderer.renderPassManager));return this._componentObjectCollection},set:function(a){this._componentObjectCollection=a},enumerable:!1,configurable:!0});d.__decorate([b.property({type:Boolean,readOnly:!0,dependsOn:["waterTextureRepository.updating"]})],
c.prototype,"updating",null);d.__decorate([q.autoDispose()],c.prototype,"_rctx",void 0);d.__decorate([q.autoDispose()],c.prototype,"_container",void 0);d.__decorate([q.autoDispose()],c.prototype,"_canvas",void 0);d.__decorate([q.autoDispose()],c.prototype,"_stippleTextureRepository",void 0);d.__decorate([q.autoDispose(),b.property()],c.prototype,"waterTextureRepository",void 0);d.__decorate([q.autoDispose()],c.prototype,"_textureRepository",void 0);d.__decorate([q.autoDispose()],c.prototype,"_commonUniformStore",
void 0);d.__decorate([q.autoDispose()],c.prototype,"_compositingHelper",void 0);d.__decorate([q.autoDispose()],c.prototype,"_renderer",void 0);d.__decorate([q.autoDispose()],c.prototype,"_screenshotManager",void 0);d.__decorate([q.autoDispose()],c.prototype,"componentObjectCollection",null);d.__decorate([q.autoDispose()],c.prototype,"_componentObjectCollection",void 0);return c=d.__decorate([b.subclass("esri.views.3d.webgl-engine.parts.RenderView")],c)}(q.AutoDisposableMixin(l));a.RenderView=n})},
"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("require exports tslib ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/typedArrayUtil ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../../geometry/support/aaBoundingBox ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/BufferView ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./interface ./RenderSubmitSystem ./SourceGeometry ./IndexRange/ComponentRangeRunLengthEncoded ./Material/ComponentMaterial ./Material/ComponentTechnique ../../core/util/BucketedObjectStore ../../core/util/TwoVectorPosition ../../lib/AutoDisposable ../../lib/ComponentUtils ../../lib/geometryDataUtils ../../lib/Util ../../lib/TextureBackedBuffer/BufferManager ../../materials/internal/MaterialUtil ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q){function R(a,b,c){var d=[],e=c.length;b.forEachComponent(function(b){0<a[b]&&(e!==b-1&&(d.length&&d.push(c[e+1]-d[d.length-1]),d.push(c[b])),e=b);return!0});d.length&&d.push(c[e+1]-d[d.length-1]);return d}Object.defineProperty(a,"__esModule",{value:!0});a.ComponentObject=a.Renderable=a.RenderGeometry=a.ComponentObjectCollection=void 0;var O=l.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");
n=function(){function a(a){this._renderManager=a;this._objects=new E.BucketedObjectStore;this._renderSubmit=new z.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._componentBufferManager=new K.BufferManager(a.rctx)}a.prototype.dispose=function(){I.assert(0===this.count,"ObjectCollection should be empty upon disposal");this._componentBufferManager=k.destroyMaybe(this._componentBufferManager)};a.prototype.createObject=function(a){var b=new V;b.toMapSpace=a.toMapSpace.slice();
b.transform=a.transform;b.obb=u.clone(a.obb);b.components=new N(this._componentBufferManager,a.geometry.componentOffsets);b.renderable=this._createRenderable(a,b.components);b.intersectionGeometry=new S(a.geometry.positionData,b.components);this._objects.add(a.visible?ga:0,b);return b};a.prototype.destroyObject=function(a){this._objects.remove(a);a.dispose();this._notifyDirty()};a.prototype.setObjectVisibility=function(a,b){b!==a.visible&&(this._objects.updateKey(a,b?a.bucketKey|ga:a.bucketKey&~ga),
this._notifyDirty())};Object.defineProperty(a.prototype,"count",{get:function(){return this._objects.count},enumerable:!1,configurable:!0});a.prototype.preSubmit=function(a){var b=a.camera.eye;this._objects.forEach(function(a,c){c&ga&&a.forEach(function(a){var c=m.vec3.squaredDistance(b,a.obb.center);a.renderable.meta.cameraDepthSquared=c})})};a.prototype.updateMaterial=function(a,b){a=a.renderable.material;b(a);a.dirty&&this._notifyDirty()};a.prototype.setAllComponentVisibilities=function(a,b){a.components.visibility.reset(b);
a.components.visibilityDirty();this._notifyDirty()};a.prototype.forEachVisibleComponent=function(a,b){return a.components.visibility.forEachComponent(b)};a.prototype.getComponentCount=function(a){var b=a.components.visibility.componentCount();return{visible:b,invisible:a.components.count-b}};a.prototype.setComponentData=function(a,b){var c=a.renderable.material;if(w.isVaryingComponentParameters(b)){a=a.components;for(var d=a.materialDataBuffer,e=a.materialDataIndices,f={castShadows:!0,pickable:!0,
externalColor:g.vec4f32.create(),externalColorMixMode:1},d=d.textureBuffer,h=new Uint8Array(4),k=new Uint32Array(h.buffer),m=0,l=0,p=0,r=!1,q=0,n=0;n<a.count;n++)b(n,f),m+=+(1>f.externalColor[3]),l+=+(3===f.externalColorMixMode&&1===f.externalColor[3]),p+=+f.castShadows,t.encodeSymbolColor(f.externalColor,f.externalColorMixMode,h),h[2]=h[2]&254|+f.castShadows,d.setData(e[n],0,h[0],h[1],h[2],h[3]),r=r||0<n&&q!==k[0],q=k[0],f.pickable!==H.getVisibility(a.pickability,n)&&(a.pickability=H.updateVisibilityWithCount(a.pickability,
a.count,n,f.pickable));r?(c.componentParameters=new A.ComponentParametersVarying,c.componentParameters.castShadows=p===a.count?0:0===p?2:1,c.componentParameters.transparent=m===a.count?0:0===m?2:1,c.componentParameters.opaqueOverride=l===a.count?0:0===l?2:1,c.componentParameters.texture=d,d.updateTexture()):(c.componentParameters=new A.ComponentParametersUniform,c.componentParameters.castShadows=f.castShadows?0:2,c.componentParameters.externalColor=f.externalColor,c.componentParameters.externalColorMixMode=
f.externalColorMixMode)}else c.componentParameters=new A.ComponentParametersUniform,c.componentParameters.castShadows=b.castShadows?0:2,c.componentParameters.externalColor=b.externalColor,c.componentParameters.externalColorMixMode=b.externalColorMixMode;this._notifyDirty()};a.prototype.getComponentAabb=function(a,b,c){return a.intersectionGeometry.getComponentAabb(b,c)};a.prototype.getComponentObb=function(a){return a.obb};a.prototype.getObjectTransform=function(a){return a.transform};a.prototype.getComponentPositions=
function(a,b,c){return a.intersectionGeometry.getComponentPositions(b,c)};a.prototype.intersect=function(a,b,d,e,f,g){k.isSome(f)&&(f.localOrigin=a.transform.position);var h=c.mat3.invert(T,a.transform.rotationScale);m.vec3.sub(X,b,a.transform.position);m.vec3.sub(ca,d,a.transform.position);m.vec3.transformMat3(X,X,h);m.vec3.transformMat3(ca,ca,h);b=c.mat3.transpose(T,h);return a.intersectionGeometry.intersect(X,ca,e,b,f,g)};a.prototype.addEdges=function(a,b,c,d){var e=a.intersectionGeometry;return b.addComponentObject(a,
a.transform,a.obb.center,e.positions,e.indices,a.components.offsets,c,d)};a.prototype.addComponentHighlight=function(a,b){a=a.components;k.isNone(a.highlightCounts)&&(a.highlightCounts=new Uint32Array(a.count+1));0===a.highlightCounts[b]++&&(a.highlightsDirty(),this._notifyDirty());a.highlightCounts[a.count]++};a.prototype.removeComponentHighlight=function(a,b){a=a.components;if(k.isNone(a.highlightCounts))O.warn("Removing non-existing highlight.");else{var c=a.highlightCounts[b],d=a.highlightCounts[a.count];
0===c?O.warn("Removing non-existing highlight."):1<c?(a.highlightCounts[b]=c-1,a.highlightCounts[a.count]=d-1):(a.highlightCounts[b]=0,a.highlightsDirty(),this._notifyDirty(),1===d?a.highlightCounts=null:a.highlightCounts[a.count]=d-1)}};a.prototype.clearHighlights=function(a){a=a.components;k.isSome(a.highlightCounts)&&(a.highlightCounts=null,a.highlightsDirty(),this._notifyDirty())};a.prototype.getObjectGPUMemoryUsage=function(a){return a.renderable.meta.gpuMemoryEstimate};Object.defineProperty(a.prototype,
"visibleObjects",{get:function(){return this._objects.getBucket(ga)},enumerable:!1,configurable:!0});a.prototype._createRenderable=function(a,d){for(var e=this._renderManager.rctx,f=a.geometry,g=f.vertices.layoutParameters,l=M.createVertex(e,35044,f.vertices.data),p=k.applySome(f.indices,function(a){return M.createIndex(e,35044,a)}),r=q.glLayout(x.createVertexBufferLayout(g)),n=new Uint16Array(f.vertices.count),t=0;t<d.count;t++){var u=d.offsets[t],v=d.offsets[t+1],w=d.materialDataIndices[t];if(k.isSome(f.indices))for(;u<
v;u++)n[f.indices[u]]=w;else for(;u<v;u++)n[u]=w}d=M.createVertex(e,35044,n.buffer);t=new G.TwoVectorPosition(a.transform.position);v=h.mat3f32.clone(a.transform.rotationScale);c.mat3.invert(v,v);c.mat3.transpose(v,v);n=new C.ComponentDrawParameters;m.vec3.copy(n.worldFromModel_TL,t.low);m.vec3.copy(n.worldFromModel_TH,t.high);c.mat3.copy(n.worldFromModel_RS,a.transform.rotationScale);c.mat3.copy(n.transformNormal_GlobalFromModel,v);b.vec4.copy(n.toMapSpace,a.toMapSpace);a=new A.ComponentMaterial;
r=new Q(e,a.attributeLocations,{data:r,componentIndices:Z},{data:l,componentIndices:d},k.unwrap(p));t=new U;t.material=a;t.drawParameters=n;t.geometry=new P(r,f.primitiveType,g,k.isSome(p));t.meta.cameraDepthSquared=.5;t.meta.gpuMemoryEstimate=l.byteSize+d.byteSize+(k.isSome(p)?p.byteSize:0);return t};a.prototype._notifyDirty=function(){this._renderManager.notifyDirty()};return a}();a.ComponentObjectCollection=n;var N=function(a){function b(b,c){var d=a.call(this)||this;d.pickability=null;d.highlightCounts=
null;d.cachedGeometryRanges=null;d.cachedHighlightRanges=null;d.offsets=e.slice(c);c=d.count;d.visibility=new B.ComponentRangeRunLengthEncoded(c);d.materialDataBuffer=b.getBuffer(c);d.materialDataIndices=new Uint16Array(c);for(b=0;b<c;b++)d.materialDataIndices[b]=d.materialDataBuffer.acquireIndex();return d}d.__extends(b,a);b.prototype.dispose=function(){a.prototype.dispose.call(this);for(var b=0;b<this.count;b++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[b])};Object.defineProperty(b.prototype,
"count",{get:function(){return this.offsets.length-1},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"geometryRanges",{get:function(){k.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"highlightRanges",{get:function(){if(k.isNone(this.highlightCounts))return null;k.isNone(this.cachedHighlightRanges)&&(this.cachedHighlightRanges=
R(this.highlightCounts,this.visibility,this.offsets));return this.cachedHighlightRanges},enumerable:!1,configurable:!0});b.prototype.highlightsDirty=function(){this.cachedHighlightRanges=null};b.prototype.visibilityDirty=function(){this.cachedHighlightRanges=this.cachedGeometryRanges=null};return b}(F.AutoDisposable),S=function(){function a(a,b){this._indices=k.isSome(a.indices)?a.indices:J.generateDefaultIndexArray(a.positions.length/3);this._positions=new r.BufferViewVec3f(a.positions);this._components=
b}a.prototype.getComponentAabb=function(a,b){if(k.isSome(this._perComponentAabbs)){for(var c=0;6>c;c++)b[c]=this._perComponentAabbs[6*a+c];return b}this._computePerComponentAabbs();return this.getComponentAabb(a,b)};a.prototype.getComponentPositions=function(a,b){b.indices=this._indices;b.data=this._positions.typedBuffer;b.stride=this._positions.typedBufferStride;b.startIndex=this._components.offsets[a];b.endIndex=this._components.offsets[a+1]};a.prototype.intersect=function(a,b,c,d,e,f){var g=this,
h={data:this._positions.typedBuffer,strideIdx:this._positions.typedBufferStride,offsetIdx:0,size:3},l=this._indices,p=this._components.offsets,r=L.computeInvDir(a,b,Y);this._components.visibility.forEachComponent(function(q){if(!H.getVisibility(g._components.pickability,q))return!0;var n=g.getComponentAabb(q,ba);k.isSome(e)&&e.applyToAabb(n);if(!L.intersectAabbInvDir(n,a,r,c))return!0;L.intersectTriangles(a,b,p[q]/3,p[q+1]/3,l,h,void 0,e,function(a,b,c){return f(q,a,m.vec3.transformMat3(b,b,d),c)});
return!0})};a.prototype._computePerComponentAabbs=function(){var a=this._components.count;this._perComponentAabbs=new Float32Array(6*a);for(var b=0;b<a;b++)this._computeAABB(b)};a.prototype._computeAABB=function(a){for(var b=this._indices,c=this._positions,d=this._components.offsets,e=d[a+1],f=[0,0,0],g=[Infinity,Infinity,Infinity],h=[-Infinity,-Infinity,-Infinity],d=d[a];d<e;d++)c.getVec(b[d],f),m.vec3.min(g,g,f),m.vec3.max(h,h,f);a*=6;this._perComponentAabbs[a++]=g[0];this._perComponentAabbs[a++]=
g[1];this._perComponentAabbs[a++]=g[2];this._perComponentAabbs[a++]=h[0];this._perComponentAabbs[a++]=h[1];this._perComponentAabbs[a]=h[2]};Object.defineProperty(a.prototype,"positions",{get:function(){return this._positions},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0});return a}(),P=function(a){function b(b,c,d,e){var f=a.call(this)||this;f.vao=b;f.primitiveType=c;f.parameters=d;f.indexed=e;return f}
d.__extends(b,a);d.__decorate([F.autoDispose()],b.prototype,"vao",void 0);return b}(F.AutoDisposable);a.RenderGeometry=P;var U=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.meta={cameraDepthSquared:0,gpuMemoryEstimate:0};return b}d.__extends(b,a);d.__decorate([F.autoDispose()],b.prototype,"geometry",void 0);return b}(F.AutoDisposable);a.Renderable=U;var Z=q.glLayout(v.newLayout().u16("componentIndex")),V=function(a){function b(){return null!==a&&a.apply(this,arguments)||
this}d.__extends(b,a);Object.defineProperty(b.prototype,"visible",{get:function(){return!!(this.bucketKey&ga)},enumerable:!1,configurable:!0});d.__decorate([F.autoDispose()],b.prototype,"renderable",void 0);d.__decorate([F.autoDispose()],b.prototype,"components",void 0);return b}(E.BucketStorable);a.ComponentObject=V;var T=h.mat3f32.create(),Y=f.vec3f64.create(),X=f.vec3f64.create(),ca=f.vec3f64.create(),ba=p.create(),ga=1})},"esri/views/3d/support/orientedBoundingBox":function(){define("require exports ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/quatf64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ./dito ./geometryUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){function r(a,b,c){void 0===a&&(a=[0,0,0]);void 0===b&&(b=[-1,-1,-1]);void 0===c&&(c=[0,0,0,1]);return{center:f.vec3f64.clone(a),halfSize:m.vec3f32.clone(b),quaternion:e.quatf32.clone(c)}}function q(a,b){var c=u.plane.signedDistance(b,a.center);a=v(a,u.plane.normal(b));return c>a?1:c<-a?-1:0}function v(a,b){k.quat.conjugate(w,a.quaternion);h.vec3.transformQuat(z,b,w);a=a.halfSize;return Math.abs(z[0]*a[0])+Math.abs(z[1]*a[1])+Math.abs(z[2]*a[2])}Object.defineProperty(a,
"__esModule",{value:!0});a.corners=a.projectedRadius=a.projectedArea=a.intersectLine=a.isVisible=a.maximumDistancePlane=a.minimumDistancePlane=a.toAaBoundingBox=a.intersectPlane=a.compute=a.set=a.clone=a.create=a.ObbArray=void 0;var w=c.quatf64.create(),z=f.vec3f64.create(),x=f.vec3f64.create(),B=g.vec4f64.create(),A=l.mat3f64.create();n=function(){return function(a){this.buffer=new ArrayBuffer(56*a);this.obbs=Array(a);for(var b=0;b<a;b++)this.obbs[b]={center:f.vec3f64.createView(this.buffer,56*b+
0),halfSize:m.vec3f32.createView(this.buffer,56*b+24),quaternion:e.quatf32.createView(this.buffer,56*b+36)}}}();a.ObbArray=n;a.create=r;a.clone=function(a){return r(a.center,a.halfSize,a.quaternion)};a.set=function(a,b){h.vec3.copy(b.center,a.center);h.vec3.copy(b.halfSize,a.halfSize);k.quat.copy(b.quaternion,a.quaternion)};a.compute=function(a,b){b=b||r();t.computeOBB(a,b);return b};a.intersectPlane=q;a.toAaBoundingBox=function(a,b){b||(b=p.create());var c=d.mat3.fromQuat(A,a.quaternion),e=a.halfSize[0]*
Math.abs(c[0])+a.halfSize[1]*Math.abs(c[3])+a.halfSize[2]*Math.abs(c[6]),f=a.halfSize[0]*Math.abs(c[1])+a.halfSize[1]*Math.abs(c[4])+a.halfSize[2]*Math.abs(c[7]),c=a.halfSize[0]*Math.abs(c[2])+a.halfSize[1]*Math.abs(c[5])+a.halfSize[2]*Math.abs(c[8]);b[0]=a.center[0]-e;b[1]=a.center[1]-f;b[2]=a.center[2]-c;b[3]=a.center[0]+e;b[4]=a.center[1]+f;b[5]=a.center[2]+c;return b};a.minimumDistancePlane=function(a,b){var c=u.plane.signedDistance(b,a.center);a=v(a,u.plane.normal(b));return c-a};a.maximumDistancePlane=
function(a,b){var c=u.plane.signedDistance(b,a.center);a=v(a,u.plane.normal(b));return c+a};a.isVisible=function(a,b){return 0>=q(a,b.planes[0])&&0>=q(a,b.planes[1])&&0>=q(a,b.planes[2])&&0>=q(a,b.planes[3])&&0>=q(a,b.planes[4])&&0>=q(a,b.planes[5])};a.intersectLine=function(a,b,c,d){void 0===d&&(d=0);k.quat.conjugate(w,a.quaternion);h.vec3.subtract(z,b,a.center);b=h.vec3.transformQuat(z,z,w);c=h.vec3.transformQuat(x,c,w);for(var e=-Infinity,f=Infinity,g=0;3>g;g++)if(1E-6<Math.abs(c[g]))var m=(d+
a.halfSize[g]-b[g])/c[g],l=(-d-a.halfSize[g]-b[g])/c[g],e=Math.max(e,Math.min(m,l)),f=Math.min(f,Math.max(m,l));else if(b[g]>a.halfSize[g]+d||b[g]<-a.halfSize[g]-d)return!1;return e<=f};a.projectedArea=function(a,c,e,f,g){k.quat.conjugate(w,a.quaternion);h.vec3.sub(z,c,a.center);h.vec3.transformQuat(z,z,w);var m=z[0]<-a.halfSize[0]?-1:z[0]>a.halfSize[0]?1:0,l=z[1]<-a.halfSize[1]?-1:z[1]>a.halfSize[1]?1:0,p=z[2]<-a.halfSize[2]?-1:z[2]>a.halfSize[2]?1:0;c=Math.abs(m)+Math.abs(l)+Math.abs(p);if(0===
c)return Infinity;c=1===c?4:6;l=6*(m+3*l+9*p+13);d.mat3.fromQuat(A,a.quaternion);d.mat3.scale(A,A,a.halfSize);for(m=0;m<c;m++)p=E[l+m],h.vec3.set(z,((p&1)<<1)-1,(p&2)-1,((p&4)>>1)-1),h.vec3.transformMat3(z,z,A),h.vec3.add(B,a.center,z),B[3]=1,b.vec4.transformMat4(B,B,e),p=1/Math.max(1E-6,B[3]),C[2*m]=B[0]*p,C[2*m+1]=B[1]*p;a=2*c-2;e=C[0]*(C[3]-C[a+1])+C[a]*(C[1]-C[a-1]);for(m=2;m<a;m+=2)e+=C[m]*(C[m+3]-C[m-1]);return Math.abs(e)*f*g*.125};var C=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],E=function(){var a=
new Int8Array(162),b=0,c=function(c){for(var d=0;d<c.length;d++)a[b+d]=c[d];b+=6};c([6,2,3,1,5,4]);c([0,2,3,1,5,4]);c([0,2,3,7,5,4]);c([0,1,3,2,6,4]);c([0,1,3,2,0,0]);c([0,1,5,7,3,2]);c([0,1,3,7,6,4]);c([0,1,3,7,6,2]);c([0,1,5,7,6,2]);c([0,1,5,4,6,2]);c([0,1,5,4,0,0]);c([0,1,3,7,5,4]);c([0,2,6,4,0,0]);c([0,0,0,0,0,0]);c([1,3,7,5,0,0]);c([2,3,7,6,4,0]);c([2,3,7,6,0,0]);c([2,3,1,5,7,6]);c([0,1,5,7,6,2]);c([0,1,5,7,6,4]);c([0,1,3,7,6,4]);c([4,5,7,6,2,0]);c([4,5,7,6,0,0]);c([4,5,1,3,7,6]);c([0,2,3,7,
5,4]);c([6,2,3,7,5,4]);c([6,2,3,1,5,4]);return a}();a.projectedRadius=v;a.corners=function(a,b){for(var c=0;8>c;++c){var d=b[c];d[0]=c&1?-a.halfSize[0]:a.halfSize[0];d[1]=c&2?-a.halfSize[1]:a.halfSize[1];d[2]=c&4?-a.halfSize[2]:a.halfSize[2];h.vec3.transformQuat(d,d,a.quaternion);h.vec3.add(d,d,a.center)}}})},"esri/core/libs/gl-matrix-2/quatf32":function(){define(["require","exports","./factories/quatf32"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.quatf32=void 0;a.quatf32=
d})},"esri/core/libs/gl-matrix-2/factories/quatf32":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.createView=a.fromValues=a.clone=a.create=void 0;a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.clone=function(a){var d=new Float32Array(4);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];return d};a.fromValues=function(a,l,k,e){var c=new Float32Array(4);c[0]=a;c[1]=l;c[2]=k;c[3]=e;return c};a.createView=function(a,l){return new Float32Array(a,
l,4)}})},"esri/views/3d/support/dito":function(){define(["require","exports"],function(n,a){function d(a,b,c,d,e,f){if(!(1E-6>b[0]*b[0]+b[1]*b[1]+b[2]*b[2]))for(p(H,c,b),p(J,d,b),p(I,e,b),l(a,b,F),L[1]=F[0],K[1]=F[1],M[1]=K[1]-L[1],c=[c,d,e],d=[H,J,I],e=0;3>e;++e){l(a,c[e],F);L[0]=F[0];K[0]=F[1];l(a,d[e],F);L[2]=F[0];K[2]=F[1];M[0]=K[0]-L[0];M[2]=K[2]-L[2];var k=h(M);k<f.quality&&(g(f.b0,c[e]),g(f.b1,b),g(f.b2,d[e]),f.quality=k)}}function l(a,b,c){var d=a.data,e=a.offsetIdx;a=a.strideIdx;c[0]=Number.POSITIVE_INFINITY;
for(c[1]=Number.NEGATIVE_INFINITY;e<d.length;e+=a){var f=d[e]*b[0]+d[e+1]*b[1]+d[e+2]*b[2];c[0]=Math.min(c[0],f);c[1]=Math.max(c[1],f)}}function k(a,c,d){g(d.center,a);b(d.halfSize,c,.5);d.quaternion[0]=0;d.quaternion[1]=0;d.quaternion[2]=0;d.quaternion[3]=1}function e(a,b,c,d,e,f){l(a,b,F);e[0]=F[0];f[0]=F[1];l(a,c,F);e[1]=F[0];f[1]=F[1];l(a,d,F);e[2]=F[0];f[2]=F[1]}function c(a,c,d,e,f,g,h){V[0]=a[0];V[1]=a[1];V[2]=a[2];V[3]=c[0];V[4]=c[1];V[5]=c[2];V[6]=d[0];V[7]=d[1];V[8]=d[2];var k=h.quaternion,
l=V,p=l[0]+l[4]+l[8];if(0<p)p=Math.sqrt(p+1),k[3]=.5*p,p=.5/p,k[0]=(l[5]-l[7])*p,k[1]=(l[6]-l[2])*p,k[2]=(l[1]-l[3])*p;else{var r=0;l[4]>l[0]&&(r=1);l[8]>l[3*r+r]&&(r=2);var q=(r+1)%3,n=(r+2)%3,p=Math.sqrt(l[3*r+r]-l[3*q+q]-l[3*n+n]+1);k[r]=.5*p;p=.5/p;k[3]=(l[3*q+n]-l[3*n+q])*p;k[q]=(l[3*q+r]+l[3*r+q])*p;k[n]=(l[3*n+r]+l[3*r+n])*p}m(T,e,f);b(T,T,.5);b(h.center,a,T[0]);b(Z,c,T[1]);m(h.center,h.center,Z);b(Z,d,T[2]);m(h.center,h.center,Z);b(h.halfSize,g,.5)}function h(a){return a[0]*a[1]+a[0]*a[2]+
a[1]*a[2]}function m(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2]}function f(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2]}function b(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c}function g(a,b,c){void 0===c&&(c=0);a[0]=b[c+0];a[1]=b[c+1];a[2]=b[c+2]}function p(a,b,c){var d=b[0],e=b[1];b=b[2];var f=c[0],g=c[1];c=c[2];a[0]=e*c-b*g;a[1]=b*f-d*c;a[2]=d*g-e*f}function t(a,b){var c=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c)}function u(a,b){var c=
b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}Object.defineProperty(a,"__esModule",{value:!0});a.computeOBB=void 0;var r=[0,0,0],q=[0,0,0];a.computeOBB=function(a,l){var n=a.data.length/a.strideIdx;if(!(0>=n)){var I=new Y(a);m(r,I.minProj,I.maxProj);b(r,r,.5);f(q,I.maxProj,I.minProj);var H=h(q),J=new X;J.quality=H;14>n&&(a={data:new Float64Array(I.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var K=[0,0,0],L=[0,0,0],M=[0,0,0],n=[0,0,0],T=[0,0,0],ba=[0,0,0],ca=[0,0,0],V;V=a;for(var Z=u(I.maxVert[0],
I.minVert[0]),ua=0,oa=1;7>oa;++oa){var ta=u(I.maxVert[oa],I.minVert[oa]);ta>Z&&(Z=ta,ua=oa)}g(K,I.minVert[ua]);g(L,I.maxVert[ua]);if(1E-6>u(K,L))V=1;else{f(n,K,L);t(n,n);I=V.data;Z=V.strideIdx;ua=Number.NEGATIVE_INFINITY;oa=0;for(ta=V.offsetIdx;ta<I.length;ta+=Z){G[0]=I[ta]-K[0];G[1]=I[ta+1]-K[1];G[2]=I[ta+2]-K[2];var ma=n[0]*G[0]+n[1]*G[1]+n[2]*G[2],ma=G[0]*G[0]+G[1]*G[1]+G[2]*G[2]-ma*ma/(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);ma>ua&&(ua=ma,oa=ta)}g(M,I,oa);1E-6>ua?V=2:(f(T,L,M),t(T,T),f(ba,M,K),t(ba,ba),
p(ca,T,n),t(ca,ca),d(V,ca,n,T,ba,J),V=0)}switch(V){case 1:k(r,q,l);return;case 2:H=a;g(R,n);Math.abs(n[0])>Math.abs(n[1])&&Math.abs(n[0])>Math.abs(n[2])?R[0]=0:Math.abs(n[1])>Math.abs(n[2])?R[1]=0:R[2]=0;1E-6>R[0]*R[0]+R[1]*R[1]+R[2]*R[2]&&(R[0]=R[1]=R[2]=1);p(O,n,R);t(O,O);p(N,n,O);t(N,N);e(H,n,O,N,S,P);f(U,P,S);c(n,O,N,S,P,U,l);return}V=a;I=v;Z=w;ua=F;oa=V.data;ma=V.offsetIdx;ta=V.strideIdx;g(Z,oa,ma);g(I,Z);ua[0]=Q[0]*ca[0]+Q[1]*ca[1]+Q[2]*ca[2];ua[1]=ua[0];for(ma+=ta;ma<oa.length;ma+=ta){var qa=
oa[ma]*ca[0]+oa[ma+1]*ca[1]+oa[ma+2]*ca[2];qa<ua[0]&&(ua[0]=qa,g(Z,oa,ma));qa>ua[1]&&(ua[1]=qa,g(I,oa,ma))}ca=K[0]*ca[0]+K[1]*ca[1]+K[2]*ca[2];F[1]-1E-6<=ca&&(I[0]=void 0);F[0]+1E-6>=ca&&(Z[0]=void 0);void 0!==v[0]&&(f(z,v,K),t(z,z),f(x,v,L),t(x,x),f(B,v,M),t(B,B),p(A,x,n),t(A,A),p(C,B,T),t(C,C),p(E,z,ba),t(E,E),d(V,A,n,x,z,J),d(V,C,T,B,x,J),d(V,E,ba,z,B,J));void 0!==w[0]&&(f(z,w,K),t(z,z),f(x,w,L),t(x,x),f(B,w,M),t(B,B),p(A,x,n),t(A,A),p(C,B,T),t(C,C),p(E,z,ba),t(E,E),d(V,A,n,x,z,J),d(V,C,T,B,x,
J),d(V,E,ba,z,B,J));e(a,J.b0,J.b1,J.b2,S,P);a=[0,0,0];f(a,P,S);J.quality=h(a);J.quality<H?c(J.b0,J.b1,J.b2,S,P,a,l):k(r,q,l)}};var v=[0,0,0],w=[0,0,0],z=[0,0,0],x=[0,0,0],B=[0,0,0],A=[0,0,0],C=[0,0,0],E=[0,0,0],G=[0,0,0],F=[0,0],H=[0,0,0],J=[0,0,0],I=[0,0,0],K=[0,0,0],L=[0,0,0],M=[0,0,0],Q=[0,0,0],R=[0,0,0],O=[0,0,0],N=[0,0,0],S=[0,0,0],P=[0,0,0],U=[0,0,0],Z=[0,0,0],V=[1,0,0,0,1,0,0,0,1],T=[0,0,0],Y=function(){return function(a){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);
var b=0;this.minProj=new Float64Array(this.buffer,b,7);b+=56;this.maxProj=new Float64Array(this.buffer,b,7);for(var b=b+56,c=0;7>c;++c)this.minVert[c]=new Float64Array(this.buffer,b,3),b+=24;for(c=0;7>c;++c)this.maxVert[c]=new Float64Array(this.buffer,b,3),b+=24;for(c=0;7>c;++c)this.minProj[c]=Number.POSITIVE_INFINITY,this.maxProj[c]=Number.NEGATIVE_INFINITY;for(var b=Array(7),d=Array(7),e=a.data,f=a.strideIdx,c=a.offsetIdx;c<e.length;c+=f)a=e[c],a<this.minProj[0]&&(this.minProj[0]=a,b[0]=c),a>this.maxProj[0]&&
(this.maxProj[0]=a,d[0]=c),a=e[c+1],a<this.minProj[1]&&(this.minProj[1]=a,b[1]=c),a>this.maxProj[1]&&(this.maxProj[1]=a,d[1]=c),a=e[c+2],a<this.minProj[2]&&(this.minProj[2]=a,b[2]=c),a>this.maxProj[2]&&(this.maxProj[2]=a,d[2]=c),a=e[c]+e[c+1]+e[c+2],a<this.minProj[3]&&(this.minProj[3]=a,b[3]=c),a>this.maxProj[3]&&(this.maxProj[3]=a,d[3]=c),a=e[c]+e[c+1]-e[c+2],a<this.minProj[4]&&(this.minProj[4]=a,b[4]=c),a>this.maxProj[4]&&(this.maxProj[4]=a,d[4]=c),a=e[c]-e[c+1]+e[c+2],a<this.minProj[5]&&(this.minProj[5]=
a,b[5]=c),a>this.maxProj[5]&&(this.maxProj[5]=a,d[5]=c),a=e[c]-e[c+1]-e[c+2],a<this.minProj[6]&&(this.minProj[6]=a,b[6]=c),a>this.maxProj[6]&&(this.maxProj[6]=a,d[6]=c);for(c=0;7>c;++c)a=b[c],g(this.minVert[c],e,a),a=d[c],g(this.maxVert[c],e,a)}}(),X=function(){return function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0}}()})},"esri/views/3d/webgl-engine/collections/Component/interface":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",
{value:!0});a.isVaryingComponentParameters=void 0;a.isVaryingComponentParameters=function(a){return"function"===typeof a}})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["require","exports","./DepthRange"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.RenderSubmitSystem=void 0;n=function(){function a(a){this._objects=a}a.prototype.submit=function(a,d){this._objects.preSubmit(d);d=this._objects.visibleObjects;for(var c=0;c<d.length;c++){var e=
d[c];e.renderable.material.submit(a,e)}};a.prototype.queryShadowCasterDepthRange=function(a){return this._objects.visibleObjects.length?d.computeDepthRange(a,this._objects.visibleObjects):null};return a}();a.RenderSubmitSystem=n})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("require exports ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/quat ../../../../../core/libs/gl-matrix-2/quatf64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/orientedBoundingBox ../../../support/geometryUtils/plane ../../lib/depthRange".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){function p(a,b,c){return h.vec3.set(a,b.data[c+0],b.data[c+1],b.data[c+2])}function t(a,b){a.push(b[0]);a.push(b[1]);a.push(b[2])}function u(a,b,c,d){e.quat.conjugate(G,a.quaternion);h.vec3.sub(F,b,a.center);h.vec3.transformQuat(F,F,G);var f=8*((F[0]<-a.halfSize[0]?-1:F[0]>a.halfSize[0]?1:0)+3*(F[1]<-a.halfSize[1]?-1:F[1]>a.halfSize[1]?1:0)+9*(F[2]<-a.halfSize[2]?-1:F[2]>a.halfSize[2]?1:0)+13);b=A[f];if(0===b)return b;l.mat3.fromQuat(E,a.quaternion);l.mat3.scale(E,
E,a.halfSize);var g=function(b,c){c=A[f+c+1];h.vec3.set(b,((c&1)<<1)-1,(c&2)-1,((c&4)>>1)-1);h.vec3.transformMat3(b,b,E);return h.vec3.add(b,a.center,b)};c.length=0;t(c,g(H,0));t(c,g(J,1));t(c,g(F,2));t(c,g(I,3));d(c);if(1===b)return b;c.length=0;t(c,H);t(c,I);t(c,g(F,4));t(c,g(K,5));d(c);if(2===b)return b;c.length=0;t(c,H);t(c,K);t(c,g(F,6));t(c,J);d(c);return b}function r(a,b){for(var c=0,d=0;d<C;d++){var e=f.intersectPlane(a,b[d]);if(0<e)return-1;0===e&&(c|=1<<d)}return c}Object.defineProperty(a,
"__esModule",{value:!0});a.computeDepthRange=void 0;a.computeDepthRange=function(a,c){var d=g.empty(),e=a.eye,k=a.viewForward,m=a.frustum.planes;for(a=0;a<c.length;a++){var l=c[a].obb,n=h.vec3.dot(h.vec3.sub(F,l.center,e),k),A=f.projectedRadius(l,k);if(!g.within(d,n-A)||!g.within(d,n+A))if(l=r(l,m),-1!==l)if(0===l)v.far=n+A,v.near=n-A,g.union(d,v);else{var I=q.pushNew();I.near=n-A;I.far=n+A;I.mask=l;I.object=c[a]}}c=function(a){var c=q.data[a];if(g.within(d,c.near)&&g.within(d,c.far))return"continue";
v.far=c.far;v.near=Infinity;0===u(c.object.obb,e,x,function(a){for(var d=B,f=0;f<C&&0<a.length;f++)if(0!==(c.mask&1<<f)){var g=m[f],l=a,n=d;n.length=0;var r=l.length-3;p(w,l,r);var q=b.signedDistance(g,w);0>=q&&(n.push(w[0]),n.push(w[1]),n.push(w[2]));var u=0,x=q;for(u;u<r;u+=3){p(z,l,u);var A=b.signedDistance(g,z);0>x*A&&(h.vec3.lerp(w,z,w,A/(A-x)),t(n,w));0>=A&&t(n,z);x=A;h.vec3.copy(w,z)}0>x*q&&(p(z,l,r),h.vec3.lerp(w,z,w,q/(q-x)),t(n,w));g=a;a=d;d=g}for(d=0;d<a.length;d+=3)h.vec3.set(w,a.data[d+
0],a.data[d+1],a.data[d+2]),f=h.vec3.dot(h.vec3.sub(w,w,e),k),v.near=Math.min(v.near,f)})&&(v.near=0);g.union(d,v)};for(a=0;a<q.length;a++)c(a);q.length=0;return d};var q=new d({allocator:function(a){return a||{near:Infinity,far:-Infinity,mask:0,object:null}},deallocator:function(a){a.object=null;return a}}),v=g.empty(),w=m.vec3f64.create(),z=m.vec3f64.create(),x=new d({deallocator:null}),B=new d({deallocator:null}),A=function(){var a=new Int8Array(216),b=0,c=function(c){for(var d=0;d<c.length;d++)a[b+
d]=c[d];b+=8};c([3,0,6,2,3,1,5,4]);c([2,0,2,3,1,5,4,0]);c([3,1,0,2,3,7,5,4]);c([2,0,1,3,2,6,4,0]);c([1,0,1,3,2,0,0,0]);c([2,1,5,7,3,2,0,0]);c([3,2,0,1,3,7,6,4]);c([2,2,0,1,3,7,6,0]);c([3,3,0,1,5,7,6,2]);c([2,0,1,5,4,6,2,0]);c([1,0,1,5,4,0,0,0]);c([2,1,3,7,5,4,0,0]);c([1,0,2,6,4,0,0,0]);c([0,0,0,0,0,0,0,0]);c([1,1,3,7,5,0,0,0]);c([2,2,3,7,6,4,0,0]);c([1,2,3,7,6,0,0,0]);c([2,3,1,5,7,6,2,0]);c([3,4,0,1,5,7,6,2]);c([2,5,7,6,4,0,1,0]);c([3,5,0,1,3,7,6,4]);c([2,4,5,7,6,2,0,0]);c([1,4,5,7,6,0,0,0]);c([2,
5,1,3,7,6,4,0]);c([3,6,0,2,3,7,5,4]);c([2,6,2,3,7,5,4,0]);c([3,7,6,2,3,1,5,4]);return a}(),C=4,E=k.mat3f64.create(),G=c.quatf64.create(),F=m.vec3f64.create(),H=m.vec3f64.create(),J=m.vec3f64.create(),I=m.vec3f64.create(),K=m.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["require","exports"],function(n,a){function d(a,d){return{near:a,far:d}}function l(a,d,c){a.near=d;a.far=c;return a}Object.defineProperty(a,"__esModule",{value:!0});a.within=a.union=a.set=a.empty=
a.create=void 0;a.create=d;a.empty=function(a){return a?l(a,Infinity,-Infinity):d(Infinity,-Infinity)};a.set=l;a.union=function(a,d,c){void 0===c&&(c=a);c.near=Math.min(a.near,d.near);c.far=Math.max(a.far,d.far);return c};a.within=function(a,d){return a.near<=d&&d<=a.far}})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["require","exports","../../../support/buffer/InterleavedLayout"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.createVertexBufferLayout=
void 0;a.createVertexBufferLayout=function(a){var k=d.newLayout().vec3f("position");a.normals&&k.vec2i16("normalCompressed",{glNormalized:!0});1===a.textureCoordinates?k.vec2f("uv0"):2===a.textureCoordinates&&(k.vec2f("uv0"),k.vec4u16("uvRegion",{glNormalized:!0}));a.colors&&k.vec4u8("color",{glNormalized:!0});return k.alignTo(4)}})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,
"__esModule",{value:!0});a.ComponentRangeRunLengthEncoded=void 0;n=function(){function a(a){this._totalCount=a;this._indexRanges=[0,a]}a.prototype.componentCount=function(){for(var a=this._indexRanges,d=0,e=0;e<a.length;e+=2)d+=a[e+1];return d};a.prototype.reset=function(a){if("all"===a||a.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{var d=[];if(0!==a.length){for(var e=a[0],c=1,h=1;h<a.length;h++){var m=a[h];e+c===m?c+=1:(d.push(e),d.push(c),e=m,c=1)}d.push(e);d.push(c)}this._indexRanges=
d}};a.prototype.forEachComponent=function(a){for(var d=this._indexRanges,e=0;e<d.length;e+=2)for(var c=d[e],h=c+d[e+1];c<h;c++)if(!a(c))return!1;return!0};a.prototype.forEachComponentRange=function(a){for(var d=this._indexRanges,e=0;e<d.length;e+=2){var c=d[e];if(!a(c,c+d[e+1]))return!1}return!0};a.prototype.computeOffsetRanges=function(a){for(var d=Array(this._indexRanges.length),e=this._indexRanges,c=0;c<e.length;c+=2){var h=e[c],m=a[h],h=a[h+e[c+1]];d[c]=m;d[c+1]=h-m}return d};return a}();a.ComponentRangeRunLengthEncoded=
n})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("require exports tslib ../../../../../../core/maybe ../../../../../../core/libs/gl-matrix-2/vec3 ../../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../../core/libs/gl-matrix-2/vec4 ../../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../../../core/libs/gl-matrix-2/vec4f64 ./ComponentTechnique ./shader/ComponentShader.glsl ../../../core/material/MaterialBase ../../../core/shaderLibrary/util/AlphaDiscard.glsl".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p){function t(a){switch(a){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 7}}Object.defineProperty(a,"__esModule",{value:!0});a.ComponentParametersVarying=a.ComponentParametersUniform=a.CommonMaterialParameters=a.ComponentMaterial=void 0;n=function(a){function n(){var b=a.call(this)||this;b.baseColor=h.vec4f32.fromValues(1,1,1,1);b.usePBR=!1;b.mrrFactors=e.vec3f32.fromValues(1,1,.5);b.emissiveFactor=e.vec3f32.fromValues(0,0,0);b.baseColorTexture=null;
b.metallicRoughnessTexture=null;b.emissionTexture=null;b.occlusionTexture=null;b.normalTexture=null;b.overlayTexOffset=m.vec4f64.fromValues(-1,-1,-1,-1);b.overlayTexScale=m.vec4f64.fromValues(0,0,0,0);b.overlayColorInner=null;b.overlayColorOuter=null;b.overlayHighlightInner=null;b.overlayHighlightOuter=null;b.overlayNormalInner=null;b.overlayNormalOuter=null;b.objectOpacity=1;b.commonMaterialParameters=new u;b.componentParameters=new r;b.alphaCutoff=p.defaultMaskAlphaCutoff;b.alphaDiscardMode=1;b.isIntegratedMesh=
!1;b.polygonOffsetEnabled=!1;b.sceneHasOcludees=!1;b._techniqueConfig=new f.ComponentTechniqueConfiguration;return b}d.__extends(n,a);n.prototype.dispose=function(a){this._technique&&(a.release(this._technique),this._technique=void 0);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};n.prototype.getTechnique=function(a,b,c){var d=this._techniqueConfig;d.hasVertexColors=c.colors;d.hasNormals=c.normals;d.vertexTextureCoordinates=
c.textureCoordinates;d.usePBR=this.usePBR;d.hasMetalnessAndRoughnessTexture=l.isSome(this.metallicRoughnessTexture);d.hasEmissionTexture=l.isSome(this.emissionTexture);d.hasOcclusionTexture=l.isSome(this.occlusionTexture);d.hasNormalTexture=l.isSome(this.normalTexture);d.transparencyPassType=0===b.identifier&&null!=b.transparencyPassType?b.transparencyPassType:3;this.dirty&&(d.componentData=this.componentParameters.type,d.cullFace=this.commonMaterialParameters.cullFace,d.doubleSidedMode=this.commonMaterialParameters.doubleSided?
1:0,d.baseColorTexture=l.isSome(this.baseColorTexture),c=this._computeWhichMaterialPass(),d.blendingEnabled=1===c||2===c,d.alphaDiscardMode=this.alphaDiscardMode,d.integratedMeshMode=this.isIntegratedMesh?this.overlayColorInner||this.overlayColorOuter?this.overlayNormalInner||this.overlayNormalOuter?3:2:1:0,d.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean());d.slicePlaneEnabled=b.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled;1===b.identifier?(d.output=3,d.vertexDiscardMode=
0):2===b.identifier?(d.output=4,d.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?d.vertexDiscardMode=b.transparent?2:1:d.vertexDiscardMode=0,d.output=t(b.subPass),0===b.subPass?(d.receiveAmbientOcclusion=b.ambientOcclusionEnabled,d.sceneHasOcludees=b.sceneHasOcludees,d.receiveShadows=b.shadowsEnabled,d.ssrEnabled=b.ssrParams.ssrEnabled):(d.receiveAmbientOcclusion=!1,d.receiveShadows=!1));return this._technique=a.repository.acquireAndReleaseExisting(f.ComponentTechnique,d,this._technique)};
n.prototype.submit=function(a,b){var c=b.renderable.geometry,d=b.components,e=b.renderable.drawParameters;b=b.renderable.meta.cameraDepthSquared;var f=d.geometryRanges,d=d.highlightRanges;switch(this._computeWhichMaterialPass()){case 0:a.materialOpaque.submitDraw(this,c,f,e,b);break;case 1:a.materialTransparent.submitDraw(this,c,f,e,b);break;case 2:a.materialOpaque.submitDraw(this,c,f,e,b);a.materialTransparent.submitDraw(this,c,f,e,b);break;case 3:a.materialIntegratedMesh.submitDraw(this,c,f,e,b),
(this.overlayHighlightInner||this.overlayHighlightOuter)&&a.highlightIntegratedMesh.submitDraw(this,c,f,e,b)}l.isSome(a.shadowMap)&&2!==this.componentParameters.castShadows&&a.shadowMap.submitDraw(this,c,f,e,b);l.isSome(a.highlight)&&l.isSome(d)&&a.highlight.submitDraw(this,c,d,e,b)};Object.defineProperty(n.prototype,"attributeLocations",{get:function(){return b.attributeLocations},enumerable:!1,configurable:!0});n.prototype._computeWhichMaterialPass=function(){return this.isIntegratedMesh?3:1>this.objectOpacity?
1:0===this.componentParameters.opaqueOverride?0:1>this.baseColor[3]||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2};d.__decorate([g.parameter({vectorOps:c.vec4})],n.prototype,"baseColor",void 0);d.__decorate([g.parameter()],n.prototype,"usePBR",void 0);d.__decorate([g.parameter({vectorOps:k.vec3})],n.prototype,"mrrFactors",void 0);d.__decorate([g.parameter({vectorOps:k.vec3})],n.prototype,"emissiveFactor",
void 0);d.__decorate([g.parameter({dispose:!0})],n.prototype,"baseColorTexture",void 0);d.__decorate([g.parameter({dispose:!0})],n.prototype,"metallicRoughnessTexture",void 0);d.__decorate([g.parameter({dispose:!0})],n.prototype,"emissionTexture",void 0);d.__decorate([g.parameter({dispose:!0})],n.prototype,"occlusionTexture",void 0);d.__decorate([g.parameter({dispose:!0})],n.prototype,"normalTexture",void 0);d.__decorate([g.parameter({vectorOps:{equals:c.vec4.exactEquals,copy:c.vec4.copy}})],n.prototype,
"overlayTexOffset",void 0);d.__decorate([g.parameter({vectorOps:{equals:c.vec4.exactEquals,copy:c.vec4.copy}})],n.prototype,"overlayTexScale",void 0);d.__decorate([g.parameter()],n.prototype,"overlayColorInner",void 0);d.__decorate([g.parameter()],n.prototype,"overlayColorOuter",void 0);d.__decorate([g.parameter()],n.prototype,"overlayHighlightInner",void 0);d.__decorate([g.parameter()],n.prototype,"overlayHighlightOuter",void 0);d.__decorate([g.parameter()],n.prototype,"overlayNormalInner",void 0);
d.__decorate([g.parameter()],n.prototype,"overlayNormalOuter",void 0);d.__decorate([g.parameter()],n.prototype,"objectOpacity",void 0);d.__decorate([g.parameterBlock()],n.prototype,"commonMaterialParameters",void 0);d.__decorate([g.parameterBlock()],n.prototype,"componentParameters",void 0);d.__decorate([g.parameter()],n.prototype,"alphaCutoff",void 0);d.__decorate([g.parameter()],n.prototype,"alphaDiscardMode",void 0);d.__decorate([g.parameter()],n.prototype,"isIntegratedMesh",void 0);d.__decorate([g.parameter()],
n.prototype,"polygonOffsetEnabled",void 0);d.__decorate([g.parameter()],n.prototype,"sceneHasOcludees",void 0);return n}(g.MaterialBase);a.ComponentMaterial=n;var u=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.doubleSided=!1;b.cullFace=2;b.slicePlaneEnabled=!0;return b}d.__extends(b,a);d.__decorate([g.parameter()],b.prototype,"doubleSided",void 0);d.__decorate([g.parameter()],b.prototype,"cullFace",void 0);d.__decorate([g.parameter()],b.prototype,"slicePlaneEnabled",void 0);
return b}(g.MaterialParameterBlock);a.CommonMaterialParameters=u;var r=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.externalColor=h.vec4f32.fromValues(1,1,1,1);b.externalColorMixMode=1;b.castShadows=0;return b}d.__extends(b,a);Object.defineProperty(b.prototype,"transparent",{get:function(){return 1>this.externalColor[3]?0:2},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"opaqueOverride",{get:function(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?
0:2},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){return 0<this.externalColor[3]?0:2},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"type",{get:function(){return 0},enumerable:!1,configurable:!0});d.__decorate([g.parameter({vectorOps:c.vec4})],b.prototype,"externalColor",void 0);d.__decorate([g.parameter()],b.prototype,"externalColorMixMode",void 0);d.__decorate([g.parameter()],b.prototype,"castShadows",void 0);return b}(g.MaterialParameterBlock);
a.ComponentParametersUniform=r;n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.texture=null;b.transparent=2;b.opaqueOverride=2;b.castShadows=2;return b}d.__extends(b,a);Object.defineProperty(b.prototype,"type",{get:function(){return 1},enumerable:!1,configurable:!0});d.__decorate([g.parameter()],b.prototype,"texture",void 0);d.__decorate([g.parameter()],b.prototype,"transparent",void 0);d.__decorate([g.parameter()],b.prototype,"opaqueOverride",void 0);d.__decorate([g.parameter()],
b.prototype,"castShadows",void 0);return b}(g.MaterialParameterBlock);a.ComponentParametersVarying=n})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports tslib ../../../../../../core/maybe ../../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../../core/libs/gl-matrix-2/vec4f64 ./shader/ComponentShader.glsl ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/StencilUtils ../../../../../webgl/Program ../../../../../webgl/renderState ../../../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z){Object.defineProperty(a,"__esModule",{value:!0});a.ComponentTechniqueConfiguration=a.ComponentDrawParameters=a.ComponentTechnique=a.TextureUnits=void 0;a.TextureUnits={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2,EMISSION:3,OCCLUSION:4,METALLIC_ROUGHNESS:5,OVERLAY0_COLOR:2,OVERLAY1_COLOR:3,OVERLAY0_NORMAL:4,OVERLAY1_NORMAL:5,SSAO:6,SHADOW_MAP:7,PREPASS_LINEAR_DEPTH:8,LAST_FRAME_COLOR:9};u=function(e){function k(){return null!==e&&e.apply(this,arguments)||
this}d.__extends(k,e);k.prototype.bindPass=function(b,c){var d=this.program;m.VertexPosition.bindViewProjTransform(d,c.viewTransform);h.Slice.bindUniforms(this.program,this.configuration,c.slicePlane);0===c.identifier&&void 0!==c.ssrParams&&(c.ssrParams.lastFrameColorTextureID=a.TextureUnits.LAST_FRAME_COLOR,c.ssrParams.linearDepthTextureID=a.TextureUnits.PREPASS_LINEAR_DEPTH,g.ScreenSpaceReflections.bindUniforms(this.program,b,c.ssrParams));0===c.identifier&&(d.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",
c.transformNormal_ViewFromGlobal),1===c.subPass&&d.setUniform2fv("uCameraNearFar",c.cameraNearFar),0===c.subPass&&(c.ambientOcclusionEnabled&&c.ambientOcclusion.bind(d,a.TextureUnits.SSAO),c.shadowsEnabled&&c.shadowMap.bind(d,a.TextureUnits.SHADOW_MAP),c.lighting.setUniforms(this.program,c.integratedMesh)));1===c.identifier&&this.program.setUniform2fv("uCameraNearFar",c.cameraNearFar);2===c.identifier&&f.OutputHighlight.bindOutputHighlight(b,this.program,c)};k.prototype.bindDraw=function(a,b){m.VertexPosition.bindModelTransform(this.program,
a);this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",a.transformNormal_GlobalFromModel);if(b.isIntegratedMesh){var c=b.overlayTexScale;b=b.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[a.toMapSpace[0]*c[0]+b[0],a.toMapSpace[1]*c[1]+b[1],a.toMapSpace[0]*c[2]+b[2],a.toMapSpace[1]*c[3]+b[3]]);this.program.setUniform4fv("overlayTexScale",[a.toMapSpace[2]*c[0],a.toMapSpace[3]*c[1],a.toMapSpace[2]*c[2],a.toMapSpace[3]*c[3]])}};k.prototype.bindMaterial=function(c,d,e){var f=
this.program;f.setUniform4fv("uBaseColor",d.baseColor);f.setUniform1f("uObjectOpacity",d.objectOpacity);f.setUniform1f("textureAlphaCutoff",d.alphaCutoff);1===d.componentParameters.type?d.componentParameters.texture.bind(f,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:a.TextureUnits.COMPONENT_COLOR}):(f.setUniform4fv("uExternalColor",d.componentParameters.externalColor),f.setUniform1i("uExternalColorMixMode",d.componentParameters.externalColorMixMode));l.isSome(d.baseColorTexture)&&
d.baseColorTexture.bind(c,f,"uBaseColorTexture",a.TextureUnits.DIFFUSE,"uBaseColorTextureSize");0===this.configuration.output&&(b.PhysicallyBasedRenderingParameters.bindUniforms(this.program,d),l.isSome(d.metallicRoughnessTexture)&&d.metallicRoughnessTexture.bind(c,f,"texMetallicRoughness",a.TextureUnits.METALLIC_ROUGHNESS,"texMetallicRoughnessSize"),l.isSome(d.emissionTexture)&&d.emissionTexture.bind(c,f,"texEmission",a.TextureUnits.EMISSION,"texEmissionSize"),l.isSome(d.occlusionTexture)&&d.occlusionTexture.bind(c,
f,"texOcclusion",a.TextureUnits.OCCLUSION,"texOcclusionSize"),l.isSome(d.normalTexture)&&d.normalTexture.bind(c,f,"normalTexture",a.TextureUnits.NORMAL,"normalTextureSize"));d.isIntegratedMesh&&(0===e.identifier&&0===e.subPass?(c.bindTexture(l.unwrap(d.overlayColorInner),a.TextureUnits.OVERLAY0_COLOR),c.bindTexture(l.unwrap(d.overlayColorOuter),a.TextureUnits.OVERLAY1_COLOR),c.bindTexture(l.unwrap(d.overlayNormalInner),a.TextureUnits.OVERLAY0_NORMAL),c.bindTexture(l.unwrap(d.overlayNormalOuter),a.TextureUnits.OVERLAY1_NORMAL),
f.setUniform1i("ovInnerNormalTex",a.TextureUnits.OVERLAY0_NORMAL),f.setUniform1i("ovOuterNormalTex",a.TextureUnits.OVERLAY1_NORMAL)):2===e.identifier&&(c.bindTexture(l.unwrap(d.overlayHighlightInner),a.TextureUnits.OVERLAY0_COLOR),c.bindTexture(l.unwrap(d.overlayHighlightOuter),a.TextureUnits.OVERLAY1_COLOR)),f.setUniform1i("ovInnerColorTex",a.TextureUnits.OVERLAY0_COLOR),f.setUniform1i("ovOuterColorTex",a.TextureUnits.OVERLAY1_COLOR),f.setUniform1f("overlayOpacity",1))};k.prototype.initializeProgram=
function(a){var b=k.shader.get(),c=this.configuration,c=b.build({OITEnabled:0===this.configuration.transparencyPassType||1===this.configuration.transparencyPassType,alphaPass:1===c.transparencyPassType,output:c.output,normalType:0===c.integratedMeshMode?c.hasNormals?1:3:2,attributeColor:c.hasVertexColors,attributeTextureCoordinates:c.vertexTextureCoordinates,componentData:c.componentData,alphaDiscardMode:c.alphaDiscardMode,baseColorTexture:c.baseColorTexture,doubleSidedMode:c.doubleSidedMode,receiveAmbientOcclusion:c.receiveAmbientOcclusion,
receiveShadows:c.receiveShadows,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:a.viewingMode,vertexDiscardMode:c.vertexDiscardMode,pbrMode:3===c.integratedMeshMode?4:c.usePBR?1:0,hasMetalnessAndRoughnessTexture:c.hasMetalnessAndRoughnessTexture,hasEmissionTexture:c.hasEmissionTexture,hasOcclusionTexture:c.hasOcclusionTexture,hasNormalTexture:c.hasNormalTexture,vertexTangets:!1,useOldSceneLightInterface:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:p.doublePrecisionRequiresObfuscation(a.rctx),
overlayEnabled:2===c.integratedMeshMode||3===c.integratedMeshMode,ssrEnabled:c.ssrEnabled,highStepCount:!1});return new v(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),b.attributeLocations)};Object.defineProperty(k.prototype,"pipeline",{get:function(){switch(this.configuration.transparencyPassType){case 0:return this.colorPipelineState;case 1:return this.alphaPipelineState;case 2:return this.frontFacePipelineState;default:return this.defaultPipelineState}},enumerable:!1,configurable:!0});
k.prototype.pipelineState=function(a){var b=this.configuration,c=0!==b.integratedMeshMode,d,e,f;3===a?(f=x,d=513,e=z.defaultDepthWriteParams,a=b.polygonOffsetEnabled?{factor:2,units:2}:null):(f=2!==a?1===a?A:B:null,d=2===a?513:515,e=2===a?z.defaultDepthWriteParams:null,a=2!==a?{factor:-1,units:-2}:null);return z.makePipelineState({blending:0===b.output&&b.blendingEnabled?f:null,culling:C[b.cullFace],depthTest:{func:d},depthWrite:e,colorWrite:z.defaultColorWriteParams,stencilWrite:c||b.sceneHasOcludees?
q.stencilWriteMaskOn:null,stencilTest:c?q.replaceBitWhenDepthTestPasses(1):b.sceneHasOcludees?q.stencilBaseAllZerosParams:null,polygonOffset:a})};k.prototype.initializePipeline=function(){this._colorPipelineState=this.pipelineState(0);this._alphaPipelineState=this.pipelineState(1);this._frontFacePipelineState=this.pipelineState(2);return this._defaultPipelineState=this.pipelineState(3)};Object.defineProperty(k.prototype,"defaultPipelineState",{get:function(){return this._defaultPipelineState},enumerable:!1,
configurable:!0});Object.defineProperty(k.prototype,"colorPipelineState",{get:function(){return this._colorPipelineState},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"alphaPipelineState",{get:function(){return this._alphaPipelineState},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"frontFacePipelineState",{get:function(){return this._frontFacePipelineState},enumerable:!1,configurable:!0});k.shader=new t.ReloadableShaderModule(c,function(){return new Promise(function(a,
b){n(["./shader/ComponentShader.glsl"],a,b)})});return k}(u.ShaderTechnique);a.ComponentTechnique=u;var x=w.separateBlendingParams(770,1,771,771),B=z.simpleBlendingParams(1,1),A=z.simpleBlendingParams(0,771),C=[null,{face:1028,mode:2305},{face:1029,mode:2305}];w=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.transformNormal_GlobalFromModel=k.mat3f64.create();b.toMapSpace=e.vec4f64.create();return b}d.__extends(b,a);return b}(m.VertexPosition.ModelTransform);a.ComponentDrawParameters=
w;w=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.hasVertexColors=!1;b.hasNormals=!1;b.vertexTextureCoordinates=0;b.componentData=0;b.slicePlaneEnabled=!1;b.cullFace=2;b.baseColorTexture=!1;b.receiveAmbientOcclusion=!0;b.receiveShadows=!0;b.vertexDiscardMode=0;b.doubleSidedMode=2;b.blendingEnabled=!0;b.alphaDiscardMode=1;b.integratedMeshMode=0;b.ssrEnabled=!1;b.polygonOffsetEnabled=!1;b.usePBR=!1;b.hasMetalnessAndRoughnessTexture=!1;b.hasEmissionTexture=!1;b.hasOcclusionTexture=
!1;b.hasNormalTexture=!1;b.sceneHasOcludees=!1;b.transparencyPassType=3;return b}d.__extends(b,a);d.__decorate([r.parameter({count:7})],b.prototype,"output",void 0);d.__decorate([r.parameter()],b.prototype,"hasVertexColors",void 0);d.__decorate([r.parameter()],b.prototype,"hasNormals",void 0);d.__decorate([r.parameter({count:3})],b.prototype,"vertexTextureCoordinates",void 0);d.__decorate([r.parameter({count:2})],b.prototype,"componentData",void 0);d.__decorate([r.parameter()],b.prototype,"slicePlaneEnabled",
void 0);d.__decorate([r.parameter({count:3})],b.prototype,"cullFace",void 0);d.__decorate([r.parameter()],b.prototype,"baseColorTexture",void 0);d.__decorate([r.parameter()],b.prototype,"receiveAmbientOcclusion",void 0);d.__decorate([r.parameter()],b.prototype,"receiveShadows",void 0);d.__decorate([r.parameter({count:3})],b.prototype,"vertexDiscardMode",void 0);d.__decorate([r.parameter({count:3})],b.prototype,"doubleSidedMode",void 0);d.__decorate([r.parameter()],b.prototype,"blendingEnabled",void 0);
d.__decorate([r.parameter({count:4})],b.prototype,"alphaDiscardMode",void 0);d.__decorate([r.parameter({count:4})],b.prototype,"integratedMeshMode",void 0);d.__decorate([r.parameter()],b.prototype,"ssrEnabled",void 0);d.__decorate([r.parameter()],b.prototype,"polygonOffsetEnabled",void 0);d.__decorate([r.parameter()],b.prototype,"usePBR",void 0);d.__decorate([r.parameter()],b.prototype,"hasMetalnessAndRoughnessTexture",void 0);d.__decorate([r.parameter()],b.prototype,"hasEmissionTexture",void 0);
d.__decorate([r.parameter()],b.prototype,"hasOcclusionTexture",void 0);d.__decorate([r.parameter()],b.prototype,"hasNormalTexture",void 0);d.__decorate([r.parameter()],b.prototype,"sceneHasOcludees",void 0);d.__decorate([r.parameter({count:4})],b.prototype,"transparencyPassType",void 0);return b}(r.ShaderTechniqueConfiguration);a.ComponentTechniqueConfiguration=w})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentShader.glsl":function(){define("require exports tslib ../../../../../../../geometry/support/geodesicConstants ./ComponentData.glsl ./VertexDiscardByOpacity.glsl ../../../../core/shaderLibrary/ForwardLinearDepth.glsl ../../../../core/shaderLibrary/Slice.glsl ../../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../../core/shaderLibrary/attributes/VertexColor.glsl ../../../../core/shaderLibrary/attributes/VertexNormal.glsl ../../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../../core/shaderLibrary/output/OutputDepth.glsl ../../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../../core/shaderLibrary/shading/ComputeMaterialColor.glsl ../../../../core/shaderLibrary/shading/ComputeNormalTexture.glsl ../../../../core/shaderLibrary/shading/ComputeShadingNormal.glsl ../../../../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../../core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../../../../core/shaderLibrary/shading/ReadShadowMap.glsl ../../../../core/shaderLibrary/terrain/Overlay.glsl ../../../../core/shaderLibrary/util/AlphaDiscard.glsl ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/ShaderBuilder".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E){Object.defineProperty(a,"__esModule",{value:!0});a.build=a.attributeLocations=void 0;a.attributeLocations={position:0,normal:1,normalCompressed:1,color:2,uv0:3,uvRegion:4,componentIndex:5};a.build=function(a){var n=new E.ShaderBuilder;n.include(g.VertexPosition,a);n.include(b.VertexNormal,a);n.include(f.VertexColor,a);n.include(m.TextureCoordinateAttribute,a);n.include(c.ForwardLinearDepth,a);n.include(k.ComponentData,a);n.include(A.DiscardOrAdjustAlpha,
a);n.include(h.Slice,a);n.include(z.ReadBaseColorTexture,a);n.include(e.VertexDiscardByOpacity,a);n.fragment.uniforms.add("view","mat4");if(1===a.pbrMode||2===a.pbrMode)n.include(w.PhysicallyBasedRenderingParameters,a),n.include(r.ComputeNormalTexture,a);3===a.output&&1===a.componentData?n.vertex.code.add(C.glsl(G||(G=d.__makeTemplateObject(["\n      #define discardShadows(castShadows) { if(!castShadows) { gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n    "],["\n      #define discardShadows(castShadows) { if(!castShadows) { gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n    "])))):
n.vertex.code.add(C.glsl(F||(F=d.__makeTemplateObject(["\n      #define discardShadows(castShadows) {}\n    "],["\n      #define discardShadows(castShadows) {}\n    "]))));var ya=a.overlayEnabled&&0===a.output&&4===a.pbrMode;a.overlayEnabled&&(n.include(B.Overlay,a),1===a.viewingMode?n.vertex.code.add(C.glsl(H||(H=d.__makeTemplateObject(["\n      const float invEarthRadius \x3d ",";\n      vec2 projectOverlay(vec3 pos) {\n        return pos.xy / (1.0 + invEarthRadius * pos.z);\n      }\n      "],
["\n      const float invEarthRadius \x3d ",";\n      vec2 projectOverlay(vec3 pos) {\n        return pos.xy / (1.0 + invEarthRadius * pos.z);\n      }\n      "])),C.glsl.float(1/l.earthRadius))):n.vertex.code.add(C.glsl(J||(J=d.__makeTemplateObject(["\n      vec2 projectOverlay(vec3 pos) { return pos.xy; }\n      "],["\n      vec2 projectOverlay(vec3 pos) { return pos.xy; }\n      "])))));ya&&(n.varyings.add("tbnTangent","vec3"),n.varyings.add("tbnBiTangent","vec3"),n.varyings.add("groundNormal",
"vec3"),n.varyings.add("positionView","vec3"));n.vertex.code.add(C.glsl(Q||(Q=d.__makeTemplateObject(["\n    void main() {\n      bool castShadows;\n      vec4 externalColor \x3d forwardExternalColor(castShadows);\n      discardShadows(castShadows);\n\n      vertexDiscardByOpacity(externalColor.a);\n\n      if (externalColor.a \x3c ",") {\n        // Discard this vertex\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n      forwardPosition();\n      forwardNormal();\n      ",
"\n\n      ","\n      forwardTextureCoordinates();\n      forwardVertexColor();\n      forwardLinearDepth(); // depends on forwardPosition()\n    }\n  "],["\n    void main() {\n      bool castShadows;\n      vec4 externalColor \x3d forwardExternalColor(castShadows);\n      discardShadows(castShadows);\n\n      vertexDiscardByOpacity(externalColor.a);\n\n      if (externalColor.a \x3c ",") {\n        // Discard this vertex\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n      forwardPosition();\n      forwardNormal();\n      ",
"\n\n      ","\n      forwardTextureCoordinates();\n      forwardVertexColor();\n      forwardLinearDepth(); // depends on forwardPosition()\n    }\n  "])),C.glsl.float(A.symbolAlphaCutoff),ya?C.glsl(L||(L=d.__makeTemplateObject(["\n        positionView \x3d position_view();\n        ","\n        "],["\n        positionView \x3d position_view();\n        ","\n        "])),1===a.viewingMode?C.glsl(I||(I=d.__makeTemplateObject(["\n        groundNormal \x3d normalize(positionWorld());\n        tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));\n        tbnBiTangent \x3d normalize(cross(groundNormal, tbnTangent));"],
["\n        groundNormal \x3d normalize(positionWorld());\n        tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));\n        tbnBiTangent \x3d normalize(cross(groundNormal, tbnTangent));"]))):C.glsl(K||(K=d.__makeTemplateObject(["\n        groundNormal \x3d vec3(0.0, 0.0, 1.0);\n        tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n        tbnBiTangent \x3d normalize(cross(groundNormal, tbnTangent));"],["\n        groundNormal \x3d vec3(0.0, 0.0, 1.0);\n        tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n        tbnBiTangent \x3d normalize(cross(groundNormal, tbnTangent));"])))):
"",a.overlayEnabled?C.glsl(M||(M=d.__makeTemplateObject(["setOverlayVTC(projectOverlay(position));"],["setOverlayVTC(projectOverlay(position));"]))):""));0===a.output&&(n.include(u.ComputeMaterialColor,a),n.include(q.ComputeShadingNormal,a),n.include(v.EvaluateSceneLighting,a),ya&&(n.fragment.uniforms.add("ovInnerNormalTex","sampler2D"),n.fragment.uniforms.add("ovOuterNormalTex","sampler2D")),a.receiveShadows?(n.include(x.ReadShadowMap,a),n.fragment.code.add(C.glsl(R||(R=d.__makeTemplateObject(["\n        float evaluateShadow() {\n          return readShadowMap(vPositionWorldCameraRelative, linearDepth);\n        }\n      "],
["\n        float evaluateShadow() {\n          return readShadowMap(vPositionWorldCameraRelative, linearDepth);\n        }\n      "]))))):n.fragment.code.add(C.glsl(O||(O=d.__makeTemplateObject(["\n        float evaluateShadow() { return 0.0; }\n      "],["\n        float evaluateShadow() { return 0.0; }\n      "])))),n.fragment.code.add(C.glsl(S||(S=d.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        vec4 externalColor;\n        int externalColorMixMode;\n        readExternalColor(externalColor, externalColorMixMode);\n\n        vec4 materialColor \x3d computeMaterialColor(\n          textureColor,\n          externalColor,\n          externalColorMixMode\n        );\n        ",
"\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        vec4 externalColor;\n        int externalColorMixMode;\n        readExternalColor(externalColor, externalColorMixMode);\n\n        vec4 materialColor \x3d computeMaterialColor(\n          textureColor,\n          externalColor,\n          externalColorMixMode\n        );\n        ","\n    "])),a.overlayEnabled?
C.glsl(N||(N=d.__makeTemplateObject(["\n        vec4 overlayColorOpaque \x3d getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n        vec4 overlayColor \x3d overlayOpacity * overlayColorOpaque;\n        materialColor \x3d materialColor * (1.0 - overlayColor.a) + overlayColor;"],["\n        vec4 overlayColorOpaque \x3d getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n        vec4 overlayColor \x3d overlayOpacity * overlayColorOpaque;\n        materialColor \x3d materialColor * (1.0 - overlayColor.a) + overlayColor;"]))):
"")),a.alphaPass?n.fragment.code.add(C.glsl(P||(P=d.__makeTemplateObject(["\n        gl_FragColor \x3d materialColor.aaaa;\n      }\n    "],["\n        gl_FragColor \x3d materialColor.aaaa;\n      }\n    "])))):(1===a.pbrMode||2===a.pbrMode?(n.fragment.code.add(C.glsl(Z||(Z=d.__makeTemplateObject(["\n        ","\n        vec3 normalVertex \x3d shadingNormalWorld();\n        float additionalIrradiance \x3d 0.02 * lightingMainIntensity[2];\n      "],["\n        ","\n        vec3 normalVertex \x3d shadingNormalWorld();\n        float additionalIrradiance \x3d 0.02 * lightingMainIntensity[2];\n      "])),
1===a.pbrMode?C.glsl(U||(U=d.__makeTemplateObject(["\n        applyPBRFactors();\n        if (int(externalColorMixMode) \x3d\x3d 3) {\n          mrr \x3d vec3(0.0, 0.6, 0.2);\n        }"],["\n        applyPBRFactors();\n        if (int(externalColorMixMode) \x3d\x3d 3) {\n          mrr \x3d vec3(0.0, 0.6, 0.2);\n        }"]))):"")),a.hasNormalTexture?n.fragment.code.add(C.glsl(V||(V=d.__makeTemplateObject(["\n        mat3 tangentSpace \x3d computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);\n        vec3 shadingNormal \x3d computeTextureNormal(tangentSpace, vuv0);\n        "],
["\n        mat3 tangentSpace \x3d computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);\n        vec3 shadingNormal \x3d computeTextureNormal(tangentSpace, vuv0);\n        "])))):n.fragment.code.add(C.glsl(T||(T=d.__makeTemplateObject(["\n        vec3 shadingNormal \x3d normalVertex;\n        "],["\n        vec3 shadingNormal \x3d normalVertex;\n        "])))),n.fragment.code.add(C.glsl(ca||(ca=d.__makeTemplateObject(["","\n      "],["","\n      "])),1===a.viewingMode?C.glsl(Y||
(Y=d.__makeTemplateObject(["vec3 normalGround \x3d normalize(positionWorld());"],["vec3 normalGround \x3d normalize(positionWorld());"]))):C.glsl(X||(X=d.__makeTemplateObject(["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"],["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"]))))),n.fragment.code.add(C.glsl(ba||(ba=d.__makeTemplateObject(["\n        vec3 viewDir \x3d normalize(vPositionWorldCameraRelative);\n        float ssao \x3d 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());\n        vec3 additionalLight \x3d evaluateAdditionalLighting(ssao, positionWorld());\n        vec4 shadedColor \x3d vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);\n        "],
["\n        vec3 viewDir \x3d normalize(vPositionWorldCameraRelative);\n        float ssao \x3d 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());\n        vec3 additionalLight \x3d evaluateAdditionalLighting(ssao, positionWorld());\n        vec4 shadedColor \x3d vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);\n        "]))))):(a.receiveShadows?n.fragment.code.add(C.glsl(ga||
(ga=d.__makeTemplateObject(["\n      float shadow \x3d evaluateShadow();\n        "],["\n      float shadow \x3d evaluateShadow();\n        "])))):1===a.viewingMode?n.fragment.code.add(C.glsl(ia||(ia=d.__makeTemplateObject(["\n      float additionalAmbientScale \x3d _oldHeuristicLighting(positionWorld());\n      float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n        "],["\n      float additionalAmbientScale \x3d _oldHeuristicLighting(positionWorld());\n      float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n        "])))):
n.fragment.code.add(C.glsl(ha||(ha=d.__makeTemplateObject(["\n      float shadow \x3d 0.0;\n      "],["\n      float shadow \x3d 0.0;\n      "])))),n.fragment.code.add(C.glsl(fa||(fa=d.__makeTemplateObject(["\n      float ambientOcclusion \x3d evaluateAmbientOcclusion();\n      // At global scale we create some additional ambient light based on the main light to simulate global illumination\n      vec3 additionalLight \x3d evaluateAdditionalLighting(ambientOcclusion, positionWorld());\n      vec4 shadedColor \x3d vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);\n      ",
"\n      "],["\n      float ambientOcclusion \x3d evaluateAmbientOcclusion();\n      // At global scale we create some additional ambient light based on the main light to simulate global illumination\n      vec3 additionalLight \x3d evaluateAdditionalLighting(ambientOcclusion, positionWorld());\n      vec4 shadedColor \x3d vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);\n      ","\n      "])),ya?C.glsl(da||(da=d.__makeTemplateObject(["\n          vec4 overlayWaterMask \x3d getOverlayColor(ovInnerNormalTex, ovOuterNormalTex, vtcOverlay);\n          float waterNormalLength \x3d length(overlayWaterMask);\n          if (waterNormalLength \x3e 0.95) {\n            mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, groundNormal);\n            vec4 waterOverlayColor \x3d vec4(overlayColorOpaque.xyz, overlayColor.w);\n            vec4 waterColorLinear \x3d getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView);\n            vec4 waterColorNonLinear \x3d delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));\n            // un-gamma the ground color to mix in linear space\n            shadedColor \x3d mix(shadedColor, waterColorNonLinear, waterColorLinear.w);\n          }"],
["\n          vec4 overlayWaterMask \x3d getOverlayColor(ovInnerNormalTex, ovOuterNormalTex, vtcOverlay);\n          float waterNormalLength \x3d length(overlayWaterMask);\n          if (waterNormalLength \x3e 0.95) {\n            mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, groundNormal);\n            vec4 waterOverlayColor \x3d vec4(overlayColorOpaque.xyz, overlayColor.w);\n            vec4 waterColorLinear \x3d getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView);\n            vec4 waterColorNonLinear \x3d delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));\n            // un-gamma the ground color to mix in linear space\n            shadedColor \x3d mix(shadedColor, waterColorNonLinear, waterColorLinear.w);\n          }"]))):
""))),n.fragment.code.add(C.glsl(ja||(ja=d.__makeTemplateObject(["\n        gl_FragColor \x3d highlightSlice(shadedColor, vPositionWorldCameraRelative);\n        ","\n      }\n    "],["\n        gl_FragColor \x3d highlightSlice(shadedColor, vPositionWorldCameraRelative);\n        ","\n      }\n    "])),a.OITEnabled?C.glsl(ka||(ka=d.__makeTemplateObject(["\n          //For order-independent transparency we need to sum together colors premultiplied with alpha. For opaque rendering this has no effect.\n          gl_FragColor.rgb *\x3d shadedColor.a;\n        "],
["\n          //For order-independent transparency we need to sum together colors premultiplied with alpha. For opaque rendering this has no effect.\n          gl_FragColor.rgb *\x3d shadedColor.a;\n        "]))):""))));if(1===a.output||3===a.output)n.include(p.OutputDepth,a),n.fragment.code.add(C.glsl(pa||(pa=d.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        outputDepth(linearDepth);\n      }\n    "],
["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        outputDepth(linearDepth);\n      }\n    "]))));2===a.output&&(n.include(q.ComputeShadingNormal,a),n.fragment.code.add(C.glsl(na||(na=d.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        // note: the alpha component needs to be 1.0 in order for this material\n        // to influence ambient occlusion, see the ssao fragment shader\n        float alpha \x3d ",
";\n        gl_FragColor \x3d vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);\n      }\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        // note: the alpha component needs to be 1.0 in order for this material\n        // to influence ambient occlusion, see the ssao fragment shader\n        float alpha \x3d ",";\n        gl_FragColor \x3d vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);\n      }\n    "])),
2===a.normalType?"0.0":"1.0")));4===a.output&&(n.include(t.OutputHighlight),n.fragment.code.add(C.glsl(za||(za=d.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        ","\n\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        ",
"\n\n        outputHighlight();\n      }\n    "])),a.overlayEnabled?C.glsl(va||(va=d.__makeTemplateObject(["\n        vec4 overlayColor \x3d getCombinedOverlayColor();\n\n        if (overlayColor.a \x3d\x3d 0.0) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }"],["\n        vec4 overlayColor \x3d getCombinedOverlayColor();\n\n        if (overlayColor.a \x3d\x3d 0.0) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }"]))):"")));return n};var G,F,H,J,I,K,
L,M,Q,R,O,N,S,P,U,Z,V,T,Y,X,ca,ba,ga,ia,ha,da,fa,ka,ja,pa,na,va,za})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define(["require","exports","tslib","./DecodeSymbolColor.glsl","../../../../core/shaderModules/interfaces"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.ComponentData=void 0;a.ComponentData=function(a,b){1===b.componentData&&(a.vertex.uniforms.add("uComponentColorTex","sampler2D"),a.vertex.uniforms.add("uComponentColorTexInvDim",
"vec2"),a.attributes.add("componentIndex","float"),a.varyings.add("vExternalColorMixMode","mediump float"),a.varyings.add("vExternalColor","vec4"),a.include(l.DecodeSymbolColor),a.vertex.code.add(k.glsl(e||(e=d.__makeTemplateObject(["\n      vec4 _readComponentColor() {\n        float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n        vec2 indexCoord \x3d vec2(\n          mod(normalizedIndex, 1.0),\n          (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n        );\n        return texture2D(uComponentColorTex, indexCoord);\n       }\n\n      vec4 forwardExternalColor(out bool castShadows) {\n        vec4 componentColor \x3d _readComponentColor() * 255.0;\n\n        float shadowFlag \x3d mod(componentColor.b * 255.0, 2.0);\n        componentColor.b -\x3d shadowFlag;\n        castShadows \x3d shadowFlag \x3e\x3d 1.0;\n\n        int decodedColorMixMode;\n        vExternalColor \x3d decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // \x3d 1/255;\n        vExternalColorMixMode \x3d float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n\n        return vExternalColor;\n      }\n    "],
["\n      vec4 _readComponentColor() {\n        float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n        vec2 indexCoord \x3d vec2(\n          mod(normalizedIndex, 1.0),\n          (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n        );\n        return texture2D(uComponentColorTex, indexCoord);\n       }\n\n      vec4 forwardExternalColor(out bool castShadows) {\n        vec4 componentColor \x3d _readComponentColor() * 255.0;\n\n        float shadowFlag \x3d mod(componentColor.b * 255.0, 2.0);\n        componentColor.b -\x3d shadowFlag;\n        castShadows \x3d shadowFlag \x3e\x3d 1.0;\n\n        int decodedColorMixMode;\n        vExternalColor \x3d decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // \x3d 1/255;\n        vExternalColorMixMode \x3d float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n\n        return vExternalColor;\n      }\n    "])))),
a.fragment.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d int(vExternalColorMixMode);\n      }\n    "],["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d int(vExternalColorMixMode);\n      }\n    "])))));0===b.componentData&&
(a.vertex.uniforms.add("uExternalColor","vec4"),a.fragment.uniforms.add("uExternalColorMixMode","int"),a.varyings.add("vExternalColor","vec4"),a.vertex.code.add(k.glsl(h||(h=d.__makeTemplateObject(["\n      vec4 forwardExternalColor(out bool castShadows) {\n        vExternalColor \x3d uExternalColor;\n        castShadows \x3d true;\n        return uExternalColor;\n      }\n    "],["\n      vec4 forwardExternalColor(out bool castShadows) {\n        vExternalColor \x3d uExternalColor;\n        castShadows \x3d true;\n        return uExternalColor;\n      }\n    "])))),
a.fragment.code.add(k.glsl(m||(m=d.__makeTemplateObject(["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d uExternalColorMixMode;\n      }\n    "],["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d uExternalColorMixMode;\n      }\n    "])))))};var e,c,h,m})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["require",
"exports","tslib","../../../../core/shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.VertexDiscardByOpacity=void 0;a.VertexDiscardByOpacity=function(a,f){a=a.vertex;a.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n  #define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)\n  "],["\n  #define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)\n  "]))));switch(f.vertexDiscardMode){case 0:a.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n        #define vertexDiscardByOpacity(_opacity_) {}\n      "],
["\n        #define vertexDiscardByOpacity(_opacity_) {}\n      "]))));break;case 2:a.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3e  VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "],["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3e  VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "]))));break;case 1:a.code.add(l.glsl(h||
(h=d.__makeTemplateObject(["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3c\x3d VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "],["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3c\x3d VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "]))))}};var k,e,c,h})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("require exports tslib ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/interfaces".split(" "),
function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.ComputeMaterialColor=void 0;a.ComputeMaterialColor=function(a,b){a.include(l.VertexColor,b);a.fragment.include(k.MixExternalColor);a=a.fragment;a.uniforms.add("uBaseColor","vec4");a.uniforms.add("uObjectOpacity","float");b.attributeColor?a.code.add(e.glsl(c||(c=d.__makeTemplateObject(["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb * vColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a * vColor.a;\n      }\n    "],
["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb * vColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a * vColor.a;\n      }\n    "])))):a.code.add(e.glsl(h||(h=d.__makeTemplateObject(["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a;\n      }\n    "],
["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a;\n      }\n    "]))));a.code.add(e.glsl(m||(m=d.__makeTemplateObject(["\n    vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {\n      vec3 baseColor \x3d _baseColor();\n      float baseOpacity \x3d _baseOpacity();\n\n      vec3 color \x3d mixExternalColor(\n        baseColor,\n        textureColor.rgb,\n        externalColor.rgb,\n        externalColorMixMode\n      );\n      float opacity \x3d uObjectOpacity * mixExternalOpacity(\n        baseOpacity,\n        textureColor.a,\n        externalColor.a,\n        externalColorMixMode\n      );\n\n      return vec4(color, opacity);\n    }\n  "],
["\n    vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {\n      vec3 baseColor \x3d _baseColor();\n      float baseOpacity \x3d _baseOpacity();\n\n      vec3 color \x3d mixExternalColor(\n        baseColor,\n        textureColor.rgb,\n        externalColor.rgb,\n        externalColorMixMode\n      );\n      float opacity \x3d uObjectOpacity * mixExternalOpacity(\n        baseOpacity,\n        textureColor.a,\n        externalColor.a,\n        externalColorMixMode\n      );\n\n      return vec4(color, opacity);\n    }\n  "]))))};
var c,h,m})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("require exports tslib ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ../../shaderModules/interfaces".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.ComputeShadingNormal=void 0;a.ComputeShadingNormal=function(a,n){var r=a.fragment;0===n.doubleSidedMode?r.code.add(e.glsl(c||(c=d.__makeTemplateObject(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return normal;\n      }\n    "],
["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return normal;\n      }\n    "])))):1===n.doubleSidedMode?(a.include(k.VertexPosition,n),r.uniforms.add("uTransform_ViewFromCameraLocal_T","vec3"),r.code.add(e.glsl(h||(h=d.__makeTemplateObject(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        vec3 viewDir \x3d vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;\n        return dot(normal, viewDir) \x3e 0.0 ? -normal : normal;\n      }\n    "],["\n      vec3 _adjustDoublesided(vec3 normal) {\n        vec3 viewDir \x3d vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;\n        return dot(normal, viewDir) \x3e 0.0 ? -normal : normal;\n      }\n    "]))))):
2===n.doubleSidedMode&&r.code.add(e.glsl(m||(m=d.__makeTemplateObject(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "],["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "]))));0===n.normalType||1===n.normalType?(a.include(l.VertexNormal,n),r.code.add(e.glsl(f||(f=d.__makeTemplateObject(["\n      vec3 shadingNormalWorld() {\n        return _adjustDoublesided(normalize(vNormalWorld));\n      }\n\n      vec3 shadingNormal_view() {\n        vec3 normal \x3d normalize(vNormalView);\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "],
["\n      vec3 shadingNormalWorld() {\n        return _adjustDoublesided(normalize(vNormalWorld));\n      }\n\n      vec3 shadingNormal_view() {\n        vec3 normal \x3d normalize(vNormalView);\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "]))))):3===n.normalType?(a.extensions.add("GL_OES_standard_derivatives"),a.include(k.VertexPosition,n),r.code.add(e.glsl(b||(b=d.__makeTemplateObject(["\n      vec3 shadingNormalWorld() {\n        return normalize(cross(\n          dFdx(vPositionWorldCameraRelative),\n          dFdy(vPositionWorldCameraRelative)\n        ));\n      }\n\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));\n      }\n    "],
["\n      vec3 shadingNormalWorld() {\n        return normalize(cross(\n          dFdx(vPositionWorldCameraRelative),\n          dFdy(vPositionWorldCameraRelative)\n        ));\n      }\n\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));\n      }\n    "]))))):2===n.normalType&&(1===n.viewingMode?(a.include(k.VertexPosition,n),r.code.add(e.glsl(g||(g=d.__makeTemplateObject(["\n        vec3 shadingNormalWorld() {\n          return normalize(positionWorld());\n        }\n      "],
["\n        vec3 shadingNormalWorld() {\n          return normalize(positionWorld());\n        }\n      "]))))):2===n.viewingMode&&r.code.add(e.glsl(p||(p=d.__makeTemplateObject(["\n        vec3 shadingNormalWorld() {\n          return vec3(0.0, 0.0, 1.0);\n        }\n      "],["\n        vec3 shadingNormalWorld() {\n          return vec3(0.0, 0.0, 1.0);\n        }\n      "])))),a.extensions.add("GL_OES_standard_derivatives"),r.code.add(e.glsl(t||(t=d.__makeTemplateObject(["\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;\n      }\n    "],
["\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;\n      }\n    "])))))};var c,h,m,f,b,g,p,t})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("require exports tslib ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.ReadBaseColorTexture=
void 0;a.ReadBaseColorTexture=function(a,b){var f=a.fragment;b.baseColorTexture?(a.include(l.VertexTextureCoordinates,b),f.uniforms.add("uBaseColorTexture","sampler2D"),f.uniforms.add("uBaseColorTextureSize","vec2"),2===b.attributeTextureCoordinates?(a.include(k.TextureAtlasLookup),f.code.add(e.glsl(c||(c=d.__makeTemplateObject(["\n        vec4 readBaseColorTexture() {\n          return textureAtlasLookup(\n            uBaseColorTexture,\n            uBaseColorTextureSize,\n            vuv0,\n            vuvRegion\n          );\n        }\n      "],
["\n        vec4 readBaseColorTexture() {\n          return textureAtlasLookup(\n            uBaseColorTexture,\n            uBaseColorTextureSize,\n            vuv0,\n            vuvRegion\n          );\n        }\n      "]))))):f.code.add(e.glsl(h||(h=d.__makeTemplateObject(["\n        vec4 readBaseColorTexture() {\n          return texture2D(uBaseColorTexture, vuv0);\n        }\n      "],["\n        vec4 readBaseColorTexture() {\n          return texture2D(uBaseColorTexture, vuv0);\n        }\n      "]))))):
f.code.add(e.glsl(m||(m=d.__makeTemplateObject(["\n      vec4 readBaseColorTexture() { return vec4(1.0); }\n    "],["\n      vec4 readBaseColorTexture() { return vec4(1.0); }\n    "]))))};var c,h,m})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.parameterBlock=a.parameter=a.MaterialParameterBlock=a.MaterialBase=void 0;n=function(){function a(){this._dirty=!0}a.prototype._setDirty=function(){this._dirty=
!0};a.prototype._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(var a=0,d=this._parameterBlocks;a<d.length;a++)this[d[a]]._setClean()};Object.defineProperty(a.prototype,"dirty",{get:function(){return this._dirty||this._checkParameterBlocksDirty()},enumerable:!1,configurable:!0});a.prototype._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(var a=0,d=this._parameterBlocks;a<d.length;a++)if(this[d[a]].dirty)return!0;return!1};return a}();a.MaterialBase=
n;n=function(){function a(){this._dirty=!0}a.prototype._setDirty=function(){this._dirty=!0};a.prototype._setClean=function(){this._dirty=!1};Object.defineProperty(a.prototype,"dirty",{get:function(){return this._dirty},enumerable:!1,configurable:!0});return a}();a.MaterialParameterBlock=n;a.parameter=function(a){void 0===a&&(a={});return function(d,k){var e,c=null!==(e=d._parameterCount)&&void 0!==e?e:0;d._parameterCount=c+1;if(a.vectorOps){var h=a.vectorOps;Object.defineProperty(d,k,{get:function(){return this[c]},
set:function(a){var d=this[c];if(null==d)this[c]=a;else{if(h.equals(d,a))return;h.copy(d,a)}this._setDirty()}})}else Object.defineProperty(d,k,{get:function(){return this[c]},set:function(d){this[c]!==d&&(a.dispose&&this[c]&&this[c].dispose(),this[c]=d,this._setDirty())}})}};a.parameterBlock=function(){return function(a,l){var d,e=null!==(d=a._parameterCount)&&void 0!==d?d:0;a._parameterCount=e+1;a._parameterBlocks=a._parameterBlocks||[];a._parameterBlocks.push(e);Object.defineProperty(a,l,{get:function(){return this[e]},
set:function(a){this[e]!==a&&(this[e]=a,this._setDirty())}})}}})},"esri/views/3d/webgl-engine/core/util/BucketedObjectStore":function(){define(["require","exports","tslib","../../lib/AutoDisposable"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.BucketedObjectStore=a.BucketStorable=void 0;n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c._bucket=null;c._bucketIndex=0;return c}d.__extends(c,a);Object.defineProperty(c.prototype,"bucketKey",{get:function(){return this._bucket.key},
enumerable:!1,configurable:!0});return c}(l.AutoDisposable);a.BucketStorable=n;n=function(){function a(){this._buckets=new Map;this._count=0}a.prototype.add=function(a,d){a=this._getBucket(a);d._bucket=a;d._bucketIndex=a.count;a._data.push(d);this._count++};a.prototype.remove=function(a){var c=a._bucket._data,d=c[c.length-1];c[a._bucketIndex]=d;d._bucketIndex=a._bucketIndex;c.pop();this._count--;a._bucket=null;a._bucketIndex=0};a.prototype.updateKey=function(a,d){this.remove(a);this.add(d,a)};a.prototype.getBucket=
function(a){return this._getBucket(a).data};a.prototype.forEach=function(a){this._buckets.forEach(function(c){a(c.data,c.key)})};Object.defineProperty(a.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0});a.prototype._getBucket=function(a){var c=this._buckets.get(a);if(c)return c;c=new k(a);this._buckets.set(a,c);return c};return a}();a.BucketedObjectStore=n;var k=function(){function a(a){this.key=a;this._data=[]}Object.defineProperty(a.prototype,"data",{get:function(){return this._data},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this._data.length},enumerable:!1,configurable:!0});return a}()})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec3","../../../../../core/libs/gl-matrix-2/vec3f32","../../../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.TwoVectorPosition=void 0;n=function(){function a(a){this._low=
l.vec3f32.create();this._high=l.vec3f32.create();a&&this.set(a)}Object.defineProperty(a.prototype,"low",{get:function(){return this._low},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"high",{get:function(){return this._high},enumerable:!1,configurable:!0});a.prototype.set=function(a){var c=this._low,e=this._high;d.vec3.copy(c,a);d.vec3.sub(e,a,c)};a.prototype.setElements=function(a,c,f){d.vec3.set(e,a,c,f);this.set(e)};a.prototype.get=function(a){return d.vec3.add(a,this._low,
this._high)};a.prototype.getLowScaled=function(a){return d.vec3.scale(a,this._low,1)};return a}();a.TwoVectorPosition=n;var e=k.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require","exports"],function(n,a){function d(a){void 0===a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}Object.defineProperty(a,"__esModule",{value:!0});a.defaultVisibilities=a.getVisibility=a.updateVisibilityWithCount=void 0;a.updateVisibilityWithCount=function(a,k,e,c){if(e>=
k)return a;null==a&&(a=d());var h=a.data,m=8*h.BYTES_PER_ELEMENT,f=e/m|0,b=e-m*f,g=h;c=c===a.isVisibleBit;e<g.length*m||!c||(e=Math.max(f+1,Math.ceil(1.5*g.length)),e=Math.min(e,((k-1)/m|0)+1),h=new Uint32Array(e),h.set(g));f<h.length&&(h[f]=h[f]&~(1<<b)|(c?1:0)<<b);a.data=h;return a};a.getVisibility=function(a,d){if(null==a)return!0;var e=a.isVisibleBit,c=a.data,h=8*c.BYTES_PER_ELEMENT;return d<c.length*h?(a=d/h|0,0!==(c[a]&1<<d-a*h)===e):!a.isVisibleBit};a.defaultVisibilities=d;n=[];for(a=0;65>
a;a++)n.push(Math.pow(2,a)-1)})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports","./ManagedTextureBackedBuffer"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.BufferManager=void 0;n=function(){function a(a,d){void 0===d&&(d=1);this.rctx=a;this.fieldCount=d;this.buffers=[]}a.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(a){return 0===a.activeCount?(a.dispose(),!1):!0})};a.prototype.destroy=
function(){this.buffers.forEach(function(a){return a.dispose()});this.buffers=[]};a.prototype.getBuffer=function(a){for(var e=0,c=this.buffers;e<c.length;e++){var h=c[e];if(h.availableCount>=a)return h}if(a>d.MAX_INDEX_COUNT)return null;a=new d.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(a);return a};a.prototype.updateTextures=function(){for(var a=0,d=this.buffers;a<d.length;a++)d[a].textureBuffer.updateTexture()};return a}();a.BufferManager=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require",
"exports","./SimpleIndexManager","./TextureBackedBuffer"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.ManagedTextureBackedBuffer=a.MAX_INDEX_COUNT=void 0;a.MAX_INDEX_COUNT=65536;n=function(){function k(e,c){void 0===c&&(c=1);this.textureBuffer=new l.TextureBackedBuffer(e,c);this.indexManager=new d.SimpleIndexManager(a.MAX_INDEX_COUNT)}k.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(k.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},
enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!1,configurable:!0});k.prototype.acquireIndex=function(){var a=this.indexManager.acquire();this.textureBuffer.resizeToFit(a);return a};k.prototype.releaseIndex=function(a){this.indexManager.release(a)};return k}();a.ManagedTextureBackedBuffer=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],
function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.SimpleIndexManager=void 0;n=function(){function a(a){this.maxCount=a;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(a.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!1,configurable:!0});a.prototype.acquire=
function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};a.prototype.release=function(a){this.recycledIndices.push(a)};return a}();a.SimpleIndexManager=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require","exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.TextureBackedBuffer=void 0;
n=function(){function a(a,c){void 0===c&&(c=1);this.rctx=a;this.fieldCount=c;this.textureWidth=4096;this.dirty=!0;this.texture=new l(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new d.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}a.prototype.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};a.prototype.setData=function(a,c,d,k,f,b){a=a*this.fieldCount+c;this.dirty=!0;this.data.set(a,
0,d);this.data.set(a,1,k);this.data.set(a,2,f);this.data.set(a,3,b)};a.prototype.setDataElement=function(a,c,d,k){a=a*this.fieldCount+c;this.dirty=!0;this.data.set(a,d,k)};a.prototype.resizeToFit=function(a){a*=this.fieldCount;a>=this.data.count&&(a=new d.BufferViewVec4u8(new ArrayBuffer(Math.ceil((a+1)/this.textureWidth)*this.textureWidth*4)),a.typedBuffer.set(this.data.typedBuffer),this.data=a)};a.prototype.updateTexture=function(){if(this.dirty){var a=this.texture.descriptor.width;this.data.count>
a*this.texture.descriptor.height&&this.texture.resize(a,this.data.count/a);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};a.prototype.bind=function(a,c){this.rctx.bindTexture(this.texture,c.unit);a.setUniform1i(c.texName,c.unit);a.setUniform2f(c.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return a}();a.TextureBackedBuffer=n})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("require exports ../../../../core/maybe ./glUtil3D ../shaders/CompositingTechnique ../../../webgl/Util".split(" "),
function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,c){this._rctx=a;this._techniqueRepository=c;this._techniques=new Set}a.prototype.dispose=function(){var a=this;this._techniques.forEach(function(c){return a._techniqueRepository.release(c)});this._techniques.clear();d.isSome(this._vao)&&(this._vao.dispose(),this._vao=null)};a.prototype.composite=function(a,c,b){void 0===c&&(c=0);void 0===b&&(b=1);this.compositeInternal(a,c,b,0)};a.prototype.compositeTransparent=
function(a,d,b,g){void 0===g&&(g=1);var f=this._rctx;c.alphaMode=3;c.function=3;c.hasOpacityFactor=1!==g;g=this._techniqueRepository.acquire(k.CompositingTechnique,c);f.bindProgram(g.program);g.bindPipelineState(f);g.program.setUniform1i("colorTexture",1);f.bindTexture(a,1);g.program.setUniform1i("alphaTexture",2);f.bindTexture(d,2);g.program.setUniform1i("frontFaceTexture",3);f.bindTexture(b,3);a=this.ensureVAO();f.bindVAO(a);f.drawArrays(5,0,e.vertexCount(a,"geometry"));this._techniqueRepository.release(g)};
a.prototype.compositeSpecial=function(a,c){this.compositeInternal(a,0,1,c)};a.prototype.compositeInternal=function(a,d,b,g){var f=this._rctx;c.alphaMode=d;c.function=g;c.hasOpacityFactor=1!==b;d=this._techniqueRepository.acquire(k.CompositingTechnique,c);f.bindProgram(d.program);d.bindPipelineState(f);d.program.setUniform1i("tex",1);c.hasOpacityFactor&&d.program.setUniform1f("opacity",b);f.bindTexture(a,1);a=this.ensureVAO();f.bindVAO(a);f.drawArrays(5,0,e.vertexCount(a,"geometry"));this._techniqueRepository.release(d)};
a.prototype.ensureVAO=function(){d.isNone(this._vao)&&(this._vao=l.createQuadVAO(this._rctx));return this._vao};return a}();a.default=n;var c=new k.CompositingTechniqueConfiguration})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports tslib ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./Compositing.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.CompositingTechniqueConfiguration=a.CompositingTechnique=void 0;k=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}d.__extends(e,a);e.prototype.initializeProgram=function(a){var b=e.shader.get().build(this.configuration);return new m(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),c.Default3D)};e.prototype.initializePipeline=function(){if(2===this.configuration.function)return b.makePipelineState({colorWrite:{r:!1,
g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case 0:return b.makePipelineState({colorWrite:b.defaultColorWriteParams});case 1:return b.makePipelineState({blending:f.separateBlendingParams(770,1,771,771),colorWrite:b.defaultColorWriteParams});case 3:return b.makePipelineState({blending:f.simpleBlendingParams(771,770),colorWrite:b.defaultColorWriteParams,depthTest:null,depthWrite:null});default:return b.makePipelineState({blending:f.simpleBlendingParams(1,771),colorWrite:b.defaultColorWriteParams})}};
e.shader=new l.ReloadableShaderModule(h,function(){return new Promise(function(a,b){n(["./Compositing.glsl"],a,b)})});return e}(k.ShaderTechnique);a.CompositingTechnique=k;k=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.function=0;b.alphaMode=0;b.hasOpacityFactor=!1;return b}d.__extends(b,a);d.__decorate([e.parameter({count:4})],b.prototype,"function",void 0);d.__decorate([e.parameter({count:4})],b.prototype,"alphaMode",void 0);d.__decorate([e.parameter()],b.prototype,"hasOpacityFactor",
void 0);return b}(e.ShaderTechniqueConfiguration);a.CompositingTechniqueConfiguration=k})},"esri/views/3d/webgl-engine/shaders/Compositing.glsl":function(){define("require exports tslib ../core/shaderLibrary/ScreenSpacePass ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var b=new e.ShaderBuilder;b.include(l.ScreenSpacePass);b.fragment.uniforms.add("tex","sampler2D");
0===a.function&&(a.hasOpacityFactor?(b.fragment.uniforms.add("opacity","float"),b.fragment.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n      void main() {\n        gl_FragColor \x3d texture2D(tex, uv) * opacity;\n      }"],["\n      void main() {\n        gl_FragColor \x3d texture2D(tex, uv) * opacity;\n      }"]))))):b.fragment.code.add(k.glsl(h||(h=d.__makeTemplateObject(["\n      void main() {\n        gl_FragColor \x3d texture2D(tex, uv);\n      }"],["\n      void main() {\n        gl_FragColor \x3d texture2D(tex, uv);\n      }"])))));
2===a.function&&b.fragment.code.add(k.glsl(m||(m=d.__makeTemplateObject(["\n    void main() {\n      gl_FragColor \x3d vec4(1.0 - texture2D(tex, uv).a);\n    }"],["\n    void main() {\n      gl_FragColor \x3d vec4(1.0 - texture2D(tex, uv).a);\n    }"]))));3===a.function&&(b.fragment.uniforms.add("colorTexture","sampler2D"),b.fragment.uniforms.add("alphaTexture","sampler2D"),b.fragment.uniforms.add("frontFaceTexture","sampler2D"),b.fragment.code.add(k.glsl(f||(f=d.__makeTemplateObject(["\n    void main() {\n      vec4 srcColor \x3d texture2D(colorTexture, uv);\n      float srcAlpha \x3d texture2D(alphaTexture, uv).r;\n      vec4 frontFace \x3d texture2D(frontFaceTexture, uv);\n\n      gl_FragColor \x3d vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), srcAlpha);\n    }"],
["\n    void main() {\n      vec4 srcColor \x3d texture2D(colorTexture, uv);\n      float srcAlpha \x3d texture2D(alphaTexture, uv).r;\n      vec4 frontFace \x3d texture2D(frontFaceTexture, uv);\n\n      gl_FragColor \x3d vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), srcAlpha);\n    }"])))));return b};var c,h,m,f})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/has ../../../../core/MapUtils ../../../../core/maybe ../../../../core/TimeProfiler ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/debugFlags ../core/renderPasses/RenderPassManager ../core/shaderLibrary/hud/HUD.glsl ./BoundingInfo ./Camera ./depthRange ./depthRangeUtils ./FxaaRenderPass ./glUtil3D ./HighlightHelper ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderPluginManager ./renderStats ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/renderers/MergedRenderer ../../../webgl/Profiling".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O,N){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,b,c,d,e,f,h,n){var r=this;this._materialRep=a;this._rctx=d;this._compositingHelper=e;this.requestRender=f;this._stage=n;this._materialRenderers=new Map;this._hasWater=this._hasOccludees=this._hasHighlights=!1;this._camera=new v.default(p.vec3f64.fromValues(0,100,-100));this._lighting=new R.SceneLighting;this._content=new Map;this._isRendering=
!1;this._fallbackDepthStencilTexture=null;this._stats=new J.RenderStatsAggregator;this._antialiasing=1;this._edgeView=null;this._handles=new l;this._OITEnabled=!1;this.renderHiddenTransparentEdges=function(){};this._shaderTechniqueRepository=c;this._fxaaPass=new x(this._rctx);this._smaaPass=new L(this._rctx);this.camera.viewport[2]=h[0];this.camera.viewport[3]=h[1];this.requestRender();this._bindParameters={slot:null,camera:null,inverseViewport:g.vec2f64.create(),shadowMappingEnabled:!1,ssaoEnabled:!1,
origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,slicePlane:null,highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting};this._offscreenRendering=new E.OffscreenRendering(this._rctx,this._compositingHelper);this._sliceHelper=new K;this._shadowMap=new I(this._rctx,c.viewingMode);this._ssaoHelper=new M(c,this._rctx,function(){return r.requestRender()});
this._highlightHelper=new A(c,this._rctx);this._renderPlugins=new H.RenderPluginManager({rctx:this._rctx,shaderTechniqueRep:c,textureRep:b,materialRep:this._materialRep,requestRender:this.requestRender});this.renderPassManager=new u.RenderPassManager(this._rctx,this._shaderTechniqueRepository);this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager);this._renderContext=new G(this._rctx,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper);
this._renderContext.ssrParams={camera:null,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrEnabled:!1};k("enable-feature:alo10771/OIT")&&(this._OITEnabled=!0);this._handles.add(m.init(t,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",function(a){r.renderHiddenTransparentEdges=a?function(){return r.renderEdges(1)}:function(){};r.requestRender()}))}a.prototype.dispose=function(){this._handles.destroy();this._fxaaPass.disable();this._smaaPass.disable();
this._materialRenderers.forEach(function(a){return a.dispose()});this._materialRenderers=null;this._edgeView=c.destroyMaybe(this._edgeView);this._offscreenRendering=c.disposeMaybe(this._offscreenRendering);this._fallbackDepthStencilTexture=c.disposeMaybe(this._fallbackDepthStencilTexture);this._shadowMap&&(this._shadowMap.enabled=!1,this._shadowMap.dispose());this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose());this._highlightHelper&&(this._highlightHelper.enabled=!1);q.tmpIndices.prune();
this._content.clear();this._content=null};Object.defineProperty(a.prototype,"updating",{get:function(){return 1===this._antialiasing&&this._smaaPass.isLoadingResources},enumerable:!1,configurable:!0});a.prototype.ensureEdgeView=function(){var a=this;null==this._edgeView&&(this._edgeView=new Q.EdgeView(this._rctx,this._shaderTechniqueRepository,{setNeedsRender:function(){return a.requestRender()}}));return this._edgeView};Object.defineProperty(a.prototype,"camera",{get:function(){return this._camera},
set:function(a){this._camera.copyFrom(a);this.requestRender()},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"edgeView",{get:function(){return this._edgeView},enumerable:!1,configurable:!0});a.prototype.setLighting=function(a){this._lighting.set(a)};a.prototype.setRenderParams=function(a){void 0!==a.ssrEnable&&(this.renderPassManager.screenSpaceReflectionsEnabled=a.ssrEnable);void 0!==a.shadowMap&&(this._shadowMap.enabled=a.shadowMap,this.renderPassManager.shadowCastingEnabled=
a.shadowMap);void 0!==a.shadowMapMaxCascades&&(this._shadowMap.maxCascades=a.shadowMapMaxCascades);this._highlightHelper.enabled=!0;void 0!==a.ssao&&(this._ssaoHelper.enabled=a.ssao);void 0!==a.ssaoAttenuation&&(this._ssaoHelper.attenuation=a.ssaoAttenuation);void 0!==a.ssaoRadius&&(this._ssaoHelper.radius=a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&(this._ssaoHelper.samples=a.ssaoSamples);
a.background&&(this._offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&(this._antialiasing=a.antialiasingEnabled?1:0);void 0!==a.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(a.defaultHighlightOptions);void 0!==a.slicePlane&&(this._sliceHelper.plane=c.unwrap(a.slicePlane));void 0!==a.waterReflectionEnabled&&(this._waterReflectionEnabled=10<=this._rctx.parameters.maxTextureImageUnits&&a.waterReflectionEnabled);this.requestRender()};Object.defineProperty(a.prototype,
"hasSlicePlane",{get:function(){return!!this._sliceHelper.plane},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"canRender",{get:function(){return 0<this._camera.fullWidth&&0<this._camera.fullHeight},enumerable:!1,configurable:!0});a.prototype.getStats=function(){return this._stats.getAggregatedStats()};a.prototype.getFramebufferTexture=function(a){switch(a){case "color":return this._offscreenRendering.colorTexture;
case "hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case "shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();case "linearDepth":return this._offscreenRendering.linearDepthTexture;case "normals":return this._offscreenRendering.normalTexture;case "highlight":return this._offscreenRendering.highlightTexture;default:return d.neverReached(a),null}};a.prototype.modify=function(a,b,c,d,f,g){var h=this;void 0===b&&(b=a?a.length:0);void 0===d&&(d=c?c.length:0);void 0===
g&&(g=f?f.length:0);this._isRendering&&console.warn("Renderer.modify called while rendering");for(var k=0;k<d;++k)this._content.delete(c[k].uniqueName);for(k=0;k<b;++k)this._content.set(a[k].uniqueName,a[k]);if(b||d||g){var m=!1;F.splitRenderGeometryChangeSetByMaterial({toAdd:a,numToAdd:b,toRemove:c,numToRemove:d,toUpdate:f,numToUpdate:g}).forEach(function(a,b){var c=h._materialRenderers.get(b);!c&&0<a.toAdd.length&&(c=new O(h._rctx,h._materialRep,b),h._materialRenderers.set(b,c));c&&(c.modify(a),
c.isEmpty&&(m=!0))});m&&this._materialRenderers.forEach(function(a,b){a.isEmpty&&(h._materialRenderers.delete(b),a.dispose())});this._hasHighlights=e.someMap(this._materialRenderers,function(a){return a.hasHighlights});this._hasOccludees=e.someMap(this._materialRenderers,function(a){return a.hasOccludees});this._hasWater=e.someMap(this._materialRenderers,function(a){return a.hasWater});this.requestRender()}};a.prototype.updateLogic=function(a){var b=!1;this._materialRenderers.forEach(function(c){c.updateLogic&&
(b=c.updateLogic(a)||b)});return b};a.prototype.render=function(a,b,c,d){var e=this;this._isRendering=!0;var f=this._offscreenRendering;f.needLastFrameColorTexture=this._waterReflectionEnabled;f.advanceCurrentRenderTarget();var g=this._sliceHelper.plane;c&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(a);b.setGLViewport(this._rctx);this._renderPlugins.prepareRender(b);this.renderShadowMap(a,b,d);this.ensureBindParameters(this._renderContext,b);this.ensureBindParametersSSR(this._renderContext);
f.initializeFrame(b);this.renderLinearDepth();this.renderNormal();this._ssaoHelper.enabled&&this._ssaoHelper.computeSSAO(b,f.linearDepthTexture,f.normalTexture);this._ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository);this._stats.reset();this._renderContext.pass=0;this._renderContext.hasOccludees=this._hasOccludees;f.bindFramebuffer();this._renderPlugins.render(0,this._renderContext);this.renderOpaqueGeometry(this._renderContext);this.renderEdges(2);this.renderHiddenTransparentEdges();
this.renderOrderIndependentTransparency();this.renderEdges(1);c=b=!1;b=this.renderHUDVisibility(this._renderContext);this.renderInternalSlot(20,this._renderContext);(c=this.renderTransparentTerrain(this._renderContext))&&b&&(f.compositeTransparentTerrainOntoHUDVisibility(),f.renderToTargets(function(){return e.renderHUD(r.HUD.TransparentRenderStyle.OCCLUDED)},f.currentColorTarget,f.tmpDepth,void 0,!0,!0));c&&f.compositeTransparentTerrainOntoMain();f.renderToTargets(function(){e.renderInternalSlot(8,
e._renderContext);e._renderPlugins.render(15,e._renderContext);e._renderPlugins.render(16,e._renderContext)},f.currentColorTarget,f.mainDepth);this._renderPlugins.needsLaserlineWithContrastControl&&f.renderAndComposite(function(){e._renderPlugins.render(17,e._renderContext)},2);this.renderOccluded();this.renderAntiAliasing(a,this._antialiasing);this._rctx.bindFramebuffer(a);this._rctx.clearSafe(256);this.renderHUD(r.HUD.TransparentRenderStyle.NOTOCCLUDED);this.renderHighlights(this._renderContext.camera,
a);this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera);this._sliceHelper.plane=g;this._isRendering=!1;if(this.onPostRender)this.onPostRender()};a.prototype.renderEdges=function(a){var b=this,c=this._edgeView;c&&c.shouldRender()&&this._offscreenRendering.renderAndComposite(function(){return c.render(b._bindParameters,a)},1)};a.prototype.renderShadowMap=function(a,b,c){var d=this._shadowMap;if(d.enabled){t.ENABLE_PROFILE_DEPTH_RANGE&&h.begin("depthRange");var e=this.computeDepthRange(b);
t.ENABLE_PROFILE_DEPTH_RANGE&&h.end("depthRange");d.prepare(b,c,e);c=d.getCascades();for(e=0;e<c.length;++e){var f=c[e];f.camera.setGLViewport(this._rctx);this.ensureCameraBindParameters(this._renderContext,f.camera);this.renderGeometryPass(3)}d.finish(a);b.setGLViewport(this._rctx)}d.bindToAllPrograms(this._shaderTechniqueRepository)};a.prototype.renderLinearDepth=function(){var a=this;this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled?this._offscreenRendering.renderToTargets(function(){return a.renderGeometryPass(1)},
this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth)};a.prototype.renderNormal=function(){var a=this;this._ssaoHelper.enabled?this._offscreenRendering.renderToTargets(function(){a.renderGeometryPass(2)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};a.prototype.computeDepthRange=
function(a){var b=z.depthRangeFromScene(a,this._content,this._stage.getLayers());w.union(b,this.renderPlugins.queryDepthRange(a));b.near=Math.max(a.near,b.near);b.far=Math.min(a.far,b.far);return b};a.prototype.renderGeometryPass=function(a){this._renderContext.pass=a;this.renderOpaqueGeometry(this._renderContext);this.renderTransparentGeometry(this._renderContext);this.renderTransparentTerrain(this._renderContext)};a.prototype.renderOpaqueGeometry=function(a){this._renderPlugins.render(1,a);this._renderPlugins.render(2,
a);this.renderInternalSlot(3,a);this._renderPlugins.render(4,a);a.ssaoHelper&&a.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository);this._renderPlugins.render(14,this._renderContext)};a.prototype.renderTransparentGeometry=function(a){this.renderInternalSlot(5,a);this._renderPlugins.render(6,a);a.ssaoHelper&&a.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository)};a.prototype.renderTransparentTerrain=function(a){return this._renderPlugins.render(7,a)};a.prototype.renderHUDVisibility=
function(a){var b=this,c=!1;a.offscreenRenderingHelper&&a.offscreenRenderingHelper.renderHUDVisibility(function(){b._bindParameters.hudVisibilityTexture=b._renderContext.offscreenRenderingHelper?b._renderContext.offscreenRenderingHelper.hudVisibilityTexture:null;c=b.renderInternalSlot(12,a)});return c};a.prototype.renderHUD=function(a){this._bindParameters.renderTransparentlyOccludedHUD=a;this.renderInternalSlot(21,this._renderContext);this.renderInternalSlot(18,this._renderContext);this.renderInternalSlot(19,
this._renderContext)};a.prototype.renderHighlights=function(a,b){var c=this,d=this._highlightHelper;if(d&&d.enabled&&(this._hasHighlights||this._renderPlugins.needsHighlight)){var e=null;d.profilingCallback&&(e=N.startMeasurement(this._renderContext.rctx));this._renderContext.highlightDepthTexture=this._bindParameters.highlightDepthTexture;var f=this._offscreenRendering.renderToTargets(function(){c.renderGeometryPass(4);c._rctx.clearSafe(256);c.renderHUD(r.HUD.TransparentRenderStyle.BOTH)},this._offscreenRendering.highlight,
this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);d.render(a,f,b);null!==e&&d.profilingCallback&&e.stop(function(a){d.profilingCallback&&d.profilingCallback(a)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};a.prototype.renderOrderIndependentTransparency=function(){var a=this;if(this._OITEnabled&&this._rctx.capabilities.textureFloat&&this._rctx.capabilities.textureFloat.textureFloat){var b=function(b){a._renderContext.transparencyPassType=b;a._offscreenRendering.renderOITPass(function(){return a.renderTransparentGeometry(a._renderContext)},
b)};b(0);b(1);b(2);this._offscreenRendering.compositeTransparentOntoOpaque();this._renderContext.transparencyPassType=3}else this.renderTransparentGeometry(this._renderContext)};a.prototype.renderOccluded=function(){var a=this,b=0;this._materialRenderers.forEach(function(a,c){c&&c.isVisible()&&8===c.renderOccluded&&(b|=c.renderOccluded,P.push(c))});var c=this._offscreenRendering,d=this._renderContext,e=function(a,d,e,f,h){void 0===e&&(e=function(){return g(d)});void 0===f&&(f=!0);void 0===h&&(h=!0);
0!==(b&d)&&(c.renderToTargets(e,c.tmpColor,c.mainDepth,[0,0,0,0],f,h),c.compositeOccludedOntoMain(a))};0!==P.length&&(this.renderInternalSlot(10,d,P),e(.2,8,function(){return a.renderInternalSlot(11,d,P)},!1,!1),P.length=0);this._materialRenderers.forEach(function(a,c){c&&c.isVisible()&&(4===c.renderOccluded||2===c.renderOccluded||32===c.renderOccluded||16===c.renderOccluded)&&(b|=c.renderOccluded,S.push(c))});var f=this._renderPlugins.renderOccludedFlags;if(b|=f){var g=function(b){d.renderOccludedMask=
b;1<f&&a._renderPlugins.render(9,d);a.renderInternalSlot(3,d,S);a.renderInternalSlot(5,d,S);a.renderInternalSlot(8,d,S);d.resetRenderOccludedMask()};d.pass=0;e(.5,4,function(){return g(4)},!0,2);e(.5,2,function(){return g(2)},!0,2);e(1,48,function(){g(16);g(32)},!0,2);S.length=0}};a.prototype.renderAntiAliasing=function(a,b){var c=this;switch(b){case 1:this._smaaPass.loadResources(function(){return c.requestRender()});this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:this._offscreenRendering.colorTexture},
a)):(this._rctx.bindFramebuffer(a),this._offscreenRendering.composite());break;case 2:this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:this._offscreenRendering.colorTexture},a)):(this._rctx.bindFramebuffer(a),this._offscreenRendering.composite());break;default:this._rctx.bindFramebuffer(a),this._offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable()}};a.prototype.ensureCameraBindParameters=function(a,b){this._renderContext.camera=b;this._bindParameters.camera=
a.camera;this._bindParameters.inverseViewport[0]=1/a.camera.fullViewport[2];this._bindParameters.inverseViewport[1]=1/a.camera.fullViewport[3]};a.prototype.ensureBindParameters=function(a,b){this.ensureCameraBindParameters(a,b);b=this._renderContext.offscreenRenderingHelper;this._bindParameters.shadowMap=a.shadowMap;this._bindParameters.shadowMappingEnabled=!!a.shadowMap&&a.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!a.ssaoHelper&&a.ssaoHelper.enabled;this._bindParameters.slicePlane=a.sliceHelper&&
a.sliceHelper.plane;this._bindParameters.hasOccludees=a.hasOccludees;this._bindParameters.linearDepthTextureID=3;this._bindParameters.lastFrameColorTextureID=4;this._bindParameters.hudVisibilityTexture=b?b.hudVisibilityTexture:null;this._bindParameters.highlightDepthTexture=b&&b.depthTexture||this.getFallbackDepthTexture()};a.prototype.ensureBindParametersSSR=function(a){this._waterReflectionEnabled?(f.mat4.translate(U,a.lastFrameCamera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:
[0,0,0]),f.mat4.translate(V,a.camera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),f.mat4.invert(V,V),f.mat4.invert(Z,a.camera.projectionMatrix),f.mat4.multiply(T,V,Z),f.mat4.multiply(T,U,T),f.mat4.multiply(T,a.lastFrameCamera.projectionMatrix,T),this._renderContext.ssrParams.camera=a.camera,this._renderContext.ssrParams.reprojectionMat=this._bindParameters.reprojectionMat=T,this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture,
this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null;this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=this._waterReflectionEnabled};a.prototype.renderInternalSlot=function(a,b,d){var e=this,f=0===b.pass?this._stats:null,g=!1;this._bindParameters.slot=a;c.isSome(d)?d.forEach(function(d){C.materialPredicate(d,
b)&&(d=e._materialRenderers.get(d),c.isSome(d)&&(g=d.render(a,b,e._bindParameters)||g))}):this._materialRenderers.forEach(function(c,d){C.materialPredicate(d,b)&&(d=f?f.getMaterialRenderStatsObject(c.type):null,g=c.render(a,b,e._bindParameters,d)||g)});return g};a.prototype.getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=B.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};a.prototype.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?
this._offscreenRendering.getGpuMemoryUsage():0,highlights:this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{antialiasing:this._antialiasing,offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,materialRenderers:this._materialRenderers,
OITEnabled:this._OITEnabled,setOITEnabled:function(b){return a._OITEnabled=b}}},enumerable:!1,configurable:!0});return a}();a.default=n;var S=[],P=[],U=b.mat4f64.create(),Z=b.mat4f64.create(),V=b.mat4f64.create(),T=b.mat4f64.create()})},"esri/core/TimeProfiler":function(){define(["require","exports"],function(n,a){n=function(){function a(a,d){void 0===d&&(d=.9);this._alpha=.9;this._max=this._min=this._smooth=this._sum=this._count=this._startTime=0;this._name=a;this._alpha=d;this.reset()}a.prototype.reset=
function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};Object.defineProperty(a.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"average",{get:function(){return 0<this._count?this._sum/this._count:0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"smooth",{get:function(){return this._smooth},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0});a.prototype.begin=function(){this._startTime=performance.now()};a.prototype.end=function(){var a=performance.now()-this._startTime;this._count+=1;this._sum+=a;this._smooth=this._alpha*a+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,a);this._max=
Math.max(this._max,a)};a.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};return a}();(function(a){function d(c){c in e||(e[c]=new a(c));return e[c]}function k(a){console.log(d(a).toJSON())}var e={},c={};a.get=d;a.begin=function(a){d(a).begin()};a.end=function(a,e){void 0===e&&(e=!0);d(a).end();var f=performance.now();!e||a in c&&!(f>=c[a]+1E3)||(k(a),c[a]=f)};a.log=k;a.logAll=function(){for(var a in e)k(a)}})(n||
(n={}));return n})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("require exports ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../support/geometryUtils ./AllRenderPasses ./RenderPass ../util/TwoVectorPosition ../../lib/depthRange".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){Object.defineProperty(a,"__esModule",{value:!0});a.RenderPassManager=void 0;n=function(){function a(a,b){this.rctx=a;this.shaderTechniqueRepository=b;this.canRender=!0;this._materialPassParams=new g.MaterialPassesParameters;this._shadowPassParams=new g.ShadowMapPassParameters;this._highlightPassParams=new g.HighlightPassParameters;this._systems=new Set;this._passes=[];this._shadowMapPass=this._registerPass(new p.RenderPass(a,this.shaderTechniqueRepository));
this.passes={materialOpaque:this._registerPass(new p.RenderPass(a,this.shaderTechniqueRepository)),materialTransparent:this._registerPass(new p.RenderPass(a,this.shaderTechniqueRepository,1)),materialIntegratedMesh:this._registerPass(new p.RenderPass(a,this.shaderTechniqueRepository)),shadowMap:this._shadowMapPass,highlight:this._registerPass(new p.RenderPass(a,this.shaderTechniqueRepository)),highlightIntegratedMesh:this._registerPass(new p.RenderPass(a,this.shaderTechniqueRepository))}}a.prototype.register=
function(a){this._systems.add(a)};a.prototype.prepareRender=function(a){var b=this;this._passes.forEach(function(a){return a.prepareSubmit()});this._systems.forEach(function(c){c.submit(b.passes,{camera:a})});this._passes.forEach(function(a){return a.finishSubmit()});this.shaderTechniqueRepository.frameUpdate()};a.prototype.render=function(a){if(4===a.slot)switch(this._configure(a),a.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(a);this.passes.materialOpaque.dispatch(this._materialPassParams);
break;case 1:this._materialPassParams.subPass=1;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 4:this.passes.highlight.dispatch(this._highlightPassParams);break;case 3:this._shadowMapPass.dispatch(this._shadowPassParams)}if(6===a.slot)switch(this._configure(a),a.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(a);this.passes.materialTransparent.dispatch(this._materialPassParams);
break;case 1:this._materialPassParams.subPass=1;this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2,this.passes.materialTransparent.dispatch(this._materialPassParams)}if(1===a.slot)switch(this._configure(a),a.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(a);this._materialPassParams.ssrParams=a.ssrParams;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=
1;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 4:this.passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}return!0};a.prototype.notifyDirty=function(){this.initContext.requestRender()};a.prototype.slots=function(){return[4,6,1]};a.prototype.initializeRenderContext=function(a){this.initContext=a};a.prototype.uninitializeRenderContext=
function(){};a.prototype.queryDepthRange=function(a){var b={near:Infinity,far:-Infinity};this._systems.forEach(function(c){c=c.queryShadowCasterDepthRange(a);d.isSome(c)&&u.union(b,c,b)});return b};Object.defineProperty(a.prototype,"shadowCastingEnabled",{get:function(){return d.isSome(this.passes.shadowMap)},set:function(a){a?(this._materialPassParams.shadowsEnabled=!0,this.passes.shadowMap=this._shadowMapPass):(this._materialPassParams.shadowsEnabled=!1,this.passes.shadowMap=null)},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"screenSpaceReflectionsEnabled",{get:function(){return d.isSome(this._materialPassParams.ssrParams.ssrEnabled)},set:function(a){this._materialPassParams.ssrParams.ssrEnabled=a?!0:!1},enumerable:!1,configurable:!0});a.prototype._configureMaterialColorPass=function(a){var b=this;this._materialPassParams.shadowMap={bind:function(c,d){a.shadowMap.bind(c,d);d=b._materialPassParams.viewTransform;h.vec3.add(r,d.worldFromView_TL,d.worldFromView_TH);a.shadowMap.bindView(c,
r)}};this._materialPassParams.ambientOcclusion={bind:function(b,c){a.ssaoHelper.setUniforms(b,c)}};this._materialPassParams.ambientOcclusionEnabled=a.ssaoHelper.enabled;this._materialPassParams.sceneHasOcludees=a.hasOccludees};a.prototype._configure=function(a){this._updateParameters(a,3===a.pass?this._shadowPassParams:4===a.pass?this._highlightPassParams:this._materialPassParams)};a.prototype._updateParameters=function(a,d){var g=a.camera,k=g.viewInverseTransposeMatrix;h.vec3.set(r,k[3],k[7],k[11]);
v.set(r);h.vec3.copy(d.viewTransform.worldFromView_TH,v.high);h.vec3.copy(d.viewTransform.worldFromView_TL,v.low);l.mat3.fromMat4(d.viewTransform.viewFromCameraRelative_RS,g.viewMatrix);e.mat4.copy(d.viewTransform.projFromView,g.projectionMatrix);0===d.identifier?(this._materialPassParams.transparent=6===a.slot,this._materialPassParams.integratedMesh=1===a.slot,this._materialPassParams.lighting=a.scenelightingData,l.mat3.transpose(q,d.viewTransform.viewFromCameraRelative_RS),l.mat3.invert(d.transformNormal_ViewFromGlobal,
q),c.vec2.set(d.cameraNearFar,g.near,g.far)):1===d.identifier?c.vec2.set(d.cameraNearFar,g.near,g.far):2===d.identifier&&(d.highlightDepthTexture=a.highlightDepthTexture,f.vec4.copy(d.viewport,g.fullViewport),d.inverseViewport[0]=1/g.fullViewport[2],d.inverseViewport[1]=1/g.fullViewport[3]);b.boundedPlane.copy(a.sliceHelper.plane,d.slicePlane);h.vec3.subtract(d.slicePlane.origin,d.slicePlane.origin,r);d.slicePlaneEnabled=a.sliceHelper.isEnabled;this._materialPassParams.transparencyPassType=a.transparencyPassType};
a.prototype._registerPass=function(a){this._passes.push(a);return a};Object.defineProperty(a.prototype,"needsHighlight",{get:function(){return 0<this.passes.highlight.count||0<this.passes.highlightIntegratedMesh.count},enumerable:!1,configurable:!0});return a}();a.RenderPassManager=n;var r=m.vec3f64.create(),q=k.mat3f64.create(),v=new t.TwoVectorPosition})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../support/geometryUtils ../shaderLibrary/attributes/VertexPosition.glsl".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.HighlightPassParameters=a.ShadowMapPassParameters=a.MaterialPassesParameters=void 0;n=function(){return function(){this.identifier=0;this.integratedMesh=this.transparent=!1;this.viewTransform=new c.VertexPosition.ViewProjectionTransform;this.transformNormal_ViewFromGlobal=d.mat3f64.create();this.cameraNearFar=l.vec2f64.create();this.slicePlane=e.boundedPlane.create();this.shadowsEnabled=this.ambientOcclusionEnabled=this.slicePlaneEnabled=
!0;this.sceneHasOcludees=!1;this.transparencyPassType=3}}();a.MaterialPassesParameters=n;n=function(){return function(){this.identifier=1;this.viewTransform=new c.VertexPosition.ViewProjectionTransform;this.cameraNearFar=l.vec2f64.create();this.slicePlane=e.boundedPlane.create()}}();a.ShadowMapPassParameters=n;n=function(){return function(){this.identifier=2;this.viewTransform=new c.VertexPosition.ViewProjectionTransform;this.slicePlane=e.boundedPlane.create();this.inverseViewport=l.vec2f64.create();
this.viewport=k.vec4f64.create()}}();a.HighlightPassParameters=n})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["require","exports","../../../../../core/PooledArray"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.RenderPass=void 0;n=function(){function a(a,c,h){void 0===h&&(h=0);this._rctx=a;this._techniqueRepository=c;this._sorting=h;this._draws=new d({initialSize:32,allocator:function(a){return a||{material:null,geometry:null,geometryRanges:null,
bindDrawParams:null,depthSquaredHint:0,indexType:0}}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}a.prototype.submitDraw=function(a,c,d,k,f){var b=this._draws.pushNew();b.geometry=c;b.geometryRanges=d;b.material=a;b.bindDrawParams=k;b.depthSquaredHint=f;b.indexType=c.indexed?c.vao.indexBuffer.indexType:0};a.prototype.dispatch=function(a){var c=this._rctx;this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();
for(var d=null,e={repository:this._techniqueRepository},f=this._draws.length,b=0;b<f;b++){var g=this._draws.data[b],k=g.geometry,n=g.material.getTechnique(e,a,k.parameters);this._passBoundTechniques.has(n)||(n.bindPass(c,a),this._passBoundTechniques.add(n));c.bindVAO(k.vao);if(n!==d||3!==n.configuration.transparencyPassType)c.bindProgram(n.program),c.setPipelineState(n.pipeline),d=n;this._previouslyBoundMaterials.get(n)!==g.material&&(n.bindMaterial(c,g.material,a),this._previouslyBoundMaterials.set(n,
g.material));this._previouslyBoundDraw.get(n)!==g.bindDrawParams&&(n.bindDraw(g.bindDrawParams,g.material,a),this._previouslyBoundMaterials.set(n,g.material));if(0!==g.indexType)for(var n=l.get(g.indexType),u=0;u<g.geometryRanges.length;u+=2){var r=g.geometryRanges[u],q=g.geometryRanges[u+1];c.drawElements(k.primitiveType,q,g.indexType,r*n)}else for(u=0;u<g.geometryRanges.length;u+=2)r=g.geometryRanges[u],q=g.geometryRanges[u+1],c.drawArrays(k.primitiveType,r,q)}};a.prototype.prepareSubmit=function(){this._draws.clear()};
a.prototype.finishSubmit=function(){var a=0===this._sorting?1:-1;this._draws.sort(function(c,d){var e=a*(c.depthSquaredHint-d.depthSquaredHint);return 0!==e?e:c.geometry.vao.size-d.geometry.vao.size})};Object.defineProperty(a.prototype,"count",{get:function(){return this._draws.length},enumerable:!1,configurable:!0});return a}();a.RenderPass=n;var l=new Map;l.set(5121,1);l.set(5123,2);l.set(5125,4)})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ./depthRange ./Util".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p){function t(a,b){if(b.isVisible){var c=g.empty(),d=b.getObjects();b.getSpatialQueryAccelerator()?u(c,a,b.getSpatialQueryAccelerator()):r(c,a,d);return c}}function u(a,b,c){var d=b.eye,e=b.viewForward,f=b.frustum,h=function(a){return a.isVisible},k=c.objectCount;500>k?(g.set(C,b.near,Math.min(a.near,b.far)),c.forEachInDepthRange(d,e,"front-to-back",C,function(c,d){q(a,b,c);C.far=a.near;d.setRange(C)},f,h),g.set(C,Math.max(a.far,b.near),b.far),c.forEachInDepthRange(d,
e,"back-to-front",C,function(c,d){q(a,b,c);C.near=a.far;d.setRange(C)},f,h)):(k=Math.max(Math.min(k,500),Math.ceil(.1*k)),d=c.findClosest(e,"front-to-back",f,h,k),c=c.findClosest(e,"back-to-front",f,h,k),d&&c&&(w(a,b,d.getCenter(),d.getBSRadius()),w(a,b,c.getCenter(),c.getBSRadius())))}function r(a,b,c){E.clear();c.forEach(function(a){a.isVisible&&E.add(a)});E.empty||(E.sort(b),g.set(C,b.near,Math.min(a.near,b.far)),E.forEachInDepthRange(C,"front-to-back",function(c,d){d<a.near&&q(a,b,c)}),g.set(C,
Math.max(a.far,b.near),b.far),E.forEachInDepthRange(C,"back-to-front",function(b,c,d){a.far=Math.max(a.far,d)}))}function q(a,c,d){if(d.isVisible&&f.frustum.intersectsSphere(c.frustum.planes,f.sphere.wrap(d.getBSRadius(),d.getCenter()))){var e=d.objectTransformation,g=A;d.geometryRecords.forEach(function(d){l.mat4.multiply(g,e,d.getShaderTransformation());var f=b.maxScale(g);v(a,c,d.geometry.boundingInfo,g,f)})}}function v(a,b,c,d,g){var h=b.eye,k=b.viewForward;e.vec3.transformMat4(B,c.center,d);
h=k[0]*(B[0]-h[0])+k[1]*(B[1]-h[1])+k[2]*(B[2]-h[2]);k=c.bsRadius*g;if(!(h-k>a.near&&h+k<a.far)&&f.frustum.intersectsSphere(b.frustum.planes,f.sphere.wrap(k,B)))if(100<c.bsRadius&&c.getChildren())for(c=c.getChildren(),h=0;8>h;++h)c[h]&&v(a,b,c[h],d,g);else F.unionDepthRangeWithAABB(a,b.viewProjectionMatrix,d,c.bbMin,c.bbMax)}function w(a,b,c,d){var e=b.eye;b=b.viewForward;c=(c[0]-e[0])*b[0]+(c[1]-e[1])*b[1]+(c[2]-e[2])*b[2];a.near=Math.min(a.near,c-d);a.far=Math.max(a.far,c+d)}Object.defineProperty(a,
"__esModule",{value:!0});a.DepthRangeFromRenderGeometries=a.depthRangeFromLayer=a.depthRangeFromScene=void 0;a.depthRangeFromScene=function(a,b,c){if(1E4>b.size)return G.compute(a,b);var d=g.empty();c.forEach(function(b){b.isVisible&&g.union(d,t(a,b))});return d};a.depthRangeFromLayer=t;n=function(){function a(){this._items=new d({allocator:function(a){return a||{obj:null,distance:0,near:0,far:0}},deallocator:function(a){a.obj=null;a.distance=0;a.near=0;a.far=0;return a}})}Object.defineProperty(a.prototype,
"length",{get:function(){return this._items.length},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0});a.prototype.clear=function(){this._items.clear()};a.prototype.add=function(a){this._items.pushNew().obj=a};a.prototype.sort=function(a){var b=a.eye,c=a.viewForward;this._items.forEachSimple(function(a){var d=a.obj,e=d.getCenter(),d=d.getBSRadius(),e=(e[0]-b[0])*c[0]+(e[1]-b[1])*c[1]+(e[2]-b[2])*
c[2];a.distance=e;a.near=e-d;a.far=e+d});this._items.sort(function(a,b){return a.distance-b.distance})};a.prototype.forEachInDepthRange=function(a,b,c){if("front-to-back"===b)for(b=0;b<this._items.length;++b){var d=this._items.data[b];d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)}else for(b=this._items.length-1;0<=b;--b)d=this._items.data[b],d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)};return a}();var z=function(){function a(){this.view=k.mat4f64.create();this.viewProj=k.mat4f64.create();
this.frustum=f.frustum.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}a.prototype.compute=function(a,b){var c=this;this.reset();l.mat4.copy(this.view,a.viewMatrix);l.mat4.multiply(this.viewProj,a.projectionMatrix,this.view);f.frustum.copy(a.frustum,this.frustum);a=this.view;var d=a[2],e=a[6],g=a[10],h=a[14];a=this.range;var k=0;b.forEach(function(a){if(a.instanceParameters.visible&&a.castShadow){var b,
f;a.hasShaderTransformation?(b=a.getBoundingSphere(a.getShaderTransformation(),1,B),f=B):(b=a.bsRadius,f=a.center);f=d*f[0]+e*f[1]+g*f[2]+h;c.geometries[k]=a;c.near[k]=-(f+b);c.far[k]=-(f-b);++k}});if(0===this.geometries.length)return a;for(b=0;b<this.geometries.length;++b)this.near[b]>a.far&&(a.far=this.near[b]),2<this.near[b]&&this.far[b]<a.near&&(a.near=this.far[b]);var m=this.looseRange;m.near=Math.max(.5*a.near,2);m.far=2*a.far;var p=0,n=0;for(b=0;b<this.geometries.length;++b)this.near[b]<a.near&&
(this.near[b]>=m.near?a.near=this.near[b]:this.nearCandidates[p++]=b),this.far[b]>a.far&&(this.far[b]<=m.far?a.far=this.far[b]:this.farCandidates[n++]=b);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return a;this.nearCandidates.sort(function(a,b){return c.near[a]<c.near[b]?-1:c.near[a]>c.near[b]?1:0});this.farCandidates.sort(function(a,b){return c.far[a]<c.far[b]?1:c.far[a]>c.far[b]?-1:0});for(b=0;b<this.nearCandidates.length;++b)m=this.nearCandidates[b],this.near[m]<a.near&&(m=
this.geometries[m],p=m.boundingInfo,this.includeNearBoundingInfoRec(p,m.getShaderTransformation()));for(b=0;b<this.farCandidates.length;++b)m=this.farCandidates[b],this.far[m]>a.far&&(m=this.geometries[m],p=m.boundingInfo,this.includeFarBoundingInfoRec(p,m.getShaderTransformation()));return a};a.prototype.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};
a.prototype.includeNearBoundingInfoRec=function(a,c){var d=a.getBSRadius(),f=a.getCenter();e.vec3.transformMat4(B,f,c);var g=b.maxScale(c),f=B[0],h=B[1],k=B[2],d=d*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*h+g[0][2]*k+g[0][3]>d||g[1][0]*f+g[1][1]*h+g[1][2]*k+g[1][3]>d||g[2][0]*f+g[2][1]*h+g[2][2]*k+g[2][3]>d||g[3][0]*f+g[3][1]*h+g[3][2]*k+g[3][3]>d||(f=this.view[2]*f+this.view[6]*h+this.view[10]*k+this.view[14],h=f+d,2>-(f-d)||-h>=this.range.near)))if(-h>this.looseRange.near)this.range.near=
-h;else{if(100<d&&(d=a.getChildren(),void 0!==d)){for(a=0;8>a;++a)void 0!==d[a]&&this.includeNearBoundingInfoRec(d[a],c);return}F.unionDepthRangeWithAABB(this.range,this.viewProj,c,a.getBBMin(),a.getBBMax())}};a.prototype.includeFarBoundingInfoRec=function(a,c){var d=a.getBSRadius(),f=a.getCenter();e.vec3.transformMat4(B,f,c);var g=b.maxScale(c),f=B[0],h=B[1],k=B[2],d=d*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*h+g[0][2]*k+g[0][3]>d||g[1][0]*f+g[1][1]*h+g[1][2]*k+g[1][3]>d||g[2][0]*f+g[2][1]*
h+g[2][2]*k+g[2][3]>d||g[3][0]*f+g[3][1]*h+g[3][2]*k+g[3][3]>d||(f=this.view[2]*f+this.view[6]*h+this.view[10]*k+this.view[14]-d,-f<=this.range.far)))if(-f<this.looseRange.far)this.range.far=-f;else{if(100<d&&(d=a.getChildren(),void 0!==d)){for(a=0;8>a;++a)void 0!==d[a]&&this.includeFarBoundingInfoRec(d[a],c);return}F.unionDepthRangeWithAABB(this.range,this.viewProj,c,a.getBBMin(),a.getBBMax())}};return a}();a.DepthRangeFromRenderGeometries=z;a=function(){function a(){this.modelViewProj=k.mat4f64.create();
this.clipPosition=[m.vec4f64.create(),m.vec4f64.create(),m.vec4f64.create(),m.vec4f64.create(),m.vec4f64.create(),m.vec4f64.create(),m.vec4f64.create(),m.vec4f64.create()]}a.prototype.unionDepthRangeWithAABB=function(a,b,c,d,e){var f=this.modelViewProj;l.mat4.multiply(f,b,c);b=!1;for(c=0;8>c;++c){var g=this.clipPosition[c],h=0===c||3===c||4===c||7===c?d[0]:e[0],k=0===c||1===c||4===c||5===c?d[1]:e[1],m=4>c?d[2]:e[2];g[0]=f[0]*h+f[4]*k+f[8]*m+f[12];g[1]=f[1]*h+f[5]*k+f[9]*m+f[13];g[2]=f[2]*h+f[6]*k+
f[10]*m+f[14];g[3]=f[3]*h+f[7]*k+f[11]*m+f[15]}for(c=0;12>c;++c){d=this.clipTriangle(this.clipPosition[x[c][0]],this.clipPosition[x[c][1]],this.clipPosition[x[c][2]]);e=!0;for(f=0;f<d.length;++f)if(g=d[f][3],2<=g){e=!1;break}if(!e)for(b=!0,f=0;f<d.length;++f)g=d[f][3],g<a.near&&(a.near=g),g>a.far&&(a.far=g)}return b};a.prototype.inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];p.assert(!1)};a.prototype.intersect=function(a,
b,c){var d=0;0===c?d=(-a[3]-a[0])/(b[0]-a[0]+b[3]-a[3]):1===c?d=(-a[3]-a[1])/(b[1]-a[1]+b[3]-a[3]):2===c?d=(a[3]-a[0])/(b[0]-a[0]-b[3]+a[3]):3===c&&(d=(a[3]-a[1])/(b[1]-a[1]-b[3]+a[3]));return h.vec4.lerp(m.vec4f64.create(),a,b,d)};a.prototype.clipTriangle=function(a,b,c){a=[a,b,c];for(b=0;4>b;++b){c=a;a=[];for(var d=0;d<c.length;++d){var e=c[d],f=c[(d+1)%c.length];this.inside(f,b)?(this.inside(e,b)||a.push(this.intersect(e,f,b)),a.push(f)):this.inside(e,b)&&a.push(this.intersect(e,f,b))}}return a};
return a}();var x=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],B=c.vec3f64.create(),A=k.mat4f64.create(),C=g.empty(),E=new n,G=new z,F=new a})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define("require exports ../../../../core/maybe ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/VertexArrayObject".split(" "),function(n,a,d,l,k,e,c,h){return function(){function a(a){this.isEnabled=
!1;this.vertexAttributeLocations={position:0};this.rctx=a}a.prototype.enable=function(){if(this.isEnabled)return!0;var a=this.rctx;this.program=new e(a,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);this.pipelineState=c.makePipelineState({colorWrite:c.defaultColorWriteParams});var b=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new h(a,this.vertexAttributeLocations,{geometry:l.Pos2},{geometry:new k(a,34962,35044,b)});return this.isEnabled=!0};a.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};a.prototype.render=function(a,b){this.enable();var c=this.rctx;c.bindVAO(this.vao);
c.bindFramebuffer(b);var e=0,f=0;d.isSome(b)?(e=b.descriptor.width,f=b.descriptor.height):(e=c.gl.canvas.width,f=c.gl.canvas.height);c.bindProgram(this.program);c.setPipelineState(this.pipelineState);c.bindTexture(a.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/e,1/f);c.drawArrays(4,0,3)};return a}()})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f32 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/HighlightTechnique ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){return function(){function a(a,c){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=c;this.viewportToRestore=k.vec4f64.create();this.defaultOptions={color:l.vec4f32.fromValues(1,0,1,1),haloColor:l.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};c=new b.HighlightCompositionTechniqueConfiguration;
c.highlightStage=0;c.gridOptimization=!1;this.blurTechnique=a.acquireAndReleaseExisting(b.HighlightCompositionTechnique,c,this.blurTechnique);c.highlightStage=0;c.gridOptimization=!0;this.blurGridTechnique=a.acquireAndReleaseExisting(b.HighlightCompositionTechnique,c,this.blurGridTechnique);c.highlightStage=1;c.gridOptimization=!1;this.applyTechnique=a.acquireAndReleaseExisting(b.HighlightCompositionTechnique,c,this.applyTechnique);c.highlightStage=1;c.gridOptimization=!0;this.applyGridTechnique=
a.acquireAndReleaseExisting(b.HighlightCompositionTechnique,c,this.applyGridTechnique);c.highlightStage=2;c.gridOptimization=!1;this.downsampleTechnique=a.acquireAndReleaseExisting(b.HighlightCompositionTechnique,c,this.downsampleTechnique)}Object.defineProperty(a.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(a){a?this.enable():this.disable()},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"profilingCallback",{get:function(){return e.HIGHLIGHTS_PROFILE_TO_CONSOLE?
function(a){return console.log(a)}:null},enumerable:!1,configurable:!0});a.prototype.setDefaultOptions=function(a){this.defaultOptions=a};a.prototype.render=function(a,b,c){var g=a.pixelRatio,h=!e.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,k=this._rctx;f.assert(this.enabled);d.vec4.copy(this.viewportToRestore,a.fullViewport);var m=Math.ceil(a.fullWidth/g),g=Math.ceil(a.fullHeight/g);this.blur0Fbo.resize(m,g);this.blur1Fbo.resize(m,g);k.bindVAO(this.quadVAO);var l=a=null;h&&(this._gridUpdateResources(b,
32),this._gridComputeMipmap());h?(a=this._grid.vao,l=this.blurGridTechnique,k.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,1),l.program.setUniform1i("coverageTex",1)):(a=this.quadVAO,l=this.blurTechnique);l.bindPipelineState(k);k.bindProgram(l.program);k.bindVAO(a);k.bindFramebuffer(this.blur0Fbo);k.setViewport(0,0,m,g);k.setClearColor(0,0,0,0);k.clear(16384);l.program.setUniform1i("tex",0);k.bindTexture(b.colorTexture,0);l.program.setUniform2f("blurSize",1/m,0);k.drawArrays(l.primitiveType,
0,t.vertexCount(a,"geometry"));k.bindFramebuffer(this.blur1Fbo);k.clear(16384);k.bindTexture(this.blur0Fbo.colorTexture,0);l.program.setUniform2f("blurSize",0,1/g);k.drawArrays(l.primitiveType,0,t.vertexCount(a,"geometry"));m=h?this.applyGridTechnique:this.applyTechnique;k.bindFramebuffer(c);m.bindPipelineState(k);k.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);k.bindProgram(m.program);k.bindTexture(this.blur1Fbo.colorTexture,
0);k.bindTexture(b.colorTexture,1);h&&k.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2);m.bindApplyPass(this.defaultOptions);k.drawArrays(m.primitiveType,0,t.vertexCount(a,"geometry"));k.bindVAO(null)};a.prototype.enable=function(){if(!this.enabled){this.quadVAO=m.createQuadVAO(this._rctx);var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=new p(this._rctx,
a,b);this.blur1Fbo=new p(this._rctx,a,b)}};a.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};a.prototype._gridUpdateResources=function(a,b){var d=this._rctx,e=this._grid,f=!1;null===e.coverageMipmap&&(e.coverageMipmap=[a],f=!0);if(e.viewportWidth!==a.width||e.viewportHeight!==a.height)f=!0,e.viewportWidth=a.width,e.viewportHeight=a.height;e.coverageMipmap[0]=a;e.cellPixelSize!==b&&
(e.cellPixelSize=b,f=!0);if(f){for(b=1;b<e.coverageMipmap.length;b++)e.coverageMipmap[b].dispose();e.mipmapLevels=Math.ceil(Math.log(e.cellPixelSize)*Math.LOG2E);e.coverageMipmap.length=e.mipmapLevels+1;for(b=0;b<e.mipmapLevels;b++)f=e.coverageMipmap[b],f=new p(d,{colorTarget:0,depthStencilTarget:0,width:Math.ceil(f.width/2),height:Math.ceil(f.height/2)},{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(f.width/2),height:Math.ceil(f.height/2)}),e.coverageMipmap[b+
1]=f}var f=Math.ceil(a.height/e.cellPixelSize),k=Math.ceil(a.width/e.cellPixelSize);if(!e.vao||e.verticalCellCount!==f||e.horizontalCellCount!==k){e.verticalCellCount=f;e.horizontalCellCount=k;a=f+1;b=k+1;for(var f=1/f,k=1/k,m=new Float32Array(24*a*b),l=0,n=0;n<a;n++)for(var r=0;r<b;r++)m[l+0]=(r-.5)*k*2-1,m[l+1]=(n-.5)*f*2-1,m[l+2]=r*k,m[l+3]=n*f,m[l+4]=(r+.5)*k*2-1,m[l+5]=(n-.5)*f*2-1,m[l+6]=r*k,m[l+7]=n*f,m[l+8]=(r-.5)*k*2-1,m[l+9]=(n+.5)*f*2-1,m[l+10]=r*k,m[l+11]=n*f,m[l+12]=(r-.5)*k*2-1,m[l+
13]=(n+.5)*f*2-1,m[l+14]=r*k,m[l+15]=n*f,m[l+16]=(r+.5)*k*2-1,m[l+17]=(n-.5)*f*2-1,m[l+18]=r*k,m[l+19]=n*f,m[l+20]=(r+.5)*k*2-1,m[l+21]=(n+.5)*f*2-1,m[l+22]=r*k,m[l+23]=n*f,l+=24;e.vao&&e.vao.dispose(!0);e.vao=new u(d,c.Default3D,{geometry:h.Pos2Tex},{geometry:g.createVertex(d,35044,m)})}};a.prototype._gridComputeMipmap=function(){var a=this._rctx,b=this._grid,c=this.downsampleTechnique.program;this.downsampleTechnique.bindPipelineState(a);a.bindVAO(this.quadVAO);for(var d=0;d<b.mipmapLevels;d++){a.bindFramebuffer(b.coverageMipmap[d+
1]);a.bindTexture(b.coverageMipmap[d].colorTexture,0);var e=b.coverageMipmap[d+1].width,f=b.coverageMipmap[d+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/e,1/f);a.setViewport(0,0,e,f);a.drawArrays(5,0,t.vertexCount(this.quadVAO,"geometry"))}};a.prototype.getGpuMemoryUsage=function(){var a=t.getGpuMemoryUsage(this.blur0Fbo)+t.getGpuMemoryUsage(this.blur1Fbo);if(this._grid&&this._grid.coverageMipmap)for(var b=0,c=this._grid.coverageMipmap;b<c.length;b++)a+=
t.getGpuMemoryUsage(c[b]);return a};Object.defineProperty(a.prototype,"test",{get:function(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}},enumerable:!1,configurable:!0});return a}()})},"esri/views/3d/webgl-engine/shaders/HighlightTechnique":function(){define("require exports tslib ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./HighlightComposition.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.HighlightCompositionTechniqueConfiguration=a.HighlightCompositionTechnique=void 0;k=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}d.__extends(e,a);e.prototype.initializeProgram=function(a){var b=e.shader.get().build(this.configuration);return new m(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),c.Default3D)};e.prototype.bindApplyPass=function(a){this.program.setUniform1i("tex",
0);this.program.setUniform1i("origin",1);this.configuration.gridOptimization&&this.program.setUniform1i("coverageTex",2);this.program.setUniform4fv("color",a.color);this.program.setUniform4fv("haloColor",a.haloColor);this.program.setUniform1f("outlineSize",8.6);this.program.setUniform1f("blurSize",.4);this.program.setUniform4f("opacities",a.haloOpacity,a.haloOpacityOccluded,a.fillOpacity,a.fillOpacityOccluded)};e.prototype.initializePipeline=function(){return 1===this.configuration.highlightStage?
b.makePipelineState({blending:f.separateBlendingParams(770,1,771,771),colorWrite:b.defaultColorWriteParams}):b.makePipelineState({colorWrite:b.defaultColorWriteParams})};Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this.configuration.gridOptimization?4:5},enumerable:!1,configurable:!0});e.shader=new l.ReloadableShaderModule(h,function(){return new Promise(function(a,b){n(["./HighlightComposition.glsl"],a,b)})});return e}(k.ShaderTechnique);a.HighlightCompositionTechnique=
k;k=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.highlightStage=0;b.gridOptimization=!1;return b}d.__extends(b,a);d.__decorate([e.parameter({count:3})],b.prototype,"highlightStage",void 0);d.__decorate([e.parameter()],b.prototype,"gridOptimization",void 0);return b}(e.ShaderTechniqueConfiguration);a.HighlightCompositionTechniqueConfiguration=k})},"esri/views/3d/webgl-engine/shaders/HighlightComposition.glsl":function(){define(["require","exports","tslib","../core/shaderModules/interfaces",
"../core/shaderModules/ShaderBuilder"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var n=new k.ShaderBuilder,q=n.vertex.code,z=n.fragment.code;n.attributes.add("position","vec2");2===a.highlightStage&&(q.add(l.glsl(e||(e=d.__makeTemplateObject(["\n    void main() {\n      gl_Position \x3d vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);\n    }"],["\n    void main() {\n      gl_Position \x3d vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);\n    }"])))),
n.fragment.uniforms.add("tex","sampler2D"),n.fragment.uniforms.add("invFramebufferDim","vec2"),z.add(l.glsl(c||(c=d.__makeTemplateObject(["\n      void main() {\n        vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\n        vec4 value \x3d texture2D(tex, coord);\n        float mx \x3d floor(max(value.g, value.b));\n        gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\n      }"],["\n      void main() {\n        vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\n        vec4 value \x3d texture2D(tex, coord);\n        float mx \x3d floor(max(value.g, value.b));\n        gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\n      }"])))));
0===a.highlightStage&&(n.attributes.add("uv0","vec2"),a.gridOptimization?(n.vertex.uniforms.add("coverageTex","sampler2D"),n.fragment.uniforms.add("blurSize","vec2"),n.varyings.add("blurCoordinate","vec3")):(n.vertex.uniforms.add("blurSize","vec2"),n.varyings.add("blurCoordinates[5]","vec2")),q.add(l.glsl(f||(f=d.__makeTemplateObject(["\n    void main() {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      ","\n    }"],["\n    void main() {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      ",
"\n    }"])),a.gridOptimization?l.glsl(h||(h=d.__makeTemplateObject(["\n      vec4 cov \x3d texture2D(coverageTex, uv0);\n      if (cov.r \x3d\x3d 0.0) {\n        gl_Position \x3d vec4(0.0);\n      }\n      blurCoordinate \x3d vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));\n      "],["\n      vec4 cov \x3d texture2D(coverageTex, uv0);\n      if (cov.r \x3d\x3d 0.0) {\n        gl_Position \x3d vec4(0.0);\n      }\n      blurCoordinate \x3d vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));\n      "]))):
l.glsl(m||(m=d.__makeTemplateObject(["\n      vec2 uv \x3d position.xy * 0.5 + vec2(0.5);\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n          "],["\n      vec2 uv \x3d position.xy * 0.5 + vec2(0.5);\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n          "]))))),
n.fragment.uniforms.add("tex","sampler2D"),z.add(l.glsl(p||(p=d.__makeTemplateObject(["\n    void main() {\n      ","\n    }"],["\n    void main() {\n      ","\n    }"])),a.gridOptimization?l.glsl(b||(b=d.__makeTemplateObject(["\n          vec2 uv \x3d blurCoordinate.xy;\n          vec4 center \x3d texture2D(tex, uv);\n\n          // do not blur if no pixel or all pixels in neighborhood are set\n          if (blurCoordinate.z \x3d\x3d 1.0) {\n            gl_FragColor \x3d center;\n          } else {\n            vec4 sum \x3d vec4(0.0);\n            sum +\x3d center * 0.204164;\n            sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n            sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n            gl_FragColor \x3d sum;\n          }"],
["\n          vec2 uv \x3d blurCoordinate.xy;\n          vec4 center \x3d texture2D(tex, uv);\n\n          // do not blur if no pixel or all pixels in neighborhood are set\n          if (blurCoordinate.z \x3d\x3d 1.0) {\n            gl_FragColor \x3d center;\n          } else {\n            vec4 sum \x3d vec4(0.0);\n            sum +\x3d center * 0.204164;\n            sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n            sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n            gl_FragColor \x3d sum;\n          }"]))):
l.glsl(g||(g=d.__makeTemplateObject(["\n          vec4 sum \x3d vec4(0.0);\n          sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n          sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n          sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n          gl_FragColor \x3d sum;"],["\n          vec4 sum \x3d vec4(0.0);\n          sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n          sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n          sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n          gl_FragColor \x3d sum;"]))))));
1===a.highlightStage&&(n.varyings.add("uv","vec2"),a.gridOptimization&&(n.attributes.add("uv0","vec2"),n.vertex.uniforms.add("coverageTex","sampler2D")),q.add(l.glsl(u||(u=d.__makeTemplateObject(["\n      void main() {\n        ","\n        gl_Position \x3d vec4(position, 0.0, 1.0);\n        uv \x3d position.xy * 0.5 + vec2(0.5);\n      }"],["\n      void main() {\n        ","\n        gl_Position \x3d vec4(position, 0.0, 1.0);\n        uv \x3d position.xy * 0.5 + vec2(0.5);\n      }"])),a.gridOptimization?
l.glsl(t||(t=d.__makeTemplateObject(["\n            vec4 cov \x3d texture2D(coverageTex, uv0);\n            // if no highlight pixel set in this block, hide block\n            if (cov.r \x3d\x3d 0.0) {\n              gl_Position \x3d vec4(0.0);\n              return;\n            }"],["\n            vec4 cov \x3d texture2D(coverageTex, uv0);\n            // if no highlight pixel set in this block, hide block\n            if (cov.r \x3d\x3d 0.0) {\n              gl_Position \x3d vec4(0.0);\n              return;\n            }"]))):
"")),n.fragment.uniforms.add("tex","sampler2D"),n.fragment.uniforms.add("origin","sampler2D"),n.fragment.uniforms.add("color","vec4"),n.fragment.uniforms.add("haloColor","vec4"),n.fragment.uniforms.add("outlineSize","float"),n.fragment.uniforms.add("blurSize","float"),n.fragment.uniforms.add("opacities","vec4"),z.add(l.glsl(r||(r=d.__makeTemplateObject(["\n      void main() {\n        // Read the highlight intensity from the blurred highlight image\n        vec4 blurredHighlightValue \x3d texture2D(tex, uv);\n        float highlightIntensity \x3d blurredHighlightValue.a;\n\n        // Discard all pixels which are not affected by highlight\n        if (highlightIntensity \x3d\x3d 0.0) {\n          discard;\n        }\n\n        vec4 origin_color \x3d texture2D(origin, uv);\n\n        float outlineIntensity;\n        float fillIntensity;\n\n        // if occluded\n        if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\n          outlineIntensity \x3d haloColor.w * opacities[1];\n          fillIntensity \x3d color.w * opacities[3];\n        }\n        // if unoccluded\n        else {\n          outlineIntensity \x3d haloColor.w * opacities[0];\n          fillIntensity \x3d color.w * opacities[2];\n        }\n\n        float inner \x3d 1.0 - outlineSize / 9.0;\n        float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\n\n        float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\n        //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\n        float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n        float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n        // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        // I.e., color should not be premultiplied with alpha\n        gl_FragColor \x3d vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);\n      }"],
["\n      void main() {\n        // Read the highlight intensity from the blurred highlight image\n        vec4 blurredHighlightValue \x3d texture2D(tex, uv);\n        float highlightIntensity \x3d blurredHighlightValue.a;\n\n        // Discard all pixels which are not affected by highlight\n        if (highlightIntensity \x3d\x3d 0.0) {\n          discard;\n        }\n\n        vec4 origin_color \x3d texture2D(origin, uv);\n\n        float outlineIntensity;\n        float fillIntensity;\n\n        // if occluded\n        if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\n          outlineIntensity \x3d haloColor.w * opacities[1];\n          fillIntensity \x3d color.w * opacities[3];\n        }\n        // if unoccluded\n        else {\n          outlineIntensity \x3d haloColor.w * opacities[0];\n          fillIntensity \x3d color.w * opacities[2];\n        }\n\n        float inner \x3d 1.0 - outlineSize / 9.0;\n        float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\n\n        float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\n        //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\n        float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n        float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n        // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        // I.e., color should not be premultiplied with alpha\n        gl_FragColor \x3d vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);\n      }"])))));
return n};var e,c,h,m,f,b,g,p,t,u,r})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define(["require","exports","./RenderTargetHelper"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.OffscreenRendering=void 0;n=function(){function a(a,e){this._rctx=a;this._compositingHelper=e;this._currentRenderTarget=0;this.dimensions={width:4,height:4};this._needLastFrameColorTexture=!1;this._background={type:"color",color:[0,0,0,1]};var c=this.renderTargetHelper=new d.RenderTargetHelper(this._rctx);
this.mainColorTarget0=c.registerColorTarget({name:"mainColorTarget0"});this.mainColorTarget1=c.registerColorTarget({name:"mainColorTarget1"});a=function(a){return c.registerColorTarget({name:a,dataType:5126,samplingMode:9728})};this.colorFloatTarget=a("colorFloatTarget");this.alphaFloatTarget=a("alphaFloatTarget");this.mainDepth=c.registerDepthTarget({name:"mainDepth"});this.linearDepth=c.registerColorTarget({name:"linearDepth",samplingMode:9728});this.normal=c.registerColorTarget({name:"normal"});
this.highlight=c.registerColorTarget({name:"highlight",dataType:32819});this.hudVisibility=c.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=c.registerColorTarget({name:"tmpColor"});this.tmpDepth=c.registerDepthTarget({name:"tmpDepth"})}a.prototype.dispose=function(){this.renderTargetHelper.dispose()};Object.defineProperty(a.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this.dimensions.height},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"background",{get:function(){return this._background},set:function(a){this._background=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"currentColorTarget",{get:function(){return 0===this._currentRenderTarget?this.mainColorTarget0:this.mainColorTarget1},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"previousColorTarget",{get:function(){return 0===this._currentRenderTarget?this.mainColorTarget1:
this.mainColorTarget0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"currentRenderTarget",{get:function(){return this._currentRenderTarget},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.currentColorTarget,this.mainDepth)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"depthTexture",{get:function(){return this.renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"linearDepthTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"lastFrameColorTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"normalTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"highlightTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"tmpColorTexture",{get:function(){return this.getColorTexture(this.tmpColor)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"mainColorTexture",{get:function(){return this.getColorTexture(this.currentColorTarget)},enumerable:!1,configurable:!0});a.prototype.advanceCurrentRenderTarget=function(){this._currentRenderTarget=0===this._currentRenderTarget&&this._needLastFrameColorTexture?1:0};a.prototype.initializeFrame=function(a){var c=
this._rctx;this.dimensions.width=a.fullWidth;this.dimensions.height=a.fullHeight;this.bindTarget(this.currentColorTarget,this.mainDepth);c.setClearStencil(0);a=this._background.color;c.setClearColor(a[0]*a[3],a[1]*a[3],a[2]*a[3],a[3]);c.clearSafe(17664)};a.prototype.composite=function(){this._compositingHelper.composite(this.colorTexture,0)};a.prototype.renderAndComposite=function(a,d){this.renderToTargets(a,this.tmpColor,this.mainDepth,l);this._compositingHelper.composite(this.getColorTexture(this.tmpColor),
d)};a.prototype.renderHUDVisibility=function(a){this.renderToTargets(a,this.hudVisibility,this.mainDepth,k)};a.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var a=this;this.renderToTargets(function(){a._compositingHelper.compositeSpecial(a.getColorTexture(a.tmpColor),2)},this.hudVisibility,this.mainDepth)};a.prototype.renderOITPass=function(a,d){var c,e;switch(d){case 0:c=this.colorFloatTarget;e=[0,0,0,0];break;case 1:c=this.alphaFloatTarget;e=[1,1,1,1];break;case 2:c=this.tmpColor,
e=[0,0,0,0]}this.renderToTargets(a,c,this.mainDepth,e,!1)};a.prototype.compositeTransparentTerrainOntoMain=function(){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2)};a.prototype.compositeOccludedOntoMain=function(a){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2,a)};a.prototype.compositeTransparentOntoOpaque=function(){this.bindFramebuffer();this._compositingHelper.compositeTransparent(this.getColorTexture(this.colorFloatTarget),
this.getColorTexture(this.alphaFloatTarget),this.getColorTexture(this.tmpColor))};a.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};a.prototype.renderDepthDetached=function(a){this.bindTarget(this.currentColorTarget);a();this.bindTarget(this.currentColorTarget,this.mainDepth)};a.prototype.disposeTarget=function(a){this.renderTargetHelper.disposeTargetResource(a)};Object.defineProperty(a.prototype,"needLastFrameColorTexture",{get:function(){return this._needLastFrameColorTexture},
set:function(a){!a&&this._needLastFrameColorTexture&&(this._currentRenderTarget=0,this.disposeTarget(this.mainColorTarget1));this._needLastFrameColorTexture=a},enumerable:!1,configurable:!0});a.prototype.renderToTargets=function(a,d,e,f,b,g){var c=this._rctx;d=this.bindTarget(d,e);e=0;f&&(c.setClearColor(f[0],f[1],f[2],Math.max(1E-13,f[3])),e|=16384);b&&(e|=256);g&&(e|=1024);c.clearSafe(e,!0===g?255:!1===g?0:g);a();c.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth);return d};a.prototype.bindTarget=
function(a,d){a=this.renderTargetHelper.getFramebuffer(this.dimensions,a,d);this._rctx.bindFramebuffer(a);return a};a.prototype.getColorTexture=function(a){return this.renderTargetHelper.getColorTexture(a,this.dimensions)};a.prototype.getGpuMemoryUsage=function(){var a=0;this.renderTargetHelper&&(a+=this.renderTargetHelper.getGpuMemoryUsage());return a};return a}();a.OffscreenRendering=n;var l=[0,0,0,0],k=[0,1,0,1]})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("require exports tslib ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.RenderTargetHelper=void 0;var h={dataType:5121},m={};n=function(){function a(a){this.rctx=a;this._activeTargets=new Set;this._depthTextures=new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=new Map;this._nextId=1;this.depthTextureSupported=a.capabilities.depthTexture}a.prototype.dispose=function(){this._depthBuffers.forEach(function(a){return a.dispose()});this._depthBuffers.clear();this._depthTextures.forEach(function(a){return a.dispose()});
this._depthTextures.clear();this._colorTextures.forEach(function(a){return a.dispose()});this._colorTextures.clear();this._framebuffers.forEach(function(a){return a.dispose()});this._framebuffers.clear()};a.prototype.disposeTargetResource=function(a){a=a.id;this._activeTargets.has(a)&&(this._activeTargets.delete(a),this._depthTextures.has(a)&&(this._depthTextures.get(a).dispose(),this._depthTextures.delete(a)),this._depthBuffers.has(a)&&(this._depthBuffers.get(a).dispose(),this._depthBuffers.delete(a)),
this._colorTextures.has(a)&&(this._colorTextures.get(a).dispose(),this._colorTextures.delete(a)))};a.prototype.getDepthTexture=function(a,c){if(this.depthTextureSupported){var b=this._depthTextures.get(a.id);!b||b.descriptor.width===c.width&&b.descriptor.height===c.height||(b.dispose(),b=void 0);b||(b=new e(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:c.width,height:c.height}),this._depthTextures.set(a.id,b),this._activeTargets.add(a.id));return b}};
a.prototype.getAllocatedDepthTexture=function(a){return this._depthTextures.get(a.id)};a.prototype.getDepthBuffer=function(a,c){if(!this.depthTextureSupported){var b=this._depthBuffers.get(a.id);b?b.descriptor.width===c.width&&b.descriptor.height===c.height||b.resize(c.width,c.height):(b=new k(this.rctx,d.__assign({internalFormat:34041},c)),this._depthBuffers.set(a.id,b),this._activeTargets.add(a.id));return b}};a.prototype.getColorTexture=function(a,c){var b=this._colorTextures.get(a.id);!b||b.descriptor.width===
c.width&&b.descriptor.height===c.height||(b.dispose(),b=void 0);b||(b=new e(this.rctx,{target:3553,pixelFormat:6408,dataType:a.dataType,samplingMode:null!=a.samplingMode?a.samplingMode:9729,wrapMode:33071,width:c.width,height:c.height}),this._colorTextures.set(a.id,b),this._activeTargets.add(a.id));return b};a.prototype.getAllocatedColorTexture=function(a){return this._colorTextures.get(a.id)};a.prototype.registerDepthTarget=function(a){void 0===a&&(a={});var b=this._nextId++;return d.__assign(d.__assign({id:b},
m),a)};a.prototype.registerColorTarget=function(a){void 0===a&&(a={});var b=this._nextId++;return d.__assign(d.__assign({id:b},h),a)};a.prototype.getFramebuffer=function(a,c,d){var b=this.getKey(c,d),e=this._framebuffers.get(b);c=this.getColorTexture(c,a);if(this.depthTextureSupported){var f=d?this.getDepthTexture(d,a):void 0;if(!e)return e=d?new l(this.rctx,{colorTarget:0,depthStencilTarget:4},c,f):new l(this.rctx,{colorTarget:0,depthStencilTarget:0},c),this._framebuffers.set(b,e),e;if(d=e.width!==
a.width||e.height!==a.height||e.colorTexture!==c||e.depthStencilTexture!==f)e.detachColorTexture(),e.detachDepthStencilTexture(),e.resize(a.width,a.height),e.attachColorTexture(c),e.attachDepthStencilTexture(f);return e}f=d?this.getDepthBuffer(d,a):void 0;if(!e)return e=new l(this.rctx,{colorTarget:0,depthStencilTarget:d?3:0},c,f),this._framebuffers.set(b,e),e;if(d=e.width!==a.width||e.height!==a.height||e.colorTexture!==c)e.detachColorTexture(),e.detachDepthStencilBuffer(),e.resize(a.width,a.height),
e.attachColorTexture(c),e.attachDepthStencilBuffer(f);return e};a.prototype.getKey=function(a,c){return a.id+"_"+(c?c.id:"X")+"_"+a.name+(c?"_"+c.name:"")};a.prototype.getGpuMemoryUsage=function(){var a=0,d=new Set,e=function(b){d.has(b)||(d.add(b),a+=c.getGpuMemoryUsage(b))};this._depthTextures.forEach(e);this._colorTextures.forEach(e);this._depthBuffers.forEach(e);this._framebuffers.forEach(e);return a};return a}();a.RenderTargetHelper=n})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["require",
"exports","./depthRange","./Util"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.RenderPluginManager=void 0;n=function(){function a(a){this.pluginContext=a;this.renderPlugins=[];this.slots=[];for(a=0;23>a;++a)this.slots[a]=[]}a.prototype.add=function(a,d){this.renderPlugins.push(d);for(var c=0;c<a.length;++c)this.slots[a[c]].push(d);d.initializeRenderContext(this.pluginContext);this.pluginContext.requestRender()};a.prototype.remove=function(a){var c=this.renderPlugins.length;
this.renderPlugins=this.renderPlugins.filter(function(c){return c!==a});l.assert(this.renderPlugins.length<c,"Removing non-added render plugin");for(c=0;c<this.slots.length;++c)this.slots[c]=this.slots[c].filter(function(c){return c!==a});a.uninitializeRenderContext();this.pluginContext.requestRender()};a.prototype.prepareRender=function(a){for(var c=0,d=this.renderPlugins;c<d.length;c++){var e=d[c];e.prepareRender&&e.prepareRender(a)}};a.prototype.render=function(a,d){d.slot=a;var c=!1,e=0;for(a=
this.slots[a];e<a.length;e++){var b=a[e];b.canRender&&b.render(d)&&(c=!0)}return c};a.prototype.queryDepthRange=function(a){var c=k;c.near=Infinity;c.far=-Infinity;for(var e=0,f=this.renderPlugins;e<f.length;e++){var b=f[e];b.queryDepthRange&&(b=b.queryDepthRange(a))&&d.union(c,b,c)}return c};Object.defineProperty(a.prototype,"needsHighlight",{get:function(){return this.renderPlugins.some(function(a){return a.needsHighlight})},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"needsLinearDepth",
{get:function(){return this.renderPlugins.some(function(a){return a.needsLinearDepth})},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"needsLaserlineWithContrastControl",{get:function(){var a=this.slots[17];return!!a&&0<a.length},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"renderOccludedFlags",{get:function(){var a=0;this.renderPlugins.forEach(function(c){c.renderOccludedFlags&&(a|=c.renderOccludedFlags)});return a},enumerable:!1,configurable:!0});return a}();
a.RenderPluginManager=n;var k={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ./Camera ./DefaultTextureUnits ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w){function z(a,b){c.vec2.set(ia,a[b],a[b+3]);return ia}var x=function(){return function(){this.camera=new p.default;this.lightMat=e.mat4f64.create()}}();n=function(){function a(a,b){this.rctx=a;this.viewingMode=b;this._enabled=!1;this.maxTextureSize=this.textureSize=0;this.numCascades=1;this.maxNumCascades=4;this.splitSchemeLambda=0;this.warp=!0;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.emptyTexture=u.createEmptyTexture(this.rctx);this.maxTextureSize=
this.rctx.parameters.maxTextureSize;for(a=0;4>a;++a)this.cascades.push(new x)}a.prototype.dispose=function(){this.emptyTexture.dispose();this.emptyTexture=null;this.discardDepthTexture()};Object.defineProperty(a.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(a){this.maxNumCascades=d.clamp(Math.floor(a),1,4)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},set:function(a){(this._enabled=a)||this.discardDepthTexture()},
enumerable:!1,configurable:!0});a.prototype.getDepthTexture=function(){return this.depthTexture};a.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)O[a]=this.cascades[a];O.length=this.numCascades;return O};a.prototype.prepare=function(a,e,f){r.assert(this.enabled);this.textureSize=this.computeTextureSize(a.fullWidth,a.fullHeight);this.assertDepthTexture();k.mat4.multiply(A,a.projectionMatrix,a.viewMatrix);var g=f.near,h=f.far;2>g&&(g=2);2>h&&(h=2);g>=h&&(g=2,h=4);this.numCascades=
Math.min(1+Math.floor(r.logWithBase(h/g,4)),this.maxNumCascades);var l=(h-g)/this.numCascades,p=Math.pow(h/g,1/this.numCascades),h=g;for(f=0;f<this.numCascades+1;++f)this.cascadeDistances[f]=d.lerp(h,g,this.splitSchemeLambda),h*=p,g+=l;k.mat4.invert(C,A);f=1===this.viewingMode?a.eye:m.vec3.set(R,0,0,1);k.mat4.lookAt(Q,[0,0,0],[-e[0],-e[1],-e[2]],f);l=a.viewMatrix;a=a.projectionMatrix;for(f=0;f<this.numCascades;++f){p=this.cascades[f];g=-this.cascadeDistances[f];h=-this.cascadeDistances[f+1];g=(a[10]*
g+a[14])/Math.abs(a[11]*g+a[15]);h=(a[10]*h+a[14])/Math.abs(a[11]*h+a[15]);r.assert(g<h);for(var n=0;8>n;++n){b.vec4.set(E,0===n%4||3===n%4?-1:1,0===n%4||1===n%4?-1:1,4>n?g:h,1);b.vec4.transformMat4(G[n],E,C);for(var q=0;3>q;++q)G[n][q]/=G[n][3]}m.vec3.negate(R,G[0]);k.mat4.translate(B,Q,R);p.camera.viewMatrix=B;for(n=0;8>n;++n)m.vec3.transformMat4(G[n],G[n],p.camera.viewMatrix);m.vec3.copy(F,G[0]);m.vec3.copy(H,G[0]);for(n=1;8>n;++n)for(q=0;3>q;++q)F[q]=Math.min(F[q],G[n][q]),H[q]=Math.max(H[q],
G[n][q]);F[2]-=200;H[2]+=200;p.camera.near=-H[2];p.camera.far=-F[2];if(this.warp){g=1/G[0][3];h=1/G[4][3];r.assert(g<h);var n=g+Math.sqrt(g*h),h=Math.sin(d.acosClamped(l[2]*e[0]+l[6]*e[1]+l[10]*e[2])),n=n/h,g=G,t=n,u=h,h=J,v=I,w=K,q=L,n=M;c.vec2.set(P,0,0);for(var x=0;4>x;++x)c.vec2.add(P,P,g[x]);c.vec2.scale(P,P,.25);c.vec2.set(U,0,0);for(x=4;8>x;++x)c.vec2.add(U,U,g[x]);c.vec2.scale(U,U,.25);c.vec2.lerp(Z[0],g[4],g[5],.5);c.vec2.lerp(Z[1],g[5],g[6],.5);c.vec2.lerp(Z[2],g[6],g[7],.5);c.vec2.lerp(Z[3],
g[7],g[4],.5);for(var O=0,N=c.vec2.squaredDistance(Z[0],P),x=1;4>x;++x){var y=c.vec2.squaredDistance(Z[x],P);y<N&&(N=y,O=x)}c.vec2.subtract(V,Z[O],g[O+4]);x=V[0];V[0]=-V[1];V[1]=x;c.vec2.subtract(T,U,P);0>c.vec2.dot(T,V)&&c.vec2.negate(V,V);c.vec2.lerp(V,V,T,u);c.vec2.normalize(V,V);O=u=void 0;u=O=c.vec2.dot(c.vec2.subtract(Y,g[0],P),V);for(x=1;8>x;++x)N=c.vec2.dot(c.vec2.subtract(Y,g[x],P),V),N<u?u=N:N>O&&(O=N);c.vec2.copy(h,P);c.vec2.scale(Y,V,u-t);c.vec2.add(h,h,Y);for(var y=-1,S=1,x=t=N=0;8>x;++x){c.vec2.subtract(X,
g[x],h);c.vec2.normalize(X,X);var ia=V[0]*X[1]-V[1]*X[0];0<ia?ia>y&&(y=ia,N=x):ia<S&&(S=ia,t=x)}r.verify(0<y,"leftArea");r.verify(0>S,"rightArea");c.vec2.scale(ca,V,u);c.vec2.add(ca,ca,P);c.vec2.scale(ba,V,O);c.vec2.add(ba,ba,P);ga[0]=-V[1];ga[1]=V[0];v=r.rayRay2D(h,g[t],ba,c.vec2.add(Y,ba,ga),1,v);w=r.rayRay2D(h,g[N],ba,Y,1,w);q=r.rayRay2D(h,g[N],ca,c.vec2.add(Y,ca,ga),1,q);g=r.rayRay2D(h,g[t],ca,Y,1,n);r.verify(v,"rayRay");r.verify(w,"rayRay");r.verify(q,"rayRay");r.verify(g,"rayRay");w=J;g=I;h=
L;q=M;n=p.camera.projectionMatrix;c.vec2.subtract(ha,h,q);c.vec2.scale(ha,ha,.5);da[0]=ha[0];da[1]=ha[1];da[2]=0;da[3]=ha[1];da[4]=-ha[0];da[5]=0;da[6]=ha[0]*ha[0]+ha[1]*ha[1];da[7]=ha[0]*ha[1]-ha[1]*ha[0];da[8]=1;da[6]=-c.vec2.dot(z(da,0),w);da[7]=-c.vec2.dot(z(da,1),w);w=c.vec2.dot(z(da,0),h)+da[6];v=c.vec2.dot(z(da,1),h)+da[7];x=c.vec2.dot(z(da,0),q)+da[6];q=c.vec2.dot(z(da,1),q)+da[7];w=-(w+x)/(v+q);da[0]+=da[1]*w;da[3]+=da[4]*w;da[6]+=da[7]*w;w=1/(c.vec2.dot(z(da,0),h)+da[6]);v=1/(c.vec2.dot(z(da,
1),h)+da[7]);da[0]*=w;da[3]*=w;da[6]*=w;da[1]*=v;da[4]*=v;da[7]*=v;da[2]=da[1];da[5]=da[4];da[8]=da[7];da[7]+=1;w=c.vec2.dot(z(da,1),g)+da[7];v=c.vec2.dot(z(da,2),g)+da[8];x=c.vec2.dot(z(da,1),h)+da[7];q=c.vec2.dot(z(da,2),h)+da[8];w=-.5*(w/v+x/q);da[1]+=da[2]*w;da[4]+=da[5]*w;da[7]+=da[8]*w;w=c.vec2.dot(z(da,1),g)+da[7];v=c.vec2.dot(z(da,2),g)+da[8];x=-v/w;da[1]*=x;da[4]*=x;da[7]*=x;n[0]=da[0];n[1]=da[1];n[2]=0;n[3]=da[2];n[4]=da[3];n[5]=da[4];n[6]=0;n[7]=da[5];n[8]=0;n[9]=0;n[10]=1;n[11]=0;n[12]=
da[6];n[13]=da[7];n[14]=0;n[15]=da[8];p.camera.projectionMatrix[10]=2/(F[2]-H[2]);p.camera.projectionMatrix[14]=-(F[2]+H[2])/(F[2]-H[2])}else k.mat4.ortho(p.camera.projectionMatrix,F[0],H[0],F[1],H[1],p.camera.near,p.camera.far);k.mat4.multiply(p.lightMat,p.camera.projectionMatrix,p.camera.viewMatrix);g=this.textureSize/2;p.camera.viewport[0]=0===f%2?0:g;p.camera.viewport[1]=0===Math.floor(f/2)?0:g;p.camera.viewport[2]=g;p.camera.viewport[3]=g}this.lastOrigin=null;e=this.rctx;e.bindFramebuffer(this.fbo);
e.bindTexture(null,7);e.setClearColor(1,1,1,1);e.clearSafe(16640)};a.prototype.finish=function(a){r.assert(this.enabled);this.rctx.bindFramebuffer(a)};a.prototype.bind=function(a,b){var c=this.rctx;c.bindTexture(this.enabled?this.depthTexture:this.emptyTexture,b);c.bindProgram(a);a.setUniform1i("depthTex",b);a.setUniform1f("depthHalfPixelSz",this.enabled?.5/this.textureSize:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],1<this.numCascades?
this.cascadeDistances[1]:Infinity,2<this.numCascades?this.cascadeDistances[2]:Infinity,3<this.numCascades?this.cascadeDistances[3]:Infinity)};a.prototype.bindToAllPrograms=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var b=0;b<a.length;b++)this.bind(a[b],t.DefaultTextureUnits.SHADOW_MAP)};a.prototype.bindView=function(a,b){if(this.enabled){var c=this.lastOrigin;if(!c||c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2])for(this.lastOrigin=this.lastOrigin||f.vec3f64.create(),m.vec3.copy(this.lastOrigin,
b),c=0;c<this.numCascades;++c){k.mat4.translate(N,this.cascades[c].lightMat,b);for(var d=0;16>d;++d)S[16*c+d]=N[d]}a.setUniformMatrix4fv("shadowMapMatrix",S)}};a.prototype.computeTextureSize=function(a,b){return Math.min(this.maxTextureSize,2*Math.pow(2,Math.round(.5*Math.log(a*a+b*b)*Math.LOG2E+.35)))};a.prototype.assertDepthTexture=function(){if(null==this.depthTexture||this.depthTexture.descriptor.width!==this.textureSize)this.discardDepthTexture(),this.depthTexture=new v(this.rctx,{target:3553,
pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,height:this.textureSize}),this.fbo=new q(this.rctx,{colorTarget:0,depthStencilTarget:1,width:this.textureSize,height:this.textureSize},this.depthTexture)};a.prototype.discardDepthTexture=function(){this.fbo&&(this.fbo.dispose(),this.fbo=null);this.depthTexture&&(this.depthTexture.dispose(),this.depthTexture=null)};a.prototype.getGpuMemoryUsage=function(){return w.getGpuMemoryUsage(this.fbo)};Object.defineProperty(a.prototype,
"test",{get:function(){var a=this;return{maxNumCascades:this.maxNumCascades,cascades:this.cascades,textureSize:this.textureSize,set splitSchemeLambda(b){a.splitSchemeLambda=b},get splitSchemeLambda(){return a.splitSchemeLambda},set warp(b){a.warp=b},get warp(){return a.warp}}},enumerable:!1,configurable:!0});return a}();var B=e.mat4f64.create(),A=e.mat4f64.create(),C=e.mat4f64.create(),E=g.vec4f64.create(),G=[];for(a=0;8>a;++a)G.push(g.vec4f64.create());var F=f.vec3f64.create(),H=f.vec3f64.create(),
J=h.vec2f64.create(),I=h.vec2f64.create(),K=h.vec2f64.create(),L=h.vec2f64.create(),M=h.vec2f64.create(),Q=e.mat4f64.create(),R=f.vec3f64.create(),O=[],N=e.mat4f64.create(),S=new Float32Array(64),P=h.vec2f64.create(),U=h.vec2f64.create(),Z=[h.vec2f64.create(),h.vec2f64.create(),h.vec2f64.create(),h.vec2f64.create()],V=h.vec2f64.create(),T=h.vec2f64.create(),Y=h.vec2f64.create(),X=h.vec2f64.create(),ca=h.vec2f64.create(),ba=h.vec2f64.create(),ga=h.vec2f64.create(),ia=h.vec2f64.create(),ha=h.vec2f64.create(),
da=l.mat3f64.create();return n})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["require","exports","../../support/geometryUtils"],function(n,a,d){var l=d.boundedPlane.create();return function(){function a(){this._worldPlane=l}Object.defineProperty(a.prototype,"isEnabled",{get:function(){return this.plane!==l},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"plane",{get:function(){return this._worldPlane},set:function(a){this._worldPlane=a?a:l},enumerable:!1,configurable:!0});
return a}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../core/maybe ../../../../core/promiseUtils ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject @dojo/framework/shim/Promise".split(" "),function(n,a,d,l,k,e,c,h,m,f,b){return function(){function a(a){this.resourceLoadingPromise=null;this.isEnabled=!1;this.vertexAttributeLocations=
{vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}a.prototype.loadResources=function(a){var b=this;if(!this.data||!this.textureArea||!this.textureSearch){var c=this.resourceLoadingPromise||this.loadDataModule().then(function(){return b.loadTextures()});a&&c.then(a);this.resourceLoadingPromise||(this.resourceLoadingPromise=c,c.then(function(){return b.resourceLoadingPromise=null}));return!1}return!0};a.prototype.loadDataModule=
function(){var a=this;return this.data?l.resolve():(new Promise(function(a,b){n(["./SmaaRenderPassData"],a,b)})).then(function(b){a.data=b})};a.prototype.loadTextures=function(){var a=this;return l.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,9728,6409)]).then(function(b){var c=b[1];a.textureArea=b[0];a.textureSearch=c})};Object.defineProperty(a.prototype,"isLoadingResources",{get:function(){return null!=this.resourceLoadingPromise},
enumerable:!1,configurable:!0});a.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var a=this.rctx;this.programEdgeDetect=new h(a,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new h(a,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new h(a,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);
this.pipelineState=m.makePipelineState({colorWrite:m.defaultColorWriteParams});var d=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new b(a,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new e(a,34962,35044,d)});this.tmpFramebufferEdges=new c(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});this.tmpFramebufferBlend=new c(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,
pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});return this.isEnabled=!0};a.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),
this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};a.prototype.render=function(a,b){this.enable();var c=this.rctx,e=0,f=0;d.isSome(b)?(e=b.descriptor.width,f=b.descriptor.height):(e=c.gl.canvas.width,f=c.gl.canvas.height);c.bindVAO(this.vao);c.setPipelineState(this.pipelineState);c.setViewport(0,0,e,f);this.tmpFramebufferEdges.resize(e,f);c.bindFramebuffer(this.tmpFramebufferEdges);c.setClearColor(0,0,0,1);c.clear(16384);c.bindProgram(this.programEdgeDetect);
c.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/e,1/f,e,f);c.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(e,f);c.bindFramebuffer(this.tmpFramebufferBlend);c.setClearColor(0,0,1,1);c.clear(16384);c.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/e,1/f,e,f);c.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);c.bindTexture(this.textureArea,
2);this.programBlendWeights.setUniform1i("tArea",2);c.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);c.drawArrays(4,0,3);c.bindFramebuffer(b);c.setClearColor(0,1,0,1);c.clear(16384);c.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/e,1/f,e,f);c.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);c.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",
1);c.drawArrays(4,0,3)};a.prototype.loadTextureFromBase64=function(a,b,c){var d=new f(this.rctx,{pixelFormat:c,dataType:5121,wrapMode:33071,samplingMode:b},null);return k.requestImage(a).then(function(a){d.resize(a.width,a.height);d.setData(a);return d})};return a}()})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../core/Logger ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/imageUtils ./DefaultTextureUnits ./glUtil3D ./SSAOTechnique ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){var q=d.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");a=function(){function a(a,c,d){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=h.vec4f64.create();this.quadVAO=null;this._rctx=c;this._techniqueRep=a;this._requestRender=d;this._ssaoTechniqueConfig=new g.SSAOTechniqueConfiguration;this._emptyTexture=b.createColorTexture(c,[1,1,1,1])}a.prototype.dispose=function(){this._emptyTexture.dispose();
this._emptyTexture=null;l.isSome(this.quadVAO)&&(this.quadVAO=l.disposeMaybe(this.quadVAO))};Object.defineProperty(a.prototype,"isSupported",{get:function(){var a=this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),a=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return!(b||a)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"attenuation",{get:function(){return this._attenuation},set:function(a){this._attenuation=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"filterRadius",{get:function(){return 4},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples=a;this._enabled&&
this.selectPrograms()},enumerable:!1,configurable:!0});a.prototype.computeSSAO=function(a,d,f){if(this._noiseTexture){p.assert(this.enabled);var g=this._rctx,h=a.fullViewport,k=h[2],m=h[3],h=k/this._BLUR_F,n=m/this._BLUR_F;this._ssaoFBO.resize(k,m);this._blur0FBO.resize(h,n);this._blur1FBO.resize(h,n);h=1*k;n=1*m;g.bindFramebuffer(this._ssaoFBO);c.vec4.copy(this._viewportToRestore,a.fullViewport);g.setViewport(0,0,k,m);var q=this._ssaoTechnique.program,t=this._blurTechnique.program;g.bindProgram(q);
g.setPipelineState(this._ssaoTechnique.pipeline);q.setUniform2f("rnmScale",k/this._noiseTexture.descriptor.width,m/this._noiseTexture.descriptor.height);q.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:32>=this._samples?this._data.random32:this._data.random64);k=this._data.minDiscrepancy;q.setUniform1f("numSpiralTurns",this._samples<k.length?k[this._samples]:5779);k=w;m=v;p.inverseProjectionInfo(a.projectionMatrix,a.fullWidth,a.fullHeight,k,m);q.setUniform4fv("projInfo",
k);q.setUniform2fv("zScale",m);q.setUniform2f("nearFar",a.near,a.far);k=1/a.computeRenderPixelSizeAtDist(1);q.setUniform1f("projScale",1*k);q.setUniform2f("screenDimensions",h,n);var u=2*this._radius,m=e.vec3.distance(a.eye,a.center),u=20*a.computeRenderPixelSizeAtDist(m),u=Math.max(.1,u);q.setUniform1f("radius",u);q.setUniform1f("intensity",4*this._attenuation/Math.pow(u,6));q.setUniform1i("rnm",0);q.setUniform1i("normalMap",1);q.setUniform1i("depthMap",2);g.bindTexture(this._noiseTexture,0);g.bindTexture(f,
1);g.bindTexture(d,2);l.isSome(this.quadVAO)||(this.quadVAO=b.createQuadVAO(this._rctx));d=this.quadVAO;g.bindVAO(d);g.drawArrays(5,0,r.vertexCount(d,"geometry"));g.bindTexture(this._ssaoFBO.colorTexture,0);g.setViewport(0,0,h/this._BLUR_F,n/this._BLUR_F);g.bindFramebuffer(this._blur0FBO);g.bindProgram(t);t.setUniform2f("screenDimensions",h,n);t.setUniform1i("tex",0);t.setUniform1i("normalMap",1);t.setUniform1i("depthMap",2);t.setUniform2f("blurSize",0,1*this._BLUR_F/n);t.setUniform1i("radius",4);
t.setUniform1f("g_BlurFalloff",.08);t.setUniform2f("nearFar",a.near,a.far);5E4<m&&(k=Math.max(0,k-(m-5E4)));t.setUniform1f("projScale",k);t.setUniform2f("zScale",1,0);g.drawArrays(5,0,r.vertexCount(d,"geometry"));t.setUniform2f("blurSize",1*this._BLUR_F/h,0);g.bindFramebuffer(this._blur1FBO);g.bindTexture(this._blur0FBO.colorTexture,0);g.drawArrays(5,0,r.vertexCount(d,"geometry"));g.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};
a.prototype.setUniforms=function(a,b){var c=this.enabled&&this._noiseTexture,d=this._rctx;d.bindTexture(c?this._blur1FBO.colorTexture:this._emptyTexture,b);d.setActiveTexture(0);a.setUniform1i("ssaoTex",b);c?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};a.prototype.bindToAllPrograms=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b],
f.DefaultTextureUnits.SSAO)};a.prototype.selectPrograms=function(){this._ssaoTechniqueConfig.samples=8>=this._samples?8:16>=this._samples?16:32>=this._samples?32:64;this._ssaoTechniqueConfig.radius=4;this._ssaoTechniqueConfig.output=0;this._ssaoTechnique=this._techniqueRep.acquireAndReleaseExisting(g.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique);this._ssaoTechniqueConfig.output=1;this._blurTechnique=this._techniqueRep.acquireAndReleaseExisting(g.SSAOTechnique,this._ssaoTechniqueConfig,
this._blurTechnique)};a.prototype.enable=function(){var a=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(function(){a._enabled&&a.initialize()})):q.warn("SSAO is not supported for this browser or hardware"))};a.prototype.loadResources=function(a){var b=this;this._data?a():(new Promise(function(a,b){n(["./SSAOHelperData"],a,b)})).then(function(c){b._data=c;a()})};a.prototype.initialize=function(){var a=this,b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,
wrapMode:33071,width:0,height:0},c={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=new t(this._rctx,c,b);this._blur0FBO=new t(this._rctx,c,b);this._blur1FBO=new t(this._rctx,c,b);m.requestImage(this._data.noiseTexture).then(function(b){a._enabled&&(a._noiseTexture=new u(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:b.width,height:b.height},b),a._requestRender())});this.selectPrograms()};a.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._noiseTexture&&
(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};a.prototype.getGpuMemoryUsage=function(){return r.getGpuMemoryUsage(this._blur0FBO)+r.getGpuMemoryUsage(this._blur1FBO)+r.getGpuMemoryUsage(this._ssaoFBO)};Object.defineProperty(a.prototype,"test",{get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}},
enumerable:!1,configurable:!0});return a}();var v=k.vec2f64.create(),w=h.vec4f64.create();return a})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports tslib ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../shaders/SSAO.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),function(n,a,d,l,k,e,
c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.SSAOTechniqueConfiguration=a.SSAOTechnique=void 0;k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype.initializeProgram=function(a){var d=b.shader.get(),e=this.configuration,d=d.build({output:e.output,samples:e.samples,radius:e.radius});return new m(a.rctx,d.generateSource("vertex"),d.generateSource("fragment"),c.Default3D)};b.prototype.initializePipeline=function(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})};
b.shader=new l.ReloadableShaderModule(h,function(){return new Promise(function(a,b){n(["../shaders/SSAO.glsl"],a,b)})});return b}(k.ShaderTechnique);a.SSAOTechnique=k;k=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.samples=64;b.radius=4;return b}d.__extends(b,a);d.__decorate([e.parameter({count:2})],b.prototype,"output",void 0);d.__decorate([e.parameter()],b.prototype,"samples",void 0);d.__decorate([e.parameter()],b.prototype,"radius",void 0);return b}(e.ShaderTechniqueConfiguration);
a.SSAOTechniqueConfiguration=k})},"esri/views/3d/webgl-engine/shaders/SSAO.glsl":function(){define("require exports tslib ../core/shaderLibrary/ScreenSpacePass ../core/shaderLibrary/output/ReadLinearDepth.glsl ../core/shaderLibrary/util/CameraSpace.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var n=new h.ShaderBuilder;n.include(l.ScreenSpacePass);1===
a.output&&(n.include(k.ReadLinearDepth),n.fragment.code.add(c.glsl(m||(m=d.__makeTemplateObject(["\n      #ifndef RADIUS\n        #define RADIUS "],["\n      #ifndef RADIUS\n        #define RADIUS "])))+a.radius+"\n      #endif\n    "),n.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("g_BlurFalloff","float").add("projScale","float").add("nearFar","vec2").add("zScale","vec2"),n.fragment.code.add(c.glsl(f||(f=d.__makeTemplateObject(["\n      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n        float c \x3d texture2D(tex, uv).r;\n        float d \x3d linearDepthFromTexture(depthMap, uv, nearFar);\n\n        float ddiff \x3d d - center_d;\n\n        float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n        w_total +\x3d w;\n\n        return w*c;\n      }\n\n      void main(void) {\n        float b \x3d 0.0;\n        float w_total \x3d 0.0;\n\n        float center_d \x3d linearDepthFromTexture(depthMap, uv, nearFar);\n\n        float sharpness \x3d -0.05 * projScale/(center_d*zScale.x+zScale.y);\n        for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\n          float rf \x3d float(r);\n          vec2 uvOffset \x3d uv + rf*blurSize;\n          b +\x3d blurFunction(uvOffset, rf, center_d, w_total, sharpness);\n        }\n\n        gl_FragColor \x3d vec4(b/w_total);\n      }\n    "],
["\n      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n        float c \x3d texture2D(tex, uv).r;\n        float d \x3d linearDepthFromTexture(depthMap, uv, nearFar);\n\n        float ddiff \x3d d - center_d;\n\n        float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n        w_total +\x3d w;\n\n        return w*c;\n      }\n\n      void main(void) {\n        float b \x3d 0.0;\n        float w_total \x3d 0.0;\n\n        float center_d \x3d linearDepthFromTexture(depthMap, uv, nearFar);\n\n        float sharpness \x3d -0.05 * projScale/(center_d*zScale.x+zScale.y);\n        for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\n          float rf \x3d float(r);\n          vec2 uvOffset \x3d uv + rf*blurSize;\n          b +\x3d blurFunction(uvOffset, rf, center_d, w_total, sharpness);\n        }\n\n        gl_FragColor \x3d vec4(b/w_total);\n      }\n    "])))));
0===a.output&&(n.include(k.ReadLinearDepth),n.include(e.CameraSpace),n.fragment.uniforms.add("projMatrixInv","mat4").add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),n.fragment.code.add(c.glsl(b||(b=d.__makeTemplateObject(["\n      #ifndef SAMPLES\n        #define SAMPLES "],["\n      #ifndef SAMPLES\n        #define SAMPLES "])))+
a.samples+"\n      #endif\n      uniform vec3 pSphere[SAMPLES]; //tap position\n    "),n.fragment.code.add(c.glsl(g||(g=d.__makeTemplateObject(["\n      float fallOffFunction(float vv, float vn, float bias) {\n        float radius2 \x3d radius * radius;\n\n        // A: From the HPG12 paper\n        // Note large epsilon to avoid overdarkening within cracks\n        // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n        // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n        float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n        // C: Medium contrast (which looks better at high radii), no division.  Note that the\n        // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n        // more computationally efficient and happens to be aesthetically pleasing.\n        // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n        // D: Low contrast, no division operation\n        // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\n      }\n    "],
["\n      float fallOffFunction(float vv, float vn, float bias) {\n        float radius2 \x3d radius * radius;\n\n        // A: From the HPG12 paper\n        // Note large epsilon to avoid overdarkening within cracks\n        // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n        // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n        float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n        // C: Medium contrast (which looks better at high radii), no division.  Note that the\n        // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n        // more computationally efficient and happens to be aesthetically pleasing.\n        // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n        // D: Low contrast, no division operation\n        // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\n      }\n    "])))),
n.fragment.code.add(c.glsl(p||(p=d.__makeTemplateObject(["\n      float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n        vec3 v \x3d Q - C;\n        float vv \x3d dot(v, v);\n        float vn \x3d dot(normalize(v), n_C);\n        return fallOffFunction(vv, vn, 0.1);\n      }\n    "],["\n      float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n        vec3 v \x3d Q - C;\n        float vv \x3d dot(v, v);\n        float vn \x3d dot(normalize(v), n_C);\n        return fallOffFunction(vv, vn, 0.1);\n      }\n    "])))),
n.fragment.code.add(c.glsl(t||(t=d.__makeTemplateObject(["\n      void main(void) {\n        //Hash function used in the HPG12 AlchemyAO paper\n        //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\n        //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\n        //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n        vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n        float currentPixelDepth \x3d linearDepthFromTexture(depthMap, uv, nearFar);\n\n        if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }\n\n        vec3 currentPixelPos \x3d reconstructPosition(gl_FragCoord.xy,currentPixelDepth);\n\n        // get the normal of current fragment\n        vec4 norm4 \x3d texture2D(normalMap, uv);\n        vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\n        bool isTerrain \x3d norm4.w\x3c0.5;\n\n        float sum \x3d .0;\n\n        vec4 occluderFragment;\n        vec3 ray;\n\n        vec3 tapPixelPos;\n\n        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n        // bug or deviation from CE somewhere else?\n        float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n        for(int i \x3d 0; i \x3c SAMPLES; ++i) {\n          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n          //float ssR;\n          //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\n          // get the depth of the occluder fragment\n          //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\n\n          vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\n          vec2 offset \x3d vec2(-unitOffset*radius*ps);\n\n          //don't use current or very nearby samples\n          if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\n\n          vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\n          if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\n          vec2 tcTap \x3d tc/screenDimensions;\n          float occluderFragmentDepth \x3d linearDepthFromTexture(depthMap, tcTap, nearFar);\n\n          if (isTerrain) {\n            bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\n            if (isTerrainTap) {\n              continue;\n            }\n          }\n\n          tapPixelPos \x3d reconstructPosition(tc, occluderFragmentDepth);\n\n          sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n        }\n\n        // output the result\n\n        float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n        // Anti-tone map to reduce contrast and drag dark region farther\n        // (x^0.2 + 1.2 * x^4)/2.2\n        A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n        //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\n        //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\n        //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\n        gl_FragColor \x3d vec4(A);\n      }\n    "],
["\n      void main(void) {\n        //Hash function used in the HPG12 AlchemyAO paper\n        //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\n        //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\n        //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n        vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n        float currentPixelDepth \x3d linearDepthFromTexture(depthMap, uv, nearFar);\n\n        if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }\n\n        vec3 currentPixelPos \x3d reconstructPosition(gl_FragCoord.xy,currentPixelDepth);\n\n        // get the normal of current fragment\n        vec4 norm4 \x3d texture2D(normalMap, uv);\n        vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\n        bool isTerrain \x3d norm4.w\x3c0.5;\n\n        float sum \x3d .0;\n\n        vec4 occluderFragment;\n        vec3 ray;\n\n        vec3 tapPixelPos;\n\n        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n        // bug or deviation from CE somewhere else?\n        float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n        for(int i \x3d 0; i \x3c SAMPLES; ++i) {\n          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n          //float ssR;\n          //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\n          // get the depth of the occluder fragment\n          //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\n\n          vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\n          vec2 offset \x3d vec2(-unitOffset*radius*ps);\n\n          //don't use current or very nearby samples\n          if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\n\n          vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\n          if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\n          vec2 tcTap \x3d tc/screenDimensions;\n          float occluderFragmentDepth \x3d linearDepthFromTexture(depthMap, tcTap, nearFar);\n\n          if (isTerrain) {\n            bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\n            if (isTerrainTap) {\n              continue;\n            }\n          }\n\n          tapPixelPos \x3d reconstructPosition(tc, occluderFragmentDepth);\n\n          sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n        }\n\n        // output the result\n\n        float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n        // Anti-tone map to reduce contrast and drag dark region farther\n        // (x^0.2 + 1.2 * x^4)/2.2\n        A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n        //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\n        //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\n        //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\n        gl_FragColor \x3d vec4(A);\n      }\n    "])))));
return n};var m,f,b,g,p,t})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.CameraSpace=void 0;a.CameraSpace=function(a){a.fragment.uniforms.add("projInfo","vec4");a.fragment.uniforms.add("zScale","vec2");a.fragment.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "],
["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "]))))};var k})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports tslib ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/typedArrayUtil ../../../../../core/workers ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/utils ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K){function L(a){for(var b=null,c=null,d=0;d<a.geometries.length;d++){var e=a.geometryRecords[d];if(e.material.supportsEdges){if(!b)b=e.transformation;else if(!l.equals(b,e.transformation))return!1;if(!c&&e.origin)c=e;else if(c&&e.origin&&c.origin.id!==e.origin.id)return!1}}return!0}Object.defineProperty(a,"__esModule",{value:!0});a.EdgeView=void 0;n=function(){function a(a,b,c){var d=this;this.rctx=a;this.techniqueRepository=b;
this.callbacks=c;this.profilingCallback=null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new x.LocalOriginManager(new w);this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new E;this.destroyed=!1;this.tmpModelPosition=u.vec3f64.create();this.tmpCameraPosition=u.vec3f64.create();this.componentColorManager=new J.BufferManager(this.rctx,2);m.open("EdgeProcessingWorker").then(function(a){d.destroyed?a.close():d.workerThread=a});a=A.VertexLayout.createBuffer(4);for(b=
0;4>b;b++)a.sideness.set(b,0,0===b||3===b?0:1),a.sideness.set(b,1,0===b||1===b?0:1);this.verticesBufferObject=I.createVertex(this.rctx,35044,a.buffer)}a.prototype.destroy=function(){var a=this;this.destroyed||(this.perObjectData.forEach(function(b,c){a.perObjectData.delete(c);b.renderables.forEach(function(b){a.removeRenderable(b)})}),this.strokesTexture=e.disposeMaybe(this.strokesTexture),this.componentColorManager=e.destroyMaybe(this.componentColorManager),this.workerThread=e.destroyMaybe(this.workerThread),
this.verticesBufferObject=e.disposeMaybe(this.verticesBufferObject),this.perObjectData.clear(),this.renderers.clear(),this.destroyed=!0)};a.prototype.getUsedMemory=function(){return this.gpuMemoryUsage};Object.defineProperty(a.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!1,configurable:!0});a.prototype.shouldRender=function(){return 0<this.renderers.size};a.prototype.addComponentObject=function(a,b,e,f,g,h,k,m){return d.__awaiter(this,void 0,
void 0,function(){var l,p;return d.__generator(this,function(d){switch(d.label){case 0:if(this.hasObject(a))return[2];p={loaded:c.create(function(a){return l=a}),renderables:[],center:e};this.perObjectData.set(a,p);return[4,this.addComponentGeometry(b,p,f,g,h,k,m)];case 1:return d.sent(),this.callbacks.setNeedsRender(),l(),[2]}})})};a.prototype.addOrUpdateObject=function(a,b,e,f,g){return d.__awaiter(this,void 0,void 0,function(){var h,k,m,l,p,n,r,q,t=this;return d.__generator(this,function(d){switch(d.label){case 0:h=
[];m={loaded:c.create(function(a){return k=a}),renderables:[]};l=this.perObjectData.get(a);this.perObjectData.set(a,m);if(g&&g.mergeGeometries&&1<a.geometries.length&&L(a))h.push(this.addObjectMergedGeometries(a,m,b,e));else for(p=0;p<a.geometries.length;p++)n=a.geometries[p],r=a.geometryRecords[p],q=r.material,q.supportsEdges&&h.push(this.addGeometryData(a,m,n.data,r,b[0],e,f));return[4,c.all(h)];case 1:return d.sent(),l&&l.loaded.then(function(){l.renderables.forEach(function(a){return t.removeRenderable(a)});
t.callbacks.setNeedsRender()}),this.callbacks.setNeedsRender(),k(),[2]}})})};a.prototype.hasObject=function(a){return this.perObjectData.has(a)};a.prototype.updateAllComponentOpacities=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f=this;return d.__generator(this,function(d){switch(d.label){case 0:return c=b instanceof Array?function(a){return b[a]}:function(){return b},[4,this.getObjectEntry(a)];case 1:return e=d.sent(),e.renderables.forEach(function(a){for(var b=a.components.meta.length,
d=0;d<b;d++){var e=c(d),g=a.components.meta[d],h=g.index;g.material.opacity=e;a.components.buffer.textureBuffer.setDataElement(h,1,3,255*e)}f.updateTransparency(a)}),this.callbacks.setNeedsRender(),[2]}})})};a.prototype.updateAllComponentMaterials=function(a,b,c,e){return d.__awaiter(this,void 0,void 0,function(){var f,g,h,k,m,l=this;return d.__generator(this,function(d){switch(d.label){case 0:return f=a instanceof B,g=!!c.slicePlaneEnabled,h=H.determineRendererType(b),k=G.EdgeRenderer.getKey(h,g,
f),[4,this.getObjectEntry(a)];case 1:return m=d.sent(),m.renderables.forEach(function(a){if(k!==a.rendererKey){var c=l.renderers.get(a.rendererKey),d=l.acquireRenderer(h,g,f);c.removeRenderable(a);c.refCount.decrement();a.rendererKey=k;d.addRenderable(a)}for(c=0;c<b.length;c++)a.components.meta[c].material=b[c];e&&l.updateComponentBuffer(a.components);l.updateTransparency(a)}),this.callbacks.setNeedsRender(),[2]}})})};a.prototype.updateObjectVisibility=function(a,b){return d.__awaiter(this,void 0,
void 0,function(){var c;return d.__generator(this,function(d){switch(d.label){case 0:return[4,this.getObjectEntry(a)];case 1:return c=d.sent(),c.renderables.forEach(function(a){return a.visible=b}),this.callbacks.setNeedsRender(),[2]}})})};a.prototype.removeObject=function(a){var b=this,c=this.perObjectData.get(a);c&&(this.perObjectData.delete(a),c.loaded.then(function(){c.renderables.forEach(function(a){return b.removeRenderable(a)});b.callbacks.setNeedsRender()}))};a.prototype.getObjectEntry=function(a){return d.__awaiter(this,
void 0,void 0,function(){var b;return d.__generator(this,function(c){switch(c.label){case 0:b=this.perObjectData.get(a);if(!b)throw"no object";return[4,b.loaded];case 1:return c.sent(),[2,b]}})})};a.prototype.removeAll=function(){var a=this;this.perObjectData.forEach(function(b,c){a.removeObject(c)})};a.prototype.render=function(a,c){var d=this;if(!e.isNone(this.componentColorManager)){this.localOrigins.updateViewMatrices(a.camera.viewMatrix);var h=a.camera.viewInverseTransposeMatrix,k=u.vec3f64.create(),
m=new v.TwoVectorPosition,l=new q.VertexPosition.ViewProjectionTransform,p=b.mat3f64.create();t.vec3.set(k,h[3],h[7],h[11]);m.set(k);t.vec3.copy(l.worldFromView_TH,m.high);t.vec3.copy(l.worldFromView_TL,m.low);f.mat3.fromMat4(l.viewFromCameraRelative_RS,a.camera.viewMatrix);g.mat4.copy(l.projFromView,a.camera.projectionMatrix);h=b.mat3f64.create();f.mat3.transpose(h,l.viewFromCameraRelative_RS);f.mat3.invert(p,h);this.renderers.forEach(function(a){0===a.refCount.value&&(d.renderers.delete(a.key),
a.dispose())});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();var n=0,r=0;this.renderers.forEach(function(a){return a.forEachRenderable(function(a){n+=a.statistics.averageEdgeLength;r++},c)});if(0!==r){var h=40*n/r,k=H.estimateLengthAtDistance(a.camera.fullViewport[3],a.camera.fovY,1,3.5*a.camera.pixelRatio),w={distanceFalloffFactor:h,minimumEdgeLength:k,transparency:c,viewProjectionTransform:l,transformNormal_ViewFromGlobal:p};this.updateObjectCameraDistances(a);
this.numberOfRenderedEdges=0;this.renderers.forEach(function(b){d.renderRegularEdges(b,a,w);d.renderSilhouetteEdges(b,a,w)})}}};a.prototype.updateTransparency=function(a){var b=H.determineEdgeTransparency(a.components.meta),c=H.determineObjectTransparency(a.components.meta);if(b!==a.edgeTransparency||c!==a.objectTransparency)a.edgeTransparency=b,a.objectTransparency=c,this.renderers.get(a.rendererKey).setRenderablesDirty()};a.prototype.computeModelTransformWithLocalOrigin=function(a,b,c){a.getCombinedStaticTransformation(b,
c);b.origin?this.localOrigins.register(b.origin):(a=t.vec3.set(this.tmpModelPosition,c[12],c[13],c[14]),b.origin=this.localOrigins.acquire(a));z.applyToModelMatrix(b.origin.vec3,c);return c};a.prototype.updateComponentBuffer=function(a){var b=a.meta;a=a.buffer;for(var c=0;c<b.length;c++){var d=b[c].material,e=b[c].index,f=k.clamp(Math.round(d.size*G.LINE_WIDTH_FRACTION_FACTOR),0,255),g=k.clamp(d.extensionLength,-G.EXTENSION_LENGTH_OFFSET,255-G.EXTENSION_LENGTH_OFFSET)+G.EXTENSION_LENGTH_OFFSET,h=
"solid"===d.type?0:1,m=255*d.opacity,d=d.color;a.textureBuffer.setData(e,0,255*d[0],255*d[1],255*d[2],255*d[3]);a.textureBuffer.setData(e,1,f,g,h,m)}};a.prototype.createComponentBuffers=function(a){if(e.isNone(this.componentColorManager))return null;for(var b=[],c=this.componentColorManager.getBuffer(a.length),d=0;d<a.length;d++){var f=a[d],g=c.acquireIndex();b.push({index:g,material:f})}a={meta:b,buffer:c};this.updateComponentBuffer(a);return a};a.prototype.extractEdges=function(a,b,c,d,e){return this.worker.process({data:b,
originalIndices:e,writerSettings:a,skipDeduplicate:c},d?null:this.workerThread)};a.prototype.createEdgeResources=function(a){var b={};if(e.isNone(this.verticesBufferObject))return b;if(0<a.regular.lodInfo.lengths.length){var c=new K(this.rctx,A.EdgeShaderAttributeLocations,{vertices:A.glVertexLayout,instances:C.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:I.createVertex(this.rctx,35044,a.regular.instancesData.buffer)});b.regular={vao:c,lod:a.regular.lodInfo}}0<a.silhouette.lodInfo.lengths.length&&
(c=new K(this.rctx,A.EdgeShaderAttributeLocations,{vertices:A.glVertexLayout,instances:C.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:I.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),b.silhouette={vao:c,lod:a.silhouette.lodInfo});return b};a.prototype.addGeometryData=function(a,b,c,e,f,g,h){return d.__awaiter(this,void 0,void 0,function(){var k,m,l,n;return d.__generator(this,function(d){k=c.getAttribute("position");m=this.computeModelTransformWithLocalOrigin(a,
e,p.mat4f64.create());l=e.origin;n={position:k,indices:c.getIndices("position"),modelTransform:m,origin:l};return[2,this.addPositionData(b,n,f,g,h)]})})};a.prototype.addPositionData=function(a,b,c,f,g){void 0===g&&(g=!1);return d.__awaiter(this,void 0,void 0,function(){var h,k,m,l,p,n,r,q,t,u,v,w,x,B,z;return d.__generator(this,function(d){switch(d.label){case 0:h=this.createComponentBuffers([c]);if(e.isNone(h))return[2];k=this.acquireRenderer(c.type,!!f.slicePlaneEnabled);m=b.modelTransform;l=b.origin;
p=b.indices;n=b.position;r=n.data.length/n.strideIdx;q=A.EdgeInputBufferLayout.createBuffer(r);for(t=0;t<r;t++)q.position.set(t,0,n.data[n.offsetIdx+t*n.strideIdx+0]),q.position.set(t,1,n.data[n.offsetIdx+t*n.strideIdx+1]),q.position.set(t,2,n.data[n.offsetIdx+t*n.strideIdx+2]);H.fillComponenBufferIndices(h.meta,[0,q.componentIndex.count],q.componentIndex);return[4,this.extractEdges(k.writerSettings,q,!1,g,p)];case 1:return u=d.sent(),v=this.createEdgeResources(u),w=v.regular,x=v.silhouette,B=(w?
w.vao.size:0)+(x?x.vao.size:0),z={regular:w,silhouette:x,transform:{modelMatrix:m,origin:l},statistics:{gpuMemoryUsage:B,averageEdgeLength:u.averageEdgeLength},components:h,visible:!0,edgeTransparency:H.determineEdgeTransparency(h.meta),objectTransparency:H.determineObjectTransparency(h.meta),distanceToCamera:0,rendererKey:k.key},a.renderables.push(z),k.addRenderable(z),this.gpuMemoryUsage+=B,[2]}})})};a.prototype.addComponentGeometry=function(a,b,c,f,g,h,k){return d.__awaiter(this,void 0,void 0,
function(){var m,l,p,n,q,t,u,v,w,x,B;return d.__generator(this,function(d){switch(d.label){case 0:m=this.createComponentBuffers(h);if(e.isNone(m))return[2];l=H.determineRendererType(h);p=this.acquireRenderer(l,k.slicePlaneEnabled||!1,!1);n=A.EdgeInputBufferLayout.createBuffer(c.count);r.vec3.copy(n.position,c);H.fillComponenBufferIndices(m.meta,g,n.componentIndex,f);q=p.writerSettings;return[4,this.extractEdges(q,n,!0,!1,f)];case 1:return t=d.sent(),u=this.createEdgeResources(t),v=u.regular,w=u.silhouette,
x=(v?v.vao.size:0)+(w?w.vao.size:0),B={regular:v,silhouette:w,transform:a,statistics:{gpuMemoryUsage:x,averageEdgeLength:t.averageEdgeLength},components:m,visible:!0,edgeTransparency:H.determineEdgeTransparency(m.meta),objectTransparency:H.determineObjectTransparency(m.meta),distanceToCamera:0,rendererKey:p.key},b.renderables.push(B),p.addRenderable(B),this.gpuMemoryUsage+=x,[2]}})})};a.prototype.addObjectMergedGeometries=function(a,b,c,e){return d.__awaiter(this,void 0,void 0,function(){var f,g,
k,m,l,n,r,q,t,u,v,w,x,B,z,A,C,I,E,H,F;return d.__generator(this,function(d){switch(d.label){case 0:f=new Map;g=0;m=k=null;for(l=0;l<a.geometries.length;l++)if(n=a.geometries[l],r=a.geometryRecords[l],q=r.material,q.supportsEdges&&(!m&&r.origin&&(m=r),t=n.data.getIndices("position"),g+=t?t.length:0,t&&null==k||k===Uint16Array))k=h.isUint16Array(t)?Uint16Array:Uint32Array;u=g?new k(g):null;v=[];for(l=w=0;l<a.geometries.length;l++)if(n=a.geometries[l],x=a.geometryRecords[l],q=x.material,q.supportsEdges){B=
n.data.getAttribute("position");t=n.data.getIndices("position");z=f.get(B.data);if(null==z){z=v.length/3;for(A=B.offsetIdx;A<B.data.length;A+=B.strideIdx)v.push(B.data[A+0]),v.push(B.data[A+1]),v.push(B.data[A+2]);f.set(B.data,z)}if(t)for(C=0;C<t.length;C++)u[w++]=z+t[C]}I=m||a.geometryRecords[0];E=this.computeModelTransformWithLocalOrigin(a,I,p.mat4f64.create());H=I.origin;for(l=0;l<a.geometryRecords.length;l++)a.geometryRecords[l].origin=H;F={position:{data:v,offsetIdx:0,strideIdx:3},indices:u,
modelTransform:E,origin:H};return[4,this.addPositionData(b,F,c[0],e)];case 1:return d.sent(),[2]}})})};a.prototype.acquireRenderer=function(a,b,c){void 0===c&&(c=!0);var d=G.EdgeRenderer.getKey(a,b,c),f=this.renderers.get(d);e.isNone(this.strokesTexture)&&(this.strokesTexture=F.generateStrokesTexture(this.rctx));f||(f=new G.EdgeRenderer(this.rctx,this.techniqueRepository,{type:a,slicePlaneEnabled:b,strokesTexture:this.strokesTexture,legacy:c}),this.renderers.set(d,f));f.refCount.increment();return f};
a.prototype.removeRenderable=function(a){var b=this.renderers.get(a.rendererKey);if(b){b.removeRenderable(a);b.refCount.decrement();a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),a.regular.vao.dispose(!1),a.regular.vao=null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),a.silhouette.vao.dispose(!1),a.silhouette.vao=null);"origin"in a.transform&&this.localOrigins.release(a.transform.origin);this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;for(var b=0,c=a.components.meta;b<
c.length;b++)a.components.buffer.releaseIndex(c[b].index)}};a.prototype.updateObjectCameraDistances=function(a){var b=this;a=a.camera.viewInverseTransposeMatrix;t.vec3.set(this.tmpCameraPosition,a[3],a[7],a[11]);this.perObjectData.forEach(function(a,c){c="getCenter"in c?c.getCenter():a.center;var d=t.vec3.distance(c,b.tmpCameraPosition);a.renderables.forEach(function(a){return a.distanceToCamera=d})})};a.prototype.renderRegularEdges=function(a,b,c){var d=this;a.bindRegularEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&
e.regular){var f=H.computeEdgeCount(e.regular.lod.lengths,e.distanceToCamera,c);"origin"in e.transform&&(b.localViewMatrixForEdges=d.localOrigins.getViewMatrix(e.transform.origin));a.renderRegularEdges(e,b,f);d.numberOfRenderedEdges+=f}},c.transparency)};a.prototype.renderSilhouetteEdges=function(a,b,c){var d=this;a.bindSilhouetteEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.silhouette){var f=H.computeEdgeCount(e.silhouette.lod.lengths,e.distanceToCamera,c);"origin"in e.transform&&(b.localViewMatrixForEdges=
d.localOrigins.getViewMatrix(e.transform.origin));a.renderSilhouetteEdges(e,b,f);d.numberOfRenderedEdges+=f}},c.transparency)};return a}();a.EdgeView=n})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.applyToViewMatrix=a.applyToModelMatrix=void 0;a.applyToModelMatrix=function(a,l){var d=-a[0],e=-a[1];a=-a[2];var c=l[3],h=l[7],m=l[11],f=l[15];l[0]+=c*d;l[1]+=c*e;l[2]+=c*a;l[4]+=h*d;l[5]+=h*
e;l[6]+=h*a;l[8]+=m*d;l[9]+=m*e;l[10]+=m*a;l[12]+=f*d;l[13]+=f*e;l[14]+=f*a};a.applyToViewMatrix=function(a,l){var d=a[0],e=a[1];a=a[2];l[12]+=d*l[0]+e*l[4]+a*l[8];l[13]+=d*l[1]+e*l[5]+a*l[9];l[14]+=d*l[2]+e*l[6]+a*l[10];l[14]+=d*l[3]+e*l[7]+a*l[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/mat4f64","./localOriginHelper"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",
{value:!0});a.LocalOriginManager=void 0;n=function(){function a(a){this.factory=a;this.originData=new Map}a.prototype.acquire=function(a){return this.register(this.factory.getOrigin(a))};a.prototype.register=function(a){var c=this.originData.get(a.id);if(c)return c.refCount++,c.origin;this.originData.set(a.id,{refCount:1,viewMatrix:l.mat4f64.create(),origin:a});return a};a.prototype.release=function(a){var c=this.originData.get(a.id);c&&(c.refCount--,0===c.refCount&&this.originData.delete(a.id))};
a.prototype.updateViewMatrices=function(a){this.originData.forEach(function(c){d.mat4.copy(c.viewMatrix,a);k.applyToViewMatrix(c.origin.vec3,c.viewMatrix)})};a.prototype.getViewMatrix=function(a){return this.originData.get(a.id).viewMatrix};return a}();a.LocalOriginManager=n})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require","exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(n,a,d,l){Object.defineProperty(a,"__esModule",
{value:!0});a.EdgeShaderAttributeLocations=a.SilhouetteEdgeInstancesLayout=a.RegularEdgeInstancesLayout=a.CommonInstancesLayout=a.glVertexLayout=a.VertexLayout=a.EdgeInputBufferLayout=void 0;a.EdgeInputBufferLayout=l.newLayout().vec3f("position").u16("componentIndex").u16("_padding");a.VertexLayout=l.newLayout().vec2u8("sideness");a.glVertexLayout=d.glLayout(a.VertexLayout);a.CommonInstancesLayout=l.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",
{glNormalized:!0}).u8("_padding",{glPadding:!0}).u16("_padding2",{glPadding:!0});a.RegularEdgeInstancesLayout=a.CommonInstancesLayout.clone().vec3f("normal");a.SilhouetteEdgeInstancesLayout=a.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");a.EdgeShaderAttributeLocations={position0:0,position1:1,componentIndex:2,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/RandomLCG ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.SilhouetteEdgeBufferWriter=a.RegularEdgeBufferWriter=a.CommonBufferWriter=void 0;var h=function(){function a(){}a.prototype.updateSettings=function(a){this.settings=a};a.prototype.write=function(a,c,d){var e=m;e[0]=d.position0[0];e[1]=d.position0[1];e[2]=d.position0[2];e[3]=d.position1[0];e[4]=d.position1[1];e[5]=d.position1[2];b[0]=5381;for(e=0;e<f.length;e++)b[0]=31*b[0]+f[e];g.seed=b[0];var e=g.getIntRange(0,255),h=g.getIntRange(0,
this.settings.variants-1),k=g.getFloat(),k=-(1-Math.min(k/.7,1))+Math.max(0,k-.7)/(1-.7),k=255*(Math.pow(Math.abs(k),1.2)*(0>k?-1:1)*.5+.5);a.position0.setVec(c,d.position0);a.position1.setVec(c,d.position1);a.componentIndex.set(c,d.componentIndex);a.variantOffset.set(c,e);a.variantStroke.set(c,h);a.variantExtension.set(c,k)};a.prototype.trim=function(a,b){return a.slice(0,b)};return a}();a.CommonBufferWriter=h;var m=new Float32Array(6),f=new Uint32Array(m.buffer),b=new Uint32Array(1),g=new d;n=function(){function a(){this.commonWriter=
new h}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return c.RegularEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);l.vec3.add(p,c.faceNormal0,c.faceNormal1);l.vec3.normalize(p,p);a.normal.setVec(b,p)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=c.RegularEdgeInstancesLayout;a.glLayout=e.glLayout(c.RegularEdgeInstancesLayout,{divisor:1});return a}();a.RegularEdgeBufferWriter=
n;n=function(){function a(){this.commonWriter=new h}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return c.SilhouetteEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);a.normalA.setVec(b,c.faceNormal0);a.normalB.setVec(b,c.faceNormal1)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=c.SilhouetteEdgeInstancesLayout;a.glLayout=e.glLayout(c.SilhouetteEdgeInstancesLayout,
{divisor:1});return a}();a.SilhouetteEdgeBufferWriter=n;var p=k.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports tslib ../../../../../core/maybe ../../../../../core/typedArrayUtil ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(n,a,d,l,k,e,c,h,m,f,b){return function(){function a(){this.regularWriter=
new f.RegularEdgeBufferWriter;this.silhouetteWriter=new f.SilhouetteEdgeBufferWriter}a.prototype.process=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f;return d.__generator(this,function(d){switch(d.label){case 0:if(l.isNone(b))return[2,this.work(a)];c=[];e=this.packInput(a,c);return[4,b.invoke("wrappedWork",e,{transferList:c})];case 1:return f=d.sent(),[2,this.unpackOutput(f)]}})})};a.prototype.wrappedWork=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,
c,e,f;return d.__generator(this,function(d){b=this.unpackInput(a);c=this.work(b);e=[];this.packInputTransferables(b,e);f=this.packOutput(c,e);return[2,{result:f,transferList:e}]})})};a.prototype.work=function(a){var c=this.extractEdgeInformation(a.data,a.skipDeduplicate,a.originalIndices);this.regularWriter.updateSettings(a.writerSettings);this.silhouetteWriter.updateSettings(a.writerSettings);return b.extractEdges(c,this.regularWriter,this.silhouetteWriter)};a.prototype.packInputTransferables=function(a,
b){b.push(a.data.buffer)};a.prototype.packInput=function(a,b){this.packInputTransferables(a,b);b={dataBuffer:a.data.buffer,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate};a.originalIndices&&(b.originalIndicesBuffer=a.originalIndices.buffer,b.originalIndicesType=k.isUint32Array(a.originalIndices)?"Uint32Array":"Uint16Array");return b};a.prototype.unpackInput=function(a){return{data:m.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===a.originalIndicesType?
new Uint32Array(a.originalIndicesBuffer):"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):void 0,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate}};a.prototype.packOutput=function(a,b){b.push(a.regular.lodInfo.lengths.buffer);b.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:h.packInterleavedBuffer(a.regular.instancesData,b),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:h.packInterleavedBuffer(a.silhouette.instancesData,
b),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:a.averageEdgeLength}};a.prototype.unpackOutput=function(a){return{regular:{instancesData:h.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:h.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};a.prototype.extractEdgeInformation=function(a,
b,d){if(b&&d)return b=c.computeNeighbors(d,a.count),{faces:d,neighbors:b,vertices:a};a=e.default(a.buffer,a.stride/4,{originalIndices:d});b=c.computeNeighbors(a.indices,a.uniqueCount);return{faces:a.indices,neighbors:b,vertices:m.EdgeInputBufferLayout.createView(a.buffer)}};return a}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.computeNeighbors=void 0;a.computeNeighbors=function(a,l){for(var d=
a.length/3,e=new Uint32Array(l+1),c=new Uint32Array(l+1),h=function(a,b){a<b?e[a+1]++:c[b+1]++},m=0;m<d;m++){var f=a[3*m],b=a[3*m+1],g=a[3*m+2];h(f,b);h(b,g);h(g,f)}for(m=b=f=0;m<l;m++)g=e[m+1],h=c[m+1],e[m+1]=f,c[m+1]=b,f+=g,b+=h;for(var p=new Uint32Array(6*d),n=e[l],h=function(a,b,d){if(a<b){var f=e[a+1]++;p[2*f]=b;p[2*f+1]=d}else f=c[b+1]++,p[2*n+2*f]=a,p[2*n+2*f+1]=d},m=0;m<d;m++)f=a[3*m],b=a[3*m+1],g=a[3*m+2],h(f,b,m),h(b,g,m),h(g,f,m);f=function(a,b){var c=2*a;a=b-a;for(b=1;b<a;b++){var d=p[c+
2*b],e=p[c+2*b+1],f=b-1;for(f;0<=f&&p[c+2*f]>d;f--)p[c+2*f+2]=p[c+2*f],p[c+2*f+3]=p[c+2*f+1];p[c+2*f+2]=d;p[c+2*f+3]=e}};for(m=0;m<l;m++)f(e[m],e[m+1]),f(n+c[m],n+c[m+1]);for(var u=new Int32Array(3*d),r=function(b,c){return b===a[3*c]?0:b===a[3*c+1]?1:b===a[3*c+2]?2:-1},d=function(a,b){a=r(a,b);u[3*b+a]=-1},f=function(a,b,c,d){a=r(a,b);u[3*b+a]=d;c=r(c,d);u[3*d+c]=b},m=0;m<l;m++){for(var b=e[m],g=e[m+1],h=c[m],q=c[m+1];b<g&&h<q;){var v=p[2*b],w=p[2*n+2*h];v===w?(f(m,p[2*b+1],w,p[2*n+2*h+1]),b++,h++):
v<w?(d(m,p[2*b+1]),b++):(d(w,p[2*n+2*h+1]),h++)}for(;b<g;)d(m,p[2*b+1]),b++;for(;h<q;)w=p[2*n+2*h],d(w,p[2*n+2*h+1]),h++}return u}})},"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","tslib","./BufferView","./InterleavedLayout"],function(n,a,d,l,k){function e(a){var b=[];a.fields.forEach(function(a,c){a=d.__assign(d.__assign({},a),{constructor:h(a.constructor)});b.push([c,a])});return{stride:a.stride,fields:b,fieldNames:a.fieldNames}}function c(a){var b=k.newLayout();
b.stride=a.stride;b.fieldNames=a.fieldNames;a.fields.forEach(function(a){return b.fields.set(a[0],d.__assign(d.__assign({},a[1]),{constructor:m.get(a[1].constructor)}))});return b}function h(a){return a.ElementType+"_"+a.ElementCount}Object.defineProperty(a,"__esModule",{value:!0});a.unpackLayout=a.packLayout=a.unpackInterleavedBuffer=a.packInterleavedBuffer=void 0;a.packInterleavedBuffer=function(a,b){b.push(a.buffer);return{buffer:a.buffer,layout:e(a.layout)}};a.unpackInterleavedBuffer=function(a){return c(a.layout).createView(a.buffer)};
a.packLayout=e;a.unpackLayout=c;n=[l.BufferViewFloat,l.BufferViewVec2f,l.BufferViewVec3f,l.BufferViewVec4f,l.BufferViewMat3f,l.BufferViewMat4f,l.BufferViewFloat64,l.BufferViewVec2f64,l.BufferViewVec3f64,l.BufferViewVec4f64,l.BufferViewMat3f64,l.BufferViewMat4f64,l.BufferViewUint8,l.BufferViewVec2u8,l.BufferViewVec3u8,l.BufferViewVec4u8,l.BufferViewUint16,l.BufferViewVec2u16,l.BufferViewVec3u16,l.BufferViewVec4u16,l.BufferViewUint32,l.BufferViewVec2u32,l.BufferViewVec3u32,l.BufferViewVec4u32,l.BufferViewInt8,
l.BufferViewVec2i8,l.BufferViewVec3i8,l.BufferViewVec4i8,l.BufferViewInt16,l.BufferViewVec2i16,l.BufferViewVec3i16,l.BufferViewVec4i16,l.BufferViewInt32,l.BufferViewVec2i32,l.BufferViewVec3i32,l.BufferViewVec4i32];var m=new Map;n.forEach(function(a){return m.set(h(a),a)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils".split(" "),
function(n,a,d,l,k,e,c,h){function m(a,b){var c=l.acosClamped(a.cosAngle),d=g.fwd,f=g.ortho;h.directionFromTo(d,a.position1,a.position0);a=0<e.vec3.dot(e.vec3.cross(f,a.faceNormal0,a.faceNormal1),d)?-1:1;return c*a>b}function f(a){var b=a.faces.length/3,c=a.faces;a=a.neighbors;for(var d=0,e=0;e<b;e++)var f=a[3*e+0],g=a[3*e+1],h=a[3*e+2],k=c[3*e+0],m=c[3*e+1],l=c[3*e+2],d=d+(-1===f||k<m?1:0),d=d+(-1===g||m<l?1:0),d=d+(-1===h||l<k?1:0);for(var d=new Int32Array(4*d),p=0,e=0;e<b;e++){f=a[3*e+0];g=a[3*
e+1];h=a[3*e+2];k=c[3*e+0];m=c[3*e+1];l=c[3*e+2];if(-1===f||k<m)d[p++]=k,d[p++]=m,d[p++]=e,d[p++]=f;if(-1===g||m<l)d[p++]=m,d[p++]=l,d[p++]=e,d[p++]=g;if(-1===h||l<k)d[p++]=l,d[p++]=k,d[p++]=e,d[p++]=h}return d}function b(a){var b=a.faces.length/3,c=a.vertices.position;a=a.faces;for(var d=p.v0,f=p.v1,g=p.v2,h=new Float32Array(3*b),k=0;k<b;k++){var m=a[3*k+1],l=a[3*k+2];c.getVec(a[3*k+0],d);c.getVec(m,f);c.getVec(l,g);e.vec3.subtract(f,f,d);e.vec3.subtract(g,g,d);e.vec3.cross(d,f,g);e.vec3.normalize(d,
d);h[3*k+0]=d[0];h[3*k+1]=d[1];h[3*k+2]=d[2]}return h}Object.defineProperty(a,"__esModule",{value:!0});a.extractEdges=void 0;a.extractEdges=function(a,c,h,p){void 0===p&&(p=t);var n=a.vertices.position,r=a.vertices.componentIndex,q=l.deg2rad(p.anglePlanar);p=l.deg2rad(p.angleSignificantEdge);var u=Math.cos(p),v=Math.cos(q),C=g.edge,E=C.position0,G=C.position1,F=C.faceNormal0,H=C.faceNormal1,J=b(a),I=f(a),K=I.length/4;a=c.allocate(K);p=0;var L=h.allocate(K),M=0,Q=0,R=0,O=d.range(0,K),N=new Float32Array(K);
k.forEach(N,function(a,b,c){n.getVec(I[4*b+0],E);n.getVec(I[4*b+1],G);c[b]=e.vec3.distance(E,G)});O.sort(function(a,b){return N[b]-N[a]});for(var S=[],P=[],U=0;U<K;U++){var Z=O[U],V=N[Z],T=I[4*Z+0],Y=I[4*Z+1],X=I[4*Z+2],Z=I[4*Z+3],ca=-1===Z;n.getVec(T,E);n.getVec(Y,G);if(ca)e.vec3.set(F,J[3*X+0],J[3*X+1],J[3*X+2]),e.vec3.copy(H,F),C.componentIndex=r.get(T),C.cosAngle=e.vec3.dot(F,H);else{e.vec3.set(F,J[3*X+0],J[3*X+1],J[3*X+2]);e.vec3.set(H,J[3*Z+0],J[3*Z+1],J[3*Z+2]);C.componentIndex=r.get(T);C.cosAngle=
e.vec3.dot(F,H);if(C.cosAngle>v)continue;-.9999>C.cosAngle&&e.vec3.copy(H,F)}Q+=V;R++;ca||C.cosAngle<u?(c.write(a,p++,C),S.push(V)):m(C,q)&&(h.write(L,M++,C),P.push(V))}r=new Float32Array(S.reverse());q=new Float32Array(P.reverse());return{regular:{instancesData:c.trim(a,p),lodInfo:{lengths:r}},silhouette:{instancesData:h.trim(L,M),lodInfo:{lengths:q}},averageEdgeLength:Q/R}};var g={edge:{position0:c.vec3f64.create(),position1:c.vec3f64.create(),faceNormal0:c.vec3f64.create(),faceNormal1:c.vec3f64.create(),
componentIndex:0,cosAngle:0},ortho:c.vec3f64.create(),fwd:c.vec3f64.create()},p={v0:c.vec3f64.create(),v1:c.vec3f64.create(),v2:c.vec3f64.create()},t={anglePlanar:4,angleSignificantEdge:35}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports tslib ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../collections/Component/Material/ComponentTechnique ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderTechnique".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){Object.defineProperty(a,"__esModule",{value:!0});a.componentDataBindParameters=a.EdgeRenderer=a.EXTENSION_LENGTH_OFFSET=a.LINE_WIDTH_FRACTION_FACTOR=void 0;a.LINE_WIDTH_FRACTION_FACTOR=8;a.EXTENSION_LENGTH_OFFSET=128;var q={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0},v=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0});
a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}(),w={solid:0,sketch:1,uber:2};n=function(){function f(a,b,c){var g,h,k;this.rctx=a;this.shaderTechniqueRepository=b;this.config=new r.EdgeShaderTechnique.Configuration;this.technique=null;this.refCount=new v;this.renderables=new Set;this.sortedRenderables=(g={},g[1]=(h={},h[1]=new e,h[2]=new e,h),g[2]=(k={},k[1]=new e,k[2]=new e,k),g);this.renderablesDirty=!1;this.settings=d.__assign(d.__assign({},
q),c);this.key=f.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);this.writerSettings={variants:this.settings.strokesTexture.variants};this.config.legacy=this.settings.legacy;this.config.mode=w[this.settings.type];this.config.silhouette=!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=t.doublePrecisionRequiresObfuscation(a)}f.prototype.dispose=
function(){this.technique&&(this.shaderTechniqueRepository.release(this.technique),this.technique=null)};f.prototype.addRenderable=function(a){this.renderables.add(a);this.renderablesDirty=!0};f.prototype.removeRenderable=function(a){this.renderables.delete(a);this.renderablesDirty=!0};f.prototype.setRenderablesDirty=function(){this.renderablesDirty=!0};f.prototype.forEachRenderable=function(a,b){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[b][1].forEachSimple(a);this.sortedRenderables[b][2].forEachSimple(a)};
f.prototype.bindRegularEdges=function(a,b){this.config.silhouette=!1;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(r.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass(this.rctx,{bindParameters:a,edgeRenderParameters:b});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};f.prototype.bindSilhouetteEdges=function(a,b){this.config.silhouette=!0;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(r.EdgeShaderTechnique,
this.config,this.technique);this.technique.bindPass(this.rctx,{bindParameters:a,edgeRenderParameters:b});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};f.prototype.renderRegularEdges=function(a,b,c){this.render(this.technique.program,a,a.regular.vao,b,c)};f.prototype.renderSilhouetteEdges=function(a,b,c){this.render(this.technique.program,a,a.silhouette.vao,b,c)};f.prototype.render=function(a,b,c,d,e){this.setUniforms(a,b,d);this.rctx.bindVAO(c);
this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,e)};f.prototype.setUniforms=function(d,e,f){e.components.buffer.textureBuffer.bind(d,a.componentDataBindParameters);if("origin"in e.transform)d.setUniformMatrix4fv("uView",f.localViewMatrixForEdges),d.setUniformMatrix4fv("uModel",e.transform.modelMatrix),g.Slice.bindUniforms(d,this.settings,f.slicePlane,e.transform.origin.vec3);else{var h=new u.TwoVectorPosition(e.transform.position),k=c.mat3.transpose(z,c.mat3.invert(z,e.transform.rotationScale)),
l=new b.ComponentDrawParameters;m.vec3.copy(l.worldFromModel_TL,h.low);m.vec3.copy(l.worldFromModel_TH,h.high);c.mat3.copy(l.worldFromModel_RS,e.transform.rotationScale);c.mat3.copy(l.transformNormal_GlobalFromModel,k);p.VertexPosition.bindModelTransform(d,l);d.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",l.transformNormal_GlobalFromModel);e=f.camera.viewInverseTransposeMatrix;e=m.vec3.set(x,e[3],e[7],e[11]);g.Slice.bindUniforms(d,this.settings,f.slicePlane,e)}"uber"!==this.settings.type&&
"sketch"!==this.settings.type||this.setSketchUniforms(d);d.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(f.camera.fovY/2)/(f.camera.fullViewport[3]/2))};f.prototype.setSketchUniforms=function(a){var b=this.settings.strokesTexture,c=b.texture;k.isNone(c)||(this.rctx.bindTexture(c,0),a.setUniform1i("uStrokesTexture",0),a.setUniform2f("uStrokesTextureScale",1/c.descriptor.width,1/c.descriptor.height),a.setUniform1f("uStrokesLog2Resolution",l.log2(b.resolution)),a.setUniform1f("uStrokesNormalizationScale",
b.normalizationScale),a.setUniform1f("uStrokesAmplitude",b.amplitude),a.setUniform1f("uStrokeVariants",b.variants))};f.prototype.sortRenderables=function(){var a=this;this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();this.sortedRenderables[2][2].clear();this.renderables.forEach(function(b){0!==b.objectTransparency&&0!==b.edgeTransparency&&a.sortedRenderables[b.objectTransparency][b.edgeTransparency].push(b)});var b=
function(a,b){return"origin"in a.transform&&"origin"in b.transform?a.transform.origin.id<b.transform.origin.id?-1:a.transform.origin.id>b.transform.origin.id?1:0:0};this.sortedRenderables[1][1].sort(b);this.sortedRenderables[1][2].sort(b);this.sortedRenderables[2][1].sort(b);this.sortedRenderables[2][2].sort(b)};f.getKey=function(a,b,c){return"edges-t:"+a+":"+b+":"+c};return f}();a.EdgeRenderer=n;a.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2};
var z=h.mat3f32.create(),x=f.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports tslib ../../../../webgl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl ../../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.EdgeShaderTechnique=void 0;c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype.bindPass=function(a,b){a=this.program;var c=b.edgeRenderParameters;b=b.bindParameters;k.VertexPosition.bindViewProjTransform(a,c.viewProjectionTransform);a.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",c.transformNormal_ViewFromGlobal);a.setUniformMatrix4fv("uProj",b.camera.projectionMatrix);
a.setUniform2f("uDepthBias",.5,-4E-4);a.setUniform2f("uPixelToNDC",2/b.camera.fullViewport[2],2/b.camera.fullViewport[3]);a.setUniform2f("uNDCToPixel",b.camera.fullViewport[2]/2,b.camera.fullViewport[3]/2);a.setUniform1f("uDistanceFalloffFactor",c.distanceFalloffFactor);a.setUniform2f("uViewportDimInv",1/b.camera.fullViewport[2],1/b.camera.fullViewport[3]);a.setUniform1f("uPixelRatio",b.camera.pixelRatio||1)};b.prototype.initializeProgram=function(a){var c=b.shader.get(),d=this.configuration,d=c.build({slicePlaneEnabled:d.slicePlaneEnabled,
sliceHighlightDisabled:d.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,silhouette:d.silhouette,legacy:d.legacy,antialiasing:d.antialiasing,mode:d.mode,doublePrecisionRequiresObfuscation:d.doublePrecisionRequiresObfuscation});return new l.Program(a.rctx,d.generateSource("vertex"),d.generateSource("fragment"),c.attributeLocations)};b.prototype.initializePipeline=function(a){return(a=a.rctx.capabilities.blendMinMax)?f.makePipelineState({blending:f.separateBlendingParams(1,1,0,1,32774,a.MAX),
depthTest:{func:515},colorWrite:f.defaultColorWriteParams}):f.makePipelineState({depthTest:{func:515},depthWrite:f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams})};b.shader=new e.ReloadableShaderModule(m,function(){return new Promise(function(a,b){n(["../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl"],a,b)})});return b}(c.ShaderTechnique);a.EdgeShaderTechnique=c;(function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.slicePlaneEnabled=!1;
b.sliceHighlightDisabled=!1;b.silhouette=!1;b.legacy=!1;b.antialiasing=!1;b.mode=0;b.doublePrecisionRequiresObfuscation=!1;return b}d.__extends(b,a);d.__decorate([h.parameter()],b.prototype,"slicePlaneEnabled",void 0);d.__decorate([h.parameter()],b.prototype,"sliceHighlightDisabled",void 0);d.__decorate([h.parameter()],b.prototype,"silhouette",void 0);d.__decorate([h.parameter()],b.prototype,"legacy",void 0);d.__decorate([h.parameter()],b.prototype,"antialiasing",void 0);d.__decorate([h.parameter({count:3})],
b.prototype,"mode",void 0);d.__decorate([h.parameter()],b.prototype,"doublePrecisionRequiresObfuscation",void 0);return b}(h.ShaderTechniqueConfiguration);a.Configuration=b})(c=a.EdgeShaderTechnique||(a.EdgeShaderTechnique={}));a.EdgeShaderTechnique=c})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeShaderProgram.glsl":function(){define("require exports tslib ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderModules/interfaces ../../../core/shaderModules/ShaderBuilder ./AdjustProjectedPosition.glsl ./DiscardByCoverage.glsl ./DiscardNonSilhouetteEdges.glsl ./DiscardShortEdges.glsl ./EdgeUtil.glsl ./LineAmplitude.glsl ./LineOffset.glsl ./UnpackAttributes.glsl".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){Object.defineProperty(a,"__esModule",{value:!0});a.build=a.attributeLocations=void 0;a.attributeLocations={position0:0,position1:1,componentIndex:2,packedAttributes:3,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9};a.build=function(a){var n=new e.ShaderBuilder,w=n.vertex,B=n.fragment;a.legacy&&w.uniforms.add("uModel","mat4");a.antialiasing&&(w.code.add(k.glsl(u||(u=d.__makeTemplateObject(["\n      #define ANTIALIASING 1\n    "],
["\n      #define ANTIALIASING 1\n    "])))),B.code.add(k.glsl(r||(r=d.__makeTemplateObject(["\n      #define ANTIALIASING 1\n    "],["\n      #define ANTIALIASING 1\n    "])))));n.include(c.AdjustProjectedPosition,a);n.include(g.LineAmplitude,a);n.include(b.EdgeUtil,a);n.include(t.UnpackAttributes,a);n.include(p.LineOffset,a);n.include(l.Slice,a);n.include(m.DiscardNonSilhouetteEdges,a);n.include(h.DiscardByCoverage,a);n.include(f.DiscardShortEdges,a);n.varyings.add("vColor","vec4");n.varyings.add("vRadius",
"float");n.varyings.add("vPosition","vec3");n.varyings.add("vWorldPosition","vec3");n.varyings.add("vLineLengthPixels","float");n.varyings.add("vSizeFalloffFactor","float");w.uniforms.add("uPixelToNDC","vec2");w.uniforms.add("uNDCToPixel","vec2");w.uniforms.add("uPixelRatio","float");n.attributes.add("position0","vec3");n.attributes.add("position1","vec3");n.attributes.add("variantOffset","float");n.attributes.add("variantStroke","float");n.attributes.add("variantExtension","float");w.code.add(k.glsl(q||
(q=d.__makeTemplateObject(["\n    const float opaqueCutoff \x3d 1.0 / 255.0;\n\n    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n      vec2 sideness \x3d unpackedAttributes.sideness;\n      vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n      vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n      vec3 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\n\n      vec4 projPosV0 \x3d projFromViewPosition(viewPosV0);\n      vec4 projPosV1 \x3d projFromViewPosition(viewPosV1);\n      vec4 projPos \x3d projFromViewPosition(viewPos);\n\n      vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n      vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\n      float lineLengthPixels \x3d length(screenSpaceLinePixels);\n\n      float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\n      vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n      float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n      float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\n\n      float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n      float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n      vSizeFalloffFactor \x3d falloffFactor;\n\n      float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n      float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n    #ifdef ANTIALIASING\n      const float aaPaddingPixels \x3d 1.0;\n\n      // Line size with padding\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n      float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\n    #else /* ANTIALIASING */\n\n      // Even if there is no AA, we still want to do proper \x3c1px rendering,\n      // so we effectively clamp the pixel sizes to minimum of 1px and compute\n      // coverage in the fragment shader\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n      float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\n    #endif /* ANTIALIASING */\n\n      // Half line width in NDC including padding for anti aliasing\n      vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n      vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\n      vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\n\n      // Compute screen space position of vertex, offsetting for line size and end caps\n      vec2 ndcOffset \x3d (\n          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n      );\n\n      projPos.xy +\x3d ndcOffset * projPos.w;\n      projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n      projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n      // Line length with end caps\n      float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n      float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n      // Position in pixels with origin at first vertex of line segment\n      vPosition \x3d vec3(\n        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n        pixelPositionAlongLine,\n        pixelPositionAlongLine / extendedLineLengthPixels\n      );\n\n      // The line width radius in pixels\n      vRadius \x3d lineWidthPixels * 0.5;\n      vLineLengthPixels \x3d extendedLineLengthPixels;\n\n      // discard edges below a certain length threshold\n      discardShortEdges(unpackedAttributes, lineLengthPixels);\n\n      gl_Position \x3d projPos;\n    }\n\n    void main() {\n      ComponentData component \x3d readComponentData();\n      UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\n\n      vec3 worldPosV0 \x3d worldFromModelPosition(position0);\n      vec3 worldPosV1 \x3d worldFromModelPosition(position1);\n      vec3 viewPosV0 \x3d viewFromModelPosition(position0);\n      vec3 viewPosV1 \x3d viewFromModelPosition(position1);\n\n      // Component color\n      vColor \x3d component.color;\n\n      // Discard fully transparent edges\n      if (vColor.a \x3c opaqueCutoff) {\n        gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n        return;\n      }\n\n      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {\n        return;\n      }\n\n      // General geometric computation for all types of edges\n      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);\n\n      // Specific computation for different edge styles\n      calculateStyleOutputs(unpackedAttributes);\n    }\n  "],
["\n    const float opaqueCutoff \x3d 1.0 / 255.0;\n\n    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n      vec2 sideness \x3d unpackedAttributes.sideness;\n      vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n      vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n      vec3 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\n\n      vec4 projPosV0 \x3d projFromViewPosition(viewPosV0);\n      vec4 projPosV1 \x3d projFromViewPosition(viewPosV1);\n      vec4 projPos \x3d projFromViewPosition(viewPos);\n\n      vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n      vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\n      float lineLengthPixels \x3d length(screenSpaceLinePixels);\n\n      float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\n      vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n      float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n      float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\n\n      float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n      float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n      vSizeFalloffFactor \x3d falloffFactor;\n\n      float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n      float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n    #ifdef ANTIALIASING\n      const float aaPaddingPixels \x3d 1.0;\n\n      // Line size with padding\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n      float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\n    #else /* ANTIALIASING */\n\n      // Even if there is no AA, we still want to do proper \x3c1px rendering,\n      // so we effectively clamp the pixel sizes to minimum of 1px and compute\n      // coverage in the fragment shader\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n      float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\n    #endif /* ANTIALIASING */\n\n      // Half line width in NDC including padding for anti aliasing\n      vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n      vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\n      vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\n\n      // Compute screen space position of vertex, offsetting for line size and end caps\n      vec2 ndcOffset \x3d (\n          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n      );\n\n      projPos.xy +\x3d ndcOffset * projPos.w;\n      projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n      projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n      // Line length with end caps\n      float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n      float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n      // Position in pixels with origin at first vertex of line segment\n      vPosition \x3d vec3(\n        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n        pixelPositionAlongLine,\n        pixelPositionAlongLine / extendedLineLengthPixels\n      );\n\n      // The line width radius in pixels\n      vRadius \x3d lineWidthPixels * 0.5;\n      vLineLengthPixels \x3d extendedLineLengthPixels;\n\n      // discard edges below a certain length threshold\n      discardShortEdges(unpackedAttributes, lineLengthPixels);\n\n      gl_Position \x3d projPos;\n    }\n\n    void main() {\n      ComponentData component \x3d readComponentData();\n      UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\n\n      vec3 worldPosV0 \x3d worldFromModelPosition(position0);\n      vec3 worldPosV1 \x3d worldFromModelPosition(position1);\n      vec3 viewPosV0 \x3d viewFromModelPosition(position0);\n      vec3 viewPosV1 \x3d viewFromModelPosition(position1);\n\n      // Component color\n      vColor \x3d component.color;\n\n      // Discard fully transparent edges\n      if (vColor.a \x3c opaqueCutoff) {\n        gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n        return;\n      }\n\n      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {\n        return;\n      }\n\n      // General geometric computation for all types of edges\n      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);\n\n      // Specific computation for different edge styles\n      calculateStyleOutputs(unpackedAttributes);\n    }\n  "]))));
n.fragment.code.add(k.glsl(v||(v=d.__makeTemplateObject(["\n    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n      float lineOffset \x3d calculateLineOffset();\n      float positionX \x3d position.x - lineOffset;\n\n      if (radius \x3c 1.0) {\n        // Handle this specifically for subpixel sizes:\n        // 1. Compute correct coverage (note coverage is computed by\n        //    0.5 - dist, so we make sure that that will lead to correct\n        //    subpixel coverage\n        // 2. Ignore rounded caps\n        float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n        float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n        float coverage \x3d min(coverageX, coverageY);\n\n        return vec2(0.5 - coverage, 0.0);\n      }\n      else {\n        // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\n        float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\n\n        vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\n        return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n      }\n    }\n\n    void main() {\n      float radius \x3d vRadius * calculateLinePressure();\n\n      vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n      float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\n\n      discardByCoverage(radius, coverage);\n      discardBySlice(vWorldPosition);\n\n      float alpha \x3d vColor.a * coverage;\n\n      gl_FragColor \x3d vec4(vColor.rgb, alpha);\n\n    }\n  "],
["\n    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n      float lineOffset \x3d calculateLineOffset();\n      float positionX \x3d position.x - lineOffset;\n\n      if (radius \x3c 1.0) {\n        // Handle this specifically for subpixel sizes:\n        // 1. Compute correct coverage (note coverage is computed by\n        //    0.5 - dist, so we make sure that that will lead to correct\n        //    subpixel coverage\n        // 2. Ignore rounded caps\n        float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n        float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n        float coverage \x3d min(coverageX, coverageY);\n\n        return vec2(0.5 - coverage, 0.0);\n      }\n      else {\n        // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\n        float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\n\n        vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\n        return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n      }\n    }\n\n    void main() {\n      float radius \x3d vRadius * calculateLinePressure();\n\n      vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n      float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\n\n      discardByCoverage(radius, coverage);\n      discardBySlice(vWorldPosition);\n\n      float alpha \x3d vColor.a * coverage;\n\n      gl_FragColor \x3d vec4(vColor.rgb, alpha);\n\n    }\n  "]))));
return n};var u,r,q,v})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("require exports tslib ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/interfaces".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.AdjustProjectedPosition=void 0;a.AdjustProjectedPosition=function(a,b){a.vertex.include(k.IsNaN);a.include(l.VertexPosition,
b);a=a.vertex;a.uniforms.add("uDepthBias","vec2");a.uniforms.add("uViewportDimInv","vec2");b.legacy?(a.uniforms.add("uView","mat4"),a.uniforms.add("uProj","mat4")):a.uniforms.add("uTransformNormal_ViewFromGlobal","mat3");b.legacy?a.code.add(e.glsl(c||(c=d.__makeTemplateObject(["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uProj * uView * vec4(globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "],
["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uProj * uView * vec4(globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "])))):
a.code.add(e.glsl(h||(h=d.__makeTemplateObject(["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "],
["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "]))));
a.code.add(e.glsl(m||(m=d.__makeTemplateObject(["\n    // A z-offset, using a depth based heuristic.\n    float _calculateProjectedBiasZ(vec4 projPos) {\n      float offsetZ \x3d uDepthBias.y;\n      return sqrt(projPos.z) * offsetZ;\n    }\n\n    vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n      vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\n\n      // we currently have to do this check because some geometries come with 0 length edge normals.\n      // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n      if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\n        projPos.xy +\x3d offsetXY;\n      }\n\n      projPos.z +\x3d _calculateProjectedBiasZ(projPos);\n\n      return projPos;\n    }\n  "],
["\n    // A z-offset, using a depth based heuristic.\n    float _calculateProjectedBiasZ(vec4 projPos) {\n      float offsetZ \x3d uDepthBias.y;\n      return sqrt(projPos.z) * offsetZ;\n    }\n\n    vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n      vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\n\n      // we currently have to do this check because some geometries come with 0 length edge normals.\n      // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n      if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\n        projPos.xy +\x3d offsetXY;\n      }\n\n      projPos.z +\x3d _calculateProjectedBiasZ(projPos);\n\n      return projPos;\n    }\n  "]))))};
var c,h,m})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.IsNaN=void 0;a.IsNaN=function(a){var c=l.glsl(k||(k=d.__makeTemplateObject(["\n    bool isNaN( float val )\n    {\n      return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\n      // important: some nVidias failed to cope with version below.\n      // Probably wrong optimization.\n      /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\n    }\n  "],
["\n    bool isNaN( float val )\n    {\n      return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\n      // important: some nVidias failed to cope with version below.\n      // Probably wrong optimization.\n      /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\n    }\n  "])));a.code.add(c)};var k})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["require","exports","tslib","../../../core/shaderModules/interfaces"],
function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.DiscardByCoverage=void 0;a.DiscardByCoverage=function(a,h){a=a.fragment;a.defines.addFloat("COVERAGE_TEST_THRESHOLD",.01);h.antialiasing?a.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n      #define discardByCoverage(radius, coverage) { if (coverage \x3c COVERAGE_TEST_THRESHOLD) discard; }\n    "],["\n      #define discardByCoverage(radius, coverage) { if (coverage \x3c COVERAGE_TEST_THRESHOLD) discard; }\n    "])))):a.code.add(l.glsl(e||
(e=d.__makeTemplateObject(["\n      #define discardByCoverage(radius, coverage) { float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75; if (coverage \x3c coverageLimit) discard; }\n    "],["\n      #define discardByCoverage(radius, coverage) { float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75; if (coverage \x3c coverageLimit) discard; }\n    "]))))};var k,e})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["require",
"exports","tslib","../../../core/shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.DiscardNonSilhouetteEdges=void 0;a.DiscardNonSilhouetteEdges=function(a,f){a=a.vertex;f.silhouette?(a.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n      bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {\n        float faceAVisible \x3d dot(viewDir, normalA);\n        float faceBVisible \x3d dot(viewDir, normalB);\n        return faceAVisible * faceBVisible \x3c 0.0;\n      }\n    "],
["\n      bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {\n        float faceAVisible \x3d dot(viewDir, normalA);\n        float faceBVisible \x3d dot(viewDir, normalB);\n        return faceAVisible * faceBVisible \x3c 0.0;\n      }\n    "])))),f.legacy?a.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 viewNormalA \x3d _modelToViewNormal(normalA);\n          vec3 viewNormalB \x3d _modelToViewNormal(normalB);\n          vec3 viewDir \x3d -viewPos;\n\n          if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "],
["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 viewNormalA \x3d _modelToViewNormal(normalA);\n          vec3 viewNormalB \x3d _modelToViewNormal(normalB);\n          vec3 viewDir \x3d -viewPos;\n\n          if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "])))):a.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 worldNormalA \x3d _modelToWorldNormal(normalA);\n          vec3 worldNormalB \x3d _modelToWorldNormal(normalB);\n          vec3 viewDir \x3d -worldPos;\n\n          if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "],
["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 worldNormalA \x3d _modelToWorldNormal(normalA);\n          vec3 worldNormalB \x3d _modelToWorldNormal(normalB);\n          vec3 viewDir \x3d -worldPos;\n\n          if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "]))))):a.code.add(l.glsl(h||(h=d.__makeTemplateObject(["\n      bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n        return false;\n      }\n    "],
["\n      bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n        return false;\n      }\n    "]))))};var k,e,c,h})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["require","exports","tslib","../../../core/shaderModules/interfaces"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.DiscardShortEdges=void 0;a.DiscardShortEdges=function(a,m){a=a.vertex;switch(m.mode){case 1:a.code.add(l.glsl(k||(k=d.__makeTemplateObject(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "],
["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "]))));break;case 2:a.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "],["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "]))));
break;case 0:a.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) {}\n      "],["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) {}\n      "]))))}};var k,e,c})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define(["require","exports","tslib","../../../core/shaderLibrary/util/DoublePrecision.glsl","../../../core/shaderModules/interfaces"],function(n,a,d,l,k){function e(a,
e){var n=a.vertex;n.uniforms.add("uDistanceFalloffFactor","float");n.code.add(k.glsl(c||(c=d.__makeTemplateObject(["\n    float distanceBasedPerspectiveFactor(float distance) {\n      return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n    }\n  "],["\n    float distanceBasedPerspectiveFactor(float distance) {\n      return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n    }\n  "]))));n.uniforms.add("uComponentDataTex","sampler2D");n.uniforms.add("uComponentDataTexInvDim",
"vec2");a.attributes.add("componentIndex","float");n.defines.addFloat("COMPONENT_COLOR_FIELD_OFFSET",0);n.defines.addFloat("COMPONENT_OTHER_FIELDS_OFFSET",1);n.defines.addFloat("COMPONENT_FIELD_COUNT",2);n.defines.addFloat("LINE_WIDTH_FRACTION_FACTOR",8);n.defines.addFloat("EXTENSION_LENGTH_OFFSET",128);n.defines.addFloat("COMPONENT_TEX_WIDTH",4096);n.code.add(k.glsl(h||(h=d.__makeTemplateObject(["\n    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {\n      float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n      float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\n      float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n      vec2 linearIndex \x3d vec2(\n        (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n        (rowIndex + 0.5) * uComponentDataTexInvDim.y\n      );\n\n      return linearIndex;\n    }\n\n    struct ComponentData {\n      vec4 color;\n      float lineWidth;\n      float extensionLength;\n      float type;\n    };\n\n    ComponentData readComponentData() {\n      vec2 colorIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n      vec2 otherIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n      vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\n      vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\n\n      return ComponentData(\n        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n        otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n        otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n        -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\n      );\n    }\n  "],
["\n    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {\n      float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n      float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\n      float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n      vec2 linearIndex \x3d vec2(\n        (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n        (rowIndex + 0.5) * uComponentDataTexInvDim.y\n      );\n\n      return linearIndex;\n    }\n\n    struct ComponentData {\n      vec4 color;\n      float lineWidth;\n      float extensionLength;\n      float type;\n    };\n\n    ComponentData readComponentData() {\n      vec2 colorIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n      vec2 otherIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n      vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\n      vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\n\n      return ComponentData(\n        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n        otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n        otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n        -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\n      );\n    }\n  "]))));
e.legacy?n.code.add(k.glsl(m||(m=d.__makeTemplateObject(["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return (uModel * vec4(normal, 0.0)).xyz;\n      }\n\n      vec3 _modelToViewNormal(vec3 normal) {\n        return (uView * uModel * vec4(normal, 0.0)).xyz;\n      }\n    "],["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return (uModel * vec4(normal, 0.0)).xyz;\n      }\n\n      vec3 _modelToViewNormal(vec3 normal) {\n        return (uView * uModel * vec4(normal, 0.0)).xyz;\n      }\n    "])))):
(n.uniforms.add("uTransformNormal_GlobalFromModel ","mat3"),n.code.add(k.glsl(f||(f=d.__makeTemplateObject(["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return uTransformNormal_GlobalFromModel * normal;\n      }\n    "],["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return uTransformNormal_GlobalFromModel * normal;\n      }\n    "])))));e.silhouette?(a.attributes.add("normalA","vec3"),a.attributes.add("normalB","vec3"),n.code.add(k.glsl(b||(b=d.__makeTemplateObject(["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normalize(normalA + normalB));\n      }\n    "],
["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normalize(normalA + normalB));\n      }\n    "]))))):(a.attributes.add("normal","vec3"),n.code.add(k.glsl(g||(g=d.__makeTemplateObject(["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normal);\n      }\n    "],["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normal);\n      }\n    "])))));e.legacy?n.code.add(k.glsl(p||(p=d.__makeTemplateObject(["\n      vec3 worldFromModelPosition(vec3 position) {\n        return (uModel * vec4(position, 1.0)).xyz;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uProj * vec4(position, 1.0);\n      }\n    "],
["\n      vec3 worldFromModelPosition(vec3 position) {\n        return (uModel * vec4(position, 1.0)).xyz;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uProj * vec4(position, 1.0);\n      }\n    "])))):(a.vertex.include(l.DoublePrecision,e),n.code.add(k.glsl(t||(t=d.__makeTemplateObject(["\n      vec3 worldFromModelPosition(vec3 position) {\n        vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * position;\n\n        vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n          uTransform_WorldFromModel_TL,\n          uTransform_WorldFromModel_TH,\n          -uTransform_WorldFromView_TL,\n          -uTransform_WorldFromView_TH\n        );\n\n        return transform_CameraRelativeFromModel + rotatedModelPosition;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uTransform_ProjFromView * vec4(position, 1.0);\n      }\n    "],
["\n      vec3 worldFromModelPosition(vec3 position) {\n        vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * position;\n\n        vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n          uTransform_WorldFromModel_TL,\n          uTransform_WorldFromModel_TH,\n          -uTransform_WorldFromView_TL,\n          -uTransform_WorldFromView_TH\n        );\n\n        return transform_CameraRelativeFromModel + rotatedModelPosition;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uTransform_ProjFromView * vec4(position, 1.0);\n      }\n    "])))));
n.code.add(k.glsl(u||(u=d.__makeTemplateObject(["\n    float calculateExtensionLength(float extensionLength, float lineLength) {\n      return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n    }\n  "],["\n    float calculateExtensionLength(float extensionLength, float lineLength) {\n      return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n    }\n  "]))))}Object.defineProperty(a,"__esModule",{value:!0});a.EdgeUtil=void 0;a.EdgeUtil=e;(function(a){a.usesSketchLogic=
function(a){return 1===a.mode||2===a.mode};a.usesSolidLogic=function(a){return 0===a.mode||2===a.mode}})(e=a.EdgeUtil||(a.EdgeUtil={}));var c,h,m,f,b,g,p,t,u})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define("require exports tslib ../../../core/shaderModules/interfaces ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.LineAmplitude=void 0;a.LineAmplitude=function(a,b){var f=a.vertex;
a.include(e.UnpackAttributes,b);k.EdgeUtil.usesSketchLogic(b)&&f.uniforms.add("uStrokesAmplitude","float");switch(b.mode){case 0:f.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return 0.0;\n        }\n      "],["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return 0.0;\n        }\n      "]))));break;case 1:f.code.add(l.glsl(h||(h=d.__makeTemplateObject(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return uStrokesAmplitude;\n        }\n      "],
["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return uStrokesAmplitude;\n        }\n      "]))));break;case 2:f.code.add(l.glsl(m||(m=d.__makeTemplateObject(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          float type \x3d unpackedAttributes.type;\n\n          if (type \x3c\x3d 0.0) {\n            return uStrokesAmplitude;\n          }\n          else {\n            return 0.0;\n          }\n        }\n      "],
["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          float type \x3d unpackedAttributes.type;\n\n          if (type \x3c\x3d 0.0) {\n            return uStrokesAmplitude;\n          }\n          else {\n            return 0.0;\n          }\n        }\n      "]))))}};var c,h,m})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["require","exports","tslib","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],
function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.UnpackAttributes=void 0;a.UnpackAttributes=function(a,g){var b=a.vertex;a.include(k.EdgeUtil,g);a.attributes.add("sideness","vec2");2===g.mode?b.code.add(l.glsl(e||(e=d.__makeTemplateObject(["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n        float type;\n      };\n    "],["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n        float type;\n      };\n    "])))):
b.code.add(l.glsl(c||(c=d.__makeTemplateObject(["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n      };\n  "],["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n      };\n  "]))));switch(g.mode){case 2:b.code.add(l.glsl(h||(h=d.__makeTemplateObject(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float fType \x3d component.type;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          if (fType \x3c\x3d 0.0) {\n            extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          }\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n        }\n      "],
["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float fType \x3d component.type;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          if (fType \x3c\x3d 0.0) {\n            extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          }\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n        }\n      "]))));
break;case 1:b.code.add(l.glsl(m||(m=d.__makeTemplateObject(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "],
["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "]))));break;case 0:b.code.add(l.glsl(f||
(f=d.__makeTemplateObject(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "],["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "]))))}};
var e,c,h,m,f})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("require exports tslib ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/interfaces ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.LineOffset=void 0;a.LineOffset=function(a,n){var r=a.vertex;a.include(c.UnpackAttributes,n);var q=a.fragment;e.EdgeUtil.usesSketchLogic(n)&&(r.uniforms.add("uStrokesTextureScale",
"vec2"),r.uniforms.add("uStrokesLog2Resolution","float"),r.uniforms.add("uStrokeVariants","float"),a.varyings.add("vStrokeUV","vec2"),q.uniforms.add("uStrokesTexture","sampler2D"),q.uniforms.add("uStrokesNormalizationScale","float"),r.code.add(k.glsl(h||(h=d.__makeTemplateObject(["\n      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n        vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n        float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n        vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;\n        vStrokeUV.x +\x3d variantOffset;\n      }\n    "],
["\n      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n        vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n        float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n        vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;\n        vStrokeUV.x +\x3d variantOffset;\n      }\n    "])))),a.fragment.include(l.RgbaFloatEncoding),
q.code.add(k.glsl(m||(m=d.__makeTemplateObject(["\n      float calculateLineOffsetSketch() {\n        float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n        return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n      }\n\n      float calculateLinePressureSketch() {\n        return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n      }\n    "],["\n      float calculateLineOffsetSketch() {\n        float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n        return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n      }\n\n      float calculateLinePressureSketch() {\n        return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n      }\n    "])))));
switch(n.mode){case 0:r.code.add(k.glsl(f||(f=d.__makeTemplateObject(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}\n      "],["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}\n      "]))));q.code.add(k.glsl(b||(b=d.__makeTemplateObject(["\n        float calculateLineOffset() {\n          return 0.0;\n        }\n\n        float calculateLinePressure() {\n          return 1.0;\n        }\n      "],["\n        float calculateLineOffset() {\n          return 0.0;\n        }\n\n        float calculateLinePressure() {\n          return 1.0;\n        }\n      "]))));
break;case 1:r.code.add(k.glsl(g||(g=d.__makeTemplateObject(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n        }\n      "],["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n        }\n      "]))));q.code.add(k.glsl(p||(p=d.__makeTemplateObject(["\n        float calculateLineOffset() {\n          return calculateLineOffsetSketch();\n        }\n\n        float calculateLinePressure() {\n          return calculateLinePressureSketch();\n        }\n      "],
["\n        float calculateLineOffset() {\n          return calculateLineOffsetSketch();\n        }\n\n        float calculateLinePressure() {\n          return calculateLinePressureSketch();\n        }\n      "]))));break;case 2:a.varyings.add("vType","float"),r.code.add(k.glsl(t||(t=d.__makeTemplateObject(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          vType \x3d unpackedAttributes.type;\n\n          if (unpackedAttributes.type \x3c\x3d 0.0) {\n            calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n          }\n        }\n      "],
["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          vType \x3d unpackedAttributes.type;\n\n          if (unpackedAttributes.type \x3c\x3d 0.0) {\n            calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n          }\n        }\n      "])))),q.code.add(k.glsl(u||(u=d.__makeTemplateObject(["\n        float calculateLineOffset() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLineOffsetSketch();\n          }\n          else {\n            return 0.0;\n          }\n        }\n\n        float calculateLinePressure() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLinePressureSketch();\n          }\n          else {\n            return 1.0;\n          }\n        }\n      "],
["\n        float calculateLineOffset() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLineOffsetSketch();\n          }\n          else {\n            return 0.0;\n          }\n        }\n\n        float calculateLinePressure() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLinePressureSketch();\n          }\n          else {\n            return 1.0;\n          }\n        }\n      "]))))}};var h,m,f,b,g,p,t,u})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/mathUtils ../../../../../core/maybe ../Util ../../../../webgl/Texture".split(" "),
function(n,a,d,l,k,e){function c(a,c){if(!a)return null;var b=a.length/2,d=h*b,b=Array(b),e=0;c=1===c;for(var f=0;f<a.length;f+=2){var g=(a[f]+a[f+1])/2;c?b[e++]=Math.min(d,1-(1-g)*m):b[e++]=Math.min(d,g*m)}return b}Object.defineProperty(a,"__esModule",{value:!0});a.strokesDefinition=a.StrokesTexture=a.rasterizeStrokes=a.generateStrokesTexture=void 0;a.generateStrokesTexture=function(b){for(var g=a.strokesDefinition.resolution,h=g/2,m=new Uint8Array(4*g*g),l=4*g*h,h=a.strokesDefinition.amplitude,
n=2*h,q=4*g,v=d.log2(g)+1,w=a.strokesDefinition.strokes.length,z=(v-1)*w*q,x=0,B=a.strokesDefinition.strokes;x<B.length;x++){for(var A=B[x],C=A.distance,A=A.pressure,E=z,G=0;G<v;G++){0!==G&&(C=c(C,0),A=c(A,1));for(var F=0;F<a.strokesDefinition.resolution;F++){var H=A?A[F%A.length]:1;k.packFloatRGBA((C?C[F%C.length]/n:0)+.5,m,E);k.packFloatRGBA(H,m,E+l);E+=4}E-=q*(w+1)}z+=q}b=new e(b,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:g,height:g,wrapMode:10497},m);return new f(g,n,
h,w,b)};a.rasterizeStrokes=function(){for(var b=a.strokesDefinition.resolution,e=d.log2(b)+1,f=a.strokesDefinition.strokes.length,h=a.strokesDefinition.amplitude,k=Math.ceil(2*h+.5),m=0;1<=b;)m+=b,b/=2;var m=m+6*(e+1),f=f*k,b=new Uint8ClampedArray(4*m*f),l=4*m;b.fill(255);for(var n=24,w=0,z=a.strokesDefinition.strokes;w<z.length;w++){for(var x=z[w],B=x.distance,x=x.pressure,A=n,C=0;C<e;C++){0!==C&&(B=c(B,0),x=c(x,1));for(var E=0;E<B.length;E++){for(var G=B?B[E]:0,F=x?d.clamp(x[E],0,1):1,H=A,J=-h;J<
k-h;J++){var I=255-255*d.clamp(1-(Math.abs(J-G+.5)-.5*F),0,1);b[H+0]=I;b[H+1]=I;b[H+2]=I;b[H+3]=255;H+=l}A+=4}A+=24}n+=k*l}return new ImageData(b,m,f)};var h=.1,m=.5,f=function(){function a(a,b,c,d,e){this.resolution=a;this.normalizationScale=b;this.amplitude=c;this.variants=d;this.texture=e}a.prototype.dispose=function(){this.texture=l.disposeMaybe(this.texture)};return a}();a.StrokesTexture=f;a.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,
-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,
.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,
.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,
-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,
.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,
1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,
.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,
-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,
-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,
1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,
.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,
-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,
.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,
.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,
.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,
.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,
4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,
3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,
1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,
.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,
.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,
.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,
.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,
1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,
-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,
.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,
2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,
.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,
.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,
.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,
-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,
.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,
.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,
-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,
.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,
.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,
.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,
.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,
5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,
.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,
-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,
4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,
.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,
.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,
.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils","../../../../../core/maybe"],function(n,a,d,l){function k(a){return 0<
a.size*a.color[3]*a.opacity}Object.defineProperty(a,"__esModule",{value:!0});a.fillComponenBufferIndices=a.computeEdgeCount=a.estimateLengthAtDistance=a.determineObjectTransparency=a.determineEdgeTransparency=a.determineRendererType=void 0;a.determineRendererType=function(a){for(var c=null,d=0;d<a.length;d++){var e=a[d],f=e.type;if(k(e))if(l.isNone(c))c=f;else if(c!==f)return"uber"}return l.isSome(c)?c:"solid"};a.determineEdgeTransparency=function(a){for(var c=0,d=0;d<a.length;d++){var e=a[d].material;
if(k(e)){if(1>e.color[3]*e.opacity)return 1;c=2}}return c};a.determineObjectTransparency=function(a){for(var c=0,d=0;d<a.length;d++){var e=a[d].material;if(k(e)){switch(e.objectTransparency){case 1:case 0:return 1;case 2:if(1>e.opacity)return 1}c=2}}return c};a.estimateLengthAtDistance=function(a,c,d,k){return k/a*d*2*Math.tan(.5*c)};a.computeEdgeCount=function(a,c,h){var e=a.length;c*=h.minimumEdgeLength;h=d.binaryIndexOf(a,c,!0);a=-1===h?c<a[0]?0:a.length:h;return e-a};a.fillComponenBufferIndices=
function(a,c,d,k){for(var e=0;e<a.length;e++){var b=a[e].index,g=c[e],h=c[e+1];if(k)for(;g<h;g++)d.set(k[g],b);else for(;g<h;g++)d.set(g,b)}}})},"esri/views/webgl/Profiling":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.supportsTimestamps=a.getTimestamp=a.startMeasurement=void 0;a.startMeasurement=function(a){return(a=a.capabilities.disjointTimerQuery)?new d(a):null};a.getTimestamp=function(a,d,e){void 0===e&&(e=50);var c=a.capabilities.disjointTimerQuery;
if(!c||0>=c.timestampBits())return!1;var h=c.createQuery();c.createTimestamp(h);var k=function(){var a=c.resultAvailable(h),b=c.disjoint();a&&!b?(a=c.getResult(h),d(a/1E6)):b?d():setTimeout(k,e)};k();return!0};a.supportsTimestamps=function(a){a=a.capabilities.disjointTimerQuery;if(!a)return!1;a=a.timestampBits();console.log({bits:a});return 0<a};var d=function(){function a(a){this.timer=a;this.query=a.createQuery();this.timer.beginTimeElapsed(this.query)}a.prototype.stop=function(a,d){void 0===d&&
(d=50);this.cb=a;this.checkInterval=d;this.timer.endTimeElapsed();this.checkQueryResult()};a.prototype.checkQueryResult=function(){var a=this.timer.resultAvailable(this.query),d=this.timer.disjoint();a&&!d?(a=this.timer.getResult(this.query),this.cb(a/1E6)):d?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval)};return a}()})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("require exports ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ./TextureTechnique ./Util ../../../support/Scheduler ../../../webgl/Texture".split(" "),
function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.RefCountedTexture=a.TextureRepository=void 0;var b=l.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");n=function(){function a(a,b,e,f){this._textures=b;this.rctx=f;this._idToRefCountedTexture=new Map;this._textureTechniqueConfig=new c.TextureTechniqueConfiguration;this._loadingCount=0;this._frameUpdates=new Map;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);
this.events=new d;this._textureTechnique=e.acquireAndReleaseExisting(c.TextureTechnique,this._textureTechniqueConfig,this._textureTechnique);for(b=0;b<this._fallbackTextureData.length;++b)this._fallbackTextureData[b]=255,this._fallbackTextureTransparentData[b]=0!==(b+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:this.rctx.parameters.maxMaxAnisotropy};this._frameTask=k.isSome(a)?a.registerTask(m.Task.TEXTURE_UNLOAD,
function(){},function(){return!1}):new m.TestTaskHandle}a.prototype.dispose=function(){this._frameTask.remove();k.isSome(this._fallbackTexture)&&(this._fallbackTexture.dispose(),this._fallbackTexture=null);k.isSome(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent.dispose(),this._fallbackTextureTransparent=null);this._textures.forEach(function(a){return a.unload()})};a.prototype.acquire=function(a,b,c){void 0===b&&(b=!1);a=this._getOrCreateRef(a,b,c);a.ref();return a};a.prototype.update=
function(){var a=this,b=!1;this._frameUpdates.forEach(function(c){var d=c.texture.frameUpdate(a.rctx,a._textureTechnique,c.previousToken);0<=d&&d!==c.previousToken&&(c.previousToken=d,b=!0)});b&&this.events.emit("changed",0)};a.prototype._getOrCreateRef=function(a,b,c){var d=this._idToRefCountedTexture.get(a);return d?d:this._createNewRef(a,b,c)};a.prototype._createNewRef=function(a,c,d){var f=this,k=this._textures.get(a);h.assert(void 0!==k);var m=k.events.on("unloaded",function(){m.remove();f._onTextureUnloaded(a)}),
l=new g;this._idToRefCountedTexture.set(a,l);var p=k.load(this.rctx,this._textureTechnique);this._loadingCount++;var n=function(b){f._loadingCount--;f._updateGLTexture(l,b);d&&d(l);k.requiresFrameUpdates&&f._frameUpdates.set(a,{texture:k,previousToken:-1});return l},r=function(a){f._loadingCount--;e.isAbortError(a)||b.error(a)};e.isThenable(p)?(this._updateGLTexture(l,c?this.fallbackTextureTransparent:this.fallbackTexture),p.then(n,r)):n(p);return l};a.prototype._updateGLTexture=function(a,b){a.glTexture=
b;this.events.emit("changed",1)};a.prototype.release=function(a){var b=this._idToRefCountedTexture.get(a);if(b&&(b.unref(),b.isUnreferenced)){var c=this._textures.get(a);this._frameTask.schedule(function(){b.isUnreferenced&&c.unload()})}};a.prototype.getTexture=function(a){return this._textures.get(a)};Object.defineProperty(a.prototype,"loadingCount",{get:function(){return this._loadingCount},enumerable:!1,configurable:!0});a.prototype._onTextureUnloaded=function(a){this._idToRefCountedTexture.delete(a);
this._frameUpdates.delete(a)};Object.defineProperty(a.prototype,"fallbackTexture",{get:function(){k.isNone(this._fallbackTexture)&&(this._fallbackTexture=new f(this.rctx,this._fallbackTextureDesc,this._fallbackTextureData));return this._fallbackTexture},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"fallbackTextureTransparent",{get:function(){k.isNone(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent=new f(this.rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData));
return this._fallbackTextureTransparent},enumerable:!1,configurable:!0});return a}();a.TextureRepository=n;var g=function(){function a(){this._refCount=0;this.glTexture=null}Object.defineProperty(a.prototype,"isUnreferenced",{get:function(){return 0===this._refCount},enumerable:!1,configurable:!0});a.prototype.ref=function(){++this._refCount};a.prototype.unref=function(){0===this._refCount?b.error("Cannot dereference texture that has no references!"):--this._refCount};return a}();a.RefCountedTexture=
g})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("require exports tslib ../../../../../assets ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators ../../../support/imageUtils ../../../../webgl/Texture".split(" "),function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.WaterTextureRepository=a.waveAndPertubationTextureUrls=void 0;var b=e.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");
a.waveAndPertubationTextureUrls=[l.getAssetUrl("esri/images/materials/water/normals.jpg"),l.getAssetUrl("esri/images/materials/water/perturbation.jpg")];n=function(e){function g(){var a=null!==e&&e.apply(this,arguments)||this;a.data=[];a.loadingState=0;return a}d.__extends(g,e);g.prototype.dispose=function(){this.loadingState=0;this.data.forEach(function(a){a.dispose();a=null});this.data=null};g.prototype.getTextureProps=function(a,b,c){void 0===c&&(c=!1);return{target:3553,pixelFormat:6408,dataType:5121,
wrapMode:10497,samplingMode:9987,hasMipmap:c,maxAnisotropy:8,width:a,height:b}};Object.defineProperty(g.prototype,"updating",{get:function(){return 1===this.loadingState},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"ready",{get:function(){return 2===this.loadingState},enumerable:!1,configurable:!0});g.prototype.loadTextures=function(d){var e=this;this.loadingState=1;c.all(a.waveAndPertubationTextureUrls.map(function(a){return m.requestImage(a)})).then(function(a){a.forEach(function(a,
b){e.data[b]=new f(d,e.getTextureProps(a.width,a.height,!0),a)});e.loadingState=2}).catch(function(a){b.error("Failed to load textures for water material.",a);e.loadingState=0})};g.prototype.bindRepo=function(a){for(var b=0;b<this.data.length;b++)a.bindTexture(this.data[b],b)};d.__decorate([h.property()],g.prototype,"loadingState",void 0);d.__decorate([h.property({type:Boolean,readOnly:!0,dependsOn:["loadingState"]})],g.prototype,"updating",null);return g=d.__decorate([h.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],
g)}(k);a.WaterTextureRepository=n})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("require exports tslib ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec4f64 ../lib/AutoDisposable ../../../support/screenshotUtils ../../../webgl/FramebufferObject".split(" "),function(n,a,d,l,k,e,c,h,m){Object.defineProperty(a,"__esModule",{value:!0});a.ScreenshotManager=void 0;n=function(a){function b(b,c,d,e,f,h){void 0===e&&(e=null);void 0===h&&
(h=!0);var g=a.call(this)||this;g._rctx=b;g._renderScene=c;g._requestRenderScene=d;g._renderOverlay=e;g.forceCameraHook=f;g.supersample=h;g._screenshotQueue=[];return g}d.__extends(b,a);b.prototype.dispose=function(){this._rctx=null};b.prototype.takeScreenshot=function(a){this._requestRenderScene();var b=k.createResolver();this._screenshotQueue.push({settings:a,resolver:b});return b.promise};b.prototype.update=function(a){if(0!==this._screenshotQueue.length){for(var b=0,c=this._screenshotQueue;b<
c.length;b++){var e=c[b];if(this.isDisposed)e.resolver.reject();else{var f=d.__assign(d.__assign({},e.settings),{pixelRatio:e.settings.pixelRatio*a.viewCamera.pixelRatio}),g=this._ensureScreenshotEncodeCanvas(),k=this._renderScreenshot(a,f),f=h.encodeResult(k,f,g,{flipY:!0,premultipliedAlpha:!0});e.resolver(f)}}this._screenshotQueue=[]}};b.prototype._renderScreenshotOverlay=function(a,b,c){if(!l.isNone(this._renderOverlay)){a.width=b.width;a.height=b.height;var d=a.getContext("2d"),e=c.pixelRatio;
d.save();d.translate(0,b.height);d.scale(1,-1);c.region&&d.translate(-c.region.x,-c.region.y);d.scale(e,e);this._renderOverlay(a,b);d.restore()}};b.prototype._readbackScreenshot=function(a){return a.resample?this._readbackScreenshotResampled(a):this._readbackScreenshotImmediate(a)};b.prototype._readbackScreenshotResampled=function(a){var b=a.framebufferWidth,c=a.framebufferHeight,e=a.region,f=a.resample,g=this._ensureScreenshotEncodeCanvas(),k=h.createEmptyImageData(b,c,g);this._rctx.gl.readPixels(0,
0,b,c,6408,5121,new Uint8Array(k.data.buffer));this._renderScreenshotOverlay(g,k,d.__assign(d.__assign({},a),{region:null}));a=h.createEmptyImageData(e.width,e.height,g);return h.resampleHermite(k,a,!0,f.region.x,c-(f.region.y+f.region.height),f.region.width,f.region.height)};b.prototype._readbackScreenshotImmediate=function(a){var b=a.framebufferHeight,c=a.region,d=this._ensureScreenshotEncodeCanvas(),e=h.createEmptyImageData(c.width,c.height,d);this._rctx.gl.readPixels(c.x,b-(c.y+c.height),c.width,
c.height,6408,5121,new Uint8Array(e.data.buffer));this._renderScreenshotOverlay(d,e,a);return e};b.prototype._renderScreenshot=function(a,b){var c=null,d=a.viewCamera,f=b.framebufferWidth,g=b.framebufferHeight,h=!1;a=a.frameHasSlicePlane&&b.disableSlice;var k=b.ignorePadding&&d.pixelRatio!==b.pixelRatio;if(a=f!==d.fullWidth||g!==d.fullHeight||a||k){k=d.clone();if(b.ignorePadding){for(var c=e.vec4f64.clone(k.padding),l=0;4>l;l++)c[l]=Math.round(c[l]/k.pixelRatio*b.pixelRatio);k.padding=c}k.fullWidth=
f;k.fullHeight=g;k.pixelRatio=b.pixelRatio;c=d.fovX-k.fovX;f=d.fovY-k.fovY;0>c&&c<f?k.fovX=d.fovX:0>f&&f<c&&(k.fovY=d.fovY);this.forceCameraHook(k);h=!0;c=new m(this._rctx,{width:k.fullWidth,height:k.fullHeight,colorTarget:0,depthStencilTarget:3});this._renderScene(c,k,b.disableSlice)}b=this._readbackScreenshot(b);if(a&&!this._rctx.contextAttributes.alpha)for(l=3;l<b.data.length;l+=4)b.data[l]=255;c&&c.dispose();this._rctx.bindFramebuffer(null);h&&this.forceCameraHook(d);return b};b.prototype._ensureScreenshotEncodeCanvas=
function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return b}(c.AutoDisposable);a.ScreenshotManager=n})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","tslib","../../core/Error","../../core/has"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.check=void 0;var e={checkMajorWebPerformanceCaveat:!0};a.check=function(a){a=d.__assign(d.__assign({},e),a);return k("esri-webgl")?
a.checkMajorWebPerformanceCaveat&&k("esri-webgl-major-performance-caveat")?new l("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):k("esri-webgl-high-precision-fragment")?k("esri-webgl-vertex-shader-samplers")?k("esri-webgl-element-index-uint")?k("esri-webgl-standard-derivatives")?k("esri-webgl-instanced-arrays")?null:new l("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):
new l("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new l("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new l("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new l("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new l("webgl:required",
"WebGL is required but not supported.")}})},"esri/views/ui/3d/DefaultUI3D":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","../DefaultUI"],function(n,a,d,l,k){return function(a){function c(c){c=a.call(this,c)||this;c.components=["attribution","zoom","navigation-toggle","compass"];return c}d.__extends(c,a);d.__decorate([l.property()],c.prototype,"components",void 0);return c=d.__decorate([l.subclass("esri.views.ui.3d.DefaultUI3D")],c)}(k)})},"esri/views/ui/DefaultUI":function(){define("require exports tslib ../../core/has ../../core/Logger ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p){k.getLogger("esri.views.ui.DefaultUI");return function(a){function k(b){b=a.call(this,b)||this;b._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"};b.components=[];return b}d.__extends(k,a);k.prototype.initialize=function(){this._handles.add([e.init(this,"components",this._componentsWatcher.bind(this)),e.init(this,"view",this._updateViewAwareWidgets.bind(this))])};k.prototype._add=function(b,
c,d,e){if("string"===typeof b&&this._defaultPositionLookup[b]){if(this._find(b))return;b=this._createComponent(b)}a.prototype._add.call(this,b,c,d,e)};k.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b._find(a))b.remove(a),a.destroy()})};k.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b._find(c))&&c.widget)&&void 0!==c.view&&(c.view=a)})};k.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);
this._adjustPadding(a)};k.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=this.padding.top)};k.prototype._addComponents=function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),b._defaultPositionLookup[a])})};k.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new h({id:a,node:b})};k.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();
if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};k.prototype._createAttribution=function(){return new f({view:this.view})};k.prototype._createCompass=function(){return new b({view:this.view})};k.prototype._createNavigationToggle=function(){return new g({view:this.view})};k.prototype._createZoom=function(){return new p({view:this.view})};d.__decorate([c.property()],k.prototype,"components",void 0);
return k=d.__decorate([c.subclass("esri.views.ui.DefaultUI")],k)}(m)})},"esri/views/ui/Component":function(){define("require exports tslib ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators".split(" "),function(n,a,d,l,k,e){return function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.widget=null;return c}d.__extends(c,a);c.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(c.prototype,"id",{get:function(){return this.get("widget.id")||
this.get("node.id")},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"node",{set:function(a){var c=this._get("node");a!==c&&(a&&a.classList.add("esri-component"),c&&c.classList.remove("esri-component"),this._set("node",a))},enumerable:!1,configurable:!0});c.prototype.castNode=function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in a)return this._set("widget",null),k.byId(a);a&&"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));
this._set("widget",a);return a.domNode};d.__decorate([e.property()],c.prototype,"id",null);d.__decorate([e.property()],c.prototype,"node",null);d.__decorate([e.cast("node")],c.prototype,"castNode",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"widget",void 0);return c=d.__decorate([e.subclass("esri.views.ui.Component")],c)}(l)})},"esri/views/ui/UI":function(){define("require exports tslib ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ../../widgets/support/widgetUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f){function b(a){return"object"!==typeof a||a instanceof m||"declaredClass"in a||!("component"in a||"index"in a||"position"in a)?null:a}function g(a,b){var c=b.bottom,d=b.left,e=b.right;a.style.top=b.top;a.style.bottom=c;a.style.left=d;a.style.right=e}var p={left:0,top:0,bottom:0,right:0},t={bottom:30,top:15,right:15,left:15};return function(a){function k(b){b=a.call(this,b)||this;b._cornerNameToContainerLookup={};b._positionNameToContainerLookup={};b._components=[];b._componentToKey=
new Map;b._handles=new e;b.view=null;b._initContainers();return b}d.__extends(k,a);k.prototype.initialize=function(){this._handles.add([c.init(this,"view.padding, container",this._applyViewPadding.bind(this)),c.init(this,"padding",this._applyUIPadding.bind(this))])};k.prototype.destroy=function(){this.container=null;for(var a=0,b=this._components;a<b.length;a++)b[a].destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};Object.defineProperty(k.prototype,"container",
{set:function(a){var b=this._get("container");a!==b&&(a&&(a.classList.add("esri-ui"),this._attachContainers(a)),b&&(b.classList.remove("esri-ui"),g(b,{top:"",bottom:"",left:"",right:""}),l.empty(b)),this._set("container",a))},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,
"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",a):this._clearOverride("padding")},enumerable:!1,configurable:!0});k.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:d.__assign(d.__assign({},t),a)};Object.defineProperty(k.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!1,configurable:!0});k.prototype.add=
function(a,c){var d,e=this,f,g;if(Array.isArray(a))a.forEach(function(a){return e.add(a,c)});else{if(d=b(a))f=d.index,c=d.position,a=d.component,g=d.key;c&&"object"===typeof c&&(d=c,f=d.index,g=d.key,c=d.position);!a||c&&!this._isValidPosition(c)||this._add(a,c,f,g)}};k.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,b)});var d=this._find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),
d.node.parentNode&&d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};k.prototype.empty=function(a){var b=this;if(Array.isArray(a))return a.map(function(a){return b.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";return"manual"===a?Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!a.classList.contains("esri-ui-corner")}).map(function(a){return b.remove(a)}):this._isValidPosition(a)?Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this):null};k.prototype.move=function(a,c){var d=this;Array.isArray(a)&&a.forEach(function(a){return d.move(a,c)});if(a){var e,f=b(a)||b(c);f&&(e=f.index,c=f.position,a=f.component||a);(!c||this._isValidPosition(c))&&(a=this.remove(a))&&this.add(a,{position:c,index:e})}};k.prototype.find=function(a){return a?(a=this._findById(a))&&(a.widget||a.node):null};k.prototype._add=function(a,b,c,d){a instanceof m||(a=new m({node:a}));this._place({component:a,position:b,index:c});this._components.push(a);d&&
this._componentToKey.set(a,d)};k.prototype._find=function(a){return a?a instanceof m?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};k.prototype._getViewPadding=function(){return this.get("view.padding")||p};k.prototype._attachContainers=function(a){a.appendChild(this._innerContainer);a.appendChild(this._manualContainer)};k.prototype._initContainers=function(){var a=document.createElement("div");a.classList.add("esri-ui-inner-container");a.classList.add("esri-ui-corner-container");
var b=document.createElement("div");b.classList.add("esri-ui-inner-container");b.classList.add("esri-ui-manual-container");var c=document.createElement("div");c.classList.add("esri-ui-top-left");c.classList.add("esri-ui-corner");a.appendChild(c);var e=document.createElement("div");e.classList.add("esri-ui-top-right");e.classList.add("esri-ui-corner");a.appendChild(e);var g=document.createElement("div");g.classList.add("esri-ui-bottom-left");g.classList.add("esri-ui-corner");a.appendChild(g);var h=
document.createElement("div");h.classList.add("esri-ui-bottom-right");h.classList.add("esri-ui-corner");a.appendChild(h);this._innerContainer=a;this._manualContainer=b;a=f.isRTL();this._cornerNameToContainerLookup={"top-left":c,"top-right":e,"bottom-left":g,"bottom-right":h,"top-leading":a?e:c,"top-trailing":a?c:e,"bottom-leading":a?h:g,"bottom-trailing":a?g:h};this._positionNameToContainerLookup=d.__assign({manual:b},this._cornerNameToContainerLookup)};k.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};
k.prototype._place=function(a){var b=a.component,c=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];var d=-1<c,e=b.widget;e&&!e._started&&"function"===typeof e.postMixInProperties&&"function"===typeof e.buildRendering&&"function"===typeof e.postCreate&&"function"===typeof e.startup&&b.widget.startup();d?(d=Array.prototype.slice.call(a.children),0===c?a.firstChild?l.insertBefore(b.node,a.firstChild):a.appendChild(b.node):c>=d.length?a.appendChild(b.node):l.insertBefore(b.node,d[c])):
a.appendChild(b.node)};k.prototype._applyViewPadding=function(){var a=this.container;a&&g(a,this._toPxPosition(this._getViewPadding()))};k.prototype._applyUIPadding=function(){var a=this._innerContainer;a&&g(a,this._toPxPosition(this.padding))};k.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};k.prototype._toPxUnit=function(a){return 0===a?"0":a+"px"};k.prototype._findByComponent=function(a){var b=
null,c;this._components.some(function(d){(c=d===a)&&(b=d);return c});return b};k.prototype._findById=function(a){var b=null,c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});return b};k.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};d.__decorate([h.property()],k.prototype,"container",null);d.__decorate([h.property({dependsOn:["view.height"]})],k.prototype,"height",null);d.__decorate([h.property({value:t})],
k.prototype,"padding",null);d.__decorate([h.cast("padding")],k.prototype,"castPadding",null);d.__decorate([h.property()],k.prototype,"view",void 0);d.__decorate([h.property({dependsOn:["view.width"]})],k.prototype,"width",null);return k=d.__decorate([h.subclass("esri.views.ui.UI")],k)}(k.EventedAccessor)})},"esri/widgets/Attribution":function(){define("require exports tslib ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),
function(n,a,d,l,k,e,c,h){return function(a){function e(b,d){b=a.call(this,b,d)||this;b._isOpen=!1;b._attributionTextOverflowed=!1;b._prevSourceNodeHeight=0;b.iconClass="esri-icon-description";b.itemDelimiter=" | ";b.label=void 0;b.messages=null;b.view=null;b.viewModel=new c;return b}d.__extends(e,a);e.prototype.initialize=function(){var a=this;this.own(l.on(this,"viewModel.items","change",function(){return a.scheduleRender()}))};Object.defineProperty(e.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,
c){-1===a.indexOf(c.text)&&a.push(c.text);return a},[]).join(this.itemDelimiter)},enumerable:!1,configurable:!0});e.prototype.render=function(){var a,c=(a={},a["esri-attribution--open"]=this._isOpen,a);return h.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",c),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};e.prototype.renderPoweredBy=function(){return h.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",
h.tsx("a",{class:this.classes("esri-attribution__link","esri-widget__anchor"),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))};e.prototype.renderSourcesNode=function(){var a,c=this._isOpen,d=this._isInteractive(),e=d?0:-1,f=this.attributionText,k=d?"button":void 0,c=(a={},a["esri-attribution__sources--open"]=c,a["esri-interactive"]=d,a);return h.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",
c),innerHTML:f,role:k,tabIndex:e})};e.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=a.clientWidth};e.prototype._afterSourcesNodeUpdate=function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};e.prototype._toggleState=function(){this._isInteractive()&&
(this._isOpen=!this._isOpen)};e.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};d.__decorate([k.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),h.renderable()],e.prototype,"attributionText",null);d.__decorate([k.property()],e.prototype,"iconClass",void 0);d.__decorate([k.property(),h.renderable()],e.prototype,"itemDelimiter",void 0);d.__decorate([k.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],e.prototype,
"label",void 0);d.__decorate([k.property(),h.renderable(),h.messageBundle("esri/widgets/Attribution/t9n/Attribution")],e.prototype,"messages",void 0);d.__decorate([k.aliasOf("viewModel.view")],e.prototype,"view",void 0);d.__decorate([k.property({type:c}),h.renderable(["state","view.size"])],e.prototype,"viewModel",void 0);d.__decorate([h.accessibleHandler()],e.prototype,"_toggleState",null);return e=d.__decorate([k.subclass("esri.widgets.Attribution")],e)}(e)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports tslib ../../geometry ../../core/arrayUtils ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){function p(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})}function t(a,b,c){c&&b&&(k.find(a,function(a){return a.layerView===b&&a.text===c})||a.push({text:c,layerView:b}))}var u=[];return function(a){function h(b){var d=a.call(this,b)||this;d.clear=function(){d._fetchedAttributionData.clear();d._pendingAttributions.clear();d.handles.remove("suspension");d.notifyChange("state")};d._pendingAttributions=new Set;d._fetchedAttributionData=
new Map;d.items=new c;d.view=null;d._allLayerViewsChange=function(a){d.handles.remove("suspension");var b=d.get("view.allLayerViews");b&&d.handles.add(b.map(function(a){return a.watch(["suspended","attributionVisible"],d._updateAttributionItems)}),"suspension");a&&a.removed&&a.removed.forEach(function(a){d._pendingAttributions.delete(a);d._fetchedAttributionData.delete(a)});d._updateAttributionItems()};d._updateAttributionItems=function(){var a=d.get("view.allLayerViews");u.length=0;a?(a.forEach(function(a){if(!a.suspended&&
a.get("layer.attributionVisible")){var b=a.layer;if(b&&"copyright"in b&&"function"===typeof b.originOf&&"user"===b.originOf("copyright"))t(u,a,b.copyright);else if(b.hasAttributionData)if(d._fetchedAttributionData.has(a)){var c=d._fetchedAttributionData.get(a);c&&t(u,a,d._getDynamicAttribution(c,d.view,b))}else d._fetchAttributionData(a);else(c=b.get("portalItem.accessInformation"))?t(u,a,c):t(u,a,b.copyright)}}),p(d.items,u)&&(d.items.removeAll(),d.items.addMany(u)),u.length=0,d.notifyChange("state")):
d.clear()};d.handles.add([m.on(d,"view.allLayerViews","change",d._allLayerViewsChange,d._allLayerViewsChange,d.clear),m.whenTrue(d,"view.stationary",function(){return d._updateAttributionItems()})]);return d}d.__extends(h,a);h.prototype.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};Object.defineProperty(h.prototype,"state",{get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":
"disabled"},enumerable:!1,configurable:!0});h.prototype._fetchAttributionData=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c;return d.__generator(this,function(d){switch(d.label){case 0:if(this._pendingAttributions.has(a))return[2];this._pendingAttributions.add(a);return[4,e.result(a.layer.fetchAttributionData())];case 1:return b=d.sent(),this._pendingAttributions.has(a)&&(c=b.ok?this._createContributionIndex(b.value,"bing-maps"===a.layer.type):null,this._pendingAttributions.delete(a),
this._fetchedAttributionData.set(a,c)),this._updateAttributionItems(),[2]}})})};h.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;for(var d=0;d<a.length;d++){var e=a[d],f=e.coverageAreas;if(!f)return;for(var h=0;h<f.length;h++)for(var k=f[h],m=k.bbox,p=k.zoomMin-(b&&k.zoomMin?1:0),n=k.zoomMax-(b&&k.zoomMax?1:0),k={extent:g.geographicToWebMercator({xmin:m[1],ymin:m[0],xmax:m[3],ymax:m[2],spatialReference:l.SpatialReference.WGS84}),attribution:e.attribution||
"",score:null!=k.score?k.score:100,id:d};p<=n;p++)c[p]=c[p]||[],c[p].push(k)}c.maxKey=Math.max.apply(null,Object.keys(c));return c};h.prototype._getDynamicAttribution=function(a,c,d){var e=c.extent;d=d.tileInfo.scaleToZoom(c.scale);d=Math.min(a.maxKey,Math.round(d));if(!e||null==d||-1>=d)return"";a=a[d];var f=g.project(e.center.clone().normalize(),c.spatialReference),h={};return a?a.filter(function(a){var c=!h[a.id]&&f&&b.extentContainsPoint(a.extent,f);c&&(h[a.id]=!0);return c}).sort(function(a,
b){return b.score-a.score||a.objectId-b.objectId}).map(function(a){return a.attribution}).join(", "):""};d.__decorate([f.property({readOnly:!0,type:c})],h.prototype,"items",void 0);d.__decorate([f.property({dependsOn:["view.ready"],readOnly:!0})],h.prototype,"state",null);d.__decorate([f.property()],h.prototype,"view",void 0);return h=d.__decorate([f.subclass("esri.widgets.Attribution.AttributionViewModel")],h)}(h.HandleOwner)})},"esri/widgets/Compass":function(){define("require exports tslib ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),
function(n,a,d,l,k,e,c){return function(a){function h(c,b){c=a.call(this,c,b)||this;c.goToOverride=null;c.iconClass="esri-icon-locate-circled";c.label=void 0;c.messages=null;c.view=null;c.viewModel=new e;return c}d.__extends(h,a);h.prototype.reset=function(){return this.viewModel.reset()};h.prototype.render=function(){var a,b,d=this.viewModel,e=d.orientation,d=d.state,h="disabled"===d,k="compass"===("rotation"===d?"rotation":"compass"),d=h?-1:0,h=(a={},a["esri-disabled"]=h,a["esri-interactive"]=!h,
a);a=(b={},b["esri-icon-compass"]=k,b["esri-icon-dial"]=!k,b);b=this.messages;return c.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",h),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:d,"aria-label":b.reset,title:b.reset},c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",a),styles:this._toRotationTransform(e)}),c.tsx("span",{class:"esri-icon-font-fallback-text"},b.reset))};h.prototype._reset=function(){this.viewModel.reset()};
h.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+a.z+"deg)"}};d.__decorate([l.aliasOf("viewModel.goToOverride")],h.prototype,"goToOverride",void 0);d.__decorate([l.property()],h.prototype,"iconClass",void 0);d.__decorate([l.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],h.prototype,"label",void 0);d.__decorate([l.property(),c.renderable(),c.messageBundle("esri/widgets/Compass/t9n/Compass")],h.prototype,"messages",void 0);d.__decorate([l.aliasOf("viewModel.view")],
h.prototype,"view",void 0);d.__decorate([l.property({type:e}),c.renderable(["viewModel.orientation","viewModel.state"])],h.prototype,"viewModel",void 0);d.__decorate([c.accessibleHandler()],h.prototype,"_reset",null);return h=d.__decorate([l.subclass("esri.widgets.Compass")],h)}(k)})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports tslib ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),function(n,
a,d,l,k,e,c,h){return function(a){function f(b){b=a.call(this,b)||this;b._handles=new k;b.orientation={x:0,y:0,z:0};b.view=null;b._updateForCamera=b._updateForCamera.bind(b);b._updateForRotation=b._updateForRotation.bind(b);b._updateRotationWatcher=b._updateRotationWatcher.bind(b);b.view;return b}d.__extends(f,a);f.prototype.initialize=function(){this._handles.add(e.init(this,"view",this._updateRotationWatcher))};f.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};
Object.defineProperty(f.prototype,"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return!(!a||!a.isWebMercator&&!a.isGeographic)},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!1,configurable:!0});f.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};f.prototype._updateForRotation=
function(a){void 0!==a&&null!==a&&(this.orientation={z:a})};f.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};f.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(e.init(this,"view.rotation",this._updateForRotation)):this._handles.add(e.init(this,"view.camera",this._updateForCamera)))};d.__decorate([c.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],f.prototype,
"canShowNorth",null);d.__decorate([c.property()],f.prototype,"orientation",void 0);d.__decorate([c.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],f.prototype,"state",null);d.__decorate([c.property()],f.prototype,"view",void 0);return f=d.__decorate([c.subclass("esri.widgets.CompassViewModel")],f)}(h.GoToMixin(l))})},"esri/widgets/NavigationToggle":function(){define("require exports tslib ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),
function(n,a,d,l,k,e,c){return function(a){function h(c,b){c=a.call(this,c,b)||this;c.iconClass="esri-icon-pan2";c.label=void 0;c.messages=null;c.view=null;c.viewModel=new e;return c}d.__extends(h,a);Object.defineProperty(h.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!1,configurable:!0});h.prototype.toggle=function(){return this.viewModel.toggle()};h.prototype.render=function(){var a,b,d,e="disabled"===this.get("viewModel.state"),h="pan"===
this.get("viewModel.navigationMode"),k=(a={},a["esri-disabled"]=e,a["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,a);a=(b={},b["esri-navigation-toggle__button--active"]=h,b);b=(d={},d["esri-navigation-toggle__button--active"]=!h,d);d=e?-1:0;e=this.messages.toggle;return c.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",k),onclick:this._toggle,onkeydown:this._toggle,tabIndex:d,"aria-label":e,title:e},c.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--pan",a)},c.tsx("span",{class:"esri-icon-pan"})),c.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--rotate",b)},c.tsx("span",{class:"esri-icon-rotate"})))};h.prototype._toggle=function(){this.toggle()};d.__decorate([l.property()],h.prototype,"iconClass",void 0);d.__decorate([l.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],h.prototype,"label",void 0);d.__decorate([l.property({value:"vertical"}),
c.renderable()],h.prototype,"layout",null);d.__decorate([l.property(),c.renderable(),c.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],h.prototype,"messages",void 0);d.__decorate([l.aliasOf("viewModel.view"),c.renderable()],h.prototype,"view",void 0);d.__decorate([l.property({type:e}),c.renderable(["viewModel.state","viewModel.navigationMode"])],h.prototype,"viewModel",void 0);d.__decorate([c.accessibleHandler()],h.prototype,"_toggle",null);return h=d.__decorate([l.subclass("esri.widgets.NavigationToggle")],
h)}(k)})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports tslib ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(n,a,d,l,k,e,c){return function(a){function h(c){c=a.call(this,c)||this;c._handles=new k;c.navigationMode="pan";c.view=null;return c}d.__extends(h,a);h.prototype.initialize=function(){this._handles.add(e.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};h.prototype.destroy=
function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(h.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"},enumerable:!1,configurable:!0});h.prototype.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};h.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};
d.__decorate([c.property({dependsOn:["view.ready"],readOnly:!0})],h.prototype,"state",null);d.__decorate([c.property()],h.prototype,"navigationMode",void 0);d.__decorate([c.property()],h.prototype,"view",void 0);return h=d.__decorate([c.subclass("esri.widgets.NavigationToggleViewModel")],h)}(l)})},"esri/widgets/Zoom":function(){define("require exports tslib ../core/accessorSupport/decorators ./Widget ./support/widget ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),function(n,a,d,l,k,e,c,h){return function(a){function f(b,
c){b=a.call(this,b,c)||this;b.iconClass="esri-icon-zoom-in-magnifying-glass";b.label=void 0;b.messages=null;b.view=null;b.viewModel=new h;return b}d.__extends(f,a);f.prototype.initialize=function(){this._zoomInButton=new c({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new c({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};f.prototype.destroy=function(){this._zoomInButton.destroy();this._zoomOutButton.destroy();this._zoomOutButton=this._zoomInButton=
null};Object.defineProperty(f.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!1,configurable:!0});f.prototype.render=function(){var a,c=this.viewModel,d=(a={},a["esri-zoom--horizontal"]="horizontal"===this.layout,a);this._zoomInButton.enabled="ready"===c.state&&c.canZoomIn;this._zoomOutButton.enabled="ready"===c.state&&c.canZoomOut;this._zoomInButton.title=this.messages.zoomIn;this._zoomOutButton.title=this.messages.zoomOut;return e.tsx("div",
{class:this.classes("esri-zoom esri-widget",d)},this._zoomInButton.render(),this._zoomOutButton.render())};f.prototype.zoomIn=function(){return this.viewModel.zoomIn()};f.prototype.zoomOut=function(){return this.viewModel.zoomOut()};d.__decorate([l.property()],f.prototype,"iconClass",void 0);d.__decorate([l.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],f.prototype,"label",void 0);d.__decorate([l.property({value:"vertical"}),e.renderable()],f.prototype,"layout",null);d.__decorate([l.property(),
e.renderable(),e.messageBundle("esri/widgets/Zoom/t9n/Zoom")],f.prototype,"messages",void 0);d.__decorate([l.aliasOf("viewModel.view"),e.renderable()],f.prototype,"view",void 0);d.__decorate([l.property({type:h}),e.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],f.prototype,"viewModel",void 0);return f=d.__decorate([l.subclass("esri.widgets.Zoom")],f)}(k)})},"esri/widgets/Zoom/IconButton":function(){define("require exports tslib ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(n,a,d,l,k,e){return function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.enabled=!0;c.iconClass="";c.title="";return c}d.__extends(c,a);c.prototype.render=function(){var a,c,b=this.enabled?0:-1,d=(a={},a["esri-disabled"]=!this.enabled,a["esri-interactive"]=this.enabled,a);a=(c={},c[this.iconClass]=!!this.iconClass,c);return e.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",d),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",
tabIndex:b,title:this.title},e.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",a)}),e.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};c.prototype._triggerAction=function(){this.action.call(this)};d.__decorate([l.property()],c.prototype,"action",void 0);d.__decorate([l.property(),e.renderable()],c.prototype,"enabled",void 0);d.__decorate([l.property(),e.renderable()],c.prototype,"iconClass",void 0);d.__decorate([l.property(),e.renderable()],c.prototype,
"title",void 0);d.__decorate([e.accessibleHandler()],c.prototype,"_triggerAction",null);return c=d.__decorate([l.subclass("esri.widgets.IconButton")],c)}(k)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports tslib ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(n,a,d,l,k,e,c,h){return function(a){function f(b){b=a.call(this,b)||this;b.canZoomIn=!1;b.canZoomOut=!1;return b}d.__extends(f,
a);f.prototype.destroy=function(){this.view=null};Object.defineProperty(f.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new c({view:a}):"3d"===a.type&&(this._zoomConditions=new h({view:a})):this._zoomConditions=null;this._set("view",a)},enumerable:!1,configurable:!0});f.prototype.zoomIn=function(){if(this.canZoomIn){var a=this.view;"2d"===
a.type?a.mapViewNavigation.zoomIn():k.ignoreAbortErrors(a.goTo({zoomFactor:2}))}};f.prototype.zoomOut=function(){if(this.canZoomOut){var a=this.view;"2d"===a.type?a.mapViewNavigation.zoomOut():k.ignoreAbortErrors(a.goTo({zoomFactor:.5}))}};d.__decorate([e.property()],f.prototype,"_zoomConditions",void 0);d.__decorate([e.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],f.prototype,"canZoomIn",void 0);d.__decorate([e.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],f.prototype,
"canZoomOut",void 0);d.__decorate([e.property({dependsOn:["view.ready"],readOnly:!0})],f.prototype,"state",null);d.__decorate([e.property()],f.prototype,"view",null);return f=d.__decorate([e.subclass("esri.widgets.Zoom.ZoomViewModel")],f)}(l)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define(["require","exports","tslib","../../core/Accessor","../../core/accessorSupport/decorators"],function(n,a,d,l,k){return function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,
a);Object.defineProperty(c.prototype,"canZoomIn",{get:function(){if(!this.get("view.ready"))return!1;var a=this.get("view.animation.target.scale")||this.get("view.scale"),c=this.get("view.constraints.effectiveMaxScale");return 0===c||a>c},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"canZoomOut",{get:function(){if(!this.get("view.ready"))return!1;var a=this.get("view.animation.target.scale")||this.get("view.scale"),c=this.get("view.constraints.effectiveMinScale");return 0===c||
a<c},enumerable:!1,configurable:!0});d.__decorate([k.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMaxScale"],readOnly:!0})],c.prototype,"canZoomIn",null);d.__decorate([k.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMinScale"],readOnly:!0})],c.prototype,"canZoomOut",null);d.__decorate([k.property()],c.prototype,"view",void 0);return c=d.__decorate([k.subclass("esri.widgets.Zoom.ZoomConditions2D")],
c)}(l)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define(["require","exports","tslib","../../core/Accessor","../../core/accessorSupport/decorators"],function(n,a,d,l,k){return function(a){function c(){return null!==a&&a.apply(this,arguments)||this}d.__extends(c,a);Object.defineProperty(c.prototype,"canZoomIn",{get:function(){return!!this.get("view.ready")},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"canZoomOut",{get:function(){return!!this.get("view.ready")},enumerable:!1,
configurable:!0});d.__decorate([k.property({dependsOn:["view.ready"],readOnly:!0})],c.prototype,"canZoomIn",null);d.__decorate([k.property({dependsOn:["view.ready"],readOnly:!0})],c.prototype,"canZoomOut",null);d.__decorate([k.property()],c.prototype,"view",void 0);return c=d.__decorate([k.subclass("esri.widgets.Zoom.ZoomConditions3D")],c)}(l)})},"esri/layers/SceneLayer":function(){define("require exports tslib ../PopupTemplate ../renderers ../request ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/utils ./Layer ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/FetchAssociatedFeatureLayer ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../renderers/support/styleUtils ../support/popupUtils ../tasks/support/Query @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O){var N=["3DObject","Point"],S=h.getLogger("esri.layers.SceneLayer"),P=F.defineFieldProperties(),U={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},Z={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(a){function f(){for(var b=
[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.featureReduction=null;b.rangeInfos=null;b.operationalLayerType="ArcGISSceneServiceLayer";b.type="scene";b.fields=null;b.outFields=null;b.nodePages=null;b.materialDefinitions=null;b.textureSetDefinitions=null;b.geometryDefinitions=null;b.serviceUpdateTimeStamp=null;b.definitionExpression=null;b.path=null;b.labelsVisible=!0;b.labelingInfo=null;b.legendEnabled=!0;b.cachedDrawingInfo={color:!1};b.popupEnabled=!0;b.popupTemplate=
null;b.objectIdField=null;b.objectIdFilter=null;b._fieldUsageInfo={};b.screenSizePerspectiveEnabled=!0;return b}d.__extends(f,a);f.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?d.__assign({url:a},b):a};f.prototype.getField=function(a){return this.fieldsIndex.get(a)};f.prototype.getFieldDomain=function(a){return(a=this.getField(a))&&a.domain?a.domain:null};Object.defineProperty(f.prototype,"fieldsIndex",{get:function(){return new H(this.fields)},enumerable:!1,configurable:!0});
f.prototype.readNodePages=function(a,b,c){"Point"===b.layerType&&(a=b.pointNodePages);return null==a||"object"!==typeof a?null:I.I3SNodePageDefinition.fromJSON(a,c)};Object.defineProperty(f.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this.loaded&&this._validateElevationInfo()},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"geometryType",{get:function(){return Z[this.profile]||"mesh"},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,
"renderer",{set:function(a){J.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!1,configurable:!0});f.prototype.readCachedDrawingInfo=function(a){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};Object.defineProperty(f.prototype,"defaultPopupTemplate",{get:function(){return m.isSome(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null},enumerable:!1,configurable:!0});f.prototype.readObjectIdField=function(a,b){!a&&b.fields&&
b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a||void 0};f.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&U[a])return U[a];S.error("Unknown or missing profile",{profile:a,layer:this});return"mesh-pyramids"};f.prototype.load=function(a){var c=this,d=m.isSome(a)?a.signal:null;a=this.loadFromPortal({supportedTypes:["Scene Service"]},a).then(function(){return c._fetchService(d)},function(){return c._fetchService(d)}).then(function(){return b.all([c._verifyRootNodeAndUpdateExtent(c.nodePages,
d),c._setAssociatedFeatureLayer(d)])}).then(function(){return c._validateElevationInfo()}).then(function(){return c._applyAssociatedLayerOverrides()}).then(function(){return c._populateFieldUsageInfo()}).then(function(){return Q.loadStyleRenderer(c,{origin:"service"},d)}).then(function(){return J.fixRendererFields(c.renderer,c.fields)});this.addResolvingPromise(a);return b.resolve(this)};f.prototype.createQuery=function(){var a=new O;"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);
a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};f.prototype.queryExtent=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryExtent(a||c.createQuery(),b)})};f.prototype.queryFeatureCount=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeatureCount(a||c.createQuery(),b)})};f.prototype.queryFeatures=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeatures(a||
c.createQuery(),b)}).then(function(a){if(a&&a.features)for(var b=0,d=a.features;b<d.length;b++){var e=d[b];e.layer=c;e.sourceLayer=c}return a})};f.prototype.queryObjectIds=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryObjectIds(a||c.createQuery(),b)})};f.prototype.getFieldUsageInfo=function(a){var b={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[a]||b:(S.error("#getFieldUsageInfo()",
"Unavailable until layer is loaded"),b)};f.prototype.createPopupTemplate=function(a){return R.createPopupTemplate(this,a)};f.prototype._getAssociatedLayerForQuery=function(){var a=this.associatedLayer;return m.isSome(a)&&a.loaded?b.resolve(a):this._loadAssociatedLayerForQuery()};f.prototype._loadAssociatedLayerForQuery=function(){return d.__awaiter(this,void 0,void 0,function(){var a;return d.__generator(this,function(b){switch(b.label){case 0:return[4,this.load()];case 1:b.sent();if(m.isNone(this.associatedLayer))throw new c("scenelayer:query-not-available",
"SceneLayer queries are not available without an associated feature layer",{layer:this});b.label=2;case 2:return b.trys.push([2,4,,5]),[4,this.associatedLayer.load()];case 3:return b.sent(),[3,5];case 4:throw a=b.sent(),new c("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:a});case 5:return[2,this.associatedLayer]}})})};f.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===
a})};f.prototype.queryCachedStatistics=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var f,h,k,m,l;return d.__generator(this,function(d){switch(d.label){case 0:return[4,this.load(b)];case 1:d.sent();if(!this.statisticsInfo)throw new c("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");f=this.fieldsIndex.get(a);if(!f)throw new c("scenelayer:field-unexisting","Field '"+a+"' does not exist on the layer");h=0;for(k=this.statisticsInfo;h<k.length;h++)if(m=
k[h],m.name===f.name)return l=g.join(this.parsedUrl.path,m.href),[2,e(l,{query:{f:"json"},responseType:"json",signal:b?b.signal:null}).then(function(a){return a.data})];throw new c("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");}})})};f.prototype.saveAs=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c=this;return d.__generator(this,function(e){return[2,this._debouncedSaveOperations(1,d.__assign(d.__assign({},b),{getTypeKeywords:function(){return c._getTypeKeywords()},
portalItemLayerType:"scene"}),a)]})})};f.prototype.save=function(){return d.__awaiter(this,void 0,void 0,function(){var a,b=this;return d.__generator(this,function(c){a={getTypeKeywords:function(){return b._getTypeKeywords()},portalItemLayerType:"scene"};return[2,this._debouncedSaveOperations(0,a)]})})};f.prototype.validateLayer=function(a){if(a.layerType&&-1===N.indexOf(a.layerType))throw new c("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});
if(isNaN(this.version.major)||isNaN(this.version.minor))throw new c("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new c("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,d=!1,e=!1;if(null==a)e=d=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":d=
!0;e=b;break;case "vertex-reference-frame":d=!0;e=!b;break;default:d=!1}if(!d)throw new c("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!e)throw new c("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");};f.prototype._getTypeKeywords=function(){var a=[];if("points"===this.profile)a.push("Point");else if("mesh-pyramids"===this.profile)a.push("3DObject");else throw new c("scenelayer:unknown-profile",
"SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return a};f.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),d=!!(m.isSome(b.associatedLayer)&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||
d,supportsLayerQuery:d}},b=this,c=0,d=this.fields;c<d.length;c++)a(d[c])};f.prototype._applyAssociatedLayerOverrides=function(){if(!m.isNone(this.associatedLayer)){if(this.associatedLayer.fields){for(var a=null,b=0,c=this.associatedLayer.fields;b<c.length;b++){var d=c[b];this.getField(d.name)||(a||(a=this.fields?this.fields.slice():[]),a.push(d.clone()))}a&&this._set("fields",a)}a=["popupTemplate","popupEnabled"];b=u.getProperties(this);for(c=0;c<a.length;c++)d=a[c],this._buddyIsMoreImportant(d)&&
(b.setDefaultOrigin(this.associatedLayer.originOf(d)),b.set(d,this.associatedLayer[d]),b.setDefaultOrigin("user"))}};f.prototype._setAssociatedFeatureLayer=function(a){return d.__awaiter(this,void 0,void 0,function(){var c,e,f;return d.__generator(this,function(d){switch(d.label){case 0:if(-1===["mesh-pyramids","points"].indexOf(this.profile))return[2];c=new G.FetchAssociatedFeatureLayer(this.parsedUrl,this.portalItem,a);d.label=1;case 1:return d.trys.push([1,3,,4]),e=this,[4,c.fetch()];case 2:return e.associatedLayer=
d.sent(),[3,4];case 3:return f=d.sent(),b.isAbortError(f)||this._logWarningOnPopupEnabled(),[3,4];case 4:return[2]}})})};f.prototype._logWarningOnPopupEnabled=function(){var a=this;p.whenValidOnce(this,["popupTemplate","popupEnabled"],function(){return a.popupEnabled&&null!=a.popupTemplate}).then(function(){return function(){var b="this SceneLayer: "+a.title;null==a.attributeStorageInfo?S.warn("Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on "+b):
S.info("Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on "+b)}})};f.prototype._buddyIsMoreImportant=function(a){if(m.isNone(this.associatedLayer))return!1;var b=this.originIdOf(a);a=this.associatedLayer.originIdOf(a);return null!=a&&2>=a?null==b||2>b:null!=a&&3>=a?null==b||3>b:!1};f.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("mesh-pyramids"===this.profile&&"absolute-height"!==a.mode&&S.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),
a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&S.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};d.__decorate([t.property({types:{key:"type",base:C.default,typeMap:{selection:E}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],f.prototype,"featureReduction",void 0);d.__decorate([t.property({type:[M.default],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",
write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],f.prototype,"rangeInfos",void 0);d.__decorate([t.property({json:{read:!1}})],f.prototype,"associatedLayer",void 0);d.__decorate([t.property({type:["show","hide"]})],f.prototype,"listMode",void 0);d.__decorate([t.property({type:["ArcGISSceneServiceLayer"]})],f.prototype,"operationalLayerType",void 0);d.__decorate([t.property({json:{read:!1},readOnly:!0})],f.prototype,"type",void 0);d.__decorate([t.property(d.__assign(d.__assign({},
P.fields),{readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}}))],f.prototype,"fields",void 0);d.__decorate([t.property({readOnly:!0,dependsOn:["fields"]})],f.prototype,"fieldsIndex",null);d.__decorate([t.property(P.outFields)],f.prototype,"outFields",void 0);d.__decorate([t.property({type:I.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],f.prototype,"nodePages",void 0);d.__decorate([t.reader("service","nodePages",["nodePages","pointNodePages"])],f.prototype,"readNodePages",null);d.__decorate([t.property({type:[I.I3SMaterialDefinition],
readOnly:!0})],f.prototype,"materialDefinitions",void 0);d.__decorate([t.property({type:[I.I3STextureSetDefinition],readOnly:!0})],f.prototype,"textureSetDefinitions",void 0);d.__decorate([t.property({type:[I.I3SGeometryDefinition],readOnly:!0})],f.prototype,"geometryDefinitions",void 0);d.__decorate([t.property({readOnly:!0})],f.prototype,"serviceUpdateTimeStamp",void 0);d.__decorate([t.property({readOnly:!0})],f.prototype,"attributeStorageInfo",void 0);d.__decorate([t.property({readOnly:!0})],f.prototype,
"statisticsInfo",void 0);d.__decorate([t.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:!0}})],f.prototype,"definitionExpression",void 0);d.__decorate([t.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],f.prototype,"path",void 0);d.__decorate([t.property(B.elevationInfo)],f.prototype,"elevationInfo",null);d.__decorate([t.property({type:String,dependsOn:["profile"]})],f.prototype,"geometryType",null);
d.__decorate([t.property(B.labelsVisible)],f.prototype,"labelsVisible",void 0);d.__decorate([t.property({type:[K],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:L.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:L.reader},write:!0}})],f.prototype,"labelingInfo",void 0);d.__decorate([t.property(B.legendEnabled)],f.prototype,"legendEnabled",void 0);d.__decorate([t.property(B.opacityDrawingInfo)],f.prototype,"opacity",void 0);d.__decorate([t.property({types:k.webSceneRendererTypes,
json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],f.prototype,"renderer",null);d.__decorate([t.property({json:{read:!1}})],f.prototype,"cachedDrawingInfo",void 0);d.__decorate([t.reader("service","cachedDrawingInfo")],f.prototype,"readCachedDrawingInfo",null);d.__decorate([t.property(B.popupEnabled)],f.prototype,"popupEnabled",void 0);d.__decorate([t.property({type:l,json:{name:"popupInfo",write:!0}})],f.prototype,"popupTemplate",
void 0);d.__decorate([t.property({readOnly:!0,json:{read:!1},dependsOn:["fields","title","attributeStorageInfo","associatedLayer"]})],f.prototype,"defaultPopupTemplate",null);d.__decorate([t.property({type:String,json:{read:!1}})],f.prototype,"objectIdField",void 0);d.__decorate([t.reader("service","objectIdField",["objectIdField","fields"])],f.prototype,"readObjectIdField",null);d.__decorate([t.property({json:{read:!1}})],f.prototype,"objectIdFilter",void 0);d.__decorate([t.property({type:String,
json:{read:!1}})],f.prototype,"profile",void 0);d.__decorate([t.reader("service","profile",["store.profile"])],f.prototype,"readProfile",null);d.__decorate([t.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],f.prototype,"normalReferenceFrame",void 0);d.__decorate([t.property(A.screenSizePerspectiveEnabled)],f.prototype,"screenSizePerspectiveEnabled",void 0);return f=d.__decorate([t.subclass("esri.layers.SceneLayer")],f)}(x.SceneService(q.ArcGISService(v.OperationalLayer(w.PortalLayer(z.ScaleRangeLayer(f.MultiOriginJSONMixin(r)))))))})},
"esri/layers/mixins/SceneService":function(){define("require exports tslib ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../../portal/Portal ../../portal/PortalItem ../../webdoc/support/saveUtils @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w){Object.defineProperty(a,"__esModule",{value:!0});a.SCENE_SERVICE_ITEM_TYPE=a.SceneService=void 0;var z=c.getLogger("esri.layers.mixins.SceneService");a.SceneService=function(c){return function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.minScale=0;a.maxScale=0;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";
a.title=null;a.layerId=null;a._debouncedSaveOperations=h.debounce(function(b,c,e){return d.__awaiter(a,void 0,void 0,function(){return d.__generator(this,function(a){switch(b){case 0:return[2,this._save(c)];case 1:return[2,this._saveAs(e,c)]}return[2]})})});return a}d.__extends(e,c);e.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};e.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return t.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||
a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new t(a):null};e.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent||!Array.isArray(a.extent)||a.extent.some(function(a){return a<x})?null:new g({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:b})};e.prototype.readVersion=function(a,b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,
minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};e.prototype.readTitlePortalItem=function(a){return"item-title"!==this.sublayerTitleMode?void 0:a};e.prototype.readTitleService=function(a,b){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return u.titleFromUrlAndName(this.url,b.name);b=b.name||u.parse(this.url).title;"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);
return u.cleanTitle(b)};Object.defineProperty(e.prototype,"url",{set:function(a){a=u.sanitizeUrlWithLayerId(this,a,z);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!1,configurable:!0});e.prototype.writeUrl=function(a,b,c,d){u.writeUrlWithLayerId(this,a,"layers",b,d)};Object.defineProperty(e.prototype,"parsedUrl",{get:function(){var a=this._get("url");if(!a)return null;a=m.urlToObject(a);null!=this.layerId&&u.isArcGISUrl(a.path)&&(a.path=a.path+"/layers/"+this.layerId);
return a},enumerable:!1,configurable:!0});e.prototype._verifyRootNodeAndUpdateExtent=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f;return d.__generator(this,function(d){switch(d.label){case 0:if(!a)return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),c=this._updateExtentFromRootPage,e=[a],[4,this._fetchRootPage(a,b)];case 2:return[2,c.apply(this,e.concat([d.sent()]))];case 3:return d.sent(),[3,4];case 4:return f=this._updateExtentFromRootNode,[4,this._fetchRootNode(b)];
case 5:return[2,f.apply(this,[d.sent()])]}})})};e.prototype._fetchRootPage=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f;return d.__generator(this,function(d){switch(d.label){case 0:if(!a)return[2,h.reject()];c=Math.floor(a.rootIndex/a.nodesPerPage);e=this.parsedUrl.path+"/nodepages/"+c;return[4,l(e,{responseType:"json",signal:b})];case 1:return f=d.sent(),[2,f.data]}})})};e.prototype._updateExtentFromRootPage=function(a,b){if(null==b||null==b.nodes)throw new k("sceneservice:invalid-node-page",
"Inavlid node page.");b=b.nodes[a.rootIndex%a.nodesPerPage];if(null==b||null==b.obb||null==b.obb.center||null==b.obb.halfSize)throw new k("sceneservice:invalid-node-page","Inavlid node page.");b.obb.center[0]<x||(a=b.obb.halfSize,b=b.obb.center[2],a=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),this.fullExtent.zmin=b-a,this.fullExtent.zmax=b+a)};e.prototype._updateExtentFromRootNode=function(a){if(null!=a&&null!=this.fullExtent&&!this.fullExtent.hasZ&&Array.isArray(a.mbs)&&4===a.mbs.length&&!(a.mbs[0]<
x)){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};e.prototype._fetchRootNode=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e;return d.__generator(this,function(d){switch(d.label){case 0:if(!this.rootNode)return[2];b=m.join(this.parsedUrl.path,this.rootNode);d.label=1;case 1:return d.trys.push([1,3,,4]),[4,l(b,{query:{f:"json"},responseType:"json",signal:a})];case 2:return c=d.sent(),[2,c.data];case 3:throw e=d.sent(),new k("sceneservice:root-node-missing",
"Root node missing.",{error:e,url:b});case 4:return[2]}})})};e.prototype._fetchService=function(a){return d.__awaiter(this,void 0,void 0,function(){var b;return d.__generator(this,function(c){switch(c.label){case 0:return null==this.layerId&&/SceneServer\/*$/i.test(this.url)?[4,this._fetchFirstLayerId(a)]:[3,2];case 1:b=c.sent(),null!=b&&(this.layerId=b),c.label=2;case 2:return[2,this._fetchServiceLayer(a)]}})})};e.prototype._fetchFirstLayerId=function(a){return d.__awaiter(this,void 0,void 0,function(){var b;
return d.__generator(this,function(c){switch(c.label){case 0:return[4,l(this.url,{query:{f:"json"},responseType:"json",signal:a})];case 1:return b=c.sent(),b.data&&Array.isArray(b.data.layers)&&0<b.data.layers.length?[2,b.data.layers[0].id]:[2,void 0]}})})};e.prototype._fetchServiceLayer=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c;return d.__generator(this,function(d){switch(d.label){case 0:return[4,l(this.parsedUrl.path,{query:{f:"json"},responseType:"json",signal:a})];case 1:return b=
d.sent(),b.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),c=b.data,this.read(c,{origin:"service",url:this.parsedUrl}),this.validateLayer(c),[2]}})})};e.prototype._ensureLoadBeforeSave=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(a){switch(a.label){case 0:return[4,this.load()];case 1:return a.sent(),"beforeSave"in this&&"function"===typeof this.beforeSave?[4,this.beforeSave()]:[3,3];case 2:a.sent(),a.label=3;case 3:return[2]}})})};e.prototype.validateLayer=
function(a){};e.prototype._updateTypeKeywords=function(a,b,c){a.typeKeywords||(a.typeKeywords=[]);var d=0;for(b=b.getTypeKeywords();d<b.length;d++)a.typeKeywords.push(b[d]);a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b}),1===c&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"Hosted Service"!==a})))};e.prototype._saveAs=function(c,e){return d.__awaiter(this,void 0,void 0,function(){var f,g,m,l,p;return d.__generator(this,function(n){switch(n.label){case 0:f=
d.__assign(d.__assign({},A),e);if(g=v.from(c))return[3,2];z.error("_saveAs(): requires a portal item parameter");return[4,h.reject(new k("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))];case 1:n.sent(),n.label=2;case 2:return g.id&&(g=g.clone(),g.id=null),m=g.portal||q.getDefault(),[4,this._ensureLoadBeforeSave()];case 3:return n.sent(),g.type=a.SCENE_SERVICE_ITEM_TYPE,g.portal=m,l={origin:"portal-item",url:null,messages:[],portal:m,portalItem:g,writtenProperties:[],
blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},p={layers:[this.write(null,l)]},[4,h.all(l.resources.pendingOperations)];case 4:return n.sent(),[4,this._validateAgainstJSONSchema(p,l,f)];case 5:return n.sent(),g.url=this.url,g.title||(g.title=this.title),this._updateTypeKeywords(g,f,1),[4,m._signIn()];case 6:return n.sent(),[4,m.user.addItem({item:g,folder:f&&f.folder,data:p})];case 7:return n.sent(),[4,w.saveResources(this.resourceReferences,l,null)];case 8:return n.sent(),
this.portalItem=g,b.updateOrigins(l),l.portalItem=g,[2,g]}})})};e.prototype._save=function(c){return d.__awaiter(this,void 0,void 0,function(){var e,f,g;return d.__generator(this,function(l){switch(l.label){case 0:e=d.__assign(d.__assign({},A),c);if(this.portalItem)return[3,2];z.error("_save(): requires the .portalItem property to be set");return[4,h.reject(new k("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))];case 1:l.sent(),l.label=2;case 2:if(this.portalItem.type===
a.SCENE_SERVICE_ITEM_TYPE)return[3,4];z.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+a.SCENE_SERVICE_ITEM_TYPE);return[4,h.reject(new k("sceneservice:portal-item-wrong-type",'Portal item needs to have type "'+a.SCENE_SERVICE_ITEM_TYPE+'"'))];case 3:l.sent(),l.label=4;case 4:return[4,this._ensureLoadBeforeSave()];case 5:return l.sent(),f={origin:"portal-item",url:this.portalItem.itemUrl&&m.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||
q.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},g={layers:[this.write(null,f)]},[4,h.all(f.resources.pendingOperations)];case 6:return l.sent(),[4,this._validateAgainstJSONSchema(g,f,e)];case 7:return l.sent(),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,e,0),[4,this.portalItem.update({data:g})];case 8:return l.sent(),
[4,w.saveResources(this.resourceReferences,f,null)];case 9:return l.sent(),b.updateOrigins(f),[2,this.portalItem]}})})};e.prototype._validateAgainstJSONSchema=function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var e,f,g,h,m,l;return d.__generator(this,function(d){switch(d.label){case 0:return e=b.messages.filter(function(a){return"error"===a.type}).map(function(a){return new k(a.name,a.message,a.details)}),c&&c.validationOptions.ignoreUnsupported&&(e=e.filter(function(a){return"layer:unsupported"!==
a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name&&"scenemodification:unsupported"!==a.name})),c.validationOptions.enabled||B?[4,new Promise(function(a,b){n(["../../layers/support/schemaValidator"],a,b)})]:[3,2];case 1:f=d.sent();g=f.validate(a,c.portalItemLayerType);if(0<g.length&&(h="Layer item did not validate:\n"+g.join("\n"),z.error("_validateAgainstJSONSchema(): "+h),"throw"===c.validationOptions.failPolicy))throw m=
g.map(function(a){return new k("sceneservice:schema-validation",a)}),l=m.concat(e),new k("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:l});d.label=2;case 2:if(0<e.length)throw new k("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:e});return[2]}})})};d.__decorate([f.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],
e.prototype,"id",void 0);d.__decorate([f.property({type:t})],e.prototype,"spatialReference",void 0);d.__decorate([f.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readSpatialReference",null);d.__decorate([f.property({type:g})],e.prototype,"fullExtent",void 0);d.__decorate([f.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readFullExtent",null);d.__decorate([f.property({readOnly:!0,type:p})],
e.prototype,"heightModelInfo",void 0);d.__decorate([f.property({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],e.prototype,"minScale",void 0);d.__decorate([f.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],e.prototype,"maxScale",void 0);d.__decorate([f.property({readOnly:!0})],e.prototype,"version",void 0);d.__decorate([f.reader("version",["store.version"])],
e.prototype,"readVersion",null);d.__decorate([f.property({type:String,json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0);d.__decorate([f.property({type:String,json:{read:!1}})],e.prototype,"sublayerTitleMode",void 0);d.__decorate([f.property({type:String})],e.prototype,"title",void 0);d.__decorate([f.reader("portal-item","title")],e.prototype,"readTitlePortalItem",null);d.__decorate([f.reader("service","title",["name"])],e.prototype,"readTitleService",null);d.__decorate([f.property({type:Number,
json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],e.prototype,"layerId",void 0);d.__decorate([f.property(r.url)],e.prototype,"url",null);d.__decorate([f.writer("url")],e.prototype,"writeUrl",null);d.__decorate([f.property({dependsOn:["layerId"]})],e.prototype,"parsedUrl",null);d.__decorate([f.property({readOnly:!0})],e.prototype,"store",void 0);d.__decorate([f.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],
e.prototype,"rootNode",void 0);return e=d.__decorate([f.subclass("esri.layers.mixins.SceneService")],e)}(c)};var x=-1E38,B=0;a.SCENE_SERVICE_ITEM_TYPE="Scene Service";var A={getTypeKeywords:function(){return[]},portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}}})},"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../multiOriginJSONSupportUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.updateOrigins=
void 0;a.updateOrigins=function(a){a&&a.writtenProperties&&a.writtenProperties.forEach(function(a){var e=a.target;a.newOrigin&&a.oldOrigin!==a.newOrigin&&d.isMultiOriginJSONMixin(e)&&e.updateOrigin(a.propName,a.newOrigin)})}})},"esri/webdoc/support/saveUtils":function(){define("require exports tslib ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/SetUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),function(n,a,d,l,k,e,c,h,m){function f(a,b){return d.__awaiter(this,
void 0,void 0,function(){var c;return d.__generator(this,function(d){switch(d.label){case 0:return[4,l.result(a.resource.portalItem.addResource(a.resource,a.content,b))];case 1:c=d.sent();if(!0===c.ok)a.finish&&a.finish(a.resource);else throw a.error&&a.error(c.error),c.error;return[2]}})})}function b(a,b){return d.__awaiter(this,void 0,void 0,function(){var c;return d.__generator(this,function(d){switch(d.label){case 0:return[4,l.result(a.resource.update(a.content,b))];case 1:c=d.sent();if(!0===
c.ok)a.finish(a.resource);else throw a.error(c.error),c.error;return[2]}})})}Object.defineProperty(a,"__esModule",{value:!0});a.saveResources=void 0;a.saveResources=function(a,l,n){return d.__awaiter(this,void 0,void 0,function(){var g,p,q,t,w,z,x,B,A,C,E,G,F,H,J,I,K;return d.__generator(this,function(d){switch(d.label){case 0:if(!l||!l.resources)return[2];g=l.portalItem===a.portalItem?c.SetFromValues(a.paths):new Set;a.paths.length=0;a.portalItem=l.portalItem;p=c.SetFromValues(l.resources.toKeep.map(function(a){return a.resource.path}));
q=new Set;t=[];p.forEach(function(b){g.delete(b);a.paths.push(b)});w=0;for(z=l.resources.toUpdate;w<z.length;w++)x=z[w],g.delete(x.resource.path),p.has(x.resource.path)||q.has(x.resource.path)?(B=x.resource,A=x.content,C=x.finish,E=x.error,G=m.getSiblingOfSameTypeI(B,h.generateUUID()),a.paths.push(G.path),t.push(f({resource:G,content:A,finish:C,error:E},n))):(a.paths.push(x.resource.path),t.push(b(x,n)),q.add(x.resource.path));F=0;for(H=l.resources.toAdd;F<H.length;F++)J=H[F],t.push(f(J,n)),a.paths.push(J.resource.path);
g.forEach(function(a){a=l.portalItem.resourceFromPath(a);t.push(a.portalItem.removeResource(a).catch(function(){}))});return 0===t.length?[2]:[4,e.eachAlways(t)];case 1:I=d.sent();e.throwIfAborted(n);K=I.filter(function(a){return"error"in a}).map(function(a){return a.error});if(0<K.length)throw new k("save:resources","Failed to save one or more resources",{errors:K});return[2]}})})}})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("require exports tslib ../../kernel ../../request ../../core/arrayUtils ../../core/maybe ../../core/promiseUtils ../FeatureLayer ../../portal/Portal ../../portal/PortalItem".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.FetchAssociatedFeatureLayer=void 0;n=function(){function a(a,b,c){this.parsedUrl=a;this.portalItem=b;this.signal=c;this.rootDocument=null;if(a=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this.urlParts={root:a[1],layerId:parseInt(a[2],10)}}a.prototype.fetch=function(){var a;return d.__awaiter(this,void 0,void 0,function(){var b,e,f;return d.__generator(this,function(d){switch(d.label){case 0:if(!this.urlParts)return[2,
null];if(null===(a=this.portalItem)||void 0===a)return[3,1];e=a;return[3,3];case 1:return[4,this.portalItemFromServiceItemId()];case 2:e=d.sent(),d.label=3;case 3:return b=e,c.isNone(b)?[2,this.loadFromUrl()]:[4,this.findAndLoadRelatedPortalItem(b)];case 4:return f=d.sent(),c.isNone(f)?[2,null]:[2,this.loadFeatureLayerFromPortalItem(f)]}})})};a.prototype.fetchPortalItem=function(){var a;return d.__awaiter(this,void 0,void 0,function(){var b,e;return d.__generator(this,function(d){switch(d.label){case 0:if(!this.urlParts)return[2,
null];if(null===(a=this.portalItem)||void 0===a)return[3,1];e=a;return[3,3];case 1:return[4,this.portalItemFromServiceItemId()];case 2:e=d.sent(),d.label=3;case 3:return b=e,c.isNone(b)?[2,null]:[2,this.findAndLoadRelatedPortalItem(b)]}})})};a.prototype.fetchRootDocument=function(){return d.__awaiter(this,void 0,void 0,function(){var a,b,e;return d.__generator(this,function(d){switch(d.label){case 0:if(c.isSome(this.rootDocument))return[2,this.rootDocument];if(c.isNone(this.urlParts))return this.rootDocument=
{},[2,{}];a={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal};b=this.urlParts.root+"/SceneServer";d.label=1;case 1:return d.trys.push([1,3,,4]),[4,k(b,a)];case 2:return e=d.sent(),this.rootDocument=e.data,[3,4];case 3:return d.sent(),this.rootDocument={},[3,4];case 4:return[2,this.rootDocument]}})})};a.prototype.fetchServiceOwningPortalUrl=function(){var a;return d.__awaiter(this,void 0,void 0,function(){var b,c,e,f,g;return d.__generator(this,function(d){switch(d.label){case 0:b=
null===(a=l.id)||void 0===a?void 0:a.findServerInfo(this.parsedUrl.path);if(null===b||void 0===b?0:b.owningSystemUrl)return[2,b.owningSystemUrl];c=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";d.label=1;case 1:return d.trys.push([1,3,,4]),[4,k(c,{query:{f:"json"},responseType:"json",signal:this.signal})];case 2:return e=d.sent(),(f=e.data.owningSystemUrl)?[2,f]:[3,4];case 3:return g=d.sent(),h.throwIfAbortError(g),[3,4];case 4:return[2,null]}})})};a.prototype.findAndLoadRelatedPortalItem=
function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c;return d.__generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,a.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})];case 1:return b=d.sent(),[2,e.find(b,function(a){return"Feature Service"===a.type})||null];case 2:return c=d.sent(),h.throwIfAbortError(c),[2,null];case 3:return[2]}})})};a.prototype.loadFeatureLayerFromPortalItem=function(a){return d.__awaiter(this,
void 0,void 0,function(){var b,c;return d.__generator(this,function(d){switch(d.label){case 0:return[4,a.load({signal:this.signal})];case 1:return d.sent(),[4,this.findMatchingAssociatedSublayerUrl(a.url)];case 2:return b=d.sent(),c=new m({url:b,portalItem:a}),[2,c.load({signal:this.signal})]}})})};a.prototype.loadFromUrl=function(){return d.__awaiter(this,void 0,void 0,function(){var a,b;return d.__generator(this,function(c){switch(c.label){case 0:return[4,this.findMatchingAssociatedSublayerUrl(this.urlParts.root+
"/FeatureServer")];case 1:return a=c.sent(),b=new m({url:a}),[2,b.load({signal:this.signal})]}})})};a.prototype.findMatchingAssociatedSublayerUrl=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e,f,g,m,l,p,n,A,C,E;return d.__generator(this,function(d){switch(d.label){case 0:return b=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),c={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},e=this.urlParts.layerId,f=this.fetchRootDocument(),g=k(b,c),[4,
h.all([g,f])];case 1:m=d.sent();l=m[0];n=(p=m[1])&&p.layers;A=l.data&&l.data.layers;if(!Array.isArray(A))throw Error("expected layers array");if(Array.isArray(n))for(C=0;C<Math.min(n.length,A.length);C++){if(E=n[C],E.id===e)return[2,b+"/"+A[C].id]}else if(e<A.length)return[2,b+"/"+A[e].id];throw Error("could not find matching associated sublayer");}})})};a.prototype.portalItemFromServiceItemId=function(){return d.__awaiter(this,void 0,void 0,function(){var a,e,g,k;return d.__generator(this,function(d){switch(d.label){case 0:return[4,
this.fetchRootDocument()];case 1:a=d.sent();e=a.serviceItemId;if(!e)return[2,null];g=new b({id:e});return[4,this.fetchServiceOwningPortalUrl()];case 2:k=d.sent();c.isSome(k)&&(g.portal=new f({url:k}));try{return[2,g.load({signal:this.signal})]}catch(v){return h.throwIfAbortError(v),[2,null]}}})})};return a}();a.FetchAssociatedFeatureLayer=n})},"esri/layers/support/I3SLayerDefinitions":function(){define(["require","exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],
function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.I3SGeometryDefinition=a.I3SGeometryBuffer=a.I3SGeometryCompressedAttributes=a.I3SGeometryAttribute=a.I3STextureSetDefinition=a.I3STextureFormat=a.I3SMaterialDefinition=a.I3SMaterialPBRMetallicRoughness=a.I3SMaterialTexture=a.I3SNodePageDefinition=void 0;n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.nodesPerPage=null;b.rootIndex=0;b.lodSelectionMetricType=null;return b}d.__extends(b,a);d.__decorate([k.property({type:Number})],
b.prototype,"nodesPerPage",void 0);d.__decorate([k.property({type:Number})],b.prototype,"rootIndex",void 0);d.__decorate([k.property({type:String})],b.prototype,"lodSelectionMetricType",void 0);return b=d.__decorate([k.subclass("esri.layer.support.I3SNodePageDefinition")],b)}(l.JSONSupport);a.I3SNodePageDefinition=n;var e=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.factor=1;return b}d.__extends(b,a);d.__decorate([k.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],
b.prototype,"id",void 0);d.__decorate([k.property({type:Number})],b.prototype,"factor",void 0);return b=d.__decorate([k.subclass("esri.layer.support.I3SMaterialTexture")],b)}(l.JSONSupport);a.I3SMaterialTexture=e;var c=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.baseColorFactor=[1,1,1,1];b.baseColorTexture=null;b.metallicRoughnessTexture=null;b.metallicFactor=1;b.roughnessFactor=1;return b}d.__extends(b,a);d.__decorate([k.property({type:[Number]})],b.prototype,"baseColorFactor",
void 0);d.__decorate([k.property({type:e})],b.prototype,"baseColorTexture",void 0);d.__decorate([k.property({type:e})],b.prototype,"metallicRoughnessTexture",void 0);d.__decorate([k.property({type:Number})],b.prototype,"metallicFactor",void 0);d.__decorate([k.property({type:Number})],b.prototype,"roughnessFactor",void 0);return b=d.__decorate([k.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],b)}(l.JSONSupport);a.I3SMaterialPBRMetallicRoughness=c;n=function(a){function b(){var b=null!==
a&&a.apply(this,arguments)||this;b.alphaMode="opaque";b.alphaCutoff=.25;b.doubleSided=!1;b.cullFace="none";b.normalTexture=null;b.occlusionTexture=null;b.emissiveTexture=null;b.emissiveFactor=null;b.pbrMetallicRoughness=null;return b}d.__extends(b,a);d.__decorate([k.enumeration({opaque:"opaque",mask:"mask",blend:"blend"})],b.prototype,"alphaMode",void 0);d.__decorate([k.property({type:Number})],b.prototype,"alphaCutoff",void 0);d.__decorate([k.property({type:Boolean})],b.prototype,"doubleSided",void 0);
d.__decorate([k.enumeration({none:"none",back:"back",front:"front"})],b.prototype,"cullFace",void 0);d.__decorate([k.property({type:e})],b.prototype,"normalTexture",void 0);d.__decorate([k.property({type:e})],b.prototype,"occlusionTexture",void 0);d.__decorate([k.property({type:e})],b.prototype,"emissiveTexture",void 0);d.__decorate([k.property({type:[Number]})],b.prototype,"emissiveFactor",void 0);d.__decorate([k.property({type:c})],b.prototype,"pbrMetallicRoughness",void 0);return b=d.__decorate([k.subclass("esri.layer.support.I3SMaterialDefinition")],
b)}(l.JSONSupport);a.I3SMaterialDefinition=n;var h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);d.__decorate([k.property({type:String,json:{read:{source:["name","index"],reader:function(a,b){return null!=a?a:""+b.index}}}})],b.prototype,"name",void 0);d.__decorate([k.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2"})],b.prototype,"format",void 0);return b=d.__decorate([k.subclass("esri.layer.support.I3STextureFormat")],b)}(l.JSONSupport);
a.I3STextureFormat=h;n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.atlas=!1;return b}d.__extends(b,a);d.__decorate([k.property({type:[h]})],b.prototype,"formats",void 0);d.__decorate([k.property({type:Boolean})],b.prototype,"atlas",void 0);return b=d.__decorate([k.subclass("esri.layer.support.I3STextureSetDefinition")],b)}(l.JSONSupport);a.I3STextureSetDefinition=n;var m=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);d.__decorate([k.enumeration({Float32:"Float32",
UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],b.prototype,"type",void 0);d.__decorate([k.property({type:Number})],b.prototype,"component",void 0);return b=d.__decorate([k.subclass("esri.layer.support.I3SGeometryAttribute")],b)}(l.JSONSupport);a.I3SGeometryAttribute=m;var f=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);d.__decorate([k.enumeration({draco:"draco"})],b.prototype,"encoding",void 0);d.__decorate([k.property({type:[String]})],
b.prototype,"attributes",void 0);return b=d.__decorate([k.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],b)}(l.JSONSupport);a.I3SGeometryCompressedAttributes=f;n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.offset=0;return b}d.__extends(b,a);d.__decorate([k.property({type:Number})],b.prototype,"offset",void 0);d.__decorate([k.property({type:m})],b.prototype,"position",void 0);d.__decorate([k.property({type:m})],b.prototype,"normal",void 0);d.__decorate([k.property({type:m})],
b.prototype,"uv0",void 0);d.__decorate([k.property({type:m})],b.prototype,"color",void 0);d.__decorate([k.property({type:m})],b.prototype,"uvRegion",void 0);d.__decorate([k.property({type:m})],b.prototype,"featureId",void 0);d.__decorate([k.property({type:m})],b.prototype,"faceRange",void 0);d.__decorate([k.property({type:f})],b.prototype,"compressedAttributes",void 0);return b=d.__decorate([k.subclass("esri.layer.support.I3SGeometryBuffer")],b)}(l.JSONSupport);a.I3SGeometryBuffer=n;l=function(a){function b(){return null!==
a&&a.apply(this,arguments)||this}d.__extends(b,a);d.__decorate([k.enumeration({triangle:"triangle"})],b.prototype,"topology",void 0);d.__decorate([k.property()],b.prototype,"geometryBuffers",void 0);return b=d.__decorate([k.subclass("esri.layer.support.I3SGeometryDefinition")],b)}(l.JSONSupport);a.I3SGeometryDefinition=l})},"esri/layers/support/RangeInfo":function(){define(["require","exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],function(n,a,d,l,k){Object.defineProperty(a,
"__esModule",{value:!0});a.RangeInfo=void 0;n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.name=null;c.field=null;c.currentRangeExtent=null;c.fullRangeExtent=null;c.type="rangeInfo";return c}d.__extends(c,a);d.__decorate([k.property({type:String,json:{read:!0,write:!0}})],c.prototype,"name",void 0);d.__decorate([k.property({type:String,json:{read:!0,write:!0}})],c.prototype,"field",void 0);d.__decorate([k.property({type:[Number],json:{read:!0,write:!0}})],c.prototype,"currentRangeExtent",
void 0);d.__decorate([k.property({type:[Number],json:{read:!0,write:!0}})],c.prototype,"fullRangeExtent",void 0);d.__decorate([k.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0);return c=d.__decorate([k.subclass("esri.layers.support.RangeInfo")],c)}(l.JSONSupport);a.RangeInfo=n;a.default=n})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("require exports tslib ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ./support/layerViewUpdatingProperties ../support/EventedSet ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v){var w={point:5E3,polygon:500,polyline:1E3};return function(a){function b(b){b=a.call(this,b)||this;b._controllerTotal=0;b._graphicsCoreTotal=0;b.suspendResumeExtentMode="data";return b}d.__extends(b,a);b.prototype.destroy=function(){this.fetcherContext&&(this.fetcherContext.destroy(),this.fetcherContext=null)};Object.defineProperty(b.prototype,"updatingProgressValue",{get:function(){var a=1;if(this.controller&&this.controller.updating){var b=this.controller.updatingRemaining,
c=this.controller.updatingTotal;0<c&&(this._controllerTotal=Math.max(c,this._controllerTotal),a=(c-b)/c)}var d=1;this.graphics3d&&this.graphics3d.graphicsCore&&(b=this.graphics3d.graphicsCore.updatingRemaining,c=this.graphics3d.graphicsCore.updatingTotal,0<c&&(this._graphicsCoreTotal=Math.max(c,this._graphicsCoreTotal),d=(c-b)/c));1===a&&1===d&&(this._graphicsCoreTotal=this._controllerTotal=0);return.5*(a+d)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"maximumNumberOfFeatures",
{get:function(){var a,b;return null!==(b=null===(a=this.controller)||void 0===a?void 0:a.maximumNumberOfFeatures)&&void 0!==b?b:this._get("maximumNumberOfFeatures")},set:function(a){this._set("maximumNumberOfFeatures",a);this.controller&&(this.controller.maximumNumberOfFeatures=a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1},enumerable:!1,
configurable:!0});Object.defineProperty(b.prototype,"asyncGraphicsUpdates",{get:function(){if(this.controller)switch(this.controller.mode){case "snapshot":var a=w[this.layer.geometryType];return null==a||this.controller.serviceDataCount>a;case "tiles":break;default:l.neverReached(this.controller.mode)}return!0},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"hasZ",{get:function(){var a=this.layer,b=a.capabilities&&a.capabilities.data;return b&&b.supportsZ?"returnZ"in a&&null!=a.returnZ?
a.returnZ:b.supportsZ:!1},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"hasM",{get:function(){var a=this.layer,b=a.capabilities&&a.capabilities.data;return b&&b.supportsM?"returnM"in a&&null!=a.returnM?a.returnM:!1:!1},enumerable:!1,configurable:!0});b.prototype.fetchPopupFeatures=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var a;return d.__generator(this,function(c){return(a=this.validateFetchPopupFeatures(b))?[2,e.reject(a)]:[2,this.fetchClientPopupFeatures(b)]})})};
b.prototype.setVisibility=function(a,b){this.graphics3d&&this.graphics3d.graphicsCore.setObjectIdVisibility(a,b)};b.prototype.createQuery=function(){return a.prototype.createQuery.call(this)};b.prototype.queryFeatures=function(b,c){var d=this,e=function(){return a.prototype.queryFeatures.call(d,b,c)};return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(b),e):e()};b.prototype.beforeSetController=function(a){a.maximumNumberOfFeatures=this.maximumNumberOfFeatures};b.prototype.createController=
function(){var a=this;this.fetcherContext=new p.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});var b=new f({layerView:this,context:this.fetcherContext,graphics:new u.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(b,"serviceDataExtent",function(b){a.graphics3d&&(a.graphics3d.dataExtent=b)},2);this.handles.add(c.init(this,"suspended",function(a){a?b.suspend():b.resume()},!0));this.updatingHandles.add(this.graphics3d.graphicsCore,"displayFeatureLimit",
function(){return a.updateDisplayFeatureLimit(b)},2);this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",function(){return a.updateDisplayFeatureLimit()}));return b};b.prototype.doRefresh=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(a){!this.suspended&&this.controller&&this.controller.refetch();return[2]})})};b.prototype.getUsedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return(a?a.usedMemory:
0)+(this.controller?this.controller.memoryForUnusedFeatures:0)};b.prototype.getUnloadedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return(a?a.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*a.usedMemoryPerGraphic:0)};b.prototype.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride};b.prototype.updateDisplayFeatureLimit=function(a){void 0===a&&(a=this.controller);if(a&&this.graphics3d&&
this.graphics3d.graphicsCore){var b=this.graphics3d.graphicsCore.displayFeatureLimit,c=this.view.resourceController.memoryController.memoryFactor;if(1===c)a.displayFeatureLimit=b;else{var e=Math.ceil(b.maximumNumberOfFeatures*c),f=Math.ceil(b.maximumTotalNumberOfFeatures*c),c=Math.ceil(b.minimumTotalNumberOfFeatures*c);a.displayFeatureLimit=d.__assign(d.__assign({},b),{maximumNumberOfFeatures:e,maximumTotalNumberOfFeatures:f,minimumTotalNumberOfFeatures:c})}}};b.prototype._queryFeaturesMesh=function(a,
b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g,h,k,l,n;return d.__generator(this,function(d){switch(d.label){case 0:return[4,this._validateQueryFeaturesMesh(a)];case 1:return d.sent(),[4,b()];case 2:c=d.sent();if(a&&a.outStatistics)return[2,c];e=this.layer.objectIdField;f=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID;g=[];h=0;for(k=c.features;h<k.length;h++)if(l=k[h],l.geometry){if(n=f.get(l.attributes[e]))l.geometry=m.hydrateGeometry(n.graphic.geometry),g.push(l)}else g.push(l);
c.features=g;return[2,c]}})})};b.prototype._validateQueryFeaturesMesh=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e,f,g;return d.__generator(this,function(d){if(!a)return[2];b=function(a){throw new k("feature-layer-view:unsupported-query","Queries on Mesh feature collection layers do not support '"+a+"'");};c=["quantizationParameters","geometryPrecision","maxAllowableOffset"];e=0;for(f=c;e<f.length;e++)g=f[e],null!=a[g]&&b(g);"returnM"in a&&a.returnM&&b("returnM");"returnCentroid"in
a&&a.returnCentroid&&b("returnCentroid");a.outSpatialReference&&!a.outSpatialReference.equals(this.view.spatialReference)&&b("outSpatialReference");return[2]})})};Object.defineProperty(b.prototype,"performanceInfo",{get:function(){var a=this.controller&&this.controller.displayFeatureLimit,a=(a=a&&a.maximumSymbolComplexity)?"f:"+a.primitivesPerFeature+",v:"+a.primitivesPerCoordinate:"n/a",a=d.__assign(d.__assign({},this._getResourceInfo()),{storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,
mode:this.controller?this.controller.mode:"n/a",symbolComplexity:a,nodes:this.controller?this.controller.tileDescriptors.length:0});if(this.controller&&a.displayedNumberOfFeatures){var b=this.controller.debug;a.storedFeatures=b.storedFeatures;a.totalVertices=b.totalVertices}return a},enumerable:!1,configurable:!0});d.__decorate([h.property()],b.prototype,"layer",void 0);d.__decorate([h.property()],b.prototype,"controller",void 0);d.__decorate([h.property({readOnly:!0,dependsOn:["controller.updatingRemaining",
"controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"]})],b.prototype,"updatingProgressValue",null);d.__decorate([h.property({dependsOn:["controller.maximumNumberOfFeatures"]})],b.prototype,"maximumNumberOfFeatures",null);d.__decorate([h.property({dependsOn:["suspended","controller.maximumNumberOfFeaturesExceeded"]})],b.prototype,"maximumNumberOfFeaturesExceeded",null);d.__decorate([h.property(t.updatingProgress)],b.prototype,"updatingProgress",
void 0);d.__decorate([h.property({readOnly:!0,dependsOn:["controller.mode","layer.geometryType","controller.serviceDataCount"]})],b.prototype,"asyncGraphicsUpdates",null);d.__decorate([h.property({readOnly:!0})],b.prototype,"hasZ",null);d.__decorate([h.property({readOnly:!0})],b.prototype,"hasM",null);d.__decorate([h.property()],b.prototype,"suspendResumeExtentMode",void 0);return b=d.__decorate([h.subclass("esri.views.3d.layers.FeatureLayerView3D")],b)}(v.RefreshableLayerView(b.FeatureLikeLayerView3D(r.FeatureLayerView(g.LayerView3D(q)))))})},
"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("require exports tslib ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/compilerUtils ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../support/arcgisLayerUrl ../../../portal/support/geometryServiceUtils ../../../tasks/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags ../../../views/support/WatchUpdatingTracking".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A){function C(a,b){if(!b)return!1;for(var c=0;c<b.length;c++)if(!a.has(b[c]))return!0;return!1}var E=b.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");n=function(a){function b(b){b=a.call(this,b)||this;b.type="feature-tile-3d";b.watchUpdatingTracking=new A.WatchUpdatingTracking;b.serviceDataExtent=null;b.serviceDataCount=l.constants.NO_SERVICE_DATA_COUNT;b.vertexLimitExceeded=!1;b.displayFeatureLimit=null;b.suspended=!1;b.tileFetcher=
null;b.handles=new m;b.fetchDataInfoPromise=null;b.fetchDataInfoAbortController=null;b.lifeCycleAbortController=t.createAbortController();return b}d.__extends(b,a);l=b;Object.defineProperty(b.prototype,"extent",{set:function(a){if(a&&!a.spatialReference.equals(this.layerView.view.spatialReference))E.error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var b=this._get("extent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("extent",a))}},enumerable:!1,
configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"updatingTotal",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingTotal:0},
enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"updatingRemaining",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"memoryForUnusedFeatures",{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:
0},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"maximumNumberOfFeatures",{get:function(){return this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:
0},set:function(a){a!==this.maximumNumberOfFeatures&&(null==a?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",a))},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"mode",{get:function(){if(this.serviceDataCount===l.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";
var a=this.layerView,b=a.layer,a=(a=(a=a.view)&&a.featureTiles)&&a.tilingScheme;return b&&b.minScale&&this.serviceDataExtent&&a&&(b=this.approximateExtentSizeAtScale(b.minScale,a),(this.serviceDataExtent.width/b+this.serviceDataExtent.height/b)/2>l.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"maxTotalSnapshotVertices",{get:function(){var a=
this._get("maxTotalSnapshotVertices")||0;return Math.max(a,"snapshot"===this.mode&&this.tileFetcher&&this.tileFetcher.totalVertices||0)},enumerable:!1,configurable:!0});b.prototype.approximateExtentSizeAtScale=function(a,b){var c=this.layerView.view,d=b.levels[0];return(d.tileSize[0]/(d.scale/a)+d.tileSize[1]/(d.scale/a))/2*Math.ceil((c.width/b.pixelSize+c.height/b.pixelSize)/2)};Object.defineProperty(b.prototype,"tileDescriptors",{get:function(){return"snapshot"===this.mode?new e([{id:"dummy-tile-full-extent",
lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new e},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}},enumerable:!1,configurable:!0});b.prototype.initialize=function(){var a=this;this.watchUpdatingTracking.add(this,"vertexLimitInfo",function(){return a.watchUpdatingTracking.addPromise(a.updateVertexLimitExceeded(null,a.lifeCycleAbortController.signal))});
this.watchUpdatingTracking.add(this,"mode",function(){return a.modeChanged()},2);this.addResolvingPromise(t.resolve().then(function(){return a.verifyCapabilities()}).then(function(){return a.watchUpdatingTracking.addPromise(a.fetchServiceDataInfo())}).then(function(){return a.initializeTileFetcher()}))};b.prototype.verifyCapabilities=function(){var a=this.layerView.layer;if(!a.get("capabilities.operations.supportsQuery"))throw new h("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",
{layer:a});};b.prototype.destroy=function(){this.cancelFetchServiceDataInfo();this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null);this.handles&&(this.handles.destroy(),this.handles=null);this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null);this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null);this.watchUpdatingTracking.destroy();this._set("watchUpdatingTracking",null)};b.prototype.suspend=function(){this.suspended||
(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())};b.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())};b.prototype.restart=function(){var a=this,b=function(){a.tileFetcher&&a.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(b,b))};b.prototype.refetch=function(){var a=this,b=function(){a.tileFetcher&&a.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(b,
b))};b.prototype.initializeTileFetcher=function(){var a=this,b=this.layerView.view;if(b){var c=u.whenOnce(b.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(c);c.then(function(){var c=a.layerView,d=c.layer;a.tileFetcher=new z.FeatureTileFetcher3D({context:a.context,filterExtent:a.filteredDataExtent,tileDescriptors:a.tileDescriptors,features:a.graphics});a.suspended?a.tileFetcher.suspend():a.tileFetcher.resume();var e=a.layerView.view.resourceController;
e&&(a.handles.add(e.memoryController.events.on("quality-changed",function(b){a.tileFetcher.memoryFactor=b})),a.tileFetcher.memoryFactor=e.memoryController.memoryFactor);(e="polygon"===a.context.geometryType?"polygonLodFactor":"polyline"===a.context.geometryType?"polylineLodFactor":null)&&a.handles.add(u.init(a.layerView.view,"qualitySettings.graphics3D."+e,function(b){a.tileFetcher.lodFactor=b||1}));a.watchUpdatingTracking.add(d,"createQueryVersion",function(){return a.dataFilterChanged()});a.watchUpdatingTracking.add(c,
"availableFields",function(b,c){return a.availableFieldsChanged(c,b)});a.watchUpdatingTracking.add(c,"requiredFields",function(b,c){return a.requiredFieldsChanged(c,b)});a.handles.add([d.on("apply-edits",function(b){return a.applyEdits(b)}),a.watch("filteredDataExtent",function(b){return a.tileFetcher.filterExtent=b},!0),a.watch("tileDescriptors",function(b){return a.tileFetcher.tileDescriptors=b},!0),u.init(a,"maximumNumberOfFeatures",function(b){a.tileFetcher.maximumNumberOfFeatures=b;a.tileFetcher.useTileCount=
a.serviceDataCount>b},!0),u.init(a,"serviceDataCount",function(b){return a.tileFetcher.useTileCount=b>a.maximumNumberOfFeatures},!0),u.init(B,"FEATURE_TILE_FETCH_SHOW_TILES",function(c){c&&a.tileFetcher&&!a.tileFetcher.debugger?(a.tileFetcher.debugger=new x.FeatureTileFetcher3DDebugger(a.tileFetcher,b.featureTiles.tilingScheme.toTileInfo(),b),a.tileFetcher.debugger.update()):!c&&a.tileFetcher&&a.tileFetcher.debugger&&(a.tileFetcher.debugger.destroy(),a.tileFetcher.debugger=null)})]);a.supportsExceedsLimitQuery||
a.watchUpdatingTracking.add(a,"maxTotalSnapshotVertices",function(){return a.watchUpdatingTracking.addPromise(a.updateVertexLimitExceeded(null,a.lifeCycleAbortController.signal))})}).catch(function(){})}};b.prototype.modeChanged=function(){switch(this.mode){case "tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:E.warn("Unhandled feature layer mode "+this.mode);case "snapshot":this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null)}};
b.prototype.dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};b.prototype.applyEdits=function(a){var b=this;this.tileFetcher.applyEdits(a).then(function(a){a&&(a.deletedFeatures.length||a.updatedFeatures.length||a.addedFeatures.length)&&b.watchUpdatingTracking.addPromise(b.updateServiceDataExtent(b.lifeCycleAbortController.signal))})};b.prototype.availableFieldsChanged=function(a,b){this.tileFetcher&&C(this.tileFetcher.availableFields,
b)&&this.refetch()};b.prototype.requiredFieldsChanged=function(a,b){this.tileFetcher&&C(this.tileFetcher.availableFields,b)&&this.restart()};b.prototype.createVertexLimitExceededQuery=function(a){var b=this.layerView.layer,c=b.createQuery();c.outStatistics=[new w({statisticType:"exceedslimit",maxVertexCount:a,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];b.capabilities.query.supportsCacheHint&&(c.cacheHint=!0);return c};b.prototype.createDataInfoQuery=function(){var a=
this.layerView.layer,b=a.createQuery();b.outSpatialReference=this.layerView.view.spatialReference;a.capabilities.query.supportsCacheHint&&(b.cacheHint=!0);return b};b.prototype.fullExtentIsAccurate=function(){var a=this.layerView.layer;if(a.definitionExpression)return!1;switch(a.type){case "feature":return q.isHostedAgolService(a.url);case "csv":case "geojson":case "ogc-feature":return!0;default:c.neverReached(a)}};b.prototype.updateServiceDataExtent=function(a){return d.__awaiter(this,void 0,void 0,
function(){var b;return d.__generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.tryUpdateServiceDataExtent(a)];case 1:return c.sent(),[3,3];case 2:return b=c.sent(),t.isAbortError(b)||this._set("serviceDataExtent",f.clone(this.layerView.fullExtentInLocalViewSpatialReference)),[3,3];case 3:return[2]}})})};b.prototype.tryUpdateServiceDataExtent=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e,g,h,k,m,n,p,r,q,t;return d.__generator(this,function(d){switch(d.label){case 0:b=
this.layerView;c=b.layer;e=c.capabilities.query.supportsExtent;g=f.clone(b.fullExtentInLocalViewSpatialReference);h=c.fullExtent;k=this.fullExtentIsAccurate();m=this.serviceDataCount;n=e&&m<=l.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!g||!k);if(!(n&&"queryExtent"in c))return[3,2];p=this.createDataInfoQuery();return[4,c.queryExtent(p,{timeout:l.constants.QUERY_EXTENT_TIMEOUT,signal:a})];case 1:return r=d.sent(),this._set("serviceDataExtent",r.extent),[3,6];case 2:if(!g)return[3,3];this._set("serviceDataExtent",
g);return[3,6];case 3:if(!h)return[3,5];q="portalItem"in c?c.portalItem:null;return[4,v.projectGeometry(h,b.view.spatialReference,q,a)];case 4:return t=d.sent(),this._set("serviceDataExtent",t),[3,6];case 5:this._set("serviceDataExtent",null),d.label=6;case 6:return[2]}})})};b.prototype.updateServiceDataCount=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e;return d.__generator(this,function(d){switch(d.label){case 0:return b=this.layerView.layer,"queryFeatureCount"in b?[4,k.result(b.queryFeatureCount(this.createDataInfoQuery(),
{timeout:l.constants.QUERY_STATISTICS_TIMEOUT,signal:a}))]:(c=l.constants.NO_SERVICE_DATA_COUNT,this._set("serviceDataCount",c),[2]);case 1:e=d.sent();if(!0===e.ok)this._set("serviceDataCount",e.value);else{if(t.isAbortError(e.error))throw e.error;c=l.constants.NO_SERVICE_DATA_COUNT;this._set("serviceDataCount",c)}return[2]}})})};Object.defineProperty(b.prototype,"vertexLimitInfo",{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var a=this.displayFeatureLimit,
b=a.maximumSymbolComplexity,a=a.maximumTotalNumberOfPrimitives,c=b.primitivesPerCoordinate,b=b.primitivesPerFeature,d=this._get("vertexLimitInfo");return g.isNone(d)||d.maximumTotalNumberOfPrimitives!==a||d.primitivesPerCoordinate!==c||d.primitivesPerFeature!==b?{primitivesPerCoordinate:c,primitivesPerFeature:b,maximumTotalNumberOfPrimitives:a}:d},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"supportsExceedsLimitQuery",{get:function(){var a=this.layerView.layer;return a.capabilities&&
a.capabilities.operations&&a.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var a=this.layerView.layer.geometryType;switch(a){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;default:return c.neverReached(a),0}},enumerable:!1,configurable:!0});b.prototype.updateVertexLimitExceeded=function(a,
b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,h,m,n,p,r,q,u,w,v,x,z,B;return d.__generator(this,function(d){switch(d.label){case 0:c=g.isSome(this.vertexLimitInfo)&&0>=this.vertexLimitInfo.primitivesPerFeature;e=1<this.minimumNumberOfVerticesForGeometry;f=this.layerView.layer;h=this.supportsExceedsLimitQuery;if(g.isNone(this.vertexLimitInfo)||!c&&!e)return this._set("vertexLimitExceeded",!1),[2];m=this.vertexLimitInfo;n=m.primitivesPerFeature;p=m.primitivesPerCoordinate;r=m.maximumTotalNumberOfPrimitives;
return(q=0!==n)&&g.isSome(a)?[4,a]:[3,2];case 1:d.sent(),d.label=2;case 2:return u=this.serviceDataCount,w=(v=u!==l.constants.NO_SERVICE_DATA_COUNT)?Math.ceil((r-u*n)/(p||1)):Math.ceil(r/(p||1)),e&&(w=Math.min(w,G)),v&&this.minimumNumberOfVerticesForGeometry*u>w?(this._set("vertexLimitExceeded",!0),[2]):h?[4,k.result(f.queryFeatures(this.createVertexLimitExceededQuery(w),{timeout:l.constants.QUERY_STATISTICS_TIMEOUT,signal:b}))]:(this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>w),[2]);
case 3:x=d.sent();if(!1===x.ok){if(t.isAbortError(x.error))throw x.error;this._set("vertexLimitExceeded",!1);return[2]}z=x.value;(B=z.features[0])&&B.attributes?this._set("vertexLimitExceeded",!!B.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);return[2]}})})};b.prototype.fetchServiceDataInfo=function(){return d.__awaiter(this,void 0,void 0,function(){var a,b,c,e,f,g=this;return d.__generator(this,function(d){this.cancelFetchServiceDataInfo();a=t.createAbortController();b=a.signal;c=
this.updateServiceDataCount(b);e=t.eachAlways([c,this.updateVertexLimitExceeded(c,b)]);f=e.then(function(){return g.updateServiceDataExtent(b)}).catch(function(a){t.isAbortError(a)||E.error("#fetchServiceDataInfo()",a)}).then(function(){f===g.fetchDataInfoPromise&&(g.fetchDataInfoPromise=null,g.fetchDataInfoAbortController=null);a=null});a&&(this.fetchDataInfoPromise=f);this.fetchDataInfoAbortController=a;return[2,e.then(function(){},function(){})]})})};b.prototype.cancelFetchServiceDataInfo=function(){var a=
this.fetchDataInfoAbortController;a&&(this.fetchDataInfoPromise=this.fetchDataInfoAbortController=null,a.abort())};Object.defineProperty(b.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!1,configurable:!0});var l;d.__decorate([r.property({readOnly:!0})],b.prototype,"type",void 0);d.__decorate([r.property({constructOnly:!0})],
b.prototype,"graphics",void 0);d.__decorate([r.property({constructOnly:!0})],b.prototype,"layerView",void 0);d.__decorate([r.property({constructOnly:!0})],b.prototype,"context",void 0);d.__decorate([r.property()],b.prototype,"extent",null);d.__decorate([r.property({dependsOn:["tileFetcher.updating","mode","layerView.view.featureTiles.updating","fetchDataInfoPromise","watchUpdatingTracking.updating"]})],b.prototype,"updating",null);d.__decorate([r.property({readOnly:!0})],b.prototype,"watchUpdatingTracking",
void 0);d.__decorate([r.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],b.prototype,"updatingTotal",null);d.__decorate([r.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],b.prototype,"updatingRemaining",null);d.__decorate([r.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],b.prototype,"expectedFeatureDiff",null);d.__decorate([r.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],b.prototype,"memoryForUnusedFeatures",null);d.__decorate([r.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],
b.prototype,"maximumNumberOfFeaturesExceeded",null);d.__decorate([r.property({readOnly:!0})],b.prototype,"serviceDataExtent",void 0);d.__decorate([r.property({readOnly:!0})],b.prototype,"serviceDataCount",void 0);d.__decorate([r.property({readOnly:!0})],b.prototype,"vertexLimitExceeded",void 0);d.__decorate([r.property({readOnly:!0,dependsOn:["extent"]})],b.prototype,"filteredDataExtent",null);d.__decorate([r.property()],b.prototype,"displayFeatureLimit",void 0);d.__decorate([r.property({type:Number,
dependsOn:["displayFeatureLimit"]})],b.prototype,"maximumNumberOfFeatures",null);d.__decorate([r.property({readOnly:!0,dependsOn:"serviceDataCount displayFeatureLimit maximumNumberOfFeatures vertexLimitExceeded serviceDataExtent layerView.layer.minScale layerView.view.featureTiles.tilingScheme".split(" ")})],b.prototype,"mode",null);d.__decorate([r.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],b.prototype,"maxTotalSnapshotVertices",null);d.__decorate([r.property({readOnly:!0,
dependsOn:["mode"]})],b.prototype,"tileDescriptors",null);d.__decorate([r.property()],b.prototype,"tileFetcher",void 0);d.__decorate([r.property()],b.prototype,"fetchDataInfoPromise",void 0);d.__decorate([r.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],b.prototype,"vertexLimitInfo",null);return b=l=d.__decorate([r.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],b)}(p.EsriPromiseMixin(l));var G=5E6;(function(a){(function(a){a.NO_SERVICE_DATA_COUNT=Infinity;a.MAX_SNAPSHOT_MIN_SCALE_FACTOR=
5;a.reset=function(){a.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;a.QUERY_STATISTICS_TIMEOUT=12E3;a.QUERY_EXTENT_TIMEOUT=1E4}})(a.constants||(a.constants={}))})(n||(n={}));n.constants.reset();return n})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/SetUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/QuantizationParameters ../../../../tasks/support/Query ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x){function B(a){return"dummy-tile-full-extent"===a.id}function A(a){for(var b=0,c=0;c<a.length;c++){var d=a[c];d.features&&0<d.features.length&&d.alive&&(b=Math.max(b,d.descriptor.lij[0]))}return b}function C(a){return h.isNone(a)?new Set:b.SetFromValues(a.map(function(a){return a.name}))}function E(a,b){if(h.isNone(a)||h.isNone(b))return C(b);for(var c=new Set,d=0;d<b.length;d++){var e=b[d].name;a.has(e)&&c.add(e)}return c}Object.defineProperty(a,
"__esModule",{value:!0});a.contextCapabilitiesFromLayer=a.FeatureTileFetcher3D=void 0;var G=c.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");n=function(a){function c(b){b=a.call(this,b)||this;b._useTileCount=!1;b.updating=!1;b.updatingTotal=0;b.updatingRemaining=0;b.expectedFeatureDiff=0;b.maximumNumberOfFeaturesExceeded=!1;b.maximumNumberOfFeaturesExceededThrottle=1E3;b.maximumNumberOfFeaturesExceededNext=0;b._fullRatio=1;b._farRatio=1;b.changes={updates:{adds:[],removes:[]},adds:[],
removes:[]};b.handles=new e;b._dirty=!1;b.featureTiles=new Map;b.displayingFeatureReferences=new Map;b.numDisplayingFeatureReferences=0;b.suspended=!0;b.pendingEdits=null;return b}d.__extends(c,a);Object.defineProperty(c.prototype,"maximumNumberOfFeatures",{set:function(a){a=a||Infinity;var b=this._get("maximumNumberOfFeatures");a===b||1>a||(this._set("maximumNumberOfFeatures",a),this.maximumFeaturesUpdated(b,a))},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"memoryFactor",{set:function(a){this.memoryFactor!==
a&&(this._set("memoryFactor",a),this.setDirty())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"lodFactor",{set:function(a){this.lodFactor!==a&&(this._set("lodFactor",a),this.supportsResolution&&this.refetch())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"useTileCount",{get:function(){return this._useTileCount&&h.isSome(this.context.query.queryFeatureCount)},set:function(a){this._useTileCount=a;this.notifyChange("useTileCount")},enumerable:!1,configurable:!0});
Object.defineProperty(c.prototype,"memoryForUnusedFeatures",{get:function(){var a=0;this.featureTiles.forEach(function(b){return a+=b.estimatedUnusedSize});return a},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"totalVertices",{get:function(){var a=0;this.featureTiles.forEach(function(b){return a+=b.numVertices});return a},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"totalFeatures",{get:function(){var a=0;this.featureTiles.forEach(function(b){return a+=b.numFeatures});
return a},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"filterExtent",{set:function(a){if(a&&this.context.tilingScheme&&!a.spatialReference.equals(this.context.tilingScheme.spatialReference))G.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.reclip(a,b))}},enumerable:!1,configurable:!0});c.prototype.initialize=function(){var a=
this;this.handles.add(g.on(this,"tileDescriptors","change",function(){return a.setDirty()},function(){return a.setDirty()}));this.objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?v.MultiFeatureReference:v.SingleFeatureReference;var b=this.context.scheduler;h.isSome(b)&&this.handles.add(b.registerTask(x.Task.FEATURE_TILE_FETCHER,function(b){return a.update(b)},function(){return a._dirty||0<a.maximumNumberOfFeaturesExceededNext}));
this.setDirty()};c.prototype.destroy=function(){var a=this;this.handles&&(this.handles.destroy(),this.handles=null);this.featureTiles.forEach(function(b){a.cancelFetchTile(b);a.removeTile(b)});this.featureTiles.clear();this.displayingFeatureReferences.clear();this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)};Object.defineProperty(c.prototype,"paused",{get:function(){return this.suspended||!!this.pendingEdits},enumerable:!1,configurable:!0});c.prototype.restart=function(){var a=
this;this.featureTiles.forEach(function(b){a.cancelFetchTile(b);a.clearTile(b);a.resetFetchTile(b)});h.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};c.prototype.refetch=function(){var a=this;this.featureTiles.forEach(function(b){a.cancelFetchTile(b);a.resetFetchTile(b)});h.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};c.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())};c.prototype.resume=
function(){this.suspended&&(this.suspended=!1,this.unpause())};c.prototype.pause=function(){var a=this;this.paused&&(this.featureTiles.forEach(function(b){return a.cancelFetchTile(b)}),this.updated())};c.prototype.unpause=function(){this.paused||(this.setDirty(),this.updated())};Object.defineProperty(c.prototype,"availableFields",{get:function(){var a=null;this.featureTiles.forEach(function(c){c.displayingFeatures&&0!==c.displayingFeatures.length&&(h.isNone(a)?a=b.SetFromValues(k.keysOfSet(c.availableFields)):
a.forEach(function(b){c.availableFields.has(b)||h.unwrap(a).delete(b)}))});return h.isSome(a)?a:new Set},enumerable:!1,configurable:!0});c.prototype.applyEdits=function(a){var b=this;this.pendingEdits||(this.pendingEdits={edits:m.resolve(),count:0,controller:m.createAbortController()},this.pause());this.pendingEdits.count++;var c=this.pendingEdits.edits.then(function(){return a.result.catch(function(a){if(m.isAbortError(a))throw a;return null}).then(function(a){return a?(b.applyEditsDeleteFeatures(a.deletedFeatures),
b.applyEditsAddUpdateFeatures(a.addedFeatures,a.updatedFeatures,b.pendingEdits.controller.signal).then(function(){return a})):a}).then(function(a){0===--b.pendingEdits.count&&(b.pendingEdits=null,h.isSome(b.context.memoryCache)&&b.context.memoryCache.clear(),b.unpause(),b.updated());return a})});this.pendingEdits.edits=c;this.updated();return c};c.prototype.applyEditsDeleteFeatures=function(a){var b=this;if(0!==a.length){var c=new Set;a.forEach(function(a){return c.add(a.objectId)});this.featureTiles.forEach(function(a){if(a.features){var d=
a.features.filter(function(a){return!c.has(u.getObjectId(a,b.objectIdField))});d.length!==a.features.length&&(a.setFeatures(d,0,a.availableFields),b.invalidateCounts())}})}};c.prototype.applyEditsAddUpdateFeatures=function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var e,f,g,h=this;return d.__generator(this,function(d){switch(d.label){case 0:e=[];f=new Set;a.forEach(function(a){return e.push(a.objectId)});b.forEach(function(a){e.push(a.objectId);f.add(a.objectId)});if(0===e.length)return[2];
g=[];this.featureTiles.forEach(function(a){(a=h.applyEditsAddUpdateTile(a,e,f,c))&&g.push(a)});return[4,m.eachAlways(g)];case 1:return d.sent(),[2]}})})};c.prototype.applyEditsAddUpdateTile=function(a,b,c,e){return d.__awaiter(this,void 0,void 0,function(){var f,g,h,k,m,l,n,p=this;return d.__generator(this,function(d){switch(d.label){case 0:if(!a.features)return[2];f=this.createQuery(a);f.resultType=void 0;f.cacheHint=!1;f.objectIds=b;return[4,this.queryFeatures(f,e)];case 1:g=d.sent();h=null;0<c.size&&
(k=a.features.filter(function(a){return!c.has(u.getObjectId(a,p.objectIdField))}),k.length!==a.features.length&&(h=k));if(0<g.features.length)for(h||(h=a.features.slice()),m=0,l=g.features;m<l.length;m++)n=l[m],h.push(n);h&&(a.setFeatures(h,0,E(a.availableFields,g.fields)),this.invalidateCounts());return[2]}})})};c.prototype.queryFeatures=function(a,b){return this.context.query.queryFeaturesDehydrated(a,{signal:b,timeout:I})};c.prototype.setDirty=function(){this._dirty=!0;this.updated()};c.prototype.update=
function(a){var b=this;this.maximumNumberOfFeaturesExceededNext&&performance.now()>=this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded();if(this._dirty&&this.constructed){this._dirty=!1;var c=this.getListOfTiles();this.markTilesNotAlive(c);if(a.run(function(){return b.addTiles(c,a)})&&a.run(function(){return b.filterExtentTiles(c,a)})&&a.run(function(){return b.removeTiles(c,a)})&&!a.done){var d=this.sortTiles(c);a.run(function(){return b.displayTiles(d,a)})&&a.run(function(){return b.fetchTiles(d,
a)})&&a.run(function(){return b.updateMemoryEstimates(d,a)})||this.setDirty();this.updated()}else this.setDirty()}};c.prototype.markTilesNotAlive=function(a){for(var b=0;b<a.length;b++)a[b].alive=!1};c.prototype.addTiles=function(a,b){var c=this;if(this.suspended)return!1;this.tileDescriptors.forEach(function(d){var e=c.featureTiles.get(d.id);e?e.alive=!0:b.done||(a.push(c.addTile(d)),b.madeProgress())});return b.hasProgressed};c.prototype.filterExtentTiles=function(a,b){for(var c=0;c<a.length;c++){var d=
a[c];if(b.done)break;d.alive&&(d.filtered=!d.intersects(this.filterExtent),d.filtered&&(this.clearTile(d),b.madeProgress()))}return b.hasProgressed};c.prototype.removeTiles=function(a,b){for(var c=a.length-1;0<=c&&!b.done;c--){var d=a[c];d.alive||(this.removeTile(d),c!==a.length-1&&(a[c]=a[a.length-1]),a.pop(),b.madeProgress())}return b.hasProgressed};c.prototype.sortTiles=function(a){a.sort(function(a,b){return a.descriptor.loadPriority-b.descriptor.loadPriority});return a};c.prototype.displayTiles=
function(a,b){for(var c=this,d=this.updateRatio(a),e=function(a){if(!b.run(function(){var b=1>c._fullRatio?d(a)*c._farRatio:1;a.reduceFeatures(b,c.memoryFactor,c.objectIdField)&&c.setDirty();return c.showTile(a)}))return f.setDirty(),"break"},f=this,g=0;g<a.length&&"break"!==e(a[g]);g++);return b.hasProgressed};c.prototype.fetchTiles=function(a,b){var c=this;if(this.paused)return!1;for(var d=!1,e=function(a){if(!a.needsFetching)return"continue";var c=h.isSome(f.context.memoryCache)?f.context.memoryCache.pop(a.id):
null;if(h.isSome(c))return a.cache=c,f.setDirty(),f.scheduleUpdated(),b.madeProgress(),"continue";if(f.needsNumFeatures(a)){var c=m.createAbortController(),e=f.fetchTileCount(a,c.signal);f._handleRequest(a,e,c,function(){return a.numFeatures=w.FAILED_FEATURE_COUNT});d=!0;b.madeProgress()}if(b.done)return{value:!0}},f=this,g=0;g<a.length;g++){var k=a[g],k=e(k);if("object"===typeof k)return k.value}if(d)return b.hasProgressed;for(var e=function(a){if(a.needsFetching){var d=m.createAbortController(),
e=l.fetchTile(a,d.signal);l._handleRequest(a,e,d,function(b){a.setFeatures([],0,null);c.invalidateCounts();a.featuresMissing=!1;c.context.logFetchError(G,b)});b.madeProgress();if(b.done)return{value:!0}}},l=this,g=0;g<a.length;g++)if(k=a[g],k=e(k),"object"===typeof k)return k.value;return b.hasProgressed};c.prototype.updateMemoryEstimates=function(a,b){var c=this;a.some(function(a){return b.run(function(){return a.updateMemoryEstimates()})?!1:(c.setDirty(),!0)});return b.hasProgressed};c.prototype.reclip=
function(a,b){var c=this;this.constructed&&(this.featureTiles.forEach(function(d){d.displayingFeatures&&0!==d.displayingFeatures.length&&(d.intersection(b,H),d.intersection(a,J),t.equals(H,J)||c.hideTileFeatures(d))}),this.featureTiles.forEach(function(a){return c.showTile(a)}),this.updated())};c.prototype.updated=function(){var a=this,b=0;this.paused||this.featureTiles.forEach(function(a){return a.isFetching?++b:0});var c=this._dirty||0<b||!!this.pendingEdits;this._set("updating",c);if(c){var d=
c=0,e=0,f=0,g=0,h=0,k=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach(function(b){++e;if(b.isFetching&&b.hasPreciseFeatureCount){var c=a.maximumFeaturesForTile(b)*(1-b.emptyFeatureRatio);h+=c-(b.displayingFeatures?b.displayingFeatures.length*k:0)}b.needsFetching?++g:0<b.numFeatures&&(++f,d+=b.numFeatures)});var g=g+b,m=0;d?(c=d,m=Math.min(g*d/f,d)):(c=e,m=g);h=Math.min(this.maximumNumberOfFeatures-this.features.length,h);this._set("updatingTotal",
c);this._set("updatingRemaining",m);this._set("expectedFeatureDiff",h)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update();this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||performance.now()+this.maximumNumberOfFeaturesExceededThrottle)};c.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var a=!1;this.featureTiles.forEach(function(b){a=
a||b.perTileMaximumNumberOfFeaturesExceeded});this.maximumNumberOfFeaturesExceededNext=0;this._set("maximumNumberOfFeaturesExceeded",a)}};c.prototype.updateRatio=function(a){for(var b=A(a),c=function(a){return 1/(1<<Math.max(0,b-a.descriptor.lij[0]))},d=0,e=0,f=0;f<a.length;f++)var g=a[f],h=g.numFeatures,d=d+h,e=e+h*c(g);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/d);this._farRatio=this.maximumNumberOfFeatures/e;this.scheduleUpdated();return c};c.prototype.maximumFeaturesUpdated=function(a,
b){var c=this;a!==b&&(b>a&&this.featureTiles.forEach(function(a){if(a.featuresMissing){var b=c.maximumFeaturesForTile(a);a.features&&(a.features.length>=b||5===a.fetchStatus)||(c.cancelFetchTile(a),c.resetFetchTile(a))}}),this.setDirty())};c.prototype.addTile=function(a){a=new w.FeatureTile(a);this.featureTiles.set(a.id,a);this.resetFetchTile(a);this.referenceDisplayingFeaturesFromRelatedTiles(a);return a};c.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(a){var b=this,c=a.descriptor.resolution;
this.featureTiles.forEach(function(d){if(d.displayingFeatures&&a!==d&&(!a.descriptor.lij||!d.descriptor.lij||z.tilesAreRelated(a.descriptor.lij,d.descriptor.lij))){a.displayingFeatures=a.displayingFeatures||[];var e=0;for(d=d.displayingFeatures;e<d.length;e++){var f=d[e];a.displayingFeatures.push(f);f=b.displayingFeatureReferences.get(u.getObjectId(f,b.objectIdField));f.ref(f.feature,c);b.numDisplayingFeatureReferences++}}});a.featureLimit=a.displayingFeatures?a.displayingFeatures.length:0};c.prototype.removeTile=
function(a){this.clearTile(a);this.featureTiles.delete(a.id)};c.prototype.resetFetchTile=function(a){a.filtered=!a.intersects(this.filterExtent);a.filtered?a.needsFetching&&(a.fetchStatus=4):a.fetchStatus=0};c.prototype.cancelFetchTile=function(a){var b=a.requestController;h.isSome(b)&&(a.requestController=null,a.resetFetching(),b.abort())};c.prototype.fetchTileCount=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c;return d.__generator(this,function(d){switch(d.label){case 0:return c=
a,[4,this.fetchCount(a,b)];case 1:return c.numFeatures=d.sent(),this.updateRatio(this.getListOfTiles()),[2,3===a.fetchStatus?1:0]}})})};c.prototype.fetchTile=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g,h,k,m,l,n,p,r;return d.__generator(this,function(d){switch(d.label){case 0:c=this.maximumFeaturesForTile(a);if(0>=c)return a.setFeatures([],0,null),a.featuresMissing=!1,[2,4];e=this.getMaxRecordCount(a);f=Math.ceil(c/e);if(B(a)||!this.context.capabilities.supportsMaxRecordCountFactor||
a.numFeatures<=c&&f>q.MAX_MAX_RECORD_COUNT_FACTOR)return[2,this.fetchPagedTile(a,b)];g=this.createQuery(a);g.maxRecordCountFactor=Math.ceil(c/e);a.isRefetching&&a.features&&0<a.features.length&&(h=Math.ceil(a.features.length/(1-a.emptyFeatureRatio)/e),g.maxRecordCountFactor=Math.max(h+1,g.maxRecordCountFactor));return[4,this.queryFeatures(g,b)];case 1:return k=d.sent(),m=k.features,l=k.exceededTransferLimit,n=k.fields,p=l?g.maxRecordCountFactor>=q.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,a.featuresMissing=
m.length<a.numFeatures||l,r=this._removeEmptyFeatures(m),a.setFeatures(m,r,C(n)),this.invalidateCounts(),[2,p]}})})};c.prototype.fetchCount=function(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){return[2,this.context.query.queryFeatureCount(this.createFeatureCountQuery(a),{signal:b})]})})};c.prototype.fetchPagedTile=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g,h,k,m,l,n,p,r,q,t;return d.__generator(this,function(d){switch(d.label){case 0:g=
e=c=0,h=this.maximumFeaturesForTile(a)-g,k=this.getMaxRecordCount(a),m=null,d.label=1;case 1:return l=this.createQuery(a),n=this.setPagingParameters(l,c,h,k),[4,this.queryFeatures(l,b)];case 2:return p=d.sent(),r=p.features,q=p.exceededTransferLimit,t=p.fields,n&&(c+=l.num),g+=r.length,e+=this._removeEmptyFeatures(r),a.featuresMissing=c<a.numFeatures||q,f=f?f.concat(r):r,m=E(m,t),a.setFeatures(f,e,m),this.invalidateCounts(),this.setDirty(),h=this.maximumFeaturesForTile(a)-g,!n||!q||0>=h?[2,q?4:5]:
[3,1];case 3:return[2]}})})};c.prototype.createFeatureCountQuery=function(a){a=this.createQuery(a);this.context.capabilities.supportsCacheHint&&(a.resultType=void 0,a.cacheHint=!0);return a};c.prototype.createQuery=function(a){var b=this.context.createQuery(),c=a.descriptor.extent;c&&(b.geometry=t.toExtent(c,this.context.tilingScheme.spatialReference));this.setResolutionParams(b,a);this.useTileQuery(a)?b.resultType="tile":this.context.capabilities.supportsCacheHint&&(b.cacheHint=!0);return b};c.prototype.setPagingParameters=
function(a,b,c,d){if(!this.context.capabilities.supportsPagination)return!1;a.start=b;0<c&&this.context.capabilities.supportsMaxRecordCountFactor?(a.maxRecordCountFactor=Math.ceil(c/d),a.num=Math.min(a.maxRecordCountFactor*d,c)):a.num=Math.min(d);return!0};c.prototype.getEffectiveTileResolution=function(a){if(null==a.descriptor.resolution)return null;var b=1===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(a.descriptor.resolution,b)/this.lodFactor};
Object.defineProperty(c.prototype,"supportsResolution",{get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType},enumerable:!1,configurable:!0});c.prototype.setResolutionParams=function(a,b){this.supportsResolution&&(b=this.getEffectiveTileResolution(b),null!=b&&(this.context.capabilities.supportsQuantization?a.quantizationParameters=new r.default({mode:"view",originPosition:"upper-left",tolerance:b,extent:this.context.fullExtent}):"polyline"===
this.context.geometryType&&(a.maxAllowableOffset=b)))};c.prototype._removeEmptyFeatures=function(a){for(var b=a.length,c=0;c<a.length;)u.hasVertices(a[c].geometry)?++c:(a[c]=a[a.length-1],--a.length);return b-a.length};c.prototype.needsNumFeatures=function(a){return this.useTileCount&&a.needsFeatureCount&&!B(a)};c.prototype.getMaxRecordCount=function(a){var b=this.context,c=b.tileMaxRecordCount,b=b.maxRecordCount;return this.useTileQuery(a)&&h.isSome(c)&&0<c&&this.context.capabilities.supportsResultType?
c:h.isSome(b)&&0<b?b:F};c.prototype.useTileQuery=function(a){return B(a)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};c.prototype._handleRequest=function(a,b,c,d){var e=this;a.fetchStatus=a.needsRefetching?3:2;a.requestController=c;var f=!1;b.then(function(b){a.requestController=null;a.fetchStatus=b}).catch(function(b){a.requestController===c&&(a.requestController=null,a.fetchStatus=4);m.isAbortError(b)?f=!0:d(b)}).then(function(){f||e.setDirty();e.scheduleUpdated()})};
c.prototype.scheduleUpdated=function(){var a=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(f.schedule(function(){a.handles.remove("scheduleUpdated");a.updated()}),"scheduleUpdated")};c.prototype.showTile=function(a){if(a.displayingFeatures&&!a.needsDisplayUpdate)return!1;var b=a.features;if(0===a.featureLimit||!b)return b=a.displayingFeatures&&0<a.displayingFeatures.length,this.hideTileFeatures(a),a.displayingFeatures=[],b;var c=a.descriptor.resolution,d=this.changes.updates,
e=this.changes.adds,f=Math.min(a.featureLimit,b.length);a.featureLimit=f;for(var g=0;g<f;++g){var h=b[g],k=u.getObjectId(h,this.objectIdField),m=this.displayingFeatureReferences.get(k);m?(h=m.ref(h,c),h.oldVersion!==h.newVersion&&(d.removes.push(h.oldVersion),d.adds.push(h.newVersion))):(this.displayingFeatureReferences.set(k,new this.FeatureReferenceClass(h,c)),e.push(h));this.numDisplayingFeatureReferences++}this.hideTileFeatures(a);this.applyChanges();a.displayingFeatures=b.slice(0,f);return!0};
c.prototype.hideTile=function(a){this.cancelFetchTile(a);this.hideTileFeatures(a)};c.prototype.hideTileFeatures=function(a){if(a.displayingFeatures){for(var b=this.changes.updates,c=this.changes.removes,d=0,e=a.displayingFeatures;d<e.length;d++){var f=u.getObjectId(e[d],this.objectIdField),g=this.displayingFeatureReferences.get(f);g&&((g=g.unref(a.descriptor.resolution),this.numDisplayingFeatureReferences--,g)?g.oldVersion!==g.newVersion&&(null==g.newVersion?(this.displayingFeatureReferences.delete(f),
c.push(g.oldVersion)):(b.adds.push(g.newVersion),b.removes.push(g.oldVersion))):console.error("Hiding unreferenced feature"))}this.applyChanges();a.displayingFeatures=null}};c.prototype.applyChanges=function(){var a=this.changes.updates;0<a.removes.length&&(this.features.removeMany(a.removes),a.removes.length=0);0<a.adds.length&&(this.features.addMany(a.adds),a.adds.length=0);for(var a=this.changes.adds,b=this.changes.removes,c=Math.min(a.length,b.length),d=0;d<c;){var e=Math.min(d+K,c);this.features.addMany(a.slice(d,
e));this.features.removeMany(b.slice(d,e));d=e}a.length>c&&this.features.addMany(0===d?a:a.slice(d));b.length>c&&this.features.removeMany(0===d?b:b.slice(d));a.length=0;b.length=0};c.prototype.clearTile=function(a){this.hideTile(a);a.features&&h.isSome(this.context.memoryCache)&&this.context.memoryCache.put(a.id,a.cache,16+a.estimatedSize);a.setFeatures(null,0,null);this.invalidateCounts()};c.prototype.invalidateCounts=function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");
this.notifyChange("memoryForUnusedFeatures")};c.prototype.getListOfTiles=function(){var a=Array(this.featureTiles.size),b=0;this.featureTiles.forEach(function(c){return a[b++]=c});return a};Object.defineProperty(c.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce(function(a,b){return a+(b.features?b.features.length:0)},0)},enumerable:!1,configurable:!0});c.prototype.maximumFeaturesForTile=function(a){var b=a.hasPreciseFeatureCount?a.numFeatures:Infinity;return Math.min(Math.ceil((a.hasPreciseFeatureCount?
b:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-a.emptyFeatureRatio)),b)};Object.defineProperty(c.prototype,"test",{get:function(){var a=this;return{update:function(b){return a.update(b)},getFeatureTileById:function(b){return a.featureTiles.get(b)},forEachFeatureTile:function(b){return a.featureTiles.forEach(b)}}},enumerable:!1,configurable:!0});d.__decorate([p.property({constructOnly:!0})],c.prototype,"features",void 0);d.__decorate([p.property()],c.prototype,"tileDescriptors",
void 0);d.__decorate([p.property({value:Infinity})],c.prototype,"maximumNumberOfFeatures",null);d.__decorate([p.property({value:1})],c.prototype,"memoryFactor",null);d.__decorate([p.property({value:1})],c.prototype,"lodFactor",null);d.__decorate([p.property({dependsOn:["context"]})],c.prototype,"useTileCount",null);d.__decorate([p.property({readOnly:!0})],c.prototype,"updating",void 0);d.__decorate([p.property({readOnly:!0})],c.prototype,"updatingTotal",void 0);d.__decorate([p.property({readOnly:!0})],
c.prototype,"updatingRemaining",void 0);d.__decorate([p.property({readOnly:!0})],c.prototype,"expectedFeatureDiff",void 0);d.__decorate([p.property({readOnly:!0})],c.prototype,"memoryForUnusedFeatures",null);d.__decorate([p.property({readOnly:!0})],c.prototype,"maximumNumberOfFeaturesExceeded",void 0);d.__decorate([p.property({constructOnly:!0})],c.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);d.__decorate([p.property({readOnly:!0})],c.prototype,"totalVertices",null);d.__decorate([p.property({readOnly:!0})],
c.prototype,"totalFeatures",null);d.__decorate([p.property()],c.prototype,"filterExtent",null);d.__decorate([p.property({constructOnly:!0})],c.prototype,"context",void 0);return c=d.__decorate([p.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],c)}(l);a.FeatureTileFetcher3D=n;a.contextCapabilitiesFromLayer=function(a){var b=a.capabilities.query;a:switch(a.geometryType){case "polyline":a=!0;break a;case "polygon":a=a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsQuantization;
break a;default:a=!1}return{supportsMultipleResolutions:a,supportsPagination:!(!b||!b.supportsPagination),supportsResultType:!(!b||!b.supportsResultType),supportsCacheHint:!(!b||!b.supportsCacheHint),supportsQuantization:!(!b||!b.supportsQuantization),supportsQuantizationEditMode:!(!b||!b.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!b||!b.supportsMaxRecordCountFactor),supportsFormatPBF:!(!b||!b.supportsFormatPBF)}};var F=2E3,H=t.create(),J=t.create(),I=6E5,K=200;a.default=n})},"esri/views/3d/layers/support/featureReference":function(){define(["require",
"exports","../../../../layers/graphics/dehydratedFeatures"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.SingleFeatureReference=a.MultiFeatureReference=void 0;n=function(){function a(a,c){this.highestResolutionVersion=null;this.versions=[];this.ref(a,c)}Object.defineProperty(a.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===
this.versions[0].refCount},enumerable:!1,configurable:!0});a.prototype.ref=function(a,c){var e=this.feature;l.oldVersion=e;this.feature&&Object.defineProperty(a,"uid",{value:this.feature.uid,configurable:!0});for(var k=0,f=this.versions;k<f.length;k++){var b=f[k];if(b.resolution===c){b.refCount++;if((c=this.highestResolutionVersion===b&&!d.equals(a,b.feature))||this.highestResolutionVersion!==b)b.feature=a;l.newVersion=c?a:e;return l}}b={feature:a,resolution:c,refCount:1};this.versions.push(b);!this.highestResolutionVersion||
c<this.highestResolutionVersion.resolution?(l.newVersion=a,this.highestResolutionVersion=b):l.newVersion=e;return l};a.prototype.unref=function(a){for(var c=0;c<this.versions.length;c++){var d=this.versions[c];if(d.resolution===a)return d.refCount--,l.oldVersion=this.feature,0===d.refCount&&(this.versions[c]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===d&&(this.recalculateHighestResolutionVersion(),l.oldVersion=d.feature)),l.newVersion=this.feature,
l}return null};Object.defineProperty(a.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!1,configurable:!0});a.prototype.recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{for(var a=this.versions[0],c=1;c<this.versions.length;c++){var d=this.versions[c];d.resolution<a.resolution&&(a=d)}this.highestResolutionVersion=a}};return a}();a.MultiFeatureReference=n;
n=function(){function a(a){this._feature=a;this.refCount=1}Object.defineProperty(a.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!1,configurable:!0});a.prototype.ref=function(a){++this.refCount;l.oldVersion=this._feature;this.feature&&Object.defineProperty(a,"uid",{value:this.feature.uid,configurable:!0});d.equals(this._feature,a)||(this._feature=a);
l.newVersion=this._feature;return l};a.prototype.unref=function(){l.oldVersion=this._feature;if(0<this.refCount&&(this.refCount--,!this.isReferenced))return l.newVersion=null,l;l.newVersion=this._feature;return l};Object.defineProperty(a.prototype,"feature",{get:function(){return this._feature},enumerable:!1,configurable:!0});return a}();a.SingleFeatureReference=n;var l={oldVersion:null,newVersion:null}})},"esri/views/3d/layers/support/FeatureTile":function(){define("require exports ../../../../core/arrayUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.FAILED_FEATURE_COUNT=a.FeatureTile=void 0;var c=new Set;n=function(){function a(a){this.descriptor=a;this.fetchStatus=0;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=h;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=c;this.displayingFeatures=null;this.alive=!0;this.filtered=
!1}Object.defineProperty(a.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"featureLimit",{get:function(){return this._featureLimit},set:function(a){this._featureLimit!==a&&(this._featureLimit=a,this._estimatedUnusedSizeDirty=
!0)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"availableFields",{get:function(){return this._availableFields},enumerable:!1,configurable:!0});a.prototype.setFeatures=function(a,d,f){this._availableFields=l.unwrapOr(f,c);this._features=a;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;a&&0<a.length?(this._emptyFeatureRatio=d/(a.length+d),this._numVertices=a.reduce(function(a,b){return a+e.numVertices(b.geometry)},0)):this._numVertices=this._emptyFeatureRatio=
0};Object.defineProperty(a.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"numFeatures",{get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(a){this._numFeatures=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hasPreciseFeatureCount",{get:function(){return this._numFeatures>h},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"needsFeatureCount",{get:function(){return this._numFeatures===h},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"estimatedSize",{get:function(){this.updateMemoryEstimates();return this._estimatedSize},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"estimatedUnusedSize",{get:function(){return this._estimatedUnusedSize},enumerable:!1,configurable:!0});a.prototype.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var a=0;a<this._features.length;++a){var c=e.estimateSize(this._features[a]);this._estimatedSize+=c;a>=this.featureLimit&&(this._estimatedUnusedSize+=c)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=
!1;if(this._features)for(a=this.featureLimit;a<this._features.length;++a)this._estimatedUnusedSize+=e.estimateSize(this._features[a]);return!0}return!1};Object.defineProperty(a.prototype,"isFetching",{get:function(){return 2===this.fetchStatus||3===this.fetchStatus},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isRefetching",{get:function(){return 3===this.fetchStatus},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"needsFetching",{get:function(){return 0===
this.fetchStatus||1===this.fetchStatus},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"needsRefetching",{get:function(){return 1===this.fetchStatus},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!1,configurable:!0});a.prototype.resetFetching=function(){this.fetchStatus=3===this.fetchStatus?1:0};Object.defineProperty(a.prototype,"needsDisplayUpdate",{get:function(){var a;
if(a=!!this._features){a:{a=this._features;var c=this.displayingFeatures,d=this.featureLimit;if(!c||!a||d!==c.length||d>a.length)a=!1;else{for(var e=0;e<d;++e)if(a[e]!==c[e]){a=!1;break a}a=!0}}a=!a}return a},enumerable:!1,configurable:!0});a.prototype.intersects=function(a){if(!a||!this.descriptor.extent)return!0;k.fromExtent(a,m);return k.intersects(this.descriptor.extent,m)};a.prototype.intersection=function(a,c){if(!a&&!this.descriptor.extent)return k.set(c,k.POSITIVE_INFINITY),c;a?(k.fromExtent(a,
c),this.descriptor.extent&&k.intersection(c,this.descriptor.extent,c)):k.set(c,this.descriptor.extent);return c};a.prototype._shuffle=function(a){this._features.sort(function(b,c){return e.getObjectId(b,a)-e.getObjectId(c,a)});d.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=!0};a.prototype.reduceFeatures=function(a,c,d){if(0>=a)return!1;var b=!1;this._features?(this.featureLimit=Math.ceil(this.numFeatures*a),this.featureLimit>this._features.length&&(this.featureLimit=
this._features.length,4===this.fetchStatus&&0<this._features.length&&(this.fetchStatus=1,b=!0)),!this._shuffled&&1>a&&this._shuffle(d),a=Math.max(this.featureLimit,Math.ceil(c*this.numFeatures)),this._features.length>a&&(this._features.length=a,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4))):this.featureLimit=0;return b};Object.defineProperty(a.prototype,"cache",{get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,
fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(a){this.requestController=null;this._availableFields=a.availableFields;this._features=a.features;this._numFeatures=a.numFeatures;this._emptyFeatureRatio=a.emptyFeatureRatio;this.fetchStatus=a.fetchStatus;this.featuresMissing=a.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0},enumerable:!1,configurable:!0});return a}();a.FeatureTile=n;var h=-1;a.FAILED_FEATURE_COUNT=-2;var m=k.create()})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("require exports ../../../../Graphic ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),
function(n,a,d,l,k,e,c,h,m){Object.defineProperty(a,"__esModule",{value:!0});a.FeatureTileFetcher3DDebugger=void 0;var f=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];n=function(){function a(a,b,d){this.loadingGraphics=new Map;this.loadedGraphics=new Map;this.pendingGraphics=new Map;this._enabled=!0;this.tileFetcher=
a;this.view=d;this.tilingScheme=new m(b);this.loadedSymbols=f.map(function(a){return new c(new k({material:{color:[a[0],a[1],a[2],.6]},outline:{color:"black",size:1}}))});this.loadingSymbols=[new c(new k({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this.pendingSymbols=[new c(new k({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this.dataExtentSymbol=new c(new k({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}a.prototype.destroy=function(){this.enabled=
!1};Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!1,configurable:!0});a.prototype.update=function(){var a=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(a){return a.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(a){return!a.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(a){return!a.isFetching},
symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))};a.prototype.showDataExtent=
function(a){this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null);a&&(a=l.fromExtent(a),this.dataExtentGraphic=new d({geometry:a,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic))};a.prototype.synchronizeMaps=function(a,b){var c=this,f=[];a.forEach(function(a,d){var e=c.tileFetcher.test.getFeatureTileById(d);e&&b.filter(e)||(c.view.graphics.removeMany(a),f.push(d))});f.forEach(function(b){return a.delete(b)});this.tileFetcher.test.forEachFeatureTile(function(f){if(b.filter(f)&&
!a.has(f.id)){var g=f.descriptor.lij,k=g[0],m=g[1],l=g[2];c.tilingScheme.ensureMaxLod(k);var n=c.tilingScheme.getExtentGeometry(k,m,l),g=new d({geometry:n,symbol:b.symbols[k%b.symbols.length]}),k=new d({geometry:n.center,symbol:new e({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new h({text:k+"/"+m+"/"+l,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})}),k=[g,k];a.set(f.id,k);c.view.graphics.addMany(k)}})};return a}();
a.FeatureTileFetcher3DDebugger=n;a.default=n})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("require exports tslib ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../renderers/support/renderingInfoUtils ../../../tasks/support/Query ./graphics/Graphics3DFeatureLikeLayerView ./graphics/QueryEngine ./support/projectExtentUtils ../../support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){Object.defineProperty(a,"__esModule",{value:!0});a.FeatureLikeLayerView3D=void 0;a.FeatureLikeLayerView3D=function(a){return function(a){function n(){var b=null!==a&&a.apply(this,arguments)||this;b.controller=null;b.asyncGraphicsUpdates=!1;b.suspendResumeExtentMode="computed";b.slicePlaneEnabled=!1;b.drapeSourceType=1;b.fullExtentInLocalViewSpatialReference=null;b.suspendResumeExtent=null;b._controllerCreated=!1;b.clippingExtent=null;b.supportsHeightUnitConversion=
!0;b.pendingController=null;b.queryEngine=null;return b}d.__extends(n,a);n.prototype.initialize=function(){var a=this,b=this.layer;"isTable"in b&&b.isTable?this.addResolvingPromise(e.reject(new l("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:b}))):(this._set("graphics3d",new p.default({owner:this,layer:b,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,
preferredUpdatePolicy:this.asyncGraphicsUpdates?1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(b){return a.updateClippingExtent(b)}})),this.updatingHandles.add(this,"asyncGraphicsUpdates",function(b){a.graphics3d.graphicsCore.preferredUpdatePolicy=b?1:0}),this.updatingHandles.add(this,"suspendResumeExtentMode",function(b){a.graphics3d.suspendResumeExtentMode=b}),this.addResolvingPromise(this.graphics3d.setup().then(function(){return a.validateGeometryType()}).then(function(){return a.queryEngine=
new t.default({layerView:a,task:r.Task.FEATURE_QUERY_ENGINE})}).then(function(){return u.toViewIfLocal(a)}).then(function(b){return a.fullExtentInLocalViewSpatialReference=b}).then(function(){return a.initializeController()})),this.notifyChange("updating"))};n.prototype.destroy=function(){this.destroyPendingController();this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this.queryEngine&&(this.queryEngine.destroy(),
this.queryEngine=null);this.loadedGraphics=null};n.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)};Object.defineProperty(n.prototype,"legendEnabled",{get:function(){return this.canResume()},enumerable:!1,configurable:!0});n.prototype.notifyGraphicUpdate=function(a,b){this.graphics3d.graphicsCore.notifyGraphicUpdate(a,b)};n.prototype.getRenderingInfo=function(a,c,d){(a=b.getRenderingInfo(a,{renderer:c,arcade:d}))&&
a.color&&(c=a.color,c[0]/=255,c[1]/=255,c[2]/=255);return a};n.prototype.getRenderingInfoAsync=function(a,c,e,f){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(g){return[2,b.getRenderingInfoAsync(a,d.__assign({renderer:c,arcade:e},f))]})})};n.prototype.getGraphicFromGraphicUid=function(a){var b=this,c=null;this.loadedGraphics&&this.loadedGraphics.forEach(function(d){d.uid===a&&(c=m.hydrateGraphic(d,b.layer))});return c};Object.defineProperty(n.prototype,"graphics3DGraphics",
{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!1,configurable:!0});
n.prototype.whenGraphicBounds=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(a,b):null};n.prototype.computeAttachmentOrigin=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(a,b):null};n.prototype.getSymbolLayerSize=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(a,b):null};n.prototype.queryFeatures=function(a,b){return this.queryEngine.executeQuery(this._ensureQuery(a),k.get(b,"signal"))};
n.prototype.queryObjectIds=function(a,b){return this.queryEngine.executeQueryForIds(this._ensureQuery(a),k.get(b,"signal"))};n.prototype.queryFeatureCount=function(a,b){return this.queryEngine.executeQueryForCount(this._ensureQuery(a),k.get(b,"signal"))};n.prototype.queryExtent=function(a,b){return this.queryEngine.executeQueryForExtent(this._ensureQuery(a),k.get(b,"signal"))};n.prototype._ensureQuery=function(a){return k.isNone(a)?this.createQuery():g.from(a)};n.prototype.highlight=function(a){return this.graphics3d.highlight(a,
this.layer.objectIdField)};n.prototype.canResume=function(){return!a.prototype.canResume.call(this)||this.graphics3d&&this.graphics3d.suspended?!1:!0};n.prototype.getSuspendInfo=function(){var b=a.prototype.getSuspendInfo.call(this);return this.graphics3d?d.__assign(d.__assign({},b),this.graphics3d.suspendInfo):b};n.prototype.isUpdating=function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!(!(!this._controllerCreated||this.controller&&this.controller.updating)&&this.view.basemapTerrain&&
this.view.basemapTerrain.ready&&!this.graphics3d.updating)};n.prototype.initializeController=function(){return d.__awaiter(this,void 0,void 0,function(){var a;return d.__generator(this,function(b){switch(b.label){case 0:return this.pendingController=a=this.createController(),[4,a.when()];case 1:return b.sent(),this.setControllerWhenInitialized(a),[2]}})})};n.prototype.setControllerWhenInitialized=function(a){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(b){switch(b.label){case 0:return b.trys.push([0,
2,,3]),[4,this.when()];case 1:return b.sent(),[3,3];case 2:return b.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),!this.isResolved()||this.destroyed?(this.destroyPendingController(),[2]):[4,c.whenTrueOnce(this.view,"basemapTerrain.ready")];case 4:return b.sent(),this.beforeSetController(a),this.pendingController=null,this.controller=a,this.loadedGraphics=a.graphics,this.notifyChange("updating"),[2]}})})};n.prototype.updateClippingExtent=function(a){this.clippingExtent=
a;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=a,!0}};n.prototype.validateGeometryType=function(){switch(this.layer.geometryType){case "multipatch":case "multipoint":return e.reject(new l("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}};n.prototype._getResourceInfo=function(){var a=this.controller&&this.controller instanceof f?
this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:a?a.maximumNumberOfFeatures:-1,totalNumberOfFeatures:a?a.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}};Object.defineProperty(n.prototype,"performanceInfo",{get:function(){return this._getResourceInfo()},
enumerable:!1,configurable:!0});d.__decorate([h.property()],n.prototype,"loadedGraphics",void 0);d.__decorate([h.property({dependsOn:["graphics3d.suspended"]})],n.prototype,"suspended",void 0);d.__decorate([h.property({readOnly:!0,dependsOn:["graphics3d.suspended"]})],n.prototype,"legendEnabled",null);d.__decorate([h.property({dependsOn:["graphics3d.updating","controller.updating"]})],n.prototype,"updating",void 0);d.__decorate([h.property()],n.prototype,"controller",void 0);d.__decorate([h.property()],
n.prototype,"graphics3d",void 0);d.__decorate([h.property({readOnly:!0})],n.prototype,"asyncGraphicsUpdates",void 0);d.__decorate([h.property({readOnly:!0})],n.prototype,"suspendResumeExtentMode",void 0);d.__decorate([h.property({type:Boolean})],n.prototype,"slicePlaneEnabled",void 0);d.__decorate([h.property({readOnly:!0,dependsOn:["graphics3d.suspendInfo"]})],n.prototype,"suspendInfo",void 0);d.__decorate([h.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],n.prototype,"hasDraped",void 0);
return n=d.__decorate([h.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],n)}(a)}})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("require exports tslib ../../../../Graphic ../../../../core/Accessor ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/accessorSupport/diffUtils ../../../../geometry/support/webMercatorUtils ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../../../support/WatchUpdatingTracking".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function k(b){b=a.call(this,b)||this;b._handles=new c;b.watchUpdatingTracking=new A.WatchUpdatingTracking;b.suspendResumeExtentMode="computed";b.dataExtent=null;b.suspendResumeExtent=null;return b}d.__extends(k,a);Object.defineProperty(k.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},
enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"suspendInfo",{get:function(){var a={};this.scaleVisibility&&this.scaleVisibility.suspended&&(a.outsideScaleRange=!0);this.frustumVisibility&&this.frustumVisibility.suspended&&(a.outsideOfView=!0);return a},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.watchUpdatingTracking&&
this.watchUpdatingTracking.updating)},enumerable:!1,configurable:!0});k.prototype.normalizeCtorArgs=function(a){var b=a.frustumVisibilityEnabled?new v:null,c=a.scaleVisibilityEnabled?new z:null,d=(a.filterVisibilityEnabled||a.timeExtentVisibilityEnabled)&&"multipatch"!==a.layer.geometryType?new q.Graphics3DFilterVisibility:null,e=a.elevationAlignmentEnabled?new r.default:null;return{graphicsCore:new u.Graphics3DCore({owner:a.owner,layer:a.layer,preferredUpdatePolicy:a.preferredUpdatePolicy,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled,
graphicSymbolSupported:!1,hasZ:a.owner.hasZ,hasM:a.owner.hasM}),frustumVisibility:b,scaleVisibility:c,filterVisibility:d,elevationAlignment:e,updateClippingExtent:a.updateClippingExtent,suspendResumeExtentMode:a.suspendResumeExtentMode,dataExtent:a.dataExtent}};k.prototype.initialize=function(){var a=this;this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()});this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,
"filter",function(){return a.filterVisibility.filterChanged()}),this.watchUpdatingTracking.add(this.owner,"timeExtent",function(){return a.filterVisibility.filterChanged()}));this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",function(c,d){b.diff(c,d)&&a.watchUpdatingTracking.addPromise(a.graphicsCore.elevationInfoChange())});this.watchUpdatingTracking.add(this.layer,"labelsVisible",function(){return a.graphicsCore.updateVisibilityInfo()});this.watchUpdatingTracking.add(this.layer,
"labelingInfo",function(c,d){b.diff(c,d)&&a.graphicsCore.updateLabelingInfo()})};k.prototype.setup=function(){return d.__awaiter(this,void 0,void 0,function(){var a,b,c,e,f=this;return d.__generator(this,function(d){switch(d.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),a=this.owner,b=this.owner.view.basemapTerrain,c=function(a,b,c){return f.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(a,b,c)},this.scaleVisibility&&this.scaleVisibility.setup(a,this.layer,
c,this.graphicsCore,b),this.filterVisibility&&("filter"in a||"timeExtent"in a)&&this.filterVisibility.setup(a,this.graphicsCore),this.elevationAlignment&&(e=a.view.elevationProvider,this.elevationAlignment.setup(a,c,this.graphicsCore,e)),this._set("objectStates",new w.Graphics3DObjectStates(this.graphicsCore)),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",a.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,
h.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}))];case 1:return d.sent(),this.watchUpdatingTracking.add(this.layer,"renderer",function(a){return f.watchUpdatingTracking.addPromise(f.graphicsCore.rendererChange(a))}),this.watchUpdatingTracking.add(a,"fullOpacity",function(){return f.graphicsCore.opacityChange()}),
this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(a.view,"clippingArea",function(){return f._updateClippingExtent()}),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,h.logOnError(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:d.sent(),d.label=3;case 3:return[2]}})})};k.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var a=0,b="watchUpdatingTracking frustumVisibility scaleVisibility filterVisibility elevationAlignment objectStates graphicsCore".split(" ");a<
b.length;a++){var c=b[a],d=this[c];d&&(d.destroy(),this._set(c,null))}this._set("layer",null);this._set("owner",null)};k.prototype.highlight=function(a,b){var c=this;if(a instanceof p){var d=this.objectStates.acquireSet(0,b),e=d.set,d=d.handle;this.owner.queryObjectIds(a).then(function(a){return c.objectStates.setObjectIds(e,a)});return d}if("number"===typeof a||"string"===typeof a||a instanceof l)return this.highlight([a],b);"toArray"in a&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof
l)if(b&&a[0].attributes&&null!==B.attributeLookup(a[0].attributes,b))a=a.map(function(a){return B.attributeLookup(a.attributes,b)});else{var f=a.map(function(a){return a.uid}),d=this.objectStates.acquireSet(0,null);a=d.set;d=d.handle;this.objectStates.setUids(a,f);return d}if("number"===typeof a[0]||"string"===typeof a[0])return f=a,d=this.objectStates.acquireSet(0,b),a=d.set,d=d.handle,this.objectStates.setObjectIds(a,f),d}return E};k.prototype._updateClippingExtent=function(){var a=this.owner.view.clippingArea;
this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())};k.prototype.setupSuspendResumeExtent=function(){var a=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(m.init(this,"suspendResumeExtentMode",function(){a._handles.remove(C);switch(a.suspendResumeExtentMode){case "computed":a._handles.add([m.init(a.graphicsCore,"computedExtent",function(b){return a.updateSuspendResumeExtent(b)}),a.graphicsCore.watch("extentPadding",
function(){return a.updateSuspendResumeExtent(a.graphicsCore.computedExtent)})],C);break;case "data":a._handles.add([m.init(a,"dataExtent",function(b){return a.updateSuspendResumeExtent(b)}),a.graphicsCore.watch("extentPadding",function(){return a.updateSuspendResumeExtent(a.dataExtent)})],C);break;default:e.neverReached(a.suspendResumeExtentMode)}}))};k.prototype.updateSuspendResumeExtent=function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};
k.prototype.extentToSuspendResumeRect=function(a,b){var c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!g.canProject(a,c))return;a=g.project(a,c)}return x.enlargeExtent(a,b,t.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};k.prototype.suspendResumeExtentChanged=function(a){this.frustumVisibility&&this.frustumVisibility.setExtent(a);this.scaleVisibility&&this.scaleVisibility.setExtent(a)};d.__decorate([f.property({aliasOf:"graphicsCore.layer"})],k.prototype,
"layer",void 0);d.__decorate([f.property({aliasOf:"graphicsCore.owner"})],k.prototype,"owner",void 0);d.__decorate([f.property({constructOnly:!0})],k.prototype,"updateClippingExtent",void 0);d.__decorate([f.property({constructOnly:!0})],k.prototype,"graphicsCore",void 0);d.__decorate([f.property({constructOnly:!0})],k.prototype,"scaleVisibility",void 0);d.__decorate([f.property({constructOnly:!0})],k.prototype,"filterVisibility",void 0);d.__decorate([f.property({constructOnly:!0})],k.prototype,"elevationAlignment",
void 0);d.__decorate([f.property({constructOnly:!0})],k.prototype,"frustumVisibility",void 0);d.__decorate([f.property({readOnly:!0})],k.prototype,"deconfliction",void 0);d.__decorate([f.property({readOnly:!0})],k.prototype,"labeling",void 0);d.__decorate([f.property({readOnly:!0})],k.prototype,"objectStates",void 0);d.__decorate([f.property({readOnly:!0})],k.prototype,"watchUpdatingTracking",void 0);d.__decorate([f.property()],k.prototype,"suspendResumeExtentMode",void 0);d.__decorate([f.property()],
k.prototype,"dataExtent",void 0);d.__decorate([f.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],k.prototype,"suspended",null);d.__decorate([f.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],k.prototype,"suspendInfo",null);d.__decorate([f.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],k.prototype,"updating",null);return k=d.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],
k)}(k);a.default=n;var C="suspendResumeExtentMode",E={remove:function(){},pause:function(){},resume:function(){}}})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports tslib ../../../../geometry ../../../../renderers ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/accessorSupport/diffUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphic ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicStateTracking ./graphicUtils ./SpatialIndex2D ./symbolComplexity ../support/StageLayerElevationProvider ../../support/extentUtils ../../support/projectionUtils ../../support/PropertiesPool ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/Layer ../../../support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O,N,S,P,U,Z,V,T,Y,X,ca,ba,ga,ia,ha,da){Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DCore=void 0;var fa=C.vec3f64.create(),ka=E.create(),ja=g.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");n=function(a){function c(c){c=a.call(this,c)||this;c.propertiesPool=new ga.PropertiesPool({computedExtent:l.Extent},c);c.computedExtent=null;c.currentRenderer=null;c.rendererHasGeometryOperations=!1;c.graphicStateTracking=
null;c.symbolCreationContext=new S.Graphics3DSymbolCreationContext;c.graphics3DGraphics=new Map;c.stageLayer=null;c.stage=null;c.graphicsDrapedUids=new Set;c.graphicsBySymbol=new Map;c.symbolConversionCache=new Map;c.symbols=new Map;c.graphicsWithoutSymbol=new Map;c.graphicsWaitingForSymbol=new Set;c.handles=new b;c.suspendSymbolCleanup=!1;c._spatialReference=null;c.arcadeOnDemand=null;c.rendererChangeAbortController=null;c.elevationInfoChangeAbortController=null;c.setupAbortController=null;c.elevationAlignment=
null;c.scaleVisibility=null;c.filterVisibility=null;c._spatialIndex=null;c.extentPadding=0;c._updatingPendingLoadedGraphicsChange=null;c.featureStore=null;c.deconflictor=null;c.labeler=null;c.objectStates=null;c.viewElevationProvider=null;c.stageLayerElevationProvider=null;c.sharedSymbolResourcesOwnerHandle=null;c.whenGraphics3DGraphicRequests={};c.pendingUpdates=new Map;c.numberOfGraphics=0;c.numberOfGraphicsProvidingElevation=0;c.pendingAdds=0;c.pendingRemoves=0;c.pendingUpdatesPool=new q({allocator:function(a){return a||
{add:null,renderingInfo:null,abortController:null,state:0,remove:null}},deallocator:function(a){a.add=null;a.renderingInfo=null;a.remove=null;a.state=0;a.abortController=null;return a}});c.symbolWarningLogged=!1;c.geometryWarningLogged=!1;c.objectIdInvisibleSet=new Set;c._whenSymbolRemoved=new q;c.preferredUpdatePolicy=0;c.forcedUpdatePolicy=null;c._asyncUpdates=!1;c.elevationFeatureExpressionEnabled=!0;c.owner=null;c.layer=null;c.hasDraped=!1;c.graphicSymbolSupported=!0;c.getRenderingInfoWithoutRenderer=
!1;c.hasZ=null;c.hasM=null;c._usedMemory=0;c._visible=void 0;c._startCreateGraphics=!1;c.maxPendingUpdates=0;return c}d.__extends(c,a);g=c;Object.defineProperty(c.prototype,"spatialIndex",{get:function(){if(!this._spatialIndex){this._spatialIndex=new T.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM});var a=0,b=Array(this.graphics3DGraphics.size);this.graphics3DGraphics.forEach(function(c){return b[a++]=
c});this._spatialIndex.addMany(b)}return this._spatialIndex},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"asyncUpdates",{get:function(){return this._asyncUpdates},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return!!(0<this.graphicsWaitingForSymbol.size||this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating||
this.rendererChangeAbortController||this.elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"displayFeatureLimit",
{get:function(){var a=this.owner&&this.owner.view&&this.owner.view.qualitySettings,b=a?a.graphics3D.minTotalNumberOfFeatures:0,c=a?a.graphics3D.maxTotalNumberOfFeatures:0,a=a?a.graphics3D.maxTotalNumberOfPrimitives:0,d=this.maxSymbolComplexity,e=Math.max(b,Math.min(c,Math.ceil(a/Math.max(1,d?d.primitivesPerFeature:1)))),f=this._get("displayFeatureLimit");return f&&f.minimumTotalNumberOfFeatures===b&&f.maximumTotalNumberOfFeatures===c&&f.maximumTotalNumberOfPrimitives===a&&f.maximumSymbolComplexity===
d&&f.maximumNumberOfFeatures===e?f:{minimumTotalNumberOfFeatures:b,maximumTotalNumberOfFeatures:c,maximumTotalNumberOfPrimitives:a,maximumSymbolComplexity:d,maximumNumberOfFeatures:e}},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"maxSymbolComplexity",{get:function(){for(var a=null,b=this.symbolComplexities,c=this._get("maxSymbolComplexity"),d=!1,e=0;e<b.length;e++){var f=b[e];if(!a||0===a.primitivesPerCoordinate&&f.primitivesPerFeature>a.primitivesPerFeature||0!==a.primitivesPerCoordinate&&
f.primitivesPerCoordinate>a.primitivesPerCoordinate)a=f;d=d||f.estimated}return!a||d&&c&&(c.primitivesPerFeature>=a.primitivesPerFeature||c.primitivesPerCoordinate>=a.primitivesPerCoordinate)||c&&c.primitivesPerFeature===a.primitivesPerFeature&&c.primitivesPerCoordinate===a.primitivesPerCoordinate?c:a},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"spatialReference",{get:function(){return this._spatialReference},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,
"usedMemory",{get:function(){return this._usedMemory+(this.maxSymbolComplexity&&this.labelsEnabled?this.maxSymbolComplexity.memory.bytesPerFeatureLabel*this.numberOfGraphics:0)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.maxSymbolComplexity.memory.bytesPerFeatureLabel:
0):0},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"symbolComplexities",{get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()},enumerable:!1,configurable:!0});c.prototype.getConvertedSymbol=function(a){if("web-style"===
a.type)return a.clone();var b=this.symbolConversionCache.get(a.id);if(void 0!==b)return b;var b=M.to3D(a,!0,!1,this.hasLabelingContext(a)),c=b.symbol||null;c||b.error&&ja.error(b.error.message);this.symbolConversionCache.set(a.id,c);return c};c.prototype.getSymbolComplexitiesUsedOrRenderer=function(a){if(u.isNone(a))return[];var b=a.getSymbols(),c="backgroundFillSymbol"in a&&a.backgroundFillSymbol;if(!(c||b&&b.length))return[];a=[];c=this.getSymbolComplexityUsedOrRenderer(c);u.isSome(c)&&a.push(c);
for(c=0;c<b.length;c++){var d=this.getSymbolComplexityUsedOrRenderer(b[c]);u.isSome(d)&&a.push(d)}return a};c.prototype.getSymbolComplexityUsedOrRenderer=function(a){if(u.isNone(a))return null;var b=this.symbols.get(a.id);return u.isSome(b)?b.complexity:(a=this.getConvertedSymbol(a))?Y.defaultSymbolComplexity(a):null};c.prototype.getSymbolComplexitiesUsed=function(){var a=[];this.symbols.forEach(function(b){u.isSome(b)&&a.push(b.complexity)});return a};c.prototype.initialize=function(){var a=this;
this._spatialReference=this.owner.view.spatialReference;this._set("featureStore",new O.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:function(){return a.spatialIndex},forAllGraphics:function(b){return a.graphics3DGraphics.forEach(b)}}))};c.prototype.setup=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e,f,g,h=this;return d.__generator(this,function(d){switch(d.label){case 0:return this.setupAbortController=
v.createAbortController(),b=this.setupAbortController.signal,this._set("elevationAlignment",a.elevationAlignment),this._set("scaleVisibility",a.scaleVisibility),this._set("filterVisibility",a.filterVisibility),this._set("deconflictor",a.deconflictor),this._set("labeler",a.labeler),this._set("objectStates",a.objectStates),c=this.owner.view,this.viewElevationProvider=new Q.ViewElevationProvider(this._spatialReference,c),this.initializeStage(c,this.layer.uid),this.symbolCreationContext.sharedResources=
c.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=c.sharedSymbolResources.addGraphicsOwner(this.owner),u.isSome(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer),this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataRequester=c.sharedSymbolResources.streamDataRequester,this.symbolCreationContext.renderCoordsHelper=c.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.localOriginFactory=
new ia,this.symbolCreationContext.elevationProvider=c.elevationProvider,this.symbolCreationContext.notifyGraphicUpdate=function(a,b){return h.notifyGraphicUpdate(a,b)},e=R.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),f=this.symbolCreationContext,[4,R.createContext(e,this._spatialReference,ja)];case 1:f.featureExpressionInfoContext=d.sent(),v.throwIfAborted(b),this.symbolCreationContext.screenSizePerspectiveEnabled=c.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,
this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled,this.handles.add(this.owner.watch("suspended",function(){return h.updateLayerVisibility()})),g="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled",this.handles.add([this.owner.watch(g,function(){var a=c.screenSizePerspectiveEnabled&&
h.layer.screenSizePerspectiveEnabled;a!==h.symbolCreationContext.screenSizePerspectiveEnabled&&(h.symbolCreationContext.screenSizePerspectiveEnabled=a,h.recreateAllGraphics())}),z.init(this,"preferredUpdatePolicy",function(){return h.updateUpdatePolicy()},!0),this.owner.watch("slicePlaneEnabled",function(a){return h.slicePlaneEnabledChange(!!a)}),this.owner.view.watch("pixelRatio",function(){return h.pixelRatioChange()}),this.owner.view.watch("qualitySettings.physicallyBasedRenderingEnabled",function(a){return h.physicalBasedRenderingChange(a)}),
z.when(c.basemapTerrain,"tilingScheme",function(a){a.spatialReference.equals(h.symbolCreationContext.overlaySR)||(h.symbolCreationContext.overlaySR=c.basemapTerrain.spatialReference);h.handles.has("loaded-graphics")?h.recreateAllGraphics():h.handles.add([z.on(h.owner,"loadedGraphics","change",function(a){return h.graphicsCollectionChanged(a)},function(){return h.recreateAllGraphics()}),z.on(h.owner,"loadedGraphics","after-changes",function(){return h._signalUpdatingDuringAsyncLoadedGraphicsChange()},
function(){return h._signalUpdatingDuringAsyncLoadedGraphicsChange()})],"loaded-graphics")}),c.resourceController.scheduler.registerTask(da.Task.GRAPHICS_CORE,function(a){return h.update(a)},function(){return h.needsUpdate()})]),this.owner.layer&&"featureReduction"in this.owner.layer&&this.handles.add(this.owner.watch("layer.featureReduction",function(){return h.deconflictor.featureReductionChange()})),this.notifyChange("maxSymbolComplexity"),d.label=2;case 2:return d.trys.push([2,4,,5]),[4,this.rendererChange(this.layer.renderer)];
case 3:return d.sent(),[3,5];case 4:return d.sent(),[3,5];case 5:return v.throwIfAborted(b),this.setupAbortController=null,[2]}})})};c.prototype.abortSetup=function(){this.setupAbortController&&(this.setupAbortController.abort(),this.setupAbortController=null)};c.prototype.destroy=function(){this.abortSetup();this.abortRendererChange();this.abortElevationInfoChange();this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this._updatingPendingLoadedGraphicsChange&&
(this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=null);this.clear();u.isSome(this.graphicStateTracking)&&(this.graphicStateTracking.destroy(),this.graphicStateTracking=null);this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(0,this.stageLayer.id),this.stage=this.stageLayer=null);this.handles.destroy();this._spatialReference=this.handles=null;this._set("owner",null);for(var a in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[a].reject(new f("graphic:layer-destroyed",
"Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null);this.pendingUpdatesPool=null;this.symbolConversionCache.clear();this.objectIdInvisibleSet.clear();this._spatialIndex&&(this._spatialIndex.destroy(),this._spatialIndex=null);this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",
null))};c.prototype.clear=function(){this.objectStates&&this.objectStates.allGraphicsDeleted();u.isSome(this.graphicStateTracking)&&this.graphicStateTracking.allGraphicsDeleted();this.graphics3DGraphics.forEach(function(a){return a.destroy()});this._spatialIndex&&this._spatialIndex.clear();this.graphics3DGraphics.clear();this._usedMemory=this.numberOfGraphics=0;this.updateLayerVisibility();this.symbols.forEach(function(a){u.isSome(a)&&a.destroy()});this.symbols.clear();this.graphicsBySymbol.clear();
this.graphicsWithoutSymbol.clear();this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this.pendingRemoves=this.pendingAdds=this.maxPendingUpdates=0;this._set("hasDraped",!1);this.notifyChange("updating");this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");this.featureStore.events.emit("changed")};c.prototype.initializeStage=function(a,b){var c=this;this.stage=a._stage;this.stageLayer=new ha(b,{isPickable:!this.owner.suspended},b);
this.stage.add(0,this.stageLayer);this.stage.addToViewContent([this.stageLayer.id]);this.stageLayer.on("dirty",function(a){if(c.graphicStateTracking)switch(a.dirtyType){case "objTransformation":case "objGeometryAdded":case "objGeometryRemoved":case "shaderTransformationChanged":case "vertexAttrsUpdated":a=a.origin.metadata.graphicUid;c.notifyGraphicUpdate(a,2);break;case "visibilityChanged":a=a.origin.metadata.graphicUid,c.notifyGraphicUpdate(a,1)}})};c.prototype.notifyGraphicUpdate=function(a,b){switch(b){case 1:this.notifyGraphicVisibilityChanged(a);
break;case 2:this.notifyGraphicGeometryChanged(a)}};c.prototype.notifyGraphicGeometryChanged=function(a){u.isNone(this.graphicStateTracking)||(a=this.graphics3DGraphics.get(a))&&this.graphicStateTracking.updateGraphicGeometry(a)};c.prototype.notifyGraphicVisibilityChanged=function(a){u.isNone(this.graphicStateTracking)||(a=this.graphics3DGraphics.get(a))&&this.graphicStateTracking.updateGraphicVisibility(a)};c.prototype.updateLayerVisibility=function(){var a=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*
za,a=!this.owner.suspended&&!a;a!==this._visible&&((this._visible=a)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())};c.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};c.prototype.getGraphics3DGraphicById=function(a){return this.graphics3DGraphics.get(a)};c.prototype.getGraphics3DGraphicByObjectId=function(a){var b=
this;if(!this.owner.layer||!this.owner.layer.objectIdField)return null;var c=null;p.someMap(this.graphics3DGraphics,function(d){return b._getGraphicObjectID(d.graphic)===a?(c=d,!1):!0});return c};c.prototype._getGraphicObjectID=function(a,b){void 0===b&&(b=this.owner.layer&&this.owner.layer.objectIdField);return H.getObjectId(a,b)};Object.defineProperty(c.prototype,"graphics3DGraphicsByObjectID",{get:function(){var a=this,b=this.owner.layer&&this.owner.layer.objectIdField;if(!b)return null;var c=
new Map;this.graphics3DGraphics.forEach(function(d){if(d){var e=a._getGraphicObjectID(d.graphic,b);u.isSome(e)&&c.set(e,d)}});return c},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"labelsEnabled",{get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())},enumerable:!1,configurable:!0});c.prototype.updateLabelingInfo=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c;return d.__generator(this,function(d){switch(d.label){case 0:return b=this.deconflictor&&
this.deconflictor.labelingInfoChange(a),c=this.labeler&&this.labeler.labelingInfoChange(a),[4,v.eachAlways([b,c])];case 1:return d.sent(),[2]}})})};c.prototype.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange();this.labeler&&this.labeler.visibilityInfoChange()};Object.defineProperty(c.prototype,"symbolUpdateType",{get:function(){var a=this;if(0<this.pendingUpdates.size)return"unknown";var b=0,c=0;return p.someMap(this.symbols,function(d,e){if(u.isSome(d)){d=
d.getFastUpdateStatus();if(0<d.loading)return!0;a.graphicsBySymbol.has(e)&&(c+=d.fast,b+=d.slow)}return!1})?"unknown":0<=c&&0===b?"fast":0<=b&&0===c?"slow":"mixed"},enumerable:!1,configurable:!0});c.prototype.needsUpdate=function(){return 0<this.pendingUpdates.size};c.prototype.update=function(a){this._applyPendingUpdates(a);this.needsUpdate()||this.notifyChange("updating")};c.prototype.setObjectIdVisibility=function(a,b){b?this.objectIdInvisibleSet.delete(a):this.objectIdInvisibleSet.add(a);a=this._findGraphics3DGraphicByObjectId(a);
u.isSome(a)&&this._updateUserVisibility(a)};c.prototype._findGraphics3DGraphicByObjectId=function(a){var b=this,c;p.someMap(this.graphics3DGraphics,function(d){return b._getGraphicObjectID(d.graphic)===a?(c=d,!0):!1});return c};c.prototype._updateUserVisibility=function(a){if(u.isNone(a))return!1;var b=a.graphic,c=this._getGraphicObjectID(b),b=b.visible&&!this.owner.suspended&&(u.isNone(c)||!this.objectIdInvisibleSet.has(c));return a.setVisibilityFlag(0,b,0)};c.prototype.whenGraphics3DGraphic=function(a){var b=
this.graphics3DGraphics.get(a.uid);if(b)return v.resolve(b);if(b=this.whenGraphics3DGraphicRequests[a.uid])return b.promise;b=v.createDeferred();this.whenGraphics3DGraphicRequests[a.uid]=b;return b.promise};c.prototype.boundsForGraphics3DGraphic=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g,h,k,m,l,n,p;return d.__generator(this,function(d){switch(d.label){case 0:return c=this._spatialReference,e=this.owner.view.renderSpatialReference,f=this.owner.view.basemapTerrain.spatialReference,
g=function(a,b,d){return ba.bufferToBuffer(a,e,b,a,c,b,d)},h=function(a,b,d){return ba.bufferToBuffer(a,f,b,a,c,b,d)},k=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:u.isSome(b)&&b.useViewElevation,minDemResolution:u.isSome(b)&&b.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,a.getProjectedBoundingBox(g,h,k,u.get(b,"signal"))];case 1:m=d.sent();if(!m)return[2,null];l=m.boundingBox;m.requiresDrapedElevation&&(n=this.symbolCreationContext.elevationProvider)&&
(E.center(l,fa),p=n.getElevation(fa[0],fa[1],0,c,"ground")||0,l[2]=Math.min(l[2],p),l[5]=Math.max(l[5],p));return[2,{boundingBox:l,screenSpaceObjects:m.screenSpaceObjects}]}})})};c.prototype.whenGraphicBounds=function(a,b){var c=this;return z.whenOnce(this.owner,"loadedGraphics").then(function(){var b=c.owner.layer&&c.owner.layer.objectIdField,d=c.owner.loadedGraphics.find(function(c){return c===a?!0:b&&c.attributes&&a.attributes&&c.attributes[b]===a.attributes[b]});if(d)return c.whenGraphics3DGraphic(d);
throw new f("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return c.boundsForGraphics3DGraphic(a,b)})};c.prototype.computeAttachmentOrigin=function(a,b){a=this.graphics3DGraphics.get(a.uid);if(!a)return null;var c=a.computeAttachmentOrigin();if(0===c.render.num&&0===c.draped.num)return null;A.vec3.set(ya,0,0,0);a=0;if(0<c.render.num){if(!ba.vectorToVector(c.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,ua,b))return null;A.vec3.add(ya,
ya,ua);a++}if(0<c.draped.num){var d=c.draped.origin,c=d[0],d=d[1],e=this.viewElevationProvider.getElevation(c,d,"ground")||0;A.vec3.set(ua,c,d,e);if(!ba.vectorToVector(ua,this.viewElevationProvider.spatialReference,ua,b))return null;A.vec3.add(ya,ya,ua);a++}1<a&&A.vec3.scale(ya,ya,1/a);return new l.Point({x:ya[0],y:ya[1],z:ya[2],spatialReference:b})};c.prototype.getSymbolLayerSize=function(a,b){var c=this.symbols.get(a.id);if(u.isNone(c))throw new f("internal:symbol-not-part-of-view","Symbol is not part of this view");
a=a.symbolLayers.indexOf(b);if(-1===a)throw new f("internal:missing-symbol-layer","Symbol layer is not in symbol");c=c.getSymbolLayerSize(a);if(null==c)throw new f("internal:missing-size","Symbol layer has no valid size");return c};c.prototype.graphicsCollectionChanged=function(a){this._startCreateGraphics&&(this.add(a.added),this.remove(a.removed))};c.prototype.graphicUpdateHandler=function(a){var b=a.graphic.uid,c=this.graphics3DGraphics.get(b),b=this.graphicsWithoutSymbol.get(b);if(c||b)switch(a.property){case "visible":this.graphicUpdateVisibleHandler(c);
break;case "geometry":this.graphicUpdateGeometryHandler(c,a);break;case "symbol":this.graphicUpdateSymbolHandler(c,a);break;case "attributes":break;default:m.neverReached(a)}};c.prototype.graphicUpdateGeometryHandler=function(a,b){var c=b.graphic.geometry;if(u.isNone(c))this.recreateGraphic(b.graphic);else if(u.isNone(a)){if(a=b.graphic.symbol&&b.graphic.symbol.id)if(a=this.symbols.get(a),u.isSome(a)&&0===a.loadStatus)return;this.recreateGraphic(b.graphic)}else a.graphics3DSymbol.updateGeometry(a,
b.newValue)||this.recreateGraphic(a.graphic),this.expandComputedExtent(c)};c.prototype.graphicUpdateSymbolHandler=function(a,b){var c=b.graphic,d=u.isSome(a)?a.graphics3DSymbol:b.oldValue&&this.symbols.get(b.oldValue.id);if(u.isNone(d))this.recreateGraphic(c);else{var e=d.symbol;b=this.getConvertedSymbol(b.newValue);if(b.type!==e.type||"web-style"===b.type||"web-style"===e.type)this.recreateGraphic(c);else{var f=this.graphicsBySymbol.get(e.id);if(f&&1!==f.size)this.recreateGraphic(c);else if(f=B.diff(e,
b),u.isNone(f))this.updateSymbolMapping(e.id,b);else{var g={diff:f,graphics3DGraphicPatches:[],symbolStatePatches:[]};d.prepareSymbolPatch(g);if(B.isEmpty(g.diff)){for(var h=d.extentPadding,k=0,m=g.symbolStatePatches;k<m.length;k++)f=m[k],f();h!==d.extentPadding&&this.recomputeExtentPadding();c=this._getRenderingInfo(c);if(u.isSome(a))for(d=0,g=g.graphics3DGraphicPatches;d<g.length;d++)f=g[d],f(a,c);this.updateSymbolMapping(e.id,b)}else this.recreateGraphic(c)}}}};c.prototype.graphicUpdateVisibleHandler=
function(a){this._updateUserVisibility(a)&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};c.prototype.recreateGraphic=function(a){a=[a];this.suspendSymbolCleanup=!0;this.remove(a);this.add(a);this.suspendSymbolCleanup=!1;this.asyncUpdates||this._cleanupSymbols()};c.prototype._beginGraphicUpdate=function(a){this.graphicsWaitingForSymbol.add(a.uid);1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating");this._get("symbolsUpdating")||this._set("symbolsUpdating",
!0)};c.prototype._endGraphicUpdate=function(a){a&&(this.graphicsWaitingForSymbol.delete(a.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))};c.prototype.recomputeExtentPadding=function(){var a=0;this.symbols.forEach(function(b){u.isSome(b)&&(a=Math.max(a,b.extentPadding))});this._set("extentPadding",a)};c.prototype.expandComputedExtent=function(a){var b=
a.spatialReference;H.computeAABB(a,ka);a=this._spatialReference;var c=g.tmpVec;!b.equals(a)&&ba.xyzToVector(ka[0],ka[1],0,b,c,a)&&(ka[0]=c[0],ka[1]=c[1],ba.xyzToVector(ka[3],ka[4],0,b,c,a),ka[3]=c[0],ka[4]=c[1]);if(t.isFinite(ka[0])&&t.isFinite(ka[3])&&t.isFinite(ka[1])&&t.isFinite(ka[4])){var b=this.computedExtent,c=null,d=t.isFinite(ka[2])&&t.isFinite(ka[5]),e=d&&(!b||null==b.zmin||ka[2]<b.zmin),d=d&&(!b||null==b.zmax||ka[5]>b.zmax);if(b){if(ka[0]<b.xmin||ka[1]<b.ymin||ka[3]>b.xmax||ka[4]>b.ymax||
e||d)c=this.propertiesPool.get("computedExtent"),c.xmin=Math.min(ka[0],b.xmin),c.ymin=Math.min(ka[1],b.ymin),c.xmax=Math.max(ka[3],b.xmax),c.ymax=Math.max(ka[4],b.ymax),c.spatialReference=a}else c=this.propertiesPool.get("computedExtent"),c.xmin=ka[0],c.ymin=ka[1],c.xmax=ka[3],c.ymax=ka[4],c.spatialReference=a;c&&(e&&(c.zmin=ka[2]),d&&(c.zmax=ka[5]),this._set("computedExtent",c))}};c.prototype.updateHasDraped=function(){this._set("hasDraped",0<this.graphicsDrapedUids.size)};c.prototype.abortElevationInfoChange=
function(){this.elevationInfoChangeAbortController&&(this.elevationInfoChangeAbortController.abort(),this.elevationInfoChangeAbortController=null)};c.prototype.elevationInfoChange=function(){return d.__awaiter(this,void 0,void 0,function(){var a,b,c,e=this;return d.__generator(this,function(d){switch(d.label){case 0:return this.abortElevationInfoChange(),this.elevationInfoChangeAbortController=a=v.createAbortController(),b=R.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),
c=this.symbolCreationContext,[4,R.createContext(b,this._spatialReference,ja)];case 1:return c.featureExpressionInfoContext=d.sent(),v.throwIfAborted(a),this.elevationInfoChangeAbortController=null,this.labeler&&this.labeler.elevationInfoChange(),this.forEachGraphics3DSymbol(function(a,b,c){a.globalPropertyChanged("elevationInfo",b)?b.forEach(function(a){var b=a.graphic,c=0;for(a=a.labelGraphics;c<a.length;c++){var d=a[c];d.graphics3DSymbolLayer.updateGraphicElevationContext(b,d)}}):e._recreateSymbol(c)}),
this.updateStageLayerElevationProvider(),this.elevationAlignment&&this.elevationAlignment.elevationInfoChange(),[2]}})})};c.prototype.updateStageLayerElevationProvider=function(){if(this.stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null}else(!this.layer.elevationInfo||
this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this.numberOfGraphicsProvidingElevation&&(this.stageLayerElevationProvider=new X.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))};c.prototype.clearSymbolsAndGraphics=function(){this.clear();this.filterVisibility&&this.filterVisibility.clear();this.labeler&&this.labeler.reset();this.deconflictor&&
this.deconflictor.clear();this.elevationAlignment&&this.elevationAlignment.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)};c.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};c.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&
(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};c.prototype._recreateSymbol=function(a){var b=this,c=this.graphicsBySymbol.get(a),
d=[];c&&(c.forEach(function(a,c){var e=a.usedMemory;b._conditionalRemove(a,c);b._spatialIndex&&b._spatialIndex.remove(a);d.push(a.graphic);a.destroy();b.removeGraphics3DGraphic(c,e);b.updateLayerVisibility();b.featureStore.events.emit("changed")}),this.graphicsBySymbol.set(a,new Map));c=this.symbols.get(a);u.isSome(c)&&c.destroy();this.symbols.delete(a);this.updateHasDraped();this.add(d)};c.prototype._conditionalRemove=function(a,b){a.isDraped&&this.graphicsDrapedUids.delete(b);this.objectStates&&
this.objectStates.removeGraphic(a);this.labeler&&this.labeler.removeGraphic(a);this.deconflictor&&this.deconflictor.removeGraphic(a);u.isSome(this.graphicStateTracking)&&this.graphicStateTracking.removeGraphic(a)};c.prototype.add=function(a){a&&0!==a.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this.asyncUpdates?this._addDelayed(a):this._addImmediate(a),this.notifyChange("updating")):ja.error("#add()","Cannot add graphics before terrain surface has been initialized"))};
c.prototype._addImmediate=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;pa.clear();for(var c=0;c<a.length;c++){var d=a[c];this._startAddGraphic(d,this._getRenderingInfo(d,ja),pa)}pa.forEach(function(a){return b._finishAddGraphics(a)});pa.clear();this.updateHasDraped();this._cleanupSymbols();this.labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()};c.prototype._addDelayed=function(a){for(var b=0;b<a.length;b++){var c=
a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add?0!==e.state&&e.abortController.abort():this.pendingAdds++:(e=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,this.pendingUpdates.set(d,e));e.add=c}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};c.prototype.remove=function(a){this.asyncUpdates?this._removeDelayed(a):this._removeImmediate(a);this.notifyChange("updating")};c.prototype._removeImmediate=
function(a){for(var b=0;b<a.length;b++)this._removeGraphic(a[b]);this.updateHasDraped();this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};c.prototype._removeDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add&&(e.remove?e.add=null:this.pendingUpdates.delete(d),1===e.state&&e.abortController.abort(),this.pendingAdds--):(e=this.pendingUpdatesPool.pushNew(),e.remove=c,this.pendingUpdates.set(d,
e),this.pendingRemoves++)}0===this.pendingUpdates.size&&this._finishPendingUpdates();this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};c.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear();this.maxPendingUpdates=0;this._cleanupSymbols();(this.pendingAdds||this.pendingRemoves)&&ja.warn("pendingAdds/Removes in inconsistent state!");this.pendingRemoves=this.pendingAdds=0};
c.prototype._applyPendingUpdates=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;var c=2===a.state?1E3:100,d=0;pa.clear();p.someMap(this.pendingUpdates,function(e,f){e.add&&0===e.state&&b._startAddRenderingInfo(e);!e.remove||e.add&&2!==e.state||(b.pendingRemoves--,b._removeGraphic(e.remove),e.remove=null);if(e.add)switch(e.state){case 2:b._startAddGraphic(e.add,e.renderingInfo,pa)&&d++;e.add=null;b.pendingAdds--;break;case 3:e.add=null,b.pendingAdds--}d>c&&(pa.forEach(function(a){return b._finishAddGraphics(a)}),
pa.clear(),d=0);null==e.remove&&null==e.add&&(b.pendingUpdates.delete(f),a.madeProgress());return a.done});pa.forEach(function(a){return b._finishAddGraphics(a)});pa.clear();0===this.pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");this.updateHasDraped()};c.prototype._startAddRenderingInfo=function(a){var b=this;u.isSome(this.layer.renderer)&&"dictionary"===this.layer.renderer.type?(a.state=1,a.abortController=v.createAbortController(),
this._getRenderingInfoAsync(a.add,{signal:a.abortController.signal}).then(function(c){u.isNone(c)||u.isNone(c.symbol)?(ja&&!b.symbolWarningLogged&&(b.symbolWarningLogged=!0,ja.warn("Graphic in layer "+b.layer.id+" has no symbol and will not render")),a.renderingInfo=null):a.renderingInfo=c;a.state=2},function(b){a.abortController=null;v.isAbortError(b)?a.state=0:a.state=3})):(a.renderingInfo=this._getRenderingInfo(a.add,ja),a.state=2)};c.prototype._startAddGraphic=function(a,b,c){this.graphicsWithoutSymbol.set(a.uid,
a);if(!b||u.isNone(b.symbol)||!H.hasGeometry(a))return!1;var d=this.getOrCreateGraphics3DSymbol(b.symbol,b.renderer);if(u.isNone(d))return!1;this.expandComputedExtent(a.geometry);this._beginGraphicUpdate(a);a={graphic:a,renderingInfo:b,layer:this.layer};b=d.symbol.id;var e=c.get(b);e?e.graphics.push(a):(e=va.acquire(),e.clear(),e.push(a),c.set(b,{asyncSymbol:d,graphics:e}));return!0};c.prototype._finishAddGraphics=function(a){var b=this,c=!1,d=function(b){b===a.asyncSymbol.symbol.id&&(c=!0)};this._whenSymbolRemoved.push(d);
a.asyncSymbol.load(function(){if(!b.destroyed){b._whenSymbolRemoved.removeUnordered(d);na.clear();for(var e=0;e<a.graphics.length;e++){var f=a.graphics.data[e],g=f.graphic;c||a.asyncSymbol.destroyed||b.graphicSymbolSupported&&g.symbol&&g.symbol.id!==a.asyncSymbol.symbol.id||(b.graphicsWaitingForSymbol.has(g.uid)&&(f=b.createGraphics3DGraphic(a.asyncSymbol,f),b._spatialIndex&&u.isSome(f)&&na.push(f)),b._endGraphicUpdate(g));--a.asyncSymbol.referenced}0<na.length&&(b._spatialIndex.addMany(na.data,na.length),
na.clear());b.featureStore.events.emit("changed");a.graphics.clear();va.release(a.graphics);b.labeler&&b.owner.view.labeler.setDirty()}},function(e){if(!b.destroyed){b._whenSymbolRemoved.removeUnordered(d);if(!c)if(v.isAbortError(e))b.add(a.graphics.map(function(a){return a.graphic}));else if(!a.asyncSymbol.destroyed)for(e=0;e<a.graphics.length;e++)b._endGraphicUpdate(a.graphics.data[e].graphic);a.graphics.clear();va.release(a.graphics)}})};c.prototype._removeGraphic=function(a){a=a.uid;var b=this.graphics3DGraphics.get(a);
if(b){b.graphics3DSymbol.onRemoveGraphic(b);var c=b.usedMemory,d=b.isElevationSource;this._conditionalRemove(b,a);this._spatialIndex&&this._spatialIndex.remove(b);this.graphicsBySymbol.get(b.graphics3DSymbol.symbol.id).delete(a);this.graphicsWithoutSymbol.delete(a);this.removeGraphics3DGraphic(a,c,d);b.destroy();this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(a),this.graphicsWaitingForSymbol.delete(a)};c.prototype.hasLabelingContext=function(a){if(a instanceof e.LabelSymbol3D||
a instanceof e.TextSymbol){var b=this.symbolCreationContext.layer;return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};c.prototype.hasValidSymbolCreationContext=function(a){return a instanceof e.LabelSymbol3D&&!this.hasLabelingContext(a)?(ja.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};c.prototype._getRenderingInfo=function(a,b){var c=a.geometry;if(u.isNone(c))return b&&!this.geometryWarningLogged&&
(this.geometryWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!ba.canProject(c.spatialReference,this._spatialReference))return b&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has incompatible spatial reference and will not render")),null;if(!this.graphicSymbolSupported&&u.isSome(a.symbol))return b&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+
" is not allowed to have a symbol, use a renderer instead")),null;a=this.rendererHasGeometryOperations?J.hydrateGraphic(a,this.layer):a;a=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||u.isSome(this.currentRenderer))?this.owner.getRenderingInfo(a,this.currentRenderer,u.unwrap(this.arcadeOnDemand)):{symbol:a.symbol||L.getDefaultSymbol3D(a.geometry)};return!a||u.isNone(a.symbol)?(b&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+
" has no symbol and will not render")),null):a};c.prototype._getRenderingInfoAsync=function(a,b){if(u.isNone(a.geometry))return ja&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,ja.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&u.isSome(a.symbol))return ja&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,ja.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),
null;a=this.rendererHasGeometryOperations?J.hydrateGraphic(a,this.layer):a;return this.owner.getRenderingInfoAsync(a,u.unwrap(this.currentRenderer),u.unwrap(this.arcadeOnDemand),b)};c.prototype.createGraphics3DSymbol=function(a,b){var c=this;if(!this.hasValidSymbolCreationContext(a))return null;a=this.getConvertedSymbol(a);if(!a)return null;var d;u.isSome(b)&&"backgroundFillSymbol"in b&&b.backgroundFillSymbol&&(b=M.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&"web-style"!==b.symbol.type&&(d=b.symbol.symbolLayers));
var e=P.make(a,this.symbolCreationContext,d);e.load(function(){var a=e.extentPadding;a>c.extentPadding&&c._set("extentPadding",a);c.notifyChange("maxSymbolComplexity")},function(){});return e};c.prototype.getOrCreateGraphics3DSymbol=function(a,b){var c=this,d=this.symbols.get(a.id);void 0===d&&(d=a instanceof e.WebStyleSymbol?new U(a,function(a){return c.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols.set(a.id,d));u.isSome(d)&&++d.referenced;return d};c.prototype.trackGraphicState=
function(a){u.isNone(this.graphicStateTracking)&&(this.graphicStateTracking=new Z.GraphicStateTracking(this));return this.graphicStateTracking.add(a)};c.prototype.addGraphics3DGraphic=function(a){this._usedMemory+=a.usedMemory;this.graphics3DGraphics.set(a.graphic.uid,a);this.numberOfGraphics++;a.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};c.prototype.removeGraphics3DGraphic=function(a,b,c){void 0===c&&(c=!1);
this._usedMemory-=b;this.graphics3DGraphics.delete(a);this.numberOfGraphics--;c&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};c.prototype.createGraphics3DGraphic=function(a,b){var c=b.graphic;this.graphicsWithoutSymbol.delete(c.uid);if(!this.symbols.has(a.symbol.id))return this.add([c]),null;if(this.graphics3DGraphics.has(c.uid))return null;b=a.createGraphics3DGraphic(b);if(u.isNone(b))return null;this.addGraphics3DGraphic(b);a=
a.symbol.id;this.graphicsBySymbol.has(a)||this.graphicsBySymbol.set(a,new Map);this.graphicsBySymbol.get(a).set(c.uid,b);b.isDraped&&(this.graphicsDrapedUids.add(c.uid),this._set("hasDraped",!0));b.centroid=null;u.isSome(c.geometry)&&"point"!==c.geometry.type&&b instanceof N&&(b.centroid=V.computeCentroid(c.geometry,this._spatialReference));this._updateUserVisibility(b);this.scaleVisibility&&this.scaleVisibility.updateVisibility(b);this.filterVisibility&&this.filterVisibility.updateVisibility(b);
this.deconflictor&&this.deconflictor.addGraphic(b);this.labeler&&this.labeler.addGraphic(b);this.objectStates&&this.objectStates.addGraphic(b);this.deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,b);b.initialize(this.stage,this.stageLayer,this.owner);u.isSome(this.graphicStateTracking)&&this.graphicStateTracking.addGraphic(b);if(a=this.whenGraphics3DGraphicRequests[c.uid])delete this.whenGraphics3DGraphicRequests[c.uid],a.resolve(b);return b};c.prototype.abortRendererChange=
function(){this.rendererChangeAbortController&&(this.rendererChangeAbortController.abort(),this.rendererChangeAbortController=null)};c.prototype.rendererChange=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c;return d.__generator(this,function(d){switch(d.label){case 0:this.abortRendererChange();if(a===this.currentRenderer)return[2];this.validateRenderer(a);if(!I.isSupportedRenderer3D(a))return this.currentRendererChange(null,!1),[2];if(!u.isSome(a)||!a.arcadeRequired)return[3,
4];this.rendererChangeAbortController=b=v.createAbortController();return[4,this.ensureArcade()];case 1:return c=d.sent().arcadeUtils,v.throwIfAborted(b),c.hasGeometryOperations(a)?[4,c.enableGeometryOperations()]:[3,3];case 2:d.sent(),v.throwIfAborted(b),d.label=3;case 3:return this.rendererChangeAbortController=null,this.currentRendererChange(a,!0),[3,5];case 4:this.currentRendererChange(a,!1),d.label=5;case 5:return[2]}})})};c.prototype.ensureArcade=function(){return d.__awaiter(this,void 0,void 0,
function(){var a;return d.__generator(this,function(b){switch(b.label){case 0:if(!u.isNone(this.arcadeOnDemand))return[3,2];a=this;return[4,K.loadArcade()];case 1:return a.arcadeOnDemand=b.sent(),[2,this.arcadeOnDemand];case 2:return[2,this.arcadeOnDemand]}})})};c.prototype.currentRendererChange=function(a,b){this.currentRenderer=a;this.rendererHasGeometryOperations=b;this.symbolCreationContext.arcade=u.unwrap(this.arcadeOnDemand);b=this.symbolCreationContext.renderer;if(a!==b)if(this.updateUpdatePolicy(),
this.symbolConversionCache.clear(),u.isNone(a))this.symbolCreationContext.renderer=null,this.recreateAllGraphics();else{var c=B.diff(b,a);this.updateUnchangedSymbolMappings(c,a,b);this.symbolCreationContext.renderer=a;u.isNone(c)||("complete"===c.type?this.recreateAllGraphics():"partial"===c.type&&(this.applyRendererDiff(c,a,b)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}};c.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;
case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};c.prototype.applySymbolSetDiff=function(a,b,c){var d=this;a=a||[];b=b||[];for(var e=[],f=function(b){var f=g.graphicsBySymbol.get(b.id);f&&f.forEach(function(g,h){var k=g.graphic,m=d.layer instanceof F?d.layer:null,l=u.unwrap(d.arcadeOnDemand);if(b!==c.defaultSymbol||c.getSymbol(J.hydrateGraphic(k,m),{arcade:l})!==c.defaultSymbol)m=g.usedMemory,a.length||c.defaultSymbol?e.push(k):d.graphicsWithoutSymbol.set(h,
k),k=d.graphics3DGraphics.get(h),d._conditionalRemove(k,h),g.destroy(),f.delete(h),d.removeGraphics3DGraphic(h,m),d.updateLayerVisibility()});g._whenSymbolRemoved.forEachSimple(function(a){return a(b.id)})},g=this,h=0;h<b.length;h++)f(b[h]);if(a.length||e.length)this.graphicsWithoutSymbol.forEach(function(a){return e.push(a)}),this.graphicsWithoutSymbol.clear(),this.add(e);this.updateHasDraped();this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};
c.prototype.applyUniqueValueRendererDiff=function(a,b,c){var d=a.diff.defaultSymbol,e=a.diff.uniqueValueInfos;if(d||e){var f=e?e.added.map(function(a){return a.symbol}):[],g=e?e.removed.map(function(a){return a.symbol}):[];if(e)for(var h=0;h<e.changed.length;h++)f.push(e.changed[h].newValue.symbol),g.push(e.changed[h].oldValue.symbol);d?(c.defaultSymbol&&g.push(c.defaultSymbol),b.defaultSymbol&&f.push(b.defaultSymbol)):c.defaultSymbol&&f.length&&g.push(b.defaultSymbol);this.applySymbolSetDiff(f,g,
b);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};c.prototype.calculateUnchangedSymbolMapping=function(a,b,c){var d=function(a){return u.isSome(a)?a.id:null};if(b instanceof k.UniqueValueRenderer&&c instanceof k.UniqueValueRenderer&&(u.isNone(a)||"partial"===a.type)){var e=a&&a.diff;a=e&&e.defaultSymbol;var e=e&&e.uniqueValueInfos,f=void 0,f=e?e.unchanged.map(function(a){return{oldId:d(a.oldValue.symbol),newId:d(a.newValue.symbol)}}):c.uniqueValueInfos.map(function(a,
c){return{oldId:d(a.symbol),newId:d(b.uniqueValueInfos[c].symbol)}});!a&&c.defaultSymbol&&f.push({oldId:d(c.defaultSymbol),newId:d(b.defaultSymbol)});return f}return[]};c.prototype.updateSymbolMapping=function(a,b){var c=b?"string"===typeof b?b:b.id:null;b="string"===typeof b?null:b;if(a&&a!==c){var d=this.graphicsBySymbol.get(a);this.graphicsBySymbol.delete(a);void 0!==d&&this.graphicsBySymbol.set(c,d);d=this.symbols.get(a);void 0!==d&&(this.symbols.delete(a),this.symbols.set(c,d),u.isSome(d)&&(u.isSome(b)?
d.symbol=b:d.symbol.id=c))}};c.prototype.updateUnchangedSymbolMappings=function(a,b,c){var d=0;for(a=this.calculateUnchangedSymbolMapping(a,b,c);d<a.length;d++)b=a[d],this.updateSymbolMapping(b.oldId,b.newId)};c.prototype.applyRendererDiff=function(a,b,c){var d=this;return this.diffHasSymbolChange(a)?!1:b instanceof k.UniqueValueRenderer&&c instanceof k.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(a,b,c)&&0===Object.keys(a.diff).length?!0:!p.someMap(this.graphicsBySymbol,function(c,e){c=
d.symbols.get(e);return u.isSome(c)&&!c.applyRendererDiff(a,b)})};c.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(a,b){return a.globalPropertyChanged("opacity",b)});this.updateStageLayerVisibility()};c.prototype.updateUpdatePolicy=function(){var a=u.isSome(this.currentRenderer)&&"dictionary"===this.currentRenderer.type;u.isSome(this.forcedUpdatePolicy)?this._asyncUpdates=1===this.forcedUpdatePolicy:this._asyncUpdates=1===this.preferredUpdatePolicy||a;(this.symbolCreationContext.isAsync=
this._asyncUpdates)||this.update(da.noBudget)};c.prototype.slicePlaneEnabledChange=function(a){a!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=a,this.stageLayer.isSliceable=a,this.forEachGraphics3DSymbol(function(a,b){return a.globalPropertyChanged("slicePlaneEnabled",b)}),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())};c.prototype.physicalBasedRenderingChange=function(a){a!==this.symbolCreationContext.physicalBasedRenderingEnabled&&
(this.symbolCreationContext.physicalBasedRenderingEnabled=a,this.forEachGraphics3DSymbol(function(a,b){return a.globalPropertyChanged("physicalBasedRenderingEnabled",b)}))};c.prototype.pixelRatioChange=function(){var a=this;this.forEachGraphics3DSymbol(function(b,c,d){b.globalPropertyChanged("pixelRatio",c)||a._recreateSymbol(d)})};c.prototype._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){var a=this;this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();
this._updatingPendingLoadedGraphicsChange=w.schedule(function(){a._updatingPendingLoadedGraphicsChange=null})};c.prototype.setClippingExtent=function(a,b){var c=this.symbolCreationContext.clippingExtent,d=G.create();ca.toBoundingRect(a,d,b)?this.symbolCreationContext.clippingExtent=E.fromRect(E.create(),d):this.symbolCreationContext.clippingExtent=null;return!E.equals(this.symbolCreationContext.clippingExtent,c)};c.prototype.modifyGraphics3DGraphicVisibilities=function(a){var b=!1;this.graphics3DGraphics.forEach(function(c){a(c)&&
(b=!0)});b&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};c.prototype.forEachGraphics3DSymbol=function(a){for(var b=0,c=h.keysOfMap(this.symbols);b<c.length;b++){var d=c[b],e=this.symbols.get(d);if(u.isNone(e))break;var f=this.graphicsBySymbol.get(d);a(e,f||oa,d)}};c.prototype.updateAllGraphicsVisibility=function(){var a=this;this.filterVisibility&&(this.filterVisibility.dirty=!0);this.modifyGraphics3DGraphicVisibilities(function(b){var c=a._updateUserVisibility(b);
b=a.scaleVisibility&&a.scaleVisibility.updateVisibility(b);return c||b})};c.prototype.hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(function(a){return a.setVisibilityFlag(0,!1,0)})};c.prototype.validateRenderer=function(a){(a=I.validateTo3D(a))&&ja.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)};c.prototype.volatileGraphicsUpdated=function(){this.labeler&&this.labeler.reset();this.stageLayer.invalidateSpatialQueryAccelerator();
this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};c.prototype._cleanupSymbols=function(){var a=this;if(!(0<this.graphicsWaitingForSymbol.size||this.suspendSymbolCleanup)){var b=!1;this.symbols.forEach(function(c,d){if(!(u.isNone(c)||0<c.referenced)){var e=a.graphicsBySymbol.get(d);e&&0!==e.size||(a.graphicsBySymbol.delete(d),a.symbols.delete(d),c&&c.destroy(),b=!0)}});b&&(this.recomputeExtentPadding(),this.notifyChange("maxSymbolComplexity"))}};c.prototype.snapshotInternals=
function(){var a=this;return{graphics:h.keysOfMap(this.graphics3DGraphics).sort(),symbols:h.keysOfMap(this.symbols).sort(),graphicsBySymbol:h.keysOfMap(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,graphics:h.keysOfMap(a.graphicsBySymbol.get(b)).sort()}}),graphicsWithoutSymbol:h.keysOfMap(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:h.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}};Object.defineProperty(c.prototype,"test",{get:function(){var a=
this;return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size,forceUpdatePolicy:function(b){a.forcedUpdatePolicy=b;a.updateUpdatePolicy()}}},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"performanceInfo",{get:function(){return{visible:this.graphics3DGraphics.size,missing:this.graphicsWithoutSymbol.size,pending:this.pendingUpdates.size}},enumerable:!1,configurable:!0});var g;c.tmpVec=C.vec3f64.create();d.__decorate([x.property({readOnly:!0})],
c.prototype,"computedExtent",void 0);d.__decorate([x.property()],c.prototype,"currentRenderer",void 0);d.__decorate([x.property()],c.prototype,"rendererHasGeometryOperations",void 0);d.__decorate([x.property()],c.prototype,"rendererChangeAbortController",void 0);d.__decorate([x.property()],c.prototype,"elevationInfoChangeAbortController",void 0);d.__decorate([x.property()],c.prototype,"setupAbortController",void 0);d.__decorate([x.property({readOnly:!0})],c.prototype,"elevationAlignment",void 0);
d.__decorate([x.property({readOnly:!0})],c.prototype,"scaleVisibility",void 0);d.__decorate([x.property({readOnly:!0})],c.prototype,"filterVisibility",void 0);d.__decorate([x.property({readOnly:!0})],c.prototype,"extentPadding",void 0);d.__decorate([x.property()],c.prototype,"_updatingPendingLoadedGraphicsChange",void 0);d.__decorate([x.property({readOnly:!0})],c.prototype,"featureStore",void 0);d.__decorate([x.property({readOnly:!0})],c.prototype,"deconflictor",void 0);d.__decorate([x.property({readOnly:!0})],
c.prototype,"labeler",void 0);d.__decorate([x.property({readOnly:!0})],c.prototype,"objectStates",void 0);d.__decorate([x.property()],c.prototype,"preferredUpdatePolicy",void 0);d.__decorate([x.property({constructOnly:!0})],c.prototype,"elevationFeatureExpressionEnabled",void 0);d.__decorate([x.property({constructOnly:!0})],c.prototype,"owner",void 0);d.__decorate([x.property({constructOnly:!0})],c.prototype,"layer",void 0);d.__decorate([x.property({readOnly:!0})],c.prototype,"hasDraped",void 0);
d.__decorate([x.property({readOnly:!0})],c.prototype,"symbolsUpdating",void 0);d.__decorate([x.property({constructOnly:!0})],c.prototype,"graphicSymbolSupported",void 0);d.__decorate([x.property({constructOnly:!0})],c.prototype,"getRenderingInfoWithoutRenderer",void 0);d.__decorate([x.property({readOnly:!0,dependsOn:"elevationAlignment.updating scaleVisibility.updating filterVisibility.updating rendererChangeAbortController elevationInfoChangeAbortController _updatingPendingLoadedGraphicsChange".split(" ")})],
c.prototype,"updating",null);d.__decorate([x.property({readOnly:!0})],c.prototype,"updatingRemaining",null);d.__decorate([x.property({readOnly:!0})],c.prototype,"updatingTotal",null);d.__decorate([x.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],c.prototype,"displayFeatureLimit",null);d.__decorate([x.property({readOnly:!0})],c.prototype,"maxSymbolComplexity",
null);d.__decorate([x.property({constructOnly:!0})],c.prototype,"hasZ",void 0);d.__decorate([x.property({constructOnly:!0})],c.prototype,"hasM",void 0);return c=g=d.__decorate([x.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],c)}(c);a.Graphics3DCore=n;var pa=new Map,na=new q,va=new r(q);(function(){return function(){this.renderingInfo=this.add=null;this.state=0;this.remove=null}})();var za=10,ya=C.vec3f64.create(),ua=C.vec3f64.create(),oa=new Map})},"esri/renderers/support/rendererConversion":function(){define("require exports ../../core/compilerUtils ../../core/Error ../../core/maybe ../../symbols/support/symbolConversion".split(" "),
function(n,a,d,l,k,e){function c(a){return k.isNone(a)||"simple"===a.type||"unique-value"===a.type||"class-breaks"===a.type||"dictionary"===a.type}function h(a,c){if(!c)return null;c=Array.isArray(c)?c:[c];if(0<c.length){var b=c.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});b.sort();var d=[];b.forEach(function(a,c){0!==c&&a===b[c-1]||d.push(a)});return new l("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+d.join(", ")+
") which are not supported in 3D",{renderer:a,symbolErrors:c})}return null}function m(a){var b=a.uniqueValueInfos.map(function(a){return e.to3D(a.symbol).error}).filter(function(a){return!!a}),c=e.to3D(a.defaultSymbol);c.error&&b.unshift(c.error);return h(a,b)}function f(a){var b=a.classBreakInfos.map(function(a){return e.to3D(a.symbol).error}).filter(function(a){return!!a}),c=e.to3D(a.defaultSymbol);c.error&&b.unshift(c.error);return h(a,b)}Object.defineProperty(a,"__esModule",{value:!0});a.validateTo3D=
a.isSupportedRenderer3D=void 0;a.isSupportedRenderer3D=c;a.validateTo3D=function(a){if(k.isNone(a))return null;if(!c(a))return new l("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(a.type||a.declaredClass)+"'",{renderer:a});switch(a.type){case "simple":return h(a,e.to3D(a.symbol).error);case "unique-value":return m(a);case "class-breaks":return f(a);case "dictionary":break;default:d.neverReached(a)}return null}})},"esri/symbols/support/defaults3D":function(){define("require exports ../../core/compilerUtils ../../core/maybe ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ./defaults ./defaultsJSON".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.getDefaultSymbol3D=void 0;var g=h.fromSimpleMarkerSymbol(f.defaultPointSymbol2D),p=e.fromSimpleLineSymbol(f.defaultPolylineSymbol2D),t=m.fromSimpleFillSymbol(f.defaultPolygonSymbol2D),u=new c({symbolLayers:[new k({material:{color:b.defaultColor},edges:{type:"solid",size:"1px",color:b.defaultOutlineColor}})]});a.getDefaultSymbol3D=function(a){if(l.isNone(a))return null;switch(a.type){case "mesh":return u;case "point":case "multipoint":return g;
case "polyline":return p;case "polygon":case "extent":return t;default:d.neverReached(a)}return null}})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter ../../support/pointUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DFeatureStore=void 0;n=function(a){function l(c){var d=a.call(this,c)||this;d.events=new k;d.hasZ=null;d.hasM=null;d.objectIdField=null;d.spatialReference=null;d.featureAdapter={getAttribute:function(a,c){return"graphic"in a?a.graphic.attributes[c]:b.default.getAttribute(a,c)},getAttributes:function(a){return"graphic"in a?a.graphic.attributes:b.default.getAttributes(a)},getObjectId:function(a){return"graphic"in
a?h.getObjectId(a.graphic,d.objectIdField):b.default.getObjectId(a)},getGeometry:function(a){return"graphic"in a?a.getAsOptimizedGeometry(d.hasZ,d.hasM):b.default.getGeometry(a)},getCentroid:function(a,c){if("graphic"in a){var h=null;e.isSome(a.centroid)?h=a.centroid:"point"===a.graphic.geometry.type&&g.pointToPoint(a.graphic.geometry,p,d.spatialReference)&&(h=p);a=Array(2+(c.hasZ?1:0)+(c.hasM?1:0));e.isNone(h)?(a[0]=0,a[1]=0,a[2]=0,a[3]=0):(a[0]=h.x,a[1]=h.y,c.hasZ&&(a[2]=h.hasZ?h.z:0),c.hasM&&(a[c.hasZ?
3:2]=h.hasM?h.m:0));return new f.default([],a)}return b.default.getCentroid(a,c)},cloneWithGeometry:function(a,c){return"graphic"in a?new m.default(c,d.featureAdapter.getAttributes(a),null,d.featureAdapter.getObjectId(a)):b.default.cloneWithGeometry(a,c)}};return d}d.__extends(l,a);l.prototype.forEach=function(a){this.forAllGraphics(function(b){a(b)})};l.prototype.forEachInBounds=function(a,b){this.getSpatialIndex().forEachInBounds(a,b)};l.prototype.forEachBounds=function(a,b,c){for(var d=this.getSpatialIndex(),
f=0;f<a.length;f++){var g=this.featureAdapter.getObjectId(a[f]);e.isSome(d.getBounds(g,c))&&b(c)}};d.__decorate([c.property({constructOnly:!0})],l.prototype,"getSpatialIndex",void 0);d.__decorate([c.property({constructOnly:!0})],l.prototype,"forAllGraphics",void 0);d.__decorate([c.property({constructOnly:!0})],l.prototype,"hasZ",void 0);d.__decorate([c.property({constructOnly:!0})],l.prototype,"hasM",void 0);d.__decorate([c.property({constructOnly:!0})],l.prototype,"objectIdField",void 0);d.__decorate([c.property({constructOnly:!0})],
l.prototype,"spatialReference",void 0);return l=d.__decorate([c.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],l)}(l);a.Graphics3DFeatureStore=n;var p={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};a.default=n})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["require","exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.optimizedFeatureQueryEngineAdapter=
void 0;a.optimizedFeatureQueryEngineAdapter={getObjectId:function(a){return a.objectId},getAttributes:function(a){return a.attributes},getAttribute:function(a,c){return a.attributes[c]},cloneWithGeometry:function(a,c){return new l.default(c,a.attributes,null,a.objectId)},getGeometry:function(a){return a.geometry},getCentroid:function(a,c){a.centroid||(a.centroid=d.getCentroidOptimizedGeometry(new k.default,a.geometry,c.hasZ,c.hasM));return a.centroid}};a.default=a.optimizedFeatureQueryEngineAdapter})},
"esri/layers/graphics/centroid":function(){define(["require","exports"],function(n,a){function d(a,d,c,h,m,f,b){void 0===b&&(b=1);f=m?f?4:3:f?3:2;var e=c,k=c+f,l=0,n=0,r=c=0,q=0,v=0;for(--h;v<h;v++,e+=f,k+=f){var w=d[e],z=d[e+1],x=d[e+2],B=d[k],A=d[k+1],C=d[k+2],E=w*A-B*z,r=r+E,l=l+(w+B)*E,n=n+(z+A)*E;m&&(E=w*C-B*x,c+=(x+C)*E,q+=E);w<a[0]&&(a[0]=w);w>a[1]&&(a[1]=w);z<a[2]&&(a[2]=z);z>a[3]&&(a[3]=z);m&&(x<a[4]&&(a[4]=x),x>a[5]&&(a[5]=x))}0<r*b&&(r*=-1);0<q*b&&(q*=-1);if(!r)return null;a=[l,n,.5*r];
m&&(a[3]=c,a[4]=.5*q);return a}function l(a,d,c,h,m){m=h?m?4:3:m?3:2;for(var e=d,b=d+m,g=0,k=0,l=0,n=0,r=0,q=c-1;r<q;r++,e+=m,b+=m){var v=a[e],w=a[e+1],z=a[e+2],x=a[b],B=a[b+1],A=a[b+2],C;if(h){C=x-v;var E=B-w,G=A-z;C=Math.sqrt(C*C+E*E+G*G)}else C=x-v,E=B-w,C=Math.sqrt(C*C+E*E);C&&(g+=C,h?(v=[v+.5*(x-v),w+.5*(B-w),z+.5*(A-z)],k+=C*v[0],l+=C*v[1],n+=C*v[2]):(v=[v+.5*(x-v),w+.5*(B-w)],k+=C*v[0],l+=C*v[1]))}return 0<g?h?[k/g,l/g,n/g]:[k/g,l/g]:0<c?h?[a[d],a[d+1],a[d+2]]:[a[d],a[d+1]]:null}Object.defineProperty(a,
"__esModule",{value:!0});a.lineCentroid=a.getCentroidOptimizedGeometry=void 0;a.getCentroidOptimizedGeometry=function(a,e,c,h,m){if(!e||!e.lengths.length)return null;var f="upperLeft"===(null===m||void 0===m?void 0:m.originPosition)?-1:1;a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);m=a.coords;for(var b=[],g=c?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,
Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],k=e.lengths,n=e.coords,u=c?h?4:3:h?3:2,r=0,q=0;q<k.length;q++){var v=k[q],w=d(g,n,r,v,c,h,f);w&&b.push(w);r+=v*u}b.sort(function(a,b){var d=f*a[2]-f*b[2];0===d&&c&&(d=a[4]-b[4]);return d});b.length&&(u=6*b[0][2],m[0]=b[0][0]/u,m[1]=b[0][1]/u,c&&(u=6*b[0][4],m[2]=0!==u?b[0][3]/u:0),m[0]<g[0]||m[0]>g[1]||m[1]<g[2]||m[1]>g[3]||c&&(m[2]<g[4]||m[2]>g[5]))&&(m.length=0);if(!m.length)if(e=e.lengths[0]?l(n,0,k[0],c,h):null)m[0]=e[0],
m[1]=e[1],c&&2<e.length&&(m[2]=e[2]);else return null;return a};a.lineCentroid=l})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DSymbolLayerCreationContext=a.Graphics3DSymbolCreationContext=void 0;n=function(){return function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=
this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1}}();a.Graphics3DSymbolCreationContext=n;n=function(){return function(){}}();a.Graphics3DSymbolLayerCreationContext=n})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require","exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(n,a,d,l){Object.defineProperty(a,
"__esModule",{value:!0});a.make=void 0;a.make=function(a,e,c){var h;switch(a.type){case "point-3d":h=d;break;default:h=l}return new h(a,e,c)}})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("require exports tslib ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DSymbol".split(" "),function(n,a,d,l,k,e){return function(a){function c(c,d,b){c=a.call(this,c,d,b)||this;c.calloutSymbolLayer=null;c.symbol.hasVisibleCallout()&&(c.calloutSymbolLayer=
k.make(c.symbol,d));return c}d.__extends(c,a);c.prototype.doLoad=function(c){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(d){switch(d.label){case 0:return[4,a.prototype.doLoad.call(this,c)];case 1:return d.sent(),this.calloutSymbolLayer?[4,this.calloutSymbolLayer.load()]:[3,3];case 2:d.sent(),d.label=3;case 3:if(l.isAborted(c))throw l.createAbortError();return[2]}})})};c.prototype.destroy=function(){a.prototype.destroy.call(this);this.calloutSymbolLayer&&this.calloutSymbolLayer.destroy()};
c.prototype.createGraphics3DGraphic=function(c,d){d=a.prototype.createGraphics3DGraphic.call(this,c,d);this.calloutSymbolLayer&&(c=this.createCalloutGraphic(c))&&d.addAuxiliaryGraphic(c);return d};c.prototype.globalPropertyChanged=function(c,d){var b=this;return a.prototype.globalPropertyChanged.call(this,c,d)?this.calloutSymbolLayer?this.calloutSymbolLayer.globalPropertyChanged(c,d,function(a){return b._getCalloutGraphicLayer(a)}):!0:!1};c.prototype.updateGeometry=function(c,d){var b=a.prototype.updateGeometry.call(this,
c,d);return b&&this.calloutSymbolLayer&&(c=this._getCalloutGraphicLayer(c))?this.calloutSymbolLayer.updateGeometry(c,d):b};c.prototype.createCalloutGraphic=function(a){var c=a.renderingInfo;a.renderingInfo={renderer:c.renderer,symbol:c.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(a)};c.prototype._getCalloutGraphicLayer=function(a){var c=0;for(a=a._auxiliaryGraphics;c<
a.length;c++){var b=a[c];if(b.graphics3DSymbolLayer===this.calloutSymbolLayer)return b}};return c}(e)})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["require","exports","../../../../core/arrayUtils","../../../../core/maybe","../../../../layers/graphics/dehydratedFeatures"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.GraphicStateTracking=void 0;n=function(){function a(a){var c=this;this.graphicsCore=a;this.idToState=new Map;this.states=new Set;
var d=a.owner.layer&&a.owner.layer.objectIdField;d?(this.getGraphicId=function(a){return k.getObjectId(a,d)},this.getGraphics3DGraphicById=function(a){return c.graphicsCore.getGraphics3DGraphicByObjectId(a)}):(this.getGraphicId=function(a){return a.uid},this.getGraphics3DGraphicById=function(a){return c.graphicsCore.getGraphics3DGraphicById(a)})}a.prototype.destroy=function(){var a=this;this.idToState.clear();this.states.forEach(function(c,d){return a.remove(d)})};a.prototype.add=function(a){var c=
this,d={remove:function(){return c.remove(a)}};if(this.states.has(a))return d;var e=this.getGraphicId(a.graphic),b=this.getGraphics3DGraphicById(e);this.states.has(a)||this.states.add(a);this.ensureStateList(e).push(a);a.displaying=l.isSome(b)?b.isVisible():!1;a.isDraped=l.isSome(b)?b.isDraped:!1;a.tracking=!0;return d};a.prototype.remove=function(a){if(this.states.has(a)){if(this.idToState.size){var c=this.getGraphicId(a.graphic),e=this.idToState.get(c);e&&(d.remove(e,a),0===e.length&&this.idToState.delete(c))}this.states.delete(a);
a.tracking=!1;a.displaying=!1}};a.prototype.addGraphic=function(a){this.forEachState(a,function(c){c.displaying=a.isVisible();c.isDraped=a.isDraped;c.emit("changed",{})})};a.prototype.removeGraphic=function(a){this.forEachState(a,function(a){a.displaying=!1;a.isDraped=!1})};a.prototype.updateGraphicGeometry=function(a){this.forEachState(a,function(a){a.emit("changed",{})})};a.prototype.updateGraphicVisibility=function(a){this.forEachState(a,function(c){c.displaying=a.isVisible()})};a.prototype.allGraphicsDeleted=
function(){this.states.forEach(function(a){a.displaying=!1})};a.prototype.ensureStateList=function(a){var c=this.idToState.get(a);if(c)return c;c=[];this.idToState.set(a,c);return c};a.prototype.forEachState=function(a,d){0!==this.states.size&&0!==this.idToState.size&&(a=this.getGraphicId(a.graphic),a=this.idToState.get(a),null!=a&&a.forEach(d))};return a}();a.GraphicStateTracking=n})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/has ../../../../core/accessorSupport/decorators ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(n,a,d,l,k,e,c,h,m){Object.defineProperty(a,"__esModule",{value:!0});a.SpatialIndex2D=void 0;n=function(a){function b(b){b=a.call(this,b)||this;b.index=new c.default(9,k("csp-restrictions")?function(a){return{minX:a.extent[0],minY:a.extent[1],maxX:a.extent[2],maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);b.boundsByFeature=new Map;b.spatialReference=null;b.hasZ=null;b.hasM=null;b.objectIdField=null;return b}d.__extends(b,a);b.prototype.destroy=function(){this.index.destroy();
this.index=null;this.boundsByFeature.clear();this.boundsByFeature=null};b.prototype.queryGraphicUIDsInExtent=function(a,b,c){b.equals(this.spatialReference)&&(f.minX=a[0],f.minY=a[1],f.maxX=a[2],f.maxY=a[3],this.index.search(f,function(a){return c(a.graphic.uid)}))};b.prototype.add=function(a){a.computeExtent(this.spatialReference);this.index.insert(a);var b=m.getObjectId(a.graphic,this._get("objectIdField"));null!=b&&this.boundsByFeature.set(b,a.extent)};b.prototype.addMany=function(a,b){void 0===
b&&(b=a.length);for(var c=this._get("objectIdField"),d=0;d<b;d++){var e=a[d];e.computeExtent(this.spatialReference);var f=m.getObjectId(e.graphic,c);null!=f&&this.boundsByFeature.set(f,e.extent)}this.index.load(a,b)};b.prototype.remove=function(a){this.index.remove(a);a=m.getObjectId(a.graphic,this._get("objectIdField"));null!=a&&this.boundsByFeature.delete(a)};b.prototype.clear=function(){this.index.clear();this.boundsByFeature.clear()};b.prototype.forEachInBounds=function(a,b){f.minX=a[0];f.minY=
a[1];f.maxX=a[2];f.maxY=a[3];this.index.search(f,function(a){b(a)})};b.prototype.getBounds=function(a,b){return(a=this.boundsByFeature.get(a))?h.fromRect(b,a):null};d.__decorate([e.property({constructOnly:!0})],b.prototype,"spatialReference",void 0);d.__decorate([e.property({constructOnly:!0})],b.prototype,"hasZ",void 0);d.__decorate([e.property({constructOnly:!0})],b.prototype,"hasM",void 0);d.__decorate([e.property({constructOnly:!0})],b.prototype,"objectIdField",void 0);return b=d.__decorate([e.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],
b)}(l);a.SpatialIndex2D=n;var f={minX:0,minY:0,maxX:0,maxY:0};a.default=n})},"esri/core/libs/rbush/PooledRBush":function(){define("require exports tslib ../../arrayUtils ../../maybe ../../PooledArray ../quickselect/quickselect".split(" "),function(n,a,d,l,k,e,c){function h(a,b){m(a,0,a.children.length,b,a)}function m(a,b,c,d,e){e||(e=new B([]));e.minX=Infinity;e.minY=Infinity;e.maxX=-Infinity;e.maxY=-Infinity;for(var g=void 0;b<c;b++)g=a.children[b],f(e,a.leaf?d(g):g);return e}function f(a,b){a.minX=
Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY)}function b(a,b){return a.minX-b.minX}function g(a,b){return a.minY-b.minY}function p(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function t(a){return a.maxX-a.minX+(a.maxY-a.minY)}function u(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function r(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function q(a,b,d,e,f){for(b=[b,d];b.length;){d=
k.assumeNonNull(b.pop());var g=k.assumeNonNull(b.pop());if(!(d-g<=e)){var h=g+Math.ceil((d-g)/e/2)*e;c(a,h,g,d,f);b.push(g,h,h,d)}}}Object.defineProperty(a,"__esModule",{value:!0});a.BBox=a.PooledRBush=void 0;n=function(){function a(a,c){void 0===a&&(a=9);this.compareMinX=b;this.compareMinY=g;this.toBBox=function(a){return a};this._maxEntries=Math.max(4,a||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));c&&("function"===typeof c?this.toBBox=c:this._initFormat(c));this.clear()}a.prototype.destroy=
function(){this.clear();v.prune();w.prune();z.prune();x.prune()};a.prototype.all=function(a){this._all(this.data,a)};a.prototype.search=function(a,b){var c=this.data,d=this.toBBox;if(r(a,c))for(v.clear();c;){for(var e=0,f=c.children.length;e<f;e++){var g=c.children[e],h=c.leaf?d(g):g;r(a,h)&&(c.leaf?b(g):u(a,h)?this._all(g,b):v.push(g))}c=v.pop()}};a.prototype.collides=function(a){var b=this.data,c=this.toBBox;if(!r(a,b))return!1;for(v.clear();b;){for(var d=0,e=b.children.length;d<e;d++){var f=b.children[d],
g=b.leaf?c(f):f;if(r(a,g)){if(b.leaf||u(a,g))return!0;v.push(f)}}b=v.pop()}return!1};a.prototype.load=function(a,b){void 0===b&&(b=a.length);if(!b)return this;if(b<this._minEntries){for(var c=0;c<b;c++)this.insert(a[c]);return this}a=this._build(a.slice(0,b),0,b-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(c=this.data,this.data=a,a=c),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this};a.prototype.insert=
function(a){a&&this._insert(a,this.data.height-1);return this};a.prototype.clear=function(){this.data=new B([]);return this};a.prototype.remove=function(a){var b;if(!a)return this;var c=this.data,d=null,e=0,f=!1,g,h=this.toBBox(a);z.clear();for(x.clear();c||0<z.length;){c||(c=k.assumeNonNull(z.pop()),d=z.data[z.length-1],e=null!==(b=x.pop())&&void 0!==b?b:0,f=!0);if(c.leaf&&(g=l.indexOf(c.children,a,c.children.length,c.indexHint),-1!==g)){c.children.splice(g,1);z.push(c);this._condense(z);break}f||
c.leaf||!u(c,h)?d?(e++,c=d.children[e],f=!1):c=null:(z.push(c),x.push(e),e=0,d=c,c=c.children[0])}return this};a.prototype.toJSON=function(){return this.data};a.prototype.fromJSON=function(a){this.data=a;return this};a.prototype._all=function(a,b){var c,d=a;for(w.clear();d;){if(!0===d.leaf)for(a=0,d=d.children;a<d.length;a++)b(d[a]);else w.pushArray(d.children);d=null!==(c=w.pop())&&void 0!==c?c:null}};a.prototype._build=function(a,b,c,d){var e=c-b+1,f=this._maxEntries;if(e<=f)return a=new B(a.slice(b,
c+1)),h(a,this.toBBox),a;d||(d=Math.ceil(Math.log(e)/Math.log(f)),f=Math.ceil(e/Math.pow(f,d-1)));var g=new A([]);g.height=d;e=Math.ceil(e/f);f=e*Math.ceil(Math.sqrt(f));for(q(a,b,c,f,this.compareMinX);b<=c;b+=f){var k=Math.min(b+f-1,c);q(a,b,k,e,this.compareMinY);for(var m=b;m<=k;m+=e)g.children.push(this._build(a,m,Math.min(m+e-1,k),d-1))}h(g,this.toBBox);return g};a.prototype._chooseSubtree=function(a,b,c,d){for(;;){d.push(b);if(!0===b.leaf||d.length-1===c)break;for(var e=Infinity,f=Infinity,g=
void 0,h=0,k=b.children.length;h<k;h++){var m=b.children[h],l=p(m),n=(Math.max(m.maxX,a.maxX)-Math.min(m.minX,a.minX))*(Math.max(m.maxY,a.maxY)-Math.min(m.minY,a.minY))-l;n<f?(f=n,e=l<e?l:e,g=m):n===f&&l<e&&(e=l,g=m)}b=g||b.children[0]}return b};a.prototype._insert=function(a,b,c){var d=this.toBBox;c=c?a:d(a);z.clear();d=this._chooseSubtree(c,this.data,b,z);d.children.push(a);for(f(d,c);0<=b;)if(z.data[b].children.length>this._maxEntries)this._split(z,b),b--;else break;this._adjustParentBBoxes(c,
z,b)};a.prototype._split=function(a,b){var c=a.data[b],d=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,d);(d=this._chooseSplitIndex(c,e,d))?(d=c.children.splice(d,c.children.length-d),d=c.leaf?new B(d):new A(d),d.height=c.height,h(c,this.toBBox),h(d,this.toBBox),b?a.data[b-1].children.push(d):this._splitRoot(c,d)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")};a.prototype._splitRoot=function(a,b){this.data=new A([a,b]);this.data.height=a.height+
1;h(this.data,this.toBBox)};a.prototype._chooseSplitIndex=function(a,b,c){var d,e,f=void 0;d=e=Infinity;for(var g=b;g<=c-b;g++){var h=m(a,0,g,this.toBBox),k=m(a,g,c,this.toBBox),l;l=Math.max(0,Math.min(h.maxX,k.maxX)-Math.max(h.minX,k.minX))*Math.max(0,Math.min(h.maxY,k.maxY)-Math.max(h.minY,k.minY));h=p(h)+p(k);l<d?(d=l,f=g,e=h<e?h:e):l===d&&h<e&&(e=h,f=g)}return f};a.prototype._chooseSplitAxis=function(a,c,d){var e=a.leaf?this.compareMinX:b,f=a.leaf?this.compareMinY:g,h=this._allDistMargin(a,c,
d,e);c=this._allDistMargin(a,c,d,f);h<c&&a.children.sort(e)};a.prototype._allDistMargin=function(a,b,c,d){a.children.sort(d);d=this.toBBox;for(var e=m(a,0,b,d),g=m(a,c-b,c,d),h=t(e)+t(g),k=b;k<c-b;k++){var l=a.children[k];f(e,a.leaf?d(l):l);h+=t(e)}for(k=c-b-1;k>=b;k--)l=a.children[k],f(g,a.leaf?d(l):l),h+=t(g);return h};a.prototype._adjustParentBBoxes=function(a,b,c){for(;0<=c;c--)f(b.data[c],a)};a.prototype._condense=function(a){for(var b=a.length-1;0<=b;b--){var c=a.data[b];if(0===c.children.length)if(0<
b){var d=a.data[b-1],e=d.children;e.splice(l.indexOf(e,c,e.length,d.indexHint),1)}else this.clear();else h(c,this.toBBox)}};a.prototype._initFormat=function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")};return a}();a.PooledRBush=n;var v=new e,w=new e,z=new e,x=new e({deallocator:void 0});e=function(){return function(){this.minY=
this.minX=Infinity;this.maxY=this.maxX=-Infinity}}();a.BBox=e;e=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.height=1;b.indexHint=new l.PositionHint;return b}d.__extends(b,a);return b}(e);var B=function(a){function b(b){var c=a.call(this)||this;c.children=b;c.leaf=!0;return c}d.__extends(b,a);return b}(e),A=function(a){function b(b){var c=a.call(this)||this;c.children=b;c.leaf=!1;return c}d.__extends(b,a);return b}(e);a.default=n})},"esri/core/libs/quickselect/quickselect":function(){define([],
function(){function n(d,k,e,c,h){for(;c>e;){if(600<c-e){var m=c-e+1,f=k-e+1,b=Math.log(m),g=.5*Math.exp(2*b/3),b=.5*Math.sqrt(b*g*(m-g)/m)*(0>f-m/2?-1:1);n(d,k,Math.max(e,Math.floor(k-f*g/m+b)),Math.min(c,Math.floor(k+(m-f)*g/m+b)),h)}m=d[k];f=e;g=c;a(d,e,k);for(0<h(d[c],m)&&a(d,e,c);f<g;){a(d,f,g);f++;for(g--;0>h(d[f],m);)f++;for(;0<h(d[g],m);)g--}0===h(d[e],m)?a(d,e,g):(g++,a(d,g,c));g<=k&&(e=g+1);k<=g&&(c=g-1)}}function a(a,d,e){var c=a[d];a[d]=a[e];a[e]=c}function d(a,d){return a<d?-1:a>d?1:0}
return function(a,k,e,c,h){n(a,k,e||0,c||a.length-1,h||d)}})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/unitUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){Object.defineProperty(a,"__esModule",{value:!0});a.StageLayerElevationProvider=void 0;var r=e.getLogger("esri.views.3d.layers.support.StageLayerElevationProvider");n=function(a){function b(b){b=a.call(this,b)||this;b.elevationOffset=0;b.layerDirtyNotificationHandle=null;return b}d.__extends(b,a);b.prototype.initialize=function(){var a=this;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.intersector=new u.Intersector(this.view.state.mode);
this.intersector.options.store=0;var b=this.computeLayerExtent(this.stageLayer);this.zmin=b[2];this.zmax=b[5];this.layerDirtyNotificationHandle=this.stageLayer.on("dirty",function(b){return a.stageLayerChanged(b.origin,b.dirtyType,b.subObject)})};b.prototype.dispose=function(){this.layerDirtyNotificationHandle.remove()};b.prototype.elevationInfoChanged=function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"on-the-ground"!==a.mode){var b=h.getMetersPerVerticalUnitForSR(this.layer.spatialReference),
d=t.getMetersPerUnit(a.unit);this.elevationOffset=c.unwrapOr(a.offset,0)*d/b}else this.elevationOffset=0};b.prototype.getElevation=function(a,b,c,d){z[0]=a;z[1]=b;z[2]=c;if(!this.renderCoordsHelper.toRenderCoords(z,d,z))return r.error("could not project point for elevation alignment"),null;b=this.elevationOffset;a=this.zmin+b;b=this.zmax+b;f.vec3.copy(x,z);f.vec3.copy(B,z);this.renderCoordsHelper.setAltitude(b,x);this.renderCoordsHelper.setAltitude(a,B);this.intersector.reset(x,B);this.intersector.intersect(this.intersectLayers,
null,null,1,null,function(a){return a.metadata&&a.metadata.isElevationSource});return this.intersector.results.min.getIntersectionPoint(z)?this.renderCoordsHelper.getAltitude(z):null};b.prototype.stageLayerChanged=function(a,b,c){switch(b){case "layerObjectAdded":case "layerObjectRemoved":case "objGeometryAdded":a=c;a.metadata&&a.metadata.isElevationSource&&this.objectChanged(a);break;case "objGeometryRemoved":case "vertexAttrsUpdated":case "objTransformation":a.metadata&&a.metadata.isElevationSource&&
this.objectChanged(a)}};b.prototype.objectChanged=function(a){if(this.spatialReference){g.empty(q);a.metadata.lastValidElevationBB.isEmpty()||this.expandExtent(a.metadata.lastValidElevationBB.bbMin,a.metadata.lastValidElevationBB.bbMax,q);var b=a.getBBMin(!1),c=a.getBBMax(!1);this.expandExtent(b,c,q);g.toRect(q,v);this.zmin=Math.min(this.zmin,q[2]);this.zmax=Math.max(this.zmax,q[5]);w.extent=v;w.spatialReference=this.spatialReference;this.emit("elevation-change",w);f.vec3.copy(a.metadata.lastValidElevationBB.bbMin,
b);f.vec3.copy(a.metadata.lastValidElevationBB.bbMax,c)}};b.prototype.computeLayerExtent=function(a){g.empty(q);var b=0;for(a=a.getObjects();b<a.length;b++){var c=a[b];this.expandExtent(c.getBBMin(!1),c.getBBMax(!1),q)}return q};b.prototype.expandExtent=function(a,b,c){for(var d=0;8>d;++d)z[0]=d&1?a[0]:b[0],z[1]=d&2?a[1]:b[1],z[2]=d&4?a[2]:b[2],this.renderCoordsHelper.fromRenderCoords(z,z,this.spatialReference),g.expand(c,z);return c};d.__decorate([m.property({constructOnly:!0})],b.prototype,"layer",
void 0);d.__decorate([m.property({constructOnly:!0})],b.prototype,"stageLayer",void 0);d.__decorate([m.property({constructOnly:!0})],b.prototype,"view",void 0);d.__decorate([m.property({readOnly:!0,aliasOf:"view.spatialReference"})],b.prototype,"spatialReference",void 0);return b=d.__decorate([m.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],b)}(k.EventedMixin(l));a.StageLayerElevationProvider=n;var q=g.empty(),v=p.empty(),w={spatialReference:null,extent:v,context:"scene"},
z=b.vec3f64.create(),x=b.vec3f64.create(),B=b.vec3f64.create()})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/SetUtils ../../../../core/accessorSupport/decorators ./ExtentSet ../../../support/Scheduler".split(" "),function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||
this;b.dirtyExtents=new m.ExtentSet;b.globalDirty=!1;b.dirtyGraphicsSet=new Set;b.handles=new e;b.updateElevation=!1;b.layerView=null;b.graphicsCore=null;b.events=new k;return b}d.__extends(b,a);Object.defineProperty(b.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!1,configurable:!0});b.prototype.setup=function(a,b,c,d){var e=this;this.layerView=a;this.queryGraphicUIDsInExtent=b;this.graphicsCore=c;this.elevationProvider=d;a=this.layerView.view.resourceController.scheduler;
this.handles.add([d.on("elevation-change",function(a){return e._elevationChanged(a)}),this.layerView.watch("suspended",function(){return e.suspendedChange()}),a.registerTask(f.Task.ELEVATION_ALIGNMENT,function(a){return e.update(a)},function(){return e.needsUpdate()})])};b.prototype.destroy=function(){this.dirtyGraphicsSet=null;this.handles.destroy();this.queryGraphicUIDsInExtent=this.graphicsCore=this.layerView=this.handles=null};b.prototype.clear=function(){this.dirtyGraphicsSet.clear();this.notifyChange("updating")};
b.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))};b.prototype.elevationInfoChange=function(){this.globalDirty=!0;this.notifyChange("updating")};b.prototype.needsUpdate=function(){return this.dirtyGraphicsSet&&0<this.dirtyGraphicsSet.size||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty};b.prototype.update=function(a){var b=this;this.globalDirty&&
(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,a.madeProgress());for(a.run(function(){return b.dirtyExtents.merge(a)});this.needsUpdate()&&!a.done;)this._updateDirtyGraphics(a),this._updateDirtyExtents(a);this.layerView.view.deconflictor.setDirty();this.notifyChange("updating")};b.prototype._updateDirtyGraphics=function(a){for(var b=this,d=this.layerView.view,e=this.graphicsCore.stageLayer.id,f=this.layerView.labeling,g=function(){var g=Math.min(h.dirtyGraphicsSet.size,100);c.someSet(h.dirtyGraphicsSet,
function(c){var e=b.graphicsCore.getGraphics3DGraphicById(c);b.dirtyGraphicsSet.delete(c);e&&e.alignWithElevation(b.elevationProvider,d.renderCoordsHelper,b.graphicsCore.asyncUpdates);a.madeProgress();return 0>=--g||a.done});d._stage.processDirtyLayer(e);f&&f.processStageDirty()},h=this;0<this.dirtyGraphicsSet.size&&!a.done;)g()};b.prototype._updateDirtyExtents=function(a){for(var b=this;!this.dirtyExtents.empty&&100>this.dirtyGraphicsSet.size&&!a.done;){var c=this.dirtyExtents.pop(),d=this.elevationProvider.spatialReference;
this.events.emit("invalidate-elevation",{extent:c,spatialReference:d});this.queryGraphicUIDsInExtent(c,d,function(a){var c=b.graphicsCore.getGraphics3DGraphicById(a);c&&c.needsElevationUpdates()&&b.dirtyGraphicsSet.add(a)});a.madeProgress()}};b.prototype.markAllGraphicsElevationDirty=function(){var a=this;this.dirtyExtents.clear();this.dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach(function(b,c){return a.dirtyGraphicsSet.add(c)})};b.prototype._elevationChanged=function(a){if("scene"!==
a.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var b=a.extent;a=a.spatialReference;if(this.layerView.suspended){if(!this.updateElevation){var c=this.graphicsCore.computedExtent;c&&b[2]>c.xmin&&b[0]<c.xmax&&b[3]>c.ymin&&b[1]<c.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:b,spatialReference:a})}else-Infinity===b[0]?this.globalDirty=!0:this.dirtyExtents.add(b),this.notifyChange("updating")}};d.__decorate([h.property({readOnly:!0})],
b.prototype,"updating",null);return b=d.__decorate([h.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],b)}(l);a.default=n})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["require","exports","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.ExtentSet=void 0;n=function(){function a(){this.extents=new d({allocator:function(a){return a||
l.create()}});this.tempExtent=l.create();this.dirty=!1}Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this.extents.length},enumerable:!1,configurable:!0});a.prototype.clear=function(){this.extents.clear()};a.prototype.add=function(a){this.contains(a)||(this.removeContained(a),l.set(this.extents.pushNew(),a),this.dirty=!0)};a.prototype.pop=function(){this.dirty&&this.mergeTight();return this.extents.pop()};a.prototype.merge=function(a){this.mergeTight(a);return a.hasProgressed};
a.prototype.mergeTight=function(a){var c=this;void 0===a&&(a=k.noBudget);for(var d=this.extents,e=new Set,b=0;b!==d.length;){d.sort(function(a,b){return a[0]-b[0]});b=d.length;e.clear();for(var g=function(b){if(a.done)return{value:void 0};var f=d.getItemAt(b);for(b+=1;b<d.length;++b){var g=d.getItemAt(b);if(g[0]>=f[2])break;e.add(g)}e.forEach(function(b){if(f!==b)if(b[2]<=f[0])e.delete(b);else{var g=l.area(f),h=l.area(b),k=c.tempExtent;l.expand(f,b,k);g+=h;.05>(l.area(k)-g)/g&&(l.set(f,k),e.delete(b),
d.remove(b),a.madeProgress())}});e.add(f)},n=0;n<d.length;++n){var t=g(n);if("object"===typeof t)return t.value}}this.dirty=!1};a.prototype.contains=function(a){return this.extents.some(function(c){return l.contains(c,a)})};a.prototype.removeContained=function(a){this.extents.filterInPlace(function(c){return!l.contains(a,c)})};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{containsPoint:function(c){return a.extents.some(function(a){return l.containsPoint(a,c)})}}},enumerable:!1,
configurable:!0});return a}();a.ExtentSet=n})},"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ./QueryEngine ../../../layers/support/FeatureFilter ../../../support/Scheduler".split(" "),function(n,a,d,l,k,e,c,h,m,f,b,g,p){Object.defineProperty(a,"__esModule",
{value:!0});a.Graphics3DFilterVisibility=void 0;var t=e.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");n=function(a){function e(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.filter=null;b._dirty=!1;b._querying=!1;b._handles=new k;return b}d.__extends(e,a);Object.defineProperty(e.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!1,configurable:!0});e.prototype.setup=function(a,
c){var d=this;this._layerView=a;this._core=c;this._objectIdField=a.layer.objectIdField;this._queryEngine=new b.default({layerView:this._layerView,task:p.Task.FILTER_VISIBILITY});this._handles.add(this._layerView.view.resourceController.scheduler.registerTask(p.Task.FILTER_VISIBILITY,function(a){return d._update(a)},function(){return d._needsUpdate()}));this._handles.add(m.on(c.owner,"loadedGraphics","after-changes",function(a){return d._graphicsChanged(a)},function(){return d.dirty=!0}));this.filterChanged()};
e.prototype.destroy=function(){this._handles.destroy();this._handles=null;this.clear();this._core=this._layerView=null};e.prototype.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(function(a){return a.clearVisibilityFlag(2)}),this._queryResult=null,this._querying=!1);this.dirty=!1;this.notifyChange("updating")};e.prototype._graphicsChanged=function(a){this._queryEngine&&0===(a.type&1)||(this.dirty=!0)};e.prototype.updateVisibility=function(a){this.active&&
(a.hasVisibilityFlag(2,0)||a.setVisibilityFlag(2,!1,0),this.dirty=!0)};e.prototype.filterChanged=function(){var a=this.recomputeFilter();a!==this.filter&&(this.filter=a,this.dirty=!0)};Object.defineProperty(e.prototype,"active",{get:function(){return this.filter&&0<this._core.graphics3DGraphics.size},enumerable:!1,configurable:!0});e.prototype.recomputeFilter=function(){var a="filter"in this._layerView?this._layerView.filter:null,b="timeExtent"in this._layerView?this._layerView.timeExtent:null;if(!b)return a;
a=c.isSome(a)?a.clone():new g;a.timeExtent=a.timeExtent?a.timeExtent.intersection(b):b;return a};e.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult};e.prototype._update=function(a){var b=this;this.active?(!this._dirty||this._querying||a.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then(function(a){b._queryResult=a;b._querying=!1}).catch(function(a){h.isAbortError(a)||(t.warn("FeatureFilter query failed: "+
a,{error:a}),b._queryResult=new Set,b._core.graphics3DGraphics.forEach(function(a){return b._queryResult.add(b._getFeatureId(a.graphic))}),b._querying=!1)}),a.madeProgress()),this._queryResult&&!a.done&&(this._core.modifyGraphics3DGraphicVisibilities(function(c){if(a.done)return!1;var d=b._queryResult.has(b._getFeatureId(c.graphic));return c.setVisibilityFlag(2,d,0)?(a.madeProgress(),!0):!1}),a.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()};e.prototype._getFeatureId=
function(a){return null==a.objectId?a.attributes[this._objectIdField]:a.objectId};Object.defineProperty(e.prototype,"dirty",{set:function(a){this._dirty!==a&&(this._dirty=a,this.notifyChange("updating"))},enumerable:!1,configurable:!0});d.__decorate([f.property({readOnly:!0})],e.prototype,"updating",null);return e=d.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],e)}(l);a.Graphics3DFilterVisibility=n})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("require exports tslib ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.QueryEngine=void 0;var g=m.default;n=function(a){function k(b){b=a.call(this,b)||this;b._dataQueryEngineInstance=null;return b}d.__extends(k,a);Object.defineProperty(k.prototype,"queryGeometryType",{get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,
"defaultQueryJSON",{get:function(){return(new b({outSpatialReference:this.spatialReference})).toJSON()},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!1,configurable:!0});k.prototype.destroy=function(){this.clear()};k.prototype.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};k.prototype.executeQueryForIdSet=
function(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){return[2,this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(a),b)]})})};k.prototype.executeQueryForCount=function(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(a),b)]})})};k.prototype.executeQueryForExtent=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,
e,f,g;return d.__generator(this,function(d){switch(d.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(a),b)];case 1:return c=d.sent(),e=c.count,f=c.extent,g=h.fromJSON(f),[2,{count:e,extent:g}]}})})};k.prototype.executeQueryForIds=function(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(a),b)]})})};k.prototype.executeQueryForLatestObservations=function(a,
b){return d.__awaiter(this,void 0,void 0,function(){var c,e,g=this;return d.__generator(this,function(d){switch(d.label){case 0:return[4,this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(a),b)];case 1:return c=d.sent(),e=f.fromJSON(c),e.features.forEach(function(a){a.layer=g.layer;a.sourceLayer=g.layer}),[2,e]}})})};k.prototype.executeQuery=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,g=this;return d.__generator(this,function(d){switch(d.label){case 0:return[4,
this.dataQueryEngine.executeQuery(this._ensureQueryJSON(a),b)];case 1:return c=d.sent(),e=f.fromJSON(c),e.features.forEach(function(a){a.layer=g.layer;a.sourceLayer=g.layer}),[2,e]}})})};k.prototype._ensureQueryJSON=function(a){if(e.isNone(a))return this.defaultQueryJSON;"outSpatialReference"in a&&!a.outSpatialReference&&(a.outSpatialReference=this.spatialReference);return a.toJSON()};k.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
var a="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,b=this.layer.objectIdField,c=l.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),d=this.layer.fields.map(function(a){return a.toJSON()}),e=this.layerView.view.resourceController.scheduler,f=this.task,h=this.spatialReference.toJSON(),k=this.layerView;return this._dataQueryEngineInstance=new g({hasZ:k.hasZ,hasM:k.hasM,geometryType:c,fields:d,timeInfo:a,spatialReference:h,objectIdField:b,featureStore:this.layerView.graphics3d.graphicsCore.featureStore,
scheduler:e,task:f})};d.__decorate([c.property({constructOnly:!0})],k.prototype,"layerView",void 0);d.__decorate([c.property({constructOnly:!0})],k.prototype,"task",void 0);d.__decorate([c.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],k.prototype,"spatialReference",void 0);d.__decorate([c.property({readOnly:!0,aliasOf:"layerView.layer"})],k.prototype,"layer",void 0);d.__decorate([c.property({readOnly:!0,dependsOn:["layer.geometryType"]})],k.prototype,"queryGeometryType",null);
d.__decorate([c.property({readOnly:!0,dependsOn:["spatialReference"]})],k.prototype,"defaultQueryJSON",null);return k=d.__decorate([c.subclass("esri.views.3d.layers.graphics.QueryEngine")],k)}(k);a.QueryEngine=n;a.default=n})},"esri/layers/graphics/data/QueryEngine":function(){define("require exports tslib ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/promiseUtils ../../../core/SetUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../support/PromiseQueue".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C){function E(a){return a.every(function(a){return"exceedslimit"!==a.statisticType})}Object.defineProperty(a,"__esModule",{value:!0});a.Feature=void 0;n=function(){return function(a,b,c,d,e){void 0===b&&(b=null);this.attributes=a;this.geometry=c;this.centroid=d;this.filterFlags=e;this.groupId=-1;this.displayId=b}}();a.Feature=n;var G=new Set,F=new c.MemCacheStorage(2E6),H=0;n=function(){function a(a){var b=this;this.capabilities={query:v.queryCapabilities};
this.geometryType=a.geometryType;this.hasM=a.hasM;this.hasZ=a.hasZ;this.objectIdField=a.objectIdField;this.spatialReference=a.spatialReference;this.definitionExpression=a.definitionExpression;this.featureStore=a.featureStore;this._changeHandle=this.featureStore.events.on("changed",function(){return b.clearCache()});this.timeInfo=a.timeInfo;a.cacheSpatialQueries&&(this._geometryQueryCache=new c.MemCache(H++ +"$$",F));this.fieldsIndex=new A(a.fields);a.scheduler&&a.task&&(this._frameQueue=new C.default,
this._frameTask=a.scheduler.registerTask(a.task,function(a){return b._update(a)},function(){return 0<b._frameQueue.length}))}a.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null);this.clearCache();this._geometryQueryCache&&this._geometryQueryCache.destroy();this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null);this.fieldsIndex.destroy()};Object.defineProperty(a.prototype,"featureAdapter",
{get:function(){return this.featureStore.featureAdapter},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"fullExtent",{get:function(){var a=this.featureStore.fullBounds;return a?{xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:B.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"timeExtent",{get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:this._timeExtent=x.getTimeExtent(this.timeInfo,
this.featureStore):null},enumerable:!1,configurable:!0});a.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};a.prototype.executeQuery=function(a,b){void 0===a&&(a={});return d.__awaiter(this,void 0,void 0,function(){var b,c,e,f=this;return d.__generator(this,function(d){switch(d.label){case 0:b=k.clone(a),d.label=1;case 1:return d.trys.push([1,8,,9]),[4,this._schedule(function(){return B.normalizeQuery(b,f.definitionExpression,
f.spatialReference)})];case 2:return b=d.sent(),[4,this._reschedule(function(){return f._checkQuerySupport(b)})];case 3:return b=d.sent(),[4,this._reschedule(function(){return f._executeGeometryQuery(b)})];case 4:return c=d.sent(),[4,this._reschedule(function(){return c.executeObjectIdsQuery(b)})];case 5:return c=d.sent(),[4,this._reschedule(function(){return c.executeTimeQuery(b)})];case 6:return c=d.sent(),[4,this._reschedule(function(){return c.executeAttributesQuery(b)})];case 7:return c=d.sent(),
[3,9];case 8:e=d.sent();if(e!==B.QUERY_ENGINE_EMPTY_RESULT)throw e;c=new w.default([],null,this);return[3,9];case 9:return[2,c.createQueryResponse(b)]}})})};a.prototype.executeQueryForCount=function(a,b){void 0===a&&(a={});return d.__awaiter(this,void 0,void 0,function(){var b,c,e,f=this;return d.__generator(this,function(d){switch(d.label){case 0:b=k.clone(a),b.returnGeometry=!1,b.returnCentroid=!1,b.outSR=null,d.label=1;case 1:return d.trys.push([1,8,,9]),[4,this._schedule(function(){return B.normalizeQuery(b,
f.definitionExpression,f.spatialReference)})];case 2:return b=d.sent(),[4,this._reschedule(function(){return f._checkQuerySupport(b)})];case 3:return b=d.sent(),[4,this._reschedule(function(){return f._executeGeometryQuery(b)})];case 4:return c=d.sent(),[4,this._reschedule(function(){return c.executeObjectIdsQuery(b)})];case 5:return c=d.sent(),[4,this._reschedule(function(){return c.executeTimeQuery(b)})];case 6:return c=d.sent(),[4,this._reschedule(function(){return c.executeAttributesQuery(b)})];
case 7:return c=d.sent(),[3,9];case 8:e=d.sent();if(e!==B.QUERY_ENGINE_EMPTY_RESULT)throw e;return[2,0];case 9:return[2,c.createQueryResponseForCount(b)]}})})};a.prototype.executeQueryForExtent=function(a,c){void 0===a&&(a={});return d.__awaiter(this,void 0,void 0,function(){var c,e,g,h,m,l,n,p,r=this;return d.__generator(this,function(d){switch(d.label){case 0:c=k.clone(a),g=c.outSR,d.label=1;case 1:return d.trys.push([1,8,,9]),[4,this._schedule(function(){return B.normalizeQuery(c,r.definitionExpression,
r.spatialReference)})];case 2:return c=d.sent(),[4,this._reschedule(function(){return r._checkQuerySupport(c)})];case 3:return c=d.sent(),c.returnGeometry=!0,c.returnCentroid=!1,c.outSR=null,[4,this._reschedule(function(){return r._executeGeometryQuery(c)})];case 4:return e=d.sent(),[4,this._reschedule(function(){return e.executeObjectIdsQuery(c)})];case 5:return e=d.sent(),[4,this._reschedule(function(){return e.executeTimeQuery(c)})];case 6:return e=d.sent(),[4,this._reschedule(function(){return e.executeAttributesQuery(c)})];
case 7:e=d.sent();h=e.size;if(!h)return[2,{count:h,extent:null}];b.set(I,b.NEGATIVE_INFINITY);this.featureStore.forEachBounds(e.items,function(a){return b.expand(I,a)},J);m={xmin:I[0],ymin:I[1],xmax:I[3],ymax:I[4],spatialReference:B.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(I[2])&&isFinite(I[5])&&(m.zmin=I[2],m.zmax=I[5]);l=q.project(m,e.spatialReference,g);l.spatialReference=B.cleanFromGeometryEngine(g||this.spatialReference);0===l.xmax-l.xmin&&(n=f.getMetersPerUnitForSR(l.spatialReference),
l.xmin-=n,l.xmax+=n);0===l.ymax-l.ymin&&(n=f.getMetersPerUnitForSR(l.spatialReference),l.ymin-=n,l.ymax+=n);this.hasZ&&null!=l.zmin&&null!=l.zmax&&0===l.zmax-l.zmin&&(n=f.getMetersPerUnitForSR(l.spatialReference),l.zmin-=n,l.zmax+=n);return[2,{count:h,extent:l}];case 8:p=d.sent();if(p===B.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw p;case 9:return[2]}})})};a.prototype.executeQueryForIds=function(a,b){void 0===a&&(a={});return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,
function(c){return[2,this.executeQueryForIdSet(a,b).then(function(a){return m.valuesOfSet(a)})]})})};a.prototype.executeQueryForIdSet=function(a,b){void 0===a&&(a={});return d.__awaiter(this,void 0,void 0,function(){var b,c,e,f,g,h=this;return d.__generator(this,function(d){switch(d.label){case 0:b=k.clone(a),b.returnGeometry=!1,b.returnCentroid=!1,b.outSR=null,d.label=1;case 1:return d.trys.push([1,9,,10]),[4,this._schedule(function(){return B.normalizeQuery(b,h.definitionExpression,h.spatialReference)})];
case 2:return b=d.sent(),[4,this._reschedule(function(){return h._checkQuerySupport(b)})];case 3:return b=d.sent(),[4,this._reschedule(function(){return h._executeGeometryQuery(b)})];case 4:return c=d.sent(),[4,this._reschedule(function(){return c.executeObjectIdsQuery(b)})];case 5:return c=d.sent(),[4,this._reschedule(function(){return c.executeTimeQuery(b)})];case 6:return c=d.sent(),[4,this._reschedule(function(){return c.executeAttributesQuery(b)})];case 7:return c=d.sent(),e=c.items,f=new Set,
[4,this._reschedule(function(){for(var a=0,b=e;a<b.length;a++)f.add(c.featureAdapter.getObjectId(b[a]))})];case 8:return d.sent(),[2,f];case 9:g=d.sent();if(g===B.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw g;case 10:return[2]}})})};a.prototype.executeQueryForLatestObservations=function(a,b){void 0===a&&(a={});return d.__awaiter(this,void 0,void 0,function(){var b,c,e,f=this;return d.__generator(this,function(d){switch(d.label){case 0:if(!this.timeInfo||!this.timeInfo.trackIdField)throw new l("feature-store:unsupported-query",
"Missing timeInfo or timeInfo.trackIdField",{query:a,timeInfo:this.timeInfo});b=k.clone(a);d.label=1;case 1:return d.trys.push([1,9,,10]),[4,this._schedule(function(){return B.normalizeQuery(b,f.definitionExpression,f.spatialReference)})];case 2:return b=d.sent(),[4,this._reschedule(function(){return f._checkQuerySupport(b)})];case 3:return b=d.sent(),[4,this._reschedule(function(){return f._executeGeometryQuery(b)})];case 4:return c=d.sent(),[4,this._reschedule(function(){return c.executeObjectIdsQuery(b)})];
case 5:return c=d.sent(),[4,this._reschedule(function(){return c.executeTimeQuery(b)})];case 6:return c=d.sent(),[4,this._reschedule(function(){return c.executeAttributesQuery(b)})];case 7:return c=d.sent(),[4,this._reschedule(function(){return c.filterLatest()})];case 8:return c=d.sent(),[3,10];case 9:e=d.sent();if(e!==B.QUERY_ENGINE_EMPTY_RESULT)throw e;c=new w.default([],null,this);return[3,10];case 10:return[2,c.createQueryResponse(b)]}})})};a.prototype._schedule=function(a){return d.__awaiter(this,
void 0,void 0,function(){return d.__generator(this,function(b){return this._frameQueue?[2,this._frameQueue.push(a)]:[2,a()]})})};a.prototype._reschedule=function(a){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(b){return this._frameQueue?[2,this._frameQueue.unshift(a)]:[2,a()]})})};a.prototype._update=function(a){for(this._budget=a;!a.done&&this._frameQueue&&this._frameQueue.process();)a.madeProgress();this._budget=null};a.prototype._getAll=function(){if(!this._allItems){var a=
[];this.featureStore.forEach(function(b){return a.push(b)});this._allItems=new w.default(a,null,this)}return this._allItems};a.prototype._executeGeometryQuery=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,f,g,h,k,m,l,n,p,r,q,t,v,x,B,A,C,I,E,F=this;return d.__generator(this,function(G){switch(G.label){case 0:b=a.geometry;c=a.outSR;f=a.spatialRel;g=u.isValid(c)&&!u.equals(this.spatialReference,c);if(h=this._geometryQueryCache?g?JSON.stringify({geometry:b,spatialRelationship:f,
outSpatialReference:c}):JSON.stringify({geometry:b,spatialRelationship:f}):null)if(k=this._geometryQueryCache.get(h),!e.isUndefined(k))return[2,k];m=function(b){return d.__awaiter(F,void 0,void 0,function(){var e;return d.__generator(this,function(d){switch(d.label){case 0:return g&&(a.returnGeometry||a.returnCentroid)?[4,b.project(c)]:[3,2];case 1:return e=d.sent(),h&&this._geometryQueryCache.put(h,e,e.size||1),[2,e];case 2:return h&&this._geometryQueryCache.put(h,b,b.size||1),[2,b]}})})};if(!b)return[2,
m(this._getAll())];l=this.featureAdapter;if("esriSpatialRelDisjoint"!==f)return[3,3];n=this._searchFeatures(this._getQueryBBoxes(b));if(!n.length)return[2,m(this._getAll())];q=new Set;t=0;for(v=n;t<v.length;t++)x=v[t],q.add(l.getObjectId(x));return[4,this._reschedule(function(){var a=0;p=Array(q.size);F.featureStore.forEach(function(b){return p[a++]=b});r=q})];case 1:return G.sent(),[4,this._reschedule(function(){return d.__awaiter(F,void 0,void 0,function(){var a,c,e;return d.__generator(this,function(d){switch(d.label){case 0:return[4,
z.getSpatialQueryOperator(f,b,this.geometryType,this.hasZ,this.hasM)];case 1:return a=d.sent(),c=function(b){return!r.has(l.getObjectId(b))||a(l.getGeometry(b))},e=w.default.bind,[4,this._runSpatialFilter(p,c)];case 2:return[2,new (e.apply(w.default,[void 0,d.sent(),b,this]))]}})})})];case 2:return B=G.sent(),[2,m(B)];case 3:return A=this._searchFeatures(this._getQueryBBoxes(b)),A.length?(C=this._canExecuteSoloPass(b,a))?[2,m(new w.default(A,b,this))]:[4,z.getSpatialQueryOperator(f,b,this.geometryType,
this.hasZ,this.hasM)]:(B=new w.default([],b,this),h&&this._geometryQueryCache.put(h,B,B.size||1),[2,B]);case 4:return I=G.sent(),[4,this._runSpatialFilter(A,function(a){return I(l.getGeometry(a))})];case 5:return E=G.sent(),[2,m(new w.default(E,b,this))]}})})};a.prototype._runSpatialFilter=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g=this;return d.__generator(this,function(h){if(!b)return[2,a];if(!this._budget)return[2,a.filter(function(a){return b(a)})];c=0;e=[];f=function(){return d.__awaiter(g,
void 0,void 0,function(){var g;return d.__generator(this,function(d){switch(d.label){case 0:if(!(c<a.length))return[3,3];g=a[c];b(g)&&e.push(g);return this._budget.done?[4,this._reschedule(function(){return f()})]:[3,2];case 1:d.sent(),d.label=2;case 2:return++c,[3,0];case 3:return[2]}})})};return[2,this._reschedule(function(){return f()}).then(function(){return e})]})})};a.prototype._canExecuteSoloPass=function(a,b){var c=this.geometryType;b=b.spatialRel;return z.canQueryWithRBush(a)&&("esriSpatialRelEnvelopeIntersects"===
b||"esriGeometryPoint"===c&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b||"esriSpatialRelWithin"===b))};a.prototype._getQueryBBoxes=function(a){if(z.canQueryWithRBush(a)){if(t.isExtent(a))return[g.fromValues(a.xmin,a.ymin,a.xmax,a.ymax)];if(t.isPolygon(a))return a.rings.map(function(a){return g.fromValues(Math.min(a[0][0],a[2][0]),Math.min(a[0][1],a[2][1]),Math.max(a[0][0],a[2][0]),Math.max(a[0][1],a[2][1]))})}return[p.getBoundsXY(g.create(),a)]};a.prototype._searchFeatures=function(a){for(var b=
0;b<a.length;b++)this.featureStore.forEachInBounds(a[b],function(a){G.add(a)});var c=Array(G.size),d=0;G.forEach(function(a){return c[d++]=a});G.clear();return c};a.prototype._checkQuerySupport=function(a){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(b){if(0>a.distance||null!=a.geometryPrecision||a.multipatchOption||a.pixelSize||a.relationParam||a.text)throw new l("feature-store:unsupported-query","Unsupported query options",{query:a});return[2,h.all([this._checkAttributesQuerySupport(a),
this._checkStatisticsQuerySupport(a),z.checkSpatialQuerySupport(a,this.geometryType,this.spatialReference),q.checkProjectionSupport(this.spatialReference,a.outSR)]).then(function(){return a})]})})};a.prototype._checkAttributesQuerySupport=function(a){var b=a.outFields,c=a.orderByFields,d=a.returnDistinctValues,e=a.outStatistics,f=e?e.map(function(a){return a.outStatisticFieldName&&a.outStatisticFieldName.toLowerCase()}):[];c&&0<c.length&&(c=c.map(function(a){var b=a.toLowerCase();return-1<b.indexOf(" asc")?
b.split(" asc")[0]:-1<b.indexOf(" desc")?b.split(" desc")[0]:a}).filter(function(a){return-1===f.indexOf(a)}),r.validateFields(this.fieldsIndex,c,"orderByFields contains missing fields"));if(b&&0<b.length)r.validateFields(this.fieldsIndex,b,"outFields contains missing fields");else if(d)throw new l("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:a});r.validateWhere(this.fieldsIndex,a.where)};a.prototype._checkStatisticsQuerySupport=function(a){return d.__awaiter(this,
void 0,void 0,function(){var b,c,e,f,g,h,k,m,n,p,q,t,u;return d.__generator(this,function(d){b=a.outStatistics;c=a.groupByFieldsForStatistics;e=a.having;f=c&&c.length;g=b&&b.length;if(e){if(!f||!g)throw new l("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:a});r.validateHaving(this.fieldsIndex,e,b)}if(g){if(!E(b))return[2];h=b.map(function(a){return a.onStatisticField});r.validateFields(this.fieldsIndex,h,"onStatisticFields contains missing fields");
f&&r.validateFields(this.fieldsIndex,c,"groupByFieldsForStatistics contains missing fields");k=0;for(m=b;k<m.length;k++)if(n=m[k],p=n.onStatisticField,q=n.statisticType,(t="percentile_disc"===q||"percentile_cont"===q)&&"statisticParameters"in n){if(u=n.statisticParameters,!u)throw new l("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:n,query:a});}else if("count"!==q&&p&&r.hasInvalidFieldType(p,this.fieldsIndex))throw new l("feature-store:unsupported-query",
"outStatistics contains non-numeric fields",{definition:n,query:a});}return[2]})})};return a}();a.default=n;var J=b.create(),I=b.create()})},"esri/layers/graphics/data/attributeSupport":function(){define(["require","exports","../../../core/Error","../../../core/SetUtils","../../../core/sql/WhereClauseCache"],function(n,a,d,l,k){function e(a,c){return a?m.get(a,c):null}function c(a,f,k,m){void 0===m&&(m=!0);for(var b=[],g=0;g<f.length;g++){var l=f[g];if("*"!==l&&!a.has(l))if(m){var n=h(l);try{var p=
e(n,a);if(!p)throw new d("feature-store:unsupported-query","invalid SQL expression",{where:n});if(!p.isStandardized)throw new d("feature-store:unsupported-query","expression is not standard",{clause:p});c(a,p.fieldNames,"expression contains missing fields")}catch(z){if((n=z&&z.details)&&(n.clause||n.where))throw z;n&&n.missingFields?b.push.apply(b,n.missingFields):b.push(l)}}else b.push(l)}if(b.length)throw new d("feature-store:unsupported-query",k,{missingFields:b});}function h(a){return a.split(" as ")[0]}
Object.defineProperty(a,"__esModule",{value:!0});a.hasInvalidFieldType=a.getAliasFromFieldName=a.getExpressionFromFieldName=a.validateFields=a.getWhereClause=a.validateHaving=a.validateWhere=void 0;var m=new k.WhereClauseCache(50,500),f=l.SetFromValues("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));a.validateWhere=function(a,e){if(!e)return!0;var b=m.get(e,a);if(!b)throw new d("feature-store:unsupported-query",
"invalid SQL expression",{where:e});if(!b.isStandardized)throw new d("feature-store:unsupported-query","where clause is not standard",{where:e});c(a,b.fieldNames,"where clause contains missing fields");return!0};a.validateHaving=function(a,e,f){if(!e)return!0;var b=m.get(e,a);if(!b)throw new d("feature-store:unsupported-query","invalid SQL expression",{having:e});if(!b.isAggregate)throw new d("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:e});c(a,b.fieldNames,
"having contains missing fields");if(!b.getExpressions().every(function(b){var c=b.aggregateType;b=b.field;var d=a.has(b)&&a.get(b).name;return f.some(function(b){var e=b.onStatisticField;b=b.statisticType;return(a.has(e)&&a.get(e).name)===d&&b.toLowerCase().trim()===c})}))throw new d("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:e});return!0};a.getWhereClause=e;a.validateFields=c;a.getExpressionFromFieldName=h;a.getAliasFromFieldName=function(a){return a.split(" as ")[1]};
a.hasInvalidFieldType=function(a,c){return(a=c.get(a))?!f.has(a.type):!1}})},"esri/core/sql/WhereClauseCache":function(){define(["require","exports","../ItemCache","./WhereClause"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.WhereClauseCache=void 0;n=function(){function a(a,c){this._cache=new d(a);this._invalidCache=new d(c)}a.prototype.get=function(a,c){var d=c.uid+":"+a,e=this._cache.get(d);if(e)return e;if(void 0!==this._invalidCache.get(d))return null;try{var f=l.WhereClause.create(a,
c);this._cache.put(d,f);return f}catch(b){return this._invalidCache.put(d,null),null}};return a}();a.WhereClauseCache=n})},"esri/core/sql/WhereClause":function(){define("require exports ../has ../MapUtils ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(n,a,d,l,k,e,c){function h(a,b){a+="";return a.length>=b?a:Array(b-a.length+1).join("0")+a}function m(a,b,c,d,e,f,g,k,m){void 0===c&&(c="0");void 0===d&&(d="0");void 0===e&&(e="0");void 0===f&&(f="0");void 0===g&&(g=
"");void 0===k&&(k="0");void 0===m&&(m="0");return"+"===g||"-"===g?(a=h(parseInt(a,10),4)+"-"+h(parseInt(b,10),2)+"-"+h(parseInt(c,10),2),b="",10>parseFloat(f)&&(b="0"),d=h(parseInt(d,10),2)+":"+h(parseInt(e,10),2)+":"+(b+parseFloat(f).toString()),g=""+g+h(parseInt(k,10),2)+":"+h(parseInt(m,10),2),new Date(a+"T"+d+g)):new Date(parseInt(a,10),parseInt(b,10)-1,parseInt(c,10),parseInt(d,10),parseInt(e,10),parseFloat(f))}function f(a){var b=C.exec(a);if(null!==b){a=b[1];var c=b[2],d=b[3],e=b[4],f=b[5],
g=b[6];return m(a,c,d,e,f,g)}b=E.exec(a);if(null!==b){a=b[1];var c=b[2],d=b[3],e=b[4],f=b[5],g=b[6],h=b[7],k=b[8],b=b[9];return m(a,c,d,e,f,g,h,k,b)}b=G.exec(a);if(null!==b)return a=b[1],c=b[2],d=b[3],e=b[4],f=b[5],h=b[6],k=b[7],b=b[8],m(a,c,d,e,f,"0",h,k,b);b=F.exec(a);if(null!==b)return a=b[1],c=b[2],d=b[3],e=b[4],f=b[5],m(a,c,d,e,f);b=A.exec(a);if(null!==b)return a=b[1],c=b[2],d=b[3],m(a,c,d);throw Error("SQL Invalid Timestamp");}function b(a){a=A.exec(a);if(null===a)throw Error("SQL Invalid Date");
var b=a[2],c=a[3];return new Date(parseInt(a[1],10),parseInt(b,10)-1,parseInt(c,10))}function g(a){return Array.isArray(a)?a:[a]}function p(a){return null!==a?!0!==a:null}function t(a,b){return null!=a&&null!=b?!0===a&&!0===b:!1===a||!1===b?!1:null}function u(a,b){return null!=a&&null!=b?!0===a||!0===b:!0===a||!0===b?!0:null}function r(a,b){if(null==a)return null;for(var c=!1,d=0;d<b.length;d++){var e=b[d];if(null==e)c=null;else if(a===e){c=!0;break}}return c}function q(a,b,c){if(null==a)return null;
for(var d="",e=0,f=0;f<b.length;f++){var g=b.charAt(f);switch(e){case 0:g===c?e=1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):"%"===g?d+".*":"_"===g?d+".":d+g;break;case 1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):d+g,e=0}}return(new RegExp("^"+d+"$")).test(a)}function v(a){return a instanceof Date?a.valueOf():a}function w(a,b,c){if(null==b||null==c)return null;b=v(b);c=v(c);switch(a){case "\x3c\x3e":return b!==c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=
c;case "\x3c\x3d":return b<=c}}function z(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d],f=e.toLowerCase();void 0===c[f]&&(b.push(e),c[f]=1)}return b}function x(a,b,c){if(b instanceof e.SqlInterval)if(c instanceof Date)switch(a){case "+":return new Date(b.valueInMilliseconds()+c.getTime());case "-":return b.valueInMilliseconds()-c.getTime();case "*":return b.valueInMilliseconds()*c.getTime();case "/":return b.valueInMilliseconds()/c.getTime()}else if(c instanceof e.SqlInterval)switch(a){case "+":return e.SqlInterval.createFromMilliseconds(b.valueInMilliseconds()+
c.valueInMilliseconds());case "-":return e.SqlInterval.createFromMilliseconds(b.valueInMilliseconds()-c.valueInMilliseconds());case "*":return b.valueInMilliseconds()*c.valueInMilliseconds();case "/":return b.valueInMilliseconds()/c.valueInMilliseconds()}else b=b.valueInMilliseconds();else if(c instanceof e.SqlInterval)if(b instanceof Date)switch(a){case "+":return new Date(c.valueInMilliseconds()+b.getTime());case "-":return new Date(b.getTime()-c.valueInMilliseconds());case "*":return b.getTime()*
c.valueInMilliseconds();case "/":return b.getTime()/c.valueInMilliseconds()}else c=c.valueInMilliseconds();else if(b instanceof Date&&"number"===typeof c)switch(c*=864E5,b=b.getTime(),a){case "+":return new Date(b+c);case "-":return new Date(b-c);case "*":return new Date(b*c);case "/":return new Date(b/c)}else if(c instanceof Date&&"number"===typeof b)switch(b*=864E5,c=c.getTime(),a){case "+":return new Date(b+c);case "-":return new Date(b-c);case "*":return new Date(b*c);case "/":return new Date(b/
c)}switch(a){case "+":return b+c;case "-":return b-c;case "*":return b*c;case "/":return b/c}}function B(a,b,c,d){a=d.getAttribute(a,b);return null!=a&&1===c[b]?new Date(a):a}Object.defineProperty(a,"__esModule",{value:!0});a.defaultAttributeAdapter=a.WhereClause=void 0;var A=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,C=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,E=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,G=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,
F=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,H=function(){function a(){}a.makeBool=function(a){return!0===a};a.featureValue=function(a,b,c,d){return B(a,b,c,d)};a.equalsNull=function(a){return null===a};a.applyLike=function(a,b,c){return q(a,b,c)};a.ensureArray=function(a){return g(a)};a.applyIn=function(a,b){return r(a,b)};a.currentDate=function(){var a=new Date;a.setHours(0,0,0,0);return a};a.makeSqlInterval=function(a,b,c){return e.SqlInterval.createFromValueAndQualifer(a,b,c)};a.convertInterval=
function(a){return a instanceof e.SqlInterval?a.valueInMilliseconds():a};a.currentTimestamp=function(){return new Date};a.compare=function(a,b,c){return w(a,b,c)};a.calculate=function(a,b,c){return x(a,b,c)};a.makeComparable=function(a){return v(a)};a.evaluateFunction=function(a,b){return e.evaluateFunction(a,b)};a.lookup=function(a,b){a=b[a];return void 0===a?null:a};a.between=function(a,b){return null==a||null==b[0]||null==b[1]?null:a>=b[0]&&a<=b[1]};a.notbetween=function(a,b){return null==a||null==
b[0]||null==b[1]?null:a<b[0]||a>b[1]};a.ternaryNot=function(a){return p(a)};a.ternaryAnd=function(a,b){return t(a,b)};a.ternaryOr=function(a,b){return u(a,b)};return a}();n=function(){function h(a,b){this.fieldsIndex=b;this.datefields={};this.parameters={};this.parseTree=c.WhereGrammar.parse(a);a=this.extractExpressionInfo(b);b=a.isStandardized;var d=a.isAggregate;this.referencedFieldNames=a.referencedFieldNames;this.isStandardized=b;this.isAggregate=d}h.create=function(a,b){return new h(a,b)};Object.defineProperty(h.prototype,
"fieldNames",{get:function(){return this.referencedFieldNames},enumerable:!1,configurable:!0});h.prototype.testSet=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);for(var d={},e=function(a){d[a]=b.map(function(b){return c.getAttribute(b,a)})},f=0,g=this.fieldNames;f<g.length;f++)e(g[f]);return!!this.evaluateNode(this.parseTree,{attributes:d},a.defaultAttributeAdapter)};h.prototype.calculateValue=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);b=this.evaluateNode(this.parseTree,b,c);
return b instanceof e.SqlInterval?b.valueInMilliseconds()/864E5:b};h.prototype.calculateValueCompiled=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(b,this.parameters,c,this.datefields);if(d("csp-restrictions"))return this.calculateValue(b,c);this.compileMe();return this.parseTree._compiledVersion(b,this.parameters,c,this.datefields)};h.prototype.testFeature=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);
return!!this.evaluateNode(this.parseTree,b,c)};h.prototype.testFeatureCompiled=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(b,this.parameters,c,this.datefields);if(d("csp-restrictions"))return this.testFeature(b,c);this.compileMe();return!!this.parseTree._compiledVersion(b,this.parameters,c,this.datefields)};h.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===
b.type&&a.push(b.name.toLowerCase())});return z(a)};h.prototype.getExpressions=function(){var a=new Map;this.visitAll(this.parseTree,function(b){if("function"===b.type){var c=b.name.toLowerCase();b=b.args.value[0];if("column_ref"===b.type){b=b.column;var d=c+"-"+b;a.has(d)||a.set(d,{aggregateType:c,field:b})}}});return l.valuesOfMap(a)};h.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return z(a)};h.prototype.compileMe=
function(){var a="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",a)).bind(H)};h.prototype.extractExpressionInfo=function(a){var b=this,c=[],d=!0,f=!0;this.visitAll(this.parseTree,function(g){switch(g.type){case "column_ref":var h=a.get(g.column),m=h&&h.name;!h||"date"!==h.type&&"esriFieldTypeDate"!==h.type||(b.datefields[h.name]=1);void 0!==m?(c.push(m),g.column=m):c.push(g.column);
break;case "function":h=g.name,g=g.args.value.length,d&&(d=e.isStandardized(h,g)),f&&(f=k.isAggregate(h,g))}});return{referencedFieldNames:z(c),isStandardized:d,isAggregate:f}};h.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,b);this.visitAll(a.value,b);break;case "case_expression":for(var c=0,d=a.clauses;c<d.length;c++){var e=d[c];this.visitAll(e,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;
case "expr_list":c=0;for(a=a.value;c<a.length;c++)e=a[c],this.visitAll(e,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};h.prototype.evaluateNodeToJavaScript=function(a){switch(a.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(a.value)+", "+JSON.stringify(a.qualifier)+","+JSON.stringify(a.op)+")";case "case_expression":var c="";if("simple"===
a.format)for(var d="this.makeComparable("+this.evaluateNodeToJavaScript(a.operand)+")",c="( ",e=0;e<a.clauses.length;e++)c+=" ("+d+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(a.clauses[e].operand)+")) ? ("+this.evaluateNodeToJavaScript(a.clauses[e].value)+") : ";else for(c="( ",e=0;e<a.clauses.length;e++)c+=" this.makeBool("+this.evaluateNodeToJavaScript(a.clauses[e].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(a.clauses[e].value)+") : ";c=null!==a.else?c+
this.evaluateNodeToJavaScript(a.else):c+"null";return c+" )";case "param":return"this.lookup("+JSON.stringify(a.value.toLowerCase())+",lookups)";case "expr_list":c="[";d=0;for(a=a.value;d<a.length;d++)e=a[d],"["!==c&&(c+=","),c+=this.evaluateNodeToJavaScript(e);return c+"]";case "unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(a.expr)+")";case "binary_expr":switch(a.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+
" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")";case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+
this.evaluateNodeToJavaScript(a.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(a.left)+
","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+
JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")"}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(a.value);case "date":return"(new Date("+b(a.value).getTime().toString()+"))";case "timestamp":return"(new Date("+f(a.value).getTime().toString()+"))";case "current_time":return"date"===a.mode?"this.currentDate()":"this.currentTimestamp()";case "column_ref":return"this.featureValue(feature,"+
JSON.stringify(a.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(a.name)+","+this.evaluateNodeToJavaScript(a.args)+")"}throw Error("Unsupported sql syntax "+a.type);};h.prototype.evaluateNode=function(a,c,d){switch(a.type){case "interval":return c=this.evaluateNode(a.value,c,d),e.SqlInterval.createFromValueAndQualifer(c,a.qualifier,a.op);case "case_expression":if("simple"===a.format)for(var h=v(this.evaluateNode(a.operand,c,d)),m=0;m<a.clauses.length;m++){if(h===
v(this.evaluateNode(a.clauses[m].operand,c,d)))return this.evaluateNode(a.clauses[m].value,c,d)}else for(m=0;m<a.clauses.length;m++)if(!0===this.evaluateNode(a.clauses[m].operand,c,d))return this.evaluateNode(a.clauses[m].value,c,d);return null!==a.else?this.evaluateNode(a.else,c,d):null;case "param":return this.parameters[a.value.toLowerCase()];case "expr_list":h=[];m=0;for(a=a.value;m<a.length;m++)h.push(this.evaluateNode(a[m],c,d));return h;case "unary_expr":return p(this.evaluateNode(a.expr,c,
d));case "binary_expr":switch(a.operator){case "AND":return t(this.evaluateNode(a.left,c,d),this.evaluateNode(a.right,c,d));case "OR":return u(this.evaluateNode(a.left,c,d),this.evaluateNode(a.right,c,d));case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(a.left,c,d);case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(a.left,c,d);case "IN":return h=g(this.evaluateNode(a.right,c,d)),r(this.evaluateNode(a.left,
c,d),h);case "NOT IN":return h=g(this.evaluateNode(a.right,c,d)),p(r(this.evaluateNode(a.left,c,d),h));case "BETWEEN":return h=this.evaluateNode(a.left,c,d),a=this.evaluateNode(a.right,c,d),null==h||null==a[0]||null==a[1]?null:h>=v(a[0])&&h<=v(a[1]);case "NOTBETWEEN":return h=this.evaluateNode(a.left,c,d),a=this.evaluateNode(a.right,c,d),null==h||null==a[0]||null==a[1]?null:h<v(a[0])||h>v(a[1]);case "LIKE":return q(this.evaluateNode(a.left,c,d),this.evaluateNode(a.right,c,d),a.escape);case "NOT LIKE":return p(q(this.evaluateNode(a.left,
c,d),this.evaluateNode(a.right,c,d),a.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return w(a.operator,this.evaluateNode(a.left,c,d),this.evaluateNode(a.right,c,d));case "-":case "+":case "*":case "/":return x(a.operator,this.evaluateNode(a.left,c,d),this.evaluateNode(a.right,c,d))}case "null":case "bool":case "string":case "number":return a.value;case "date":return b(a.value);case "timestamp":return f(a.value);case "current_time":return c=new Date,
"date"===a.mode&&c.setHours(0,0,0,0),c;case "column_ref":return B(c,a.column,this.datefields,d);case "function":return c=this.evaluateNode(a.args,c,d),this.isAggregate?k.aggregateFunction(a.name,c):e.evaluateFunction(a.name,c)}throw Error("Unsupported sql syntax "+a.type);};return h}();a.WhereClause=n;a.defaultAttributeAdapter={getAttribute:function(a,b){return(a&&"object"===typeof a.attributes?a.attributes:a)[b]}}})},"esri/core/sql/AggregateFunctions":function(){define(["require","exports"],function(n,
a){function d(a){for(var c=0,d=0;d<a.length;d++)c+=a[d];return c/a.length}function l(a){for(var c=d(a),e=a.length,k=0,f=0;f<a.length;f++)k+=Math.pow(a[f]-c,2);return 1<e?k/(e-1):0}Object.defineProperty(a,"__esModule",{value:!0});a.isAggregate=a.aggregateFunction=void 0;a.aggregateFunction=function(a,c){var d=k[a.toLowerCase()];if(null==d)throw Error("Function Not Recognised");if(c.length<d.minParams||c.length>d.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return d.evaluate(c)};
a.isAggregate=function(a,c){a=k[a.toLowerCase()];return null!=a&&c>=a.minParams&&c<=a.maxParams};var k={min:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.min.apply(Math,a[0])}},max:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.max.apply(Math,a[0])}},avg:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:d(a[0])}},sum:{minParams:1,maxParams:1,evaluate:function(a){if(null==a[0])a=null;else{a=a[0];for(var c=0,d=0;d<a.length;d++)c+=
a[d];a=c}return a}},stddev:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sqrt(l(a[0]))}},count:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].length}},var:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:l(a[0])}}}})},"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","../string"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.isStandardized=a.evaluateFunction=a.SqlInterval=void 0;
n=function(){function a(){this.op="+";this.minute=this.year=this.month=this.hour=this.second=this.day=0}a.fixDefaults=function(a){if(null!==a.precision||null!==a.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};a.createFromMilliseconds=function(d){var c=new a;c.second=d/1E3;return c};a.createFromValueAndQualifer=function(d,c,h){var e=null,f=new a;f.op="-"===h?"-":"+";if("interval-period"===c.type){a.fixDefaults(c);if("year"===c.period||"month"===c.period)throw Error("Year-Month Intervals not supported");
if(/^[0-9]{1,}$/.test(d))f[c.period]=parseFloat(d);else throw Error("Illegal Interval");}else{a.fixDefaults(c.start);a.fixDefaults(c.end);if("year"===c.start.period||"month"===c.start.period)throw Error("Year-Month Intervals not supported");if("year"===c.end.period||"month"===c.end.period)throw Error("Year-Month Intervals not supported");switch(c.start.period){case "day":switch(c.end.period){case "hour":e=/^[0-9]{1,} [0-9]{1,}$/;if(e.test(d))f[c.start.period]=parseFloat(d.split(" ")[0]),f[c.end.period]=
parseFloat(d.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":e=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(e.test(d))f[c.start.period]=parseFloat(d.split(" ")[0]),d=d.split(" ")[1].split(":"),f.hour=parseFloat(d[0]),f.minute=parseFloat(d[1]);else throw Error("Illegal Interval");break;case "second":e=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(d))f[c.start.period]=parseFloat(d.split(" ")[0]),d=d.split(" ")[1].split(":"),f.hour=parseFloat(d[0]),f.minute=
parseFloat(d[1]),f.second=parseFloat(d[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(c.end.period){case "minute":e=/^[0-9]{1,}:[0-9]{1,}$/;if(e.test(d))f.hour=parseFloat(d.split(":")[0]),f.minute=parseFloat(d.split(":")[1]);else throw Error("Illegal Interval");break;case "second":e=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(d))d=d.split(":"),f.hour=parseFloat(d[0]),f.minute=parseFloat(d[1]),f.second=parseFloat(d[2]);
else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "minute":switch(c.end.period){case "second":e=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(d))d=d.split(":"),f.minute=parseFloat(d[0]),f.second=parseFloat(d[1]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return f};a.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+
864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return a}();a.SqlInterval=n;a.evaluateFunction=function(a,d){var c=l[a.toLowerCase()];if(null==c)throw Error("Function Not Recognised");if(d.length<c.minParams||d.length>c.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return c.evaluate(d)};a.isStandardized=function(a,d){a=l[a.toLowerCase()];return null!=a&&d>=a.minParams&&d<=a.maxParams};var l={extract:{minParams:2,maxParams:2,evaluate:function(a){var d=a[0];
a=a[1];if(null==a)return null;if(a instanceof Date)switch(d.toUpperCase()){case "SECOND":return a.getSeconds();case "MINUTE":return a.getMinutes();case "HOUR":return a.getHours();case "DAY":return a.getDate();case "MONTH":return a.getMonth()+1;case "YEAR":return a.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(a){if(2===a.length){var d=a[0],c=a[1];return null==d||null==c?null:d.toString().substring(c-1)}if(3===a.length)return d=
a[0],c=a[1],a=a[2],null==d||null==c||null==a?null:0>=a?"":d.toString().substring(c-1,c+a-1)}},position:{minParams:2,maxParams:2,evaluate:function(a){var d=a[0];a=a[1];return null==d||null==a?null:a.indexOf(d)+1}},trim:{minParams:2,maxParams:3,evaluate:function(a){var e=3===a.length,c=e?a[1]:" ",e=e?a[2]:a[1];if(null==c||null==e)return null;c="("+d.escapeRegExpString(c)+")";switch(a[0]){case "BOTH":return e.replace(new RegExp("^"+c+"*|"+c+"*$","g"),"");case "LEADING":return e.replace(new RegExp("^"+
c+"*","g"),"");case "TRAILING":return e.replace(new RegExp(c+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.abs(a[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.ceil(a[0])}},floor:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.floor(a[0])}},log:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])}},log10:{minParams:1,
maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sin(a[0])}},cos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.cos(a[0])}},tan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.tan(a[0])}},asin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.asin(a[0])}},acos:{minParams:1,maxParams:1,evaluate:function(a){return null==
a[0]?null:Math.acos(a[0])}},atan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.atan(a[0])}},sign:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:0<a[0]?1:0>a[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:Math.pow(a[0],a[1])}},mod:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:a[0]%a[1]}},round:{minParams:1,maxParams:2,evaluate:function(a){var d=a[0];a=2===a.length?
Math.pow(10,a[1]):1;return null==d?null:Math.round(d*a)/a}},truncate:{minParams:1,maxParams:2,evaluate:function(a){return null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(a){return"string"===typeof a[0]||a[0]instanceof String?a[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(a){for(var d="",c=0;c<a.length;c++){if(null==a[c])return null;d+=a[c].toString()}return d}},lower:{minParams:1,
maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.WhereGrammar=void 0;n=function(){function a(){}a.parse=function(a){return d.parse(a)};return a}();a.WhereGrammar=n})},"esri/core/sql/sql92grammar":function(){(function(n,
a){"function"===typeof define&&define.amd?define([],a):"object"===typeof module&&module.exports&&(module.exports=a())})(this,function(){function n(a,d,l,k){this.message=a;this.expected=d;this.found=l;this.location=k;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}(function(a,d){function l(){this.constructor=a}l.prototype=d.prototype;a.prototype=new l})(n,Error);n.buildMessage=function(a,d){function l(a){return a.charCodeAt(0).toString(16).toUpperCase()}
function k(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+l(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+l(a)})}function e(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+
l(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+l(a)})}var c={literal:function(a){return'"'+k(a.text)+'"'},"class":function(a){var c="",d;for(d=0;d<a.parts.length;d++)c+=a.parts[d]instanceof Array?e(a.parts[d][0])+"-"+e(a.parts[d][1]):e(a.parts[d]);return"["+(a.inverted?"^":"")+c+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var d=Array(a.length),e;for(e=0;e<a.length;e++){var b=
e,g;g=a[e];g=c[g.type](g);d[b]=g}d.sort();if(0<d.length){for(a=e=1;e<d.length;e++)d[e-1]!==d[e]&&(d[a]=d[e],a++);d.length=a}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}(a)+" but "+(d?'"'+k(d)+'"':"end of input")+" found."};return{SyntaxError:n,parse:function(a,d){function l(a,b){return{type:"literal",text:a,ignoreCase:b}}function k(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function e(b){var c=kb[b],
d;if(!c){for(d=b-1;!kb[d];)d--;c=kb[d];for(c={line:c.line,column:c.column};d<b;)10===a.charCodeAt(d)?(c.line++,c.column=1):c.column++,d++;kb[b]=c}return c}function c(a,b){var c=e(a),d=e(b);return{start:{offset:a,line:c.line,column:c.column},end:{offset:b,line:d.line,column:d.column}}}function h(a){D<Qa||(D>Qa&&(Qa=D,ub=[]),ub.push(a))}function m(){var a,c,d;a=D;c=aa();c!==y?(c=b(),c!==y?(d=aa(),d!==y?a=c:(D=a,a=y)):(D=a,a=y)):(D=a,a=y);return a}function f(){var a,c,d,e,f,g,h,k;a=D;c=b();if(c!==y){d=
[];e=D;f=aa();f!==y?(g=ta(),g!==y?(h=aa(),h!==y?(k=b(),k!==y?e=f=[f,g,h,k]:(D=e,e=y)):(D=e,e=y)):(D=e,e=y)):(D=e,e=y);for(;e!==y;)d.push(e),e=D,f=aa(),f!==y?(g=ta(),g!==y?(h=aa(),h!==y?(k=b(),k!==y?e=f=[f,g,h,k]:(D=e,e=y)):(D=e,e=y)):(D=e,e=y)):(D=e,e=y);if(d!==y){a={type:"expr_list"};c=[c];for(e=0;e<d.length;e++)c.push(d[e][3]);a.value=c}else D=a,a=y}else D=a,a=y;return a}function b(){var a,b,c,d,e,f,h,k;a=D;b=g();if(b!==y){c=[];d=D;e=aa();e!==y?(f=ba(),f!==y?(h=aa(),h!==y?(k=g(),k!==y?d=e=[e,f,
h,k]:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y);for(;d!==y;)c.push(d),d=D,e=aa(),e!==y?(f=ba(),f!==y?(h=aa(),h!==y?(k=g(),k!==y?d=e=[e,f,h,k]:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y);c!==y?a=b=Ga(b,c):(D=a,a=y)}else D=a,a=y;return a}function g(){var a,b,c,d,e,f,g,h;a=D;b=p();if(b!==y){c=[];d=D;e=aa();e!==y?(f=ca(),f!==y?(g=aa(),g!==y?(h=p(),h!==y?d=e=[e,f,g,h]:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y);for(;d!==y;)c.push(d),d=D,e=aa(),e!==y?(f=ca(),f!==y?(g=aa(),g!==y?(h=p(),h!==y?d=e=[e,f,g,h]:
(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y);c!==y?a=b=Ga(b,c):(D=a,a=y)}else D=a,a=y;return a}function p(){var b,c,d,e,g;b=D;c=X();c===y&&(c=D,33===a.charCodeAt(D)?(d=Ha,D++):(d=y,0===ea&&h(Xa)),d!==y?(e=D,ea++,61===a.charCodeAt(D)?(g=Ya,D++):(g=y,0===ea&&h(W)),ea--,g===y?e=void 0:(D=e,e=y),e!==y?c=d=[d,e]:(D=c,c=y)):(D=c,c=y));c!==y?(d=aa(),d!==y?(e=p(),e!==y?b=c={type:"unary_expr",operator:"NOT",expr:e}:(D=b,b=y)):(D=b,b=y)):(D=b,b=y);if(b===y)if(b=D,c=q(),c!==y)if(d=aa(),d!==y){var k,m,l;d=[];e=
D;g=aa();g!==y?(k=t(),k!==y?(m=aa(),m!==y?(l=q(),l!==y?e=g=[g,k,m,l]:(D=e,e=y)):(D=e,e=y)):(D=e,e=y)):(D=e,e=y);if(e!==y)for(;e!==y;)d.push(e),e=D,g=aa(),g!==y?(k=t(),k!==y?(m=aa(),m!==y?(l=q(),l!==y?e=g=[g,k,m,l]:(D=e,e=y)):(D=e,e=y)):(D=e,e=y)):(D=e,e=y);else d=y;d!==y&&(d={type:"arithmetic",tail:d});d===y&&(d=D,e=r(),e!==y?(g=aa(),g!==y?(g=ma(),g!==y?(g=aa(),g!==y?(g=f(),g!==y?(k=aa(),k!==y?(k=qa(),k!==y?d=e={op:e,right:g}:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,
d=y),d===y&&(d=D,e=r(),e!==y?(g=aa(),g!==y?(g=ma(),g!==y?(g=aa(),g!==y?(g=qa(),g!==y?d=e={op:e,right:{type:"expr_list",value:[]}}:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y),d===y&&(d=D,e=r(),e!==y?(g=aa(),g!==y?(g=G(),g!==y?d=e={op:e,right:g}:(D=d,d=y)):(D=d,d=y)):(D=d,d=y))),d===y&&(d=D,g=X(),g!==y?(e=aa(),e!==y?(e=ga(),e!==y?(k=aa(),k!==y?(k=q(),k!==y?(m=aa(),m!==y?(m=ca(),m!==y?(g=aa(),g!==y?(g=q(),g!==y?d=g={op:"NOT"+e,right:{type:"expr_list",value:[k,g]}}:(D=d,d=y)):(D=d,d=y)):(D=
d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y),d===y&&(d=D,g=ga(),g!==y?(e=aa(),e!==y?(e=q(),e!==y?(k=aa(),k!==y?(k=ca(),k!==y?(m=aa(),m!==y?(m=q(),m!==y?d=g={op:g,right:{type:"expr_list",value:[e,m]}}:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)),d===y&&(d=D,e=T(),e!==y?(g=aa(),g!==y?(g=X(),g!==y?(g=aa(),g!==y?(g=q(),g!==y?d=e={op:e+"NOT",right:g}:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y),d===y&&(d=D,e=T(),e!==y?(g=aa(),g!==y?(g=
q(),g!==y?d=e={op:e,right:g}:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)),d===y&&(d=D,e=u(),e!==y?(g=aa(),g!==y?(g=L(),g!==y?(k=aa(),k!==y?(k=D,a.substr(D,6).toLowerCase()===ad?(m=a.substr(D,6),D+=6):(m=y,0===ea&&h(bd)),m!==y?(m=D,ea++,l=C(),ea--,l===y?m=void 0:(D=m,m=y),m!==y?k="ESCAPE":(D=k,k=y)):(D=k,k=y),k!==y?(k=aa(),k!==y?(k=M(),k!==y?d=e={op:e,right:g,escape:k.value}:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y),d===y&&(d=D,e=u(),e!==y?(g=aa(),g!==y?(g=L(),g!==y?d=e={op:e,
right:g,escape:""}:(D=d,d=y)):(D=d,d=y)):(D=d,d=y))))));d===y&&(d=null);d!==y?(b=c,c=d,""==c||void 0==c||null==c?c=b:(d=null,c=d="arithmetic"==c.type?Ga(b,c.tail):La(c.op,b,c.right,c.escape)),b=c):(D=b,b=y)}else D=b,b=y;else D=b,b=y;return b}function t(){var b;a.substr(D,2)===wa?(b=wa,D+=2):(b=y,0===ea&&h(Ca));b===y&&(62===a.charCodeAt(D)?(b=Da,D++):(b=y,0===ea&&h(bb)),b===y&&(a.substr(D,2)===la?(b=la,D+=2):(b=y,0===ea&&h(Oa)),b===y&&(a.substr(D,2)===Pa?(b=Pa,D+=2):(b=y,0===ea&&h(ab)),b===y&&(60===
a.charCodeAt(D)?(b=cb,D++):(b=y,0===ea&&h(Za)),b===y&&(61===a.charCodeAt(D)?(b=Ya,D++):(b=y,0===ea&&h(W)),b===y&&(a.substr(D,2)===vb?(b=vb,D+=2):(b=y,0===ea&&h(lb))))))));return b}function u(){var a,b,c,d;a=a=D;b=X();b!==y?(c=aa(),c!==y?(d=Y(),d!==y?a=b=[b,c,d]:(D=a,a=y)):(D=a,a=y)):(D=a,a=y);a!==y&&(a=a[0]+" "+a[2]);a===y&&(a=Y());return a}function r(){var a,b,c,d;a=a=D;b=X();b!==y?(c=aa(),c!==y?(d=V(),d!==y?a=b=[b,c,d]:(D=a,a=y)):(D=a,a=y)):(D=a,a=y);a!==y&&(a=a[0]+" "+a[2]);a===y&&(a=V());return a}
function q(){var a,b,c,d,e,f,g,h;a=D;b=w();if(b!==y){c=[];d=D;e=aa();e!==y?(f=v(),f!==y?(g=aa(),g!==y?(h=w(),h!==y?d=e=[e,f,g,h]:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y);for(;d!==y;)c.push(d),d=D,e=aa(),e!==y?(f=v(),f!==y?(g=aa(),g!==y?(h=w(),h!==y?d=e=[e,f,g,h]:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y);c!==y?a=b=Ga(b,c):(D=a,a=y)}else D=a,a=y;return a}function v(){var b;43===a.charCodeAt(D)?(b=mb,D++):(b=y,0===ea&&h(wb));b===y&&(45===a.charCodeAt(D)?(b=Ra,D++):(b=y,0===ea&&h(db)));return b}function w(){var a,
b,c,d,e,f,g,h;a=D;b=x();if(b!==y){c=[];d=D;e=aa();e!==y?(f=z(),f!==y?(g=aa(),g!==y?(h=x(),h!==y?d=e=[e,f,g,h]:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y);for(;d!==y;)c.push(d),d=D,e=aa(),e!==y?(f=z(),f!==y?(g=aa(),g!==y?(h=x(),h!==y?d=e=[e,f,g,h]:(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y);c!==y?a=b=Ga(b,c):(D=a,a=y)}else D=a,a=y;return a}function z(){var b;42===a.charCodeAt(D)?(b=Ka,D++):(b=y,0===ea&&h(gb));b===y&&(47===a.charCodeAt(D)?(b=eb,D++):(b=y,0===ea&&h(fb)));return b}function x(){var c,d,
e,g,k,m,l;l=M();if(l===y){var n,p,r,q;n=D;var t,u,w,v;t=D;u=N();u!==y?(w=S(),w!==y?(v=P(),v!==y?t=u=parseFloat(u+w+v):(D=t,t=y)):(D=t,t=y)):(D=t,t=y);t===y&&(t=D,u=N(),u!==y?(w=S(),w!==y?t=u=parseFloat(u+w):(D=t,t=y)):(D=t,t=y),t===y&&(t=D,u=N(),u!==y?(w=P(),w!==y?t=u=parseFloat(u+w):(D=t,t=y)):(D=t,t=y),t===y&&(t=D,u=N(),u!==y&&(u=parseFloat(u)),t=u)));p=t;p!==y?(r=D,ea++,q=A(),ea--,q===y?r=void 0:(D=r,r=y),r!==y?n=p={type:"number",value:p}:(D=n,n=y)):(D=n,n=y);l=n;if(l===y){var x,z;x=D;var I,J,
Pa,K;I=D;a.substr(D,4).toLowerCase()===cd?(J=a.substr(D,4),D+=4):(J=y,0===ea&&h(dd));J!==y?(Pa=D,ea++,K=C(),ea--,K===y?Pa=void 0:(D=Pa,Pa=y),Pa!==y?I=J=[J,Pa]:(D=I,I=y)):(D=I,I=y);z=I;z!==y&&(z={type:"bool",value:!0});x=z;if(x===y){x=D;var Ca,Oa,Y,la;Ca=D;a.substr(D,5).toLowerCase()===ed?(Oa=a.substr(D,5),D+=5):(Oa=y,0===ea&&h(fd));Oa!==y?(Y=D,ea++,la=C(),ea--,la===y?Y=void 0:(D=Y,Y=y),Y!==y?Ca=Oa=[Oa,Y]:(D=Ca,Ca=y)):(D=Ca,Ca=y);z=Ca;z!==y&&(z={type:"bool",value:!1});x=z}l=x;if(l===y){var ga,ab,Da,
T,X;ab=D;a.substr(D,4).toLowerCase()===gd?(Da=a.substr(D,4),D+=4):(Da=y,0===ea&&h(hd));Da!==y?(T=D,ea++,X=C(),ea--,X===y?T=void 0:(D=T,T=y),T!==y?ab=Da=[Da,T]:(D=ab,ab=y)):(D=ab,ab=y);ga=ab;ga!==y&&(ga={type:"null",value:null});l=ga;if(l===y){var ba,bb,ca,U;ba=D;var cb,W,wa,Z;cb=D;a.substr(D,4).toLowerCase()===id?(W=a.substr(D,4),D+=4):(W=y,0===ea&&h(jd));W!==y?(wa=D,ea++,Z=C(),ea--,Z===y?wa=void 0:(D=wa,wa=y),wa!==y?cb=W="DATE":(D=cb,cb=y)):(D=cb,cb=y);bb=cb;bb!==y?(ca=aa(),ca!==y?(U=L(),U!==y?ba=
bb={type:"date",value:U.value}:(D=ba,ba=y)):(D=ba,ba=y)):(D=ba,ba=y);l=ba;if(l===y){var Za,vb,ua,oa;Za=D;var ta,Ga,lb,La;ta=D;a.substr(D,9).toLowerCase()===kd?(Ga=a.substr(D,9),D+=9):(Ga=y,0===ea&&h(ld));Ga!==y?(lb=D,ea++,La=C(),ea--,La===y?lb=void 0:(D=lb,lb=y),lb!==y?ta=Ga="TIMESTAMP":(D=ta,ta=y)):(D=ta,ta=y);vb=ta;vb!==y?(ua=aa(),ua!==y?(oa=L(),oa!==y?Za=vb={type:"timestamp",value:oa.value}:(D=Za,Za=y)):(D=Za,Za=y)):(D=Za,Za=y);l=Za;if(l===y){var ra,Ja,Ya,Ka,Na,Ha,pc,gb;ra=D;Ja=da();Ja!==y?(Ya=
aa(),Ya!==y?(45===a.charCodeAt(D)?(Ka=Ra,D++):(Ka=y,0===ea&&h(db)),Ka===y&&(43===a.charCodeAt(D)?(Ka=mb,D++):(Ka=y,0===ea&&h(wb))),Ka!==y?(Na=aa(),Na!==y?(Ha=L(),Ha!==y?(pc=aa(),pc!==y?(gb=H(),gb!==y?ra=Ja={type:"interval",value:Ha,qualifier:gb,op:Ka}:(D=ra,ra=y)):(D=ra,ra=y)):(D=ra,ra=y)):(D=ra,ra=y)):(D=ra,ra=y)):(D=ra,ra=y)):(D=ra,ra=y);ra===y&&(ra=D,Ja=da(),Ja!==y?(Ya=aa(),Ya!==y?(Ka=L(),Ka!==y?(Na=aa(),Na!==y?(Ha=H(),Ha!==y?ra=Ja={type:"interval",value:Ka,qualifier:Ha,op:""}:(D=ra,ra=y)):(D=
ra,ra=y)):(D=ra,ra=y)):(D=ra,ra=y)):(D=ra,ra=y));l=ra}}}}}}c=l;if(c===y){var Ea,fb,sb,Xa,eb,Nb,Qa,qc,kb,jb,tb,ub;Ea=D;var nb,Xb,Eb,rc;nb=D;a.substr(D,7).toLowerCase()===md?(Xb=a.substr(D,7),D+=7):(Xb=y,0===ea&&h(nd));Xb!==y?(Eb=D,ea++,rc=C(),ea--,rc===y?Eb=void 0:(D=Eb,Eb=y),Eb!==y?nb=Xb="EXTRACT":(D=nb,nb=y)):(D=nb,nb=y);fb=nb;if(fb!==y)if(sb=aa(),sb!==y)if(Xa=ma(),Xa!==y)if(eb=aa(),eb!==y){var Sa;Sa=fa();Sa===y&&(Sa=ka(),Sa===y&&(Sa=ja(),Sa===y&&(Sa=pa(),Sa===y&&(Sa=na(),Sa===y&&(Sa=va())))));Nb=
Sa;Nb!==y?(Qa=aa(),Qa!==y?(qc=ia(),qc!==y?(kb=aa(),kb!==y?(jb=b(),jb!==y?(tb=aa(),tb!==y?(ub=qa(),ub!==y?Ea=fb={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:Nb},jb]}}:(D=Ea,Ea=y)):(D=Ea,Ea=y)):(D=Ea,Ea=y)):(D=Ea,Ea=y)):(D=Ea,Ea=y)):(D=Ea,Ea=y)):(D=Ea,Ea=y)}else D=Ea,Ea=y;else D=Ea,Ea=y;else D=Ea,Ea=y;else D=Ea,Ea=y;c=Ea;if(c===y){var Ba,Ob,Pb,Qb,Rb,Yb,Sb,Tb,Ub,Zb,Vb,Ma,xb,sc,tc,uc;Ba=D;var ob,$b,Fb,Wb;ob=D;a.substr(D,9).toLowerCase()===od?($b=a.substr(D,9),D+=
9):($b=y,0===ea&&h(pd));$b!==y?(Fb=D,ea++,Wb=C(),ea--,Wb===y?Fb=void 0:(D=Fb,Fb=y),Fb!==y?ob=$b="SUBSTRING":(D=ob,ob=y)):(D=ob,ob=y);Ob=ob;if(Ob!==y)if(Pb=aa(),Pb!==y)if(Qb=ma(),Qb!==y)if(Rb=aa(),Rb!==y)if(Yb=b(),Yb!==y)if(Sb=aa(),Sb!==y)if(Tb=ia(),Tb!==y)if(Ub=aa(),Ub!==y)if(Zb=b(),Zb!==y)if(Vb=aa(),Vb!==y){Ma=D;var pb,ac,Gb,Bc;pb=D;a.substr(D,3).toLowerCase()===qd?(ac=a.substr(D,3),D+=3):(ac=y,0===ea&&h(rd));ac!==y?(Gb=D,ea++,Bc=C(),ea--,Bc===y?Gb=void 0:(D=Gb,Gb=y),Gb!==y?pb=ac="FOR":(D=pb,pb=
y)):(D=pb,pb=y);xb=pb;xb!==y?(sc=aa(),sc!==y?(tc=b(),tc!==y?(uc=aa(),uc!==y?Ma=xb=[xb,sc,tc,uc]:(D=Ma,Ma=y)):(D=Ma,Ma=y)):(D=Ma,Ma=y)):(D=Ma,Ma=y);Ma===y&&(Ma=null);Ma!==y?(xb=qa(),xb!==y?Ba=Ob={type:"function",name:"substring",args:{type:"expr_list",value:Ma?[Yb,Zb,Ma[2]]:[Yb,Zb]}}:(D=Ba,Ba=y)):(D=Ba,Ba=y)}else D=Ba,Ba=y;else D=Ba,Ba=y;else D=Ba,Ba=y;else D=Ba,Ba=y;else D=Ba,Ba=y;else D=Ba,Ba=y;else D=Ba,Ba=y;else D=Ba,Ba=y;else D=Ba,Ba=y;else D=Ba,Ba=y;c=Ba;if(c===y){var sa,yb,bc,cc,dc,Ta,ec,zb,
fc,gc,Cc,vc,Dc,Ec;sa=D;yb=ha();yb!==y?(bc=aa(),bc!==y?(cc=ma(),cc!==y?(dc=aa(),dc!==y?(Ta=F(),Ta===y&&(Ta=null),Ta!==y?(ec=aa(),ec!==y?(zb=b(),zb!==y?(fc=aa(),fc!==y?(gc=ia(),gc!==y?(Cc=aa(),Cc!==y?(vc=b(),vc!==y?(Dc=aa(),Dc!==y?(Ec=qa(),Ec!==y?sa=yb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Ta?"BOTH":Ta},zb,vc]}}:(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):
(D=sa,sa=y)):(D=sa,sa=y);sa===y&&(sa=D,yb=ha(),yb!==y?(bc=aa(),bc!==y?(cc=ma(),cc!==y?(dc=aa(),dc!==y?(Ta=F(),Ta===y&&(Ta=null),Ta!==y?(ec=aa(),ec!==y?(zb=b(),zb!==y?(fc=aa(),fc!==y?(gc=qa(),gc!==y?sa=yb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Ta?"BOTH":Ta},zb]}}:(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y)):(D=sa,sa=y));c=sa;if(c===y){var Fa,wc,Fc,Gc,Hc,xc,Ic,Jc,Kc,yc,Lc,Mc;Fa=D;var qb,hc,Hb,Nc;
qb=D;a.substr(D,8).toLowerCase()===sd?(hc=a.substr(D,8),D+=8):(hc=y,0===ea&&h(td));hc!==y?(Hb=D,ea++,Nc=C(),ea--,Nc===y?Hb=void 0:(D=Hb,Hb=y),Hb!==y?qb=hc="POSITION":(D=qb,qb=y)):(D=qb,qb=y);wc=qb;wc!==y?(Fc=aa(),Fc!==y?(Gc=ma(),Gc!==y?(Hc=aa(),Hc!==y?(xc=b(),xc!==y?(Ic=aa(),Ic!==y?(Jc=V(),Jc!==y?(Kc=aa(),Kc!==y?(yc=b(),yc!==y?(Lc=aa(),Lc!==y?(Mc=qa(),Mc!==y?Fa=wc={type:"function",name:"position",args:{type:"expr_list",value:[xc,yc]}}:(D=Fa,Fa=y)):(D=Fa,Fa=y)):(D=Fa,Fa=y)):(D=Fa,Fa=y)):(D=Fa,Fa=y)):
(D=Fa,Fa=y)):(D=Fa,Fa=y)):(D=Fa,Fa=y)):(D=Fa,Fa=y)):(D=Fa,Fa=y)):(D=Fa,Fa=y);c=Fa;if(c===y){var Ia,ic,Oc,Pc,Qc,Ab,Rc,Sc;Ia=D;var Ua,Ib,Jb,$a;Ua=D;Ua=Ib=B();if(Ua===y)if(Ua=D,96===a.charCodeAt(D)?(Ib=Tc,D++):(Ib=y,0===ea&&h(Uc)),Ib!==y){Jb=[];Vc.test(a.charAt(D))?($a=a.charAt(D),D++):($a=y,0===ea&&h(Wc));if($a!==y)for(;$a!==y;)Jb.push($a),Vc.test(a.charAt(D))?($a=a.charAt(D),D++):($a=y,0===ea&&h(Wc));else Jb=y;Jb!==y?(96===a.charCodeAt(D)?($a=Tc,D++):($a=y,0===ea&&h(Uc)),$a!==y?Ua=Ib=Jb.join(""):(D=
Ua,Ua=y)):(D=Ua,Ua=y)}else D=Ua,Ua=y;ic=Ua;ic!==y?(Oc=aa(),Oc!==y?(Pc=ma(),Pc!==y?(Qc=aa(),Qc!==y?(Ab=f(),Ab===y&&(Ab=null),Ab!==y?(Rc=aa(),Rc!==y?(Sc=qa(),Sc!==y?Ia=ic={type:"function",name:ic,args:Ab?Ab:{type:"expr_list",value:[]}}:(D=Ia,Ia=y)):(D=Ia,Ia=y)):(D=Ia,Ia=y)):(D=Ia,Ia=y)):(D=Ia,Ia=y)):(D=Ia,Ia=y)):(D=Ia,Ia=y);c=Ia;if(c===y){var jc,xa,Bb,kc,Cb,lc,hb,Va,Kb,Xc,Yc;xa=D;Bb=za();if(Bb!==y)if(kc=aa(),kc!==y)if(Cb=b(),Cb!==y)if(lc=aa(),lc!==y){hb=[];for(Va=R();Va!==y;)hb.push(Va),Va=R();hb!==
y?(Va=aa(),Va!==y?(Kb=ya(),Kb!==y?xa=Bb={type:"case_expression",format:"simple",operand:Cb,clauses:hb,else:null}:(D=xa,xa=y)):(D=xa,xa=y)):(D=xa,xa=y)}else D=xa,xa=y;else D=xa,xa=y;else D=xa,xa=y;else D=xa,xa=y;if(xa===y)if(xa=D,Bb=za(),Bb!==y)if(kc=aa(),kc!==y)if(Cb=b(),Cb!==y)if(lc=aa(),lc!==y){hb=[];for(Va=R();Va!==y;)hb.push(Va),Va=R();hb!==y?(Va=aa(),Va!==y?(Kb=O(),Kb!==y?(Xc=aa(),Xc!==y?(Yc=ya(),Yc!==y?xa=Bb={type:"case_expression",format:"simple",operand:Cb,clauses:hb,else:Kb.value}:(D=xa,
xa=y)):(D=xa,xa=y)):(D=xa,xa=y)):(D=xa,xa=y)):(D=xa,xa=y)}else D=xa,xa=y;else D=xa,xa=y;else D=xa,xa=y;else D=xa,xa=y;jc=xa;if(jc===y){var Aa,Db,mc,ib,Wa,Lb,Zc,$c;Aa=D;Db=za();if(Db!==y)if(mc=aa(),mc!==y){ib=[];for(Wa=Q();Wa!==y;)ib.push(Wa),Wa=Q();ib!==y?(Wa=aa(),Wa!==y?(Lb=ya(),Lb!==y?Aa=Db={type:"case_expression",format:"searched",clauses:ib,else:null}:(D=Aa,Aa=y)):(D=Aa,Aa=y)):(D=Aa,Aa=y)}else D=Aa,Aa=y;else D=Aa,Aa=y;if(Aa===y)if(Aa=D,Db=za(),Db!==y)if(mc=aa(),mc!==y){ib=[];for(Wa=Q();Wa!==y;)ib.push(Wa),
Wa=Q();ib!==y?(Wa=aa(),Wa!==y?(Lb=O(),Lb!==y?(Zc=aa(),Zc!==y?($c=ya(),$c!==y?Aa=Db={type:"case_expression",format:"searched",clauses:ib,else:Lb.value}:(D=Aa,Aa=y)):(D=Aa,Aa=y)):(D=Aa,Aa=y)):(D=Aa,Aa=y)):(D=Aa,Aa=y)}else D=Aa,Aa=y;else D=Aa,Aa=y;jc=Aa}c=jc;if(c===y){var Mb,rb,zc,nc,oc;rb=D;zc=A();if(zc!==y){nc=[];for(oc=E();oc!==y;)nc.push(oc),oc=E();nc!==y?rb=zc+=nc.join(""):(D=rb,rb=y)}else D=rb,rb=y;Mb=rb;if(Mb!==y){var Ac=Mb;Mb=/^CURRENT_DATE$/i.test(Ac)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(Ac)?
{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:Ac}}c=Mb;c===y&&(c=G(),c===y&&(c=D,d=ma(),d!==y?(e=aa(),e!==y?(g=b(),g!==y?(k=aa(),k!==y?(m=qa(),m!==y?(g.paren=!0,c=d=g):(D=c,c=y)):(D=c,c=y)):(D=c,c=y)):(D=c,c=y)):(D=c,c=y)))}}}}}}}return c}function B(){var a,b,c,d;a=D;b=A();if(b!==y){c=[];for(d=C();d!==y;)c.push(d),d=C();c!==y?a=b+=c.join(""):(D=a,a=y)}else D=a,a=y;return a}function A(){var b;sb.test(a.charAt(D))?(b=a.charAt(D),D++):(b=y,0===ea&&h(pc));return b}function C(){var b;
Nb.test(a.charAt(D))?(b=a.charAt(D),D++):(b=y,0===ea&&h(qc));return b}function E(){var b;rc.test(a.charAt(D))?(b=a.charAt(D),D++):(b=y,0===ea&&h(Ob));return b}function G(){var b,c,d;b=D;64===a.charCodeAt(D)?(c=ud,D++):(c=y,0===ea&&h(vd));c!==y?(d=B(),d!==y?b=c=[c,d]:(D=b,b=y)):(D=b,b=y);b!==y&&(b={type:"param",value:b[1]});return b}function F(){var b,c,d;b=D;a.substr(D,7).toLowerCase()===wd?(c=a.substr(D,7),D+=7):(c=y,0===ea&&h(xd));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="LEADING":
(D=b,b=y)):(D=b,b=y);b===y&&(b=D,a.substr(D,8).toLowerCase()===yd?(c=a.substr(D,8),D+=8):(c=y,0===ea&&h(zd)),c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="TRAILING":(D=b,b=y)):(D=b,b=y),b===y&&(b=D,a.substr(D,4).toLowerCase()===Ad?(c=a.substr(D,4),D+=4):(c=y,0===ea&&h(Bd)),c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="BOTH":(D=b,b=y)):(D=b,b=y)));return b}function H(){var b,c,d;b=D;var e,f;c=D;d=J();d!==y?(e=aa(),e!==y?(e=ma(),e!==y?(e=aa(),e!==y?(e=K(),e!==y?(f=aa(),
f!==y?(f=qa(),f!==y?c=d={type:"interval-period",period:d.value,precision:e,secondary:null}:(D=c,c=y)):(D=c,c=y)):(D=c,c=y)):(D=c,c=y)):(D=c,c=y)):(D=c,c=y)):(D=c,c=y);c===y&&(c=D,d=J(),d!==y&&(d=Pb(d)),c=d);if(c!==y)if(d=aa(),d!==y)if(d=D,a.substr(D,2).toLowerCase()===Cd?(e=a.substr(D,2),D+=2):(e=y,0===ea&&h(Dd)),e!==y?(e=D,ea++,f=C(),ea--,f===y?e=void 0:(D=e,e=y),e!==y?d="TO":(D=d,d=y)):(D=d,d=y),d!==y)if(d=aa(),d!==y){var g;d=D;e=J();e!==y&&(e={type:"interval-period",period:e.value,precision:null,
secondary:null});d=e;d===y&&(d=D,e=va(),e!==y?(e=aa(),e!==y?(e=ma(),e!==y?(e=aa(),e!==y?(e=K(),e!==y?(f=aa(),f!==y?(f=ta(),f!==y?(f=aa(),f!==y?(f=I(),f!==y?(g=aa(),g!==y?(g=qa(),g!==y?d=e=Qb(e,f):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y),d===y&&(d=D,e=va(),e!==y?(e=aa(),e!==y?(e=ma(),e!==y?(e=aa(),e!==y?(e=K(),e!==y?(f=aa(),f!==y?(f=qa(),f!==y?d=e={type:"interval-period",period:"second",precision:e,secondary:null}:(D=d,
d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y)):(D=d,d=y),d===y&&(d=D,e=va(),e!==y&&(e={type:"interval-period",period:"second",precision:null,secondary:null}),d=e)));d!==y?b=c={type:"interval-qualifier",start:c,end:d}:(D=b,b=y)}else D=b,b=y;else D=b,b=y;else D=b,b=y;else D=b,b=y;b===y&&(b=D,d=J(),d!==y?(c=aa(),c!==y?(c=ma(),c!==y?(c=aa(),c!==y?(c=I(),c!==y?(e=aa(),e!==y?(e=qa(),e!==y?b=d={type:"interval-period",period:d.value,precision:c,secondary:null}:(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):
(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y),b===y&&(b=D,d=J(),d!==y&&(d=Pb(d)),b=d,b===y&&(b=D,d=va(),d!==y?(c=aa(),c!==y?(c=ma(),c!==y?(c=aa(),c!==y?(c=K(),c!==y?(e=aa(),e!==y?(e=ta(),e!==y?(d=aa(),d!==y?(d=I(),d!==y?(e=aa(),e!==y?(e=qa(),e!==y?b=d=Qb(c,d):(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y),b===y&&(b=D,d=va(),d!==y?(c=aa(),c!==y?(c=ma(),c!==y?(c=aa(),c!==y?(c=I(),c!==y?(e=aa(),e!==y?(e=qa(),e!==y?b=d={type:"interval-period",
period:"second",precision:c,secondary:null}:(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y)):(D=b,b=y),b===y&&(b=D,d=va(),d!==y&&(d={type:"interval-period",period:"second",precision:null,secondary:null}),b=d)))));return b}function J(){var a;a=D;a=ja();a!==y&&(a={type:"string",value:"day"});a===y&&(a=D,a=pa(),a!==y&&(a={type:"string",value:"hour"}),a===y&&(a=D,a=na(),a!==y&&(a={type:"string",value:"minute"}),a===y&&(a=D,a=ka(),a!==y&&(a={type:"string",value:"month"}),a===y&&(a=D,a=
fa(),a!==y&&(a={type:"string",value:"year"})))));return a}function I(){var a;a=U();a!==y&&(a=parseFloat(a));return a}function K(){var a;a=U();a!==y&&(a=parseFloat(a));return a}function L(){var a;a=M();a===y&&(a=G());return a}function M(){var b,c,d;b=D;39===a.charCodeAt(D)?(c=Rb,D++):(c=y,0===ea&&h(Sb));c===y&&(a.substr(D,2)===Tb?(c=Tb,D+=2):(c=y,0===ea&&h(Ed)));if(c!==y){c=[];d=D;a.substr(D,2)===jb?(d=jb,D+=2):(d=y,0===ea&&h(Ub));d!==y&&(d="'");d===y&&(Vb.test(a.charAt(D))?(d=a.charAt(D),D++):(d=
y,0===ea&&h(Wb)));for(;d!==y;)c.push(d),d=D,a.substr(D,2)===jb?(d=jb,D+=2):(d=y,0===ea&&h(Ub)),d!==y&&(d="'"),d===y&&(Vb.test(a.charAt(D))?(d=a.charAt(D),D++):(d=y,0===ea&&h(Wb)));c!==y?(39===a.charCodeAt(D)?(d=Rb,D++):(d=y,0===ea&&h(Sb)),d!==y?b=c={type:"string",value:c.join("")}:(D=b,b=y)):(D=b,b=y)}else D=b,b=y;return b}function Q(){var a,c,d;a=D;c=ua();c!==y?(c=aa(),c!==y?(c=b(),c!==y?(d=aa(),d!==y?(d=oa(),d!==y?(d=aa(),d!==y?(d=b(),d!==y?a=c={type:"when_clause",operand:c,value:d}:(D=a,a=y)):
(D=a,a=y)):(D=a,a=y)):(D=a,a=y)):(D=a,a=y)):(D=a,a=y)):(D=a,a=y);return a}function R(){var a,c,d;a=D;c=ua();c!==y?(c=aa(),c!==y?(c=b(),c!==y?(d=aa(),d!==y?(d=oa(),d!==y?(d=aa(),d!==y?(d=b(),d!==y?a=c={type:"when_clause",operand:c,value:d}:(D=a,a=y)):(D=a,a=y)):(D=a,a=y)):(D=a,a=y)):(D=a,a=y)):(D=a,a=y)):(D=a,a=y);return a}function O(){var c,d;c=D;var e,f;d=D;a.substr(D,4).toLowerCase()===Fd?(e=a.substr(D,4),D+=4):(e=y,0===ea&&h(Gd));e!==y?(e=D,ea++,f=C(),ea--,f===y?e=void 0:(D=e,e=y),e!==y?d="ELSE":
(D=d,d=y)):(D=d,d=y);d!==y?(d=aa(),d!==y?(d=b(),d!==y?c={type:"else_clause",value:d}:(D=c,c=y)):(D=c,c=y)):(D=c,c=y);return c}function N(){var b,c,d;b=U();b===y&&(b=D,45===a.charCodeAt(D)?(c=Ra,D++):(c=y,0===ea&&h(db)),c===y&&(43===a.charCodeAt(D)?(c=mb,D++):(c=y,0===ea&&h(wb))),c!==y?(d=U(),d!==y?b=c=c[0]+d:(D=b,b=y)):(D=b,b=y));return b}function S(){var b,c;b=D;46===a.charCodeAt(D)?(c=Hd,D++):(c=y,0===ea&&h(Id));c!==y?(c=U(),c===y&&(c=null),c!==y?b="."+(null!=c?c:""):(D=b,b=y)):(D=b,b=y);return b}
function P(){var b,c,d;c=b=D;Jd.test(a.charAt(D))?(d=a.charAt(D),D++):(d=y,0===ea&&h(Kd));d!==y?(Ld.test(a.charAt(D))?(d=a.charAt(D),D++):(d=y,0===ea&&h(Md)),d===y&&(d=null),d!==y?c="e"+(null===d?"":d):(D=c,c=y)):(D=c,c=y);c!==y?(d=U(),d!==y?b=c+d:(D=b,b=y)):(D=b,b=y);return b}function U(){var a,b;a=[];b=Z();if(b!==y)for(;b!==y;)a.push(b),b=Z();else a=y;a!==y&&(a=a.join(""));return a}function Z(){var b;Nd.test(a.charAt(D))?(b=a.charAt(D),D++):(b=y,0===ea&&h(Od));return b}function V(){var b,c,d;b=
D;a.substr(D,2).toLowerCase()===Pd?(c=a.substr(D,2),D+=2):(c=y,0===ea&&h(Qd));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="IN":(D=b,b=y)):(D=b,b=y);return b}function T(){var b,c,d;b=D;a.substr(D,2).toLowerCase()===Rd?(c=a.substr(D,2),D+=2):(c=y,0===ea&&h(Sd));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="IS":(D=b,b=y)):(D=b,b=y);return b}function Y(){var b,c,d;b=D;a.substr(D,4).toLowerCase()===Td?(c=a.substr(D,4),D+=4):(c=y,0===ea&&h(Ud));c!==y?(c=D,ea++,d=C(),ea--,
d===y?c=void 0:(D=c,c=y),c!==y?b="LIKE":(D=b,b=y)):(D=b,b=y);return b}function X(){var b,c,d;b=D;a.substr(D,3).toLowerCase()===Vd?(c=a.substr(D,3),D+=3):(c=y,0===ea&&h(Wd));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="NOT":(D=b,b=y)):(D=b,b=y);return b}function ca(){var b,c,d;b=D;a.substr(D,3).toLowerCase()===Xd?(c=a.substr(D,3),D+=3):(c=y,0===ea&&h(Yd));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="AND":(D=b,b=y)):(D=b,b=y);return b}function ba(){var b,c,d;b=D;a.substr(D,
2).toLowerCase()===Zd?(c=a.substr(D,2),D+=2):(c=y,0===ea&&h($d));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="OR":(D=b,b=y)):(D=b,b=y);return b}function ga(){var b,c,d;b=D;a.substr(D,7).toLowerCase()===ae?(c=a.substr(D,7),D+=7):(c=y,0===ea&&h(be));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="BETWEEN":(D=b,b=y)):(D=b,b=y);return b}function ia(){var b,c,d;b=D;a.substr(D,4).toLowerCase()===ce?(c=a.substr(D,4),D+=4):(c=y,0===ea&&h(de));c!==y?(c=D,ea++,d=C(),ea--,d===y?
c=void 0:(D=c,c=y),c!==y?b="FROM":(D=b,b=y)):(D=b,b=y);return b}function ha(){var b,c,d;b=D;a.substr(D,4).toLowerCase()===ee?(c=a.substr(D,4),D+=4):(c=y,0===ea&&h(fe));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="TRIM":(D=b,b=y)):(D=b,b=y);return b}function da(){var b,c,d;b=D;a.substr(D,8).toLowerCase()===ge?(c=a.substr(D,8),D+=8):(c=y,0===ea&&h(he));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="INTERVAL":(D=b,b=y)):(D=b,b=y);return b}function fa(){var b,c,d;b=D;a.substr(D,
4).toLowerCase()===ie?(c=a.substr(D,4),D+=4):(c=y,0===ea&&h(je));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="YEAR":(D=b,b=y)):(D=b,b=y);return b}function ka(){var b,c,d;b=D;a.substr(D,5).toLowerCase()===ke?(c=a.substr(D,5),D+=5):(c=y,0===ea&&h(le));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="MONTH":(D=b,b=y)):(D=b,b=y);return b}function ja(){var b,c,d;b=D;a.substr(D,3).toLowerCase()===me?(c=a.substr(D,3),D+=3):(c=y,0===ea&&h(ne));c!==y?(c=D,ea++,d=C(),ea--,d===y?
c=void 0:(D=c,c=y),c!==y?b="DAY":(D=b,b=y)):(D=b,b=y);return b}function pa(){var b,c,d;b=D;a.substr(D,4).toLowerCase()===oe?(c=a.substr(D,4),D+=4):(c=y,0===ea&&h(pe));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="HOUR":(D=b,b=y)):(D=b,b=y);return b}function na(){var b,c,d;b=D;a.substr(D,6).toLowerCase()===qe?(c=a.substr(D,6),D+=6):(c=y,0===ea&&h(re));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="MINUTE":(D=b,b=y)):(D=b,b=y);return b}function va(){var b,c,d;b=D;a.substr(D,
6).toLowerCase()===se?(c=a.substr(D,6),D+=6):(c=y,0===ea&&h(te));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="SECOND":(D=b,b=y)):(D=b,b=y);return b}function za(){var b,c,d;b=D;a.substr(D,4).toLowerCase()===ue?(c=a.substr(D,4),D+=4):(c=y,0===ea&&h(ve));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="CASE":(D=b,b=y)):(D=b,b=y);return b}function ya(){var b,c,d;b=D;a.substr(D,3).toLowerCase()===we?(c=a.substr(D,3),D+=3):(c=y,0===ea&&h(xe));c!==y?(c=D,ea++,d=C(),ea--,d===y?
c=void 0:(D=c,c=y),c!==y?b="END":(D=b,b=y)):(D=b,b=y);return b}function ua(){var b,c,d;b=D;a.substr(D,4).toLowerCase()===ye?(c=a.substr(D,4),D+=4):(c=y,0===ea&&h(ze));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="WHEN":(D=b,b=y)):(D=b,b=y);return b}function oa(){var b,c,d;b=D;a.substr(D,4).toLowerCase()===Ae?(c=a.substr(D,4),D+=4):(c=y,0===ea&&h(Be));c!==y?(c=D,ea++,d=C(),ea--,d===y?c=void 0:(D=c,c=y),c!==y?b="THEN":(D=b,b=y)):(D=b,b=y);return b}function ta(){var b;44===a.charCodeAt(D)?
(b=Ce,D++):(b=y,0===ea&&h(De));return b}function ma(){var b;40===a.charCodeAt(D)?(b=Ee,D++):(b=y,0===ea&&h(Fe));return b}function qa(){var b;41===a.charCodeAt(D)?(b=Ge,D++):(b=y,0===ea&&h(He));return b}function aa(){var a,b;a=[];for(b=Ja();b!==y;)a.push(b),b=Ja();return a}function Ja(){var b;Ie.test(a.charAt(D))?(b=a.charAt(D),D++):(b=y,0===ea&&h(Je));return b}function La(a,b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function Ga(a,b){for(var c=0;c<b.length;c++)a=
La(b[c][1],a,b[c][3]);return a}d=void 0!==d?d:{};var y={},ra={start:m},Na=m,Ha="!",Xa=l("!",!1),Ya="\x3d",W=l("\x3d",!1),wa="\x3e\x3d",Ca=l("\x3e\x3d",!1),Da="\x3e",bb=l("\x3e",!1),la="\x3c\x3d",Oa=l("\x3c\x3d",!1),Pa="\x3c\x3e",ab=l("\x3c\x3e",!1),cb="\x3c",Za=l("\x3c",!1),vb="!\x3d",lb=l("!\x3d",!1),mb="+",wb=l("+",!1),Ra="-",db=l("-",!1),Ka="*",gb=l("*",!1),eb="/",fb=l("/",!1),sb=/^[A-Za-z_\x80-\uFFFF]/,pc=k([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Nb=/^[A-Za-z0-9_]/,qc=k([["A","Z"],
["a","z"],["0","9"],"_"],!1,!1),rc=/^[A-Za-z0-9_.\x80-\uFFFF]/,Ob=k([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),ud="@",vd=l("@",!1),Pb=function(a){return{type:"interval-period",period:a.value,precision:null,secondary:null}},Qb=function(a,b){return{type:"interval-period",period:"second",precision:a,secondary:b}},Rb="'",Sb=l("'",!1),Tb="N'",Ed=l("N'",!1),jb="''",Ub=l("''",!1),Vb=/^[^']/,Wb=k(["'"],!0,!1),Hd=".",Id=l(".",!1),Nd=/^[0-9]/,Od=k([["0","9"]],!1,!1),Jd=/^[eE]/,Kd=k(["e",
"E"],!1,!1),Ld=/^[+\-]/,Md=k(["+","-"],!1,!1),gd="null",hd=l("NULL",!0),cd="true",dd=l("TRUE",!0),ed="false",fd=l("FALSE",!0),Pd="in",Qd=l("IN",!0),Rd="is",Sd=l("IS",!0),Td="like",Ud=l("LIKE",!0),ad="escape",bd=l("ESCAPE",!0),Vd="not",Wd=l("NOT",!0),Xd="and",Yd=l("AND",!0),Zd="or",$d=l("OR",!0),ae="between",be=l("BETWEEN",!0),ce="from",de=l("FROM",!0),qd="for",rd=l("FOR",!0),od="substring",pd=l("SUBSTRING",!0),md="extract",nd=l("EXTRACT",!0),ee="trim",fe=l("TRIM",!0),sd="position",td=l("POSITION",
!0),kd="timestamp",ld=l("TIMESTAMP",!0),id="date",jd=l("DATE",!0),wd="leading",xd=l("LEADING",!0),yd="trailing",zd=l("TRAILING",!0),Ad="both",Bd=l("BOTH",!0),Cd="to",Dd=l("TO",!0),ge="interval",he=l("INTERVAL",!0),ie="year",je=l("YEAR",!0),ke="month",le=l("MONTH",!0),me="day",ne=l("DAY",!0),oe="hour",pe=l("HOUR",!0),qe="minute",re=l("MINUTE",!0),se="second",te=l("SECOND",!0),ue="case",ve=l("CASE",!0),we="end",xe=l("END",!0),ye="when",ze=l("WHEN",!0),Ae="then",Be=l("THEN",!0),Fd="else",Gd=l("ELSE",
!0),Ce=",",De=l(",",!1),Ee="(",Fe=l("(",!1),Ge=")",He=l(")",!1),Ie=/^[ \t\n\r]/,Je=k([" ","\t","\n","\r"],!1,!1),Tc="`",Uc=l("`",!1),Vc=/^[^`]/,Wc=k(["`"],!0,!1),D=0,kb=[{line:1,column:1}],Qa=0,ub=[],ea=0,tb;if("startRule"in d){if(!(d.startRule in ra))throw Error("Can't start parsing from rule \""+d.startRule+'".');Na=ra[d.startRule]}tb=Na();if(tb!==y&&D===a.length)return tb;tb!==y&&D<a.length&&h({type:"end"});throw function(a,b,c){return new n(n.buildMessage(a,b),a,b,c)}(ub,Qa<a.length?a.charAt(Qa):
null,Qa<a.length?c(Qa,Qa+1):c(Qa,Qa));}}})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports tslib ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(n,a,d,l,k,e,c,h,m){function f(a,c){var d;if(!c)return null;if("x"in c){var e={x:0,y:0};a=a(c.x,c.y,t);e.x=a[0];e.y=a[1];null!=c.z&&(e.z=c.z);null!=
c.m&&(e.m=c.m);return e}if("xmin"in c)return e={xmin:0,ymin:0,xmax:0,ymax:0},d=a(c.xmin,c.ymin,t),e.xmin=d[0],e.ymin=d[1],a=a(c.xmax,c.ymax,t),e.xmax=a[0],e.ymax=a[1],c.hasZ&&(e.zmin=c.zmin,e.zmax=c.zmax,e.hasZ=!0),c.hasM&&(e.mmin=c.mmin,e.mmax=c.mmax,e.hasM=!0),e;if("rings"in c)return{rings:b(c.rings,a),hasM:c.hasM,hasZ:c.hasZ};if("paths"in c)return{paths:b(c.paths,a),hasM:c.hasM,hasZ:c.hasZ};if("points"in c)return{points:g(c.points,a),hasM:c.hasM,hasZ:c.hasZ}}function b(a,b){for(var c=[],d=0;d<
a.length;d++)c.push(g(a[d],b));return c}function g(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=b(e[0],e[1],[0,0]);c.push(f);2<e.length&&f.push(e[2]);3<e.length&&f.push(e[3])}return c}function p(a,b){return!h.isValid(a)||!h.isValid(b)||h.equals(a,b)||m.canProject(a,b)?!1:!0}Object.defineProperty(a,"__esModule",{value:!0});a.projectMany=a.project=a.checkProjectionSupport=a.doesBrowserSupportProjection=void 0;var t=[0,0];a.doesBrowserSupportProjection=function(a,b){return p(a,b)?e.isSupported():
!0};a.checkProjectionSupport=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,f,g;return d.__generator(this,function(d){if(!b)return[2];if(Array.isArray(a)){c=0;for(f=a;c<f.length;c++)if(g=f[c],p(g.geometry&&g.geometry.spatialReference,b)){if(e.isSupported())return[2,e.load()];throw new l("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:b});}return[2]}if(!p(a,b))return[2];if(e.isSupported())return[2,e.load()];throw new l("feature-store:unsupported-query",
"projection not supported",{inSpatialReference:a,outSpatialReference:b});})})};var u=f.bind(null,m.lngLatToXY),r=f.bind(null,m.xyToLngLat);a.project=function(a,b,d){if(!a)return a;d||(d=b,b=a.spatialReference);return h.isValid(b)&&h.isValid(d)&&!h.equals(b,d)?m.canProject(b,d)?h.isWebMercator(d)?u(a):r(a):e.projectMany(c.jsonAdapter,[a],b,d,null)[0]:a};var q=new (function(){function a(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}a.prototype.push=function(a,b,c){return d.__awaiter(this,
void 0,void 0,function(){var e,f=this;return d.__generator(this,function(d){a&&a.length&&b&&c&&!h.equals(b,c)||k.resolve(a);e={geometries:a,inSpatialReference:b,outSpatialReference:c,resolve:null};this._jobs.push(e);return[2,k.create(function(a){e.resolve=a;null===f._timer&&(f._timer=setTimeout(f._process,10))})]})})};a.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var b=a.geometries,d=a.inSpatialReference,f=a.outSpatialReference,a=a.resolve;m.canProject(d,f)?h.isWebMercator(f)?
a(b.map(u)):a(b.map(r)):a(e.projectMany(c.jsonAdapter,b,d,f,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return a}());a.projectMany=function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(d){return[2,q.push(a,b,c)]})})}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./support/GeographicTransformation @dojo/framework/shim/Promise".split(" "),function(n,a,d,l,k){function e(a,d,e,f,m){void 0===
m&&(m=null);if(null===m){var g=k.cacheKey(e,f);void 0!==b[g]?m=b[g]:(m=c(e,f,null),null===m&&(m=new k),b[g]=m)}return h._project(a,d,e,f,m)}function c(a,b,c){void 0===c&&(c=null);a=h._getTransformation(m,a,b,c,null===c||void 0===c?void 0:c.spatialReference);return null!==a?k.fromGE(a):null}Object.defineProperty(a,"__esModule",{value:!0});a.getTransformations=a.getTransformation=a.projectMany=a.project=a.load=a.isSupported=a.isLoaded=void 0;var h=null,m=null;a.isLoaded=function(){return!!h&&l.isLoaded()};
a.isSupported=function(){return l.isSupported()};var f=null;a.load=function(){return f?f:f=d.all([l.load(),new Promise(function(a,b){n(["./geometryEngineBase"],a,b)}),new Promise(function(a,b){n(["./geometryAdapters/hydrated"],a,b)})]).then(function(a){var b=a[1];m=a[2].hydratedAdapter;h=b;h._enableProjection(l)})};a.project=function(a,b,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:e(m,a,a[0].spatialReference,b,c):e(m,[a],a.spatialReference,b,c)[0]};var b={};a.projectMany=e;a.getTransformation=
c;a.getTransformations=function(a,b,c){void 0===c&&(c=null);a=h._getTransformationBySuitability(m,a,b,c,null===c||void 0===c?void 0:c.spatialReference);if(null!==a){b=[];for(c=0;c<a.length;c++)b.push(k.fromGE(a[c]));return b}return[]}})},"esri/geometry/pe":function(){define("require exports tslib ../assets ../core/has ../core/promiseUtils @dojo/framework/shim/Promise".split(" "),function(n,a,d,l,k,e){function c(c){function e(a,b,c){a[b]=c(a[b])}a._pe=c;p.init();t.init();u.init();r.init();q.init();
a.PeGCSExtent=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}d.__extends(c,b);c.prototype.destroy=function(){a._pe.destroy(this)};return c}(a._pe.PeGCSExtent);for(var f=0,g=[a._pe.PeDatum,a._pe.PeGeogcs,a._pe.PeGeogtran,a._pe.PeObject,a._pe.PeParameter,a._pe.PePrimem,a._pe.PeProjcs,a._pe.PeSpheroid,a._pe.PeUnit];f<g.length;f++)c=g[f],e(c.prototype,"getName",function(a){return function(){return a.call(this,Array(p.PE_NAME_MAX))}});f=0;for(g=[a._pe.PeGeogtran,a._pe.PeProjcs];f<
g.length;f++)c=g[f],e(c.prototype,"getParameters",function(b){return function(){for(var c=Array(p.PE_PARM_MAX),d=b.call(this),e=0;e<c.length;e++){var f=a._pe.getValue(d,"*");c[e]=f?a._pe.wrapPointer(f,a._pe.PeParameter):null;d+=Int32Array.BYTES_PER_ELEMENT}return c}});e(a._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var c=this.getSize();if(!c)return null;var d=[],e=a.call(this);b(d,c,e);return d}});e(a._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(b){var c=a._pe._pe_getPeGTlistExtendedGTsSize();
return function(){var d=null,e=b.call(this);if(!a._pe.compare(e,a._pe.NULL)){var d=[e],f=this.getSteps();if(1<f)for(var e=a._pe.getPointer(e),g=1;g<f;g++)d.push(a._pe.wrapPointer(e+c*g,a._pe.PeGTlistExtendedGTs))}return d}});var h=a._pe._pe_getPeHorizonSize();c=function(b){return function(){var c=this._cache;c||(this._cache=c=new Map);if(c.has(b))return c.get(b);var d=null,e=b.call(this);if(!a._pe.compare(e,a._pe.NULL)){var d=[e],f=e.getNump();if(1<f)for(var e=a._pe.getPointer(e),g=1;g<f;g++)d.push(a._pe.wrapPointer(e+
h*g,a._pe.PeHorizon))}c.set(b,d);return d}};e(a._pe.PeProjcs.prototype,"horizonGcsGenerate",c);e(a._pe.PeProjcs.prototype,"horizonPcsGenerate",c);a._pe.PeObject.prototype.toString=function(b){void 0===b&&(b=p.PE_STR_OPTS_NONE);a._pe.ensureCache.prepare();var c=a._pe.getPointer(this),d=a._pe.ensureInt8(Array(p.PE_BUFFER_MAX));return a._pe.UTF8ToString(a._pe._pe_object_to_string_ext(c,b,d))}}function h(b){if(b){var c=a._pe.getClass(b);c&&(c=a._pe.getCache(c))&&(b=a._pe.getPointer(b))&&delete c[b]}}
function m(b,c){var d=[];c=Array(c);for(var e=0;e<b;e++)d.push(a._pe.ensureInt8(c));return d}function f(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):b=a;return b}function b(b,c,d,e){void 0===e&&(e=!1);if(e)for(e=0;e<2*c;e++)b[e]=a._pe.getValue(d+e*Float64Array.BYTES_PER_ELEMENT,"double");else{var f=0===b.length;for(e=0;e<c;e++)f&&(b[e]=Array(2)),b[e][0]=a._pe.getValue(d,"double"),b[e][1]=a._pe.getValue(d+Float64Array.BYTES_PER_ELEMENT,"double"),d+=2*Float64Array.BYTES_PER_ELEMENT}}
Object.defineProperty(a,"__esModule",{value:!0});a._init=a.PeVersion=a.PePCSInfo=a.PeNotationUtm=a.PeNotationUsng=a.PeNotationMgrs=a.PeNotationDms=a.PeGTTransformations=a.PeGTlistExtendedEntry=a.PeGTlistExtended=a.PeGCSExtent=a.PeFactory=a.PeDefs=a.PeCSTransformations=a.load=a.isSupported=a.isLoaded=a._pe=void 0;var g;a._pe=null;a.isLoaded=function(){return!!a._pe};a.isSupported=function(){return!!k("esri-wasm")};a.load=function(){return g?g:g=e.create(function(a,b){(new Promise(function(a,b){n(["./support/pe-wasm"],
a,b)})).then(function(d){d({locateFile:function(a){return l.getAssetUrl("esri/geometry/support/"+a)},onAbort:function(a){b(Error(a))}}).then(function(b){c(b);a()})})})};(function(c){function d(c,d,e){a._pe.ensureCache.prepare();var g=f(e),h=e===g,g=a._pe.ensureFloat64(g);(c=a._pe._pe_geog_to_proj(a._pe.getPointer(c),d,g))&&b(e,d,g,h);return c}function e(a,b,c){return g(a,b,c,0)}function g(c,d,e,g){a._pe.ensureCache.prepare();var h=f(e),k=e===h,h=a._pe.ensureFloat64(h);(c=a._pe._pe_proj_to_geog_center(a._pe.getPointer(c),
d,h,g))&&b(e,d,h,k);return c}c.geogToProj=d;c.projGeog=function(a,b,c,f){switch(f){case p.PE_TRANSFORM_P_TO_G:return e(a,b,c);case p.PE_TRANSFORM_G_TO_P:return d(a,b,c)}return 0};c.projToGeog=e;c.projToGeogCenter=g})(a.PeCSTransformations||(a.PeCSTransformations={}));var p;(function(b){b.init=function(){b.PE_BUFFER_MAX=a._pe.PeDefs.prototype.PE_BUFFER_MAX;b.PE_NAME_MAX=a._pe.PeDefs.prototype.PE_NAME_MAX;b.PE_MGRS_MAX=a._pe.PeDefs.prototype.PE_MGRS_MAX;b.PE_USNG_MAX=a._pe.PeDefs.prototype.PE_USNG_MAX;
b.PE_DD_MAX=a._pe.PeDefs.prototype.PE_DD_MAX;b.PE_DDM_MAX=a._pe.PeDefs.prototype.PE_DDM_MAX;b.PE_DMS_MAX=a._pe.PeDefs.prototype.PE_DMS_MAX;b.PE_UTM_MAX=a._pe.PeDefs.prototype.PE_UTM_MAX;b.PE_PARM_MAX=a._pe.PeDefs.prototype.PE_PARM_MAX;b.PE_TYPE_NONE=a._pe.PeDefs.prototype.PE_TYPE_NONE;b.PE_TYPE_GEOGCS=a._pe.PeDefs.prototype.PE_TYPE_GEOGCS;b.PE_TYPE_PROJCS=a._pe.PeDefs.prototype.PE_TYPE_PROJCS;b.PE_TYPE_GEOGTRAN=a._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;b.PE_TYPE_COORDSYS=a._pe.PeDefs.prototype.PE_TYPE_COORDSYS;
b.PE_TYPE_UNIT=a._pe.PeDefs.prototype.PE_TYPE_UNIT;b.PE_STR_OPTS_NONE=a._pe.PeDefs.prototype.PE_STR_OPTS_NONE;b.PE_STR_AUTH_NONE=a._pe.PeDefs.prototype.PE_STR_AUTH_NONE;b.PE_STR_AUTH_TOP=a._pe.PeDefs.prototype.PE_STR_AUTH_TOP;b.PE_STR_NAME_CANON=a._pe.PeDefs.prototype.PE_STR_NAME_CANON;b.PE_PARM_X0=a._pe.PeDefs.prototype.PE_PARM_X0;b.PE_PARM_ND=a._pe.PeDefs.prototype.PE_PARM_ND;b.PE_TRANSFORM_1_TO_2=a._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;b.PE_TRANSFORM_2_TO_1=a._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;
b.PE_TRANSFORM_P_TO_G=a._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;b.PE_TRANSFORM_G_TO_P=a._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;b.PE_HORIZON_RECT=a._pe.PeDefs.prototype.PE_HORIZON_RECT;b.PE_HORIZON_POLY=a._pe.PeDefs.prototype.PE_HORIZON_POLY;b.PE_HORIZON_LINE=a._pe.PeDefs.prototype.PE_HORIZON_LINE;b.PE_HORIZON_DELTA=a._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(p=a.PeDefs||(a.PeDefs={}));(function(b){function c(b,c){var f=null,g=e[b];g||(g={},e[b]=g);g.hasOwnProperty(String(c))?f=g[c]:(b=a._pe.PeFactory.prototype.factoryByType(b,
c),a._pe.compare(b,a._pe.NULL)||(f=b,g[c]=f));return f=d(f)}function d(b){if(b){var c=b.getType();switch(c){case p.PE_TYPE_GEOGCS:b=a._pe.castObject(b,a._pe.PeGeogcs);break;case p.PE_TYPE_PROJCS:b=a._pe.castObject(b,a._pe.PeProjcs);break;case p.PE_TYPE_GEOGTRAN:b=a._pe.castObject(b,a._pe.PeGeogtran);break;default:c&p.PE_TYPE_UNIT&&(b=a._pe.castObject(b,a._pe.PeUnit))}}return b}var e={},f={};b.initialize=function(){a._pe.PeFactory.prototype.initialize(null)};b.coordsys=function(a){return c(p.PE_TYPE_COORDSYS,
a)};b.factoryByType=c;b.fromString=function(b,c){var e=null,g=f[b];g||(g={},f[b]=g);g.hasOwnProperty(c)?e=g[c]:(b=a._pe.PeFactory.prototype.fromString(b,c),a._pe.compare(b,a._pe.NULL)||(e=b,g[c]=e));return e=d(e)};b.geogcs=function(a){return c(p.PE_TYPE_GEOGCS,a)};b.geogtran=function(a){return c(p.PE_TYPE_GEOGTRAN,a)};b.getCode=function(b){return a._pe.PeFactory.prototype.getCode(b)};b.projcs=function(a){return c(p.PE_TYPE_PROJCS,a)};b.unit=function(a){return c(p.PE_TYPE_UNIT,a)}})(a.PeFactory||(a.PeFactory=
{}));a.PeGCSExtent=null;var t;(function(b){var c;b.init=function(){b.PE_GTLIST_OPTS_COMMON=a._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;c=a._pe._pe_getPeGTlistExtendedEntrySize()};b.getGTlist=function(b,d,e,f,g,h){var k=null,m=new a._pe.PeInteger(h);try{var l=a._pe.PeGTlistExtended.prototype.getGTlist(b,d,e,f,g,m);if(h=m.val)if(k=[l],1<h){var n=a._pe.getPointer(l);for(b=1;b<h;b++)k.push(a._pe.wrapPointer(n+c*b,a._pe.PeGTlistExtendedEntry))}}finally{a._pe.destroy(m)}return k}})(t=a.PeGTlistExtended||
(a.PeGTlistExtended={}));(function(b){b.destroy=function(b){if(b&&b.length){for(var c=0;c<b.length;c++){var d=b[c];h(d);d.getEntries().forEach(function(a){h(a);a=a.getGeogtran();h(a);a.getParameters().forEach(h);[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){h(a);var b=a.getDatum();h(b);h(b.getSpheroid());h(a.getPrimem());h(a.getUnit())})})}a._pe.PeGTlistExtendedEntry.prototype.Delete(b[0])}}})(a.PeGTlistExtendedEntry||(a.PeGTlistExtendedEntry={}));(function(c){c.geogToGeog=function(c,d,e,g,
h){a._pe.ensureCache.prepare();var k=f(e),m=e===k,k=a._pe.ensureFloat64(k),l=0;g&&(l=a._pe.ensureFloat64(g));(c=a._pe._pe_geog_to_geog(a._pe.getPointer(c),d,k,l,h))&&b(e,d,k,m);return c}})(a.PeGTTransformations||(a.PeGTTransformations={}));(function(c){function d(b,c,d,e,g,h){a._pe.ensureCache.prepare();var k,l;switch(b){case "dd":k=a._pe._pe_geog_to_dd;l=p.PE_DD_MAX;break;case "ddm":k=a._pe._pe_geog_to_ddm;l=p.PE_DDM_MAX;break;case "dms":k=a._pe._pe_geog_to_dms,l=p.PE_DMS_MAX}b=0;c&&(b=a._pe.getPointer(c));
c=f(e);c=a._pe.ensureFloat64(c);l=m(d,l);e=a._pe.ensureInt32(l);if(g=k(b,d,c,g,e))for(k=0;k<d;k++)h[k]=a._pe.UTF8ToString(l[k]);return g}function e(c,d,e,f,g){a._pe.ensureCache.prepare();var h;switch(c){case "dd":h=a._pe._pe_dd_to_geog;break;case "ddm":h=a._pe._pe_ddm_to_geog;break;case "dms":h=a._pe._pe_dms_to_geog}c=0;d&&(c=a._pe.getPointer(d));d=f.map(function(b){return a._pe.ensureString(b)});f=a._pe.ensureInt32(d);d=a._pe.ensureFloat64(Array(2*e));(h=h(c,e,f,d))&&b(g,e,d);return h}c.geog_to_dms=
function(a,b,c,e,f){return d("dms",a,b,c,e,f)};c.dms_to_geog=function(a,b,c,d){return e("dms",a,b,c,d)};c.geog_to_ddm=function(a,b,c,e,f){return d("ddm",a,b,c,e,f)};c.ddm_to_geog=function(a,b,c,d){return e("ddm",a,b,c,d)};c.geog_to_dd=function(a,b,c,e,f){return d("dd",a,b,c,e,f)};c.dd_to_geog=function(a,b,c,d){return e("dd",a,b,c,d)}})(a.PeNotationDms||(a.PeNotationDms={}));var u;(function(c){c.init=function(){c.PE_MGRS_STYLE_NEW=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;c.PE_MGRS_STYLE_OLD=
a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;c.PE_MGRS_STYLE_AUTO=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;c.PE_MGRS_180_ZONE_1_PLUS=a._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;c.PE_MGRS_ADD_SPACES=a._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};c.geog_to_mgrs_extended=function(b,c,d,e,g,h,k){a._pe.ensureCache.prepare();var l=0;b&&(l=a._pe.getPointer(b));b=f(d);d=a._pe.ensureFloat64(b);b=m(c,p.PE_MGRS_MAX);var n=a._pe.ensureInt32(b);if(e=a._pe._pe_geog_to_mgrs_extended(l,
c,d,e,g,h,n))for(g=0;g<c;g++)k[g]=a._pe.UTF8ToString(b[g]);return e};c.mgrs_to_geog_extended=function(c,d,e,f,g){a._pe.ensureCache.prepare();var h=0;c&&(h=a._pe.getPointer(c));c=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(c);c=a._pe.ensureFloat64(Array(2*d));(f=a._pe._pe_mgrs_to_geog_extended(h,d,e,f,c))&&b(g,d,c);return f}})(u=a.PeNotationMgrs||(a.PeNotationMgrs={}));(function(c){c.geog_to_usng=function(b,c,d,e,g,h,k){a._pe.ensureCache.prepare();var l=0;b&&(l=a._pe.getPointer(b));
b=f(d);d=a._pe.ensureFloat64(b);b=m(c,p.PE_MGRS_MAX);var n=a._pe.ensureInt32(b);if(e=a._pe._pe_geog_to_usng(l,c,d,e,g,h,n))for(g=0;g<c;g++)k[g]=a._pe.UTF8ToString(b[g]);return e};c.usng_to_geog=function(c,d,e,f){a._pe.ensureCache.prepare();var g=0;c&&(g=a._pe.getPointer(c));c=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(c);c=a._pe.ensureFloat64(Array(2*d));(g=a._pe._pe_usng_to_geog(g,d,e,c))&&b(f,d,c);return g}})(a.PeNotationUsng||(a.PeNotationUsng={}));var r;(function(c){c.init=
function(){c.PE_UTM_OPTS_NONE=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;c.PE_UTM_OPTS_ADD_SPACES=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;c.PE_UTM_OPTS_NS=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};c.geog_to_utm=function(b,c,d,e,g){a._pe.ensureCache.prepare();var h=0;b&&(h=a._pe.getPointer(b));b=f(d);d=a._pe.ensureFloat64(b);b=m(c,p.PE_UTM_MAX);var k=a._pe.ensureInt32(b);if(e=a._pe._pe_geog_to_utm(h,c,d,e,k))for(h=0;h<c;h++)g[h]=a._pe.UTF8ToString(b[h]);return e};c.utm_to_geog=
function(c,d,e,f,g){a._pe.ensureCache.prepare();var h=0;c&&(h=a._pe.getPointer(c));c=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(c);c=a._pe.ensureFloat64(Array(2*d));(f=a._pe._pe_utm_to_geog(h,d,e,f,c))&&b(g,d,c);return f}})(r=a.PeNotationUtm||(a.PeNotationUtm={}));var q;(function(b){var c=new Map;b.init=function(){b.PE_PCSINFO_OPTION_NONE=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;b.PE_PCSINFO_OPTION_DOMAIN=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;b.PE_POLE_OUTSIDE_BOUNDARY=
a._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;b.PE_POLE_POINT=a._pe.PePCSInfo.prototype.PE_POLE_POINT};b.generate=function(d,e){void 0===e&&(e=b.PE_PCSINFO_OPTION_DOMAIN);var f,g;c.has(d)&&(g=c.get(d),g[e]&&(f=g[e]));f||(f=a._pe.PePCSInfo.prototype.generate(d,e),g||(g=[],c.set(d,g)),g[e]=f);return f}})(q=a.PePCSInfo||(a.PePCSInfo={}));(function(b){b.version_string=function(){return a._pe.PeVersion.prototype.version_string()}})(a.PeVersion||(a.PeVersion={}));a._init=c})},"esri/geometry/support/GeographicTransformation":function(){define(["require",
"exports","./GeographicTransformationStep"],function(n,a,d){return function(){function a(a){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(a&&a.steps){var e=0;for(a=a.steps;e<a.length;e++){var c=a[e];c instanceof d?this.steps.push(c):this.steps.push(new d({wkid:c.wkid,wkt:c.wkt,isInverse:c.isInverse}))}}}a.cacheKey=function(a,d){return[void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():"",void 0!==d.wkid&&null!==d.wkid?
d.wkid.toString():"-1",void 0!==d.wkt&&null!==d.wkt?d.wkt.toString():""].join()};a.fromGE=function(k){var e=new a,c="",h=0;for(k=k.steps;h<k.length;h++){var m=d.fromGE(k[h]);e.steps.push(m);c+=m.uid.toString()+","}e._cached_projection={};e._gtlistentry=null;e._chain=c;return e};a.prototype.getInverse=function(){var d=new a;d.steps=[];for(var e=this.steps.length-1;0<=e;e--)d.steps.push(this.steps[e].getInverse());return d};a.prototype.getGTListEntry=function(){for(var a="",d=0,c=this.steps;d<c.length;d++)a+=
c[d].uid.toString()+",";a!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=a);return this._gtlistentry};a.prototype.assignCachedGe=function(d,e,c){this._cached_projection[a.cacheKey(d,e)]=c};a.prototype.getCachedGeTransformation=function(d,e){for(var c="",h=0,k=this.steps;h<k.length;h++)c+=k[h].uid.toString()+",";c!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=c);d=this._cached_projection[a.cacheKey(d,e)];return void 0===d?null:d};return a}()})},
"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(n,a){var d=0;return function(){function a(a){void 0===a&&(a=null);this.uid=d++;a?(this._wkt=void 0!==a.wkt?a.wkt:null,this._wkid=void 0!==a.wkid?a.wkid:-1,this._isInverse=void 0!==a.isInverse?!0===a.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}a.fromGE=function(d){var e=new a;e._wkt=d.wkt;e._wkid=d.wkid;e._isInverse=d.isInverse;return e};Object.defineProperty(a.prototype,"wkt",
{get:function(){return this._wkt},set:function(a){this._wkt=a;this.uid=d++},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"wkid",{get:function(){return this._wkid},set:function(a){this._wkid=a;this.uid=d++},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isInverse",{get:function(){return this._isInverse},set:function(a){this._isInverse=a;this.uid=d++},enumerable:!1,configurable:!0});a.prototype.getInverse=function(){var d=new a;d._wkt=this.wkt;d._wkid=this._wkid;
d._isInverse=!this.isInverse;return d};return a}()})},"esri/geometry/geometryAdapters/json":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.jsonAdapter=void 0;a.jsonAdapter={convertToGEGeometry:function(a,c){return null==c?null:a.convertJSONToGeometry(c)},exportPoint:function(a,c,e){e=new d(a.getPointX(c),a.getPointY(c),e);var b=a.hasZ(c),f=a.hasM(c);b&&(e.z=a.getPointZ(c));f&&(e.m=a.getPointM(c));return e},exportPolygon:function(a,c,d){return new l(a.exportPaths(c),
d,a.hasZ(c),a.hasM(c))},exportPolyline:function(a,c,d){return new k(a.exportPaths(c),d,a.hasZ(c),a.hasM(c))},exportMultipoint:function(a,c,d){return new e(a.exportPoints(c),d,a.hasZ(c),a.hasM(c))},exportExtent:function(a,d,e){var b=a.hasZ(d),f=a.hasM(d);e=new c(a.getXMin(d),a.getYMin(d),a.getXMax(d),a.getYMax(d),e);b&&(b=a.getZExtent(d),e.zmin=b.vmin,e.zmax=b.vmax);f&&(a=a.getMExtent(d),e.mmin=a.vmin,e.mmax=a.vmax);return e}};var d=function(){return function(a,c,d){this.x=a;this.y=c;this.spatialReference=
d;this.m=this.z=void 0}}(),l=function(){return function(a,c,d,b){this.rings=a;this.spatialReference=c;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);b&&(this.hasM=b)}}(),k=function(){return function(a,c,d,b){this.paths=a;this.spatialReference=c;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);b&&(this.hasM=b)}}(),e=function(){return function(a,c,d,b){this.points=a;this.spatialReference=c;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);b&&(this.hasM=b)}}(),c=function(){return function(a,c,d,b,e){this.xmin=a;this.ymin=
c;this.xmax=d;this.ymax=b;this.spatialReference=e;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}()})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.queryCapabilities=void 0;a.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,
supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports tslib ../../../core/MapUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/SetUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){function r(a){return a.substr(24,12)+a.substr(19,4)+a.substr(16,2)+a.substr(14,2)+a.substr(11,2)+a.substr(9,2)+a.substr(6,2)+a.substr(4,2)+a.substr(2,2)+a.substr(0,2)}function q(a,b,c,d){if(c&&"esriFieldTypeDate"===c.type){var e=(new Date(a)).getTime(),f=(new Date(b)).getTime();if(!isNaN(e)&&!isNaN(f))return d?f-e:e-f}return"number"===typeof a&&"number"===typeof b?d?b-a:a-b:"string"===typeof a&&"string"===typeof b?(e=a.toUpperCase(),f=b.toUpperCase(),!c||"esriFieldTypeGUID"!==
c.type&&"esriFieldTypeGlobalID"!==c.type?d=(d?e>f:e<f)?-1:(d?e<f:e>f)?1:0:(a=r(e),f=r(f),d=(d?a>f:a<f)?-1:(d?a<f:a>f)?1:0),d):d?1:-1}Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,b,c){this.items=a;this.queryGeometry=b;this.definitionExpression=c.definitionExpression;this.geometryType=c.geometryType;this.hasM=c.hasM;this.hasZ=c.hasZ;this.objectIdField=c.objectIdField;this.spatialReference=c.spatialReference;this.fieldsIndex=c.fieldsIndex;this.timeInfo=c.timeInfo;this.featureAdapter=
c.featureAdapter}Object.defineProperty(a.prototype,"size",{get:function(){return this.items.length},enumerable:!1,configurable:!0});a.prototype.createQueryResponseForCount=function(a){var c=new b.default(a,this.featureAdapter,this.fieldsIndex);if(!a.outStatistics)return c.countDistinctValues(this.items);var d=a.groupByFieldsForStatistics,e=a.having;if(null===d||void 0===d||!d.length)return 1;var f=new Map,g=new Map,h=new Set,k=0;for(a=a.outStatistics;k<a.length;k++){var m=a[k],m="exceedslimit"!==
m.statisticType?m.onStatisticField:void 0;if(!g.has(m)){for(var l=[],n=0,p=d;n<p.length;n++){var r=this._getAttributeValues(c,p[n],f);l.push(r)}g.set(m,this._calculateUniqueValues(l))}var m=g.get(m),q;for(q in m)n=m[q],l=n.items,n=n.data.join(","),e&&!c.validateItems(l,e)||h.add(n)}return h.size};a.prototype.createQueryResponse=function(a){var b;b=a.outStatistics?a.outStatistics.some(function(a){return"exceedslimit"===a.statisticType})?this._createExceedsLimitQueryResponse(a):this._createStatisticsQueryResponse(a):
this._createFeatureQueryResponse(a);a.returnQueryGeometry&&(m.isValid(a.outSR)&&!m.equals(this.queryGeometry.spatialReference,a.outSR)?b.queryGeometry=u.cleanFromGeometryEngine(d.__assign({spatialReference:a.outSR},p.project(this.queryGeometry,this.queryGeometry.spatialReference,a.outSR))):b.queryGeometry=u.cleanFromGeometryEngine(d.__assign({spatialReference:a.outSR},this.queryGeometry)));return b};a.prototype.executeAttributesQuery=function(b){var c=g.getWhereClause(b.where,this.fieldsIndex);if(!c)return e.resolve(this);
if(c.isStandardized){for(var d=0,f=[],h=0,k=this.items;h<k.length;h++){var m=k[h];c.testFeature(m,this.featureAdapter)&&(f[d++]=m)}c=new a(f,this.queryGeometry,this);c.definitionExpression=b.where;return e.resolve(c)}return e.reject(new TypeError("Where clause is not standardized"))};a.prototype.executeObjectIdsQuery=function(b){if(!b.objectIds||!b.objectIds.length)return e.resolve(this);var d=c.SetFromValues(b.objectIds),f=this.featureAdapter.getObjectId;return e.resolve(new a(this.items.filter(function(a){return d.has(f(a))}),
this.queryGeometry,this))};a.prototype.executeTimeQuery=function(b){b=t.getTimeOperator(this.timeInfo,b.timeExtent,this.featureAdapter);if(!k.isSome(b))return e.resolve(this);b=this.items.filter(b);return e.resolve(new a(b,this.queryGeometry,this))};a.prototype.filterLatest=function(){for(var b=this.timeInfo,c=b.trackIdField,d=b.startTimeField,b=b.endTimeField||d,d=new Map,f=this.featureAdapter.getAttribute,g=0,h=this.items;g<h.length;g++){var k=h[g],m=f(k,c),n=f(k,b),p=d.get(m);(!p||n>f(p,b))&&d.set(m,
k)}c=l.valuesOfMap(d);return e.resolve(new a(c,this.queryGeometry,this))};a.prototype.project=function(b){return d.__awaiter(this,void 0,void 0,function(){var c,e,g,h=this;return d.__generator(this,function(d){switch(d.label){case 0:if(!b||m.equals(this.spatialReference,b))return[2,this];c=this.featureAdapter;return[4,p.projectMany(this.items.map(function(a){return u.getGeometry(h.geometryType,h.hasZ,h.hasM,c.getGeometry(a))}),this.spatialReference,b)];case 1:return e=d.sent(),g=e.map(function(a,
b){return c.cloneWithGeometry(h.items[b],f.convertFromGeometry(a,h.hasZ,h.hasM))}),[2,new a(g,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:b,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}})})};a.prototype._sortFeatures=function(a,b,c){if(1<a.length&&b&&b.length){var d=function(b){b=b.split(" ");var d=b[0],f=e.fieldsIndex.get(d),
g=b[1]&&"desc"===b[1].toLowerCase();a.sort(function(a,b){a=c(a,d,f);b=c(b,d,f);return q(a,b,f,g)})},e=this,f=0;for(b=b.reverse();f<b.length;f++)d(b[f])}};a.prototype._createFeatureQueryResponse=function(a){var b=this,c=this.items,e=this.geometryType,f=this.hasM,g=this.hasZ,k=this.objectIdField,m=this.spatialReference,l=a.outFields,n=a.outSR,p=a.quantizationParameters,r=a.resultRecordCount,q=a.resultOffset,t=a.returnZ,w=a.returnM,r=null!=r?c.length>(q||0)+r:!1,l=l&&(-1<l.indexOf("*")?d.__spreadArrays(this.fieldsIndex.fields):
l.map(function(a){return b.fieldsIndex.get(a)}));return{exceededTransferLimit:r,features:this._createFeatures(a,c),fields:l,geometryType:e,hasM:f&&w,hasZ:g&&t,objectIdFieldName:k,spatialReference:u.cleanFromGeometryEngine(n?n:m),transform:p&&h.toQuantizationTransform(p)||null}};a.prototype._createFeatures=function(a,c){var e=new b.default(a,this.featureAdapter,this.fieldsIndex),f=a.orderByFields,g=a.quantizationParameters,k=a.returnGeometry,m=a.returnCentroid,l=a.maxAllowableOffset,n=a.resultOffset,
p=a.resultRecordCount,r=a.returnZ;a=a.returnM;var q=this.hasZ&&(void 0===r?!1:r),t=this.hasM&&(void 0===a?!1:a),r=[];a=0;c=d.__spreadArrays(c);this._sortFeatures(c,f,function(a,b,c){return e.getFieldValue(a,b,c)});if(k||m)if(f=h.toQuantizationTransform(g),k&&!m)for(m=0;m<c.length;m++)k=c[m],r[a++]={attributes:e.getAttributes(k),geometry:u.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(k),l,f,q,t)};else if(!k&&m)for(l=0;l<c.length;l++)k=c[l],r[a++]={attributes:e.getAttributes(k),
centroid:u.transformCentroid(this,this.featureAdapter.getCentroid(k,this),f)};else for(m=0;m<c.length;m++)k=c[m],r[a++]={attributes:e.getAttributes(k),centroid:u.transformCentroid(this,this.featureAdapter.getCentroid(k,this),f),geometry:u.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(k),l,f,q,t)};else for(l=0;l<c.length;l++)k=c[l],(q=e.getAttributes(k))&&(r[a++]={attributes:q});n=n||0;null!=p&&(r=r.slice(n,Math.min(r.length,n+p)));return r};a.prototype._createExceedsLimitQueryResponse=
function(a){var b=!1,c=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,e=0;for(a=a.outStatistics;e<a.length;e++){var f=a[e];if("exceedslimit"===f.statisticType){c=null!=f.maxPointCount?f.maxPointCount:Number.POSITIVE_INFINITY;d=null!=f.maxRecordCount?f.maxRecordCount:Number.POSITIVE_INFINITY;b=null!=f.maxVertexCount?f.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)b=this.items.length>c;else if(this.items.length>d)b=!0;else var c=
this.hasZ?this.hasM?4:3:this.hasM?3:2,g=this.featureAdapter,b=this.items.reduce(function(a,b){b=g.getGeometry(b);return a+(b&&b.coords.length||0)},0)/c>b;return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(b)}}]}};a.prototype._createStatisticsQueryResponse=function(a){var c=this,d={attributes:{}},e=[],f=new Map,g=new Map,h=new Map,k=new Map,m=new b.default(a,this.featureAdapter,
this.fieldsIndex),n=a.outStatistics,p=a.groupByFieldsForStatistics,r=a.having;a=a.orderByFields;for(var q=p&&p.length,t=!!q,u=t&&p[0],w=t&&!this.fieldsIndex.get(u),v=0;v<n.length;v++){var O=n[v],N=O.outStatisticFieldName,S=O.statisticType,P=O,U="exceedslimit"!==S?O.onStatisticField:void 0,Z="percentile_disc"===S||"percentile_cont"===S,V=t&&1===q&&(U===u||w)&&"count"===S;if(t){if(!h.has(U)){for(var O=[],S=0,T=p;S<T.length;S++){var Y=this._getAttributeValues(m,T[S],f);O.push(Y)}h.set(U,this._calculateUniqueValues(O))}var X=
h.get(U),O=function(a){var b=X[a];a=b.count;var d=b.data,e=b.items,g=b.itemPositions,b=d.join(",");if(!r||m.validateItems(e,r)){var h=k.get(b)||{attributes:{}},e=null;if(V)e=a;else{var l=ca._getAttributeValues(m,U,f);a=g.map(function(a){return l[a]});e=Z&&"statisticParameters"in P?ca._getPercentileValue(P,a):ca._getStatisticValue(P,a)}h.attributes[N]=e;p.forEach(function(a,b){return h.attributes[c.fieldsIndex.get(a)?a:"EXPR_"+(b+1)]=d[b]});k.set(b,h)}},ca=this,ba;for(ba in X)O(ba)}else Y=this._getAttributeValues(m,
U,f),d.attributes[N]=Z&&"statisticParameters"in P?this._getPercentileValue(P,Y):this._getStatisticValue(P,Y,g);e.push({name:N,alias:N,type:"esriFieldTypeDouble"})}d=t?l.valuesOfMap(k):[d];this._sortFeatures(d,a,function(a,b){return a.attributes[b]});return{fields:e,features:d}};a.prototype._getStatisticValue=function(a,b,c){var d=a.onStatisticField;a=a.statisticType;b=c&&c.has(d)?c.get(d):this._calculateStatistics(b);c&&c.set(d,b);return b["var"===a?"variance":a]};a.prototype._getPercentileValue=
function(a,b){var c=a.statisticParameters,e=a.statisticType,f=c.value,g="desc"===c.orderBy,h=this.fieldsIndex.get(a.onStatisticField);a=d.__spreadArrays(b).filter(function(a){return null!=a}).sort(function(a,b){return q(a,b,h,g)});return this._calculatePercentile(a,f,"percentile_disc"===e)};a.prototype._getAttributeValues=function(a,b,c){if(c.has(b))return c.get(b);var d=this.fieldsIndex.get(b),e=this.items.map(function(c){return a.getFieldValue(c,b,d)});c.set(b,e);return e};a.prototype._calculateStatistics=
function(a){for(var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=null,e=null,f=null,g=null,h=[],k=0,m=0;m<a.length;m++){var l=a[m];"string"===typeof l?k++:null==l||isNaN(l)||(d+=l,b=Math.min(b,l),c=Math.max(c,l),h.push(l),k++)}if(k){e=d/k;for(f=a=0;f<h.length;f++)l=h[f],a+=Math.pow(l-e,2);g=1<k?a/(k-1):0;f=Math.sqrt(g)}else c=b=null;return{avg:e,count:k,max:c,min:b,stddev:f,sum:d,variance:g}};a.prototype._calculateUniqueValues=function(a){for(var b={},c=this.items,d=c.length,e=0;e<d;e++){for(var f=
c[e],g=[],h=0,k=a;h<k.length;h++)g.push(k[h][e]);h=g.join(",");null==b[h]?b[h]={count:1,data:g,items:[f],itemPositions:[e]}:(b[h].count++,b[h].items.push(f),b[h].itemPositions.push(e))}return b};a.prototype._calculatePercentile=function(a,b,c){if(0===a.length)return null;if(0>=b)return a[0];if(1<=b)return a[a.length-1];var d=(a.length-1)*b,e=Math.floor(d);b=e+1;var d=d%1,e=a[e],f=a[b];return b>=a.length||c||"string"===typeof e||"string"===typeof f?e:e*(1-d)+f*d};return a}();a.default=n})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["require",
"exports","../../../core/maybe","./attributeSupport"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,c,d){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=a.returnDistinctValues;this.fieldsIndex=d;this.featureAdapter=c;if((a=a.outFields)&&-1===a.indexOf("*")){this.outFields=a;for(var e=c=0;e<a.length;e++){var f=a[e],b=l.getExpressionFromFieldName(f),g=this.fieldsIndex.get(b),b=g?null:l.getWhereClause(b,d),g=g?g.name:
l.getAliasFromFieldName(f)||"FIELD_EXP_"+c++;this._fieldDataCache.set(f,{alias:g,clause:b})}}}a.prototype.countDistinctValues=function(a){var c=this;if(!this.returnDistinctValues)return a.length;a.forEach(function(a){return c.getAttributes(a)});return this._returnDistinctMap.size};a.prototype.getAttributes=function(a){a=this._processAttributesForOutFields(a);return this._processAttributesForDistinctValues(a)};a.prototype.getFieldValue=function(a,c,d){var e=d?d.name:c,f=null;this._fieldDataCache.has(e)?
f=this._fieldDataCache.get(e).clause:d||(f=l.getWhereClause(c,this.fieldsIndex),this._fieldDataCache.set(e,{alias:e,clause:f}));return d?this.featureAdapter.getAttribute(a,e):f.calculateValue(a,this.featureAdapter)};a.prototype.validateItem=function(a,c){this._fieldDataCache.has(c)||this._fieldDataCache.set(c,{alias:c,clause:l.getWhereClause(c,this.fieldsIndex)});return this._fieldDataCache.get(c).clause.testFeature(a,this.featureAdapter)};a.prototype.validateItems=function(a,c){this._fieldDataCache.has(c)||
this._fieldDataCache.set(c,{alias:c,clause:l.getWhereClause(c,this.fieldsIndex)});return this._fieldDataCache.get(c).clause.testSet(a,this.featureAdapter)};a.prototype._processAttributesForOutFields=function(a){var c=this.outFields;if(!c||!c.length)return this.featureAdapter.getAttributes(a);for(var d={},e=0;e<c.length;e++){var f=this._fieldDataCache.get(c[e]),b=f.alias,f=f.clause;d[b]=f?f.calculateValue(a,this.featureAdapter):this.featureAdapter.getAttribute(a,b)}return d};a.prototype._processAttributesForDistinctValues=
function(a){if(d.isNone(a)||!this.returnDistinctValues)return a;var c=this.outFields,e=[];if(c)for(var k=0;k<c.length;k++){var f=this._fieldDataCache.get(c[k]).alias;e.push(a[f])}else for(f in a)e.push(a[f]);c=(c||["*"]).join(",")+"\x3d"+e.join(",");e=this._returnDistinctMap.get(c)||0;this._returnDistinctMap.set(c,++e);return 1<e?null:a};return a}();a.default=n})},"esri/layers/graphics/data/timeSupport":function(){define(["require","exports"],function(n,a){function d(a,c,d,k,f){if(null!=k&&null!=
f)return function(b){var e=a.getAttribute(b,c);b=a.getAttribute(b,d);return(null==e||e<=f)&&(null==b||b>=k)};if(null!=k)return function(b){b=a.getAttribute(b,d);return null==b||b>=k};if(null!=f)return function(b){b=a.getAttribute(b,c);return null==b||b<=f}}function l(a,c,d,k){if(null!=d&&null!=k&&d===k)return function(e){return a.getAttribute(e,c)===d};if(null!=d&&null!=k)return function(e){e=a.getAttribute(e,c);return e>=d&&e<=k};if(null!=d)return function(e){return a.getAttribute(e,c)>=d};if(null!=
k)return function(d){return a.getAttribute(d,c)<=k}}function k(){return function(){return!1}}Object.defineProperty(a,"__esModule",{value:!0});a.getTimeOperator=a.getTimeExtent=void 0;a.getTimeExtent=function(a,c){if(!a)return null;var d=c.featureAdapter,e=a.startTimeField,f=a.endTimeField,b=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;if(e&&f)c.forEach(function(a){var c=d.getAttribute(a,e);a=d.getAttribute(a,f);null==c||isNaN(c)||(b=Math.min(b,c));null==a||isNaN(a)||(g=Math.max(g,a))});else{var k=
e||f;c.forEach(function(a){a=d.getAttribute(a,k);null==a||isNaN(a)||(b=Math.min(b,a),g=Math.max(g,a))})}return{start:b,end:g}};a.getTimeOperator=function(a,c,h){if(!c||!a)return null;var e=a.startTimeField;a=a.endTimeField;if(!e&&!a)return null;var f=c.start;c=c.end;return null===f&&null===c?null:void 0===f&&void 0===c?k():e&&a?d(h,e,a,f,c):l(h,e||a,f,c)}})},"esri/layers/graphics/data/utils":function(){define("require exports tslib ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u){function r(a,b,c,d,e){void 0===d&&(d=a.hasZ);void 0===e&&(e=a.hasM);var f=a.hasZ&&d,h=a.hasM&&e;return c?(a=g.quantizeOptimizedGeometry(B,b,a.hasZ,a.hasM,"esriGeometryPoint",c,d,e),g.convertToPoint(a,f,h)):g.convertToPoint(b,f,h)}function q(b,e,f){return d.__awaiter(this,void 0,void 0,function(){var g,l,n,p,r,q;return d.__generator(this,function(d){switch(d.label){case 0:if(!b)return[2,null];g=b.where;b.where=g=g&&g.trim();if(!g||/^1 *= *1$/.test(g)||e&&e===
g)b.where=null;return b.geometry?[4,v(b)]:[2,b];case 1:return l=d.sent(),b.distance=0,b.units=null,"esriSpatialRelEnvelopeIntersects"===b.spatialRel&&(n=b.geometry.spatialReference,l=c.getGeometryExtent(l),l.spatialReference=n),b.geometry=l,[4,t.checkProjectionSupport(l.spatialReference,f)];case 2:return d.sent(),[4,m.normalizeCentralMeridian(h.fromJSON(l))];case 3:p=d.sent()[0];if(k.isNone(p))throw a.QUERY_ENGINE_EMPTY_RESULT;r=p.toJSON();return[4,t.project(r,r.spatialReference,f)];case 4:q=d.sent();
if(!q)throw a.QUERY_ENGINE_EMPTY_RESULT;q.spatialReference=f;b.geometry=q;return[2,b]}})})}function v(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,g,h,k,m,l,n,p;return d.__generator(this,function(d){switch(d.label){case 0:b=a.geometry;c=a.distance;g=a.units;if(null==c||"vertexAttributes"in b)return[2,b];h=b.spatialReference;k=g?w.fromJSON(g):e.getUnitString(h);m=h&&(f.isGeographic(h)||f.isWebMercator(h));if(!m)return[3,1];n=b;return[3,3];case 1:return[4,t.checkProjectionSupport(h,f.WGS84).then(function(){return t.project(b,
f.WGS84)})];case 2:n=d.sent(),d.label=3;case 3:return l=n,[4,u.getGeodesicBufferOperator()];case 4:return p=d.sent(),[2,p(l.spatialReference,l,c,k)]}})})}Object.defineProperty(a,"__esModule",{value:!0});a.cleanFromGeometryEngine=a.normalizeQueryLike=a.normalizeFilter=a.normalizeQuery=a.getGeometry=a.getCentroid=a.transformCentroid=a.QUERY_ENGINE_EMPTY_RESULT=void 0;var w=new l.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",
esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});a.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var z=new p.default,x=new p.default,B=new p.default,A={esriGeometryPoint:g.convertToPoint,esriGeometryPolyline:g.convertToPolyline,esriGeometryPolygon:g.convertToPolygon,esriGeometryMultipoint:g.convertToMultipoint};a.transformCentroid=r;a.getCentroid=function(a,c,d){if("esriGeometryPolygon"!==a.geometryType||!c||!c.centroid&&!c.geometry)return null;c.centroid||(c.centroid=
b.getCentroidOptimizedGeometry(new p.default,c.geometry,a.hasZ,a.hasM));return r(a,c.centroid,d)};a.getGeometry=function(a,b,c,d,e,f,h,k){void 0===h&&(h=b);void 0===k&&(k=c);var m=b&&h,l=c&&k;d=d?"coords"in d?d:d.geometry:null;if(!d)return null;if(e)return b=g.generalizeOptimizedGeometry(x,d,b,c,a,e,h,k),f&&(b=g.quantizeOptimizedGeometry(B,b,m,l,a,f)),A[a](b,m,l);if(f)return b=g.quantizeOptimizedGeometry(B,d,b,c,a,f,h,k),A[a](b,m,l);g.removeZMValues(z,d,b,c,h,k);return A[a](z,m,l)};a.normalizeQuery=
function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var e,f,g,h,k;return d.__generator(this,function(d){e=a.outFields;f=a.orderByFields;g=a.groupByFieldsForStatistics;h=a.outStatistics;if(e)for(k=0;k<e.length;k++)e[k]=e[k].trim();if(f)for(k=0;k<f.length;k++)f[k]=f[k].trim();if(g)for(k=0;k<g.length;k++)g[k]=g[k].trim();if(h)for(k=0;k<h.length;k++)h[k].onStatisticField&&(h[k].onStatisticField=h[k].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return[2,
q(a,b,c)]})})};a.normalizeFilter=function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(d){return[2,q(a,b,c)]})})};a.normalizeQueryLike=q;a.cleanFromGeometryEngine=function(a){return a&&C in a?JSON.parse(JSON.stringify(a,E)):a};var C="_geVersion",E=function(a,b){return a!==C?b:void 0}})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports tslib ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){function u(){return new Promise(function(a,b){n(["../../../geometry/geometryEngineJSON"],a,b)})}Object.defineProperty(a,"__esModule",{value:!0});a.canQueryWithRBush=a.checkSpatialQuerySupport=a.getSpatialQueryOperator=a.getGeodesicBufferOperator=a.importGeometryEngine=void 0;var r={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",
esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},q={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},v={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,
esriGeometryPolygon:!0,esriGeometryEnvelope:!0},w={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};a.importGeometryEngine=u;a.getGeodesicBufferOperator=function(){return u().then(function(a){return a.geodesicBuffer})};a.getSpatialQueryOperator=function(a,d,m,l,n){if(h.isPolygon(d)&&"esriGeometryPoint"===m&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a)){var p=b.convertFromPolygon(new g.default,d,!1,!1);return k.resolve(function(a){return f.polygonContainsPoint(p,
!1,!1,a)})}if(h.isPolygon(d)&&"esriGeometryMultipoint"===m){var q=b.convertFromPolygon(new g.default,d,!1,!1);if("esriSpatialRelContains"===a)return k.resolve(function(a){return f.polygonContainsMultipoint(q,!1,!1,a,l,n)})}if(h.isExtent(d)&&"esriGeometryPoint"===m&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a))return k.resolve(function(a){return e.extentContainsPoint(d,t.getGeometry(m,l,n,a))});if(h.isExtent(d)&&"esriGeometryMultipoint"===m&&"esriSpatialRelContains"===a)return k.resolve(function(a){return e.extentContainsMultipoint(d,
t.getGeometry(m,l,n,a))});if(h.isExtent(d)&&"esriSpatialRelIntersects"===a){var v=c.getExtentIntersector(m);return k.resolve(function(a){return v(d,t.getGeometry(m,l,n,a))})}return u().then(function(b){var c=b[r[a]].bind(null,d.spatialReference,d);return function(a){return c(t.getGeometry(m,l,n,a))}})};a.checkSpatialQuerySupport=function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var e,f;return d.__generator(this,function(d){e=a.spatialRel;f=a.geometry;if(!f)return[2];if(!0!==q[e])throw new l("feature-store:unsupported-query",
"Unsupported query spatial relationship",{query:a});if(!m.isValid(f.spatialReference)||!m.isValid(c))return[2];if(!0!==v[h.getJsonType(f)])throw new l("feature-store:unsupported-query","Unsupported query geometry type",{query:a});if(!0!==w[b])throw new l("feature-store:unsupported-query","Unsupported layer geometry type",{query:a});return a.outSR?[2,p.checkProjectionSupport(a.geometry&&a.geometry.spatialReference,a.outSR)]:[2]})})};a.canQueryWithRBush=function(a){if(h.isExtent(a))return!0;if(h.isPolygon(a)){var b=
0;for(a=a.rings;b<a.length;b++){var c=a[b];if(5!==c.length||c[0][0]!==c[1][0]||c[0][0]!==c[4][0]||c[2][0]!==c[3][0]||c[0][1]!==c[3][1]||c[0][1]!==c[4][1]||c[1][1]!==c[2][1])return!1}return!0}return!1}})},"esri/layers/graphics/contains":function(){define(["require","exports"],function(n,a){function d(a,d,e,c,h){if(!a)return!1;d=d?e?4:3:e?3:2;e=a.coords;var k=!1,f=0,b=0;for(a=a.lengths;b<a.length;b++){for(var g=a[b],l=f,n=f,u=f+g*d;n<u;n+=d){l=n+d;l===u&&(l=f);var r=e[n],q=e[n+1],v=e[l],l=e[l+1];(q<
h&&l>=h||l<h&&q>=h)&&r+(h-q)/(l-q)*(v-r)<c&&(k=!k)}f+=g*d}return k}Object.defineProperty(a,"__esModule",{value:!0});a.polygonContainsCoords=a.polygonContainsMultipoint=a.polygonContainsPoint=void 0;a.polygonContainsPoint=function(a,k,e,c){return d(a,k,e,c.coords[0],c.coords[1])};a.polygonContainsMultipoint=function(a,k,e,c,h,m){h=h?m?4:3:m?3:2;m=c.coords;c=c.lengths;if(!c)return!1;for(var f=0,b=0;f<c.length;f++,b+=h)if(!d(a,k,e,m[b],m[b+1]))return!1;return!0};a.polygonContainsCoords=d})},"esri/views/layers/support/FeatureFilter":function(){define("require exports tslib ../../../geometry ../../../TimeExtent ../../../core/jsonMap ../../../core/JSONSupport ../../../core/lang ../../../core/SetUtils ../../../core/accessorSupport/decorators ../../../geometry/support/jsonUtils ../../../tasks/support/Query".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){var p=new e.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),t=new e.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(a){function c(b){b=a.call(this,b)||this;b.where=null;b.geometry=null;b.spatialRelationship="intersects";b.hiddenIds=new Set;b.distance=void 0;b.objectIds=null;b.units=null;b.timeExtent=null;b.enabled=!1;return b}d.__extends(c,a);e=c;c.prototype.writeWhere=function(a,b){b.where=a||"1\x3d1"};c.prototype.enable=function(){this._set("enabled",!0)};
c.prototype.createQuery=function(a){void 0===a&&(a={});var b=this.where,c=this.spatialRelationship,e=this.timeExtent,f=this.objectIds,k=this.units,m=this.distance;return new g(d.__assign({geometry:h.clone(this.geometry),objectIds:h.clone(f),spatialRelationship:c,timeExtent:h.clone(e),where:b,units:k,distance:m},a))};c.prototype.clone=function(){var a=this.where,b=this.geometry,c=this.spatialRelationship,d=this.hiddenIds,f=this.timeExtent,g=this.objectIds,k=this.units,m=this.distance,l=new Set;d.forEach(function(a){return l.add(a)});
return new e({geometry:h.clone(b),hiddenIds:l,objectIds:h.clone(g),spatialRelationship:c,timeExtent:h.clone(f),where:a,units:k,distance:m})};var e;d.__decorate([f.property({type:String})],c.prototype,"where",void 0);d.__decorate([f.writer("where")],c.prototype,"writeWhere",null);d.__decorate([f.property({types:l.geometryTypes,json:{read:b.fromJSON,write:!0}})],c.prototype,"geometry",void 0);d.__decorate([f.property({type:String,json:{read:{source:"spatialRel",reader:p.read},write:{target:"spatialRel",
writer:p.write}}})],c.prototype,"spatialRelationship",void 0);d.__decorate([f.property({json:{write:function(a,b,c){return b[c]=m.valuesOfSet(a)},read:function(a){return m.SetFromValues(a)}}})],c.prototype,"hiddenIds",void 0);d.__decorate([f.property({type:Number,json:{write:{overridePolicy:function(a){return{enabled:0<a}}}}})],c.prototype,"distance",void 0);d.__decorate([f.property({type:[Number],json:{write:!0}})],c.prototype,"objectIds",void 0);d.__decorate([f.property({type:String,json:{read:t.read,
write:{writer:t.write,overridePolicy:function(a){return{enabled:a&&0<this.distance}}}}})],c.prototype,"units",void 0);d.__decorate([f.property({type:k,json:{write:!0}})],c.prototype,"timeExtent",void 0);d.__decorate([f.property({readOnly:!0})],c.prototype,"enabled",void 0);return c=e=d.__decorate([f.subclass("esri.views.layers.support.FeatureFilter")],c)}(c.JSONSupport)})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/geodesicConstants ../../support/FrustumExtentIntersection ../../../support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f){var b=-.3*h.earthRadius;return function(a){function g(){var b=null!==a&&a.apply(this,arguments)||this;b.suspended=!1;b.extent=null;b.extentIntersectionDirty=!0;b._isVisibleBelowSurface=!1;b.handles=new k;b.layerView=null;b.updating=!0;return b}d.__extends(g,a);g.prototype.setup=function(a){var b=this;this.layerView=a;this.extentIntersection=new m.FrustumExtentIntersection({renderCoordsHelper:a.view.renderCoordsHelper});a=a.view;var c=a.basemapTerrain,d=a.resourceController.scheduler;
this.handles.add([a.on("resize",function(){return b.viewChange()}),a.state.watch("camera",function(){return b.viewChange()},!0),d.registerTask(f.Task.FRUSTUM_VISIBILITY,function(){return b.update()},function(){return b.updating}),c.on("elevation-bounds-change",function(){return b.elevationBoundsChange()})]);"local"===a.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([e.init(c,["opacity","wireframe"],function(){return b.updateIsVisibleBelowSurface()}),e.init(a,"map.ground.navigationConstraint.type",
function(){return b.updateIsVisibleBelowSurface()})])};g.prototype.destroy=function(){this.extentIntersection=this.extent=this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};g.prototype._setDirty=function(){this.updating||this._set("updating",!0)};g.prototype.setExtent=function(a){this.extent=a;this.extentIntersectionDirty=!0;this._setDirty()};g.prototype.viewChange=function(){this._setDirty()};g.prototype.elevationBoundsChange=function(){this._setDirty();this.extentIntersectionDirty=
!0};Object.defineProperty(g.prototype,"isVisibleBelowSurface",{set:function(a){this._isVisibleBelowSurface=a;this._setDirty();this.extentIntersectionDirty=!0},enumerable:!1,configurable:!0});g.prototype.updateIsVisibleBelowSurface=function(){var a=this.layerView.view,b=a.basemapTerrain,c=a.map.ground&&a.map.ground.navigationConstraint&&"none"===a.map.ground.navigationConstraint.type;this.isVisibleBelowSurface="local"===a.viewingMode||!b.isOpaque()||c};g.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=
!1;var a=this.layerView.view,c;if(this._isVisibleBelowSurface)c=b;else{c=a.basemapTerrain.elevationBounds;var d=c.min;c=d-Math.max(1,(c.max-d)*(1.2-1))}this.extentIntersection.update(this.extent,a.spatialReference,c)}};g.prototype.update=function(){this._set("updating",!1);this.extent?(this.updateExtentIntersection(),this._set("suspended",!this.extentIntersection.isVisibleInFrustum(this.layerView.view.frustum))):this._set("suspended",!1)};d.__decorate([c.property({readOnly:!0})],g.prototype,"suspended",
void 0);d.__decorate([c.property({readOnly:!0})],g.prototype,"updating",void 0);return g=d.__decorate([c.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],g)}(l)})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["require","exports","./Graphics3DObjectStateSet"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.Graphics3DObjectStates=void 0;n=function(){function a(a){this._graphicsCore=a;this._stateSets=[]}a.prototype.destroy=function(){this._stateSets&&
this._stateSets.forEach(function(a){return a.objectStateSet.removeAll()});this._stateSets=null};a.prototype.acquireSet=function(a,e){var c=this,h=new d.Graphics3DObjectStateSet(a,e);this._stateSets.push(h);return{set:h,handle:{remove:function(){return c.releaseSet(h)},pause:function(){h.objectStateSet.removeAll();h.paused=!0},resume:function(){h.paused=!1;c.initializeSet(h)}}}};a.prototype.releaseSet=function(a){a.objectStateSet.removeAll();a=this._stateSets?this._stateSets.indexOf(a):-1;-1!==a&&
this._stateSets.splice(a,1)};a.prototype._addObjectStateSet=function(a,d){a.addObjectStateSet(d.stateType,d.objectStateSet)};a.prototype._removeObjectStateSet=function(a,d){a.removeObjectState(d.objectStateSet)};a.prototype.setUid=function(a,d){a.ids.add(d);(d=this._graphicsCore.graphics3DGraphics.get(d))&&this._addObjectStateSet(d,a)};a.prototype.setUids=function(a,d){var c=this;d.forEach(function(d){return c.setUid(a,d)})};a.prototype.setObjectIds=function(a,d){d.forEach(function(c){return a.ids.add(c)});
this.initializeSet(a)};a.prototype.addGraphic=function(a){var d=this;this._stateSets.forEach(function(c){!c.paused&&c.hasGraphic(a)&&d._addObjectStateSet(a,c)})};a.prototype.removeGraphic=function(a){var d=this;this._stateSets.forEach(function(c){c.hasGraphic(a)&&d._removeObjectStateSet(a,c)})};a.prototype.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach(function(a){return a.objectStateSet.removeAll()})};a.prototype.initializeSet=function(a){var d=this,c=this._graphicsCore.graphics3DGraphics;
a.objectIdField?c.forEach(function(c){c&&a.hasGraphic(c)&&d._addObjectStateSet(c,a)}):a.ids.forEach(function(e){(e=c.get(e))&&d._addObjectStateSet(e,a)})};Object.defineProperty(a.prototype,"test",{get:function(){return{states:this._stateSets}},enumerable:!1,configurable:!0});return a}();a.Graphics3DObjectStates=n})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["require","exports","../../webgl-engine/lib/Object3DStateSet"],function(n,a,d){Object.defineProperty(a,"__esModule",
{value:!0});a.Graphics3DObjectStateSet=void 0;n=function(){function a(a,e){this.stateType=a;this.objectIdField=e;this.objectStateSet=new d.Object3DStateSet;this.ids=new Set;this.paused=!1}a.prototype.hasGraphic=function(a){return this.objectIdField?this.ids.has(a.graphic.attributes[this.objectIdField]):this.ids.has(a.graphic.uid)};return a}();a.Graphics3DObjectStateSet=n})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../support/layerViewUtils ../../../support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._scaleRangeActive=!1;b.layerScaleRangeVisibilityQuery=!1;b.handles=new k;b.layerView=null;b.layer=null;b.queryGraphicUIDsInExtent=null;b.extent=null;b.graphicsCore=null;b.basemapTerrain=null;b.layerScaleEnabled=!0;b.suspended=!1;b.updating=!0;return b}d.__extends(b,a);b.prototype.setup=function(a,b,c,d,e){var f=this;this.layerView=a;this.layer=b;this.queryGraphicUIDsInExtent=c;this.graphicsCore=
d;this.basemapTerrain=e;this.updateScaleRangeActive();this.handles.add(this.layerView.view.resourceController.scheduler.registerTask(m.Task.SCALE_VISIBILITY,function(){return f.update()},function(){return f.needsUpdate()}))};b.prototype.destroy=function(){this.handles.destroy();this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=this.handles=null};b.prototype.needsUpdate=function(){return!(!this.layerView.view.basemapTerrain||!this.updating)};b.prototype._setDirty=function(){this.updating||
this._set("updating",!0)};b.prototype.setExtent=function(a){this.extent=a;this._setDirty()};b.prototype.scaleRangeActive=function(){return this._scaleRangeActive};b.prototype.updateScaleRangeActive=function(){var a=this,b=this.layer,c=this.layerScaleEnabled&&(0<b.minScale||0<b.maxScale);b.labelingInfo&&!c&&(c=b.labelingInfo.some(function(a){return a&&(0<a.minScale||0<a.maxScale)}));b=this._scaleRangeActive!==c;(this._scaleRangeActive=c)&&!this.handles.has("terrain-events")&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",
function(b){return a.scaleUpdateHandler(b)}),"terrain-events"),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",function(){return a._setDirty()}),"terrain-events")):!c&&this.handles.has("terrain-events")&&this.handles.remove("terrain-events");return b};b.prototype.update=function(){var a=this,b=this.layerView.view.basemapTerrain;this.extent&&b&&b.ready&&this._scaleRangeActive&&this.layerScaleEnabled?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=
!0,b.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(b){return a.finishUpdate(b)})):this.finishUpdate(!0)};b.prototype.finishUpdate=function(a){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!a);this._set("updating",!1)};b.prototype.visibleAtLayerScale=function(a){return!this.layerScaleEnabled||h.scaleBoundsPredicate(a,this.layer.minScale||0,this.layer.maxScale||0)};b.prototype.visibleAtLabelScale=function(a,b){return h.scaleBoundsPredicate(a,b.minScale||
0,b.maxScale||0)};b.prototype.graphicScale=function(a){var b;e.isSome(a.centroid)?b=a.centroid:e.isSome(a.graphic.geometry)&&"point"===a.graphic.geometry.type&&(b=a.graphic.geometry);return b?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(b):1:null};b.prototype.graphicVisible=function(a){if(!this.layerScaleEnabled)return!0;a=this.graphicScale(a);return this.visibleAtLayerScale(a)};b.prototype.updateVisibility=function(a){if(this._scaleRangeActive){var b=this.graphicVisible(a);
return a.setVisibilityFlag(1,b,0)}return!1};b.prototype.updateGraphicLabelScaleVisibility=function(a){if(!this._scaleRangeActive||!a.labelGraphics||0===a.labelGraphics.length)return!1;var b=this.graphicScale(a);if(a=this.updateLabelScaleVisibility(a,b))this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty();return a};b.prototype.updateLabelScaleVisibility=function(a,b){if(!a.labelGraphics||0===a.labelGraphics.length)return!1;var c=a.labelGraphics[0]._labelClass;return c&&
null!=c.minScale&&null!=c.maxScale&&(b=this.visibleAtLabelScale(b,c),a.setVisibilityFlag(1,b,1))?!0:!1};b.prototype.scaleUpdateHandler=function(a){var b=this;this._setDirty();if(!this.layerView.suspended){var c=a.extent,d=a.scale,f=this.visibleAtLayerScale(d),g=!1;this.queryGraphicUIDsInExtent(c,a.spatialReference,function(a){if(a=b.graphicsCore.getGraphics3DGraphicById(a)){var h=a.centroid;e.isSome(h)&&(c[0]>h.x||c[1]>h.y||c[2]<h.x||c[3]<h.y)||(a.setVisibilityFlag(1,f,0)&&(g=!0),b.updateLabelScaleVisibility(a,
d)&&(g=!0))}});g&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}};b.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(function(a){return a.clearVisibilityFlag(1)}):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()};d.__decorate([c.property({constructOnly:!0})],b.prototype,"layerScaleEnabled",void 0);d.__decorate([c.property({readOnly:!0})],
b.prototype,"suspended",void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"updating",void 0);return b=d.__decorate([c.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],b)}(l)})},"esri/views/3d/layers/support/attributeUtils":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.attributeLookup=void 0;a.attributeLookup=function(a,l){l=l.toLowerCase();for(var d=0,e=Object.keys(a);d<e.length;d++){var c=e[d];if(c.toLowerCase()===
l)return a[c]}return null}})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["require","exports","../../../../core/promiseUtils","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.toViewIfLocal=void 0;a.toViewIfLocal=function(a){var c=a.view.spatialReference,e=a.layer.fullExtent,m=e&&e.spatialReference;return m?m.equals(c)?d.resolve(e.clone()):l.canProject(m,
c)?d.resolve(l.project(e,c)):a.view.state.isLocal?k.projectGeometry(e,c,a.layer.portalItem).then(function(c){return!a.destroyed&&c?c:void 0}).catch(function(){return null}):d.resolve(null):d.resolve(null)}})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["require","exports","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.FeatureTileFetcher3DLayerViewContext=void 0;
n=function(){function a(a){this._capabilities=this.memoryCache=null;var c=a.layerView.layer;this.layerView=a.layerView;this.objectIdField=c.objectIdField;this.returnZ=a.returnZ;this.returnM=a.returnM;a=this.layerView.view.resourceController;this.query=k.createFeatureTileQuery3D(c,a.scheduler);"hasService"in c&&c.hasService&&a&&(this.memoryCache=a.memoryController.getMemCache(c.uid))}a.prototype.destroy=function(){d.isSome(this.memoryCache)&&this.memoryCache.destroy();this.query.destroy()};a.prototype.createQuery=
function(){var a=this.layerView.layer.createQuery();a.outFields=this.layerView.availableFields;a.returnZ=this.returnZ;a.returnM=this.returnM;a.outSpatialReference=this.tilingScheme.spatialReference;return a};Object.defineProperty(a.prototype,"viewingMode",{get:function(){return this.layerView.view.state.mode},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"tilingScheme",{get:function(){return this.layerView.view.featureTiles.tilingScheme},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"scheduler",{get:function(){var a=this.layerView.view.resourceController;return a?a.scheduler:null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"geometryType",{get:function(){return this.layerView.layer.geometryType},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"fullExtent",{get:function(){return this.layerView.layer.fullExtent},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"tileMaxRecordCount",{get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"maxRecordCount",{get:function(){return this.layerView.layer.capabilities.query.maxRecordCount},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"capabilities",{get:function(){return d.isSome(this._capabilities)?this._capabilities:this._capabilities=l.contextCapabilitiesFromLayer(this.layerView.layer)},enumerable:!1,configurable:!0});a.prototype.logFetchError=function(a,d){a.error("#fetchTile()",this.layerView.layer,
d&&d.message?d.message:d)};return a}();a.FeatureTileFetcher3DLayerViewContext=n})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/operations/query ../../support/PBFDecoder".split(" "),function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.createFeatureTileQuery3D=
void 0;var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);Object.defineProperty(b.prototype,"queryFeaturesDehydrated",{get:function(){var a=this,b,c,d=this.layer.capabilities;if((d=d&&d.query)&&d.supportsFormatPBF){k.isNone(this._decoder)&&(this._decoder=new f.PBFDecoder(this.scheduler));var g={sourceSpatialReference:null!==(c=null===(b=this.layer.spatialReference)||void 0===b?void 0:b.toJSON())&&void 0!==c?c:null,applyTransform:!0,maxStringAttributeLength:1024};
return function(b,c){return m.runQuery(a.layer.parsedUrl,b,"pbf",c).then(function(b){e.throwIfAborted(c);return k.isSome(a._decoder)?a._decoder.invoke({buffer:b.data,options:g}):e.reject(e.createAbortError())})}}return function(b,c){return m.executeQuery(a.layer.parsedUrl,b,a.layer.spatialReference,c).then(function(a){return h.fromFeatureSetJSON(a.data)})}},enumerable:!1,configurable:!0});b.prototype.queryFeatureCount=function(a,b){return this.layer.queryFeatureCount(a,b)};b.prototype.destroy=function(){this._decoder=
k.destroyMaybe(this._decoder)};d.__decorate([c.property({constructOnly:!0})],b.prototype,"layer",void 0);d.__decorate([c.property({constructOnly:!0})],b.prototype,"scheduler",void 0);d.__decorate([c.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],b.prototype,"queryFeaturesDehydrated",null);return b=d.__decorate([c.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],b)}(l),g=function(a){function b(){return null!==a&&a.apply(this,
arguments)||this}d.__extends(b,a);b.prototype.queryFeaturesDehydrated=function(a,b){return this.layer.queryFeatures(a,b)};d.__decorate([c.property({constructOnly:!0})],b.prototype,"layer",void 0);return b=d.__decorate([c.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],b)}(l),p=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype.destroy=function(){};b.prototype.queryFeaturesDehydrated=function(a,b){var c=this;return this.source.queryFeaturesJSON(a,
b).then(h.fromFeatureSetJSON,function(d){if(d&&"query-features-json:unsupported"===d.name)return c.layer.queryFeatures(a,b);throw d;})};b.prototype.queryFeatureCount=function(a,b){return this.layer.queryFeatureCount(a,b)};d.__decorate([c.property({constructOnly:!0})],b.prototype,"layer",void 0);d.__decorate([c.aliasOf("layer.source")],b.prototype,"source",void 0);return b=d.__decorate([c.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],b)}(l);a.createFeatureTileQuery3D=
function(a,c){switch(a.source.type){case "feature-layer":return new b({layer:a,scheduler:c});case "memory":case "csv":case "geojson":return new p({layer:a});case "ogc-feature":return new g({layer:a});case "stream-layer":throw Error("Tile based queries unsupported for stream sources");}}})},"esri/views/3d/support/PBFDecoder":function(){define("require exports tslib ../../../Graphic ../../../core/promiseUtils ../../../geometry/SpatialReference ../../../layers/support/Field ./WorkerHandle".split(" "),
function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.PBFDecoder=void 0;n=function(){function a(a){this._handle=new m(a)}a.prototype.destroy=function(){this._handle.destroy()};a.prototype.invoke=function(a,f){void 0===f&&(f=null);if(!a.buffer||0===a.buffer.byteLength)return k.resolve(null);a.options.sourceSpatialReference&&a.options.sourceSpatialReference instanceof e&&(a.options=d.__assign(d.__assign({},a.options),{sourceSpatialReference:a.options.sourceSpatialReference.toJSON()}));
return this._handle.invoke(a,f).then(function(a){a.spatialReference=e.fromJSON(a.spatialReference);if(a.fields)for(var b=0;b<a.fields.length;b++)a.fields[b]=c.fromJSON(a.fields[b]);for(var b=a.spatialReference,d=0,f=a.features;d<f.length;d++){var g=f[d];g.uid=l.generateUID();g.geometry&&(g.geometry.spatialReference=b)}return a})};return a}();a.PBFDecoder=n;var m=function(a){function b(b){return a.call(this,"PBFDecoderWorker","_parseFeatureQuery",b,{strategy:"dedicated"})||this}d.__extends(b,a);b.prototype.getTransferList=
function(a){return[a.buffer]};return b}(h.WorkerHandle)})},"esri/views/3d/support/EventedSet":function(){define(["require","exports","tslib","../../../core/Evented","../../../core/SetUtils"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.EventedSet=void 0;n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c._set=new Set;return c}d.__extends(c,a);c.prototype.clear=function(){if(0<this._set.size){var a=this.toArray();this._set.clear();this.emit("after-changes",
{type:2});this.emit("change",{added:[],removed:a})}};Object.defineProperty(c.prototype,"length",{get:function(){return this._set.size},enumerable:!1,configurable:!0});c.prototype.addMany=function(a){if(0!==a.length){for(var c=0;c<a.length;c++)this._set.add(a[c]);this.emit("after-changes",{type:1});this.emit("change",{added:a,removed:[]})}};c.prototype.remove=function(a){this._set.delete(a)&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:[a]}))};c.prototype.removeMany=function(a){for(var c=
[],d=0;d<a.length;d++){var b=a[d];this._set.delete(b)&&c.push(b)}0<c.length&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:c}))};c.prototype.toArray=function(){return k.valuesOfSet(this._set)};c.prototype.find=function(a){var c;k.someSet(this._set,function(d){return a(d)?(c=d,!0):!1});return c};c.prototype.forEach=function(a){this._set.forEach(function(c){return a(c)})};return c}(l);a.EventedSet=n})},"esri/views/layers/FeatureLayerView":function(){define("require exports tslib ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/SetUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/support/commonProperties ../../layers/support/fieldUtils ../../support/arcadeOnDemand ../../tasks/support/Query ./support/FeatureEffect ./support/FeatureFilter ./support/popupUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q){Object.defineProperty(a,"__esModule",{value:!0});a.FeatureLayerView=void 0;var v=k.getLogger("esri.views.layers.FeatureLayerView");a.FeatureLayerView=function(a){return function(a){function k(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b._updatingRequiredFieldsPromise=null;b.effect=null;b.filter=null;b.layer=null;b.requiredFields=[];b.view=null;return b}d.__extends(k,a);k.prototype.initialize=function(){var a=this;
m.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo layer.displayField filter effect layer.timeInfo timeExtent".split(" "),function(){return a._handleRequiredFieldsChange()},!0)};Object.defineProperty(k.prototype,"availableFields",{get:function(){var a=this.layer,b=this.layer.fields,c=this.requiredFields;return"outFields"in a&&a.outFields?g.fixFields(b,d.__spreadArrays(g.unpackFieldNames(b,a.outFields),c)):g.fixFields(b,c)},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,
"maximumNumberOfFeatures",{get:function(){return 0},set:function(a){v.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!1},enumerable:!1,configurable:!0});k.prototype.highlight=function(a,b){void 0===b&&(b={});throw Error("missing implementation");};k.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},
a=e.isSome(this.filter)?this.filter.createQuery(a):new t(a);this.timeExtent&&(a.timeExtent=a.timeExtent?a.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return a};k.prototype.queryFeatures=function(a,b){throw Error("missing implementation");};k.prototype.queryObjectIds=function(a,b){throw Error("missing implementation");};k.prototype.queryFeatureCount=function(a,b){throw Error("missing implementation");};k.prototype.queryExtent=function(a,b){throw Error("missing implementation");
};k.prototype._loadArcadeModules=function(a){if(a.get("expressionInfos.length"))return p.loadArcade()};k.prototype._handleRequiredFieldsChange=function(){var a=this,b=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",b);b.then(function(){a._updatingRequiredFieldsPromise===b&&a._set("_updatingRequiredFieldsPromise",null)})};k.prototype._updateRequiredFields=function(){return d.__awaiter(this,void 0,void 0,function(){var a,b,f,k,m,l,n,p,r,q,t,u,w,x,z;return d.__generator(this,
function(d){switch(d.label){case 0:if(!this.layer||!this.view)return[2];a="3d"===this.view.type;b=this;k=f=b.layer;m=k.fields;l=k.objectIdField;n=k.renderer;p=k.displayField;r=f.featureReduction;q=new Set;return[4,c.eachAlways([n?n.collectRequiredFields(q,m):null,g.collectLabelingFields(q,f),a?g.collectElevationFields(q,f):null,e.isSome(this.filter)?g.collectFilterFields(q,f,this.filter):null,this.effect?g.collectFilterFields(q,f,this.effect.filter):null,r?g.collectFeatureReductionFields(q,f,r):null])];
case 1:t=d.sent();f.timeInfo&&this.timeExtent&&g.collectFields(q,f.fields,[f.timeInfo.startField,f.timeInfo.endField]);u=0;for(w=t;u<w.length;u++)x=w[u],x.error&&v.error(x.error);g.collectField(q,m,l);a&&p&&g.collectField(q,m,p);z=h.valuesOfSet(q).sort();this._set("requiredFields",z);return[2]}})})};k.prototype.validateFetchPopupFeatures=function(a){var b=this.layer;if(!this.layer.popupEnabled)return new l("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:b});if(!q.getFetchPopupTemplate(this.layer,
a))return new l("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:b})};k.prototype.fetchClientPopupFeatures=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,f,h,k,m,l,n,p,r,t,u,v;return d.__generator(this,function(d){switch(d.label){case 0:b=e.isSome(a)?a.clientGraphics:null;if(!b||0===b.length)return[2,c.resolve([])];f=[];h=[];k=this.layer;m=q.getFetchPopupTemplate(k,a);return e.isSome(m)?[4,this._loadArcadeModules(m)]:[2,c.resolve([])];case 1:return n=
(l=d.sent())&&l.arcadeUtils.hasGeometryOperations(m),[4,this.createPopupQuery(a)];case 2:p=d.sent();r=g.unpackFieldNames(k.fields,p.outFields);t=0;for(u=b;t<u.length;t++)v=u[t],n||!g.featureHasFields(r,v)?h.push(v):f.push(v);if("stream"===k.type||0===h.length)return[2,c.resolve(f)];p.objectIds=h.map(function(a){return a.attributes[k.objectIdField]});return[2,k.queryFeatures(p).then(function(a){return f.concat(a.features)}).catch(function(){return h})]}})})};k.prototype.createPopupQuery=function(a){return d.__awaiter(this,
void 0,void 0,function(){var b,c,f,g,h,k,m,l;return d.__generator(this,function(d){switch(d.label){case 0:return b=this.layer,c=b.createQuery(),f=q.getFetchPopupTemplate(b,a),(h=e.isSome(f))?[4,this._loadArcadeModules(f)]:[3,2];case 1:h=d.sent(),d.label=2;case 2:return g=h,k=e.isSome(f)&&g&&g.arcadeUtils.hasGeometryOperations(f),m=!("point"!==b.geometryType&&!k),c.returnGeometry=m,c.returnZ=m,c.returnM=m,l=c,[4,q.getRequiredFields(this.layer,f)];case 3:return l.outFields=d.sent(),c.outSpatialReference=
this.view.spatialReference,[2,c]}})})};k.prototype.canResume=function(){var b;return!a.prototype.canResume.call(this)||(null===(b=this.timeExtent)||void 0===b?0:b.isEmpty)?!1:!0};d.__decorate([f.property()],k.prototype,"_updatingRequiredFieldsPromise",void 0);d.__decorate([f.property({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],k.prototype,"availableFields",null);d.__decorate([f.property({type:u})],k.prototype,"effect",void 0);d.__decorate([f.property({type:r})],k.prototype,"filter",
void 0);d.__decorate([f.property(b.combinedViewLayerTimeExtentProperty)],k.prototype,"timeExtent",void 0);d.__decorate([f.property()],k.prototype,"layer",void 0);d.__decorate([f.property({type:Number})],k.prototype,"maximumNumberOfFeatures",null);d.__decorate([f.property({readOnly:!0,type:Boolean})],k.prototype,"maximumNumberOfFeaturesExceeded",null);d.__decorate([f.property({readOnly:!0})],k.prototype,"requiredFields",void 0);d.__decorate([f.property({dependsOn:["timeExtent"]})],k.prototype,"suspended",
void 0);d.__decorate([f.property()],k.prototype,"view",void 0);return k=d.__decorate([f.subclass("esri.views.layers.FeatureLayerView")],k)}(a)}})},"esri/views/layers/support/FeatureEffect":function(){define("require exports tslib ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ./FeatureFilter ./ParsedFeatureEffect ./Transition".split(" "),function(n,a,d,l,k,e,c,h,m,f){var b=k.getLogger("esri.views.layers.support.FeatureEffect");return function(a){function g(){var b=
null!==a&&a.apply(this,arguments)||this;b.filter=null;b.includedEffect=null;b.excludedEffect=null;b.excludedLabelsVisible=!1;return b}d.__extends(g,a);k=g;Object.defineProperty(g.prototype,"insideEffect",{get:function(){b.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");return this.includedEffect},set:function(a){b.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");this.includedEffect=a},enumerable:!1,configurable:!0});
Object.defineProperty(g.prototype,"outsideEffect",{get:function(){b.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");return this.excludedEffect},set:function(a){b.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");this.excludedEffect=a},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"parsedIncludedEffect",{get:function(){return e.isSome(this.includedEffect)?"string"===typeof this.includedEffect?
m.ParsedFeatureEffect.fromString(this.includedEffect):new f({from:m.ParsedFeatureEffect.fromString(this.includedEffect.from),to:m.ParsedFeatureEffect.fromString(this.includedEffect.to),duration:this.includedEffect.duration}):null},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"parsedExcludedEffect",{get:function(){return e.isSome(this.excludedEffect)?"string"===typeof this.excludedEffect?m.ParsedFeatureEffect.fromString(this.excludedEffect):new f({from:m.ParsedFeatureEffect.fromString(this.excludedEffect.from),
to:m.ParsedFeatureEffect.fromString(this.excludedEffect.to),duration:this.excludedEffect.duration}):null},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"renderingHash",{get:function(){return this.excludedLabelsVisible+"-"+this.includedEffect+"-"+this.excludedEffect},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"done",{get:function(){return(!e.isSome(this.parsedIncludedEffect)||this.parsedIncludedEffect.done)&&(!e.isSome(this.parsedExcludedEffect)||this.parsedExcludedEffect.done)},
enumerable:!1,configurable:!0});g.prototype.clone=function(){return new k({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};var k;d.__decorate([c.property({type:h,json:{write:!0}})],g.prototype,"filter",void 0);d.__decorate([c.property({type:String,json:{write:!0}})],g.prototype,"includedEffect",void 0);d.__decorate([c.property({type:String,json:{write:!0}})],g.prototype,"excludedEffect",
void 0);d.__decorate([c.property({type:Boolean,json:{write:!0}})],g.prototype,"excludedLabelsVisible",void 0);d.__decorate([c.property({dependsOn:["includedEffect"]})],g.prototype,"parsedIncludedEffect",null);d.__decorate([c.property({dependsOn:["excludedEffect"]})],g.prototype,"parsedExcludedEffect",null);d.__decorate([c.property({dependsOn:["includedEffect","excludedEffect"]})],g.prototype,"renderingHash",null);return g=k=d.__decorate([c.subclass("esri.views.layers.support.FeatureEffect")],g)}(l.JSONSupport)})},
"esri/views/layers/support/ParsedFeatureEffect":function(){define("require exports tslib ../../../core/Error ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f32 ../effects/parser".split(" "),function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.ParsedFeatureEffect=void 0;var g=e.getLogger("esri.views.layers.support.ParsedFeatureEffect");n=
function(a){function e(){var b=null!==a&&a.apply(this,arguments)||this;b.done=!0;return b}d.__extends(e,a);k=e;e.fromString=function(a){var c=[],d=null,e=b.parse(a);if(e.error)g.error(new l("invalid-type","Encountered an error when parsing css",e.error));else for(a=0,e=e.effects;a<e.length;a++){var f=e[a];"opacity"===f.type?d=f:"colorMatrix"in f&&c.push(f)}return new k({transforms:c,opacity:d})};e.prototype.getOpacity=function(){return c.isSome(this.opacity)?this.opacity.amount:1};e.prototype.getColorMatrix=
function(){return(this.transforms||[]).map(function(a){return{colorMatrix:f.mat4f32.clone(a.colorMatrix)}}).reverse().reduce(function(a,b){return m.mat4.multiply(a,a,b.colorMatrix)},f.mat4f32.create())};e.prototype.clone=function(){return new k({transforms:this.transforms&&this.transforms.map(function(a){return d.__assign({},a)})})};var k;d.__decorate([h.property()],e.prototype,"opacity",void 0);d.__decorate([h.property()],e.prototype,"transforms",void 0);return e=k=d.__decorate([h.subclass("esri.views.layers.support.ParsedFeatureEffect")],
e)}(k.JSONSupport);a.ParsedFeatureEffect=n})},"esri/views/layers/effects/parser":function(){define("require exports ../../../colorUtils ../../../core/Error ./effects ./grammar".split(" "),function(n,a,d,l,k,e){function c(a){try{switch(a.name){case "grayscale":case "sepia":case "saturate":case "invert":case "brightness":case "contrast":var c=1;h(a.parameters,1);1===a.parameters.length&&(c=b(a.parameters[0]));return new k.ColorMatrixEffect(a.name,c);case "opacity":return c=1,h(a.parameters,1),1===a.parameters.length&&
(c=b(a.parameters[0])),new k.OpacityEffect(c);case "hue-rotate":c=0;h(a.parameters,1);if(1===a.parameters.length){var e=a.parameters[0];if("quantity"!==e.type||(0!==e.value||null!==e.unit)&&null==u[e.unit])throw new l("effect:type-error","Expected \x3cangle\x3e, Actual: "+m(e),{term:e});c=e.value*u[e.unit]||0}return new k.HueRotateEffect(c);case "radial-blur":case "blur":return c=0,h(a.parameters,1),1===a.parameters.length&&(c=p(a.parameters[0]),f(c,a.parameters[0])),new k.BlurEffect(a.name,c);case "drop-shadow":for(var e=
[],n=0,r=a.parameters;n<r.length;n++){var w=r[n];if("color"===w.type){e.length&&Object.freeze(e);if(c)throw new l("effect:type-error","Accepts only one color",{});a:{var E=w;switch(E.colorType){case "hex":c=d.hex2rgba(E.value);break a;case "named":c=t(E.value);break a;case "function":var G=void 0;var F=E.value;h(F.parameters,4);if(q.test(F.name))G=[b(F.parameters[0]),b(F.parameters[1]),b(F.parameters[2]),F.parameters[3]?b(F.parameters[3]):1];else if(v.test(F.name))G=d.hsla2rgba(g(F.parameters[0]),
b(F.parameters[1]),b(F.parameters[2]),F.parameters[3]?b(F.parameters[3]):1);else throw new l("effect:syntax-error","Invalid color function '"+F.name+"'",{colorFunction:F});c=G;break a}c=void 0}}else{var H=p(w);if(Object.isFrozen(e))throw new l("effect:type-error","\x3clength\x3e parameters not consecutive",{lengths:e});e.push(H);3===e.length&&f(H,w)}}if(2>e.length||3<e.length)throw new l("effect:type-error","Expected \x3clength\x3e{2,3}, Actual: \x3clength\x3e{"+e.length+"}",{lengths:e});return new k.DropShadowEffect(e[0],
e[1],e[2]||0,c||t("black"));case "bloom":return c=1,w=r=0,h(a.parameters,3),a.parameters[0]&&(c=b(a.parameters[0])),a.parameters[1]&&(r=p(a.parameters[1]),f(r,a.parameters[1])),a.parameters[2]&&(w=b(a.parameters[2])),new k.BloomEffect(c,r,w)}}catch(J){throw J.details.filter=a,J;}throw new l("effect:unknown-effect","Effect '"+a.name+"' is not supported",{effect:a});}function h(a,b){if(a.length>b)throw new l("effect:type-error","Function supports up to "+b+" parameters, Actual: "+a.length,{parameters:a});
}function m(a){return"color"===a.type?"\x3ccolor\x3e":r[a.unit]?"\x3clength\x3e":u[a.unit]?"\x3cangle\x3e":"%"===a.unit?"\x3cpercentage\x3e":"\x3cdouble\x3e"}function f(a,b){if(0>a)throw new l("effect:type-error","Negative values are not allowed, Actual: "+a,{term:b});}function b(a){if("quantity"!==a.type||null!==a.unit&&"%"!==a.unit)throw new l("effect:type-error","Expected \x3cdouble\x3e or \x3cpercentage\x3e, Actual: "+m(a),{term:a});var b=a.value;f(b,a);return"%"===a.unit?.01*b:b}function g(a){if("quantity"!==
a.type||null!==a.unit)throw new l("effect:type-error","Expected \x3cdouble\x3e, Actual: "+m(a),{term:a});f(a.value,a);return a.value}function p(a){if("quantity"!==a.type||(0!==a.value||null!==a.unit)&&null==r[a.unit])throw new l("effect:type-error","Expected \x3clength\x3e, Actual: "+m(a),{term:a});return a.value*r[a.unit]||0}function t(a){var b=d.getNamedColorCopy(a);if(!b)throw new l("effect:unknown-color","color '"+a+"' isn't valid",{namedColor:a});return b}Object.defineProperty(a,"__esModule",
{value:!0});a.parse=void 0;a.parse=function(a){var b;try{b=a?e.parse(a):[]}catch(B){return{input:a,parsedFunctions:[],effects:[],error:new l("effect:invalid-syntax","Invalid filter syntax",{input:a,error:B})}}a={input:a,parsedFunctions:b,effects:[],error:null};try{for(var d=0;d<b.length;d++)a.effects.push(c(b[d]))}catch(B){a.effects.length=0,a.error=B}return a};var u={deg:1,grad:.9,rad:180/Math.PI,turn:360},r={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/73},q=/^rgba?/i,v=/^hsla?/i})},"esri/views/layers/effects/effects":function(){define(["require",
"exports","tslib","../../../core/libs/gl-matrix-2/mat4","../../../core/libs/gl-matrix-2/mat4f32"],function(n,a,d,l,k){function e(a,d,e){return a+(d-a)*e}Object.defineProperty(a,"__esModule",{value:!0});a.OpacityEffect=a.HueRotateEffect=a.DropShadowEffect=a.ColorMatrixEffect=a.sepia=a.grayscale=a.BlurEffect=a.BloomEffect=void 0;n=function(){function a(a,c,d){this.strength=a;this.radius=c;this.threshold=d;this.type="bloom"}a.prototype.interpolate=function(a,c,d){this.strength=e(a.strength,c.strength,
d);this.radius=e(a.radius,c.radius,d);this.threshold=e(a.threshold,c.threshold,d)};a.prototype.clone=function(){return new a(this.strength,this.radius,this.threshold)};return a}();a.BloomEffect=n;n=function(){function a(a,c){this.type=a;this.radius=c}a.prototype.interpolate=function(a,c,d){this.radius=Math.round(e(a.radius,c.radius,d))};a.prototype.clone=function(){return new a(this.type,this.radius)};return a}();a.BlurEffect=n;a.grayscale=function(a,d){d=1-d;a=l.mat4.set(a,.2126+.7874*d,.7152-.7152*
d,.0722-.0722*d,0,.2126-.2126*d,.7152+.2848*d,.0722-.0722*d,0,.2126-.2126*d,.7152-.7152*d,.0722+.9278*d,0,0,0,0,1);return l.mat4.transpose(a,a)};a.sepia=function(a,d){d=1-d;a=l.mat4.set(a,.393+.607*d,.769-.769*d,.189-.189*d,0,.349-.349*d,.686+.314*d,.168-.168*d,0,.272-.272*d,.534-.534*d,.131+.869*d,0,0,0,0,1);return l.mat4.transpose(a,a)};n=function(){function c(a,c){this.type=a;this.amount=c;if("invert"===this.type||"grayscale"===this.type||"sepia"===this.type)this.amount=Math.min(this.amount,1)}
Object.defineProperty(c.prototype,"colorMatrix",{get:function(){this._colorMatrix||this._updateMatrix();return this._colorMatrix},enumerable:!1,configurable:!0});c.prototype.interpolate=function(a,c,d){this.amount=e(a.amount,c.amount,d);this._updateMatrix()};c.prototype.clone=function(){return new c(this.type,this.amount)};c.prototype._updateMatrix=function(){var c=this._colorMatrix||k.mat4f32.create();switch(this.type){case "brightness":var d=this.amount,c=l.mat4.set(c,d,0,0,0,0,d,0,0,0,0,d,0,0,
0,0,1);this._colorMatrix=l.mat4.transpose(c,c);break;case "contrast":d=this.amount;c=l.mat4.set(c,d,0,0,.5-.5*d,0,d,0,.5-.5*d,0,0,d,.5-.5*d,0,0,0,1);this._colorMatrix=l.mat4.transpose(c,c);break;case "grayscale":this._colorMatrix=a.grayscale(c,this.amount);break;case "invert":var d=this.amount,e=1-2*d,c=l.mat4.set(c,e,0,0,d,0,e,0,d,0,0,e,d,0,0,0,1);this._colorMatrix=l.mat4.transpose(c,c);break;case "saturate":d=this.amount;c=l.mat4.set(c,.213+.787*d,.715-.715*d,.072-.072*d,0,.213-.213*d,.715+.285*
d,.072-.072*d,0,.213-.213*d,.715-.715*d,.072+.928*d,0,0,0,0,1);this._colorMatrix=l.mat4.transpose(c,c);break;case "sepia":this._colorMatrix=a.sepia(c,this.amount)}};return c}();a.ColorMatrixEffect=n;n=function(){function a(a,c,d,b){this.offsetX=a;this.offsetY=c;this.blurRadius=d;this.color=b;this.type="drop-shadow"}a.prototype.interpolate=function(a,c,d){this.offsetX=e(a.offsetX,c.offsetX,d);this.offsetY=e(a.offsetY,c.offsetY,d);this.blurRadius=e(a.blurRadius,c.blurRadius,d);this.color[0]=Math.round(e(a.color[0],
c.color[0],d));this.color[1]=Math.round(e(a.color[1],c.color[1],d));this.color[2]=Math.round(e(a.color[2],c.color[2],d));this.color[3]=e(a.color[3],c.color[3],d)};a.prototype.clone=function(){return new a(this.offsetX,this.offsetY,this.blurRadius,d.__spreadArrays(this.color))};return a}();a.DropShadowEffect=n;n=function(){function a(a){this.angle=a;this.type="hue-rotate"}Object.defineProperty(a.prototype,"colorMatrix",{get:function(){this._colorMatrix||this._updateMatrix();return this._colorMatrix},
enumerable:!1,configurable:!0});a.prototype.interpolate=function(a,c,d){this.angle=e(a.angle,c.angle,d);this._updateMatrix()};a.prototype.clone=function(){return new a(this.angle)};a.prototype._updateMatrix=function(){var a=this._colorMatrix||k.mat4f32.create(),c=this.angle,d=Math.sin(c*Math.PI/180),c=Math.cos(c*Math.PI/180),a=l.mat4.set(a,.213+.787*c-.213*d,.715-.715*c-.715*d,.072-.072*c+.928*d,0,.213-.213*c+.143*d,.715+.285*c+.14*d,.072-.072*c-.283*d,0,.213-.213*c-.787*d,.715-.715*c+.715*d,.072+
.928*c+.072*d,0,0,0,0,1);this._colorMatrix=l.mat4.transpose(a,a)};return a}();a.HueRotateEffect=n;n=function(){function a(a){this.amount=a;this.type="opacity";this.amount=Math.min(this.amount,1)}a.prototype.interpolate=function(a,c,d){this.amount=e(a.amount,c.amount,d)};a.prototype.clone=function(){return new a(this.amount)};return a}();a.OpacityEffect=n})},"esri/views/layers/effects/grammar":function(){(function(n,a){"function"===typeof define&&define.amd?define([],a):"object"===typeof module&&module.exports&&
(module.exports=a())})(this,function(){function n(a,d,l,k){this.message=a;this.expected=d;this.found=l;this.location=k;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}(function(a,d){function l(){this.constructor=a}l.prototype=d.prototype;a.prototype=new l})(n,Error);n.buildMessage=function(a,d){function l(a){return a.charCodeAt(0).toString(16).toUpperCase()}function k(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,
"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+l(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+l(a)})}function e(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+l(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+l(a)})}var c={literal:function(a){return'"'+
k(a.text)+'"'},"class":function(a){var c="",d;for(d=0;d<a.parts.length;d++)c+=a.parts[d]instanceof Array?e(a.parts[d][0])+"-"+e(a.parts[d][1]):e(a.parts[d]);return"["+(a.inverted?"^":"")+c+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var d=Array(a.length),e;for(e=0;e<a.length;e++){var b=e,g;g=a[e];g=c[g.type](g);d[b]=g}d.sort();if(0<d.length){for(a=e=1;e<d.length;e++)d[e-1]!==d[e]&&(d[a]=d[e],
a++);d.length=a}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}(a)+" but "+(d?'"'+k(d)+'"':"end of input")+" found."};return{SyntaxError:n,parse:function(a,d){function l(a,b){return{type:"literal",text:a,ignoreCase:b}}function k(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function e(a){return{type:"other",description:a}}function c(b){var c=Ca[b],d;if(!c){for(d=b-1;!Ca[d];)d--;c=Ca[d];for(c={line:c.line,
column:c.column};d<b;)10===a.charCodeAt(d)?(c.line++,c.column=1):c.column++,d++;Ca[b]=c}return c}function h(a,b){var d=c(a),e=c(b);return{start:{offset:a,line:d.line,column:d.column},end:{offset:b,line:e.line,column:e.column}}}function m(a){W<Da||(W>Da&&(Da=W,bb=[]),bb.push(a))}function f(){var c,d;la++;c=W;d=p();d!==q?(a.substr(W,4)===x?(d=x,W+=4):(d=q,0===la&&m(B)),d!==q?(d=p(),d!==q?(wa=c,c=d=[]):(W=c,c=q)):(W=c,c=q)):(W=c,c=q);la--;c===q&&(d=q,0===la&&m(z));if(c===q)if(c=[],d=b(),d!==q)for(;d!==
q;)c.push(d),d=b();else c=q;return c}function b(){var b,c,d,e;b=W;c=p();if(c!==q)if(la++,c=W,d=t(),d!==q?(40===a.charCodeAt(W)?(e=K,W++):(e=q,0===la&&m(L)),e!==q?(wa=c,c=d):(W=c,c=q)):(W=c,c=q),la--,c===q&&(d=q,0===la&&m(I)),c!==q)if(d=p(),d!==q){var f,h,k,l,n,u;e=W;f=g();if(f!==q){d=[];h=W;k=p();k!==q?(44===a.charCodeAt(W)?(l=E,W++):(l=q,0===la&&m(G)),l===q&&(l=null),l!==q?(n=p(),n!==q?(u=g(),u!==q?h=k=[k,l,n,u]:(W=h,h=q)):(W=h,h=q)):(W=h,h=q)):(W=h,h=q);for(;h!==q;)d.push(h),h=W,k=p(),k!==q?(44===
a.charCodeAt(W)?(l=E,W++):(l=q,0===la&&m(G)),l===q&&(l=null),l!==q?(n=p(),n!==q?(u=g(),u!==q?h=k=[k,l,n,u]:(W=h,h=q)):(W=h,h=q)):(W=h,h=q)):(W=h,h=q);d!==q?(wa=e,e=f,e=f=0<d.length?[e].concat(r(d,3)):[e]):(W=e,e=q)}else W=e,e=q;d=e;d===q&&(d=null);d!==q?(e=p(),e!==q?(41===a.charCodeAt(W)?(e=A,W++):(e=q,0===la&&m(C)),e!==q?(e=p(),e!==q?(wa=b,b=c={type:"function",name:c,parameters:d||[]}):(W=b,b=q)):(W=b,b=q)):(W=b,b=q)):(W=b,b=q)}else W=b,b=q;else W=b,b=q;else W=b,b=q;return b}function g(){var c,d;
c=W;var e,f;la++;d=W;e=p();e!==q?(e=u(),e!==q?(37===a.charCodeAt(W)?(f=N,W++):(f=q,0===la&&m(S)),f!==q?(wa=d,d=e={value:e,unit:"%"}):(W=d,d=q)):(W=d,d=q)):(W=d,d=q);la--;d===q&&(e=q,0===la&&m(O));d===q&&(la++,d=W,e=p(),e!==q?(e=u(),e!==q?(a.substr(W,2)===U?(f=U,W+=2):(f=q,0===la&&m(Z)),f!==q?(wa=d,d=e={value:e,unit:"px"}):(W=d,d=q)):(W=d,d=q)):(W=d,d=q),d===q&&(d=W,e=p(),e!==q?(e=u(),e!==q?(a.substr(W,2)===V?(f=V,W+=2):(f=q,0===la&&m(T)),f!==q?(wa=d,d=e={value:e,unit:"cm"}):(W=d,d=q)):(W=d,d=q)):
(W=d,d=q),d===q&&(d=W,e=p(),e!==q?(e=u(),e!==q?(a.substr(W,2)===Y?(f=Y,W+=2):(f=q,0===la&&m(X)),f!==q?(wa=d,d=e={value:e,unit:"mm"}):(W=d,d=q)):(W=d,d=q)):(W=d,d=q),d===q&&(d=W,e=p(),e!==q?(e=u(),e!==q?(a.substr(W,2)===ca?(f=ca,W+=2):(f=q,0===la&&m(ba)),f!==q?(wa=d,d=e={value:e,unit:"in"}):(W=d,d=q)):(W=d,d=q)):(W=d,d=q),d===q&&(d=W,e=p(),e!==q?(e=u(),e!==q?(a.substr(W,2)===ga?(f=ga,W+=2):(f=q,0===la&&m(ia)),f!==q?(wa=d,d=e={value:e,unit:"pt"}):(W=d,d=q)):(W=d,d=q)):(W=d,d=q),d===q&&(d=W,e=p(),e!==
q?(e=u(),e!==q?(a.substr(W,2)===ha?(f=ha,W+=2):(f=q,0===la&&m(da)),f!==q?(wa=d,d=e={value:e,unit:"pc"}):(W=d,d=q)):(W=d,d=q)):(W=d,d=q)))))),la--,d===q&&(e=q,0===la&&m(P)),d===q&&(la++,d=W,e=u(),e!==q?(a.substr(W,3)===ka?(f=ka,W+=3):(f=q,0===la&&m(ja)),f!==q?(wa=d,d=e={value:e,unit:"deg"}):(W=d,d=q)):(W=d,d=q),d===q&&(d=W,e=u(),e!==q?(a.substr(W,3)===pa?(f=pa,W+=3):(f=q,0===la&&m(na)),f!==q?(wa=d,d=e={value:e,unit:"rad"}):(W=d,d=q)):(W=d,d=q),d===q&&(d=W,e=u(),e!==q?(a.substr(W,4)===va?(f=va,W+=4):
(f=q,0===la&&m(za)),f!==q?(wa=d,d=e={value:e,unit:"grad"}):(W=d,d=q)):(W=d,d=q),d===q&&(d=W,e=u(),e!==q?(a.substr(W,4)===ya?(f=ya,W+=4):(f=q,0===la&&m(ua)),f!==q?(wa=d,d=e={value:e,unit:"turn"}):(W=d,d=q)):(W=d,d=q)))),la--,d===q&&(e=q,0===la&&m(fa)),d===q&&(la++,d=W,e=p(),e!==q?(e=u(),e!==q?(wa=d,d=e={value:e,unit:null}):(W=d,d=q)):(W=d,d=q),la--,d===q&&(e=q,0===la&&m(oa)))));d!==q&&(wa=c,d={type:"quantity",value:d.value,unit:d.unit});c=d;if(c===q){c=W;la++;d=W;35===a.charCodeAt(W)?(e=ma,W++):(e=
q,0===la&&m(qa));if(e!==q){e=[];aa.test(a.charAt(W))?(f=a.charAt(W),W++):(f=q,0===la&&m(Ja));if(f!==q)for(;f!==q;)e.push(f),aa.test(a.charAt(W))?(f=a.charAt(W),W++):(f=q,0===la&&m(Ja));else e=q;e!==q?(wa=d,d=e={type:"hex",value:a.substring(wa,W)}):(W=d,d=q)}else W=d,d=q;d===q&&(d=W,e=b(),e!==q&&(wa=d,e={type:"function",value:e}),d=e,d===q&&(d=W,e=t(),e!==q&&(wa=d,e={type:"named",value:a.substring(wa,W)}),d=e));la--;d===q&&(e=q,0===la&&m(ta));d!==q&&(wa=c,d={type:"color",colorType:d.type,value:d.value});
c=d}return c}function p(){var b,c;la++;b=[];H.test(a.charAt(W))?(c=a.charAt(W),W++):(c=q,0===la&&m(J));for(;c!==q;)b.push(c),H.test(a.charAt(W))?(c=a.charAt(W),W++):(c=q,0===la&&m(J));la--;b===q&&(c=q,0===la&&m(F));return b}function t(){var b,c,d;la++;b=W;c=[];Q.test(a.charAt(W))?(d=a.charAt(W),W++):(d=q,0===la&&m(R));if(d!==q)for(;d!==q;)c.push(d),Q.test(a.charAt(W))?(d=a.charAt(W),W++):(d=q,0===la&&m(R));else c=q;c!==q&&(wa=b,c=a.substring(wa,W));b=c;la--;b===q&&(c=q,0===la&&m(M));return b}function u(){var b,
c,d,e,f,g;b=W;La.test(a.charAt(W))?(c=a.charAt(W),W++):(c=q,0===la&&m(Ga));c===q&&(c=null);if(c!==q){d=W;c=[];y.test(a.charAt(W))?(e=a.charAt(W),W++):(e=q,0===la&&m(ra));for(;e!==q;)c.push(e),y.test(a.charAt(W))?(e=a.charAt(W),W++):(e=q,0===la&&m(ra));if(c!==q)if(46===a.charCodeAt(W)?(e=Na,W++):(e=q,0===la&&m(Ha)),e!==q){f=[];y.test(a.charAt(W))?(g=a.charAt(W),W++):(g=q,0===la&&m(ra));if(g!==q)for(;g!==q;)f.push(g),y.test(a.charAt(W))?(g=a.charAt(W),W++):(g=q,0===la&&m(ra));else f=q;f!==q?d=c=[c,
e,f]:(W=d,d=q)}else W=d,d=q;else W=d,d=q;if(d===q)if(d=[],y.test(a.charAt(W))?(c=a.charAt(W),W++):(c=q,0===la&&m(ra)),c!==q)for(;c!==q;)d.push(c),y.test(a.charAt(W))?(c=a.charAt(W),W++):(c=q,0===la&&m(ra));else d=q;if(d!==q){c=W;101===a.charCodeAt(W)?(e=Xa,W++):(e=q,0===la&&m(Ya));if(e!==q)if(La.test(a.charAt(W))?(f=a.charAt(W),W++):(f=q,0===la&&m(Ga)),f===q&&(f=null),f!==q){g=[];y.test(a.charAt(W))?(d=a.charAt(W),W++):(d=q,0===la&&m(ra));if(d!==q)for(;d!==q;)g.push(d),y.test(a.charAt(W))?(d=a.charAt(W),
W++):(d=q,0===la&&m(ra));else g=q;g!==q?c=e=[e,f,g]:(W=c,c=q)}else W=c,c=q;else W=c,c=q;c===q&&(c=null);c!==q?(wa=b,b=c=parseFloat(a.substring(wa,W))):(W=b,b=q)}else W=b,b=q}else W=b,b=q;return b}function r(a,b){return a.map(function(a){return a[b]})}d=void 0!==d?d:{};var q={},v={start:f},w=f,z=e("none"),x="none",B=l("none",!1),A=")",C=l(")",!1),E=",",G=l(",",!1),F=e("whitespace"),H=/^[ \t\n\r]/,J=k([" ","\t","\n","\r"],!1,!1),I=e("function"),K="(",L=l("(",!1),M=e("identifier"),Q=/^[a-z\-]/,R=k([["a",
"z"],"-"],!1,!1),O=e("percentage"),N="%",S=l("%",!1),P=e("length"),U="px",Z=l("px",!1),V="cm",T=l("cm",!1),Y="mm",X=l("mm",!1),ca="in",ba=l("in",!1),ga="pt",ia=l("pt",!1),ha="pc",da=l("pc",!1),fa=e("angle"),ka="deg",ja=l("deg",!1),pa="rad",na=l("rad",!1),va="grad",za=l("grad",!1),ya="turn",ua=l("turn",!1),oa=e("number"),ta=e("color"),ma="#",qa=l("#",!1),aa=/^[0-9a-fA-F]/,Ja=k([["0","9"],["a","f"],["A","F"]],!1,!1),La=/^[+\-]/,Ga=k(["+","-"],!1,!1),y=/^[0-9]/,ra=k([["0","9"]],!1,!1),Na=".",Ha=l(".",
!1),Xa="e",Ya=l("e",!1),W=0,wa=0,Ca=[{line:1,column:1}],Da=0,bb=[],la=0;if("startRule"in d){if(!(d.startRule in v))throw Error("Can't start parsing from rule \""+d.startRule+'".');w=v[d.startRule]}d=w();if(d!==q&&W===a.length)return d;d!==q&&W<a.length&&m({type:"end"});throw function(a,b,c){return new n(n.buildMessage(a,b),a,b,c)}(bb,Da<a.length?a.charAt(Da):null,Da<a.length?h(Da,Da+1):h(Da,Da));}}})},"esri/views/layers/support/Transition":function(){define("require exports tslib ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4".split(" "),
function(n,a,d,l,k,e){return function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.from=null;c.to=null;c.duration=4E3;c.repeat=!0;c.done=!1;return c}d.__extends(c,a);m=c;c.prototype.getColorMatrix=function(){this.done=!1;if(null==this._lastTime)this._currentStep=0,this._lastTime=Date.now();else{var a=this._lastTime,b=Date.now();this._currentStep+=b-a;2147483647<=this._currentStep&&(this._currentStep=0);this._lastTime=b}var a=this._currentStep%this.duration/(this.duration/2),a=1>=
a?a:2-a,b=this.from.getColorMatrix(),c=this.to.getColorMatrix();e.mat4.multiplyScalar(b,b,1-a);e.mat4.multiplyScalar(c,c,a);!this.repeat&&this._currentStep>=this.duration&&(this.done=!0);return e.mat4.add(b,b,c)};c.prototype.getOpacity=function(){throw Error("No getOpacity definition for Transition");};c.prototype.clone=function(){var a=new m({from:this.from.clone(),to:this.to.clone(),duration:this.duration});a._lastTime=this._lastTime;a._currentStep=this._currentStep;return a};var m;d.__decorate([k.property()],
c.prototype,"from",void 0);d.__decorate([k.property()],c.prototype,"to",void 0);d.__decorate([k.property({type:Number})],c.prototype,"duration",void 0);d.__decorate([k.property({type:Boolean})],c.prototype,"repeat",void 0);return c=m=d.__decorate([k.subclass("esri.views.layers.support.Transition")],c)}(l)})},"esri/views/layers/support/popupUtils":function(){define("require exports tslib @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),function(n,a,d,l,
k,e){Object.defineProperty(a,"__esModule",{value:!0});a.getFetchPopupTemplate=a.getRequiredFields=void 0;a.getRequiredFields=function(a,h){void 0===h&&(h=a.popupTemplate);return d.__awaiter(this,void 0,void 0,function(){var c,f,b,g,n,t,u,r,q;return d.__generator(this,function(m){switch(m.label){case 0:return k.isSome(h)?[4,h.getRequiredFields(a.fields)]:[2,[]];case 1:return c=m.sent(),f=h.lastEditInfoEnabled,b=a.objectIdField,g=a.typeIdField,n=a.globalIdField,t=a.relationships,l.includes(c,"*")?[2,
["*"]]:f?[4,e.getFeatureEditFields(a)]:[3,3];case 2:return r=m.sent(),[3,4];case 3:r=[],m.label=4;case 4:return u=r,q=e.fixFields(a.fields,d.__spreadArrays(c,u)),g&&q.push(g),q&&b&&e.hasField(a.fields,b)&&-1===q.indexOf(b)&&q.push(b),q&&n&&e.hasField(a.fields,n)&&-1===q.indexOf(n)&&q.push(n),t&&t.forEach(function(b){b=b.keyField;q&&b&&e.hasField(a.fields,b)&&-1===q.indexOf(b)&&q.push(b)}),[2,q]}})})};a.getFetchPopupTemplate=function(a,d){return a.popupTemplate?a.popupTemplate:k.isSome(d)&&d.defaultPopupTemplateEnabled&&
k.isSome(a.defaultPopupTemplate)?a.defaultPopupTemplate:null}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("require exports tslib ../../../core/arrayUtils ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/screenUtils ../../../core/SetUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ../../../layers/support/CodedValue ../../../layers/support/domains ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/extentUtils ../support/geometryUtils ../support/orientedBoundingBox ../support/projectionUtils ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O,N,S,P,U,Z,V,T){var Y=h.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),X=S.plane.create();n=function(a){function h(){var b=null!==a&&a.apply(this,arguments)||this;b.maximumPointCount=4E6;b.slicePlaneEnabled=!1;b._renderer=null;b._rendererAdded=!1;b._renderedNodes=new Set;b._nodeScales=new Map;b._updateViewNeeded=!0;b._lodFactor=1;b._maxLoggedBoxWarnings=5;b._pageMultiplier=1;b._nodeLoadEpoch=0;b._indexQueue=[];
b._workQueue=[];b._idleQueue=new C.default;b._indexPagesLoading=new Map;b._loadingNodes=new Map;b._recalcWork=!0;b._layerIsVisible=!1;b._codedDomainPopulationPromise=null;b._codedDomainPopulationAbortController=null;b._totalWork=0;b._index=null;b._loadingInitNodePage=!1;b._nodeIdArray=[];return b}d.__extends(h,a);Object.defineProperty(h.prototype,"pointScale",{get:function(){var a=K.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return a&&null!=a.scaleFactor?a.scaleFactor:1},enumerable:!1,
configurable:!0});Object.defineProperty(h.prototype,"useRealWorldSymbolSizes",{get:function(){var a=K.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return a&&null!=a.useRealWorldSymbolSizes?a.useRealWorldSymbolSizes:!1},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"pointSize",{get:function(){var a=K.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return a&&null!=a.size?a.size:0},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"inverseDensity",
{get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"availableFields",{get:function(){var a=K.getRendererInfo(this.layer),b=new Set;a.primaryAttribute&&b.add(a.primaryAttribute.name);a.modulationAttribute&&b.add(a.primaryAttribute.name);if(a=K.getFilterInfo(this.layer))for(var c=0;c<a.length;c++)b.add(a[c].attributeInfo.name);if(this.layer.outFields)for(a=0,c=A.unpackFieldNames(this.layer.fields,
this.layer.outFields);a<c.length;a++)b.add(c[a]);return g.valuesOfSet(b)},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"_clippingBox",{get:function(){if(!this.view||!this.view.clippingArea)return null;var a=v.create();return N.projectToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?a:null},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"_elevationOffset",{get:function(){var a=this.layer&&this.layer.elevationInfo;if(a&&"absolute-height"===
a.mode){var b=t.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=E.getMetersPerUnit(a.unit);return m.unwrapOr(a.offset,0)*c/b}return 0},enumerable:!1,configurable:!0});h.prototype.initialize=function(){var a=this,b=this.view.resourceController,c=b.scheduler;this._worker=new F.PointCloudWorkerHandle(c);this.addResolvingPromise(this._worker.promise);this._tmpPoint=z.makeDehydratedPoint(0,0,0,this.layer.spatialReference);H.checkPointCloudLayerValid(this.layer);H.checkPointCloudLayerCompatibleWithView(this.layer,
this.view);this._streamDataRequester=b.createStreamDataRequester(2);this._initRenderer();var b=this._initNodePages(),d=this.view.resourceController.memoryController;this._memCache=d.getMemCache(this.layer.uid);this.updatingHandles.add(this,"_clippingBox",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this,"_elevationOffset",function(){return a._elevationOffsetChanged()},2);this.updatingHandles.add(this.layer,"renderer",function(){return a._rendererChanged()},2);this.updatingHandles.add(this.layer,
"filters",function(){return a._reload()},2);this.updatingHandles.add(this.layer,"outFields",function(){return a._reload()},2);this.updatingHandles.add(this.layer,"scaleRangeId",function(){return a._setUpdateViewNeeded()});this.updatingHandles.add(this,"clippingArea",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this.view.state,"camera",function(){return a._setUpdateViewNeeded()});this.handles.add([this.view.basemapTerrain.on("scale-change",function(b){return a._scaleUpdateHandler(b)}),
d.events.on("quality-changed",function(){return a._setUpdateViewNeeded()})]);this.addResolvingPromise(b);this.when(function(){a.handles.add([c.registerTask(T.Task.POINT_CLOUD_LAYER,function(b){return a._process(b)},function(){return a._needsUpdate()}),c.registerIdleStateCallbacks(function(){return a._idleBegin()},function(){return a._idleEnd()}),a.updatingHandles.add(a,"suspended",function(b){b?a._clearNodeState():a._setUpdateViewNeeded()},2)])},function(){a.updatingHandles.removeAll();a.handles.removeAll()})};
h.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};h.prototype.destroy=function(){this.cancelLoading();this._worker&&(this._worker.destroy(),this._worker=null);this._destroyRenderer();this._memCache.destroy();this._memCache=null;this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null);this._codedDomainPopulationPromise=null};h.prototype._initRenderer=function(){var a=this;
this._renderer=new Q.PointRenderer({createGraphic:function(b,c,d){return a._createGraphic(b,c,d)}});this._renderer.layerUid=this.layer.uid;this.updatingHandles.add(this,"_clippingBox",function(b){return a._renderer.clippingBox=b},2);this.updatingHandles.add(this,"suspended",function(b){return a._setPointsVisible(!b)},2);this.updatingHandles.add(this,"pointScale",function(b){return a._renderer.scaleFactor=b},2);this._renderer.minSizePx=Math.sqrt(2);this.updatingHandles.add(this,"useRealWorldSymbolSizes",
function(b){return a._renderer.useRealWorldSymbolSizes=b},2);this.updatingHandles.add(this,"pointSize",function(c){var d=b.pt2px(c);a._renderer.size=c;a._renderer.sizePx=d},2);this.updatingHandles.add(this,"slicePlaneEnabled",function(b){return a._renderer.slicePlane=b},2);this.updatingHandles.add(this,"inverseDensity",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this,"maximumPointCount",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",
function(b){a._lodFactor=b;a._setUpdateViewNeeded()},2)};h.prototype._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};h.prototype._createGraphic=function(a,b,c){var d=m.isSome(a.pointIdFilterMap)?a.pointIdFilterMap[b]:b;c=this.view.computeMapPointFromVec3d(c);var e=this._createGraphicAttributes(a,d);return new M.PointGraphic({pointCloudMetadata:{nodeId:a.id,pointIndexInNode:b,attributePointIndexInNode:d,epoch:this._nodeLoadEpoch},geometry:c,attributes:e,layer:this.layer,
sourceLayer:this.layer})};h.prototype._createGraphicAttributes=function(a,b){var c={},d=0;for(a=a.attributes;d<a.length;d++){var e=a[d];this._encodeGraphicAttribute(e.attributeInfo,e.values,b,c)}return c};h.prototype._encodeGraphicAttribute=function(a,b,c,d){var e=a.storageInfo&&a.storageInfo.attributeValues,f=e?e.valuesPerElement:1;if(1===f)d[a.name]=b[c];else if("UInt8"===e.valueType&&4>=f){for(var e=0,g=c*=f;g<c+f;g++)e=(e<<8)+b[g];d[a.name]=e}else d[a.name]=void 0};h.prototype._setPointsVisible=
function(a){a&&!this._rendererAdded?(this.view._stage.addRenderPlugin([4],this._renderer),this._rendererAdded=!0):!a&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};h.prototype._rendererChanged=function(){this._renderer.useFixedSizes=K.rendererUsesFixedSizes(this.layer.renderer);this._reload()};h.prototype._reload=function(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()};h.prototype._elevationOffsetChanged=function(){this._clearNodeState();
this._memCache.clear();this._initNodePages()};h.prototype._scaleUpdateHandler=function(a){var b=this;this.layer.minScale||this.layer.maxScale?U.boundingRectToBoundingRect(a.extent,a.spatialReference,ca,this.layer.spatialReference)&&(this._nodeScales.forEach(function(c,d){b._renderedNodes.has(d)?(c=b._index.getNode(d),w.containsPoint(ca,c.obb.center)&&b._nodeScales.set(d,a.scale)):b._nodeScales.delete(d)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};h.prototype.displayNodes=function(a){this._workQueue=
J.nodeDiff(l.keysOfSet(this._renderedNodes),a,this._index);J.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,this._index);J.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<a.length||this._loadingInitNodePage;this.notifyChange("suspended")};h.prototype.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};h.prototype._cancelNodeLoading=function(){var a=[];
this._loadingNodes.forEach(function(b){return a.push(b.abortController)});this._loadingNodes.clear();for(var b=0;b<a.length;b++)a[b].abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};h.prototype._updateQueues=function(){var a=this,b=new Set;this._workQueue.forEach(function(a){return a.load.forEach(function(a){return b.add(a)})});var c=[],d=new Map;this._loadingNodes.forEach(function(a,e){b.has(e)?d.set(e,a):c.push(a)});this._loadingNodes=
d;for(var e=0;e<c.length;e++)c[e].abortController.abort();this._workQueue=this._workQueue.filter(function(b){var c=0;for(b=b.load;c<b.length;c++)if(a._loadingNodes.has(b[c]))return a._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};h.prototype._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(function(a){return a.abortController.abort()});this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};
h.prototype._clearNodeState=function(){var a=this;this._nodeLoadEpoch++;this._renderedNodes.forEach(function(b){return a._removeFromRenderer(b)});this._cancelNodeLoading()};h.prototype._idleBegin=function(){this._setUpdateViewNeeded()};h.prototype._idleEnd=function(){this._setUpdateViewNeeded()};h.prototype._needsUpdate=function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||0<this._idleQueue.length};h.prototype._process=
function(a){var b=this;if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,a=this._isRootNodeVisible(),a!==this._layerIsVisible&&(this._layerIsVisible=a,this.notifyChange("suspended")),this._updateLoading());else{for(a.run(function(){return b._updateWorkQueues()});0<this._indexQueue.length&&a.run(function(){return b._processIndexQueue()}););for(this._processWorkQueue(a);0<this._idleQueue.length&&a.run(function(){return b._idleQueue.process()}););}};h.prototype._processIndexQueue=
function(){var a=this,b=this._indexQueue.shift(),c=this._loadNodePage(b);this._indexPagesLoading.set(b,c);c.promise.then(function(c){a._index.addPage(b,c,a._elevationOffset);a._setUpdateViewNeeded()}).then(function(){a._indexPagesLoading.delete(b)},function(){a._indexPagesLoading.delete(b)});return!0};h.prototype._processWorkQueue=function(a){for(;!a.done;){var b=this._scheduleWorkEntry();if(m.isNone(b))break;this._processWorkEntry(b);a.madeProgress()}};h.prototype._scheduleWorkEntry=function(){for(var a=
this,b=this._workQueue.length;b--;){var c=this._workQueue.shift();if(k.find(c.remove,function(b){return!a._renderedNodes.has(b)}))this._workQueue.push(c);else return c}return null};h.prototype._processWorkEntry=function(a){var b=this;if(0===a.load.length)for(var c=0,d=a.remove;c<d.length;c++)this._removeFromRenderer(d[c]);else f.all(a.load.map(function(a){var c=f.createAbortController(),d=b._memCache.pop(a.toString());m.isSome(d)?b._loadingNodes.set(a,{abortController:c,promise:f.resolve(d)}):b._loadingNodes.has(a)||
b._loadingNodes.set(a,{abortController:c,promise:b.loadNode(a,c.signal)});return b._loadingNodes.get(a).promise})).then(function(c){for(var d=0;d<a.load.length;d++)if(c[d]){var e=b._setupRendererData(a.load[d],c[d]);b._addToRenderer(e)}c=0;for(d=a.remove;c<d.length;c++)b._removeFromRenderer(d[c])}).catch(function(){}).then(function(){for(var c=0,d=a.load;c<d.length;c++)b._loadingNodes.delete(d[c]);b._updateLoading();b._recalcWork&&0===b._idleQueue.length&&0===b._indexQueue.length&&0===b._loadingNodes.size&&
(b._recalcWork=!1,b._setUpdateViewNeeded())}),this._updateLoading()};h.prototype.populateClassCodeCodedDomain=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,f,g,h;return d.__generator(this,function(d){switch(d.label){case 0:return c=this.layer.fieldsIndex.get("CLASS_CODE"),!c||c.domain||-1===a.indexOf(c.name)?[2]:[4,e.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:b}))];case 1:f=d.sent();if(!1===f.ok)return[2];h=(g=f.value)&&g.labels&&g.labels.labels;if(!h||!Array.isArray(h))return[2];
c.domain=new B.CodedValueDomain({name:"CLASS_CODE",codedValues:h.map(function(a){return new x.default({code:a.value,name:a.label})})});return[2]}})})};h.prototype.prepareFetchPopupFeatures=function(a){return d.__awaiter(this,void 0,void 0,function(){var b=this;return d.__generator(this,function(c){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=f.createAbortController(),this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(a,this._codedDomainPopulationAbortController.signal).then(function(){b._codedDomainPopulationAbortController=
null}));return[2,this._codedDomainPopulationPromise]})})};h.prototype.whenGraphicAttributes=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,g,h,k,m,l=this;return d.__generator(this,function(n){switch(n.label){case 0:return c=this._splitGraphicsPerNode(a),g=this.layer.attributeStorageInfo,h=b.map(function(a){return K.getAttributeInfo(g,a)}),k=function(a,b){return d.__awaiter(l,void 0,void 0,function(){var c,f=this;return d.__generator(this,function(g){switch(g.label){case 0:return c=
this._index.getNode(b),[4,e.forEach(h,function(b){return d.__awaiter(f,void 0,void 0,function(){var e,f,g,h,k,m;return d.__generator(this,function(d){switch(d.label){case 0:return b.useElevation?[4,this._loadElevationAttributeFromGeometry(c.resourceId)]:[3,2];case 1:return f=d.sent(),[3,4];case 2:return[4,this._loadAndParseAttribute(c,b)];case 3:f=d.sent(),d.label=4;case 4:e=f;if(!e)return[2];g=0;for(h=a;g<h.length;g++)k=h[g],this._isValidPointGraphic(k)&&(m=k.pointCloudMetadata.attributePointIndexInNode,
this._encodeGraphicAttribute(b,e,m,k.attributes));return[2]}})})})];case 1:return g.sent(),[2]}})})},m=[],c.forEach(function(a,b){m.push(k(a,b))}),[4,f.eachAlways(m)];case 1:return n.sent(),[2,a]}})})};h.prototype._isValidPointGraphic=function(a){return a instanceof M.PointGraphic&&a.pointCloudMetadata&&a.pointCloudMetadata.epoch===this._nodeLoadEpoch};h.prototype._splitGraphicsPerNode=function(a){for(var b=new Map,c=0;c<a.length;c++){var d=a[c];if(this._isValidPointGraphic(d)){var e=d.pointCloudMetadata,
f=b.get(e.nodeId);f?f.push(d):b.set(e.nodeId,[d])}}return b};h.prototype._loadAndParseAttribute=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c;return d.__generator(this,function(d){switch(d.label){case 0:return[4,this._loadAttribute(a.resourceId,b,null)];case 1:return c=d.sent(),[2,m.isSome(c)?L.getAttributeValues({attributeInfo:b,buffer:c},null,a.vertexCount):null]}})})};h.prototype._loadElevationAttributeFromGeometry=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,
c,e,f;return d.__generator(this,function(d){switch(d.label){case 0:return b=this.layer.store.defaultGeometrySchema,e=L.readGeometry,f=[b],[4,this._loadGeometry(a,null)];case 1:return c=e.apply(void 0,f.concat([d.sent()])),[2,L.elevationFromPositions(c,c.length/3)]}})})};h.prototype.highlight=function(a){var b=this;if(!a)return{remove:function(){},pause:function(){},resume:function(){}};a=c.isCollection(a)?a.toArray():Array.isArray(a)?a:[a];return this._renderer.highlight(a.map(function(a){return b._graphicToPointDefinition(a)}))};
h.prototype._graphicToPointDefinition=function(a){if(!this._isValidPointGraphic(a))return null;var b=a.pointCloudMetadata;a=b.nodeId;b=b.pointIndexInNode;return null!=a&&null!=b?{nodeId:a,pointId:b}:null};h.prototype._computeWork=function(){for(var a=0,b=0,c=this._workQueue;b<c.length;b++)var d=c[b],a=a+(d.load.length+d.remove.length);a+=this._loadingNodes.size;a+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;a+=this._loadingInitNodePage?100:0;return a+=this._updateViewNeeded?
100:0};Object.defineProperty(h.prototype,"updatingProgressValue",{get:function(){if(this.suspended)return this._updateViewNeeded?0:1;var a=this._computeWork();return 1-Math.min(this._totalWork,a)/this._totalWork},enumerable:!1,configurable:!0});h.prototype._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")};h.prototype.canResume=function(){return a.prototype.canResume.call(this)&&this._layerIsVisible};h.prototype.isUpdating=function(){return this.suspended?
this._updateViewNeeded:0<this._computeWork()};h.prototype._initNodePages=function(){var a=this,b=this.layer.store.index;this._index=new I(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,b.nodesPerPage||b.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=b.nodesPerPage?1:b.nodePerIndexBlock;
return this._loadNodePage(0).promise.then(function(b){a._index.addPage(0,b,a._elevationOffset);a._loadingInitNodePage=!1;a._setUpdateViewNeeded()})};h.prototype._loadNodePage=function(a){var b=this,c=f.createAbortController();return{promise:this._requestJSON(this.baseUrl+"/nodepages/"+a*this._pageMultiplier,c.signal).then(function(c){return c.nodes.map(function(c,d){return{resourceId:null!=c.resourceId?c.resourceId:a*b._index.pageSize+d,obb:c.obb,firstChild:c.firstChild,childCount:c.childCount,vertexCount:null!=
c.vertexCount?c.vertexCount:c.pointCount,lodThreshold:null!=c.lodThreshold?c.lodThreshold:c.effectiveArea}})}),abortController:c}};h.prototype._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;for(var a=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),b=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),e=Math.sqrt(d/(.75*b));d>b;)a*=e,c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),
e=Math.sqrt(2);this.displayNodes(c);this._updateViewNeeded=!1;this._updateLoading();return!0};h.prototype._computePointCount=function(a){for(var b=0,c=0;c<a.length;c++){var d=this._index.getNode(a[c]);d&&(b+=d.vertexCount)}return b};h.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};h.prototype._isRootNodeVisible=function(){var a=!1;this._traverseVisible({frustumPlanes:this.view.state.camera.frustum.planes,clippingBox:this._clippingBox},{predicate:function(b,
c,d){a=d;return!1},pageMiss:function(){}});return a};h.prototype._computeNodesForMinimumDensity=function(a){var b=this,c=this.view.state.camera,d=c.frustum,e=this._clippingBox,f=c.viewForward,g=r.vec3.dot(f,c.eye),h=S.plane.fromNormalAndOffset(f,-g,X),k=c.perScreenPixelRatio/2,m=a*a,l=this._nodeIdArray;l.length=0;a=V.extractSafeScaleBounds(this.layer);var n=a.minScale,p=a.maxScale,q=0===n&&0===p?function(a){return l.push(a)}:function(a){var c=b._getScale(a);V.scaleBoundsPredicate(c,n,p)&&l.push(a)};
this._traverseVisible({frustumPlanes:d.planes,clippingBox:e},{predicate:function(a,c,d){if(!d)return!1;if(0===c.childCount)return q(a),!1;d=b._index.getRenderObb(a);return b._computeAveragePixelArea(d,c.lodThreshold,c.vertexCount,h,k)<=m?(q(a),!1):!0},pageMiss:function(a,c){q(a);0>b._indexQueue.indexOf(c)&&b._indexQueue.push(c)}});return l};h.prototype._getScale=function(a){var b=this._nodeScales.get(a);null==b&&(b=this._index.getNode(a).obb.center,this._tmpPoint.x=b[0],this._tmpPoint.y=b[1],this._tmpPoint.z=
b[2],b=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(a,b));return b};h.prototype._computeAveragePixelArea=function(a,b,c,d,e){a=Math.max(1E-7,P.minimumDistancePlane(a,d));return b/(a*a)/(4*e*e)/c};h.prototype.loadNode=function(a,b){try{return this.loadNodeAsync(a,b)}catch(fa){throw f.isAbortError(fa)||Y.error(fa),fa;}};h.prototype.loadAdditionalUserAttributes=function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var e,h,k,l,n,p,r,q,t,u;return d.__generator(this,
function(d){switch(d.label){case 0:e=this.layer.outFields;if(!e)return[2,[]];h=A.unpackFieldNames(this.layer.fields,e);k=g.SetFromValues(a.map(function(a){return m.isSome(a)?a.name:null}));l=this.layer.attributeStorageInfo;n=[];p=0;for(r=h;p<r.length;p++)q=r[p],k.has(q)||(t=K.getAttributeInfo(l,q))&&n.push(b(t));return[4,f.eachAlwaysValues(n)];case 1:return u=d.sent(),f.throwIfAborted(c),[2,m.mapSome(u,function(a){return a})]}})})};h.prototype.loadNodeAsync=function(a,b){return d.__awaiter(this,void 0,
void 0,function(){var c,e,g,h,k,l=this;return d.__generator(this,function(n){c=this._index.getNode(a);e=K.getRendererInfo(this.layer);g=K.getFilterInfo(this.layer);h=c.resourceId;k=function(a){return d.__awaiter(l,void 0,void 0,function(){var c;return d.__generator(this,function(d){switch(d.label){case 0:return m.isNone(a)?[2,null]:a.useElevation?[2,{attributeInfo:a,buffer:null}]:[4,this._loadAttribute(h,a,b)];case 1:return c=d.sent(),[2,m.isSome(c)?{attributeInfo:a,buffer:c}:null]}})})};return[2,
this._idleQueue.push(function(){return d.__awaiter(l,void 0,void 0,function(){var c,m,l,n,p,r,q,t,u,v,w,x,B,A,z;return d.__generator(this,function(C){switch(C.label){case 0:return c=this._loadGeometry(h,b),m=e.primaryAttribute,l=e.modulationAttribute,n=k(m),p=k(l),r=g.map(function(a){return a.attributeInfo}),q=r.map(function(a){return k(a)}),t=this.loadAdditionalUserAttributes(d.__spreadArrays([m,l],r),k,b),[4,f.all([c,n,p,f.all(q),t])];case 1:return u=C.sent(),v=u[0],w=u[1],x=u[2],B=u[3],A=u[4],
f.throwIfAborted(b),z={geometryBuffer:v,primaryAttributeData:w,modulationAttributeData:x,filterAttributesData:B,userAttributesData:A,schema:this.layer.store.defaultGeometrySchema,rendererInfo:e,filterInfo:g,obb:this._index.getRenderObb(a),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()},[2,this._worker.invoke(z,b)]}})})})]})})};h.prototype._loadGeometry=function(a,b){return d.__awaiter(this,void 0,void 0,
function(){return d.__generator(this,function(c){return[2,this._requestBinary(this.baseUrl+"/nodes/"+a+"/geometries/0",b)]})})};h.prototype._loadAttribute=function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var e;return d.__generator(this,function(d){if(m.isNone(b)||!b.storageInfo)return[2,null];e=b.storageInfo.key;return[2,this._requestBinary(this.baseUrl+"/nodes/"+a+"/attributes/"+e,c)]})})};h.prototype._requestJSON=function(a,b){return this._streamDataRequester.request(a,"json",{query:{f:"json"},
signal:b})};h.prototype._requestBinary=function(a,b){return this._streamDataRequester.request(a,"binary",{signal:b})};h.prototype._removeFromRenderer=function(a){if(this._renderedNodes.has(a)){var b=this._renderer.removeNode(a);this._renderedNodes.delete(a);this._nodeScales.delete(a);this._memCache.put(b.id.toString(),b,5*b.coordinates.length+128)}};h.prototype._addToRenderer=function(a){this._renderedNodes.has(a.id)||(this._renderedNodes.add(a.id),this._renderer.addNode(a))};h.prototype._setupRendererData=
function(a,b){var c=this._index.getNode(a),d=Math.sqrt(c.lodThreshold/c.vertexCount),e=this._index.getRenderObb(a);if(Q.PointRenderer.isInstanceOfNode(b))return b.splatSize=d,b.obb=e,b.origin=q.vec3f32.clone(b.obb.center),b;if(b.obb.halfSize[0]>1.001*e.halfSize[0]||b.obb.halfSize[1]>1.001*e.halfSize[1]||b.obb.halfSize[2]>1.001*e.halfSize[2]){if(0<this._maxLoggedBoxWarnings){var f=function(a){return"["+a.halfSize[0]+", "+a.halfSize[1]+", "+a.halfSize[2]+"]"};Y.warn("Node "+a+" reported bounding box too small. got "+
f(e)+" but points cover "+f(b.obb));0===--this._maxLoggedBoxWarnings&&Y.warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(a,b.obb)}return{id:a,coordinates:b.points,origin:q.vec3f32.clone(e.center),rgb:b.rgb,attributes:b.attributes,pointIdFilterMap:b.pointIdFilterMap,highlights:null,splatSize:d,obb:e,isLeaf:0===c.childCount}};h.prototype.getUsedMemory=function(){var a=0;this._renderer.forEachNode(function(b){a+=ba;a+=p.estimateSize(b.coordinates);var c=
0;for(b=b.attributes;c<b.length;c++){var d=b[c].values;p.isArrayBuffer(d.buffer)&&(a+=p.estimateSize(d))}});return a};h.prototype.getUnloadedMemory=function(){var a=this,b=this._renderedNodes.size;if(4>b)return 0;for(var c=l.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount}),d=this._loadingNodes.size,e=0;e<this._workQueue.length;e++)d+=this._workQueue[e].load.length,d-=this._workQueue[e].remove.length;if(0>d)return 0;e=d*c/b;b=(this.getUsedMemory()-b*ba)/
c;return e*b+d*ba};h.prototype.ignoresMemoryFactor=function(){return!1};Object.defineProperty(h.prototype,"performanceInfo",{get:function(){var a=this;return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:l.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount},0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,
"Idle Queue":this._idleQueue.length}},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"test",{get:function(){return{index:this._index,visibleNodes:this._renderedNodes}},enumerable:!1,configurable:!0});d.__decorate([u.property()],h.prototype,"layer",void 0);d.__decorate([u.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],h.prototype,"baseUrl",void 0);d.__decorate([u.property({readOnly:!0,dependsOn:["layer.renderer"]})],h.prototype,"pointScale",null);d.__decorate([u.property({readOnly:!0,
dependsOn:["layer.renderer"]})],h.prototype,"useRealWorldSymbolSizes",null);d.__decorate([u.property({readOnly:!0,dependsOn:["layer.renderer"]})],h.prototype,"pointSize",null);d.__decorate([u.property({readOnly:!0,dependsOn:["layer.renderer"]})],h.prototype,"inverseDensity",null);d.__decorate([u.property()],h.prototype,"maximumPointCount",void 0);d.__decorate([u.property({readOnly:!0,dependsOn:["layer.renderer","layer.filters","layer.outFields"]})],h.prototype,"availableFields",null);d.__decorate([u.property({readOnly:!0,
dependsOn:["view.clippingArea"]})],h.prototype,"_clippingBox",null);d.__decorate([u.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],h.prototype,"_elevationOffset",null);d.__decorate([u.property({type:Boolean})],h.prototype,"slicePlaneEnabled",void 0);d.__decorate([u.property()],h.prototype,"updating",void 0);d.__decorate([u.property(R.updatingProgress)],h.prototype,"updatingProgress",void 0);d.__decorate([u.property({readOnly:!0,dependsOn:["suspended"]})],h.prototype,"updatingProgressValue",
null);return h=d.__decorate([u.subclass("esri.views.3d.layers.PointCloudLayerView3D")],h)}(O.PopupSceneLayerView(G.LayerView3D(Z)));var ca=w.create(),ba=160;return n})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["require","exports","tslib","../../../core/maybe","../support/WorkerHandle"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.PointCloudWorkerHandle=void 0;n=function(a){function c(c){return a.call(this,"PointCloudWorker","transform",c)||this}d.__extends(c,
a);c.prototype.getTransferList=function(a){var c=[a.geometryBuffer];l.isSome(a.primaryAttributeData)&&a.primaryAttributeData.buffer&&c.push(a.primaryAttributeData.buffer);l.isSome(a.modulationAttributeData)&&a.modulationAttributeData.buffer&&c.push(a.modulationAttributeData.buffer);if(l.isSome(a.filterAttributesData))for(var d=0,b=a.filterAttributesData;d<b.length;d++){var e=b[d];l.isSome(e)&&e.buffer&&c.push(e.buffer)}d=0;for(a=a.userAttributesData;d<a.length;d++)e=a[d],e.buffer&&c.push(e.buffer);
return c};return c}(k.WorkerHandle);a.PointCloudWorkerHandle=n})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("require exports ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf32 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/geodesicConstants ../../../../geometry/support/webMercatorUtils ../../../../tasks/support/Query ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox ../../support/projectionUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G){function F(a){return a&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10)}function H(a,b){var c=b[0],d=b[1];b=b[3];var e=a[0]-c,c=c-a[2],f=a[1]-d;a=d-a[3];var d=Math.max(e,c,0),g=Math.max(f,a,0),d=d*d+g*g;return d>b*b?0:0<d?1:-Math.max(e,c,f,a)>b?3:2}function J(a,b,c){var d=[],e=c&&c.missingFields;c=c&&c.originalFields;for(var f=0;f<a.length;f++){for(var g=a[f],h=g.toLowerCase(),k=!1,m=0,l=b;m<l.length;m++){var n=l[m];if(h===n.name.toLowerCase()){d.push(n.name);
k=!0;c&&c.push(g);break}}!k&&e&&e.push(g)}return d}function I(a,b){return a.filter(function(a){return a!==b}).concat([b])}function K(a,b,c,d){b.sort(function(a,b){return a.attributes[c]-b.attributes[c]});var e=b.map(function(a){return a.attributes[c]}),f=[],g=J(d,a.fields,{originalFields:f});return L(a,e,g).then(function(a){for(var c=0;c<b.length;c++){var d=b[c],e=a[c],h={};if(d.attributes)for(var k in d.attributes)h[k]=d.attributes[k];for(var m=0;m<f.length;m++)h[f[m]]=e[g[m]];d.attributes=h}return b})}
function L(a,b,d){var e=a.capabilities.query.maxRecordCount;if(null!=e&&b.length>e)return e=l.splitIntoChunks(b,e),c.all(e.map(function(b){return L(a,b,d)})).then(l.flatten);e=new z({objectIds:b,outFields:d,orderByFields:[a.objectIdField]});return a.queryFeatures(e).then(function(a){if(a&&a.features&&a.features.length===b.length)return a.features.map(function(a){return a.attributes});throw new k("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}function M(a,
b,e,f,g){for(var h=[],k=0;k<b.length;k++){var m=b[k];m&&-1!==g.indexOf(m.name)&&h.push({url:a+"/nodes/"+e.resources.attributes+"/attributes/"+m.key+"/0",storageInfo:m})}return c.eachAlways(h.map(function(a){return d(a.url,{responseType:"array-buffer"}).then(function(b){return x.readBinaryAttribute(a.storageInfo,b.data)})})).then(function(a){for(var b=[],c=0;c<f.length;c++){for(var d=f[c],e={},g=0;g<a.length;g++)null!=a[g].value&&(e[h[g].storageInfo.name]=Q(a[g].value,d));b.push(e)}return b})}function Q(a,
b){if(!a)return null;b=a[b];return h.isInt16Array(a)?b===V?null:b:h.isInt32Array(a)?b===T?null:b:b!==b?null:b}function R(a){var b=new u(F(a.store.indexCRS||a.store.geographicCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function O(a){var b=new u(F(a.store.vertexCRS||a.store.projectedCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function N(a,b,c){if(!w.canProject(a,b))throw new k("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",
{});if("local"===c&&a.isGeographic)throw new k("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{});}function S(a,b,c){var d=R(a);a=O(a);N(d,b,c);N(a,b,c)}function P(a,c,d,e,f){void 0===f&&(f=0);if(e===X)if(c.isGeographic)e=1+Math.max(0,f)/(v.earthRadius+a.center[2]),p.vec3.set(d.center,a.center[0],a.center[1],a.center[2]+f),G.bufferToBuffer(d.center,c,0,d.center,X,0,1),b.quat.copy(d.quaternion,a.quaternion),b.quat.conjugate(ba,a.quaternion),p.vec3.set(fa,
0,0,1),p.vec3.transformQuat(fa,fa,ba),p.vec3.set(fa,a.halfSize[0]*Math.abs(fa[0]),a.halfSize[1]*Math.abs(fa[1]),a.halfSize[2]*Math.abs(fa[2])),p.vec3.scale(fa,fa,v.earthInverseFlattening),p.vec3.add(d.halfSize,a.halfSize,fa),p.vec3.scale(d.halfSize,d.halfSize,e);else{E.corners(a,ga);p.vec3.set(d.center,a.center[0],a.center[1],a.center[2]+f);G.computeLinearTransformation(c,d.center,ca,X);p.vec3.set(d.center,ca[12],ca[13],ca[14]);e=2*Math.sqrt(1+ca[0]+ca[5]+ca[10]);ba[0]=(ca[6]-ca[9])/e;ba[1]=(ca[8]-
ca[2])/e;ba[2]=(ca[1]-ca[4])/e;ba[3]=.25*e;b.quat.multiply(d.quaternion,ba,a.quaternion);b.quat.conjugate(ba,d.quaternion);for(var g=e=a=0,h=0,k=ga;h<k.length;h++){var m=k[h];m[2]+=f;G.bufferToBuffer(m,c,0,m,X,0,1);p.vec3.sub(fa,m,d.center);p.vec3.transformQuat(fa,fa,ba);a=Math.max(a,Math.abs(fa[0]));e=Math.max(e,Math.abs(fa[1]));g=Math.max(g,Math.abs(fa[2]))}p.vec3.set(d.halfSize,a,e,g)}else a===d?(d.center[2]+=f,G.bufferToBuffer(d.center,c,0,d.center,e,0,1)):(p.vec3.set(d.center,a.center[0],a.center[1],
a.center[2]+f),G.bufferToBuffer(d.center,c,0,d.center,e,0,1),b.quat.copy(d.quaternion,a.quaternion),p.vec3.copy(d.halfSize,a.halfSize))}Object.defineProperty(a,"__esModule",{value:!0});a.computeVisibilityObb=a.transformObb=a.addWraparound=a.getSymbolInfo=a.SymbolInfo=a.transparentEdgeMaterial=a.rendererNeedsTextures=a.checkPointCloudLayerCompatibleWithView=a.checkPointCloudLayerValid=a.checkSceneLayerCompatibleWithView=a.checkSceneLayerValid=a.checkSpatialReferences=a.checkSpatialReference=a.getCacheKeySuffix=
a.getVertexCrs=a.getIndexCrs=a.getCachedAttributeValue=a.whenGraphicAttributes=a.findFieldsCaseInsensitive=a.intersectBoundingBoxWithMbs=a.intersectBoundingRectWithMbs=a.getClipAABB=a.filterInPlace=a.findIntersectingNodes=a.selectEncoding=a.extractWkid=a.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=a.DDS_ENCODING_STRING=void 0;a.DDS_ENCODING_STRING="image/vnd-ms.dds";a.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"];a.extractWkid=F;a.selectEncoding=function(b,c){if(c)for(c=0;c<b.length;c++)if(b[c].encoding===
a.DDS_ENCODING_STRING)return b[c];for(c=0;c<b.length;c++)if(-1<a.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(b[c].encoding))return b[c];return null};a.findIntersectingNodes=function(a,b,c,d,e,f){e.traverse(c,function(c){var e=c.mbs;b!==d&&(e=Z,G.mbsToMbs(c.mbs,d,e,b));e=H(a,e);if(0===e)return!1;f(c,e);return!0})};a.filterInPlace=function(a,b,c){for(var d=0,e=0,f=0;f<b.length&&d<a.length;f++)a[d]===b[f]&&(c(f)&&(a[e]=a[d],e++),d++);a.length=e};var U=r.create();a.getClipAABB=function(a,b){if(0===
b.rotationScale[1]&&0===b.rotationScale[2]&&0===b.rotationScale[3]&&0===b.rotationScale[5]&&0===b.rotationScale[6]&&0===b.rotationScale[7])return U[0]=(a[0]-b.position[0])/b.rotationScale[0],U[1]=(a[1]-b.position[1])/b.rotationScale[4],U[2]=(a[2]-b.position[2])/b.rotationScale[8],U[3]=(a[3]-b.position[0])/b.rotationScale[0],U[4]=(a[4]-b.position[1])/b.rotationScale[4],U[5]=(a[5]-b.position[2])/b.rotationScale[8],U};var Z=t.vec4f64.create();a.intersectBoundingRectWithMbs=H;a.intersectBoundingBoxWithMbs=
function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=a[0]-c,c=c-a[3],g=a[1]-d,d=d-a[4],h=a[2]-e;a=e-a[5];var e=Math.max(f,c,0),k=Math.max(g,d,0),m=Math.max(h,a,0),e=e*e+k*k+m*m;return e>b*b?0:0<e?1:-Math.max(f,c,g,d,h,a)>b?3:2};a.findFieldsCaseInsensitive=J;a.whenGraphicAttributes=function(a,b,d,f,g,h){!0===(h&&h.populateObjectId)&&(f=I(f,d));if(0===b.length)return c.resolve(b);h=a.associatedLayer;var m=a.attributeStorageInfo;if(e.isSome(h)&&h.loaded)return K(h,b,d,f);if(m){b=g(b);if(!b)return c.reject(new k("scenelayer:features-not-loaded",
"Tried to query attributes for unloaded features"));var n=a.parsedUrl.path;return c.all(b.map(function(a){return M(n,m,a.node,a.indices,f).then(function(b){for(var c=0;c<a.graphics.length;c++){var d=a.graphics[c],e=b[c];if(d.attributes)for(var f in d.attributes)f in e||(e[f]=d.attributes[f]);d.attributes=e}return a.graphics})})).then(l.flatten)}return c.reject(new k("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var V=-Math.pow(2,15),T=-Math.pow(2,
31);a.getCachedAttributeValue=Q;a.getIndexCrs=R;a.getVertexCrs=O;a.getCacheKeySuffix=function(a,b){return b===G.SphericalECEFSpatialReference?"@ECEF":a.equals(b)?"":null!=b.wkid?"@"+b.wkid:null};a.checkSpatialReference=N;a.checkSpatialReferences=S;a.checkSceneLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(b=a.store.defaultGeometrySchema,b=!!(null!=b.geometryType&&"triangles"!==b.geometryType||null!=b.topology&&"PerAttributeArray"!==b.topology||null==b.vertexAttributes||
null==b.vertexAttributes.position));if(b)throw new k("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:a.parsedUrl.path});};a.checkSceneLayerCompatibleWithView=function(a,b){S(a,b.spatialReference,b.viewingMode)};a.checkPointCloudLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,b=!!(null==a.geometryType||"points"!==a.geometryType||null!=a.topology&&"PerAttributeArray"!==a.topology||
null!=a.encoding&&""!==a.encoding&&"lepcc-xyz"!==a.encoding||null==a.vertexAttributes||null==a.vertexAttributes.position));if(b)throw new k("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkPointCloudLayerCompatibleWithView=function(a,b){N(a.spatialReference,b.spatialReference,b.viewingMode)};a.rendererNeedsTextures=function(a){if(null==a||"simple"!==a.type&&"class-breaks"!==a.type&&"unique-value"!==a.type||("unique-value"===
a.type||"class-breaks"===a.type)&&null==a.defaultSymbol)return!0;a=a.getSymbols();if(0===a.length)return!0;for(var b=0;b<a.length;b++){var c=a[b];if("mesh-3d"!==c.type||0===c.symbolLayers.length)return!0;for(var d=0,c=c.symbolLayers.items;d<c.length;d++){var f=c[d];if("fill"!==f.type||e.isNone(f.material)||e.isNone(f.material.color)||"replace"!==f.material.colorMixMode)return!0}}return!1};a.transparentEdgeMaterial=A.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});var Y=function(){return function(){this.material=
this.edgeMaterial=null;this.castShadows=!0}}();a.SymbolInfo=Y;a.getSymbolInfo=function(a){var b=new Y,c=!1,d=!1,f=0;for(a=a.symbolLayers.items;f<a.length;f++){var g=a[f];if("fill"===g.type&&g.enabled){var h=g.material,k=g.edges;e.isSome(h)&&!c&&(c=h.color,h=C.parseColorMixMode(h.colorMixMode),e.isSome(c)?b.material={color:[c.r/255,c.g/255,c.b/255],alpha:c.a,colorMixMode:h}:b.material={color:[1,1,1],alpha:1,colorMixMode:1},b.castShadows=g.castShadows,c=!0);e.isSome(k)&&!d&&(b.edgeMaterial=A.createMaterialFromEdges(k,
{}),d=!0)}}b.material||(b.material={color:[1,1,1],alpha:1,colorMixMode:1});return b};a.addWraparound=function(a,b){return(a|0)+(b|0)|0};a.transformObb=P;a.computeVisibilityObb=function(a,b,c,d,f,g){if(!g||0===g.length)return null;var h=B.computeGlobalTransformation(a.mbs,f,c,b);m.mat4.invert(ja,h);var k,l=function(){if(!k)if(k=ga,q.empty(ha),e.isSome(a.serviceObb)){P(a.serviceObb,c,da,b,f);E.corners(da,k);for(var d=0,g=k;d<g.length;d++){var h=g[d];p.vec3.transformMat4(h,h,ja);q.expandPointInPlace(ha,
h)}}else for(h=a.mbs,d=h[3],G.vectorToVector(h,c,fa,b),p.vec3.transformMat4(fa,fa,ja),fa[2]+=f,g=0;8>g;++g){var m=g&1?d:-d,l=g&2?d:-d,n=g&4?d:-d,h=k[g];p.vec3.copy(h,[fa[0]+m,fa[1]+l,fa[2]+n]);q.expandPointInPlace(ha,h)}},n=Infinity,r=-Infinity,t=function(a){if("replace"===a.type&&(a=a.geometry,a.hasZ)){q.empty(ia);var c=a.spatialReference||d;a=a.rings.reduce(function(a,d){return d.reduce(function(a,d){G.vectorToVector(d,c,fa,b);p.vec3.transformMat4(fa,fa,ja);q.expandPointInPlace(ia,fa);return Math.min(fa[2],
a)},a)},Infinity);l();q.intersects(ha,ia)&&(n=Math.min(n,a),r=Math.max(r,a))}};g.forEach(function(a){return t(a)});if(Infinity===n)return null;g=function(a,b,c){p.vec3.transformMat4(fa,c,h);a[b+0]=fa[0];a[b+1]=fa[1];a[b+2]=fa[2];b+=24;c[2]=n;p.vec3.transformMat4(fa,c,h);a[b+0]=fa[0];a[b+1]=fa[1];a[b+2]=fa[2];b+=24;c[2]=r;p.vec3.transformMat4(fa,c,h);a[b+0]=fa[0];a[b+1]=fa[1];a[b+2]=fa[2]};for(var u=0;8>u;++u)g(ka.data,3*u,k[u]);return E.compute(ka)};var X=G.SphericalECEFSpatialReference,ca=f.mat4f64.create(),
ba=g.quatf32.create(),ga=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],ia=q.create(),ha=q.create(),da=E.create(),fa=[0,0,0],ka={data:Array(72),size:3,offsetIdx:0,strideIdx:3},ja=f.mat4f64.create()})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("require exports tslib ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC".split(" "),function(n,a,d,l,k,e,c){function h(a,b,c){for(var d="",e=0;e<c;){var f=a[b+e];if(128>f)d+=String.fromCharCode(f),
e++;else if(192<=f&&224>f){if(e+1>=c)throw new l("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var g=a[b+e+1],f=(f&31)<<6|g&63,d=d+String.fromCharCode(f),e=e+2}else if(224<=f&&240>f){if(e+2>=c)throw new l("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");var g=a[b+e+1],h=a[b+e+2],f=(f&15)<<12|(g&63)<<6|h&63,d=d+String.fromCharCode(f),e=e+3}else if(240<=f&&248>f){if(e+3>=c)throw new l("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");
g=a[b+e+1];h=a[b+e+2];f=(f&7)<<18|(g&63)<<12|(h&63)<<6|a[b+e+3]&63;d=65536<=f?d+String.fromCharCode((f-65536>>10)+55296,(f&1023)+56320):d+String.fromCharCode(f);e+=4}else throw new l("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return d}function m(b,c){for(var d={byteOffset:0,byteCount:0,fields:Object.create(null)},e=0,f=0;f<c.length;f++){var g=c[f],h=g.valueType||g.type;d.fields[g.property]=(0,a.valueType2ArrayBufferReader[h])(b,e);e+=a.valueType2TypedArrayClassMap[h].BYTES_PER_ELEMENT}d.byteCount=
e;return d}function f(a,b,c){var d=[],e,f=0,g;for(g=0;g<a;g+=1){e=b[g];if(0<e){if(d.push(h(c,f,e-1)),0!==c[f+e-1])throw new l("string-array-error","Invalid string array: missing null termination.");}else d.push(null);f+=e}return d}function b(b,c){return new a.valueType2TypedArrayClassMap[c.valueType](b,c.byteOffset,c.count*c.valuesPerElement)}function g(a,b){return new Uint8Array(a,b.byteOffset,b.byteCount)}function p(a,b,c){a=null!=b.header?m(a,b.header):{byteOffset:0,byteCount:0,fields:{count:c}};
c={header:a,byteOffset:a.byteCount,byteCount:0,entries:Object.create(null)};for(var d=a.byteCount,e=0;e<b.ordering.length;e++){var f=b.ordering[e],g=k.clone(b[f]);g.count=a.fields.count;if("String"===g.valueType){if(g.byteOffset=d,g.byteCount=a.fields[f+"ByteCount"],"UTF-8"!==g.encoding)throw new l("unsupported-encoding","Unsupported String encoding.",{encoding:g.encoding});}else if(v(g.valueType)){var h=w(g.valueType),d=d+(0!==d%h?h-d%h:0);g.byteOffset=d;g.byteCount=h*g.valuesPerElement*g.count}else throw new l("unsupported-value-type",
"Unsupported binary valueType",{valueType:g.valueType});d+=g.byteCount;c.entries[f]=g}c.byteCount=d-c.byteOffset;return c}function t(a,b,c){b!==a&&z.error("Invalid "+c+" buffer size\n expected: "+a+", actual: "+b+")");if(b<a)throw new l("buffer-too-small","Binary buffer is too small",{expectedSize:a,actualSize:b});}function u(a){return{isDraco:!1,isLegacy:!1,color:null!=a.color,normal:null!=a.normal,uv0:null!=a.uv0,uvRegion:null!=a.uvRegion,featureIndex:null!=a.faceRange&&null!=a.featureId}}function r(a){for(var b=
{isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1},c=0,d=a.ordering;c<d.length;c++){var e=d[c];if(a.vertexAttributes[e])switch(e){case "normal":b.normal=!0;break;case "color":b.color=!0;break;case "uv0":b.uv0=!0;break;case "region":b.uvRegion=!0}}a.featureAttributes&&a.featureAttributeOrder&&(b.featureIndex=!0);return b}function q(a){for(var b={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1},c=0;c<a.length;c++)switch(a[c]){case "normal":b.normal=
!0;break;case "uv0":b.uv0=!0;break;case "color":b.color=!0;break;case "uv-region":b.uvRegion=!0;break;case "feature-index":b.featureIndex=!0}return b}function v(b){return a.valueType2TypedArrayClassMap.hasOwnProperty(b)}function w(b){return v(b)?a.valueType2TypedArrayClassMap[b].BYTES_PER_ELEMENT:0}Object.defineProperty(a,"__esModule",{value:!0});a.getBytesPerValue=a.isValueType=a.valueType2ArrayBufferReader=a.valueType2TypedArrayClassMap=a.readBinaryAttribute=a.createGeometryDescriptorForDraco=a.createGeometryDescriptorFromSchema=
a.createGeometryDescriptor=a.createGeometryIndexFromSchema=a.createGeometryDescriptorFromDefinition=a.createAttributeDataIndex=a.createRawView=a.createTypedView=a.readStringArray=a.readHeader=void 0;var z=e.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");a.readHeader=m;a.readStringArray=f;a.createTypedView=b;a.createRawView=g;a.createAttributeDataIndex=p;a.createGeometryDescriptorFromDefinition=u;a.createGeometryIndexFromSchema=function(a,b){for(var c=m(a,b&&b.header),e=c.byteCount,f={isDraco:!1,
header:c,byteOffset:c.byteCount,byteCount:0,vertexAttributes:{}},g=c.fields,h=null!=g.vertexCount?g.vertexCount:g.count,k=0,l=b.ordering;k<l.length;k++){var n=l[k];b.vertexAttributes[n]&&(c=d.__assign(d.__assign({},b.vertexAttributes[n]),{byteOffset:e,count:h}),f.vertexAttributes[x[n]?x[n]:"_"+n]=c,e+=w(c.valueType)*c.valuesPerElement*h)}h=g.faceCount;if(b.faces&&h)for(f.faces={},k=0,l=b.ordering;k<l.length;k++)n=l[k],b.faces[n]&&(c=d.__assign(d.__assign({},b.faces[n]),{byteOffset:e,count:h}),f.faces[n]=
c,e+=w(c.valueType)*c.valuesPerElement*h);g=g.featureCount;if(b.featureAttributes&&b.featureAttributeOrder&&g)for(f.featureAttributes={},h=0,k=b.featureAttributeOrder;h<k.length;h++)l=k[h],b.featureAttributes[l]&&(c=d.__assign(d.__assign({},b.featureAttributes[l]),{byteOffset:e,count:g}),f.featureAttributes[l]=c,l="UInt64"===c.valueType?8:w(c.valueType),e+=l*c.valuesPerElement*g);t(e,a.byteLength,"geometry");f.byteCount=e-f.byteOffset;return f};a.createGeometryDescriptor=function(a,b){return a&&a.compressedAttributes&&
"draco"===a.compressedAttributes.encoding?q(a.compressedAttributes.attributes):a?u(a):r(b)};a.createGeometryDescriptorFromSchema=r;a.createGeometryDescriptorForDraco=q;var x={position:"position",normal:"normal",color:"color",uv0:"uv0",region:"uvRegion"};a.readBinaryAttribute=function(a,d,e){if("lepcc-rgb"===a.encoding)return c.decodeRGB(d);if("lepcc-intensity"===a.encoding)return c.decodeIntensity(d);if(null!=a.encoding&&""!==a.encoding)throw new l("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");
a["attributeByteCounts "]&&!a.attributeByteCounts&&(z.warn("Warning: Trailing space in 'attributeByteCounts '."),a.attributeByteCounts=a["attributeByteCounts "]);"ObjectIds"===a.ordering[0]&&a.hasOwnProperty("objectIds")&&(z.warn("Warning: Case error in objectIds"),a.ordering[0]="objectIds");e=p(d,a,e);t(e.byteOffset+e.byteCount,d.byteLength,"attribute");if(a=e.entries.attributeValues||e.entries.objectIds){if("String"===a.valueType){e=e.entries.attributeByteCounts;var h=b(d,e);d=g(d,a);return f(e.count,
h,d)}return b(d,a)}throw new l("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array};a.valueType2ArrayBufferReader={Float32:function(a,b){return(new DataView(a,0)).getFloat32(b,!0)},Float64:function(a,b){return(new DataView(a,0)).getFloat64(b,!0)},UInt8:function(a,b){return(new DataView(a,0)).getUint8(b)},
Int8:function(a,b){return(new DataView(a,0)).getInt8(b)},UInt16:function(a,b){return(new DataView(a,0)).getUint16(b,!0)},Int16:function(a,b){return(new DataView(a,0)).getInt16(b,!0)},UInt32:function(a,b){return(new DataView(a,0)).getUint32(b,!0)},Int32:function(a,b){return(new DataView(a,0)).getInt32(b,!0)}};a.isValueType=v;a.getBytesPerValue=w})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["require","exports","../../../../core/Error"],function(n,a,d){function l(a,d,e){return{identifier:String.fromCharCode.apply(null,
new Uint8Array(a,e+c.identifierOffset,c.identifierLength)),version:d.getUint16(e+c.versionOffset,!0),checksum:d.getUint32(e+c.checksumOffset,!0)}}function k(a,c,d){var b=[];c=e(a,c,b);for(var f=[],h=0;h<b.length;h++){f.length=0;c=e(a,c,f);for(var k=0;k<f.length;k++)d.push(f[k]+b[h])}return c}function e(a,c,e){var b=new DataView(a,c),f=b.getUint8(0),h=f&31,k=!!(f&32),m=(f&192)>>6,f=0;if(0===m)f=b.getUint32(1,!0),c+=5;else if(1===m)f=b.getUint16(1,!0),c+=3;else if(2===m)f=b.getUint8(1),c+=2;else throw new d("lepcc-decode-error",
"Bad count type");if(k)throw new d("lepcc-decode-error","LUT not implemented");a=new Uint8Array(a,c,Math.ceil(f*h/8));for(var m=k=b=0,l=-1>>>32-h,n=0;n<f;n++){for(;k<h;)b|=a[m]<<k,k+=8,m+=1;e[n]=b&l;b>>>=h;k-=h;32<k+h&&(b|=a[m-1]>>8-k)}return c+m}Object.defineProperty(a,"__esModule",{value:!0});a.decodeIntensity=a.decodeRGB=a.decodeXYZ=void 0;var c={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeXYZ=function(a){var e,f,b,g,h,n,u,r,q,v,w,z,x=new DataView(a,
0),B=0;g=l(a,x,B);b=g.identifier;g=g.version;B+=c.byteCount;if("LEPCC     "!==b)throw new d("lepcc-decode-error","Bad identifier");if(1<g)throw new d("lepcc-decode-error","Unknown version");var A=B;e=x.getUint32(A+0,!0);f=x.getUint32(A+4,!0);b=x.getFloat64(A+8,!0);g=x.getFloat64(A+16,!0);h=x.getFloat64(A+24,!0);n=x.getFloat64(A+32,!0);u=x.getFloat64(A+40,!0);r=x.getFloat64(A+48,!0);q=x.getFloat64(A+56,!0);v=x.getFloat64(A+64,!0);w=x.getFloat64(A+72,!0);z=x.getUint32(A+80,!0);x.getUint32(A+84,!0);
B+=88;if(f*Math.pow(2,32)+e!==a.byteLength)throw new d("lepcc-decode-error","Bad size");x=new Float64Array(3*z);e=[];f=[];z=[];A=[];B=k(a,B,e);B=k(a,B,f);B=k(a,B,z);B=k(a,B,A);if(B!==a.byteLength)throw new d("lepcc-decode-error","Bad length");for(var C=B=a=0;C<e.length;C++)for(var B=B+e[C],E=0,G=0;G<f[C];G++){var E=E+z[a],F=A[a];x[3*a]=Math.min(n,b+2*q*E);x[3*a+1]=Math.min(u,g+2*v*B);x[3*a+2]=Math.min(r,h+2*w*F);a++}return{errorX:q,errorY:v,errorZ:w,result:x}};a.decodeRGB=function(a){var e,f,b,g,
h,k,n=new DataView(a,0),r=0;g=l(a,n,r);b=g.identifier;g=g.version;r+=c.byteCount;if("ClusterRGB"!==b)throw new d("lepcc-decode-error","Bad identifier");if(1<g)throw new d("lepcc-decode-error","Unknown version");k=r;e=n.getUint32(k+0,!0);f=n.getUint32(k+4,!0);b=n.getUint32(k+8,!0);g=n.getUint16(k+12,!0);h=n.getUint8(k+14);k=n.getUint8(k+15);r+=16;if(f*Math.pow(2,32)+e!==a.byteLength)throw new d("lepcc-decode-error","Bad size");if((2===h||1===h)&&0===k){if(3*g+b+r!==a.byteLength||256<g)throw new d("lepcc-decode-error",
"Bad count");n=new Uint8Array(a,r,3*g);g=new Uint8Array(a,r+3*g,b);r=new Uint8Array(3*b);for(a=0;a<b;a++)e=g[a],r[3*a]=n[3*e],r[3*a+1]=n[3*e+1],r[3*a+2]=n[3*e+2];return r}if(0===h&&0===k){if(3*b+r!==a.byteLength||0!==g)throw new d("lepcc-decode-error","Bad count");return(new Uint8Array(a,r)).slice()}if(2>=h&&1===k){if(r+3!==a.byteLength||1!==g)throw new d("lepcc-decode-error","Bad count");g=n.getUint8(r);e=n.getUint8(r+1);n=n.getUint8(r+2);r=new Uint8Array(3*b);for(a=0;a<b;a++)r[3*a]=g,r[3*a+1]=e,
r[3*a+2]=n;return r}throw new d("lepcc-decode-error","Bad method "+h+","+k);};a.decodeIntensity=function(a){var h,f,b,g,k,n=new DataView(a,0),u=0;g=l(a,n,u);b=g.identifier;g=g.version;u+=c.byteCount;if("Intensity "!==b)throw new d("lepcc-decode-error","Bad identifier");if(1<g)throw new d("lepcc-decode-error","Unknown version");var r=u;h=n.getUint32(r+0,!0);f=n.getUint32(r+4,!0);b=n.getUint32(r+8,!0);g=n.getUint16(r+12,!0);k=n.getUint8(r+14);n.getUint8(r+15);u+=16;if(f*Math.pow(2,32)+h!==a.byteLength)throw new d("lepcc-decode-error",
"Bad size");n=new Uint16Array(b);if(8===k){if(b+u!==a.byteLength)throw new d("lepcc-decode-error","Bad size");k=new Uint8Array(a,u,b)}else if(16===k){if(2*b+u!==a.byteLength)throw new d("lepcc-decode-error","Bad size");k=new Uint16Array(a,u,b)}else if(k=[],e(a,u,k)!==a.byteLength)throw new d("lepcc-decode-error","Bad size");for(a=0;a<b;a++)n[a]=k[a]*g;return n}})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/geodesicConstants ../../support/projectionUtils".split(" "),
function(n,a,d,l,k,e){function c(a,b,c){var d=l.vec3f64.create(),e=Math.pow(2,Math.ceil(Math.log(a[3])*Math.LOG2E/m)*m+h);if(c.isGeographic){var f=e/k.earthRadius*180/Math.PI;c=Math.round(a[1]/f);c=Math.max(-90,Math.min(90,c*f));var g=f/Math.cos((Math.abs(c)-f/2)/180*Math.PI),f=Math.round(a[0]/g);d[0]=f*g;d[1]=c}else f=Math.round(a[0]/e),c=Math.round(a[1]/e),d[0]=f*e,d[1]=c*e;d[2]=Math.round((a[2]+b)/e)*e;return d}Object.defineProperty(a,"__esModule",{value:!0});a.getLocalOrigin=a.computeGlobalTransformation=
void 0;a.computeGlobalTransformation=function(a,b,g,h){a=c(a,b,g);b=d.mat4f64.create();e.computeLinearTransformation(g,a,b,h);return b};var h=1,m=5-h;a.getLocalOrigin=c})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3"],function(n,a,d){function l(a,b,c){for(;0<a;){var d=b.indexOf(a);if(0<=d)return d;a=c.getParentId(a)}return b.indexOf(a)}function k(a,b,c){for(var d=[b.remove[0]],e=[];1===d.length;)for(var f=d.pop(),g=e.length=0;g<
b.load.length;g++){for(var h=b.load[g],k=c.getParentId(h);k!==f;)h=k,k=c.getParentId(h);k=d.indexOf(h);0>k&&(k=d.length,d.push(h),e.push([]));e[k].push(b.load[g])}b.load=d;for(g=0;g<d.length;g++)1<e[g].length?a.push({remove:[d[g]],load:e[g]}):d[g]=e[g][0]}Object.defineProperty(a,"__esModule",{value:!0});a.splitWorkEntry=a.splitWorkEntries=a.sortFrontToBack=a.nodeDiff=void 0;a.nodeDiff=function(a,b,d){for(var f=0;f<b.length;f++)h[f]=!1,m[f]=null;for(f=0;f<a.length;f++)e[f]=!1,c[f]=null;for(f=0;f<b.length;f++){var g=
l(b[f],a,d);0<=g&&(h[f]=!0,null!=c[g]?c[g].push(b[f]):c[g]=[b[f]])}for(f=0;f<a.length;f++)g=l(a[f],b,d),0<=g&&(e[f]=!0,null!=m[g]?m[g].push(a[f]):m[g]=[a[f]]);d=[];for(f=0;f<a.length;f++)null!=c[f]||e[f]||d.push({load:[],remove:[a[f]]});for(f=0;f<b.length;f++)null!=m[f]||h[f]||d.push({load:[b[f]],remove:[]});for(f=0;f<b.length;f++)null!=m[f]&&(1<m[f].length||m[f][0]!==b[f])&&d.push({load:[b[f]],remove:m[f]});for(f=0;f<a.length;f++)null!=c[f]&&(1<c[f].length||c[f][0]!==a[f])&&d.push({load:c[f],remove:[a[f]]});
return d};var e=[!1],c=[null],h=[!1],m=[null];a.sortFrontToBack=function(a,b,c){return a.sort(function(a,e){if(0===a.load.length&&0===e.load.length)return 0;if(0===a.load.length)return-1;if(0===e.load.length)return 1;if(0===a.remove.length&&0===e.remove.length)return a=c.getRenderCenter(a.load[0]),e=c.getRenderCenter(e.load[0]),d.vec3.dot(a,b)-d.vec3.dot(e,b);if(0===a.remove.length)return-1;if(0===e.remove.length)return 1;if(1===a.load.length&&1===e.load.length)return a=c.getRenderCenter(a.load[0]),
e=c.getRenderCenter(e.load[0]),d.vec3.dot(a,b)-d.vec3.dot(e,b);if(1===a.load.length)return-1;if(1===e.load.length)return 1;a=c.getRenderCenter(a.remove[0]);e=c.getRenderCenter(e.remove[0]);return d.vec3.dot(a,b)-d.vec3.dot(e,b)})};a.splitWorkEntries=function(a,b,c){for(var d=0;d<a.length;++d){var e=a[d];e.load.length>b&&1===e.remove.length&&k(a,e,c)}};a.splitWorkEntry=k})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["require","exports","../../../../geometry/support/aaBoundingBox",
"./I3SUtil","../../support/orientedBoundingBox"],function(n,a,d,l,k){return function(){function a(a,d,e){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=a;this._renderSR=d;this.pageSize=e}a.prototype.addPage=function(a,d,e){for(void 0===e&&(e=0);this._pages.length<a;)this._pages.push(null);for(var c=this._nodeSR,b=this._renderSR,g=new k.ObbArray(d.length),h=0;h<d.length;h++)l.transformObb(d[h].obb,c,g.obbs[h],b,e);this._pages[a]={nodes:d,renderObbs:g.obbs,parents:new Uint32Array(this.pageSize)};
a=this._pages;d=this.pageSize;for(c=[0];c.length;)for(b=c.pop(),e=a[b/d|0].nodes[b%d],g=0;g<e.childCount;g++)h=e.firstChild+g,null!=a[h/d|0]&&(a[h/d|0].parents[h%d]=b,c.push(h))};a.prototype.hasPage=function(a){return!!this._pages[a]};a.prototype.getNode=function(a){var c=this.pageSize;return this._pages[a/c|0].nodes[a%c]};a.prototype.getRenderObb=function(a){var c=this.pageSize;return this._pages[a/c|0].renderObbs[a%c]};a.prototype.getRenderCenter=function(a){return this.getRenderObb(a).center};
a.prototype.setRenderObb=function(a,d){var c=this.pageSize;k.set(d,this._pages[a/c|0].renderObbs[a%c])};a.prototype.getParentId=function(a){var c=this.pageSize;return this._pages[a/c|0].parents[a%c]};a.prototype.hasNodes=function(a,d){d=(a+d-1)/this.pageSize|0;for(a=a/this.pageSize|0;a<=d;a++)if(null==this._pages[a])return!1;return!0};a.prototype.forEachNodeId=function(a){for(var c=0;c<this._pages.length;c++){var d=this._pages[c];if(d)for(var e=0;e<d.nodes.length;e++)a(c*this.pageSize+e)}};a.prototype.createVisibilityTraverse=
function(){var a=this,e=[],m=[],f=d.create();return function(b,c){if(a.hasNodes(0,1))for(e.length=0,e.push(0),m.length=0,m.push(0);0<e.length;){var g=e.pop(),h=m.pop(),l=a.getNode(g),n=a.getRenderObb(g),q=!0;if(null!=b.clippingBox){var v=1<<b.frustumPlanes.length;if(0===(h&v)){var w=k.toAaBoundingBox(n,f);d.contains(b.clippingBox,w)?h|=v:d.intersects(b.clippingBox,w)||(q=!1)}}for(w=0;w<b.frustumPlanes.length&&q;w++)if(v=1<<w,0===(h&v)){var z=k.intersectPlane(n,b.frustumPlanes[w]);0<z?q=!1:0>z&&(h|=
v)}if(c.predicate(g,l,q)){n=l.firstChild;l=l.childCount;w=!1;q=(n+l-1)/a.pageSize|0;for(v=n/a.pageSize|0;v<=q;v++)if(!a.hasPage(v)){c.pageMiss(g,v);w=!0;break}if(!w)for(w=0;w<l;w++)e.push(n+w),m.push(h)}}}};return a}()})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["require","exports"],function(n,a){function d(a,d){for(var c=0;c<a.length;c++){var e=a[c];if(e.name===d&&null!=e.attributeValues&&"UInt8"===e.attributeValues.valueType&&3===e.attributeValues.valuesPerElement)return{name:d,
storageInfo:e,useElevation:!1}}return null}function l(a,d){for(var c=0;c<a.length;c++){var e=a[c];if(e.name===d)return a="embedded-elevation"===e.encoding,{name:d,storageInfo:a?null:e,useElevation:a}}return"elevation"===d.toLowerCase()?{name:d,storageInfo:null,useElevation:!0}:null}Object.defineProperty(a,"__esModule",{value:!0});a.getAttributeInfo=a.rendererUsesFixedSizes=a.getFixedSizeAlgorithm=a.getSplatSizeAlgorithm=a.getFilterInfo=a.getRendererInfo=void 0;a.getRendererInfo=function(a){var e=
a.renderer,c=e&&e.type,h=e&&a.renderer.toJSON()||null,k=null,f=!1;"point-cloud-unique-value"===c?k=l(a.attributeStorageInfo,e.field):"point-cloud-stretch"===c?k=l(a.attributeStorageInfo,e.field):"point-cloud-class-breaks"===c?k=l(a.attributeStorageInfo,e.field):(k="point-cloud-rgb"===c?d(a.attributeStorageInfo,e.field):d(a.attributeStorageInfo,"RGB"),f=null!=k);c=null;e&&e.colorModulation&&(c=l(a.attributeStorageInfo,e.colorModulation.field));return{rendererJSON:h,isRGBRenderer:f,primaryAttribute:k,
modulationAttribute:c}};a.getFilterInfo=function(a){var d=a.filters;return d?d.map(function(c){return{filterJSON:c.toJSON(),attributeInfo:l(a.attributeStorageInfo,c.field)}}):[]};a.getSplatSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"splat"===a.type?a:null};a.getFixedSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"fixed-size"===a.type?a:null};a.rendererUsesFixedSizes=function(a){return(a=a&&a.pointSizeAlgorithm)&&a.type?"fixed-size"===a.type:!1};a.getAttributeInfo=l})},
"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("require exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),function(n,a,d,l,k,e,c,h){function m(a,b){for(var c=new Float64Array(b),d=0;d<b;d++)c[d]=a[3*d+2];return c}function f(a){return null==a||"none"===a?null:"low-four-bit"===a?function(a){return a&15}:"high-four-bit"===
a?function(a){return(a&240)>>4}:"absolute-value"===a?function(a){return Math.abs(a)}:"modulo-ten"===a?function(a){return a%10}:null}function b(a){var b=0,c=0;for(a=a?a:[];c<a.length;c++)b|=1<<a[c];return b}Object.defineProperty(a,"__esModule",{value:!0});a.filterInPlace=a.elevationFromPositions=a.getAttributeValues=a.readGeometry=a.evaluateRenderer=void 0;a.evaluateRenderer=function(a,b,c,d){var g=a.rendererJSON,h=a.isRGBRenderer,m=a=null;if(b&&h)a=b;else if(b&&"pointCloudUniqueValueRenderer"===g.type){var m=
e.fromJSON(g),n=m.colorUniqueValueInfos;a=new Uint8Array(3*d);h=f(m.fieldTransformType);for(g=0;g<d;g++)for(var p=h?h(b[g]):b[g],p=p+"",u=0;u<n.length;u++)if(0<=n[u].values.indexOf(p)){a[3*g]=n[u].color.r;a[3*g+1]=n[u].color.g;a[3*g+2]=n[u].color.b;break}}else if(b&&"pointCloudStretchRenderer"===g.type)for(m=k.fromJSON(g),n=m.stops,a=new Uint8Array(3*d),h=f(m.fieldTransformType),g=0;g<d;g++)if(p=h?h(b[g]):b[g],u=n.length-1,p<n[0].value)a[3*g]=n[0].color.r,a[3*g+1]=n[0].color.g,a[3*g+2]=n[0].color.b;
else if(p>=n[u].value)a[3*g]=n[u].color.r,a[3*g+1]=n[u].color.g,a[3*g+2]=n[u].color.b;else for(u=1;u<n.length;u++){if(p<n[u].value){p=(p-n[u-1].value)/(n[u].value-n[u-1].value);a[3*g]=n[u].color.r*p+n[u-1].color.r*(1-p);a[3*g+1]=n[u].color.g*p+n[u-1].color.g*(1-p);a[3*g+2]=n[u].color.b*p+n[u-1].color.b*(1-p);break}}else if(b&&"pointCloudClassBreaksRenderer"===g.type)for(m=l.fromJSON(g),n=m.colorClassBreakInfos,a=new Uint8Array(3*d),h=f(m.fieldTransformType),g=0;g<d;g++)for(p=h?h(b[g]):b[g],u=0;u<
n.length;u++){if(p>=n[u].minValue&&p<=n[u].maxValue){a[3*g]=n[u].color.r;a[3*g+1]=n[u].color.g;a[3*g+2]=n[u].color.b;break}}else for(a=new Uint8Array(3*d),g=0;g<a.length;g++)a[g]=255;if(c&&m&&m.colorModulation)for(b=m.colorModulation.minValue,m=m.colorModulation.maxValue,g=0;g<d;g++)p=c[g],h=p>=m?1:p<=b?.3:.3+.7*(p-b)/(m-b),a[3*g]*=h,a[3*g+1]*=h,a[3*g+2]*=h;return a};a.readGeometry=function(a,b){if(null==a.encoding||""===a.encoding){a=c.createGeometryIndexFromSchema(b,a);if(d.isNone(a.vertexAttributes.position))return;
b=c.createTypedView(b,a.vertexAttributes.position);var e=a.header.fields;a=[e.offsetX,e.offsetY,e.offsetZ];for(var e=[e.scaleX,e.scaleY,e.scaleZ],f=b.length/3,g=new Float64Array(3*f),k=0;k<f;k++)g[3*k]=b[3*k]*e[0]+a[0],g[3*k+1]=b[3*k+1]*e[1]+a[1],g[3*k+2]=b[3*k+2]*e[2]+a[2];return g}if("lepcc-xyz"===a.encoding)return h.decodeXYZ(b).result};a.getAttributeValues=function(a,b,e){return d.isSome(a)&&a.attributeInfo.useElevation?m(b,e):d.isSome(a)?c.readBinaryAttribute(a.attributeInfo.storageInfo,a.buffer,
e):null};a.elevationFromPositions=m;a.filterInPlace=function(a,c,d,e,f){for(var g=a.length/3,h=0,k=0;k<g;k++){for(var m=!0,l=0;l<e.length&&m;l++){var n=e[l].filterJSON,p=f[l].values[k];switch(n.type){case "pointCloudValueFilter":var r="exclude"===n.mode;-1!==n.values.indexOf(p)===r&&(m=!1);break;case "pointCloudBitfieldFilter":r=b(n.requiredSetBits);n=b(n.requiredClearBits);if((p&r)!==r||0!==(p&n))m=!1;break;case "pointCloudReturnFilter":for(var u=p&15,t=p>>>4&15,p=1<t,r=1===u,u=u===t,t=!1,F=0,n=
n.includedReturns;F<n.length;F++){var H=n[F];if("last"===H&&u||"firstOfMany"===H&&r&&p||"lastOfMany"===H&&u&&p||"single"===H&&!p){t=!0;break}}t||(m=!1)}}m&&(d[h]=k,a[3*h]=a[3*k],a[3*h+1]=a[3*k+1],a[3*h+2]=a[3*k+2],c[3*h]=c[3*k],c[3*h+1]=c[3*k+1],c[3*h+2]=c[3*k+2],h++)}return h}})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("require exports tslib ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(n,a,d,l,k,e,c,h){return function(a){function f(b){b=a.call(this,b)||this;b.type="point-cloud-class-breaks";b.field=null;b.legendOptions=null;b.fieldTransformType=null;b.colorClassBreakInfos=null;return b}d.__extends(f,a);b=f;f.prototype.clone=function(){return new b(d.__assign(d.__assign({},this.cloneProperties()),{field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:l.clone(this.colorClassBreakInfos),legendOptions:l.clone(this.legendOptions)}))};var b;d.__decorate([k.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
f.prototype,"type",void 0);d.__decorate([k.property({json:{write:!0},type:String})],f.prototype,"field",void 0);d.__decorate([k.property({type:c.default,json:{write:!0}})],f.prototype,"legendOptions",void 0);d.__decorate([k.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],f.prototype,"fieldTransformType",void 0);d.__decorate([k.property({type:[h.default],
json:{write:!0}})],f.prototype,"colorClassBreakInfos",void 0);return f=b=d.__decorate([k.subclass("esri.renderers.PointCloudClassBreaksRenderer")],f)}(e)})},"esri/renderers/PointCloudRenderer":function(){define("require exports tslib ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(n,a,d,l,k,e,c,h,m){var f=l.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",
pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});n=function(a){function b(b){b=a.call(this,b)||this;b.type=void 0;b.pointSizeAlgorithm=null;b.colorModulation=null;b.pointsPerInch=10;return b}d.__extends(b,a);b.prototype.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);return null};b.prototype.cloneProperties=function(){return{pointSizeAlgorithm:e.clone(this.pointSizeAlgorithm),
colorModulation:e.clone(this.colorModulation),pointsPerInch:e.clone(this.pointsPerInch)}};d.__decorate([c.property({type:f.apiValues,readOnly:!0,nonNullable:!0,json:{type:f.jsonValues,read:!1,write:f.write}})],b.prototype,"type",void 0);d.__decorate([c.property({types:m.pointSizeAlgorithmTypes,json:{write:!0}})],b.prototype,"pointSizeAlgorithm",void 0);d.__decorate([c.property({type:h.default,json:{write:!0}})],b.prototype,"colorModulation",void 0);d.__decorate([c.property({json:{write:!0},nonNullable:!0,
type:Number})],b.prototype,"pointsPerInch",void 0);return b=d.__decorate([c.subclass("esri.renderers.PointCloudRenderer")],b)}(k.JSONSupport);(n||(n={})).fieldTransformTypeKebabDict=new l.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return n})},"esri/renderers/support/pointCloud/ColorModulation":function(){define(["require","exports","tslib","../../../core/JSONSupport","../../../core/accessorSupport/decorators"],
function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.ColorModulation=void 0;n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.field=null;c.minValue=0;c.maxValue=255;return c}d.__extends(c,a);e=c;c.prototype.clone=function(){return new e({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};var e;d.__decorate([k.property({type:String,json:{write:!0}})],c.prototype,"field",void 0);d.__decorate([k.property({type:Number,nonNullable:!0,json:{write:!0}})],
c.prototype,"minValue",void 0);d.__decorate([k.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"maxValue",void 0);return c=e=d.__decorate([k.subclass("esri.renderers.support.pointCloud.ColorModulation")],c)}(l.JSONSupport);a.ColorModulation=n;a.default=n})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["require","exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(n,a,d,l,k){Object.defineProperty(a,
"__esModule",{value:!0});a.pointSizeAlgorithmTypes=void 0;a.pointSizeAlgorithmTypes={key:"type",base:d.default,typeMap:{"fixed-size":l.default,splat:k.default}}})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("require exports tslib ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.PointSizeAlgorithm=a.typeKebabDictionary=void 0;a.typeKebabDictionary=
new l.default({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});n=function(c){function h(){return null!==c&&c.apply(this,arguments)||this}d.__extends(h,c);d.__decorate([e.property({type:a.typeKebabDictionary.apiValues,readOnly:!0,nonNullable:!0,json:{type:a.typeKebabDictionary.jsonValues,read:!1,write:a.typeKebabDictionary.write}})],h.prototype,"type",void 0);return h=d.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],h)}(k.JSONSupport);a.PointSizeAlgorithm=
n;a.default=n})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","./PointSizeAlgorithm"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.PointSizeFixedSizeAlgorithm=void 0;n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.type="fixed-size";c.size=0;c.useRealWorldSymbolSizes=null;return c}d.__extends(c,a);e=c;c.prototype.clone=function(){return new e({size:this.size,
useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};var e;d.__decorate([l.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],c.prototype,"type",void 0);d.__decorate([l.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"size",void 0);d.__decorate([l.property({type:Boolean,json:{write:!0}})],c.prototype,"useRealWorldSymbolSizes",void 0);return c=e=d.__decorate([l.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],c)}(k.default);a.PointSizeFixedSizeAlgorithm=
n;a.default=n})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","./PointSizeAlgorithm"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.PointSizeSplatAlgorithm=void 0;n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.type="splat";c.scaleFactor=1;return c}d.__extends(c,a);e=c;c.prototype.clone=function(){return new e({scaleFactor:this.scaleFactor})};
var e;d.__decorate([l.enumeration({pointCloudSplatAlgorithm:"splat"})],c.prototype,"type",void 0);d.__decorate([l.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],c.prototype,"scaleFactor",void 0);return c=e=d.__decorate([l.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],c)}(k.default);a.PointSizeSplatAlgorithm=n;a.default=n})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("require exports tslib ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.ColorClassBreakInfo=void 0;n=function(a){function f(){var b=null!==a&&a.apply(this,arguments)||this;b.description=null;b.label=null;b.minValue=0;b.maxValue=0;b.color=null;return b}d.__extends(f,a);b=f;f.prototype.clone=function(){return new b({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:e.clone(this.color)})};var b;d.__decorate([c.property({type:String,json:{write:!0}})],
f.prototype,"description",void 0);d.__decorate([c.property({type:String,json:{write:!0}})],f.prototype,"label",void 0);d.__decorate([c.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],f.prototype,"minValue",void 0);d.__decorate([c.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],f.prototype,"maxValue",void 0);d.__decorate([c.property({type:l,json:{type:[h.Integer],write:!0}})],f.prototype,"color",void 0);return f=
b=d.__decorate([c.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],f)}(k.JSONSupport);a.ColorClassBreakInfo=n;a.default=n})},"esri/renderers/PointCloudStretchRenderer":function(){define("require exports tslib ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/StopInfo".split(" "),function(n,a,d,l,k,e,c,h){return function(a){function f(b){b=a.call(this,b)||this;b.type="point-cloud-stretch";b.field=null;b.legendOptions=
null;b.fieldTransformType=null;b.stops=null;return b}d.__extends(f,a);b=f;f.prototype.clone=function(){return new b(d.__assign(d.__assign({},this.cloneProperties()),{field:l.clone(this.field),fieldTransformType:l.clone(this.fieldTransformType),stops:l.clone(this.stops),legendOptions:l.clone(this.legendOptions)}))};var b;d.__decorate([k.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],f.prototype,"type",void 0);d.__decorate([k.property({json:{write:!0},type:String})],f.prototype,"field",
void 0);d.__decorate([k.property({type:c.default,json:{write:!0}})],f.prototype,"legendOptions",void 0);d.__decorate([k.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],f.prototype,"fieldTransformType",void 0);d.__decorate([k.property({type:[h.default],json:{write:!0}})],f.prototype,"stops",void 0);return f=b=d.__decorate([k.subclass("esri.renderers.PointCloudStretchRenderer")],
f)}(e)})},"esri/renderers/support/pointCloud/StopInfo":function(){define("require exports tslib ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.StopInfo=void 0;n=function(a){function f(){var b=null!==a&&a.apply(this,arguments)||this;b.label=null;b.value=0;b.color=null;return b}d.__extends(f,a);b=f;f.prototype.clone=function(){return new b({label:this.label,
value:this.value,color:e.clone(this.color)})};var b;d.__decorate([c.property({type:String,json:{write:!0}})],f.prototype,"label",void 0);d.__decorate([c.property({type:Number,nonNullable:!0,json:{write:!0}})],f.prototype,"value",void 0);d.__decorate([c.property({type:l,json:{type:[h.Integer],write:!0}})],f.prototype,"color",void 0);return f=b=d.__decorate([c.subclass("esri.renderers.support.pointCloud.StopInfo")],f)}(k.JSONSupport);a.StopInfo=n;a.default=n})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("require exports tslib ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(n,a,d,l,k,e,c,h){return function(a){function f(b){b=a.call(this,b)||this;b.type="point-cloud-unique-value";b.field=null;b.fieldTransformType=null;b.colorUniqueValueInfos=null;b.legendOptions=null;return b}d.__extends(f,a);b=f;f.prototype.clone=function(){return new b(d.__assign(d.__assign({},this.cloneProperties()),{field:l.clone(this.field),fieldTransformType:l.clone(this.fieldTransformType),colorUniqueValueInfos:l.clone(this.colorUniqueValueInfos),legendOptions:l.clone(this.legendOptions)}))};
var b;d.__decorate([k.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],f.prototype,"type",void 0);d.__decorate([k.property({json:{write:!0},type:String})],f.prototype,"field",void 0);d.__decorate([k.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],f.prototype,"fieldTransformType",void 0);d.__decorate([k.property({type:[h.default],json:{write:!0}})],
f.prototype,"colorUniqueValueInfos",void 0);d.__decorate([k.property({type:c.default,json:{write:!0}})],f.prototype,"legendOptions",void 0);return f=b=d.__decorate([k.subclass("esri.renderers.PointCloudUniqueValueRenderer")],f)}(e)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("require exports tslib ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(n,a,d,
l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.ColorUniqueValueInfo=void 0;n=function(a){function f(){var b=null!==a&&a.apply(this,arguments)||this;b.description=null;b.label=null;b.values=null;b.color=null;return b}d.__extends(f,a);b=f;f.prototype.clone=function(){return new b({description:this.description,label:this.label,values:e.clone(this.values),color:e.clone(this.color)})};var b;d.__decorate([c.property({type:String,json:{write:!0}})],f.prototype,"description",void 0);d.__decorate([c.property({type:String,
json:{write:!0}})],f.prototype,"label",void 0);d.__decorate([c.property({type:[String],json:{write:!0}})],f.prototype,"values",void 0);d.__decorate([c.property({type:l,json:{type:[h.Integer],write:!0}})],f.prototype,"color",void 0);return f=b=d.__decorate([c.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],f)}(k.JSONSupport);a.ColorUniqueValueInfo=n;a.default=n})},"esri/views/3d/layers/i3s/PointGraphic":function(){define(["require","exports","tslib","../../../../Graphic","../../../../core/accessorSupport/decorators"],
function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.PointGraphic=void 0;n=function(a){function c(c){return a.call(this,c)||this}d.__extends(c,a);e=c;c.prototype.clone=function(){return new e(this.cloneProperties())};c.prototype.cloneProperties=function(){var c=this.pointCloudMetadata;return d.__assign(d.__assign({},a.prototype.cloneProperties.call(this)),{pointCloudMetadata:c})};var e;d.__decorate([k.property({constructOnly:!0})],c.prototype,"pointCloudMetadata",void 0);return c=
e=d.__decorate([k.subclass("esri.views.3d.layers.i3s.PointGraphic")],c)}(l);a.PointGraphic=n})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../geometry/support/aaBoundingBox ./PointHighlights ../../support/geometryUtils ../../support/geometryUtils ../../support/orientedBoundingBox ../../webgl-engine/core/shaderLibrary/Slice.glsl ../../webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/shaders/PointRendererTechnique ../../../webgl/BufferObject ../../../webgl/VertexArrayObject".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B){function A(a,b,c,d,e){if(c.drawScreenSpace)return c.fixedSize*b*d;e=(e?256:64)*b*d;return c.drawFixedSize?Math.min(c.fixedSize/2,e):0<c.screenMinSize?Math.min(Math.max(c.screenMinSize*b*d,a/2),e):Math.min(a/2,e)}function C(a){return d.isSome(a.component)?a.component:-1}function E(a,b){if(d.isNone(a))return a;a=a.filter(function(a){return a.id!==b});return 0===a.length?null:a}Object.defineProperty(a,"__esModule",{value:!0});a.PointRenderer=void 0;
var G={positions:[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"color",count:3,type:5121,offset:0,stride:3,normalized:!0}]};n=function(){function a(a){var c=this;this._params=a;this.type="Point";this.isGround=!1;this._bindParameters={inverseViewport:[0,0],highlightDepthTexture:null};this._highlights=new g.PointHighlights({forEachNode:function(a){return c.forEachNode(a)},addHighlight:function(a,b,d){return c.addHighlight(a,b,d)},removeHighlight:function(a,b){return c.removeHighlight(a,
b)}});this.canRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=b.create(b.POSITIVE_INFINITY);this._techniqueConfig=new z.PointRendererTechniqueConfiguration;this.tempMatrix4=k.mat4f32.create();this.tempVec3=h.vec3f32.create();this.nodes=[]}Object.defineProperty(a.prototype,"needsHighlight",{get:function(){return this._highlights.hasHighlights},enumerable:!1,configurable:!0});
a.prototype.initializeRenderContext=function(a){this._initContext=a;this._techniqueRep=this._initContext.shaderTechniqueRep;a.requestRender()};a.prototype.uninitializeRenderContext=function(){};a.prototype.intersect=function(a,d,g,h){var k=this,l=m.vec3f64.create(),n=m.vec3f64.create(),r=m.vec3f64.create(),q=m.vec3f64.create(),v=t.plane.create(),x=a.camera.perScreenPixelRatio/2,B=a.camera.near,z=this._getSizeParams();c.vec3.subtract(n,h,g);var C=1/c.vec3.length(n);c.vec3.scale(n,n,C);c.vec3.negate(r,
n);f.vec4.set(v,n[0],n[1],n[2],-c.vec3.dot(n,g));var E=function(){return function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""}}(),H=new E,F=new E,G=[],I=b.create(),J=b.create(this._clipBox);b.offset(J,-g[0],-g[1],-g[2],J);for(var K=function(e){var f=e.splatSize*ia._scaleFactor,p=u.minimumDistancePlane(e.obb,v),t=u.maximumDistancePlane(e.obb,v),p=p-(z.drawScreenSpace?0:A(f,p+B,z,x,e.isLeaf)),t=t-(z.drawScreenSpace?0:A(f,t+B,z,x,e.isLeaf)),p=null!=H.dist&&null!=F.dist&&
H.dist<p*C&&F.dist>t*C;if(0>t||p)return"continue";t=A(f,t+B,z,x,e.isLeaf);if(!u.intersectLine(e.obb,g,n,t))return"continue";var w=t*t;u.toAaBoundingBox(e.obb,I);b.offset(I,-g[0],-g[1],-g[2],I);var K=!b.contains(J,I);c.vec3.subtract(q,e.origin,g);for(var t=e.coordinates.length/3,p=function(p){l[0]=q[0]+e.coordinates[3*p];l[1]=q[1]+e.coordinates[3*p+1];l[2]=q[2]+e.coordinates[3*p+2];if(K&&!b.containsPoint(J,l))return"continue";var u=c.vec3.dot(l,n),t=c.vec3.squaredLength(l)-u*u;if(t>w)return"continue";
var v=u+B,I=z.drawScreenSpace?0:A(f,v,z,x,e.isLeaf);if(0>u-I)return"continue";v=A(f,v-I,z,x,e.isLeaf);if(t>v*v)return"continue";var Y=(u-I)*C,u=function(a){var b=a.point;null==b&&(b=m.vec3f64.create());b[0]=e.origin[0]+e.coordinates[3*p];b[1]=e.origin[1]+e.coordinates[3*p+1];b[2]=e.origin[2]+e.coordinates[3*p+2];a.point=b;a.dist=Y;a.normal=r;a.node=e;a.pointId=p;a.layerUid=k.layerUid};(null==H.dist||Y<H.dist)&&(null==d||d(g,h,Y))&&u(H);0!==a.options.store&&(null==F.dist||Y>F.dist)&&(null==d||d(g,
h,Y))&&u(F);2!==a.options.store||null!=d&&!d(g,h,Y)||(t=new E,u(t),G.push(t))},Y=0;Y<t;Y++)p(Y)},ia=this,ha=0,da=this.nodes;ha<da.length;ha++)K(da[ha]);var fa=function(a){var b=a.node,c=a.pointId;return{type:"external",point:a.point,metadata:{layerUid:a.layerUid,createGraphic:function(){return k._params.createGraphic(b,c,a.point)}}}},K=function(a,b){var c=fa(b);a.set(c,b.layerUid+"/"+b.node.id+"/"+b.pointId,b.dist,b.normal,e.mat4f64.IDENTITY,void 0);a.intersector="PointRenderer"};null!=H.dist&&(ha=
a.results.min,(null==ha.dist||H.dist<ha.dist)&&K(ha,H));null!=F.dist&&0!==a.options.store&&(ha=a.results.max,(null==ha.dist||F.dist>ha.dist)&&K(ha,F));if(2===a.options.store)for(ha=p.ray.fromPoints(g,h),da=0;da<G.length;da++){var ka=G[da],ja=new w.IntersectorResult(ha);K(ja,ka);a.results.all.push(ja)}};a.prototype.render=function(a){if(0!==a.pass&&1!==a.pass&&4!==a.pass)return!1;for(var d=1===a.pass,e=a.rctx,f=0,g=this.nodes;f<g.length;f++){var h=g[f];null==h.vao&&this._initNode(a,h)}var f=this._getSizeParams(),
g=this.selectTechnique(a,f),k=g.program;if(null==k||0===this.nodes.length)return!0;var m=this._clipBox,n=!b.equals(m,b.POSITIVE_INFINITY,function(a,b){return a===b});n||(c.vec3.set(this.tempVec3,-Infinity,-Infinity,-Infinity),k.setUniform3fv("uClipMin",this.tempVec3),c.vec3.set(this.tempVec3,Infinity,Infinity,Infinity),k.setUniform3fv("uClipMax",this.tempVec3));e.bindProgram(k);g.bindPipelineState(e);k.setUniformMatrix4fv("uProjectionMatrix",a.camera.projectionMatrix);d&&k.setUniform2f("nearFar",
a.camera.near,a.camera.far);a.isHighlightPass&&(this._bindParameters.inverseViewport[0]=1/a.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/a.camera.fullViewport[3],this._bindParameters.highlightDepthTexture=a.highlightDepthTexture,q.OutputHighlight.bindOutputHighlight(e,k,this._bindParameters));d=a.camera.pixelRatio;f.drawFixedSize&&k.setUniform2f("uPointScale",f.fixedSize*d,a.camera.fullHeight);for(var p=this._slicePlaneEnabled?a.sliceHelper&&a.sliceHelper.plane:null,u=0,t=this.nodes;u<
t.length;u++)if(h=t[u],0!==h.coordinates.length&&(!a.isHighlightPass||h.highlights)){k.setUniform2f("uScreenMinMaxSize",f.screenMinSize*d,(h.isLeaf?256:64)*d);f.drawFixedSize||k.setUniform2f("uPointScale",h.splatSize*this._scaleFactor*d,a.camera.fullHeight/d);var v=h.origin;n&&(c.vec3.set(this.tempVec3,m[0]-v[0],m[1]-v[1],m[2]-v[2]),k.setUniform3fv("uClipMin",this.tempVec3),c.vec3.set(this.tempVec3,m[3]-v[0],m[4]-v[1],m[5]-v[2]),k.setUniform3fv("uClipMax",this.tempVec3));l.mat4.identity(this.tempMatrix4);
l.mat4.translate(this.tempMatrix4,this.tempMatrix4,v);l.mat4.multiply(this.tempMatrix4,a.camera.viewMatrix,this.tempMatrix4);k.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4);r.Slice.bindUniforms(k,g.configuration,p,v);e.bindVAO(h.vao);a.isHighlightPass?this._renderHighlightFragments(e,h):e.drawArrays(0,0,h.coordinates.length/3)}return!0};a.prototype._renderHighlightFragments=function(a,b){var c=b.highlights;if(!d.isNone(c)){b=d.unwrap(c[0].component);for(var e=b+1,f=1;f<c.length;f++){var g=
d.unwrap(c[f].component);g!==e&&(e-=b,0<e&&a.drawArrays(0,b,e),b=g);e=g+1}c=e-b;0<c&&a.drawArrays(0,b,c)}};Object.defineProperty(a.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(a){this._useFixedSizes!==a&&(this._useFixedSizes=a,this._requestRender())},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(a){this._scaleFactor!==a&&(this._scaleFactor=a,this._requestRender())},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"minSizePx",{get:function(){return this._minSizePx},set:function(a){this._minSizePx!==a&&(this._minSizePx=a,this._requestRender())},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},set:function(a){this._useRealWorldSymbolSizes!==a&&(this._useRealWorldSymbolSizes=a,this._requestRender())},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"size",{get:function(){return this._size},set:function(a){this._size!==a&&(this._size=a,this._requestRender())},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"sizePx",{get:function(){return this._sizePx},set:function(a){this._sizePx!==a&&(this._sizePx=a,this._requestRender())},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"clippingBox",{set:function(a){b.set(this._clipBox,a||b.POSITIVE_INFINITY)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"slicePlane",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled!==a&&(this._slicePlaneEnabled=a,this._requestRender())},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"intersectionHandlerId",{get:function(){return this.layerUid},enumerable:!1,configurable:!0});a.prototype.addNode=function(a){this.nodes.push(a);this._highlights.nodeAdded(a);this._requestRender()};a.prototype.removeNode=function(a){var b=this,c=null;this.nodes=this.nodes.filter(function(d){return d.id===
a?(c=d,d.vao&&(d.vao.dispose(!0),d.vao=null),b._highlights.nodeRemoved(d),!1):!0});this._requestRender();return c};a.prototype.forEachNode=function(a){this.nodes.forEach(a)};a.prototype.removeAll=function(){this.nodes.forEach(function(a){a.vao&&(a.vao.dispose(!0),a.vao=null)});this._highlights.removeAll();this.nodes=[];this._requestRender()};a.prototype.highlight=function(a){return this._highlights.add(a)};a.prototype.addHighlight=function(a,b,c){var e=a.highlights;d.isNone(e)&&(e=[]);b={component:b,
id:c};e.push(b);c=C(b);for(var f=e.length-1;0<f&&c<C(e[f-1]);)b=[e[f],e[f-1]],e[f-1]=b[0],e[f]=b[1],--f;a.highlights=e;this._requestRender()};a.prototype.removeHighlight=function(a,b){a.highlights=E(a.highlights,b);this._requestRender()};a.prototype._initNode=function(a,b){a=a.rctx;b.vao=new B(a,v.Default3D,G,{positions:x.createVertex(a,35044,b.coordinates),colors:x.createVertex(a,35044,b.rgb)})};a.prototype._requestRender=function(){this._initContext&&this._initContext.requestRender()};a.prototype._getSizeParams=
function(){var a=this._useFixedSizes,b=a&&!this._useRealWorldSymbolSizes,c=b?this._sizePx:this._size,d=this._minSizePx;a&&(d=0);return{drawScreenSpace:b,drawFixedSize:a,fixedSize:c,screenMinSize:d}};a.prototype.selectTechnique=function(a,b){this._techniqueConfig.drawScreenSize=b.drawScreenSpace;this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled;this._techniqueConfig.sceneHasOcludees=a.hasOccludees;this._techniqueConfig.output=1===a.pass?1:4===a.pass?4:0;return this._techniqueRep.acquireAndReleaseExisting(z.PointRendererTechnique,
this._techniqueConfig,this._technique)};return a}();a.PointRenderer=n;(function(a){a.isInstanceOfNode=function(a){return a.hasOwnProperty("splatSize")}})(n=a.PointRenderer||(a.PointRenderer={}));a.PointRenderer=n})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["require","exports","../../../../core/maybe","../../../../core/SetUtils","../../webgl-engine/lib/Object3DStateSet"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.PointHighlights=void 0;n=function(){function a(a){this.context=
a;this.highlights=new Set}Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return 0<this.highlights.size},enumerable:!1,configurable:!0});a.prototype.destroy=function(){this.highlights=null};a.prototype.add=function(a){var c=this,d=new e(a);this.highlights.add(d);this.enableSet(d);return{remove:function(){return c.removeSet(d)},pause:function(){c.disableSet(d)},resume:function(){c.enableSet(d)}}};a.prototype.removeSet=function(a){this.disableSet(a);this.highlights.delete(a)};a.prototype.enableSet=
function(a){var c=this;a.enabled||(a.enabled=!0,this.context.forEachNode(function(d){return c.enableSetForNode(a,d)}))};a.prototype.enableSetForNode=function(a,c){var d=this;if(a.enabled){var b=a.ids.get(c.id);b&&b.forEach(function(b){return d.context.addHighlight(c,b,a.id)})}};a.prototype.disableSet=function(a){var c=this;a.enabled&&(a.enabled=!1,this.context.forEachNode(function(d){return c.disableSetForNode(a,d)}))};a.prototype.disableSetForNode=function(a,c){a.enabled||this.context.removeHighlight(c,
a.id)};a.prototype.nodeAdded=function(a){var c=this;this.highlights.forEach(function(d){return c.enableSetForNode(d,a)})};a.prototype.nodeRemoved=function(a){var c=this;this.highlights.forEach(function(d){return c.disableSetForNode(d,a)})};a.prototype.removeAll=function(){var a=this;this.highlights.forEach(function(c){return a.disableSet(c)})};return a}();a.PointHighlights=n;var e=function(){function a(a){this.id=k.generateObject3DStateId(0);this.ids=new Map;this.enabled=!1;for(var c=0;c<a.length;c++){var e=
a[c];d.isSome(e)&&this.add(e.nodeId,e.pointId)}}a.prototype.add=function(a,c){var d=this.ids.get(a);d?d.add(c):this.ids.set(a,l.SetFromValues([c]))};return a}()})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports tslib ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ./PointRenderer.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){Object.defineProperty(a,"__esModule",{value:!0});a.PointRendererTechniqueConfiguration=a.PointRendererTechnique=void 0;k=function(a){function e(b,c){return a.call(this,b,c)||this}d.__extends(e,a);e.prototype.initializeProgram=function(a){var b=e.shader.get(),d=this.configuration,b=b.build({output:d.output,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:d.drawScreenSize});return new f(a.rctx,b.generateSource("vertex"),
b.generateSource("fragment"),c.Default3D)};e.prototype.initializePipeline=function(){return b.makePipelineState({depthTest:{func:513},depthWrite:b.defaultDepthWriteParams,colorWrite:b.defaultColorWriteParams,stencilWrite:this.configuration.sceneHasOcludees?h.stencilWriteMaskOn:null,stencilTest:this.configuration.sceneHasOcludees?h.stencilBaseAllZerosParams:null})};e.shader=new l.ReloadableShaderModule(m,function(){return new Promise(function(a,b){n(["./PointRenderer.glsl"],a,b)})});return e}(k.ShaderTechnique);
a.PointRendererTechnique=k;k=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.slicePlaneEnabled=!1;b.drawScreenSize=!1;b.sceneHasOcludees=!1;return b}d.__extends(b,a);d.__decorate([e.parameter({count:7})],b.prototype,"output",void 0);d.__decorate([e.parameter()],b.prototype,"slicePlaneEnabled",void 0);d.__decorate([e.parameter()],b.prototype,"drawScreenSize",void 0);d.__decorate([e.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(e.ShaderTechniqueConfiguration);
a.PointRendererTechniqueConfiguration=k})},"esri/views/3d/webgl-engine/shaders/PointRenderer.glsl":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(n,a,d,l,k,e,c,h){Object.defineProperty(a,"__esModule",{value:!0});a.build=void 0;a.build=function(a){var n=new h.ShaderBuilder,v=0===a.output,
x=1===a.output,B=4===a.output;n.extensions.add("GL_OES_standard_derivatives");n.include(l.Slice,a);n.attributes.add("position","vec3");n.attributes.add("color","vec3");n.vertex.uniforms.add("uModelViewMatrix","mat4").add("uProjectionMatrix","mat4").add("uScreenMinMaxSize","vec2").add("uPointScale","vec2").add("uClipMin","vec3").add("uClipMax","vec3");x?(n.vertex.uniforms.add("nearFar","vec2"),n.varyings.add("depth","float")):4!==a.output&&n.varyings.add("vColor","vec3");n.vertex.code.add(c.glsl(p||
(p=d.__makeTemplateObject(["\n    void main(void) {\n      // Move clipped points outside of clipspace\n      if (position.x \x3c uClipMin.x || position.y \x3c uClipMin.y || position.z \x3c uClipMin.z ||\n        position.x \x3e uClipMax.x || position.y \x3e uClipMax.y || position.z \x3e uClipMax.z) {\n        gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize \x3d 0.0;\n        return;\n      }\n\n      if (rejectBySlice(position)) {\n        gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize \x3d 0.0;\n        return;\n      }\n\n      // Position in camera space\n      vec4 camera \x3d uModelViewMatrix * vec4(position, 1.0);\n\n      float pointSize \x3d uPointScale.x;\n      vec4 position \x3d uProjectionMatrix * camera;\n     ",
"\n\n     gl_PointSize \x3d clampedScreenSize;\n     gl_Position \x3d position;\n\n     ","\n     ","\n    }\n  "],["\n    void main(void) {\n      // Move clipped points outside of clipspace\n      if (position.x \x3c uClipMin.x || position.y \x3c uClipMin.y || position.z \x3c uClipMin.z ||\n        position.x \x3e uClipMax.x || position.y \x3e uClipMax.y || position.z \x3e uClipMax.z) {\n        gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize \x3d 0.0;\n        return;\n      }\n\n      if (rejectBySlice(position)) {\n        gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize \x3d 0.0;\n        return;\n      }\n\n      // Position in camera space\n      vec4 camera \x3d uModelViewMatrix * vec4(position, 1.0);\n\n      float pointSize \x3d uPointScale.x;\n      vec4 position \x3d uProjectionMatrix * camera;\n     ",
"\n\n     gl_PointSize \x3d clampedScreenSize;\n     gl_Position \x3d position;\n\n     ","\n     ","\n    }\n  "])),a.drawScreenSize?c.glsl(m||(m=d.__makeTemplateObject(["\n      float clampedScreenSize \x3d pointSize;"],["\n      float clampedScreenSize \x3d pointSize;"]))):c.glsl(f||(f=d.__makeTemplateObject(["\n      float pointRadius \x3d 0.5 * pointSize;\n      vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\n      vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\n      float radius \x3d abs(positionOffset.y - position.y);\n      float viewHeight \x3d uPointScale.y;\n      // screen diameter \x3d (2 * r / w) * (h / 2)\n      float screenPointSize \x3d (radius / position.w) * viewHeight;\n      float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n      // Shift towards camera, to move rendered point out of terrain i.e. to\n      // the camera-facing end of the virtual point when considering it as a\n      // 3D sphere.\n      camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n      position \x3d uProjectionMatrix * camera;"],
["\n      float pointRadius \x3d 0.5 * pointSize;\n      vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\n      vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\n      float radius \x3d abs(positionOffset.y - position.y);\n      float viewHeight \x3d uPointScale.y;\n      // screen diameter \x3d (2 * r / w) * (h / 2)\n      float screenPointSize \x3d (radius / position.w) * viewHeight;\n      float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n      // Shift towards camera, to move rendered point out of terrain i.e. to\n      // the camera-facing end of the virtual point when considering it as a\n      // 3D sphere.\n      camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n      position \x3d uProjectionMatrix * camera;"]))),
x?c.glsl(b||(b=d.__makeTemplateObject(["depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);"],["depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);"]))):"",v?c.glsl(g||(g=d.__makeTemplateObject(["vColor \x3d color;"],["vColor \x3d color;"]))):""));n.fragment.include(e.RgbaFloatEncoding,a);B&&n.include(k.OutputHighlight);n.fragment.code.add(c.glsl(q||(q=d.__makeTemplateObject(["\n    void main(void) {\n      vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\n      float r2 \x3d dot(vOffset, vOffset);\n\n      if (r2 \x3e 0.25) {\n        discard;\n      }\n      ",
"\n      ","\n      ","\n    }\n  "],["\n    void main(void) {\n      vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\n      float r2 \x3d dot(vOffset, vOffset);\n\n      if (r2 \x3e 0.25) {\n        discard;\n      }\n      ","\n      ","\n      ","\n    }\n  "])),x?c.glsl(t||(t=d.__makeTemplateObject(["gl_FragColor \x3d float2rgba(depth);"],["gl_FragColor \x3d float2rgba(depth);"]))):"",B?c.glsl(u||(u=d.__makeTemplateObject(["outputHighlight();"],["outputHighlight();"]))):"",v?c.glsl(r||(r=d.__makeTemplateObject(["gl_FragColor \x3d vec4(vColor, 1.0);"],
["gl_FragColor \x3d vec4(vColor, 1.0);"]))):""));return n};var m,f,b,g,p,t,u,r,q})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("require exports tslib ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/SetUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),function(n,a,d,l,k,e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.PopupSceneLayerView=
void 0;a.PopupSceneLayerView=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype._validateFetchPopupFeatures=function(a){var b=this.layer;if(!b.popupEnabled)return new l("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:b});if(!f.getFetchPopupTemplate(b,a))return new l("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:b})};b.prototype.prepareFetchPopupFeatures=function(a){return d.__awaiter(this,
void 0,void 0,function(){return d.__generator(this,function(a){return[2]})})};b.prototype.fetchPopupFeatures=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var a,g,h,l,n,p,u,t,C,E,G;return d.__generator(this,function(d){switch(d.label){case 0:if(a=this._validateFetchPopupFeatures(b))return[2,e.reject(a)];g=k.isSome(b)?b.clientGraphics:null;if(!g||0===g.length)return[2,e.resolve([])];h=[];l=[];p=m.unpackFieldNames;u=[this.layer.fields];return[4,f.getRequiredFields(this.layer,f.getFetchPopupTemplate(this.layer,
b))];case 1:return n=p.apply(void 0,u.concat([d.sent()])),[4,this.prepareFetchPopupFeatures(n)];case 2:d.sent();t=new Set;C=0;for(E=g;C<E.length;C++)G=E[C],m.populateMissingFields(n,G,t)?l.push(G):h.push(G);return 0===l.length?[2,e.resolve(h)]:[2,this.whenGraphicAttributes(l,c.valuesOfSet(t)).catch(function(){return l}).then(function(a){return h.concat(a)})]}})})};return b=d.__decorate([h.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],b)}(a)}})},"esri/views/3d/layers/SceneLayerView3D":function(){define("require exports tslib ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/SetUtils ../../../core/unitUtils ../../../core/accessorSupport/decorators ../../../core/sql/WhereClause ../../../geometry/projection ../../../geometry/support/webMercatorUtils ../../../layers/support/fieldUtils ../../../tasks/support/Query ./I3SMeshView3D ./LayerView3D ./i3s/I3SGeometryUtil ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/projectionUtils ../../layers/SceneLayerView ../../layers/support/FeatureFilter ../../support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L){var M=c.getLogger("esri.views.3d.layers.SceneLayerView3D"),Q=G.defineFieldProperties(),R=[0,0,0,0];return function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._queryEngine=null;b.requiredFields=[];b.lodFactor=1;b.progressiveLoadFactor=1;b._elevationContext="scene";b._isIntegratedMesh=!1;b._supportsLabeling=!0;b._projectionEngineLoaded=!1;return b}d.__extends(c,a);Object.defineProperty(c.prototype,"filter",
{set:function(a){if(h.isNone(a))this._set("filter",null);else{var b=["contains","intersects","disjoint"];a.timeExtent?(M.warn("Filters with a timeExtent are not supported for mesh scene layers"),a=null):a.spatialRelationship&&-1===b.indexOf(a.spatialRelationship)&&(M.warn("Filters with spatialRelationship other than "+b.join(", ")+" are not supported for mesh scene layers"),a=null);this._set("filter",a)}},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"parsedFilterWhereClause",
{get:function(){var a=h.isSome(this.filter)?this.filter.where:null;if(!a)return null;try{return p.WhereClause.create(a,this.layer.fieldsIndex)}catch(P){M.error("Failed to parse filter where clause: "+P)}return null},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"filterSpatialRelationship",{get:function(){return h.isSome(this.filter)?this.filter.spatialRelationship:"intersects"},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"parsedFilterGeometry",{get:function(){var a=
this;if(h.isNone(this.filter)||!this._geometryEngine)return null;var c=this.filter.geometry;if(!c)return null;var d=this.filter,e=d.distance,f=d.units,d=this.filterSpatialRelationship,c="mesh"===c.type?c.extent:c;if(!e)return z.processFilterGeometry(c,d);f=f||b.getUnitString(c.spatialReference);if(c.spatialReference.isWGS84)return e=this._geometryEngine.geodesicBuffer(c,e,f),z.processFilterGeometry(e,d);if(u.canProject(c,l.SpatialReference.WGS84))return e=u.project(this._geometryEngine.geodesicBuffer(u.project(c,
l.SpatialReference.WGS84),e,f),c.spatialReference),z.processFilterGeometry(e,d);if(!t.isSupported())return M.error("Filter by geodesic buffer (distance) unsupported due to lack of projection support."),null;if(!this._projectionEngineLoaded&&(this._loadAsyncModule(t.load()).then(function(){a._set("_projectionEngineLoaded",!0)}),!this._projectionEngineLoaded))return null;var g=null;try{g=t.project(c,l.SpatialReference.WGS84)}catch(Y){}if(g)try{g=t.project(this._geometryEngine.geodesicBuffer(g,e,f),
c.spatialReference)}catch(Y){g=null}g||M.error("Filter by geodesic buffer (distance) unsupported, failed to project input geometry ("+c.spatialReference.wkid+") to WGS84.");return z.processFilterGeometry(g,d)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"lodCrossfadeDuration",{get:function(){var a,b;return null!==(b=null===(a=this.view)||void 0===a?void 0:a.qualitySettings.sceneService["3dObject"].lodCrossfadeDuration)&&void 0!==b?b:0},enumerable:!1,configurable:!0});c.prototype.initialize=
function(){for(var a=this,b=0,c=["layer.renderer","layer.labelingInfo","layer.labelsVisible","definitionExpressionFields","filter"];b<c.length;b++){var d=c[b];this.updatingHandles.add(this,d,function(){return a.updatingHandles.addPromise(a._updateRequiredFields())})}this._updateRequiredFields();this.updatingHandles.add(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)},2);this.updatingHandles.add(this.layer,"renderer",function(b){return a.updatingHandles.addPromise(a._rendererChange(b))},
2);b=0;for(c=["parsedDefinitionExpression","layer.objectIdFilter","filter","parsedFilterWhereClause","parsedFilterGeometry"];b<c.length;b++)d=c[b],this.updatingHandles.add(this,d,function(){return a._filterChange()})};c.prototype.destroy=function(){};c.prototype._updateRequiredFields=function(){return d.__awaiter(this,void 0,void 0,function(){var a,b,c,e,g,k,l,n,p,q,u;return d.__generator(this,function(d){switch(d.label){case 0:return a=this,c=b=a.layer,e=c.fields,g=c.renderer,k=a.definitionExpressionFields,
l=new Set,[4,m.eachAlways([g?g.collectRequiredFields(l,e):null,r.collectLabelingFields(l,b),h.isSome(this.filter)?r.collectFilterFields(l,b,this.filter):null])];case 1:n=d.sent();p=0;for(q=n;p<q.length;p++)u=q[p],u.error&&M.error(u.error);r.collectFields(l,e,k);this._set("requiredFields",f.valuesOfSet(l).sort());return[2]}})})};c.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&M.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};
c.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return h.isSome(this.filter)?this.filter.createQuery(a):new q(a)};c.prototype.queryExtent=function(a){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(a))};c.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(a))};c.prototype.queryFeatures=function(a){var b=this;return this._ensureQueryEngine().executeQuery(this._ensureQuery(a)).then(function(a){if(null===
a||void 0===a||!a.features)return a;for(var c=b.layer,d=0,e=a.features;d<e.length;d++){var f=e[d];f.layer=c;f.sourceLayer=c}return a})};c.prototype.queryObjectIds=function(a){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(a))};c.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};c.prototype._createQueryEngine=function(){var a=this,b=z.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,
this._collection);return new x.default({layerView:this,task:L.Task.FEATURE_QUERY_ENGINE,spatialIndex:new A.default({featureAdapter:new B.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:b}),forAllFeatures:function(b,c){return a._forAllFeatures(function(a,c,d){return b({id:a,index:c,meta:d})},c,2)},getFeatureExtent:b,sourceSpatialReference:C.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};
c.prototype.highlight=function(b){var c=this._highlights;if(b instanceof q){var d=c.acquireSet(),e=d.set,d=d.handle;this.queryObjectIds(b).then(function(a){return c.setFeatureIds(e,a)});return d}return a.prototype.highlight.call(this,b)};c.prototype._createLayerGraphic=function(a){a=new k(null,null,a);a.layer=this.layer;a.sourceLayer=this.layer;return a};c.prototype.canResume=function(){return a.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};c.prototype.getFilters=
function(){var b=this,c=a.prototype.getFilters.call(this);if(this.layer.objectIdFilter){var d=new Float64Array(this.layer.objectIdFilter.ids),e="include"===this.layer.objectIdFilter.method;d.sort();c.push(function(a){return b._objectIdFilter(d,e,a)})}this.addSqlFilter(c,this.parsedDefinitionExpression,this.definitionExpressionFields,this.logError);if(h.isSome(this.filter)){var f=this.parsedFilterGeometry;h.isSome(f)&&c.push(function(a,c){return b._geometryFilter(a,c,f,b.filterSpatialRelationship)});
if(this.filter.objectIds){var g=new Float64Array(this.filter.objectIds);g.sort();c.push(function(a){return b._objectIdFilter(g,!0,a)})}}h.isSome(this.parsedFilterWhereClause)&&this.addSqlFilter(c,this.parsedFilterWhereClause,this.parsedFilterWhereClause.fieldNames,this.logError);return c};c.prototype._geometryFilter=function(a,b,c,d){var e=c[0].spatialReference||this.view.spatialReference;if(J.mbsToMbs(b.node.mbs,this._controller.crsIndex,R,e))for(var f=z.acquireMaskFilterContext(d,this.view,e,this._collection,
b.objectHandle),g=z.computeMaskNodeMBS(R,f),e=function(c){if(0===a.length)return{value:void 0};switch(z.testMaskWithGeometry(c,g,d)){case 1:return a.length=0,{value:void 0};case 0:return"continue"}C.filterInPlace(a,b.featureIds,function(a){return z.filterWithMask(c,a,f)})},h=0;h<c.length;h++){var k=e(c[h]);if("object"===typeof k)return k.value}else M.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")};c.prototype._filterChange=function(){var b=
this;h.isSome(this.filter)&&this.filter.geometry&&!this._geometryEngine?this._loadAsyncModule(z.loadGeometryEngine()).then(function(a){b.destroyed||(b._set("_geometryEngine",a),b._applyFilters(!0))}):a.prototype._filterChange.call(this)};c.prototype._objectIdFilter=function(a,b,c){for(var d=0,f=0;d<c.length;)0<=e.binaryIndexOf(a,c[d])===b&&(c[f]=c[d],f++),d++;c.length=f};c.prototype._ensureQuery=function(a){return this._addDefinitionExpressionToQuery(h.isNone(a)?this.createQuery():q.from(a))};d.__decorate([g.property()],
c.prototype,"layer",void 0);d.__decorate([g.property({aliasOf:"layer"})],c.prototype,"i3slayer",void 0);d.__decorate([g.property({dependsOn:["_controller.rootNodeVisible"]})],c.prototype,"suspended",void 0);d.__decorate([g.property(F.updatingProgress)],c.prototype,"updatingProgress",void 0);d.__decorate([g.property({type:K})],c.prototype,"filter",null);d.__decorate([g.property({readOnly:!0,dependsOn:["filter.where"]})],c.prototype,"parsedFilterWhereClause",null);d.__decorate([g.property({readOnly:!0,
dependsOn:["filter.spatialRelationship"]})],c.prototype,"filterSpatialRelationship",null);d.__decorate([g.property({readOnly:!0,dependsOn:"filter.geometry filter.distance filter.units filterSpatialRelationship _geometryEngine _projectionEngineLoaded".split(" ")})],c.prototype,"parsedFilterGeometry",null);d.__decorate([g.property(Q.requiredFields)],c.prototype,"requiredFields",void 0);d.__decorate([g.property(Q.availableFields)],c.prototype,"availableFields",void 0);d.__decorate([g.property({readOnly:!0,
aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],c.prototype,"lodFactor",void 0);d.__decorate([g.property({readOnly:!0,dependsOn:["view.qualitySettings.sceneService.3dObject.lodCrossfadeDuration"]})],c.prototype,"lodCrossfadeDuration",null);d.__decorate([g.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],c.prototype,"updatingProgressValue",void 0);d.__decorate([g.property({readOnly:!0})],c.prototype,"_geometryEngine",void 0);d.__decorate([g.property({readOnly:!0})],
c.prototype,"_projectionEngineLoaded",void 0);return c=d.__decorate([g.subclass("esri.views.3d.layers.SceneLayerView3D")],c)}(v.I3SMeshView3D(E.DefinitionExpressionSceneLayerView(H.PopupSceneLayerView(w.LayerView3D(I)))))})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports tslib ../../../Color ../../../Graphic ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/mathUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../geometry/support/aaBoundingBox ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./SceneLayerWorker ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ./support/layerViewUpdatingProperties ../support/debugFlags ../support/extentUtils ../support/orientedBoundingBox ../support/projectionUtils ../support/buffer/glUtil ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/material/RenderTexture ../webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../webgl-engine/lib/Texture ../webgl-engine/lib/TextureBackedBuffer/BufferManager @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O,N,S,P,U,Z,V,T,Y,X,ca,ba,ga,ia,ha,da,fa,ka,ja,pa,na,va,za){function ya(a){var b=a.metallicRoughness;return b&&0<=b.baseColorTextureId||b&&0<=b.metallicRoughnessTextureId||0<=a.normalTextureId||0<=a.emissiveTextureId||0<=a.occlusionTextureId}function ua(a){return b.isSome(a)&&u.isArrayBuffer(a.data)}function oa(a,c){a=1024+a.interleavedVertexData.byteLength+(a.indices?a.indices.byteLength:0)+a.positionData.data.byteLength+
a.positionData.indices.byteLength;if(b.isSome(c))for(var d=0;d<c.length;d++){var e=c[d];b.isSome(e)&&u.isArrayBuffer(e.data)&&(a+=e.data.byteLength)}return a}function ta(a,b){return 104857600<b.byteSize?(qa.warn("Node is too big to store in IndexedDB cache: "+a.id+" ("+b.byteSize+" bytes)"),!1):0<b.byteSize}function ma(a){if(0===a.length)return null;var c=new Float64Array(10*a.length);a.forEachSimple(function(a,d){var e=a.serviceObb;b.isNone(e)&&(e=y,A.vec3.copy(e.center,a.mbs),e.halfSize[0]=e.halfSize[1]=
e.halfSize[2]=a.mbs[3]);a=10*d;c[a+0]=e.center[0];c[a+1]=e.center[1];c[a+2]=e.center[2];c[a+3]=e.halfSize[0];c[a+4]=e.halfSize[1];c[a+5]=e.halfSize[2];c[a+6]=e.quaternion[0];c[a+7]=e.quaternion[1];c[a+8]=e.quaternion[2];c[a+9]=e.quaternion[3]});return c}Object.defineProperty(a,"__esModule",{value:!0});a.I3SMeshView3D=void 0;var qa=h.getLogger("esri.views.3d.layers.SceneLayerView3D"),aa=[1,1,1,1],Ja=function(){return function(a,b,c,d,e,f,g){this.node=a;this.featureIds=b;this.objectHandle=c;this.cachedRendererVersion=
d;this.attributeInfo=e;this.material=f;this.textures=g;this.lodCrossfadeTargetTime=null;this.lodCrossfadeDirection=0;this.cachedEdgeMaterials=[];this.cachedSymbology=null}}();a.I3SMeshView3D=function(a){return function(a){function h(){var b=null!==a&&a.apply(this,arguments)||this;b._elevationProvider=null;b._intersectionHandler=null;b._nodeId2Meta=new Map;b._nodeId2MetaReloading=new Map;b._asyncModuleLoading=0;b._addTasks=new Map;b._rendererVersion=0;b._colorVariable=null;b._opacityVariable=null;
b._rendererFields=null;b._symbologyFields=null;b._symbologyOverride=null;b._symbologyOverrideFields=null;b._symbolInfos=new Map;b._idbCache=new ca.IDBCache("esri-scenelayer-cache","geometries");b._labeler=null;b.holeFilling="auto";b._hasColors=!1;b._hasTextures=!1;b._hasData=!1;b.slicePlaneEnabled=!1;b._modifications=[];b._layerUrl="";b._cacheKeySuffix=null;b._arcade=null;b._tmpAttributeOnlyGraphic=new k(null,null,{});b._crossfadeHelper=new U.I3SCrossfadeHelper(b);return b}d.__extends(h,a);Object.defineProperty(h.prototype,
"lodCrossfadeDuration",{get:function(){return 0},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"layerUid",{get:function(){return this.i3slayer&&this.i3slayer.uid},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"sublayerUid",{get:function(){return null},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!1,
configurable:!0});Object.defineProperty(h.prototype,"rendererTextureUsage",{get:function(){return X.rendererNeedsTextures(this._currentRenderer)?63:44},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"elevationOffset",{get:function(){var a=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var c=r.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),d=Q.getMetersPerUnit(a.unit);return b.unwrapOr(a.offset,0)*d/c}return 0},enumerable:!1,
configurable:!0});Object.defineProperty(h.prototype,"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view&&this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"useCompressedTextures",{get:function(){var a=this.i3slayer.version,a=!c("trident")||1<a.major||1===a.major&&3<a.minor;return this.view._stage.renderView.has("s3tc")&&a},enumerable:!1,configurable:!0});
Object.defineProperty(h.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"_atlasBiasCompensationEnabled",{get:function(){return this.view&&this.view._stage&&!this.view._stage.renderView.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!1,configurable:!0});
Object.defineProperty(h.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!1,configurable:!0});h.prototype.initialize=function(){var a=this;this._worker=new O.I3SMeshWorkerHandle(this.view.resourceController.scheduler);this.addResolvingPromise(this._worker.promise);this._worker.setLegacySchema(this.layerUid,this.i3slayer.store.defaultGeometrySchema);X.checkSceneLayerValid(this.i3slayer);X.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);
this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new F({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this._highlights=new P({collection:this._collection,forAllFeatures:function(b){return a._forAllFeatures(b,null,1)},forAllFeaturesOfNode:function(b,c){return a._forAllFeaturesOfNode(b,c)}});if(this._isIntegratedMesh||!this.i3slayer.store.defaultGeometrySchema)this._hasSymbolColors=
!1;else{var c=this.i3slayer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(c&&c.faceRange&&c.id)}this._hasVertexColors=null!=this.i3slayer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.i3slayer.cachedDrawingInfo||!this.i3slayer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.getMemCache(this.i3slayer.uid,function(b){return a._deleteComponentObject(b)});
this._intersectionHandler=new T.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,forEach:function(c){a._nodeId2Meta.forEach(function(a){return b.isSome(a)&&c(a.node,a.objectHandle)});a._nodeId2MetaReloading.forEach(function(a){return b.isSome(a)&&c(a.node,a.objectHandle)})}});this._elevationProvider=new Z({layerView:this,intersectionHandler:this._intersectionHandler});this.updatingHandles.add(this,
"view.clippingArea",function(){return a._clippingAreaChanged()},2);this.updatingHandles.add(this,"fullOpacity",function(b){return a._opacityChange(b)});this.updatingHandles.add(this,"slicePlaneEnabled",function(b){return a._slicePlaneEnabledChange(b)});this.updatingHandles.add(this,"elevationOffset",function(b,c){a._reloadAll(c);a._controller.invalidateVisibilityObbs()});this.updatingHandles.add(this,"filter",function(){return a._filterChange()},2);this.updatingHandles.add(this,"view.qualitySettings.physicallyBasedRenderingEnabled",
function(){return a._updatePBR()});c=function(){a._reloadAll();a._memCache.clear()};this.updatingHandles.add(this,"rendererTextureUsage",c);this.updatingHandles.add(this,"uncompressedTextureDownsamplingEnabled",c);this.updatingHandles.add(this,"suspended",function(b){return a._suspendedChange(b)},2);this.updatingHandles.add(this.i3slayer,"labelsVisible",function(){return a._labelingChanged()},2);this.updatingHandles.add(this.i3slayer,"labelingInfo",function(){return a._labelingChanged()},2);this.updatingHandles.add(this,
"_modifications",function(){return a._modificationsChanged()},2);this.handles.add([q.init(ia,"I3S_TREE_SHOW_TILES",function(b){if(b&&!a._treeDebugger){var c=a._controller.crsIndex;(new Promise(function(a,b){n(["./support/I3STreeDebugger"],a,b)})).then(function(b){b=b.I3STreeDebugger;!a._treeDebugger&&ia.I3S_TREE_SHOW_TILES&&(a._treeDebugger=new b({lv:a,view:a.view,nodeSR:c}))})}else b||!a._treeDebugger||ia.I3S_TREE_SHOW_TILES||(a._treeDebugger.destroy(),a._treeDebugger=null)}),q.init(ia,"I3S_SHOW_MODIFICATIONS",
function(){return a._showModifications()})]);this._cacheKeySuffix=X.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(function(a){return qa.warn("Failed to initialize IndexedDB cache: "+a)});this._componentColorManager=this._hasSymbolColors?new za.BufferManager(this._stage.renderView.renderingContext):null};h.prototype.destroy=function(){this._clearAddTasks();this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),
this._elevationProvider=null);this._intersectionHandler&&(this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);var a=this._worker;a&&(a.destroyContext(this.i3slayer.uid).then(function(){return a.destroy()}),this._worker=null);this._removeAllNodeDataFromStage();this._memCache.destroy();this._edgeView=this._stage=this._collection=this._memCache=null;b.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);this._treeDebugger&&
(this._treeDebugger.destroy(),this._treeDebugger=null);this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();this._nodeId2MetaReloading=this._nodeId2Meta=null;this._componentColorManager&&(this._componentColorManager.destroy(),this._componentColorManager=null);this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};h.prototype.memEstimateTextureAdded=
function(a){a=a.estimatedTexMemRequired;this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=a;return a};h.prototype.memEstimateTextureRemoved=function(a){a=a.estimatedTexMemRequired;this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a};h.prototype.memEstimateGeometryAdded=function(a){a=this._collection.getObjectGPUMemoryUsage(a);this.gpuMemoryEstimate+=a;this.geoMemoryEstimate+=a;return a};h.prototype.memEstimateGeometryRemoved=function(a){a=this._collection.getObjectGPUMemoryUsage(a);this.gpuMemoryEstimate-=
a;this.geoMemoryEstimate-=a};h.prototype.isNodeLoaded=function(a){return this._nodeId2Meta.has(a)};h.prototype.isNodeReloading=function(a){return this._nodeId2MetaReloading.has(a)};h.prototype.getUsedMemory=function(){var a=b.isSome(this._labeler)?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(function(c){return a+=b.isSome(c)?c.node.memory:0});this._nodeId2MetaReloading.forEach(function(c){return a+=b.isSome(c)?c.node.memory:0});return a};h.prototype.getUnloadedMemory=function(){return(this._controller?
this._controller.unloadedMemoryEstimate:0)+(b.isSome(this._labeler)?this._labeler.unloadedMemoryEstimate:0)};h.prototype.ignoresMemoryFactor=function(){return!1};h.prototype._labelingChanged=function(){var a=this;if(!J.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)b.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);else if(!b.isSome(this._labeler)){var c=new R.default({view:this.view,layer:this.i3slayer,collection:this._collection});this._nodeId2Meta.forEach(function(d){return b.isSome(d)&&
a._addMetaToLabeler(c,d)});this._labeler=c}};h.prototype._loadAsyncModule=function(a){var b=this;++this._asyncModuleLoading;return a.then(function(a){--b._asyncModuleLoading;return a},function(a){--b._asyncModuleLoading;throw a;})};h.prototype._modificationsChanged=function(){var a=this;if(b.isNone(this._i3sModule)&&this._hasModifications)this._i3sModule=this._loadAsyncModule((new Promise(function(a,b){n(["./SceneLayerWorker"],a,b)})).then(function(b){return b.ensureWASM().then(function(){a._i3sModule=
b;a._modificationsChanged()})}));else if(!(b.isNone(this._i3sModule)||this._i3sModule instanceof Promise)){var c=this.i3slayer.uid,d=this.i3slayer.spatialReference;this._worker.setModifications(c,this._modifications,d);var e=O.toWasmModification(this._modifications,d);this._i3sModule.setModificationsSync({context:c,modifications:e,isGeodetic:d.isGeographic});this._controller.modificationsChanged();var f=this._hasModifications?new g:null;this._nodeId2Meta.forEach(function(c,d){b.isNone(c)?a._nodeId2Meta.delete(d):
c.node.hasModifications?(a._nodeId2Meta.delete(d),a._nodeId2MetaReloading.set(d,c)):b.isSome(f)&&f.push(c.node)});b.isSome(f)&&this._nodeId2MetaReloading.forEach(function(a){return f.push(a.node)});b.isSome(f)&&0<f.length&&(this.updateNodeModificationStatus(f),f.forEachSimple(function(c){if(2!==c.imModificationImpact){var d=a._nodeId2Meta.get(c.index);a._controller.invalidateGeometryVisibility(c.index);a._nodeId2Meta.delete(c.index);b.isSome(d)&&a._nodeId2MetaReloading.set(c.index,d)}}));this._memCache.clear();
this._controller.restartNodeLoading();this._showModifications()}};h.prototype._showModifications=function(){b.isSome(this._modificationGraphics)&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null);if(ia.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var a={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},c={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(var e=0,f=this._modifications;e<
f.length;e++){var g=f[e];g.geometry.spatialReference=this.i3slayer.spatialReference;var h=d.__assign(d.__assign({},c),{color:a[g.type]});this._modificationGraphics.push(new k({geometry:g.geometry,symbol:h}))}this.view.graphics.addMany(this._modificationGraphics)}};h.prototype._addMetaToLabeler=function(a,b){var c=this;a.addNodeMeta(b,function(a,b){return c._createAttributes(a,b)})};h.prototype._suspendedChange=function(a){a?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),
this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};h.prototype.getLoadedAttributes=function(a){a=this._nodeId2Meta.get(a);if(b.isSome(a)&&b.isSome(a.attributeInfo))return a.attributeInfo.loadedAttributes};h.prototype.getAttributeData=function(a){a=this._nodeId2Meta.get(a);if(b.isSome(a)&&
b.isSome(a.attributeInfo))return a.attributeInfo.attributeData};h.prototype.setAttributeData=function(a,c){var d=this;a=this._nodeId2Meta.get(a);b.isSome(a)&&(a.attributeInfo=c,a.cachedRendererVersion=this._getInvalidRendererVersion(),a.filteredIds=null,b.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(a,function(a,b){return d._createAttributes(a,b)}),this._updateEngineObject(a))};h.prototype.getVisibleNodes=function(){var a=[];this._nodeId2Meta.forEach(function(c){return b.isSome(c)&&
a.push(c.node)});return a};h.prototype.getLoadedNodeIndices=function(a){this._nodeId2Meta.forEach(function(b,c){return a.push(c)});this._nodeId2MetaReloading.forEach(function(b,c){return a.push(c)})};h.prototype._createTexture=function(a,c,d,e){if(b.isNone(d)||null==d.data)return null;var g=d.data,h=c.wrapTextures;c=d.usage&1?"opaque"===c.alphaMode?3:4:3;var k=!0,m;d.encoding===X.DDS_ENCODING_STRING?m=va.DDS_ENCODING:k=f.isPowerOfTwo(g.width)&&f.isPowerOfTwo(g.height);k=(e?this._enableAtlasMipMaps:
this._enableMipMaps)&&k;d=new va(g,a.id+"/"+d.id,{mipmap:k,wrap:e||!h?{s:33071,t:33071}:{s:10497,t:10497},disableAnisotropy:e&&k&&this._disableAtlasAnisotropy,encoding:m,noUnpackFlip:!0,components:c});this._stage.add(4,d);a.memory+=this.memEstimateTextureAdded(d);return d};h.prototype._getVertexBufferLayout=function(a,b){a={hasTexture:ya(a.params.material),hasNormals:b.normal,hasRegions:b.uvRegion};return ka.glLayout(ja.createVertexBufferLayout(this._getGeometryParameters(a)))};h.prototype._getObjectIdField=
function(){return this.i3slayer.objectIdField||"OBJECTID"};h.prototype._findGraphicNodeAndIndex=function(a){var c=ba.attributeLookup(a.attributes,this._getObjectIdField()),d=null;m.someMap(this._nodeId2Meta,function(a){if(b.isNone(a))return!1;var e=a.featureIds.indexOf(c);if(-1===e)return!1;d={node:a.node,index:e};return!0});return d};h.prototype._getGraphicIndices=function(a,c){a=this._nodeId2Meta.get(a.index);if(b.isNone(a))return[];for(var d=[],e=this._getObjectIdField(),f=0;f<c.length;f++){var g=
ba.attributeLookup(c[f].attributes,e),g=a.featureIds.indexOf(g);-1!==g&&d.push(g)}return d};h.prototype.whenGraphicBounds=function(a){a=this._findGraphicNodeAndIndex(a);if(!a)return p.reject();var c=this._nodeId2Meta.get(a.node.index);if(b.isNone(c))return p.reject();a=V.boundingBoxCornerPoints(a.index,this._collection,c.objectHandle,new Float64Array(24));if(fa.bufferToBuffer(a,this.view.renderSpatialReference,0,a,this.view.spatialReference,0,8))return c=G.empty(),G.expandWithBuffer(c,a,0,8),p.resolve({boundingBox:c,
screenSpaceObjects:[]})};h.prototype.whenGraphicAttributes=function(a,b){var c=this;return X.whenGraphicAttributes(this.i3slayer,a,this._getObjectIdField(),b,function(a){for(var b=new Map,d=[],e=0;e<a.length;e++){var f=a[e],g=c._findGraphicNodeAndIndex(f),h=b.get(g.node);h||(h={node:g.node,indices:[],graphics:[]},d.push(h),b.set(g.node,h));h.indices.push(g.index);h.graphics.push(f)}return d},{populateObjectId:!0})};h.prototype.getGraphicFromIntersectorMetadata=function(a){if(null==a.nodeIndex||null==
a.componentIndex)return null;var c=this._nodeId2Meta.get(a.nodeIndex);return b.isNone(c)||null==c.featureIds||a.componentIndex>=c.featureIds.length?null:this._createGraphic(a.componentIndex,c)};h.prototype._getCacheKey=function(a){return this._layerUrl+"/v16/"+a.id+this._cacheKeySuffix};h.prototype._getMemCacheKey=function(a,b){void 0===b&&(b=this.elevationOffset);return a+"#"+b};Object.defineProperty(h.prototype,"_idbCacheEnabled",{get:function(){return!this._controller.disableIDBCache&&0===this._modifications.length&&
0===this.elevationOffset&&null!=this._cacheKeySuffix},enumerable:!1,configurable:!0});h.prototype.loadCachedGPUData=function(a){return this._memCache.pop(this._getMemCacheKey(a.index))};h.prototype._cacheGPUData=function(a,b){void 0===b&&(b=this.elevationOffset);var c=this._controller.indexDepth-a.node.level+1;this._memCache.put(this._getMemCacheKey(a.node.index,b),a,a.node.memory,c)};h.prototype.loadMissingTextures=function(a,c,d,e){var f=this,g=a.filter(function(a,d){if(0===(a.usage&f.rendererTextureUsage))return!1;
if(b.isNone(c))return!0;a=X.selectEncoding(a.encodings,f.useCompressedTextures);d=c[d];return b.isNone(d)||null==d.data||a&&d.encoding!==a.encoding?!0:!1});return 0===g.length?p.resolve(!1):d(g,e).then(function(b){for(var d=0,e=0;e<a.length;e++)d<b.length&&b[d].id===a[e].id&&(c[e]=b[d],d++);return!0})};h.prototype.loadCachedNodeData=function(a,c,d){var e=this;return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(a),c).then(function(f){if(null==f)return null;if(f.nodeVersion!==a.version)return e._idbCache.remove(e._getCacheKey(a)),
null;a.geometryObb=f.geometryObb;return e.loadMissingTextures(f.requiredTextures,f.textureData,d,c).then(function(d){d&&e._idbCache.initialized&&b.isSome(f.textureData)&&(f.byteSize=oa(f.transformedGeometry,f.textureData),f.textureData.every(ua)&&ta(a,f)&&e._idbCache.put(e._getCacheKey(a),f).catch(function(b){return qa.warn("Failed to update node with textures in IndexedDB cache: "+a.id+": "+b)}));p.throwIfAborted(c);return f})}):p.resolve(null)};h.prototype.addNode=function(a,c,e){var f=this;return"geometryData"in
c?this._addData(a,c.attributeDataInfo,function(){return f._transformNode(a,c,e).then(function(g){return f._safeReschedule(e,function(){if(b.isNone(g))return a.hasModifications=!1,f._addCachedNodeData(a,null,e);a.hasModifications=g.transformedGeometry.hasModifications;var h=g.obb,k=g.componentOffsets,m=g.featureIds,l=g.transformedGeometry,n=Y.computeGlobalTransformation(a.mbs,f.elevationOffset,f._controller.crsIndex,f.view.renderSpatialReference);a.geometryObb=da.create([h.center.x,h.center.y,h.center.z],
[h.extents.x,h.extents.y,h.extents.z],[h.orientation.x,h.orientation.y,h.orientation.z,h.orientation.w]);A.vec3.transformMat4(a.geometryObb.center,a.geometryObb.center,n);c.geometryData.componentOffsets=k;m&&(c.geometryData.featureIds=Array.prototype.slice.call(m));h={nodeVersion:a.version,geometryData:c.geometryData,requiredTextures:c.requiredTextures,textureData:c.textureData,transformedGeometry:l,globalTrafo:n,geometryObb:a.geometryObb,byteSize:oa(l,c.textureData)};f._idbCacheEnabled&&f._idbCache.initialized&&
ta(a,h)&&(k=b.isSome(h.textureData)?h.textureData.map(function(a){return ua(a)?a:null}):null,f._idbCache.put(f._getCacheKey(a),d.__assign(d.__assign({},h),{textureData:k})).catch(function(b){return qa.warn("Failed to store node in IndexedDB cache: "+a.id+": "+b)}));return f._addCachedNodeData(a,h,e)})})}):p.reject()};h.prototype.computeVisibilityObb=function(a){return X.computeVisibilityObb(a,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,
this._modifications)};h.prototype._transformNode=function(a,c,d){for(var e=c.geometryData.geometries,f=Array(e.length),g=0;g<e.length;++g)f[g]=this._getVertexBufferLayout(e[g],c.geometryDescriptor);var e=a.mbs,g=this.elevationOffset,h=this._controller.crsIndex,k=this._controller.crsVertex,m=this.view.renderSpatialReference,l=Y.getLocalOrigin(e,g,h),n=Y.computeGlobalTransformation(e,g,h,m),h=fa.getProjectorName(h,k),k=fa.getProjectorName(k,m);return b.isNone(h)||b.isNone(k)?p.resolve(null):this._worker.invoke({context:this.i3slayer.uid,
geometryBuffer:c.geometryBuffer,geometryData:c.geometryData,geometryDescriptor:c.geometryDescriptor,layouts:f,localOrigin:l,globalTrafo:n,mbs:e,obb:a.serviceObb,elevationOffset:g,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:h,vertexToRenderProjector:k},d)};h.prototype.isFadingEnabled=function(){return 0<this.lodCrossfadeDuration};h.prototype._setNewNodeOpacity=function(a,b){var c=this.isFadingEnabled();
this.setNodeOpacity(b,c?0:this.fullOpacity);c?this._crossfadeHelper.fadeNodeInternal(a,b,0):this._crossfadeHelper.stopNodeFadingInternal(b)};h.prototype.addCachedGPUData=function(a,c,d){a.geometryObb=da.clone(this._collection.getComponentObb(c.objectHandle));this._controller.isGeometryVisible(a)?(b.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,c),a=a.index,this._addNodeMeta(a,c),this.updateNodeState(a,d),this._collection.setObjectVisibility(c.objectHandle,!0),this._updateMaterial(c),
this._setNewNodeOpacity(a,c),this._updateEngineObject(c),this._highlights.objectCreated(c),this._treeDebugger&&this._treeDebugger.update()):this._cacheGPUData(c)};h.prototype.addCachedNodeData=function(a,b,c,d){var e=this;return this._addData(a,c,function(){return e._addCachedNodeData(a,b,d)})};h.prototype._addCachedNodeData=function(a,c,d){var e=this;if(this.suspended||!this._controller.isGeometryVisible(a))return this._removeNodeStageData(a.index,this.elevationOffset,this._nodeId2MetaReloading),
p.resolve();if(b.isNone(c))return this._addNodeMeta(a.index,null),p.resolve();var f=c.geometryData,g=c.transformedGeometry,h=c.globalTrafo,k=b.isSome(c.textureData)?c.textureData.filter(function(a){return b.isSome(a)&&0!==(a.usage&e.rendererTextureUsage)}):null;a.memory=0;var m=f.componentOffsets,l=f.geometries,f=f.featureIds,n=null,r=null;if(this._hasSymbolColors)for(var n=this._componentColorManager.getBuffer(f.length),r=new Uint16Array(f.length),q=0;q<f.length;q++)r[q]=n.acquireIndex();var u=this._collection,
l=l[0],n=g.layout,r=g.indices,q=g.interleavedVertexData,t=g.positionData,g=g.hasColors,v=this._materialParameters(l,n),m=m||new Uint32Array([0,r?r.length:q.byteLength/n[0].stride]),m={vertices:{data:q,count:q.byteLength/n[0].stride,layoutParameters:v.geometryParams},positionData:{positions:t.data,indices:t.indices},indices:r,primitiveType:4,componentOffsets:m},n=l.transformation?B.mat4f64.clone(l.transformation):B.mat4f64.create();x.mat4.multiply(n,h,n);var h=x.mat4.getTranslation(C.vec3f64.create(),
n),n=w.mat3.fromMat4(z.mat3f32.create(),n),r=this.view.renderSpatialReference,q=this.view.basemapTerrain.spatialReference,t=C.vec3f64.create(),A=[1,1,1];fa.localLinearScaleFactors(h,r,A,q);fa.vectorToVector(h,r,t,q);var y=u.createObject({toMapSpace:[t[0],t[1],A[0],A[1]],geometry:m,obb:b.unwrap(a.geometryObb),transform:{position:h,rotationScale:n},visible:!1}),h={isSchematic:l.params.material.isSchematic,isOpaque:"blend"!==l.params.material.alphaMode&&1<=l.params.material.metallicRoughness.baseColorFactor[3]},
m=b.isSome(k)?k.map(function(b){return e._createTexture(a,v.material,b,2===v.geometryParams.textureCoordinates)}):[];this._configureMaterial(y,l.params.material,m,k);a.memory+=this.memEstimateGeometryAdded(y);var E=this._addTasks.get(a.index),F=new Ja(a,f,y,this._getInvalidRendererVersion(),E.attributeInfo,h,m);E.meta=F;!this._hasTextures&&c.requiredTextures.some(function(a){return 0!==(a.usage&19)})&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||g;this._hasTextures=this._hasTextures||
!!a.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var G=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(F).then(function(c){c&&e._edgeView.updateObjectVisibility(F.objectHandle,!1);return e._safeReschedule(d,function(){var d=e._addTasks.get(a.index);if(d)if(b.isSome(e._labeler)&&e._addMetaToLabeler(e._labeler,F),e._addNodeMeta(a.index,F),d.meta=null,e.suspended)e._removeNodeStageData(a.index,e.elevationOffset);else{u.setObjectVisibility(y,!0);c&&e._edgeView.updateObjectVisibility(F.objectHandle,
!0);F.attributeInfo=d.attributeInfo;var d=F.cachedRendererVersion!==e._rendererVersion,f=G!==e.slicePlaneEnabled;e._setObjectSymbolColors(F);var g=e._applyFiltersToNode(F);(d||c&&(f||g))&&e._addOrUpdateEdgeRendering(F);e.visibleGeometryChanged(F);e._highlights.objectCreated(F);e._updateMaterial(F);e._setNewNodeOpacity(a.index,F);e._treeDebugger&&e._treeDebugger.update()}})}).catch(function(a){b.isSome(E.meta)&&(e._deleteComponentObject(E.meta),E.meta=null);throw a;})};h.prototype._addNodeMeta=function(a,
c){this._removeNodeStageData(a,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(a)){qa.error("Removing duplicated node");var d=this._nodeId2Meta.get(a);b.isSome(d)&&this._deleteComponentObject(d)}this._nodeId2Meta.set(a,c)};h.prototype._safeReschedule=function(a,b){p.throwIfAborted(a);return this._controller.reschedule(a,b)};h.prototype._materialParameters=function(a,b){a=a.params.material;var c=b.some(function(a){return"uvRegion"===a.name});b=b.some(function(a){return"normalCompressed"===
a.name});var d=ya(a);return{geometryParams:this._getGeometryParameters({hasTexture:d,hasNormals:b,hasRegions:c}),material:a}};h.prototype._configureMaterial=function(a,c,d,e){var g=this,h=this.rendererTextureUsage,k=function(a){a:{a&=h;if(!b.isNone(e)&&0!==a)for(var c=0;c<e.length;c++){var f=e[c];if(b.isSome(f)&&0!==(f.usage&a)){a=d[c].id;break a}}a=null}return a};this._collection.updateMaterial(a,function(a){var b=c.metallicRoughness.baseColorFactor,d=f.clamp(c.metallicRoughness.baseColorFactor[3],
0,1);a.baseColor=[b[0],b[1],b[2],d];a.mrrFactors=[c.metallicRoughness.metallicFactor,c.metallicRoughness.roughnessFactor,c.isSchematic?.2:.5];a.emissiveFactor=c.emissiveFactor;a.usePBR=g._usePBR(c.isSchematic);a.isIntegratedMesh=g._isIntegratedMesh;a.alphaCutoff="mask"===c.alphaMode?c.alphaCutoff:na.defaultMaskAlphaCutoff;a.alphaDiscardMode="opaque"===c.alphaMode?1:"mask"===c.alphaMode?2:3;b=g._stage.renderView.textureRepository;if(d=k(33))a.baseColorTexture=new pa.RenderTexture(b,d);if(d=k(2))a.metallicRoughnessTexture=
new pa.RenderTexture(b,d);if(d=k(16))a.emissionTexture=new pa.RenderTexture(b,d);if(d=k(8))a.occlusionTexture=new pa.RenderTexture(b,d);if(d=k(4))a.normalTexture=new pa.RenderTexture(b,d);a.commonMaterialParameters.slicePlaneEnabled=g.slicePlaneEnabled;a.commonMaterialParameters.doubleSided=c.doubleSided;a.commonMaterialParameters.cullFace=c.cullFace;g._updateMaterialOverlay(a)})};h.prototype._getGeometryParameters=function(a){return{textureCoordinates:a.hasTexture?a.hasRegions?2:1:0,colors:this._hasVertexColors,
normals:a.hasNormals&&!this._isIntegratedMesh}};h.prototype._addData=function(a,b,c){var e=this,f=this._addTasks.get(a.index);f?f.attributeInfo=b:(f=d.__assign(d.__assign({},p.createResolver()),{attributeInfo:b,meta:null}),this._addTasks.set(a.index,f),c().then(f.resolve,f.reject).then(function(){return e._addTasks.delete(a.index)}).catch(function(b){e._addTasks.delete(a.index);throw b;}));return f.promise};h.prototype._clearAddTasks=function(){var a=this;this._addTasks.forEach(function(c){b.isSome(c.meta)&&
(a._deleteComponentObject(c.meta),c.meta=null)});this._addTasks.clear()};h.prototype._clippingAreaChanged=function(){var a=G.create();ha.projectToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?this._clippingArea=a:this._clippingArea=null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};h.prototype._filterChange=function(){this._applyFilters(!1)};h.prototype._applyFilters=function(a){var c=this;this._filters=this.getFilters();
a?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(function(a){b.isSome(a)&&c._applyFiltersToNode(a)&&(c._addOrUpdateEdgeRendering(a),c.visibleGeometryChanged(a))})};h.prototype.getFilters=function(){var a=this,b=[];this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,c,a._clippingArea)});return b};h.prototype.addSqlFilter=function(a,b,c,d){var e=this;b&&c&&a.push(function(a,f){return e._sqlFilter(a,f,b,c,d)})};h.prototype._sqlFilter=function(a,c,d,e,
f){var g={},h=this._createLayerGraphic(g),k=this.i3slayer.objectIdField,m=c.featureIds,l=b.isSome(c.attributeInfo)&&c.attributeInfo.attributeData;e.every(function(a){return null!=l[a]||a===k})&&X.filterInPlace(a,m,function(a){g[k]=m[a];for(var b=0;b<e.length;b++){var c=e[b];c!==k&&(g[c]=X.getCachedAttributeValue(l[c],a))}try{if(Array.isArray(d)){for(a=0;a<d.length;a++)if(d[a].testFeature(h))return!0;return!1}return d.testFeature(h)}catch(Ra){return f(Ra),!1}})};h.prototype._boundingboxNodeTest=function(a,
b){fa.mbsToMbs(a.node.mbs,this._controller.crsIndex,Ha,this.view.renderSpatialReference);return X.intersectBoundingBoxWithMbs(b,Ha)};h.prototype._boundingboxFeatureTest=function(a,b,c){return G.intersects(c,this._collection.getComponentAabb(a.objectHandle,b,La))};h.prototype._boundingboxFilter=function(a,b,c){var d=this,e=this._collection,f=this._boundingboxNodeTest(b,c);if(3!==f)if(0===f)a.length=0;else if(e=e.getComponentCount(b.objectHandle),e.invisible+e.visible===b.featureIds.length){var g=this._transformAABB(Ga,
c,b.objectHandle);X.filterInPlace(a,b.featureIds,function(a){return d._boundingboxFeatureTest(b,a,g)})}};h.prototype._transformAABB=function(a,b,c){var d=this._collection.getObjectTransform(c);c=d.position;d=d.rotationScale;a[0]=(b[0]-c[0])/d[0];a[1]=(b[1]-c[1])/d[4];a[2]=(b[2]-c[2])/d[8];a[3]=(b[3]-c[0])/d[0];a[4]=(b[4]-c[1])/d[4];a[5]=(b[5]-c[2])/d[8];return a};h.prototype._addOrUpdateEdgeRendering=function(a,b){void 0===b&&(b=!0);if(!this._edgeView)return p.resolve(!1);var c=a.objectHandle,d=this._edgeView.hasObject(c);
a=this._getFilteredEdgeMaterials(a);var e=a.perFeatureEdgeMaterials,f={slicePlaneEnabled:this.slicePlaneEnabled};if(a.hasEdges)return d?(this._edgeView.updateAllComponentMaterials(c,e,f,b),this._edgeView.updateObjectVisibility(c,!0),p.resolve(!0)):this._collection.addEdges(c,this._edgeView,e,f).then(function(){return!0});d&&this._edgeView.removeObject(c);return p.resolve(!1)};h.prototype._removeEdgeRendering=function(a){this._edgeView&&this._edgeView.hasObject(a.objectHandle)&&this._edgeView.removeObject(a.objectHandle)};
h.prototype._applyFiltersToNode=function(a){return this._applyFiltersToNodeComponents(a)?(b.isSome(this._labeler)&&this._labeler.applyFilterChange(a),!0):!1};h.prototype._applyFiltersToNodeComponents=function(a){var b=this._collection,c=0===b.getComponentCount(a.objectHandle).invisible;b.setAllComponentVisibilities(a.objectHandle,"all");if(0===this._filters.length)return a.filteredIds=null,!c;this._updateCachedFilteredIds(a);if(a.filteredIds===a.featureIds)return!c;c=this._computeFilteredComponentIndices(a);
b.setAllComponentVisibilities(a.objectHandle,c);return!0};h.prototype._updateCachedFilteredIds=function(a){if(null==a.filteredIds||a.appliedFilters!==this._filters)a.filteredIds=this._computeFilteredIds(a),a.appliedFilters=this._filters};h.prototype._computeFilteredIds=function(a){for(var b=a.featureIds.slice(),c=0,d=this._filters;c<d.length&&((0,d[c])(b,a),0!==b.length);c++);return b.length===a.featureIds.length?a.featureIds:b};h.prototype._computeFilteredComponentIndices=function(a){var b=[];a.featureIds.forEach(function(c,
d){a.filteredIds[b.length]===c&&b.push(d)});return b};h.prototype._removeAllNodeDataFromStage=function(a){var b=this;void 0===a&&(a=this.elevationOffset);this._nodeId2Meta.forEach(function(c,d){return b._removeNodeStageData(d,a)});this._nodeId2MetaReloading.forEach(function(c,d){return b._removeNodeStageData(d,a,b._nodeId2MetaReloading)})};h.prototype.removeNode=function(a){var b=this.elevationOffset;this._removeNodeStageData(a,b);this._removeNodeStageData(a,b,this._nodeId2MetaReloading)};h.prototype._removeNodeStageData=
function(a,c,d){void 0===d&&(d=this._nodeId2Meta);var e=d.get(a);b.isNone(e)?d.delete(a):(this._collection.setObjectVisibility(e.objectHandle,!1),this.visibleGeometryChanged(e),this._removeEdgeRendering(e),b.isSome(this._labeler)&&this._labeler.removeNodeMeta(e),d.delete(a),this._highlights.objectDeleted(e),d===this._nodeId2Meta?this._cacheGPUData(e,c):this._deleteComponentObject(e),this._treeDebugger&&this._treeDebugger.update())};h.prototype._deleteComponentObject=function(a){this._edgeView&&this._edgeView.removeObject(a.objectHandle);
this.memEstimateGeometryRemoved(a.objectHandle);this._collection.destroyObject(a.objectHandle);if(a.textures){var b=0;for(a=a.textures;b<a.length;b++){var c=a[b];this.memEstimateTextureRemoved(c);this._stage.remove(4,c.id)}}};h.prototype.updateNodeState=function(a,c){a=this._nodeId2Meta.get(a);b.isSome(a)&&this._collection.updateMaterial(a.objectHandle,function(a){return a.polygonOffsetEnabled=0===c})};h.prototype._invalidateAllSymbols=function(){this._rendererVersion=X.addWraparound(this._rendererVersion,
1);this._controller&&this._controller.requestUpdate()};h.prototype._getInvalidRendererVersion=function(){return X.addWraparound(this._rendererVersion,-1)};h.prototype._rendererChange=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e,f,g,h,k,m,l,n;return d.__generator(this,function(d){switch(d.label){case 0:this._currentRenderer=a;this.notifyChange("rendererTextureUsage");this._rendererVersion=X.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=
null;this._invalidateAllSymbols();if(!a)return[3,2];b=this;c=H.fixFields;e=[this.i3slayer.fields];return[4,a.getRequiredFields(this.i3slayer.fields)];case 1:b._rendererFields=c.apply(void 0,e.concat([d.sent()])),d.label=2;case 2:this._updateSymbologyFields();if(!(!this._arcade&&a&&"arcadeRequired"in a&&a.arcadeRequired))return[3,4];f=this;return[4,L.loadArcade()];case 3:f._arcade=d.sent(),d.label=4;case 4:if(a&&"visualVariables"in a&&a.visualVariables)for(g=0,h=a.visualVariables;g<h.length;g++)k=
h[g],"color"===k.type?this._colorVariable=k:"opacity"===k.type?this._opacityVariable=k:qa.warn("Unsupported visual variable type for 3D Object Scene Services: "+k.type);if(a)for(m=0,l=a.getSymbols();m<l.length;m++)n=l[m],"mesh-3d"!==n.type&&qa.error("Symbols of type '"+n.type+"' are not supported for 3D Object Scene Services.");this._controller&&this._controller.requestUpdate();return[2]}})})};h.prototype._getCachedEdgeMaterials=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&
this._updateCachedRendererData(a);return a.cachedEdgeMaterials};h.prototype._getSymbolColors=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);var b=a.cachedSymbology;return function(a,c){a*=5;E.vec4.set(c.externalColor,b[a+0]/255,b[a+1]/255,b[a+2]/255,b[a+3]/255);c.externalColorMixMode=b[a+4]&15;c.castShadows=0!==(b[a+4]&16);c.pickable=0!==(b[a+4]&32)}};h.prototype._getSymbolInfo=function(a,b){b=a&&a.getSymbol(b,{arcade:this._arcade});
if(!(b instanceof M))return null;a=b.id;if(this._symbolInfos.has(a))return this._symbolInfos.get(a);b=X.getSymbolInfo(b);this._symbolInfos.set(a,b);return b};h.prototype._setSymbologyOverride=function(a,b){this._symbologyOverride!==a&&(this._symbologyOverride=a,this._symbologyOverrideFields=b,this._invalidateAllSymbols(),this._updateSymbologyFields())};h.prototype._updateSymbologyFields=function(){this._symbologyFields=b.isSome(this._symbologyOverrideFields)&&0<this._symbologyOverrideFields.length?
b.isSome(this._rendererFields)&&0<this._rendererFields.length?H.fixFields(this.i3slayer.fields,d.__spreadArrays(this._rendererFields,this._symbologyOverrideFields)):this._symbologyOverrideFields:this._rendererFields};h.prototype._updateCachedRendererData=function(a){a.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var c=this._tmpAttributeOnlyGraphic,e={};c.attributes=e;var f=this._currentRenderer,g=b.isSome(a.attributeInfo)&&a.attributeInfo.attributeData,h=null!=a.featureIds?
this.i3slayer.objectIdField:null,k=null!=g&&b.isSome(this._symbologyFields)&&0<this._symbologyFields.length,m=k?[]:null,l=k?[]:null;if(k&&b.isSome(this._symbologyFields))for(var n=0,p=this._symbologyFields;n<p.length;n++){var r=p[n],q=g[r];q&&(m.push(r),l.push(q))}a.cachedSymbology||(a.cachedSymbology=new Uint8Array(5*a.featureIds.length));for(var g={color:ra,castShadows:!0,pickable:!0,colorMixMode:1,edgeMaterial:null},n=this.fullOpacity,p=null,r=2,q=X.transparentEdgeMaterial,u=0,t=0;t<a.featureIds.length;t++){null!=
h&&(e[h]=a.featureIds[t]);if(k)for(var v=0;v<m.length;v++)e[m[v]]=X.getCachedAttributeValue(l[v],t);var x=this._getSymbolInfo(f,c),w=v=null;if(f&&"visualVariables"in f){if(this._colorVariable){var B=K.getColor(this._colorVariable,c,{color:Na,arcade:this._arcade});B&&(v=ra,v[0]=B.r/255,v[1]=B.g/255,v[2]=B.b/255,this._opacityVariable||null===B.a||(w=B.a))}this._opacityVariable&&(w=K.getOpacity(this._opacityVariable,c,{arcade:this._arcade}))}x&&x.material&&(B=x.material,v=b.isNone(v)||b.isNone(w)?S.overrideColor(v,
w,B.color,B.alpha,aa,ra):S.overrideColor(v,w,null,null,aa,ra));b.isNone(v)&&(v=ra,v[0]=1,v[1]=1,v[2]=1,v[3]=1);g.pickable=!0;g.castShadows=x?x.castShadows:!0;g.colorMixMode=x&&x.material?x.material.colorMixMode:1;g.edgeMaterial=x?x.edgeMaterial:null;b.isSome(this._symbologyOverride)&&(g.color=v,this._symbologyOverride(c,g),v=g.color);if(b.isSome(g.edgeMaterial)){x=0>=v[3]?0:1<=v[3]&&(a.material.isOpaque||3===g.colorMixMode)?2:1;if(g.edgeMaterial!==p||x!==r)q=d.__assign(d.__assign({},g.edgeMaterial),
{opacity:n,objectTransparency:x}),p=g.edgeMaterial,r=x;a.cachedEdgeMaterials[t]=q}else a.cachedEdgeMaterials[t]=X.transparentEdgeMaterial;a.cachedSymbology[u+0]=Math.round(255*v[0]);a.cachedSymbology[u+1]=Math.round(255*v[1]);a.cachedSymbology[u+2]=Math.round(255*v[2]);a.cachedSymbology[u+3]=Math.round(255*v[3]);a.cachedSymbology[u+4]=g.colorMixMode|+g.castShadows<<4|+g.pickable<<5;u+=5}}};h.prototype._getFilteredEdgeMaterials=function(a){var c=this,d=this._getCachedEdgeMaterials(a);d.forEach(function(a){return a.opacity=
c.fullOpacity});if(b.isNone(a.filteredIds))return{hasEdges:d.some(function(a){return a!==X.transparentEdgeMaterial}),perFeatureEdgeMaterials:d};var e=0,f=!1,d=d.map(function(b,c){if(a.featureIds[c]!==a.filteredIds[e])return X.transparentEdgeMaterial;f=f||b!==X.transparentEdgeMaterial;e++;return b});return{hasEdges:f,perFeatureEdgeMaterials:d}};h.prototype._setObjectSymbolColors=function(a){if(this._hasSymbolColors){var b=a.objectHandle;a=this._getSymbolColors(a);this._collection.setComponentData(b,
a);this._stage.renderView.setNeedsRender()}};h.prototype._reloadAll=function(a){void 0===a&&(a=this.elevationOffset);this._removeAllNodeDataFromStage(a);null!=this._controller&&this._controller.restartNodeLoading()};h.prototype._opacityChange=function(a){var c=this;this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(function(d){b.isNone(d)||(c._collection.updateMaterial(d.objectHandle,function(b){return b.objectOpacity=a}),d.cachedEdgeMaterials.forEach(function(b){return b.opacity=
a}),c._updateEdgeRendering(d))})};h.prototype._updateMaterial=function(a){var b=this;this._collection.updateMaterial(a.objectHandle,function(c){c.commonMaterialParameters.slicePlaneEnabled=b.slicePlaneEnabled;c.usePBR=b._usePBR(a.material.isSchematic);b._updateMaterialOverlay(c)})};h.prototype._updateMaterialOverlay=function(a){};h.prototype._updateEngineObject=function(a){this._setObjectSymbolColors(a);this._applyFiltersToNode(a);this._addOrUpdateEdgeRendering(a);this.visibleGeometryChanged(a)};
h.prototype._slicePlaneEnabledChange=function(a){var c=this;this._intersectionHandler&&(this._intersectionHandler.slicePlane=a);b.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=a);this._nodeId2Meta.forEach(function(d){b.isNone(d)||(c._collection.updateMaterial(d.objectHandle,function(b){b.commonMaterialParameters.slicePlaneEnabled=a}),c._updateEdgeRendering(d,!1))})};h.prototype._updatePBR=function(){var a=this;this._nodeId2Meta.forEach(function(c){b.isNone(c)||a._collection.updateMaterial(c.objectHandle,
function(b){b.usePBR=a._usePBR(c.material.isSchematic)})})};h.prototype._usePBR=function(a){return!this._isIntegratedMesh&&(a?this.view.qualitySettings.physicallyBasedRenderingEnabled:!0)};h.prototype._updateEdgeRendering=function(a,b){void 0===b&&(b=!0);this._edgeView&&this._edgeView.hasObject(a.objectHandle)&&this._addOrUpdateEdgeRendering(a,b)};h.prototype._forAllNodes=function(a){this._nodeId2Meta.forEach(a)};h.prototype._forAllFeatures=function(a,c,d){var e=this;void 0===d&&(d=0);m.someMap(this._nodeId2Meta,
function(f){if(b.isNone(f))return!1;if(b.isSome(c))switch(c(f)){case 0:return!0;case 2:return!1}var g=1;switch(d){case 1:g=e._forAllFeaturesOfNode(f,a);break;case 0:g=e._forVisibleFeaturesOfNode(f,a);break;case 2:g=e._forAllFeaturesOfNodeInClippingArea(f,a)}return 0===g})};h.prototype._forAllFeaturesOfNode=function(a,b){for(var c=1,d=a.featureIds,e=0;e<d.length&&(c=b(d[e],e,a),0!==c);e++);return c};h.prototype._forVisibleFeaturesOfNode=function(a,b){var c=1,d=a.featureIds;this._collection.forEachVisibleComponent(a.objectHandle,
function(e){c=b(d[e],e,a);return 1===c});return c};h.prototype._forAllFeaturesOfNodeInClippingArea=function(a,b){if(null==this._clippingArea)return this._forAllFeaturesOfNode(a,b);var c=this._boundingboxNodeTest(a,this._clippingArea);if(0===c)return 1;if(3===c)return this._forAllFeaturesOfNode(a,b);for(var c=a.featureIds,d=X.getClipAABB(this._clippingArea,this._collection.getObjectTransform(a.objectHandle)),e=0;e<c.length;e++)if(this._boundingboxFeatureTest(a,e,d)){var f=b(c[e],e,a);if(0===f)return f}return 1};
h.prototype._createAttributes=function(a,c){var d={};null!=c.featureIds&&(d[this._getObjectIdField()]=c.featureIds[a]);c=b.isSome(c.attributeInfo)&&c.attributeInfo.attributeData;if(b.isSome(c))for(var e=0,f=Object.keys(c);e<f.length;e++){var g=f[e];d[g]=X.getCachedAttributeValue(c[g],a)}return d};h.prototype._createGraphic=function(a,b){return this._createLayerGraphic(this._createAttributes(a,b))};h.prototype.highlight=function(a){var b=this,c=this._highlights;"number"===typeof a?a=[a]:a instanceof
k?a=[a]:a instanceof e&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof k){a=a.map(function(a){return ba.attributeLookup(a.attributes,b._getObjectIdField())});var d=c.acquireSet(),f=d.set,d=d.handle;c.setFeatureIds(f,a);return d}if("number"===typeof a[0])return d=c.acquireSet(),f=d.set,d=d.handle,c.setFeatureIds(f,a),d}return Xa};h.prototype.visibleGeometryChanged=function(a){var b=this;this._elevationProvider&&(this._elevationProvider.objectChanged(a.node),null==this._visibleGeometryChangedSchedulerHandle&&
(this._visibleGeometryChangedSchedulerHandle=t.schedule(function(){b.emit("visible-geometry-changed");b._visibleGeometryChangedSchedulerHandle=null})))};Object.defineProperty(h.prototype,"performanceInfo",{get:function(){var a={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+
"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB"};this._controller&&(this._idbCacheEnabled&&(a.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(a));return a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"test",{get:function(){var a=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){var b=[];a._forAllFeatures(function(a){b.push(a);return 1},null,0);b.sort(function(a,b){return a-
b});return b},get numNodes(){return a._nodeId2Meta.size}}},enumerable:!1,configurable:!0});h.prototype.getNodeOpacityByIndex=function(a){a=this._nodeId2Meta.get(a);return this.getNodeOpacity(a)};h.prototype.getNodeOpacity=function(a){var c=0;b.isSome(a)&&this._collection.updateMaterial(a.objectHandle,function(a){c=a.objectOpacity});return c};h.prototype.getNodeCrossfadeMetaData=function(a){var b;return null===(b=this._nodeId2Meta)||void 0===b?void 0:b.get(a)};h.prototype.markNodeToRemove=function(a){var b=
this._controller;b&&b.markNodeToRemove(a)};h.prototype.removeMarkedNodes=function(){var a=this._controller;a&&a.removeMarkedNodes()};h.prototype.foreachCrossfadeNode=function(a){var b=this._nodeId2Meta;b&&b.forEach(function(b,c){return a(c,b)})};h.prototype.setNodeOpacityByIndex=function(a,c){a=this._nodeId2Meta.get(a);b.isSome(a)&&this.setNodeOpacity(a,c)};h.prototype.setNodeOpacity=function(a,b){this._collection.updateMaterial(a.objectHandle,function(a){a.objectOpacity=b});this.setNodeEdgeOpacity(a,
b)};h.prototype.setNodeEdgeOpacity=function(a,b){var c=this._getFilteredEdgeMaterials(a);if(c.hasEdges){for(var d=0,c=c.perFeatureEdgeMaterials;d<c.length;d++)c[d].opacity=b;this._addOrUpdateEdgeRendering(a)}};Object.defineProperty(h.prototype,"_hasModifications",{get:function(){return this._modifications&&0<this._modifications.length},enumerable:!1,configurable:!0});h.prototype.updateNodeModificationStatus=function(a){var c=this,d=a.length;if(!(!this._hasModifications||0>=d||b.isNone(this._i3sModule)||
this._i3sModule instanceof Promise)){var d=this.i3slayer.uid,e=ma(a);if(b.isSome(e)){this._i3sModule.filterObbsForModificationsSync({context:d,buffer:e.buffer});var f=new Float64Array(e.buffer);a.forEachSimple(function(a,b){b=N.interpretObbModificationResults(f[b]);a.imModificationImpact=b;0!==b&&c._controller.invalidateGeometryVisibility(a.index)})}}};h.prototype.notifyUpdate=function(){this.notifyChange("updating")};h.prototype.isUpdating=function(){return!(!this._controller||!this._controller.updating)||
!!this._visibleGeometryChangedSchedulerHandle||b.isSome(this._labeler)&&this._labeler.updating||0<this._crossfadeHelper.numFadingNodes||0<this._asyncModuleLoading};d.__decorate([v.property({readOnly:!0})],h.prototype,"lodCrossfadeDuration",null);d.__decorate([v.property({})],h.prototype,"_asyncModuleLoading",void 0);d.__decorate([v.property()],h.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);d.__decorate([v.property()],h.prototype,"view",void 0);d.__decorate([v.property()],h.prototype,
"i3slayer",void 0);d.__decorate([v.property()],h.prototype,"_controller",void 0);d.__decorate([v.property()],h.prototype,"_labeler",void 0);d.__decorate([v.property({dependsOn:["_controller.updating","_visibleGeometryChangedSchedulerHandle","_labeler.updating","_asyncModuleLoading"]})],h.prototype,"updating",void 0);d.__decorate([v.property({dependsOn:["_controller.rootNodeVisible"]})],h.prototype,"suspended",void 0);d.__decorate([v.property()],h.prototype,"holeFilling",void 0);d.__decorate([v.property(ga.updatingProgress)],
h.prototype,"updatingProgress",void 0);d.__decorate([v.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],h.prototype,"updatingProgressValue",void 0);d.__decorate([v.property({readOnly:!0})],h.prototype,"hasTexturesOrVertexColors",null);d.__decorate([v.property({readOnly:!0})],h.prototype,"rendererTextureUsage",null);d.__decorate([v.property({readOnly:!0,dependsOn:["i3slayer.elevationInfo"]})],h.prototype,"elevationOffset",null);d.__decorate([v.property({type:Boolean})],h.prototype,"slicePlaneEnabled",
void 0);d.__decorate([v.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","useCompressedTextures"]})],h.prototype,"uncompressedTextureDownsamplingEnabled",null);d.__decorate([v.property({dependsOn:["i3slayer.version"]})],h.prototype,"useCompressedTextures",null);d.__decorate([v.property({type:[I]})],h.prototype,"_modifications",void 0);return h=d.__decorate([v.subclass("esri.views.3d.layers.I3SMeshView3D")],h)}(a)};var La=G.create(),Ga=G.create(),y=da.create(),
ra=[0,0,0,0],Na=new l([0,0,0,0]),Ha=[0,0,0,0],Xa={remove:function(){},pause:function(){},resume:function(){}}})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("require exports tslib ../../../core/Accessor ../../../core/arrayUtils ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../dehydratedFeatures ../../support/PromiseQueue ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/support/debugFlags ../../../views/3d/support/debugUtils ../../../views/3d/support/extentUtils ../../../views/3d/support/projectionUtils ../../../views/support/layerViewUtils ../../../views/support/Scheduler".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M){function Q(a,b){return m.isSome(a)&&a.length===b.length&&a.every(function(a){return 0<=R(b,a.name)})}function R(a,b){b=b.toLowerCase();for(var c=0;c<a.length;c++)if(a[c].name.toLowerCase()===b)return c;return-1}function O(a){return m.isSome(a)&&m.isSome(a.loadedAttributes)&&m.isSome(a.attributeData)}var N=h.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");n=function(a){function b(b){b=a.call(this,b)||this;
b.screenSizeFactor=0;b.featureTarget=5E4;b.fixedFeatureTarget=!1;b.updating=!0;b.updatingProgress=1;b.leafsReached=!1;b.scaleVisibilityEnabled=!0;b.uncompressedTextureDownsamplingEnabled=!1;b._featureLOD=1;b._stableFeatureLOD=!1;b._isIdle=!1;b._cameraDirty=!0;b._invisibleDirty=!1;b._newLoadingNodes=new f({deallocator:null});b._loadedNodeScales=new Map;b._modificationsNodeFilteringArray=new f;b._downloadingCount=0;b._loadingNodes=new Map;b._updatingNodes=new Map;b._progressMaxNumNodes=1;b._poi=r.vec3f64.create();
b._requiredAttributes=[];b._requiredAttributesDirty=!0;b._updatesDisabled=!1;b.disableIDBCache=!1;b._disableMemCache=!1;b._restartNodeLoading=!1;b._fields=null;b._attributeStorageInfo=null;b._handles=new e;b._idleQueue=new z.default;b._elevationUpdateNodes=new f({deallocator:null});b._errorCount=0;return b}d.__extends(b,a);Object.defineProperty(b.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!1,configurable:!0});
Object.defineProperty(b.prototype,"isGraphics3D",{get:function(){return"points"===this.layer.profile},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"streamDataController",{get:function(){var a=this.layerView.view.resourceController.createStreamDataRequester(2);return new E.default(a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"crsVertex",{get:function(){return G.getVertexCrs(this.layer)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"crsIndex",{get:function(){return G.getIndexCrs(this.layer)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"rootNodeVisible",{get:function(){if(m.isSome(this._index)){var a=this._index.rootNode;if(m.isSome(a))return this._updateViewData(),this._index.isNodeVisible(a.index)}return!0},enumerable:!1,configurable:!0});b.prototype.initialize=function(){var a=this;this._disableMemCache=!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData;this._lodHandling=new A(this.layerView);
var b=this.layerView.i3slayer;this.layer=b;this._defaultGeometrySchema=b.store.defaultGeometrySchema;this.disableIDBCache=c("disable-feature:idb-cache");"fields"in b&&(this._fields=b.fields,this._attributeStorageInfo=b.attributeStorageInfo);var d=g.all([this.layer.when(),this.layerView.when()]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){var c=a.layerView.view;a._setClippingArea(c.clippingArea);a._centerOnSurface=c.pointsOfInterest.centerOnSurfaceFrequent;var d=a.layerView.view.resourceController;
a._handles.add([a._centerOnSurface.watch("renderLocation",function(){return a._pointOfInterestChanged()}),d.memoryController.events.on("quality-changed",function(){return a._setCameraDirty()}),p.init(a.layerView,"suspended",function(b){var c=b?function(){return a._updateViewData()}:function(){return a._updateIdleState(!0)},e=b?function(){}:function(){return a._updateIdleState(!1)};a._idleStateCallbacks?(b&&a.cancelNodeLoading(),a.restartNodeLoading(),a._idleStateCallbacks.idleBegin=c,a._idleStateCallbacks.idleEnd=
e):a._idleStateCallbacks=d.scheduler.registerIdleStateCallbacks(c,e)}),x.addTask(a.layerView.view.resourceController.scheduler,{update:function(b,c){return a._frame(b,c)},needsUpdate:function(){return a.updating}}),a.watch("uncompressedTextureDownsamplingEnabled",function(){return a.restartNodeLoading()}),a.watch(["featureTarget","fixedFeatureTarget"],function(){a._setCameraDirty();a._stableFeatureLOD=!1}),c.state.watch("camera",function(){return a._setCameraDirty()}),a.layer.watch("elevationInfo",
function(){return a._elevationInfoChanged()}),a.layer.watch(["minScale","maxScale"],function(){return a._scaleBoundsChanged()}),a.layerView.watch("lodFactor",function(){return a._setCameraDirty()}),a.layerView.watch("availableFields?",function(){return a._requiredFieldsChange()}),a.layerView.watch("holeFilling",function(b){return m.isSome(a._index)&&(a._index.holeFilling=b)})]);a._updateScaleHandles();a._viewportQueries=new F(a.crsIndex,c.renderCoordsHelper,c.state.camera,a._clippingArea,c.elevationProvider,
a.layer.elevationInfo,{progressiveLoadFactor:a._getProgressiveLoadFactor(),screenspaceErrorBias:a.lod,angleDependentLoD:.5>a.lod});a._index=new B.I3SIndex(b,a.streamDataController,a._viewportQueries,N,a.layerView.holeFilling,function(b){return a.layerView.isNodeLoaded(b)},function(b){return a.layerView.isNodeReloading(b)},function(b){return a._shouldLoadNode(b)},function(b){return a._enableFromGPUCache(b,1)},function(b){return a._needsUpdate(b)},function(){return!a.streamDataController.busy},function(b){return a.layerView.computeVisibilityObb?
a.layerView.computeVisibilityObb(b):null});c=m.isSome(a.layer.modifications)&&a.layer.modifications&&0<a.layer.modifications.length;a._index.imModificationsChanged(c)}});this._tmpPoint=w.makeDehydratedPoint(0,0,0,this.crsIndex);this.addResolvingPromise(d);this.when(function(){return a._startNodeLoading()})};b.prototype.updateNodeModificationStatus=function(a){var b=this,c=this._index,d=this.layerView;m.isSome(c)&&d&&d.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),a.forEachSimple(function(a){a=
c.getNode(a);m.isSome(a)&&b._modificationsNodeFilteringArray.push(a)}),d.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=!0)};b.prototype.destroy=function(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;S.prune();m.isSome(P)&&(P.remove(),P=null)};b.prototype._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||
!this._fields||!this.layerView.availableFields)return[];var a=this._attributeStorageInfo,b=this._fields,c=this.layer.objectIdField;return this.layerView.availableFields.map(function(c){var d=R(a,c);c=R(b,c);return 0<=d&&0<=c?{index:d,name:b[c].name,field:b[c],attributeStorageInfo:a[d]}:null}).filter(function(a){return null!=a&&a.name!==c})};b.prototype._requiredFieldsChange=function(){var a=this._getRequiredAttributes();Q(this._requiredAttributes,a)||(this._requiredAttributes=a,this._requiredAttributesDirty=
!1,this.restartNodeLoading())};b.prototype.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};b.prototype._setClippingArea=function(a){var b=q.create();I.projectToBoundingBox(a,b,this.layerView.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null};b.prototype._pointOfInterestChanged=function(){this._camPos&&(this._calculatePointOfInterest(this._poi),m.isSome(this._viewportQueries)&&(this._viewportQueries.setPointOfInterest(this._poi),m.isSome(this._index)&&
(this._index.progressiveLoadPenalty=U.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate())))};b.prototype._calculatePointOfInterest=function(a){var b=this._centerOnSurface.renderLocation,c=r.vec3f64.create();u.vec3.subtract(c,b,this._camPos);var d=this.layerView.view.renderCoordsHelper,e=r.vec3f64.create();d.worldUpAtPosition(b,e);c=u.vec3.angle(e,c)-.5*Math.PI;u.vec3.lerp(a,this._camPos,b,Math.max(0,Math.min(1,c/(.5*Math.PI))));H.SHOW_POI?(m.isNone(P)&&(P=new J.GraphicsHandle(this.layerView.view.graphics,
"blue")),P.showPoint(a,this.layerView.view.renderSpatialReference)):m.isSome(P)&&P.remove()};b.prototype.updateClippingArea=function(a){this._setClippingArea(a);m.isSome(this._viewportQueries)&&m.isSome(this._index)&&(this._viewportQueries.updateExtent(this._clippingArea),this._index.invalidateVisibilityCache());this._setCameraDirty()};b.prototype._setCameraDirty=function(){this._cameraDirty=!0;this.notifyChange("rootNodeVisible");this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};b.prototype.updateElevationChanged=
function(a,b){var c=this,d=this._index;if(!m.isNone(d)){var e=d.rootNode;if(!m.isNone(e)){var f=this._elevationUpdateNodes;f.clear();G.findIntersectingNodes(a,b,e,this.crsIndex,d,function(a){return f.push(a.index)});f.forEachSimple(function(a){d.invalidateBoundingVolumeCache(a);a===e.index&&c.notifyChange("rootNodeVisible")});f.length&&this.restartNodeLoading()}}};b.prototype.getParentIndex=function(a){return m.isSome(this._index)&&this._index.getParentIndex(a)};b.prototype._elevationInfoChanged=
function(){m.isSome(this._index)&&this._index.updateElevationInfo(this.layer.elevationInfo);this._setCameraDirty()};b.prototype._updateScaleHandles=function(){var a=this;this._handles.remove("scale-bounds");this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",function(b){return a._scaleUpdateHandler(b)}),"scale-bounds")};b.prototype._scaleBoundsChanged=function(){this.areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};
b.prototype._scaleUpdateHandler=function(a){this._updateScaleInBoundingRect(a.scale,a.extent,a.spatialReference);this._setCameraDirty()};b.prototype._updateScaleInBoundingRect=function(a,b,c){var d=this,e=this._index;m.isNone(e)||!m.isNone(e.rootNode)&&K.boundingRectToBoundingRect(b,c,Z,this.crsIndex)&&this._loadedNodeScales.forEach(function(b,c){b=e.getNode(c);m.isSome(b)&&v.containsPoint(Z,b.mbs)&&d._loadedNodeScales.set(c,a)})};b.prototype.restartNodeLoading=function(){this._restartNodeLoading=
!0;this.cancelNodeLoading();this._evaluateUpdating()};b.prototype.schedule=function(a,b){return this._idleQueue.push(function(){g.throwIfAborted(a);return b()})};b.prototype.reschedule=function(a,b){return this._idleQueue.unshift(function(){g.throwIfAborted(a);return b()})};Object.defineProperty(b.prototype,"isIntegratedMesh",{get:function(){return"integrated-mesh"===this.layer.type},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"areScaleBoundsActive",{get:function(){var a=L.extractSafeScaleBounds(this.layer),
b=a.minScale,a=a.maxScale;return this.scaleVisibilityEnabled&&(0<b||0<a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"unloadedMemoryEstimate",{get:function(){return m.isNone(this._index)||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"indexDepth",{get:function(){return m.isSome(this._index)?this._index.maxLevel:0},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"disableMemCache",{set:function(a){this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData||(this._disableMemCache=!0);this._disableMemCache=a},enumerable:!1,configurable:!0});b.prototype._frame=function(a,b){if(this.layerView.suspended)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||m.isNone(this._index))return-Infinity;this._processLogError(a,b);return this._index.getPriority()};b.prototype._processLogError=function(a,b){try{this._process(a,
b)}catch(ca){50>this._errorCount?N.error("Error during processing: "+ca):50===this._errorCount&&N.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};b.prototype._process=function(a,b){var c=this;this._restartNodeLoading&&this._startNodeLoading();if(null!=this._nodeLoader&&!m.isNone(this._index)){this._updateViewData();this._invisibleDirty&&this._removeInvisibleNodes(a)&&(this._invisibleDirty=!1);this.isIntegratedMesh&&(a.enabled=!1);a.run(function(){return c._processIndex(a)});
this._updateFeatureLOD();a.run(function(){return c._processCache(a)});this.isIntegratedMesh&&(a.enabled=!0);for(a.run(function(){return c._processNodes(a,b)});!a.done&&this._idleQueue.process();)a.madeProgress();a.run(function(){return c._prefetchIndex()});b.numIndexLoading+=this._index.getIndexLoading();b.numNodesLoading+=this._downloadingCount;a.run(function(){return c._lodHandling.lodGlobalHandling(a)});this._evaluateUpdating()}};b.prototype._processIndex=function(a){var b=this;if(m.isNone(this._index))return!1;
this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update(k.keysOfMap(this._loadingNodes),a,function(a){return b.updateNodeModificationStatus(a)}),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),a=this._index.getFeatureEstimate().leafsReached,this._index.isLoading()||a===this._get("leafsReached")||this._set("leafsReached",
a));return this._index.load()};b.prototype._prefetchIndex=function(){return m.isNone(this._index)||0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()};b.prototype._updateFeatureLOD=function(){if(this.isGraphics3D&&!m.isNone(this._index)&&!m.isNone(this._viewportQueries)){var a=!this._index.isLoading(),b=this.featureTarget*this.baseLOD,c=this._index.getFeatureEstimate();c.estimate=c.estimate||b/2;if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;
this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(a&&c.estimate<b){if(c.leafsReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(b/c.estimate,1.001));a=this.lod;b=this._index.checkFeatureTarget(b,a);b!==a&&(this._featureLOD=b/this.baseLOD,this._stableFeatureLOD=!0)}else if(c.estimate>1.2*b||a&&c.estimate>b){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(c.estimate/b-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,
Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.requestUpdate()}};b.prototype._processCache=function(a){var b=this._index;if(m.isNone(b))return!1;for(;0<this._newLoadingNodes.length&&!a.done;)for(var c=this._newLoadingNodes.pop(),c=b.getParent(c);m.isSome(c)&&!this.layerView.isNodeLoaded(c.index)&&this._isNodeInScaleBounds(c);c=b.getParent(c.index))if(this._enableFromGPUCache(c,0)){a.madeProgress();break}return a.hasProgressed};b.prototype._processNodes=
function(a,b){if(m.isNone(this._index))return!1;var c=(this._isIdle?100:2)-this._loadingNodes.size,d=this._index.updates;d.cancel.forEach(this._cancelNode,this);for(d.cancel=[];0<d.remove.length&&!a.done;)this.layerView.removeNode(d.remove.pop()),a.madeProgress();for(;0<d.update.length&&!a.done;){var e=this._index.getNode(d.update.pop());m.isSome(e)&&(this._updateLoadedNode(e),a.madeProgress())}for(;0<d.add.length&&!a.done&&0<c;){--c;e=this._index.getNode(d.add.back());if(m.isNone(e)||2!==e.cacheState&&
!this._hasNodeLoadToken(b))break;d.add.pop();this._loadNode(e);a.madeProgress()}return a.hasProgressed};b.prototype._cancelAllNodes=function(){this._loadingNodes.forEach(function(a){return a.abort()});this._loadingNodes.clear();this._updatingNodes.forEach(function(a){return a.abort()});this._updatingNodes.clear()};b.prototype._cancelNode=function(a){var b=this._loadingNodes.get(a);b&&(b.abort(),this._loadingNodes.delete(a))};b.prototype._hasNodeLoadToken=function(a){return!this._isIdle&&2<=a.numNodesLoading+
this._loadingNodes.size?!1:!this.streamDataController.busy};b.prototype._evaluateUpdating=function(){var a=!1,b=0;this.layerView.suspended?b=(a=this._cameraDirty)?.5:1:(a=m.isSome(this._index)?this._index.getIndexMissing():0,b=m.isSome(this._index)?this._index.updates.add.length:0,b=a+3*b+2*this._loadingNodes.size,a=!!(0<b||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===b&&(this._progressMaxNumNodes=
1),this._progressMaxNumNodes=Math.max(b,this._progressMaxNumNodes),b=1-b/this._progressMaxNumNodes);a!==this.updating&&this._set("updating",a);b!==this.updatingProgress&&this._set("updatingProgress",b)};b.prototype._updateViewData=function(){if(this._cameraDirty&&!m.isNone(this._index)&&!m.isNone(this._viewportQueries)){var a=this.layerView.view,b=a.state.camera;this._camPos=r.vec3f64.clone(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/(b.perScreenPixelRatio/2);this._calculatePointOfInterest(this._poi);
this._viewportQueries.updateCamera(b);this._viewportQueries.setPointOfInterest(this._poi);this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=U.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};b.prototype._getProgressiveLoadFactor=function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?
1:this.layerView.progressiveLoadFactor};Object.defineProperty(b.prototype,"lod",{get:function(){return this._featureLOD*this.baseLOD},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"baseLOD",{get:function(){var a=this.layerView.lodFactor,b=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<a?a:1)*b},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"lodDropFactor",{get:function(){if(this.fixedFeatureTarget)return 1;
var a=this.layerView.view.resourceController.memoryController;return(Math.min(a.memoryFactor,.5)-a.minQuality)/(.5-a.minQuality)},enumerable:!1,configurable:!0});b.prototype.isGeometryVisible=function(a){return m.isSome(this._index)&&this._index.isGeometryVisible(a.index)};b.prototype.updateVisibility=function(a){m.isSome(this._index)&&this._index.invalidateNodeVisibilityCache(a)};b.prototype.updateBoundingVolume=function(a){m.isSome(this._index)&&this._index.invalidateBoundingVolumeCache(a)};b.prototype.invalidateGeometryVisibility=
function(a){m.isSome(this._index)&&this._index.invalidateGeometryVisibility(a)};b.prototype.invalidateVisibilityObbs=function(){m.isSome(this._index)&&this._index.invalidateVisibilityObbs()};b.prototype.modificationsChanged=function(){if(m.isSome(this._index)){var a=m.isSome(this.layer.modifications)&&this.layer.modifications&&0<this.layer.modifications.length;this._index.imModificationsChanged(a)}this._invisibleDirty=!0};b.prototype._shouldLoadNode=function(a){return this._lodHandling.shouldLoadNode(a)&&
!this._shouldDropNode(a)&&this._isNodeInScaleBounds(a)?m.isSome(this._index)?this._index.isGeometryVisible(a.index):!1:!1};b.prototype._shouldDropNode=function(a){if(m.isNone(this._viewportQueries))return!1;var b=this.lodDropFactor;return 1<=b||!this._lodHandling.childrenEmpty(a)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(a))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*b};b.prototype._startNodeLoading=function(){var a=this;
this._restartNodeLoading=!1;var b=this._index;if(!(this._updatesDisabled||null==this.streamDataController||m.isNone(b)||m.isNone(this._viewportQueries))){this._updateViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);var c=C.TextureFormat.Normal;this.layerView.useCompressedTextures?c=C.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(c=C.TextureFormat.Downsampled);this._nodeLoader=new C(this.layer,
this.streamDataController,N,this._defaultGeometrySchema,this._requiredAttributes,{textureFormat:c,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:!this.isMeshPyramid});b.requestUpdate();this._lodHandling.startNodeLoading(function(b){return a._isNodeInScaleBounds(b)},function(b,c){return a._removeNodes(b,c)},b,{maxLodLevel:this._viewportQueries.maxLodLevel});this._evaluateUpdating()}};b.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};b.prototype.cancelNodeLoading=
function(){this.isNodeLoading()&&(this.streamDataController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())};b.prototype._removeInvisibleNodes=function(a){var b=this,c=this._index;if(m.isNone(c)||m.isNone(this._viewportQueries))return!1;S.clear();this.layerView.getLoadedNodeIndices(S);var d=0===this._viewportQueries.maxDistance,e=d?function(){return!1}:function(a){return b._shouldDropNode(a)};S.filterInPlace(function(a){var d=c.getNode(a);
return m.isNone(d)||!c.isGeometryVisible(a)||e(d)||!b._isNodeInScaleBounds(d)});0<S.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(S,a);if(d&&1>this.lodDropFactor)return!1;if(0===S.length)return!0;S.clear();return!1};b.prototype.markNodeToRemove=function(a){S.push(a)};b.prototype.removeMarkedNodes=function(){this._removeNodes(S,M.noBudget)};b.prototype._removeNodes=function(a,b){0<a.length&&m.isSome(this._index)&&this._index.requestUpdate();for(var c=a.length;0<a.length&&!b.done;)this.layerView.removeNode(a.pop()),
b.madeProgress();if(0<this._loadedNodeScales.size)for(b=a.length;b<c;b++)this._loadedNodeScales.delete(a.data[b])};b.prototype._needsUpdate=function(a){if(!a.resources.hasFeatureData||this._updatingNodes.has(a.index))return!1;a=this.layerView.getLoadedAttributes(a.index);return null!=a&&a!==this._requiredAttributes};b.prototype._updateLoadedNode=function(a){var b=this,c=g.createAbortController();this._updatingNodes.set(a.index,c);var d=this.layerView.getLoadedAttributes(a.index);(Q(d,this._requiredAttributes)?
g.resolve(this.layerView.getAttributeData(a.index)):this._nodeLoader.loadAttributes(a,this._requiredAttributes,c.signal)).then(function(d){return b.schedule(c.signal,function(){return b.layerView.setAttributeData(a.index,{loadedAttributes:b._requiredAttributes,attributeData:d})})}).catch(function(c){g.isAbortError(c)||b.layerView.setAttributeData(a.index,{loadedAttributes:b._requiredAttributes,attributeData:{}})}).catch(function(){}).then(function(){b._updatingNodes.delete(a.index);b._evaluateUpdating()});
this._evaluateUpdating()};b.prototype._loadNode=function(a){var b=this;if(this._loadingNodes.has(a.index))N.error("already loading node "+a.index);else{var c=g.createAbortController();this._loadingNodes.set(a.index,c);var d=function(){b._loadingNodes.get(a.index)===c&&b._loadingNodes.delete(a.index);b._evaluateUpdating()};this._evaluateUpdating();this._loadAndAddNode(a,c.signal).then(d).catch(function(a){d();if(!g.isAbortError(a))throw a;})}};b.prototype._loadAndAddNode=function(a,b){var c=this;return 1===
a.cacheState?this._loadUncached(a,b):this._loadCached(a,b).then(function(b){b||(a.cacheState=1,m.isSome(c._index)&&c._index.updates.add.push(a.index))}).catch(function(b){if(!g.isAbortError(b))throw a.cacheState=1,b;})};b.prototype._enableFromGPUCache=function(a,b){if(this._disableMemCache||m.isNone(this._index))return!1;if(0===b&&!this._index.useNodeAsHole(a.index))return!0;var c=this._loadCachedGPUData(a);if(!c)return!1;this.layerView.addCachedGPUData(a,c,b);this._nodeAdded();return!0};b.prototype._loadCachedGPUData=
function(a){a=this.layerView.loadCachedGPUData(a);return m.isSome(a)&&O(a.attributeInfo)&&Q(a.attributeInfo.loadedAttributes,this._requiredAttributes)?a:null};b.prototype._nodeAdded=function(){m.isSome(this._index)&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};b.prototype._loadCached=function(a,b){var c=this;if(this._enableFromGPUCache(a,1))return g.resolve(!0);var d=this.layerView;return!this.disableIDBCache&&d.loadCachedNodeData&&d.addCachedNodeData?
this.schedule(b,function(){return d.loadCachedNodeData(a,b,function(b,d){return c._nodeLoader.loadTextures(a,b,d)})}).then(function(e){if(m.isNone(e))return!1;var f=c._requiredAttributes;return O(e)&&Q(e.loadedAttributes,f)?c.reschedule(b,function(){return d.addCachedNodeData(a,e,e,b)}).then(function(){c._nodeAdded();return!0}):c.reschedule(b,function(){return c._nodeLoader.loadAttributes(a,f,b)}).then(function(g){return c.reschedule(b,function(){return d.addCachedNodeData(a,e,{loadedAttributes:f,
attributeData:g},b)})}).then(function(){c._nodeAdded();return!0})}):g.resolve(!1)};b.prototype._loadUncached=function(a,b){var c=this;this._downloadingCount++;return this._nodeLoader.loadNodeData(a,b).catch(function(a){c._downloadingCount--;throw a;}).then(function(d){c._downloadingCount--;return c.schedule(b,function(){return c.layerView.addNode(a,d,b)})}).then(function(){c._nodeAdded();a.cacheState=2}).catch(function(b){if(!g.isAbortError(b))throw N.error("Failed to load node '"+a.id+"': "+b),a.failed=
!0,m.isSome(c._index)&&c._index.requestUpdate(),b;})};b.prototype._updateIdleState=function(a){a!==this._isIdle&&(this._isIdle=a,this._evaluateUpdating(),a&&this._index&&m.isSome(this._index)&&this._index.resetFailedNodes())};b.prototype._getScale=function(a){if(this._loadedNodeScales.has(a.index))return this._loadedNodeScales.get(a.index);this._tmpPoint.x=a.mbs[0];this._tmpPoint.y=a.mbs[1];this._tmpPoint.z=a.mbs[2];var b=this.layerView.view.basemapTerrain.getScale(this._tmpPoint);this.layerView.isNodeLoaded(a.index)&&
this._loadedNodeScales.set(a.index,b);return b};b.prototype._isNodeInScaleBounds=function(a){if(!this.areScaleBoundsActive)return!0;a=this._getScale(a);var b=L.extractSafeScaleBounds(this.layer);return L.scaleBoundsPredicate(a,b.minScale,b.maxScale)};b.prototype.updateStats=function(a){a.index=m.isSome(this._index)?this._index.size:0;this.isGraphics3D&&(a.detail=this._featureLOD,a.target=this.featureTarget*this.baseLOD);m.isSome(this._index)&&this._index.updateStats(a)};Object.defineProperty(b.prototype,
"test",{get:function(){var a=this;return{index:this._index,set disableUpdates(b){(a._updatesDisabled=b)?a.cancelNodeLoading():a.requestUpdate()},set disableIDBCache(b){a.disableIDBCache=b},set ignoreServiceObb(b){m.isSome(a._index)&&(a._index.ignoreServiceObb=b)},shouldLoadNode:function(b){return a._shouldLoadNode(b)}}},enumerable:!1,configurable:!0});d.__decorate([t.property({readOnly:!0})],b.prototype,"isMeshPyramid",null);d.__decorate([t.property({readOnly:!0})],b.prototype,"isGraphics3D",null);
d.__decorate([t.property({readOnly:!0})],b.prototype,"streamDataController",null);d.__decorate([t.property({readOnly:!0})],b.prototype,"crsVertex",null);d.__decorate([t.property({readOnly:!0})],b.prototype,"crsIndex",null);d.__decorate([t.property()],b.prototype,"_camPos",void 0);d.__decorate([t.property()],b.prototype,"screenSizeFactor",void 0);d.__decorate([t.property()],b.prototype,"featureTarget",void 0);d.__decorate([t.property()],b.prototype,"fixedFeatureTarget",void 0);d.__decorate([t.property()],
b.prototype,"layerView",void 0);d.__decorate([t.property()],b.prototype,"layer",void 0);d.__decorate([t.property({readOnly:!0})],b.prototype,"updating",void 0);d.__decorate([t.property({readOnly:!0})],b.prototype,"updatingProgress",void 0);d.__decorate([t.property({readOnly:!0})],b.prototype,"leafsReached",void 0);d.__decorate([t.property({constructOnly:!0})],b.prototype,"scaleVisibilityEnabled",void 0);d.__decorate([t.property({readOnly:!0})],b.prototype,"rootNodeVisible",null);d.__decorate([t.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled?"})],
b.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return b=d.__decorate([t.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],b)}(b.EsriPromiseMixin(l));var S=new f({deallocator:null}),P,U={factorIM:.2,factor3dObject:.05,distancePenalty:10},Z=v.create();return n})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define(["require","exports","../../../../core/arrayUtils","../../../support/Scheduler"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.addTask=
void 0;var k=function(){function a(a){var c=this;this.referenceCount=0;this.callbacks=[];this.runIndex=0;this.handle=a.registerTask(l.Task.I3S_CONTROLLER,function(a){return c.update(a)},function(){return c.needsUpdate()})}a.prototype.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)};a.prototype.needsUpdate=function(){for(var a=0,c=this.callbacks;a<c.length;a++)if(c[a].needsUpdate())return!0;return!1};a.prototype.update=function(a){this.sort();for(var c=this.callbacks,d={numIndexLoading:0,
numNodesLoading:0},b=0;b<c.length&&!a.done;++b)c[b].priority=c[b].update(a,d),this.runIndex=b};a.prototype.sort=function(){for(var a=this.callbacks,c=a.length,d=this.runIndex;0<d;d--){for(var b=a[d-1],e=d;e<a.length&&b.priority<=a[e].priority&&(e!==c||b.priority<a[e].priority);)a[e-1]=a[e],e++;a[e-1]=b;c=e-1}this.runIndex=0};a.prototype.add=function(a){this.sort();a.priority=Infinity;this.callbacks.unshift(a)};a.prototype.remove=function(a){d.removeUnordered(this.callbacks,a);this.runIndex=this.callbacks.length;
this.sort()};return a}(),e=new Map;a.addTask=function(a,d){var c=e.get(a);null==c&&(c=new k(a),e.set(a,c));c.add(d);return{remove:function(){null!=c&&(c.remove(d),0<c.callbacks.length||(e.delete(a),c.destroy()),c=null)}}}})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("require exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4f64 ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(n,a,d,l,k,e,c,h,m,f){function b(a){d.isSome(a.node)&&(a.node.renderMbs[3]=-1,d.isSome(a.node.serviceObbInRenderSR)&&(a.node.serviceObbInRenderSR.halfSize[0]=-1));d.isSome(a.ref)&&(a.ref.renderMbs[3]=-1,d.isSome(a.ref.serviceObbInRenderSR)&&(a.ref.serviceObbInRenderSR.halfSize[0]=-1))}function g(a,b){return 0===b?0:a/b|0}function p(a,b){return 0===b?a:a%b}function t(a){if(a)for(var b=0;b<a.length;b++)for(var c=0,d=w;c<d.length;c++){var e=d[c];if(e[0]===a[b].metricType)return{lodMetric:e[1],
maxError:a[b].maxError}}return{lodMetric:0,maxError:0}}function u(a){return Math.sqrt(4/Math.PI*a)}Object.defineProperty(a,"__esModule",{value:!0});a.selectErrorMetric=a.I3SIndex=void 0;var r=function(){return function(a,b,c,d,e){this.childOffset=a;this.childCount=b;this.visibilityCache=c;this.ref=d;this.node=e;this.useAsHole=0}}();n=function(){function a(a,b,c,d,e,f,g,h,k,n,p,r){this.streamDataController=b;this.viewportQueries=c;this.logger=d;this.holeFilling=e;this._isLoaded=f;this._isReloading=
g;this._isSelected=h;this._enable=k;this._needsUpdate=n;this._canRequest=p;this._computeVisibilityObb=r;this._dirty=!0;this._nodePages=[];this.lodMetric=this.rootIndex=this.nodesPerPage=this.nodeCount=0;this.lodConversion=function(a){return a};this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState={};this._version=m.addWraparound(0,2);this._visibilityCacheVersion=
m.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leafsReached:!1};this._unloadedMemoryEstimate=0;this._missing=new l({deallocator:null});this._prefetch=new l({deallocator:null});this._updates=new v;this._imModificationUncategorized=new l({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this.layerHasModifications=!1;this.layerUrl=a.parsedUrl.path;this.rootId=a.rootNode&&a.rootNode.split("/").pop();a.serviceUpdateTimeStamp&&a.serviceUpdateTimeStamp.lastUpdate&&
(this.lastUpdate=""+a.serviceUpdateTimeStamp.lastUpdate);this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1;(a=a.nodePages)?this.initNodePages(a):this.initNodeDocuments(this.rootId)}a.prototype.initNodePages=function(a){this.nodesPerPage=a.nodesPerPage;this.rootIndex=a.rootIndex;switch(a.lodSelectionMetricType){case "maxScreenThreshold":this.lodMetric=1;break;case "maxScreenThresholdSQ":this.lodMetric=1,this.lodConversion=u}};a.prototype.initNodeDocuments=function(a){this.rootIndex=
this.nodesPerPage=0;this._nodePages.push({nodes:[],children:[],parents:[]});this.makeRefNode(new h.NodeBase(a,null),-1)};a.prototype.loadPage=function(a){var b=this;this._loading.add(a);this.streamDataController.request(this.layerUrl+"/nodepages/"+a,"json").then(function(c){b._loading.delete(a);b.addPage(a,c)}).catch(function(c){b._loading.delete(a);if(!k.isAbortError(c)){if(0===b._nodePages.length)return b.initNodeDocuments(b.rootId);b._failedPages.add(a);b.logger.error("Error when loading page "+
a,c)}})};a.prototype.addPage=function(a,b){for(var d=this,g=this._nodePages.length;g<a;g++)this._nodePages[g]=null;var k=[],l=[];b=b.nodes.map(function(b,g){var n=k.length,p=b.children?b.children.length:0;l.push(-1);for(var q=0;q<p;q++)k.push(b.children[q]);var u=""+b.index,q=f.clone(b.obb),t=c.vec4f64.fromArray([q.center[0],q.center[1],q.center[2],e.vec3.length(q.halfSize)]),v=b.mesh&&b.mesh.attribute,w=b.mesh&&b.mesh.geometry,x=b.mesh&&b.mesh.material;b=new h.Node(u,a*d.nodesPerPage+g,t,p,0,{hasSharedResource:!1,
hasFeatureData:!!w,attributes:v&&null!=v.resource?""+v.resource:null,geometry:w&&null!=w.resource?""+w.resource:null,texture:x&&null!=x.resource?""+x.resource:null,geometryDefinition:w?w.definition:-1,materialDefinition:x?x.definition:-1},d.lastUpdate,d.lodMetric,d.lodConversion(b.lodThreshold),w?w.featureCount:null);b.serviceObb=q;b.visibilityObb=d._computeVisibilityObb(b);b.vertexCount=w?w.vertexCount:0;return new r(n,p,m.addWraparound(d._visibilityCacheVersion,-2),null,b)});this._nodePages[a]=
{nodes:b,children:k,parents:l};this.nodeCount+=b.length;this.updateParentsAndLevel()};a.prototype.updateParentsAndLevel=function(){var a=this,b=[],c=function(c,e,f){var g=a.getPage(c);if(d.isSome(g)){var h=p(c,a.nodesPerPage);g.parents[h]=e;e=g.nodes[h].node;d.isSome(e)&&(e.level=f,b.push(c))}};for(c(this.rootIndex,-1,0);b.length;){var e=b.pop(),f=this.getNode(e);if(d.isSome(f))for(var g=0;g<f.childCount;g++){var h=this.getChildIndex(f,g);c(h,e,f.level+1)}}};a.prototype.getPage=function(a){return this._nodePages[g(a,
this.nodesPerPage)]};a.prototype.getNodeInternal=function(a){var b=this.getPage(a);return d.isNone(b)?null:b.nodes[p(a,this.nodesPerPage)]};a.prototype.addNode=function(a,b){null!=a.children&&this.populateChildren(b,a.children);var e=this.getParent(b),e=d.isSome(e)?e.level+1:1;this._maxLevel=Math.max(this._maxLevel,e);var g=t(a.lodSelection),k=g.lodMetric,g=g.maxError,m=d.unwrap(this.getNodeInternal(b));m.node=new h.Node(a.id,b,c.vec4f64.fromArray(a.mbs),m.childCount,e,a.resources,a.version,k,g,a.numFeatures);
a.obb&&(m.node.serviceObb=f.clone(a.obb));m.node.visibilityObb=this._computeVisibilityObb(m.node);d.isSome(m.ref)&&(null==m.ref.mbs&&(m.ref.mbs=a.mbs),m.node.renderMbs=m.ref.renderMbs,m.node.serviceObbInRenderSR=m.ref.serviceObbInRenderSR,m.ref.visibilityObb=m.node.visibilityObb);return m.node};a.prototype.makeRefNode=function(a,b){var c=this._nodePages[0],e=c.nodes.length;c.nodes.push(new r(0,0,m.addWraparound(this._visibilityCacheVersion,-2),a,null));this.nodeCount++;c.parents.push(b);a.renderMbs[3]=
-1;d.isSome(a.serviceObbInRenderSR)&&(a.serviceObbInRenderSR.halfSize[0]=-1);return e};a.prototype.populateChildren=function(a,b){var c=d.unwrap(this.getNodeInternal(a)),e=d.unwrap(this.getPage(a));c.childOffset=e.children.length;c.childCount=b.length;for(c=0;c<b.length;c++){var f=this.makeRefNode(b[c],a);e.children.push(f)}};a.prototype.getNode=function(a){a=this.getNodeInternal(a);return d.isSome(a)?a.node:null};a.prototype.getIndexById=function(a){var b;this.forAllNodes(function(c,e){d.isSome(c.node)&&
c.node.id===a?b=e:d.isSome(c.ref)&&c.ref.id===a&&(b=e)});return b};a.prototype.getNodeById=function(a){a=this.getIndexById(a);return 0<=a?this.getNode(a):null};a.prototype.getChildIndex=function(a,b){var c=this.getPage(a.index);if(d.isNone(c))return-1;a=c.nodes[p(a.index,this.nodesPerPage)];return c.children[a.childOffset+b]};a.prototype.getParentIndex=function(a){var b=this.getPage(a);return d.isSome(b)?b.parents[p(a,this.nodesPerPage)]:-1};a.prototype.getParent=function(a){a=this.getParentIndex(a);
return 0<=a?this.getNode(a):null};a.prototype.isLeaf=function(a){a=this.getNodeInternal(a);return d.isSome(a)&&0===a.childCount};Object.defineProperty(a.prototype,"rootNode",{get:function(){return this.getNode(this.rootIndex)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this.nodeCount},enumerable:!1,configurable:!0});a.prototype.invalidateVisibilityCache=function(){this._visibilityCacheVersion=m.addWraparound(this._visibilityCacheVersion,2)};a.prototype.invalidateNodeVisibilityCache=
function(a){a=this.getNodeInternal(a);d.isSome(a)&&this.invalidateNodeVisibilityCacheInternal(a)};a.prototype.invalidateNodeVisibilityCacheInternal=function(a){a.visibilityCache=m.addWraparound(this._visibilityCacheVersion,-2)};a.prototype.invalidateBoundingVolumeCache=function(a){a=this.getNodeInternal(a);d.isSome(a)&&(b(a),this.invalidateNodeVisibilityCacheInternal(a))};a.prototype.invalidateGeometryVisibility=function(a){a=this.getNodeInternal(a);d.isSome(a)&&d.isSome(a.node)&&(a.node.geometryObb=
null,a.node.renderMbs[3]=-1,d.isSome(a.node.serviceObbInRenderSR)&&(a.node.serviceObbInRenderSR.halfSize[0]=-1))};a.prototype.invalidateVisibilityObbs=function(){var a=this;d.isNone(this.rootNode)||this.traverse(this.rootNode,function(b){b.visibilityObb=a._computeVisibilityObb(b);b.geometryObb=null;return!0})};a.prototype.isNodeVisible=function(a){a=this.getNodeInternal(a);if(d.isNone(a)||d.isSome(a.ref)&&!a.ref.mbs)return!0;if((a.visibilityCache&-2)!==this._visibilityCacheVersion){var b=a.node,c=
d.isSome(b)&&(d.isNone(a.ref)||d.isSome(b.visibilityObb))?b:d.isSome(a.ref)?a.ref:null,b=!(d.isSome(b)&&2===b.imModificationImpact)&&(!c||this.viewportQueries.isNodeVisible(c));a.visibilityCache=this._visibilityCacheVersion+(b?1:0);return b}return 1===(a.visibilityCache&1)};a.prototype.isGeometryVisible=function(a){if(!this.isNodeVisible(a))return!1;a=this.getNodeInternal(a);return d.isSome(a)&&d.isSome(a.node)&&d.isSome(a.node.geometryObb)&&(!this.layerHasModifications||4!==a.node.imModificationImpact)?
this.viewportQueries.isGeometryVisible(a.node):!0};a.prototype._traverseCoverage=function(a,b,c,e,f){var g=this.getPage(a);if(!d.isNone(g)&&0!==b.childCount){var h=b.childOffset+b.childCount;a=[];for(var k=b.childOffset;k<h;++k){b=g.children[k];var m=this.getNodeInternal(b);d.isSome(m)&&d.isSome(m.node)&&this.isGeometryVisible(b)&&a.push(m)}e/=a.length;for(g=0;g<a.length;g++)m=a[g],b=d.unwrap(m.node).index,this._isLoaded(b)||this._isReloading(b)?(f.delta=Math.max(f.delta,c),f.coverage+=e):this._traverseCoverage(b,
m,c+1,e,f)}};a.prototype.useNodeAsHole=function(a){if("off"===this.holeFilling)return!1;var b=this.getNodeInternal(a);if(d.isNone(b))return!1;if("always"===this.holeFilling)return!0;if((b.useAsHole&-2)===this._version)return 1===(b.useAsHole&1);var c={delta:0,coverage:0};this._traverseCoverage(a,b,0,1,c);a=.5>=c.delta*c.coverage;b.useAsHole=this._version+(a?1:0);return a};Object.defineProperty(a.prototype,"maxLevel",{get:function(){return this._maxLevel},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"dirty",{get:function(){return this._dirty},enumerable:!1,configurable:!0});a.prototype.destroy=function(){this._updates.add.prune();this._updates.update.prune()};a.prototype.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;this._version=m.addWraparound(this._version,2)};a.prototype.imModificationsChanged=function(a){var b=this;this.layerHasModifications=a;this.forAllNodes(function(a){a=a.node;d.isSome(a)&&(a.imModificationImpact=4,a.visibilityObb=b._computeVisibilityObb(a),a.hasModifications&&
b.invalidateGeometryVisibility(a.index))});this.invalidateVisibilityCache()};a.prototype.update=function(a,b,c){var e=this;if(this._dirty){this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(a,this._missing);q.clear();var f=!0,h=new z,k=new z,m=this._imModificationUncategorized;m.clear();this.traverseVisible(function(l,n){if(n){var p=n.node;e._updateNodeFeatureEstimate(p,k);if(d.isNone(p))n=e.entryPriority(l),e._loading.has(l)||
e._failedNodes.has(l)||(e._missing.push(l),q.set(l,n)),e._maxProcessingPrio=Math.max(e._maxProcessingPrio,n);else{var r=d.unwrap(e.getPage(l));if(0===e._missing.length&&0===e.nodesPerPage)for(var u=0;u<n.childCount;u++){var t=r.children[n.childOffset+u],v=e.getNodeInternal(t);!d.isSome(v)||v.node||e._loading.has(t)||e._failedNodes.has(t)||(q.set(t,e.entryPriority(t)),e._prefetch.push(t))}!p.failed&&p.resources.hasFeatureData&&(e._isLoaded(l)?(h.known+=p.memory,++h.knownNodes,e._isSelected(p)?0<n.childCount&&
(f=!1):(h.unremoved+=p.memory,f=!1),e._needsUpdate(p)&&(n=e.entryPriority(l),q.set(l,n),e._maxProcessingPrio=Math.max(e._maxProcessingPrio,n),e._updates.update.push(l))):(p.memory&&(h.known+=p.memory,++h.knownNodes),e._isSelected(p)?(0<n.childCount&&(f=!1),p.memory?(h.missing+=p.memory,h.known+=p.memory,++h.knownNodes):++h.missingNodes,0<=a.indexOf(p.index)?(e._maxProcessingPrio=Math.max(e._maxProcessingPrio,e.entryPriority(l)),e._updates.cancel=e._updates.cancel.filter(function(a){return a!==p.index})):
!b.done&&e._enable(p)?b.madeProgress():(r=e.entryPriority(l),q.set(l,r),e._maxProcessingPrio=Math.max(e._maxProcessingPrio,r),e._updates.add.push(l),e.layerHasModifications&&c&&d.isSome(n)&&d.isSome(n.node)&&4===n.node.imModificationImpact&&m.push(l))):e._isReloading(l)&&e._updates.remove.push(l)))}}else n=e.entryPriority(l),l=g(l,e.nodesPerPage),q.set(l,Math.max(n,q.get(l)||0)),e._loading.has(l)||e._failedPages.has(l)||e._missing.push(l),e._maxProcessingPrio=Math.max(e._maxProcessingPrio,n)});var l=
this._updates.add;0<l.length&&this.layerHasModifications&&(0<m.length&&c(m),l.filterInPlace(function(a){var b=e.getNodeInternal(a);(b=d.isNone(b)||d.isNone(b.node)||2!==b.node.imModificationImpact)||e.invalidateNodeVisibilityCache(a);return b}));this._unloadedMemoryEstimate=h.missing-h.unremoved;3<h.knownNodes&&0<h.missingNodes&&(this._unloadedMemoryEstimate+=h.known/h.knownNodes*h.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=
this._computeFeatureEstimate(k);this._featureEstimate.leafsReached=f;this._missing.sort(function(a,b){return a-b});this._missing.filterInPlace(function(a,b){return 1>b||e._missing.data[b-1]!==a});this._missing.sort(function(a,b){return q.get(a)-q.get(b)});0<this._missing.length?(this._maxUnloadedPrio=q.get(this._missing.back()),this._prefetch.clear()):this._prefetch.sort(function(a,b){return q.get(a)-q.get(b)});this._updates.add.filterInPlace(function(a){return q.get(a)>=e._maxUnloadedPrio}).sort(function(a,
b){return q.get(a)-q.get(b)});this._updates.update.sort(function(a,b){return q.get(a)-q.get(b)});this._indexMissing=this._loading.size+this._missing.length;this._dirty=0<this._indexMissing;q.clear()}};a.prototype.checkFeatureTarget=function(a,b){for(var c=this.viewportQueries.updateScreenSpaceErrorBias(b),d=b,e=b,f=c,g=10;g--;){var h=new z;this._updateFeatureEstimate(d,h);if(this._computeFeatureEstimate(h)<=a){if(d>=b||0<h.missingNodes||0===g)break;f=d;d=.5*(d+e)}else e=d,d=.5*(d+f)}this._version=
m.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(c);return Math.min(b,d)};a.prototype._updateFeatureEstimate=function(a,b){var c=this;this._version=m.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(a);this.traverseVisible(function(a,d){return c._updateNodeFeatureEstimate(d&&d.node,b)})};a.prototype._updateNodeFeatureEstimate=function(a,b){d.isNone(a)||a.failed||d.isNone(a.numFeatures)||(this._isLoaded(a.index)?(b.known+=a.numFeatures,
++b.knownNodes,this._isSelected(a)||(b.unremoved+=a.numFeatures)):this._isSelected(a)&&(d.isSome(a.numFeatures)?(b.missing+=a.numFeatures,b.known+=a.numFeatures,++b.knownNodes):++b.missingNodes))};a.prototype._computeFeatureEstimate=function(a){var b=a.known-a.unremoved;3<a.knownNodes&&0<a.missingNodes&&(b+=a.known/a.knownNodes*a.missingNodes);return Math.max(0,b)};a.prototype.load=function(){return this._load(this._missing)};a.prototype.prefetch=function(){return this._load(this._prefetch)};a.prototype._load=
function(a){if(0===a.length||!this._canRequest())return!1;for(;0<a.length&&this._canRequest();)0===this.nodesPerPage?this._loadNode(a.pop()):this.loadPage(a.pop());return!0};a.prototype.isLoading=function(){return 0<this._indexMissing};a.prototype.getIndexLoading=function(){return this._loading.size};a.prototype.getIndexMissing=function(){return this._indexMissing};a.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};Object.defineProperty(a.prototype,"updates",{get:function(){return this._updates},
enumerable:!1,configurable:!0});a.prototype.getFeatureEstimate=function(){return this._featureEstimate};a.prototype.nodeTraversalState=function(a){if(d.isNone(a))return null;var b=this._nodeTraversalState[a.index];if(b&&(b.version&-2)===this._version)return b;var c=this.viewportQueries.getLodLevel(a),e=this.viewportQueries.hasLOD(a),f=!0;e?(f=this.getParentIndex(a.index),f=0<=f?(f=this._nodeTraversalState[f])&&c>f.lodLevel:0<c):f=0===a.childCount;if(b)return b.lodLevel=c,b.isChosen=f,b.version=this._version+
1,b;this._nodeTraversalState[a.index]={nodeHasLOD:e,lodLevel:c,isChosen:f,version:this._version+1};return this._nodeTraversalState[a.index]};a.prototype._loadNode=function(a){var b=this;this._loading.add(a);var c=d.unwrap(this.getNodeInternal(a)).ref;if(d.isNone(c))this._failedNodes.add(a);else{var e=c.id,f=this.layerUrl+"/nodes/"+e,g=function(){b._loading.delete(a);0===b._missing.length&&0===b._loading.size&&b.requestUpdate()};this.streamDataController.request(f,"json").then(function(c){c=b._validateNode(e,
c);null!=c&&(c.obb&&b.invalidateNodeVisibilityCache(a),c=b.addNode(c,a),b.nodeTraversalState(c));g()},function(c){k.isAbortError(c)||(b.logger.error("Error loading node: "+f),b._failedNodes.add(a));g()})}};a.prototype._validateNode=function(a,b){var c=this;if(null==b||"object"!==typeof b||b.id!==a)return this.logger.error('Invalid node. Wrong type or wrong id "'+a+'"'),null;b.sharedResource&&"./shared"!==b.sharedResource.href&&"./shared/"!==b.sharedResource.href&&this.logger.warn('Invalid shared resource href on node "'+
a+'"');null==b.geometryData||Array.isArray(b.geometryData)&&1===b.geometryData.length&&"./geometries/0"===b.geometryData[0].href||this.logger.warn('Invalid geometry data on node "'+a+'"');null==b.attributeData||Array.isArray(b.attributeData)&&!b.attributeData.some(function(a,b){return a.href!=="./attributes/f_"+b+"/0"})||this.logger.warn('Invalid attribute data on node "'+a+'"');b.featureData&&1<b.featureData.length&&this.logger.warn("Node "+a+" has "+b.featureData.length+" bundles. Only the first bundle will be loaded.");
var d=b.hasOwnProperty("obb")&&!this.ignoreServiceObb?b.obb:null,e=b.featureData&&1===b.featureData.length&&b.featureData[0].featureRange?b.featureData[0].featureRange[1]-b.featureData[0].featureRange[0]+1:null,f=function(b){if(null==b)return null;var d=function(b){return c.logger.error("Invalid node reference on node "+a+": "+b)};if("number"===typeof b.id)d("id "+b.id+" is a number instead of a string.");else if("string"!==typeof b.id||!Array.isArray(b.mbs))return d("Missing or invalid id."),null;
if(!Array.isArray(b.mbs))return d("Invalid bounding volume on reference "+b.id+"."),null;b.href&&b.href!=="../"+b.id&&c.logger.error('Invalid node href on node "'+a+'"');d=b.hasOwnProperty("obb")&&!c.ignoreServiceObb?b.obb:null;b=new h.NodeBase(""+b.id,b.mbs);b.serviceObb=d;b.visibilityObb=c._computeVisibilityObb(b);return b},f=Array.isArray(b.children)?b.children.map(f).filter(function(a){return null!=a}):null;return{id:a,mbs:b.mbs,obb:d,children:f,resources:{hasFeatureData:b.featureData&&0<b.featureData.length,
hasSharedResource:null!=b.sharedResource,attributes:b.attributeData?a:null,texture:b.textureData&&0<b.textureData.length?a:null,geometry:null!=b.geometryData?a:null},version:"string"===typeof b.version?b.version:null,lodSelection:Array.isArray(b.lodSelection)?b.lodSelection:null,numFeatures:e}};a.prototype.resetFailedNodes=function(){this._failedNodes.clear();this._failedPages.clear();this.forAllNodes(function(a){d.isSome(a.node)&&(a.node.failed=!1)})};a.prototype.entryPriority=function(a){var b=
this.getNodeInternal(a),c=this.getParentIndex(a);if(d.isNone(b)||0>c&&null==b.node)return 0>c?Infinity:this.entryPriority(c);var e=0;b.node&&0<=c&&(c=this._nodeTraversalState[c],null!=c&&(e=c.lodLevel));for(c=this.progressiveLoadPenalty;0<=a;a=this.getParentIndex(a))if(this._isLoaded(a)){c=0;break}b=d.isSome(b.ref)?this.viewportQueries.distToPOI(b.ref):d.isSome(b.node)?this.viewportQueries.distToPOI(b.node):0;return-b-e*(b+this.progressiveLoadPenalty)+c};a.prototype.traverseVisible=function(a){var b=
this.getNodeInternal(this.rootIndex);d.isNone(b)?a(this.rootIndex,null):this._traverseVisible(this.rootIndex,b,a)};a.prototype._traverseVisible=function(a,b,c){if(b.node&&0===b.childCount)this.isGeometryVisible(a)&&c(a,b);else if(this.isNodeVisible(a)&&(c(a,b),null!=b.node)){var e=this.nodeTraversalState(b.node);if(!e.nodeHasLOD||e.lodLevel!==this._maxLodLevel)for(a=d.unwrap(this.getPage(a)),e=0;e<b.childCount;e++){var f=a.children[b.childOffset+e],g=this.getNodeInternal(f);d.isSome(g)?this._traverseVisible(f,
g,c):c(f,null)}}};a.prototype.traverse=function(a,b){b(a)&&this.traverseChildren(a,b)};a.prototype.traverseChildren=function(a,b){a=a.index;var c=this.getNodeInternal(a);d.isSome(c)&&this._traverseChildren(a,c,b)};a.prototype._traverseChildren=function(a,b,c){a=this.getPage(a);if(!d.isNone(a)){var e=b.childOffset+b.childCount;for(b=b.childOffset;b<e;++b){var f=a.children[b],g=this.getNodeInternal(f);d.isSome(g)&&d.isSome(g.node)&&c(g.node)&&this._traverseChildren(f,g,c)}}};a.prototype.updateStats=
function(a){0<this._updates.add.length&&(a.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)a.index+=" + "+this._indexMissing||this._prefetch.length;a.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){var b=this._featureEstimate.estimate-a.features;0<b?a.features+=" + "+b:0>b&&(a.features+=" - "+-b)}};a.prototype.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)};a.prototype.updateElevationInfo=function(a){this.forAllNodes(b);
this.viewportQueries.updateElevationInfo(a)};a.prototype.forAllNodes=function(a){for(var b=0;b<this._nodePages.length;b++){var c=this._nodePages[b];if(c)for(var d=b*this.nodesPerPage,e=0;e<c.nodes.length;e++)a(c.nodes[e],d+e)}};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{addNode:function(b,c){return a.addNode(b,c)}}},enumerable:!1,configurable:!0});return a}();a.I3SIndex=n;var q=new Map,v=function(){function a(){this.update=new l({deallocator:null});this.add=new l({deallocator:null});
this.remove=new l({deallocator:null});this.cancel=[]}a.prototype.reset=function(a,b){this.add.clear();this.update.clear();this.cancel=a;this.missing=b};return a}(),w=[["maxScreenThreshold",1],["screenSpaceRelative",2],["removedFeatureDiameter",3],["distanceRangeFromDefaultCamera",4]];a.selectErrorMetric=t;var z=function(){return function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}()})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["require","exports","tslib",
"../../../../core/libs/gl-matrix-2/vec4f64"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.Node=a.NodeBase=void 0;n=function(){return function(a,d){this.id=a;this.mbs=d;this.renderMbs=l.vec4f64.fromArray([0,0,0,-1]);this.imModificationImpact=4}}();a.NodeBase=n;n=function(a){function e(c,d,e,f,b,g,k,l,n,r){c=a.call(this,c,e)||this;c.index=d;c.childCount=f;c.level=b;c.resources=g;c.version=k;c.lodMetric=l;c.maxError=n;c.numFeatures=r;c.failed=!1;c.hasModifications=!1;c.cacheState=
0;c.vertexCount=0;c.memory=0;return c}d.__extends(e,a);return e}(n);a.Node=n})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["require","exports","../../../../core/maybe","../../../../core/PooledArray"],function(n,a,d,l){n=function(){function a(a){this.layerView=a;this._lodGlobalDirty=!1}a.prototype.startNodeLoading=function(a,d,e,f){this._maxLodLevel=f.maxLodLevel;this._index=e;this._isNodeInScaleBounds=a;this._removeNodes=d};a.prototype.shouldLoadNode=function(a){if(d.isNone(a))return!1;
var c=this._index.nodeTraversalState(a);return this.isChosenMaxLOD(c)?!0:c.isChosen?this._childrenRequireLoading(a):!1};a.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0};Object.defineProperty(a.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._index&&!0===this._lodGlobalDirty},enumerable:!1,configurable:!0});a.prototype.lodGlobalHandling=function(a){if(!this.requiresLODGlobalHandling)return!1;var c=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.memoryController.usedMemory-
1)));k.clear();this._lodGlobalHandlingRecursion(this._index.rootNode,c);c=k.length;this._removeNodes(k,a);a=k.length<c;0===k.length&&(this._lodGlobalDirty=!1);k.clear();return a};a.prototype._lodGlobalHandlingRecursion=function(a,e){if(d.isNone(a))return!1;var c=this._index.nodeTraversalState(a),f=this.isChosenMaxLOD(c);if(c=this.layerView.isNodeLoaded(a.index)){if(f)return this._removeChildrenRecursive(a),this.layerView.updateNodeState(a.index,1),this.layerView.fadeNode&&this.layerView.fadeNode(a.index,
0),!0;this.layerView.updateNodeState(a.index,0)}var b=!1;if(0<a.childCount)for(var b=!0,g=0;g<a.childCount;g++){var h=this._index.getChildIndex(a,g),l=this._index.getNode(h);d.isSome(l)?this._index.isGeometryVisible(h)&&!this._lodGlobalHandlingRecursion(l,e)&&this._isNodeInScaleBounds(l)&&(b=!1):this._index.isNodeVisible(h)&&(b=!1)}c&&!f&&(b||k.length<e)&&(k.push(a.index),c=!1);a=!a.resources.hasFeatureData;return b||c||a};a.prototype._removeChildrenRecursive=function(a){this._index.traverseChildren(a,
function(a){k.push(a.index);return!0})};a.prototype.childrenEmpty=function(a){var c=this,d=!0;this._index.traverseChildren(a,function(a){return d&&c._index.isNodeVisible(a.index)?c.layerView.isNodeLoaded(a.index)?d=!1:!0:!1});return d};a.prototype._childrenRequireLoading=function(a){var c=this,d=!1,e=!0;this._index.traverseChildren(a,function(a){if(!e||!c._index.isNodeVisible(a.index))return!1;var b=c._index.nodeTraversalState(a);c.isChosenMaxLOD(b)&&c._index.isGeometryVisible(a.index)&&(d=!0);return c.layerView.isNodeLoaded(a.index)?
e=!1:!0});return e&&d};a.prototype.isChosenMaxLOD=function(a){return a.isChosen&&(!a.nodeHasLOD||a.lodLevel===this._maxLodLevel)};return a}();var k=new l({deallocator:null});return n})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("require exports tslib ../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ./I3SBinaryReader ./I3SMaterialUtil ./I3SUtil".split(" "),function(n,a,d,l,k,e,c,h,
m,f,b,g){n=function(){function a(a,c,d,e,f,g){this.streamDataController=c;this.logger=d;this.defaultGeometrySchema=e;this.requiredAttributes=f;this.options=g;this.layerUrl=a.parsedUrl.path;this.geometryDefinitions=a.geometryDefinitions;if(a.materialDefinitions){var h=a.textureSetDefinitions;this.materialAndTextures=a.materialDefinitions.map(function(a){return b.getMaterialAndTextures(h,a)})}}a.prototype.load=function(a,b,c){return this.streamDataController.request(a,b,{signal:c})};a.prototype.loadAttribute=
function(a,b,c){return this.load(this.layerUrl+"/nodes/"+a.resources.attributes+"/attributes/"+b.key+"/0","binary",c).then(function(a){return f.readBinaryAttribute(b,a)})};a.prototype.loadAttributes=function(a,b,c){var d=this;return h.eachAlways(b.map(function(b){return d.loadAttribute(a,b.attributeStorageInfo,c)})).then(function(c){for(var e={},f=0;f<b.length;++f)if(c[f].value)e[b[f].name]=c[f].value;else{if(h.isAbortError(c[f].error))throw c[f].error;d.logger.error("Failed to load attributeData for '"+
b[f].name+"' on node '"+a.id+"'",c[f].error)}return e})};a.prototype.loadNodeData=function(a,g){return d.__awaiter(this,void 0,void 0,function(){var m,n,p,u,t,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O,N,S,P,U,Z,V,T,Y,X,ca,ba;return d.__generator(this,function(d){switch(d.label){case 0:m=null!=this.requiredAttributes&&a.resources.attributes?l.result(this.loadAttributes(a,this.requiredAttributes,g)):null;var r=this.geometryDefinitions;d={bufferDefinition:null,bufferIndex:0};if(!(null==r||0>a.resources.geometryDefinition)&&
(r=0<=a.resources.geometryDefinition?r[a.resources.geometryDefinition].geometryBuffers:null,null!=r))for(var q=0;q<r.length;q++){var v=r[q];if(null!=v.compressedAttributes){if("draco"===v.compressedAttributes.encoding&&!k("disable-feature:i3s-draco")){d.bufferIndex=q;d.bufferDefinition=v;break}}else d.bufferIndex=q,d.bufferDefinition=r[q]}n=d;p=n.bufferDefinition;u=n.bufferIndex;x=(t=!!a.resources.geometry)?l.result(this.loadGeometry(a.resources.geometry,u,g)):null;return a.resources.hasSharedResource?
[4,this.loadShared(a,g)]:[3,2];case 1:return A=d.sent(),[3,3];case 2:A=null,d.label=3;case 3:return B=A,E=(C=this.materialAndTextures&&0<=a.resources.materialDefinition?this.materialAndTextures[a.resources.materialDefinition]:null!=B?b.getMaterialAndTexturesFromShared(B):null)&&C.material,G=C&&C.textures,F=""+a.id,(H=!t&&this.options.loadFeatureData)?[4,this.loadFeatureData(F,g)]:[3,5];case 4:return I=d.sent(),[3,6];case 5:I=null,d.label=6;case 6:J=I;if(H)a:{d=0;for(r=J.featureData;d<r.length;d++)if(q=
r[d],v=q.geometries,null!=v)for(;0<v.length;){d={featureIds:[q.id],featureDataPosition:q.position,geometries:[v[0]]};break a}d=null}else d={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:E}}],featureDataPosition:[0,0,0]};K=d;if(d=c.isNone(K))for(d=[],r=0,q=J.featureData;r<q.length;r++)v=q[r],null!=v.position&&d.push({featureIds:[v.id],featureDataPosition:v.position,geometries:null});L=d;M=null!=G&&0<G.length?l.result(this.loadTextures(a,G,g)):null;R=Q=null;if(!x)return[3,8];N=
(O=l).assertResult;return[4,x];case 7:Q=N.apply(O,[d.sent()]),r=this.defaultGeometrySchema,q=B,r&&q&&q.materialDefinitions&&(v=Object.keys(q.materialDefinitions)[0],!q.materialDefinitions[v].params.vertexRegions&&r.vertexAttributes.region&&(r=e.clone(r),delete r.vertexAttributes.region)),S=r,R=f.createGeometryDescriptor(p,S),d.label=8;case 8:if(!M)return[3,10];V=(Z=l).assertResult;return[4,M];case 9:return U=V.apply(Z,[d.sent()]),[3,11];case 10:U=null,d.label=11;case 11:P=U;if(!m)return[3,13];ca=
(X=l).assertResult;return[4,m];case 12:return Y=ca.apply(X,[d.sent()]),[3,14];case 13:Y={},d.label=14;case 14:return ba=(T=Y)?{attributeData:T,loadedAttributes:this.requiredAttributes}:null,c.isSome(K)?[2,{geometryData:K,attributeDataInfo:ba,geometryBuffer:Q,geometryDescriptor:R,requiredTextures:G,textureData:P}]:c.isSome(L)?[2,{pointData:L,attributeDataInfo:ba,geometryBuffer:Q,geometryDescriptor:R,requiredTextures:G,textureData:P}]:[2,h.reject()]}})})};a.addAbsoluteHrefTexture=function(a,b){a=a.textureDefinitions;
if(null!=a)for(var c=0,d=Object.keys(a);c<d.length;c++)for(var e=0,f=a[d[c]].images;e<f.length;e++){var g=f[e];Array.isArray(g.href)?g.hrefConcat=g.href.map(function(a){return m.makeAbsolute(a,b)}):g.hrefConcat=m.makeAbsolute(g.href,b)}};a.fixTextureEncodings=function(a){a=a.textureDefinitions;if(null!=a)for(var b in a){var c=a[b];if(Array.isArray(c.encoding))for(var d=0;d<c.encoding.length;d++){var e=c.encoding[d];"data:"===e.substring(0,5)&&(c.encoding[d]=e.substring(5))}else e=c.encoding,"data:"===
e.substring(0,5)&&(c.encoding=e.substring(5))}};a.prototype.loadShared=function(b,c){var d=this.layerUrl+"/nodes/"+b.resources.geometry+"/shared";return this.load(d,"json",c).then(function(b){a.fixTextureEncodings(b);a.addAbsoluteHrefTexture(b,d);return b})};a.prototype.loadTexture=function(a,b,c,d,e,f){return e===g.DDS_ENCODING_STRING?this.load(a,"binary",f).then(function(a){return{id:b,usage:c,data:a,encoding:e}}):this.load(a,"image",f).then(function(a){var f=a;if(d&&4096<=a.width*a.height){var f=
Math.ceil(a.width/2),g=Math.ceil(a.height/2),h=document.createElement("canvas");h.width=f;h.height=g;h.getContext("2d").drawImage(a,0,0,f,g);f=h}return{id:b,usage:c,data:f,encoding:e}})};a.prototype.loadTextures=function(b,c,d){var e=this,f=this.options.textureFormat===a.TextureFormat.Compressed,k=this.options.textureFormat===a.TextureFormat.Downsampled,m=this.options.textureUsageMask;return h.all(c.map(function(a){if(0===(a.usage&m))return null;var c=g.selectEncoding(a.encodings,f);return null==
c?(e.logger.error("No known encoding for texture found on node "+b.id),h.reject()):e.loadTexture(e.layerUrl+"/nodes/"+(b.resources.texture||b.id)+"/textures/"+c.name,a.id,a.usage,k,c.encoding,d)}))};a.prototype.loadFeatureData=function(a,b){return this.load(this.layerUrl+"/nodes/"+a+"/features/0","json",b)};a.prototype.loadGeometry=function(a,b,c){return this.load(this.layerUrl+"/nodes/"+a+"/geometries/"+b,"binary",c)};return a}();(function(a){a=a.TextureFormat||(a.TextureFormat={});a[a.Compressed=
0]="Compressed";a[a.Normal=1]="Normal";a[a.Downsampled=2]="Downsampled"})(n||(n={}));return n})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("require exports ../../../../core/mathUtils ../../../../core/maybe ../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.getMaterialAndTexturesFromShared=a.getMaterialAndTextures=
void 0;a.getMaterialAndTextures=function(a,d){var e=new Map,b=function(a,b){if(l.isNone(a))return-1;if(e.has(a.id))return a=e.get(a.id),a.usage|=b,a.id;var c=e.size;e.set(a.id,{id:c,usage:b});return c},g=d.pbrMetallicRoughness,h=g&&g.baseColorFactor,m=d.emissiveFactor,n=null==d.normalTexture&&null==d.emissiveTexture&&null==d.occlusionTexture&&(g?null==g.metallicRoughnessTexture&&1===g.roughnessFactor&&(1===g.metallicFactor||0===g.metallicFactor):!0),r=n?k.PBRSchematicMRRValues[0]:g?g.metallicFactor:
1,q=n?k.PBRSchematicMRRValues[1]:g?g.roughnessFactor:1,g={baseColorFactor:h?[h[0],h[1],h[2],h[3]]:[1,1,1,1],baseColorTextureId:b(g&&g.baseColorTexture,"mask"===d.alphaMode?33:1),metallicRoughnessTextureId:b(g&&g.metallicRoughnessTexture,2),metallicFactor:r,roughnessFactor:q};d={alphaMode:d.alphaMode,alphaCutoff:d.alphaCutoff,doubleSided:d.doubleSided,cullFace:"none"===d.cullFace?0:"back"===d.cullFace?2:"front"===d.cullFace?1:void 0,normalTextureId:b(d.normalTexture,4),emissiveTextureId:b(d.emissiveTexture,
16),occlusionTextureId:b(d.occlusionTexture,8),emissiveFactor:m?[m[0],m[1],m[2]]:[0,0,0],metallicRoughness:g,wrapTextures:!1,isSchematic:n};var v=[];e.forEach(function(b,d){b=b.usage;var e=l.isSome(a)&&a[d]&&a[d].formats,e=e?e.map(function(a){return{name:a.name,encoding:c[a.format]}}):[];v.push({id:d,usage:b,encodings:e})});return{material:d,textures:v}};var c={jpg:"image/jpeg",png:"image/png",dds:"image/vnd-ms.dds","ktx-etc2":"image/ktx"};a.getMaterialAndTexturesFromShared=function(a){var c=a&&a.materialDefinitions?
Object.keys(a.materialDefinitions)[0]:null,f=a&&a.textureDefinitions?Object.keys(a.textureDefinitions)[0]:null,c=c&&a.materialDefinitions[c],f=f&&a.textureDefinitions[f];a={alphaMode:"opaque",alphaCutoff:e.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,isSchematic:!0};
if(null!=c){c=c.params;c.diffuse&&(a.metallicRoughness.baseColorFactor=[c.diffuse[0],c.diffuse[1],c.diffuse[2],1]);null!=c.doubleSided&&(a.doubleSided=c.doubleSided,a.cullFace=c.doubleSided?0:2);if("none"===c.cullFace||"front"===c.cullFace||"back"===c.cullFace)a.cullFace="none"===c.cullFace?0:"back"===c.cullFace?2:1;c.transparency&&(a.metallicRoughness.baseColorFactor[3]=d.clamp(1-c.transparency,0,1));if(c.useVertexColorAlpha||1>a.metallicRoughness.baseColorFactor[3])a.alphaMode="blend"}c=[];if(null!=
f){!f.wrap||"repeat"!==f.wrap[0]&&"repeat"!==f.wrap[1]||(a.wrapTextures=!0);var b=1;"rgba"===f.channels&&(a.alphaMode="blend",b|=32);var g=f.images[f.images.length-1],h=function(a){return a&&a.split("/").pop()},f=Array.isArray(f.encoding)?f.encoding.map(function(a,b){return{name:h(g.href[b]),encoding:a}}):[{name:h(g.href),encoding:f.encoding}];c.push({id:0,usage:b,encodings:f});a.metallicRoughness.baseColorTextureId=0}return{material:a,textures:c}}})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["require",
"exports","tslib","../../../../core/promiseUtils"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.I3SStreamDataController=void 0;n=function(){function a(a){this.requester=a;this.activeRequests=new Set}Object.defineProperty(a.prototype,"busy",{get:function(){return this.requester.busy},enumerable:!1,configurable:!0});a.prototype.request=function(a,c,h){var e=this,f=l.createAbortController(),b=l.onAbortOrThrow(h,function(){return f.abort()});h=d.__assign(d.__assign({},h),{signal:f.signal});
a=this.requester.request(a,c,h);var g={response:a,abortController:f,abortHandle:b};this.activeRequests.add(g);l.always(a,function(){var a;g.abortController=null;null===(a=g.abortHandle)||void 0===a?void 0:a.remove();g.abortHandle=null;e.activeRequests.delete(g)});return a};a.prototype.cancelAll=function(){this.activeRequests.forEach(function(a){var c,d;null===(c=a.abortController)||void 0===c?void 0:c.abort();a.abortController=null;null===(d=a.abortHandle)||void 0===d?void 0:d.remove()});this.activeRequests.clear()};
return a}();a.I3SStreamDataController=n;a.default=n})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../layers/graphics/dehydratedFeatures ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SUtil ../../support/geometryUtils ../../support/orientedBoundingBox ../../support/projectionUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){return function(){function a(a,b,d,e,f,h,m){void 0===m&&(m={});this.indexSR=a;this._renderCoordsHelper=b;this.extent=e;this.elevationProvider=f;this.options=m;this.fp=g.frustum.create();this._poi=k.vec3f64.create();this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=k.vec3f64.create();this._tmp2=k.vec3f64.create();this._tmp3=k.vec3f64.create();this._tmp0=k.vec3f64.create();this.screenspaceErrorBias=m.screenspaceErrorBias||1;this.progressiveLoadFactor=
m.progressiveLoadFactor||1;this.updateCamera(d);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(h);this.tmpPoint=c.makeDehydratedPoint(0,0,0,a)}a.prototype.updateElevationInfo=function(a){null==a?this._elevationContext=null:(this._elevationContext=m.ElevationContext.fromElevationInfo(a),this._elevationContext.updateFeatureExpressionInfoContext(f.createContextWithoutExpressionSupport(f.extractExpressionInfo(a,!1))))};a.prototype.updateCamera=function(a){g.frustum.fromMatrix(a.viewMatrix,
a.projectionMatrix,this.fp);this._screenSizeFactor=1/(a.perScreenPixelRatio/2);this._camPos=a.eye;this.minDistance=Infinity;this.maxDistance=0};a.prototype.setPointOfInterest=function(a){this._poi=a};a.prototype.updateScreenSpaceErrorBias=function(a){var b=this.screenspaceErrorBias;this.screenspaceErrorBias=a;return b};a.prototype.updateExtent=function(a){this.extent=a};a.prototype.getRenderMbs=function(a){var b=a.renderMbs;0>b[3]&&(e.vec4.copy(b,a.mbs),this._elevationContext&&1E5>b[3]&&(this.tmpPoint.x=
b[0],this.tmpPoint.y=b[1],this.tmpPoint.z=b[2],b[2]=h.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)),t.mbsToMbs(b,this.indexSR,b,this.engineSR));return b};a.prototype.getVisibilityObb=function(a){if(d.isSome(a.visibilityObb))return a.visibilityObb;var b=a.serviceObb;if(!(d.isNone(b)||0>b.halfSize[0]))return a.serviceObbInRenderSR=this._computeRenderObb(b,a.serviceObbInRenderSR,a.mbs[3]),a.serviceObbInRenderSR};a.prototype._computeRenderObb=
function(a,c,e){d.isNone(c)&&(c=p.create());if(0>c.halfSize[0]){var f=0;this._elevationContext&&1E5>e&&(this.tmpPoint.x=a.center[0],this.tmpPoint.y=a.center[1],this.tmpPoint.z=a.center[2],f=h.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)-a.center[2]);b.transformObb(a,this.indexSR,c,this.engineSR,f)}return c};a.prototype.isNodeVisible=function(a){var b=this.getRenderMbs(a);if(!this.isMBSinExtent(b))return!1;a=this.getVisibilityObb(a);
return d.isSome(a)?p.isVisible(a,this.fp):this.isMBSVisible(b)};a.prototype.isGeometryVisible=function(a){var b=a.geometryObb;return d.isSome(b)?p.isVisible(b,this.fp):this.isNodeVisible(a)};a.prototype.isMBSinExtent=function(a){return this.extent?0!==b.intersectBoundingBoxWithMbs(this.extent,a):!0};a.prototype.isMBSVisible=function(a){return g.frustum.intersectsSphere(this.fp.planes,g.sphere.wrap(a[3],a))};a.prototype.screenSpaceDiameterMbs=function(a,b){var c=this.getRenderMbs(a);a=Math.sqrt(l.vec3.squaredDistance(c,
this._camPos));c=a-c[3];this._updateMinMaxDistance(a);return 0>c?.5*Number.MAX_VALUE:b/c*this._screenSizeFactor};a.prototype.calcCameraDistance=function(a){return this.calcCameraDistanceToCenter(a)-this.getRenderMbs(a)[3]};a.prototype.calcCameraDistanceToCenter=function(a){a=this.getRenderMbs(a);a=l.vec3.distance(a,this._camPos);this._updateMinMaxDistance(a);return a};a.prototype.calcAngleDependentLoD=function(a){a=this.getRenderMbs(a);var b=a[3];a=(Math.abs(a[0]*(a[0]-this._camPos[0])+a[1]*(a[1]-
this._camPos[1])+a[2]*(a[2]-this._camPos[2]))/l.vec3.length(a)+b)/l.vec3.distance(a,this._camPos);return Math.min(1,a)};a.prototype.hasLOD=function(a){return 0!==a.lodMetric};a.prototype.getDistancePlanarMode=function(a,b){var c=a[0]-b[0],d=a[1]-b[1];a=a[2]-b[2];c=c*c+d*d;b=b[3];if(c<=b*b)return Math.abs(a);b=Math.sqrt(c)-b;return Math.sqrt(a*a+b*b)};a.prototype.getDistanceGlobeMode=function(a,b){var c=l.vec3.length(b),d=l.vec3.length(a)-c;l.vec3.scale(this._tmp0,a,l.vec3.dot(a,b)/l.vec3.squaredLength(a));
var e=l.vec3.squaredDistance(b,this._tmp0),f=b[3];if(e<=f*f)return Math.abs(d);b=l.vec3.scale(this._tmp0,b,1/c);c=l.vec3.scale(this._tmp1,b,c-f*f/2/c);e=l.vec3.subtract(this._tmp2,a,c);e=l.vec3.subtract(this._tmp2,e,l.vec3.scale(this._tmp3,b,l.vec3.dot(b,e)));c=l.vec3.add(this._tmp2,c,l.vec3.scale(this._tmp2,e,f/l.vec3.length(e)));f=l.vec3.distance(a,c);2E5<=d&&(a=l.vec3.subtract(this._tmp1,a,c),a=l.vec3.dot(a,b)/l.vec3.length(a),.08>a&&(a=1E-4),f/=a);return f};a.prototype.getDistance=function(a,
b){return this.engineSR===t.SphericalECEFSpatialReference?this.getDistanceGlobeMode(a,b):this.getDistancePlanarMode(a,b)};a.prototype._updateMinMaxDistance=function(a){0<a?(this.minDistance=Math.min(this.minDistance,a),this.maxDistance=Math.max(this.maxDistance,a)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-a))};a.prototype.getLodLevel=function(a){if(0===a.lodMetric||!a.resources.hasFeatureData)return 0;if(0===a.childCount)return this.maxLodLevel;if(1>this.progressiveLoadFactor){var b=
this.screenspaceErrorBias;return this.evaluateLODmetric(a,this.progressiveLoadFactor*this.screenspaceErrorBias)?this.evaluateLODmetric(a,b)?2:1:0}return this.evaluateLODmetric(a,this.screenspaceErrorBias)?this.maxLodLevel:0};a.prototype.evaluateLODmetric=function(a,b){switch(a.lodMetric){case 2:var c=this.getRenderMbs(a),d=this.getDistance(this._camPos,c),e=2*d/this._screenSizeFactor;this._updateMinMaxDistance(d+c[3]);return a.maxError*b<=e;case 1:return b=this.screenSpaceDiameterMbs(a,a.mbs[3]*b),
this.options.angleDependentLoD&&(b*=this.calcAngleDependentLoD(a)),b<a.maxError;case 3:return 10>this.screenSpaceDiameterMbs(a,a.maxError)*b;case 4:return this.calcCameraDistance(a)>a.maxError*b}return!1};a.prototype.distToPOI=function(a){a=this.getRenderMbs(a);return l.vec3.distance(a,this._poi)-a[3]};a.prototype.distCameraToPOI=function(){return l.vec3.distance(this._camPos,this._poi)};return a}()})},"esri/layers/support/SceneModification":function(){define("require exports tslib ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators ../../core/accessorSupport/decorators/persistable ../../views/3d/support/polygonUtils ../../views/3d/support/projectionUtils".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b){return function(a){function g(b){b=a.call(this,b)||this;b.geometry=null;b.type="clip";return b}d.__extends(g,a);k=g;g.prototype.writeGeometry=function(a,d,e,g){if(g.layer&&g.layer.spatialReference&&!g.layer.spatialReference.equals(this.geometry.spatialReference)){if(!b.canProject(a.spatialReference,g.layer.spatialReference)){g&&g.messages&&g.messages.push(new c("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",
{modification:this,spatialReference:g.layer.spatialReference,context:g}));return}var h=new l.Polygon({spatialReference:g.layer.spatialReference});f.polygonToPolygon(a,h);d[e]=h.toJSON(g)}else d[e]=a.toJSON(g);delete d[e].spatialReference};g.prototype.clone=function(){return new k({geometry:e.clone(this.geometry),type:this.type})};var k;d.__decorate([h.property({type:l.Polygon}),m.persistable()],g.prototype,"geometry",void 0);d.__decorate([h.writer(["web-scene","portal-item"],"geometry")],g.prototype,
"writeGeometry",null);d.__decorate([h.property({type:["clip","mask","replace"],nonNullable:!0}),m.persistable()],g.prototype,"type",void 0);return g=k=d.__decorate([h.subclass("esri.layers.support.SceneModification")],g)}(k.JSONSupport)})},"esri/views/3d/support/polygonUtils":function(){define(["require","exports","./projectionUtils"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.polygonToPolygon=void 0;a.polygonToPolygon=function(a,k,e,c){void 0===e&&(e=k.spatialReference);void 0===
c&&(c=0);var h=[];if(!d.pathsToPaths(a.rings,a.hasZ,a.hasM,a.spatialReference,h,e,c))return!1;k.rings=h;k.spatialReference=e;k.hasZ=a.hasZ;k.hasM=a.hasM;return!0}})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("require exports tslib ../../../Graphic ../../../symbols ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/accessorSupport/diffUtils ../../../core/libs/gl-matrix-2/vec3f64 ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(b){b=a.call(this,b)||this;b.loadedGraphics=new r.LimitGraphicsMap(5E4);b.slicePlaneEnabled=!1;b._renderingInfo={symbol:new k.PointSymbol3D};b._handles=new c;b._graphicsByNode=new Map;b._scaleVisibility=null;return b}d.__extends(b,a);b.prototype.initialize=function(){var a=this;this._graphicsCore=new p.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:1,elevationFeatureExpressionEnabled:!1,
graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1});var b=this.view.basemapTerrain;this._scaleVisibility=new t({layerScaleEnabled:!1});this._scaleVisibility.setup(this,this.layer,function(b,c,d){return a._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(b,c,d)},this._graphicsCore,b);var b=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),
c=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);this._graphicsCore.setup({labeler:b,deconflictor:c,scaleVisibility:this._scaleVisibility}).then(function(){a._graphicsCore.startCreateGraphics()}).catch(function(){});this._handles.add([this.layer.watch("labelingInfo",function(b,c){f.diff(b,c)&&a._graphicsCore.updateLabelingInfo()})])};b.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);null!=this._scaleVisibility&&(this._scaleVisibility.destroy(),
this._scaleVisibility=null);null!=this._graphicsCore&&(this._graphicsCore.destroy(),this._graphicsCore=null);this.loadedGraphics.destroy();this.view=null};b.prototype.addNodeMeta=function(a,b){var c=this,d=0,e=a.filteredIds,f=a.featureIds.map(function(f,k){u.boundingBoxTop(k,c.collection,a.objectHandle,v);var m=g.makeDehydratedPoint(0,0,0,c.view.spatialReference);c.view.renderCoordsHelper.fromRenderCoords(v,m);k=b(k,a);var n=!1;h.isNone(e)?n=!0:d<e.length&&f===e[d]&&(n=!0,d++);return{objectId:f,uid:l.generateUID(),
attributes:k,visible:n,geometry:m}});this.loadedGraphics.addMany(f);this._graphicsByNode.set(a.node.index,f)};b.prototype.setNodeMetaAttributes=function(a,b){for(var c=this._graphicsByNode.get(a.node.index),d=Array(c.length),e=0;e<c.length;e++){var f=c[e];f.attributes=b(e,a);d[e]=f.uid}this._graphicsCore.updateLabelingInfo(d)};b.prototype.applyFilterChange=function(a){var b=this._graphicsByNode.get(a.node.index);if(b)if(h.isNone(a.filteredIds))for(a=0;a<b.length;a++){var c=b[a];c.visible||(c.visible=
!0,q.graphic=c,q.property="visible",q.oldValue=!1,q.newValue=!0,this._graphicsCore.graphicUpdateHandler(q))}else for(var d=0,e=0;e<b.length;e++){var c=b[e],f=c.visible;d<a.filteredIds.length&&c.objectId===a.filteredIds[d]?(c.visible=!0,d++):c.visible=!1;f!==c.visible&&(q.graphic=c,q.property="visible",q.oldValue=f,q.newValue=c.visible,this._graphicsCore.graphicUpdateHandler(q))}};b.prototype.removeNodeMeta=function(a){this.loadedGraphics.removeManyByObjectId(a.featureIds)};b.prototype.getRenderingInfo=
function(){return this._renderingInfo};b.prototype.notifyGraphicUpdate=function(){};Object.defineProperty(b.prototype,"usedMemory",{get:function(){return this._graphicsCore.usedMemory},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"unloadedMemoryEstimate",{get:function(){return this._graphicsCore.unprocessedMemoryEstimate},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"test",{get:function(){return{graphicsCore:this._graphicsCore}},enumerable:!1,configurable:!0});
d.__decorate([m.property()],b.prototype,"view",void 0);d.__decorate([m.property()],b.prototype,"layer",void 0);d.__decorate([m.property()],b.prototype,"collection",void 0);d.__decorate([m.property()],b.prototype,"loadedGraphics",void 0);d.__decorate([m.property({aliasOf:"_graphicsCore.updating"})],b.prototype,"updating",void 0);d.__decorate([m.property()],b.prototype,"slicePlaneEnabled",void 0);d.__decorate([m.property()],b.prototype,"_graphicsCore",void 0);return b=d.__decorate([m.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],
b)}(e);var q={graphic:null,property:null,oldValue:null,newValue:null},v=b.vec3f64.create();a.default=n})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("require exports tslib ../../../../core/arrayUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../support/projectionUtils @dojo/framework/shim/Promise".split(" "),function(n,a,d,l,k,e,
c,h,m,f){function b(a,b){return t.intersects(a,b)?t.contains(a,b)?0:2:1}function g(a,b){return t.intersects(a,b)?t.contains(a,b)?1:2:0}function p(a,b,c,d){a=b.getComponentAabb(c,a,r);b=b.getObjectTransform(c);for(c=0;8>c;++c)q[0]=c&1?a[0]:a[3],q[1]=c&2?a[1]:a[4],q[2]=c&4?a[2]:a[5],e.vec3.transformMat3(q,q,b.rotationScale),e.vec3.add(q,q,b.position),d[3*c]=q[0],d[3*c+1]=q[1],d[3*c+2]=q[2];return d}Object.defineProperty(a,"__esModule",{value:!0});a.boundingBoxTop=a.createGetFeatureExtent=a.boundingBoxCornerPoints=
a.filterWithMask=a.testMaskWithGeometry=a.computeMaskNodeMBS=a.acquireMaskFilterContext=a.processFilterGeometry=a.loadGeometryEngine=a.isGeometryEngineLoaded=void 0;var t;a.isGeometryEngineLoaded=function(){return!!t};a.loadGeometryEngine=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(a){switch(a.label){case 0:return t?[2,t]:[4,new Promise(function(a,b){n(["../../../../geometry/geometryEngine"],a,b)})];case 1:return t=a.sent(),[2,t]}})})};a.processFilterGeometry=
function(a,b){if(!a)return null;if("disjoint"===b&&"polygon"===a.type){var c=Array(a.rings.length);for(b=0;b<a.rings.length;++b){var d=m.fromValues(Infinity,Infinity,-Infinity,-Infinity);m.expandWithNestedArray(d,a.rings[b]);c[b]={type:"polygon",rings:[a.rings[b]],spatialReference:a.spatialReference,aabr:d}}c.sort(function(a,b){return a.aabr[0]-b.aabr[0]});var e=new Set,f=new l.PositionHint;a=function(a){var b=c[a];for(a+=1;a<c.length;++a){var d=c[a];if(d.aabr[0]>=b.aabr[2])break;e.add(d)}e.forEach(function(a){b!==
a&&(a.aabr[2]<=b.aabr[0]?e.delete(a):t.intersects(b,a)&&(b.rings=b.rings.concat(a.rings),m.expand(b.aabr,a.aabr),delete b._geVersion,e.delete(a),a=l.indexOf(c,a,c.length,f),c.splice(a,1)))});e.add(b)};for(b=0;b<c.length;++b)a(b);for(a=0;a<c.length;a++)delete c[a].aabr;return c}return[a]};a.acquireMaskFilterContext=function(a,c,d,e,f){c=c.renderSpatialReference;var h=new Map,k={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:d};k.rings[0][3]=k.rings[0][0];
var m,l;switch(a){case "intersects":m=function(a,b){return t.intersects(a,b)?0:2};l=b;break;case "contains":m=function(a,b){return t.contains(a,b)?2:1};l=b;break;default:m=function(a,b){return t.disjoint(a,b)?2:1},l=g}return{collection:e,object:f,type:a,maskSR:d,renderSR:c,aabbCache:h,triangle:k,positions:{indices:null,data:null,stride:0,startIndex:0,endIndex:0},triangleTest:m,geometryTest:l}};a.computeMaskNodeMBS=function(a,b){var c={x:a[0],y:a[1],hasZ:!1,hasM:!1,type:"point",spatialReference:b.maskSR};
a=b.maskSR.isWGS84||b.maskSR.isWebMercator?t.geodesicBuffer(c,a[3],1):t.buffer(c,a[3],1);a.type="polygon";return a};a.testMaskWithGeometry=function(a,c,d){switch(d){case "intersects":case "contains":return b(a,c);case "disjoint":return g(a,c)}};var u=Math.pow(2,-32);a.filterWithMask=function(a,b,c){var d=c.collection,g=c.object,h=c.renderSR,k=c.maskSR,m=c.geometryTest,l=c.aabbCache,n=l.get(b);if(!n){var p=d.getObjectTransform(g);d.getComponentAabb(g,b,r);for(var q=[[r[0],r[1],0],[r[0],r[4],0],[r[3],
r[4],0],[r[3],r[1],0]],n=0;4>n;++n)e.vec3.transformMat3(q[n],q[n],p.rotationScale),e.vec3.add(q[n],q[n],p.position),f.vectorToVector(q[n],h,q[n],k);n={rings:[q],hasZ:!1,hasM:!1,type:"polygon",spatialReference:k};n.rings[0][4]=n.rings[0][0];l.set(b,n)}switch(m(a,n)){case 1:return!1;case 0:return!0}var m=c.triangle,l=c.triangleTest,n=c.positions,p=m.rings[0][0],q=m.rings[0][1],t=m.rings[0][2],v=d.getObjectTransform(g);d.getComponentPositions(g,b,n);b=n.indices;for(var d=n.data,g=n.stride,w=n.endIndex,
n=n.startIndex;n<w;n+=3){var z=g*b[n+0],Q=g*b[n+1],R=g*b[n+2];e.vec3.set(p,d[z+0],d[z+1],d[z+2]);e.vec3.set(q,d[Q+0],d[Q+1],d[Q+2]);e.vec3.set(t,d[R+0],d[R+1],d[R+2]);e.vec3.transformMat3(p,p,v.rotationScale);e.vec3.transformMat3(q,q,v.rotationScale);e.vec3.transformMat3(t,t,v.rotationScale);e.vec3.add(p,p,v.position);e.vec3.add(q,q,v.position);e.vec3.add(t,t,v.position);f.vectorToVector(p,h,p,k);f.vectorToVector(q,h,q,k);f.vectorToVector(t,h,t,k);if(!(Math.abs((q[0]-p[0])*(t[1]-p[1])-(q[1]-p[1])*
(t[0]-p[0]))<u))switch(delete m._geVersion,l(a,m)){case 1:return!1;case 0:return!0}}switch(c.type){case "intersects":return!1;default:return!0}};a.boundingBoxCornerPoints=p;a.createGetFeatureExtent=function(a,b,c){var d=new Float64Array(24);return function(e){var g=e.meta.featureExtents;if(k.isNone(g)){g=new Float64Array(6*e.meta.featureIds.length);e.meta.featureExtents=g;for(var m=0;m<g.length;m+=6)g[m]=Number.POSITIVE_INFINITY}g=new Float64Array(g.buffer,6*e.index*Float64Array.BYTES_PER_ELEMENT,
6);g[0]===Number.POSITIVE_INFINITY&&(p(e.index,c,e.meta.objectHandle,d),f.bufferToBuffer(d,b,0,d,a,0,8)?h.expandWithBuffer(h.NEGATIVE_INFINITY,d,0,8,g):h.set(g,h.ZERO));return g}};a.boundingBoxTop=function(a,b,c,d){a=b.getComponentAabb(c,a,r);b=b.getObjectTransform(c);d[0]=0;d[1]=0;for(c=d[2]=0;8>c;++c)q[0]=c&1?a[0]:a[3],q[1]=c&2?a[1]:a[4],q[2]=a[5],e.vec3.transformMat3(q,q,b.rotationScale),e.vec3.add(q,q,b.position),d[0]+=q[0],d[1]+=q[1],d[2]+=q[2];d[0]/=8;d[1]/=8;d[2]/=8;return d};var r=h.create(),
q=c.vec3f64.create()})},"esri/views/3d/support/LimitGraphicsMap":function(){define("require exports tslib ../../../core/Evented ../../../core/MapUtils ./GraphicsMap".split(" "),function(n,a,d,l,k,e){Object.defineProperty(a,"__esModule",{value:!0});a.LimitGraphicsMap=void 0;n=function(a){function f(b){var c=a.call(this)||this;c._limit=b;c._all=new e.GraphicsMap;c._active=new h(c);c._pending=new Map;c._handle=c._all.on("change",function(a){return c._handleChanges(a)});return c}d.__extends(f,a);f.prototype.destroy=
function(){this._handle.remove()};Object.defineProperty(f.prototype,"length",{get:function(){return this._active.length},enumerable:!1,configurable:!0});f.prototype.toArray=function(){return this._active.toArray()};f.prototype.find=function(a){return this._active.find(a)};f.prototype.forEach=function(a){this._active.forEach(a)};f.prototype.addMany=function(a){this._all.addMany(a)};f.prototype.removeManyByObjectId=function(a){this._all.removeManyByObjectId(a)};f.prototype._handleChanges=function(a){var b=
this,d=a.removed;if(0<this._pending.size)for(var d=[],e=0,f=a.removed;e<f.length;e++){var h=f[e];this._pending.delete(h.objectId)||d.push(h)}e=this._limit-this._active.length+d.length;e<a.added.length&&(this._active.removeMany(d),d=[],c.reset(1-this._limit/(this._active.length+a.added.length)),this._active.forEach(function(a){c.sample()&&(d.push(a),b._pending.set(a.objectId,a))}),e=this._limit-this._active.length+d.length);var k=a.added;if(e<a.added.length)for(k=[],c.reset(e/a.added.length),f=0,a=
a.added;f<a.length;f++)h=a[f],c.sample()?k.push(h):this._pending.set(h.objectId,h);h=e-k.length;0<h&&0<this._pending.size&&(c.reset(h/this._pending.size),this._pending.forEach(function(a){c.sample()&&(k.push(a),b._pending.delete(a.objectId))}));this._active.addAndRemove(k,d)};return f}(l);a.LimitGraphicsMap=n;var c=new (function(){function a(){this.percentage=1;this.last=-1;this.index=0}a.prototype.reset=function(a){this.percentage=a;this.last=-1};a.prototype.sample=function(){var a=Math.floor(this.index*
this.percentage);++this.index;if(a===this.last)return!1;this.last=a;return!0};return a}()),h=function(){function a(a){this._parent=a;this._map=new Map}Object.defineProperty(a.prototype,"length",{get:function(){return this._map.size},enumerable:!1,configurable:!0});a.prototype.forEach=function(a){this._map.forEach(function(b){return a(b)})};a.prototype.find=function(a){var b;k.someMap(this._map,function(c){return a(c)?(b=c,!0):!1});return b};a.prototype.toArray=function(){return k.valuesOfMap(this._map)};
a.prototype.addAndRemove=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];this._map.set(d.objectId,d)}for(c=0;c<b.length;c++)d=b[c],this._map.delete(d.objectId);(0<a.length||0<b.length)&&this._parent.emit("change",{added:a,removed:b})};a.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this._map.delete(a[b].objectId);0<a.length&&this._parent.emit("change",{added:[],removed:a})};return a}()})},"esri/views/3d/support/GraphicsMap":function(){define(["require","exports","tslib","../../../core/Evented",
"../../../core/MapUtils"],function(n,a,d,l,k){Object.defineProperty(a,"__esModule",{value:!0});a.GraphicsMap=void 0;n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c._map=new Map;return c}d.__extends(c,a);c.prototype.clear=function(){if(0<this._map.size){var a=this.toArray();this._map.clear();this.emit("change",{added:[],removed:a})}};Object.defineProperty(c.prototype,"length",{get:function(){return this._map.size},enumerable:!1,configurable:!0});c.prototype.get=function(a){return this._map.get(a)};
c.prototype.addMany=function(a){if(0!==a.length){for(var c=new Set,d=0;d<a.length;d++){var b=a[d],e=b.objectId,h=this._map.get(e);h?(c.add(e),b!==h&&(a[d]=h),++h.refCount):(b.refCount=1,this._map.set(e,b))}a=0<c.size?a.filter(function(a){return!c.has(a.objectId)}):a;0<a.length&&this.emit("change",{added:a,removed:[]})}};c.prototype.removeMany=function(a){for(var c=[],d=0;d<a.length;d++){var b=a[d],e=b.objectId,h=this._map.get(e);null!=h&&0>=--h.refCount&&(this._map.delete(e),c.push(b))}0<c.length&&
this.emit("change",{added:[],removed:c})};c.prototype.removeManyByObjectId=function(a){for(var c=[],d=0;d<a.length;d++){var b=a[d],e=this._map.get(b);null!=e&&0>=--e.refCount&&(this._map.delete(b),c.push(e))}0<c.length&&this.emit("change",{added:[],removed:c})};c.prototype.toArray=function(){return k.valuesOfMap(this._map)};c.prototype.find=function(a){var c;k.someMap(this._map,function(d){return a(d)?(c=d,!0):!1});return c};c.prototype.forEach=function(a){this._map.forEach(function(c){return a(c)})};
return c}(l);a.GraphicsMap=n})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("require exports tslib ../../../core/Logger ../../../core/PooledArray ../support/projectionUtils ../support/WorkerHandle".split(" "),function(n,a,d,l,k,e,c){function h(a,c){f.clear();for(var d=function(a){var d="clip"===a.type?2:"mask"===a.type?1:0,g=a.geometry;a=function(a){return a};if(g.spatialReference){if(!e.canProject(g.spatialReference,c))return m.warn("Can't project modification polygon into layer spatial reference, ignoring modification"),
"continue";a=function(a){e.vectorToVector(a,g.spatialReference,b,c);return b}}else g.hasZ||(b[2]=0,a=function(a){b[0]=a[0];b[1]=a[1];return b});f.push(d);f.push(g.rings.length);for(var d=0,h=g.rings;d<h.length;d++){var k=h[d];f.push(k.length);for(var l=0;l<k.length;l++){var n=a(k[l]);f.push(n[0]);f.push(n[1]);f.push(n[2])}}},g=0;g<a.length;g++)d(a[g]);f.push(3);a=new Float64Array(f.length);for(d=0;d<f.length;++d)a[d]=f.getItemAt(d);return a}Object.defineProperty(a,"__esModule",{value:!0});a.toWasmModification=
a.I3SMeshWorkerHandle=void 0;var m=l.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle");n=function(a){function b(b){return a.call(this,"SceneLayerWorker","process",b)||this}d.__extends(b,a);b.prototype.getTransferList=function(a){return[a.geometryBuffer]};b.prototype.setModifications=function(a,b,c){a={context:a,modifications:h(b,c),isGeodetic:c.isGeographic};this.broadcast(a,"setModifications")};b.prototype.setLegacySchema=function(a,b){b=JSON.stringify(b);this.broadcast({context:a,jsonSchema:b},
"setLegacySchema")};b.prototype.destroyContext=function(a){return this.broadcast(a,"destroyContext")};return b}(c.WorkerHandle);a.I3SMeshWorkerHandle=n;var f=new k({deallocator:null}),b=[0,0,0];a.toWasmModification=h})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports tslib ../../../core/maybe ../../../core/promiseUtils ../../../core/typedArrayUtil ../../../libs/i3s/I3SWorker".split(" "),function(n,a,d,l,k,e,c){function h(a){for(var b=a.modifications,c=u._malloc(8*b.length),
d=new Float64Array(u.HEAPU8.buffer,c,b.length),e=0;e<b.length;++e)d[e]=b[e];u.setModifications(a.context,c,b.length,a.isGeodetic);u._free(c)}function m(a,b){if(!u)return null;var c=a.context,d=a.localOrigin,f=a.globalTrafo,h=a.mbs,k=a.obb,m=a.elevationOffset,n=a.geometryBuffer,p=a.geometryDescriptor,q=a.indexToVertexProjector,r=a.vertexToRenderProjector,t=u._malloc(n.byteLength),J=u._malloc(33*Float64Array.BYTES_PER_ELEMENT),I=new Uint8Array(u.HEAPU8.buffer,t,n.byteLength);I.set(new Uint8Array(n));
n=new Float64Array(u.HEAPU8.buffer,J,33);g(n,d);var d=n.byteOffset+3*n.BYTES_PER_ELEMENT,K=new Float64Array(n.buffer,d);g(K,f);d+=16*n.BYTES_PER_ELEMENT;K=new Float64Array(n.buffer,d);g(K,h);d+=4*n.BYTES_PER_ELEMENT;l.isSome(k)&&(K=new Float64Array(n.buffer,d),g(K,k.center),d+=3*n.BYTES_PER_ELEMENT,K=new Float64Array(n.buffer,d),g(K,k.halfSize),d+=3*n.BYTES_PER_ELEMENT,K=new Float64Array(n.buffer,d),g(K,k.quaternion));f={isDraco:!1,isLegacy:!1,color:a.layouts.some(function(a){return a.some(function(a){return"color"===
a.name})}),normal:a.needNormals&&a.layouts.some(function(a){return a.some(function(a){return"normalCompressed"===a.name})}),uv0:a.layouts.some(function(a){return a.some(function(a){return"uv0"===a.name})}),uvRegion:a.layouts.some(function(a){return a.some(function(a){return"uvRegion"===a.name})}),featureIndex:p.featureIndex};c=u.process(c,!!a.obb,t,I.byteLength,p,f,J,m,q,r,a.normalReferenceFrame);u._free(J);u._free(t);if(0<c.error.length)throw"i3s.wasm: "+c.error;if(c.discarded)return null;t=0<c.componentOffsets.length?
e.slice(c.componentOffsets):null;J=0<c.featureIds.length?e.slice(c.featureIds):null;m=e.slice(c.interleavedVertedData).buffer;p=1===c.indicesType?e.slice(new Uint16Array(c.indices.buffer,c.indices.byteOffset,c.indices.byteLength/2)):e.slice(new Uint32Array(c.indices.buffer,c.indices.byteOffset,c.indices.byteLength/4));q=e.slice(c.positions);r=1===c.positionIndicesType?e.slice(new Uint16Array(c.positionIndices.buffer,c.positionIndices.byteOffset,c.positionIndices.byteLength/2)):e.slice(new Uint32Array(c.positionIndices.buffer,
c.positionIndices.byteOffset,c.positionIndices.byteLength/4));a={layout:a.layouts[0],interleavedVertexData:m,indices:p,hasColors:c.hasColors,hasModifications:c.hasModifications,positionData:{data:q,indices:r}};J&&b.push(J.buffer);t&&b.push(t.buffer);b.push(m);b.push(p.buffer);b.push(q.buffer);b.push(r.buffer);return{componentOffsets:t,featureIds:J,transformedGeometry:a,obb:c.obb}}function f(a){var b=a.context,c=a.buffer;a=u._malloc(c.byteLength);var d=c.byteLength/Float64Array.BYTES_PER_ELEMENT,e=
new Float64Array(u.HEAPU8.buffer,a,d),c=new Float64Array(c);e.set(c);u.filterOBBs(b,a,d);c.set(e);u._free(a)}function b(a){u&&u.destroy(a)}function g(a,b){for(var c=0;c<b.length;++c)a[c]=b[c]}function p(){if(u)return k.resolve();t||(t=c.getWorkerModule().then(function(a){u=a;t=null}));return t}Object.defineProperty(a,"__esModule",{value:!0});a.test=a.ensureWASM=a.filterObbsForModificationsSync=a.interpretObbModificationResults=a.setModificationsSync=a.destroyContext=a.setLegacySchema=a.setModifications=
a.filterObbsForModifications=a.dracoDecompressPointCloudData=a.process=void 0;a.process=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c;return d.__generator(this,function(d){switch(d.label){case 0:return[4,p()];case 1:return d.sent(),b=[a.geometryBuffer],c=m(a,b),[2,{result:c,transferList:b}]}})})};a.dracoDecompressPointCloudData=function(a){var b;return d.__awaiter(this,void 0,void 0,function(){var c,f,g,h,k,m,l,n,q;return d.__generator(this,function(d){switch(d.label){case 0:return[4,
p()];case 1:d.sent();c=[a.geometryBuffer];f=a.geometryBuffer;g=f.byteLength;h=u._malloc(g);k=new Uint8Array(u.HEAPU8.buffer,h,g);k.set(new Uint8Array(f));m=u.dracoDecompressPointCloudData(h,k.byteLength);u._free(h);if(0<m.error.length)throw"i3s.wasm: "+m.error;l=0<(null===(b=m.featureIds)||void 0===b?void 0:b.length)?e.slice(m.featureIds):null;n=e.slice(m.positions);l&&c.push(l.buffer);c.push(n.buffer);q={positions:n,featureIds:l};return[2,{result:q,transferList:c}]}})})};a.filterObbsForModifications=
function(a){return d.__awaiter(this,void 0,void 0,function(){var b;return d.__generator(this,function(c){switch(c.label){case 0:return[4,p()];case 1:return c.sent(),f(a),b={buffer:a.buffer},[2,{result:b,transferList:[b.buffer]}]}})})};a.setModifications=function(a){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(b){switch(b.label){case 0:return[4,p()];case 1:return b.sent(),h(a),[2]}})})};a.setLegacySchema=function(a){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,
function(b){switch(b.label){case 0:return[4,p()];case 1:return b.sent(),u.setLegacySchema(a.context,a.jsonSchema),[2]}})})};a.destroyContext=function(a){b(a)};var t,u;a.setModificationsSync=h;a.interpretObbModificationResults=function(a){return 0===a?0:1===a?1:2===a?2:3};a.filterObbsForModificationsSync=f;a.ensureWASM=p;a.test={transform:m,destroy:b}})},"esri/libs/i3s/I3SWorker":function(){define("require exports ../../assets ../../core/has ../../core/promiseUtils @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k){function e(a){return d.getAssetUrl("esri/libs/i3s/"+a)}Object.defineProperty(a,"__esModule",{value:!0});a.getWorkerModule=void 0;a.getWorkerModule=function(){if(!c){var a=l("esri-wasm")?new Promise(function(a,c){n(["./i3s"],a,c)}):new Promise(function(a,c){n(["./i3s_nowasm"],a,c)});c=k.create(function(c){return a.then(function(a){var b=a({locateFile:e,onRuntimeInitialized:function(){return c(b)}});delete b.then})}).catch(function(a){return k.reject(a)})}return c};var c})},"esri/views/3d/layers/i3s/Highlights":function(){define(["require",
"exports","../../../../core/arrayUtils"],function(n,a,d){var l=function(){return function(){this.ids=new Set;this.paused=!1}}();return function(){function a(a){this.highlights=[];this.collection=a.collection;this.forAllFeatures=a.forAllFeatures;this.forAllFeaturesOfNode=a.forAllFeaturesOfNode}a.prototype.destroy=function(){var a=this;this.highlights.forEach(function(c){return a.releaseSet(c)});this.highlights=null};a.prototype.acquireSet=function(){var a=this,c=new l;this.highlights.push(c);return{set:c,
handle:{remove:function(){a.releaseSet(c);d.removeUnordered(a.highlights,c)},pause:function(){a.releaseSet(c);c.paused=!0},resume:function(){c.paused=!1;a.initializeSet(c)}}}};a.prototype.setFeatureIds=function(a,c){c.forEach(function(c){return a.ids.add(c)});this.initializeSet(a)};a.prototype.initializeSet=function(a){var c=this;this.forAllFeatures(function(d,e,f){a.ids.has(d)&&c.collection.addComponentHighlight(f.objectHandle,e);return 1})};a.prototype.releaseSet=function(a){var c=this;this.forAllFeatures(function(d,
e,f){a.ids.has(d)&&c.collection.removeComponentHighlight(f.objectHandle,e);return 1})};a.prototype.objectCreated=function(a){var c=this;this.highlights.forEach(function(d){d.paused||c.forAllFeaturesOfNode(a,function(e,f){d.ids.has(e)&&c.collection.addComponentHighlight(a.objectHandle,f);return 1})})};a.prototype.objectDeleted=function(a){this.collection.clearHighlights(a.objectHandle)};return a}()})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["require","exports","../../../../core/maybe",
"../../../../core/scheduling"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.I3SCrossfadeHelper=void 0;n=function(){function a(a){this.view=a;this.currentFrameStartTime=this.preRenderFrameTaskHandle=null;this._numFadingNodes=0}Object.defineProperty(a.prototype,"numFadingNodes",{get:function(){return this._numFadingNodes},enumerable:!1,configurable:!0});a.sign=function(a){return 0===a?1:-1};a.prototype.preRenderCallback=function(){var a=this.currentFrameStartTime;this.currentFrameStartTime=
Date.now();null!==a&&this.updateAllNodeFading(a)};a.prototype.stopNodeFadingInternal=function(a){null!=a.lodCrossfadeTargetTime&&this._numFadingNodes--;a.lodCrossfadeTargetTime=null;0===this.numFadingNodes&&(null!=this.preRenderFrameTaskHandle&&(this.preRenderFrameTaskHandle.remove(),this.preRenderFrameTaskHandle=null),this.view.notifyUpdate())};a.prototype.startNodeFadingInternal=function(a,c,d){var e=this;0===this.numFadingNodes&&(this.preRenderFrameTaskHandle=l.addFrameTask({preRender:function(){e.preRenderCallback()}}),
this.view.notifyUpdate());null==a.lodCrossfadeTargetTime&&this._numFadingNodes++;a.lodCrossfadeDirection=d;a.lodCrossfadeTargetTime=c};a.prototype.updateAllNodeFading=function(e){var c=this;if(this.view){var h=this.currentFrameStartTime,k=this.view.lodCrossfadeDuration,f=void 0!==e&&0<k;this.view.foreachCrossfadeNode(function(b,g){if(d.isSome(g)&&null!=g.lodCrossfadeTargetTime){var k=g.lodCrossfadeTargetTime,m=g.lodCrossfadeDirection,l=0===m?c.view.fullOpacity:0;!f||h>=k?(c.stopNodeFadingInternal(g),
1===m&&c.view.markNodeToRemove(b)):(g=c.view.getNodeOpacityByIndex(b),k=(h-e)/c.view.lodCrossfadeDuration,l=g+a.sign(m)*k);c.view.setNodeOpacityByIndex(b,l)}});this.view.removeMarkedNodes()}};a.prototype.stopAllNodeFading=function(){this.updateAllNodeFading(void 0)};a.prototype.fadeoutNodes=function(a){for(var c=0;c<a.length;++c){var d=a.data[c],e=this.view.getNodeCrossfadeMetaData(d);this.fadeNode(d,e,1)}};a.prototype.fadeNode=function(a,c,h){d.isSome(c)&&this.fadeNodeInternal(a,c,h)};a.prototype.fadeNodeInternal=
function(a,c,d){var e=this.view.isFadingEnabled(),f=0===d?this.view.fullOpacity:0;e?(a=this.view.getNodeOpacityByIndex(a),this.startNodeFadingInternal(c,this.currentFrameStartTime+this.view.lodCrossfadeDuration*Math.abs(f-a),d)):(this.stopNodeFadingInternal(c),this.view.setNodeOpacityByIndex(a,f))};return a}();a.I3SCrossfadeHelper=n})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../../webgl-engine/lib/Intersector".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t){var u=p.empty(),r=f.mat4f64.create(),q=g.vec3f64.create(),v=g.vec3f64.create(),w=g.vec3f64.create(),z=e.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(a){function e(b){b=a.call(this,b)||this;b.tmpEvent={spatialReference:null,extent:u,context:"scene"};return b}d.__extends(e,a);e.prototype.initialize=function(){this.view=this.layerView.view;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersector=new t.Intersector(this.view.state.mode);
this.intersector.options.store=0;var a=this.layerView.i3slayer.fullExtent;this.zmin=a.zmin;this.zmax=a.zmax;this.tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};e.prototype.getElevation=function(a,c,d,e){q[0]=a;q[1]=c;q[2]=d;if(!this.renderCoordsHelper.toRenderCoords(q,e,q))return z.error("could not project point to compute elevation"),null;c=this.layerView.elevationOffset;a=this.zmin+c;c=this.zmax+c;b.vec3.copy(v,q);b.vec3.copy(w,q);this.renderCoordsHelper.setAltitude(c,v);this.renderCoordsHelper.setAltitude(a,
w);this.intersector.reset(v,w);this.intersectionHandler.intersect(this.intersector,null,v,w);return this.intersector.results.min.getIntersectionPoint(q)?this.renderCoordsHelper.getAltitude(q):null};e.prototype.layerChanged=function(){this.spatialReference&&(this.tmpEvent.extent=this.computeLayerExtent(),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};e.prototype.objectChanged=function(a){this.spatialReference&&(this.tmpEvent.extent=this.computeObjectExtent(a),
this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};e.prototype.computeObjectExtent=function(a){p.empty(u);this.expandExtent(a,u);return u};e.prototype.computeLayerExtent=function(){p.empty(u);for(var a=0,b=this.layerView.getVisibleNodes();a<b.length;a++)this.expandExtent(b[a],u);return u};e.prototype.expandExtent=function(a,d){var e=a.visibilityObb||a.serviceObbInRenderSR;if(c.isSome(e))for(m.mat4.fromQuat(r,e.quaternion),r[12]=e.center[0],r[13]=e.center[1],
r[14]=e.center[2],a=0;8>a;++a)q[0]=a&1?e.halfSize[0]:-e.halfSize[0],q[1]=a&2?e.halfSize[1]:-e.halfSize[1],q[2]=a&4?e.halfSize[2]:-e.halfSize[2],b.vec3.transformMat4(q,q,r),this.renderCoordsHelper.fromRenderCoords(q,q,this.spatialReference),p.expand(d,q);else{var f=a.renderMbs[3],e=b.vec3.copy(v,a.renderMbs);e[0]-=f;e[1]-=f;e[2]-=f;var g=b.vec3.copy(w,a.renderMbs);g[0]+=f;g[1]+=f;g[2]+=f;for(a=0;8>a;++a)q[0]=a&1?e[0]:g[0],q[1]=a&2?e[1]:g[1],q[2]=a&4?e[2]:g[2],this.renderCoordsHelper.fromRenderCoords(q,
q,this.spatialReference),p.expand(d,q)}return d};d.__decorate([h.property({constructOnly:!0})],e.prototype,"layerView",void 0);d.__decorate([h.property({constructOnly:!0})],e.prototype,"intersectionHandler",void 0);d.__decorate([h.property()],e.prototype,"view",void 0);d.__decorate([h.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],e.prototype,"spatialReference",void 0);return e=d.__decorate([h.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],e)}(k.EventedMixin(l))})},
"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../support/orientedBoundingBox ../../webgl-engine/lib/intersectorUtils".split(" "),function(n,a,d,l,k,e){function c(a,c,d,b){void 0===b&&(b=0);b=a[3]+b;var e=c[0]-a[0],f=c[1]-a[1];a=c[2]-a[2];c=d[0];var h=d[1];d=d[2];var k=c*e+h*f+d*a;return 0<=k*k-(c*c+h*h+d*d)*(e*e+f*f+a*a-b*b)}Object.defineProperty(a,"__esModule",{value:!0});a.I3SIntersectionHandler=
void 0;n=function(){function a(a){this.type="I3S";this.layerUid=a.layerUid;this.sublayerUid=a.sublayerUid;this.collection=a.collection;this.forEach=a.forEach;this.slicePlane=a.slicePlaneEnabled;this.isGround=a.isGround}a.prototype.intersect=function(a,f,b,g){var h=this,m=a.results,n=2===a.options.store,r=a.ray.direction,q=a.tolerance,v=function(a){return a},w=function(a){return a},z=e.getVerticalOffsetI3S(a.verticalOffset);d.isSome(z)&&(v=function(a){return z.applyToMbs(a)},w=function(a){return z.applyToObb(a)});
this.forEach(function(p,u){if(d.isSome(p.geometryObb)){if(!k.intersectLine(w(p.geometryObb),b,r,q))return}else if(d.isSome(p.serviceObbInRenderSR)){if(!k.intersectLine(w(p.serviceObbInRenderSR),b,r,q))return}else if(!c(v(p.renderMbs),b,r,q))return;h.collection.intersect(u,b,g,q,z,function(c,d,k,q){if(0<=d&&(null==f||f(b,g,d))){var r=function(a){a.intersector=h.type;a.target={type:"external",metadata:{layerUid:h.layerUid,sublayerUid:h.sublayerUid,nodeIndex:p.index,componentIndex:c}};a.dist=d;l.vec3.copy(a.normal,
k);a.triangleNr=q};h.isGround&&(null==m.ground.dist||d<m.ground.dist)&&r(m.ground);if(!a.options.isFiltered&&((null==m.min.dist||d<m.min.dist)&&r(m.min),(null==m.max.dist||d>m.max.dist)&&r(m.max),n)){var u=new e.IntersectorResult(a.ray);r(u);a.results.all.push(u)}}})})};Object.defineProperty(a.prototype,"intersectionHandlerId",{get:function(){return this.layerUid},enumerable:!1,configurable:!0});return a}();a.I3SIntersectionHandler=n})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["require",
"exports","../../../../core/Error","../../../../core/maybe","../../../../core/promiseUtils"],function(n,a,d,l,k){function e(a){return k.create(function(c,d){a.oncomplete=function(){return c()};a.onerror=function(){return d(a.error)};a.onabort=function(){return d(a.error)}})}function c(a){return k.create(function(c,d){"done"===a.readyState?null!=a.error?d(a.error):c(a.result):(a.onsuccess=function(){return c(a.result)},a.onerror=function(){return d(a.error)})})}Object.defineProperty(a,"__esModule",
{value:!0});a.whenRequest=a.whenTransaction=a.IDBCache=void 0;n=function(){function a(a,c,b){void 0===b&&(b=14);this._version=b;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=a;this._storeName=c}a.prototype.init=function(){var a=this;return k.resolve().then(function(){var d=indexedDB.open(a._dbName,a._version);d.onupgradeneeded=function(b){var c=d.result,e=
d.transaction,f=c.objectStoreNames.contains(a._storeName)?e.objectStore(a._storeName):c.createObjectStore(a._storeName),c=c.objectStoreNames.contains("last_access")?e.objectStore("last_access"):c.createObjectStore("last_access");c.indexNames.contains("date")||c.createIndex("date","date",{unique:!1});c.indexNames.contains("byteSize")||c.createIndex("byteSize","byteSize",{unique:!1});b.oldVersion<a._version&&(f.clear(),c.clear())};return c(d)}).then(function(c){a._destroyed?c.close():a._db=c})};a.prototype.destroy=
function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};Object.defineProperty(a.prototype,"initialized",{get:function(){return null!=this._db},enumerable:!1,configurable:!0});a.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)};a.prototype.put=function(a,c){var b=this;return null==this._db?k.reject(new d("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:k.resolve()).then(function(){return b._put(a,
c)}).catch(function(d){if(d&&"QuotaExceededError"===d.name)return null==b._quotaReductionPromise&&(b._quotaReductionPromise=b._getCacheSize().then(function(a){return b._removeLeastRecentlyAccessed(c.byteSize+Math.ceil(a*b.quotaReductionFactor))}),b._quotaReductionPromise.then(function(){return b._quotaReductionPromise=null},function(){return b._quotaReductionPromise=null})),b._quotaReductionPromise.then(function(){return b._put(a,c)});throw d;}).then(function(){b._gcCounter--;0>b._gcCounter&&null!=
b._db&&(b._gcCounter=b.gcFrequency,b._getCacheSize().then(function(a){return b._removeLeastRecentlyAccessed(a-b.maxByteSize)}))})};a.prototype.get=function(a,d){var b=this;if(null==this._db)return k.resolve(null);var e=null;return k.resolve().then(function(){var f=b._db.transaction(b._storeName,"readonly");e=k.onAbort(d,function(){f.abort()});var g=f.objectStore(b._storeName).get(a);return c(g)}).then(function(c){null==c?++b._miss:b._db&&(++b._hit,b._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),
byteSize:c.byteSize},a));l.isSome(e)&&e.remove();return c}).catch(function(){++b._miss;k.throwIfAborted(d);l.isSome(e)&&e.remove();return null})};a.prototype.remove=function(a){var d=this;return null==this._db?k.resolve():k.resolve().then(function(){var b=d._db.transaction([d._storeName,"last_access"],"readwrite"),f=b.objectStore(d._storeName),h=b.objectStore("last_access"),f=f.delete(a),h=h.delete(a);return k.all([c(f),c(h),e(b)])})};a.prototype._put=function(a,d){var b=this._db.transaction([this._storeName,
"last_access"],"readwrite"),f=b.objectStore(this._storeName),h=b.objectStore("last_access"),f=f.put(d,a);a=h.put({date:Date.now(),byteSize:d.byteSize},a);return k.all([c(f),c(a),e(b)])};a.prototype._removeLeastRecentlyAccessed=function(a){if(!(0>=a)){var c=this._db.transaction([this._storeName,"last_access"],"readwrite"),b=c.objectStore(this._storeName),d=c.objectStore("last_access"),h=0,k=d.index("date").openCursor(null,"next");k.onsuccess=function(){var c=k.result;null!=c&&(null!=c.value.byteSize&&
(h+=c.value.byteSize),b.delete(c.primaryKey),d.delete(c.primaryKey),h<a&&c.continue())};return e(c)}};a.prototype._getCacheSize=function(){var a=this._db.transaction("last_access"),c=0,b=a.objectStore("last_access").index("byteSize").openKeyCursor();b.onsuccess=function(){var a=b.result;if(a){var d=a.key;null!=d&&(c+=d);a.continue()}};return e(a).then(function(){return c})};return a}();a.IDBCache=n;a.whenTransaction=e;a.whenRequest=c})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["require",
"exports","../../../../../core/maybe"],function(n,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.RenderTexture=void 0;n=function(){function a(a,e){var c=this;this._textureRep=a;this._textureId=e;this._textureRef=d.applySome(this._textureId,function(a){return c._textureRep.acquire(a)})}a.prototype.dispose=function(){var a=this;this._textureRef=d.applySome(this._textureId,function(d){a._textureRep.release(d)})};a.prototype.bind=function(a,e,c,h,l){d.isSome(this._textureRef)&&(e.setUniform1i(c,
h),a.bindTexture(this._textureRef.glTexture,h),l&&(a=this._textureRef.glTexture,e.setUniform2f(l,a.descriptor.width,a.descriptor.height)))};return a}();a.RenderTexture=n})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g){Object.defineProperty(a,"__esModule",{value:!0});a.I3SQueryEngine=void 0;var p=f.default;n=function(a){function f(b){b=a.call(this,b)||this;b._dataQueryEngineInstance=null;b._handles=new e;return b}d.__extends(f,a);Object.defineProperty(f.prototype,"defaultQueryJSON",{get:function(){return(new g({outSpatialReference:this.spatialReference})).toJSON()},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},
enumerable:!1,configurable:!0});f.prototype.initialize=function(){var a=this;this._handles.add(this.layerView.on("visible-geometry-changed",function(){return a.spatialIndex.events.emit("changed")}))};f.prototype.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null);this._handles&&(this._handles.destroy(),this._handles=null);this._set("layerView",null)};f.prototype.executeQueryForCount=function(a,b){return d.__awaiter(this,void 0,
void 0,function(){return d.__generator(this,function(c){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(a),b)]})})};f.prototype.executeQueryForExtent=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g;return d.__generator(this,function(d){switch(d.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(a),b)];case 1:return c=d.sent(),e=c.count,f=c.extent,g=m.fromJSON(f),[2,{count:e,extent:g}]}})})};f.prototype.executeQueryForIds=
function(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(a),b)]})})};f.prototype.executeQuery=function(a,c){return d.__awaiter(this,void 0,void 0,function(){var e,f,g;return d.__generator(this,function(d){switch(d.label){case 0:e=this._ensureQueryJSON(a);if(e.returnGeometry)throw new k("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");
if(e.returnCentroid)throw new k("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");return[4,this.dataQueryEngine.executeQuery(e,c)];case 1:return f=d.sent(),g=b.fromJSON(f),g.features.forEach(function(a){a.geometry=null}),[2,g]}})})};f.prototype._ensureQueryJSON=function(a){if(c.isNone(a))return this.defaultQueryJSON;var b=a.toJSON();b.outSpatialReference||(a.outSpatialReference=this.spatialReference);return b};f.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
var a=this.layer.objectIdField||"OBJECTID",b=this.layer.fields.map(function(a){return a.toJSON()}),c=this.layerView.view.resourceController.scheduler,d=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new p({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:b,timeInfo:null,spatialReference:d,objectIdField:a,featureStore:this.spatialIndex,scheduler:c,task:this.task})};d.__decorate([h.property({constructOnly:!0})],f.prototype,"layerView",void 0);d.__decorate([h.property({constructOnly:!0})],
f.prototype,"task",void 0);d.__decorate([h.property({constructOnly:!0})],f.prototype,"spatialIndex",void 0);d.__decorate([h.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],f.prototype,"spatialReference",void 0);d.__decorate([h.property({readOnly:!0,aliasOf:"layerView.i3slayer"})],f.prototype,"layer",void 0);d.__decorate([h.property({readOnly:!0,dependsOn:["spatialReference"]})],f.prototype,"defaultQueryJSON",null);return f=d.__decorate([h.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],
f)}(l);a.I3SQueryEngine=n;a.default=n})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("require exports ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/centroid ../../../../layers/graphics/OptimizedGeometry ./I3SUtil".split(" "),function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.I3SQueryFeatureAdapter=void 0;n=function(){function a(a){this.objectIdField=a.objectIdField;this.getFeatureExtent=a.getFeatureExtent}
a.prototype.getObjectId=function(a){return a.id};a.prototype.getAttributes=function(a){var b=a.meta,e=a.index,f={};this.objectIdField&&(f[this.objectIdField]=a.id);a=d.isSome(b.attributeInfo)&&b.attributeInfo.attributeData;if(d.isSome(a))for(var b=0,h=Object.keys(a);b<h.length;b++){var k=h[b];f[k]=c.getCachedAttributeValue(a[k],e)}return f};a.prototype.getAttribute=function(a,b){if(b===this.objectIdField)return a.id;var e=a.meta;a=a.index;e=d.isSome(e.attributeInfo)&&e.attributeInfo.attributeData;
return d.isSome(e)?c.getCachedAttributeValue(e[b],a):null};a.prototype.getGeometry=function(a){if(a.geometry)return a.geometry;var b=this.getFeatureExtent(a,h);a=b[0];var c=b[1],d=b[2],f=b[3],b=b[4];return new e.default([5],[a,c,d,f,c,d,f,b,d,a,b,d,a,c,d])};a.prototype.getCentroid=function(a,b){if(a.geometry)return k.getCentroidOptimizedGeometry(new e.default,a.geometry,b.hasZ,b.hasM);a=this.getFeatureExtent(a,h);return new e.default([0],[(a[0]+a[3])/2,(a[1]+a[4])/2,(a[2]+a[5])/2])};a.prototype.cloneWithGeometry=
function(a,b){return{id:a.id,index:a.index,meta:a.meta,geometry:b}};return a}();a.I3SQueryFeatureAdapter=n;var h=l.create()})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../support/projectionUtils".split(" "),function(n,a,d,l,k,
e,c,h,m,f){Object.defineProperty(a,"__esModule",{value:!0});a.I3SQueryFeatureStore=void 0;n=function(a){function c(b){b=a.call(this,b)||this;b.events=new k;return b}d.__extends(c,a);c.prototype.destroy=function(){};c.prototype.forEach=function(a){this.forAllFeatures(function(b){a(b);return 1})};c.prototype.forEachBounds=function(a,b,c){for(var d=this.getFeatureExtent,e=0;e<a.length;e++)b(d(a[e],c))};c.prototype.forEachInBounds=function(a,c){var d=this;this.forAllFeatures(function(b){var e=d.getFeatureExtent(b,
g);m.intersects(a,h.toRect(e,p))&&c(b);return 1},function(c){f.mbsToMbs(c.node.mbs,d.sourceSpatialReference,b,d.viewSpatialReference);if(b[0]>=a[0]&&b[2]<=a[2]&&b[1]>=a[1]&&b[3]<=a[3])return 1;c=b[0]-Math.max(a[0],Math.min(b[0],a[2]));var e=b[1]-Math.max(a[1],Math.min(b[1],a[3]));return c*c+e*e<=b[3]*b[3]?1:2})};d.__decorate([e.property({constructOnly:!0})],c.prototype,"featureAdapter",void 0);d.__decorate([e.property({constructOnly:!0})],c.prototype,"forAllFeatures",void 0);d.__decorate([e.property({constructOnly:!0})],
c.prototype,"getFeatureExtent",void 0);d.__decorate([e.property({constructOnly:!0})],c.prototype,"sourceSpatialReference",void 0);d.__decorate([e.property({constructOnly:!0})],c.prototype,"viewSpatialReference",void 0);return c=d.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],c)}(l);a.I3SQueryFeatureStore=n;var b=c.vec4f64.create(),g=h.create(),p=m.create();a.default=n})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("require exports tslib ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),
function(n,a,d,l,k,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.DefinitionExpressionSceneLayerView=void 0;var h=l.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView");a.DefinitionExpressionSceneLayerView=function(a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._definitionExpressionErrors=0;b._maxDefinitionExpressionErrors=20;b.logError=function(a){b._definitionExpressionErrors<b._maxDefinitionExpressionErrors&&h.error("Error while evaluating definitionExpression: "+
a);b._definitionExpressionErrors++;b._definitionExpressionErrors===b._maxDefinitionExpressionErrors&&h.error("Further errors are ignored")};return b}d.__extends(b,a);Object.defineProperty(b.prototype,"parsedDefinitionExpression",{get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{var a=e.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!a.isStandardized)return h.error("definitionExpression is using non standard function"),null;
var b=[];c.findFieldsCaseInsensitive(a.fieldNames,this.i3slayer.fields,{missingFields:b});if(0<b.length)return h.error("definitionExpression references unknown fields: "+b.join(", ")),null;this._definitionExpressionErrors=0;return a}catch(t){return h.error("Failed to parse definitionExpression: "+t),null}},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"definitionExpressionFields",{get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:
null},enumerable:!1,configurable:!0});b.prototype._evaluateClause=function(a,b){try{return a.testFeature(b)}catch(t){return this.logError(t),!1}};b.prototype._addDefinitionExpressionToQuery=function(a){if(!this.parsedDefinitionExpression)return a;var b=this.i3slayer.definitionExpression;a=a.clone();a.where=a.where?"("+b+") AND ("+a.where+")":b;return a};d.__decorate([k.property()],b.prototype,"i3slayer",void 0);d.__decorate([k.property({readOnly:!0,dependsOn:["i3slayer.definitionExpression","i3slayer.fieldsIndex"]})],
b.prototype,"parsedDefinitionExpression",null);d.__decorate([k.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],b.prototype,"definitionExpressionFields",null);return b=d.__decorate([k.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],b)}(a)}})},"esri/views/3d/layers/support/fieldProperties":function(){define(["require","exports","tslib","../../../../layers/support/fieldUtils"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.defineFieldProperties=
void 0;a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,dependsOn:["layer.fields","layer.outFields","requiredFields"],get:function(){var a=this.layer,e=this.layer.fields,c=this.requiredFields;return a.outFields?l.fixFields(e,d.__spreadArrays(l.unpackFieldNames(e,a.outFields),c)):l.fixFields(e,c)}}}}})},"esri/views/layers/SceneLayerView":function(){define(["require","exports","tslib","../../core/accessorSupport/decorators",
"./LayerView"],function(n,a,d,l,k){return function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.filter=null;return c}d.__extends(c,a);Object.defineProperty(c.prototype,"availableFields",{get:function(){return[]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"maximumNumberOfFeatures",{get:function(){return 0},set:function(a){throw Error("Not implemented");},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!1},
enumerable:!1,configurable:!0});c.prototype.highlight=function(a){throw Error("Not implemented");};c.prototype.queryFeatures=function(a){throw Error("Not implemented");};c.prototype.queryObjectIds=function(a){throw Error("Not implemented");};c.prototype.queryFeatureCount=function(a){throw Error("Not implemented");};c.prototype.createQuery=function(){throw Error("Not implemented");};c.prototype.queryExtent=function(a){throw Error("Not implemented");};d.__decorate([l.property()],c.prototype,"availableFields",
null);d.__decorate([l.property()],c.prototype,"maximumNumberOfFeatures",null);d.__decorate([l.property({readOnly:!0})],c.prototype,"maximumNumberOfFeaturesExceeded",null);d.__decorate([l.property()],c.prototype,"filter",void 0);return c}(k)})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require exports tslib ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/SetUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../renderers/support/renderingInfoUtils ../../../tasks/operations/zscale ../../../tasks/support/Query ./I3SPointsWorkerHandle ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/QueryEngine ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../../3d/support/debugFlags ../support/GraphicsMap ../support/orientedBoundingBox ../support/projectionUtils ../../layers/SceneLayerView ../../layers/support/FeatureFilter ../../support/Scheduler @dojo/framework/shim/Promise".split(" "),
function(n,a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O,N,S){function P(a,b){for(var d=0;d<a.length;d++)for(var e=0,f=a[d].graphics;e<f.length;e++){var g=f[e];g.attributes||(g.attributes={});if(c.isSome(b)&&c.isSome(b.loadedAttributes))for(var h=0,k=b.loadedAttributes;h<k.length;h++){var l=k[h].name;b.attributeData[l]&&(g.attributes[l]=F.getCachedAttributeValue(b.attributeData[l],d))}}}var U=e.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D"),Z=J.defineFieldProperties();
a=function(a){function e(){var b=null!==a&&a.apply(this,arguments)||this;b._nodesAddedToStage=new Map;b.drapeSourceType=1;b._queryEngine=null;b._memCache=null;b.loadedGraphics=new M.GraphicsMap;b.holeFilling="always";b.progressiveLoadFactor=1;b.supportsHeightUnitConversion=!0;b._coordinatesOutsideExtentErrors=0;b._maxCoordinatesOutsideExtentErrors=20;return b}d.__extends(e,a);e.prototype.initialize=function(){var a=this,b=this.layer;F.checkSpatialReferences(b,this.view.spatialReference,this.view.viewingMode);
for(var c=0,d=["layer.renderer","layer.labelingInfo","layer.labelsVisible","definitionExpressionFields","filter"];c<d.length;c++)this.updatingHandles.add(this,d[c],function(){return a._updateRequiredFields()});this.updatingHandles.add(b,"rangeInfos",function(b){return a._rangeInfosChanged(b)},2);this.updatingHandles.add(b,"renderer",function(b,c){return a._rendererChange(b,c)});this.updatingHandles.add(this,"layer.objectIdFilter",function(){return a._filterChange()});this.updatingHandles.add(this,
"parsedDefinitionExpression",function(){return a._filterChange()});this.handles.add(f.init(L,"I3S_TREE_SHOW_TILES",function(b){if(b&&!a._treeDebugger){var c=a._controller.crsIndex;(new Promise(function(a,b){n(["./support/I3STreeDebugger"],a,b)})).then(function(b){b=b.I3STreeDebugger;!a._treeDebugger&&L.I3S_TREE_SHOW_TILES&&(a._treeDebugger=new b({lv:a,view:a.view,nodeSR:c}))})}else b||!a._treeDebugger||L.I3S_TREE_SHOW_TILES||(a._treeDebugger.destroy(),a._treeDebugger=null)}));this._updateRequiredFields();
this._set("graphics3d",new E.default({owner:this,layer:b,preferredUpdatePolicy:1,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:b.fullExtent,updateClippingExtent:function(b){return a._updateClippingExtent(b)}}));if(this.graphics3d.elevationAlignment)this.graphics3d.elevationAlignment.events.on("invalidate-elevation",function(b){return a._invalidateElevation(b)});
this.supportsHeightUnitConversion&&(this._verticalScale=x.getGeometryZScaler("point",b.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.graphics3d.setup());this._memCache=this.view.resourceController.memoryController.getMemCache(b.uid);this._controller=new v({layerView:this,scaleVisibilityEnabled:!1});this.when(function(){a._queryEngine=new G.default({layerView:a,task:S.Task.FEATURE_QUERY_ENGINE});a.updatingHandles.add(a,"maximumNumberOfFeatures",function(b){return a._controller.featureTarget=
b},2);a.updatingHandles.add(a,"suspended",function(b){b&&a._removeAllNodeData()})})};e.prototype.destroy=function(){this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this._controller&&(this._controller.destroy(),this._controller=null);this._queryEngine&&(this._queryEngine.destroy(),this._queryEngine=null);this._memCache.destroy();this._nodesAddedToStage=this._memCache=null};Object.defineProperty(e.prototype,
"maximumNumberOfFeatures",{get:function(){var a=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return a?a.maximumNumberOfFeatures:0},set:function(a){null!=a?(this._override("maximumNumberOfFeatures",a),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return this.suspended?
!1:!!this._controller&&!this._controller.leafsReached},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"hasM",{get:function(){return!1},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"hasZ",{get:function(){return!0},enumerable:!1,configurable:!0});e.prototype.notifyGraphicUpdate=function(a,b){this.graphics3d.graphicsCore.notifyGraphicUpdate(a,b)};e.prototype.whenGraphicAttributes=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e=this;return d.__generator(this,
function(d){c=function(a){for(var b=new Map,c=[],d=0;d<a.length;d++){var f=a[d],g=e._findGraphicNodeAndIndex(f),h=b.get(g.node);h||(h={node:g.node,indices:[],graphics:[]},c.push(h),b.set(g.node,h));h.indices.push(g.index);h.graphics.push(f)}return c};return[2,F.whenGraphicAttributes(this.layer,a,this._getObjectIdField(),b,c,{populateObjectId:!0})]})})};e.prototype.getGraphicFromGraphicUid=function(a){if(!this.loadedGraphics)return null;var b=q.hydrateGraphic(this.loadedGraphics.find(function(b){return b.uid===
a}),this.layer),c=this._getObjectIdField();if(!b||!b.attributes||!b.attributes[c])return null;b.layer=this.layer;b.sourceLayer=this.layer;return b};e.prototype.whenGraphicBounds=function(a,b){return this.graphics3d.graphicsCore.whenGraphicBounds(a,b)};e.prototype.computeAttachmentOrigin=function(a,b){return this.graphics3d.graphicsCore.computeAttachmentOrigin(a,b)};e.prototype.canResume=function(){return a.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};e.prototype.isUpdating=
function(){return!!(this._controller&&this._controller.updating||this.graphics3d&&this.graphics3d.updating)};e.prototype.getRenderingInfo=function(a,b,c){(a=z.getRenderingInfo(a,{renderer:b,arcade:c}))&&a.color&&(b=a.color,b[0]/=255,b[1]/=255,b[2]/=255);return a};e.prototype.getRenderingInfoAsync=function(a,b,c,e){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(f){return[2,z.getRenderingInfoAsync(a,d.__assign({renderer:b,arcade:c},e))]})})};Object.defineProperty(e.prototype,
"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!1,configurable:!0});e.prototype._findGraphicNodeAndIndex=function(a){a=a.attributes[this.layer.objectIdField];for(var b=0,c=k.keysOfMap(this._nodesAddedToStage);b<c.length;b++){var d=this._nodesAddedToStage.get(c[b]),e=this._findGraphicIndex(d.bundle,a);if(0<=e)return{node:d.node,index:e}}return null};e.prototype._findGraphicIndex=function(a,b){for(var c=0;c<a.length;c++)for(var d=0,e=a[c].featureIds;d<
e.length;d++)if(e[d]===b)return c;return-1};e.prototype.highlight=function(a){return this.graphics3d.highlight(a,this.layer.objectIdField)};e.prototype.extractBinaryPointData=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var e,f,g;return d.__generator(this,function(d){switch(d.label){case 0:return e={geometryBuffer:a.geometryBuffer},f=new A.I3SPointsWorkerHandle(this.view.resourceController.scheduler),[4,f.invoke(e,b).then(function(a){if(c.isSome(a))return{positionData:a.positions,
featureIds:a.featureIds};throw Error("Failed to decompress Draco point data");})];case 1:return g=d.sent(),[2,g]}})})};e.prototype.checkExtent=function(a,b){a&&!u.extentContainsCoords3D(a,b)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&U.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&U.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++)};
e.prototype.addNode=function(a,b,e){return d.__awaiter(this,void 0,void 0,function(){var f,k,m,n,q,u,t,v,w,x,z,A,B,C,E,F,G,H,y,I,J,K,L,M,N,O,S,ga,X,la,Oa,Pa,Z,ba,ca,ia,ha,mb,wb,Ra,db,Ka,gb,eb,fb,sb;return d.__generator(this,function(d){switch(d.label){case 0:if(!("geometryBuffer"in b||"pointData"in b))return[2,h.reject()];if(this._nodesAddedToStage.has(a.index))return U.error("I3S node "+a.id+" already added"),[2,void 0];f=this._getObjectIdField();if(d=this.layer.fullExtent)d=this.layer.fullExtent.clone(),
d.xmin-=.5,d.ymin-=.5,d.xmax+=.5,d.ymax+=.5,d.hasZ&&(d.zmin-=.5,d.zmax+=.5),d.hasM&&(d.mmin-=.5,d.mmax+=.5);k=d;m=this._controller.crsVertex;n=this.view.spatialReference;q=[];u=[];t=[];return"geometryBuffer"in b&&null!=b.geometryBuffer?[4,this.extractBinaryPointData(b,e)]:[3,2];case 1:v=d.sent();if(null==v)return[2,h.reject()];w=this.graphics3d.graphicsCore;x=v.positionData;z=v.featureIds;A=x.length/3;for(B=0;B<A;B++)C=c.isSome(a.serviceObb)?a.serviceObb.center:[0,0,0],E=3*B,F=p.vec3f64.fromValues(x[E+
0],x[E+1],x[E+2]),g.vec3.add(F,F,C),a.serviceObb||t.push(F[0],F[1],F[2]),k&&this.checkExtent(k,F),G=[],H=z[B],y={},null!=H&&(y[f]=H),I=null==H?l.generateUID():H,R.bufferToBuffer(F,m,0,T,n,0,1),J=r.makeDehydratedPoint(T[0],T[1],T[2],n),K=this.loadedGraphics.get(I),c.isSome(K)?(K.level<a.level&&(Y.property="geometry",Y.graphic=K,Y.oldValue=c.unwrap(K.geometry),Y.newValue=J,K.geometry=J,w.graphicUpdateHandler(Y)),G.push(K)):(L=l.generateUID(),G.push({objectId:I,uid:L,geometry:J,attributes:y,visible:!0,
level:a.level})),q.push.apply(q,G),u.push({featureIds:[H],graphics:G});d.label=2;case 2:if("pointData"in b)for(M=[0,0,0],N=0,O=b.pointData;N<O.length;N++)for(S=O[N],ga=S.featureDataPosition,X=ga.length,la=S.geometries||[V[X]],z=S.featureIds,k&&this.checkExtent(k,ga),Oa=0;Oa<la.length;Oa++)if(Pa=la[Oa],Z=Pa.params.type,"points"===Z){G=[];ba=Oa<z.length?Oa:0;H=z[ba];y={};null!=H&&(y[f]=H);I=null==H?l.generateUID():H;ca=void 0;"Embedded"===Pa.type&&(ca=Pa.params.vertexAttributes.position);for(ia=0;ia<
ca.length;ia+=X){for(ha=0;ha<X;ha++)M[ha]=ga[ha]+ca[ia+ha];mb=3===X;a.serviceObb||t.push(M[0],M[1],mb?M[2]:0);R.bufferToBuffer(M,m,0,T,n,0,1);J=r.makeDehydratedPoint(T[0],T[1],mb?T[2]:void 0,n);K=this.loadedGraphics.get(I);c.isSome(K)?G.push(K):G.push({objectId:I,uid:l.generateUID(),geometry:J,attributes:y,visible:!0})}q.push.apply(q,G);u.push({featureIds:S.featureIds,graphics:G})}a.numFeatures=q.length;this._updateNodeMemory(a);wb=b.attributeDataInfo;Ra={bundle:u,attributeInfo:wb,node:a};P(Ra.bundle,
Ra.attributeInfo);0<t.length&&(db=this._controller.crsIndex,Ka=db.isGeographic?this.view.renderSpatialReference:db,R.bufferToBuffer(t,m,0,t,Ka,0,t.length/3),gb={data:t,size:3,offsetIdx:0,strideIdx:3},a.serviceObb=Q.compute(gb),db.isGeographic&&R.vectorToVector(a.serviceObb.center,Ka,a.serviceObb.center,db),this._controller.updateVisibility(a.index));if(!this._controller.isGeometryVisible(a))return this._cacheNodeData(Ra),[2,h.resolve()];if(this._verticalScale)for(eb=0,fb=q;eb<fb.length;eb++)sb=fb[eb],
this._verticalScale(sb.geometry);this._nodesAddedToStage.set(a.index,Ra);this.loadedGraphics.addMany(q);this._filterNode(Ra);this._treeDebugger&&this._treeDebugger.update();return[2,h.resolve()]}})})};e.prototype.isNodeLoaded=function(a){return this._nodesAddedToStage.has(a)};e.prototype.isNodeReloading=function(){return!1};e.prototype.updateNodeState=function(){};e.prototype._updateNodeMemory=function(a){a.memory=4096+(c.isSome(a.numFeatures)?a.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic:
0)};e.prototype._cacheNodeData=function(a){var b=a.bundle.reduce(function(a,b){return b.graphics.reduce(function(a,b){return r.estimateSize(b)+a},512+8*b.featureIds.length+a)},1024);this._memCache.put(this._getMemCacheKey(a.node),a,b)};e.prototype._getMemCacheKey=function(a){return""+a.index};e.prototype._removeAllNodeData=function(){var a=this;this._nodesAddedToStage.forEach(function(b){b&&(a._updateNodeMemory(b.node),a._cacheNodeData(b))});this._nodesAddedToStage.clear();this._treeDebugger&&this._treeDebugger.update();
this.loadedGraphics.clear()};e.prototype.removeNode=function(a){if(a=this._removeNodeStageData(a))this._updateNodeMemory(a.node),this._cacheNodeData(a)};e.prototype._removeNodeStageData=function(a){var b=this._nodesAddedToStage.get(a);if(!b)return null;for(var c=0,d=b.bundle;c<d.length;c++)this.loadedGraphics.removeMany(d[c].graphics);this._nodesAddedToStage.delete(a);this._treeDebugger&&this._treeDebugger.update();return b};e.prototype.loadCachedNodeData=function(a){return h.resolve(this._memCache.pop(this._getMemCacheKey(a)))};
e.prototype.addCachedNodeData=function(a,b,c){if(this._nodesAddedToStage.has(a.index))U.error("I3S node "+a.id+" already added");else{for(var d=0,e=b.bundle;d<e.length;d++)this.loadedGraphics.addMany(e[d].graphics);this._nodesAddedToStage.set(a.index,b);this._updateNodeMemory(a);this.setAttributeData(a.index,c);this._filterNode(b);this._treeDebugger&&this._treeDebugger.update();return h.resolve()}};e.prototype.getLoadedNodeIds=function(){var a=[];this._nodesAddedToStage.forEach(function(b){return a.push(b.node.id)});
return a.sort()};e.prototype.getVisibleNodes=function(){var a=[];this._nodesAddedToStage.forEach(function(b){return a.push(b.node)});return a};e.prototype.getLoadedNodeIndices=function(a){this._nodesAddedToStage.forEach(function(b,c){return a.push(c)})};e.prototype.getLoadedAttributes=function(a){if((a=this._nodesAddedToStage.get(a))&&c.isSome(a.attributeInfo))return a.attributeInfo.loadedAttributes};e.prototype.getAttributeData=function(a){if((a=this._nodesAddedToStage.get(a))&&c.isSome(a.attributeInfo))return a.attributeInfo.attributeData};
e.prototype.setAttributeData=function(a,b){if(a=this._nodesAddedToStage.get(a))a.attributeInfo=b,P(a.bundle,b),this._filterNode(a),this.graphics3d.graphicsCore.labelsEnabled&&(b=a.bundle.map(function(a){return a.graphics.length&&a.graphics[0].uid}),this.graphics3d.graphicsCore.updateLabelingInfo(b))};e.prototype._updateClippingExtent=function(a){this._controller&&this._controller.updateClippingArea(a);return!1};e.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};
e.prototype._rendererChange=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g;return d.__generator(this,function(d){switch(d.label){case 0:return c=this.layer.fields,e=new Set,a?[4,a.collectRequiredFields(e,c)]:[3,2];case 1:return d.sent(),f=m.valuesOfSet(e).sort(),[3,3];case 2:f=[],d.label=3;case 3:return e.clear(),b?[4,b.collectRequiredFields(e,c)]:[3,5];case 4:return d.sent(),g=m.valuesOfSet(e).sort(),[3,6];case 5:g=[],d.label=6;case 6:if(f.length===g.length&&f.every(function(a,
b){return f[b]===g[b]}))return[2];this._reloadAllNodes();return[2]}})})};e.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&U.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};e.prototype._filterChange=function(){var a=this;this._nodesAddedToStage.forEach(function(b){return a._filterNode(b)})};e.prototype._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};
e.prototype._filterNode=function(a){var b=this._getObjectIdField(),c=null;if(this.layer.objectIdFilter)var d=this.layer.objectIdFilter.ids,e="include"===this.layer.objectIdFilter.method,c=function(a){return 0<=d.indexOf(a)===e};var f=this.parsedDefinitionExpression,g=0;for(a=a.bundle;g<a.length;g++)for(var h=0,k=a[g].graphics;h<k.length;h++){var l=k[h],m=l.visible;c&&!c(l.attributes[b])?l.visible=!1:l.visible=f?this._evaluateClause(f,l):!0;m!==l.visible&&(Y.graphic=l,Y.property="visible",Y.oldValue=
m,Y.newValue=l.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(Y))}};e.prototype._updateRequiredFields=function(){return d.__awaiter(this,void 0,void 0,function(){var a,b,e,f,g,h,k,l,n;return d.__generator(this,function(d){switch(d.label){case 0:return a=this,e=b=a.layer,f=e.fields,g=e.renderer,h=e.labelsVisible,k=a.filter,l=a.definitionExpressionFields,n=new Set,g?[4,g.collectRequiredFields(n,f)]:[3,2];case 1:d.sent(),d.label=2;case 2:return h?[4,w.collectLabelingFields(n,b)]:[3,4];case 3:d.sent(),
d.label=4;case 4:return c.isSome(k)?[4,w.collectFilterFields(n,b,k)]:[3,6];case 5:d.sent(),d.label=6;case 6:return w.collectFields(n,f,l),this._set("requiredFields",m.valuesOfSet(n).sort()),[2]}})})};e.prototype._invalidateElevation=function(a){var b=this._controller.crsIndex;R.boundingRectToBoundingRect(a.extent,a.spatialReference,X,b);this._controller.updateElevationChanged(X,b)};e.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};
return c.isSome(this.filter)?this.filter.createQuery(a):new B(a)};e.prototype.queryFeatures=function(a,b){return this._queryEngine.executeQuery(this._ensureQuery(a),b&&b.signal)};e.prototype.queryObjectIds=function(a,b){return this._queryEngine.executeQueryForIds(this._ensureQuery(a),b&&b.signal)};e.prototype.queryFeatureCount=function(a,b){return this._queryEngine.executeQueryForCount(this._ensureQuery(a),b&&b.signal)};e.prototype.queryExtent=function(a,b){return this._queryEngine.executeQueryForExtent(this._ensureQuery(a),
b&&b.signal)};e.prototype._ensureQuery=function(a){return this._addDefinitionExpressionToQuery(c.isNone(a)?this.createQuery():B.from(a))};e.prototype.getUsedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return a?a.usedMemory:0};e.prototype.getUnloadedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(a?a.unprocessedMemoryEstimate:0))};e.prototype.ignoresMemoryFactor=function(){return this._controller&&
this._controller.fixedFeatureTarget};e.prototype.getNumberOfNodes=function(){return this._nodesAddedToStage.size};e.prototype.getNumberOfFeatures=function(){return this.loadedGraphics.length};Object.defineProperty(e.prototype,"performanceInfo",{get:function(){var a={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this.getNumberOfNodes(),core:this.graphics3d.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(a);
return a},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"test",{get:function(){return{controller:this._controller}},enumerable:!1,configurable:!0});d.__decorate([b.property()],e.prototype,"graphics3d",void 0);d.__decorate([b.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],e.prototype,"hasDraped",void 0);d.__decorate([b.property({type:N})],e.prototype,"filter",void 0);d.__decorate([b.property()],e.prototype,"loadedGraphics",void 0);d.__decorate([b.property()],e.prototype,
"layer",void 0);d.__decorate([b.property({aliasOf:"layer"})],e.prototype,"i3slayer",void 0);d.__decorate([b.property()],e.prototype,"_controller",void 0);d.__decorate([b.property({dependsOn:["_controller.updating","graphics3d.updating"]})],e.prototype,"updating",void 0);d.__decorate([b.property({dependsOn:["_controller.rootNodeVisible"]})],e.prototype,"suspended",void 0);d.__decorate([b.property()],e.prototype,"holeFilling",void 0);d.__decorate([b.property(I.updatingProgress)],e.prototype,"updatingProgress",
void 0);d.__decorate([b.property({aliasOf:"_controller.updatingProgress"})],e.prototype,"updatingProgressValue",void 0);d.__decorate([b.property(Z.requiredFields)],e.prototype,"requiredFields",void 0);d.__decorate([b.property(Z.availableFields)],e.prototype,"availableFields",void 0);d.__decorate([b.property({type:Number,dependsOn:["graphics3d.graphicsCore.displayFeatureLimit"]})],e.prototype,"maximumNumberOfFeatures",null);d.__decorate([b.property({readOnly:!0,dependsOn:["suspended","_controller.leafsReached"]})],
e.prototype,"maximumNumberOfFeaturesExceeded",null);d.__decorate([b.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],e.prototype,"lodFactor",void 0);d.__decorate([b.property({readOnly:!0})],e.prototype,"hasM",null);d.__decorate([b.property({readOnly:!0})],e.prototype,"hasZ",null);return e=d.__decorate([b.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],e)}(H.DefinitionExpressionSceneLayerView(K.PopupSceneLayerView(C.LayerView3D(O))));var V={2:{type:"Embedded",
params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},T=p.vec3f64.create(),Y={graphic:null,property:null,oldValue:null,newValue:null},X=t.create();return a})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["require","exports","tslib","../support/WorkerHandle"],function(n,a,d,l){Object.defineProperty(a,"__esModule",{value:!0});a.I3SPointsWorkerHandle=void 0;n=function(a){function e(c){return a.call(this,
"SceneLayerWorker","dracoDecompressPointCloudData",c)||this}d.__extends(e,a);e.prototype.getTransferList=function(a){return[a.geometryBuffer]};return e}(l.WorkerHandle);a.I3SPointsWorkerHandle=n})},"*noref":1}});
define("require exports tslib ../Camera ../geometry ../Graphic ../Ground ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/has ../core/Logger ../core/maybe ../core/promiseUtils ../core/scheduling ../core/watchUtils ../core/workers ./../core/screenUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3f64 ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ../layers/support/layerUtils ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./3d/layerViewModuleImportUtils ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/graphics/ObjectResourceCache ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/geometryUtils ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/pointUtils ./3d/support/projectionUtils ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/geometryUtils/boundedPlane ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/intersectorUtils ./support/layerViewUtils ./support/screenshotUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment @dojo/framework/shim/Promise".split(" "),function(n,
a,d,l,k,e,c,h,m,f,b,g,p,t,u,r,q,v,w,z,x,B,A,C,E,G,F,H,J,I,K,L,M,Q,R,O,N,S,P,U,Z,V,T,Y,X,ca,ba,ga,ia,ha,da,fa,ka,ja,pa,na,va,za,ya,ua,oa,ta,ma,qa,aa,Ja,La,Ga,y,ra,Na,Ha,Xa,Ya){function W(a,b){a.layerUids||(a.layerUids=new Set);a.layerUids.add(b)}function wa(a,b){a.graphicUids||(a.graphicUids=new Set);a.graphicUids.add(b)}var Ca=t.getLogger("esri.views.SceneView");a=function(a){function t(b){var c=a.call(this,b)||this;c._clippingArea=null;c._userClippingArea=null;c._initialDefaultSpatialReference=null;
c._defaults={};c._externallySet={environment:!1};c._createGraphicsViewController=null;c._resolveWhenReady=[];c.propertiesPool=new na.default({slicePlane:ta.BoundedPlaneClass},c);c._resourceController=ya.newResourceController(c);c._defaultToMapOptions={include:new Set};c._defaultHitTestOptions={exclude:new Set};c.deconflictor=new U.GraphicsDeconflictor({view:c});c.labeler=new Z.Labeler({view:c,deconflictor:c.deconflictor.labels});c.sharedSymbolResources=null;c.basemapTerrain=null;c.elevationProvider=
null;c.camera=null;c.canvas=null;c.center=null;c.constraints=new O.default;c.environmentManager=new S.default;c.extent=null;c.windowDevicePixelRatio=1;c.fullOpacity=1;c.graphicsView=null;c.groundView=null;c.navigating=!1;c.map=null;c.screenSizePerspectiveEnabled=!0;c.state=new Y.default;c.scale=null;c.spatialReference=null;c.isHeightModelInfoRequired=!0;c.alphaCompositingEnabled=!1;c.supersampleScreenhotsEnabled=!0;c.type="3d";c.ui=new Xa;c._numUpdating=0;c._lastUpdateTime=0;c.updatingProgress=.5;
c.viewpoint=null;c.zoom=null;c.highlightOptions=new fa;w.initialize();c.handles.add(v.init(c,"viewingMode",function(a){return c.state.viewingMode=a},!0));b&&b.environment||(c._defaults.environment=new N,c.environment=c._defaults.environment);b=function(){c.notifyChange("dataExtent");c.updatingChanged();c.map&&c.map.allLayers.forEach(function(a){return d.__awaiter(c,void 0,void 0,function(){return d.__generator(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),[4,a.when()];case 1:return b.sent(),
[3,3];case 2:return b.sent(),[3,3];case 3:return this.updatingChanged(),[2]}})})})};c.handles.add([v.on(c,"map.allLayers","after-changes",b,b,b,!0),c.allLayerViews.on("after-changes",function(){return c._updateUpdatingMonitors()}),c.watch("map",function(a){a&&a.load&&a.load().catch(function(){})})]);c.inputManager=new P({view:c});c.stateManager=new X.ViewStateManager({view:c,updateDevicePixelRatio:function(){var a=window.devicePixelRatio;a!==c.windowDevicePixelRatio&&(c.windowDevicePixelRatio=a,c.notifyChange("pixelRatio"))}});
return c}d.__extends(t,a);t.prototype.initialize=function(){var a=this;this.groundView=new K({view:this});this._updateUpdatingMonitors();var b=function(){return a._updateDefaultToMapOptions()};this.handles.add(v.on(this,"map.allLayers","after-changes",b,b,b));this.updatingHandles.add(this.qualitySettings,"memoryLimit",function(b){a.resourceController&&(a.resourceController.memoryController.maxMemory=b)},2);this.updatingHandles.add(this.qualitySettings,"additionalCacheMemory",function(b){a.resourceController&&
(a.resourceController.memoryController.additionalCacheMemory=b)},2);this.updatingHandles.add(this.qualitySettings,"frameRate",function(a){return q.setFrameDuration(0<a?1E3/Math.ceil(a):0)},2);this.updatingHandles.add(ga,"SCENEVIEW_LOCKING_LOG",function(b){return a.defaultsFromMap.logDebugInformation=b},2);this.updatingHandles.add(this,"map.ground",b,3);this.updatingHandles.add(this,"map.ground.opacity",function(){return a._updateDefaultHitTestOptions()},3);this.handles.add(this.watch("spatialReference",
function(){return a.notifyChange("clippingArea")},!0))};t.prototype.destroy=function(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController.destroy(),this._resourceController=null,this.stateManager.destroy(),
this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView.destroy(),this.groundView=null)};Object.defineProperty(t.prototype,"renderSpatialReference",{get:function(){return this.renderCoordsHelper?this.renderCoordsHelper.spatialReference:null},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"clippingArea",
{get:function(){if("global"===this.viewingMode)return null;var a=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&!this.get("map.clippingEnabled")||!a)return this._clippingArea=null;if(!(a instanceof k.Extent))return Ca.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference){if(!F.canProject(a.spatialReference,this.spatialReference))return Ca.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),
this._clippingArea;a=F.project(a,this.spatialReference)}return this._clippingArea&&a&&this._clippingArea.equals(a)?this._clippingArea:this._clippingArea=a},set:function(a){this.ready&&"global"===this.viewingMode&&a?Ca.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"dataExtent",{get:function(){var a=[],b=this.spatialReference||k.SpatialReference.WGS84,
c=this.clippingArea;c&&(c=F.project(c,b));var d=function(d){if(d&&(d=F.project(d,b))){if(c&&(d=d.intersection(c),!d))return;a.push(d)}},e=this.basemapTerrain;e&&e.spatialReference&&d(new k.Extent({xmin:e.extent[0],ymin:e.extent[1],zmin:0,xmax:e.extent[2],ymax:e.extent[3],zmax:0,spatialReference:e.spatialReference}));this.map&&this.map.allLayers.forEach(function(a){return d(a.fullExtent)});if(0===a.length)return new k.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b});e=a.reduce(function(a,
b){return a.union(b)});e.hasZ?(e.zmin=Math.min(0,e.zmin),e.zmax=Math.max(0,e.zmax)):(e.zmin=0,e.zmax=0);return e},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"environment",{set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",a)},enumerable:!1,configurable:!0});t.prototype.castEnvironment=function(a){return a?a instanceof N?a:a instanceof Ya?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(a):N.fromWebsceneEnvironment(a):
B.ensureType(N,a):new N};Object.defineProperty(t.prototype,"pixelRatio",{get:function(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)},set:function(a){u.isSome(a)?this._override("pixelRatio",a):this._clearOverride("pixelRatio")},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"maximumPixelRatio",{get:function(){var a=Infinity,b=this.qualitySettings,c=b.maximumPixelRatio,b=b.maximumRenderResolution;null!=c&&(a=Math.min(a,c));null!=b&&(a=Math.min(a,b/Math.max(this.width,
this.height)));return a},set:function(a){u.isSome(a)?this._override("maximumPixelRatio",a):this._clearOverride("maximumPixelRatio")},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"groundExtent",{get:function(){var a=this._get("basemapTerrain");if(a&&a.spatialReference){var b=a.extent;return new k.Extent({xmin:b[0],ymin:b[1],xmax:b[2],ymax:b[3],spatialReference:a.spatialReference})}return new k.Extent({spatialReference:this.spatialReference||k.SpatialReference.WGS84})},enumerable:!1,
configurable:!0});Object.defineProperty(t.prototype,"initialExtentRequired",{get:function(){return this.stateManager&&!this.stateManager.hasInitialView},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"interacting",{get:function(){return this.navigating||u.isSome(this.activeTool)},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"stationary",{get:function(){return!this.animation&&!this.resizing&&(u.isNone(this.state)||this.state.stationary)},enumerable:!1,configurable:!0});
Object.defineProperty(t.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||ia.getDefaultProfile()},set:function(a){ia.isValidProfile(a)&&(ia.apply(a,this.qualitySettings),this._set("qualityProfile",a))},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"slicePlane",{set:function(a){this._stage.renderView.setRenderParameters({slicePlane:a});if(u.isNone(a))this._set("slicePlane",null);else{var b=this.propertiesPool.get("slicePlane");da.boundedPlane.copy(a,
b);this._set("slicePlane",b)}},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"resolution",{get:function(){return null!=this.spatialReference?G.getResolutionForScale(this.scale,this.spatialReference):0},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"heightModelInfo",{get:function(){var a=this.getDefaultHeightModelInfo();return null!=a?C.deriveUnitFromSR(a,this.spatialReference):null},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"updating",
{get:function(){var a=0,b=0,c=!1;this.allLayerViews.forEach(function(d){d.isFulfilled()?d.updating&&(c=!0,d.suspended||(++b,a="updatingProgress"in d?a+d.updatingProgress:a+.5)):++b});for(var d=0,e=[this.graphicsView,this.basemapView,this.basemapTerrain,this.layerViewManager,this._resourceController,this._stage&&this._stage.renderView,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.updatingHandles,this.featureTreeDebugger];d<e.length;d++){var f=e[d];u.isSome(f)&&f.updating&&
(b+=.1,a+=.05)}d=0;for(e=[this.deconflictor,this.labeler];d<e.length;d++)f=e[d],u.isSome(f)&&f.updating&&(++b,a+=f.updatingProgress);(c=!!(c||0<b||!this.ready||!this.stationary||this._createGraphicsViewController||this.inputManager&&this.inputManager.hasPendingInputs||this.map&&this.map.allLayers&&this.map.allLayers.some(function(a){return!a.isFulfilled()})))?(this._numUpdating=Math.max(b,this._numUpdating),a+=this._numUpdating-b):this._numUpdating=0;a=0<this._numUpdating?a/this._numUpdating:c?.5:
1;this._get("updatingProgress")!==a&&(f=this._resourceController.scheduler.now,1>a&&(d=Math.min((f-this._lastUpdateTime)/2E3,1),a=this.updatingProgress*(1-d)+a*d),this._set("updatingProgress",a),this._lastUpdateTime=c&&1>a?f:0);return c},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"viewingMode",{get:function(){var a=this.get("map.initialViewProperties.viewingMode");a||(a=this.spatialReference,a=!a||Na.isSpatialReferenceSupported(a,"global")?"global":"local");return a},set:function(a){this.ready?
Ca.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"resourceController",{get:function(){return this._resourceController},enumerable:!1,configurable:!0});Object.defineProperty(t.prototype,"performanceInfo",{get:function(){return new ua(this)},enumerable:!1,configurable:!0});t.prototype.on=function(b,c,
d,e){return(d=this.viewEvents.on(b,c,d,e))?d:a.prototype.on.call(this,b,c)};t.prototype.hasEventListener=function(b){return a.prototype.hasEventListener.call(this,b)||this.viewEvents.hasHandler(b)};t.prototype.toMap=function(a,b){if(!this.ready)return Ca.error("#toMap()","Scene view cannot be used before it is ready"),null;b=b?this._externalToInternalIntersectOptions(b):this._defaultToMapOptions;var c=u.isSome(b.graphics)&&(u.isSome(b.graphics.include)||u.isSome(b.graphics.exclude));a=z.isSupportedScreenPointEvent(a)?
z.createScreenPointFromSupportedEvent(this,a):a;var d=z.screenPointObjectToArray(a);b.enableDraped=b.include&&!b.include.has(Ga.TERRAIN_ID)||b.exclude&&b.exclude.has(Ga.TERRAIN_ID);var e=this.sceneIntersectionHelper;a=new La.Intersector(this.state.mode);a.options.selectionMode=!0;a.options.store=c?2:0;e.intersectIntersectorScreen(d,a,b);if(c){c=0;for(a=a.results.all;c<a.length;c++)if(d=a[c],e=d.toGraphic(this),u.isNone(e)||this._testGraphicUidFilter(b.graphics,e))return this._intersectResultToMapPoint(d);
return null}return this._intersectResultToMapPoint(a.results.min)};t.prototype.toScreen=function(a){if(!this.ready)return Ca.error("#toScreen()","Scene view cannot be used before it is ready"),null;var b=null==a.z&&ha.getElevationAtPoint(this.elevationProvider,a)||0;ja.pointToVector(a,Da,this.renderSpatialReference,b);return this.engineToScreen(Da)};t.prototype.pixelSizeAt=function(a){if(!this.ready)return Ca.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!a)return 0;
ja.pointToVector(a,Da,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(Da)};t.prototype.hitTest=function(a,b){if(!this.ready)return Ca.error("#hitTest()","Scene view cannot be used before it is ready"),null;a=z.isSupportedScreenPointEvent(a)?z.createScreenPointFromSupportedEvent(this,a):a;var c=z.createScreenPointArray(a.x,a.y),d=b?this._externalToInternalIntersectOptions(b):this._defaultHitTestOptions;d.requiresGroundFeedback=!0;d.enableDraped=!0;b=new La.Intersector(this.state.mode);
b.options.selectionMode=!0;b.options.store=2;this.sceneIntersectionHelper.intersectIntersectorScreen(c,b,d);var c=this._intersectResultsToHits(b.results.all,d.graphics),d=b.results.ground,e=d.toOwner(this),e=u.isSome(e)&&"type"in e&&"integrated-mesh"===e.type?e:null;a={screenPoint:a,results:c,ground:{mapPoint:this._intersectResultToMapPoint(d),distance:d.hasIntersectionPoint?d.distanceInRenderSpace:0,layer:e}};ga.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(a.intersector=b);return r.resolve(a)};t.prototype.popupHitTest=
function(a){return this.hitTest(a).then(function(b){for(var c=[],d=b.results.length?b.results[0].distance:0,e=0,f=b.results;e<f.length;e++){var g=f[e];if(g.distance!==d)break;c.push(g)}e=null;!(0===c.length||1E-5>Math.abs(d-b.ground.distance))||b.ground.layer&&"integrated-mesh"===b.ground.layer.type||(e=b.ground.mapPoint);return{results:c,screenPoint:a,mapPoint:e}})};t.prototype.goTo=function(a,b){return this.stateManager.goTo(a,b)};t.prototype.whenLayerView=function(b){return a.prototype.whenLayerView.call(this,
b)};t.prototype.takeScreenshot=function(a){var b=this;return this.whenReady().then(function(){var c=ra.toRenderSettings(a,b);c.pixelRatio/=b.pixelRatio;return b._stage.renderView.takeScreenshot(ra.screenshotSuperSampleSettings(c,b.supersampleScreenhotsEnabled,b.padding))})};t.prototype.importLayerView=function(a){return R.layerView3DImporter.importLayerView(a)};t.prototype.hasLayerViewModule=function(a){return R.layerView3DImporter.hasLayerViewModule(a)};t.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()};
t.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null};t.prototype.validate=function(){return d.__awaiter(this,void 0,void 0,function(){var a;return d.__generator(this,function(c){a=Ha.check();p("safari")&&9>p("safari")&&(a=new b("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",
{type:"safari",requiredVersion:9,detectedVersion:p("safari")}));if(u.isSome(a))throw Ca.warn("#validate()",a.message),a;return[2]})})};t.prototype.isSpatialReferenceSupported=function(a,b,c){var d=a.isGeographic,e=a.isWebMercator,f=Na.isSpatialReferenceSupported(a,"global"),g="local"===this.viewingMode,h=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(h){if(g&&d)return c&&c("Layer "+b.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!g&&
!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(d&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is geographic but unsupported"),!1;if(b)if(H.isTiledLayer(b)){if(d=void 0,h?h=aa.getTiledLayerInfo(b,a,this.state.mode):(h=aa.getTiledLayerInfo(b,a,1),null==h.tileInfo&&(h=aa.getTiledLayerInfo(b,a,2),null!=h.tileInfo&&e&&!this.ready&&(this.viewingMode="local"))),d=null!=h.tileInfo,!d)return c&&c("Layer "+
b.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((a.isWGS84||e)&&!g)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=a),h||this.ready||(this.viewingMode="global",c&&c("Viewing mode locked to global due to reprojectable layer "+b.id)),c&&c("Layer "+b.id+" is ignored because it supports server-side reprojection"),!1;return!0};t.prototype.whenReady=function(){var a=this;return r.create(function(b){a.ready?
b(a):a._resolveWhenReady.push(b)})};t.prototype.computeMapPointFromVec3d=function(a,b){var c=this.spatialReference||k.SpatialReference.WGS84;pa.vectorToVector(a,this.renderSpatialReference,a,c)||(c=k.SpatialReference.WGS84,pa.vectorToVector(a,this.renderSpatialReference,a,c));b?(b.x=a[0],b.y=a[1],b.z=a[2],b.spatialReference=c):b=new k.Point(a,c);return b};t.prototype.engineToScreen=function(a,b){var c=z.createRenderScreenPointArray3();this.state.camera.projectPoint(a,c);a=z.screenPointArrayToObject(c);
return z.renderToScreen(this,a,b)};t.prototype.flushDisplayModifications=function(){this._stage.processDirty()};t.prototype.trackGraphicState=function(a){if(!a.graphic)return Ca.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;var b=this.getViewForGraphic(a.graphic),c=null,d=!1,e=function(b){!d&&u.isSome(b)&&"graphics3d"in b&&b.graphics3d&&b.graphics3d.graphicsCore&&(c=b.graphics3d.graphicsCore.trackGraphicState(a))};u.isSome(b)?e(b):this.whenViewForGraphic(a.graphic,
{waitForLayer:!0}).then(function(a){return e(a)},function(){}).catch(function(){});return{remove:function(){d=!0;u.isSome(c)&&(c.remove(),c=null)}}};t.prototype.maskOccludee=function(a){if(!a)return Ca.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;var b=this.getViewForGraphic(a),c=null,d=!1,e=function(b){!d&&u.isSome(b)&&"graphics3d"in b&&y.occludeesSupported(b)&&(c=b.occlude(a))};u.isSome(b)?e(b):this.whenViewForGraphic(a,{waitForLayer:!0}).then(function(a){return e(a)},
function(){}).catch(function(){});return{remove:function(){d=!0;u.isSome(c)&&(c.remove(),c=null)}}};t.prototype.getViewForGraphic=function(a){return a.layer===this.graphics?this.graphicsView:a.layer?this.allLayerViews.find(function(b){return b.layer===a.layer}):null};t.prototype.graphicChanged=function(a){u.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(a)};t.prototype.whenViewForGraphic=function(a,c){return d.__awaiter(this,void 0,void 0,function(){var e=this;return d.__generator(this,
function(d){switch(d.label){case 0:return a.layer!==this?[3,2]:[4,v.whenOnce(this,"graphicsView")];case 1:return d.sent(),[2,this.graphicsView];case 2:if(!a.layer||!this.map)throw new b("no-view-for-graphic");return c&&c.waitForLayer&&!this.map.allLayers.includes(a.layer)?[2,r.create(function(b,c){var d=e.map.allLayers.on("change",function(f){-1!==f.added.indexOf(a.layer)&&(d.remove(),e.whenLayerView(a.layer).then(b,c))})})]:[2,this.whenLayerView(a.layer)]}})})};t.prototype._intersectResultToMapPoint=
function(a,b){if(a.getIntersectionPoint(Da)){b=this.computeMapPointFromVec3d(Da,b);var c=this.basemapTerrain;"TerrainRenderer"===a.intersector&&c&&(b.z=ha.getElevationAtPoint(c,b)||0);return b}return null};t.prototype._intersectResultsToHits=function(a,b){for(var c=[],d=null,e=0;e<a.length;e++){var f=a[e],g=f.toOwner(this);if(u.isSome(g)&&(g===this.map.ground||"type"in g&&"integrated-mesh"===g.type))break;g=f.toGraphic(this);if(u.isSome(g)){u.isNone(d)&&e!==a.length-1&&(d=new Set);if(u.isSome(d)){var h=
this._getGraphicFilterUid(g);if(d.has(h))continue;d.add(h)}this._testGraphicUidFilter(b,g)&&(h=this._intersectResultToMapPoint(f),c.push({graphic:g,mapPoint:h,distance:f.distanceInRenderSpace}))}}return c};t.prototype._getGraphicFilterUid=function(a){if(a.layer&&"objectIdField"in a.layer){var b=a.attributes[a.layer.objectIdField];if(b)return"o-"+a.layer.id+"-"+b}return"u-"+a.uid};t.prototype._testGraphicUidFilter=function(a,b){b=this._getGraphicFilterUid(b);return u.isNone(a)||(u.isNone(a.include)||
a.include.has(b))&&(u.isNone(a.exclude)||!a.exclude.has(b))};t.prototype._externalToInternalRenderItems=function(a,b,d){var f=this;void 0===d&&(d={layerUids:null,graphicUids:null});if(!a)return d;a instanceof e?(wa(d,this._getGraphicFilterUid(a)),0===b&&(u.isSome(this.graphicsView)&&a.layer===this?W(d,this.graphicsView.mockLayerId):a.layer&&W(d,a.layer.uid))):"forEach"in a?a.forEach(function(a){Array.isArray(a)?f._externalToInternalRenderItems(a,b,d):m.isCollection(a)?a===f.graphics&&u.isSome(f.graphicsView)?
W(d,f.graphicsView.mockLayerId):f._externalToInternalRenderItems(a,b,d):a instanceof c?a===f.map.ground&&W(d,Ga.TERRAIN_ID):f._externalToInternalRenderItems(a,b,d)}):W(d,a.uid);return d};t.prototype._externalToInternalIntersectOptions=function(a){var b=this._externalToInternalRenderItems(a.include,0);a=this._externalToInternalRenderItems(a.exclude,1);return{include:b.layerUids,exclude:a.layerUids,graphics:{include:b.graphicUids,exclude:a.graphicUids}}};t.prototype._viewingModeToManifold=function(a){switch(a){case "global":return"spherical";
case "local":return"planar"}};t.prototype._initBasemapTerrain=function(a){this._set("basemapTerrain",new qa({view:this,manifold:this._viewingModeToManifold(a)}));this._set("elevationProvider",new ba.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)};t.prototype._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),
this._set("basemapTerrain",null))};t.prototype._initGlobe=function(a){var b=this;this._initCoordinateSystem();this.state.init(a,this.spatialReference);this._initBasemapTerrain(a);this._set("pointsOfInterest",new ma.default({view:this}));this._set("featureTiles",new T.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler}));
a=function(){var a=b.basemapTerrain&&b.basemapTerrain.extent;b.clippingArea||a?a&&b.basemapTerrain.spatialReference?(a=E.toExtent(b.basemapTerrain.extent,b.basemapTerrain.spatialReference),b.featureTiles.filterExtent=b.clippingArea?a.intersection(b.clippingArea):a):b.featureTiles.filterExtent=b.clippingArea:b.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(ga,"FEATURE_TILE_TREE_SHOW_TILES",function(a){a&&b.featureTiles&&!b.featureTreeDebugger?b.updatingHandles.addPromise(new Promise(function(a,
b){n(["./3d/layers/support/FeatureTileTree3DDebugger"],a,b)})).then(function(a){a=a.FeatureTileTree3DDebugger;!b.featureTreeDebugger&&ga.FEATURE_TILE_TREE_SHOW_TILES&&(b.featureTreeDebugger=new a({view:b}))}):a||!b.featureTreeDebugger||ga.FEATURE_TILE_TREE_SHOW_TILES||(b.featureTreeDebugger.destroy(),b.featureTreeDebugger=null)},3),this.updatingHandles.add(this,"clippingArea",a,3),this.updatingHandles.add(this,"basemapTerrain.extent",a,3)],"feature-tiles");this.stateManager.init()};t.prototype._exitGlobe=
function(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())};t.prototype._initCoordinateSystem=function(){var a=this;if(this.spatialReference){var b=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(b)||
this._set("mapCoordsHelper",new ka.default(this.map,b));var c="global"===this.viewingMode,b=c?pa.SphericalECEFSpatialReference:b;b!==this.renderSpatialReference&&(this._set("renderCoordsHelper",za.RenderCoordsHelper.createMode(this.state.mode,b)),c||this.handles.add(this.watch("basemapTerrain.extent",function(b){if(0!==b[0]||0!==b[1]||0!==b[2]||0!==b[3])a.renderCoordsHelper.extent=b},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(La.Intersector.DEFAULT_TOLERANCE/
this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};t.prototype._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};t.prototype.updatingChanged=function(){this.notifyChange("updating")};t.prototype._updateUpdatingMonitors=function(){var a=this;this.handles.remove("updatingMonitors");this.allLayerViews.forEach(function(b){b.destroyed||
(a.handles.add([b.watch(["updating","updatingProgress"],function(){return a.updatingChanged()},!0)],"updatingMonitors"),b.when(function(){return a.updatingChanged()},function(){return a.updatingChanged()}))});this.updatingChanged()};t.prototype._renderScreenshotOverlay=function(a,b){if(this.overlay&&this.overlay.hasVisibleItems){var c=a.getContext("2d");c.putImageData(b,0,0);this.overlay.renderCanvas(a);a=c.getImageData(0,0,b.width,b.height);for(c=0;c<a.data.length;c++)b.data[c]=a.data[c]}};t.prototype._initStage=
function(){var a=this,c={renderContext:this.renderContext,deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,viewingMode:this.state.mode,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:function(b,c){return a._renderScreenshotOverlay(b,c)}}},d=new ca.SceneIntersectionHelper(this.state.mode,{forEachLayer:function(b){a._stage.getLayers().forEach(b)}},this);this._set("sceneIntersectionHelper",d);var e=f.byId(this.surface);
this._stage=new Ja.Stage({scheduler:this.resourceController.scheduler,viewingMode:this.state.mode,container:e,options:c,sceneIntersectionHelper:d});this._lostWebGLContextHandle=g.on(this._stage.renderView.getCanvas(),"webglcontextlost",function(){return a.fatalError=new b("webgl-context-lost")});this.handles.add(this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",function(){a._stage.renderView.setRenderParameters({antialiasingEnabled:a.qualitySettings.antialiasingEnabled})},2),"stage");
c=function(){a._stage.renderView.setRenderParameters({defaultHighlightOptions:fa.toEngineOptions(a.highlightOptions)})};d=0;for(e=["highlightOptions","highlightOptions.color","highlightOptions.haloColor","highlightOptions.haloOpacity","highlightOptions.fillOpacity"];d<e.length;d++)this.handles.add(this.updatingHandles.add(this,e[d],c),"stage");c();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(La.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",
this._stage.renderView.getCanvas())};t.prototype._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();this._stage=null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");this._set("canvas",null)};t.prototype._initSurface=function(){this._exitSurface();this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new oa.default({stage:this._stage,viewingMode:this.state.mode,resourceController:this._resourceController,
pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new V.ObjectResourceCache})};t.prototype._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};t.prototype._createGraphicsViewIfNeeded=function(){var a=this;if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");
this._createGraphicsViewController=r.createAbortController();var b=function(){a._createGraphicsViewController=null;a.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(b,b);this.updatingChanged()}};t.prototype._createGraphicsViewAsync=function(a){return d.__awaiter(this,void 0,void 0,function(){var b;return d.__generator(this,function(c){switch(c.label){case 0:return[4,new Promise(function(a,b){n(["./3d/layers/GraphicsView3D"],a,b)})];case 1:return b=
c.sent(),r.throwIfAborted(a),[4,v.whenTrueOnce(this.basemapTerrain,"ready",a)];case 2:return c.sent(),this._set("graphicsView",new b({view:this})),[2]}})})};t.prototype._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.handles.remove("graphics-view");u.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.mockLayerId),this.graphicsView.destroy(),this._set("graphicsView",null))};
t.prototype._startup=function(){var a=this;"global"===this.viewingMode&&(this._clippingArea=null);this._set("ready",!0);this._initSurface();this.handles.add(v.on(this,"graphics","after-changes",function(){return a._createGraphicsViewIfNeeded()}),"graphics-view");this._createGraphicsViewIfNeeded();if(!this._externallySet.environment){var b=this.get("map.initialViewProperties.environment");b&&(this.environment=b)}this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();
b=this._resolveWhenReady;this._resolveWhenReady=[];b.forEach(function(b){return b(a)})};t.prototype._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");this._exitSurface();this._set("ready",!1)};t.prototype._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(Ga.TERRAIN_ID);
for(var a=0,b=this.map.allLayers.items;a<b.length;a++){var c=b[a];"integrated-mesh"===c.type&&this._defaultToMapOptions.include.add(c.uid)}}};t.prototype._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(Ga.TERRAIN_ID);for(var a=0,b=this.map.allLayers.items;a<b.length;a++){var c=b[a];"integrated-mesh"===c.type&&1>c.opacity&&this._defaultToMapOptions.exclude.add(c.uid)}}};
d.__decorate([x.property()],t.prototype,"_resourceController",void 0);d.__decorate([x.property()],t.prototype,"_stage",void 0);d.__decorate([x.property({readOnly:!0})],t.prototype,"deconflictor",void 0);d.__decorate([x.property({readOnly:!0})],t.prototype,"labeler",void 0);d.__decorate([x.property({type:Q,readOnly:!0,aliasOf:"state.animation"})],t.prototype,"animation",void 0);d.__decorate([x.property({readOnly:!0})],t.prototype,"basemapTerrain",void 0);d.__decorate([x.property({readOnly:!0})],t.prototype,
"elevationProvider",void 0);d.__decorate([x.property({type:l,aliasOf:"stateManager.camera"})],t.prototype,"camera",void 0);d.__decorate([x.property({readOnly:!0})],t.prototype,"canvas",void 0);d.__decorate([x.property({type:k.Point,aliasOf:"stateManager.center"})],t.prototype,"center",void 0);d.__decorate([x.property({type:k.Extent,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],t.prototype,"clippingArea",null);d.__decorate([x.property({type:O.default})],t.prototype,"constraints",
void 0);d.__decorate([x.property({type:k.Extent,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],t.prototype,"dataExtent",null);d.__decorate([x.property({value:null,type:N})],t.prototype,"environment",null);d.__decorate([x.cast("environment")],t.prototype,"castEnvironment",null);d.__decorate([x.property({readOnly:!0})],t.prototype,"environmentManager",void 0);d.__decorate([x.property({type:k.Extent,aliasOf:"stateManager.extent"})],t.prototype,"extent",void 0);d.__decorate([x.property({readOnly:!0,
aliasOf:"stateManager.screenCenter"})],t.prototype,"screenCenter",void 0);d.__decorate([x.property({type:Number,dependsOn:["maximumPixelRatio"]})],t.prototype,"pixelRatio",null);d.__decorate([x.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],t.prototype,"maximumPixelRatio",null);d.__decorate([x.property({aliasOf:"stateManager.frustum"})],t.prototype,"frustum",void 0);d.__decorate([x.property({type:Number,readOnly:!0})],t.prototype,
"fullOpacity",void 0);d.__decorate([x.property({readOnly:!0})],t.prototype,"graphicsView",void 0);d.__decorate([x.property({type:k.Extent,dependsOn:["basemapTerrain.extent"],readOnly:!0})],t.prototype,"groundExtent",null);d.__decorate([x.property()],t.prototype,"groundView",void 0);d.__decorate([x.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],t.prototype,"initialExtentRequired",null);d.__decorate([x.property({type:Boolean,dependsOn:["navigating","activeTool"],readOnly:!0})],
t.prototype,"interacting",null);d.__decorate([x.property({dependsOn:["animation","resizing","state.stationary"]})],t.prototype,"stationary",null);d.__decorate([x.property({aliasOf:"state.navigating"})],t.prototype,"navigating",void 0);d.__decorate([x.property()],t.prototype,"map",void 0);d.__decorate([x.property({readOnly:!0})],t.prototype,"mapCoordsHelper",void 0);d.__decorate([x.property({aliasOf:"stateManager.padding"})],t.prototype,"padding",void 0);d.__decorate([x.property({type:ma.default,readOnly:!0})],
t.prototype,"pointsOfInterest",void 0);d.__decorate([x.property({type:T.default,readOnly:!0})],t.prototype,"featureTiles",void 0);d.__decorate([x.property()],t.prototype,"featureTreeDebugger",void 0);d.__decorate([x.property({type:Boolean})],t.prototype,"screenSizePerspectiveEnabled",void 0);d.__decorate([x.property({constructOnly:!0})],t.prototype,"deactivatedWebGLExtensions",void 0);d.__decorate([x.property({constructOnly:!0})],t.prototype,"debugWebGLExtensions",void 0);d.__decorate([x.property({constructOnly:!0})],
t.prototype,"renderCanvas",void 0);d.__decorate([x.property({constructOnly:!0})],t.prototype,"state",void 0);d.__decorate([x.property({readOnly:!0})],t.prototype,"inputManager",void 0);d.__decorate([x.property({readOnly:!0})],t.prototype,"stateManager",void 0);d.__decorate([x.property({type:["low","medium","high"]})],t.prototype,"qualityProfile",null);d.__decorate([x.property({type:va,get:function(){var a=this._get("qualitySettings");a||(a=new va,ia.apply(this.qualityProfile,a));return a}})],t.prototype,
"qualitySettings",void 0);d.__decorate([x.property()],t.prototype,"slicePlane",null);d.__decorate([x.property({dependsOn:["viewingMode"]})],t.prototype,"preconditionsReady",void 0);d.__decorate([x.property({readOnly:!0})],t.prototype,"renderCoordsHelper",void 0);d.__decorate([x.property({readOnly:!0})],t.prototype,"sceneIntersectionHelper",void 0);d.__decorate([x.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],t.prototype,"resolution",null);d.__decorate([x.property({type:Number,
aliasOf:"stateManager.scale"})],t.prototype,"scale",void 0);d.__decorate([x.property()],t.prototype,"heightModelInfo",null);d.__decorate([x.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],t.prototype,"spatialReference",void 0);d.__decorate([x.property({type:Boolean,constructOnly:!0})],t.prototype,"alphaCompositingEnabled",void 0);d.__decorate([x.property({type:Boolean})],t.prototype,"supersampleScreenhotsEnabled",void 0);d.__decorate([x.property({readOnly:!0})],
t.prototype,"type",void 0);d.__decorate([x.property({type:Xa})],t.prototype,"ui",void 0);d.__decorate([x.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating _resourceController.updating _stage.renderView.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs".split(" ")})],
t.prototype,"updating",null);d.__decorate([x.property({type:Number,readOnly:!0,dependsOn:["updating"]})],t.prototype,"updatingProgress",void 0);d.__decorate([x.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],t.prototype,"viewingMode",null);d.__decorate([x.property({type:h,aliasOf:"stateManager.viewpoint"})],t.prototype,"viewpoint",void 0);d.__decorate([x.property({type:Number,aliasOf:"stateManager.zoom"})],t.prototype,"zoom",void 0);d.__decorate([x.property({type:fa})],
t.prototype,"highlightOptions",void 0);return t=d.__decorate([x.subclass("esri.views.SceneView")],t)}(J.BreakpointsOwner(I.DOMContainer(L.PopupView(M))));var Da=A.vec3f64.create();return a});