// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../Viewpoint ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../geometry/Point ../viewpointUtils ./ZoomBox ./actions/Pan ./actions/Pinch ./actions/Rotate".split(" "),function(g,r,d,v,w,e,x,k,y,z,A,B){Object.defineProperty(r,"__esModule",{value:!0});var p=new v({targetGeometry:new x}),q=[0,0];g=function(g){function a(b){b=g.call(this,b)||this;b._endTimer=null;b.animationManager=null;return b}d.__extends(a,g);a.prototype.initialize=function(){this.pan=
new z({navigation:this});this.rotate=new B({navigation:this});this.pinch=new A({navigation:this});this.zoomBox=new y({view:this.view,navigation:this})};a.prototype.destroy=function(){this.zoomBox.destroy();this.animationManager=this.zoomBox=null};a.prototype.begin=function(){this._set("interacting",!0)};a.prototype.end=function(){this._lastEventTimestamp=performance.now();this._startTimer(250)};a.prototype.zoom=function(b,c){void 0===c&&(c=this._getDefaultAnchor());return d.__awaiter(this,void 0,
void 0,function(){return d.__generator(this,function(h){this.stop();this.begin();if(this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return 1>b?[2,this.zoomIn(c)]:[2,this.zoomOut(c)];this.setViewpoint(c,b,0,[0,0]);return[2]})})};a.prototype.zoomIn=function(b){return d.__awaiter(this,void 0,void 0,function(){var c,h;return d.__generator(this,function(a){c=this.view;h=c.constraints.snapToNextScale(c.scale);return[2,this._zoomToScale(h,b)]})})};a.prototype.zoomOut=function(b){return d.__awaiter(this,
void 0,void 0,function(){var c,a;return d.__generator(this,function(h){c=this.view;a=c.constraints.snapToPreviousScale(c.scale);return[2,this._zoomToScale(a,b)]})})};a.prototype.setViewpoint=function(b,c,a,f){this.begin();this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,b,c,a,f);this.end()};a.prototype.setViewpointImmediate=function(b,c,a,f){void 0===c&&(c=0);void 0===a&&(a=[0,0]);void 0===f&&(f=this._getDefaultAnchor());this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,
f,b,c,a)};a.prototype.continousRotateClockwise=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){k.rotateBy(a,a,-1)})};a.prototype.continousRotateCounterclockwise=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){k.rotateBy(a,a,1)})};a.prototype.resetRotation=function(){this.view.rotation=0};a.prototype.continousPanLeft=function(){this._continuousPan([-10,0])};a.prototype.continousPanRight=function(){this._continuousPan([10,
0])};a.prototype.continousPanUp=function(){this._continuousPan([0,10])};a.prototype.continousPanDown=function(){this._continuousPan([0,-10])};a.prototype.stop=function(){this.pan.stopMomentumNavigation();this.animationManager.stop();this.end();null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))};a.prototype._continuousPan=function(a){var c=this,b=this.get("view.viewpoint");this.animationManager.animateContinous(b,function(b){k.translateBy(b,b,a);c.view.constraints.constrainByGeometry(b)})};
a.prototype._startTimer=function(a){var b=this;return null!==this._endTimer?this._endTimer:this._endTimer=setTimeout(function(){b._endTimer=null;var a=performance.now()-b._lastEventTimestamp;250>a?b._endTimer=b._startTimer(a):b._set("interacting",!1)},a)};a.prototype._getDefaultAnchor=function(){var a=this.view,c=a.size,a=a.padding,h=a.top,d=a.bottom;q[0]=.5*(c[0]-a.right+a.left);q[1]=.5*(c[1]-d+h);return q};a.prototype._zoomToScale=function(a,c){void 0===c&&(c=this._getDefaultAnchor());return d.__awaiter(this,
void 0,void 0,function(){var b,f,e,t,g,u,l,m;return d.__generator(this,function(d){b=this.view;f=b.constraints;e=b.scale;t=b.viewpoint;g=b.size;u=b.padding;l=f.canZoomInTo(a);m=f.canZoomOutTo(a);if(a<e&&!l||a>e&&!m)return[2];k.padAndScaleAndRotateBy(p,t,a/e,0,c,g,u);f.constrainByGeometry(p);return[2,b.goTo(p,{animate:!0})]})})};a.prototype._scaleRotateTranslateViewpoint=function(a,c,d,e,g){var b=this.view,f=b.size,h=b.padding,l=b.constraints,m=b.viewpoint,n=b.scale*d,b=l.canZoomInTo(n),n=l.canZoomOutTo(n);
if(1>d&&!b||1<d&&!n)d=1;k.translateBy(m,m,g);k.padAndScaleAndRotateBy(a,m,d,e,c,f,h);return l.constrainByGeometry(a)};d.__decorate([e.property()],a.prototype,"animationManager",void 0);d.__decorate([e.property({type:Boolean,readOnly:!0})],a.prototype,"interacting",void 0);d.__decorate([e.property()],a.prototype,"pan",void 0);d.__decorate([e.property()],a.prototype,"pinch",void 0);d.__decorate([e.property()],a.prototype,"rotate",void 0);d.__decorate([e.property()],a.prototype,"view",void 0);d.__decorate([e.property()],
a.prototype,"zoomBox",void 0);return a=d.__decorate([e.subclass("esri.views.2d.navigation.MapViewNavigation")],a)}(w);r.default=g});