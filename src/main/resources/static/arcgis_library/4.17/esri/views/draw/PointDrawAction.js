// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Handles ../../core/maybe ../../core/screenUtils ../../core/accessorSupport/decorators ../3d/interactive/editingTools/draw/DrawTool ./DrawAction ./input/DrawEvents ./input/Keys ../input/InputManager ../input/recognizers/PointerClickHoldAndDrag".split(" "),function(l,d,h,n,e,m,k,p,q,f,r,g,t){Object.defineProperty(d,"__esModule",{value:!0});d.PointDrawAction=void 0;l=function(d){function b(a){a=d.call(this,a)||this;a._clickDelay=t.DefaultParameters.maximumClickDelay;
a._cursorMoved=!1;a._cursorScreenPoint=null;a._pointerDownEvent=null;a._viewHandles=new n;a.coordinates=[];a.view=null;return a}h.__extends(b,d);b.prototype.initialize=function(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)};b.prototype.destroy=function(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool();this.emit("destroy")};b.prototype.complete=function(){if("2d"===this.view.type){if(this._cursorScreenPoint){var a=this.getCoordsFromScreenPoint(this._cursorScreenPoint);
e.isSome(a)&&(this._set("coordinates",a),this._completeDrawing())}}else this._drawTool.completeCreateOperation()};b.prototype._addViewHandles=function(){var a=this;this._removeViewHandles();this._viewHandles.add([this.view.on("click",function(c){c.stopPropagation();var b=a.getCoordsFromScreenPoint(c.screenPoint);e.isSome(b)&&(a._set("coordinates",b),a._drawCompleteHandler(c))},g.ViewEventPriorities.TOOL),this.view.on("pointer-down",function(c){a._pointerDownEvent=c;a._cursorMoved=!1},g.ViewEventPriorities.TOOL),
this.view.on("pointer-move",function(c){a._cursorMoved=!0;a._cursorScreenPoint=m.createScreenPointFromEvent(c);a._cursorUpdateHandler(c)},g.ViewEventPriorities.TOOL),this.view.on("pointer-up",function(c){if(a._pointerDownEvent&&!a._cursorMoved&&c.timestamp-a._pointerDownEvent.timestamp>a._clickDelay){a._cursorScreenPoint=m.createScreenPointFromEvent(c);var b=a.getCoordsFromScreenPoint(a._cursorScreenPoint);e.isSome(b)&&(a._set("coordinates",b),a._drawCompleteHandler(c))}},g.ViewEventPriorities.TOOL),
this.view.on("key-down",function(c){if(c.key===r.KEYS.drawCompleteKey&&a._cursorScreenPoint){var b=a.getCoordsFromScreenPoint(a._cursorScreenPoint);e.isSome(b)&&(a._set("coordinates",b),a._drawCompleteHandler(c))}},g.ViewEventPriorities.TOOL)])};b.prototype._removeViewHandles=function(){this._viewHandles.removeAll()};b.prototype._addDrawTool=function(a){var b=this;this._drawTool=new p.DrawTool({view:a,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point"});this.view.toolViewManager.tools.push(this._drawTool);
this.view.activeTool=this._drawTool;this._drawTool.on("cursor-update",function(a){1===a.vertices.length&&b.emit("cursor-update",new f.CursorUpdateEvent(b.view,null,a.vertices[0].vertexIndex,b._drawTool.getVertexCoords()))});this._drawTool.on("complete",function(a){b.emit("draw-complete",new f.DrawCompleteEvent(null,b._drawTool.getVertexCoords()));b._removeDrawTool()})};b.prototype._removeDrawTool=function(){e.isSome(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),
this._drawTool=null)};b.prototype._updateCursor=function(a,b){e.isSome(a)?this.emit("cursor-update",new f.CursorUpdateEvent(this.view,b,0,[a])):this.emit("cursor-update",new f.CursorUpdateEvent(this.view,b,null,null))};b.prototype._completeDrawing=function(a){this._cursorMoved=!1;this._pointerDownEvent=null;a=new f.DrawCompleteEvent(a,[this.coordinates]);this.emit("draw-complete",a);a.defaultPrevented||this._removeViewHandles()};b.prototype._cursorUpdateHandler=function(a){this._updateCursor(this.getCoordsFromScreenPoint(this._cursorScreenPoint),
a.native)};b.prototype._drawCompleteHandler=function(a){this._completeDrawing(a.native)};h.__decorate([k.property({readOnly:!0})],b.prototype,"coordinates",void 0);h.__decorate([k.property()],b.prototype,"view",void 0);return b=h.__decorate([k.subclass("esri.views.draw.PointDrawAction")],b)}(q);d.PointDrawAction=l});