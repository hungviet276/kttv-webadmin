// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/clock ../../../../../core/Collection ../../../../../core/collectionUtils ../../../../../core/Handles ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/scheduling ../../../../../core/screenUtils ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../layers/Layer ../../../../../layers/buildingSublayers/BuildingComponentSublayer ../../manipulatorUtils ./sliceToolConfig ./sliceToolUtils ./sliceToolUtils ./images/heading-rotate-png ./images/tilt-rotate-png ../../editingTools/dragEventPipeline3D ../../../support/geometryUtils ../../../support/stack ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/Texture ../../../../interactive/dragEventPipeline ../../../../interactive/InteractiveToolBase ../../../../interactive/interactiveToolUtils".split(" "),
function(u,U,l,H,I,B,C,J,f,K,q,L,p,v,k,w,D,M,N,g,h,t,O,P,x,e,n,Q,E,y,R,z){function F(f,c,a,b){a=h.createShiftPlane(a,e.boundedPlane.normal(b),f.direction,e.plane.create());b=w.vec3f64.create();return e.plane.intersectRay(a,f,b)?{type:"shift",creatingPointerId:c,shiftPlane:a,depth:0,startPoint:b}:null}function A(f){return"mouse"!==f.pointerType||0===f.button}var G=J.getLogger("esri.views.3d.interactive.analysisTools.slice.SliceTool");u=function(u){function c(a){var b=u.call(this,a)||this;b.clock=H.default;
b.deferCreation=!0;b.cursor=null;b.layersMode="none";b.shiftManipulator=null;b.rotateHeadingManipulator=null;b.rotateTiltManipulator=null;b.resizeManipulators=null;b.disableEngineLayers=!1;b._handles=new C;b._viewHandles=new C;b._frameTask=null;b._prevPointerMoveTimeout=null;b._previewOutlineManipulator=null;b._previewOutlineMaterial=null;b._outlineManipulator=null;b._gridManipulator=null;b._gridMaterial=null;b._startPlane=e.boundedPlane.create();b._previewPlane=null;b._activeKeyModifiers={};b._lastCursorPosition=
q.createScreenPoint();b._baseOpacity=1;b._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}];b._intersector=new Q.Intersector(a.view.state.mode);b._intersector.options.store=0;return b}l.__extends(c,u);c.prototype.initialize=function(){var a=this;this.rotateHeadingTexture=new E(O.default,"slice-rotate-heading",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0});this.rotateTiltTexture=
new E(P.default,"slice-rotate-tilt",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0});this.view._stage&&(this.view._stage.add(4,this.rotateHeadingTexture),this.view._stage.add(4,this.rotateTiltTexture));var b=L.init(this,"state",function(b){"ready"!==b&&a.create();"sliced"===b&&a.complete()},!0);this._handles.add([b,this.view.state.watch("camera",function(){return a._onCameraChange()}),this.excludedLayers.on("before-add",function(b){var d=b.item;null!=d&&(d instanceof D||d instanceof M)?d instanceof
D&&h.isAlwaysDrapedLayer(d)?(G.error("excludedLayers","Layer '"+d.title+", id:"+d.id+"' of type '"+d.type+"' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead."),b.preventDefault()):a.excludedLayers.includes(d)&&b.preventDefault():(G.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),b.preventDefault())})]);var d=function(b){a.updateManipulatorsInteractive(b);b.grabbing||(f.isSome(a.plane)&&e.boundedPlane.copy(a.plane,
a._startPlane),a.inputState=null)};this.shiftManipulator=h.createShiftManipulator(this.view);this.manipulators.add(this.shiftManipulator);this.shiftManipulator.events.on("grab-changed",function(b){a._onShiftGrab(b);d(a.shiftManipulator)});this._handles.add(this._createShiftDragPipeline(this.shiftManipulator));this.rotateHeadingManipulator=h.createRotateManipulator(this.view,this.rotateHeadingTexture);this.manipulators.add(this.rotateHeadingManipulator);this.rotateHeadingManipulator.events.on("grab-changed",
function(b){a._onRotateHeadingGrab(b);d(a.rotateHeadingManipulator)});this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator));this.rotateTiltManipulator=h.createRotateManipulator(this.view,this.rotateTiltTexture);this.manipulators.add(this.rotateTiltManipulator);this.rotateTiltManipulator.events.on("grab-changed",function(b){a._onRotateTiltGrab(b);d(a.rotateTiltManipulator)});this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator));this.resizeManipulators=
this._resizeHandles.map(function(b,c){var m=h.createResizeManipulator(a.view,b);m.events.on("grab-changed",function(b){a._onResizeGrab(b,c);d(m)});a._handles.add(a._createResizeDragPipeline(m));return m});this.manipulators.addMany(this.resizeManipulators);var b=h.createOutlineManipulator(this.view),c=b.material;this._previewOutlineManipulator=b.manipulator;this._previewOutlineMaterial=c;this.manipulators.add(this._previewOutlineManipulator,2);this._outlineManipulator=h.createOutlineManipulator(this.view).manipulator;
this.manipulators.add(this._outlineManipulator,1);b=h.createGridManipulator(this.view);c=b.material;this._gridManipulator=b.manipulator;this._gridMaterial=c;this.manipulators.add(this._gridManipulator,2)};c.prototype.destroy=function(){this.view._stage&&(this.view._stage.remove(4,this.rotateHeadingTexture.id),this.view._stage.remove(4,this.rotateTiltTexture.id));this.detach();this._handles.destroy();this._handles=null;this._viewHandles.destroy();this._viewHandles=null;this._removeFrameTask();this._clearPointerMoveTimeout()};
Object.defineProperty(c.prototype,"state",{get:function(){var a=!!this.plane,b=!!this.inputState;return a?a&&b?"slicing":a&&!b?"sliced":"ready":"ready"},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"isSupported",{get:function(){return"3d"===this.get("view.type")},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"plane",{set:function(a){this.view?f.isSome(a)&&!this.tiltEnabled?this.internalSetPlane(h.forceHorizontalOrVertical(a,this.view.renderCoordsHelper,e.boundedPlane.create())):
this.internalSetPlane(a):this._set("plane",a)},enumerable:!1,configurable:!0});c.prototype.internalSetPlane=function(a){this._set("plane",a);this.planeChanged()};c.prototype.planeChanged=function(){this.view&&(this._updateLayerViews(),this.visible&&this.attached&&(this.view.slicePlane=this.plane,this._updateManipulators()))};Object.defineProperty(c.prototype,"excludedLayers",{get:function(){return this._get("excludedLayers")||new I},set:function(a){this._set("excludedLayers",B.referenceSetter(a,this._get("excludedLayers")))},
enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"excludeGroundSurface",{set:function(a){this._set("excludeGroundSurface",a);this.view&&this._updateLayerViews()},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"tiltEnabled",{set:function(a){a!==this._get("tiltEnabled")&&(this._set("tiltEnabled",a),this.view&&(this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),f.isSome(this.plane)&&!a&&(this.plane=e.boundedPlane.copy(this.plane)),this._updateManipulators()))},
enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"inputState",{get:function(){return this._get("inputState")},set:function(a){this._set("inputState",a);this._updateMaterials()},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"_isTargeting",{get:function(){return!this.inputState&&!this.plane&&this.active},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"_creatingPointerId",{get:function(){return this.inputState&&"shift"===this.inputState.type?this.inputState.creatingPointerId:
null},enumerable:!1,configurable:!0});c.prototype.enterExcludeLayerMode=function(){this.created&&(this._set("layersMode","exclude"),z.setActive(this,!0))};c.prototype.exitExcludeLayerMode=function(){this.created&&(this._set("layersMode","none"),z.setActive(this,!1))};c.prototype.deactivate=function(){this._updateMouseCursor();this._set("layersMode","none");this._updatePreviewPlane(null)};c.prototype.onDetach=function(){this.plane=null;this._set("layersMode","none")};c.prototype.onShow=function(){var a=
this;this._updateMouseCursor();this._updateLayerViews();this._updateManipulators();var b=this.view;b.slicePlane=this.plane;0===this._viewHandles.size&&this._viewHandles.add([b.allLayerViews.on("change",function(){return a._updateLayerViews()}),this.excludedLayers.on("change",function(){return a._updateLayerViews()})])};c.prototype.onHide=function(){this._updateMouseCursor();this._updateLayerViews();this.view.slicePlane=null;this._viewHandles.removeAll();this._clearPointerMoveTimeout()};c.prototype.onInputEvent=
function(a){switch(a.type){case "pointer-down":if(!A(a))break;this._onPointerDown(a)&&(a.stopPropagation(),this._updateMouseCursor());break;case "pointer-drag":if(!A(a))break;this._onPointerDrag(a)&&a.stopPropagation();break;case "pointer-move":this._onPointerMove(a);this._updateMouseCursor();break;case "pointer-up":this._onPointerUp(a)&&a.stopPropagation();break;case "click":if(!A(a))break;this._onClick(a)&&a.stopPropagation();break;case "drag":this.inputState&&a.stopPropagation();break;case "key-down":this._onKeyDown(a)&&
a.stopPropagation();break;case "key-up":this._onKeyUp(a)&&a.stopPropagation()}};c.prototype._updateLayerViews=function(){var a=!(!this.plane||!this.visible),b=[],d=function(a){"layers"in a?a.layers.forEach(d):b.push(a)};this.excludedLayers.forEach(d);this.view.allLayerViews.forEach(function(d){"slicePlaneEnabled"in d&&(d.slicePlaneEnabled=a&&0>b.indexOf(d.layer));"sublayerViews"in d&&d.sublayerViews.forEach(function(d){d.slicePlaneEnabled=a&&0>b.indexOf(d.sublayer)})});this.view.basemapTerrain.slicePlaneEnabled=
a&&!this.excludeGroundSurface};c.prototype._onPointerDown=function(a){if("exclude"===this.layersMode)return!0;if(this._isTargeting){var b=q.createScreenPointFromEvent(a),d=e.boundedPlane.create();if(this._pickPlane(b,!1,this._activeKeyModifiers,d))return e.boundedPlane.copy(d,this._startPlane),b=this._calculatePickRay(b),this.inputState=F(b,a.pointerId,d.origin,d),this.internalSetPlane(d),!0}return!1};c.prototype._onPointerDrag=function(a){return a.pointerId===this._creatingPointerId?(a=q.createScreenPointFromEvent(a),
this.shiftManipulator.events.emit("drag",{action:"start",start:a,screenPoint:a}),!0):!1};c.prototype._onPointerMove=function(a){this._lastCursorPosition.x=a.x;this._lastCursorPosition.y=a.y;this._resetPointerMoveTimeout();"touch"!==a.pointerType&&this._updatePreviewPlane(q.createScreenPointFromEvent(a),this._activeKeyModifiers)};c.prototype._onCameraChange=function(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers);this._updateManipulators()};c.prototype._onPointerUp=function(a){return a.pointerId===
this._creatingPointerId&&f.isSome(this.plane)?(e.boundedPlane.copy(this.plane,this._startPlane),this.inputState=null,!0):!1};c.prototype._onClick=function(a){var b=this;if("exclude"!==this.layersMode||!this.created)return!1;this.view.hitTest(q.createScreenPointFromEvent(a)).then(function(a){a.results.length?(a=(a=a.results[0])&&a.graphic)&&(a=a.sourceLayer||a.layer)&&b.excludedLayers.push(a):a.ground.layer?b.excludedLayers.push(a.ground.layer):b.excludeGroundSurface=!0});this._set("layersMode","none");
z.setActive(this,!1);return!0};c.prototype._onKeyDown=function(a){return a.key===g.forceVerticalModifier||a.key===g.forceHorizontalModifier?(this._activeKeyModifiers[a.key]=!0,f.isSome(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0):!1};c.prototype._onKeyUp=function(a){return a.key!==g.forceVerticalModifier&&a.key!==g.forceHorizontalModifier||!this._activeKeyModifiers[a.key]?!1:(delete this._activeKeyModifiers[a.key],f.isSome(this._previewPlane)&&
this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)};c.prototype._onShiftGrab=function(a){"start"!==a.action||f.isNone(this.plane)||(a=this._calculatePickRay(a.screenPoint),e.boundedPlane.copy(this.plane,this._startPlane),this.inputState=F(a,null,this.shiftManipulator.renderLocation,this.plane))};c.prototype._createShiftDragPipeline=function(a){var b=this;return y.createManipulatorDragEventPipeline(a,function(a,c){(a=b.inputState)&&"shift"===a.type&&c.next(x.screenToRenderPlane(b.view,
a.shiftPlane)).next(b._shiftDragAdjustSensitivity(a)).next(b._shiftDragUpdatePlane(a))})};c.prototype._shiftDragAdjustSensitivity=function(a){var b=this;return function(d){if(f.isNone(b.plane))return null;var c=Math.min((1-Math.abs(k.vec3.dot(e.boundedPlane.normal(b.plane),d.ray.direction)/k.vec3.length(d.ray.direction)))/.001,1),r=-e.plane.signedDistance(b._startPlane.plane,d.renderEnd),h=-e.plane.signedDistance(b._startPlane.plane,a.startPoint);a.depth=a.depth*(1-c)+r*c-h;return d}};c.prototype._shiftDragUpdatePlane=
function(a){var b=this;return function(){if(!f.isNone(b.plane)){var d=k.vec3.copy(n.sv3d.get(),b._startPlane.origin),c=k.vec3.copy(n.sv3d.get(),e.boundedPlane.normal(b._startPlane));k.vec3.scale(c,c,-a.depth);k.vec3.add(c,c,d);e.boundedPlane.fromValues(c,b.plane.basis1,b.plane.basis2,b.plane);b.planeChanged();b.notifyChange("plane")}}};c.prototype._onRotateHeadingGrab=function(a){if("start"===a.action&&!f.isNone(this.plane)){var b=h.createRotatePlane(this.plane,this.view.renderCoordsHelper,1,e.plane.create());
a=this._calculatePickRay(a.screenPoint);var d=w.vec3f64.create();e.plane.intersectRay(b,a,d)&&(e.boundedPlane.copy(this.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:b,startPoint:d})}};c.prototype._createRotateHeadingDragPipeline=function(a){var b=this;return y.createManipulatorDragEventPipeline(a,function(a,c){(a=b.inputState)&&"rotate"===a.type&&c.next(x.screenToRenderPlane(b.view,a.rotatePlane)).next(b._rotateDragRenderPlaneToRotate(a)).next(b._rotateDragUpdatePlaneFromRotate())})};
c.prototype._onRotateTiltGrab=function(a){if("start"===a.action&&!f.isNone(this.plane)){var b=h.createRotatePlane(this.plane,this.view.renderCoordsHelper,2,e.plane.create());a=this._calculatePickRay(a.screenPoint);var c=w.vec3f64.create();e.plane.intersectRay(b,a,c)&&(e.boundedPlane.copy(this.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:b,startPoint:c})}};c.prototype._createRotateTiltDragPipeline=function(a){var b=this;return y.createManipulatorDragEventPipeline(a,function(a,
c){(a=b.inputState)&&"rotate"===a.type&&c.next(x.screenToRenderPlane(b.view,a.rotatePlane)).next(b._rotateDragRenderPlaneToRotate(a)).next(b._rotateDragUpdatePlaneFromRotate())})};c.prototype._rotateDragRenderPlaneToRotate=function(a){var b=this;return function(c){if(f.isNone(b.plane))return null;var d=e.plane.normal(a.rotatePlane),r=N.calculateInputRotationTransform(b.inputState.startPoint,c.renderEnd,b.plane.origin,d);return l.__assign(l.__assign({},c),{rotateAxis:d,rotateAngle:r})}};c.prototype._rotateDragUpdatePlaneFromRotate=
function(){var a=this;return function(b){if(!f.isNone(a.plane)){var c=v.mat4.identity(n.sm4d.get());v.mat4.rotate(c,c,b.rotateAngle,b.rotateAxis);b=k.vec3.transformMat4(n.sv3d.get(),a._startPlane.basis1,c);c=k.vec3.transformMat4(n.sv3d.get(),a._startPlane.basis2,c);e.boundedPlane.fromValues(a.plane.origin,b,c,a.plane);a.planeChanged();a.notifyChange("plane")}}};c.prototype._onResizeGrab=function(a,b){if("start"===a.action&&!f.isNone(this.plane)){a=this._calculatePickRay(a.screenPoint);var c=n.sv3d.get();
e.plane.intersectRay(this.plane.plane,a,c)&&(e.boundedPlane.copy(this.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:b,startPoint:w.vec3f64.clone(c)})}};c.prototype._createResizeDragPipeline=function(a){var b=this;return y.createManipulatorDragEventPipeline(a,function(a,c){(a=b.inputState)&&"resize"===a.type&&!f.isNone(b.plane)&&c.next(x.screenToRenderPlane(b.view,b.plane.plane)).next(b._resizeDragUpdatePlane(a))})};c.prototype._resizeDragUpdatePlane=function(a){var b=this;
return function(c){f.isNone(b.plane)||(h.resizePlane(b._resizeHandles[a.activeHandleIdx],b.inputState.startPoint,c.renderEnd,b.view._stage.getCamera(),b._startPlane,b.plane),b.planeChanged(),b.notifyChange("plane"))}};c.prototype._updatePreviewPlane=function(a,b){var c=this;void 0===b&&(b={});var m=this._previewPlane;this._previewPlane=null;if(f.isNone(a))this._removeFrameTask(),this._updateManipulators();else{if(!this.plane&&this.active){var r=f.isSome(m)?m:e.boundedPlane.create(),m=f.isSome(m)?
e.boundedPlane.copy(m,S):null;this._pickPlane(a,!0,b,r)&&(a=g.PREVIEW_FADE_DOT_THRESHOLD,b=!1,f.isSome(m)&&(b=k.vec3.dot(m.plane,r.plane)<a||k.vec3.dot(k.vec3.normalize(n.sv3d.get(),m.basis1),k.vec3.normalize(n.sv3d.get(),r.basis1))<a),b&&(this._baseOpacity=0),this._previewPlane=r)}f.isSome(this._previewPlane)&&f.isNone(this._frameTask)&&0===this._baseOpacity?this._frameTask=K.addFrameTask({update:function(a){c._baseOpacity=Math.min(c._baseOpacity+a.deltaTime/(1E3*g.PREVIEW_FADE_DURATION_SECONDS),
1);c._updateManipulators();1===c._baseOpacity&&c._removeFrameTask()}}):f.isNone(this._previewPlane)&&f.isSome(this._frameTask)?this._removeFrameTask():f.isSome(this._previewPlane)&&this._updateManipulators()}};c.prototype._removeFrameTask=function(){f.isSome(this._frameTask)&&(this._frameTask.remove(),this._frameTask=null)};c.prototype._calculatePickRay=function(a){var b=e.ray.create();a=q.screenPointObjectToArray(a,T);e.ray.fromScreen(this.view.state.camera,a,b);k.vec3.normalize(b.direction,b.direction);
return b};c.prototype._pickMinResult=function(a){a=q.screenPointObjectToArray(a,n.sv2d.get());this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(a,this._intersector);return this._intersector.results.min};c.prototype._pickPlane=function(a,b,c,f){var d=this._pickMinResult(a);a=n.sv3d.get();if(!d.getIntersectionPoint(a))return!1;var d=d.getTransformedNormal(n.sv3d.get()),e=this.view._stage.getCamera();0<k.vec3.dot(d,e.viewForward)&&k.vec3.scale(d,d,-1);var m=h.calculatePlaneHalfSize(a,
e);b=(b?1:-1)*m*g.INITIAL_DEPTH_OFFSET_FRAC;b=k.vec3.scale(n.sv3d.get(),d,b);k.vec3.add(b,b,a);a=this.tiltEnabled?3:0;h.createPlane(b,d,m,m,e,c[g.forceVerticalModifier]?2:c[g.forceHorizontalModifier]?1:a,this.view.renderCoordsHelper,f);return!0};c.prototype._updateMouseCursor=function(){this._set("cursor",null);this._isTargeting||"exclude"===this.layersMode?this._set("cursor","crosshair"):f.isSome(this._creatingPointerId)&&this._set("cursor","grabbing")};c.prototype._clearPointerMoveTimeout=function(){this._prevPointerMoveTimeout&&
(this._prevPointerMoveTimeout.remove(),this._prevPointerMoveTimeout=null)};c.prototype._resetPointerMoveTimeout=function(){var a=this;this._clearPointerMoveTimeout();this.shiftManipulator.state|=t.DidPointerMoveRecentlyFlag;this.rotateHeadingManipulator.state|=t.DidPointerMoveRecentlyFlag;this.rotateTiltManipulator.state|=t.DidPointerMoveRecentlyFlag;this._prevPointerMoveTimeout=this.clock.setTimeout(function(){a.shiftManipulator.state&=~t.DidPointerMoveRecentlyFlag;a.rotateHeadingManipulator.state&=
~t.DidPointerMoveRecentlyFlag;a.rotateTiltManipulator.state&=~t.DidPointerMoveRecentlyFlag},g.POINTER_MOVE_TIMER_MS)};c.prototype._updateManipulators=function(){var a=this;if(!this.disableEngineLayers){var b=f.isSome(this.plane)?this.plane:f.isSome(this._previewPlane)?this._previewPlane:null,c=f.isSome(b)&&b===this.plane,e=f.isSome(b)&&b===this._previewPlane,g=f.isSome(b)?h.calculateBoundedPlaneTranslateRotate(b,n.sm4d.get()):null;this.shiftManipulator.available=c;this.rotateHeadingManipulator.available=
c;this.rotateTiltManipulator.available=c&&this.tiltEnabled;this.resizeManipulators.forEach(function(a){a.available=c});c&&(h.updateShiftRestartHandle(this.shiftManipulator,g,b,this.view._stage.getCamera()),h.updateRotateHeadingHandle(this.rotateHeadingManipulator,g,b,this.view.renderCoordsHelper),h.updateRotateTiltHandle(this.rotateTiltManipulator,g,b),this.resizeManipulators.forEach(function(c,d){h.updateResizeHandle(c,a._resizeHandles[d],g,b)}));this._previewOutlineManipulator.available=e;this._outlineManipulator.available=
c;this._gridManipulator.available=f.isSome(b);if(f.isSome(b)){e=k.vec3.set(n.sv3d.get(),k.vec3.length(b.basis1),k.vec3.length(b.basis2),1);e=v.mat4.fromScaling(n.sm4d.get(),e);e=v.mat4.multiply(e,g,e);e[12]=0;e[13]=0;e[14]=0;var l=k.vec3.set(n.sv3d.get(),g[12],g[13],g[14]);this._previewOutlineManipulator.modelTransform=e;this._previewOutlineManipulator.renderLocation=l;this._outlineManipulator.modelTransform=e;this._outlineManipulator.renderLocation=l;this._gridManipulator.modelTransform=e;this._gridManipulator.renderLocation=
l;this._updateMaterials()}}};c.prototype._updateMaterials=function(){this._previewOutlineMaterial.setParameterValues({color:[g.PLANE_OUTLINE_COLOR[0],g.PLANE_OUTLINE_COLOR[1],g.PLANE_OUTLINE_COLOR[2],g.PLANE_OUTLINE_COLOR[3]*this._baseOpacity]});this._gridMaterial.setParameterValues({backgroundColor:[g.PLANE_BACKGROUND_COLOR[0],g.PLANE_BACKGROUND_COLOR[1],g.PLANE_BACKGROUND_COLOR[2],g.PLANE_BACKGROUND_COLOR[3]*this._baseOpacity],gridColor:this.inputState&&"resize"===this.inputState.type?g.GRID_COLOR:
[0,0,0,0]})};c.prototype.updateManipulatorsInteractive=function(a){a.grabbing?(this.shiftManipulator.interactive=this.shiftManipulator===a,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===a,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===a,this.resizeManipulators.forEach(function(b){b.interactive=b===a})):(this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,this.resizeManipulators.forEach(function(a){a.interactive=
!0}))};l.__decorate([p.property()],c.prototype,"clock",void 0);l.__decorate([p.property({constructOnly:!0})],c.prototype,"view",void 0);l.__decorate([p.property({dependsOn:["plane","inputState"],readOnly:!0})],c.prototype,"state",null);l.__decorate([p.property({dependsOn:["view.type"],readOnly:!0})],c.prototype,"isSupported",null);l.__decorate([p.property({readOnly:!0})],c.prototype,"cursor",void 0);l.__decorate([p.property({value:null})],c.prototype,"plane",null);l.__decorate([p.property({readOnly:!0})],
c.prototype,"layersMode",void 0);l.__decorate([p.property({cast:B.castForReferenceSetter})],c.prototype,"excludedLayers",null);l.__decorate([p.property({type:Boolean,value:!1})],c.prototype,"excludeGroundSurface",null);l.__decorate([p.property({type:Boolean,value:!1})],c.prototype,"tiltEnabled",null);l.__decorate([p.property({value:null})],c.prototype,"inputState",null);return c=l.__decorate([p.subclass("esri.views.3d.interactive.analysisTools.slice.SliceTool")],c)}(R.InteractiveToolBase);var S=e.boundedPlane.create(),
T=q.createScreenPointArray();return u});