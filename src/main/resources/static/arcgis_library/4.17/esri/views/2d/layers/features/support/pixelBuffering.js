// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/promiseUtils ../../../../../core/screenUtils ../../../../../symbols/cim/CIMSymbolHelper ../../../../../symbols/cim/Rect ../../../engine/webgl/definitions ../../graphics/graphicsUtils".split(" "),function(M,e,c,D,E,F,G,H,I){function J(a){if(!("visualVariables"in a&&a.hasVisualVariables("size")))return 0;a=a.getVisualVariablesForType("size");if(!a[0])return 0;a=a[0];if("stops"===a.transformationType)return a.stops.map(function(a){return a.size}).reduce(m,
0);if("clamped-linear"===a.transformationType)return"number"===typeof a.maxSize?a.maxSize:a.maxSize.stops.map(function(a){return a.size}).reduce(m,0);if("real-world-size"===a.transformationType)return 30}function d(a,b){return null==a?b:a}function u(a,b){return c.__awaiter(this,void 0,void 0,function(){var v,f,w,k,g,l,x,n,y,e,q,m,p,z;return c.__generator(this,function(r){switch(r.label){case 0:if("simple-marker"===a.type)return v=Math.max(d(a.size,12),b),[2,A(a)+.707*v];if("picture-marker"===a.type)return f=
Math.max(d(a.height,12),b),w=d(a.width,12)*(f/d(a.height,12)),k=w/2,g=f/2,[2,A(a)+Math.sqrt(k*k+g*g)];if("text"===a.type){if(r=a.text&&a.text.length){for(var B=[],t=0;t<r;t++)B.push(c.__assign(c.__assign({},C),{code:a.text.charCodeAt(t)}));l={glyphMosaicItems:B}}else l={glyphMosaicItems:[C]};I.getTextSymbolSize(h,a.toJSON(),l);x=Math.abs(h[0]);n=Math.abs(h[1]);y=h[2];e=h[3];return[2,Math.max(x,n)+Math.max(y,e)]}if("simple-line"===a.type)return q=a,m=Math.max(d(q.width,.75),b)/2,q.marker?[2,Math.max(6*
q.width,2*b)]:[2,m];if("simple-fill"===a.type||"picture-fill"===a.type)return[2,Math.max(null==a.outline?0:d(a.outline.width,0),b)/2];if("cim"===a.type)return(p=F.CIMSymbolHelper.getEnvelope(a.data))?[2,Math.sqrt(p.width*p.width+p.height*p.height)]:[2,0];if("web-style"!==a.type)return[3,2];z=u;return[4,a.fetchCIMSymbol()];case 1:return[2,z.apply(void 0,[r.sent(),b])];case 2:return[2,0]}})})}function K(a,b){return c.__awaiter(this,void 0,void 0,function(){var d,f;return c.__generator(this,function(c){switch(c.label){case 0:if(!(a.type in
L))return[2,0];f=(d=Math).min;return[4,u(a,b)];case 1:return[2,f.apply(d,[c.sent(),75])]}})})}function A(a){var b=d(a.xoffset,0);a=d(a.yoffset,0);return Math.sqrt(b*b+a*a)}function m(a,b){return Math.max(a,b)}Object.defineProperty(e,"__esModule",{value:!0});e.computePxBuffer=void 0;var L={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1};e.computePxBuffer=function(a,b,d){return c.__awaiter(this,void 0,void 0,function(){var f,e,k,g,l,
h,n;return c.__generator(this,function(c){switch(c.label){case 0:if(!a||d&&"cluster"===d.type)return[2,0];if("heatmap"===a.type)return[2,Math.round(3*a.blurRadius)];if("dot-density"===a.type)return[2,0];if("dictionary"===a.type)return"esriGeometryPoint"===b||"esriGeometryMultipoint"===b?[2,100]:[2,200];f=a.getSymbols();e=J(a);k=[];g=0;for(l=f;g<l.length;g++)h=l[g],k.push(K(h,e));return[4,D.all(k)];case 1:return n=c.sent(),[2,E.pt2px(n.reduce(m,0))]}})})};var h=[0,0,0,0],C={sdf:!0,code:99,metrics:H.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,
rect:new G.default(0,0,24,24),page:0,textureBinding:2}});