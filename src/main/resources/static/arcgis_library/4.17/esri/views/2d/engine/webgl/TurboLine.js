// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","./mesh/templates/util"],function(n,g,y){function w(){if(b.cosine<d.innerBisectorAutoSplitThreshold){b.splitInner=!0;b.gapInner=!0;var c=Math.max(d.innerBisectorAutoSplitThreshold,b.cosine),c=Math.sqrt(1-c*c)/c;b.leftInner.x=b.nextNormal.x+b.sign*c*b.outbound.x;b.leftInner.y=b.nextNormal.y+b.sign*c*b.outbound.y;b.rightInner.x=b.prevNormal.x-b.sign*c*b.inbound.x;b.rightInner.y=b.prevNormal.y-b.sign*c*b.inbound.y}else d.enableInnerBisectorSplit&&(b.splitInner=!0,b.gapInner=
!1,b.leftInner.x=b.rightInner.x=b.bisector.x/b.cosine,b.leftInner.y=b.rightInner.y=b.bisector.y/b.cosine);b.cosine<d.outerBisectorAutoSplitThreshold?(b.splitOuter=!0,b.gapOuter=!0,c=Math.max(d.outerBisectorAutoSplitThreshold,b.cosine),c=Math.sqrt(1-c*c)/c,b.leftOuter.x=b.prevNormal.x-b.sign*c*b.inbound.x,b.leftOuter.y=b.prevNormal.y-b.sign*c*b.inbound.y,b.rightOuter.x=b.nextNormal.x+b.sign*c*b.outbound.x,b.rightOuter.y=b.nextNormal.y+b.sign*c*b.outbound.y):d.enableOuterBisectorSplit&&(b.splitOuter=
!0,b.gapOuter=!1,b.leftOuter.x=b.rightOuter.x=b.bisector.x/b.cosine,b.leftOuter.y=b.rightOuter.y=b.bisector.y/b.cosine)}function p(){if(r)b.distance=0,r=b.isCap=b.isFirstVertex=b.isLastVertex=!1;else{if(0===h)if(b.isFirstVertex=0===f,k=e[f],0===f){if(h=0,b.closed){b.inbound.x=k.x-e[e.length-2].x;b.inbound.y=k.y-e[e.length-2].y;var c=Math.sqrt(b.inbound.x*b.inbound.x+b.inbound.y*b.inbound.y);b.inbound.x/=c;b.inbound.y/=c}}else b.inbound.x=k.x-q.x,b.inbound.y=k.y-q.y,h=Math.sqrt(b.inbound.x*b.inbound.x+
b.inbound.y*b.inbound.y),b.inbound.x/=h,b.inbound.y/=h;b.distance+h-m<=d.wrapDistance?(f<e.length-1?(b.outbound.x=e[f+1].x-k.x,b.outbound.y=e[f+1].y-k.y,c=Math.sqrt(b.outbound.x*b.outbound.x+b.outbound.y*b.outbound.y),b.outbound.x/=c,b.outbound.y/=c):b.closed?(b.outbound.x=e[1].x-k.x,b.outbound.y=e[1].y-k.y,c=Math.sqrt(b.outbound.x*b.outbound.x+b.outbound.y*b.outbound.y),b.outbound.x/=c,b.outbound.y/=c):(b.outbound.x=b.inbound.x,b.outbound.y=b.inbound.y),0!==f||b.closed||(b.inbound.x=b.outbound.x,
b.inbound.y=b.outbound.y),++f,b.isLastVertex=f===e.length,b.isCap=!b.closed&&(b.isFirstVertex||b.isLastVertex),b.distance+=h-m,m=h=0,r=b.distance+h-m===d.wrapDistance,b.currentVertex.x=k.x,b.currentVertex.y=k.y,q=k,k=null):(b.outbound.x=b.inbound.x,b.outbound.y=b.inbound.y,m+=d.wrapDistance-b.distance,b.distance=d.wrapDistance,r=!0,c=m/h,b.currentVertex.x=(1-c)*q.x+c*k.x,b.currentVertex.y=(1-c)*q.y+c*k.y)}}function v(){b.prevNormal.x=-b.inbound.y;b.prevNormal.y=b.inbound.x;b.nextNormal.x=-b.outbound.y;
b.nextNormal.y=b.outbound.x}function t(){v();b.bisector.x=b.prevNormal.x+b.nextNormal.x;b.bisector.y=b.prevNormal.y+b.nextNormal.y;var c=Math.sqrt(b.bisector.x*b.bisector.x+b.bisector.y*b.bisector.y);.001>c?(b.bisector.x=void 0,b.bisector.y=void 0,b.cosine=0,b.sign=void 0):(b.bisector.x/=c,b.bisector.y/=c,b.cosine=b.bisector.x*b.nextNormal.x+b.bisector.y*b.nextNormal.y,b.sign=0<=b.prevNormal.x*b.nextNormal.y-b.prevNormal.y*b.nextNormal.x?1:-1)}function u(c){l.vertex(b);1===c?(b.leftEntry0=b.entry0,
b.leftEntry1=b.entry1,b.leftEntry2=b.entry2,b.leftExit0=b.exit0,b.leftExit1=b.exit1,b.leftExit2=b.exit2):2===c&&(b.rightEntry0=b.entry0,b.rightEntry1=b.entry1,b.rightEntry2=b.entry2,b.rightExit0=b.exit0,b.rightExit1=b.exit1,b.rightExit2=b.exit2)}function x(c){l.vertex(b);1===c?(b.leftEntry0=b.entry0,b.leftEntry2=b.entry2,b.leftExit0=b.exit0,b.leftExit2=b.exit2):2===c&&(b.rightEntry0=b.entry0,b.rightEntry2=b.entry2,b.rightExit0=b.exit0,b.rightExit2=b.exit2)}Object.defineProperty(g,"__esModule",{value:!0});
g.ThinTessellationCallbacks=g.StandardTessellationCallbacks=g.splitVertex=g.cleanup=g.tessellate=g.TessellationState=void 0;n=function(){return function(){this.isCap=this.isLastVertex=this.isFirstVertex=this.closed=void 0;this.currentVertex={x:void 0,y:void 0};this.inbound={x:void 0,y:void 0};this.outbound={x:void 0,y:void 0};this.prevNormal={x:void 0,y:void 0};this.nextNormal={x:void 0,y:void 0};this.bisector={x:void 0,y:void 0};this.leftInner={x:void 0,y:void 0};this.rightInner={x:void 0,y:void 0};
this.leftOuter={x:void 0,y:void 0};this.rightOuter={x:void 0,y:void 0}}}();g.TessellationState=n;g.tessellate=function(c,a,z){d.trackDistance=null!=a.trackDistance?a.trackDistance:!1;d.wrapDistance=null!=a.wrapDistance?a.wrapDistance:65535;d.thin=null!=a.thin?a.thin:!1;d.initialDistance=null!=a.initialDistance?a.initialDistance:0;d.enableOuterBisectorSplit=null!=a.enableOuterBisectorSplit?a.enableOuterBisectorSplit:!1;d.outerBisectorAutoSplitThreshold=null!=a.outerBisectorAutoSplitThreshold?a.outerBisectorAutoSplitThreshold:
0;d.enableInnerBisectorSplit=null!=a.enableOuterBisectorSplit?a.enableOuterBisectorSplit:!1;d.innerBisectorAutoSplitThreshold=null!=a.innerBisectorAutoSplitThreshold?a.innerBisectorAutoSplitThreshold:0;e=c;l=z;m=h=f=0;r=!1;k=q=null;b.currentVertex.x=null;b.currentVertex.y=null;b.distance=d.initialDistance;c=e[0];a=e[e.length-1];b.canSplit=!1;b.closed=c.x===a.x&&c.y===a.y;if(!(2>e.length||2===e.length&&b.closed))if(d.thin)if(d.trackDistance)for(p(),v(),x(1);h-m>d.wrapDistance||f<e.length;)p(),v(),
x(2),l.bridge(b),b.leftExit0=b.rightExit0,b.leftExit2=b.rightExit2;else for(;f<e.length;)0<f&&(b.inbound.x=b.outbound.x,b.inbound.y=b.outbound.y),f<e.length-1?(b.outbound.x=e[f+1].x-e[f].x,b.outbound.y=e[f+1].y-e[f].y,c=Math.sqrt(b.outbound.x*b.outbound.x+b.outbound.y*b.outbound.y),b.distance+=c,b.outbound.x/=c,b.outbound.y/=c):(b.outbound.x=b.inbound.x,b.outbound.y=b.inbound.y),0===f&&(b.inbound.x=b.outbound.x,b.inbound.y=b.outbound.y),b.currentVertex.x=e[f].x,b.currentVertex.y=e[f].y,b.prevNormal.x=
-b.inbound.y,b.prevNormal.y=b.inbound.x,b.nextNormal.x=-b.outbound.y,b.nextNormal.y=b.outbound.x,0===f?(l.vertex(b),b.leftEntry0=b.entry0,b.leftEntry2=b.entry2,b.leftExit0=b.exit0,b.leftExit2=b.exit2):(l.vertex(b),b.rightEntry0=b.entry0,b.rightEntry2=b.entry2,b.rightExit0=b.exit0,b.rightExit2=b.exit2,l.bridge(b),b.leftExit0=b.rightExit0,b.leftExit2=b.rightExit2),++f;else{if(d.enableOuterBisectorSplit||0<d.outerBisectorAutoSplitThreshold||d.enableInnerBisectorSplit||0<d.innerBisectorAutoSplitThreshold)for(b.canSplit=
!0,p(),t(),b.splitInner=b.gapInner=b.splitOuter=b.gapOuter=!1,u(1),b.closure0=b.leftEntry0,b.closure1=b.leftEntry1,b.closure2=b.leftEntry2;h-m>d.wrapDistance||f<e.length-1||f<e.length&&(!b.closed||d.trackDistance);)p(),t(),b.splitInner=b.gapInner=b.splitOuter=b.gapOuter=!1,u(2),l.bridge(b),b.leftExit0=b.rightExit0,b.leftExit1=b.rightExit1,b.leftExit2=b.rightExit2;else for(p(),t(),u(1),b.closure0=b.leftEntry0,b.closure1=b.leftEntry1,b.closure2=b.leftEntry2;h-m>d.wrapDistance||f<e.length-1||f<e.length&&
(!b.closed||d.trackDistance);)p(),t(),u(2),l.bridge(b),b.leftExit0=b.rightExit0,b.leftExit1=b.rightExit1,b.leftExit2=b.rightExit2;b.closed&&!d.trackDistance&&(b.rightEntry0=b.closure0,b.rightEntry1=b.closure1,b.rightEntry2=b.closure2,l.bridge(b),b.leftExit0=b.rightExit0,b.leftExit1=b.rightExit1,b.leftExit2=b.rightExit2)}};g.cleanup=function(){l=e=null};g.splitVertex=w;var e,d={},l,f=void 0,h,m,r,q,k,b=new n;n=function(){function b(a,b){this.writeVertex=a;this.writeTriangle=b;this.capType=0;this.joinType=
2;this.miterLimitCosine=y.getLimitCosine(2);this.roundLimitCosine=Math.cos(23*Math.PI/180);this.almostParallelCosine=.97;this.radsPerSlice=.8;this.joinOnUTurn=this.textured=!1}b.prototype.vertex=function(a){var b=2===this.joinType?this.miterLimitCosine:this.roundLimitCosine,c=a.isCap&&0!==this.capType,d=!1;a.cosine>this.almostParallelCosine?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):a.cosine<1-this.almostParallelCosine?(d=!a.isCap&&this.joinOnUTurn,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.canSplit?(w(),0<a.sign?(a.splitInner?(a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.leftInner.x,a.leftInner.y,0,-1,a.distance),a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.rightInner.x,a.rightInner.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/
a.cosine,0,-1,a.distance),a.cosine<b?(d=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.splitOuter?(d=d||a.gapOuter,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.leftOuter.x,-a.leftOuter.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,
a.outbound.y,-a.rightOuter.x,-a.rightOuter.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.splitInner?(a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,-a.leftInner.x,-a.leftInner.y,0,1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.rightInner.x,-a.rightInner.y,0,1,a.distance)):a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<b?(d=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.splitOuter?(d=d||a.gapOuter,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.leftOuter.x,a.leftOuter.y,0,-1,a.distance),a.exit0=
this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.rightOuter.x,a.rightOuter.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance))):0<a.sign?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.cosine<b?(d=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,
0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<b?(d=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance));b=a.canSplit&&(a.splitInner||a.splitOuter)||d||c?a.entry1=a.exit1=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,0,0,0,0,a.distance):a.entry1=a.exit1=null;if(d&&1!==this.joinType)this.writeTriangle(b,
0<a.sign?a.exit2:a.entry0,0<a.sign?a.entry2:a.exit0);else if(c&&1===this.capType||d&&1===this.joinType){var e=d=c=void 0,f=void 0,k=void 0,h=void 0;if(a.isCap){var g=Math.PI,k=Math.ceil(g/this.radsPerSlice),h=g/k;a.isFirstVertex?(c=a.prevNormal.x,d=a.prevNormal.y,e=a.entry0,f=a.entry2):a.isLastVertex&&(c=-a.nextNormal.x,d=-a.nextNormal.y,e=a.exit2,f=a.exit0)}else g=2*Math.acos(a.cosine),k=Math.ceil(g/this.radsPerSlice),h=g/k,c=0<a.sign?-a.prevNormal.x:a.nextNormal.x,d=0<a.sign?-a.prevNormal.y:a.nextNormal.y,
e=0<a.sign?a.entry2:a.exit0,f=0<a.sign?a.exit2:a.entry0;for(var g=Math.cos(h),h=Math.sin(h),l=h*c+g*d,c=g*c-h*d,d=l,m,l=void 0,n=0;n<k;++n)m=l,n<k-1&&(l=a.isCap?this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,c,d,a.isFirstVertex?-1:1,0,a.distance):this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,c,d,0,a.sign,a.distance)),this.writeTriangle(0===n?e:m,b,n===k-1?f:l),m=h*c+g*d,c=g*c-h*d,d=m}else c&&2===this.capType&&(c=a.isFirstVertex?1:-1,e=d=void 0,this.textured?(d=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,a.prevNormal.x-c*a.inbound.x,a.prevNormal.y-c*a.inbound.y,-c,-1,a.distance),e=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x-c*a.inbound.x,-a.prevNormal.y-c*a.inbound.y,-c,1,a.distance)):(d=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-c*a.inbound.x,a.prevNormal.y-c*a.inbound.y,0,-1,a.distance),e=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x-c*a.inbound.x,-a.prevNormal.y-c*a.inbound.y,0,1,a.distance)),
0<c?(this.writeTriangle(b,a.entry2,e),this.writeTriangle(b,e,d),this.writeTriangle(b,d,a.entry0)):(this.writeTriangle(b,e,a.exit2),this.writeTriangle(b,d,e),this.writeTriangle(b,a.exit0,d)))};b.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,null!=a.leftExit1?a.leftExit1:a.leftExit2);this.writeTriangle(a.rightEntry0,null!=a.rightEntry1?a.rightEntry1:a.rightEntry2,null!=a.leftExit1?a.leftExit1:a.leftExit2);null!=a.leftExit1&&null!=a.rightEntry1?(this.writeTriangle(a.leftExit1,
a.rightEntry1,a.leftExit2),this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)):null!=a.leftExit1?this.writeTriangle(a.leftExit1,a.rightEntry2,a.leftExit2):null!=a.rightEntry1&&this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)};return b}();g.StandardTessellationCallbacks=n;n=function(){function b(a,b){this.writeVertex=a;this.writeTriangle=b}b.prototype.vertex=function(a){a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance);
a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance);a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance);a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)};b.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,a.leftExit2);this.writeTriangle(a.rightEntry0,a.rightEntry2,a.leftExit2)};return b}();
g.ThinTessellationCallbacks=n});