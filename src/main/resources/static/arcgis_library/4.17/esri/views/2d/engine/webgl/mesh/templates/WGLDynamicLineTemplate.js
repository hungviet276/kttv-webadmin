// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../../core/screenUtils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(g,h,q,k,l,m,n,r,d,t,u,v){Object.defineProperty(h,"__esModule",{value:!0});g=function(g){function f(a){var b=g.call(this,a)||this;b._cimLineLayer=a;var f=0;d.isFunction(a.width)||(f=.5*k.pt2px(a.width));b._dynamicPropertyMap.set("_halfWidth",function(b,c,e){return d.isFunction(a.width)?
.5*k.pt2px(a.width(b,c,e)):f});d.isFunction(a.cap)?b._dynamicPropertyMap.set("_capType",a.cap):b._capType=a.cap;d.isFunction(a.join)?b._dynamicPropertyMap.set("_joinType",a.join):b._joinType=a.join;if(d.isFunction(a.color))b._dynamicPropertyMap.set("_fillColor",function(b,c,e){return(b=a.color(b,c,e))&&l.premultiplyAlphaRGBA(b)||0});else{var p=a.color;b._fillColor=p&&l.premultiplyAlphaRGBA(p)||0}d.isFunction(a.miterLimit)?b._dynamicPropertyMap.set("_miterLimitCosine",function(b,c,e){return d.getLimitCosine(a.miterLimit(b,
c,e))}):b._miterLimitCosine=d.getLimitCosine(a.miterLimit);b._scaleFactor=a.scaleFactor||1;b._isDashed=a.isDashed;b.effects=a.effects;b.tessellationProperties._bitset=a.colorLocked?1:0;b._materialKey=a.materialKey;b._initializeTessellator(!0);return b}q.__extends(f,g);f.fromCIMLine=function(a){return new f(a)};f.prototype.bindFeature=function(a,b,d){var f=this,g=a.readLegacyFeature();this._dynamicPropertyMap.forEach(function(a,c){f[c]=a(g,b,d)});this._halfWidth*=this._scaleFactor;a=this._materialCache;
var c=this._cimLineLayer.materialHash,c=c(g,b,d),c=a.get(c);a=null;c&&v.ok(c.spriteMosaicItem)&&(a=c.spriteMosaicItem);if(a){this._hasPattern=!0;var e=a.rect,c=e.x+m.SPRITE_PADDING,e=e.y+m.SPRITE_PADDING,h=c+a.width,k=e+a.height;this.tessellationProperties._tl=n.i1616to32(c,e);this.tessellationProperties._br=n.i1616to32(h,k)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor;this.tessellationProperties._halfWidth=
this._halfWidth;this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;c=r.LineMaterialKey.load(this._materialKey);a&&(c.sdf=a.sdf,c.pattern=!0,c.textureBinding=a.textureBinding);this._materialKey=c.data};return f}(t.default(u.default));h.default=g});