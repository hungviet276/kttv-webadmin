// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../layers/graphics/ElevationQuery".split(" "),function(q,m,h,u,v,r,t,n,w){function k(d,a,b,g,l,f,e){for(var c=0;c<a.length;c++){var p=a[c].getElevation(b,g,l,f,e);null!=p&&(d=null!=d?Math.max(p,d):p)}return d}Object.defineProperty(m,"__esModule",{value:!0});m.CombinedElevationProvider=void 0;q=function(d){function a(b){b=d.call(this,b)||
this;b.im=[];b.ground=[];b.scene=[];b.handles=new Map;return b}h.__extends(a,d);a.prototype.destroy=function(){this._elevationQuery=r.destroyMaybe(this._elevationQuery)};Object.defineProperty(a.prototype,"elevationQuery",{get:function(){var b=this;r.isNone(this._elevationQuery)&&(this._elevationQuery=new w.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,function(){return b.view.map&&b.view.map.ground},{maximumAutoTileRequests:4}));return this._elevationQuery},enumerable:!1,
configurable:!0});a.prototype.getElevation=function(b,g,a,f,e){var c;c=k(null,this.im,b,g,a,f,e);null==c&&(c=k(c,this.ground,b,g,a,f,e));"scene"===e&&(c=k(c,this.scene,b,g,a,f,e));return c};a.prototype.queryElevation=function(b,a,l,f,e,c,d){var g=this;void 0===c&&(c=null);void 0===d&&(d=0);var h=t.createResolver();this.elevationQuery.queryElevation(b,a,c,d).then(function(c){"scene"===e&&(c=k(c,g.scene,b,a,l,f,e));h.resolve(c)}).catch(function(c){t.isAbortError(c)?h.reject(c):h.resolve(g.getElevation(b,
a,l,f,e))});return h.promise};a.prototype.register=function(b,a){var g=this;this.handles.set(a,a.on("elevation-change",function(b){return g.emit("elevation-change",b)}));this[b].push(a)};a.prototype.unregister=function(b){this.handles.has(b)&&(this.handles.get(b).remove(),this.handles.delete(b));for(var a=0,d=[this.im,this.ground,this.scene];a<d.length;a++){var f=d[a],e=f.indexOf(b);-1<e&&f.splice(e,1)}};h.__decorate([n.property({constructOnly:!0})],a.prototype,"view",void 0);h.__decorate([n.property({readOnly:!0,
aliasOf:"view.basemapTerrain.spatialReference"})],a.prototype,"spatialReference",void 0);return a=h.__decorate([n.subclass("esri.views.3d.support.CombinedElevationProvider")],a)}(v.EventedMixin(u));m.CombinedElevationProvider=q});