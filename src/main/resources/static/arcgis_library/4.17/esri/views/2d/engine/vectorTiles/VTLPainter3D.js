// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../brushes","./shaders/ProgramCache"],function(k,l,m,n){Object.defineProperty(l,"__esModule",{value:!0});k=function(){function h(b,c){this.spriteMosaic=b;this.glyphMosaic=c;this._brushCache=new Map}h.prototype.dispose=function(){this._brushCache&&(this._brushCache.forEach(function(b){return b.dispose()}),this._brushCache=null);this._programCache&&(this._programCache.dispose(),this._programCache=null)};h.prototype.setContext=function(b){this._programCache||(this._programCache=
new n.default(b))};h.prototype.drawTile=function(b,c,d){var e=this,a=b.context,g=d.layers;0<d.backgroundBucketIds.length&&(b.renderPass="background",d.backgroundBucketIds.forEach(function(a){return e._renderStyleLayer(a,b,c,d,!0)}));a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);a.setDepthFunction(515);b.renderPass="opaque";for(var f=g.length-1;0<=f;f--)this._renderStyleLayer(f,b,c,d,!1);a.setDepthWriteEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,
771,1,771);b.renderPass="translucent";for(f=0;f<g.length;f++)this._renderStyleLayer(f,b,c,d,!1);a.setDepthTestEnabled(!1);b.renderPass="symbol";for(f=0;f<g.length;f++)this._renderStyleLayer(f,b,c,d,!1);a.bindVAO()};h.prototype._renderStyleLayer=function(b,c,d,e,a){void 0===a&&(a=!1);if(a||d.layerData[b])if(a=c.renderPass,e=e.layers[b],void 0!==e){var g;switch(e.type){case 0:if("background"!==a)return;g="vtlBackground";break;case 1:if("opaque"!==a&&"translucent"!==c.renderPass)return;g="vtlFill";break;
case 2:if("translucent"!==a)return;g="vtlLine";break;case 4:if("symbol"!==a)return;g="vtlCircle";break;case 3:if("symbol"!==a)return;g="vtlSymbol"}a=c.displayLevel;void 0!==e.minzoom&&e.minzoom>a+1E-6||void 0!==e.maxzoom&&e.maxzoom<=a-1E-6||(c.styleLayerId=b,c.styleLayer=e,this.drawWithBrush(c,d,g))}};h.prototype.drawWithBrush=function(b,c,d){this._brushCache.has(d)||this._brushCache.set(d,new m.vtlBrushes[d]);this._brushCache.get(d).drawMany(b,[c])};h.prototype.getVectorTileProgramCach=function(){return this._programCache};
return h}();l.default=k});