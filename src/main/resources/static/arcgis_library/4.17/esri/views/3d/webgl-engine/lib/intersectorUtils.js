// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/geometryUtils/boundedPlane ../../support/geometryUtils/sphere ./Object3D".split(" "),
function(f,d,g,G,H,m,n,I,J,e,K,h,L,w,r,M,N,O){function v(c,a){return g.isNone(c)||null==c.layerUid?null:g.isSome(a.graphicsView)&&c.layerUid===a.graphicsView.mockLayerId?a.graphics:a.map.findLayerByUid(c.layerUid)}function x(c,a){if(g.isNone(c))return null;var b=v(c,a);return g.isNone(b)?null:b===a.graphics?g.isSome(a.graphicsView)?g.unwrap(a.graphicsView.getGraphicFromGraphicUid(c.graphicUid)):null:(a=a.allLayerViews.find(function(a){return a.layer===b}))?P(a,c):null}function P(c,a){return!c||c.suspended?
null:"getGraphicFromIntersectorMetadata"in c&&a?c.getGraphicFromIntersectorMetadata(a):"getGraphicFromGraphicUid"in c&&null!=a.graphicUid?c.getGraphicFromGraphicUid(a.graphicUid):null}Object.defineProperty(d,"__esModule",{value:!0});d.TERRAIN_ID=d.getVerticalOffsetTerrain=d.getVerticalOffsetI3S=d.getVerticalOffsetObject3D=d.Object3DVerticalOffsetGlobalViewingMode=d.I3SVerticalOffsetGlobalViewingMode=d.TerrainVerticalOffsetGlobalViewingMode=d.IntersectorResult=d.IntersectorResults=d.IntersectorTransform=
d.IntersectorOptions=d.sliceFilterPredicate=void 0;d.sliceFilterPredicate=function(c){return function(a,b,k){e.vec3.lerp(y,a,b,k);return!M.extrusionContainsPoint(c,y)}};f=function(){return function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.store=2}}();d.IntersectorOptions=f;f=function(){function c(){this._transform=n.mat4f64.create();this._transformInverse=new t({value:this._transform},
m.mat4.invert,n.mat4f64.create);this._transformInverseTranspose=new t(this._transformInverse,m.mat4.transpose,n.mat4f64.create);this._transformTranspose=new t({value:this._transform},m.mat4.transpose,n.mat4f64.create);this._transformInverseRotation=new t({value:this._transform},G.mat3.normalFromMat4Legacy,H.mat3f64.create)}c.prototype.invalidateLazyTransforms=function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};
Object.defineProperty(c.prototype,"transform",{get:function(){return this._transform},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},
enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!1,configurable:!0});c.prototype.setTransformMatrix=function(a){m.mat4.copy(this._transform,a)};c.prototype.multiplyTransform=function(a){m.mat4.multiply(this._transform,this._transform,a)};c.prototype.set=function(a){m.mat4.copy(this._transform,a);this.invalidateLazyTransforms()};c.prototype.setAndInvalidateLazyTransforms=function(a,b){this.setTransformMatrix(a);
this.multiplyTransform(b);this.invalidateLazyTransforms()};return c}();d.IntersectorTransform=f;var t=function(){function c(a,b,c){this.original=a;this.update=b;this.dirty=!0;this.transform=c()}c.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(c.prototype,"value",{get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform},enumerable:!1,configurable:!0});return c}();f=function(){function c(){this.min=new p;this.max=new p;this.hud=
new p;this.ground=new p}c.prototype.init=function(a){this.min.init(a);this.max.init(a);this.hud.init(a);this.ground.init(a);this.all=[]};return c}();d.IntersectorResults=f;var p=function(){function c(a){this.normal=h.vec3f64.create();this.transformation=n.mat4f64.create();this._ray=r.ray.create();this.init(a)}Object.defineProperty(c.prototype,"ray",{get:function(){return this._ray},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"hasIntersectionPoint",{get:function(){return null!=
this.dist},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return e.vec3.scale(u,this.ray.direction,this.dist),e.vec3.length(u)},enumerable:!1,configurable:!0});c.prototype.getIntersectionPoint=function(a){if(!this.hasIntersectionPoint)return!1;e.vec3.scale(u,this.ray.direction,this.dist);e.vec3.add(a,this.ray.origin,u);return!0};c.prototype.getTransformedNormal=function(a){e.vec3.copy(q,this.normal);q[3]=0;L.vec4.transformMat4(q,
q,this.transformation);e.vec3.copy(a,q);e.vec3.normalize(a,a);return a};c.prototype.init=function(a){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";a?r.ray.copy(a,this._ray):this._ray=r.ray.create()};c.prototype.set=function(a,b,c,l,d,Q,z,f,g,n){a instanceof O&&(a={type:"stage",obj:a});this.dist=c;e.vec3.copy(this.normal,l);m.mat4.copy(this.transformation,d);this.target=a;this.name=
b;this.drapedLayerOrder=Q;this.center=z?h.vec3f64.clone(z):null;this.geometryId=f;this.triangleNr=g;this.drapedLayerGraphicOrder=n};c.prototype.copyFrom=function(a){r.ray.copy(a._ray,this._ray);this.dist=a.dist;this.target=a.target;this.name=a.name;this.drapedLayerOrder=a.drapedLayerOrder;this.center=a.center?h.vec3f64.clone(a.center):null;this.geometryId=a.geometryId;this.triangleNr=a.triangleNr;this.intersector=a.intersector;this.drapedLayerGraphicOrder=a.drapedLayerGraphicOrder;e.vec3.copy(this.normal,
a.normal);m.mat4.copy(this.transformation,a.transformation)};c.prototype.toOwner=function(a){if(!this.target)return null;switch(this.target.type){case "stage":return v(this.target.obj.metadata,a);case "external":switch(this.intersector){case "PointRenderer":var b=this.target.metadata.layerUid;return null!=b?a.map.findLayerByUid(b):null;case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return v(this.target.metadata,a);case "TerrainRenderer":return a.map&&a.map.ground}}return null};c.prototype.toGraphic=
function(a){if(!this.target)return null;switch(this.target.type){case "stage":return x(this.target.obj.metadata,a);case "external":switch(this.intersector){case "PointRenderer":return this.target.metadata.createGraphic();case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return x(this.target.metadata,a)}}return null};return c}();d.IntersectorResult=p;f=function(){function c(a){void 0===a&&(a=0);this.offset=a;this.tmpVertex=h.vec3f64.create()}c.prototype.applyToVertex=function(a,b,c){var l=
a+this.localOrigin[0],k=b+this.localOrigin[1],d=c+this.localOrigin[2],e=this.offset/Math.sqrt(l*l+k*k+d*d);this.tmpVertex[0]=a+l*e;this.tmpVertex[1]=b+k*e;this.tmpVertex[2]=c+d*e;return this.tmpVertex};c.prototype.applyToAabb=function(a){var b=a[0]+this.localOrigin[0],c=a[1]+this.localOrigin[1],l=a[2]+this.localOrigin[2],d=a[3]+this.localOrigin[0],e=a[4]+this.localOrigin[1],f=a[5]+this.localOrigin[2],g=this.offset/Math.sqrt(b*b+c*c+l*l);a[0]+=b*g;a[1]+=c*g;a[2]+=l*g;b=this.offset/Math.sqrt(d*d+e*
e+f*f);a[3]+=d*b;a[4]+=e*b;a[5]+=f*b;return a};return c}();d.TerrainVerticalOffsetGlobalViewingMode=f;var B=function(){function c(a){void 0===a&&(a=0);this.offset=a;this.componentLocalOriginLength=0;this.tmpVertex=h.vec3f64.create();this.mbs=w.vec4f64.create();this.obb={center:h.vec3f64.create(),halfSize:K.vec3f32.create(),quaternion:null}}Object.defineProperty(c.prototype,"localOrigin",{set:function(a){this.componentLocalOriginLength=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},enumerable:!1,configurable:!0});
c.prototype.applyToVertex=function(a,b,c){var d=c+this.componentLocalOriginLength,k=this.offset/Math.sqrt(a*a+b*b+d*d);this.tmpVertex[0]=a+a*k;this.tmpVertex[1]=b+b*k;this.tmpVertex[2]=c+d*k;return this.tmpVertex};c.prototype.applyToAabb=function(a){var b=a[0],c=a[1],d=a[2]+this.componentLocalOriginLength,e=a[3],f=a[4],g=a[5]+this.componentLocalOriginLength,h=this.offset/Math.sqrt(b*b+c*c+d*d);a[0]+=b*h;a[1]+=c*h;a[2]+=d*h;b=this.offset/Math.sqrt(e*e+f*f+g*g);a[3]+=e*b;a[4]+=f*b;a[5]+=g*b;return a};
c.prototype.applyToMbs=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),c=this.offset/b;this.mbs[0]=a[0]+a[0]*c;this.mbs[1]=a[1]+a[1]*c;this.mbs[2]=a[2]+a[2]*c;this.mbs[3]=a[3]+a[3]*this.offset/b;return this.mbs};c.prototype.applyToObb=function(a){var b=a.center,c=this.offset/Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);this.obb.center[0]=b[0]+b[0]*c;this.obb.center[1]=b[1]+b[1]*c;this.obb.center[2]=b[2]+b[2]*c;e.vec3.transformQuat(this.obb.halfSize,a.halfSize,a.quaternion);e.vec3.add(this.obb.halfSize,
this.obb.halfSize,a.center);b=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);this.obb.halfSize[0]+=this.obb.halfSize[0]*b;this.obb.halfSize[1]+=this.obb.halfSize[1]*b;this.obb.halfSize[2]+=this.obb.halfSize[2]*b;e.vec3.subtract(this.obb.halfSize,this.obb.halfSize,a.center);I.quat.conjugate(A,a.quaternion);e.vec3.transformQuat(this.obb.halfSize,this.obb.halfSize,A);this.obb.halfSize[0]*=0>this.obb.halfSize[0]?
-1:1;this.obb.halfSize[1]*=0>this.obb.halfSize[1]?-1:1;this.obb.halfSize[2]*=0>this.obb.halfSize[2]?-1:1;this.obb.quaternion=a.quaternion;return this.obb};return c}();d.I3SVerticalOffsetGlobalViewingMode=B;var C=function(){function c(a){void 0===a&&(a=0);this.offset=a;this.sphere=N.create();this.tmpVertex=h.vec3f64.create()}c.prototype.applyToVertex=function(a,b,c){var d=this.objectTransform.transform,e=d[0]*a+d[4]*b+d[8]*c+d[12],f=d[1]*a+d[5]*b+d[9]*c+d[13];a=d[2]*a+d[6]*b+d[10]*c+d[14];b=this.offset/
Math.sqrt(e*e+f*f+a*a);e+=e*b;f+=f*b;a+=a*b;b=this.objectTransform.inverse;this.tmpVertex[0]=b[0]*e+b[4]*f+b[8]*a+b[12];this.tmpVertex[1]=b[1]*e+b[5]*f+b[9]*a+b[13];this.tmpVertex[2]=b[2]*e+b[6]*f+b[10]*a+b[14];return this.tmpVertex};c.prototype.applyToMinMax=function(a,b){var c=this.offset/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]+=a[0]*c;a[1]+=a[1]*c;a[2]+=a[2]*c;a=this.offset/Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);b[0]+=b[0]*a;b[1]+=b[1]*a;b[2]+=b[2]*a};c.prototype.applyToAabb=function(a){var b=
this.offset/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]+=a[0]*b;a[1]+=a[1]*b;a[2]+=a[2]*b;b=this.offset/Math.sqrt(a[3]*a[3]+a[4]*a[4]+a[5]*a[5]);a[3]+=a[3]*b;a[4]+=a[4]*b;a[5]+=a[5]*b;return a};c.prototype.applyToBoundingSphere=function(a,b){var c=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]),d=this.offset/c;this.sphere.center[0]=b[0]+b[0]*d;this.sphere.center[1]=b[1]+b[1]*d;this.sphere.center[2]=b[2]+b[2]*d;this.sphere.radius=a+a*this.offset/c;return this.sphere};return c}();d.Object3DVerticalOffsetGlobalViewingMode=
C;var D=new C;d.getVerticalOffsetObject3D=function(c){return g.isSome(c)?(D.offset=c,D):null};var E=new B;d.getVerticalOffsetI3S=function(c){return g.isSome(c)?(E.offset=c,E):null};var F=new f;d.getVerticalOffsetTerrain=function(c){return g.isSome(c)?(F.offset=c,F):null};d.TERRAIN_ID="terrain";var y=h.vec3f64.create(),u=h.vec3f64.create(),q=w.vec4f64.create(),A=J.quatf64.create()});