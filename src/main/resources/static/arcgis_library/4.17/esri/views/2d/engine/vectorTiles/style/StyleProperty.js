// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../Color ../GeometryUtils ../expression/definition ../expression/expression".split(" "),function(q,r,k,l,n,p){return function(){function e(a,b){this.isDataDriven=!1;var c;switch(a.type){case "number":c=!0;break;case "color":c=!0;b=e._parseColor(b);break;case "array":c="number"===a.value;break;default:c=!1}null==b&&(b=a.default);if(Array.isArray(b)&&0<b.length&&n.ops[b[0]])try{var f=p.createExpression(b);this.getValue=this._buildExpression(f,a);this.isDataDriven=
!0}catch(h){console.log(h.message),this.getValue=this._buildSimple(a.default)}else{c&&"interval"===b.type&&(c=!1);if(f=b&&b.stops&&0<b.stops.length)for(var d=0,g=b.stops;d<g.length;d++){var m=g[d];m[1]=this._validate(m[1],a)}if(this.isDataDriven=b?!!b.property:!1)if(void 0!==b.default&&(b.default=this._validate(b.default,a)),f)switch(b.type){case "identity":this.getValue=this._buildIdentity(b,a);break;case "categorical":this.getValue=this._buildCategorical(b,a);break;default:this.getValue=c?this._buildInterpolate(b,
a):this._buildInterval(b,a)}else this.getValue=this._buildIdentity(b,a);else f?this.getValue=c?this._buildZoomInterpolate(b):this._buildZoomInterval(b):(b=this._validate(b,a),this.getValue=this._buildSimple(b))}}e.prototype._validate=function(a,b){if("number"===b.type){if(a<b.minimum)return b.minimum;if(a>b.maximum)return b.maximum}return a};e.prototype._buildSimple=function(a){return function(){return a}};e.prototype._buildExpression=function(a,b){return function(c,f){try{return a.evaluate(f,c)}catch(d){return console.log(d.message),
b.default}}};e.prototype._buildIdentity=function(a,b){var c=this;return function(f,d){var g;d&&(g=d.values[a.property],"color"===b.type&&(g=e._parseColor(g)));void 0===g&&(g=a.default);return void 0!==g?c._validate(g,b):b.default}};e.prototype._buildCategorical=function(a,b){var c=this;return function(f,d){var g;d&&(g=d.values[a.property]);g=c._categorical(g,a.stops);return void 0!==g?g:void 0!==a.default?a.default:b.default}};e.prototype._buildInterval=function(a,b){var c=this;return function(f,
d){var g;d&&(g=d.values[a.property]);return"number"===typeof g?c._interval(g,a.stops):void 0!==a.default?a.default:b.default}};e.prototype._buildInterpolate=function(a,b){var c=this;return function(f,d){var g;d&&(g=d.values[a.property]);return"number"===typeof g?c._interpolate(g,a.stops,a.base||1):void 0!==a.default?a.default:b.default}};e.prototype._buildZoomInterpolate=function(a){var b=this;return function(c){return b._interpolate(c,a.stops,a.base||1)}};e.prototype._buildZoomInterval=function(a){var b=
this;return function(c){return b._interval(c,a.stops)}};e.prototype._categorical=function(a,b){for(var c=b.length,f=0;f<c;f++)if(b[f][0]===a)return b[f][1]};e.prototype._interval=function(a,b){for(var c=b.length,f=0,d=0;d<c;d++)if(b[d][0]<=a)f=d;else break;return b[f][1]};e.prototype._interpolate=function(a,b,c){for(var f,d,g=b.length,e=0;e<g;e++){var h=b[e];if(h[0]<=a)f=h;else{d=h;break}}if(f&&d){e=d[0]-f[0];a-=f[0];c=1===c?a/e:(Math.pow(c,a)-1)/(Math.pow(c,e)-1);if(Array.isArray(f[1])){f=f[1];d=
d[1];a=[];for(e=0;e<f.length;e++)a.push(l.interpolate(f[e],d[e],c));return a}return l.interpolate(f[1],d[1],c)}if(f)return f[1];if(d)return d[1]};e._isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};e._parseColor=function(a){if(Array.isArray(a))return a;if("string"===typeof a){if(a=new k(a),!this._isEmpty(a))return k.toUnitRGBA(a)}else return a&&a.default&&(a.default=e._parseColor(a.default)),a&&a.stops&&(a.stops=a.stops.map(function(a){return[a[0],e._parseColor(a[1])]})),
a};return e}()});