// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../core/maybe","../../core/scheduling"],function(f,g,h,k){Object.defineProperty(g,"__esModule",{value:!0});f=function(){function c(a){var b=this;this.view=a;this._frameTaskHandle=null;this._updateRequested=!1;this.updateEnabled=this.stationary=!0;this.animationInProgress=!1;this.prepare=function(){b._updateParameters.state=b.view.state;b._updateParameters.stationary=b.view.stationary;b._updateParameters.pixelRatio=window.devicePixelRatio;b._updateParameters.renderingOptions=
b.view.renderingOptions};this.update=function(){b._updateRequested=!1;if(b.updateEnabled){var a=b.view,c=a.basemapView,d=a.graphicsView,e=a.labelManager,f=a.layerViews,a=a.state.id;c.baseLayerViews.forEach(b._updateLayerView,b);f.forEach(b._updateLayerView,b);c.referenceLayerViews.forEach(b._updateLayerView,b);h.isSome(e)&&(e.lastUpdateId!==a&&(e.viewChange(),e.lastUpdateId=a),e.updateRequested&&e.processUpdate(b._updateParameters));h.isSome(d)&&(d.lastUpdateId!==a&&(d.viewChange(),d.lastUpdateId=
a),d.updateRequested&&d.processUpdate(b._updateParameters));b.animationInProgress||b._updateRequested||b._frameTaskHandle.pause()}}}c.prototype.destroy=function(){this.stop()};c.prototype.start=function(){var a=this;this.stationary=this.view.stationary;this._updateParameters={state:this.view.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:this.view.renderingOptions};this._stationaryHandle=this.view.watch("stationary",function(b){a.stationary=b;a.requestFrame()});
this._frameTaskHandle=k.addFrameTask(this)};c.prototype.stop=function(){this._frameTaskHandle&&(this._stationaryHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)};c.prototype.requestUpdate=function(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())};c.prototype.requestFrame=function(){this._frameTaskHandle&&this._frameTaskHandle.resume()};c.prototype._updateLayerView=
function(a){var b=this.view.state,c=a.lastUpdateId;if(null==c||!this.stationary&&!a.moving)a.moving=!0,a.moveStart();c!==b.id&&a.viewChange();this.stationary&&a.moving&&(a.moving=!1,a.moveEnd());a.lastUpdateId=b.id;a.updateRequested&&a.processUpdate(this._updateParameters);"layerViews"in a&&a.layerViews.forEach(this._updateLayerView,this)};return c}();g.default=f});