// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/mathUtils ../core/shaderLibrary/Laserline.glsl ../core/shaderLibrary/ScreenSpacePass ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(x,e,c,t,u,v,d,w){Object.defineProperty(e,"__esModule",{value:!0});e.build=e.defaultAngleCutoff=void 0;e.defaultAngleCutoff=t.deg2rad(6);e.build=function(b){var a=new w.ShaderBuilder;a.extensions.add("GL_OES_standard_derivatives");a.include(v.ScreenSpacePass);a.include(u.Laserline,
b);a.fragment.uniforms.add("angleCutoff","vec2");a.fragment.uniforms.add("globalAlpha","float");b.heightManifoldEnabled&&a.fragment.uniforms.add("heightPlane","vec4");b.pointDistanceEnabled&&a.fragment.uniforms.add("pointDistanceSphere","vec4");b.lineVerticalPlaneEnabled&&a.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3");(b.heightManifoldEnabled||b.pointDistanceEnabled||b.lineVerticalPlaneEnabled)&&a.fragment.uniforms.add("maxPixelDistance",
"float");b.intersectsLineEnabled&&a.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float");(b.lineVerticalPlaneEnabled||b.heightManifoldEnabled)&&a.fragment.code.add(d.glsl(f||(f=c.__makeTemplateObject(["\n      float planeDistancePixels(vec4 plane, vec3 pos) {\n        float dist \x3d dot(plane.xyz, pos) + plane.w;\n        float width \x3d fwidth(dist);\n        dist /\x3d min(width, maxPixelDistance);\n        return abs(dist);\n      }"],
["\n      float planeDistancePixels(vec4 plane, vec3 pos) {\n        float dist \x3d dot(plane.xyz, pos) + plane.w;\n        float width \x3d fwidth(dist);\n        dist /\x3d min(width, maxPixelDistance);\n        return abs(dist);\n      }"]))));b.pointDistanceEnabled&&a.fragment.code.add(d.glsl(g||(g=c.__makeTemplateObject(["\n    float sphereDistancePixels(vec4 sphere, vec3 pos) {\n      float dist \x3d distance(sphere.xyz, pos) - sphere.w;\n      float width \x3d fwidth(dist);\n      dist /\x3d min(width, maxPixelDistance);\n      return abs(dist);\n    }\n    "],
["\n    float sphereDistancePixels(vec4 sphere, vec3 pos) {\n      float dist \x3d distance(sphere.xyz, pos) - sphere.w;\n      float width \x3d fwidth(dist);\n      dist /\x3d min(width, maxPixelDistance);\n      return abs(dist);\n    }\n    "]))));b.intersectsLineEnabled&&a.fragment.code.add(d.glsl(h||(h=c.__makeTemplateObject(["\n    float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\n      float dist \x3d length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\n      return abs(dist) - radius;\n    }\n    "],
["\n    float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\n      float dist \x3d length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\n      return abs(dist) - radius;\n    }\n    "]))));(b.lineVerticalPlaneEnabled||b.intersectsLineEnabled)&&a.fragment.code.add(d.glsl(k||(k=c.__makeTemplateObject(["\n    bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\n      vec3 dir \x3d end - start;\n      float t2 \x3d dot(dir, pos - start);\n      float l2 \x3d dot(dir, dir);\n      return t2 \x3e\x3d 0.0 \x26\x26 t2 \x3c\x3d l2;\n    }\n    "],
["\n    bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\n      vec3 dir \x3d end - start;\n      float t2 \x3d dot(dir, pos - start);\n      float l2 \x3d dot(dir, dir);\n      return t2 \x3e\x3d 0.0 \x26\x26 t2 \x3c\x3d l2;\n    }\n    "]))));a.fragment.code.add(d.glsl(l||(l=c.__makeTemplateObject(["\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    vec4 color \x3d vec4(0, 0, 0, 0);\n  "],
["\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    vec4 color \x3d vec4(0, 0, 0, 0);\n  "]))));b.heightManifoldEnabled&&a.fragment.code.add(d.glsl(m||(m=c.__makeTemplateObject(["\n    {\n      float heightManifoldAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\n      vec4 heightManifoldColor \x3d laserlineProfile(planeDistancePixels(heightPlane, pos));\n      color \x3d max(color, heightManifoldColor * heightManifoldAlpha);\n    }\n    "],
["\n    {\n      float heightManifoldAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\n      vec4 heightManifoldColor \x3d laserlineProfile(planeDistancePixels(heightPlane, pos));\n      color \x3d max(color, heightManifoldColor * heightManifoldAlpha);\n    }\n    "]))));b.pointDistanceEnabled&&a.fragment.code.add(d.glsl(n||(n=c.__makeTemplateObject(["\n    {\n      // distance to sphere\n      float pointDistanceSphereDistance \x3d sphereDistancePixels(pointDistanceSphere, pos);\n      vec4 pointDistanceSphereColor \x3d laserlineProfile(pointDistanceSphereDistance);\n      float pointDistanceSphereAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\n\n      color \x3d max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n    }\n    "],
["\n    {\n      // distance to sphere\n      float pointDistanceSphereDistance \x3d sphereDistancePixels(pointDistanceSphere, pos);\n      vec4 pointDistanceSphereColor \x3d laserlineProfile(pointDistanceSphereDistance);\n      float pointDistanceSphereAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\n\n      color \x3d max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n    }\n    "]))));b.lineVerticalPlaneEnabled&&
a.fragment.code.add(d.glsl(p||(p=c.__makeTemplateObject(["\n    {\n      if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\n        float lineVerticalDistance \x3d planeDistancePixels(lineVerticalPlane, pos);\n\n        vec4 lineVerticalColor \x3d laserlineProfile(lineVerticalDistance);\n        float lineVerticalAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\n\n        color \x3d max(color, lineVerticalColor * lineVerticalAlpha);\n      }\n    }\n    "],
["\n    {\n      if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\n        float lineVerticalDistance \x3d planeDistancePixels(lineVerticalPlane, pos);\n\n        vec4 lineVerticalColor \x3d laserlineProfile(lineVerticalDistance);\n        float lineVerticalAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\n\n        color \x3d max(color, lineVerticalColor * lineVerticalAlpha);\n      }\n    }\n    "]))));b.intersectsLineEnabled&&
a.fragment.code.add(d.glsl(q||(q=c.__makeTemplateObject(["\n    {\n      if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\n        float intersectsLineDistance \x3d lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\n        vec4 intersectsLineColor \x3d laserlineProfile(intersectsLineDistance);\n        float intersectsLineAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\n\n        color \x3d max(color, intersectsLineColor * intersectsLineAlpha);\n      }\n    }\n    "],
["\n    {\n      if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\n        float intersectsLineDistance \x3d lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\n        vec4 intersectsLineColor \x3d laserlineProfile(intersectsLineDistance);\n        float intersectsLineAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\n\n        color \x3d max(color, intersectsLineColor * intersectsLineAlpha);\n      }\n    }\n    "]))));
a.fragment.code.add(d.glsl(r||(r=c.__makeTemplateObject(["\n    gl_FragColor \x3d laserlineOutput(color * depthDiscontinuityAlpha);\n  }\n  "],["\n    gl_FragColor \x3d laserlineOutput(color * depthDiscontinuityAlpha);\n  }\n  "]))));return a};var f,g,h,k,l,m,n,p,q,r});