// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/Error ../../../core/maybe ../../../core/accessorSupport/decorators ../../../tasks/support/FeatureSet ./FeatureLayerView2D ./support/util".split(" "),function(q,r,d,k,e,f,m,n,p){function l(c,b){if(e.isNone(c)&&e.isNone(b))return null;var a={};e.isSome(b)&&(a.geometry=b.toJSON());e.isSome(c)&&(a.where=c);return a}return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a._enabledDataReceived=!1;a.errorString=null;a.connectionStatus="disconnected";
return a}d.__extends(b,c);b.prototype.initialize=function(){var a=this;this.handles.add([this.layer.watch("purgeOptions",function(){return a._update()})])};b.prototype.destroy=function(){this.connectionStatus="disconnected"};Object.defineProperty(b.prototype,"connectionError",{get:function(){if(this.errorString)return new k("stream-controller",this.errorString)},enumerable:!1,configurable:!0});b.prototype.on=function(a,b){"data-received"===a&&(this._enabledDataReceived=!0,this._proxy.enableEvent("data-received",
!0));var h=c.prototype.on.call(this,a,b),g=this;return{remove:function(){h.remove();"data-received"===a&&(g._proxy.closed||g.hasEventListener("data-received")||g._proxy.enableEvent("data-received",!1))}}};b.prototype.queryLatestObservations=function(a,b){var h=this;if(!this.layer.timeInfo.endField&&!this.layer.timeInfo.startField)throw new k("streamlayer-no-timeField","queryLatestObservation can only be used with services that define a TrackIdField");return this._proxy.queryLatestObservations(this._cleanUpQuery(a),
b).then(function(a){a=m.fromJSON(a);a.features.forEach(function(a){a.layer=h.layer;a.sourceLayer=h.layer});return a})};b.prototype._createClientOptions=function(){var a=this,b=c.prototype._createClientOptions.call(this);return d.__assign(d.__assign({},b),{setProperty:function(b){a.set(b.propertyName,b.value)}})};b.prototype._createTileRendererHash=function(a){var b=JSON.stringify(this.layer.purgeOptions),d=JSON.stringify(l(this.layer.definitionExpression,this.layer.geometryDefinition)),b=b+"."+d+
")";return c.prototype._createTileRendererHash.call(this,a)+b};b.prototype._createServiceOptions=function(){return d.__awaiter(this,void 0,void 0,function(){var a,b,c,g,e,f;return d.__generator(this,function(d){a=this.layer;b=a.objectIdField;c=a.fields.map(function(a){return a.toJSON()});g=p.toJSONGeometryType(a.geometryType);e=a.timeInfo&&a.timeInfo.toJSON()||null;f=a.spatialReference?a.spatialReference.toJSON():null;return[2,{type:"stream",fields:c,geometryType:g,objectIdField:b,timeInfo:e,source:this.layer.parsedUrl,
serviceFilter:l(this.layer.definitionExpression,this.layer.geometryDefinition),purgeOptions:this.layer.purgeOptions.toJSON(),enableDataReceived:this._enabledDataReceived,spatialReference:f,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval}]})})};d.__decorate([f.property()],b.prototype,"errorString",void 0);d.__decorate([f.property({dependsOn:["errorString"],readOnly:!0})],b.prototype,"connectionError",null);d.__decorate([f.property()],
b.prototype,"connectionStatus",void 0);return b=d.__decorate([f.subclass("esri.views.2d.layers.StreamLayerView2D")],b)}(n)});