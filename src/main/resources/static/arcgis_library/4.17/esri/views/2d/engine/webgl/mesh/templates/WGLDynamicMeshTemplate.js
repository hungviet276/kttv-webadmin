// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/cim/cimAnalyzer ./WGLMeshTemplate".split(" "),function(a,e,m,n,k,p,q){Object.defineProperty(e,"__esModule",{value:!0});var l=n.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");a=function(a){function f(d){var b=a.call(this)||this;b._ongoingMaterialRequestMap=new Map;b._materialCache=new Map;b._dynamicPropertyMap=new Map;b._cimLayer=d;return b}m.__extends(f,a);f.prototype.analyze=
function(d,b,a,f){var e=this;b=b.readLegacyFeature();var h=this._materialCache,g=this._cimLayer.materialHash;if(!g)return l.error("A Dynamic mesh template must have a material hash value or function!"),k.reject(null);var c="function"===typeof g?g(b,a,f):g;if(h.has(c))return d=h.get(c),k.resolve(d);if(this._ongoingMaterialRequestMap.has(c))return this._ongoingMaterialRequestMap.get(c);a=p.analyzeCIMResource(this._cimLayer.cim,this._cimLayer.materialOverrides);a.mosaicHash=c;d=d.getMosaicItem(a).then(function(a){e._ongoingMaterialRequestMap.delete(c);
h.set(c,a);return a}).catch(function(a){e._ongoingMaterialRequestMap.delete(c);l.error(".analyze()",a.message);return null});this._ongoingMaterialRequestMap.set(c,d);return d};return f}(q.default);e.default=a});