// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/has ../../../../../core/maybe ../../../../../core/accessorSupport/decorators ../../../../../core/accessorSupport/diffUtils ../../../../../renderers/support/heatmapUtils ./BaseProcessor".split(" "),function(d,f,c,u,n,p,q,r,t){Object.defineProperty(f,"__esModule",{value:!0});d=function(g){function a(){var b=null!==g&&g.apply(this,arguments)||this;b.type="heatmap";b._tileKeyToFeatureSets=new Map;return b}c.__extends(a,g);a.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",
this.onTileUpdate.bind(this))])};a.prototype.update=function(b,e){return c.__awaiter(this,void 0,void 0,function(){var a,k;return c.__generator(this,function(c){a=e.schema.processors[0];if("heatmap"!==a.type)return[2];k=q.diff(this._schema,a);if(!k)return[2];b.mesh=!0;this._schema=a;return[2]})})};a.prototype.onTileUpdate=function(b){var a=0;for(b=b.removed;a<b.length;a++)this._tileKeyToFeatureSets.delete(b[a].key.id)};a.prototype.onTileData=function(a,e,g){return c.__awaiter(this,void 0,void 0,function(){var b,
h,l,m,d,f;return c.__generator(this,function(k){this._tileKeyToFeatureSets.has(a.key.id)&&"replace"!==e.type||this._tileKeyToFeatureSets.set(a.key.id,new Map);b=this._tileKeyToFeatureSets.get(a.key.id);n.isSome(e.addOrUpdate)&&b.set(e.addOrUpdate.instance,e);h=e.end;b.forEach(function(a){return h=h||a.end});if(!h)return[2];l=[];b.forEach(function(a){n.isSome(a.addOrUpdate)&&l.push(a.addOrUpdate)});m=r.calculateHeatmapIntensityInfoReaders(l,this._schema.mesh,512,512);d={tileKey:a.key.id,intensityInfo:m};
f=[m.matrix];return[2,this.remoteClient.invoke("tileRenderer.onTileData",d,c.__assign(c.__assign({},g),{transferList:f}))]})})};a.prototype.onTileError=function(a,c,d){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:a.id,error:c},d)};return a=c.__decorate([p.subclass("esri.views.2d.layers.features.processors.HeatmapProcessor")],a)}(t.default);f.default=d});