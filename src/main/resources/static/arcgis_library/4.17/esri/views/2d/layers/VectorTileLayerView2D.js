// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("require exports tslib ../../../../request ../../../../core/has ../../../../core/ItemCache ../../../../core/maybe ../../../../core/MemCache ../../../../core/promiseUtils ../../../../core/workers ../../../../geometry/support/aaBoundingRect ../vectorTiles/VectorTile ./GlyphMosaic ./GlyphSource ./SpriteMosaic ./TileIndex ./decluttering/debugging ../../tiling/TileKey".split(" "),function(t,l,g,n,f,e,c,b,d,a,h,q,p,m,u,k,r,
G){Object.defineProperty(l,"__esModule",{value:!0});l.TileHandler=void 0;var B=new e(10),E=new Map;t=function(){function e(a,d,h){this._vectorTileLayer=a;this.devicePixelRatio=d;this._memCache=h;this._connection=this._glyphMosaic=this._spriteMosaic=null;this._ongoingTileRequests=new Map;this._ongoingRequestToController=new Map}e.prototype.destroy=function(){this._ongoingTileRequests&&this.abortAll();this._connection&&(this._connection.close(),this._connection=null);this._vectorTileLayer=null;this._spriteMosaic&&
(this._spriteMosaic.dispose(),this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null)};Object.defineProperty(e.prototype,"spriteMosaic",{get:function(){var a=this;return this._spriteSourcePromise.then(function(){return a._spriteMosaic})},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!1,configurable:!0});e.prototype.start=function(h){return g.__awaiter(this,void 0,void 0,
function(){var c,b,q,w,e,k=this;return g.__generator(this,function(r){c=this._vectorTileLayer.sourceNameToSource;b=[];for(q in c)b.push(this._fetchTileMap(c[q],h));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,h);this._spriteSourcePromise.then(function(a){k._spriteMosaic=new u(1024,1024,250);k._spriteMosaic.setSpriteSource(a)});w=this._vectorTileLayer.styleRepository;e=new m(w.glyphs);this._glyphMosaic=new p(1024,1024,e);this._broadcastPromise=a.open("WorkerTileHandler",
{client:this,scheduler:h.scheduler,signal:h.signal}).then(function(a){k._connection=a;return d.all(k._connection.broadcast("setLayers",{style:w.styleJSON},h))});return[2,d.all(b)]})})};e.prototype.updateStyle=function(){return g.__awaiter(this,void 0,void 0,function(){var a,h=this;return g.__generator(this,function(c){switch(c.label){case 0:return[4,this._broadcastPromise];case 1:return c.sent(),a=this._vectorTileLayer.styleRepository,this._broadcastPromise=d.create(function(c,b){d.all(h._connection.broadcast("updateStyle",
a.styleJSON)).then(c,b)}),[2,this._broadcastPromise]}})})};e.prototype.getVectorTile=function(a,p,e,m){var w=this,k=new G(a,p,e,0);return c.isSome(this._memCache)&&(a=this._memCache.get(k.id),c.isSome(a))?(a.reference(),d.resolve(a)):this._getVectorTileData(k).then(function(a){d.throwIfAborted(m);if(c.isSome(w._memCache)){var p=w._memCache.get(k.id);if(c.isSome(p))return p.reference(),p}if(!w._vectorTileLayer)return null;p=w._vectorTileLayer.tileInfo.getTileBounds(h.create(),k);p=new q.VectorTile(k,
w._vectorTileLayer.styleRepository,p,[512,512]);a&&a.tileData?(p.setData(a.tileData),c.isSome(w._memCache)&&(p.reference(),a=p.getMemoryUsage(),0<a&&w._memCache.put(p.key.id,p,a*p.referenced,b.MIN_PRIORITY))):p.setData(null);return p})};e.prototype.releaseVectorTile=function(a){c.isNone(this._memCache)||a.release()||this._memCache.updateSize(a.key.id,a,a.getMemoryUsage()*a.referenced)};e.prototype.fetchTileData=function(a,d){var h=this;return this._getRefKeys(a,d).then(function(a){var c=h._vectorTileLayer.sourceNameToSource,
b=[],q;for(q in c)b.push(q);return h._getSourcesData(b,a,d)})};e.prototype.parseTileData=function(a,h){var c=this,b=a&&a.data;if(!b)return d.resolve(null);var q=b.sourceName2DataAndRefKey,p=b.transferList;return 0===Object.keys(q).length?d.resolve(null):this._broadcastPromise.then(function(){return c._connection.getAvailableClient().then(function(d){return d.invoke("createTileAndParse",{key:a.key.id,sourceName2DataAndRefKey:q},g.__assign(g.__assign({},h),{transferList:p})).then(function(a){if(f("esri-vector-tiles-debug")){var d=
{},h;for(h in q)d[h]=q[h].refKey;return{tileData:a,refKeys:d}}return{tileData:a}})})})};Object.defineProperty(e.prototype,"updating",{get:function(){return 0<this._ongoingTileRequests.size},enumerable:!1,configurable:!0});e.prototype.abortAll=function(){this._ongoingRequestToController.forEach(function(a){return a.abort()});this._ongoingRequestToController.clear();this._ongoingTileRequests.clear()};e.prototype.getSprites=function(a){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,
function(d){switch(d.label){case 0:return[4,this._spriteSourcePromise];case 1:return d.sent(),[2,this._spriteMosaic.getSpriteItems(a)]}})})};e.prototype.getGlyphs=function(a){return this._glyphMosaic.getGlyphItems(a.font,a.codePoints)};e.prototype.perfReport=function(a){r.perfAdd(a.key,a.milliseconds,"ms")};e.prototype.getStyleRepository=function(){return this._vectorTileLayer.styleRepository};e.prototype._getTilePayload=function(a,d,h){return g.__awaiter(this,void 0,void 0,function(){var c,b,q,p,
e;return g.__generator(this,function(m){switch(m.label){case 0:return c=G.pool.acquire(a.id),b=this._vectorTileLayer.sourceNameToSource,q=b[d],p=q.getSourceTileUrl(c.level,c.row,c.col),G.pool.release(c),[4,n(p,g.__assign({responseType:"array-buffer"},h))];case 1:return e=m.sent(),[2,{protobuff:e.data,sourceName:d}]}})})};e.prototype._fetchTileMap=function(a,h){if(a.capabilities.operations.supportsTileMap&&a.tileIndex||!a.tileMapURL)return d.resolve();var c=B.get(a.tileMapURL);if(c)return a.tileIndex=
c,d.resolve();if(E.has(a.tileMapURL))return E.get(a.tileMapURL).then(function(d){a.tileIndex=new k(d.data)});h=n(a.tileMapURL,h);h.then(function(d){a.tileIndex=new k(d.data);E["delete"](a.tileMapURL);B.put(a.tileMapURL,a.tileIndex)});E.set(a.tileMapURL,h);return h};e.prototype._getRefKeys=function(a,h){var c=this._vectorTileLayer.sourceNameToSource,b=[],q;for(q in c){var p=c[q].getRefKey(a,h);b.push(p)}return d.eachAlways(b)};e.prototype._getSourcesData=function(a,h,c){for(var b=[],q=0;q<h.length;q++)if(null==
h[q].value||null==a[q])b.push(null);else{var p=this._getTilePayload(h[q].value,a[q],c);b.push(p)}return d.eachAlways(b).then(function(a){for(var d={},c=[],b=0;b<a.length;b++)a[b].value&&a[b].value&&a[b].value.protobuff&&0<a[b].value.protobuff.byteLength&&(d[a[b].value.sourceName]={refKey:h[b].value.id,protobuff:a[b].value.protobuff},c.push(a[b].value.protobuff));return{sourceName2DataAndRefKey:d,transferList:c}})};e.prototype._getVectorTileData=function(a){var d=this,h=a.id;if(this._ongoingTileRequests.has(h))return this._ongoingTileRequests.get(h);
var c=new AbortController;a=this._getParsedVectorTileData(a,{signal:c.signal}).then(function(a){d._ongoingTileRequests.delete(h);d._ongoingRequestToController.delete(h);return a}).catch(function(){d._ongoingTileRequests.delete(h);d._ongoingRequestToController.delete(h);return null});this._ongoingTileRequests.set(h,a);this._ongoingRequestToController.set(h,c);return a};e.prototype._getParsedVectorTileData=function(a,d){var h=this;return this.fetchTileData(a,d).then(function(c){return h.parseTileData({key:a,
data:c},d)})};return e}();l.TileHandler=t})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(t,l,g){return function(){function n(f,e){this._storage=new g.MemCacheStorage;this._storage.maxSize=f;e&&this._storage.registerRemoveFunc("",e)}n.prototype.put=function(f,e){this._storage.put(f,e,1,1)};n.prototype.pop=function(f){return this._storage.pop(f)};n.prototype.get=function(f){return this._storage.get(f)};n.prototype.clear=function(){this._storage.clearAll()};n.prototype.destroy=
function(){this._storage.clearAll()};return n}()})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f32 ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(t,l,g,n,f,e,c,b){Object.defineProperty(l,"__esModule",{value:!0});l.VectorTile=void 0;t=function(d){function a(a,c,b,e){b=d.call(this,a,b,e,[4096,4096])||this;b._referenced=0;b._hasSymbolBuckets=
!1;b._memoryUsedByLayerData=0;b.layerData={};b.layerCount=0;b.status="loading";b.allSymbolsFadingOut=!1;b.lastOpacityUpdate=0;b.symbols=new Map;b.isCoverage=!1;b.neededForCoverage=!1;b.decluttered=!1;b.invalidating=!1;b._referenced=1;b.styleLayers=c;b.id=a.id;b.transforms.tileUnitsToPixels=f.mat3f32.create();return b}g.__extends(a,d);Object.defineProperty(a.prototype,"hasSymbolBuckets",{get:function(){return this._hasSymbolBuckets},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"isFading",{get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<c.FADE_DURATION},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isHoldingForFade",{get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<c.FADE_DURATION)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"wasRequested",{get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===
this.status},enumerable:!1,configurable:!0});a.prototype.setData=function(a){this.changeDataImpl(a);this.requestRender();this.ready();this.invalidating=!1};a.prototype.hasData=function(){return 0<this.layerCount};a.prototype.dispose=function(){a._destroyRenderBuckets(this.layerData);this.layerData={};this._memoryUsedByLayerData=this.layerCount=0;this.destroy()};a.prototype.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};a.prototype.reference=function(){++this._referenced};
Object.defineProperty(a.prototype,"referenced",{get:function(){return this._referenced},enumerable:!1,configurable:!0});a.prototype.getMemoryUsage=function(){return this._memoryUsedByLayerData/(this._referenced||1)};a.prototype.changeDataImpl=function(d){a._destroyRenderBuckets(this.layerData);this.layerData={};this._memoryUsedByLayerData=this.layerCount=0;if(d){d=a._createRenderBuckets(d);for(var h in d)this.layerData[h]&&(this._memoryUsedByLayerData-=this.layerData[h].memoryUsed,this.layerData[h].destroy(),
this.layerData[h]=null,this.layerCount--),this._memoryUsedByLayerData+=d[h].memoryUsed,this.layerData[h]=d[h],this.layerCount++}d=new Map;this._hasSymbolBuckets=!1;for(var c in this.layerData){h=parseInt(c,10);var b=this.layerData[h];3===b.type&&(d.set(h,b.symbols),this._hasSymbolBuckets=!0)}this.symbols=d;this.emit("symbols-changed")};a.prototype.attachWithContext=function(a){this.stage={context:a,trashDisplayObject:function(a){a.processDetach()},untrashDisplayObject:function(){return!1}}};a.prototype.setTransform=
function(a,c){d.prototype.setTransform.call(this,a,c);var h=c/(a.resolution*a.pixelRatio);c=this.size[0]/this.coordRange[0]*h;var h=this.size[1]/this.coordRange[1]*h,b=a.toScreen([0,0],this.coords),q=b[0],b=b[1],e=this.transforms.tileUnitsToPixels;n.mat3.identity(e);n.mat3.translate(e,e,[q,b]);n.mat3.rotate(e,e,Math.PI*a.rotation/180);n.mat3.scale(e,e,[c,h,1])};a._destroyRenderBuckets=function(a){var d=new Set,h;for(h in a){var c=a[h];d.has(c)||(c.destroy(),d.add(c))}};a._createRenderBuckets=function(a){var d=
{},c=0;for(a=a.buckets;c<a.length;c++){var h=a[c],b=void 0;switch((new Uint32Array(h))[0]){case 1:b=new e.FillRenderBucket(h);break;case 2:b=new e.LineRenderBucket(h);break;case 3:b=new e.SymbolRenderBucket(h);break;case 4:b=new e.CircleRenderBucket(h)}for(var h=0,k=b.layerIndices;h<k.length;h++)d[k[h]]=b}return d};return a}(b.TiledDisplayObject);l.VectorTile=t})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("require exports tslib ../../../../core/maybe ../../../webgl ./decluttering/config ./decluttering/util".split(" "),
function(t,l,g,n,f,e,c){Object.defineProperty(l,"__esModule",{value:!0});l.CircleRenderBucket=l.SymbolRenderBucket=l.FillRenderBucket=l.LineRenderBucket=l.RenderBucketBase=void 0;t=function(){function d(a){this.layerIndices=[];this.isDestroyed=!1;this.data=a;this.memoryUsed=a.byteLength;var d=1;a=new Uint32Array(a);this.layerIndices=[];for(var c=a[d++],b=0;b<c;b++)this.layerIndices[b]=a[d++];this.bufferDataOffset=d}Object.defineProperty(d.prototype,"isPreparedForRendering",{get:function(){return n.isNone(this.data)},
enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"offset",{get:function(){return this.bufferDataOffset},enumerable:!1,configurable:!0});d.prototype.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};d.prototype.prepareForRendering=function(a,d){n.isNone(this.data)||(this.doPrepareForRendering(a,d,this.data,this.bufferDataOffset),this.data=null)};return d}();l.RenderBucketBase=t;var b=function(d){function a(a){var c=d.call(this,a)||this;c.type=2;c.lineIndexStart=
0;c.lineIndexCount=0;var b=c.bufferDataOffset;a=new Uint32Array(a);c.lineIndexStart=a[b++];c.lineIndexCount=a[b++];c.isLineDataDriven=!!a[b++];c.bufferDataOffset=b;return c}g.__extends(a,d);a.prototype.hasData=function(){return 0<this.lineIndexCount};a.prototype.triangleCount=function(){return this.lineIndexCount/3};a.prototype.doDestroy=function(){n.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();n.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();n.isSome(this.lineIndexBuffer)&&
this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=null;this.memoryUsed=0};a.prototype.doPrepareForRendering=function(d,c,b,e){b=new Uint32Array(b);var h=new Int32Array(b.buffer),q=b[e++];this.lineVertexBuffer=f.BufferObject.createVertex(d,35044,new Int32Array(h.buffer,4*e,q));e+=q;h=b[e++];this.lineIndexBuffer=f.BufferObject.createIndex(d,35044,new Uint32Array(b.buffer,4*e,h));e+=h;this.lineVertexArrayObject=new f.VertexArrayObject(d,c.getProgramAttributes(3),
this.isLineDataDriven?a.lineVertexAttributesDD:a.lineVertexAttributes,{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};a.lineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]};a.lineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,
normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};return a}(t);l.LineRenderBucket=b;b=function(d){function a(a){var c=d.call(this,a)||this;c.type=1;c.fillIndexStart=0;c.fillIndexCount=0;
c.outlineIndexStart=0;c.outlineIndexCount=0;var b=c.bufferDataOffset;a=new Uint32Array(a);c.fillIndexStart=a[b++];c.fillIndexCount=a[b++];c.outlineIndexStart=a[b++];c.outlineIndexCount=a[b++];c.isFillDataDriven=!!a[b++];c.isOutlineDataDriven=!!a[b++];c.bufferDataOffset=b;return c}g.__extends(a,d);a.prototype.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};a.prototype.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};a.prototype.doDestroy=function(){n.isSome(this.fillVertexArrayObject)&&
this.fillVertexArrayObject.dispose();n.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();n.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;n.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();n.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();n.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=
this.outlineVertexArrayObject=null;this.memoryUsed=0};a.prototype.doPrepareForRendering=function(d,c,b,e){b=new Uint32Array(b);var h=new Int32Array(b.buffer),q=b[e++];this.fillVertexBuffer=f.BufferObject.createVertex(d,35044,new Int32Array(h.buffer,4*e,q));e+=q;q=b[e++];this.fillIndexBuffer=f.BufferObject.createIndex(d,35044,new Uint32Array(b.buffer,4*e,q));e+=q;q=b[e++];this.outlineVertexBuffer=f.BufferObject.createVertex(d,35044,new Int32Array(h.buffer,4*e,q));e+=q;h=b[e++];this.outlineIndexBuffer=
f.BufferObject.createIndex(d,35044,new Uint32Array(b.buffer,4*e,h));e+=h;this.fillVertexArrayObject=new f.VertexArrayObject(d,c.getProgramAttributes(1),this.isFillDataDriven?a.fillVertexAttributesDD:a.fillVertexAttributes,{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new f.VertexArrayObject(d,c.getProgramAttributes(2),this.isOutlineDataDriven?a.outlineVertexAttributesDD:a.outlineVertexAttributes,{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};a.fillVertexAttributes=
{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};a.fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]};a.outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,
offset:6,stride:8,normalized:!1,divisor:0}]};a.outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:12,normalized:!0,divisor:0}]};return a}(t);l.FillRenderBucket=b;b=function(d){function a(a){var b=d.call(this,a)||this;b.type=3;b.iconPerPageElementsMap=
new Map;b.glyphPerPageElementsMap=new Map;b.symbolInstances=[];b.isIconSDF=!1;b.opacityChanged=!1;b.lastOpacityUpdate=0;b.symbols=[];var h=b.bufferDataOffset,m=new Uint32Array(a),u=new Int32Array(a);a=new Float32Array(a);b.isIconSDF=!!m[h++];b.isIconDataDriven=!!m[h++];b.isTextDataDriven=!!m[h++];for(var k=m[h++],r=0;r<k;r++){var f=m[h++],g=m[h++],n=m[h++];b.iconPerPageElementsMap.set(f,[g,n])}k=m[h++];for(r=0;r<k;r++)f=m[h++],g=m[h++],n=m[h++],b.glyphPerPageElementsMap.set(f,[g,n]);f=m[h++];g=m[h++];
b.iconOpacity=new Int32Array(f);b.textOpacity=new Int32Array(g);if(!e.DECLUTTER_TILES){for(r=0;r<f;r++)b.iconOpacity[r]=-1;for(r=0;r<g;r++)b.textOpacity[r]=-1;b.opacityChanged=!0}h=c.deserializeSymbols(m,u,a,h,b.symbols);b.bufferDataOffset=h;return b}g.__extends(a,d);a.prototype.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};a.prototype.triangleCount=function(){var a=0;this.iconPerPageElementsMap.forEach(function(b){a+=b[1]});this.glyphPerPageElementsMap.forEach(function(b){a+=
b[1]});return a/3};a.prototype.doDestroy=function(){n.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();n.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();n.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();n.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;n.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();n.isSome(this.textVertexBuffer)&&
this.textVertexBuffer.dispose();n.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();n.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};a.prototype.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var a=n.unwrap(this.iconOpacity),b=n.unwrap(this.iconOpacityBuffer);0<a.length&&a.byteLength===b.size&&b.setSubData(a);a=n.unwrap(this.textOpacity);
b=n.unwrap(this.textOpacityBuffer);0<a.length&&a.byteLength===b.size&&b.setSubData(a)}};a.prototype.doPrepareForRendering=function(b,d,c,e){c=new Uint32Array(c);var h=new Int32Array(c.buffer),q=c[e++];this.iconVertexBuffer=f.BufferObject.createVertex(b,35044,new Int32Array(h.buffer,4*e,q));e+=q;q=c[e++];this.iconIndexBuffer=f.BufferObject.createIndex(b,35044,new Uint32Array(c.buffer,4*e,q));e+=q;q=c[e++];this.textVertexBuffer=f.BufferObject.createVertex(b,35044,new Int32Array(h.buffer,4*e,q));e+=
q;h=c[e++];this.textIndexBuffer=f.BufferObject.createIndex(b,35044,new Uint32Array(c.buffer,4*e,h));e+=h;this.iconOpacityBuffer=f.BufferObject.createVertex(b,35044,n.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=f.BufferObject.createVertex(b,35044,n.unwrap(this.textOpacity).buffer);this.iconVertexArrayObject=new f.VertexArrayObject(b,d.getProgramAttributes(4),this.isIconDataDriven?a.vertexAttributesDD:a.vertexAttributes,{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);
this.textVertexArrayObject=new f.VertexArrayObject(b,d.getProgramAttributes(6),this.isTextDataDriven?a.vertexAttributesDD:a.vertexAttributes,{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};a.vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},
{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],opacity:[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}]};a.vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,
stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}],opacity:[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}]};return a}(t);l.SymbolRenderBucket=b;t=function(b){function a(a){var d=b.call(this,a)||this;d.type=4;d.circleIndexStart=0;d.circleIndexCount=0;var c=d.bufferDataOffset;a=new Uint32Array(a);d.circleIndexStart=a[c++];
d.circleIndexCount=a[c++];d.bufferDataOffset=c;return d}g.__extends(a,b);a.prototype.hasData=function(){return 0<this.circleIndexCount};a.prototype.triangleCount=function(){return this.circleIndexCount/3};a.prototype.doDestroy=function(){n.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();n.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();n.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=
null;this.memoryUsed=0};a.prototype.doPrepareForRendering=function(b,d,c,e){c=new Uint32Array(c);var h=new Int32Array(c.buffer),q=c[e++];this.circleVertexBuffer=f.BufferObject.createVertex(b,35044,new Int32Array(h.buffer,4*e,q));e+=q;h=c[e++];this.circleIndexBuffer=f.BufferObject.createIndex(b,35044,new Uint32Array(c.buffer,4*e,h));e+=h;this.circleVertexArrayObject=new f.VertexArrayObject(b,d.getProgramAttributes(5),a.circleVertexAttributes,{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};
a.circleVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,normalized:!0,divisor:0},{name:"a_data",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};return a}(t);l.CircleRenderBucket=t})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["require","exports","../../../../../core/maybe",
"./core"],function(t,l,g,n){Object.defineProperty(l,"__esModule",{value:!0});l.writeOpacityToBuffers=l.deserializeSymbols=l.GridIndex=l.tileCoordChange=l.TileForest=l.TileGraph=l.TileNode=void 0;var f=function(){return function(c){this.tile=c;this.parent=null;this.children=new Set}}();l.TileNode=f;var e=function(){function c(){this.nodes=new Map;this.roots=new Set}c.prototype.create=function(b){var d=this,a=new f(b),c,e=[];this.nodes.forEach(function(b){d._canConnectDirectly(a,b)&&e.push(b);!c&&d._canConnectDirectly(b,
a)&&(c=b)});if(c){for(var p=0;p<e.length;p++){var m=e[p];c.children.delete(m);a.children.add(m);m.parent=a}c.children.add(a);a.parent=c}else for(this.roots.add(a),p=0;p<e.length;p++)m=e[p],a.children.add(m),m.parent=a,this.roots.delete(m);this.nodes.set(b.key.id,a);return a};c.prototype.destroy=function(b){var d=this;g.isSome(b.parent)?(b.parent.children.delete(b),b.children.forEach(function(a){g.isSome(b.parent)&&b.parent.children.add(a)})):this.roots.delete(b);b.children.forEach(function(a){(a.parent=
b.parent)||d.roots.add(a)});this.nodes.delete(b.tile.key.id)};c.prototype.clear=function(){this.roots.clear();this.nodes.clear()};c.prototype._canConnectDirectly=function(b,d){var a=d.tile.key,c=a.level,e=a.row,a=a.col;for(d=d.tile.key.world;0<c;){c--;e>>=1;a>>=1;if(b.tile.key.level===c&&b.tile.key.row===e&&b.tile.key.col===a&&b.tile.key.world===d)return!0;if(this.nodes.has(c+"/"+e+"/"+a+"/"+d))break}return!1};return c}();l.TileGraph=e;t=function(){function c(){this._tileGraph=new e;this._tileArray=
null}c.prototype.has=function(b){return this.hasKey(b.key.id)};c.prototype.getAll=function(){var b=this;this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(function(c){b._tileArray.push(c.tile)}));return this._tileArray};c.prototype.getRoots=function(){var b=[];this._tileGraph.roots.forEach(function(c){b.push(c.tile)});return b};c.prototype.getParent=function(b){b=this._tileGraph.nodes.get(b.key.id);return g.isSome(b.parent)&&b.parent.tile};c.prototype.getChildren=function(b){var c=
[];this._tileGraph.nodes.get(b.key.id).children.forEach(function(a){c.push(a.tile)});return c};c.prototype.get=function(b){return this._tileGraph.nodes.get(b).tile};c.prototype.hasKey=function(b){return this._tileGraph.nodes.has(b)};c.prototype.removeKey=function(b){b=this._tileGraph.nodes.get(b);this._tileGraph.destroy(b);this._tileArray=null};c.prototype.forEach=function(b){this._tileGraph.nodes.forEach(function(c,a){return b(c.tile,a)})};c.prototype.add=function(b){this._tileGraph.create(b);this._tileArray=
null};c.prototype.remove=function(b){b=this._tileGraph.nodes.get(b.key.id);this._tileGraph.destroy(b);this._tileArray=null};c.prototype.clear=function(){this._tileGraph.clear();this._tileArray=[]};return c}();l.TileForest=t;l.tileCoordChange=function(c,b,d,a,h,e){d-=h;if(0<=d)return(b>>d)+(a-(e<<d))*(c>>d);d=-d;return b-(e-(a<<d))*(c>>d)<<d};t=function(){function c(b,c,a){this._rows=Math.ceil(c/a);this._columns=Math.ceil(b/a);this._cellSize=a;this.cells=Array(this._rows);for(b=0;b<this._rows;b++)for(this.cells[b]=
Array(this._columns),c=0;c<this._columns;c++)this.cells[b][c]=[]}c.prototype.getCell=function(b,c){c=Math.min(Math.max(Math.floor(c/this._cellSize),0),this._rows-1);b=Math.min(Math.max(Math.floor(b/this._cellSize),0),this._columns-1);return this.cells[c]&&this.cells[c][b]||null};c.prototype.getCellSpan=function(c,d,a,h){return[Math.min(Math.max(Math.floor(c/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(d/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(a/this._cellSize),
0),this.columns-1),Math.min(Math.max(Math.floor(h/this._cellSize),0),this.rows-1)]};Object.defineProperty(c.prototype,"cellSize",{get:function(){return this._cellSize},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"columns",{get:function(){return this._columns},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"rows",{get:function(){return this._rows},enumerable:!1,configurable:!0});return c}();l.GridIndex=t;l.deserializeSymbols=function(c,b,d,a,h){for(var e=b[a++],
p=0;p<e;p++){var m=new n.VTLSymbol;m.xTile=b[a++];m.yTile=b[a++];m.hash=b[a++];m.priority=b[a++];for(var f=b[a++],k=0;k<f;k++){var r=b[a++],g=b[a++],B=b[a++],l=b[a++],x=!!b[a++],w=b[a++],H=d[a++],K=d[a++],I=b[a++],t=b[a++];m.colliders.push({xTile:r,yTile:g,dxPixels:B,dyPixels:l,hard:x,partIndex:w,width:I,height:t,minLod:H,maxLod:K})}f=c[a++];for(k=0;k<f;k++)m.textVertexRanges.push([c[a++],c[a++]]);f=c[a++];for(k=0;k<f;k++)m.iconVertexRanges.push([c[a++],c[a++]]);h.push(m)}return a};l.writeOpacityToBuffers=
function(c,b,d){c.symbols.forEach(function(a,h){h=c.layerData[h];if(3===h.type){for(var e=0;e<a.length;e++){var p=a[e],m=p.unique,f=void 0;if(p.selectedForRendering){var k=m.parts[0],f=k.startOpacity,k=k.targetOpacity;c.allSymbolsFadingOut=c.allSymbolsFadingOut&&0===k;f=d?Math.floor(127*f)|k<<7:k?255:0;f|=f<<24|f<<16|f<<8}else f=0;for(var r=0,g=p.iconVertexRanges;r<g.length;r++)for(var k=g[r],n=k[0],l=k[1],k=n;k<n+l;k+=4)h.iconOpacity[k/4]=f;p.selectedForRendering?(m=m.parts[1],f=m.startOpacity,k=
m.targetOpacity,c.allSymbolsFadingOut=c.allSymbolsFadingOut&&0===k,f=d?Math.floor(127*f)|k<<7:k?255:0,f|=f<<24|f<<16|f<<8):f=0;m=0;for(p=p.textVertexRanges;m<p.length;m++)for(k=p[m],r=k[0],g=k[1],k=r;k<r+g;k+=4)h.textOpacity[k/4]=f}h.lastOpacityUpdate=b;h.opacityChanged=!0}})}})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["require","exports"],function(t,l){Object.defineProperty(l,"__esModule",{value:!0});l.VTLUniqueSymbol=l.VTLSymbol=void 0;t=function(){return function(){this.hash=
this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[]}}();l.VTLSymbol=t;t=function(){return function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1;this.visible=!0}}();l.VTLUniqueSymbol=t})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define("require exports ../../../../core/has ../../../../core/promiseUtils ../../../webgl ./RectangleBinPack ../webgl/Rect".split(" "),
function(t,l,g,n,f,e,c){return function(){function b(c,a,b){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=c;this.height=a;this._glyphSource=b;this._binPack=new e(c-4,a-4);this._glyphData.push(new Uint8Array(c*a));this._dirties.push(!0);this._textures.push(void 0)}b.prototype.getGlyphItems=function(b,a){for(var d=this,q=[],f=this._glyphSource,m=new Set,g=1/256,k=0;k<a.length;k++)m.add(Math.floor(a[k]*
g));var r=[];m.forEach(function(a){if(256>=a){var c=b+a;d._rangePromises.has(c)?r.push(d._rangePromises.get(c)):(a=f.getRange(b,a).then(function(){d._rangePromises["delete"](c)},function(){d._rangePromises["delete"](c)}),d._rangePromises.set(c,a),r.push(a))}});return n.all(r).then(function(){var h,r=d._glyphIndex[b];r||(r={},d._glyphIndex[b]=r);for(var k=0;k<a.length;k++){h=a[k];var p=r[h];if(p)q[h]={sdf:!0,rect:p.rect,metrics:p.metrics,page:p.page,code:h};else{var w=f.getGlyph(b,h);if(w&&w.metrics){var p=
w.metrics,m=void 0;if(0===p.width)m=new c.default(0,0,0,0);else{var g=p.width+6,u=p.height+6,n=g%4?4-g%4:4,l=u%4?4-u%4:4;1===n&&(n=5);1===l&&(l=5);m=d._binPack.allocate(g+n,u+l);m.isEmpty&&(d._dirties[d._currentPage]||(d._glyphData[d._currentPage]=null),d._currentPage=d._glyphData.length,d._glyphData.push(new Uint8Array(d.width*d.height)),d._dirties.push(!0),d._textures.push(void 0),d._binPack=new e(d.width-4,d.height-4),m=d._binPack.allocate(g+n,u+l));var n=d._glyphData[d._currentPage],w=w.bitmap,
t=l=void 0;if(w)for(var C=0;C<u;C++)for(var l=g*C,t=d.width*(m.y+C+1)+m.x,z=0;z<g;z++)n[t+z+1]=w[l+z]}r[h]={rect:m,metrics:p,tileIDs:null,page:d._currentPage};q[h]={sdf:!0,rect:m,metrics:p,page:d._currentPage,code:h};d._dirties[d._currentPage]=!0}}}return q})};b.prototype.removeGlyphs=function(c){for(var a in this._glyphIndex){var b=this._glyphIndex[a];if(b){var d=void 0,e;for(e in b)if(d=b[e],d.tileIDs["delete"](c),0===d.tileIDs.size){for(var f=this._glyphData[d.page],g=d.rect,k=void 0,r=void 0,
n=0;n<g.height;n++)for(k=this.width*(g.y+n)+g.x,r=0;r<g.width;r++)f[k+r]=0;delete b[e];this._dirties[d.page]=!0}}}};b.prototype.bind=function(c,a,b,e){void 0===e&&(e=0);this._textures[b]||(this._textures[b]=new f.Texture(c,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var d=this._textures[b];d.setSamplingMode(a);this._dirties[b]&&d.setData(this._glyphData[b]);c.bindTexture(d,e);this._dirties[b]=!1};b.prototype.dispose=function(){this._binPack=
null;for(var c=0,a=this._textures;c<a.length;c++){var b=a[c];b&&b.dispose()}this._textures.length=0};return b}()})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["require","exports","../webgl/Rect"],function(t,l,g){return function(){function n(f,e){this._height=this._width=0;this._free=[];this._width=f;this._height=e;this._free.push(new g.default(0,0,f,e))}Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,
"height",{get:function(){return this._height},enumerable:!1,configurable:!0});n.prototype.allocate=function(f,e){if(f>this._width||e>this._height)return new g.default;for(var c=null,b=-1,d=0;d<this._free.length;++d){var a=this._free[d];f<=a.width&&e<=a.height&&(null===c||a.y<=c.y&&a.x<=c.x)&&(c=a,b=d)}if(null===c)return new g.default;this._free.splice(b,1);c.width<c.height?(c.width>f&&this._free.push(new g.default(c.x+f,c.y,c.width-f,e)),c.height>e&&this._free.push(new g.default(c.x,c.y+e,c.width,
c.height-e))):(c.width>f&&this._free.push(new g.default(c.x+f,c.y,c.width-f,c.height)),c.height>e&&this._free.push(new g.default(c.x,c.y+e,f,c.height-e)));return new g.default(c.x,c.y,f,e)};n.prototype.release=function(f){for(var e=0;e<this._free.length;++e){var c=this._free[e];if(c.y===f.y&&c.height===f.height&&c.x+c.width===f.x)c.width+=f.width;else if(c.x===f.x&&c.width===f.width&&c.y+c.height===f.y)c.height+=f.height;else if(f.y===c.y&&f.height===c.height&&f.x+f.width===c.x)c.x=f.x,c.width+=f.width;
else if(f.x===c.x&&f.width===c.width&&f.y+f.height===c.y)c.y=f.y,c.height+=f.height;else continue;this._free.splice(e,1);this.release(f)}this._free.push(f)};return n}()})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define("require exports ../../../../request ../../../../core/has ../../../../core/pbf ../../../../core/promiseUtils".split(" "),function(t,l,g,n,f,e){var c=function(){function c(a){this._metrics=[];this._bitmaps=[];if(a)for(;a.next();)switch(a.tag()){case 1:for(var c=a.getMessage();c.next();)switch(c.tag()){case 3:for(var b=
c.getMessage(),d=void 0,e=void 0,f=void 0,k=void 0,r=void 0,g=void 0,n=void 0;b.next();)switch(b.tag()){case 1:d=b.getUInt32();break;case 2:e=b.getBytes();break;case 3:f=b.getUInt32();break;case 4:k=b.getUInt32();break;case 5:r=b.getSInt32();break;case 6:g=b.getSInt32();break;case 7:n=b.getUInt32();break;default:b.skip()}b.release();d&&(this._metrics[d]={width:f,height:k,left:r,top:g,advance:n},this._bitmaps[d]=e);break;default:c.skip()}c.release();break;default:a.skip()}}c.prototype.getMetrics=function(a){return this._metrics[a]};
c.prototype.getBitmap=function(a){return this._bitmaps[a]};return c}(),b=function(){function b(){this._ranges=[]}b.prototype.getRange=function(a){return this._ranges[a]};b.prototype.addRange=function(a,b){this._ranges[a]=b};return b}();return function(){function d(a){this._glyphInfo={};this._baseURL=a}d.prototype.getRange=function(a,b){var d=this._getFontStack(a);if(d.getRange(b))return e.resolve();var h=256*b,m=h+255;a=this._baseURL.replace("{fontstack}",a).replace("{range}",h+"-"+m);return g(a,
{responseType:"array-buffer"}).then(function(a){d.addRange(b,new c(new f(new Uint8Array(a.data),new DataView(a.data))))}).catch(function(){d.addRange(b,new c)})};d.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}};d.prototype._getFontStack=function(a){var c=this._glyphInfo[a];c||(c=this._glyphInfo[a]=new b);return c};return d}()})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define(["require",
"exports","../../../webgl","./RectangleBinPack","../webgl/Rect"],function(t,l,g,n,f){return function(){function e(c,b,d){void 0===d&&(d=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=c||0>=b)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=c;this._pageHeight=b;0<d&&(this._maxItemSize=d);this._binPack=
new n(c-4,b-4)}e.prototype.getWidth=function(c){return c>=this._size.length?-1:this._size[c][0]};e.prototype.getHeight=function(c){return c>=this._size.length?-1:this._size[c][1]};e.prototype.setSpriteSource=function(c){this.dispose();this.pixelRatio=c.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new n(this._pageWidth-4,this._pageHeight-4);var b=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._mosaicsData[0]=b;this._dirties.push(!0);this._size.push([this._pageWidth,
this._pageHeight]);this._textures.push(void 0)}this._sprites=c};e.prototype.getSpriteItem=function(c,b){void 0===b&&(b=!1);var d=this._mosaicRects[c];if(d)return d;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;d=this._sprites.getSpriteInfo(c);if(!d||!d.width||!d.height||0>d.width||0>d.height)return null;var a=d.width,e=d.height,f=this._allocateImage(a,e),p=f[0],m=f[1];if(0>=p.width)return null;this._copy(p,d,m,f[2],b);d={rect:p,width:a,height:e,sdf:d.sdf,simplePattern:!1,pixelRatio:d.pixelRatio,
page:m};return this._mosaicRects[c]=d};e.prototype.preloadSpriteItems=function(){for(var c=0,b=this._sprites.spriteNames;c<b.length;c++)this.getSpriteItem(b[c],!0)};e.prototype.getSpriteItems=function(c){for(var b={},d=0;d<c.length;d++){var a=c[d];b[a]=this.getSpriteItem(a)}return b};e.prototype.getMosaicItemPosition=function(c,b){b=(c=this.getSpriteItem(c,b))&&c.rect;if(!b)return null;b.width=c.width;b.height=c.height;var d=this._size[c.page];return{size:[c.width,c.height],tl:[(b.x+2)/d[0],(b.y+
2)/d[1]],br:[(b.x+2+c.width)/d[0],(b.y+2+c.height)/d[1]],page:c.page}};e.prototype.bind=function(c,b,d,a){void 0===d&&(d=0);void 0===a&&(a=0);this._textures[d]||(this._textures[d]=new g.Texture(c,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[d][0],height:this._size[d][1]},new Uint8Array(this._mosaicsData[d].buffer)));var e=this._textures[d];e.setSamplingMode(b);this._dirties[d]&&e.setData(new Uint8Array(this._mosaicsData[d].buffer));c.bindTexture(e,a);this._dirties[d]=!1};e._copyBits=
function(c,b,d,a,e,f,p,m,g,k,r){var h=a*b+d;p=m*f+p;if(r)for(p-=f,r=-1;r<=k;r++,h=((r+k)%k+a)*b+d,p+=f)for(m=-1;m<=g;m++)e[p+m]=c[h+(m+g)%g];else for(r=0;r<k;r++){for(m=0;m<g;m++)e[p+m]=c[h+m];h+=b;p+=f}};e.prototype._copy=function(c,b,d,a,h,f){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(d>=this._mosaicsData.length)){var p=new Uint32Array(f?f.buffer:this._sprites.image.buffer),m=this._mosaicsData[d];m&&p||console.error("Source or target images are uninitialized!");e._copyBits(p,f?b.width:
this._sprites.width,b.x,b.y,m,a[0],c.x+2,c.y+2,b.width,b.height,h);this._dirties[d]=!0}};e.prototype._allocateImage=function(c,b){c+=2;b+=2;var d=Math.max(c,b);if(this._maxItemSize&&this._maxItemSize<d)return d=new f.default(0,0,c,b),this._mosaicsData.push(new Uint32Array(c*b)),this._dirties.push(!0),this._size.push([c,b]),this._textures.push(void 0),[d,this._mosaicsData.length-1,[c,b]];var d=c%4?4-c%4:4,a=b%4?4-b%4:4;1===d&&(d=5);1===a&&(a=5);d=this._binPack.allocate(c+d,b+a);return 0>=d.width?(this._dirties[this._currentPage]||
(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new n(this._pageWidth-4,this._pageHeight-4),this._allocateImage(c,b)):[d,this._currentPage,[this._pageWidth,this._pageHeight]]};e.prototype.dispose=function(){this._binPack=null;this._mosaicRects={};for(var c=0,b=this._textures;c<
b.length;c++){var d=b[c];d&&d.dispose()}this._textures.length=0};return e}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["require","exports","../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(t,l,g,n,f){return function(){function e(c){if(c instanceof n.TilemapCache)this._tilemapCache=c;else if(c&&"index"in c)this._tilemap=c.index;else throw Error("Invalid tilemap!");}e.prototype.dataKey=function(c,b){if(this._tilemapCache){var d=
c.level,a=c.row,e=c.col,q=new f(c);return this._tilemapCache.fetchAvailabilityUpsample(d,a,e,q,b).then(function(){return q}).catch(function(a){if(g.isAbortError(a))throw a;return null})}return this._getIndexedDataKey(c)};e.prototype.forEach=function(c,b,d,a,e){this._callback=e;this._maxLevel=b+c;this._forEach(this._tilemap,b,d,a)};e.prototype._forEach=function(c,b,d,a){0!==c&&(this._callback(b,d,a),b!==this._maxLevel&&"object"===typeof c&&(this._forEach(c[0],b+1,2*d,2*a),this._forEach(c[1],b+1,2*
d,2*a+1),this._forEach(c[2],b+1,2*d+1,2*a),this._forEach(c[3],b+1,2*d+1,2*a+1)))};e.prototype._getIndexedDataKey=function(c){var b=[c];if(0>c.level||0>c.row||0>c.col||0<c.row>>c.level||0<c.col>>c.level)return g.resolve(null);for(;0!==c.level;)c=new f(c.level-1,c.row>>1,c.col>>1,c.world),b.push(c);c=this._tilemap;var d=b.pop(),a,e;if(1===c)return g.resolve(d);for(;b.length;)if(a=b.pop(),e=(a.col&1)+((a.row&1)<<1),c){if(0===c[e]){d=null;break}if(1===c[e]){d=a;break}d=a;c=c[e]}return g.resolve(d)};return e}()})},
"esri/layers/support/TilemapCache":function(){define("require exports tslib ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),function(t,l,g,n,f,e,c,b,d,a,h,q,p,m,u,k){Object.defineProperty(l,"__esModule",{value:!0});l.TilemapCache=void 0;var r=b.getLogger("esri.layers.support.TilemapCache");
t=function(b){function f(a){a=b.call(this,a)||this;a._handles=new c;a._pendingTilemapRequests={};a._availableLevels={};a.levels=5;a.cacheByteSize=2097152;a.request=n;a._prefetchingEnabled=!0;return a}g.__extends(f,b);l=f;f.prototype.initialize=function(){var a=this;this._tilemapCache=new d(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],function(){return a._initializeTilemapDefinition()}),m.init(this,"layer.tileInfo.lods",function(b){return a._initializeAvailableLevels(b)},
!0)]);this._initializeTilemapDefinition()};f.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};f.prototype.castLevels=function(a){return 2>=a?(r.error("Minimum levels for Tilemap is 3, but got ",a),3):a};Object.defineProperty(f.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!1,configurable:!0});f.prototype.fetchTilemap=function(a,b,c,d){var f=this;if(!this._availableLevels[a])return h.reject(new e("tilemap-cache:level-unavailable","Level "+
a+" is unavailable in the service"));var r=this._tmpTilemapDefinition;if(a=this._tilemapFromCache(a,b,c,r))return h.resolve(a);var w=d&&d.signal;d=g.__assign(g.__assign({},d),{signal:null});return h.create(function(a,b){h.onAbort(w,function(){return b(h.createAbortError())});var c=k.tilemapDefinitionId(r),e=f._pendingTilemapRequests[c];if(!e){var e=k.Tilemap.fromDefinition(r,d).then(function(a){f._tilemapCache.put(c,a,a.byteSize);return a}),m=function(){return delete f._pendingTilemapRequests[c]};
f._pendingTilemapRequests[c]=e;e.then(m,m)}e.then(a,b)})};f.prototype.getAvailability=function(a,b,c){return this._availableLevels[a]?(a=this._tilemapFromCache(a,b,c,this._tmpTilemapDefinition))?a.getAvailability(b,c):"unknown":"unavailable"};f.prototype.getAvailabilityUpsample=function(a,b,c,d){d.level=a;d.row=b;d.col=c;a=this.layer.tileInfo;for(a.updateTileInfo(d);;)if(b=this.getAvailability(d.level,d.row,d.col),"unavailable"===b){if(!a.upsampleTile(d))return"unavailable"}else return b};f.prototype.fetchAvailability=
function(a,b,c,d){return this._availableLevels[a]?this.fetchTilemap(a,b,c,d).catch(function(a){return a}).then(function(d){if(d instanceof k.Tilemap)return d=d.getAvailability(b,c),"unavailable"===d?h.reject(new e("tile-map:tile-unavailable","Tile is not available",{level:a,row:b,col:c})):d;if(h.isAbortError(d))throw d;return"unknown"}):h.reject(new e("tilemap-cache:level-unavailable","Level "+a+" is unavailable in the service"))};f.prototype.fetchAvailabilityUpsample=function(a,b,c,d,e){var f=this;
d.level=a;d.row=b;d.col=c;var r=this.layer.tileInfo;r.updateTileInfo(d);var k=this.fetchAvailability(a,b,c,e).catch(function(a){if(h.isAbortError(a))throw a;if(r.upsampleTile(d))return f.fetchAvailabilityUpsample(d.level,d.row,d.col,d);throw a;});this._fetchAvailabilityUpsamplePrefetch(d.id,a,b,c,e,k);return k};f.prototype._fetchAvailabilityUpsamplePrefetch=function(a,b,c,d,e,f){return g.__awaiter(this,void 0,void 0,function(){var r,k,m,w,p,n,u,x,G,H;return g.__generator(this,function(B){switch(B.label){case 0:if(!this._prefetchingEnabled)return[2];
r="prefetch-"+a;if(this._handles.has(r))return[2];k=h.createAbortController();f.then(function(){return k.abort()},function(){return k.abort()});m=!1;w={remove:function(){m||(m=!0,k.abort())}};this._handles.add(w,r);B.label=1;case 1:return B.trys.push([1,3,,4]),[4,q.waitTicks(10,k.signal)];case 2:return B.sent(),[3,4];case 3:return B.sent(),[3,4];case 4:m||(m=!0,this._handles.remove(r));if(h.isAborted(k))return[2];p={id:a,level:b,row:c,col:d};n=g.__assign(g.__assign({},e),{signal:k.signal});u=this.layer.tileInfo;
x=function(a){var b=G.fetchAvailability(p.level,p.row,p.col,n);l._prefetches.push(b);a=function(){l._prefetches.removeUnordered(b)};b.then(a,a)};G=this;for(H=0;l._prefetches.length<l._maxPrefetch&&u.upsampleTile(p);++H)x(H);return[2]}})})};f.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var a=this.layer.parsedUrl,b=a.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:a.path,query:b?p.objectToQuery(b):null,tileServers:this.layer.tileServers,request:this.request,
type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};f.prototype._tilemapFromCache=function(a,b,c,d){d.level=a;d.row=b-b%this.size;d.col=c-c%this.size;a=k.tilemapDefinitionId(d);return this._tilemapCache.get(a)};f.prototype._initializeAvailableLevels=function(a){var b=this;this._availableLevels={};a&&a.forEach(function(a){return b._availableLevels[a.level]=!0})};Object.defineProperty(f.prototype,"test",{get:function(){var a=this;return{get prefetchingEnabled(){return a._prefetchingEnabled},
set prefetchingEnabled(b){a._prefetchingEnabled=b},hasTilemap:function(b,c,d){return!!a._tilemapFromCache(b,c,d,a._tmpTilemapDefinition)}}},enumerable:!1,configurable:!0});var l;f._maxPrefetch=4;f._prefetches=new a({initialSize:l._maxPrefetch});g.__decorate([u.property({constructOnly:!0,type:Number})],f.prototype,"levels",void 0);g.__decorate([u.cast("levels")],f.prototype,"castLevels",null);g.__decorate([u.property({readOnly:!0,dependsOn:["levels"],type:Number})],f.prototype,"size",null);g.__decorate([u.property({constructOnly:!0,
type:Number})],f.prototype,"cacheByteSize",void 0);g.__decorate([u.property({constructOnly:!0})],f.prototype,"layer",void 0);g.__decorate([u.property({constructOnly:!0})],f.prototype,"request",void 0);return f=l=g.__decorate([u.subclass("esri.layers.support.TilemapCache")],f)}(f);l.TilemapCache=t})},"esri/layers/support/Tilemap":function(){define("require exports tslib ../../request ../../core/arrayUtils ../../core/Error ../../core/lang".split(" "),function(t,l,g,n,f,e,c){function b(b){var a;"vector-tile"===
b.service.type?a=b.service.url+"/tilemap/"+b.level+"/"+b.row+"/"+b.col+"/"+b.width+"/"+b.height:(a=b.service.tileServers,a=(a&&a.length?a[b.row%a.length]:b.service.url)+"/tilemap/"+b.level+"/"+b.row+"/"+b.col+"/"+b.width+"/"+b.height);(b=b.service.query)&&(a=a+"?"+b);return a}Object.defineProperty(l,"__esModule",{value:!0});l.tilemapDefinitionUrl=l.tilemapDefinitionId=l.Tilemap=void 0;t=function(){function d(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=
40}d.prototype.getAvailability=function(a,b){if("unknown"!==this._allAvailability)return this._allAvailability;a=(a-this.location.top)*this.location.width+(b-this.location.left);b=a>>3;var c=this._tileAvailabilityBitSet;return 0>b||b>c.length?"unknown":c[b]&1<<a%8?"available":"unavailable"};d.prototype._updateFromData=function(a){for(var b=!0,c=!0,d=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),e=0,f=0;f<a.length;f++){var k=f%8;a[f]?(c=!1,d[e]|=1<<k):b=!1;7===k&&++e}c?this._allAvailability=
"unavailable":b?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=d,this.byteSize+=d.length)};d.fromDefinition=function(a,c){var h=a.service.request||n,p=a.row,m=a.col,u=a.width,k=a.height,r={query:{f:"json"}};c=c?g.__assign(g.__assign({},r),c):r;return h(b(a),c).then(function(a){return a.data}).catch(function(a){if(a&&a.details&&422===a.details.httpStatus)return{location:{top:p,left:m,width:u,height:k},valid:!0,data:f.constant(u*k,0)};throw a;}).then(function(a){if(a.location&&
(a.location.top!==p||a.location.left!==m||a.location.width!==u||a.location.height!==k))throw new e("tilemap:location-mismatch","Tilemap response for different location than requested",{response:a,definition:{top:p,left:m,width:u,height:k}});return d.fromJSON(a)})};d.fromJSON=function(a){d.validateJSON(a);var b=new d;b.location=Object.freeze(c.clone(a.location));b._updateFromData(a.data);return Object.freeze(b)};d.validateJSON=function(a){if(!a||!a.location)throw new e("tilemap:missing-location","Location missing from tilemap response");
if(!1===a.valid)throw new e("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new e("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new e("tilemap:data-mismatch","Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new e("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return d}();l.Tilemap=t;l.tilemapDefinitionId=function(b){return b.level+"/"+
b.row+"/"+b.col+"/"+b.width+"/"+b.height};l.tilemapDefinitionUrl=b;l.default=t})},"esri/views/2d/engine/vectorTiles/decluttering/debugging":function(){define(["require","exports"],function(t,l){Object.defineProperty(l,"__esModule",{value:!0});l.perfElement=l.perfClear=l.perfAdd=l.drawColliders=l.drawGridIndex=void 0;l.drawGridIndex=function(g,n){g.strokeStyle="black";for(var f=n.cellSize,e=n.rows,c=n.columns,b=0;b<e;b++)for(var d=n.cells[b],a=b*f,h=(b+1)*f,q=0;q<c;q++){var p=d[q],m=q*f;g.strokeRect(m,
a,(q+1)*f-m,h-a);g.fillText("cells:"+p.length,m+4,a+12)}};l.drawColliders=function(g,n){for(var f=window.COLLISION_XRAY,e=0;e<n.length;++e){var c=!n[e].unique.show;if(f||!c)for(var b=0,d=n[e].colliders;b<d.length;b++){var a=d[b];if(a.enabled){var h=!n[e].unique.parts[a.partIndex].show;if(f||!h){var q=a.xScreen,p=a.yScreen,m=a.dxScreen,u=a.dyScreen;g.globalAlpha=c||h?.2:1;var h=g,k=q-1,r=p-1;h.fillStyle="green";h.fillRect(k,r,3,3);var h=g,k=q+m,r=p+u,l=a.width,a=a.height;h.strokeStyle="red";h.strokeRect(k,
r,l,a);a=g;q=q+m-1;p=p+u-1;a.fillStyle="blue";a.fillRect(q,p,3,3);g.globalAlpha=1}}}}};l.perfAdd=function(g,n,f){if(window.PERFORMANCE_RECORDING_STORAGE){var e=window.PERFORMANCE_RECORDING_STORAGE;e.perf=e.perf||{};e=e.perf;e[g]=e[g]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:f};e[g].time+=n;e[g].samples.push(n);if(null==e[g].min||n<e[g].min)e[g].min=n;if(null==e[g].max||n>e[g].max)e[g].max=n}};l.perfClear=function(){window.PERFORMANCE_RECORDING_STORAGE&&(window.PERFORMANCE_RECORDING_STORAGE.perf=
{})};l.perfElement=function(g){if(!window.PERFORMANCE_RECORDING_STORAGE){var n=document.createElement("div");n.innerHTML="No recorded data is present because performance recording is disabled.";return n}var n=document.createElement("div"),f,e=window.PERFORMANCE_RECORDING_STORAGE.perf;f='\x3ctable style\x3d"border-collapse: collapse;"\x3e'+('\x3ctr style\x3d"text-weight: bold; border-bottom: 1px solid "'+g+'";"\x3e\x3ctd\x3eName\x3c/td\x3e\x3ctd\x3eTotal\x3c/td\x3e\x3ctd\x3eRuns\x3c/td\x3e\x3ctd\x3eAverage\x3c/td\x3e\x3ctd\x3eMin\x3c/td\x3e\x3ctd\x3eDistribution\x3c/td\x3e\x3ctd\x3eMax\x3c/td\x3e\x3ctd\x3eHistogram (50 bins)\x3c/td\x3e\x3c/tr\x3e');
var c=[],b;for(b in e)c.push({name:b,value:e[b].time/e[b].samples.length,sortkey:e[b].max});c.sort(function(a,b){return-(a.sortkey-b.sortkey)});b=c.map(function(a){return a.name});for(var d=0;d<b.length;d++){var a=b[d];f+="\x3ctr\x3e";f+="\x3ctd\x3e"+a+"\x3c/td\x3e";f+="\x3ctd\x3e"+(""+Math.round(10*e[a].time)/10+e[a].unit)+"\x3c/td\x3e";f+="\x3ctd\x3e"+e[a].samples.length+"\x3c/td\x3e";f+="\x3ctd\x3e"+(""+Math.round(e[a].time/e[a].samples.length*10)/10+e[a].unit)+"\x3c/td\x3e";f+='\x3ctd style\x3d"text-align: right;"\x3e'+
(""+Math.round(10*e[a].min)/10+e[a].unit)+"\x3c/td\x3e";f+="\x3ctd data-distribution\x3d'1'\x3e\x3c/td\x3e";f+="\x3ctd\x3e"+(""+Math.round(10*e[a].max)/10+e[a].unit)+"\x3c/td\x3e";f+="\x3ctd data-histogram\x3d'1'\x3e\x3c/td\x3e";f+="\x3c/tr\x3e"}n.innerHTML=f+"\x3ctable\x3e";d=n.querySelectorAll("td[data-distribution\x3d'1']");a=n.querySelectorAll("td[data-histogram\x3d'1']");for(f=0;f<d.length;f++){var h=d[f],q=document.createElement("canvas");q.height=10;q.width=100;var p=q.getContext("2d");p.strokeStyle=
g;p.beginPath();p.moveTo(0,5);p.lineTo(100,5);if(e[b[f]].max>e[b[f]].min+.001)for(var m=0,u=e[b[f]].samples;m<u.length;m++){var k=u[m],k=(k-e[b[f]].min)/(e[b[f]].max-e[b[f]].min);p.moveTo(100*k,3);p.lineTo(100*k,7)}p.stroke();p.strokeRect((c[f].value-e[b[f]].min)/(e[b[f]].max-e[b[f]].min)*100-2,0,4,9);h.appendChild(q);h=a[f];m=Array(50);for(q=0;q<m.length;q++)m[q]=0;q=0;for(p=e[b[f]].samples;q<p.length;q++)k=p[q],k=(k-e[b[f]].min)/(e[b[f]].max-e[b[f]].min),k=1===k?m.length-1:Math.floor(k*m.length),
m[k]++;q=document.createElement("canvas");q.height=30;q.width=120;p=q.getContext("2d");p.strokeStyle=g;p.fillStyle=g;for(k=u=0;k<m.length;k++)var r=m[k],u=Math.max(u,r);for(k=0;k<m.length;k++)r=m[k],p.fillRect(k*q.width/m.length,q.height*(1-r/u),q.width/m.length,r/u*q.height);p.beginPath();p.moveTo(0,q.height);p.lineTo(q.width,q.height);p.stroke();h.appendChild(q)}g=n.querySelectorAll("td");for(f=0;f<g.length;f++)g[f].style.padding="5px";return n}})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["require",
"exports","../../../../core/LRUCache","../../tiling/TileCoverage","../../tiling/TileKey"],function(t,l,g,n,f){Object.defineProperty(l,"__esModule",{value:!0});l.TileManager=void 0;var e=function(c,b){return c+1/(1<<2*b)};t=function(){function c(b,c){this._tiles=new Map;this._tileCache=new g(40,function(a){return a.dispose()});this._viewSize=[0,0];this.acquireTile=b.acquireTile;this.releaseTile=b.releaseTile;this.tileInfoView=b.tileInfoView;this._container=c}c.prototype.destroy=function(){this._tiles.clear();
this._tiles=null;this._tileCache.clear();this._tileCache=null};c.prototype.update=function(b){var c=this;this._updateCacheSize(b);b=this.tileInfoView.getTileCoverage(b.state,0,"smallest");for(var a=b.spans,e=b.lodInfo,g=e.level,p=new Set,m=new Set,u=0;u<a.length;u++)for(var k=a[u],r=k.row,l=k.colTo,k=k.colFrom;k<=l;k++){var B=f.getId(g,r,e.normalizeCol(k),e.getWorldForColumn(k)),t=this._getOrAcquireTile(B);p.add(B);t.hasData()?this._container.addChild(t):m.add(new f(B))}this._tiles.forEach(function(a,
b){a.isCoverage=p.has(b)});m.forEach(function(a){return c._findPlaceholdersForMissingTiles(a,p)});var x=!1;this._tiles.forEach(function(a,b){a.neededForCoverage=p.has(b);a.isHoldingForFade&&p.add(b);a.isFading&&(x=!0)});this._tiles.forEach(function(a,b){p.has(b)||c._releaseTile(b)});n.pool.release(b);return!x};c.prototype.clearCache=function(){this._tileCache.clear()};c.prototype._findPlaceholdersForMissingTiles=function(b,c){var a=this,d=[];this._tiles.forEach(function(e){a._addPlaceholderChild(d,
e,b,c)});var f=d.reduce(e,0);1E-6>Math.abs(1-f)||this._addPlaceholderParent(b.id,c)};c.prototype._addPlaceholderChild=function(b,c,a,e){if(!(c.key.level<=a.level)&&c.hasData()){var d=c.key,h=d.level-a.level;a.row===d.row>>h&&a.col===d.col>>h&&a.world===d.world&&(this._container.addChild(c),e.add(c.id),b.push(c.key.level-a.level))}};c.prototype._addPlaceholderParent=function(b,c){for(;;){var a=b.split("/");b=a[1];var d=a[2],e=a[3],a=parseInt(a[0],10);b=0===a?null:a-1+"/"+(parseInt(b,10)>>1)+"/"+(parseInt(d,
10)>>1)+"/"+parseInt(e,10);if(!b||c.has(b))break;if((d=this._getTile(b))&&d.hasData()){this._container.addChild(d);c.add(d.id);break}}};c.prototype._getOrAcquireTile=function(b){var c=this._tiles.get(b);if(c)return c;(c=this._tileCache.pop(b))||(c=this.acquireTile(new f(b)));this._tiles.set(b,c);return c};c.prototype._getTile=function(b){var c=this._tiles.get(b);if(c)return c;(c=this._tileCache.pop(b))&&this._tiles.set(b,c);return c};c.prototype._releaseTile=function(b){var c=this._tiles.get(b);this.releaseTile(c);
this._container.removeChild(c);this._tiles.delete(b);c.hasData()?this._tileCache.put(b,c,1):c.dispose()};c.prototype._updateCacheSize=function(b){b=b.state.size;if(b[0]!==this._viewSize[0]||b[1]!==this._viewSize[1]){var c=Math.ceil(b[0]/512)+1,a=Math.ceil(b[1]/512)+1;this._viewSize[0]=b[0];this._viewSize[1]=b[1];this._tileCache.maxSize=5*c*a}};return c}();l.TileManager=t})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("require exports tslib ../../../../core/maybe ../../../../core/promiseUtils ../../../../geometry/support/aaBoundingRect ./decluttering/debugging ./decluttering/SymbolFader ../webgl/enums ../webgl/TileContainer ../webgl/TiledDisplayObject ../../tiling/TileCoverage ../../tiling/TileKey".split(" "),
function(t,l,g,n,f,e,c,b,d,a,h,q,p){function m(a,b){if(a){var c=a.getLayoutProperty("visibility");if(!c||"none"!==c.getValue()&&(void 0===a.minzoom||a.minzoom<b+1E-6)&&(void 0===a.maxzoom||a.maxzoom>=b-1E-6))return!0}return!1}Object.defineProperty(l,"__esModule",{value:!0});l.VectorTileContainer=void 0;t=function(a){function k(b){b=a.call(this,b)||this;b._backgroundTiles=[];b._pointToCallbacks=new Map;b._fading=!1;return b}g.__extends(k,a);k.prototype.destroy=function(){this.removeAllChildren();this.children.forEach(function(a){return a.destroy()});
this._spriteMosaic&&this._spriteMosaic.dispose();this._glyphMosaic&&this._glyphMosaic.dispose()};k.prototype.setStyleResources=function(a,c,d){var e=this;this._spriteMosaic=a;this._glyphMosaic=c;this._styleRepository=d;n.isNone(this._symbolFader)&&(a=new b.SymbolFader(this._styleRepository.layers),a.on("fade-start",function(){e.emit("fade-start");e._fading=!0;e.requestRender()}),a.on("fade-complete",function(){e.emit("fade-complete");e._fading=!1;e.requestRender()}),this._symbolFader=a);n.unwrap(this._symbolFader).layers=
d.layers};k.prototype.hitTest=function(a,b){return g.__awaiter(this,void 0,void 0,function(){var c,d;return g.__generator(this,function(e){c=[a,b];d=f.createResolver();this._pointToCallbacks.set(c,d);this.requestRender();return[2,d.promise]})})};k.prototype.enterTileInvalidation=function(){for(var a=0,b=this.children;a<b.length;a++)b[a].invalidating=!0};k.prototype.createRenderParams=function(b){return g.__assign(g.__assign({},a.prototype.createRenderParams.call(this,b)),{renderPass:null,styleLayer:null,
styleLayerId:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos})};k.prototype.doRender=function(b){!this.visible||b.drawPhase!==d.WGLDrawPhase.MAP&&b.drawPhase!==d.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||a.prototype.doRender.call(this,b)};k.prototype.addChild=function(b){a.prototype.addChild.call(this,b);n.isSome(this._symbolFader)?this._symbolFader.addTile(b):b.decluttered=!0;this.requestRender();return b};k.prototype.removeChild=function(b){n.isSome(this._symbolFader)&&
this._symbolFader.removeTile(b);this.requestRender();return a.prototype.removeChild.call(this,b)};k.prototype.renderChildren=function(b){if(b.drawPhase===d.WGLDrawPhase.DEBUG)a.prototype.renderChildren.call(this,b);else if(this._doRender(b),0<this._pointToCallbacks.size){var c=b.context,e=c.getBoundFramebufferObject();b.drawPhase=d.WGLDrawPhase.HITTEST;var h=b.painter.effects.hittest;h.bind(b);this._doRender(b);h.draw(b,this._pointToCallbacks,6);c.bindFramebuffer(e)}};k.prototype.removeAllChildren=
function(){for(var b=0;b<this.children.length;b++){var c=this.children[b];n.isSome(this._symbolFader)&&this._symbolFader.removeTile(c);c.dispose()}a.prototype.removeAllChildren.call(this)};k.prototype.getStencilTarget=function(){return this.children.filter(function(a){return a.neededForCoverage})};k.prototype.restartDeclutter=function(){n.isSome(this._symbolFader)&&this._symbolFader.restartDeclutter()};k.prototype._doRender=function(b){var e,h,f,k=b.context,m=this._styleRepository,g=m.layers,p=!0;
b.drawPhase===d.WGLDrawPhase.HITTEST&&(p=!1);0<m.backgroundBucketIds.length&&(b.renderPass="background",this._renderBackgroundLayers(b,m.backgroundBucketIds));a.prototype.renderChildren.call(this,b);var r=this.children.filter(function(a){return a.visible});if(r&&0!==r.length){for(var q=0;q<r.length;q++)m=r[q],m.triangleCount=0;k.setStencilWriteMask(0);k.setColorMask(!0,!0,!0,!0);k.setStencilOp(7680,7680,7681);k.setStencilTestEnabled(!0);k.setBlendingEnabled(!1);k.setDepthTestEnabled(!0);k.setDepthWriteEnabled(!0);
k.setDepthFunction(515);k.setClearDepth(1);k.clear(k.gl.DEPTH_BUFFER_BIT);b.renderPass="opaque";for(m=g.length-1;0<=m;m--)this._renderStyleLayer(m,b,r);k.setDepthWriteEnabled(!1);k.setBlendingEnabled(p);k.setBlendFunctionSeparate(1,771,1,771);b.renderPass="translucent";for(m=0;m<g.length;m++)this._renderStyleLayer(m,b,r);k.setDepthTestEnabled(!1);b.renderPass="symbol";for(m=0;m<g.length;m++)this._renderStyleLayer(m,b,r);k.bindVAO();k.setStencilTestEnabled(!0);k.setBlendingEnabled(!0);if(b.drawPhase===
d.WGLDrawPhase.MAP){this._fade(b.displayLevel,b.state);var l=window.COLLISION_DEBUG_CTX;if(l&&n.isSome(this._symbolFader)&&(l.clearRect(0,0,l.canvas.width,l.canvas.height),!this._fading||window.COLLISION_XRAY)){b=function(a){if(a.symbols){var b=[];a.symbols.forEach(function(a){b.push.apply(b,a)});window.COLLISION_SHOW_GRID&&(a=null===(f=null===(h=null===(e=u._symbolFader)||void 0===e?void 0:e._symbolDeclutterer)||void 0===h?void 0:h._collisionJob)||void 0===f?void 0:f._gridIndex)&&c.drawGridIndex(l,
a);c.drawColliders(l,b)}};for(var u=this,k=0,g=this.children;k<g.length;k++)m=g[k],b(m)}}}};k.prototype._fade=function(a,b){n.isSome(this._symbolFader)&&(this._symbolFader.update(a,b)||this.requestRender())};k.prototype._renderStyleLayer=function(a,b,c){var d=b.painter,e=b.renderPass,h=this._styleRepository.layers[a];if(void 0!==h){var f;switch(h.type){case 0:return;case 1:if("opaque"!==e&&"translucent"!==b.renderPass)return;f="vtlFill";break;case 2:if("translucent"!==e)return;f="vtlLine";break;case 4:if("symbol"!==
e)return;f="vtlCircle";break;case 3:if("symbol"!==e)return;f="vtlSymbol"}c=3===h.type?c.filter(function(a){return a.decluttered}):c.filter(function(a){return a.neededForCoverage});if("vtlSymbol"!==f&&(e=b.displayLevel,0===c.length||void 0!==h.minzoom&&h.minzoom>=e+1E-6||void 0!==h.maxzoom&&h.maxzoom<e-1E-6))return;b.styleLayerId=a;b.styleLayer=h;h=0;for(e=c;h<e.length;h++)if(e[h].layerData[a]){d.renderObjects(b,c,f);break}}};k.prototype._renderBackgroundLayers=function(a,b){for(var c=a.context,f=
a.displayLevel,k=a.painter,g=a.state,r=this._styleRepository,l=!1,u=0;u<b.length;u++){var t=b[u];if(m(r.layers[t],f)){l=!0;break}}if(l){var l=this._tileInfoView.getTileCoverage(a.state,0,"smallest"),t=l.spans,v=l.lodInfo,G=v.level,C=e.create(),u=[];if(this._renderPasses){var z=this._renderPasses[0];n.isSome(this._clippingInfos)&&(z.brushes[0].prepareState(a,this._clippingInfos[0]),z.brushes[0].drawMany(a,this._clippingInfos))}for(var z=this._backgroundTiles,J=0,A,F=0;F<t.length;F++)for(var D=t[F],
M=D.row,N=D.colTo,D=D.colFrom;D<=N;D++)J<z.length?(A=z[J],A.key.set(G,M,v.normalizeCol(D),v.getWorldForColumn(D)),this._tileInfoView.getTileBounds(C,A.key,!1),A.bounds=C,A.coords[0]=C[0],A.coords[1]=C[3]):(A=new p(G,M,v.normalizeCol(D),v.getWorldForColumn(D)),A=new h.TiledDisplayObject(A,this._tileInfoView.getTileBounds(e.create(),A),[512,512],[4096,4096]),z.push(A)),A.setTransform(g,this._tileInfoView.getTileResolution(A.key)),u.push(A),J++;c.setStencilWriteMask(0);c.setColorMask(!0,!0,!0,!0);c.setStencilOp(7680,
7680,7681);c.setStencilFunction(514,0,255);g=!0;a.drawPhase===d.WGLDrawPhase.HITTEST&&(g=!1);c.setStencilTestEnabled(g);for(c=0;c<b.length;c++)t=b[c],g=r.layers[t],m(g,f)&&(a.styleLayerId=t,a.styleLayer=g,k.renderObjects(a,u,"vtlBackground"));q.pool.release(l)}};return k}(a.default);l.VectorTileContainer=t})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define("require exports tslib ../../../../../core/Evented ../../../../../core/maybe ./config ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util".split(" "),
function(t,l,g,n,f,e,c,b,d,a,h){Object.defineProperty(l,"__esModule",{value:!0});l.SymbolFader=void 0;t=function(q){function p(e){var f=q.call(this)||this;f.layers=e;f._tileToHandle=new Map;f._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]};f._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]};f._completed=!1;f._tileForest=new h.TileForest;f._symbolRepository=new a.SymbolRepository(4096,f._tileForest,function(){return new c.VTLUniqueSymbol});f._symbolDeclutterer=new d.SymbolDeclutterer(f._tileForest,
f._symbolRepository,function(a,c,d){return new b.CollisionJob(a,c,d,f.layers,f._zoom,f._viewState.rotation)},function(a,b){a.allSymbolsFadingOut=!0;a.lastOpacityUpdate=b;h.writeOpacityToBuffers(a,b,!0);a.decluttered=!0;a.requestRender()});return f}g.__extends(p,q);p.prototype.addTile=function(a){var b=this;this._tileForest.has(a)||(a.decluttered=!1,this._tileForest.add(a),this._tileToHandle.set(a,a.on("symbols-changed",function(){b._symbolRepository.addTile(a,!1);b.restartDeclutter()})),this._symbolRepository.addTile(a),
this.restartDeclutter())};p.prototype.removeTile=function(a){this._tileForest.has(a)&&(this._symbolRepository.removeTile(a),this.restartDeclutter(),this._tileToHandle.get(a).remove(),this._tileToHandle.delete(a),this._tileForest.remove(a))};p.prototype.update=function(a,b){this._zoom=a;this._viewState={scale:b.scale,rotation:b.rotation,center:[b.center[0],b.center[1]],size:[b.size[0],b.size[1]]};this._continueDeclutter();return this._completed};p.prototype.restartDeclutter=function(){this._completed=
!1;this._symbolDeclutterer.restart();this._notifyUnstable()};Object.defineProperty(p.prototype,"stale",{get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation},enumerable:!1,configurable:!0});p.prototype._continueDeclutter=function(){if(!this._completed||this.stale)this._symbolDeclutterer.running||
(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),
(this._completed=this._symbolDeclutterer.continue(e.DECLUTTER_BUDGET))&&this._scheduleNotifyStable()};p.prototype._scheduleNotifyStable=function(){var a=this;f.isSome(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle);this._stableNotificationHandle=setTimeout(function(){a._stableNotificationHandle=null;a.emit("fade-complete")},1.5*e.FADE_DURATION)};p.prototype._notifyUnstable=function(){f.isSome(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),
this._stableNotificationHandle=null);this.emit("fade-start")};return p}(n);l.SymbolFader=t})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/mat3f32","./config","./util"],function(t,l,g,n,f){Object.defineProperty(l,"__esModule",{value:!0});l.CollisionJob=void 0;t=function(){function e(c,b,d,a,e,q){this._symbols=c;this._layers=a;this._zoom=e;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=new Map;
this._allNeededMatrices=new Map;this._gridIndex=new f.GridIndex(b,d,n.COLLISION_GRID_CELL_SIZE);this._si=Math.sin(Math.PI*q/180);this._co=Math.cos(Math.PI*q/180);for(b=0;b<c.length;b++)for(d=0,a=c[b].symbols;d<a.length;d++)e=a[d],this._allNeededMatrices.has(e.tile)||this._allNeededMatrices.set(e.tile,g.mat3f32.clone(e.tile.transforms.tileUnitsToPixels))}e.prototype.work=function(c){for(var b=this._gridIndex,d=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,
this._currentSymbolCursor=0)for(var a=this._symbols[this._currentLayerCursor],e=this._getProperties(a.layerIndex);this._currentSymbolCursor<a.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-d>c)return!1;var f=a.symbols[this._currentSymbolCursor];if(f.unique.show){for(var g=f,m=this._si,n=this._co,k=this._allNeededMatrices.get(f.tile),r=this._zoom,l=e.iconRotationAlignment,t=e.textRotationAlignment,E=e.iconTranslate,x=e.iconTranslateAnchor,w=e.textTranslate,
H=e.textTranslateAnchor,K=0,I=0,L=g.colliders;I<L.length;I++){var v=L[I],y=0===v.partIndex?E:w,C=y[0],y=y[1],z=0===v.partIndex?x:H,J=v.minLod<=r&&r<=v.maxLod,K=K+(J?0:1);v.enabled=J;v.xScreen=v.xTile*k[0]+v.yTile*k[3]+k[6];v.yScreen=v.xTile*k[1]+v.yTile*k[4]+k[7];0===z?(v.xScreen+=n*C-m*y,v.yScreen+=m*C+n*y):(v.xScreen+=C,v.yScreen+=y);1===(0===v.partIndex?l:t)?(v.dxScreen=v.dxPixels,v.dyScreen=v.dyPixels):(v.dxScreen=n*(v.dxPixels+v.width/2)-m*(v.dyPixels+v.height/2)-v.width/2,v.dyScreen=m*(v.dxPixels+
v.width/2)+n*(v.dyPixels+v.height/2)-v.height/2)}0<g.colliders.length&&K===g.colliders.length&&(g.unique.show=!1);g=f.unique;if(g.show){l=e.iconAllowOverlap;m=e.iconIgnorePlacement;t=e.textAllowOverlap;n=e.textIgnorePlacement;E=0;for(x=f.colliders;E<x.length;E++)if(k=x[E],k.enabled&&(r=g.parts[k.partIndex],r.show)){if(w=!(k.partIndex?t:l))a:{w=k.xScreen+k.dxScreen;H=k.yScreen+k.dyScreen;K=w+k.width;I=H+k.height;y=b.getCellSpan(w,H,K,I);L=y[0];v=y[2];C=y[3];for(y=y[1];y<=C;y++)for(z=L;z<=v;z++)for(var J=
0,A=b.cells[y][z];J<A.length;J++){var F=A[J],D=F.xScreen+F.dxScreen,M=F.yScreen+F.dyScreen,N=D+F.width,F=M+F.height;if(!(K<D||w>N||I<M||H>F)){w=!0;break a}}w=!1}w&&(k.hard?g.show=!1:r.show=!1)}if(g.show)for(l=0,f=f.colliders;l<f.length;l++)if(k=f[l],k.enabled&&(k.partIndex?!n:!m)&&(r=g.parts[k.partIndex],r.show))for(r=k.xScreen+k.dxScreen,t=k.yScreen+k.dyScreen,x=this._gridIndex.getCellSpan(r,t,r+k.width,t+k.height),r=x[0],t=x[2],E=x[3],x=x[1];x<=E;x++)for(w=r;w<=t;w++)this._gridIndex.cells[x][w].push(k)}}}return!0};
e.prototype._getProperties=function(c){var b=this._styleProps.get(c);if(b)return b;var b=this._zoom,d=this._layers[c],a=1===d.getLayoutValue("symbol-placement",b),e=d.getLayoutValue("icon-rotation-alignment",b);2===e&&(e=a?0:1);var f=d.getLayoutValue("text-rotation-alignment",b);2===f&&(f=a?0:1);var a=d.getPaintValue("icon-translate",b),g=d.getPaintValue("icon-translate-anchor",b),m=d.getPaintValue("text-translate",b),n=d.getPaintValue("text-translate-anchor",b),b={iconAllowOverlap:d.getLayoutValue("icon-allow-overlap",
b),iconIgnorePlacement:d.getLayoutValue("icon-ignore-placement",b),textAllowOverlap:d.getLayoutValue("text-allow-overlap",b),textIgnorePlacement:d.getLayoutValue("text-ignore-placement",b),iconRotationAlignment:e,textRotationAlignment:f,iconTranslateAnchor:g,iconTranslate:a,textTranslateAnchor:n,textTranslate:m};this._styleProps.set(c,b);return b};return e}();l.CollisionJob=t})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["require","exports","./config"],function(t,
l,g){function n(f,e){return f.priority-e.priority}Object.defineProperty(l,"__esModule",{value:!0});l.SymbolDeclutterer=void 0;t=function(){function f(e,c,b,d){this._tileForest=e;this._symbolRepository=c;this._createCollisionJob=b;this._assignTileSymbolsOpacity=d;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}Object.defineProperty(f.prototype,"running",{get:function(){return this._running},
enumerable:!1,configurable:!0});f.prototype.setScreenSize=function(e,c){this._screenWidth===e&&this._screenHeight===c||this.restart();this._screenWidth=e;this._screenHeight=c};f.prototype.restart=function(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0};f.prototype.continue=function(e){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var c=
performance.now();if(!this._selectionJob.work(e))return!1;this._selectionJobCompleted=!0;e=Math.max(0,e-(performance.now()-c));if(0===e)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){c=performance.now();if(!this._collisionJob.work(e))return!1;this._collisionJobCompleted=!0;e=Math.max(0,e-(performance.now()-c));if(0===e)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());
if(!this._opacityJobCompleted){c=performance.now();if(!this._opacityJob.work(e))return!1;this._opacityJobCompleted=!0;e=Math.max(0,e-(performance.now()-c));if(0===e)return!1}this._running=!1;return!0};f.prototype._createSelectionJob=function(){var e=this._symbolRepository.uniqueSymbols,c=[],b=0,d=0,a,f,g,p=function(b){b.selectedForRendering=!1;if(!g||!f){var c=b.tile;if(b.unique.visible&&(!a||c.isCoverage||c.neededForCoverage&&!f)){a=b;if(c.neededForCoverage||c.isCoverage)g=!0;c.isCoverage&&(f=!0)}}};
return{work:function(h){for(var m,k=performance.now();d<e.length;d++,b=0){var r=e[d];c[d]=c[d]||{layerIndex:r.layerIndex,symbols:[]};for(var l=c[d];b<r.uniqueSymbols.length;b++){m=r.uniqueSymbols[b];if(99===b%100&&performance.now()-k>h)return!1;a=null;g=f=!1;m.tileSymbols.forEach(p);a.selectedForRendering=!0;if(g){l.symbols.push(a);m.show=!0;var q=0;for(m=m.parts;q<m.length;q++)m[q].show=!0}else m.show=!1}}for(h=0;h<c.length;h++)l=c[h],l.symbols.sort(n);return!0},get sortedSymbols(){return c.sort(function(a,
b){return b.layerIndex-a.layerIndex})}}};f.prototype._createOpacityJob=function(){function e(a,d){a.symbols.forEach(function(a){for(var b=0;b<a.length;b++)for(var c=a[b].unique,e=0,f=c.parts;e<f.length;e++){var h=f[e];h.startOpacity+=(d-h.startTime)/g.FADE_DURATION*(.5<h.targetOpacity?1:-1);h.startOpacity=Math.min(Math.max(h.startOpacity,0),1);h.startTime=d;h.targetOpacity=c.show&&h.show?1:0}});c(a,d);var f=0;for(a=b.getChildren(a);f<a.length;f++)e(a[f],d)}var c=this._assignTileSymbolsOpacity,b=this._tileForest,
d=b.getRoots(),a=0;return{work:function(b){for(var c=performance.now();a<d.length;a++){if(performance.now()-c>b)return!1;var f=d[a],h=performance.now();e(f,h)}return!0}}};return f}();l.SymbolDeclutterer=t})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["require","exports","../../../../../core/maybe","./util"],function(t,l,g,n){Object.defineProperty(l,"__esModule",{value:!0});l.SymbolRepository=void 0;t=function(){function f(e,c,b){this.tileCoordRange=e;this._tileForest=
c;this._createUnique=b;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}Object.defineProperty(f.prototype,"uniqueSymbols",{get:function(){g.isNone(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray},enumerable:!1,configurable:!0});f.prototype.addTile=function(e,c){var b=this;void 0===c&&(c=!0);this._uniqueSymbolLayerArray=null;c?(c={flatLatestSymbols:null,indexedLatestSymbols:null},this._tiles.set(e,c)):(c=
this._tiles.get(e),this._removeSymbols(c.flatLatestSymbols));var d=e.symbols;d.forEach(function(a){for(var b=0;b<a.length;b++)a[b].tile=e});var a=new Map;d.forEach(function(c,d){var e=c.length;if(32<=e){var f=b.tileCoordRange;do f/=2,e/=4;while(8<e&&64<f);e=new n.GridIndex(b.tileCoordRange,b.tileCoordRange,f);a.set(d,e);for(d=0;d<c.length;d++)f=c[d],e.getCell(f.xTile,f.yTile).push(f)}});c.flatLatestSymbols=d;c.indexedLatestSymbols=a;this._addSymbols(e.key,d)};f.prototype.removeTile=function(e){this._uniqueSymbolLayerArray=
null;this._removeSymbols(e.symbols);this._tiles.delete(e)};f.prototype._removeSymbols=function(e){var c=this;e.forEach(function(b,d){for(var a=0;a<b.length;a++){for(var e=b[a],f=e.unique,g=f.tileSymbols,m=g.length-1,n=0;n<m;n++)if(g[n]===e){g[n]=g[m];break}g.length=m;0===m&&(g=c._uniqueSymbolsReferences.get(d),g.delete(f),0===g.size&&c._uniqueSymbolsReferences.delete(d));e.unique=null;e.tile=null}})};f.prototype._addSymbols=function(e,c){var b=this;if(0!==c.size){for(var d=0,a=this._tileForest.getRoots();d<
a.length;d++){var f=a[d];f.key.world===e.world&&(f.key.level!==e.level||f.key.equals(e))&&this._matchSymbols(f,e,c)}c.forEach(function(a,c){for(var d=0;d<a.length;d++){var e=a[d];if(g.isNone(e.unique)){var f=b._createUnique();e.unique=f;f.tileSymbols.push(e);e=b._uniqueSymbolsReferences.get(c);e||(e=new Set,b._uniqueSymbolsReferences.set(c,e));e.add(f)}}})}};f.prototype._matchSymbols=function(e,c,b){var d=this;if(e.key.level>c.level){var a=e.key.level-c.level;if(e.key.row>>a!==c.row||e.key.col>>a!==
c.col)return}if(c.level>e.key.level&&(a=c.level-e.key.level,c.row>>a!==e.key.row||c.col>>a!==e.key.col))return;if(c.equals(e.key))for(var f=0,g=this._tileForest.getChildren(e);f<g.length;f++)a=g[f],this._matchSymbols(a,c,b);else{var l=new Map;b.forEach(function(a,b){for(var f=[],h=0;h<a.length;h++){var g=a[h],m=n.tileCoordChange(d.tileCoordRange,g.xTile,c.level,c.col,e.key.level,e.key.col),p=n.tileCoordChange(d.tileCoordRange,g.yTile,c.level,c.row,e.key.level,e.key.row);0<=m&&m<d.tileCoordRange&&
0<=p&&p<d.tileCoordRange&&f.push({symbol:g,xTransformed:m,yTransformed:p})}a=[];h=e.key.level<c.level?1:1<<e.key.level-c.level;g=d._tiles.get(e);if(m=g.flatLatestSymbols.get(b))for(var p=g.indexedLatestSymbols.get(b),q=0;q<f.length;q++){for(var g=f[q],w=!1,t=void 0,u=g.xTransformed,I=g.yTransformed,t=p?p.getCell(u,I):m,g=g.symbol,L=g.hash,v=0;v<t.length;v++){var y=t[v];if(L===y.hash&&Math.abs(u-y.xTile)<=h&&Math.abs(I-y.yTile)<=h){w=y.unique;g.unique=w;w.tileSymbols.push(g);w=!0;break}}w||a.push(g)}0<
a.length&&l.set(b,a)});b=0;for(f=this._tileForest.getChildren(e);b<f.length;b++)a=f[b],this._matchSymbols(a,c,l)}};f.prototype._createUniqueSymbolLayerArray=function(){var e=Array(this._uniqueSymbolsReferences.size),c=0;this._uniqueSymbolsReferences.forEach(function(b,d){var a=[];b.forEach(function(b){a.push(b)});e[c]={layerIndex:d,uniqueSymbols:a};c++});return e};return f}();l.SymbolRepository=t})},"esri/views/2d/layers/LayerView2D":function(){define("require exports tslib ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(t,l,g,n,f,e,c,b,d,a,h,q){Object.defineProperty(l,"__esModule",{value:!0});l.LayerView2DMixin=void 0;var p=n.ofType({key:"type",base:d,typeMap:{rect:a,path:q,geometry:h}});l.LayerView2DMixin=function(a){return function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;b.clips=new p;b.moving=!1;b.attached=!1;b.lastUpdateId=-1;b.updateRequested=!1;return b}g.__extends(d,a);d.prototype.initialize=function(){var a=this,c;this.container||(this.container=new b.Container);this.container.fadeTransitionEnabled=
!0;this.container.opacity=0;this.container.clips=this.clips;this.handles.add([e.init(this,"suspended",function(b){a.container&&(a.container.visible=!b);a.view&&!b&&a.updateRequested&&a.view.requestUpdate()},!0),e.init(this,["layer.opacity","container"],function(){var b,c;a.container&&(a.container.opacity=null!==(c=null===(b=a.layer)||void 0===b?void 0:b.opacity)&&void 0!==c?c:1)},!0),e.init(this,["layer.blendMode"],function(b){a.container&&(a.container.blendMode=b)},!0),e.init(this,["layer.effect"],
function(b){a.container&&(a.container.effect=b)},!0),this.clips.on("change",function(){a.container.clips=a.clips;a.notifyChange("clips")})]);(null===(c=this.view)||void 0===c?0:c.whenLayerView)?this.view.whenLayerView(this.layer).then(function(b){b!==a||a.attached||a.destroyed||(a.attach(),a.requestUpdate(),a.attached=!0)},function(){}):this.when().then(function(){a.attached||a.destroyed||(a.attach(),a.requestUpdate(),a.attached=!0)},function(){})};d.prototype.destroy=function(){this.attached&&(this.detach(),
this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};Object.defineProperty(d.prototype,"updating",{get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())},enumerable:!1,configurable:!0});d.prototype.isVisibleAtScale=function(a){var b=!0,c=this.layer,d=c.minScale,c=c.maxScale;if(null!=d&&null!=c){var b=!d,e=!c;!b&&a<=d&&(b=!0);!e&&a>=c&&(e=!0);b=b&&e}return b};d.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=
!0,this.suspended||this.view.requestUpdate())};d.prototype.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};d.prototype.isUpdating=function(){return!1};d.prototype.isRendering=function(){return!1};d.prototype.canResume=function(){return a.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};g.__decorate([c.property({type:p,
set:function(a){a=f.referenceSetter(a,this._get("clips"),p);this._set("clips",a)}})],d.prototype,"clips",void 0);g.__decorate([c.property()],d.prototype,"moving",void 0);g.__decorate([c.property()],d.prototype,"attached",void 0);g.__decorate([c.property()],d.prototype,"container",void 0);g.__decorate([c.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],d.prototype,"suspended",void 0);g.__decorate([c.property({readOnly:!0})],d.prototype,"updateParameters",void 0);g.__decorate([c.property()],
d.prototype,"updateRequested",void 0);g.__decorate([c.property({dependsOn:["attached","updateRequested","suspended"]})],d.prototype,"updating",null);g.__decorate([c.property()],d.prototype,"view",void 0);return d=g.__decorate([c.subclass("esri.views.2d.layers.LayerView2D")],d)}(a)}})},"esri/views/layers/support/ClipArea":function(){define(["require","exports","tslib","../../../core/JSONSupport","../../../core/accessorSupport/decorators"],function(t,l,g,n,f){return function(e){function c(){return null!==
e&&e.apply(this,arguments)||this}g.__extends(c,e);return c=g.__decorate([f.subclass("esri.views.layers.support.ClipArea")],c)}(n.JSONSupport)})},"esri/views/layers/support/ClipRect":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","./ClipArea"],function(t,l,g,n,f){return function(e){function c(){var b=null!==e&&e.apply(this,arguments)||this;b.type="rect";b.left=null;b.right=null;b.top=null;b.bottom=null;return b}g.__extends(c,e);b=c;c.prototype.clone=function(){return new b({left:this.left,
right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(c.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});var b;g.__decorate([n.property({type:[Number,String],json:{write:!0}})],c.prototype,"left",void 0);g.__decorate([n.property({type:[Number,String],json:{write:!0}})],c.prototype,"right",void 0);g.__decorate([n.property({type:[Number,String],json:{write:!0}})],c.prototype,"top",void 0);g.__decorate([n.property({type:[Number,
String],json:{write:!0}})],c.prototype,"bottom",void 0);g.__decorate([n.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],c.prototype,"version",null);return c=b=g.__decorate([n.subclass("esri.views.layers.support.ClipRect")],c)}(f)})},"esri/views/layers/support/Geometry":function(){define("require exports tslib ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),function(t,l,g,n,f,e,c,b){var d=
{base:e,key:"type",typeMap:{extent:n.Extent,polygon:n.Polygon}};return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.type="geometry";b.geometry=null;return b}g.__extends(b,a);e=b;Object.defineProperty(b.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});b.prototype.clone=function(){return new e({geometry:this.geometry.clone()})};var e;g.__decorate([f.property({types:d,json:{read:c.fromJSON,write:!0}})],b.prototype,"geometry",
void 0);g.__decorate([f.property({readOnly:!0,dependsOn:["geometry"]})],b.prototype,"version",null);return b=e=g.__decorate([f.subclass("esri.views.layers.support.Geometry")],b)}(b)})},"esri/views/layers/support/Path":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","./ClipArea"],function(t,l,g,n,f){return function(e){function c(){var b=null!==e&&e.apply(this,arguments)||this;b.type="path";b.path=[];return b}g.__extends(c,e);Object.defineProperty(c.prototype,
"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});g.__decorate([n.property({type:[[[Number]]],json:{write:!0}})],c.prototype,"path",void 0);g.__decorate([n.property({readOnly:!0,dependsOn:["path"]})],c.prototype,"version",null);return c=g.__decorate([n.subclass("esri.views.layers.support.Path")],c)}(f)})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define("require exports tslib ../../../layers/support/TileInfo ./TileInfoView ./TileKey".split(" "),function(t,
l,g,n,f,e){return function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;b._fullCacheLodInfos=null;b._levelByScale={};return b}g.__extends(b,c);b.prototype.getTileParentId=function(b){b=e.pool.acquire(b);var a=0===b.level?null:e.getId(b.level-1,b.row>>1,b.col>>1,b.world);e.pool.release(b);return a};b.prototype.getTileCoverage=function(b,a,e){b=c.prototype.getTileCoverage.call(this,b,a,e);if(!b)return b;var d=1<<b.lodInfo.level;b.spans=b.spans.filter(function(a){return 0<=a.row&&a.row<
d});return b};b.prototype.scaleToLevel=function(b){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[b])return this._levelByScale[b];var a=this._fullCacheLodInfos;if(b>a[0].scale)return a[0].level;for(var c=void 0,d=void 0,c=0;c<a.length-1;c++)if(d=a[c+1],b>d.scale)return c=a[c],c.level+(c.scale-b)/(c.scale-d.scale);return a[a.length-1].level};b.prototype._initializeFullCacheLODs=function(b){b=0===b[0].level?b.map(function(a){return{level:a.level,resolution:a.resolution,
scale:a.scale}}):n.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(function(a){return{level:a.level,resolution:a.resolution,scale:a.scale}});for(var a=0;a<b.length;a++)this._levelByScale[b[a].scale]=b[a].level;this._fullCacheLodInfos=b};return b}(f)})},"*noref":1}});
define("require exports tslib ../../../Graphic ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTile ../engine/vectorTiles/VectorTileContainer ./LayerView2D ../tiling/TileInfoViewPOT ../tiling/TileQueue ../../layers/LayerView".split(" "),function(t,l,g,n,f,e,c,b,d,a,h,q,p,m,u,k,r,G){var B=
c.getLogger("esri.views.2d.layers.VectorTileLayerView2D");return function(c){function l(){var a=null!==c&&c.apply(this,arguments)||this;a._handles=new e;a._fetchQueue=null;a._parseQueue=null;a._isTileHandlerPromiseFulfilled=!1;a.fading=!1;return a}g.__extends(l,c);l.prototype.initialize=function(){var a=this,c=this.layer.tileInfo;(c&&c.spatialReference).equals(this.view.spatialReference)?(this._tileInfoView=new k(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new m.VectorTileContainer(this._tileInfoView),
this._tileHandler=new h.TileHandler(this.layer,window.devicePixelRatio||1,null),this.container.addChild(this._vectorTileContainer),this.handles.add([this._vectorTileContainer.on("updating-change",function(){return a.notifyChange("updating")}),this.watch("layer.currentStyleInfo",function(){return a._start()}),this._vectorTileContainer.on("fade-start",function(){a.fading=!0}),this._vectorTileContainer.on("fade-complete",function(){a.fading=!1;a.requestUpdate()})])):this.addResolvingPromise(b.reject(new f("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))};l.prototype.destroy=function(){var a,b;this._stop();this.container.removeAllChildren();null===(a=this._vectorTileContainer)||void 0===a?void 0:a.destroy();this._vectorTileContainer=null;null===(b=this._tileHandler)||void 0===b?void 0:b.destroy();this._tileHandler=null};l.prototype.hitTest=function(a,b){return g.__awaiter(this,void 0,void 0,function(){var c,d,e,f,h;return g.__generator(this,function(g){switch(g.label){case 0:return this.suspended||
!this._tileHandlerPromise?[2,null]:[4,this._tileHandlerPromise];case 1:return g.sent(),[4,this._vectorTileContainer.hitTest(a,b)];case 2:c=g.sent();if(!c||0===c.length)return[2,null];d=c[0]-1;e=this._tileHandler.getStyleRepository().layers;if(d>=e.length)return[2,null];f=e[d];h=new n({attributes:{layerId:d,layerName:f.id}});h.layer=this.layer;h.sourceLayer=this.layer;return[2,h]}})})};l.prototype.update=function(a){this._tileHandlerPromise&&this._isTileHandlerPromiseFulfilled&&(a.pixelRatio!==this._tileHandler.devicePixelRatio?
(this._start(),this._tileHandler.devicePixelRatio=a.pixelRatio):(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=a.state,this._parseQueue.state=a.state,this._tileManager.update(a)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))};l.prototype.attach=function(){var a=this;this._start();this._handles.add([this.layer.on("paint-change",function(){a._vectorTileContainer.restartDeclutter();a._vectorTileContainer.requestRender()}),this.layer.on("layout-change",
function(){a._vectorTileContainer.enterTileInvalidation();a._issueStyleInvalidation();a.notifyChange("updating");a.requestUpdate()})])};l.prototype.detach=function(){this._stop();this._handles.removeAll()};l.prototype.moveStart=function(){this.requestUpdate()};l.prototype.viewChange=function(){this.requestUpdate()};l.prototype.moveEnd=function(){this.requestUpdate()};l.prototype.canResume=function(){var a=c.prototype.canResume.call(this),b=this.layer;if(a&&b.currentStyleInfo){var d=this.view.scale;
(b=b.currentStyleInfo)&&b.layerDefinition&&(b=b.layerDefinition,b.minScale&&b.minScale<d&&(a=!1),b.maxScale&&b.maxScale>d&&(a=!1))}return a};l.prototype.isUpdating=function(){var a,b,c,d,e=this._vectorTileContainer.children;return!this._isTileHandlerPromiseFulfilled||(null!==(b=null===(a=this._fetchQueue)||void 0===a?void 0:a.updating)&&void 0!==b?b:!1)||(null!==(d=null===(c=this._parseQueue)||void 0===c?void 0:c.updating)&&void 0!==d?d:!1)||0<e.length&&0<e.filter(function(a){return a.invalidating}).length||
this.fading};l.prototype.acquireTile=function(a){var b=this,c=this._createVectorTile(a);this._tileHandlerPromise.then(function(){b.notifyChange("updating");b.updateTile(c)});return c};l.prototype.updateTile=function(a){var c=this;a.key&&this._fetchQueue.push(a.key).then(function(b){return c._parseQueue.push({key:a.key,data:b})}).then(function(b){a.once("attach",function(){return c.requestUpdate()});b&&(a.setData(b.tileData),c.requestUpdate(),c.notifyChange("updating"))}).catch(function(a){c.notifyChange("updating");
b.isAbortError(a)||B.error(a)})};l.prototype.releaseTile=function(a){a=a.key.id;this._fetchQueue.abort(a);this._parseQueue.abort(a);this.requestUpdate()};l.prototype._start=function(){var a=this;this._stop();this._tileManager=new q.TileManager({acquireTile:function(b){return a.acquireTile(b)},releaseTile:function(b){return a.releaseTile(b)},tileInfoView:this._tileInfoView},this._vectorTileContainer);if(this.layer.currentStyleInfo){var b=new AbortController,c=this._tileHandler.start({signal:b.signal}).then(function(){a._fetchQueue=
new r({tileInfoView:a._tileInfoView,process:function(b,c){return a._getTileData(b,c)},concurrency:15});a._parseQueue=new r({tileInfoView:a._tileInfoView,process:function(b,c){return a._parseTileData(b,c)},concurrency:8});a.requestUpdate();a._isTileHandlerPromiseFulfilled=!0});this._tileHandler.spriteMosaic.then(function(b){a._vectorTileContainer.setStyleResources(b,a._tileHandler.glyphMosaic,a.layer.styleRepository);a.requestUpdate()});this._tileHandlerAbortController=b;this._tileHandlerPromise=c}};
l.prototype._stop=function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var a=this._tileHandlerAbortController;a&&a.abort();this._tileHandlerPromise=null;this._isTileHandlerPromiseFulfilled=!1;this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null);this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null);this._tileManager&&(this._tileManager.destroy(),this._tileManager=null);this._vectorTileContainer.removeAllChildren()}};l.prototype._getTileData=function(a,
b){return g.__awaiter(this,void 0,void 0,function(){var c;return g.__generator(this,function(d){switch(d.label){case 0:return[4,this._tileHandler.fetchTileData(a,b)];case 1:return c=d.sent(),this.notifyChange("updating"),[2,c]}})})};l.prototype._parseTileData=function(a,b){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(c){return[2,this._tileHandler.parseTileData(a,b)]})})};l.prototype._issueStyleInvalidation=function(){var a=this;this.notifyChange("updating");
this._tileHandlerAbortController.abort();this._tileHandlerAbortController=b.createAbortController();var c=this._tileHandlerAbortController.signal;this._tileHandlerPromise=this._tileHandler.updateStyle().then(function(){c.aborted||a._tileHandler.spriteMosaic.then(function(b){c.aborted||(a._vectorTileContainer.setStyleResources(b,a._tileHandler.glyphMosaic,a.layer.styleRepository),a._updateTiles())})})};l.prototype._updateTiles=function(){this._tileManager.clearCache();this._fetchQueue.pause();this._parseQueue.pause();
this._fetchQueue.clear();this._parseQueue.clear();for(var a=0,b=this._vectorTileContainer.children;a<b.length;a++)this.updateTile(b[a]);this._parseQueue.resume();this._fetchQueue.resume();this.notifyChange("updating");this.requestUpdate()};l.prototype._createVectorTile=function(b){var c=this._tileInfoView.getTileBounds(a.create(),b);return new p.VectorTile(b,this.layer.styleRepository,c,[512,512])};g.__decorate([d.property()],l.prototype,"_fetchQueue",void 0);g.__decorate([d.property()],l.prototype,
"_parseQueue",void 0);g.__decorate([d.property()],l.prototype,"_isTileHandlerPromiseFulfilled",void 0);g.__decorate([d.property({dependsOn:["view.scale","layer.currentStyleInfo"]})],l.prototype,"suspended",void 0);g.__decorate([d.property()],l.prototype,"fading",void 0);g.__decorate([d.property({dependsOn:["_isTileHandlerPromiseFulfilled","_parseQueue.updating","_parseQueue.updating","fading"]})],l.prototype,"updating",void 0);return l=g.__decorate([d.subclass("esri.views.2d.layers.VectorTileLayerView2D")],
l)}(u.LayerView2DMixin(G))});