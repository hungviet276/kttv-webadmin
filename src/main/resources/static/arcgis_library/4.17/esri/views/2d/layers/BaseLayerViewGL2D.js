// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/accessorSupport/decorators ../../../core/libs/earcut/earcut ../../../geometry/support/aaBoundingRect ../../../geometry/support/coordsUtils ../../../layers/graphics/data/projectionSupport ../tiling ../engine/webgl/TurboLine ./LayerView2D ./graphics/graphicsUtils ./support/DisplayGL ./support/util ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(N,O,g,u,C,D,E,y,F,z,G,H,I,A,J,K){var x=new Set,v=[],w=[],L=function(){return function(g,
b,c,a,d,e,p,f,k){void 0===f&&(f=[0,0]);void 0===k&&(k=D.create());this.id=g;this.level=b;this.row=c;this.col=a;this.world=d;this.resolution=e;this.scale=p;this.coords=f;this.bounds=k}}(),M={trackDistance:!0,wrapDistance:1E11,thin:!1,initialDistance:0,enableOuterBisectorSplit:!0,outerBisectorAutoSplitThreshold:1/3.8,enableInnerBisectorSplit:!0,innerBisectorAutoSplitThreshold:1/3.8};return function(B){function b(c){c=B.call(this,c)||this;c._tileMap=new Map;c.container=new I.default(c);c.layer=null;
c.tiles=[];c._renderTarget={framebufferObject:null,viewport:[0,0,0,0]};return c}g.__extends(b,B);Object.defineProperty(b.prototype,"_tileInfoView",{get:function(){var c=this.layer&&this.layer.tileInfo;return c?new F.TileInfoView(c):null},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"context",{get:function(){return this.view._stage.context.gl},enumerable:!1,configurable:!0});b.prototype.attach=function(){};b.prototype.detach=function(){};b.prototype.requestRender=function(){this.container.requestRender()};
b.prototype.tilesChanged=function(c,a){};b.prototype.doRefresh=function(){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(c){return[2]})})};b.prototype.isUpdating=function(){return!1};b.prototype.update=function(c){var a=this._tileInfoView,d=this.tiles;if(a){a=a.getTileCoverage(c.state,0);c=a.spans;var a=a.lodInfo,e=a.level;if(c.length)for(var b=0;b<c.length;b++)for(var f=c[b],g=f.row,m=f.colTo,f=f.colFrom;f<=m;f++){var h=a.normalizeCol(f),n=a.getWorldForColumn(f),
l=e+"/"+g+"/"+h+"/"+n;this._tileMap.has(l)||(h=new L(l,e,g,h,n,a.resolution,a.scale),a.getTileCoords(h.coords,h,!1),a.getTileBounds(h.bounds,h,!0),this._tileMap.set(l,h),d.push(h),v.push(h));x.add(l)}}for(c=d.length-1;0<=c;c--)h=d[c],x.has(h.id)||(d.splice(c,1),w.push(h),this._tileMap.delete(h.id));if(v.length||w.length)this.tilesChanged(v,w),v.length=w.length=0;x.clear();this.requestRender()};b.prototype.moveStart=function(){};b.prototype.viewChange=function(){this.requestUpdate()};b.prototype.moveEnd=
function(){};b.prototype.bindRenderTarget=function(){this.context.bindFramebuffer(this.context.FRAMEBUFFER,this._renderTarget.framebufferObject);this.context.viewport(this._renderTarget.viewport[0],this._renderTarget.viewport[1],this._renderTarget.viewport[2],this._renderTarget.viewport[3])};b.prototype.getRenderTarget=function(){return this._renderTarget};b.prototype.tessellateExtent=function(c){return g.__awaiter(this,void 0,void 0,function(){var a,d,e;return g.__generator(this,function(b){switch(b.label){case 0:return a=
{vertices:[],indices:[]},[4,this._projectAndNormalizeGeometry(c)];case 1:return d=b.sent(),e=a.vertices.length,a.vertices.push({x:d.xmin,y:d.ymin,xOffset:0,yOffset:0,uTexcoord:0,vTexcoord:0,distance:0}),a.vertices.push({x:d.xmax,y:d.ymin,xOffset:0,yOffset:0,uTexcoord:1,vTexcoord:0,distance:0}),a.vertices.push({x:d.xmin,y:d.ymax,xOffset:0,yOffset:0,uTexcoord:0,vTexcoord:1,distance:0}),a.vertices.push({x:d.xmax,y:d.ymax,xOffset:0,yOffset:0,uTexcoord:1,vTexcoord:1,distance:0}),a.indices.push(e+0,e+1,
e+2,e+1,e+3,e+2),[2,a]}})})};b.prototype.tessellatePoint=function(c,a){return g.__awaiter(this,void 0,void 0,function(){var d;return g.__generator(this,function(e){switch(e.label){case 0:return[4,this._projectAndNormalizeGeometry(c)];case 1:return d=e.sent(),[2,this._tessellatePoints([d],a)]}})})};b.prototype.tessellateMultipoint=function(c,a){return g.__awaiter(this,void 0,void 0,function(){var d,e;return g.__generator(this,function(b){switch(b.label){case 0:return[4,this._projectAndNormalizeGeometry(c)];
case 1:return d=b.sent(),e=d.points.map(function(a){return{x:a[0],y:a[1],spatialReference:d.spatialReference}}),[2,this._tessellatePoints(e,a)]}})})};b.prototype._tessellatePoints=function(c,a){return g.__awaiter(this,void 0,void 0,function(){var d,e,b,f,k;return g.__generator(this,function(g){d={vertices:[],indices:[]};e=0;for(b=c;e<b.length;e++)f=b[e],k=d.vertices.length,d.vertices.push({x:f.x,y:f.y,xOffset:a.x,yOffset:a.y+a.height,uTexcoord:0,vTexcoord:0,distance:0}),d.vertices.push({x:f.x,y:f.y,
xOffset:a.x+a.width,yOffset:a.y+a.height,uTexcoord:1,vTexcoord:0,distance:0}),d.vertices.push({x:f.x,y:f.y,xOffset:a.x,yOffset:a.y,uTexcoord:0,vTexcoord:1,distance:0}),d.vertices.push({x:f.x,y:f.y,xOffset:a.x+a.width,yOffset:a.y,uTexcoord:1,vTexcoord:1,distance:0}),d.indices.push(k+0,k+1,k+2,k+1,k+3,k+2);return[2,d]})})};b.prototype.tessellatePolyline=function(c,a){return g.__awaiter(this,void 0,void 0,function(){var d,b,p,f,k,m,h,n,l,q,r,t;return g.__generator(this,function(e){switch(e.label){case 0:return d=
{vertices:[],indices:[]},[4,this._projectAndNormalizeGeometry(c)];case 1:b=e.sent();p=b.paths;if(!p||!p.length)return[2,d];k=new z.StandardTessellationCallbacks(function(b,c,e,g,h,k,l,p,m){e=d.vertices.length;d.vertices.push({x:b,y:-c,xOffset:h*a/2,yOffset:k*a/2,uTexcoord:m/f,vTexcoord:(p+1)/2,distance:m});return e},function(a,b,c){d.indices.push(a,b,c)});m=0;for(h=p;m<h.length;m++){n=h[m];f=0;for(l=1;l<n.length;++l)q=n[l][0]-n[l-1][0],r=n[l][1]-n[l-1][1],f+=Math.sqrt(q*q+r*r);t=n.map(function(a){return{x:a[0],
y:-a[1]}});z.tessellate(t,M,k)}return[2,d]}})})};b.prototype.tessellatePolygon=function(b){return g.__awaiter(this,void 0,void 0,function(){var a,d,c,p,f,k,m,h,n,l,q,r,t,u=this;return g.__generator(this,function(e){switch(e.label){case 0:return a={vertices:[],indices:[]},[4,this._projectAndNormalizeGeometry(b)];case 1:d=e.sent();c=d.rings;if(!c||!c.length)return[2,a];E.closeRings(d);p=0;for(f=d.rings;p<f.length;p++)for(k=f[p],m=0,h=k;m<h.length;m++)n=h[m],n[1]=-n[1];q=l=Infinity;t=r=-Infinity;A.analyzeRings(d.rings,
function(){},function(a,b,c){for(;a<b;a+=2)l=Math.min(l,c[a]),q=Math.min(q,c[a+1]),r=Math.max(r,c[a]),t=Math.max(t,c[a+1])});A.analyzeRings(d.rings,function(){},function(c,b,d,e){u._invokeEarcut(a,c,b,d,e,[l,q,r,t])});return[2,a]}})})};b.prototype._invokeEarcut=function(c,a,b,e,g,f){a=e.slice(a,b);g=C.earcut(a,g,2);b=c.vertices.length;for(e=0;e<a.length;e+=2){var d=a[e],m=a[e+1];c.vertices.push({x:d,y:-m,xOffset:0,yOffset:0,uTexcoord:(d-f[0])/(f[2]-f[0]),vTexcoord:1-(m-f[1])/(f[3]-f[1]),distance:0})}for(e=
0;e<g.length;++e)c.indices.push(b+g[e])};b.prototype._projectAndNormalizeGeometry=function(b){return g.__awaiter(this,void 0,void 0,function(){var a,c;return g.__generator(this,function(d){switch(d.label){case 0:return[4,y.checkProjectionSupport(b.spatialReference,this.view.spatialReference)];case 1:return d.sent(),a=H.normalizeCentralMeridian(b),c=y.project(a,b.spatialReference,this.view.spatialReference),[2,c]}})})};g.__decorate([u.property({dependsOn:["layer.loaded"]})],b.prototype,"_tileInfoView",
null);g.__decorate([u.property()],b.prototype,"layer",void 0);g.__decorate([u.property({dependsOn:["view"]})],b.prototype,"context",null);return b=g.__decorate([u.subclass("esri.views.2d.layers.BaseLayerViewGL2D")],b)}(K.RefreshableLayerView(G.LayerView2DMixin(J)))});