// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/Logger ../../../../../core/MapUtils ../../../../../core/SetUtils".split(" "),function(e,d,k,f,n,p){Object.defineProperty(d,"__esModule",{value:!0});d.Stage=d.Code=d.ShaderBuilder=d.Includes=void 0;var q=f.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");e=function(){function a(){this.includedModules=new Map}a.prototype.include=function(c,b){this.includedModules.has(c)?this.includedModules.get(c)!==b&&q.error("Trying to include shader module multiple times with different sets of options."):
(this.includedModules.set(c,b),c(this.builder,b))};return a}();d.Includes=e;f=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.vertex=new h;b.fragment=new h;b.attributes=new r;b.varyings=new t;b.extensions=new u;b.defines=new l;return b}k.__extends(c,a);Object.defineProperty(c.prototype,"builder",{get:function(){return this},enumerable:!1,configurable:!0});c.prototype.generateSource=function(b){var c=this.extensions.generateSource(b),a=this.attributes.generateSource(b),d=this.varyings.generateSource(),
g="vertex"===b?this.vertex:this.fragment,e=g.uniforms.generateSource(),f=g.code.generateSource();b="vertex"===b?v:w;g=this.defines.generateSource().concat(g.defines.generateSource());return"\n"+c.join("\n")+"\n\n"+g.join("\n")+"\n\n"+b+"\n\n"+e.join("\n")+"\n\n"+a.join("\n")+"\n\n"+d.join("\n")+"\n\n"+f.join("\n")};return c}(e);d.ShaderBuilder=f;var x=function(){function a(){this._entries=[];this._set=new Set}a.prototype.add=function(c,b,a){var d=c+"_"+b+"_"+a;this._set.has(d)||(this._entries.push([c,
b,a]),this._set.add(d));return this};a.prototype.generateSource=function(){return this._entries.map(function(a){var b=a[2];return"uniform "+a[1]+" "+a[0]+(b?"["+b+"]":"")+";"})};return a}(),m=function(){function a(){this._entries=[]}a.prototype.add=function(a){this._entries.push(a)};a.prototype.generateSource=function(){return this._entries};return a}();d.Code=m;var h=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.uniforms=new x;b.code=new m;b.defines=new l;return b}k.__extends(c,
a);Object.defineProperty(c.prototype,"builder",{get:function(){return this},enumerable:!1,configurable:!0});return c}(e);d.Stage=h;var r=function(){function a(){this._entries=[]}a.prototype.add=function(a,b){this._entries.push([a,b])};a.prototype.generateSource=function(a){return"fragment"===a?[]:this._entries.map(function(a){return"attribute "+a[1]+" "+a[0]+";"})};return a}(),t=function(){function a(){this._entries=[]}a.prototype.add=function(a,b){this._entries.push([a,b])};a.prototype.generateSource=
function(){return this._entries.map(function(a){return"varying "+a[1]+" "+a[0]+";"})};return a}(),u=function(){function a(){this._entries=new Set}a.prototype.add=function(a){this._entries.add(a)};a.prototype.generateSource=function(c){var b="vertex"===c?a.ALLOWLIST_VERTEX:a.ALLOWLIST_FRAGMENT;return p.valuesOfSet(this._entries).filter(function(a){return 0<=b.indexOf(a)}).map(function(a){return"#extension "+a+" : enable"})};a.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];
a.ALLOWLIST_VERTEX=[];return a}(),l=function(){function a(){this._entries=new Map}a.prototype.addInt=function(a,b){b=0===b%1?b.toFixed(0):b.toString();this._entries.set(a,b)};a.prototype.addFloat=function(a,b){b=0===b%1?b.toFixed(1):b.toString();this._entries.set(a,b)};a.prototype.generateSource=function(){return n.pairsOfMap(this._entries).map(function(a){return"#define "+a[0]+" "+a[1]})};return a}(),w="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",
v="precision highp float;\nprecision highp sampler2D;"});