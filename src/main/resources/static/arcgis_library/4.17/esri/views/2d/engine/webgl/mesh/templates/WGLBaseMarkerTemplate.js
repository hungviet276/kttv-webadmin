// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../layers/graphics/featureConversionUtils ../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../enums ../../number".split(" "),function(A,h,v,p,w,n,x,e,q,r,y,z,l){Object.defineProperty(h,
"__esModule",{value:!0});var t=3.14159265359/180;h.default=function(h){return function(h){function d(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];a=h.apply(this,a)||this;a.angle=0;a.xOffset=0;a.yOffset=0;a.width=0;a.height=0;a.boundsType="square";a._anchorX=0;a._anchorY=0;a._computedWidth=0;a._computedHeight=0;a.geometryType=z.WGLGeometryType.MARKER;return a}v.__extends(d,h);d.prototype.writeMeshWithGeometry=function(a,b,c,e,f,k){var d=this,m=b.indexVector,g=b.get("geometry"),h=b.getVector("geometry"),
l=h.vertexCount,u=m.length;if(p.isSome(this._markerPlacement))c=null!==k&&void 0!==k?k:c.readLegacyGeometry(),this._writePlacedMarkers(g,m,l,f,c);else{c=k?r.deltaDecodeGeometry(r.convertFromGeometry(k),2):"esriGeometryPolygon"===e?c.readCentroid():c.readUnquantizedGeometry();if(!c)return;c.isPoint?(c=c.coords,this._writeVertices(g,f,this._getPos(c[0],c[1])),this._writeIndices(m,l)):c.forEachVertex(function(a,b){var c=h.vertexCount;d._writeVertices(g,f,d._getPos(a,b));d._writeIndices(m,c)})}b=b.getVector("geometry").vertexCount-
l;a.writeDisplayRecord(this.geometryType,this._materialKey,l,b,u,m.length-u)};d.prototype._applyTransformation=function(a,b,c){void 0===c&&(c=0);n.mat2d.identity(a);n.mat2d.translate(a,a,q.vec2f32.fromValues(this.xOffset,-this.yOffset));0!==this.angle+c&&n.mat2d.rotate(a,a,t*(this.angle+c));c=this._computedWidth;var d=this._computedHeight,f=(this._anchorX-.5)*c,k=(this._anchorY-.5)*d;e.vec2.set(b,f,k);e.vec2.transformMat2d(b,b,a);this._offsetUpperLeft=l.i1616to32(16*b[0],16*b[1]);e.vec2.set(b,f+c,
k);e.vec2.transformMat2d(b,b,a);this._offsetUpperRight=l.i1616to32(16*b[0],16*b[1]);e.vec2.set(b,f,k+d);e.vec2.transformMat2d(b,b,a);this._offsetBottomLeft=l.i1616to32(16*b[0],16*b[1]);e.vec2.set(b,f+c,k+d);e.vec2.transformMat2d(b,b,a);this._offsetBottomRight=l.i1616to32(16*b[0],16*b[1])};d.prototype._writePlacedMarkers=function(a,b,c,d,f){if(f=y.CIMMarkerPlacementHelper.getPlacement(f,p.unwrap(this._markerPlacement),w.pt2px(1)))for(var k=q.vec2f32.create(),h=x.mat2df32.create(),e=0,g=f.next();null!=
g;)-128<=g.tx&&640>=g.tx&&-128<=g.ty&&640>=g.ty&&(this._applyTransformation(h,k,g.getAngle()/t),this._writeVertices(a,d,this._getPos(g.tx,g.ty)),this._writeIndices(b,c+e),e+=4),g=f.next()};d.prototype._getPos=function(a,b){return l.i1616to32(Math.round(8*a),Math.round(8*b))};d.prototype._writeVertices=function(a,b,c){a.push(c);a.push(this._offsetUpperLeft);a.push(this._texUpperLeft);a.push(this._bitestAndDistRatio);a.push(b);a.push(this._fillColor);a.push(this._outlineColor);a.push(this._sizeOutlineWidth);
a.push(c);a.push(this._offsetUpperRight);a.push(this._texUpperRight);a.push(this._bitestAndDistRatio);a.push(b);a.push(this._fillColor);a.push(this._outlineColor);a.push(this._sizeOutlineWidth);a.push(c);a.push(this._offsetBottomLeft);a.push(this._texBottomLeft);a.push(this._bitestAndDistRatio);a.push(b);a.push(this._fillColor);a.push(this._outlineColor);a.push(this._sizeOutlineWidth);a.push(c);a.push(this._offsetBottomRight);a.push(this._texBottomRight);a.push(this._bitestAndDistRatio);a.push(b);
a.push(this._fillColor);a.push(this._outlineColor);a.push(this._sizeOutlineWidth)};d.prototype._writeIndices=function(a,b){a.push(b+0);a.push(b+1);a.push(b+2);a.push(b+1);a.push(b+3);a.push(b+2)};return d}(h)}});