// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../../core/workers ../../../../../../layers/graphics/featureConversionUtils ../../../../../../layers/ogc/ogcFeatureUtils ../../../../../../tasks/operations/query ../../support/FeatureSetReaderJSON ../../support/FeatureSetReaderPBF".split(" "),function(e,g,d,t,l,h,m,k,u){Object.defineProperty(g,"__esModule",{value:!0});g.createSourceAdapter=g.SourceAdapter=void 0;e=function(){function a(a){this.service=a}a.prototype.destroy=function(){};return a}();g.SourceAdapter=
e;g.createSourceAdapter=function(a){var b=a.capabilities,c=a.source;return c&&c.capabilities&&c.collectionId&&c.layerDefinition&&c.url?new v(a):Array.isArray(a.source)?new w(a):b.query.supportsFormatPBF?new x(a):new y(a)};var w=function(a){function b(c){var b=a.call(this,c)||this;b._portsOpen=t.openWithPorts(c.source).then(function(a){return b.client=a});return b}d.__extends(b,a);b.prototype.destroy=function(){this.client.close();this.client=null};b.prototype.executeQuery=function(a,b){return d.__awaiter(this,
void 0,void 0,function(){var c;return d.__generator(this,function(f){switch(f.label){case 0:return[4,this._portsOpen];case 1:return f.sent(),[4,this.client.invoke("queryFeatures",a.toJSON(),b)];case 2:return c=f.sent(),[2,k.FeatureSetReaderJSON.fromFeatureSet(c,this.service.objectIdField)]}})})};return b}(e),x=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype.executeQuery=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c;return d.__generator(this,
function(f){switch(f.label){case 0:return[4,m.executeQueryPBFBuffer(this.service.source,a,b)];case 1:return c=f.sent().data,[2,u.FeatureSetReaderPBF.fromBuffer(c,this.service.geometryType)]}})})};return b}(e),y=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype.executeQuery=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,f,e,g,q,n,h,p,r;return d.__generator(this,function(d){switch(d.label){case 0:c=this.service;f=c.source;e=c.capabilities;
g=c.spatialReference;q=c.objectIdField;if(!a.quantizationParameters||e.query.supportsQuantization)return[3,2];n=a.clone();n.quantizationParameters=null;return[4,m.executeQuery(f,n,g,b)];case 1:return h=d.sent().data,p=l.convertFromFeatureSet(h,q),l.quantizeOptimizedFeatureSet(b.transform,p),[2,k.FeatureSetReaderJSON.fromOptimizedFeatureSet(p)];case 2:return[4,m.executeQuery(f,a,this.service.spatialReference,b)];case 3:return r=d.sent().data,[2,k.FeatureSetReaderJSON.fromFeatureSet(r,this.service.objectIdField)]}})})};
return b}(e),v=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}d.__extends(b,a);b.prototype.executeQuery=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,f,e,g;return d.__generator(this,function(d){switch(d.label){case 0:c=this.service.capabilities;if(!a.quantizationParameters||c.query.supportsQuantization)return[3,2];f=a.clone();f.quantizationParameters=null;return[4,h.queryOptimizedFeatureSet(this.service.source,a,b)];case 1:return e=d.sent(),l.quantizeOptimizedFeatureSet(b.transform,
e),[2,k.FeatureSetReaderJSON.fromOptimizedFeatureSet(e)];case 2:return[4,h.queryOptimizedFeatureSet(this.service.source,a,b)];case 3:return g=d.sent(),[2,k.FeatureSetReaderJSON.fromOptimizedFeatureSet(g)]}})})};return b}(e)});