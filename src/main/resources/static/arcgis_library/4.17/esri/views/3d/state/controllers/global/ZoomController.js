// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),function(m,c,d,q,n,r,p,e,h,k,t,g,l){Object.defineProperty(c,"__esModule",{value:!0});c.ZoomController=
void 0;m=function(c){function b(a){a=c.call(this,a)||this;a.view=null;a.pickPoint=h.vec3f64.create();a.tmpP0=p.vec2f64.create();a.panAxisAngle=l.axisAngle.create();a.tmpRayDir=h.vec3f64.create();a.targetOnSphere=h.vec3f64.create();a.dragBeginPoint=q.createScreenPointArray();a.normalizedAnchorPoint=p.vec2f64.create();a.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};a.sphere=l.sphere.create();a.hasPickPoint=!1;return a}
d.__extends(b,c);Object.defineProperty(b.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!1,configurable:!0});b.prototype.begin=function(a){this.active&&(r.vec2.copy(this.dragBeginPoint,a),g.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),a=g.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,a,!1),this.hasPickPoint=!!a.scenePickPoint,this.pickPoint=a.scenePickPoint,this.sphere=a.sphere,this.constraintOptions.interactionStartCamera=
this.beginCamera)};b.prototype.update=function(a){if(this.active){this.currentCamera.eye=this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;e.vec3.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var b=e.vec3.length(this.tmpRayDir);g.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var c=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),f=b*Math.pow(2,c),d=this.view.state.constraints.minimumPoiDistance;0>c&&
f<d&&(f=d);1E-6>Math.abs(b-f)||(this.hasPickPoint&&f<b&&(c=1-(1-f/b)*(1-this.sphere.radius/e.vec3.length(this.currentCamera.center)),e.vec3.scale(this.currentCamera.center,this.currentCamera.center,c)),e.vec3.scale(this.tmpRayDir,this.tmpRayDir,-f/b),e.vec3.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(this.dragBeginPoint,a),k.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&
(g.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),l.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),g.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle)),k.applySurfaceCollisionConstraint(this.view,this.currentCamera))}};b.prototype.end=function(){this.active&&this.finishController()};d.__decorate([n.property({constructOnly:!0})],b.prototype,"view",void 0);return b=d.__decorate([n.subclass("esri.views.3d.state.controllers.global.ZoomController")],
b)}(t.InteractiveController);c.ZoomController=m});