// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../renderers/support/clickToleranceUtils".split(" "),function(m,a,c,l,n,g,e,p){Object.defineProperty(a,"__esModule",{value:!0});a.TileLayerView=void 0;a.TileLayerView=function(a){return function(a){function d(){return null!==a&&a.apply(this,arguments)||this}c.__extends(d,a);d.prototype.fetchPopupFeatures=function(a,d){return c.__awaiter(this,void 0,void 0,function(){var f,
h,e,q=this;return c.__generator(this,function(m){f=this.layer;if(!a)return[2,g.reject(new l("tilelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:f}))];if("tile"!==f.type)return[2,g.reject(new l("tilelayerview:fetchPopupFeatures","Layer type should be 'tile'",{type:f.type}))];h=this.get("view.scale");e=f.allSublayers.toArray().filter(function(b){var a=0===b.minScale||h<=b.minScale,d=0===b.maxScale||h>=b.maxScale;return b.popupTemplate&&b.popupEnabled&&b.visible&&a&&d});return[2,
g.eachAlways(e.map(function(b){return c.__awaiter(q,void 0,void 0,function(){var k,e,f,g,h;return c.__generator(this,function(c){switch(c.label){case 0:return k=b.createQuery(),e=n.isSome(d)?d.event:null,f=p.calculateTolerance({renderer:b.renderer,event:e}),k.geometry=this.createFetchPopupFeaturesQueryGeometry(a,f),g=k,[4,b.popupTemplate.getRequiredFields()];case 1:return g.outFields=c.sent(),[4,b.queryFeatures(k)];case 2:return h=c.sent(),[2,h.features]}})})})).then(function(a){return[].concat.apply([],
a.map(function(a){return a.value}).filter(Boolean))})]})})};c.__decorate([e.property()],d.prototype,"layer",void 0);return d=c.__decorate([e.subclass("esri.layers.mixins.TileLayerView")],d)}(a)}});