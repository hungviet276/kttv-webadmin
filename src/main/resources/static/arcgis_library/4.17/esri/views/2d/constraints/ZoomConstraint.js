// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../layers/support/LOD".split(" "),function(u,v,f,r,h,t){return function(l){function c(a){a=l.call(this,a)||this;a._lodByScale={};a._scales=[];a.effectiveLODs=null;a.effectiveMinZoom=-1;a.effectiveMaxZoom=-1;a.effectiveMinScale=0;a.effectiveMaxScale=0;a.lods=null;a.minZoom=-1;a.maxZoom=-1;a.minScale=0;a.maxScale=0;a.snapToZoom=!0;return a}f.__extends(c,l);k=c;c.prototype.initialize=function(){var a,
b,c=this,d=this.lods;b=this.minScale;a=this.maxScale;var e=this.minZoom,g=this.maxZoom,f=-1,h=-1,k=!1,l=!1;0!==b&&0!==a&&b<a&&(a=[a,b],b=a[0],a=a[1]);if(d&&d.length){d=d.map(function(a){return a.clone()});d.sort(function(a,b){return b.scale-a.scale});d.forEach(function(a,b){return a.level=b});for(var n,p=0,q=d;p<q.length;p++){var m=q[p];!k&&0<b&&b>=m.scale&&(f=m.level,k=!0);!l&&0<a&&a>=m.scale&&(h=n?n.level:-1,l=!0);n=m}-1===e&&(e=0===b?0:f);-1===g&&(g=0===a?d.length-1:h);e=Math.max(e,0);e=Math.min(e,
d.length-1);g=Math.max(g,0);g=Math.min(g,d.length-1);e>g&&(b=[g,e],e=b[0],g=b[1]);b=d[e].scale;a=d[g].scale;d.splice(0,e);d.splice(g-e+1,d.length);d.forEach(function(a,b){c._lodByScale[a.scale]=a;c._scales[b]=a.scale});this._set("effectiveLODs",d);this._set("effectiveMinZoom",e);this._set("effectiveMaxZoom",g)}this._set("effectiveMinScale",b);this._set("effectiveMaxScale",a)};c.prototype.constrain=function(a,b){if(b&&a.scale===b.scale)return a;var c=this.effectiveMinScale,d=this.effectiveMaxScale,
e=a.targetGeometry,g=b&&b.targetGeometry,f=0!==c&&a.scale>c;if(0!==d&&a.scale<d||f)c=f?c:d,g&&(b=(c-b.scale)/(a.scale-b.scale),e.x=g.x+(e.x-g.x)*b,e.y=g.y+(e.y-g.y)*b),a.scale=c;this.snapToZoom&&this.effectiveLODs&&(a.scale=this._getClosestScale(a.scale));return a};c.prototype.fit=function(a){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(a,null);var b=this.scaleToZoom(a.scale);a.scale=this.zoomToScale(.99<Math.abs(b-Math.floor(b))?Math.round(b):Math.floor(b));return a};c.prototype.zoomToScale=
function(a){if(!this.effectiveLODs)return 0;a-=this.effectiveMinZoom;a=Math.max(0,a);var b=this._scales;if(0>=a)return b[0];if(a>=b.length)return b[b.length-1];var c=Math.round(a);return b[c]+(c-a)*(b[Math.round(a-.5)]-b[c])};c.prototype.scaleToZoom=function(a){if(!this.effectiveLODs)return-1;var b=this._scales,c,d;if(a>=b[0])return this.effectiveMinZoom;if(a<=b[b.length-1])return this.effectiveMaxZoom;for(var e=0;e<b.length-1;e++){c=b[e];d=b[e+1];if(d===a)return b=e+this.effectiveMinZoom,b+1;if(c>
a&&d<a)return b=e+this.effectiveMinZoom,b+1-(a-d)/(c-d)}};c.prototype.snapToClosestScale=function(a){if(!this.effectiveLODs)return a;a=this.scaleToZoom(a);return this.zoomToScale(Math.round(a))};c.prototype.snapToNextScale=function(a,b){void 0===b&&(b=.5);if(!this.effectiveLODs)return a*b;a=Math.round(this.scaleToZoom(a));return this.zoomToScale(a+1)};c.prototype.snapToPreviousScale=function(a,b){void 0===b&&(b=2);if(!this.effectiveLODs)return a*b;a=Math.round(this.scaleToZoom(a));return this.zoomToScale(a-
1)};c.prototype.clone=function(){return new k({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})};c.prototype._getClosestScale=function(a){if(this._lodByScale[a])return this._lodByScale[a].scale;a=this._scales.reduce(function(b,c){return Math.abs(c-a)<=Math.abs(b-a)?c:b},this._scales[0]);return this._lodByScale[a].scale};var k;f.__decorate([h.property({readOnly:!0})],c.prototype,"effectiveLODs",void 0);f.__decorate([h.property({readOnly:!0})],
c.prototype,"effectiveMinZoom",void 0);f.__decorate([h.property({readOnly:!0})],c.prototype,"effectiveMaxZoom",void 0);f.__decorate([h.property({readOnly:!0})],c.prototype,"effectiveMinScale",void 0);f.__decorate([h.property({readOnly:!0})],c.prototype,"effectiveMaxScale",void 0);f.__decorate([h.property({type:[t]})],c.prototype,"lods",void 0);f.__decorate([h.property()],c.prototype,"minZoom",void 0);f.__decorate([h.property()],c.prototype,"maxZoom",void 0);f.__decorate([h.property()],c.prototype,
"minScale",void 0);f.__decorate([h.property()],c.prototype,"maxScale",void 0);f.__decorate([h.property()],c.prototype,"snapToZoom",void 0);return c=k=f.__decorate([h.subclass("esri.views.2d.constraints.ZoomConstraint")],c)}(r)});