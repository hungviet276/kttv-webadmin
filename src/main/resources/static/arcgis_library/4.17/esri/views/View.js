// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../Map ../TimeExtent ../core/Accessor ../core/Collection ../core/CollectionFlattener ../core/Error ../core/Evented ../core/HandleOwner ../core/Loadable ../core/Logger ../core/maybe ../core/Promise ../core/promiseUtils ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/HeightModelInfo ../geometry/SpatialReference ../geometry/support/spatialReferenceUtils ../support/GraphicsCollection ./BasemapView ./LayerViewManager ./RefreshManager ./ToolViewManager ./input/Input ./input/ViewEvents ./navigation/Navigation ./support/DefaultsFromMap".split(" "),
function(O,P,c,t,u,v,h,w,x,y,z,l,A,B,C,m,D,e,d,n,E,F,G,p,H,I,J,K,L,M,q,N){var f=A.getLogger("esri.views.View");return function(k){function a(a){var b=k.call(this,a)||this;b._userSpatialReference=null;b._cursor=null;b.allLayerViews=new w({root:b,rootCollectionNames:["basemapView.baseLayerViews","groundView?.layerViews","layerViews","basemapView.referenceLayerViews"],getChildrenFunction:function(a){return a.layerViews}});b.animation=null;b.basemapView=null;b.defaultsFromMap=new N({view:b});b.fatalError=
null;b.extent=null;b.graphics=new p.default;b.navigating=!1;b.layerViews=new h;b.padding={left:0,top:0,right:0,bottom:0};b.ready=!1;b.spatialReferenceWarningDelay=1E3;b.timeExtent=null;b.type=null;b.scale=null;b.updating=!1;b.initialExtentRequired=!0;b.renderContext=null;b.input=new L;b.navigation=new q;b.layerViewManager=null;b.refreshManager=null;b.isHeightModelInfoRequired=!1;b.width=null;b.height=null;b.resizing=!1;b.suspended=!1;b.viewEvents=new M.ViewEvents(b);b._isValid=!1;b._readyCycleForced=
!1;b.handles.add(b.watch("preconditionsReady",function(a){a?(b._currentSpatialReference=b.spatialReference,g.views.add(b)):(b._currentSpatialReference=null,g.views.remove(b));b.notifyChange("spatialReference");!a&&b.ready?(b.layerViewManager.clear(),b.toolViewManager.detach(),b._teardown()):a&&!b.ready&&(b._startup(),b.toolViewManager.attach())},!0));return b}c.__extends(a,k);g=a;a.prototype.initialize=function(){var a=this;this.addResolvingPromise(this.validate().then(function(){a._isValid=!0;return e.whenOnce(a,
"ready")}));this.basemapView=new H.BasemapView({view:this});this.layerViewManager=new I.default({view:this,layerViewImporter:{importLayerView:function(b){return a.importLayerView(b)},hasLayerViewModule:function(b){return a.hasLayerViewModule(b)}}});this.refreshManager=new J({view:this});this.toolViewManager=new K({view:this});this._resetInitialViewPropertiesFromContent();var b;e.init(this.defaultsFromMap,"isSpatialReferenceDone",function(c){var r=!!(a.map&&0<a.map.allLayers.length);if((!c||a.spatialReference||
!r)&&b)b=null;else if(c&&!a.spatialReference&&r&&!b){var d=b=m.after(a.spatialReferenceWarningDelay);b.then(function(){d===b&&f.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}).catch(function(){})}},!0)};a.prototype.destroy=function(){if(!this.destroyed){this.viewEvents.destroy();this.allLayerViews.destroy();this.navigation&&(this.navigation.destroy(),this._set("navigation",null));this.graphics.destroy();this.graphics=null;this.handles.remove("defaultsFromMap");
this.defaultsFromMap.destroy();this._set("defaultsFromMap",null);this.toolViewManager.destroy();this.toolViewManager=null;this.refreshManager.destroy();this.refreshManager=null;this.layerViewManager.destroy();this.layerViewManager=null;this.basemapView.destroy();this.basemapView=null;this.invalidate();this._emitter.clear();this.handles.removeAll();var a=this.map;this.map=null;null===a||void 0===a?void 0:a.destroy()}};a.prototype._startup=function(){this._set("ready",!0)};a.prototype._teardown=function(){this._set("ready",
!1)};a.prototype.whenReady=function(){return m.resolve()};a.prototype.toMap=function(){f.error("#toMap()","Not implemented on this instance of View");return null};Object.defineProperty(a.prototype,"heightModelInfo",{get:function(){return this.getDefaultHeightModelInfo()},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"interacting",{get:function(){return this.navigating},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"preconditionsReady",{get:function(){return!!(!this.fatalError&&
this._isValid&&!this._readyCycleForced&&this.map&&(!l.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"map",{set:function(a){var b=
this._get("map");if(a!==b){if(null===a||void 0===a?0:a.destroyed)f.warn("#map","The provided map is already destroyed",{map:a}),a=null;l.isLoadable(a)&&a.load().catch(function(){});this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent());this._set("map",a)}},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"spatialReference",{get:function(){var a=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;a&&this.isHeightModelInfoRequired&&
this.defaultsFromMap&&(a=a.clone(),a.vcsWkid=this.defaultsFromMap.vcsWkid,a.latestVcsWkid=this.defaultsFromMap.latestVcsWkid);return a},set:function(a){this._userSpatialReference=a;this._set("spatialReference",a)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"stationary",{get:function(){return!this.animation&&!this.navigating&&!this.resizing},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"initialExtent",{get:function(){return this.defaultsFromMap&&this.defaultsFromMap.extent},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"cursor",{get:function(){var a=this.toolViewManager?this.toolViewManager.cursor:null;return B.isSome(a)?a:this._cursor||"default"},set:function(a){this._cursor=a;this.notifyChange("cursor")},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return[this.width,this.height]},enumerable:!1,configurable:!0});a.prototype.whenLayerView=function(a){return this.layerViewManager.whenLayerView(a)};a.prototype.getDefaultSpatialReference=
function(){return this.get("defaultsFromMap.spatialReference")};a.prototype.getDefaultHeightModelInfo=function(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null};a.prototype.importLayerView=function(a){throw new x("importLayerView() not implemented");};a.prototype.hasLayerViewModule=function(a){return!1};a.prototype.validate=function(){return c.__awaiter(this,void 0,void 0,function(){return c.__generator(this,function(a){return[2]})})};
a.prototype.invalidate=function(){this._isValid=!1};a.prototype.isSpatialReferenceSupported=function(a,b,c){return!0};a.prototype.isTileInfoRequired=function(){return!1};a.prototype.when=function(a,b){this.isResolved()&&!this.ready&&f.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.');return k.prototype.when.call(this,a,b)};a.prototype.forceReadyCycle=function(){var a=
this;this.ready&&(this._readyCycleForced=!0,e.whenFalseOnce(this,"preconditionsReady",function(){return a._readyCycleForced=!1}))};a.prototype.createTool=function(a,b,c){return this.toolViewManager.createTool(a,b,c)};a.prototype.tryFatalErrorRecovery=function(){this.fatalError=null};a.prototype._resetInitialViewPropertiesFromContent=function(){var a=this;if(this.defaultsFromMap){var b=function(){return a.defaultsFromMap&&a.defaultsFromMap.start()};this.defaultsFromMap.reset();this._currentSpatialReference=
null;this.notifyChange("spatialReference");this.handles.remove("defaultsFromMap");this.handles.add([e.watch(this,"spatialReference",function(a,c){G.equals(a,c)||b()}),e.watch(this,"initialExtentRequired",b),D.schedule(b)],"defaultsFromMap")}};var g;a.views=new h;c.__decorate([d.aliasOf("toolViewManager.activeTool")],a.prototype,"activeTool",void 0);c.__decorate([d.property({readOnly:!0})],a.prototype,"allLayerViews",void 0);c.__decorate([d.property()],a.prototype,"animation",void 0);c.__decorate([d.property()],
a.prototype,"basemapView",void 0);c.__decorate([d.property()],a.prototype,"defaultsFromMap",void 0);c.__decorate([d.property()],a.prototype,"fatalError",void 0);c.__decorate([d.property({type:n})],a.prototype,"extent",void 0);c.__decorate([d.property(p.graphicsCollectionProperty)],a.prototype,"graphics",void 0);c.__decorate([d.property({readOnly:!0,type:E,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]})],a.prototype,"heightModelInfo",null);c.__decorate([d.property({readOnly:!0,
dependsOn:["navigating"]})],a.prototype,"interacting",null);c.__decorate([d.property({readOnly:!0})],a.prototype,"navigating",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:"fatalError _isValid _readyCycleForced map map.loaded? width height spatialReference _currentSpatialReference initialExtentRequired initialExtent defaultsFromMap.isSpatialReferenceDone defaultsFromMap.isTileInfoDone".split(" ")})],a.prototype,"preconditionsReady",null);c.__decorate([d.property({type:h,readOnly:!0})],a.prototype,
"layerViews",void 0);c.__decorate([d.property({value:null,type:t})],a.prototype,"map",null);c.__decorate([d.property()],a.prototype,"padding",void 0);c.__decorate([d.property({readOnly:!0})],a.prototype,"ready",void 0);c.__decorate([d.property({type:F,dependsOn:["defaultsFromMap.spatialReference","defaultsFromMap.vcsWkid","defaultsFromMap.latestVcsWkid"]})],a.prototype,"spatialReference",null);c.__decorate([d.property()],a.prototype,"spatialReferenceWarningDelay",void 0);c.__decorate([d.property({dependsOn:["animation",
"navigating","resizing"]})],a.prototype,"stationary",null);c.__decorate([d.property({type:u})],a.prototype,"timeExtent",void 0);c.__decorate([d.aliasOf("toolViewManager.tools")],a.prototype,"tools",void 0);c.__decorate([d.property()],a.prototype,"toolViewManager",void 0);c.__decorate([d.property({readOnly:!0})],a.prototype,"type",void 0);c.__decorate([d.property({type:Number})],a.prototype,"scale",void 0);c.__decorate([d.property({readOnly:!0})],a.prototype,"updating",void 0);c.__decorate([d.property({readOnly:!0})],
a.prototype,"initialExtentRequired",void 0);c.__decorate([d.property({readOnly:!0,type:n,dependsOn:["defaultsFromMap.extent"]})],a.prototype,"initialExtent",null);c.__decorate([d.property({dependsOn:["toolViewManager.cursor"]})],a.prototype,"cursor",null);c.__decorate([d.property()],a.prototype,"renderContext",void 0);c.__decorate([d.property({readOnly:!0})],a.prototype,"input",void 0);c.__decorate([d.property({type:q,nonNullable:!0})],a.prototype,"navigation",void 0);c.__decorate([d.property()],
a.prototype,"layerViewManager",void 0);c.__decorate([d.property()],a.prototype,"width",void 0);c.__decorate([d.property()],a.prototype,"height",void 0);c.__decorate([d.property({readOnly:!0})],a.prototype,"resizing",void 0);c.__decorate([d.property({value:null,dependsOn:["width","height"],readOnly:!0})],a.prototype,"size",null);c.__decorate([d.property({readOnly:!0})],a.prototype,"suspended",void 0);c.__decorate([d.property({readOnly:!0})],a.prototype,"viewEvents",void 0);c.__decorate([d.property()],
a.prototype,"_isValid",void 0);c.__decorate([d.property()],a.prototype,"_readyCycleForced",void 0);c.__decorate([d.property()],a.prototype,"_currentSpatialReference",void 0);return a=g=c.__decorate([d.subclass("esri.views.View")],a)}(z.HandleOwnerMixin(y.EventedMixin(C.EsriPromiseMixin(v))))});