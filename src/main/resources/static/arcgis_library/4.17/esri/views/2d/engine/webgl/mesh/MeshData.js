// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../WGLDisplayObject ../WGLDisplayRecord ../collisions/Metric ../util/Reader ../util/serializationUtils ../util/Writer".split(" "),function(r,g,t,u,v,m,n,p){Object.defineProperty(g,"__esModule",{value:!0});g.MeshData=void 0;r=function(){function b(a,d){this.vertexVectorsMap=a;this._currentIndex=-1;this._currentMetricOffset=this._currentRecordOffset=0;a=4*(8*d.records+1);var b=4*(20*d.metrics+1);this._bufDisplayObjects=new p.default(Uint32Array,4*(4*d.features+1)+4);this._bufDisplayRecords=
new p.default(Uint32Array,a+4);this._bufMetrics=new p.default(Uint32Array,b+4);this._bufDisplayObjects.push(0);this._bufDisplayRecords.push(0);this._bufMetrics.push(0)}Object.defineProperty(b.prototype,"vertexBuffersMap",{get:function(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(var a=0;a<this.vertexVectorsMap.length;a++)this._vertexBuffersMap[a]=this.vertexVectorsMap[a].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap},enumerable:!1,configurable:!0});b.prototype.get=
function(a){return this.vertexVectorsMap[a]};b.prototype.currentDisplayRecordCount=function(){return this._bufDisplayRecords[this._currentRecordOffset]};b.prototype.writeDisplayObject=function(a,d){this._bufDisplayObjects.incr(0);this._currentIndex=this._bufDisplayObjects.push(a);this._bufDisplayObjects.push(d);this._bufDisplayObjects.push(0);this._bufDisplayObjects.push(0);this._currentMetricOffset=this._currentRecordOffset=0};b.prototype.hasDisplayRecords=function(){return 0!==this._currentRecordOffset};
b.prototype.endDisplayObject=function(){this.hasDisplayRecords()||this._rollbackDisplayObject()};b.prototype.writeDisplayRecord=function(a,d,b,c,q,k,f,h){void 0===f&&(f=0);void 0===h&&(h=0);0===this._currentRecordOffset&&(this._currentRecordOffset=this._bufDisplayRecords.push(0),this._bufDisplayObjects.setValue(this._currentIndex+2,this._currentRecordOffset));this._bufDisplayRecords.incr(this._currentRecordOffset);this._bufDisplayRecords.push(a);this._bufDisplayRecords.push(d);this._bufDisplayRecords.push(b);
this._bufDisplayRecords.push(c);this._bufDisplayRecords.push(q);this._bufDisplayRecords.push(k);this._bufDisplayRecords.push(f);this._bufDisplayRecords.push(h)};b.prototype.writeMetrics=function(a){0===this._currentMetricOffset&&(this._bufDisplayObjects.setValue(this._currentIndex+3,this._bufMetrics.length),this._currentMetricOffset=this._bufMetrics.length);n.serializeList(this._bufMetrics,a)};b.deserializeDisplayObjects=function(a){var b=a.bufMetrics,e=a.bufRecords;a=new m.default(a.bufDisplayObjects);
var e=new m.default(e),b=new m.default(b),c=[],q=a.readInt32();e.readInt32();for(b.readInt32();q--;){var k=a.readInt32(),f=a.readInt32(),h=a.readInt32(),g=a.readInt32(),l=new t(k);0!==f&&(l.insertAfter=f);0!==h&&(l.displayRecords=n.deserializeList(e,u,{id:k}));0!==g&&(l.metrics=n.deserializeList(b,v.default));c.push(l)}return c};b.prototype.encode=function(a,b){for(var e={},c=0;c<this.vertexVectorsMap.length;c++){var d=this.vertexVectorsMap[c];e[c]={};d.transfer(e[c],b)}a.bufDisplayObjects=this._bufDisplayObjects.buffer();
a.bufRecords=this._bufDisplayRecords.buffer();a.bufMetrics=this._bufMetrics.buffer();b.push(a.bufDisplayObjects);b.push(a.bufMetrics);b.push(a.bufRecords);a.vertexBuffersMap=e;this.destroy()};b.prototype.destroy=function(){this._bufMetrics=this._bufDisplayRecords=this._bufDisplayObjects=this.vertexVectorsMap=null};b.prototype._rollbackDisplayObject=function(){this._bufDisplayObjects.decr(0);this._bufDisplayObjects.seek(this._bufDisplayObjects.length-4);this._currentIndex=this._bufDisplayObjects.length};
return b}();g.MeshData=r});