// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/mathUtils","../../../../geometry/support/geodesicConstants"],function(w,d,e,h){function t(a,b,c){var f=c.parameters;c=c.paddingPixelsOverride;g.scale=Math.min(f.divisor/(b-f.offset),1);g.factor=Math.abs(a*a*a);g.minPixelSize=f.minPixelSize;g.paddingPixels=c;return g}function p(a,b){return 0===a?b.minPixelSize:b.minPixelSize*(1+2*b.paddingPixels/a)}function q(a,b){return Math.max(e.lerp(a*b.scale,a,b.factor),p(a,b))}Object.defineProperty(d,"__esModule",
{value:!0});d.scale=d.applyPrecomputedScaleFactor=d.precomputeScaleFactor=d.applyScaleFactorVec2=d.applyScaleFactor=d.getLabelSettings=d.getSettings=void 0;d.getSettings=function(a){return new u(a,n)};d.getLabelSettings=function(a){var b=n.curvatureDependent;return new u(a,{curvatureDependent:{min:{curvature:b.min.curvature,tiltAngle:b.min.tiltAngle,scaleFallOffFactor:r.curvatureDependent.min.scaleFallOffFactor},max:{curvature:b.max.curvature,tiltAngle:b.max.tiltAngle,scaleFallOffFactor:r.curvatureDependent.max.scaleFallOffFactor}},
scaleStart:n.scaleStart,scaleFallOffRange:n.scaleFallOffRange,minPixelSize:r.minPixelSize})};d.applyScaleFactor=q;d.applyScaleFactorVec2=function(a,b,c){void 0===c&&(c=[0,0]);var f=Math.min(Math.max(b.scale,p(a[1],b)/a[1]),1);c[0]=e.lerp(a[0]*f,a[0],b.factor);c[1]=e.lerp(a[1]*f,a[1],b.factor);return c};d.precomputeScaleFactor=function(a,b,c,f){a=t(a,b,c);a.minPixelSize=0;a.paddingPixels=0;a=q(1,a);f.scale=a;f.factor=0;f.minPixelSize=c.parameters.minPixelSize;f.paddingPixels=c.paddingPixelsOverride};
d.applyPrecomputedScaleFactor=function(a,b,c){void 0===c&&(c=[0,0]);b=Math.min(Math.max(b.scale,p(a[1],b)/a[1]),1);c[0]=a[0]*b;c[1]=a[1]*b;return c};d.scale=function(a,b,c,f){return q(a,t(b,c,f))};var u=function(){function a(b,c,a,k){void 0===a&&(a={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=b;this.description=c;this.parameters=a;this._paddingPixelsOverride=k;2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,
this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!1,configurable:!0});a.prototype.update=function(b){if(this.parameters&&this.parameters.camera.fovY===
b.fovY&&this.parameters.camera.distance===b.distance)return!1;this.calculateParameters(b,this.parameters);return!0};a.prototype.overridePadding=function(b){return b!==this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,b):this};a.prototype.calculateParameters=function(b,a){var c=this.description,k=c.scaleStart,d=c.scaleFallOffRange,c=c.minPixelSize,e=b.fovY,h=b.distance,l=this.calculateCurvatureDependentParameters(b),g=this.coverageCompensation(b,l),m=l.tiltAngle,l=
l.scaleFallOffFactor,h=Math.sin(m)*h,m=.5*Math.PI-m-e*(.5-k*g),k=h/Math.cos(m),d=(k-h/Math.cos(m+e*d*g)*l)/(1-l);a.camera.fovY=b.fovY;a.camera.distance=b.distance;a.offset=d;a.divisor=k-d;a.minPixelSize=c;return a};a.prototype.calculateCurvatureDependentParametersLocal=function(b,a){void 0===a&&(a=v);a.tiltAngle=this.description.curvatureDependent.min.tiltAngle;a.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return a};a.prototype.calculateCurvatureDependentParametersGlobal=
function(b,a){void 0===a&&(a=v);var c=this.description.curvatureDependent;b=1+b.distance/h.earthRadius;var d=[c.min.curvature,c.max.curvature],g=d[0];b=e.clamp((Math.sqrt(b*b-1)-g)/(d[1]-g),0,1);d=[c.min,c.max];c=d[0];d=d[1];a.tiltAngle=e.lerp(c.tiltAngle,d.tiltAngle,b);a.scaleFallOffFactor=e.lerp(c.scaleFallOffFactor,d.scaleFallOffFactor,b);return a};a.prototype.surfaceCoverageCompensationLocal=function(a,c){return(a.fovY-c.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,
c){var b=h.earthRadius*h.earthRadius;c=c.tiltAngle+.5*Math.PI;var d=a.fovY;a=a.distance;a=a*a+b-2*Math.cos(c)*a*h.earthRadius;var e=Math.sqrt(a);return(Math.acos(Math.sqrt(a-b)/e)-Math.asin(h.earthRadius/(e/Math.sin(c)))+.5*d)/d};return a}(),n={curvatureDependent:{min:{curvature:e.deg2rad(10),tiltAngle:e.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:e.deg2rad(70),tiltAngle:e.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},r={curvatureDependent:{min:{scaleFallOffFactor:.7},
max:{scaleFallOffFactor:.95}},minPixelSize:14},g={scale:0,factor:0,minPixelSize:0,paddingPixels:0},v={tiltAngle:0,scaleFallOffFactor:0}});