// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/promiseUtils","../../../../core/promiseUtils","./packingUtils"],function(m,n,q,p,r){Object.defineProperty(n,"__esModule",{value:!0});m=function(){function l(b){this.size=b;var g=document.createElement("canvas");g.width=g.height=b;this._context=g.getContext("2d");this._gridOuter=new Float64Array(b*b);this._gridInner=new Float64Array(b*b);this._f=new Float64Array(b);this._d=new Float64Array(b);this._z=new Float64Array(b+1);this._v=new Int16Array(b)}l.prototype.dispose=
function(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null;this._svg&&(document.body.removeChild(this._svg),this._svg=null)};l.prototype.draw=function(b,g,f){var a=this;void 0===f&&(f=31);this._initSVG();var k=this._createSVGString(b);return q.create(function(b,d){var c=new Image;c.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(k);c.onload=function(){c.onload=null;a._context.clearRect(0,0,a.size,a.size);a._context.drawImage(c,0,0,a.size,a.size);for(var d=
a._context.getImageData(0,0,a.size,a.size),g=new Uint8Array(a.size*a.size*4),e=0;e<a.size*a.size;e++){var h=d.data[4*e+3]/255;a._gridOuter[e]=1===h?0:0===h?1E20:Math.pow(Math.max(0,.5-h),2);a._gridInner[e]=1===h?1E20:0===h?0:Math.pow(Math.max(0,h-.5),2)}a._edt(a._gridOuter,a.size,a.size);a._edt(a._gridInner,a.size,a.size);for(e=0;e<a.size*a.size;e++)r.packFloatRGBA(.5-(a._gridOuter[e]-a._gridInner[e])/(2*f),g,4*e);b(g)};var h=g&&g.signal;if(h)p.onAbort(h,function(){return d(p.createAbortError())})})};
l.prototype._initSVG=function(){if(!this._svg){var b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttribute("style","position: absolute;");b.setAttribute("width","0");b.setAttribute("height","0");b.setAttribute("aria-hidden","true");b.setAttribute("role","presentation");document.body.appendChild(b);this._svg=b}};l.prototype._createSVGString=function(b){var g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d",b);this._svg.appendChild(g);b=g.getBBox();
var f=b.width/b.height,a=this.size/2,k,c,d;1<f?(c=k=a/b.width,d=this.size/4,f=a-1/f*a/2):(k=c=a/b.height,d=a-a*f/2,f=this.size/4);g.setAttribute("style","transform: matrix("+k+", 0, 0, "+c+", "+(-b.x*k+d)+", "+(-b.y*c+f)+")");b='\x3csvg style\x3d"fill:red;" height\x3d"'+this.size+'" width\x3d"'+this.size+'" xmlns\x3d"http://www.w3.org/2000/svg"\x3e'+this._svg.innerHTML+"\x3c/svg\x3e";this._svg.removeChild(g);return b};l.prototype._edt=function(b,g,f){for(var a=this._f,k=this._d,c=this._v,d=this._z,
e=0;e<g;e++){for(var h=0;h<f;h++)a[h]=b[h*g+e];this._edt1d(a,k,c,d,f);for(h=0;h<f;h++)b[h*g+e]=k[h]}for(h=0;h<f;h++){for(e=0;e<g;e++)a[e]=b[h*g+e];this._edt1d(a,k,c,d,g);for(e=0;e<g;e++)b[h*g+e]=Math.sqrt(k[e])}};l.prototype._edt1d=function(b,g,f,a,k){f[0]=0;a[0]=-1E20;a[1]=1E20;for(var c=1,d=0;c<k;c++){for(var e=(b[c]+c*c-(b[f[d]]+f[d]*f[d]))/(2*c-2*f[d]);e<=a[d];)d--,e=(b[c]+c*c-(b[f[d]]+f[d]*f[d]))/(2*c-2*f[d]);d++;f[d]=c;a[d]=e;a[d+1]=1E20}for(d=c=0;c<k;c++){for(;a[d+1]<c;)d++;g[c]=(c-f[d])*(c-
f[d])+b[f[d]]}};return l}();n.default=m});