// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../support/mathUtils ./geometryDataUtils ./Object3DStateSet ./Util ../materials/renderers/utils".split(" "),function(r,t,c,k,l,f,m,e,n,p,q,g,h){return function(){function a(b,d,a,c,f,e,g){this.uniqueName=null;this.shaderTransformationDirty=
!0;this.data=b.toRenderData();this.boundingInfo=d;this.material=a;this.origin=null;this.center=m.vec3f64.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=f;c&&this.updateTransformation(c,e);this.castShadow=g;this.instanceParameters={highlights:null,occludees:null,visible:!0}}a.prototype.updateTransformation=function(b,d){this.transformation=b;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(b,d,this.center)};a.prototype.shaderTransformationChanged=
function(){this.shaderTransformationDirty=!0};a.prototype.getBoundingSphere=function(b,d,a){d=d||n.maxScale(b);f.vec3.transformMat4(a,this.boundingInfo.getCenter(),b);return this.boundingInfo.getBSRadius()*d};Object.defineProperty(a.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!1,configurable:!0});a.prototype.getShaderTransformation=function(){if(!this.calculateShaderTransformation)return c.unwrapOr(this.transformation,e.IDENTITY);this.shaderTransformationDirty&&
(this.shaderTransformation||(this.shaderTransformation=l.mat4f64.create()),k.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(c.unwrapOr(this.transformation,e.IDENTITY))),this.shaderTransformationDirty=!1);return this.shaderTransformation};a.prototype.computeAttachmentOrigin=function(b){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,b)?(c.isSome(this.transformation)&&f.vec3.transformMat4(b,b,this.transformation),!0):!1;var a=this.getIndices(g.VertexAttrConstants.POSITION),
e=this.getAttribute(g.VertexAttrConstants.POSITION);return p.computeAttachmentOriginTriangles(e,a,b)?(c.isSome(this.transformation)&&f.vec3.transformMat4(b,b,this.transformation),!0):!1};a.prototype.getIndices=function(b){return"indices"in this.data?this.data.indices[b]:null};a.prototype.getAttribute=function(b){return"vertexAttr"in this.data?this.data.vertexAttr[b]:null};a.prototype.addHighlight=function(){var b=q.generateObject3DStateId(0),a=this.instanceParameters;a.highlights=h.addObject3DStateID(a.highlights,
b);return b};a.prototype.removeHighlight=function(b){var a=this.instanceParameters;a.highlights=h.removeObject3DStateID(a.highlights,b)};return a}()});