// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/Evented ../../../../../core/maybe ./EditGeometry ./EditGeometry".split(" "),function(m,f,r,t,g,h,k){Object.defineProperty(f,"__esModule",{value:!0});f.AppendVertexOperation=f.RemoveVerticesOperation=f.UpdateVerticesOperation=f.SplitEdgeOperation=f.EditGeometryHelper=void 0;Object.defineProperty(f,"EditGeometry",{enumerable:!0,get:function(){return k.EditGeometry}});Object.defineProperty(f,"Vertex",{enumerable:!0,get:function(){return k.Vertex}});Object.defineProperty(f,
"Edge",{enumerable:!0,get:function(){return k.Edge}});Object.defineProperty(f,"Component",{enumerable:!0,get:function(){return k.Component}});m=function(d){function b(a,b){var c=d.call(this)||this;c.data=a;c.type=b;c._dirty=!0;c._geometry=null;return c}r.__extends(b,d);b.prototype.splitEdge=function(a,b){a=new n(this,a,b);this.data.apply(a);this._dirty=!0;return a};b.prototype.moveVertices=function(a,b,d,e){var c=null;this.data.lastOperation instanceof l&&this.data.lastOperation.canAccumulate(a)?
(c=this.data.lastOperation,c.accumulate(b,d,e)):(c=new l(this,a,b,d,e),this.data.apply(c));this._dirty=!0;return c};b.prototype.removeVertices=function(a){var b=0;switch(this.type){case "point":b=1;break;case "polyline":b=2;break;case "polygon":b=3}a=new p(this,a,b);this.data.apply(a);this._dirty=!0;return a};b.prototype.appendVertex=function(a){if(0===this.data.components.length)return null;a=new q(this,this.data.components[0],a);this.data.apply(a);this._dirty=!0;return a};b.prototype.canRemoveVertex=
function(){var a=0;switch(this.type){case "point":a=1;break;case "polyline":a=2;break;case "polygon":a=3}return this.data.components[0].vertices.length>a};b.prototype.undo=function(){this.data.undo();this._dirty=!0};Object.defineProperty(b.prototype,"canUndo",{get:function(){return this.data.canUndo},enumerable:!1,configurable:!0});b.prototype.redo=function(){this.data.redo();this._dirty=!0};Object.defineProperty(b.prototype,"canRedo",{get:function(){return this.data.canRedo},enumerable:!1,configurable:!0});
Object.defineProperty(b.prototype,"geometry",{get:function(){if(this._dirty){switch(this.type){case "point":this._geometry=this.data.toPoint();break;case "polyline":this._geometry=this.data.toPolyline();break;case "polygon":this._geometry=this.data.toPolygon()}this._dirty=!1}return this._geometry},enumerable:!1,configurable:!0});return b}(t);f.EditGeometryHelper=m;var n=function(){function d(b,a,c){this.helper=b;this.edge=a;this.t=c;this.right=this.left=this.createdVertex=null}d.prototype.apply=function(){var b=
"redo",a=this.edge,c=a.component,d=a.component.data,e=a.left,f=a.right;c.edges.splice(c.edges.indexOf(a),1);g.isNone(this.createdVertex)&&(b="apply",this.createdVertex=new h.Vertex(a.component));c.vertices.push(this.createdVertex);this.createdVertex.pos=d.coordinateHelper.lerp(a.left.pos,a.right.pos,this.t,d.coordinateHelper.createNew());g.isNone(this.left)&&(this.left=new h.Edge(c,e,this.createdVertex));c.edges.push(this.left);e.right=this.left;g.isNone(this.right)&&(this.right=new h.Edge(c,this.createdVertex,
f));c.edges.push(this.right);f.left=this.right;c.updateVertexIndex(this.createdVertex,e.index+1);this.helper.emit("vertex-add",{type:"vertex-add",vertices:[this.createdVertex],operation:b})};d.prototype.undo=function(){if(g.isNone(this.createdVertex)||g.isNone(this.left)||g.isNone(this.right))return null;var b=this.edge,a=b.component,c=this.createdVertex.left.left,d=this.createdVertex.right.right;a.vertices.splice(a.vertices.indexOf(this.createdVertex),1);a.edges.splice(a.edges.indexOf(this.left),
1);a.edges.splice(a.edges.indexOf(this.right),1);a.edges.push(this.edge);c.right=b;d.left=b;a.updateVertexIndex(c,c.index);this.helper.emit("vertex-remove",{type:"vertex-remove",vertices:[this.createdVertex],operation:"undo"})};return d}();f.SplitEdgeOperation=n;var l=function(){function d(b,a,c,d,e){this.helper=b;this.applied=!1;this.vertices=a;this.dx=c;this.dy=d;this.dz=e}d.prototype.apply=function(){var b=this;this.vertices.forEach(function(a){b.helper.data.coordinateHelper.addDelta(a.pos,b.dx,
b.dy,b.dz)});this.helper.data.components.forEach(function(a){a.unnormalizeVertexPositions()});this.helper.emit("vertex-update",{type:"vertex-update",vertices:this.vertices,operation:this.applied?"redo":"apply"});this.applied=!0};d.prototype.undo=function(){var b=this;this.vertices.forEach(function(a){b.helper.data.coordinateHelper.addDelta(a.pos,-b.dx,-b.dy,-b.dz)});this.helper.emit("vertex-update",{type:"vertex-update",vertices:this.vertices,operation:"undo"})};d.prototype.canAccumulate=function(b){if(b.length!==
this.vertices.length)return!1;for(var a=0;a<b.length;++a)if(b[a]!==this.vertices[a])return!1;return!0};d.prototype.accumulate=function(b,a,c){var d=this;this.vertices.forEach(function(e){d.helper.data.coordinateHelper.addDelta(e.pos,b,a,c)});this.dx+=b;this.dy+=a;this.dz+=c;this.helper.emit("vertex-update",{type:"vertex-update",vertices:this.vertices,operation:"apply"})};return d}();f.UpdateVerticesOperation=l;var p=function(){function d(b,a,c){void 0===c&&(c=0);this.helper=b;this.removedVertices=
null;this._minNumberOfVertices=0;this.vertices=a;this._minNumberOfVertices=c}d.prototype.apply=function(){var b=this,a="redo";null==this.removedVertices?(this.removedVertices=[],this.vertices.forEach(function(a){a=b._removeVertex(a);g.isSome(a)&&b.removedVertices.push(a)}),a="apply"):this.removedVertices.forEach(function(a){b._redoRemoveVertex(a)});this.helper.emit("vertex-remove",{type:"vertex-remove",vertices:this.vertices,operation:a})};d.prototype.undo=function(){var b=this;this.removedVertices.forEach(function(a){b._undoRemoveVertex(a)});
this.helper.emit("vertex-add",{type:"vertex-add",vertices:this.vertices,operation:"undo"})};d.prototype._removeVertex=function(b){var a=b.component;if(a.vertices.length<=this._minNumberOfVertices)return null;var c={removedVertex:b,createdEdge:null},d=b.left,e=b.right;a.vertices.splice(a.vertices.indexOf(b),1);d&&(a.edges.splice(a.edges.indexOf(d),1),d.left.right=null);e&&(a.edges.splice(a.edges.indexOf(e),1),e.right.left=null);0===b.index&&e&&0<this.vertices.length&&a.swapVertices(a.vertices.indexOf(e.right),
0);d&&e&&(c.createdEdge=new h.Edge(a,d.left,e.right),a.edges.push(c.createdEdge));e&&a.updateVertexIndex(e.right,e.right.index-1);return c};d.prototype._redoRemoveVertex=function(b){console.warn("redo remove vertex not implemented yet")};d.prototype._undoRemoveVertex=function(b){var a=b.removedVertex,c=b.removedVertex.component,d=a.left,e=a.right;b.createdEdge&&c.edges.splice(c.edges.indexOf(b.createdEdge),1);c.vertices.push(a);d&&(c.edges.push(d),d.left.right=d);e&&(c.edges.push(e),e.right.left=
e);c.updateVertexIndex(a,a.index)};return d}();f.RemoveVerticesOperation=p;var q=function(){function d(b,a,c){this.helper=b;this.component=a;this.pos=c;this.right=this.left=this.originalEdge=this.addedVertex=null}d.prototype.apply=function(){var b="redo";g.isNone(this.addedVertex)&&(b="apply",this.addedVertex=new h.Vertex(this.component));if(0===this.component.vertices.length)this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,this.addedVertex.index=0;else{var a=g.unwrap(this.component.findEndVertex()),
c=null;a.right&&(this.originalEdge=a.right,c=this.originalEdge.right,this.component.edges.splice(this.component.edges.indexOf(this.originalEdge),1));this.component.vertices.push(this.addedVertex);this.addedVertex.pos=this.pos;g.isNone(this.left)&&(this.left=new h.Edge(this.component,a,this.addedVertex));this.component.edges.push(this.left);a.right=this.left;g.isSome(this.originalEdge)&&g.isSome(c)&&(g.isNone(this.right)&&(this.right=new h.Edge(this.component,this.addedVertex,c)),this.component.edges.push(this.right),
c.left=this.right);this.component.updateVertexIndex(this.addedVertex,a.index+1)}this.helper.emit("vertex-add",{type:"vertex-add",vertices:[this.addedVertex],operation:b})};d.prototype.undo=function(){if(g.isNone(this.addedVertex))return null;this.component.vertices.splice(this.component.vertices.indexOf(this.addedVertex),1);g.isSome(this.left)&&(this.component.edges.splice(this.component.edges.indexOf(this.left),1),this.left.left.right=null);g.isSome(this.right)&&(this.component.edges.splice(this.component.edges.indexOf(this.right),
1),this.right.right.left=null);g.isSome(this.originalEdge)&&(this.component.edges.push(this.originalEdge),this.originalEdge.left.right=this.originalEdge,this.originalEdge.right.left=this.originalEdge);g.isSome(this.left)?this.component.updateVertexIndex(this.left.left,this.left.left.index):this.component.updateVertexIndex(this.addedVertex,0);this.helper.emit("vertex-remove",{type:"vertex-remove",vertices:[this.addedVertex],operation:"undo"})};return d}();f.AppendVertexOperation=q});