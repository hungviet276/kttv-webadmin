// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
require({cache:{"esri/renderers/support/heatmapUtils":function(){define(["require","exports","../../core/global","../../core/mathUtils"],function(l,a,h,n){function g(c,b,f,k,e){c=new Uint32Array(c*c);b="buffer"in b?b:new Float64Array(b);f="buffer"in f?new Uint32Array(f.buffer):new Uint32Array((new Uint8Array(f)).buffer);e=f.length/(e-k);for(var a=0;a<b.length;a++)c[a]=f[n.clamp(Math.floor((b[a]-k)*e),0,f.length-1)];return c.buffer}function u(c){for(var b=Math.round(3*c),f=2*c*c,k=new Float64Array(2*
b+1),e=0;e<=k.length;e++)k[e]=Math.exp(-Math.pow(e-b,2)/f)/Math.sqrt(2*Math.PI)*(c/2);return k}function d(c,b){return"function"===typeof c?c:c?"string"===typeof b?function(b){return-1*+b[c]}:function(f){return+f[c]+b}:function(){return 1}}function q(c,b){return null!=c?"string"===typeof b?function(b){return-1*+b.readAttribute(c)}:function(f){return+f.readAttribute(c)+b}:function(b){return 1}}Object.defineProperty(a,"__esModule",{value:!0});a.createValueFunctionCursor=a.createValueFunction=a.createKernel=
a.createHeatmapImageData=a.drawHeatmap=a.calculateHeatmapIntensityInfoReaders=a.calculateHeatmapIntensityInfo=a.generateGradient=void 0;a.generateGradient=function(){if(!("document"in h))return function(){return null};var c=document.createElement("canvas"),b=c.getContext("2d");c.height=512;c.width=1;return function(f){b.clearRect(0,0,1,c.height);var k=b.createLinearGradient(0,0,0,c.height),e=0;for(f=f.colorStops;e<f.length;e++){var a=f[e],m=a.color;k.addColorStop(Math.max(a.ratio,.001),"rgba("+m[0]+
", "+m[1]+", "+m[2]+", "+m[3]+")")}b.fillStyle=k;b.fillRect(0,0,1,c.height);return b.getImageData(0,0,1,c.height).data}}();a.calculateHeatmapIntensityInfo=function(c,b,f,k){var e=b.blurRadius,a=b.fieldOffset,m=b.field;b=new Float64Array(f*k);for(var q=u(e),e=Math.round(3*e),h=Number.NEGATIVE_INFINITY,v,a=d(m,a),m=0;m<c.length;m++){var g=c[m],t=g.geometry,l=t.x-e,n=t.y-e,y=Math.max(0,l);v=Math.max(0,n);for(var z=Math.min(k,t.y+e),t=Math.min(f,t.x+e),g=+a(g.attributes),r=v;r<z;r++)for(var A=q[r-n],
p=y;p<t;p++)v=b[r*f+p]+=A*q[p-l]*g,v>h&&(h=v)}return{matrix:b.buffer,max:h}};a.calculateHeatmapIntensityInfoReaders=function(c,b,f,k){var e=b.blurRadius,a=b.fieldOffset,m=b.field;b=new Float64Array(f*k);for(var d=u(e),e=Math.round(3*e),h=Number.NEGATIVE_INFINITY,g,a=q(m,a),m=new Set,l=0;l<c.length;l++)for(var n=c[l].getCursor();n.next();){var x=n.getObjectId();if(!m.has(x)){m.add(x);g=n.readLegacyPointGeometry();for(var x=+a(n),B=g.x-e,y=g.y-e,z=Math.max(0,B),r=Math.min(k,g.y+e),A=Math.min(f,g.x+
e),p=Math.max(0,y);p<r;p++)for(var C=d[p-y],w=z;w<A;w++)g=b[p*f+w]+=C*d[w-B]*x,g>h&&(h=g)}}return{matrix:b.buffer,max:h}};a.drawHeatmap=function(c,b,f,k,e,a){c.canvas.width=c.canvas.height=b;c.clearRect(0,0,b,b);var d=c.getImageData(0,0,b,b);f&&k&&d.data.set(new Uint8ClampedArray(g(b,f,k,e,a)));c.putImageData(d,0,0)};a.createHeatmapImageData=g;a.createKernel=u;a.createValueFunction=d;a.createValueFunctionCursor=q})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define(["require",
"exports","tslib","../../../../../core/HandleOwner","../../../../../core/accessorSupport/decorators"],function(l,a,h,n,g){Object.defineProperty(a,"__esModule",{value:!0});l=function(a){function d(d){d=a.call(this,d)||this;d.tiles=new Map;return d}h.__extends(d,a);d.prototype.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.tiles=null};Object.defineProperty(d.prototype,"updating",{get:function(){return this.isUpdating()},enumerable:!1,configurable:!0});d.prototype.acquireTile=
function(a){var c=this,b=this.createTile(a);b.once("isReady",function(){return c.notifyChange("updating")});this.tiles.set(a.id,b);return b};d.prototype.forceAttributeTextureUpload=function(){};d.prototype.forEachTile=function(a){this.tiles.forEach(a)};d.prototype.releaseTile=function(a){this.tiles.delete(a.key.id);this.disposeTile(a)};d.prototype.isUpdating=function(){var a=!0;this.tiles.forEach(function(c){a=a&&c.isReady});return!a};d.prototype.setHighlight=function(){};d.prototype.invalidateLabels=
function(){};d.prototype.requestUpdate=function(){this.layerView.requestUpdate()};h.__decorate([g.property()],d.prototype,"layer",void 0);h.__decorate([g.property()],d.prototype,"layerView",void 0);h.__decorate([g.property()],d.prototype,"tileInfoView",void 0);h.__decorate([g.property()],d.prototype,"updating",null);return d=h.__decorate([g.subclass("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],d)}(n.HandleOwner);a.default=l})},"esri/views/2d/layers/features/tileRenderers/support/HeatmapSource":function(){define(["require",
"exports","../../../../../../renderers/support/heatmapUtils"],function(l,a,h){Object.defineProperty(a,"__esModule",{value:!0});a.HeatmapSource=void 0;l=function(){function a(){this.gradient=null;this.width=this.height=512}a.prototype.render=function(a){h.drawHeatmap(a,512,this.intensities,this.gradient,this.minPixelIntensity,this.maxPixelIntensity)};return a}();a.HeatmapSource=l})},"*noref":1}});
define("require exports tslib ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators ../../../../../renderers/support/heatmapUtils ../../../engine/BitmapTileContainer ./BaseTileRenderer ./support/HeatmapSource".split(" "),function(l,a,h,n,g,u,d,q,c){Object.defineProperty(a,"__esModule",{value:!0});l=function(a){function b(b){var e=a.call(this,b)||this;e._intensityInfo={minPixelIntensity:0,maxPixelIntensity:0};e.featuresView={attributeView:{initialize:function(){},requestUpdate:function(){}},
requestRender:function(){}};e._container=new d.BitmapTileContainer(b.tileInfoView);return e}h.__extends(b,a);b.prototype.createTile=function(b){var a=this._container.createTile(b);this.tileInfoView.getTileCoords(a.bitmap,b);a.bitmap.resolution=this.tileInfoView.getTileResolution(b);return a};b.prototype.onConfigUpdate=function(){var b=this,a=this.layer.renderer;if("heatmap"===a.type){var c=a.minPixelIntensity,d=a.maxPixelIntensity;this._intensityInfo.minPixelIntensity=c;this._intensityInfo.maxPixelIntensity=
d;this._gradient=u.generateGradient(a.toJSON());this.tiles.forEach(function(a){var e=a.bitmap.source;e&&(e.minPixelIntensity=c,e.maxPixelIntensity=d,e.gradient=b._gradient,a.bitmap.invalidateTexture())})}};b.prototype.hitTest=function(){return n.resolve([])};b.prototype.install=function(a){a.addChild(this._container)};b.prototype.uninstall=function(a){this._container.removeAllChildren();a.removeChild(this._container)};b.prototype.disposeTile=function(a){this._container.removeChild(a);a.destroy()};
b.prototype.supportsRenderer=function(a){return a&&"heatmap"===a.type};b.prototype.onTileData=function(a){var b=this.tiles.get(a.tileKey);if(b){a=a.intensityInfo;var d=this._intensityInfo,f=d.minPixelIntensity,d=d.maxPixelIntensity,g=b.bitmap.source||new c.HeatmapSource;g.intensities=a&&a.matrix||null;g.minPixelIntensity=f;g.maxPixelIntensity=d;g.gradient=this._gradient;b.bitmap.source=g;this._container.addChild(b);this.requestUpdate()}};b.prototype.onTileError=function(a){console.error(a)};b.prototype.lockGPUUploads=
function(){};b.prototype.unlockGPUUploads=function(){};return b=h.__decorate([g.subclass("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],b)}(q.default);a.default=l});