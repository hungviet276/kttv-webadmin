// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/MapUtils ../../../../../core/maybe ../definitions ./Effect".split(" "),function(e,c,n,u,p,v,q){Object.defineProperty(c,"__esModule",{value:!0});c.HittestEffect=void 0;e=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.name=a.constructor.name;a.defines=["id"];a._lastSize=0;return a}n.__extends(b,c);b.prototype.dispose=function(){p.isSome(this._fbo)&&this._fbo.dispose()};b.prototype.bind=function(a){var f=a.context;a=a.painter;
var c=f.getViewport();a=a.getFbos(c.width,c.height).effect0;f.bindFramebuffer(a);f.setClearColor(0,0,0,0);f.clear(f.gl.COLOR_BUFFER_BIT)};b.prototype.unbind=function(){};b.prototype.draw=function(a,c,b){var f=this,e=a.context,n=a.state,l=a.pixelRatio;void 0===b&&(b=v.HITTEST_SEARCH_SIZE);var p=e.getBoundFramebufferObject(),q=n.size[1]*l,d=Math.round(b*l),r=d/2,t=d/2;this._ensureBuffer(d);c.forEach(function(a,b){var g=new Map;p.readPixels(Math.floor(b[0]*l-d/2),Math.floor(q-b[1]*l-d/2),d,d,6408,5121,
f._buf);for(var h=0;h<f._buf32.length;h++){var k=f._buf32[h];if(4294967295!==k&&0!==k){var e=h%d,m=d-Math.floor(h/d),e=(r-e)*(r-e)+(t-m)*(t-m),m=g.has(k)?g.get(k):4294967295;g.set(k,Math.min(e,m))}}g=u.pairsOfMap(g).sort(function(a,b){return a[1]-b[1]}).map(function(a){return a[0]});a.resolve(g);c.delete(b)})};b.prototype._ensureBuffer=function(a){this._lastSize!==a&&(this._lastSize=a,this._buf=new Uint8Array(4*a*a),this._buf32=new Uint32Array(this._buf.buffer))};return b}(q.Effect);c.HittestEffect=
e});