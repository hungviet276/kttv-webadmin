// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../Graphic ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ./I3SMeshView3D ./LayerView3D ./support/layerViewUpdatingProperties ../../layers/LayerView".split(" "),function(q,r,c,k,h,d,f,g,l,m,n,p){return function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;a.lodFactor=1;a._elevationContext="im";a._isIntegratedMesh=!0;a._supportsLabeling=!1;a.drapeTargetType=
1;a._overlayTexOffset=f.vec4f64.fromValues(-1,-1,-1,-1);a._overlayTexScale=f.vec4f64.create();a._overlayTextures=[null,null];a._overlayHighlights=[null,null];a._overlayNormals=[null,null];return a}c.__extends(b,e);Object.defineProperty(b.prototype,"progressiveLoadFactor",{get:function(){return 1<=this.lodFactor?.2:1},enumerable:!1,configurable:!0});b.prototype.setDrapingTextures=function(a,b,c,d,e){var f=this;h.isSome(c)&&0<g.area(b)?(this._overlayTextures[a]=c,this._overlayHighlights[a]=d,this._overlayNormals[a]=
e,this._overlayTexOffset[2*a]=-b[0]/g.width(b),this._overlayTexOffset[2*a+1]=-b[1]/g.height(b),this._overlayTexScale[2*a]=1/g.width(b),this._overlayTexScale[2*a+1]=1/g.height(b)):(this._overlayTextures[a]=null,this._overlayHighlights[a]=null,this._overlayNormals[a]=null,this._overlayTexOffset[2*a]=-1,this._overlayTexOffset[2*a+1]=-1,this._overlayTexScale[2*a]=0,this._overlayTexScale[2*a+1]=0);this._forAllNodes(function(a){return h.isSome(a)&&f._collection.updateMaterial(a.objectHandle,function(a){return f._updateMaterialOverlay(a)})})};
b.prototype._updateMaterialOverlay=function(a){a.overlayColorInner=this._overlayTextures[0];a.overlayColorOuter=this._overlayTextures[1];a.overlayHighlightInner=this._overlayHighlights[0];a.overlayHighlightOuter=this._overlayHighlights[1];a.overlayNormalInner=this._overlayNormals[0];a.overlayNormalOuter=this._overlayNormals[1];a.overlayTexOffset=this._overlayTexOffset;a.overlayTexScale=this._overlayTexScale};b.prototype.initialize=function(){var a=this;this.updatingHandles.add(this.layer,"modifications",
function(){return a._loadModifications()},2)};b.prototype.destroy=function(){};b.prototype._createLayerGraphic=function(){var a=new k;a.layer=this.layer;a.sourceLayer=this.layer;return a};b.prototype.canResume=function(){return e.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};b.prototype._loadModifications=function(){var a=this;this.handles.remove("modifications");if(h.isNone(this.layer.modifications))this._modifications=[];else{var b=this.layer.modifications;
this.handles.add(this.updatingHandles.addOnCollectionChange(b,function(){return a._modifications=b.toArray()},2),"modifications")}};c.__decorate([d.property()],b.prototype,"layer",void 0);c.__decorate([d.property({aliasOf:"layer"})],b.prototype,"i3slayer",void 0);c.__decorate([d.property({dependsOn:["_controller.rootNodeVisible"]})],b.prototype,"suspended",void 0);c.__decorate([d.property(n.updatingProgress)],b.prototype,"updatingProgress",void 0);c.__decorate([d.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],
b.prototype,"updatingProgressValue",void 0);c.__decorate([d.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.integratedMesh.lodFactor"})],b.prototype,"lodFactor",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["lodFactor"]})],b.prototype,"progressiveLoadFactor",null);return b=c.__decorate([d.subclass("esri.views.3d.layers.SceneLayerView3D")],b)}(l.I3SMeshView3D(m.LayerView3D(p)))});