// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","tslib","../../core/compilerUtils","../../core/mathUtils"],function(P,e,v,I,J){function w(a,b){var d=a||{},p=d.format,f=d.quality,k=d.rotation,d=d.disableSlice,c=x(a,b.padding),g;g=b.width-c.left-c.right;b=b.height-c.top-c.bottom;c={x:0,y:0,width:g,height:b};if(a&&a.area){null!=a.area.x&&(c.x=Math.floor(a.area.x));null!=a.area.y&&(c.y=Math.floor(a.area.y));var h=null!=a.area.width?Math.floor(a.area.width):null,e=null!=a.area.height?Math.floor(a.area.height):null;c.width=
g-c.x;c.height=b-c.y;null!=h&&null!=e?(c.width=Math.min(c.width,h),c.height=Math.min(c.height,e)):null==h&&null!=e?(h=Math.min(c.width,h),c.height*=h/c.width,c.width=h):null!=h&&null==e&&(h=Math.min(c.height,e),c.width*=h/c.height,c.height=h)}c=K(c,a);h=Math.floor(Math.max(c.x,0));e=Math.floor(Math.max(c.y,0));g={x:h,y:e,width:Math.floor(Math.min(c.width,g-h)),height:Math.floor(Math.min(c.height,b-e))};b=g.width/g.height;c=c.width/c.height;c!==b&&(c>b?(b=Math.floor(g.width/c),g={x:g.x,y:Math.floor(g.y+
(g.height-b)/2),width:g.width,height:b}):(b=Math.floor(g.height*c),g={x:Math.floor(g.x+(g.width-b)/2),y:g.y,width:b,height:g.height}));c=L(a,g);b=c.width;c=c.height;a:switch(p){case "png":case "jpg":case "jpeg":break a;case null:case void 0:p=y;break a;default:I.neverReached(p),p=y}h=M[p];f=J.clamp(null!=f?f:h,0,100);return{format:p,quality:f,area:g,width:b,height:c,rotation:k,disableSlice:!!d,ignoreBackground:!(!a||!a.ignoreBackground),ignorePadding:!(!a||!a.ignorePadding)}}function z(a,b){return a.toDataURL(N[b.format],
b.quality/100)}function A(a,b,d){d||(m||(m=document.createElement("canvas"),m.width=1,m.height=1),d=m);return d.getContext("2d").createImageData(a,b)}function L(a,b){if(!a)return b;var d=a.width;a=a.height;if(null!=d&&null!=a)return{width:Math.floor(d),height:Math.floor(a)};if(null==d&&null==a)return b;b=b.width/b.height;return null==a?{width:Math.floor(d),height:Math.floor(d/b)}:{width:Math.floor(a*b),height:Math.floor(a)}}function K(a,b){if(!b||null==b.width||null==b.height)return a;b=b.width/b.height;
var d=a.width/a.height;if(d===b)return a;if(d<b)return b=Math.floor(a.height*b),a.x-=(b-a.width)/2,a.width=b,a;b=Math.floor(a.width/b);a.y-=(b-a.height)/2;a.height=b;return a}function x(a,b){return!b||a&&a.ignorePadding?O:b}Object.defineProperty(e,"__esModule",{value:!0});e.screenshotSuperSampleSettings=e.resampleHermite=e.wrapImageData=e.createEmptyImageData=e.toDataUrl=e.encodeResult=e.toRenderSettings=e.completeUserSettings=void 0;e.completeUserSettings=w;e.toRenderSettings=function(a,b){var d=
w(a,b),e=d.area,f=d.width/e.width,k=x(d,b.padding),c=k.left+k.right,g=k.top+k.bottom;return{framebufferWidth:Math.floor((b.width-c)*f+c),framebufferHeight:Math.floor((b.height-g)*f+g),region:{x:Math.floor(e.x*f)+k.left,y:Math.floor(e.y*f)+k.top,width:d.width,height:d.height},format:d.format,quality:d.quality,rotation:d.rotation,pixelRatio:f,layers:a&&a.layers?a.layers:[],disableSlice:d.disableSlice,ignoreBackground:d.ignoreBackground,ignorePadding:d.ignorePadding}};e.encodeResult=function(a,b,d,e){if(e.premultipliedAlpha)for(var f=
a.data,k=f.length,c=0;c<k;c+=4){var g=f[c+3];0<g&&(g/=255,f[c+0]/=g,f[c+1]/=g,f[c+2]/=g)}d.width=a.width;d.height=a.height;f=d.getContext("2d");f.putImageData(a,0,0);e.flipY&&(f.save(),f.globalCompositeOperation="copy",f.scale(1,-1),f.translate(0,-f.canvas.height),f.drawImage(f.canvas,0,0),f.restore());a=f.getImageData(0,0,a.width,a.height);b=z(d,b);d.width=0;d.height=0;return{dataUrl:b,data:a}};e.toDataUrl=z;e.createEmptyImageData=function(a,b,d){if(!a||!b)throw Error("Cannot construct image data without dimensions");
if(r)try{return new ImageData(a,b)}catch(p){r=!1}return A(a,b,d)};e.wrapImageData=function(a,b,d,e){if(!b||!d)throw Error("Cannot construct image data without dimensions");if(r)try{return new ImageData(a,b,d)}catch(f){r=!1}b=A(b,d,e);b.data.set(a,0);return b};e.resampleHermite=function(a,b,d,e,f,k,c,g){void 0===e&&(e=0);void 0===f&&(f=0);void 0===k&&(k=a.width-e);void 0===c&&(c=a.height-f);void 0===g&&(g=!1);var h=a.data,p=b.width,n=b.height,m=b.data;k/=p;c/=n;var r=Math.ceil(k/2),x=Math.ceil(c/2);
a=a.width;for(var q=0;q<n;q++)for(var t=0;t<p;t++){for(var B=4*(t+(g?n-q-1:q)*p),C=0,G=0,v=0,w=0,y=0,H=0,z=(q+.5)*c,D=Math.floor(q*c);D<(q+1)*c;D++)for(var E=Math.abs(z-(D+.5))/x,A=(t+.5)*k,E=E*E,F=Math.floor(t*k);F<(t+1)*k;F++){var l=Math.abs(A-(F+.5))/r,l=Math.sqrt(E+l*l);if(!(1<=l)){var l=2*l*l*l-3*l*l+1,u=4*(e+F+(f+D)*a),H=H+l*h[u+3],G=G+l;!d&&255>h[u+3]&&(l=l*h[u+3]/255);v+=l*h[u];w+=l*h[u+1];y+=l*h[u+2];C+=l}}m[B]=v/C;m[B+1]=w/C;m[B+2]=y/C;m[B+3]=H/G}return b};e.screenshotSuperSampleSettings=
function(a,b,d){if(!b)return a;b=a.framebufferWidth;var e=a.framebufferHeight,f=a.pixelRatio,k=a.region;d=x(a,d);var c=d.left+d.right,g=d.top+d.bottom,h=b-c,m=e-g,n=Math.min(8,Math.min((2048-c)/h,(2048-g)/m));return 1.5>n?a:v.__assign(v.__assign({},a),{framebufferWidth:Math.round(h*n)+c,framebufferHeight:Math.round(m*n)+g,pixelRatio:f*n,resample:{region:{x:Math.round((k.x-d.left)*n)+d.left,y:Math.round((k.y-d.top)*n)+d.top,width:Math.round(k.width*n),height:Math.round(k.height*n)},width:b,height:e}})};
var m=null,r=!0,N={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},y="jpg",M={png:100,jpg:98,jpeg:98},O={top:0,right:0,bottom:0,left:0}});