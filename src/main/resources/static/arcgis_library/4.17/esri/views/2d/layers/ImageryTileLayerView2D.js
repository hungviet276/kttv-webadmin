// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/PixelBlock":function(){define("require exports tslib ../../core/compilerUtils ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators".split(" "),function(E,e,q,t,v,n,f,r,k,m){var u=r.getLogger("esri.layers.support.PixelBlock");return function(c){function d(b){b=c.call(this,b)||this;b.width=null;b.height=null;b.pixelType="f32";b.validPixelCount=null;b.mask=null;b.maskIsAlpha=!1;b.pixels=null;
b.statistics=null;return b}q.__extends(d,c);h=d;d.createEmptyBand=function(b,a){return new (h.getPixelArrayConstructor(b))(a)};d.getPixelArrayConstructor=function(b){var a;switch(b){case "u1":case "u2":case "u4":case "u8":a=Uint8Array;break;case "u16":a=Uint16Array;break;case "u32":a=Uint32Array;break;case "s8":a=Int8Array;break;case "s16":a=Int16Array;break;case "s32":a=Int32Array;break;case "u32":a=Uint32Array;break;case "f32":a=Float32Array;break;case "f64":a=Float64Array;break;case "c64":case "c128":case "unknown":a=
Float32Array;break;default:t.neverReached(b)}return a};d.prototype.castPixelType=function(b){if(!b)return"f32";b=b.toLowerCase();-1<["u1","u2","u4"].indexOf(b)?b="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(b)&&(b="f32");return b};d.prototype.getPlaneCount=function(){return this.pixels&&this.pixels.length};d.prototype.addData=function(b){if(!b.pixels||b.pixels.length!==this.width*this.height)throw new v("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");
this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(b.pixels);this.statistics.push(b.statistics||{minValue:null,maxValue:null})};d.prototype.getAsRGBA=function(){var b=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(b);break;default:this._fillFrom8Bit(b)}return new Uint8ClampedArray(b)};d.prototype.getAsRGBAFloat=function(){var b=new Float32Array(this.width*
this.height*4);this._fillFrom32Bit(b);return b};d.prototype.updateStatistics=function(){var b=this;this.statistics=this.pixels.map(function(a){return b._calculateBandStatistics(a,b.mask)});var a=this.mask,g=0;if(a)for(var c=0;c<a.length;c++)a[c]&&g++;else g=this.width*this.height;this.validPixelCount=g};d.prototype.clamp=function(b){if(b&&"f64"!==b&&"f32"!==b){var a;switch(b){case "u8":a=[0,255];break;case "u16":a=[0,65535];break;case "u32":a=[0,4294967295];break;case "s8":a=[-128,127];break;case "s16":a=
[-32768,32767];break;case "s32":a=[-2147483648,2147483647];break;default:a=[-3.4*1E39,3.4*1E39]}var g=a[0];a=a[1];for(var c=this.pixels,d=this.width*this.height,x=c.length,p,l,f,k=[],m=0;m<x;m++){f=h.createEmptyBand(b,d);p=c[m];for(var u=0;u<d;u++)l=p[u],f[u]=l>a?a:l<g?g:l;k.push(f)}this.pixels=k;this.pixelType=b}};d.prototype.extractBands=function(b){var a=this;if(k.isNone(b)||0===b.length||null==this.pixels||0===this.pixels.length)return this;var g=this.pixels.length,c=b.some(function(b){return b>=
a.pixels.length}),g=g===b.length&&!b.some(function(a,b){return a!==b});return c||g?this:new h({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:b.map(function(b){return a.pixels[b]}),statistics:this.statistics&&b.map(function(b){return a.statistics[b]})})};d.prototype.clone=function(){var b=new h({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});
this.mask&&(b.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var a,g=h.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){b.pixels=[];var c=this.pixels[0].slice;for(a=0;a<this.pixels.length;a++)b.pixels[a]=c?this.pixels[a].slice(0,this.pixels[a].length):new g(this.pixels[a])}if(this.statistics)for(b.statistics=[],a=0;a<this.statistics.length;a++)b.statistics[a]=f.clone(this.statistics[a]);return b};d.prototype._fillFrom8Bit=function(b){var a=
this.mask,g=this.maskIsAlpha,c=this.pixels;if(b&&c&&c.length){var d,h,p;d=h=p=c[0];3<=c.length?(h=c[1],p=c[2]):2===c.length&&(h=c[1]);b=new Uint32Array(b);c=this.width*this.height;if(d.length!==c)u.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(a&&a.length===c)if(g)for(g=0;g<c;g++)a[g]&&(b[g]=a[g]<<24|p[g]<<16|h[g]<<8|d[g]);else for(g=0;g<c;g++)a[g]&&(b[g]=-16777216|p[g]<<16|h[g]<<8|d[g]);else for(g=0;g<c;g++)b[g]=-16777216|p[g]<<16|h[g]<<8|d[g]}else u.error("getAsRGBA()",
"Unable to convert to RGBA. The input pixel block is empty.")};d.prototype._fillFromNon8Bit=function(b){var a=this.pixels,g=this.mask,c=this.statistics;if(b&&a&&a.length){var d=this.pixelType,h=1,p=0,h=1;c&&0<c.length?(p=c.map(function(a){return a.minValue}).reduce(function(a,b){return Math.min(a,b)}),h=c.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,b){return Math.max(a,b)}),h=255/h):(h=255,"s8"===d?(p=-128,h=127):"u16"===d?h=65535:"s16"===d?(p=-32768,h=32767):"u32"===d?h=4294967295:
"s32"===d?(p=-2147483648,h=2147483647):"f32"===d?(p=-3.4*1E39,h=3.4*1E39):"f64"===d&&(p=-Number.MAX_VALUE,h=Number.MAX_VALUE),h=255/(h-p));b=new Uint32Array(b);var d=this.width*this.height,l,f,c=l=f=a[0];if(c.length!==d)return u.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=a.length)if(l=a[1],3<=a.length&&(f=a[2]),g&&g.length===d)for(a=0;a<d;a++)g[a]&&(b[a]=-16777216|(f[a]-p)*h<<16|(l[a]-p)*h<<8|(c[a]-p)*h);else for(a=0;a<d;a++)b[a]=-16777216|(f[a]-p)*h<<16|(l[a]-
p)*h<<8|(c[a]-p)*h;else if(g&&g.length===d)for(a=0;a<d;a++)l=(c[a]-p)*h,g[a]&&(b[a]=-16777216|l<<16|l<<8|l);else for(a=0;a<d;a++)l=(c[a]-p)*h,b[a]=-16777216|l<<16|l<<8|l}else u.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};d.prototype._fillFrom32Bit=function(b){var a=this.pixels,g=this.mask;if(!b||!a||!a.length)return u.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var c,h,d;c=h=d=a[0];3<=a.length?(h=a[1],d=a[2]):2===a.length&&
(h=a[1]);var p=this.width*this.height;if(c.length!==p)return u.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var l=0;if(g&&g.length===p)for(a=0;a<p;a++)b[l++]=c[a],b[l++]=h[a],b[l++]=d[a],b[l++]=g[a]&1;else for(a=0;a<p;a++)b[l++]=c[a],b[l++]=h[a],b[l++]=d[a],b[l++]=1};d.prototype._calculateBandStatistics=function(b,a){var g=Infinity,c=-Infinity,h=b.length,d,p=0;if(a)for(d=0;d<h;d++)a[d]&&(p=b[d],g=p<g?p:g,c=p>c?p:c);else for(d=0;d<h;d++)p=b[d],g=p<g?p:g,c=p>c?p:
c;return{minValue:g,maxValue:c}};var h;q.__decorate([m.property({json:{write:!0}})],d.prototype,"width",void 0);q.__decorate([m.property({json:{write:!0}})],d.prototype,"height",void 0);q.__decorate([m.property({json:{write:!0}})],d.prototype,"pixelType",void 0);q.__decorate([m.cast("pixelType")],d.prototype,"castPixelType",null);q.__decorate([m.property({json:{write:!0}})],d.prototype,"validPixelCount",void 0);q.__decorate([m.property({json:{write:!0}})],d.prototype,"mask",void 0);q.__decorate([m.property({json:{write:!0}})],
d.prototype,"maskIsAlpha",void 0);q.__decorate([m.property({json:{write:!0}})],d.prototype,"pixels",void 0);q.__decorate([m.property({json:{write:!0}})],d.prototype,"statistics",void 0);return d=h=q.__decorate([m.subclass("esri.layers.support.PixelBlock")],d)}(n.JSONSupport)})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define(["require","exports","../../../geometry","./EphemeralBlockCache","../rasterFunctions/rasterProjectionHelper"],function(E,e,q,t,v){function n(k,m){if(!f.has(k))return null;
k=f.get(k);return null==k[m]?null:k[m]}Object.defineProperty(e,"__esModule",{value:!0});e.update=e.deleteBlock=e.putBlock=e.getBlock=e.decreaseRefCount=e.deleteRaster=e.unregister=e.register=e.getRasterId=void 0;var f=new Map,r=new t;e.getRasterId=function(f,m){return null==m?f:f+"?sliceId\x3d"+m};e.register=function(k,m){m={extent:null,rasterInfo:m,cache:new Map};if(f.has(k))return k=f.get(k),k.push(m),k.length-1;f.set(k,[m]);return 0};e.unregister=function(k,m){f.has(k)&&(f.get(k)[m]=null)};e.deleteRaster=
function(k){f.delete(k)};e.decreaseRefCount=function(k,m,u){if(!f.has(k))return null==m?r.decreaseRefCount(k,u):0;var c=f.get(k);if(null==c[m])return r.decreaseRefCount(k,u);m=c[m].cache;if(m.has(u)){k=m.get(u);k.refCount--;if(0===k.refCount){m.delete(u);for(m=0;m<c.length;m++)c[m]&&c[m].cache.has(u)&&c[m].cache.delete(u);k.controller&&k.controller.abort()}return k.refCount}return 0};e.getBlock=function(k,m,u){if(!f.has(k))return null==m?r.getBlock(k,u):null;var c=f.get(k);if(null==c[m]){for(var d=
0;d<c.length;d++)if(c[d]&&c[d].cache.has(u))return u=c[d].cache.get(u),u.refCount++,u.block;return r.getBlock(k,u)}k=c[m].cache;if(k.has(u))return u=k.get(u),u.refCount++,u.block;for(d=0;d<c.length;d++)if(d!==m&&c[d]&&c[d]&&c[d].cache.has(u))return m=c[d].cache.get(u),m.refCount++,k.set(u,m),m.block;return null};e.putBlock=function(k,m,u,c,d){void 0===d&&(d=null);if(f.has(k)){var h=f.get(k);if(null==h[m])r.putBlock(k,u,c,d);else{var b={refCount:1,block:c,isResolved:!1,isRejected:!1,controller:d};
c.then(function(){return b.isResolved=!0}).catch(function(){return b.isRejected=!0});h[m].cache.set(u,b)}}else null==m&&r.putBlock(k,u,c,d)};e.deleteBlock=function(k,m,u){if(f.has(k)){var c=f.get(k);null==c[m]?r.deleteBlock(k,u):c[m].cache.delete(u)}else null==m&&r.deleteBlock(k,u)};e.update=function(f,m,u,c,d,h,b){void 0===b&&(b=null);f=n(f,m);var a=f.extent,g=f.cache;m=f.rasterInfo;if(!a||a.xmin!==u.xmin||a.xmax!==u.xmax||a.ymin!==u.ymin||a.ymax!==u.ymax){for(var a=u.clone().normalize(),z=m.spatialReference,
I=new Set,x=0;x<a.length;x++){var p=a[x];if(!(p.xmax-p.xmin<=c||p.ymax-p.ymin<=c)){var l=v.projectExtent(p,z,b),M=new q.Point({x:c,y:c,spatialReference:p.spatialReference});if(null===d&&(d=v.projectResolution(M,z,p,b),!d))return;var M=v.snapPyramid(d,m,h||"closest"),p=M.pyramidLevel,k=M.pyramidResolution;if(M.excessiveReading)return;for(var e=Math.max(0,Math.floor((l.xmin-m.storageInfo.origin.x)/k.x)),r=Math.max(0,Math.floor((m.storageInfo.origin.y-l.ymax)/k.y)),t=0<p?m.storageInfo.pyramidBlockWidth:
m.storageInfo.blockWidth,w=0<p?m.storageInfo.pyramidBlockHeight:m.storageInfo.blockHeight,M=Math.max(0,Math.floor(e/t)-1),e=Math.floor((e+Math.ceil((l.xmax-l.xmin)/k.x-.1)-1)/t)+1,l=Math.floor((r+Math.ceil((l.ymax-l.ymin)/k.y-.1)-1)/w)+1,k=Math.max(0,Math.floor(r/w)-1);k<=l;k++)for(r=M;r<=e;r++)I.add(p+"/"+k+"/"+r)}}g.forEach(function(a,b){I.has(b)||(a=g.get(b),(null==a||a.isResolved||a.isRejected)&&g.delete(b))});f.extent={xmin:u.xmin,ymin:u.ymin,xmax:u.xmax,ymax:u.ymax}}}})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(["require",
"exports","../../../core/MapUtils"],function(E,e,q){return function(){function e(e,n){void 0===e&&(e=15E3);void 0===n&&(n=5E3);this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=e;this._interval=Math.min(e,n)}e.prototype.decreaseRefCount=function(e,n){e=e+"/"+n;n=this._cachedBlocks;if(n.has(e)){var f=n.get(e);f.refCount--;0>=f.refCount&&(n.delete(e),f.controller&&f.controller.abort());return f.refCount}return 0};e.prototype.getBlock=function(e,n){e=e+"/"+n;n=this._cachedBlocks;
if(n.has(e)){var f=n.get(e);f.ts=Date.now();f.refCount++;n.delete(e);n.set(e,f);return f.block}return null};e.prototype.putBlock=function(e,n,f,q){void 0===q&&(q=null);var k=this._cachedBlocks;e=e+"/"+n;k.has(e)?(f=k.get(e),f.ts=Date.now(),f.refCount++):k.set(e,{block:f,ts:Date.now(),refCount:1,controller:q});this.trim();this.updateTimer()};e.prototype.deleteBlock=function(e,n){var f=this._cachedBlocks;e=e+"/"+n;f.has(e)&&f.delete(e)};e.prototype.updateMaxSize=function(e){this._size=e;this.trim()};
e.prototype.empty=function(){this._cachedBlocks.clear();this.clearTimer()};e.prototype.getCurrentSize=function(){return this._cachedBlocks.size};e.prototype.updateTimer=function(){var e=this;if(null==this._timer){var n=this._cachedBlocks;this._timer=setInterval(function(){for(var f=q.pairsOfMap(n),r=Date.now(),k=0;k<f.length;k++)if(f[k][1].ts<=r-e._duration)n.delete(f[k][0]);else break;0===n.size&&e.clearTimer()},this._interval)}};e.prototype.trim=function(){var e=this._cachedBlocks;if(!(-1===this._size||
this._size>=e.size))for(var n=q.pairsOfMap(e),f=0;f<n.length-this._size;f++)e.delete(n[f][0])};e.prototype.clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)};return e}()})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("require exports tslib ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(E,e,q,t,v,n,f,r,k){function m(b,a,g,c){void 0===c&&(c=null);if(b.spatialReference.equals(a))return b;var d=h(b.spatialReference,a);if(d&&!f.isLoaded())throw new v("rasterprojectionhelper-projectResolution","projection engine is not loaded");g=g.center;b=new t.Extent({xmin:g.x-b.x/2,xmax:g.x+b.x/2,ymin:g.y-b.y/2,ymax:g.y+b.y/2,spatialReference:b.spatialReference});a=d?f.project(b,a,c):k.project(b,a);return null==a?null:{x:a.xmax-a.xmin,y:a.ymax-a.ymin}}function u(b,a){void 0===a&&(a=.01);
return n.getMetersPerUnitForSR(b)?a/n.getMetersPerUnitForSR(b):0}function c(b,a,g,c){var d,z;void 0===g&&(g=null);void 0===c&&(c=!0);var p=b.spatialReference;if(p.equals(a))return b;var l=h(p,a);if(l&&!f.isLoaded())throw new v("rasterprojectionhelper-projectResolution","projection engine is not loaded");(g=l?f.project(b,a,g):k.project(b,a))&&c&&a.isGeographic&&(a=p.isWebMercator?r.getInfo(p).origin:null!==(z=null===(d=r.getInfo(p))||void 0===d?void 0:d.valid)&&void 0!==z?z:[],d=a[0],z=a[1],(p=u(p))&&
null!=d&&null!=z&&(Math.abs(b.x-d)<p&&5E-4>Math.abs(180-g.x)?g.x-=360:Math.abs(b.x-z)<p&&5E-4>Math.abs(180+g.x)&&(g.x+=360)));return g}function d(b,a,g,d){var z,x,p,l;void 0===g&&(g=null);void 0===d&&(d=!0);var e=b.spatialReference;if(e.equals(a))return b;var m=h(e,a);if(m&&!f.isLoaded())throw new v("rasterprojectionhelper-projectExtent","projection engine is not loaded");var m=m?f.project(b,a,g):k.project(b,a),n=null!==(x=null===(z=r.getInfo(e))||void 0===z?void 0:z.origin)&&void 0!==x?x:[];z=n[0];
x=n[1];m&&d&&e.isWebMercator&&a.isGeographic&&null!=z&&null!=x&&(.001>Math.abs(b.xmin-z)&&1E3<Math.abs(x-b.xmax)&&5E-4>Math.abs(180-m.xmax)&&(m.xmin=-180,d=[],d.push(new t.Point(b.xmax,b.ymin,e)),d.push(new t.Point(b.xmax,(b.ymin+b.ymax)/2,e)),d.push(new t.Point(b.xmax,b.ymax,e)),d=d.map(function(b){return c(b,a,g)}).filter(function(a){return!isNaN(null===a||void 0===a?void 0:a.x)}).map(function(a){return a.x}),m.xmax=Math.max.apply(null,d)),.001>Math.abs(b.xmax-x)&&1E3<Math.abs(z-b.xmin)&&5E-4>Math.abs(180+
m.xmin)&&(m.xmax=180,d=[],d.push(new t.Point(b.xmin,b.ymin,e)),d.push(new t.Point(b.xmin,(b.ymin+b.ymax)/2,e)),d.push(new t.Point(b.xmin,b.ymax,e)),d=d.map(function(b){return c(b,a,g)}).filter(function(a){return!isNaN(null===a||void 0===a?void 0:a.x)}).map(function(a){return a.x}),m.xmin=Math.min.apply(null,d)));b=a.isWebMercator?r.getInfo(a).origin:null!==(l=null===(p=r.getInfo(a))||void 0===p?void 0:p.valid)&&void 0!==l?l:[];z=b[0];x=b[1];(p=u(a))&&null!=z&&null!=x&&(Math.abs(m.xmin-z)<p&&(m.xmin=
z),Math.abs(m.xmax-x)<p&&(m.xmax=x));return m}Object.defineProperty(e,"__esModule",{value:!0});e.computeProjectedScales=e.snapPyramid=e.getProjectionOffsetGrid=e.projectExtent=e.projectPoint=e.projectResolution=e.load=e.defaultGridSpacing=void 0;var h=function(b,a){var c=(b.isWGS84||b.isWebMercator)&&(a.isWGS84||a.isWebMercator);return!(b.equals(a)||c)};e.defaultGridSpacing=32;e.load=function(){return q.__awaiter(this,void 0,void 0,function(){return q.__generator(this,function(b){switch(b.label){case 0:return f.isLoaded()||
!f.isSupported()?[2,null]:[4,f.load()];case 1:return b.sent(),[2]}})})};e.projectResolution=m;e.projectPoint=c;e.projectExtent=d;e.getProjectionOffsetGrid=function(b,a,g,d,I,x){var z,l;void 0===d&&(d=null);void 0===I&&(I=!1);void 0===x&&(x=[e.defaultGridSpacing,e.defaultGridSpacing]);if(h(b.spatialReference,a.spatialReference)&&!f.isLoaded())throw new v("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(b&&a&&g))return null;var k=b.xmin,m=b.ymin,u=b.xmax,n=b.ymax,q=
b.spatialReference,w=a.spatialReference;b=null!==(l=null===(z=r.getInfo(q))||void 0===z?void 0:z.valid)&&void 0!==l?l:[];var y=b[0],A=b[1],D=x[0]*g.x,C=x[1]*g.y,u=Math.ceil((u-k)/D-.1)+1,m=Math.ceil((n-m)/C-.1)+1,B;g=[];var F;z=!1;for(l=0;l<u;l++){var G=[];for(b=0;b<m;b++)B=new t.Point({x:k+D*l,y:n-C*b,spatialReference:q}),B=c(B,w,d),G.push(B),0<l&&I&&B&&F[b]&&null!=y&&B.x<F[b].x&&(B.x+=A-y),B?(g.push((B.x-a.xmin)/(a.xmax-a.xmin)),g.push((a.ymax-B.y)/(a.ymax-a.ymin))):(g.push(NaN),g.push(NaN),z=!0);
F=G}a=[Math.abs((g[0]+g[4]+g[4*u]+g[4*u+4])/4-g[2*m+2]),Math.abs((g[1]+g[5]+g[4*m+1]+g[4*m+5])/4-g[2*m+3])];d=new Float32Array((u-1)*(m-1)*12);I=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);k=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(l=0;l<u-1;l++){for(b=0;b<m-1;b++){C=l*m*2+2*b;n=g[C];F=g[C+1];q=g[C+2];w=g[C+3];C+=2*m;y=g[C];A=g[C+1];D=g[C+2];C=g[C+3];G=0;B=12*(b*(u-1)+l);for(var H=0;3>H;H++)d[B++]=I[G++]*n+I[G++]*q+I[G++]*D;for(H=G=0;3>H;H++)d[B++]=I[G++]*F+I[G++]*w+I[G++]*C;for(H=G=0;3>H;H++)d[B++]=
k[G++]*n+k[G++]*y+k[G++]*D;for(H=G=0;3>H;H++)d[B++]=k[G++]*F+k[G++]*A+k[G++]*C}if(z)for(b=0;b<d.length;b++)isNaN(d[b])&&(d[b]=-1)}return{offsets:g,error:a,coefficients:d,spacing:x,size:[u-1,m-1]}};e.snapPyramid=function(b,a,c){var d=Math.log(b.x/a.pixelSize.x)/Math.LN2,g=Math.log(b.y/a.pixelSize.y)/Math.LN2;b=a.storageInfo.maximumPyramidLevel||0;c="down"===c?Math.floor(Math.min(d,g)):"up"===c?Math.ceil(Math.max(d,g)):Math.round((d+g)/2);d=!1;0>c?c=0:c>b&&(d=c>b+3,c=b);b=Math.pow(2,c);a=new t.Point({x:b*
a.pixelSize.x,y:b*a.pixelSize.y,spatialReference:a.spatialReference});return{pyramidLevel:c,pyramidResolution:a,excessiveReading:d}};e.computeProjectedScales=function(b,a,c,h){void 0===c&&(c=512);void 0===h&&(h=!0);var g=b.extent,z=b.spatialReference,p=b.pixelSize,l=m(new t.Point({x:p.x,y:p.y,spatialReference:z}),a,g);if(null==l)return{projectedPixelSize:null,scales:null,srcResolutions:null};var f=(l.x+l.y)/2,e=n.getMetersPerUnitForSR(a),f=f*e*96*39.37;c=a.isGeographic?512/c*2.958287637958547E8:512/
c*5.91657527591555E8;var k=!1;h&&(a.isGeographic||a.isWebMercator)&&(h=d(g,a),k=0>h.xmin*h.xmax);h=f;if(k)h=c,b=h/(96*e*39.37),a=m(new t.Point({x:b,y:b,spatialReference:a}),z,g);else{a={x:p.x,y:p.y};b=Math.ceil(Math.log(Math.min(b.width,b.height)/32)/Math.LN2);for(g=0;h<.5005*c&&g<b;)g++,h*=2,a.x*=2,a.y*=2;1.001>=Math.max(h,c)/Math.min(h,c)&&(h=c)}b=[];g=[];for(f=Math.min(70.5310735,f)/1.001;h>=f;)b.push(h),g.push({x:a.x,y:a.y}),h/=2,a.x/=2,a.y/=2;return{projectedPixelSize:l,scales:b,srcResolutions:g}}})},
"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(E,e,q){function t(c,d){c=Math.min(Math.max(c,-100),100);d=Math.min(Math.max(d,-100),100);var h,b,a=new Uint8Array(256);for(h=0;256>h;h++)0<c&&100>c?b=(200*h-25500+510*d)/(2*(100-c))+128:0>=c&&-100<c?b=(200*h-25500+510*d)*(100+c)/2E4+128:100===c?(b=200*h-25500+256*(100-c)+510*d,b=0<b?255:0):-100===c&&(b=128),a[h]=255<b?255:0>b?0:b;return a}function v(c,d,h,b,a,g,z,f){return{xmin:a<=h*c?
0:a<h*c+c?a-h*c:c,ymin:g<=b*d?0:g<b*d+d?g-b*d:d,xmax:a+z<=h*c?0:a+z<h*c+c?a+z-h*c:c,ymax:g+f<=b*d?0:g+f<b*d+d?g+f-b*d:d}}function n(c,d,h,b){var a=c.filter(function(a){return u(a)})[0];if(null==a)return null;var g=b?b.width:d.width;b=b?b.height:d.height;var z=a.width,f=a.height,e=d.width/z;d=d.height/f;var p=h?h.x:0;h=h?h.y:0;var l=a.pixelType,k=q.getPixelArrayConstructor(l),m=a.pixels.length,a=[],n,r,t,w,y,A,D,C,B,F;for(y=0;y<m;y++){r=new k(g*b);for(A=0;A<d;A++)for(D=0;D<e;D++)if(t=c[A*e+D])for(n=
t.pixels[y],F=v(z,f,D,A,p,h,g,b),C=F.ymin;C<F.ymax;C++)for(t=(A*f+C-h)*g+(D*z-p),w=C*z,B=F.xmin;B<F.xmax;B++)r[t+B]=n[w+B];a.push(r)}var G;if(c.some(function(a){return null==a||a.mask&&0<a.mask.length}))for(G=new Uint8Array(g*b),A=0;A<d;A++)for(D=0;D<e;D++)if(k=(t=c[A*e+D])?t.mask:null,F=v(z,f,D,A,p,h,g,b),k)for(C=F.ymin;C<F.ymax;C++)for(t=(A*f+C-h)*g+(D*z-p),w=C*z,B=F.xmin;B<F.xmax;B++)G[t+B]=k[w+B];else if(t)for(C=F.ymin;C<F.ymax;C++)for(t=(A*f+C-h)*g+(D*z-p),w=C*z,B=F.xmin;B<F.xmax;B++)G[t+B]=
1;else for(C=F.ymin;C<F.ymax;C++)for(t=(A*f+C-h)*g+(D*z-p),w=C*z,B=F.xmin;B<F.xmax;B++)G[t+B]=0;c=new q({width:g,height:b,pixels:a,pixelType:l,mask:G});c.updateStatistics();return c}function f(c){if(!u(c))return null;var d=c.clone(),h=c.width,b=c.height,a=c.mask;c=c.pixels[0];for(var g=d.pixels[0],f=2;f<b-1;f++){for(var e=new Map,x=f-2;x<f+2;x++)for(var p=0;4>p;p++){var l=x*h+p;m(e,c[l],a?a[l]:1)}g[f*h]=r(e);g[f*h+1]=g[f*h+2]=g[f*h];for(x=3;x<h-1;x++)l=(f-2)*h+x+1,m(e,c[l],a?a[l]:1),l=(f-1)*h+x+1,
m(e,c[l],a?a[l]:1),l=f*h+x+1,m(e,c[l],a?a[l]:1),l=(f+1)*h+x+1,m(e,c[l],a?a[l]:1),l=(f-2)*h+x-3,k(e,c[l],a?a[l]:1),l=(f-1)*h+x-3,k(e,c[l],a?a[l]:1),l=f*h+x-3,k(e,c[l],a?a[l]:1),l=(f+1)*h+x-3,k(e,c[l],a?a[l]:1),g[f*h+x]=r(e);g[f*h+x+1]=g[f*h+x]}for(x=0;x<h;x++)g[x]=g[h+x]=g[2*h+x],g[(b-1)*h+x]=g[(b-2)*h+x];d.updateStatistics();return d}function r(c){if(0===c.size)return 0;for(var d=0,h=-1,b=0,a=c.keys(),g=a.next();!g.done;)b=c.get(g.value),b>d&&(h=g.value,d=b),g=a.next();return h}function k(c,d,h){0!==
h&&(h=c.get(d),1===h?c.delete(d):c.set(d,h-1))}function m(c,d,h){0!==h&&c.set(d,c.has(d)?c.get(d)+1:1)}Object.defineProperty(e,"__esModule",{value:!0});e.approximateTransform=e.clip=e.resampleByMajority=e.setValidBoundary=e.mosaic=e.mosaicPixelData=e.getClipBounds=e.remapColor=e.lookupPixels=e.stretch=e.createContrastBrightnessLUT=e.createStretchLUT=e.estimateStatisticsFromHistograms=e.estimateStatisticsHistograms=e.colorize=e.createColormapLUT=e.extractBands=void 0;var u=function(c){return c&&"esri.layers.support.PixelBlock"===
c.declaredClass&&c.pixels&&0<c.pixels.length};e.extractBands=function(c,d){if(!d||!u(c))return c;var h=c.pixels.length;return d&&d.some(function(b){return b>=h})||1===h&&1===d.length&&0===d[0]||h===d.length&&!d.some(function(b,a){return b!==a})?c:new q({pixelType:c.pixelType,width:c.width,height:c.height,mask:c.mask,validPixelCount:c.validPixelCount,maskIsAlpha:c.maskIsAlpha,pixels:d.map(function(b){return c.pixels[b]}),statistics:c.statistics&&d.map(function(b){return c.statistics[b]})})};e.createColormapLUT=
function(c){if(c){var d=c.colormap;if(d&&0!==d.length){var d=d.sort(function(a,b){return a[0]-b[0]}),h=0;0>d[0][0]&&(h=d[0][0]);var b=Math.max(256,d[d.length-1][0]-h+1),a=new Uint8Array(4*b),g=[],f=0,e=0,x=5===d[0].length;if(65536<b)return d.forEach(function(a){g[a[0]-h]=x?a.slice(1):a.slice(1).concat([255])}),{indexed2DColormap:g,offset:h,alphaSpecified:x};if(c.fillUnspecified)for(c=d[e],f=c[0]-h;f<b;f++)a[4*f]=c[1],a[4*f+1]=c[2],a[4*f+2]=c[3],a[4*f+3]=x?c[4]:255,f===c[0]-h&&(c=e===d.length-1?c:
d[++e]);else for(f=0;f<d.length;f++)c=d[f],e=4*(c[0]-h),a[e]=c[1],a[e+1]=c[2],a[e+2]=c[3],a[e+3]=x?c[4]:255;return{indexedColormap:a,offset:h,alphaSpecified:x}}}};e.colorize=function(c,d){if(!u(c)||!d&&(d.indexedColormap||d.indexed2DColormap))return c;var h=c.clone(),b=h.pixels,a=h.mask,g=h.width*h.height;if(1!==b.length)return c;var f=d.indexedColormap;c=d.indexed2DColormap;var e=d.offset;d=d.alphaSpecified;var x=f.length-1,p=0,b=b[0],l=new Uint8Array(b.length),k=new Uint8Array(b.length),m=new Uint8Array(b.length),
n=0;if(f)if(a)for(p=0;p<g;p++)a[p]&&(n=4*(b[p]-e),n<e||n>x?a[p]=0:(l[p]=f[n],k[p]=f[n+1],m[p]=f[n+2],a[p]=f[n+3]));else{a=new Uint8Array(g);for(p=0;p<g;p++)n=4*(b[p]-e),n<e||n>x?a[p]=0:(l[p]=f[n],k[p]=f[n+1],m[p]=f[n+2],a[p]=f[n+3]);h.mask=a}else if(a)for(p=0;p<g;p++)a[p]&&(f=c[b[p]],l[p]=f[0],k[p]=f[1],m[p]=f[2],a[p]=f[3]);else{a=new Uint8Array(g);for(p=0;p<g;p++)f=c[b[p]],l[p]=f[0],k[p]=f[1],m[p]=f[2],a[p]=f[3];h.mask=a}h.pixels=[l,k,m];h.statistics=null;h.pixelType="u8";h.maskIsAlpha=d;return h};
e.estimateStatisticsHistograms=function(c){if(!u(c))return null;c.statistics||c.updateStatistics();var d=c.pixels,h=c.mask,b=c.pixelType,a=c.statistics;c=c.width*c.height;var g=d.length,f,e,k,p,l,m=[],n=[],q,r,t;for(p=0;p<g;p++){q=new Uint32Array(256);t=d[p];if("u8"===b)if(f=-.5,e=255.5,h)for(l=0;l<c;l++)h[l]&&q[t[l]]++;else for(l=0;l<c;l++)q[t[l]]++;else{f=a[p].minValue;e=a[p].maxValue;k=(e-f)/256;r=new Uint32Array(257);if(h)for(l=0;l<c;l++)h[l]&&r[Math.floor((t[l]-f)/k)]++;else for(l=0;l<c;l++)r[Math.floor((t[l]-
f)/k)]++;for(l=0;255>l;l++)q[l]=r[l];q[255]=r[255]+r[256]}m.push({min:f,max:e,size:256,counts:q});for(l=t=r=k=0;256>l;l++)k+=q[l],r+=l*q[l];r/=k;for(l=0;256>l;l++)t+=q[l]*Math.pow(l-r,2);q=Math.sqrt(t/(k-1));k=(e-f)/256;l=(r+.5)*k+f;q*=k;n.push({min:f,max:e,avg:l,stddev:q})}return{statistics:n,histograms:m}};e.estimateStatisticsFromHistograms=function(c){for(var d=[],h=0;h<c.length;h++){for(var b=c[h],a=b.min,g=b.max,f=b.size,e=b.counts,k=b=0,p=0;p<f;p++)b+=e[p],k+=p*e[p];for(var k=k/b,l=0,p=0;p<
f;p++)l+=e[p]*Math.pow(p-k,2);f=(g-a)/f;d.push({min:a,max:g,avg:(k+.5)*f+a,stddev:Math.sqrt(l/(b-1))*f})}return d};e.createStretchLUT=function(c){var d=c.minCutOff,h=c.maxCutOff,b=c.gamma,a=c.pixelType,g=c.outMin||0,f=c.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(a))return null;var e=d.length,k,p=0;"s8"===a?p=-127:"s16"===a&&(p=-32767);var l=256;-1<["u16","s16"].indexOf(a)&&(l=65536);for(var m=[],n=f-g,a=0;a<e;a++)m[a]=h[a]-d[a];k=b&&b.length>=e;var u=[];if(k)for(a=0;a<e;a++)u[a]=1<b[a]?2<
b[a]?6.5+Math.pow(b[a]-2,2.5):6.5+100*Math.pow(2-b[a],4):1;var q,r=[],w,y,A;if(k)for(a=0;a<e;a++){A=[];for(k=0;k<l;k++)w=k+p,q=(w-d[a])/m[a],y=1,1<b[a]&&(y-=Math.pow(1/n,q*u[a])),A[k]=w<h[a]&&w>d[a]?Math.floor(y*n*Math.pow(q,1/b[a]))+g:w>=h[a]?f:g;r[a]=A}else for(a=0;a<e;a++){A=[];for(k=0;k<l;k++)w=k+p,A[k]=w<=d[a]?g:w>=h[a]?f:Math.floor((w-d[a])/m[a]*n)+g;r[a]=A}if(null!=c.contrastOffset)for(c=t(c.contrastOffset,c.brightnessOffset),a=0;a<e;a++)for(A=r[a],k=0;k<l;k++)A[k]=c[A[k]];return{lut:r,offset:p}};
e.createContrastBrightnessLUT=t;e.stretch=function(c,d){if(!u(c))return null;c=c.clone();var h=c.pixels,b=c.mask,a=d.minCutOff,g=d.maxCutOff,f=d.gamma,e=d.outMin||0;d=d.outMax||255;var k=c.width*c.height,p=h.length,l,m,n,q,r,t=d-e,w=[];for(l=0;l<p;l++)w[l]=g[l]-a[l];m=f&&f.length>=p;var y=[];if(m)for(l=0;l<p;l++)y[l]=1<f[l]?2<f[l]?6.5+Math.pow(f[l]-2,2.5):6.5+100*Math.pow(2-f[l],4):1;if(m)if(null!=b)for(m=0;m<k;m++){if(b[m])for(l=0;l<p;l++)n=h[l][m],r=(n-a[l])/w[l],q=1,1<f[l]&&(q-=Math.pow(1/t,r*
y[l])),h[l][m]=n<g[l]&&n>a[l]?Math.floor(q*t*Math.pow(r,1/f[l]))+e:n>=g[l]?d:e}else for(m=0;m<k;m++)for(l=0;l<p;l++)n=h[l][m],r=(n-a[l])/w[l],q=1,1<f[l]&&(q-=Math.pow(1/t,r*y[l])),h[l][m]=n<g[l]&&n>a[l]?Math.floor(q*t*Math.pow(r,1/f[l]))+e:n>=g[l]?d:e;else if(null!=b)for(m=0;m<k;m++){if(b[m])for(l=0;l<p;l++)n=h[l][m],h[l][m]=n<g[l]&&n>a[l]?Math.floor((n-a[l])/w[l]*t)+e:n>=g[l]?d:e}else for(m=0;m<k;m++)for(l=0;l<p;l++)n=h[l][m],h[l][m]=n<g[l]&&n>a[l]?Math.floor((n-a[l])/w[l]*t)+e:n>=g[l]?d:e;c.pixelType=
"u8";c.updateStatistics();return c};e.lookupPixels=function(c,d){if(!u(c))return null;var h=c.pixels,b=c.mask,a=c.width*c.height,g=h.length,f=d.lut;d=d.offset;var e,k;f&&1===f[0].length&&(f=h.map(function(){return f}));var m=[],l,n,r;if(d)if(null==b)for(e=0;e<g;e++){l=h[e];n=f[e];r=new Uint8Array(a);for(k=0;k<a;k++)r[k]=n[l[k]-d];m.push(r)}else for(e=0;e<g;e++){l=h[e];n=f[e];r=new Uint8Array(a);for(k=0;k<a;k++)b[k]&&(r[k]=n[l[k]-d]);m.push(r)}else if(null==b)for(e=0;e<g;e++){l=h[e];n=f[e];r=new Uint8Array(a);
for(k=0;k<a;k++)r[k]=n[l[k]];m.push(r)}else for(e=0;e<g;e++){l=h[e];n=f[e];r=new Uint8Array(a);for(k=0;k<a;k++)b[k]&&(r[k]=n[l[k]]);m.push(r)}c=new q({width:c.width,height:c.height,pixels:m,mask:b,pixelType:"u8"});c.updateStatistics();return c};e.remapColor=function(c,d){if(!u(c))return null;c=c.clone();var h=c.width*c.height,b=d.length,a=Math.floor(b/2),g=d[Math.floor(a)],f=c.pixels[0],e,k,m,l,n,q,r=!1,t=new Uint8Array(h),v=new Uint8Array(h),w=new Uint8Array(h),y=c.mask,A=4===d[0].mappedColor.length;
y||(y=new Uint8Array(h),y.fill(A?255:1),c.mask=y);for(n=0;n<h;n++)if(y[n]){e=f[n];r=!1;q=a;k=g;m=0;for(l=b-1;1<l-m;){if(e===k.value){r=!0;break}e>k.value?m=q:l=q;q=Math.floor((m+l)/2);k=d[Math.floor(q)]}r||(e===d[m].value?(k=d[m],r=!0):e===d[l].value?(k=d[l],r=!0):e<d[m].value?(r=!1,k=null):e>d[m].value&&(e<d[l].value?(k=d[m],r=!0):l===b-1?(r=!1,k=null):(k=d[l],r=!0)));r?(t[n]=k.mappedColor[0],v[n]=k.mappedColor[1],w[n]=k.mappedColor[2],y[n]=k.mappedColor[3]):t[n]=v[n]=w[n]=y[n]=0}c.pixels=[t,v,w];
c.mask=y;c.pixelType="u8";c.maskIsAlpha=A;return c};e.getClipBounds=v;e.mosaicPixelData=function(c,d){if(!c||0===c.length)return null;var h=c.filter(function(a){return a.pixelBlock})[0];if(!h)return null;var b=(h.extent.xmax-h.extent.xmin)/h.pixelBlock.width,a=(h.extent.ymax-h.extent.ymin)/h.pixelBlock.height,g=.01*Math.min(b,a),f=c.sort(function(a,b){return Math.abs(a.extent.ymax-b.extent.ymax)>g?b.extent.ymax-a.extent.ymax:Math.abs(a.extent.xmin-b.extent.xmin)>g?a.extent.xmin-b.extent.xmin:0}),
e=Math.min.apply(null,f.map(function(a){return a.extent.xmin})),k=Math.min.apply(null,f.map(function(a){return a.extent.ymin})),m=Math.max.apply(null,f.map(function(a){return a.extent.xmax})),l=Math.max.apply(null,f.map(function(a){return a.extent.ymax}));c={x:Math.round((d.xmin-e)/b),y:Math.round((l-d.ymax)/a)};e={width:Math.round((m-e)/b),height:Math.round((l-k)/a)};b={width:Math.round((d.xmax-d.xmin)/b),height:Math.round((d.ymax-d.ymin)/a)};if(Math.round(e.width/h.pixelBlock.width)*Math.round(e.height/
h.pixelBlock.height)!==f.length||0>c.x||0>c.y||e.width<b.width||e.height<b.height)return null;h=f.map(function(a){return a.pixelBlock});h=n(h,e,c,b);return{extent:d,pixelBlock:h}};e.mosaic=n;e.setValidBoundary=function(c,d,h){if(!u(c))return null;var b=c.width,a=c.height,g=d.x;d=d.y;var f=h.width+g;h=h.height+d;if(0>g||0>d||f>b||h>a||0===g&&0===d&&f===b&&h===a)return c;c.mask||(c.mask=new Uint8Array(b*a));for(var e=c.mask,k=0;k<a;k++)for(var m=k*b,l=0;l<b;l++)e[m+l]=k<d||k>=h||l<g||l>=f?0:1;c.updateStatistics();
return c};e.resampleByMajority=f;e.clip=function(c,d,h){var b=d.x;d=d.y;var a=h.width,g=h.height;if(0===b&&0===d&&g===c.height&&a===c.width)return c;var f=c.width,e=Math.max(0,d),k=Math.max(0,b),m=Math.min(b+a,f),l=Math.min(d+g,c.height);if(0>m||0>l||!u(c))return null;b=Math.max(0,-b);d=Math.max(0,-d);for(var n=c.pixels,r=c.mask,t=a*g,v=n.length,g=[],E=0;E<v;E++){for(var w=n[E],y=q.createEmptyBand(c.pixelType,t),A=e;A<l;A++)for(var D=A*f,C=(A+d)*a+b,B=k;B<m;B++)y[C++]=w[D+B];g.push(y)}c=new Uint8Array(t);
for(A=e;A<l;A++)for(D=A*f,C=(A+d)*a+b,B=k;B<m;B++)c[C++]=r?r[D+B]:1;h=new q({width:h.width,height:h.height,pixels:g,mask:c});h.updateStatistics();return h};e.approximateTransform=function(c,d,h,b,a){void 0===a&&(a="nearest");if(!u(c))return null;"majority"===a&&(c=f(c));var g=c.pixels,e=c.mask,k=c.pixelType,m=c.width,n=c.height;c=q.getPixelArrayConstructor(k);var l=g.length,r=d.width,t=d.height;d=b.cols;var v=b.rows,E=Math.ceil(r/d),L=Math.ceil(t/v);b=!1;for(var w=0;w<h.length;w+=3)-1===h[w]&&-1===
h[w+1]&&-1===h[w+2]&&(b=!0);for(var y,A,D,C,B,F,G=new Float32Array(r*t),H=new Float32Array(r*t),N=0,O,P,R="majority"===a?0:.5,w=0;w<L;w++)for(var Q=0;Q<E;Q++){y=12*(w*E+Q);a=h[y];A=h[y+1];D=h[y+2];C=h[y+3];B=h[y+4];F=h[y+5];for(var J=0;J<v;J++){N=(w*v+J)*r+Q*d;P=(J+.5)/v;for(var K=0;K<J;K++)O=(K+.5)/d,G[N+K]=Math.round((a*O+A*P+D)*m-R),H[N+K]=Math.round((C*O+B*P+F)*n-R)}y+=6;a=h[y];A=h[y+1];D=h[y+2];C=h[y+3];B=h[y+4];F=h[y+5];for(J=0;J<v;J++)for(N=(w*v+J)*r+Q*d,P=(J+.5)/v,K=J;K<d;K++)O=(K+.5)/d,G[N+
K]=Math.round((a*O+A*P+D)*m-R),H[N+K]=Math.round((C*O+B*P+F)*n-R)}h=function(a,b){for(var c=0;c<t;c++){y=c*r;for(var d=0;d<r;d++)a[y]=0>G[y]||0>H[y]?0:b[G[y]+H[y]*m],y++}};n=[];for(w=0;w<l;w++)d=new c(r*t),h(d,g[w]),n.push(d);g=new q({width:r,height:t,pixelType:k,pixels:n});if(e)g.mask=new Uint8Array(r*t),h(g.mask,e);else if(b)for(g.mask=new Uint8Array(r*t),w=0;w<r*t;w++)g.mask[w]=0>G[w]||0>H[w]?0:1;g.updateStatistics();return g}})},"esri/views/2d/engine/RasterTileContainer":function(){define("require exports tslib ../../../geometry/support/aaBoundingRect ../engine/brushes ./RasterTile ./webgl/enums ./webgl/TileContainer".split(" "),
function(E,e,q,t,v,n,f,r){Object.defineProperty(e,"__esModule",{value:!0});e.RasterTileContainer=void 0;E=function(e){function k(){return null!==e&&e.apply(this,arguments)||this}q.__extends(k,e);k.prototype.createTile=function(f){var c=this._tileInfoView.getTileBounds(t.create(),f);return new n.RasterTile(f,c,this._tileInfoView.tileInfo.size)};k.prototype.destroyTile=function(){};k.prototype.prepareRenderPasses=function(k){var c=this,d=k.registerRenderPass({name:"bitmap (tile)",brushes:[v.brushes.raster],
target:function(){return c.children.map(function(c){return c.bitmap})},drawPhase:f.WGLDrawPhase.MAP});return q.__spreadArrays(e.prototype.prepareRenderPasses.call(this,k),[d])};k.prototype.doRender=function(k){this.visible&&k.drawPhase===f.WGLDrawPhase.MAP&&e.prototype.doRender.call(this,k)};return k}(r.default);e.RasterTileContainer=E})},"esri/views/2d/engine/RasterTile":function(){define(["require","exports","tslib","./RasterBitmap","./webgl/TiledDisplayObject"],function(E,e,q,t,v){Object.defineProperty(e,
"__esModule",{value:!0});e.RasterTile=void 0;E=function(e){function f(f,k,m,n){void 0===n&&(n=null);var c=e.call(this,f,k,m)||this;c.bitmap=new t.RasterBitmap(n,null,null);c.bitmap.coordScale=m;c.bitmap.once("isReady",function(){return c.ready()});return c}q.__extends(f,e);Object.defineProperty(f.prototype,"stencilRef",{get:function(){return this.bitmap.stencilRef},set:function(f){this.bitmap.stencilRef=f},enumerable:!1,configurable:!0});f.prototype.getMemoryUsage=function(){return this.bitmap.getMemoryUsage()};
f.prototype.setTransform=function(f,k){e.prototype.setTransform.call(this,f,k);this.bitmap.transforms.dvs=this.transforms.dvs};f.prototype.release=function(){this.destroy();this.stage=this.bitmap=null;return!0};f.prototype.onAttach=function(){this.bitmap.stage=this.stage};f.prototype.onDetach=function(){this.bitmap.stage=null};return f}(v.TiledDisplayObject);e.RasterTile=E})},"esri/views/2d/engine/RasterBitmap":function(){define("require exports tslib ../../../core/maybe ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/vec2f32 ../../../layers/support/rasterFunctions/pixelUtils ./DisplayObject ../../webgl/rasterUtils".split(" "),
function(E,e,q,t,v,n,f,r,k,m){Object.defineProperty(e,"__esModule",{value:!0});e.RasterBitmap=void 0;var u={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};E=function(c){function d(d,b,a){void 0===d&&(d=null);void 0===b&&(b=null);void 0===a&&(a=null);var g=c.call(this)||this;g._textureInvalidated=!0;g._memoryUsed=null;g.stencilRef=0;g.coordScale=[1,
1];g._symbolizerParameters=null;g.height=null;g.pixelRatio=1;g.resolution=0;g.rotation=0;g._source=null;g.rawPixelData=null;g._suspended=!1;g._bandIds=null;g._interpolation=null;g._transformGrid=null;g.width=null;g.x=0;g.y=0;g.transforms={dvs:n.mat3f32.create()};g.source=d;g.transformGrid=b;g.interpolation=a;return g}q.__extends(d,c);Object.defineProperty(d.prototype,"symbolizerParameters",{get:function(){return this._symbolizerParameters||u},set:function(c){this._symbolizerParameters=c},enumerable:!1,
configurable:!0});Object.defineProperty(d.prototype,"source",{get:function(){return this._source},set:function(c){this._source=c;this._rasterTexture&&(this._rasterTexture.dispose(),this._memoryUsed=this._rasterTextureBandIds=this._rasterTexture=null)},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"suspended",{get:function(){return this._suspended},set:function(c){this._suspended&&!c&&this.stage&&(this.ready(),this.requestRender());this._suspended=c},enumerable:!1,configurable:!0});
Object.defineProperty(d.prototype,"bandIds",{get:function(){return this._bandIds},set:function(c){this._bandIds=c;this.invalidateTexture()},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"interpolation",{get:function(){return this._interpolation},set:function(c){this._interpolation=c;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===c||"cubic"===c?9729:9728)},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"transformGrid",{get:function(){return this._transformGrid},
set:function(c){this._transformGrid=c;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=null)},enumerable:!1,configurable:!0});d.prototype.invalidateTexture=function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())};d.prototype.setTransform=function(c){var b=v.mat3.identity(this.transforms.dvs),a=c.toScreenNoRotation([0,0],this.x,this.y),d=this.resolution/this.pixelRatio/c.resolution,e=d*this.width,d=d*this.height,
h=Math.PI*this.rotation/180;v.mat3.translate(b,b,f.vec2f32.fromValues(a[0],a[1]));v.mat3.translate(b,b,f.vec2f32.fromValues(e/2,d/2));v.mat3.rotate(b,b,-h);v.mat3.translate(b,b,f.vec2f32.fromValues(-e/2,-d/2));v.mat3.scaleByVec2(b,b,f.vec2f32.fromValues(e,d));v.mat3.multiply(this.transforms.dvs,c.displayViewMat3,b)};d.prototype.getTextures=function(){if(!this._rasterTexture)return null;var c=[],b=[];this._transformGridTexture&&(b.push(this._transformGridTexture),c.push("u_transformGrid"));this._rasterTexture&&
(b.push(this._rasterTexture),c.push("u_image"));this._colormapTexture&&(b.push(this._colormapTexture),c.push("u_colormap"));return{names:c,textures:b}};d.prototype.getMemoryUsage=function(){if(t.isNone(this._memoryUsed)){var c=this.getTextures();if(null==c)return 0;this._memoryUsed=c.textures.map(function(b){return b.descriptor.width*b.descriptor.height*4}).reduce(function(b,a){return b+a})}return this._memoryUsed};d.prototype.onAttach=function(){this.invalidateTexture()};d.prototype.onDetach=function(){this.invalidateTexture()};
d.prototype.updateTexture=function(c){var b,a,d;c=c.context;this.stage?this._textureInvalidated&&(this._textureInvalidated=!1,b=(b=this.source)&&b.pixels&&0<b.pixels.length,this._createOrDestroyRasterTexture(c),this._rasterTexture&&(b?(this._updateColormapTexture(c),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=m.createTransformTexture(c,this.transformGrid))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender())):(null===(b=this._rasterTexture)||
void 0===b?void 0:b.dispose(),null===(a=this._transformGridTexture)||void 0===a?void 0:a.dispose(),null===(d=this._colormapTexture)||void 0===d?void 0:d.dispose(),this._colormapTexture=this._transformGridTexture=this._rasterTextureBandIds=this._rasterTexture=null)};d.prototype._createOrDestroyRasterTexture=function(c){var b=this.source?r.extractBands(this.source,this.bandIds):null;if(b&&b.pixels&&0<b.pixels.length){var a=null==this._rasterTextureBandIds&&null==this.bandIds||this._rasterTextureBandIds&&
this.bandIds&&this._rasterTextureBandIds.join("")===this.bandIds.join("");if(this._rasterTexture){if(a)return;this._rasterTexture.dispose();this._rasterTexture=this._rasterTextureBandIds=null}this._rasterTexture=m.createRasterTexture(c,b,this.interpolation||"nearest");this._rasterTextureBandIds=this.bandIds}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=this._rasterTextureBandIds=null)};d.prototype._updateColormapTexture=function(c){var b=this._colormap,a=this.symbolizerParameters.colormap;
if(!a)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!b)this._colormapTexture=m.createColormapTexture(c,a),this._colormap=a;else if(a.length!==b.length||a.some(function(a,c){return a!==b[c]}))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=m.createColormapTexture(c,a),this._colormap=a};return d}(k.DisplayObject);e.RasterBitmap=E})},"esri/views/2d/layers/LayerView2D":function(){define("require exports tslib ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(E,e,q,t,v,n,f,r,k,m,u,c){Object.defineProperty(e,"__esModule",{value:!0});e.LayerView2DMixin=void 0;var d=t.ofType({key:"type",base:k,typeMap:{rect:m,path:c,geometry:u}});e.LayerView2DMixin=function(c){return function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.clips=new d;a.moving=!1;a.attached=!1;a.lastUpdateId=-1;a.updateRequested=!1;return a}q.__extends(a,b);a.prototype.initialize=function(){var a=this,b;this.container||(this.container=new r.Container);this.container.fadeTransitionEnabled=
!0;this.container.opacity=0;this.container.clips=this.clips;this.handles.add([n.init(this,"suspended",function(b){a.container&&(a.container.visible=!b);a.view&&!b&&a.updateRequested&&a.view.requestUpdate()},!0),n.init(this,["layer.opacity","container"],function(){var b,c;a.container&&(a.container.opacity=null!==(c=null===(b=a.layer)||void 0===b?void 0:b.opacity)&&void 0!==c?c:1)},!0),n.init(this,["layer.blendMode"],function(b){a.container&&(a.container.blendMode=b)},!0),n.init(this,["layer.effect"],
function(b){a.container&&(a.container.effect=b)},!0),this.clips.on("change",function(){a.container.clips=a.clips;a.notifyChange("clips")})]);(null===(b=this.view)||void 0===b?0:b.whenLayerView)?this.view.whenLayerView(this.layer).then(function(b){b!==a||a.attached||a.destroyed||(a.attach(),a.requestUpdate(),a.attached=!0)},function(){}):this.when().then(function(){a.attached||a.destroyed||(a.attach(),a.requestUpdate(),a.attached=!0)},function(){})};a.prototype.destroy=function(){this.attached&&(this.detach(),
this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};Object.defineProperty(a.prototype,"updating",{get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())},enumerable:!1,configurable:!0});a.prototype.isVisibleAtScale=function(a){var b=!0,c=this.layer,d=c.minScale,c=c.maxScale;if(null!=d&&null!=c){var b=!d,f=!c;!b&&a<=d&&(b=!0);!f&&a>=c&&(f=!0);b=b&&f}return b};a.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=
!0,this.suspended||this.view.requestUpdate())};a.prototype.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};a.prototype.isUpdating=function(){return!1};a.prototype.isRendering=function(){return!1};a.prototype.canResume=function(){return b.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};q.__decorate([f.property({type:d,
set:function(a){a=v.referenceSetter(a,this._get("clips"),d);this._set("clips",a)}})],a.prototype,"clips",void 0);q.__decorate([f.property()],a.prototype,"moving",void 0);q.__decorate([f.property()],a.prototype,"attached",void 0);q.__decorate([f.property()],a.prototype,"container",void 0);q.__decorate([f.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],a.prototype,"suspended",void 0);q.__decorate([f.property({readOnly:!0})],a.prototype,"updateParameters",void 0);q.__decorate([f.property()],
a.prototype,"updateRequested",void 0);q.__decorate([f.property({dependsOn:["attached","updateRequested","suspended"]})],a.prototype,"updating",null);q.__decorate([f.property()],a.prototype,"view",void 0);return a=q.__decorate([f.subclass("esri.views.2d.layers.LayerView2D")],a)}(c)}})},"esri/views/layers/support/ClipArea":function(){define(["require","exports","tslib","../../../core/JSONSupport","../../../core/accessorSupport/decorators"],function(E,e,q,t,v){return function(e){function f(){return null!==
e&&e.apply(this,arguments)||this}q.__extends(f,e);return f=q.__decorate([v.subclass("esri.views.layers.support.ClipArea")],f)}(t.JSONSupport)})},"esri/views/layers/support/ClipRect":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","./ClipArea"],function(E,e,q,t,v){return function(e){function f(){var f=null!==e&&e.apply(this,arguments)||this;f.type="rect";f.left=null;f.right=null;f.top=null;f.bottom=null;return f}q.__extends(f,e);n=f;f.prototype.clone=function(){return new n({left:this.left,
right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(f.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});var n;q.__decorate([t.property({type:[Number,String],json:{write:!0}})],f.prototype,"left",void 0);q.__decorate([t.property({type:[Number,String],json:{write:!0}})],f.prototype,"right",void 0);q.__decorate([t.property({type:[Number,String],json:{write:!0}})],f.prototype,"top",void 0);q.__decorate([t.property({type:[Number,
String],json:{write:!0}})],f.prototype,"bottom",void 0);q.__decorate([t.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],f.prototype,"version",null);return f=n=q.__decorate([t.subclass("esri.views.layers.support.ClipRect")],f)}(v)})},"esri/views/layers/support/Geometry":function(){define("require exports tslib ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),function(E,e,q,t,v,n,f,r){var k=
{base:n,key:"type",typeMap:{extent:t.Extent,polygon:t.Polygon}};return function(e){function m(){var c=null!==e&&e.apply(this,arguments)||this;c.type="geometry";c.geometry=null;return c}q.__extends(m,e);c=m;Object.defineProperty(m.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});m.prototype.clone=function(){return new c({geometry:this.geometry.clone()})};var c;q.__decorate([v.property({types:k,json:{read:f.fromJSON,write:!0}})],m.prototype,"geometry",
void 0);q.__decorate([v.property({readOnly:!0,dependsOn:["geometry"]})],m.prototype,"version",null);return m=c=q.__decorate([v.subclass("esri.views.layers.support.Geometry")],m)}(r)})},"esri/views/layers/support/Path":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","./ClipArea"],function(E,e,q,t,v){return function(e){function f(){var f=null!==e&&e.apply(this,arguments)||this;f.type="path";f.path=[];return f}q.__extends(f,e);Object.defineProperty(f.prototype,
"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});q.__decorate([t.property({type:[[[Number]]],json:{write:!0}})],f.prototype,"path",void 0);q.__decorate([t.property({readOnly:!0,dependsOn:["path"]})],f.prototype,"version",null);return f=q.__decorate([t.subclass("esri.views.layers.support.Path")],f)}(v)})},"esri/views/layers/ImageryTileLayerView":function(){define("require exports tslib ../../Graphic ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../layers/graphics/data/projectionSupport ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),
function(E,e,q,t,v,n,f,r,k,m,u){Object.defineProperty(e,"__esModule",{value:!0});e.ImageryTileLayerView=void 0;e.ImageryTileLayerView=function(c){return function(c){function d(){var b=null!==c&&c.apply(this,arguments)||this;b._rasterFieldPrefix="Raster.";b.layer=null;b.view=null;b.fullExtent=null;b.tileInfo=null;b.datumTransformation=null;return b}q.__extends(d,c);Object.defineProperty(d.prototype,"hasTilingEffects",{get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&
this.layer.renderer.dynamicRangeAdjustment},enumerable:!1,configurable:!0});d.prototype.fetchPopupFeatures=function(b,a){var c,d;return q.__awaiter(this,void 0,void 0,function(){var e,g,k,h,m,r,z,E,L,w,y,A,D;return q.__generator(this,function(l){switch(l.label){case 0:e=this.layer;if(!b)return[2,f.reject(new v("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e}))];g=e.popupEnabled;k=u.getFetchPopupTemplate(e,a);if(!g||!n.isSome(k))throw new v("imageryTileLayerView:fetchPopupFeatures",
"Missing required popupTemplate or popupEnabled",{popupEnabled:g,popupTemplate:k});h=[];return[4,e.identify(b)];case 1:if(m=l.sent().value){r=m.join(", ");z={ObjectId:0};z["Raster.ServicePixelValue"]=this._formatAttributeValue(r,"Raster.ServicePixelValue");if((E=null===(d=null===(c=e.rasterInfo)||void 0===c?void 0:c.attributeTable)||void 0===d?void 0:d.features)&&0<E.length&&(L=E.filter(function(a){return String(a.attributes.value||a.attributes.Value||a.attributes.VALUE)===r}),0<L.length&&(w=L[0])))for(y in w.attributes)w.attributes.hasOwnProperty(y)&&
(A=this._rasterFieldPrefix+y,z[A]=this._formatAttributeValue(w.attributes[y],A));D=new t(this.fullExtent.clone(),null,z);D.layer=e;D.sourceLayer=D.layer;h.push(D)}return[2,h]}})})};d.prototype.updateFullExtent=function(){var b=this.layer.tileInfo,a;b&&b.spatialReference||(a=new v("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));b=this.view.spatialReference;k.doesBrowserSupportProjection(b,this.layer.spatialReference)?(b=m.projectExtent(this.layer.fullExtent,
b,this.datumTransformation),null==b&&(a=new v("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})),this._set("fullExtent",b)):a=new v("layerview:projection-not-supported","The layer requires projection engine, which is not supported in current browser",{layer:this.layer});return a?f.reject(a):f.resolve()};d.prototype._formatAttributeValue=function(b,a){if("string"===typeof b&&(a=(a=this._getFieldInfo(this.layer.popupTemplate&&
this.layer.popupTemplate.fieldInfos,a))&&a.format)){var c=void 0,d=void 0;return-1<b.trim().indexOf(",")?(c=",",this._formatDelimitedString(b,c,c+" ",a)):-1<b.trim().indexOf(" ")?(c=d=" ",this._formatDelimitedString(b,c,d,a)):this._formatNumberFromString(b,a)}return b};d.prototype._getFieldInfo=function(b,a){if(b&&b.length&&a){var c=a.toLowerCase(),d=void 0;b.some(function(a){return!a.fieldName||a.fieldName.toLowerCase()!==c&&a.fieldName.toLowerCase()!==c.replace(/ /g,"_")?!1:(d=a,!0)});return d}};
d.prototype._formatDelimitedString=function(b,a,c,d){var f=this;return b&&a&&c&&d?b.trim().split(a).map(function(a){return f._formatNumberFromString(a,d)}).join(c):b};d.prototype._formatNumberFromString=function(b,a){if(!b||!a)return b;var c=Number(b);return isNaN(c)?b:a.format(c)};q.__decorate([r.property()],d.prototype,"layer",void 0);q.__decorate([r.property()],d.prototype,"view",void 0);q.__decorate([r.property()],d.prototype,"fullExtent",void 0);q.__decorate([r.property()],d.prototype,"tileInfo",
void 0);q.__decorate([r.property({readOnly:!0,dependsOn:["layer.renderer"]})],d.prototype,"hasTilingEffects",null);return d=q.__decorate([r.subclass("esri.views.layers.ImageryTileLayerView")],d)}(c)}})},"esri/views/layers/support/popupUtils":function(){define("require exports tslib @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),function(E,e,q,t,v,n){Object.defineProperty(e,"__esModule",{value:!0});e.getFetchPopupTemplate=e.getRequiredFields=void 0;e.getRequiredFields=
function(f,e){void 0===e&&(e=f.popupTemplate);return q.__awaiter(this,void 0,void 0,function(){var k,m,r,c,d,h,b,a,g;return q.__generator(this,function(u){switch(u.label){case 0:return v.isSome(e)?[4,e.getRequiredFields(f.fields)]:[2,[]];case 1:return k=u.sent(),m=e.lastEditInfoEnabled,r=f.objectIdField,c=f.typeIdField,d=f.globalIdField,h=f.relationships,t.includes(k,"*")?[2,["*"]]:m?[4,n.getFeatureEditFields(f)]:[3,3];case 2:return a=u.sent(),[3,4];case 3:a=[],u.label=4;case 4:return b=a,g=n.fixFields(f.fields,
q.__spreadArrays(k,b)),c&&g.push(c),g&&r&&n.hasField(f.fields,r)&&-1===g.indexOf(r)&&g.push(r),g&&d&&n.hasField(f.fields,d)&&-1===g.indexOf(d)&&g.push(d),h&&h.forEach(function(a){a=a.keyField;g&&a&&n.hasField(f.fields,a)&&-1===g.indexOf(a)&&g.push(a)}),[2,g]}})})};e.getFetchPopupTemplate=function(f,e){return f.popupTemplate?f.popupTemplate:v.isSome(e)&&e.defaultPopupTemplateEnabled&&v.isSome(f.defaultPopupTemplate)?f.defaultPopupTemplate:null}})},"esri/views/support/drapedUtils":function(){define("require exports ../../geometry ../../core/maybe ../../core/unitUtils ../../renderers/support/clickToleranceUtils".split(" "),
function(E,e,q,t,v,n){function f(f,e,n,c){void 0===c&&(c=new q.Extent);var d;if("2d"===n.type)d=e*n.resolution;else if("3d"===n.type){var h=n.basemapTerrain,b=h.overlayManager,b=b?b.overlayPixelSizeInMapUnits(f):1;d=h&&!h.spatialReference.equals(n.spatialReference)?v.getMetersPerUnitForSR(h.spatialReference)/v.getMetersPerUnitForSR(n.spatialReference):e*b}e=f.x-d;h=f.y-d;b=f.x+d;f=f.y+d;n=n.spatialReference;c.xmin=Math.min(e,b);c.ymin=Math.min(h,f);c.xmax=Math.max(e,b);c.ymax=Math.max(h,f);c.spatialReference=
n;return c}Object.defineProperty(e,"__esModule",{value:!0});e.intersectsDrapedGeometry=e.createQueryGeometry=void 0;e.createQueryGeometry=f;e.intersectsDrapedGeometry=function(e,m,q){e=q.toMap(e);if(t.isNone(e))return null;var c=n.calculateTolerance();return f(e,c,q,r).intersects(m)?e:null};var r=new q.Extent})},"esri/renderers/support/clickToleranceUtils":function(){define(["require","exports"],function(E,e){function q(e,f){return f?"xoffset"in f&&f.xoffset?Math.max(e,Math.abs(f.xoffset)):"yoffset"in
f&&f.yoffset?Math.max(e,Math.abs(f.yoffset||0)):e:e}function t(e,f){if("number"===typeof e)return e;if(e&&e.stops&&e.stops.length){e=e.stops;for(var n=f=0,k=0;k<e.length;k++){var m=e[k].size;"number"===typeof m&&(f+=m,n++)}return f/n}return f}function v(e,f){if(!f)return e;f=f.filter(function(e){return"size"===e.type}).map(function(f){var c=f.minSize;return(t(f.maxSize,e)+t(c,e))/2});var n=0,k=f.length;if(0===k)return e;for(var m=0;m<k;m++)n+=f[m];return Math.max(Math.floor(n/k),e)}Object.defineProperty(e,
"__esModule",{value:!0});e.calculateTolerance=void 0;e.calculateTolerance=function(e){var f=e&&e.renderer;e="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!f)return e;e="visualVariables"in f?v(e,f.visualVariables):e;if("simple"===f.type)return q(e,f.symbol);if("unique-value"===f.type){var n=e;f.uniqueValueInfos.forEach(function(e){n=q(n,e.symbol)});return n}if("class-breaks"===f.type){var k=e;f.classBreakInfos.forEach(function(e){k=q(k,e.symbol)});return k}return e}})},"*noref":1}});
define("require exports tslib ../../../geometry ../../../Graphic ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/PixelBlock ../../../layers/support/TileInfo ../../../layers/support/rasterDatasets/RawBlockCache ../../../layers/support/rasterFunctions/pixelUtils ../../../layers/support/rasterFunctions/rasterProjectionHelper ../engine/RasterTileContainer ./LayerView2D ../tiling/TileInfoView ../tiling/TileQueue ../tiling/TileStrategy ../../layers/ImageryTileLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../support/drapedUtils".split(" "),function(E,
e,q,t,v,n,f,r,k,m,u,c,d,h,b,a,g,z,I,x,p,l,M,S,T,U){var L=f.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),w=[0,0];return function(e){function f(){var a=null!==e&&e.apply(this,arguments)||this;a._tileStrategy=null;a._tileInfoView=null;a._fetchQueue=null;a._blockCacheRegistryUrl=null;a._blockCacheRegistryId=null;a._bitmapView=null;a._emptyTilePixelBlock=null;a._srcResolutions=null;a._previousLOD=null;a._needBlockCacheUpdate=!1;a._globalSymbolizerParams=null;a._symbolizerParams=null;a._abortController=
null;a._globalUpdateRequested=!1;a.useWebGLForProcessing=!0;a.datumTransformation=null;a._redrawDebounced=k.debounce(function(b){return a._redrawImage(b)},2E3);return a}q.__extends(f,e);f.prototype.initialize=function(){var a=this.updateFullExtent();this.addResolvingPromise(a)};Object.defineProperty(f.prototype,"useProgressiveUpdate",{get:function(){return null==this._get("useProgressiveUpdate")?!0:this._get("useProgressiveUpdate")},set:function(a){var b=this;this._tileStrategy&&this.useProgressiveUpdate!==
a&&(this._tileStrategy.destroy(),this._bitmapView.removeAllChildren(),this._tileStrategy=new l({cachePolicy:a?"keep":"purge",resampling:!1,acquireTile:function(a){return b.acquireTile(a)},releaseTile:function(a){return b.releaseTile(a)},cacheSize:a?40:0,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",a),this.requestUpdate())},enumerable:!1,configurable:!0});f.prototype.hitTest=function(a,b){if(this.suspended)return k.resolve(null);a=this.view.toMap(m.createScreenPoint(a,b));return k.resolve(new v({attributes:{},
geometry:a}))};f.prototype.update=function(a){var c;this._fetchQueue.pause();this._fetchQueue.state=a.state;this._tileStrategy.update(a);this._fetchQueue.resume();var e=a.state,d=e.extent;a=e.resolution;e=this._tileInfoView.getClosestInfoForScale(e.scale);if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){var f=this._srcResolutions[e.level],d=d.toJSON?d:t.Extent.fromJSON(d);b.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,d,a,f,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=
!1;(null===(c=this._previousLOD)||void 0===c?void 0:c.level)!==e.level&&(this._previousLOD=e,null!=this._symbolizerParams&&this._updateSymbolizerParams())}this.notifyChange("updating")};f.prototype.attach=function(){var a=this;this.layer.increaseRasterJobHandlerUsage();n("esri-webgl-texture-float")&&n("esri-webgl-color-buffer-float")||(this.useWebGLForProcessing=!1);this.layer.raster&&(this.layer.raster.ioConfig.allowPartialFill=!0);this._initializeTileInfo();this._tileInfoView=new x(this.tileInfo,
this.fullExtent);this._fetchQueue=new p({tileInfoView:this._tileInfoView,concurrency:10,process:function(b,c){return a.fetchTile(b,c)}});this._tileStrategy=new l({cachePolicy:this.useProgressiveUpdate?"keep":"purge",resampling:!1,acquireTile:function(b){return a.acquireTile(b)},releaseTile:function(b){return a.releaseTile(b)},cacheSize:this.useProgressiveUpdate?40:0,tileInfoView:this._tileInfoView});this._bitmapView=new z.RasterTileContainer(this._tileInfoView);this.container.addChild(this._bitmapView);
this.handles.add([u.watch(this,["layer.bandIds","layer.renderer"],function(){return a._redrawDebounced().catch(function(a){k.isAbortError(a)||L.error(a)})}),u.watch(this,["layer.interpolation"],function(b,c){"majority"!==b&&"majority"!==c||!a._canUseMajorityInterpolationOnDataSource()?a._redrawDebounced().catch(function(a){k.isAbortError(a)||L.error(a)}):a.refreshDebounced()}),u.watch(this,["layer.multidimensionalDefinition"],this.refreshDebounced)],"attach");this._updateBlockCacheRegistry()};f.prototype.detach=
function(){this.handles.remove("attach");this.layer.decreaseRasterJobHandlerUsage();this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null;b.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId)};f.prototype.moveStart=function(){this.requestUpdate()};f.prototype.viewChange=function(){this.requestUpdate()};f.prototype.moveEnd=function(){var a=this;if(this.hasTilingEffects||!this.useProgressiveUpdate)this._abortController&&
this._abortController.abort(),this._abortController=k.createAbortController(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(function(){a._globalUpdateRequested=!1;a.requestUpdate()});this.requestUpdate()};f.prototype.createFetchPopupFeaturesQueryGeometry=function(a,b){return U.createQueryGeometry(a,b,this.view)};f.prototype.doRefresh=function(){return q.__awaiter(this,void 0,void 0,function(){var a=this;return q.__generator(this,function(b){if(this.updateRequested||
this.suspended)return[2];this._updateSymbolizerParams();this._updateBlockCacheRegistry();this._fetchQueue.reset();this._tileStrategy.tiles.forEach(function(b){return a._enqueueTileFetch(b)});this.notifyChange("updating");return[2]})})};f.prototype.isUpdating=function(){return 0<this._fetchQueue.length||this._globalUpdateRequested};f.prototype.acquireTile=function(a){var b;a=this._bitmapView.createTile(a);var c=a.bitmap;b=this._tileInfoView.getTileCoords(w,a.key);c.x=b[0];c.y=b[1];c.resolution=this._tileInfoView.getTileResolution(a.key);
b=this._tileInfoView.tileInfo.size;c.width=b[0];c.height=b[1];this._enqueueTileFetch(a);this.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate;return a};f.prototype.releaseTile=function(a){var b=this;this._fetchQueue.abort(a.key.id);this._bitmapView.removeChild(a);a.once("detach",function(){a.destroy();b.requestUpdate()});this.requestUpdate()};f.prototype.fetchTile=function(a,b){b=!r.isNone(b)&&b.signal;var c=this._canUseWebGLForProcessing();
b={tileInfo:this.tileInfo,signal:r.unwrap(b),registryId:this._blockCacheRegistryId,requestRawData:c,srcResolution:this._srcResolutions[a.level],datumTransformation:this.datumTransformation,interpolation:c?"nearest":this.layer.interpolation};return this.layer.fetchTile(a.level,a.row,a.col,b)};f.prototype._canUseWebGLForProcessing=function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())};
f.prototype._initializeTileInfo=function(){var a=this.view.spatialReference,b=new t.Point({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:a}),c=g.computeProjectedScales(this.layer.rasterInfo,a),e=c.srcResolutions,a=h.create({spatialReference:a,size:512,scales:c.scales});if(0===a.origin.x||a.origin.x>b.x)a.origin=b;this._set("tileInfo",a);this._srcResolutions=null!==e&&void 0!==e?e:[]};f.prototype._enqueueTileFetch=function(a,b){return q.__awaiter(this,void 0,void 0,function(){var b,
c,e,d,f,g,h,l,m,n=this;return q.__generator(this,function(p){switch(p.label){case 0:if(this._fetchQueue.has(a.key.id))return[2];p.label=1;case 1:return p.trys.push([1,13,,14]),[4,this._fetchQueue.push(a.key)];case 2:b=p.sent();c=this.layer.bandIds;e=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams;if(!this._globalUpdateRequested||this.moving||0!==this._fetchQueue.length)return[3,7];e=!1;p.label=3;case 3:return p.trys.push([3,5,,6]),[4,this._redrawImage(this._abortController&&
this._abortController.signal)];case 4:return p.sent(),[3,6];case 5:return d=p.sent(),k.isAbortError(d)&&L.error(d),[3,6];case 6:this._globalUpdateRequested=!1,p.label=7;case 7:(f=this._canUseWebGLForProcessing())&&!this.hasTilingEffects&&null==this._symbolizerParams&&this._updateSymbolizerParams();if(!b||!b.pixelBlock)return[3,11];if(f)return[3,9];g={extent:b.extent,pixelBlock:b.pixelBlock};return[4,this.layer.applyRenderer(g,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?
this._globalSymbolizerParams:null)];case 8:return h=p.sent(),a.bitmap.rawPixelData=g,a.bitmap.source=h,[3,10];case 9:a.bitmap.source=b.pixelBlock,p.label=10;case 10:return a.bitmap.symbolizerParameters=f?this._globalSymbolizerParams||this._symbolizerParams:null,a.bitmap.transformGrid=!a.bitmap.transformGrid&&f?b.transformGrid:null,[3,12];case 11:l=this._createEmptyTilePixelBlock(),a.bitmap.source=l,a.bitmap.symbolizerParameters=f?this._symbolizerParams:null,a.bitmap.transformGrid=null,p.label=12;
case 12:return a.bitmap.bandIds=c,a.bitmap.width=this._tileInfoView.tileInfo.size[0],a.bitmap.height=this._tileInfoView.tileInfo.size[1],a.bitmap.interpolation=this._getLayerInterpolation(),a.bitmap.suspended=e,a.bitmap.invalidateTexture(),a.once("attach",function(){return n.requestUpdate()}),this._bitmapView.addChild(a),[3,14];case 13:return m=p.sent(),k.isAbortError(m)||L.error(m),[3,14];case 14:return this.requestUpdate(),[2]}})})};f.prototype._redrawImage=function(a){return q.__awaiter(this,void 0,
void 0,function(){var b,c,e=this;return q.__generator(this,function(d){switch(d.label){case 0:return this.layer.updateRenderer(),this.hasTilingEffects?[4,this._updateGlobalSymbolizerParams(a)]:[3,2];case 1:return d.sent(),[3,3];case 2:this._updateSymbolizerParams(),this._globalSymbolizerParams=null,d.label=3;case 3:return b=this.layer.bandIds,c=this._bitmapView.children.map(function(a){return q.__awaiter(e,void 0,void 0,function(){var c,e;return q.__generator(this,function(d){switch(d.label){case 0:if(c=
this._canUseWebGLForProcessing())return[3,2];e=a.bitmap;return[4,this.layer.applyRenderer(a.bitmap.rawPixelData,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null)];case 1:e.source=d.sent(),d.label=2;case 2:return a.bitmap.symbolizerParameters=c?this._globalSymbolizerParams||this._symbolizerParams:null,a.bitmap.bandIds=b,a.bitmap.interpolation=this._getLayerInterpolation(),a.bitmap.suspended=!1,[2]}})})}),[4,k.eachAlways(c)];
case 4:return d.sent(),this.container.requestRender(),[2]}})})};f.prototype._createEmptyTilePixelBlock=function(){if(!this._emptyTilePixelBlock){var a=this._tileInfoView.tileInfo.size[0],b=this._tileInfoView.tileInfo.size[1];this._emptyTilePixelBlock=new d({width:a,height:b,pixels:[new Uint8Array(a*b)],mask:new Uint8Array(a*b),pixelType:"u8"})}return this._emptyTilePixelBlock};f.prototype._updateGlobalSymbolizerParams=function(b){return q.__awaiter(this,void 0,void 0,function(){var c,e,d;return q.__generator(this,
function(f){switch(f.label){case 0:return c={srcResolution:this._srcResolutions[this._previousLOD.level],registryId:this._blockCacheRegistryId,signal:b},[4,this.layer.fetchPixels(this.view.extent,this.view.width,this.view.height,c)];case 1:e=f.sent();if(!e||!e.pixelBlock)return[2];d=this.layer.symbolizer.generateWebGLParameters({pixelBlock:a.extractBands(e.pixelBlock,this.layer.bandIds),isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},
bandIds:this.layer.bandIds});!this._canUseWebGLForProcessing()&&d&&"stretch"===d.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(d.factor=d.factor.map(function(a){return 255*a}),d.outMin=Math.round(255*d.outMin),d.outMax=Math.round(255*d.outMax));this._globalSymbolizerParams=d;return[2]}})})};f.prototype._updateSymbolizerParams=function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,
y:this._previousLOD.resolution},bandIds:this.layer.bandIds})};f.prototype._updateBlockCacheRegistry=function(){var a=this.layer,c=a.url,d=a.rasterInfo,e=a.multidimensionalDefinition,a=a.raster,d=(null===d||void 0===d?0:d.multidimensionalInfo)?a.getSliceIndex(e):null,c=b.getRasterId(c,d);c!==this._blockCacheRegistryUrl&&(null==this._blockCacheRegistryUrl&&b.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=b.register(c,this.layer.raster.rasterInfo),this._blockCacheRegistryUrl=
c)};f.prototype._canUseMajorityInterpolationOnDataSource=function(){var a=this.layer.rasterInfo,b=a.attributeTable,c=a.colormap,d=a.pixelType;return 1===a.bandCount&&(null!=b||null!=c||"u8"===d||"s8"===d)};f.prototype._getLayerInterpolation=function(){var a=this.layer.renderer.type;return"raster-colormap"===a||"unique-value"===a||"class-breaks"===a?"nearest":this.layer.interpolation};q.__decorate([c.property()],f.prototype,"useProgressiveUpdate",null);return f=q.__decorate([c.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],
f)}(M.ImageryTileLayerView(T.RefreshableLayerView(I.LayerView2DMixin(S))))});