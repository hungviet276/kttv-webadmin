// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/maybe","./TextRenderParameters"],function(p,g,r,t){function q(b,a,e){b.canvas||(b.canvas=document.createElement("canvas"));b.canvas.width=a;b.canvas.height=e;return b.canvas}Object.defineProperty(g,"__esModule",{value:!0});g.getTextHelperCanvas=g.TextRenderer=void 0;p=function(){function b(a,e,c){void 0===c&&(c=2048);this.text=a;this.maxSize=c;this._displayWidth=this._renderPixelRatio=null;this.parameters=e instanceof t.default?e:new t.default(e);this.key=
this.parameters.key+"--"+a;this.textLines=a.split(/\r?\n/);this.lineHeight=this.computeLineHeight()}Object.defineProperty(b.prototype,"displayWidth",{get:function(){r.isNone(this._displayWidth)&&(this._displayWidth=this.computeTextWidth());return this._displayWidth},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"displayHeight",{get:function(){return this.lineHeight*this.textLines.length},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"renderedWidth",{get:function(){return Math.round(this.displayWidth*
this.renderPixelRatio)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"renderedHeight",{get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"renderedLineHeight",{get:function(){return Math.round(this.lineHeight*this.renderPixelRatio)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"renderedFontSize",{get:function(){return this.parameters.definition.size*this.renderPixelRatio},
enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"renderedHaloSize",{get:function(){return this.parameters.haloSize*this.renderPixelRatio},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"renderPixelRatio",{get:function(){if(r.isNone(this._renderPixelRatio)){var a=this.parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(a,Math.min(this.maxSize/(this.displayWidth*a),this.maxSize/(this.displayHeight*a))):a}return this._renderPixelRatio},
enumerable:!1,configurable:!0});b.prototype.render=function(a,e,c){void 0===e&&(e=0);void 0===c&&(c=0);var b=this.renderedLineHeight,h=this.renderedHaloSize,d=a.textAlign,f=this.renderedWidth,d=("center"===d?.5*f:"right"===d?f:0)+h,f=h+u;a.save();0<h&&this.renderHalo(a,d,f,e,c);this.setFontProperties(a,this.renderedFontSize);c+=f;e+=d;h=0;for(d=this.textLines;h<d.length;h++)f=d[h],a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",a.fillText(f,e,c),a.globalCompositeOperation=
"source-over",a.fillStyle=this.parameters.fillStyle,a.fillText(f,e,c),c+=b;a.restore()};b.prototype.renderHalo=function(a,e,c,b,h){var d=this.renderedWidth,f=this.renderedHeight,g=q(v,Math.max(d,m),Math.max(f,m)),k=g.getContext("2d");k.clearRect(0,0,d,f);this.setFontProperties(k,this.renderedFontSize);k.fillStyle=this.parameters.haloStyle;k.strokeStyle=this.parameters.haloStyle;var l=3>this.renderedHaloSize;k.lineJoin=l?"miter":"round";l?this.renderHaloEmulated(k,e,c):this.renderHaloNative(k,e,c);
a.globalAlpha=this.parameters.definition.halo.color[3];a.drawImage(g,0,0,d,f,b,h,d,f);a.globalAlpha=1};b.prototype.renderHaloEmulated=function(a,e,c){for(var b=this.renderedLineHeight,h=this.renderedHaloSize,d=0,f=this.textLines;d<f.length;d++){for(var g=f[d],k=0,l=w;k<l.length;k++){var m=l[k];a.fillText(g,e+h*m[0],c+h*m[1])}c+=b}};b.prototype.renderHaloNative=function(a,b,c){for(var e=this.renderedLineHeight,h=this.renderedHaloSize,d=0,f=this.textLines;d<f.length;d++){for(var g=f[d],k=2*h,l=0;5>
l;l++)a.lineWidth=(.6+.1*l)*k,a.strokeText(g,b,c);c+=e}};b.prototype.setFontProperties=function(a,b){var c=this.parameters.definition.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family+", sans-serif";a.textAlign="left";a.textBaseline="top"};b.prototype.computeTextWidth=function(){var a=q(v,m,m).getContext("2d");this.setFontProperties(a,this.parameters.definition.size);for(var b=0,c=0,g=this.textLines;c<g.length;c++)b=Math.max(b,a.measureText(g[c]).width);c=this.parameters.definition.font;if("italic"===
c.style||"oblique"===c.style||"string"===typeof c.weight&&("bold"===c.weight||"bolder"===c.weight)||"number"===typeof c.weight&&600<c.weight)b+=.3*a.measureText("A").width;b+=2*this.parameters.haloSize;return Math.round(b)};b.prototype.computeLineHeight=function(){return Math.ceil(1.275*this.parameters.definition.size+2*this.parameters.haloSize)+u};return b}();g.TextRenderer=p;for(var u=1,w=[],n=0;360>n;n+=22.5)w.push([Math.cos(Math.PI*n/180),Math.sin(Math.PI*n/180)]);g.getTextHelperCanvas=q;var v=
{canvas:null},m=512;g.default=p});