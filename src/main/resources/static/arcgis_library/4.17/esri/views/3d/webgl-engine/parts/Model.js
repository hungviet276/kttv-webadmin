// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../support/mathUtils ../lib/localOrigin ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(h,g,l,m,n,p,k){Object.defineProperty(g,"__esModule",{value:!0});g.Model=void 0;var f=k.assert,q=k.logWithBase;h=function(){function d(){this.dirtySet=new n(this);this._id2origin={};this._content=Array(5);for(var a=0;5>a;++a)this._content[a]=new Map}d.prototype.getAll=function(a){a=this._content[a];f(void 0!==a);return a};d.prototype.get=function(a,b){return this.getAll(a).get(b)};
d.prototype.add=function(a,b){var c=this._content[a];f(void 0!==c);var e=b.id;f(!c.has(e),"Model/Stage already contains object to be added");c.set(e,b);0===a&&this.notifyDirty(b,"layerAdded")};d.prototype.remove=function(a,b){var c=this._content[a];f(void 0!==c);var e=c.get(b);f(void 0!==e,"Model/Stage doesn't contain object to be removed");c.delete(b);4===a&&e.unload();0===a&&this.notifyDirty(e,"layerRemoved");return e};d.prototype.getDirtySet=function(){return this.dirtySet};d.prototype.notifyDirty=
function(a,b,c){this.dirtySet.handleUpdate(a,b,c)};d.prototype.getOrigin=function(a,b,c){void 0===c&&(c=10);var e=0;b=b*c/1E4;1<b&&(e=Math.ceil(q(b,2)));b=1E4*Math.pow(2,e);c=Math.round(a[0]/b);var d=Math.round(a[1]/b);a=Math.round(a[2]/b);var e=e+"_"+c+"_"+d+"_"+a,f=this._id2origin[e];null==f&&(f=m.fromValues(c*b,d*b,a*b,e),this._id2origin[e]=f);return f};d.prototype.getGeometryRenderGeometries=function(a,b,c){var e=b.geometry,d=a.getCombinedStaticTransformation(b),f=l.maxScale(d),g=b.origin;a=new p(e.data,
e.boundingInfo,b.material,d,b.shaderTransformation,f,a.castShadow);a.uniqueName=b.id;a.origin=g||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=b.instanceParameters;c.push(a)};d.prototype.updateRenderGeometryTransformation=function(a,b,c){a=a.getCombinedStaticTransformation(b,c.transformation);c.updateTransformation(a);a=this.getOrigin(c.center,c.bsRadius);return c.origin!==a};d.prototype.getStats=function(){for(var a={},b=0;5>b;++b)a[b]=this.getAll(b).size;return{contentTypes:a,dirtySet:this.dirtySet.formatDebugInfo()}};
d.prototype.validateObject=function(a){a=a.geometryRecords;for(var b=0;b<a.length;++b){var c=a[b];f(null!=this.get(2,c.geometry.id));f(null!=this.get(3,c.material.id))}};d.prototype.validateLayer=function(a){a=a.getObjects();for(var b=0;b<a.length;++b){var c=this.get(1,a[b].id);f(null!=c)}};return d}();g.Model=h});