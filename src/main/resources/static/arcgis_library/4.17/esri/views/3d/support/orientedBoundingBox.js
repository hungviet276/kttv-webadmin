// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/quatf64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ./dito ./geometryUtils".split(" "),function(y,d,w,C,t,z,D,k,
A,u,E,F,G,H,q){function x(a,c,b){void 0===a&&(a=[0,0,0]);void 0===c&&(c=[-1,-1,-1]);void 0===b&&(b=[0,0,0,1]);return{center:u.vec3f64.clone(a),halfSize:A.vec3f32.clone(c),quaternion:z.quatf32.clone(b)}}function m(a,c){var b=q.plane.signedDistance(c,a.center);a=v(a,q.plane.normal(c));return b>a?1:b<-a?-1:0}function v(a,c){t.quat.conjugate(n,a.quaternion);k.vec3.transformQuat(e,c,n);a=a.halfSize;return Math.abs(e[0]*a[0])+Math.abs(e[1]*a[1])+Math.abs(e[2]*a[2])}Object.defineProperty(d,"__esModule",
{value:!0});d.corners=d.projectedRadius=d.projectedArea=d.intersectLine=d.isVisible=d.maximumDistancePlane=d.minimumDistancePlane=d.toAaBoundingBox=d.intersectPlane=d.compute=d.set=d.clone=d.create=d.ObbArray=void 0;var n=D.quatf64.create(),e=u.vec3f64.create(),I=u.vec3f64.create(),p=F.vec4f64.create(),r=C.mat3f64.create();y=function(){return function(a){this.buffer=new ArrayBuffer(56*a);this.obbs=Array(a);for(var c=0;c<a;c++)this.obbs[c]={center:u.vec3f64.createView(this.buffer,56*c+0),halfSize:A.vec3f32.createView(this.buffer,
56*c+24),quaternion:z.quatf32.createView(this.buffer,56*c+36)}}}();d.ObbArray=y;d.create=x;d.clone=function(a){return x(a.center,a.halfSize,a.quaternion)};d.set=function(a,c){k.vec3.copy(c.center,a.center);k.vec3.copy(c.halfSize,a.halfSize);t.quat.copy(c.quaternion,a.quaternion)};d.compute=function(a,c){c=c||x();H.computeOBB(a,c);return c};d.intersectPlane=m;d.toAaBoundingBox=function(a,c){c||(c=G.create());var b=w.mat3.fromQuat(r,a.quaternion),d=a.halfSize[0]*Math.abs(b[0])+a.halfSize[1]*Math.abs(b[3])+
a.halfSize[2]*Math.abs(b[6]),e=a.halfSize[0]*Math.abs(b[1])+a.halfSize[1]*Math.abs(b[4])+a.halfSize[2]*Math.abs(b[7]),b=a.halfSize[0]*Math.abs(b[2])+a.halfSize[1]*Math.abs(b[5])+a.halfSize[2]*Math.abs(b[8]);c[0]=a.center[0]-d;c[1]=a.center[1]-e;c[2]=a.center[2]-b;c[3]=a.center[0]+d;c[4]=a.center[1]+e;c[5]=a.center[2]+b;return c};d.minimumDistancePlane=function(a,c){var b=q.plane.signedDistance(c,a.center);a=v(a,q.plane.normal(c));return b-a};d.maximumDistancePlane=function(a,c){var b=q.plane.signedDistance(c,
a.center);a=v(a,q.plane.normal(c));return b+a};d.isVisible=function(a,c){return 0>=m(a,c.planes[0])&&0>=m(a,c.planes[1])&&0>=m(a,c.planes[2])&&0>=m(a,c.planes[3])&&0>=m(a,c.planes[4])&&0>=m(a,c.planes[5])};d.intersectLine=function(a,c,b,d){void 0===d&&(d=0);t.quat.conjugate(n,a.quaternion);k.vec3.subtract(e,c,a.center);c=k.vec3.transformQuat(e,e,n);b=k.vec3.transformQuat(I,b,n);for(var l=-Infinity,f=Infinity,g=0;3>g;g++)if(1E-6<Math.abs(b[g]))var B=(d+a.halfSize[g]-c[g])/b[g],h=(-d-a.halfSize[g]-
c[g])/b[g],l=Math.max(l,Math.min(B,h)),f=Math.min(f,Math.max(B,h));else if(c[g]>a.halfSize[g]+d||c[g]<-a.halfSize[g]-d)return!1;return l<=f};d.projectedArea=function(a,c,b,d,m){t.quat.conjugate(n,a.quaternion);k.vec3.sub(e,c,a.center);k.vec3.transformQuat(e,e,n);var f=e[0]<-a.halfSize[0]?-1:e[0]>a.halfSize[0]?1:0,g=e[1]<-a.halfSize[1]?-1:e[1]>a.halfSize[1]?1:0,l=e[2]<-a.halfSize[2]?-1:e[2]>a.halfSize[2]?1:0;c=Math.abs(f)+Math.abs(g)+Math.abs(l);if(0===c)return Infinity;c=1===c?4:6;g=6*(f+3*g+9*l+
13);w.mat3.fromQuat(r,a.quaternion);w.mat3.scale(r,r,a.halfSize);for(f=0;f<c;f++)l=J[g+f],k.vec3.set(e,((l&1)<<1)-1,(l&2)-1,((l&4)>>1)-1),k.vec3.transformMat3(e,e,r),k.vec3.add(p,a.center,e),p[3]=1,E.vec4.transformMat4(p,p,b),l=1/Math.max(1E-6,p[3]),h[2*f]=p[0]*l,h[2*f+1]=p[1]*l;a=2*c-2;b=h[0]*(h[3]-h[a+1])+h[a]*(h[1]-h[a-1]);for(f=2;f<a;f+=2)b+=h[f]*(h[f+3]-h[f-1]);return Math.abs(b)*d*m*.125};var h=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],J=function(){var a=new Int8Array(162),c=0,b=function(b){for(var d=
0;d<b.length;d++)a[c+d]=b[d];c+=6};b([6,2,3,1,5,4]);b([0,2,3,1,5,4]);b([0,2,3,7,5,4]);b([0,1,3,2,6,4]);b([0,1,3,2,0,0]);b([0,1,5,7,3,2]);b([0,1,3,7,6,4]);b([0,1,3,7,6,2]);b([0,1,5,7,6,2]);b([0,1,5,4,6,2]);b([0,1,5,4,0,0]);b([0,1,3,7,5,4]);b([0,2,6,4,0,0]);b([0,0,0,0,0,0]);b([1,3,7,5,0,0]);b([2,3,7,6,4,0]);b([2,3,7,6,0,0]);b([2,3,1,5,7,6]);b([0,1,5,7,6,2]);b([0,1,5,7,6,4]);b([0,1,3,7,6,4]);b([4,5,7,6,2,0]);b([4,5,7,6,0,0]);b([4,5,1,3,7,6]);b([0,2,3,7,5,4]);b([6,2,3,7,5,4]);b([6,2,3,1,5,4]);return a}();
d.projectedRadius=v;d.corners=function(a,c){for(var b=0;8>b;++b){var d=c[b];d[0]=b&1?-a.halfSize[0]:a.halfSize[0];d[1]=b&2?-a.halfSize[1]:a.halfSize[1];d[2]=b&4?-a.halfSize[2]:a.halfSize[2];k.vec3.transformQuat(d,d,a.quaternion);k.vec3.add(d,d,a.center)}}});