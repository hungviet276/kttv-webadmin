// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack ./lineSegment ./plane ./ray ./vector".split(" "),function(H,b,T,U,V,A,q,I,e,k,W,l,r,g,X,t){function u(a){void 0===a&&(a=b.UP);return{plane:g.create(a.plane),origin:k.vec3f64.clone(a.origin),
basis1:k.vec3f64.clone(a.basis1),basis2:k.vec3f64.clone(a.basis2)}}function v(a,c){void 0===c&&(c=u());return J(a.origin,a.basis1,a.basis2,c)}function J(a,c,d,f){void 0===f&&(f=u());e.vec3.copy(f.origin,a);e.vec3.copy(f.basis1,c);e.vec3.copy(f.basis2,d);w(f);a=f;1E-6<Math.abs(e.vec3.dot(a.basis1,a.basis2)/(e.vec3.length(a.basis1)*e.vec3.length(a.basis2)))&&B.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(e.vec3.dot(a.basis1,h(a)))&&B.warn("fromValues()","Basis vectors and plane normal are not perpendicular");
1E-6<Math.abs(-e.vec3.dot(h(a),a.origin)-a.plane[3])&&B.warn("fromValues()","Plane offset is not consistent with plane origin");return f}function w(a){g.fromVectorsAndPoint(a.basis2,a.basis1,a.origin,a.plane)}function K(a,c,d){a!==d&&v(a,d);a=e.vec3.scale(l.sv3d.get(),h(a),c);e.vec3.add(d.origin,d.origin,a);d.plane[3]-=c;return d}function L(a,c){void 0===c&&(c=u());var d=(a[2]-a[0])/2,f=(a[3]-a[1])/2;e.vec3.set(c.origin,a[0]+d,a[1]+f,0);e.vec3.set(c.basis1,d,0,0);e.vec3.set(c.basis2,0,f,0);g.fromValues(0,
0,1,0,c.plane);return c}function C(a,c,d){return g.intersectRay(a.plane,c,d)?M(a,d):!1}function N(a,c,d){var f=x.get(),b=x.get();O(a,c,f,b);for(var b=Number.POSITIVE_INFINITY,m=0,k=D;m<k.length;m++){var h=E(a,k[m],y.get()),p=l.sv3d.get();g.intersectLineSegment(f,h,p)&&(h=W.directionFromTo(l.sv3d.get(),c.origin,p),h=Math.abs(V.acosClamped(e.vec3.dot(c.direction,h))),h<b&&(b=h,e.vec3.copy(d,p)))}return b===Number.POSITIVE_INFINITY?P(a,c,d):d}function P(a,c,d){if(C(a,c,d))return d;var f=x.get(),b=x.get();
O(a,c,f,b);for(var m=Number.POSITIVE_INFINITY,h=0,k=D;h<k.length;h++){var p=E(a,k[h],y.get()),n=l.sv3d.get();g.intersectLineSegmentClamp(f,p,n)&&(p=X.distance2(c,n),g.isPointInside(b,n)&&p<m&&(m=p,e.vec3.copy(d,n)))}F(a,c.origin)<m&&Q(a,c.origin,d);return d}function Q(a,c,d){var b=g.projectPoint(a.plane,c,l.sv3d.get());c=r.projectPointClamp(R(a,a.basis1),b,-1,1,l.sv3d.get());b=r.projectPointClamp(R(a,a.basis2),b,-1,1,l.sv3d.get());e.vec3.subtract(d,e.vec3.add(l.sv3d.get(),c,b),a.origin);return d}
function S(a,c,d){var b=a.origin,g=a.basis1,m=a.basis2;c=e.vec3.subtract(l.sv3d.get(),c,b);g=t.projectPointSignedLength(g,c);m=t.projectPointSignedLength(m,c);a=t.projectPointSignedLength(h(a),c);return e.vec3.set(d,g,m,a)}function F(a,c){c=S(a,c,l.sv3d.get());var d=a.basis2;a=e.vec3.length(a.basis1);d=e.vec3.length(d);a=Math.max(Math.abs(c[0])-a,0);d=Math.max(Math.abs(c[1])-d,0);c=c[2];return a*a+d*d+c*c}function G(a,c){var d=-a.plane[3];return t.projectPointSignedLength(h(a),c)-d}function h(a){return g.normal(a.plane)}
function M(a,c){var d=e.vec3.subtract(l.sv3d.get(),c,a.origin);c=e.vec3.squaredLength(a.basis1);var b=e.vec3.squaredLength(a.basis2),g=e.vec3.dot(a.basis1,d);a=e.vec3.dot(a.basis2,d);return 0>-g-c&&0>g-c&&0>-a-b&&0>a-b}function R(a,c){var d=y.get();e.vec3.copy(d.origin,a.origin);e.vec3.copy(d.vector,c);return d}function E(a,c,d){var b=a.basis1,g=a.basis2;a=a.origin;var h=e.vec3.scale(l.sv3d.get(),b,c.origin[0]),k=e.vec3.scale(l.sv3d.get(),g,c.origin[1]);e.vec3.add(d.origin,h,k);e.vec3.add(d.origin,
d.origin,a);b=e.vec3.scale(l.sv3d.get(),b,c.direction[0]);c=e.vec3.scale(l.sv3d.get(),g,c.direction[1]);e.vec3.scale(d.vector,e.vec3.add(b,b,c),2);return d}function O(a,c,d,b){a=h(a);g.fromVectorsAndPoint(a,c.direction,c.origin,d);g.fromVectorsAndPoint(g.normal(d),a,c.origin,b)}Object.defineProperty(b,"__esModule",{value:!0});b.UP=b.normal=b.rotate=b.transform=b.equals=b.setAltitudeAt=b.altitudeAt=b.axisAt=b.extrusionContainsPoint=b.distanceToSilhouette=b.distance=b.distance2=b.projectPointLocal=
b.projectPoint=b.closestPoint=b.closestPointOnSilhouette=b.intersectRayClosestSilhouette=b.intersectRay=b.fromAABoundingRect=b.setExtent=b.elevate=b.updateUnboundedPlane=b.fromValues=b.copy=b.wrap=b.create=b.BoundedPlaneClass=void 0;var B=U.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");H=function(){return function(){this.plane=g.create();this.origin=k.vec3f64.create();this.basis1=k.vec3f64.create();this.basis2=k.vec3f64.create()}}();b.BoundedPlaneClass=H;b.create=u;b.wrap=function(a,
c,d){var b=Y.get();b.origin=a;b.basis1=c;b.basis2=d;b.plane=g.wrap(0,0,0,0);w(b);return b};b.copy=v;b.fromValues=J;b.updateUnboundedPlane=w;b.elevate=K;b.setExtent=function(a,c,b){L(c,b);K(b,G(a,a.origin),b);return b};b.fromAABoundingRect=L;b.intersectRay=C;b.intersectRayClosestSilhouette=function(a,c,b){if(C(a,c,b))return b;a=N(a,c,l.sv3d.get());e.vec3.add(b,c.origin,e.vec3.scale(l.sv3d.get(),c.direction,e.vec3.distance(c.origin,a)/e.vec3.length(c.direction)));return b};b.closestPointOnSilhouette=
N;b.closestPoint=P;b.projectPoint=Q;b.projectPointLocal=S;b.distance2=F;b.distance=function(a,b){return Math.sqrt(F(a,b))};b.distanceToSilhouette=function(a,b){for(var c=Number.NEGATIVE_INFINITY,e=0,g=D;e<g.length;e++){var h=E(a,g[e],y.get()),h=r.distance2(h,b);h>c&&(c=h)}return Math.sqrt(c)};b.extrusionContainsPoint=function(a,b){return g.isPointInside(a.plane,b)&&M(a,b)};b.axisAt=function(a,b,d,f){switch(d){case 0:e.vec3.copy(f,a.basis1);e.vec3.normalize(f,f);break;case 1:e.vec3.copy(f,a.basis2);
e.vec3.normalize(f,f);break;case 2:e.vec3.copy(f,h(a));break;default:T.neverReached(d)}return f};b.altitudeAt=G;b.setAltitudeAt=function(a,b,d,f){var c=G(a,b);a=e.vec3.scale(Z,h(a),d-c);e.vec3.add(f,b,a);return f};b.equals=function(a,b){return e.vec3.exactEquals(a.basis1,b.basis1)&&e.vec3.exactEquals(a.basis2,b.basis2)&&e.vec3.exactEquals(a.origin,b.origin)};b.transform=function(a,b,d){a!==d&&v(a,d);q.mat4.invert(n,b);q.mat4.transpose(n,n);e.vec3.transformMat4(d.basis1,a.basis1,n);e.vec3.transformMat4(d.basis2,
a.basis2,n);e.vec3.transformMat4(g.normal(d.plane),g.normal(a.plane),n);e.vec3.transformMat4(d.origin,a.origin,b);g.setOffsetFromPoint(d.plane,d.origin,d.plane);return d};b.rotate=function(a,b,d,f){a!==f&&v(a,f);q.mat4.rotate(z,q.mat4.identity(z),b,d);e.vec3.transformMat4(f.basis1,a.basis1,z);e.vec3.transformMat4(f.basis2,a.basis2,z);w(f);return f};b.normal=h;b.UP={plane:g.create(),origin:k.vec3f64.fromValues(0,0,0),basis1:k.vec3f64.fromValues(1,0,0),basis2:k.vec3f64.fromValues(0,1,0)};var x=new A.ObjectStack(g.create),
y=new A.ObjectStack(r.create),Z=k.vec3f64.create(),Y=new A.ObjectStack(function(){return{origin:null,basis1:null,basis2:null,plane:null}}),D=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],n=I.mat4f64.create(),z=I.mat4f64.create()});