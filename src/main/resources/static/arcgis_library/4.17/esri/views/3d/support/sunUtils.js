// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../lib/SunCalc".split(" "),function(P,m,y,r,L,u,w,v){function l(g,e,k,h){for(var a=[],c=0;c<k.length;c++)a[c]=(h[c]-k[c])*g/e+k[c];return a}Object.defineProperty(m,"__esModule",{value:!0});m.computeShadowsEnabled=m.computeDirection=m.computeColorAndIntensity=m.settings=void 0;m.settings={local:{altitude:1500,
ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};m.computeColorAndIntensity=function(g,e){var k,h,a,c,d=e[2],n=M;u.vec3.set(n.ambient.color,1,1,1);n.ambient.intensity=m.settings.global.ambient;u.vec3.set(n.diffuse.color,1,1,1);n.diffuse.intensity=m.settings.global.diffuse;d=(Math.abs(d)-m.settings.local.altitude)/
(m.settings.global.altitude-m.settings.local.altitude);d=y.clamp(d,0,1);n.globalFactor=d;e=v.getTimes(g,e[1],e[0]);if(1>d){a=g.valueOf();var p,f;e.polarException===v.POLAR_EXCEPTION.MIDNIGHT_SUN?(p=a-36E5*(g.getHours()+48)-6E4*g.getMinutes(),f=p+432E6):e.polarException===v.POLAR_EXCEPTION.POLAR_NIGHT?(p=a-2,f=a-1):(p=e.sunrise.valueOf(),f=e.sunset.valueOf());var t=f-p;c=p+t/2;h=t/4;k=c-h;h=c+h;var b=.06*t,t=p-b/2;p+=b/2;var x=f-b/2,r=f+b/2;f=m.settings.local;var F=[.01,f.ambientAtNight],G=[.8,.8,
1],H=[.01,.01,.01],z=[f.diffuseAtTwilight,f.ambientAtTwilight],A=[1,.75,.75],B=[.8,.8,1],C=[.9*f.diffuseAtNoon,f.ambientAtNoon],D=[1,.98,.98],E=[.98,.98,1],I=[f.diffuseAtNoon,f.ambientAtNoon],J=[1,1,1],K=[1,1,1];f=[0,0];var q=[0,0,0],b=[0,0,0];a<t||a>r?(f=F,q=H,b=G):a<p?(b=p-t,f=l(a-t,b,F,z),q=l(a-t,b,H,A),b=l(a-t,b,G,B)):a<k?(b=k-p,f=l(a-p,b,z,C),q=l(a-p,b,A,D),b=l(a-p,b,B,E)):a<c?(b=c-k,f=l(a-k,b,C,I),q=l(a-k,b,D,J),b=l(a-k,b,E,K)):a<h?(b=h-c,f=l(a-c,b,I,C),q=l(a-c,b,J,D),b=l(a-c,b,K,E)):a<x?(b=
x-h,f=l(a-h,b,C,z),q=l(a-h,b,D,A),b=l(a-h,b,E,B)):a<r&&(b=r-x,f=l(a-x,b,z,F),q=l(a-x,b,A,H),b=l(a-x,b,B,G));a=f[0];c=w.vec3f64.fromValues(q[0],q[1],q[2]);k=f[1];h=w.vec3f64.fromValues(b[0],b[1],b[2]);u.vec3.lerp(n.ambient.color,h,n.ambient.color,d);n.ambient.intensity=y.lerp(k,n.ambient.intensity,d);u.vec3.lerp(n.diffuse.color,c,n.diffuse.color,d);n.diffuse.intensity=y.lerp(a,n.diffuse.intensity,d)}d=g.valueOf();e.polarException===v.POLAR_EXCEPTION.MIDNIGHT_SUN?(g=d-36E5*(g.getHours()+48)-6E4*g.getMinutes(),
e=g+432E6):e.polarException===v.POLAR_EXCEPTION.POLAR_NIGHT?(g=d-2,e=d-1):(g=e.sunrise.valueOf(),e=e.sunset.valueOf());g=1-y.clamp(Math.abs(d-(g+(e-g)/2))/432E5,0,1);n.noonFactor=g;return n};m.computeDirection=function(g,e,k,h){h||(h=w.vec3f64.create());var a=N,c=r.mat4.identity(O);if("global"===k)v.getPosition(g,0,0,a),u.vec3.set(h,0,0,-1),r.mat4.rotateX(c,c,-a.azimuth),r.mat4.rotateY(c,c,-a.altitude);else{var d=m.settings.planarDirection;k=d.globalAngles;d=(Math.abs(e[2])-d.localAltitude)/(d.globalAltitude-
d.localAltitude);d=y.clamp(d,0,1);1>d?(v.getPosition(g,e[1],e[0],a),a.azimuth=(1-d)*a.azimuth+d*k.azimuth,a.altitude=(1-d)*a.altitude+d*k.altitude):(a.azimuth=k.azimuth,a.altitude=k.altitude);u.vec3.set(h,0,-1,0);r.mat4.rotateZ(c,c,-a.azimuth);r.mat4.rotateX(c,c,-a.altitude)}u.vec3.transformMat4(h,h,c);return h};m.computeShadowsEnabled=function(g,e){return"global"===e?!0:Math.abs(g[2])<m.settings.planarDirection.localAltitude};var O=L.mat4f64.create(),N={azimuth:0,altitude:0},M={ambient:{color:w.vec3f64.create(),
intensity:0},diffuse:{color:w.vec3f64.create(),intensity:0,direction:w.vec3f64.create()},globalFactor:0,noonFactor:0}});