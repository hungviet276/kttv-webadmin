// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),function(l,c,d,n,p,q,f,m,k,r){Object.defineProperty(c,"__esModule",{value:!0});c.SurfaceGeometryUpdates=void 0;l=function(c){function a(){var b=null!==c&&c.apply(this,arguments)||this;b.handles=new q;b._tileGeometryUpdateExtent=
k.empty();b._tileGeometryUpdateSpatialReference=null;b.events=new p;b.updating=!1;return b}d.__extends(a,c);a.prototype.initialize=function(){var b=this;this.handles.add([this.surface.on("elevation-change",function(a){return b._tileGeometryChanged(a)}),this.scheduler.registerTask(r.Task.SURFACE_GEOMETRY_UPDATES,function(){return b.update()},function(){return b.updating})])};a.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};a.prototype.update=function(){this.updating&&
(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",t),k.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};a.prototype._tileGeometryChanged=function(b){this._tileGeometryUpdateSpatialReference=b.spatialReference;k.expand(this._tileGeometryUpdateExtent,b.tile.extent);this._set("updating",!0)};a.prototype._furthestCenterOnSurface=function(){for(var b=this.centerOnSurfaces[0],a=1;a<this.centerOnSurfaces.length;a++){var c=
this.centerOnSurfaces[a];c.distance>b.distance&&(b=c)}return b};a.prototype._centerIntersectsExtent=function(a,c){var b=this.state.camera.eye,e=u,d=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(b,g,c);this.renderCoordsHelper.fromRenderCoords(d.renderLocation,h,c);g[0]<h[0]?(e[0]=g[0],e[2]=h[0]):(e[0]=h[0],e[2]=g[0]);g[1]<h[1]?(e[1]=g[1],e[3]=h[1]):(e[1]=h[1],e[3]=g[1]);return k.intersects(e,a)};d.__decorate([f.property({constructOnly:!0})],a.prototype,"state",void 0);d.__decorate([f.property({constructOnly:!0})],
a.prototype,"centerOnSurfaces",void 0);d.__decorate([f.property({constructOnly:!0})],a.prototype,"renderCoordsHelper",void 0);d.__decorate([f.property({constructOnly:!0})],a.prototype,"scheduler",void 0);d.__decorate([f.property({constructOnly:!0})],a.prototype,"surface",void 0);d.__decorate([f.property({readOnly:!0})],a.prototype,"updating",void 0);return a=d.__decorate([f.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a)}(n);c.SurfaceGeometryUpdates=l;var t={},g=m.vec3f64.create(),h=
m.vec3f64.create(),u=k.empty();c.default=l});