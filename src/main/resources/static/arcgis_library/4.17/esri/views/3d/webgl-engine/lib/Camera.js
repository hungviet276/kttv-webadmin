// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ../../support/geometryUtils/vector ./Util".split(" "),
function(t,u,l,v,f,k,w,x,d,g,h,m,n,y,z,p){Object.defineProperty(u,"__esModule",{value:!0});t=function(){function b(a,b,c){void 0===a&&(a=g.vec3f64.create());void 0===b&&(b=g.vec3f64.create());void 0===c&&(c=g.vec3f64.fromValues(0,0,1));this._viewUp=g.vec3f64.create();this._viewForward=g.vec3f64.create();this._viewRight=g.vec3f64.create();this._ray=n.ray.createWrapper();this._viewport=m.vec4f64.fromValues(0,0,1,1);this._padding=m.vec4f64.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=x.vec2f64.fromValues(1,
1E3);this._viewDirty=!0;this._viewMatrix=k.mat4f64.create();this._projectionDirty=!0;this._projectionMatrix=k.mat4f64.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=k.mat4f64.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=k.mat4f64.create();this._frustumDirty=!0;this._frustum=n.frustum.create();this._fullViewport=null;this.pixelRatio=1;this.relativeElevation=0;this._eye=g.vec3f64.clone(a);this._center=g.vec3f64.clone(b);this._up=g.vec3f64.clone(c);
this._padding=m.vec4f64.create()}Object.defineProperty(b.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"ray",{get:function(){this._ray.origin=this.eye;this._ray.direction||(this._ray.direction=g.vec3f64.create());
d.vec3.subtract(this._ray.direction,this.center,this.eye);return this._ray},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"viewMatrix",{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(a){f.mat4.copy(this._viewMatrix,a);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=
!0},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"nearFar",
{get:function(){return this._nearFar},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"near",{get:function(){return this._nearFar[0]},set:function(a){this._nearFar[0]!==a&&(this._nearFar[0]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"far",{get:function(){return this._nearFar[1]},set:function(a){this._nearFar[1]!==a&&(this._nearFar[1]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=
!0)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"y",{get:function(){return this._viewport[1]},set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"fullHeight",{get:function(){return this._viewport[3]+
this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=m.vec4f64.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!1,configurable:!0});
Object.defineProperty(b.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"padding",{get:function(){return this._padding},set:function(a){if(this._padding[0]!==a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+
this._padding[2]),h.vec4.copy(this._padding,a),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(f.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=
this.width,b=this.height,c=this.near*Math.tan(this.fovY/2),d=c*this.aspect;f.mat4.frustum(this._projectionMatrix,-d*(1+2*this._padding[3]/a),d*(1+2*this._padding[1]/a),-c*(1+2*this._padding[2]/b),c*(1+2*this._padding[0]/b),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){f.mat4.copy(this._projectionMatrix,a);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"fov",{get:function(){return this._fov},
set:function(a){this._fov=a;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"fovX",{get:function(){return p.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=p.fovx2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"fovY",{get:function(){return p.fovd2fovy(this._fov,this.width,
this.height)},set:function(a){this._fov=p.fovy2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"distance",{get:function(){return d.vec3.distance(this._center,this._eye)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"frustum",{get:function(){this._recomputeFrustum();return this._frustum},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"viewInverseTransposeMatrix",
{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=k.mat4f64.create()),f.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),f.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!1,configurable:!0});b.prototype.depthNDCToWorld=function(a){return 2*this.near*this.far/(this.far+
this.near-(2*a-1)*(this.far-this.near))};Object.defineProperty(b.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/2)/(this.width/2)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"aboveGround",{get:function(){return this.relativeElevation&&0<=this.relativeElevation},enumerable:!1,configurable:!0});b.prototype.copyFrom=
function(a){d.vec3.copy(this._eye,a._eye);d.vec3.copy(this._center,a._center);d.vec3.copy(this._up,a._up);h.vec4.copy(this._viewport,a._viewport);h.vec4.copy(this._padding,a._padding);w.vec2.copy(this._nearFar,a._nearFar);this._fov=a._fov;this.relativeElevation=a.relativeElevation;this._viewDirty=a._viewDirty;this._viewDirty||(f.mat4.copy(this._viewMatrix,a._viewMatrix),d.vec3.copy(this._viewRight,a._viewRight),d.vec3.copy(this._viewUp,a._viewUp),d.vec3.copy(this._viewForward,a._viewForward));a._projectionDirty?
this._projectionDirty=!0:(f.mat4.copy(this._projectionMatrix,a._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;this._frustumDirty=a._frustumDirty;this._frustumDirty||(n.frustum.copy(a._frustum,this._frustum),this._frustumDirty=!1);a._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?f.mat4.copy(this._viewInverseTransposeMatrix,a._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=k.mat4f64.clone(a._viewInverseTransposeMatrix),
this._viewInverseTransposeMatrixDirty=!1);a._fullViewport?this._fullViewport?h.vec4.copy(this._fullViewport,a._fullViewport):this._fullViewport=m.vec4f64.clone(a._fullViewport):this._fullViewport=null;this.pixelRatio=a.pixelRatio;return this};b.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};b.prototype.clone=function(){var a=new b;a.copyFrom(this);return a};b.prototype.equals=function(a){return d.vec3.exactEquals(this._eye,a._eye)&&d.vec3.exactEquals(this._center,
a._center)&&d.vec3.exactEquals(this._up,a._up)&&h.vec4.exactEquals(this._viewport,a._viewport)&&h.vec4.exactEquals(this._padding,a._padding)&&w.vec2.exactEquals(this._nearFar,a._nearFar)&&this._fov===a._fov&&this.pixelRatio===a.pixelRatio&&this.relativeElevation===a.relativeElevation};b.prototype.almostEquals=function(a){if(this.pixelRatio!==a.pixelRatio||.001<=Math.abs(a._fov-this._fov))return!1;var b=1-1E-10;d.vec3.sub(e,a._eye,a._center);d.vec3.sub(r,this._eye,this._center);var c=d.vec3.dot(e,
r),f=d.vec3.sqrLen(e),g=d.vec3.sqrLen(r);return c*c>=b*f*g&&d.vec3.sqrDist(a._eye,this._eye)<2.5E-7*Math.max(f,g)&&.5>h.vec4.squaredDistance(a._padding,this._padding)&&.5>h.vec4.squaredDistance(a._viewport,this._viewport)};b.prototype.markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};b.prototype.computeRenderPixelSizeAt=function(a){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(a))};b.prototype.computeRenderPixelSizeAtDist=function(a){return a*
this.perRenderPixelRatio};b.prototype.computeScreenPixelSizeAt=function(a){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(a))};b.prototype.viewDirectionDistance=function(a){return Math.abs(z.projectPointSignedLength(this.viewForward,d.vec3.subtract(e,a,this._eye)))};b.prototype.computeScreenPixelSizeAtDist=function(a){return a*this.perScreenPixelRatio};b.prototype.computeDistanceFromRadius=function(a,b){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(b||1)))};b.prototype.getScreenCenter=
function(a){void 0===a&&(a=v.createScreenPointArray());a[0]=(this.padding[3]+this.width/2)/this.pixelRatio;a[1]=(this.padding[0]+this.height/2)/this.pixelRatio;return a};b.prototype.getRenderCenter=function(a,b,c){void 0===b&&(b=.5);void 0===c&&(c=.5);a||(a=v.createRenderScreenPointArray3());a[0]=this.padding[3]+this.width*b;a[1]=this.padding[2]+this.height*c;2<a.length&&(a[2]=.5);return a};b.prototype.setGLViewport=function(a){var b=this.viewport,c=this.padding;a.setViewport(b[0]-c[3],b[1]-c[2],
b[2]+c[1]+c[3],b[3]+c[0]+c[2])};b.prototype.applyProjection=function(a,b,e){void 0===e&&(e=!1);a!==c&&d.vec3.copy(c,a);c[3]=1;e&&(b[2]=-c[2]);h.vec4.transformMat4(c,c,this.projectionMatrix);d.vec3.scale(c,c,1/Math.abs(c[3]));a=this.fullViewport;b[0]=l.lerp(0,a[0]+a[2],.5+.5*c[0]);b[1]=l.lerp(0,a[1]+a[3],.5+.5*c[1]);e||(b[2]=.5*(c[2]+1));return b};b.prototype.projectPoint=function(a,b){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=1;h.vec4.transformMat4(c,c,this.viewProjectionMatrix);if(0===c[3])return null;
d.vec3.scale(c,c,1/Math.abs(c[3]));a=this.fullViewport;"x"in b?(b.x=l.lerp(0,a[0]+a[2],.5+.5*c[0]),b.y=l.lerp(0,a[1]+a[3],.5+.5*c[1])):(b[0]=l.lerp(0,a[0]+a[2],.5+.5*c[0]),b[1]=l.lerp(0,a[1]+a[3],.5+.5*c[1]),2<b.length&&(b[2]=.5*(c[2]+1)));return b};b.prototype.unprojectPoint=function(a,b){f.mat4.multiply(q,this.projectionMatrix,this.viewMatrix);if(!f.mat4.invert(q,q))return null;var d=this.fullViewport;c[0]=2*(a[0]-d[0])/d[2]-1;c[1]=2*(a[1]-d[1])/d[3]-1;c[2]=2*a[2]-1;c[3]=1;h.vec4.transformMat4(c,
c,q);if(0===c[3])return null;b[0]=c[0]/c[3];b[1]=c[1]/c[3];b[2]=c[2]/c[3];return b};b.prototype.computeUp=function(a){1===a?this.computeUpGlobal():this.computeUpLocal()};b.prototype.screenToRender=function(a,b){var c=this.fullHeight-a[1]*this.pixelRatio;b[0]=a[0]*this.pixelRatio;b[1]=c;return b};b.prototype.renderToScreen=function(a,b){var c=(this.fullHeight-a[1])/this.pixelRatio;b[0]=a[0]/this.pixelRatio;b[1]=c;return b};b.prototype.computeUpGlobal=function(){d.vec3.subtract(e,this.center,this.eye);
var a=d.vec3.length(this.center);1>a?(d.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(d.vec3.dot(e,this.center))>.9999*d.vec3.length(e)*a||(d.vec3.cross(this.up,e,this.center),d.vec3.cross(this.up,this.up,e),d.vec3.normalize(this.up,this.up),this.markViewDirty())};b.prototype.computeUpLocal=function(){y.directionFromTo(e,this.eye,this.center);.9999>=Math.abs(e[2])&&(d.vec3.scale(e,e,e[2]),d.vec3.set(this.up,-e[0],-e[1],1-e[2]),d.vec3.normalize(this.up,this.up),this.markViewDirty())};b.prototype._compareAndSetView=
function(a,b){d.vec3.exactEquals(a,b)||(d.vec3.copy(b,a),this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0)};b.prototype._recomputeFrustum=function(){this._frustumDirty&&(n.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};b.prototype._ensureViewClean=function(){this._viewDirty&&(f.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),d.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),d.vec3.set(this._viewUp,
this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),d.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return b}();u.default=t;var c=m.vec4f64.create(),q=k.mat4f64.create(),e=g.vec3f64.create(),r=g.vec3f64.create()});