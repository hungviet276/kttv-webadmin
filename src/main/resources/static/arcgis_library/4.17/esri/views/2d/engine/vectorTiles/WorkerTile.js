// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/maybe ./Placement ./TileParser ../../tiling/enums".split(" "),function(n,p,c,l,f,m,e){return function(){function a(a,d,b){this.status=e.TileStatus.INITIALIZED;this.placementEngine=new f.PlacementEngine;this.tileKey=a;this.refKeys=d;this._workerTileHandler=b}a.prototype.release=function(){this.tileKey="";this.refKeys=null;this.status=e.TileStatus.INITIALIZED;this._workerTileHandler=null};a.prototype.parse=function(a,d){return c.__awaiter(this,void 0,void 0,
function(){var b,g,k,h,f=this;return c.__generator(this,function(c){switch(c.label){case 0:return b=d&&d.signal,l.isSome(b)&&(g=function(){b.removeEventListener("abort",g);f.status=e.TileStatus.INVALID},b.addEventListener("abort",g)),[4,this._parse(a,d)];case 1:return k=c.sent(),this.status=e.TileStatus.READY,h={buckets:k.map(function(a){return a.serialize()})},[2,{result:h,transferList:h.buckets}]}})})};a.prototype.setObsolete=function(){this.status=e.TileStatus.INVALID};a.prototype.getLayers=function(){return this._workerTileHandler.getLayers()};
a.prototype.getWorkerTileHandler=function(){return this._workerTileHandler};a.prototype._parse=function(a,d){return c.__awaiter(this,void 0,void 0,function(){var b;return c.__generator(this,function(c){if(0===Object.keys(a).length)return[2,[]];this.status=e.TileStatus.MODIFIED;b=new m(a,this,d.client);return[2,b.parse(d)]})})};return a}()});