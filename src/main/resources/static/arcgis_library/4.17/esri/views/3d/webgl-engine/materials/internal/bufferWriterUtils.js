// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../support/buffer/BufferView","../../lib/Util"],function(G,m,r,n){function E(l,g,a,d,e){var f=a.typedBuffer;a=a.typedBufferStride;var k=l.length;d*=a;if(null==e||1===e)for(var c=0;c<k;++c){var b=2*l[c];f[d]=g[b];f[d+1]=g[b+1];d+=a}else for(c=0;c<k;++c)for(var b=2*l[c],h=0;h<e;++h)f[d]=g[b],f[d+1]=g[b+1],d+=a}function C(l,g,a,d,e){var f=a.typedBuffer;a=a.typedBufferStride;var k=l.length;d*=a;if(null==e||1===e)for(var c=0;c<k;++c){var b=3*l[c];f[d]=g[b];f[d+1]=g[b+
1];f[d+2]=g[b+2];d+=a}else for(c=0;c<k;++c)for(var b=3*l[c],h=0;h<e;++h)f[d]=g[b],f[d+1]=g[b+1],f[d+2]=g[b+2],d+=a}function z(l,g,a,d,e){var f=a.typedBuffer;a=a.typedBufferStride;var k=l.length;d*=a;if(null==e||1===e)for(var c=0;c<k;++c){var b=4*l[c];f[d]=g[b];f[d+1]=g[b+1];f[d+2]=g[b+2];f[d+3]=g[b+3];d+=a}else for(c=0;c<k;++c)for(var b=4*l[c],h=0;h<e;++h)f[d]=g[b],f[d+1]=g[b+1],f[d+2]=g[b+2],f[d+3]=g[b+3],d+=a}function v(l,g,a,d,e,f){if(a){var k=d.typedBuffer;d=d.typedBufferStride;var c=l.length;
e*=d;if(null==f||1===f)for(var b=0;b<c;++b){var h=3*l[b],m=g[h],u=g[h+1],n=g[h+2];k[e]=a[0]*m+a[4]*u+a[8]*n+a[12];k[e+1]=a[1]*m+a[5]*u+a[9]*n+a[13];k[e+2]=a[2]*m+a[6]*u+a[10]*n+a[14];e+=d}else for(b=0;b<c;++b)for(var h=3*l[b],m=g[h],u=g[h+1],n=g[h+2],h=a[0]*m+a[4]*u+a[8]*n+a[12],r=a[1]*m+a[5]*u+a[9]*n+a[13],m=a[2]*m+a[6]*u+a[10]*n+a[14],u=0;u<f;++u)k[e]=h,k[e+1]=r,k[e+2]=m,e+=d}else C(l,g,d,e,f)}function F(l,g,a,d,e,f){if(a){var k=d.typedBuffer;d=d.typedBufferStride;var c=l.length,b=a[0],h=a[1],m=
a[2],n=a[4],r=a[5],v=a[6],A=a[8],B=a[9];a=a[10];var z=1E-5<Math.abs(1-b*b+n*n+A*A)||1E-5<Math.abs(1-h*h+r*r+B*B)||1E-5<Math.abs(1-m*m+v*v+a*a);e*=d;if(null==f||1===f)for(var x=0;x<c;++x){var q=3*l[x],p=g[q],t=g[q+1],y=g[q+2];f=b*p+n*t+A*y;var q=h*p+r*t+B*y,w=m*p+v*t+a*y;z&&(p=f*f+q*q+w*w,.999999>p&&1E-6<p&&(p=Math.sqrt(p),f/=p,q/=p,w/=p));k[e+0]=f;k[e+1]=q;k[e+2]=w;e+=d}else for(x=0;x<c;++x)for(q=3*l[x],p=g[q],t=g[q+1],y=g[q+2],q=b*p+n*t+A*y,w=h*p+r*t+B*y,t=m*p+v*t+a*y,z&&(p=q*q+w*w+t*t,.999999>p&&
1E-6<p&&(p=Math.sqrt(p),q/=p,w/=p,t/=p)),p=0;p<f;++p)k[e+0]=q,k[e+1]=w,k[e+2]=t,e+=d}else C(l,g,d,e,f)}function D(l,g,a,d,e,f){var k=d.typedBuffer;d=d.typedBufferStride;var c=l.length;e*=d;if(null==f||1===f)if(4===a)for(a=0;a<c;++a){var b=4*l[a];k[e]=g[b];k[e+1]=g[b+1];k[e+2]=g[b+2];k[e+3]=g[b+3];e+=d}else{if(3===a)for(a=0;a<c;++a)b=3*l[a],k[e]=g[b],k[e+1]=g[b+1],k[e+2]=g[b+2],k[e+3]=255,e+=d}else if(4===a)for(a=0;a<c;++a)for(var b=4*l[a],h=0;h<f;++h)k[e]=g[b],k[e+1]=g[b+1],k[e+2]=g[b+2],k[e+3]=g[b+
3],e+=d;else if(3===a)for(a=0;a<c;++a)for(b=3*l[a],h=0;h<f;++h)k[e]=g[b],k[e+1]=g[b+1],k[e+2]=g[b+2],k[e+3]=255,e+=d}Object.defineProperty(m,"__esModule",{value:!0});m.writeDefaultAttributes=m.writeMultipliedColor=m.writeColor=m.writeNormal=m.writePosition=m.writeBufferMat4f=m.writeBufferMat3f=m.writeBufferVec4=m.writeBufferVec3=m.writeBufferVec2=void 0;m.writeBufferVec2=E;m.writeBufferVec3=C;m.writeBufferVec4=z;m.writeBufferMat3f=function(l,g,a,d){var e=a.typedBuffer;a=a.typedBufferStride;var f=
l.length;d*=a;for(var k=0;k<f;++k){for(var c=9*l[k],b=0;9>b;++b)e[d+b]=g[c+b];d+=a}};m.writeBufferMat4f=function(l,g,a,d){var e=a.typedBuffer;a=a.typedBufferStride;var f=l.length;d*=a;for(var k=0;k<f;++k){for(var c=16*l[k],b=0;16>b;++b)e[d+b]=g[c+b];d+=a}};m.writePosition=v;m.writeNormal=F;m.writeColor=D;m.writeMultipliedColor=function(l,g,a,d,e,f,k){var c=e.typedBuffer;e=e.typedBufferStride;var b=l.length;f*=e;if(null==k||1===k)if(4===a)for(a=0;a<b;++a){var h=4*l[a];c[f]=g[h]*d[0];c[f+1]=g[h+1]*
d[1];c[f+2]=g[h+2]*d[2];c[f+3]=g[h+3]*d[3];f+=e}else{if(3===a){var m=255*d[3];for(a=0;a<b;++a)h=3*l[a],c[f]=g[h]*d[0],c[f+1]=g[h+1]*d[1],c[f+2]=g[h+2]*d[2],c[f+3]=m,f+=e}}else if(4===a)for(a=0;a<b;++a)for(var h=4*l[a],n=0;n<k;++n)c[f]=g[h]*d[0],c[f+1]=g[h+1]*d[1],c[f+2]=g[h+2]*d[2],c[f+3]=g[h+3]*d[3],f+=e;else if(3===a)for(m=255*d[3],a=0;a<b;++a)for(h=3*l[a],n=0;n<k;++n)c[f]=g[h]*d[0],c[f+1]=g[h+1]*d[1],c[f+2]=g[h+2]*d[2],c[f+3]=m,f+=e};m.writeDefaultAttributes=function(l,g,a,d,e,f){var k=0;for(g=
g.fieldNames;k<g.length;k++){var c=g[k],b=l.vertexAttr[c],h=l.indices[c];if(b&&h)switch(c){case n.VertexAttrConstants.POSITION:n.assert(3===b.size);(c=e.getField(c,r.BufferViewVec3f))&&v(h,b.data,a,c,f);break;case n.VertexAttrConstants.NORMAL:n.assert(3===b.size);(c=e.getField(c,r.BufferViewVec3f))&&F(h,b.data,d,c,f);break;case n.VertexAttrConstants.UV0:n.assert(2===b.size);(c=e.getField(c,r.BufferViewVec2f))&&E(h,b.data,c,f);break;case n.VertexAttrConstants.UVMAPSPACE:n.assert(4===b.size);(c=e.getField(c,
r.BufferViewVec4f))&&z(h,b.data,c,f);break;case n.VertexAttrConstants.MEANVERTEXPOSITION:n.assert(3===b.size);(c=e.getField(c,r.BufferViewVec3f))&&v(h,b.data,a,c,f);break;case n.VertexAttrConstants.BOUND1:case n.VertexAttrConstants.BOUND2:case n.VertexAttrConstants.BOUND3:n.assert(3===b.size);(c=e.getField(c,r.BufferViewVec3f))&&v(h,b.data,a,c,f);break;case n.VertexAttrConstants.COLOR:n.assert(3===b.size||4===b.size);(c=e.getField(c,r.BufferViewVec4u8))&&D(h,b.data,b.size,c,f);break;case n.VertexAttrConstants.SYMBOLCOLOR:n.assert(3===
b.size||4===b.size);(c=e.getField(c,r.BufferViewVec4u8))&&D(h,b.data,b.size,c,f);break;case n.VertexAttrConstants.TANGENT:n.assert(4===b.size),(c=e.getField(c,r.BufferViewVec4f))&&z(h,b.data,c,f)}}}});