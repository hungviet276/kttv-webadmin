// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Accessor ../../core/Error ../../core/HandleOwner ../../core/Logger ../../core/throttle ../../core/accessorSupport/decorators ./engine/webgl/collisions/CollisionEngine ./engine/webgl/collisions/LayerViewSorter".split(" "),function(d,f,c,g,h,k,l,m,e,n,p){Object.defineProperty(f,"__esModule",{value:!0});var q=l.getLogger("esri.views.2d.layers.labels.LabelManager");d=function(d){function a(b){b=d.call(this,b)||this;b._applyVisibilityPassThrottled=m.throttle(b._applyVisibilityPass,
64,b);b.lastUpdateId=-1;b.updateRequested=!1;b.view=null;return b}c.__extends(a,d);a.prototype.initialize=function(){var b=this;this.collisionEngine=new n.CollisionEngine(this.view.featuresTilingScheme);this._layerViewSorter=new p.LayerViewSorter(function(a,c){b.collisionEngine.registerLayerView(a,c);(c=a.tileRenderer)&&c.forEachTile(function(c){c.isDirty=!0;b.addTile(a,c)});b.requestUpdate()},function(a){b.collisionEngine.unregisterLayerView(a);b.requestUpdate()});this.handles.add(this.view.allLayerViews.on("change",
function(a){b._layerViewSorter.update(a)}))};a.prototype.destroy=function(){this._layerViewSorter.destroy();this.collisionEngine=this._layerViewSorter=null;this._applyVisibilityPassThrottled.remove();this._applyVisibilityPassThrottled=null};Object.defineProperty(a.prototype,"updating",{get:function(){return this.updateRequested},enumerable:!1,configurable:!0});a.prototype.update=function(b){this._applyVisibilityPassThrottled(b)};a.prototype.viewChange=function(){this.requestUpdate()};a.prototype.requestUpdate=
function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())};a.prototype.processUpdate=function(b){this._set("updateParameters",b);this.updateRequested&&(this.updateRequested=!1,this.update(b))};a.prototype.addTile=function(b,a){this.collisionEngine.addTile(b,a)};a.prototype.removeTile=function(b,a){this.collisionEngine.removeTile(b,a)};a.prototype._applyVisibilityPass=function(a){try{var b=this.view.featuresTilingScheme.getClosestInfoForScale(a.state.scale).level;this.collisionEngine.run(a,
b)}catch(r){q.error(new h("mapview-labeling","Encountered an error during label decluttering",r))}};c.__decorate([e.property()],a.prototype,"updateRequested",void 0);c.__decorate([e.property({readOnly:!0})],a.prototype,"updateParameters",void 0);c.__decorate([e.property({dependsOn:["updateRequested"]})],a.prototype,"updating",null);c.__decorate([e.property()],a.prototype,"view",void 0);return a=c.__decorate([e.subclass("esri.views.2d.layers.labels.LabelManager")],a)}(k.HandleOwnerMixin(g));f.default=
d});