// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
require({cache:{"esri/libs/i3s/I3SWorker":function(){define("require exports ../../assets ../../core/has ../../core/promiseUtils @dojo/framework/shim/Promise".split(" "),function(w,a,d,x,g){function h(a){return d.getAssetUrl("esri/libs/i3s/"+a)}Object.defineProperty(a,"__esModule",{value:!0});a.getWorkerModule=void 0;a.getWorkerModule=function(){if(!l){var a=x("esri-wasm")?new Promise(function(a,h){w(["./i3s"],a,h)}):new Promise(function(a,h){w(["./i3s_nowasm"],a,h)});l=g.create(function(d){return a.then(function(a){var g=
a({locateFile:h,onRuntimeInitialized:function(){return d(g)}});delete g.then})}).catch(function(a){return g.reject(a)})}return l};var l})},"esri/assets":function(){define(["require","exports","./request","./core/urlUtils"],function(w,a,d,x){function g(a){return x.join(w.toUrl("."),"../",a)}Object.defineProperty(a,"__esModule",{value:!0});a.getAssetUrl=a.fetchAsset=void 0;a.fetchAsset=function(a,l){return d(g(a),l)};a.getAssetUrl=g})},"*noref":1}});
define("require exports tslib ../../../core/maybe ../../../core/promiseUtils ../../../core/typedArrayUtil ../../../libs/i3s/I3SWorker".split(" "),function(w,a,d,x,g,h,l){function A(c){for(var a=c.modifications,b=e._malloc(8*a.length),k=new Float64Array(e.HEAPU8.buffer,b,a.length),d=0;d<a.length;++d)k[d]=a[d];e.setModifications(c.context,b,a.length,c.isGeodetic);e._free(b)}function B(c,a){if(!e)return null;var b=c.context,k=c.localOrigin,t=c.globalTrafo,d=c.mbs,g=c.obb,m=c.elevationOffset,f=c.geometryBuffer,
n=c.geometryDescriptor,l=c.indexToVertexProjector,y=c.vertexToRenderProjector,u=e._malloc(f.byteLength),v=e._malloc(33*Float64Array.BYTES_PER_ELEMENT),r=new Uint8Array(e.HEAPU8.buffer,u,f.byteLength);r.set(new Uint8Array(f));f=new Float64Array(e.HEAPU8.buffer,v,33);p(f,k);var k=f.byteOffset+3*f.BYTES_PER_ELEMENT,q=new Float64Array(f.buffer,k);p(q,t);k+=16*f.BYTES_PER_ELEMENT;q=new Float64Array(f.buffer,k);p(q,d);k+=4*f.BYTES_PER_ELEMENT;x.isSome(g)&&(q=new Float64Array(f.buffer,k),p(q,g.center),k+=
3*f.BYTES_PER_ELEMENT,q=new Float64Array(f.buffer,k),p(q,g.halfSize),k+=3*f.BYTES_PER_ELEMENT,q=new Float64Array(f.buffer,k),p(q,g.quaternion));t={isDraco:!1,isLegacy:!1,color:c.layouts.some(function(a){return a.some(function(a){return"color"===a.name})}),normal:c.needNormals&&c.layouts.some(function(a){return a.some(function(a){return"normalCompressed"===a.name})}),uv0:c.layouts.some(function(a){return a.some(function(a){return"uv0"===a.name})}),uvRegion:c.layouts.some(function(a){return a.some(function(a){return"uvRegion"===
a.name})}),featureIndex:n.featureIndex};b=e.process(b,!!c.obb,u,r.byteLength,n,t,v,m,l,y,c.normalReferenceFrame);e._free(v);e._free(u);if(0<b.error.length)throw"i3s.wasm: "+b.error;if(b.discarded)return null;u=0<b.componentOffsets.length?h.slice(b.componentOffsets):null;v=0<b.featureIds.length?h.slice(b.featureIds):null;m=h.slice(b.interleavedVertedData).buffer;n=1===b.indicesType?h.slice(new Uint16Array(b.indices.buffer,b.indices.byteOffset,b.indices.byteLength/2)):h.slice(new Uint32Array(b.indices.buffer,
b.indices.byteOffset,b.indices.byteLength/4));l=h.slice(b.positions);y=1===b.positionIndicesType?h.slice(new Uint16Array(b.positionIndices.buffer,b.positionIndices.byteOffset,b.positionIndices.byteLength/2)):h.slice(new Uint32Array(b.positionIndices.buffer,b.positionIndices.byteOffset,b.positionIndices.byteLength/4));c={layout:c.layouts[0],interleavedVertexData:m,indices:n,hasColors:b.hasColors,hasModifications:b.hasModifications,positionData:{data:l,indices:y}};v&&a.push(v.buffer);u&&a.push(u.buffer);
a.push(m);a.push(n.buffer);a.push(l.buffer);a.push(y.buffer);return{componentOffsets:u,featureIds:v,transformedGeometry:c,obb:b.obb}}function C(a){var c=a.context,b=a.buffer;a=e._malloc(b.byteLength);var d=b.byteLength/Float64Array.BYTES_PER_ELEMENT,h=new Float64Array(e.HEAPU8.buffer,a,d),b=new Float64Array(b);h.set(b);e.filterOBBs(c,a,d);b.set(h);e._free(a)}function D(a){e&&e.destroy(a)}function p(a,d){for(var b=0;b<d.length;++b)a[b]=d[b]}function r(){if(e)return g.resolve();z||(z=l.getWorkerModule().then(function(a){e=
a;z=null}));return z}Object.defineProperty(a,"__esModule",{value:!0});a.test=a.ensureWASM=a.filterObbsForModificationsSync=a.interpretObbModificationResults=a.setModificationsSync=a.destroyContext=a.setLegacySchema=a.setModifications=a.filterObbsForModifications=a.dracoDecompressPointCloudData=a.process=void 0;a.process=function(a){return d.__awaiter(this,void 0,void 0,function(){var c,b;return d.__generator(this,function(d){switch(d.label){case 0:return[4,r()];case 1:return d.sent(),c=[a.geometryBuffer],
b=B(a,c),[2,{result:b,transferList:c}]}})})};a.dracoDecompressPointCloudData=function(a){var c;return d.__awaiter(this,void 0,void 0,function(){var b,k,g,t,l,m,f,n,p;return d.__generator(this,function(d){switch(d.label){case 0:return[4,r()];case 1:d.sent();b=[a.geometryBuffer];k=a.geometryBuffer;g=k.byteLength;t=e._malloc(g);l=new Uint8Array(e.HEAPU8.buffer,t,g);l.set(new Uint8Array(k));m=e.dracoDecompressPointCloudData(t,l.byteLength);e._free(t);if(0<m.error.length)throw"i3s.wasm: "+m.error;f=0<
(null===(c=m.featureIds)||void 0===c?void 0:c.length)?h.slice(m.featureIds):null;n=h.slice(m.positions);f&&b.push(f.buffer);b.push(n.buffer);p={positions:n,featureIds:f};return[2,{result:p,transferList:b}]}})})};a.filterObbsForModifications=function(a){return d.__awaiter(this,void 0,void 0,function(){var c;return d.__generator(this,function(b){switch(b.label){case 0:return[4,r()];case 1:return b.sent(),C(a),c={buffer:a.buffer},[2,{result:c,transferList:[c.buffer]}]}})})};a.setModifications=function(a){return d.__awaiter(this,
void 0,void 0,function(){return d.__generator(this,function(c){switch(c.label){case 0:return[4,r()];case 1:return c.sent(),A(a),[2]}})})};a.setLegacySchema=function(a){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){switch(c.label){case 0:return[4,r()];case 1:return c.sent(),e.setLegacySchema(a.context,a.jsonSchema),[2]}})})};a.destroyContext=function(a){D(a)};var z,e;a.setModificationsSync=A;a.interpretObbModificationResults=function(a){return 0===a?0:1===a?
1:2===a?2:3};a.filterObbsForModificationsSync=C;a.ensureWASM=r;a.test={transform:B,destroy:D}});