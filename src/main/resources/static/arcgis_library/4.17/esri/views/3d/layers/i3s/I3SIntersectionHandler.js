// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../support/orientedBoundingBox ../../webgl-engine/lib/intersectorUtils".split(" "),function(k,e,r,w,u,v){function x(b,a,f,d){void 0===d&&(d=0);d=b[3]+d;var m=a[0]-b[0],g=a[1]-b[1];b=a[2]-b[2];a=f[0];var c=f[1];f=f[2];var n=a*m+c*g+f*b;return 0<=n*n-(a*a+c*c+f*f)*(m*m+g*g+b*b-d*d)}Object.defineProperty(e,"__esModule",{value:!0});e.I3SIntersectionHandler=void 0;k=function(){function b(a){this.type="I3S";this.layerUid=
a.layerUid;this.sublayerUid=a.sublayerUid;this.collection=a.collection;this.forEach=a.forEach;this.slicePlane=a.slicePlaneEnabled;this.isGround=a.isGround}b.prototype.intersect=function(a,b,d,m){var g=this,c=a.results,f=2===a.options.store,e=a.ray.direction,h=a.tolerance,k=function(a){return a},t=function(a){return a},l=v.getVerticalOffsetI3S(a.verticalOffset);r.isSome(l)&&(k=function(a){return l.applyToMbs(a)},t=function(a){return l.applyToObb(a)});this.forEach(function(p,n){if(r.isSome(p.geometryObb)){if(!u.intersectLine(t(p.geometryObb),
d,e,h))return}else if(r.isSome(p.serviceObbInRenderSR)){if(!u.intersectLine(t(p.serviceObbInRenderSR),d,e,h))return}else if(!x(k(p.renderMbs),d,e,h))return;g.collection.intersect(n,d,m,h,l,function(e,q,k,n){if(0<=q&&(null==b||b(d,m,q))){var h=function(a){a.intersector=g.type;a.target={type:"external",metadata:{layerUid:g.layerUid,sublayerUid:g.sublayerUid,nodeIndex:p.index,componentIndex:e}};a.dist=q;w.vec3.copy(a.normal,k);a.triangleNr=n};g.isGround&&(null==c.ground.dist||q<c.ground.dist)&&h(c.ground);
if(!a.options.isFiltered&&((null==c.min.dist||q<c.min.dist)&&h(c.min),(null==c.max.dist||q>c.max.dist)&&h(c.max),f)){var l=new v.IntersectorResult(a.ray);h(l);a.results.all.push(l)}}})})};Object.defineProperty(b.prototype,"intersectionHandlerId",{get:function(){return this.layerUid},enumerable:!1,configurable:!0});return b}();e.I3SIntersectionHandler=k});