// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),function(D,l,p,z,A,B,v,C){function x(a,d){for(var h=new Float64Array(d),m=0;m<d;m++)h[m]=a[3*m+2];return h}function w(a){return null==a||"none"===a?null:"low-four-bit"===a?function(a){return a&15}:"high-four-bit"===a?function(a){return(a&240)>>4}:"absolute-value"===
a?function(a){return Math.abs(a)}:"modulo-ten"===a?function(a){return a%10}:null}function y(a){var d=0,h=0;for(a=a?a:[];h<a.length;h++)d|=1<<a[h];return d}Object.defineProperty(l,"__esModule",{value:!0});l.filterInPlace=l.elevationFromPositions=l.getAttributeValues=l.readGeometry=l.evaluateRenderer=void 0;l.evaluateRenderer=function(a,d,h,m){var b=a.rendererJSON,k=a.isRGBRenderer,g=a=null;if(d&&k)a=d;else if(d&&"pointCloudUniqueValueRenderer"===b.type){var g=B.fromJSON(b),c=g.colorUniqueValueInfos;
a=new Uint8Array(3*m);k=w(g.fieldTransformType);for(b=0;b<m;b++)for(var f=k?k(d[b]):d[b],f=f+"",e=0;e<c.length;e++)if(0<=c[e].values.indexOf(f)){a[3*b]=c[e].color.r;a[3*b+1]=c[e].color.g;a[3*b+2]=c[e].color.b;break}}else if(d&&"pointCloudStretchRenderer"===b.type)for(g=A.fromJSON(b),c=g.stops,a=new Uint8Array(3*m),k=w(g.fieldTransformType),b=0;b<m;b++)if(f=k?k(d[b]):d[b],e=c.length-1,f<c[0].value)a[3*b]=c[0].color.r,a[3*b+1]=c[0].color.g,a[3*b+2]=c[0].color.b;else if(f>=c[e].value)a[3*b]=c[e].color.r,
a[3*b+1]=c[e].color.g,a[3*b+2]=c[e].color.b;else for(e=1;e<c.length;e++){if(f<c[e].value){f=(f-c[e-1].value)/(c[e].value-c[e-1].value);a[3*b]=c[e].color.r*f+c[e-1].color.r*(1-f);a[3*b+1]=c[e].color.g*f+c[e-1].color.g*(1-f);a[3*b+2]=c[e].color.b*f+c[e-1].color.b*(1-f);break}}else if(d&&"pointCloudClassBreaksRenderer"===b.type)for(g=z.fromJSON(b),c=g.colorClassBreakInfos,a=new Uint8Array(3*m),k=w(g.fieldTransformType),b=0;b<m;b++)for(f=k?k(d[b]):d[b],e=0;e<c.length;e++){if(f>=c[e].minValue&&f<=c[e].maxValue){a[3*
b]=c[e].color.r;a[3*b+1]=c[e].color.g;a[3*b+2]=c[e].color.b;break}}else for(a=new Uint8Array(3*m),b=0;b<a.length;b++)a[b]=255;if(h&&g&&g.colorModulation)for(d=g.colorModulation.minValue,g=g.colorModulation.maxValue,b=0;b<m;b++)f=h[b],k=f>=g?1:f<=d?.3:.3+.7*(f-d)/(g-d),a[3*b]*=k,a[3*b+1]*=k,a[3*b+2]*=k;return a};l.readGeometry=function(a,d){if(null==a.encoding||""===a.encoding){a=v.createGeometryIndexFromSchema(d,a);if(p.isNone(a.vertexAttributes.position))return;d=v.createTypedView(d,a.vertexAttributes.position);
var h=a.header.fields;a=[h.offsetX,h.offsetY,h.offsetZ];for(var h=[h.scaleX,h.scaleY,h.scaleZ],m=d.length/3,b=new Float64Array(3*m),k=0;k<m;k++)b[3*k]=d[3*k]*h[0]+a[0],b[3*k+1]=d[3*k+1]*h[1]+a[1],b[3*k+2]=d[3*k+2]*h[2]+a[2];return b}if("lepcc-xyz"===a.encoding)return C.decodeXYZ(d).result};l.getAttributeValues=function(a,d,h){return p.isSome(a)&&a.attributeInfo.useElevation?x(d,h):p.isSome(a)?v.readBinaryAttribute(a.attributeInfo.storageInfo,a.buffer,h):null};l.elevationFromPositions=x;l.filterInPlace=
function(a,d,h,m,b){for(var k=a.length/3,g=0,c=0;c<k;c++){for(var f=!0,e=0;e<m.length&&f;e++){var l=m[e].filterJSON,n=b[e].values[c];switch(l.type){case "pointCloudValueFilter":var q="exclude"===l.mode;-1!==l.values.indexOf(n)===q&&(f=!1);break;case "pointCloudBitfieldFilter":q=y(l.requiredSetBits);l=y(l.requiredClearBits);if((n&q)!==q||0!==(n&l))f=!1;break;case "pointCloudReturnFilter":for(var r=n&15,t=n>>>4&15,n=1<t,q=1===r,r=r===t,t=!1,p=0,l=l.includedReturns;p<l.length;p++){var u=l[p];if("last"===
u&&r||"firstOfMany"===u&&q&&n||"lastOfMany"===u&&r&&n||"single"===u&&!n){t=!0;break}}t||(f=!1)}}f&&(h[g]=c,a[3*g]=a[3*c],a[3*g+1]=a[3*c+1],a[3*g+2]=a[3*c+2],d[3*g]=d[3*c],d[3*g+1]=d[3*c+1],d[3*g+2]=d[3*c+2],g++)}return g}});