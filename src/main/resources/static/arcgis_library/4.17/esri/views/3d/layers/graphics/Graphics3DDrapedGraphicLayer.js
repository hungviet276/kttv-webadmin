// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils".split(" "),function(h,v,p,r,m,f,t,u){h=function(){function c(a,b,c){this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=c;this.type="draped";this.stage=null;this._addedToStage=this._visible=!1;this._layerView=null;this.isElevationSource=!1}c.prototype.initialize=function(a,
b,c){this.stage=a;this._layerView=c;this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer};c.prototype.setVisibility=function(a){if(null!=this.stage){if(this._visible!==a){if((this._visible=a)&&!this._addedToStage)return this._addedToStage=!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,1),!0;if(!a&&!this._addedToStage)return!1;a=0;for(var b=this.renderGeometries;a<b.length;a++)b[a].instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,
this._layerView,1);return!0}return!1}};c.prototype.destroy=function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,4);this._visible=this._addedToStage=!1;this.stage=null};c.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};c.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=m.vec3f64.create());return r.vec3.set(a,0,0,0)};c.prototype.getBoundingBoxObjectSpace=
function(a){void 0===a&&(a=f.create());return f.empty(a)};c.prototype.addObjectState=function(a,b){var c=this;0===a&&(this.renderGeometries.forEach(function(a){var e=a.addHighlight();b.addRenderGeometry(a,e,c)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))};c.prototype.removeObjectState=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};c.prototype.removeRenderGeometryObjectState=function(a,b){a.removeHighlight(b);
this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)};c.prototype.computeAttachmentOrigin=function(a){for(var b=0,c=this.renderGeometries;b<c.length;b++)c[b].computeAttachmentOrigin(g)&&(a.draped.origin[0]+=g[0],a.draped.origin[1]+=g[1],a.draped.num++)};c.prototype.getProjectedBoundingBox=function(a,b,c,d,e){return p.__awaiter(this,void 0,void 0,function(){var n,h,k,m;return p.__generator(this,function(l){switch(l.label){case 0:f.empty(e);for(n=0;n<this.renderGeometries.length;n++)h=
this.renderGeometries[n],this._getRenderGeometryProjectedBoundingRect(h,a,q,c),f.expand(e,q);if(!b)return[3,5];f.center(e,g);k=void 0;m=u.demResolutionForBoundingBox(e,b);l.label=1;case 1:return l.trys.push([1,3,,4]),[4,b.service.queryElevation(g[0],g[1],d,m,"ground")];case 2:return k=l.sent(),[3,4];case 3:return l.sent(),k=null,[3,4];case 4:null!=k&&(e[2]=Math.min(e[2],k),e[5]=Math.max(e[5],k)),l.label=5;case 5:return[2,e]}})})};c.prototype._getRenderGeometryProjectedBoundingRect=function(a,c,g,
h){if(this.boundingBox)f.set(d,this.boundingBox);else{var b=a.center;a=a.bsRadius;d[0]=b[0]-a;d[1]=b[1]-a;d[2]=b[2]-a;d[3]=b[0]+a;d[4]=b[1]+a;d[5]=b[2]+a}c(d,0,2);this.calculateRelativeScreenBounds&&h.push({location:f.center(d),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return f.toRect(d,g)};return c}();var q=t.create(),d=f.create(),g=m.vec3f64.create();return h});