// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/maybe ../../../webgl ./decluttering/config ./decluttering/util".split(" "),function(l,h,p,e,f,q,r){Object.defineProperty(h,"__esModule",{value:!0});h.CircleRenderBucket=h.SymbolRenderBucket=h.FillRenderBucket=h.LineRenderBucket=h.RenderBucketBase=void 0;l=function(){function f(a){this.layerIndices=[];this.isDestroyed=!1;this.data=a;this.memoryUsed=a.byteLength;var d=1;a=new Uint32Array(a);this.layerIndices=[];for(var b=a[d++],c=0;c<b;c++)this.layerIndices[c]=
a[d++];this.bufferDataOffset=d}Object.defineProperty(f.prototype,"isPreparedForRendering",{get:function(){return e.isNone(this.data)},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"offset",{get:function(){return this.bufferDataOffset},enumerable:!1,configurable:!0});f.prototype.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};f.prototype.prepareForRendering=function(a,d){e.isNone(this.data)||(this.doPrepareForRendering(a,d,this.data,this.bufferDataOffset),
this.data=null)};return f}();h.RenderBucketBase=l;var m=function(h){function a(d){var b=h.call(this,d)||this;b.type=2;b.lineIndexStart=0;b.lineIndexCount=0;var c=b.bufferDataOffset;d=new Uint32Array(d);b.lineIndexStart=d[c++];b.lineIndexCount=d[c++];b.isLineDataDriven=!!d[c++];b.bufferDataOffset=c;return b}p.__extends(a,h);a.prototype.hasData=function(){return 0<this.lineIndexCount};a.prototype.triangleCount=function(){return this.lineIndexCount/3};a.prototype.doDestroy=function(){e.isSome(this.lineVertexArrayObject)&&
this.lineVertexArrayObject.dispose();e.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();e.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=null;this.memoryUsed=0};a.prototype.doPrepareForRendering=function(d,b,c,g){c=new Uint32Array(c);var e=new Int32Array(c.buffer),k=c[g++];this.lineVertexBuffer=f.BufferObject.createVertex(d,35044,new Int32Array(e.buffer,4*g,k));g+=k;e=c[g++];this.lineIndexBuffer=f.BufferObject.createIndex(d,
35044,new Uint32Array(c.buffer,4*g,e));g+=e;this.lineVertexArrayObject=new f.VertexArrayObject(d,b.getProgramAttributes(3),this.isLineDataDriven?a.lineVertexAttributesDD:a.lineVertexAttributes,{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};a.lineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,
stride:12,normalized:!1,divisor:0}]};a.lineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};return a}(l);
h.LineRenderBucket=m;m=function(h){function a(d){var b=h.call(this,d)||this;b.type=1;b.fillIndexStart=0;b.fillIndexCount=0;b.outlineIndexStart=0;b.outlineIndexCount=0;var c=b.bufferDataOffset;d=new Uint32Array(d);b.fillIndexStart=d[c++];b.fillIndexCount=d[c++];b.outlineIndexStart=d[c++];b.outlineIndexCount=d[c++];b.isFillDataDriven=!!d[c++];b.isOutlineDataDriven=!!d[c++];b.bufferDataOffset=c;return b}p.__extends(a,h);a.prototype.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};
a.prototype.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};a.prototype.doDestroy=function(){e.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();e.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();e.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;e.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();e.isSome(this.outlineVertexBuffer)&&
this.outlineVertexBuffer.dispose();e.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};a.prototype.doPrepareForRendering=function(d,b,c,g){c=new Uint32Array(c);var e=new Int32Array(c.buffer),k=c[g++];this.fillVertexBuffer=f.BufferObject.createVertex(d,35044,new Int32Array(e.buffer,4*g,k));g+=k;k=c[g++];this.fillIndexBuffer=f.BufferObject.createIndex(d,35044,new Uint32Array(c.buffer,
4*g,k));g+=k;k=c[g++];this.outlineVertexBuffer=f.BufferObject.createVertex(d,35044,new Int32Array(e.buffer,4*g,k));g+=k;e=c[g++];this.outlineIndexBuffer=f.BufferObject.createIndex(d,35044,new Uint32Array(c.buffer,4*g,e));g+=e;this.fillVertexArrayObject=new f.VertexArrayObject(d,b.getProgramAttributes(1),this.isFillDataDriven?a.fillVertexAttributesDD:a.fillVertexAttributes,{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new f.VertexArrayObject(d,b.getProgramAttributes(2),
this.isOutlineDataDriven?a.outlineVertexAttributesDD:a.outlineVertexAttributes,{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};a.fillVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};a.fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]};a.outlineVertexAttributes={geometry:[{name:"a_pos",count:2,
type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]};a.outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",
count:4,type:5121,offset:8,stride:12,normalized:!0,divisor:0}]};return a}(l);h.FillRenderBucket=m;m=function(h){function a(d){var b=h.call(this,d)||this;b.type=3;b.iconPerPageElementsMap=new Map;b.glyphPerPageElementsMap=new Map;b.symbolInstances=[];b.isIconSDF=!1;b.opacityChanged=!1;b.lastOpacityUpdate=0;b.symbols=[];var c=b.bufferDataOffset,a=new Uint32Array(d),e=new Int32Array(d);d=new Float32Array(d);b.isIconSDF=!!a[c++];b.isIconDataDriven=!!a[c++];b.isTextDataDriven=!!a[c++];for(var k=a[c++],
f=0;f<k;f++){var l=a[c++],n=a[c++],m=a[c++];b.iconPerPageElementsMap.set(l,[n,m])}k=a[c++];for(f=0;f<k;f++)l=a[c++],n=a[c++],m=a[c++],b.glyphPerPageElementsMap.set(l,[n,m]);l=a[c++];n=a[c++];b.iconOpacity=new Int32Array(l);b.textOpacity=new Int32Array(n);if(!q.DECLUTTER_TILES){for(f=0;f<l;f++)b.iconOpacity[f]=-1;for(f=0;f<n;f++)b.textOpacity[f]=-1;b.opacityChanged=!0}c=r.deserializeSymbols(a,e,d,c,b.symbols);b.bufferDataOffset=c;return b}p.__extends(a,h);a.prototype.hasData=function(){return 0<this.iconPerPageElementsMap.size||
0<this.glyphPerPageElementsMap.size};a.prototype.triangleCount=function(){var a=0;this.iconPerPageElementsMap.forEach(function(b){a+=b[1]});this.glyphPerPageElementsMap.forEach(function(b){a+=b[1]});return a/3};a.prototype.doDestroy=function(){e.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();e.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();e.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();e.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();
this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;e.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();e.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();e.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();e.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};a.prototype.updateOpacityInfo=
function(){if(this.opacityChanged){this.opacityChanged=!1;var a=e.unwrap(this.iconOpacity),b=e.unwrap(this.iconOpacityBuffer);0<a.length&&a.byteLength===b.size&&b.setSubData(a);a=e.unwrap(this.textOpacity);b=e.unwrap(this.textOpacityBuffer);0<a.length&&a.byteLength===b.size&&b.setSubData(a)}};a.prototype.doPrepareForRendering=function(d,b,c,g){c=new Uint32Array(c);var h=new Int32Array(c.buffer),k=c[g++];this.iconVertexBuffer=f.BufferObject.createVertex(d,35044,new Int32Array(h.buffer,4*g,k));g+=k;
k=c[g++];this.iconIndexBuffer=f.BufferObject.createIndex(d,35044,new Uint32Array(c.buffer,4*g,k));g+=k;k=c[g++];this.textVertexBuffer=f.BufferObject.createVertex(d,35044,new Int32Array(h.buffer,4*g,k));g+=k;h=c[g++];this.textIndexBuffer=f.BufferObject.createIndex(d,35044,new Uint32Array(c.buffer,4*g,h));g+=h;this.iconOpacityBuffer=f.BufferObject.createVertex(d,35044,e.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=f.BufferObject.createVertex(d,35044,e.unwrap(this.textOpacity).buffer);this.iconVertexArrayObject=
new f.VertexArrayObject(d,b.getProgramAttributes(4),this.isIconDataDriven?a.vertexAttributesDD:a.vertexAttributes,{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new f.VertexArrayObject(d,b.getProgramAttributes(6),this.isTextDataDriven?a.vertexAttributesDD:a.vertexAttributes,{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};a.vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,
normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],opacity:[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}]};a.vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",
count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}],opacity:[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}]};return a}(l);h.SymbolRenderBucket=
m;l=function(h){function a(a){var b=h.call(this,a)||this;b.type=4;b.circleIndexStart=0;b.circleIndexCount=0;var c=b.bufferDataOffset;a=new Uint32Array(a);b.circleIndexStart=a[c++];b.circleIndexCount=a[c++];b.bufferDataOffset=c;return b}p.__extends(a,h);a.prototype.hasData=function(){return 0<this.circleIndexCount};a.prototype.triangleCount=function(){return this.circleIndexCount/3};a.prototype.doDestroy=function(){e.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();e.isSome(this.circleVertexBuffer)&&
this.circleVertexBuffer.dispose();e.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};a.prototype.doPrepareForRendering=function(d,b,c,e){c=new Uint32Array(c);var g=new Int32Array(c.buffer),h=c[e++];this.circleVertexBuffer=f.BufferObject.createVertex(d,35044,new Int32Array(g.buffer,4*e,h));e+=h;g=c[e++];this.circleIndexBuffer=f.BufferObject.createIndex(d,35044,new Uint32Array(c.buffer,
4*e,g));e+=g;this.circleVertexArrayObject=new f.VertexArrayObject(d,b.getProgramAttributes(5),a.circleVertexAttributes,{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};a.circleVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,normalized:!0,divisor:0},{name:"a_data",count:4,type:5121,offset:12,stride:16,
normalized:!1,divisor:0}]};return a}(l);h.CircleRenderBucket=l});