// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../core/libs/earcut/earcut ../../../../../../layers/graphics/OptimizedGeometry ../../definitions ../../TileClipper ../bufcut ../Tesselator".split(" "),function(E,h,z,A,x,B,C,D){function v(a,b,e){for(var f=0,c=1;c<e;c++)f+=(a[2*(b+c)]-a[2*(b+c-1)])*(a[2*(b+c)+1]+a[2*(b+c-1)+1]);return f}function y(a,b,e,f,c){for(var g=0;e<f;e+=3)var d=2*(a.getValue(e)-c),k=2*(a.getValue(e+1)-c),m=2*(a.getValue(e+2)-c),g=g+Math.abs((b[d]-b[m])*(b[k+1]-b[d+1])-(b[d]-b[k])*(b[m+
1]-b[d+1]));return g}function w(a,b,e,f,c,g,d,k){c=((a-c)*(g-k)-(b-k)*(c-d))/((a-e)*(g-k)-(b-f)*(c-d));return 0>c||1<c?null:{x:Math.round(a+c*(e-a)),y:Math.round(b+c*(f-b))}}Object.defineProperty(h,"__esModule",{value:!0});h.clip=h.clipMarshall=h.triangulateLibtess=h.triangulateEarcut=h.triangulate=h.triangleArea=h.area=void 0;var r=new D.default,p=new B.TileClipper(0,0,0,1,128);p.setExtent(x.TILE_SIZE);h.area=v;h.triangleArea=y;h.triangulate=function(a,b,e){var f=b.coords,c=b.lengths;if(b.hasIndeterminateRingOrder)return!1;
b=a.length;for(var g=0,d=0;d<c.length;){for(var k=d,m=c[d],d=v(f,g,m),l=[];++k<c.length;){var h=c[k],n=v(f,g+m,h);if(!(0<n))break;d+=n;l.push(g+m);m+=h}h=a.length;C.bufcut(a,f,g,g+m,l,2,e);l=y(a,f,h,a.length,e);d=Math.abs(d);if(1E-5<Math.abs((l-d)/Math.max(1E-7,d)))return a.seek(b),!1;d=k;g+=m}return!0};h.triangulateEarcut=function(a,b,e){var f=b.coords,c=b.lengths;if(b.hasIndeterminateRingOrder)return!1;for(var g=0,d=0;d<c.length;){for(var k=d,m=c[d],d=[];++k<c.length;){var l=c[k];if(!(0<v(f,g+m,
l)))break;d.push(g+m-g);m+=l}for(var h=b.coords.slice(2*g,2*(g+m)),l=0,d=z.earcut(h,d,2);l<d.length;l++)a.push(d[l]+e+g);d=k;g+=m}return!0};h.triangulateLibtess=function(a,b,e,f){var c=[],g=e.coords,d=e.lengths;r.beginPolygon(a,c);for(var k=a=0;k<d.length;k++){var h=e.lengths[k];r.beginContour();for(var l=0;l<h;l++){var u=[g[2*(a+l)],g[2*(a+l)+1],0];r.addVertex(u,u)}r.endContour();a+=h}r.endPolygon();for(l=0;l<c.length;l++)b.push(c[l]+f)};h.clipMarshall=function(a){var b;a:{b=x.TILE_SIZE+128;for(var e=
0,f=0;f<a.lengths.length;f++){for(var c=a.lengths[f],g=0;g<c;g++){var d=a.coords[2*(g+e)],k=a.coords[2*(g+e)+1];if(-128>d||d>b||-128>k||k>b){b=!0;break a}}e+=c}b=!1}if(!b)return a;p.reset(3);for(b=e=0;b<a.lengths.length;b++){f=a.lengths[b];c=a.coords[2*(0+e)];g=a.coords[2*(0+e)+1];p.moveTo(c,g);for(d=1;d<f;d++)c=a.coords[2*(d+e)],g=a.coords[2*(d+e)+1],p.lineTo(c,g);p.close();e+=f}a=p.result(!1);if(!a)return null;e=[];f=[];for(c=0;c<a.length;c++){b=a[c];for(d=g=0;d<b.length;d++)k=b[d],f.push(k.x),
f.push(k.y),g++;e.push(g)}return new A.default(e,f)};h.clip=function(a,b,e){void 0===e&&(e=0);var f=-e;b+=e;for(var c=e=0,g=0,d=0;d<a.lengths.length;d++){for(var k=a.lengths[d],h=g+k,l=0,u=null;e!==h;){for(var n=a.coords[2*e],q=a.coords[2*e++ +1],p=n<f||n>=b||q<f||q>=b,t=p;e!==h&&p===t;)p||(a.coords[2*c]=n,a.coords[2*c++ +1]=q,l++),n=a.coords[2*e],q=a.coords[2*e++ +1],p=n<f||n>=b||q<f||q>=b;if(e===h)p?u&&(a.coords[2*c]=u.x,a.coords[2*c++ +1]=u.y,l++):(a.coords[2*c]=n,a.coords[2*c++ +1]=q,l++);else{var t=
a.coords[2*(e-2)],r=a.coords[2*(e-2)+1];if(t=w(t,r,n,q,f,f,b,f)||w(t,r,n,q,b,f,b,b)||w(t,r,n,q,b,b,f,b)||w(t,r,n,q,f,f,f,b))a.coords[2*c]=t.x,a.coords[2*c++ +1]=t.y,l++,u||(u=t);p||(a.coords[2*c]=n,a.coords[2*c++ +1]=q,l++)}}a.lengths[d]=l;g+=k}}});