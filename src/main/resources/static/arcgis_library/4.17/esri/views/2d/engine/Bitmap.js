// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/vec2f32 ../../webgl ./DisplayObject ./ImageryBitmapSource".split(" "),function(g,e,l,f,m,h,n,p,q){function r(c){var a=document.createElement("canvas");a.width=c.width;a.height=c.height;c.render(a.getContext("2d"));return a}function k(c,a,d){var b={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};a&&d&&(b.width=a,b.height=d);return new n.Texture(c,
b)}Object.defineProperty(e,"__esModule",{value:!0});e.Bitmap=void 0;g=function(c){function a(d,b){void 0===d&&(d=null);void 0===b&&(b=!0);var a=c.call(this)||this;a.requestRenderOnSourceChangedEnabled=b;a._textureInvalidated=!0;a.stencilRef=0;a.coordScale=[1,1];a._height=void 0;a.pixelRatio=1;a.resolution=0;a.rotation=0;a._source=null;a._width=void 0;a.x=0;a.y=0;a.transforms={dvs:m.mat3f32.create()};a.source=d;a.requestRender=a.requestRender.bind(a);return a}l.__extends(a,c);Object.defineProperty(a.prototype,
"isSourceScaled",{get:function(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return void 0!==this._height?this._height:this.sourceHeight},set:function(a){this._height=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"source",{get:function(){return this._source},set:function(a){this._source=a;this.invalidateTexture()},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"sourceHeight",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"sourceWidth",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(a){this._width=a},enumerable:!1,
configurable:!0});a.prototype.invalidateTexture=function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())};a.prototype.setTransform=function(a){var b=f.mat3.identity(this.transforms.dvs),d=a.toScreenNoRotation([0,0],this.x,this.y),c=this.resolution/this.pixelRatio/a.resolution,e=c*this.width,c=c*this.height,g=Math.PI*this.rotation/180;f.mat3.translate(b,b,h.vec2f32.fromValues(d[0],d[1]));f.mat3.translate(b,b,h.vec2f32.fromValues(e/
2,c/2));f.mat3.rotate(b,b,-g);f.mat3.translate(b,b,h.vec2f32.fromValues(-e/2,-c/2));f.mat3.scaleByVec2(b,b,h.vec2f32.fromValues(e,c));f.mat3.multiply(this.transforms.dvs,a.displayViewMat3,b)};a.prototype.setSamplingProfile=function(a){this._texture&&(a.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(a.samplingMode))};a.prototype.bind=function(a,b){this._texture&&a.context.bindTexture(this._texture,b)};a.prototype.updateTexture=function(a){var b;
a=a.context;this.stage?this._textureInvalidated&&(this._textureInvalidated=!1,this._texture||(this._texture=this.source?k(a,this.sourceWidth,this.sourceHeight):k(a)),(b=this.source)?(this._texture.resize(this.sourceWidth,this.sourceHeight),b&&"render"in b?b instanceof q.default?(b=b.getRenderedRasterPixels(),this._texture.setData(b.renderedRasterPixels)):this._texture.setData(r(b)):!b||"render"in b||this._texture.setData(b),this.ready()):this._texture.setData(null)):(null===(b=this._texture)||void 0===
b?void 0:b.dispose(),this._texture=null)};a.prototype.onAttach=function(){this.invalidateTexture()};a.prototype.onDetach=function(){this.invalidateTexture()};return a}(p.DisplayObject);e.Bitmap=g});