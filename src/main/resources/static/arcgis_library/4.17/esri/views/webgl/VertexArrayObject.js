// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../core/maybe","./Util"],function(m,n,e,h){return function(){function b(a,l,c,d,f){this._context=a;this._locations=l;this._layout=c;this._buffers=d;this._indexBuffer=f;this._glName=null;this._initialized=!1;this._id=b._nextId++;e.isSome(a.instanceCounter)&&a.instanceCounter.increment(2,this)}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},
enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(b,c){return b+a._buffers[c].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!1,configurable:!0});
Object.defineProperty(b.prototype,"layout",{get:function(){return this._layout},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"locations",{get:function(){return this._locations},enumerable:!1,configurable:!0});b.prototype.dispose=function(a){void 0===a&&(a=!0);if(this._context){var b=this._context.capabilities.vao;b&&this._glName&&(b.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(a){for(var c in this._buffers)this._buffers[c].dispose(),
delete this._buffers[c];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}e.isSome(this._context.instanceCounter)&&this._context.instanceCounter.decrement(2,this);this._context=null}};b.prototype.initialize=function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var b=a.createVertexArray();a.bindVertexArray(b);this._bindLayout();a.bindVertexArray(null);this._glName=b}this._initialized=!0}};b.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;
a?a.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};b.prototype._bindLayout=function(){var a=this._buffers,b=!!this._context.capabilities.vao,c=this._layout,d=this._indexBuffer;a||console.error("Vertex buffer dictionary is empty!");var f=this._context.gl,g;for(g in a){var e=a[g];e||console.error("Vertex buffer is uninitialized!");var k=c[g];k||console.error("Vertex element descriptor is empty!");h.bindVertexBufferLayout(this._context,this._locations,e,k)}d&&(b?f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,
d.glName):this._context.bindBuffer(d))};b.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};b.prototype._unbindLayout=function(){var a=this._buffers,b=this._layout;a||console.error("Vertex buffer dictionary is empty!");for(var c in a){var d=a[c];d||console.error("Vertex buffer is uninitialized!");h.unbindVertexBufferLayout(this._context,this._locations,d,b[c])}(a=this._indexBuffer)&&this._context.unbindBuffer(a.bufferType)};
b._nextId=0;return b}()});