// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Accessor ../../core/Evented ../../core/Logger ../../core/maybe ../../core/screenUtils ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../../geometry/support/webMercatorUtils ../../support/elevationInfoUtils ../../symbols/support/defaults ../../symbols/support/ElevationInfo ../support/drapedUtils".split(" "),function(l,h,c,n,p,q,f,k,d,r,t,u,m,v,w,x,y){Object.defineProperty(h,
"__esModule",{value:!0});h.GraphicManipulator=void 0;var z=q.getLogger("esri.views.interactive.GraphicManipulator");l=function(h){function a(b){b=h.call(this,b)||this;b.layer=null;b.interactive=!0;b.selectable=!1;b.grabbable=!0;b.dragging=!1;b.cursor=null;b.events=new p.EventEmitter;b._circleCollisionCache=null;b._graphicSymbolChangedHandle=null;b._originalSymbol=null;return b}c.__extends(a,h);Object.defineProperty(a.prototype,"graphic",{set:function(b){"mesh"===f.get(b.geometry,"type")?z.error("Mesh geometries are not supported"):
(this._circleCollisionCache=null,this._originalSymbol=b.symbol,this._set("graphic",b),this.attachSymbolChanged())},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"elevationInfo",{get:function(){var b="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,a=v.getGraphicEffectiveElevationMode(this.graphic);return new x({mode:a,offset:b?b.offset:0})},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"focusedSymbol",{set:function(b){b!==this._get("focusedSymbol")&&
(this._set("focusedSymbol",b),this._updateGraphicSymbol(),this._circleCollisionCache=null)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"grabbing",{set:function(b){b!==this._get("grabbing")&&(this._set("grabbing",b),this._updateGraphicSymbol())},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hovering",{set:function(b){b!==this._get("hovering")&&(this._set("hovering",b),this._updateGraphicSymbol())},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"selected",{set:function(b){b!==this._get("selected")&&(this._set("selected",b),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:b?"select":"deselect"}))},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},enumerable:!1,configurable:!0});a.prototype.destroy=function(){this.detachSymbolChanged();this._resetGraphicSymbol();this._set("view",null)};a.prototype.intersectionDistance=function(b){var a=
this._get("graphic");if(!1===a.visible)return null;var g=this._get("focusedSymbol"),g=f.isSome(g)?g:a.symbol,c=a.geometry;if(f.isNone(c))return null;var e=this._get("view");return"2d"===e.type?this._intersectDistance2D(b,e,c,g):this._intersectDistance3D(b,e,a)};a.prototype.attach=function(){this.attachSymbolChanged();f.isSome(this.layer)&&this.layer.add(this.graphic)};a.prototype.detach=function(){this.detachSymbolChanged();this._resetGraphicSymbol();f.isSome(this.layer)&&this.layer.remove(this.graphic)};
a.prototype.attachSymbolChanged=function(){var b=this;this.detachSymbolChanged();this._graphicSymbolChangedHandle=this.graphic.watch("symbol",function(a){f.isSome(a)&&a!==b.focusedSymbol&&a!==b._originalSymbol&&(b._originalSymbol=a,b._focused&&f.isSome(b.focusedSymbol)&&(b.graphic.symbol=b.focusedSymbol))},!0)};a.prototype.detachSymbolChanged=function(){f.isSome(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)};a.prototype._updateGraphicSymbol=
function(){this.graphic.symbol=this._focused&&f.isSome(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol};a.prototype._resetGraphicSymbol=function(){this.graphic.symbol=this._originalSymbol};a.prototype._intersectDistance2D=function(b,a,c,d){d=d||w.getDefaultSymbol2D(c);if(f.isNone(d))return null;var e=this._circleCollisionCache;if("point"!==c.type||"simple-marker"!==d.type)return e=y.intersectsDrapedGeometry(b,c,a),f.isSome(e)?1:null;if(f.isNone(e)||!e.originalPoint.equals(c)){var g=a.spatialReference;
m.canProject(c,g)&&(e=m.project(c,g),this._circleCollisionCache=e={originalPoint:c.clone(),mapPoint:e,radiusPx:k.pt2px(d.size)})}return f.isSome(e)?(b=k.screenPointObjectToArray(b,A),a=a.state.toScreen(B,e.mapPoint.x,e.mapPoint.y),e=e.radiusPx,r.vec2.squaredDistance(b,a)<e*e?1:null):null};a.prototype._intersectDistance3D=function(b,a,c){b=a.toMap(b,{include:[c]});if(!b)return null;c=C;return a.renderCoordsHelper.toRenderCoords(b,c)?t.vec3.distance(c,a.state.camera.eye):null};c.__decorate([d.property({constructOnly:!0,
nonNullable:!0})],a.prototype,"graphic",null);c.__decorate([d.property({readOnly:!0,dependsOn:["graphic"]})],a.prototype,"elevationInfo",null);c.__decorate([d.property({constructOnly:!0,nonNullable:!0})],a.prototype,"view",void 0);c.__decorate([d.property({value:null})],a.prototype,"focusedSymbol",null);c.__decorate([d.property({constructOnly:!0})],a.prototype,"layer",void 0);c.__decorate([d.property()],a.prototype,"interactive",void 0);c.__decorate([d.property()],a.prototype,"selectable",void 0);
c.__decorate([d.property()],a.prototype,"grabbable",void 0);c.__decorate([d.property({value:!1})],a.prototype,"grabbing",null);c.__decorate([d.property()],a.prototype,"dragging",void 0);c.__decorate([d.property()],a.prototype,"hovering",null);c.__decorate([d.property({value:!1})],a.prototype,"selected",null);c.__decorate([d.property()],a.prototype,"cursor",void 0);return a=c.__decorate([d.subclass("esri.views.interactive.GraphicManipulator")],a)}(n);h.GraphicManipulator=l;var C=u.vec3f64.create(),
A=k.createScreenPointArray(),B=k.createScreenPointArray()});