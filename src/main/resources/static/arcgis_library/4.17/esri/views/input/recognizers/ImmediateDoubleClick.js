// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),function(k,f,l,m,n,g,p){Object.defineProperty(f,"__esModule",{value:!0});f.ImmediateDoubleClick=void 0;k=function(f){function b(a,d,h,e,b){void 0===a&&(a=g.DefaultParameters.maximumDoubleClickDelay);void 0===d&&(d=g.DefaultParameters.maximumDoubleClickDistance);void 0===h&&(h=g.DefaultParameters.maximumDoubleTouchDelay);void 0===e&&(e=g.DefaultParameters.maximumDoubleTouchDistance);void 0===
b&&(b=m.default);var c=f.call(this,!1)||this;c.maximumDoubleClickDelay=a;c.maximumDoubleClickDistance=d;c.maximumDoubleTouchDelay=h;c.maximumDoubleTouchDistance=e;c._clock=b;c._pointerState=new Map;c._immediateDoubleClick=c.registerOutgoing("immediate-double-click");c.registerIncoming("pointer-down",c._handlePointerDown.bind(c));c.registerIncoming("pointer-up",function(a){c._handlePointerLoss(a,"pointer-up")});c.registerIncoming("pointer-capture-lost",function(a){c._handlePointerLoss(a,"pointer-capture-lost")});
c.registerIncoming("pointer-cancel",function(a){c._handlePointerLoss(a,"pointer-cancel")});return c}l.__extends(b,f);b.prototype.onUninstall=function(){this._pointerState.forEach(function(a){a.immediateDoubleClick&&a.immediateDoubleClick.timeoutHandle.remove()});f.prototype.onUninstall.call(this)};b.prototype._handlePointerDown=function(a){a=a.data;var d=this._pointerId(a);this._pointerState.has(d)||(this._pointerState.set(d,{downButton:a.native.button,immediateDoubleClick:null}),this.startCapturingPointer(a.native))};
b.prototype._handlePointerLoss=function(a,d){var b=a.data,e=this._pointerId(b);if((e=this._pointerState.get(e))&&"pointer-up"===d&&e.downButton===b.native.button)if(d=e.immediateDoubleClick){d.timeoutHandle.remove();var f="touch"===a.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;p.manhattanDistance(d,a.data)>f?this._startImmediateDoubleClick(a,e):(this._immediateDoubleClick.emit(a.data,void 0,d.modifiers),this._removeState(b))}else this._startImmediateDoubleClick(a,
e)};b.prototype._startImmediateDoubleClick=function(a,b){var d=this;b.immediateDoubleClick={x:a.data.x,y:a.data.y,modifiers:a.modifiers,timeoutHandle:this._clock.setTimeout(function(){return d._removeState(a.data)},"touch"===a.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}};b.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};b.prototype._removeState=function(a){var b=this._pointerId(a);this._pointerState.delete(b);
this.stopCapturingPointer(a.native);this.refreshHasPendingInputs()};return b}(n.InputHandler);f.ImmediateDoubleClick=k});