// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/colorUtils ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../Manipulator3D ../../manipulatorUtils ../dragEventPipeline3D ../settings ./config ./Manipulation ./moveUtils ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryUtil ../../../../interactive/dragEventPipeline".split(" "),
function(v,f,A,B,C,D,E,F,t,G,g,n,H,r,I,h,u,J,K,w,x,y){Object.defineProperty(f,"__esModule",{value:!0});f.MoveZManipulation=void 0;v=function(f){function d(a){var c=f.call(this)||this;c._handles=new D;c._radius=u.DISC_RADIUS;c.events=new C;c._tool=a.tool;c._view=a.view;null!=a.radius&&(c._radius=a.radius);c.createManipulator();c.forEachManipulator(function(a){return c._tool.manipulators.add(a)});return c}A.__extends(d,f);d.prototype.destroy=function(){var a=this;this._handles.destroy();this.forEachManipulator(function(c){a._tool.manipulators.remove(c);
c.destroy()})};d.prototype.forEachManipulator=function(a){a(this._manipulator,0)};d.prototype.createGraphicDragPipeline=function(a,c){var m=this,p=F.unwrap(a.graphic.geometry).spatialReference;return K.createGraphicMoveDragPipeline(a,c,function(a){return m.createDragPipeline(a,p)})};d.prototype.createDragPipeline=function(a,c){var m=this._view;return y.createManipulatorDragEventPipeline(this._manipulator,function(p,b,k,h){b=b.next(I.screenToZConstrained(m,p.renderLocation,c)).next(y.addScreenDelta());
a(p,b,k,h)})};Object.defineProperty(d.prototype,"radius",{get:function(){return this._radius},set:function(a){a!==this._radius&&(this._radius=a,this.updateManipulator())},enumerable:!1,configurable:!0});d.prototype.updateManipulator=function(){var a=this._radius/u.DISC_RADIUS,c=h.settings.zManipulator.height*a,m=h.settings.zManipulator.coneHeight*a,p=h.settings.zManipulator.coneWidth*a,a=h.settings.zManipulator.width*a,b=[n.vec3f64.fromValues(0,0,0),n.vec3f64.fromValues(0,0,c)],b=new w(x.createTubeGeometry(b,
a/2,16,!1),"move-z"),k=x.createConeGeometry(m,p/2,16,!1),k=new w(k),m=[n.vec3f64.fromValues(0,0,0),n.vec3f64.fromValues(0,0,c+m)],d=function(a){var b=G.mat4f64.create();t.mat4.translate(b,b,[0,0,c]);t.mat4.rotateX(b,b,Math.PI/2);a&&(a=1+2*a/p,t.mat4.scale(b,b,[a,a,a]));return b}(0),e=function(a,b){b=B.darken(h.settings.zManipulator.color,b);return[b.r/255,b.g/255,b.b/255,h.settings.zManipulator.color.a*a]},l=r.createManipulatorMaterial(e(1,.25),1),g=r.createManipulatorMaterial(e(1,0),1),f=r.createManipulatorMaterial(e(.7,
0),h.settings.zManipulator.occludedFlag),e=r.createManipulatorMaterial(e(.85,0),h.settings.zManipulator.occludedFlag);this._manipulator.renderObjects=[{geometry:k,transform:d,material:l,stateMask:1},{geometry:b,material:l,stateMask:1},{geometry:k,transform:d,material:g,stateMask:2},{geometry:b,material:g,stateMask:2},{geometry:k,transform:d,material:f,stateMask:1},{geometry:b,material:f,stateMask:1},{geometry:k,transform:d,material:e,stateMask:2},{geometry:b,material:e,stateMask:2}];this._manipulator.radius=
a/2+2;this._manipulator.collisionType={type:"line",paths:[m]}};d.prototype.createManipulator=function(){var a=this,c=new H.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});c.applyObjectTransform=function(c){var d=a._view.state.camera,b=z;a._view.renderCoordsHelper.toRenderCoords(a._manipulator.elevationAlignedLocation,b);var k=g.vec3.dist(d.eye,b),f=d.computeRenderPixelSizeAtDist(k),
e=g.vec3.subtract(q,b,d.eye);g.vec3.normalize(e,e);var l=L;a._view.renderCoordsHelper.worldUpAtPosition(z,l);b=Math.abs(g.vec3.dot(e,l));e=g.vec3.cross(q,e,l);l=g.vec3.cross(q,e,l);b=E.clamp(b,.01,1);d=1-Math.sqrt(1-b*b)/b/d.fullWidth;b=a._radius/u.DISC_RADIUS*h.settings.zManipulator.width;g.vec3.scale(l,g.vec3.normalize(l,l),(1/d-1)*k+f*b);c[12]-=q[0];c[13]-=q[1];c[14]-=q[2]};this._manipulator=c;this.updateManipulator()};return d}(J.Manipulation);f.MoveZManipulation=v;var z=n.vec3f64.create(),q=
n.vec3f64.create(),L=n.vec3f64.create()});