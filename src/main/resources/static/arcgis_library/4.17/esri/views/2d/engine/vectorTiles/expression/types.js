// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../../Color","./expression"],function(h,a,k,n){function m(a,b){return{kind:"array",itemType:a,n:b}}function l(a){if("array"===a.kind){var b=l(a.itemType);return"number"===typeof a.n?"array\x3c"+b+", "+a.n+"\x3e":"value"===a.itemType.kind?"array":"array\x3c"+b+"\x3e"}return a.kind}function p(d){if(null===d)return a.NullType;if("string"===typeof d)return a.StringType;if("boolean"===typeof d)return a.BooleanType;if("number"===typeof d)return a.NumberType;if(d instanceof
k)return a.ColorType;if(Array.isArray(d)){for(var b=void 0,c=0;c<d.length;c++){var g=p(d[c]);if(b){if(b!==g){b=a.ValueType;break}}else b=g}return m(b||a.ValueType,d.length)}return a.ObjectType}function q(a,b){if("error"===a.kind)return null;if("array"===b.kind){if("array"===a.kind&&(0===a.n&&"value"===a.itemType.kind||!q(a.itemType,b.itemType))&&("number"!==typeof b.n||b.n===a.n))return null}else{if(b.kind===a.kind)return null;if("value"===b.kind)for(var c=0,d=t;c<d.length;c++)if(!q(d[c],a))return null}return"Expected "+
l(b)+" but found "+l(a)+" instead."}function r(a){var b=typeof a;return null===a?"":"string"===b||"number"===b||"boolean"===b?String(a):a instanceof k?a.toString():JSON.stringify(a)}Object.defineProperty(a,"__esModule",{value:!0});a.TypeOf=a.Literal=a.Coerce=a.Assert=a.valueToString=a.typeToString=a.array=a.ErrorType=a.ValueType=a.ObjectType=a.ColorType=a.BooleanType=a.StringType=a.NumberType=a.NullType=void 0;a.NullType={kind:"null"};a.NumberType={kind:"number"};a.StringType={kind:"string"};a.BooleanType=
{kind:"boolean"};a.ColorType={kind:"color"};a.ObjectType={kind:"object"};a.ValueType={kind:"value"};a.ErrorType={kind:"error"};a.array=m;var t=[a.NullType,a.NumberType,a.StringType,a.BooleanType,a.ColorType,a.ObjectType,m(a.ValueType)];a.typeToString=l;a.valueToString=r;h=function(){function d(a,c){this.type=a;this.args=c}d.parse=function(b){var c=b[0];if(2>b.length)throw Error(c+" expects at least one argument.");var g=1,f;if("array"===c){if(2<b.length){switch(b[1]){case "string":f=a.StringType;
break;case "number":f=a.NumberType;break;case "boolean":f=a.BooleanType;break;default:throw Error('"array" type argument must be string, number or boolean');}g++}else f=a.ValueType;c=void 0;if(3<b.length){c=b[2];if(null!==c&&("number"!==typeof c||0>c||c!==Math.floor(c)))throw Error('"array" length argument must be a positive integer literal');g++}f=m(f,c)}else switch(c){case "string":f=a.StringType;break;case "number":f=a.NumberType;break;case "boolean":f=a.BooleanType;break;case "object":f=a.ObjectType}for(c=
[];g<b.length;g++){var e=n.createExpression(b[g]);c.push(e)}return new d(f,c)};d.prototype.evaluate=function(a,c){for(var b=0,d=this.args;b<d.length;b++){var e=d[b].evaluate(a,c);if(!q(p(e),this.type))return e}return null};return d}();a.Assert=h;h=function(){function d(a,c){this.type=a;this.args=c}d.parse=function(a){var b=a[0];if("to-boolean"===b||"to-string"===b){if(2!==a.length)throw Error(b+" expects one argument.");}else if(2>a.length)throw Error(b+" expects at least one argument.");for(var b=
d.types[b],g=[],f=1;f<a.length;f++){var e=n.createExpression(a[f]);g.push(e)}return new d(b,g)};d.prototype.evaluate=function(b,d){if(this.type===a.BooleanType)return!!this.args[0].evaluate(b,d);if(this.type===a.StringType)return r(this.args[0].evaluate(b,d));if(this.type===a.NumberType){for(var c=0,f=this.args;c<f.length;c++){var e=f[c],e=e.evaluate(b,d);if(null===e)return 0;e=Number(e);if(!isNaN(e))return e}return null}if(this.type===a.ColorType){c=0;for(f=this.args;c<f.length;c++){e=f[c];e=e.evaluate(b,
d);if(e instanceof k)return e;if("string"===typeof e)return k.fromString(e);if(Array.isArray(e)&&(3===e.length||4===e.length))return k.fromArray(e)}return null}};d.types={"to-boolean":a.BooleanType,"to-color":a.ColorType,"to-number":a.NumberType,"to-string":a.StringType};return d}();a.Coerce=h;h=function(){function a(a){this.val=a}a.parse=function(b){if(2!==b.length)throw Error('"literal" expects 1 argument');return new a(b[1])};a.prototype.evaluate=function(a,c){return this.val};return a}();a.Literal=
h;h=function(){function a(a){this.arg=a}a.parse=function(b){if(2!==b.length)throw Error('"typeof" expects 1 argument');return new a(n.createExpression(b[1]))};a.prototype.evaluate=function(a,c){return l(p(this.arg.evaluate(a,c)))};return a}();a.TypeOf=h});