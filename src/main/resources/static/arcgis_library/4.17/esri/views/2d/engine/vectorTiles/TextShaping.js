// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","./ScriptUtils","../webgl/Rect"],function(w,l,A,x){Object.defineProperty(l,"__esModule",{value:!0});l.TextShaping=l.SDF_GLYPH_BASELINE=l.SDF_GLYPH_SIZE=void 0;l.SDF_GLYPH_SIZE=24;l.SDF_GLYPH_BASELINE=17;w=function(){function m(b,e,d,f,c,g,h){this._glyphItems=b;this._maxWidth=e;this._lineHeight=d;this._letterSpacing=f;this._hAnchor=c;this._vAnchor=g;this._justify=h}m.prototype.getShaping=function(b,e,d){for(var f=this._letterSpacing,c=this._lineHeight,g=this._justify,h=
this._maxWidth,a=[],k=0,p=0,l=0,r=0,t=-1,u=0,m=-1,w=b.length,z=0;z<w;z++){var y=b.charCodeAt(z),v=d&&A.hasVerticalOrientation(y);if(10===y)z!==w-1&&(t>=r&&(k=a[t],v=k.x+k.glyphMosaicItem.metrics.advance,u=Math.max(v,u),g&&this._applyJustification(a,r,t),r=a.length),p=e?p-c:p+c,k=0,++l);else{for(var q=void 0,n=0,x=this._glyphItems;n<x.length&&!(q=x[n][y]);n++);if(q){a.push({codePoint:y,x:k,y:p,vertical:v,glyphMosaicItem:q});k+=q.metrics.advance+f;if(0<h&&k>h&&0<=m){q=m+1;v=a[q].x;u=Math.max(v,u);for(n=
q;n<a.length;n++)a[n].y=e?a[n].y-c:a[n].y+c,a[n].x-=v;g&&this._applyJustification(a,r,m);p=e?p-c:p+c;k-=v;++l;r=q;m=-1}++t;32===y&&(m=a.length-1)}}}t>=r&&(k=a[t],u=Math.max(u,k.x+k.glyphMosaicItem.metrics.advance),g&&this._applyJustification(a,r,t));if(0<a.length)for(b=(g-this._hAnchor)*u,d=(-this._vAnchor*(l+1)+.5)*c,e&&l&&(d+=l*c),e=0;e<a.length;e++)c=a[e],c.x+=b,c.y+=d;return a};m.getTextBox=function(b,e){if(!b.length)return null;for(var d=Infinity,f=Infinity,c=0,g=0,h=0;h<b.length;h++)var a=b[h],
k=a.x,p=a.y-l.SDF_GLYPH_BASELINE,a=k+a.glyphMosaicItem.metrics.advance,m=p+e,d=Math.min(d,k),c=Math.max(c,a),f=Math.min(f,p),g=Math.max(g,m);return{x:d,y:f,width:c-d,height:g-f}};m.getBox=function(b){if(!b.length)return null;for(var e=Infinity,d=Infinity,f=0,c=0,g=0;g<b.length;g++)var h=b[g],a=h.glyphMosaicItem.metrics,k=a.height,l=h.x,h=h.y-(k-Math.abs(a.top)),a=l+a.width+a.left,k=h+k,e=Math.min(e,l),f=Math.max(f,a),d=Math.min(d,h),c=Math.max(c,k);return{x:e,y:d,width:f-e,height:c-d}};m.addDecoration=
function(b,e){var d=b.length;if(0!==d){for(var f=b[0].x+b[0].glyphMosaicItem.metrics.left,c=b[0].y,g=1;g<d;g++){var h=b[g];if(h.y!==c){var a=b[g-1].x+b[g-1].glyphMosaicItem.metrics.left+b[g-1].glyphMosaicItem.metrics.width;b.push({codePoint:0,x:f,y:c+e-3,vertical:!1,glyphMosaicItem:{sdf:!0,rect:new x.default(4,0,4,8),metrics:{width:a-f,height:8,left:0,top:0,advance:0},page:0,code:0}});c=h.y;f=h.x+h.glyphMosaicItem.metrics.left}}d=b[d-1].x+b[d-1].glyphMosaicItem.metrics.left+b[d-1].glyphMosaicItem.metrics.width;
b.push({codePoint:0,x:f,y:c+e-3,vertical:!1,glyphMosaicItem:{sdf:!0,rect:new x.default(4,0,4,8),metrics:{width:d-f,height:8,left:0,top:0,advance:0},page:0,code:0}})}};m.prototype._applyJustification=function(b,e,d){for(var f=b[d],f=(f.x+(f.vertical?l.SDF_GLYPH_SIZE:f.glyphMosaicItem.metrics.advance))*this._justify;e<=d;e++)b[e].x-=f};return m}();l.TextShaping=w});