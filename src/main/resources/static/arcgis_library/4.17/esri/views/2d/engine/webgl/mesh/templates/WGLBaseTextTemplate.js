// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../layers/graphics/featureConversionUtils ../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../definitions ../../enums ../../number ../../materialKey/MaterialKey ./shapingUtils".split(" "),function(z,f,r,p,v,m,w,t,x,q,u,y){Object.defineProperty(f,"__esModule",{value:!0});f.default=function(f){return function(f){function e(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];
a=f.apply(this,a)||this;a._isCIM=!1;a.geometryType=x.WGLGeometryType.TEXT;a._aux=q.i8888to32(0,0,a._referenceSize,a._bitset);return a}r.__extends(e,f);e.prototype.bindTextInfo=function(a,c){var b=this;this._shapingInfo=a&&a.length?p.andThen(a,function(a){return y.shapeGlyphs(a,c,{scale:b._scale,angle:b._angle,xOffset:b._xOffset,yOffset:b._yOffset,hAlign:b._xAlignD,vAlign:b._yAlignD,maxLineWidth:Math.max(32,Math.min(b._lineWidth,512)),lineHeight:t.MAGIC_LABEL_LINE_HEIGHT*Math.max(.25,Math.min(b._lineHeight,
4)),decoration:b._decoration,isCIM:b._isCIM})}):null};e.prototype.writeMeshWithGeometry=function(a,c,b,d,g,l){var k=this;if(p.isSome(this._textPlacement))return b=null!==l&&void 0!==l?l:b.readLegacyGeometry(),this._writePlacedText(a,c,g,b);if(b=l?m.deltaDecodeGeometry(m.convertFromGeometry(l),2):"esriGeometryPolygon"===d?b.readCentroid():b.readUnquantizedGeometry()){if(b.isPoint)return b=b.coords,this._writeGlyphs(a,c,g,{x:b[0],y:b[1]});b.forEachVertex(function(b,d){return k._writeGlyphs(a,c,g,{x:b,
y:d})})}};e.prototype._writePlacedText=function(a,c,b,d){var g=this._shapingInfo;if(!p.isNone(g)){var l=u.MaterialKeyBase.load(this._materialKey),k=p.unwrap(this._textPlacement);if(d=w.CIMMarkerPlacementHelper.getPlacement(d,k,v.pt2px(1))){var h;for(h=d.next();null!=h;){k=q.i1616to32(Math.round(8*h.tx),Math.round(8*h.ty));h=h.getAngle();g.setRotation(h);for(var e=0,f=g.glyphs;e<f.length;e++){var n=f[e];l.textureBinding=n.textureBinding;var m=c.getVector("geometry").vertexCount,r=c.indexVector.length,
t=this._writeIndices(c),n=this._writeVertex(c,b,k,n);a.writeDisplayRecord(this.geometryType,l.data,m,n,r,t)}g.setRotation(-h);h=d.next()}}}};e.prototype._writeGlyphs=function(a,c,b,d){var g=this._shapingInfo;if(!p.isNone(g)){var e=u.MaterialKeyBase.load(this._materialKey);d=q.i1616to32(Math.round(8*d.x),Math.round(8*d.y));for(var k=0,g=g.glyphs;k<g.length;k++){var h=g[k];e.textureBinding=h.textureBinding;var f=c.getVector("geometry").vertexCount,m=c.indexVector.length,n=this._writeIndices(c),h=this._writeVertex(c,
b,d,h);a.writeDisplayRecord(this.geometryType,e.data,f,h,m,n)}}};e.prototype._writeVertexCommon=function(a,c,b,d){d=this._color;var e=this._haloColor,f=q.i8888to32(0,0,this._referenceSize,this._bitset),k=q.i8888to32(0,0,this._size,this._haloSize);a.push(b);a.push(c);a.push(d);a.push(e);a.push(k);a.push(f)};e.prototype._writeVertex=function(a,c,b,d){a=a.get("geometry");this._writeVertexCommon(a,c,b,d);a.push(d.offsets.upperLeft);a.push(d.texcoords.upperLeft);this._writeVertexCommon(a,c,b,d);a.push(d.offsets.upperRight);
a.push(d.texcoords.upperRight);this._writeVertexCommon(a,c,b,d);a.push(d.offsets.lowerLeft);a.push(d.texcoords.lowerLeft);this._writeVertexCommon(a,c,b,d);a.push(d.offsets.lowerRight);a.push(d.texcoords.lowerRight);return 4};e.prototype._writeIndices=function(a){var c=a.getVector("geometry").vertexCount;a=a.indexVector;a.push(c+0);a.push(c+1);a.push(c+2);a.push(c+1);a.push(c+3);a.push(c+2);return 6};return e}(f)}});