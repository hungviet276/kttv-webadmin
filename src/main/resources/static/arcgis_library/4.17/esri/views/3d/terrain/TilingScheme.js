// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/support/TileInfo ../support/projectionUtils".split(" "),function(r,z,w,n,f,x,t,y,p,q){var u=q.webMercator.x2lon,v=q.webMercator.y2lat;r=function(){function c(a){var b=c.checkUnsupported(a);if(b)throw b;this.spatialReference=a.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;
this._isWGS84Comparable=q.canProjectToWGS84ComparableLonLat(this.spatialReference);this.origin=[a.origin.x,a.origin.y];this.pixelSize=a.size[0];this.dpi=a.dpi;var e=a.lods.reduce(function(a,b,e){b.level<a.min&&(a.min=b.level,a.minIndex=e);a.max=Math.max(a.max,b.level);return a},{min:Infinity,minIndex:0,max:-Infinity}),d=a.lods[e.minIndex],l=Math.pow(2,d.level),b=d.resolution*l,d=d.scale*l;this.levels=Array(e.max+1);for(e=0;e<this.levels.length;e++)this.levels[e]={resolution:b,scale:d,tileSize:[b*
a.size[0],b*a.size[1]]},b/=2,d/=2}c.prototype.clone=function(){return new c(this.toTileInfo())};c.prototype.toTileInfo=function(){return new p({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(function(a,b){return{level:b,scale:a.scale,resolution:a.resolution}})})};c.prototype.getExtent=function(a,b,e,d){var c=this.levels[a];a=c.tileSize[0];c=c.tileSize[1];
d[0]=this.origin[0]+e*a;d[2]=d[0]+a;d[3]=this.origin[1]-b*c;d[1]=d[3]-c};c.prototype.convertExtentToRadians=function(a,b){this._isWebMercator?(b[0]=u(a[0]),b[1]=v(a[1]),b[2]=u(a[2]),b[3]=v(a[3])):this._isWGS84Comparable&&(b[0]=f.deg2rad(a[0]),b[1]=f.deg2rad(a[1]),b[2]=f.deg2rad(a[2]),b[3]=f.deg2rad(a[3]))};c.prototype.getExtentGeometry=function(a,b,e,d){void 0===d&&(d=new w.Extent);this.getExtent(a,b,e,h);d.spatialReference=this.spatialReference;d.xmin=h[0];d.ymin=h[1];d.xmax=h[2];d.ymax=h[3];d.zmin=
void 0;d.zmax=void 0;return d};c.prototype.ensureMaxLod=function(a){if(null==a)return!1;for(var b=!1;this.levels.length<=a;){var b=this.levels[this.levels.length-1],e=b.resolution/2;this.levels.push({resolution:e,scale:b.scale/2,tileSize:[e*this.pixelSize,e*this.pixelSize]});b=!0}return b};c.prototype.capMaxLod=function(a){this.levels.length>a+1&&(this.levels.length=a+1)};c.prototype.getMaxLod=function(){return this.levels.length-1};c.prototype.scaleAtLevel=function(a){return this.levels[0].scale/
Math.pow(2,a)};c.prototype.levelAtScale=function(a){var b=this.levels[0].scale;return a>=b?0:Math.log(b/a)*Math.LOG2E};c.prototype.resolutionAtLevel=function(a){return this.levels[0].resolution/Math.pow(2,a)};c.prototype.compatibleWith=function(a){if(!(a instanceof c)){if(c.checkUnsupported(a))return!1;a=new c(a)}if(!a.spatialReference.equals(this.spatialReference)||a.pixelSize!==this.pixelSize)return!1;var b=Math.min(this.levels.length,a.levels.length)-1,e=this.levels[b].resolution,d=.5*e;if(!f.floatEqualAbsolute(a.origin[0],
this.origin[0],d)||!f.floatEqualAbsolute(a.origin[1],this.origin[1],d))return!1;d=.5*e/Math.pow(2,b)/this.pixelSize*12;return f.floatEqualAbsolute(e,a.levels[b].resolution,d)};c.prototype.rootTilesInExtent=function(a,b,e){var d=this.levels[0].tileSize;if(0===d[0]||0===d[1])return[];c.computeRowColExtent(a,d,this.origin,h);a=h[1];var l=h[3],g=h[0],f=h[2],k=f-g,m=l-a;k*m>e&&(e=Math.floor(Math.sqrt(e)),m>e&&(a=a+Math.floor(.5*m)-Math.floor(.5*e),l=a+e),k>e&&(g=g+Math.floor(.5*k)-Math.floor(.5*e),f=g+
e));e=[];for(k=a;k<l;k++)for(m=g;m<f;m++)e.push([0,k,m]);b&&(b[0]=this.origin[0]+g*d[0],b[1]=this.origin[1]-l*d[1],b[2]=this.origin[0]+f*d[0],b[3]=this.origin[1]-a*d[1]);return e};c.computeRowColExtent=function(a,b,e,d){var c=.001*(a[2]-a[0]+(a[3]-a[1]));d[0]=Math.max(0,Math.floor((a[0]+c-e[0])/b[0]));d[2]=Math.max(0,Math.ceil((a[2]-c-e[0])/b[0]));d[1]=Math.max(0,Math.floor((e[1]-a[3]+c)/b[1]));d[3]=Math.max(0,Math.ceil((e[1]-a[1]-c)/b[1]))};c.isPowerOfTwo=function(a){a=a.lods;var b=a[0].resolution*
Math.pow(2,a[0].level);return!a.some(function(a){return!f.floatEqualRelative(a.resolution,b/Math.pow(2,a.level))})};c.hasGapInLevels=function(a){a=a.lods.map(function(a){return a.level});a.sort(function(a,b){return a-b});for(var b=1;b<a.length;b++)if(a[b]!==a[0]+b)return!0;return!1};c.tileSizeSupported=function(a){var b=a.size[1];return b===a.size[0]&&0===(b&b-1)&&128<=b&&512>=b};c.checkUnsupported=function(a){return a?1>a.lods.length?new n("tilingscheme:generic","Tiling scheme must have at least one level"):
c.isPowerOfTwo(a)?c.hasGapInLevels(a)?new n("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):c.tileSizeSupported(a)?null:new n("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new n("tilingscheme:power-of-two","Tiling scheme must be power of two"):new n("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};c.fromExtent=function(a,b){var e=a[2]-a[0],d=a[3]-a[1],f=x.getMetersPerUnitForSR(b),g=1.2*
Math.max(e,d);a=new c(new p({size:[256,256],origin:{x:a[0]-.5*(g-e),y:a[3]+.5*(g-d)},lods:[{level:0,resolution:g/256,scale:1/(256/96*.0254/(g*f))}],spatialReference:b}));a.ensureMaxLod(20);return a};c.makeWebMercatorAuxiliarySphere=function(a){var b=new c(c.WebMercatorAuxiliarySphereTileInfo);b.ensureMaxLod(a);return b};c.makeGCSWithTileSize=function(a,b,e){void 0===b&&(b=256);void 0===e&&(e=16);var d=256/b;a=new c(new p({size:[b,b],origin:{x:-180,y:90,spatialReference:a},spatialReference:a,lods:[{level:0,
resolution:.703125*d,scale:2.95497598570834E8*d}]}));a.ensureMaxLod(e);return a};Object.defineProperty(c.prototype,"test",{get:function(){return{isWebMercator:this._isWebMercator,isWGS84:this._isWGS84Comparable}},enumerable:!1,configurable:!0});c.WebMercatorAuxiliarySphereTileInfo=new p({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:t.WebMercator},spatialReference:t.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});c.WebMercatorAuxiliarySphere=
c.makeWebMercatorAuxiliarySphere(19);return c}();var h=y.create();return r});