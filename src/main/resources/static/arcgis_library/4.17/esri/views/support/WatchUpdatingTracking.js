// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Accessor ../../core/Handles ../../core/scheduling ../../core/watchUtils ../../core/accessorSupport/wire ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass".split(" "),function(m,c,h,n,p,q,k,r,t,u){Object.defineProperty(c,"__esModule",{value:!0});c.WatchUpdatingTracking=void 0;m=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.updating=!1;a.handleId=0;a.handles=new p;a.scheduleHandleId=0;a.pendingPromises=
new Set;return a}h.__extends(b,c);b.prototype.destroy=function(){this.removeAll();this.handles.destroy()};b.prototype.add=function(a,e,f,d){var b=this;void 0===d&&(d=0);var c=0!==(d&1),l=++this.handleId;c||this.installSyncUpdatingWatch(a,e,l);a=0!==(d&2)?k.init(a,e,f,c):a.watch(e,f,c);this.handles.add(a,l);return{remove:function(){b.handles.remove(l)}}};b.prototype.addOnCollectionPropertyChange=function(a,e,f,d){var b=this;void 0===d&&(d=0);d=0!==(d&2);var c=++this.handleId;this.handles.add([k.on(a,
e,"after-changes",this.createSyncUpdatingCallback()),k.on(a,e,"change",f,d?function(a){f({added:a.items,removed:[],moved:[],target:a})}:void 0)],c);return{remove:function(){b.handles.remove(c)}}};b.prototype.addOnCollectionChange=function(a,e,b){var d=this;void 0===b&&(b=0);b=0!==(b&2);var c=++this.handleId;this.handles.add([a.on("after-changes",this.createSyncUpdatingCallback()),a.on("change",e)],c);b&&e({added:a.items,removed:[],moved:[],target:a});return{remove:function(){d.handles.remove(c)}}};
b.prototype.addPromise=function(a){var b=this;if(!a)return a;var c=++this.handleId;this.handles.add({remove:function(){b.pendingPromises.delete(a)&&(0!==b.pendingPromises.size||b.handles.has(g)||b._set("updating",!1))}},c);this.pendingPromises.add(a);this._set("updating",!0);var d=function(){return b.handles.remove(c)};a.then(d,d);return a};b.prototype.removeAll=function(){this.pendingPromises.clear();this.handles.removeAll();this._set("updating",!1)};b.prototype.installSyncUpdatingWatch=function(a,
b,c){a=r.default(a,b,this.createSyncUpdatingCallback());this.handles.add(a,c);return a};b.prototype.createSyncUpdatingCallback=function(){var a=this;return function(){a.handles.remove(g);++a.scheduleHandleId;var b=a.scheduleHandleId;a._get("updating")||a._set("updating",!0);a.handles.add(q.schedule(function(){b===a.scheduleHandleId&&(a._set("updating",0<a.pendingPromises.size),a.handles.remove(g))}),g)}};h.__decorate([t.property({readOnly:!0})],b.prototype,"updating",void 0);return b=h.__decorate([u.subclass("esri.views.support.WatchUpdatingTracking")],
b)}(n);c.WatchUpdatingTracking=m;var g=-42});