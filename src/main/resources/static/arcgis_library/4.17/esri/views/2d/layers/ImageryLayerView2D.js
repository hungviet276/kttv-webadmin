// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/LayerView2D":function(){define("require exports tslib ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),function(z,k,h,x,w,m,p,t,u,v,y,b){Object.defineProperty(k,"__esModule",{value:!0});k.LayerView2DMixin=void 0;var d=x.ofType({key:"type",base:u,
typeMap:{rect:v,path:b,geometry:y}});k.LayerView2DMixin=function(b){return function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.clips=new d;a.moving=!1;a.attached=!1;a.lastUpdateId=-1;a.updateRequested=!1;return a}h.__extends(a,c);a.prototype.initialize=function(){var a=this,c;this.container||(this.container=new t.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=this.clips;this.handles.add([m.init(this,"suspended",function(c){a.container&&
(a.container.visible=!c);a.view&&!c&&a.updateRequested&&a.view.requestUpdate()},!0),m.init(this,["layer.opacity","container"],function(){var c,e;a.container&&(a.container.opacity=null!==(e=null===(c=a.layer)||void 0===c?void 0:c.opacity)&&void 0!==e?e:1)},!0),m.init(this,["layer.blendMode"],function(c){a.container&&(a.container.blendMode=c)},!0),m.init(this,["layer.effect"],function(c){a.container&&(a.container.effect=c)},!0),this.clips.on("change",function(){a.container.clips=a.clips;a.notifyChange("clips")})]);
(null===(c=this.view)||void 0===c?0:c.whenLayerView)?this.view.whenLayerView(this.layer).then(function(c){c!==a||a.attached||a.destroyed||(a.attach(),a.requestUpdate(),a.attached=!0)},function(){}):this.when().then(function(){a.attached||a.destroyed||(a.attach(),a.requestUpdate(),a.attached=!0)},function(){})};a.prototype.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};Object.defineProperty(a.prototype,"updating",{get:function(){return!this.attached||
!this.suspended&&(this.updateRequested||this.isUpdating())},enumerable:!1,configurable:!0});a.prototype.isVisibleAtScale=function(a){var c=!0,r=this.layer,b=r.minScale,r=r.maxScale;if(null!=b&&null!=r){var c=!b,l=!r;!c&&a<=b&&(c=!0);!l&&a>=r&&(l=!0);c=c&&l}return c};a.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};a.prototype.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",
a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};a.prototype.isUpdating=function(){return!1};a.prototype.isRendering=function(){return!1};a.prototype.canResume=function(){return c.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};h.__decorate([p.property({type:d,set:function(a){a=w.referenceSetter(a,this._get("clips"),d);this._set("clips",a)}})],a.prototype,"clips",void 0);h.__decorate([p.property()],a.prototype,"moving",void 0);h.__decorate([p.property()],
a.prototype,"attached",void 0);h.__decorate([p.property()],a.prototype,"container",void 0);h.__decorate([p.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],a.prototype,"suspended",void 0);h.__decorate([p.property({readOnly:!0})],a.prototype,"updateParameters",void 0);h.__decorate([p.property()],a.prototype,"updateRequested",void 0);h.__decorate([p.property({dependsOn:["attached","updateRequested","suspended"]})],a.prototype,"updating",null);h.__decorate([p.property()],a.prototype,
"view",void 0);return a=h.__decorate([p.subclass("esri.views.2d.layers.LayerView2D")],a)}(b)}})},"esri/views/layers/support/ClipArea":function(){define(["require","exports","tslib","../../../core/JSONSupport","../../../core/accessorSupport/decorators"],function(z,k,h,x,w){return function(m){function p(){return null!==m&&m.apply(this,arguments)||this}h.__extends(p,m);return p=h.__decorate([w.subclass("esri.views.layers.support.ClipArea")],p)}(x.JSONSupport)})},"esri/views/layers/support/ClipRect":function(){define(["require",
"exports","tslib","../../../core/accessorSupport/decorators","./ClipArea"],function(z,k,h,x,w){return function(m){function p(){var h=null!==m&&m.apply(this,arguments)||this;h.type="rect";h.left=null;h.right=null;h.top=null;h.bottom=null;return h}h.__extends(p,m);k=p;p.prototype.clone=function(){return new k({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(p.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});
var k;h.__decorate([x.property({type:[Number,String],json:{write:!0}})],p.prototype,"left",void 0);h.__decorate([x.property({type:[Number,String],json:{write:!0}})],p.prototype,"right",void 0);h.__decorate([x.property({type:[Number,String],json:{write:!0}})],p.prototype,"top",void 0);h.__decorate([x.property({type:[Number,String],json:{write:!0}})],p.prototype,"bottom",void 0);h.__decorate([x.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],p.prototype,"version",null);return p=k=
h.__decorate([x.subclass("esri.views.layers.support.ClipRect")],p)}(w)})},"esri/views/layers/support/Geometry":function(){define("require exports tslib ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),function(z,k,h,x,w,m,p,t){var u={base:m,key:"type",typeMap:{extent:x.Extent,polygon:x.Polygon}};return function(m){function k(){var b=null!==m&&m.apply(this,arguments)||this;b.type="geometry";b.geometry=null;
return b}h.__extends(k,m);b=k;Object.defineProperty(k.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});k.prototype.clone=function(){return new b({geometry:this.geometry.clone()})};var b;h.__decorate([w.property({types:u,json:{read:p.fromJSON,write:!0}})],k.prototype,"geometry",void 0);h.__decorate([w.property({readOnly:!0,dependsOn:["geometry"]})],k.prototype,"version",null);return k=b=h.__decorate([w.subclass("esri.views.layers.support.Geometry")],
k)}(t)})},"esri/views/layers/support/Path":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","./ClipArea"],function(z,k,h,x,w){return function(k){function p(){var h=null!==k&&k.apply(this,arguments)||this;h.type="path";h.path=[];return h}h.__extends(p,k);Object.defineProperty(p.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});h.__decorate([x.property({type:[[[Number]]],json:{write:!0}})],p.prototype,"path",
void 0);h.__decorate([x.property({readOnly:!0,dependsOn:["path"]})],p.prototype,"version",null);return p=h.__decorate([x.subclass("esri.views.layers.support.Path")],p)}(w)})},"esri/views/2d/layers/imagery/ImageryGraphicsView2D":function(){define("require exports tslib ../../../../Graphic ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../support/GraphicsCollection ../../engine/Container ../LayerView2D ../graphics/GraphicsView2D ../../../layers/LayerView".split(" "),
function(z,k,h,x,w,m,p,t,u,v,y,b,d,f){Object.defineProperty(k,"__esModule",{value:!0});var c=w.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D");z=function(a){function b(){var c=null!==a&&a.apply(this,arguments)||this;c.container=new y.Container;c._graphicsView=null;c.type="Graphics";c._graphics=new v.default;c._updateGraphics=m.debounce(function(a,b){return h.__awaiter(c,void 0,void 0,function(){var c,r,e,n,f,d,q,k,p,x=this;return h.__generator(this,function(g){switch(g.label){case 0:if(!a.stationary)return[2];
c=a.state;r=new u({xmin:c.extent.xmin,ymin:c.extent.ymin,xmax:c.extent.xmax,ymax:c.extent.ymax,spatialReference:c.spatialReference});e=a.state.size[0];n=a.state.size[1];f={};f.timeExtent=this.timeExtent;f.requestAsImageElement=!1;f.signal=b;d=this._getVectorFieldExportParams({extent:r,width:e,height:n});return[4,this.layer.fetchImage(d.extent,d.width,d.height,f)];case 1:q=g.sent();k=this.layer.renderer;if("vector-field"!==k.type)return[3,4];this._pixelData={extent:d.extent,pixelBlock:q.pixelData.pixelBlock};
return[4,k.getGraphicsFromPixelData(q.pixelData,"vector-uv"===this.layer.rasterInfo.dataType)];case 2:return p=g.sent(),this._graphicsView.update(a),[4,m.after(0).then(function(){x._graphics.set("items",p)})];case 3:g.sent(),g.label=4;case 4:return[2]}})})});return c}h.__extends(b,a);Object.defineProperty(b.prototype,"updating",{get:function(){var a;return null===(a=this._graphicsView)||void 0===a?void 0:a.updating},enumerable:!1,configurable:!0});b.prototype.update=function(a){this._updateGraphics(a).catch(function(a){m.isAbortError(a)||
c.error(a)})};b.prototype.hitTest=function(a,c){if(this.suspended)return m.resolve(null);a=this.view.toMap(p.createScreenPoint(a,c));return m.resolve(new x({attributes:{},geometry:a,layer:this.layer}))};b.prototype.attach=function(){var a=this;this._graphicsView=new d.default({view:this.view,graphics:this._graphics,requestUpdateCallback:function(){return a.requestUpdate()}})};b.prototype.detach=function(){this._graphics.destroy();this._graphicsView.destroy();this.container.removeChild(this._graphicsView.container);
this._graphicsView=null};b.prototype.moveStart=function(){};b.prototype.viewChange=function(){};b.prototype.moveEnd=function(){};b.prototype.install=function(a){this.container.addChild(this._graphicsView.container);a.addChild(this.container)};b.prototype.uninstall=function(a){this.container.removeChild(this._graphicsView.container);a.removeChild(this.container)};b.prototype.isUpdating=function(){return this._graphicsView.updating||this.updateRequested};b.prototype.getPixelData=function(){return this.updating?
null:this._pixelData};b.prototype.redraw=function(){};b.prototype._getVectorFieldExportParams=function(a){var c,b,e=a.extent,g=a.width;a=a.height;var f=this.layer,d=null===(c=f.fullExtent)||void 0===c?void 0:c.xmin;c=null===(b=f.fullExtent)||void 0===b?void 0:b.ymax;var q;"vector-field"===f.renderer.type&&(q=f.renderer.symbolTileSize);q=Math.max(q||0,30);g=Math.ceil(1/q*g);a=Math.ceil(1/q*a);b=(e.xmax-e.xmin)/g;q=(e.ymax-e.ymin)/a;e.xmin=d+Math.floor((e.xmin-d)/b)*b;e.xmax=d+Math.ceil((e.xmax-d)/
b)*b;e.ymin=c+Math.floor((e.ymin-c)/q)*q;e.ymax=c+Math.ceil((e.ymax-c)/q)*q;return{extent:e,width:g,height:a}};h.__decorate([t.property()],b.prototype,"container",void 0);h.__decorate([t.property()],b.prototype,"layer",void 0);h.__decorate([t.property()],b.prototype,"timeExtent",void 0);h.__decorate([t.property({dependsOn:["_graphicsView.updating"]})],b.prototype,"updating",null);h.__decorate([t.property()],b.prototype,"_graphicsView",void 0);h.__decorate([t.enumeration({graphics:"Graphics"})],b.prototype,
"type",void 0);return b=h.__decorate([t.subclass("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],b)}(b.LayerView2DMixin(f));k.default=z})},"esri/views/2d/layers/imagery/ImageryView2D":function(){define("require exports tslib ../../../../Graphic ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/rasterFunctions/pixelUtils ../../engine/BitmapContainer ../../engine/Container ../../engine/ImageryBitmapSource ../LayerView2D ../support/ExportStrategy ../../../layers/LayerView".split(" "),
function(z,k,h,x,w,m,p,t,u,v,y,b,d,f,c){Object.defineProperty(k,"__esModule",{value:!0});var a=w.getLogger("esri.views.2d.layers.imagery.ImageryView2D");z=function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;a.container=new y.Container;a.type="Imagery";a._bitmapView=null;return a}h.__extends(e,c);Object.defineProperty(e.prototype,"updating",{get:function(){var a;return null===(a=this.strategy)||void 0===a?void 0:a.updating},enumerable:!1,configurable:!0});e.prototype.update=function(c){this.strategy.update(c).catch(function(c){m.isAbortError(c)||
a.error(c)})};e.prototype.detach=function(){this.strategy.destroy();this._bitmapView.removeAllChildren();this.container.removeAllChildren()};e.prototype.hitTest=function(a,c){if(this.suspended)return m.resolve(null);a=this.view.toMap(p.createScreenPoint(a,c));return m.resolve(new x({attributes:{},geometry:a,layer:this.layer}))};e.prototype.attach=function(){var a=this,c=10<=this.layer.version,b=10.1<=this.layer.version?this.layer.imageMaxHeight:2048,g=10.1<=this.layer.version?this.layer.imageMaxWidth:
2048;this._bitmapView=new v.BitmapContainer;this.strategy=new f({container:this._bitmapView,imageNormalizationSupported:c,imageMaxHeight:b,imageMaxWidth:g,fetchSource:this._fetchImage.bind(this),requestUpdate:function(){return a.requestUpdate()}})};e.prototype.moveStart=function(){};e.prototype.viewChange=function(){};e.prototype.moveEnd=function(){};e.prototype.install=function(a){this.container.addChild(this._bitmapView);a.addChild(this.container)};e.prototype.uninstall=function(a){this.container.removeChild(this._bitmapView);
a.removeChild(this.container)};e.prototype.redraw=function(){var a=this;this.strategy.updateExports(function(c){c.source instanceof HTMLImageElement?c.requestRender():a.layer.applyRenderer({pixelBlock:c.source.pixelBlock}).then(function(b){var g=c.source;g.pixelBlock=b.pixelBlock;g.filter=function(c){return a.layer.applyFilter(c)};a.container.requestRender()})})};e.prototype.isUpdating=function(){return this.strategy.updating||this.updateRequested};e.prototype.getPixelData=function(){if(this.updating)return null;
var a=this.strategy.container.children;if(1===a.length&&a[0].source)return{extent:a[0].source.extent,pixelBlock:a[0].source.originalPixelBlock};if(1<a.length){var c=this.view.extent,a=a.map(function(a){return a.source}).filter(function(a){return a.extent&&a.extent.intersects(c)}).map(function(a){return{extent:a.extent,pixelBlock:a.originalPixelBlock}});return(a=u.mosaicPixelData(a,c))?{extent:a.extent,pixelBlock:a.pixelBlock}:null}return null};e.prototype._fetchImage=function(a,c,e,g){var f=this;
g=g||{};g.timeExtent=this.timeExtent;g.requestAsImageElement=!0;return this.layer.fetchImage(a,c,e,g).then(function(a){return a.imageElement?a.imageElement:f.layer.applyRenderer(a.pixelData,{signal:g.signal}).then(function(c){c=new b.default(c.pixelBlock,c.extent.clone(),a.pixelData.pixelBlock);c.filter=function(a){return f.layer.applyFilter(a)};return c})})};h.__decorate([t.property()],e.prototype,"container",void 0);h.__decorate([t.property()],e.prototype,"layer",void 0);h.__decorate([t.property()],
e.prototype,"strategy",void 0);h.__decorate([t.property()],e.prototype,"timeExtent",void 0);h.__decorate([t.property({dependsOn:["strategy.updating"]})],e.prototype,"updating",null);h.__decorate([t.enumeration({imagery:"Imagery"})],e.prototype,"type",void 0);return e=h.__decorate([t.subclass("esri.views.2d.layers.imagery.ImageryView2D")],e)}(d.LayerView2DMixin(c));k.default=z})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(z,k,h){function x(b,
d){b=Math.min(Math.max(b,-100),100);d=Math.min(Math.max(d,-100),100);var f,c,a=new Uint8Array(256);for(f=0;256>f;f++)0<b&&100>b?c=(200*f-25500+510*d)/(2*(100-b))+128:0>=b&&-100<b?c=(200*f-25500+510*d)*(100+b)/2E4+128:100===b?(c=200*f-25500+256*(100-b)+510*d,c=0<c?255:0):-100===b&&(c=128),a[f]=255<c?255:0>c?0:c;return a}function w(b,d,f,c,a,q,e,r){return{xmin:a<=f*b?0:a<f*b+b?a-f*b:b,ymin:q<=c*d?0:q<c*d+d?q-c*d:d,xmax:a+e<=f*b?0:a+e<f*b+b?a+e-f*b:b,ymax:q+r<=c*d?0:q+r<c*d+d?q+r-c*d:d}}function m(b,
d,f,c){var a=b.filter(function(a){return y(a)})[0];if(null==a)return null;var q=c?c.width:d.width;c=c?c.height:d.height;var e=a.width,r=a.height,n=d.width/e;d=d.height/r;var l=f?f.x:0;f=f?f.y:0;var g=a.pixelType,F=h.getPixelArrayConstructor(g),R=a.pixels.length,a=[],k,p,m,C,x,t,v,B,A,u;for(x=0;x<R;x++){p=new F(q*c);for(t=0;t<d;t++)for(v=0;v<n;v++)if(m=b[t*n+v])for(k=m.pixels[x],u=w(e,r,v,t,l,f,q,c),B=u.ymin;B<u.ymax;B++)for(m=(t*r+B-f)*q+(v*e-l),C=B*e,A=u.xmin;A<u.xmax;A++)p[m+A]=k[C+A];a.push(p)}var z;
if(b.some(function(a){return null==a||a.mask&&0<a.mask.length}))for(z=new Uint8Array(q*c),t=0;t<d;t++)for(v=0;v<n;v++)if(F=(m=b[t*n+v])?m.mask:null,u=w(e,r,v,t,l,f,q,c),F)for(B=u.ymin;B<u.ymax;B++)for(m=(t*r+B-f)*q+(v*e-l),C=B*e,A=u.xmin;A<u.xmax;A++)z[m+A]=F[C+A];else if(m)for(B=u.ymin;B<u.ymax;B++)for(m=(t*r+B-f)*q+(v*e-l),C=B*e,A=u.xmin;A<u.xmax;A++)z[m+A]=1;else for(B=u.ymin;B<u.ymax;B++)for(m=(t*r+B-f)*q+(v*e-l),C=B*e,A=u.xmin;A<u.xmax;A++)z[m+A]=0;b=new h({width:q,height:c,pixels:a,pixelType:g,
mask:z});b.updateStatistics();return b}function p(b){if(!y(b))return null;var d=b.clone(),f=b.width,c=b.height,a=b.mask;b=b.pixels[0];for(var q=d.pixels[0],e=2;e<c-1;e++){for(var r=new Map,n=e-2;n<e+2;n++)for(var l=0;4>l;l++){var g=n*f+l;v(r,b[g],a?a[g]:1)}q[e*f]=t(r);q[e*f+1]=q[e*f+2]=q[e*f];for(n=3;n<f-1;n++)g=(e-2)*f+n+1,v(r,b[g],a?a[g]:1),g=(e-1)*f+n+1,v(r,b[g],a?a[g]:1),g=e*f+n+1,v(r,b[g],a?a[g]:1),g=(e+1)*f+n+1,v(r,b[g],a?a[g]:1),g=(e-2)*f+n-3,u(r,b[g],a?a[g]:1),g=(e-1)*f+n-3,u(r,b[g],a?a[g]:
1),g=e*f+n-3,u(r,b[g],a?a[g]:1),g=(e+1)*f+n-3,u(r,b[g],a?a[g]:1),q[e*f+n]=t(r);q[e*f+n+1]=q[e*f+n]}for(n=0;n<f;n++)q[n]=q[f+n]=q[2*f+n],q[(c-1)*f+n]=q[(c-2)*f+n];d.updateStatistics();return d}function t(b){if(0===b.size)return 0;for(var d=0,f=-1,c=0,a=b.keys(),q=a.next();!q.done;)c=b.get(q.value),c>d&&(f=q.value,d=c),q=a.next();return f}function u(b,d,f){0!==f&&(f=b.get(d),1===f?b.delete(d):b.set(d,f-1))}function v(b,d,f){0!==f&&b.set(d,b.has(d)?b.get(d)+1:1)}Object.defineProperty(k,"__esModule",
{value:!0});k.approximateTransform=k.clip=k.resampleByMajority=k.setValidBoundary=k.mosaic=k.mosaicPixelData=k.getClipBounds=k.remapColor=k.lookupPixels=k.stretch=k.createContrastBrightnessLUT=k.createStretchLUT=k.estimateStatisticsFromHistograms=k.estimateStatisticsHistograms=k.colorize=k.createColormapLUT=k.extractBands=void 0;var y=function(b){return b&&"esri.layers.support.PixelBlock"===b.declaredClass&&b.pixels&&0<b.pixels.length};k.extractBands=function(b,d){if(!d||!y(b))return b;var f=b.pixels.length;
return d&&d.some(function(c){return c>=f})||1===f&&1===d.length&&0===d[0]||f===d.length&&!d.some(function(c,a){return c!==a})?b:new h({pixelType:b.pixelType,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:d.map(function(c){return b.pixels[c]}),statistics:b.statistics&&d.map(function(c){return b.statistics[c]})})};k.createColormapLUT=function(b){if(b){var d=b.colormap;if(d&&0!==d.length){var d=d.sort(function(a,c){return a[0]-c[0]}),f=0;
0>d[0][0]&&(f=d[0][0]);var c=Math.max(256,d[d.length-1][0]-f+1),a=new Uint8Array(4*c),q=[],e=0,r=0,n=5===d[0].length;if(65536<c)return d.forEach(function(a){q[a[0]-f]=n?a.slice(1):a.slice(1).concat([255])}),{indexed2DColormap:q,offset:f,alphaSpecified:n};if(b.fillUnspecified)for(b=d[r],e=b[0]-f;e<c;e++)a[4*e]=b[1],a[4*e+1]=b[2],a[4*e+2]=b[3],a[4*e+3]=n?b[4]:255,e===b[0]-f&&(b=r===d.length-1?b:d[++r]);else for(e=0;e<d.length;e++)b=d[e],r=4*(b[0]-f),a[r]=b[1],a[r+1]=b[2],a[r+2]=b[3],a[r+3]=n?b[4]:255;
return{indexedColormap:a,offset:f,alphaSpecified:n}}}};k.colorize=function(b,d){if(!y(b)||!d&&(d.indexedColormap||d.indexed2DColormap))return b;var f=b.clone(),c=f.pixels,a=f.mask,q=f.width*f.height;if(1!==c.length)return b;var e=d.indexedColormap;b=d.indexed2DColormap;var r=d.offset;d=d.alphaSpecified;var n=e.length-1,l=0,c=c[0],g=new Uint8Array(c.length),F=new Uint8Array(c.length),h=new Uint8Array(c.length),k=0;if(e)if(a)for(l=0;l<q;l++)a[l]&&(k=4*(c[l]-r),k<r||k>n?a[l]=0:(g[l]=e[k],F[l]=e[k+1],
h[l]=e[k+2],a[l]=e[k+3]));else{a=new Uint8Array(q);for(l=0;l<q;l++)k=4*(c[l]-r),k<r||k>n?a[l]=0:(g[l]=e[k],F[l]=e[k+1],h[l]=e[k+2],a[l]=e[k+3]);f.mask=a}else if(a)for(l=0;l<q;l++)a[l]&&(e=b[c[l]],g[l]=e[0],F[l]=e[1],h[l]=e[2],a[l]=e[3]);else{a=new Uint8Array(q);for(l=0;l<q;l++)e=b[c[l]],g[l]=e[0],F[l]=e[1],h[l]=e[2],a[l]=e[3];f.mask=a}f.pixels=[g,F,h];f.statistics=null;f.pixelType="u8";f.maskIsAlpha=d;return f};k.estimateStatisticsHistograms=function(b){if(!y(b))return null;b.statistics||b.updateStatistics();
var d=b.pixels,f=b.mask,c=b.pixelType,a=b.statistics;b=b.width*b.height;var q=d.length,e,r,n,l,g,h=[],k=[],p,m,t;for(l=0;l<q;l++){p=new Uint32Array(256);t=d[l];if("u8"===c)if(e=-.5,r=255.5,f)for(g=0;g<b;g++)f[g]&&p[t[g]]++;else for(g=0;g<b;g++)p[t[g]]++;else{e=a[l].minValue;r=a[l].maxValue;n=(r-e)/256;m=new Uint32Array(257);if(f)for(g=0;g<b;g++)f[g]&&m[Math.floor((t[g]-e)/n)]++;else for(g=0;g<b;g++)m[Math.floor((t[g]-e)/n)]++;for(g=0;255>g;g++)p[g]=m[g];p[255]=m[255]+m[256]}h.push({min:e,max:r,size:256,
counts:p});for(g=t=m=n=0;256>g;g++)n+=p[g],m+=g*p[g];m/=n;for(g=0;256>g;g++)t+=p[g]*Math.pow(g-m,2);p=Math.sqrt(t/(n-1));n=(r-e)/256;g=(m+.5)*n+e;p*=n;k.push({min:e,max:r,avg:g,stddev:p})}return{statistics:k,histograms:h}};k.estimateStatisticsFromHistograms=function(b){for(var d=[],f=0;f<b.length;f++){for(var c=b[f],a=c.min,q=c.max,e=c.size,r=c.counts,n=c=0,l=0;l<e;l++)c+=r[l],n+=l*r[l];for(var n=n/c,g=0,l=0;l<e;l++)g+=r[l]*Math.pow(l-n,2);e=(q-a)/e;d.push({min:a,max:q,avg:(n+.5)*e+a,stddev:Math.sqrt(g/
(c-1))*e})}return d};k.createStretchLUT=function(b){var d=b.minCutOff,f=b.maxCutOff,c=b.gamma,a=b.pixelType,q=b.outMin||0,e=b.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(a))return null;var r=d.length,n,l=0;"s8"===a?l=-127:"s16"===a&&(l=-32767);var g=256;-1<["u16","s16"].indexOf(a)&&(g=65536);for(var h=[],k=e-q,a=0;a<r;a++)h[a]=f[a]-d[a];n=c&&c.length>=r;var p=[];if(n)for(a=0;a<r;a++)p[a]=1<c[a]?2<c[a]?6.5+Math.pow(c[a]-2,2.5):6.5+100*Math.pow(2-c[a],4):1;var m,t=[],C,w,u;if(n)for(a=0;a<r;a++){u=
[];for(n=0;n<g;n++)C=n+l,m=(C-d[a])/h[a],w=1,1<c[a]&&(w-=Math.pow(1/k,m*p[a])),u[n]=C<f[a]&&C>d[a]?Math.floor(w*k*Math.pow(m,1/c[a]))+q:C>=f[a]?e:q;t[a]=u}else for(a=0;a<r;a++){u=[];for(n=0;n<g;n++)C=n+l,u[n]=C<=d[a]?q:C>=f[a]?e:Math.floor((C-d[a])/h[a]*k)+q;t[a]=u}if(null!=b.contrastOffset)for(b=x(b.contrastOffset,b.brightnessOffset),a=0;a<r;a++)for(u=t[a],n=0;n<g;n++)u[n]=b[u[n]];return{lut:t,offset:l}};k.createContrastBrightnessLUT=x;k.stretch=function(b,d){if(!y(b))return null;b=b.clone();var f=
b.pixels,c=b.mask,a=d.minCutOff,q=d.maxCutOff,e=d.gamma,r=d.outMin||0;d=d.outMax||255;var n=b.width*b.height,l=f.length,g,h,k,p,m,t=d-r,x=[];for(g=0;g<l;g++)x[g]=q[g]-a[g];h=e&&e.length>=l;var w=[];if(h)for(g=0;g<l;g++)w[g]=1<e[g]?2<e[g]?6.5+Math.pow(e[g]-2,2.5):6.5+100*Math.pow(2-e[g],4):1;if(h)if(null!=c)for(h=0;h<n;h++){if(c[h])for(g=0;g<l;g++)k=f[g][h],m=(k-a[g])/x[g],p=1,1<e[g]&&(p-=Math.pow(1/t,m*w[g])),f[g][h]=k<q[g]&&k>a[g]?Math.floor(p*t*Math.pow(m,1/e[g]))+r:k>=q[g]?d:r}else for(h=0;h<n;h++)for(g=
0;g<l;g++)k=f[g][h],m=(k-a[g])/x[g],p=1,1<e[g]&&(p-=Math.pow(1/t,m*w[g])),f[g][h]=k<q[g]&&k>a[g]?Math.floor(p*t*Math.pow(m,1/e[g]))+r:k>=q[g]?d:r;else if(null!=c)for(h=0;h<n;h++){if(c[h])for(g=0;g<l;g++)k=f[g][h],f[g][h]=k<q[g]&&k>a[g]?Math.floor((k-a[g])/x[g]*t)+r:k>=q[g]?d:r}else for(h=0;h<n;h++)for(g=0;g<l;g++)k=f[g][h],f[g][h]=k<q[g]&&k>a[g]?Math.floor((k-a[g])/x[g]*t)+r:k>=q[g]?d:r;b.pixelType="u8";b.updateStatistics();return b};k.lookupPixels=function(b,d){if(!y(b))return null;var f=b.pixels,
c=b.mask,a=b.width*b.height,q=f.length,e=d.lut;d=d.offset;var r,n;e&&1===e[0].length&&(e=f.map(function(){return e}));var l=[],g,k,p;if(d)if(null==c)for(r=0;r<q;r++){g=f[r];k=e[r];p=new Uint8Array(a);for(n=0;n<a;n++)p[n]=k[g[n]-d];l.push(p)}else for(r=0;r<q;r++){g=f[r];k=e[r];p=new Uint8Array(a);for(n=0;n<a;n++)c[n]&&(p[n]=k[g[n]-d]);l.push(p)}else if(null==c)for(r=0;r<q;r++){g=f[r];k=e[r];p=new Uint8Array(a);for(n=0;n<a;n++)p[n]=k[g[n]];l.push(p)}else for(r=0;r<q;r++){g=f[r];k=e[r];p=new Uint8Array(a);
for(n=0;n<a;n++)c[n]&&(p[n]=k[g[n]]);l.push(p)}b=new h({width:b.width,height:b.height,pixels:l,mask:c,pixelType:"u8"});b.updateStatistics();return b};k.remapColor=function(b,d){if(!y(b))return null;b=b.clone();var f=b.width*b.height,c=d.length,a=Math.floor(c/2),q=d[Math.floor(a)],e=b.pixels[0],r,n,l,g,h,k,p=!1,m=new Uint8Array(f),t=new Uint8Array(f),x=new Uint8Array(f),w=b.mask,u=4===d[0].mappedColor.length;w||(w=new Uint8Array(f),w.fill(u?255:1),b.mask=w);for(h=0;h<f;h++)if(w[h]){r=e[h];p=!1;k=a;
n=q;l=0;for(g=c-1;1<g-l;){if(r===n.value){p=!0;break}r>n.value?l=k:g=k;k=Math.floor((l+g)/2);n=d[Math.floor(k)]}p||(r===d[l].value?(n=d[l],p=!0):r===d[g].value?(n=d[g],p=!0):r<d[l].value?(p=!1,n=null):r>d[l].value&&(r<d[g].value?(n=d[l],p=!0):g===c-1?(p=!1,n=null):(n=d[g],p=!0)));p?(m[h]=n.mappedColor[0],t[h]=n.mappedColor[1],x[h]=n.mappedColor[2],w[h]=n.mappedColor[3]):m[h]=t[h]=x[h]=w[h]=0}b.pixels=[m,t,x];b.mask=w;b.pixelType="u8";b.maskIsAlpha=u;return b};k.getClipBounds=w;k.mosaicPixelData=function(b,
d){if(!b||0===b.length)return null;var f=b.filter(function(a){return a.pixelBlock})[0];if(!f)return null;var c=(f.extent.xmax-f.extent.xmin)/f.pixelBlock.width,a=(f.extent.ymax-f.extent.ymin)/f.pixelBlock.height,q=.01*Math.min(c,a),e=b.sort(function(a,c){return Math.abs(a.extent.ymax-c.extent.ymax)>q?c.extent.ymax-a.extent.ymax:Math.abs(a.extent.xmin-c.extent.xmin)>q?a.extent.xmin-c.extent.xmin:0}),r=Math.min.apply(null,e.map(function(a){return a.extent.xmin})),n=Math.min.apply(null,e.map(function(a){return a.extent.ymin})),
l=Math.max.apply(null,e.map(function(a){return a.extent.xmax})),g=Math.max.apply(null,e.map(function(a){return a.extent.ymax}));b={x:Math.round((d.xmin-r)/c),y:Math.round((g-d.ymax)/a)};r={width:Math.round((l-r)/c),height:Math.round((g-n)/a)};c={width:Math.round((d.xmax-d.xmin)/c),height:Math.round((d.ymax-d.ymin)/a)};if(Math.round(r.width/f.pixelBlock.width)*Math.round(r.height/f.pixelBlock.height)!==e.length||0>b.x||0>b.y||r.width<c.width||r.height<c.height)return null;f=e.map(function(a){return a.pixelBlock});
f=m(f,r,b,c);return{extent:d,pixelBlock:f}};k.mosaic=m;k.setValidBoundary=function(b,d,f){if(!y(b))return null;var c=b.width,a=b.height,q=d.x;d=d.y;var e=f.width+q;f=f.height+d;if(0>q||0>d||e>c||f>a||0===q&&0===d&&e===c&&f===a)return b;b.mask||(b.mask=new Uint8Array(c*a));for(var r=b.mask,n=0;n<a;n++)for(var l=n*c,g=0;g<c;g++)r[l+g]=n<d||n>=f||g<q||g>=e?0:1;b.updateStatistics();return b};k.resampleByMajority=p;k.clip=function(b,d,f){var c=d.x;d=d.y;var a=f.width,q=f.height;if(0===c&&0===d&&q===b.height&&
a===b.width)return b;var e=b.width,r=Math.max(0,d),n=Math.max(0,c),l=Math.min(c+a,e),g=Math.min(d+q,b.height);if(0>l||0>g||!y(b))return null;c=Math.max(0,-c);d=Math.max(0,-d);for(var k=b.pixels,p=b.mask,m=a*q,t=k.length,q=[],x=0;x<t;x++){for(var w=k[x],u=h.createEmptyBand(b.pixelType,m),v=r;v<g;v++)for(var z=v*e,B=(v+d)*a+c,A=n;A<l;A++)u[B++]=w[z+A];q.push(u)}b=new Uint8Array(m);for(v=r;v<g;v++)for(z=v*e,B=(v+d)*a+c,A=n;A<l;A++)b[B++]=p?p[z+A]:1;f=new h({width:f.width,height:f.height,pixels:q,mask:b});
f.updateStatistics();return f};k.approximateTransform=function(b,d,f,c,a){void 0===a&&(a="nearest");if(!y(b))return null;"majority"===a&&(b=p(b));var q=b.pixels,e=b.mask,r=b.pixelType,n=b.width,l=b.height;b=h.getPixelArrayConstructor(r);var g=q.length,k=d.width,m=d.height;d=c.cols;var t=c.rows,x=Math.ceil(k/d),w=Math.ceil(m/t);c=!1;for(var u=0;u<f.length;u+=3)-1===f[u]&&-1===f[u+1]&&-1===f[u+2]&&(c=!0);for(var v,z,M,B,A,N,K=new Float32Array(k*m),J=new Float32Array(k*m),G=0,H,I,O="majority"===a?0:
.5,u=0;u<w;u++)for(var L=0;L<x;L++){v=12*(u*x+L);a=f[v];z=f[v+1];M=f[v+2];B=f[v+3];A=f[v+4];N=f[v+5];for(var D=0;D<t;D++){G=(u*t+D)*k+L*d;I=(D+.5)/t;for(var E=0;E<D;E++)H=(E+.5)/d,K[G+E]=Math.round((a*H+z*I+M)*n-O),J[G+E]=Math.round((B*H+A*I+N)*l-O)}v+=6;a=f[v];z=f[v+1];M=f[v+2];B=f[v+3];A=f[v+4];N=f[v+5];for(D=0;D<t;D++)for(G=(u*t+D)*k+L*d,I=(D+.5)/t,E=D;E<d;E++)H=(E+.5)/d,K[G+E]=Math.round((a*H+z*I+M)*n-O),J[G+E]=Math.round((B*H+A*I+N)*l-O)}f=function(a,c){for(var b=0;b<m;b++){v=b*k;for(var g=0;g<
k;g++)a[v]=0>K[v]||0>J[v]?0:c[K[v]+J[v]*n],v++}};l=[];for(u=0;u<g;u++)d=new b(k*m),f(d,q[u]),l.push(d);q=new h({width:k,height:m,pixelType:r,pixels:l});if(e)q.mask=new Uint8Array(k*m),f(q.mask,e);else if(c)for(q.mask=new Uint8Array(k*m),u=0;u<k*m;u++)q.mask[u]=0>K[u]||0>J[u]?0:1;q.updateStatistics();return q}})},"esri/layers/support/PixelBlock":function(){define("require exports tslib ../../core/compilerUtils ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators".split(" "),
function(z,k,h,x,w,m,p,t,u,v){var y=t.getLogger("esri.layers.support.PixelBlock");return function(b){function d(c){c=b.call(this,c)||this;c.width=null;c.height=null;c.pixelType="f32";c.validPixelCount=null;c.mask=null;c.maskIsAlpha=!1;c.pixels=null;c.statistics=null;return c}h.__extends(d,b);f=d;d.createEmptyBand=function(c,a){return new (f.getPixelArrayConstructor(c))(a)};d.getPixelArrayConstructor=function(c){var a;switch(c){case "u1":case "u2":case "u4":case "u8":a=Uint8Array;break;case "u16":a=
Uint16Array;break;case "u32":a=Uint32Array;break;case "s8":a=Int8Array;break;case "s16":a=Int16Array;break;case "s32":a=Int32Array;break;case "u32":a=Uint32Array;break;case "f32":a=Float32Array;break;case "f64":a=Float64Array;break;case "c64":case "c128":case "unknown":a=Float32Array;break;default:x.neverReached(c)}return a};d.prototype.castPixelType=function(c){if(!c)return"f32";c=c.toLowerCase();-1<["u1","u2","u4"].indexOf(c)?c="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(c)&&
(c="f32");return c};d.prototype.getPlaneCount=function(){return this.pixels&&this.pixels.length};d.prototype.addData=function(c){if(!c.pixels||c.pixels.length!==this.width*this.height)throw new w("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(c.pixels);this.statistics.push(c.statistics||{minValue:null,maxValue:null})};d.prototype.getAsRGBA=
function(){var c=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(c);break;default:this._fillFrom8Bit(c)}return new Uint8ClampedArray(c)};d.prototype.getAsRGBAFloat=function(){var c=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(c);return c};d.prototype.updateStatistics=function(){var c=this;this.statistics=this.pixels.map(function(a){return c._calculateBandStatistics(a,
c.mask)});var a=this.mask,b=0;if(a)for(var e=0;e<a.length;e++)a[e]&&b++;else b=this.width*this.height;this.validPixelCount=b};d.prototype.clamp=function(c){if(c&&"f64"!==c&&"f32"!==c){var a;switch(c){case "u8":a=[0,255];break;case "u16":a=[0,65535];break;case "u32":a=[0,4294967295];break;case "s8":a=[-128,127];break;case "s16":a=[-32768,32767];break;case "s32":a=[-2147483648,2147483647];break;default:a=[-3.4*1E39,3.4*1E39]}var b=a[0];a=a[1];for(var e=this.pixels,d=this.width*this.height,n=e.length,
l,g,h,k=[],p=0;p<n;p++){h=f.createEmptyBand(c,d);l=e[p];for(var m=0;m<d;m++)g=l[m],h[m]=g>a?a:g<b?b:g;k.push(h)}this.pixels=k;this.pixelType=c}};d.prototype.extractBands=function(c){var a=this;if(u.isNone(c)||0===c.length||null==this.pixels||0===this.pixels.length)return this;var b=this.pixels.length,e=c.some(function(c){return c>=a.pixels.length}),b=b===c.length&&!c.some(function(a,c){return a!==c});return e||b?this:new f({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,
validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:c.map(function(c){return a.pixels[c]}),statistics:this.statistics&&c.map(function(c){return a.statistics[c]})})};d.prototype.clone=function(){var c=new f({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(c.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var a,b=f.getPixelArrayConstructor(this.pixelType);
if(this.pixels&&0<this.pixels.length){c.pixels=[];var e=this.pixels[0].slice;for(a=0;a<this.pixels.length;a++)c.pixels[a]=e?this.pixels[a].slice(0,this.pixels[a].length):new b(this.pixels[a])}if(this.statistics)for(c.statistics=[],a=0;a<this.statistics.length;a++)c.statistics[a]=p.clone(this.statistics[a]);return c};d.prototype._fillFrom8Bit=function(c){var a=this.mask,b=this.maskIsAlpha,e=this.pixels;if(c&&e&&e.length){var f,d,l;f=d=l=e[0];3<=e.length?(d=e[1],l=e[2]):2===e.length&&(d=e[1]);c=new Uint32Array(c);
e=this.width*this.height;if(f.length!==e)y.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(a&&a.length===e)if(b)for(b=0;b<e;b++)a[b]&&(c[b]=a[b]<<24|l[b]<<16|d[b]<<8|f[b]);else for(b=0;b<e;b++)a[b]&&(c[b]=-16777216|l[b]<<16|d[b]<<8|f[b]);else for(b=0;b<e;b++)c[b]=-16777216|l[b]<<16|d[b]<<8|f[b]}else y.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};d.prototype._fillFromNon8Bit=function(c){var a=this.pixels,b=this.mask,e=this.statistics;
if(c&&a&&a.length){var f=this.pixelType,d=1,l=0,d=1;e&&0<e.length?(l=e.map(function(a){return a.minValue}).reduce(function(a,c){return Math.min(a,c)}),d=e.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,c){return Math.max(a,c)}),d=255/d):(d=255,"s8"===f?(l=-128,d=127):"u16"===f?d=65535:"s16"===f?(l=-32768,d=32767):"u32"===f?d=4294967295:"s32"===f?(l=-2147483648,d=2147483647):"f32"===f?(l=-3.4*1E39,d=3.4*1E39):"f64"===f&&(l=-Number.MAX_VALUE,d=Number.MAX_VALUE),d=255/(d-l));c=new Uint32Array(c);
var f=this.width*this.height,g,h,e=g=h=a[0];if(e.length!==f)return y.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=a.length)if(g=a[1],3<=a.length&&(h=a[2]),b&&b.length===f)for(a=0;a<f;a++)b[a]&&(c[a]=-16777216|(h[a]-l)*d<<16|(g[a]-l)*d<<8|(e[a]-l)*d);else for(a=0;a<f;a++)c[a]=-16777216|(h[a]-l)*d<<16|(g[a]-l)*d<<8|(e[a]-l)*d;else if(b&&b.length===f)for(a=0;a<f;a++)g=(e[a]-l)*d,b[a]&&(c[a]=-16777216|g<<16|g<<8|g);else for(a=0;a<f;a++)g=(e[a]-l)*d,c[a]=-16777216|
g<<16|g<<8|g}else y.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};d.prototype._fillFrom32Bit=function(c){var a=this.pixels,b=this.mask;if(!c||!a||!a.length)return y.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var d,f,h;d=f=h=a[0];3<=a.length?(f=a[1],h=a[2]):2===a.length&&(f=a[1]);var l=this.width*this.height;if(d.length!==l)return y.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var g=
0;if(b&&b.length===l)for(a=0;a<l;a++)c[g++]=d[a],c[g++]=f[a],c[g++]=h[a],c[g++]=b[a]&1;else for(a=0;a<l;a++)c[g++]=d[a],c[g++]=f[a],c[g++]=h[a],c[g++]=1};d.prototype._calculateBandStatistics=function(c,a){var b=Infinity,d=-Infinity,f=c.length,h,l=0;if(a)for(h=0;h<f;h++)a[h]&&(l=c[h],b=l<b?l:b,d=l>d?l:d);else for(h=0;h<f;h++)l=c[h],b=l<b?l:b,d=l>d?l:d;return{minValue:b,maxValue:d}};var f;h.__decorate([v.property({json:{write:!0}})],d.prototype,"width",void 0);h.__decorate([v.property({json:{write:!0}})],
d.prototype,"height",void 0);h.__decorate([v.property({json:{write:!0}})],d.prototype,"pixelType",void 0);h.__decorate([v.cast("pixelType")],d.prototype,"castPixelType",null);h.__decorate([v.property({json:{write:!0}})],d.prototype,"validPixelCount",void 0);h.__decorate([v.property({json:{write:!0}})],d.prototype,"mask",void 0);h.__decorate([v.property({json:{write:!0}})],d.prototype,"maskIsAlpha",void 0);h.__decorate([v.property({json:{write:!0}})],d.prototype,"pixels",void 0);h.__decorate([v.property({json:{write:!0}})],
d.prototype,"statistics",void 0);return d=f=h.__decorate([v.subclass("esri.layers.support.PixelBlock")],d)}(m.JSONSupport)})},"esri/views/2d/layers/support/ExportStrategy":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../viewStateUtils ../../engine/Bitmap ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(z,k,h,x,w,m,p,t,u,v,y,b,d,f){var c=t.create(),a=[0,0],q=new f(0,0,0,0);return function(f){function e(c){var b=f.call(this,c)||this;b._imagePromise=null;b.hidpi=!1;b.imageMaxWidth=2048;b.imageMaxHeight=2048;b.imageRotationSupported=!1;b.imageNormalizationSupported=!1;b.update=w.debounce(function(c,d){return h.__awaiter(b,void 0,void 0,function(){var b,f,e,g,l,k,n,p,m,q=this;return h.__generator(this,function(h){b=c.state;f=u.getInfo(b.spatialReference);e=this.hidpi?c.pixelRatio:1;if(!c.stationary||
this.destroyed)return[2];this.imageRotationSupported?(a[0]=b.size[0],a[1]=b.size[1]):y.getOuterSize(a,b);g=Math.floor(a[0]*e)>this.imageMaxWidth||Math.floor(a[1]*e)>this.imageMaxHeight;l=f&&(b.extent.xmin<f.valid[0]||b.extent.xmax>f.valid[1]);k=!this.imageNormalizationSupported&&l;n=!g&&!k;p=this.imageRotationSupported?b.rotation:0;n?this._imagePromise=this._singleExport(b,a,p,e,d):(m=Math.min(this.imageMaxWidth,this.imageMaxHeight),k&&(m=Math.min(b.worldScreenWidth,m)),this._imagePromise=this._tiledExport(b,
m,p,e,d));return[2,this._imagePromise.then(function(a){q._imagePromise=null;var c=q.container.children.slice();q.container.removeAllChildren();a.forEach(q.container.addChild,q.container);q.disposeSource&&c.forEach(function(a){q.disposeSource(a.source)},q)}).catch(function(a){q._imagePromise=null;throw a;})]})})},5E3);return b}h.__extends(e,f);e.prototype.destroy=function(){};Object.defineProperty(e.prototype,"updating",{get:function(){return null!==this._imagePromise},enumerable:!1,configurable:!0});
e.prototype.updateExports=function(a){for(var c=0,b=this.container.children;c<b.length;c++){var d=b[c];if(!d.visible||!d.stage)break;a(d)?console.error("ExportStrategy.updateExports doesn't support promise yet"):(d.invalidateTexture(),d.requestRender())}};e.prototype._export=function(a,c,d,f,e,h){var g=this;return w.resolve().then(function(){return g.fetchSource(a,Math.floor(c*e),Math.floor(d*e),{rotation:f,pixelRatio:e,signal:h})}).then(function(d){d=new b.Bitmap(d);d.x=a.xmin;d.y=a.ymax;d.resolution=
a.width/c;d.rotation=f;d.pixelRatio=e;return d})};e.prototype._singleExport=function(a,b,d,f,e){y.getBBox(c,a.center,a.resolution,b);a=new p(c[0],c[1],c[2],c[3],a.spatialReference);return this._export(a,b[0],b[1],d,f,e).then(function(a){return[a]})};e.prototype._tiledExport=function(a,b,f,e,h){var g=this,k=v.create({size:b,spatialReference:a.spatialReference,scales:[a.scale]}),l=new d(k),k=l.getTileCoverage(a);if(!k)return null;var n=[];k.forEach(function(d,k,m,r){q.set(d,k,m,r);l.getTileBounds(c,
q);d=new p(c[0],c[1],c[2],c[3],a.spatialReference);n.push(g._export(d,b,b,f,e,h))});return w.all(n)};h.__decorate([m.property()],e.prototype,"_imagePromise",void 0);h.__decorate([m.property()],e.prototype,"container",void 0);h.__decorate([m.property()],e.prototype,"disposeSource",void 0);h.__decorate([m.property()],e.prototype,"fetchSource",void 0);h.__decorate([m.property()],e.prototype,"hidpi",void 0);h.__decorate([m.property()],e.prototype,"imageMaxWidth",void 0);h.__decorate([m.property()],e.prototype,
"imageMaxHeight",void 0);h.__decorate([m.property()],e.prototype,"imageRotationSupported",void 0);h.__decorate([m.property()],e.prototype,"imageNormalizationSupported",void 0);h.__decorate([m.property()],e.prototype,"requestUpdate",void 0);h.__decorate([m.property({dependsOn:["_imagePromise"]})],e.prototype,"updating",null);return e=h.__decorate([m.subclass("esri.views.2d.layers.support.ExportStrategy")],e)}(x)})},"esri/views/2d/viewStateUtils":function(){define(["require","exports"],function(z,k){Object.defineProperty(k,
"__esModule",{value:!0});k.bboxIntersects=k.getBBox=k.getOuterSize=k.snapToPixel=void 0;var h=Math.PI/180;k.snapToPixel=function(h,k,m){var p=m.resolution;m=m.size;h[0]=p*(Math.round(k[0]/p)+m[0]%2*.5);h[1]=p*(Math.round(k[1]/p)+m[1]%2*.5);return h};k.getOuterSize=function(k,w){var m=w.rotation*h,p=Math.abs(Math.cos(m)),m=Math.abs(Math.sin(m)),t=w.size;w=t[0];t=t[1];k[0]=Math.round(t*m+w*p);k[1]=Math.round(t*p+w*m);return k};k.getBBox=function(h,k,m,p){var t=k[0];k=k[1];var u=p[0];p=p[1];m*=.5;h[0]=
t-m*u;h[1]=k-m*p;h[2]=t+m*u;h[3]=k+m*p;return h};k.bboxIntersects=function(h,k){var m=h[1],p=h[2],t=h[3],u=k[0],v=k[1],w=k[3];return!(h[0]>k[2]||p<u||m>w||t<v)}})},"esri/views/layers/ImageryLayerView":function(){define("require exports tslib ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../layers/support/commonProperties ../../tasks/support/Query ./support/popupUtils".split(" "),function(z,k,h,x,w,m,p,t,u,v,y){Object.defineProperty(k,
"__esModule",{value:!0});k.ImageryLayerView=void 0;k.ImageryLayerView=function(b){return function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;c.view=null;return c}h.__extends(d,b);d.prototype.fetchPopupFeatures=function(b,a){return h.__awaiter(this,void 0,void 0,function(){var c,d,f,k,l,g,p,u,z,P,Q;return h.__generator(this,function(e){switch(e.label){case 0:c=this.layer;if(!b)return[2,m.reject(new x("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:c}))];
d=c.popupEnabled;f=y.getFetchPopupTemplate(c,a);if(!d||!w.isSome(f))throw new x("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:d,popupTemplate:f});return[4,f.getRequiredFields()];case 1:return k=e.sent(),l=new v,l.geometry=b,l.outFields=k,l.outSpatialReference=b.spatialReference,g=this.view.resolution,p="2d"===this.view.type?new t(g,g,this.view.spatialReference):new t(.5*g,.5*g,this.view.spatialReference),u=f.layerOptions||{returnTopmostRaster:!0,
showNoDataRecords:!1},z=u.returnTopmostRaster,P=u.showNoDataRecords,Q={returnDomainValues:!0,returnTopmostRaster:z,pixelSize:p,showNoDataRecords:P},[2,c.queryVisibleRasters(l,Q).then(function(a){return a})]}})})};d.prototype.canResume=function(){var c;return!b.prototype.canResume.call(this)||(null===(c=this.timeExtent)||void 0===c?0:c.isEmpty)?!1:!0};h.__decorate([p.property()],d.prototype,"layer",void 0);h.__decorate([p.property({dependsOn:["timeExtent"]})],d.prototype,"suspended",void 0);h.__decorate([p.property(u.combinedViewLayerTimeExtentProperty)],
d.prototype,"timeExtent",void 0);h.__decorate([p.property()],d.prototype,"view",void 0);return d=h.__decorate([p.subclass("esri.views.layers.ImageryLayerView")],d)}(b)}})},"esri/views/layers/support/popupUtils":function(){define("require exports tslib @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),function(z,k,h,x,w,m){Object.defineProperty(k,"__esModule",{value:!0});k.getFetchPopupTemplate=k.getRequiredFields=void 0;k.getRequiredFields=function(k,t){void 0===
t&&(t=k.popupTemplate);return h.__awaiter(this,void 0,void 0,function(){var p,v,y,b,d,f,c,a,q;return h.__generator(this,function(e){switch(e.label){case 0:return w.isSome(t)?[4,t.getRequiredFields(k.fields)]:[2,[]];case 1:return p=e.sent(),v=t.lastEditInfoEnabled,y=k.objectIdField,b=k.typeIdField,d=k.globalIdField,f=k.relationships,x.includes(p,"*")?[2,["*"]]:v?[4,m.getFeatureEditFields(k)]:[3,3];case 2:return a=e.sent(),[3,4];case 3:a=[],e.label=4;case 4:return c=a,q=m.fixFields(k.fields,h.__spreadArrays(p,
c)),b&&q.push(b),q&&y&&m.hasField(k.fields,y)&&-1===q.indexOf(y)&&q.push(y),q&&d&&m.hasField(k.fields,d)&&-1===q.indexOf(d)&&q.push(d),f&&f.forEach(function(a){a=a.keyField;q&&a&&m.hasField(k.fields,a)&&-1===q.indexOf(a)&&q.push(a)}),[2,q]}})})};k.getFetchPopupTemplate=function(h,k){return h.popupTemplate?h.popupTemplate:w.isSome(k)&&k.defaultPopupTemplateEnabled&&w.isSome(h.defaultPopupTemplate)?h.defaultPopupTemplate:null}})},"*noref":1}});
define("require exports tslib ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./LayerView2D ./imagery/ImageryGraphicsView2D ./imagery/ImageryView2D ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(z,k,h,x,w,m,p,t,u,v,y,b){return function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;c._exportImageVersion=-1;return c}h.__extends(d,b);Object.defineProperty(d.prototype,"pixelData",
{get:function(){return this.updating?null:this.subview.getPixelData()},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return!(this.subview&&!this.subview.updating)},enumerable:!1,configurable:!0});d.prototype.hitTest=function(b,a){return this.suspended||!this.subview?x.resolve(null):this.subview.hitTest(b,a)};d.prototype.update=function(b){var a;null===(a=this.subview)||void 0===a?void 0:a.update(b)};d.prototype.attach=function(){var b=this;this.layer.increaseRasterJobHandlerUsage();
this._setSubView();this.handles.add([w.init(this,"layer.exportImageServiceParameters.version",function(a){b._exportImageVersion!==a&&(b._exportImageVersion=a,b.requestUpdate())}),this.watch("timeExtent",function(){b.subview.timeExtent=b.timeExtent;b.requestUpdate()}),this.layer.on("redraw",function(){return b.subview.redraw()}),w.watch(this.layer,"renderer",function(){return b._setSubView()})],"imagerylayerview-update")};d.prototype.detach=function(){this.layer.decreaseRasterJobHandlerUsage();this.subview.destroy();
this.handles.remove("imagerylayerview-update");this._exportImageVersion=-1};d.prototype.moveStart=function(){};d.prototype.viewChange=function(){};d.prototype.moveEnd=function(){this.requestUpdate()};d.prototype.doRefresh=function(){return h.__awaiter(this,void 0,void 0,function(){return h.__generator(this,function(b){this.requestUpdate();return[2]})})};d.prototype.isUpdating=function(){return!this.subview||this.subview.isUpdating()};d.prototype._setSubView=function(){var b,a,d,e="Imagery";"vector-field"===
(null===(b=this.layer.renderer)||void 0===b?void 0:b.type)&&"lerc"===this.layer.format&&(e="Graphics");this.subview&&this.subview.type===e||(null===(a=this.subview)||void 0===a?void 0:a.uninstall(this.container),null===(d=this.subview)||void 0===d?void 0:d.destroy(),this.subview="Imagery"===e?new u.default({layer:this.layer,view:this.view}):new t.default({layer:this.layer,view:this.view}),this.subview.attach(),this.subview.install(this.container));this.requestUpdate()};h.__decorate([m.property({dependsOn:["updating"]})],
d.prototype,"pixelData",null);h.__decorate([m.property({readOnly:!0,dependsOn:["subview.updating"]})],d.prototype,"updating",null);h.__decorate([m.property()],d.prototype,"subview",void 0);return d=h.__decorate([m.subclass("esri.views.2d.layers.ImageryLayerView2D")],d)}(v.ImageryLayerView(b.RefreshableLayerView(p.LayerView2DMixin(y))))});