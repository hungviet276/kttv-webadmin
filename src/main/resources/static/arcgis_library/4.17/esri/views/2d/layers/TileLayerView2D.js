// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/BitmapTileLayerView2D":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","../engine/BitmapTileContainer"],function(l,d,c,g,k){Object.defineProperty(d,"__esModule",{value:!0});d.BitmapTileLayerView2D=void 0;d.BitmapTileLayerView2D=function(b){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}c.__extends(b,a);b.prototype.attach=function(){this.view.timeline.record(this.layer.title+" (BitmapTileLayer) Attach");
this._bitmapView=new k.BitmapTileContainer(this._tileInfoView);this.container.addChild(this._bitmapView)};b.prototype.detach=function(){this.container.removeChild(this._bitmapView);this._bitmapView.removeAllChildren()};return b=c.__decorate([g.subclass("esri.views.2d.layers.BitmapTileLayerView2D")],b)}(b)}})},"esri/views/2d/layers/LayerView2D":function(){define("require exports tslib ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(l,d,c,g,k,b,a,h,f,m,e,r){Object.defineProperty(d,"__esModule",{value:!0});d.LayerView2DMixin=void 0;var p=g.ofType({key:"type",base:f,typeMap:{rect:m,path:r,geometry:e}});d.LayerView2DMixin=function(f){return function(f){function e(){var a=null!==f&&f.apply(this,arguments)||this;a.clips=new p;a.moving=!1;a.attached=!1;a.lastUpdateId=-1;a.updateRequested=!1;return a}c.__extends(e,f);e.prototype.initialize=function(){var a=this,c;this.container||(this.container=new h.Container);this.container.fadeTransitionEnabled=
!0;this.container.opacity=0;this.container.clips=this.clips;this.handles.add([b.init(this,"suspended",function(b){a.container&&(a.container.visible=!b);a.view&&!b&&a.updateRequested&&a.view.requestUpdate()},!0),b.init(this,["layer.opacity","container"],function(){var b,c;a.container&&(a.container.opacity=null!==(c=null===(b=a.layer)||void 0===b?void 0:b.opacity)&&void 0!==c?c:1)},!0),b.init(this,["layer.blendMode"],function(b){a.container&&(a.container.blendMode=b)},!0),b.init(this,["layer.effect"],
function(b){a.container&&(a.container.effect=b)},!0),this.clips.on("change",function(){a.container.clips=a.clips;a.notifyChange("clips")})]);(null===(c=this.view)||void 0===c?0:c.whenLayerView)?this.view.whenLayerView(this.layer).then(function(b){b!==a||a.attached||a.destroyed||(a.attach(),a.requestUpdate(),a.attached=!0)},function(){}):this.when().then(function(){a.attached||a.destroyed||(a.attach(),a.requestUpdate(),a.attached=!0)},function(){})};e.prototype.destroy=function(){this.attached&&(this.detach(),
this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};Object.defineProperty(e.prototype,"updating",{get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())},enumerable:!1,configurable:!0});e.prototype.isVisibleAtScale=function(a){var b=!0,c=this.layer,e=c.minScale,c=c.maxScale;if(null!=e&&null!=c){var b=!e,f=!c;!b&&a<=e&&(b=!0);!f&&a>=c&&(f=!0);b=b&&f}return b};e.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=
!0,this.suspended||this.view.requestUpdate())};e.prototype.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};e.prototype.isUpdating=function(){return!1};e.prototype.isRendering=function(){return!1};e.prototype.canResume=function(){return f.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};c.__decorate([a.property({type:p,
set:function(a){a=k.referenceSetter(a,this._get("clips"),p);this._set("clips",a)}})],e.prototype,"clips",void 0);c.__decorate([a.property()],e.prototype,"moving",void 0);c.__decorate([a.property()],e.prototype,"attached",void 0);c.__decorate([a.property()],e.prototype,"container",void 0);c.__decorate([a.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],e.prototype,"suspended",void 0);c.__decorate([a.property({readOnly:!0})],e.prototype,"updateParameters",void 0);c.__decorate([a.property()],
e.prototype,"updateRequested",void 0);c.__decorate([a.property({dependsOn:["attached","updateRequested","suspended"]})],e.prototype,"updating",null);c.__decorate([a.property()],e.prototype,"view",void 0);return e=c.__decorate([a.subclass("esri.views.2d.layers.LayerView2D")],e)}(f)}})},"esri/views/layers/support/ClipArea":function(){define(["require","exports","tslib","../../../core/JSONSupport","../../../core/accessorSupport/decorators"],function(l,d,c,g,k){return function(b){function a(){return null!==
b&&b.apply(this,arguments)||this}c.__extends(a,b);return a=c.__decorate([k.subclass("esri.views.layers.support.ClipArea")],a)}(g.JSONSupport)})},"esri/views/layers/support/ClipRect":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","./ClipArea"],function(l,d,c,g,k){return function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.type="rect";a.left=null;a.right=null;a.top=null;a.bottom=null;return a}c.__extends(a,b);h=a;a.prototype.clone=function(){return new h({left:this.left,
right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});var h;c.__decorate([g.property({type:[Number,String],json:{write:!0}})],a.prototype,"left",void 0);c.__decorate([g.property({type:[Number,String],json:{write:!0}})],a.prototype,"right",void 0);c.__decorate([g.property({type:[Number,String],json:{write:!0}})],a.prototype,"top",void 0);c.__decorate([g.property({type:[Number,
String],json:{write:!0}})],a.prototype,"bottom",void 0);c.__decorate([g.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],a.prototype,"version",null);return a=h=c.__decorate([g.subclass("esri.views.layers.support.ClipRect")],a)}(k)})},"esri/views/layers/support/Geometry":function(){define("require exports tslib ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),function(l,d,c,g,k,b,a,h){var f=
{base:b,key:"type",typeMap:{extent:g.Extent,polygon:g.Polygon}};return function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.type="geometry";a.geometry=null;return a}c.__extends(e,b);g=e;Object.defineProperty(e.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});e.prototype.clone=function(){return new g({geometry:this.geometry.clone()})};var g;c.__decorate([k.property({types:f,json:{read:a.fromJSON,write:!0}})],e.prototype,"geometry",
void 0);c.__decorate([k.property({readOnly:!0,dependsOn:["geometry"]})],e.prototype,"version",null);return e=g=c.__decorate([k.subclass("esri.views.layers.support.Geometry")],e)}(h)})},"esri/views/layers/support/Path":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","./ClipArea"],function(l,d,c,g,k){return function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.type="path";a.path=[];return a}c.__extends(a,b);Object.defineProperty(a.prototype,
"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});c.__decorate([g.property({type:[[[Number]]],json:{write:!0}})],a.prototype,"path",void 0);c.__decorate([g.property({readOnly:!0,dependsOn:["path"]})],a.prototype,"version",null);return a=c.__decorate([g.subclass("esri.views.layers.support.Path")],a)}(k)})},"esri/views/layers/TileLayerView":function(){define("require exports tslib ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../renderers/support/clickToleranceUtils".split(" "),
function(l,d,c,g,k,b,a,h){Object.defineProperty(d,"__esModule",{value:!0});d.TileLayerView=void 0;d.TileLayerView=function(f){return function(f){function e(){return null!==f&&f.apply(this,arguments)||this}c.__extends(e,f);e.prototype.fetchPopupFeatures=function(a,e){return c.__awaiter(this,void 0,void 0,function(){var f,d,m,r=this;return c.__generator(this,function(p){f=this.layer;if(!a)return[2,b.reject(new g("tilelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:f}))];if("tile"!==
f.type)return[2,b.reject(new g("tilelayerview:fetchPopupFeatures","Layer type should be 'tile'",{type:f.type}))];d=this.get("view.scale");m=f.allSublayers.toArray().filter(function(a){var b=0===a.minScale||d<=a.minScale,c=0===a.maxScale||d>=a.maxScale;return a.popupTemplate&&a.popupEnabled&&a.visible&&b&&c});return[2,b.eachAlways(m.map(function(b){return c.__awaiter(r,void 0,void 0,function(){var f,g,d,n,q;return c.__generator(this,function(c){switch(c.label){case 0:return f=b.createQuery(),g=k.isSome(e)?
e.event:null,d=h.calculateTolerance({renderer:b.renderer,event:g}),f.geometry=this.createFetchPopupFeaturesQueryGeometry(a,d),n=f,[4,b.popupTemplate.getRequiredFields()];case 1:return n.outFields=c.sent(),[4,b.queryFeatures(f)];case 2:return q=c.sent(),[2,q.features]}})})})).then(function(a){return[].concat.apply([],a.map(function(a){return a.value}).filter(Boolean))})]})})};c.__decorate([a.property()],e.prototype,"layer",void 0);return e=c.__decorate([a.subclass("esri.layers.mixins.TileLayerView")],
e)}(f)}})},"esri/renderers/support/clickToleranceUtils":function(){define(["require","exports"],function(l,d){function c(b,a){return a?"xoffset"in a&&a.xoffset?Math.max(b,Math.abs(a.xoffset)):"yoffset"in a&&a.yoffset?Math.max(b,Math.abs(a.yoffset||0)):b:b}function g(b,a){if("number"===typeof b)return b;if(b&&b.stops&&b.stops.length){b=b.stops;for(var c=a=0,f=0;f<b.length;f++){var g=b[f].size;"number"===typeof g&&(a+=g,c++)}return a/c}return a}function k(b,a){if(!a)return b;a=a.filter(function(a){return"size"===
a.type}).map(function(a){var c=a.minSize;return(g(a.maxSize,b)+g(c,b))/2});var c=0,f=a.length;if(0===f)return b;for(var d=0;d<f;d++)c+=a[d];return Math.max(Math.floor(c/f),b)}Object.defineProperty(d,"__esModule",{value:!0});d.calculateTolerance=void 0;d.calculateTolerance=function(b){var a=b&&b.renderer;b="touch"===(b&&b.event&&b.event.pointerType)?9:6;if(!a)return b;b="visualVariables"in a?k(b,a.visualVariables):b;if("simple"===a.type)return c(b,a.symbol);if("unique-value"===a.type){var g=b;a.uniqueValueInfos.forEach(function(a){g=
c(g,a.symbol)});return g}if("class-breaks"===a.type){var f=b;a.classBreakInfos.forEach(function(a){f=c(f,a.symbol)});return f}return b}})},"esri/views/support/drapedUtils":function(){define("require exports ../../geometry ../../core/maybe ../../core/unitUtils ../../renderers/support/clickToleranceUtils".split(" "),function(l,d,c,g,k,b){function a(a,b,e,g){void 0===g&&(g=new c.Extent);var f;if("2d"===e.type)f=b*e.resolution;else if("3d"===e.type){var d=e.basemapTerrain,h=d.overlayManager,h=h?h.overlayPixelSizeInMapUnits(a):
1;f=d&&!d.spatialReference.equals(e.spatialReference)?k.getMetersPerUnitForSR(d.spatialReference)/k.getMetersPerUnitForSR(e.spatialReference):b*h}b=a.x-f;d=a.y-f;h=a.x+f;a=a.y+f;e=e.spatialReference;g.xmin=Math.min(b,h);g.ymin=Math.min(d,a);g.xmax=Math.max(b,h);g.ymax=Math.max(d,a);g.spatialReference=e;return g}Object.defineProperty(d,"__esModule",{value:!0});d.intersectsDrapedGeometry=d.createQueryGeometry=void 0;d.createQueryGeometry=a;d.intersectsDrapedGeometry=function(c,d,e){c=e.toMap(c);if(g.isNone(c))return null;
var f=b.calculateTolerance();return a(c,f,e,h).intersects(d)?c:null};var h=new c.Extent})},"*noref":1}});
define("require exports tslib ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./BitmapTileLayerView2D ./LayerView2D ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/TileLayerView ../../support/drapedUtils".split(" "),function(l,d,c,g,k,b,a,h,f,m,e,r,p,u,v,w,x,y){var z=k.getLogger("esri.views.2d.layers.TileLayerView2D"),
A=[0,0];return function(f){function d(){var a=null!==f&&f.apply(this,arguments)||this;a._tileStrategy=null;a._fetchQueue=null;a.layer=null;return a}c.__extends(d,f);d.prototype.initialize=function(){var b=this,c=this.layer.tileInfo,c=c&&c.spatialReference,d;c||(d=new g("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));c.equals(this.view.spatialReference)||(d=new g("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",
{layer:this.layer}));this.watch("resampling",function(){b.refresh()});d&&this.addResolvingPromise(a.reject(d))};Object.defineProperty(d.prototype,"resampling",{get:function(){return!("resampling"in this.layer)||!1!==this.layer.resampling},enumerable:!1,configurable:!0});d.prototype.hitTest=function(){return null};d.prototype.update=function(a){this._fetchQueue.pause();this._fetchQueue.state=a.state;this._tileStrategy.update(a);this._fetchQueue.resume();this.notifyChange("updating")};d.prototype.attach=
function(){var a=this,b="tileServers"in this.layer?this.layer.tileServers:null;this._tileInfoView=new e(this.layer.tileInfo,this.layer.fullExtent);this._fetchQueue=new p({tileInfoView:this._tileInfoView,concurrency:b&&10*b.length||10,process:function(b,c){return a.fetchTile(b,c)}});this._tileStrategy=new u({cachePolicy:"keep",resampling:this.resampling,acquireTile:function(b){return a.acquireTile(b)},releaseTile:function(b){return a.releaseTile(b)},tileInfoView:this._tileInfoView});this.requestUpdate();
this.container.requestRender();f.prototype.attach.call(this)};d.prototype.detach=function(){f.prototype.detach.call(this);this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null};d.prototype.moveStart=function(){this.requestUpdate()};d.prototype.viewChange=function(){this.requestUpdate()};d.prototype.moveEnd=function(){this.requestUpdate()};d.prototype.createFetchPopupFeaturesQueryGeometry=function(a,b){return y.createQueryGeometry(a,
b,this.view)};d.prototype.doRefresh=function(){return c.__awaiter(this,void 0,void 0,function(){var a=this;return c.__generator(this,function(b){if(this.updateRequested||this.suspended)return[2];this._fetchQueue.reset();this._tileStrategy.tiles.forEach(function(b){return a._enqueueTileFetch(b)});this.notifyChange("updating");return[2]})})};d.prototype.isUpdating=function(){var a;return 0<(null===(a=this._fetchQueue)||void 0===a?void 0:a.length)};d.prototype.acquireTile=function(a){var b;a=this._bitmapView.createTile(a);
var c=a.bitmap;b=this._tileInfoView.getTileCoords(A,a.key);c.x=b[0];c.y=b[1];c.resolution=this._tileInfoView.getTileResolution(a.key);b=this._tileInfoView.tileInfo.size;c.width=b[0];c.height=b[1];this._enqueueTileFetch(a);this._bitmapView.addChild(a);this.requestUpdate();return a};d.prototype.releaseTile=function(a){this._fetchQueue.abort(a.key.id);this._bitmapView.removeChild(a);a.once("detach",function(){return a.destroy()});this.requestUpdate()};d.prototype.fetchTile=function(d,f){return c.__awaiter(this,
void 0,void 0,function(){var e,g,k,h,n,q,t,l,m;return c.__generator(this,function(c){switch(c.label){case 0:e="tilemapCache"in this.layer?this.layer.tilemapCache:null;g=!b.isNone(f)&&f.signal;if(e)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this._fetchImage(d,g)];case 2:return[2,c.sent()];case 3:k=c.sent();if(!a.isAbortError(k)&&!this.resampling)return[2,this._createBlankImage()];throw k;case 4:h=new r(0,0,0,0),c.label=5;case 5:return c.trys.push([5,8,,10]),[4,e.fetchAvailabilityUpsample(d.level,
d.row,d.col,h,{signal:g})];case 6:return c.sent(),h.level===d.level||this.resampling?[4,this._fetchImage(h,g)]:[2,this._createBlankImage()];case 7:return n=c.sent(),[3,10];case 8:q=c.sent();if(a.isAbortError(q))throw q;return[4,this._fetchImage(d,g)];case 9:return n=c.sent(),[3,10];case 10:return t=h.level,l=h.row,m=h.col,this.resampling&&t!==d.level?[2,this._resampleImage(n,t,l,m,d.level,d.row,d.col)]:[2,n]}})})};d.prototype._enqueueTileFetch=function(b){return c.__awaiter(this,void 0,void 0,function(){var d,
e,f=this;return c.__generator(this,function(c){switch(c.label){case 0:if(this._fetchQueue.has(b.key.id))return[2];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this._fetchQueue.push(b.key)];case 2:return d=c.sent(),b.bitmap.source=d,b.bitmap.width=this._tileInfoView.tileInfo.size[0],b.bitmap.height=this._tileInfoView.tileInfo.size[1],b.once("attach",function(){return f.requestUpdate()}),[3,4];case 3:return e=c.sent(),a.isAbortError(e)||z.error(e),[3,4];case 4:return this.requestUpdate(),[2]}})})};
d.prototype._fetchImage=function(a,b){return c.__awaiter(this,void 0,void 0,function(){return c.__generator(this,function(c){return[2,this.layer.fetchTile(a.level,a.row,a.col,{timestamp:this.refreshTimestamp,signal:b})]})})};d.prototype._resampleImage=function(a,b,c,d,e,f,g){var h=this._tileInfoView.tileInfo.size,k=this._tileInfoView.getTileResolution(b),l=this._tileInfoView.getTileResolution(e);e=this._tileInfoView.getLODInfoAt(e);g=e.getXForColumn(g);f=e.getYForRow(f);e=this._tileInfoView.getLODInfoAt(b);
b=e.getXForColumn(d);d=e.getYForRow(c);c=Math.round((g-b)/k);b=Math.round(-(f-d)/k);d=Math.round(l/k*h[0]);k=Math.round(l/k*h[1]);l=this._createBlankImage();l.getContext("2d").drawImage(a,c,b,d,k,0,0,h[0],h[1]);return l};d.prototype._createBlankImage=function(){var a=this._tileInfoView.tileInfo.size,b=document.createElement("canvas");b.width=a[0];b.height=a[1];return b};c.__decorate([h.property({dependsOn:["layer.resampling?"]})],d.prototype,"resampling",null);return d=c.__decorate([h.subclass("esri.views.2d.layers.TileLayerView2D")],
d)}(x.TileLayerView(w.RefreshableLayerView(f.BitmapTileLayerView2D(m.LayerView2DMixin(v)))))});