// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/Evented ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f32 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./DrapedVisualElementResources ./LaserlineVisualElement ./VisualElementResources ../../layers/graphics/ElevationContext ../../layers/graphics/lineUtils ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/geometryDataUtils ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/shaders/RibbonLineTechnique".split(" "),
function(t,q,y,g,m,u,l,r,n,z,A,B,C,D,p,E,F,G,H,v,I){Object.defineProperty(q,"__esModule",{value:!0});q.OutlineVisualElement=void 0;t=function(){function b(a){var b=this;this.view=null;this._attachmentOrigin=z.makeDehydratedPoint(0,0,0,null);this._attachmentOriginDirty=!0;this.events=new y;this._isDraped=!1;this._geometry=null;this._width=1;this._color=r.vec4f32.fromValues(1,0,1,1);this._innerWidth=1;this._innerColor=r.vec4f32.fromValues(1,1,1,1);this._stippleOffColor=this._stipplePattern=null;this._falloff=
0;this._laserlineStyle=this._elevationInfo=null;this._laserlineEnabled=!1;this._occludedMode=8;this.resources=new C.VisualElementResources({view:a.view,createResources:function(a){return b.createResources(a)},recreateGeometry:function(a,c){a.geometries.length=0;b.recreateGeometry(c,a.material,a.geometries);return a.geometries}});this._attachmentOrigin.spatialReference=a.view.spatialReference;this.drapedResources=new A.DrapedVisualElementResources({view:a.view,createResources:function(){return b.createDrapedResources()},
recreateGeometry:function(a){a.geometries=b.createRenderGeometriesDraped(a.material);b.attachmentOriginChanged()}});var d=!0;this._laserline=new B.LaserlineVisualElement({view:a.view});for(var c in a)c in this?"attached"===c?d=a[c]:this[c]=a[c]:console.error("Cannot set unknown property",c);this.attached=d}b.prototype.destroy=function(){this.resources.destroy();this.drapedResources.destroy();this._laserline.destroy()};Object.defineProperty(b.prototype,"isDraped",{get:function(){return this._isDraped},
set:function(a){a!==this._isDraped&&(this._isDraped=a,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"laserlineAttached",{get:function(){return this.attached&&!this.hidden&&g.isSome(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(a){this.resources.hidden=
a;this.drapedResources.hidden=a;this._laserline.attached=this.laserlineAttached},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"attached",{get:function(){return this.resources.attached||this.drapedResources.attached},set:function(a){this.updateAttached(a)},enumerable:!1,configurable:!0});b.prototype.updateAttached=function(a){this.resources.attached=!this.isDraped&&a;this.drapedResources.attached=this.isDraped&&a;this._laserline.attached=this.laserlineAttached;this.attached&&this.attachmentOriginChanged()};
Object.defineProperty(b.prototype,"geometry",{get:function(){return this._geometry},set:function(a){this._geometry=a;this.resources.recreateGeometry();this.drapedResources.recreateGeometry()},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return this._width},set:function(a){a!==this._width&&(this._width=a,this.updateMaterial())},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"color",{get:function(){return this._color},set:function(a){l.vec4.exactEquals(a,
this._color)||(l.vec4.copy(this._color,a),this.updateMaterial())},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"innerWidth",{get:function(){return this._innerWidth},set:function(a){a!==this._innerWidth&&(this._innerWidth=a,this.updateMaterial())},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"innerColor",{get:function(){return this._innerColor},set:function(a){l.vec4.exactEquals(a,this._innerColor)||(l.vec4.copy(this._innerColor,a),this.updateMaterial())},
enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"stipplePattern",{get:function(){return this._stipplePattern},set:function(a){var b=g.isSome(a)!==g.isSome(this._stipplePattern);this._stipplePattern=a;b?this.resources.recreate():this.updateMaterial()},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"stippleOffColor",{get:function(){return this._stippleOffColor},set:function(a){a&&this._stippleOffColor&&l.vec4.exactEquals(a,this._stippleOffColor)||(this._stippleOffColor=
a?r.vec4f32.clone(a):null,this.updateMaterial())},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"falloff",{get:function(){return this._falloff},set:function(a){a!==this._falloff&&(this._falloff=a,this.updateMaterial())},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(a){this._elevationInfo=a;this.resources.recreateGeometry()},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"laserlineStyle",{get:function(){return this._laserlineStyle},set:function(a){this._laserlineStyle=a;this._laserline.attached=this.laserlineAttached;g.isSome(a)&&(this._laserline.style=a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"laserlineEnabled",{get:function(){return this._laserlineEnabled},set:function(a){this._laserlineEnabled!==a&&(this._laserlineEnabled=a,this._laserline.attached=this.laserlineAttached)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"occludedMode",{get:function(){return this._occludedMode},set:function(a){a!==this._occludedMode&&(this._occludedMode=a,g.isSome(this.resources.resources)&&(this.resources.resources.material.renderOccluded=a),g.isSome(this.drapedResources.resources)&&(this.drapedResources.resources.material.renderOccluded=a))},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"attachmentOrigin",{get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var a=g.isSome(this.resources.resources)?
this.resources.resources.geometries:null;if(!a||0===a.length)return null;m.vec3.set(k,0,0,0);for(var b=I.RibbonVertexAttributeConstants.POSITION,d=0,c=0;c<a.length;c++){var e=a[c],h=e.getAttribute(b),e=e.getIndices(b),f=g.unwrap(this.resources.resources).material.isClosed(h.data,e);G.computeAttachmentOriginLines(h,e,f,x)&&(m.vec3.add(k,k,x),d++)}if(0===d)return null;m.vec3.scale(k,k,1/d);this.view.renderCoordsHelper.fromRenderCoords(k,this._attachmentOrigin);this._attachmentOriginDirty=!1;return this._attachmentOrigin},
enumerable:!1,configurable:!0});b.prototype.updateMaterial=function(){g.isSome(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters);g.isSome(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)};Object.defineProperty(b.prototype,"isClosed",{get:function(){return g.isSome(this.geometry)&&"polygon"===this.geometry.type},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"materialParameters",{get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0}},enumerable:!1,configurable:!0});b.prototype.recreateGeometry=function(a,b,d){for(var c=0,e=this.createRenderGeometries();c<e.length;c++){var w=e[c];a.addGeometry(w,b);d.push(w)}this.attachmentOriginChanged()};
b.prototype.attachmentOriginChanged=function(){this._attachmentOriginDirty=!0;this.events.emit("attachment-origin-changed")};b.prototype.createResources=function(a){var b=new v(this.materialParameters,"lineVisualElement");b.renderOccluded=8;var d=[];this.recreateGeometry(a,b,d);return{material:b,geometries:d,forEach:function(a){a(b);d.forEach(a)}}};b.prototype.createDrapedResources=function(){var a=new v(this.materialParameters,"lineVisualElement");a.renderOccluded=4;var b=this.createRenderGeometriesDraped(a);
return{material:a,geometries:b}};b.prototype.createRenderGeometriesDraped=function(a){var b=this.geometry;if(g.isNone(b))return[];for(var d=[],c=0,b=p.geometryToRenderInfoDraped(b,this.view.basemapTerrain.spatialReference).lines;c<b.length;c++){var e=b[c].position,h=new H(p.createGeometryData({attributeData:{position:e},removeDuplicateStartEnd:this.isClosed?1:0}));h.material=a;var f=n.empty(J);n.expandWithBuffer(f,e);m.vec3.set(h.center,.5*(f[0]+f[3]),.5*(f[1]+f[4]),0);h.bsRadius=.5*Math.sqrt((f[3]-
f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1]));d.push(h)}return d};b.prototype.calculateMapBounds=function(a){if(g.isNone(this.resources.resources))return!1;for(var b=this.view.renderCoordsHelper,d=0,c=this.resources.resources.geometries;d<c.length;d++){var e=c[d].data.getAttribute("position"),h=e.data,f=new Float64Array(h.length);E.bufferToBuffer(e.data,b.spatialReference,0,f,this.view.spatialReference,0,h.length/3);n.expandWithBuffer(a,f)}return!0};b.prototype.createRenderGeometries=function(){var a=
this.geometry;if(g.isNone(a))return[];for(var b=[],d=[],c=0,a=p.geometryToRenderInfo(a,this.view.elevationProvider,this.view.renderCoordsHelper,D.ElevationContext.fromElevationInfo(this.elevationInfo)).lines;c<a.length;c++){var e=a[c],h=e.position,e=p.createGeometryData({attributeData:{position:h,mapPosition:e.mapPosition},removeDuplicateStartEnd:this.isClosed?1:0});b.push(new F(e,"geometryOutlineVisualElement"));d.push(h)}this._laserline.pathVerticalPlane=d;return b};return b}();q.OutlineVisualElement=
t;var J=n.create(),x=u.vec3f64.create(),k=u.vec3f64.create()});