// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/Handles ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Object3DVisualElement ../../support/stack ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/materials/ColorMaterial".split(" "),function(h,f,m,n,p,k,q,d,g,r,l,t,u,v){Object.defineProperty(f,"__esModule",{value:!0});f.RightAngleQuadVisualElement=
void 0;h=function(f){function c(b){var a=f.call(this,b.view)||this;a._handles=new n;a._triangleCornerMaterial=null;a._maxSize=0;a._position=g.vec3f64.create();a._up=g.vec3f64.create();a._right=g.vec3f64.create();a._transform=q.mat4f64.create();a._color=[1,0,0,1];a.applyProps(b);return a}m.__extends(c,f);Object.defineProperty(c.prototype,"color",{get:function(){return this._color},set:function(b){this._color[0]=b[0];this._color[1]=b[1];this._color[2]=b[2];this._color[3]=b[3];this._updateMaterial()},
enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"materialParameters",{get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0}},enumerable:!1,configurable:!0});c.prototype._updateMaterial=function(){this.attached&&this._triangleCornerMaterial.setParameterValues(this.materialParameters)};c.prototype.updateGeometry=function(b,a,c){this._maxSize=.33*Math.min(d.vec3.distance(a,b),d.vec3.distance(a,c));d.vec3.subtract(this._up,a,b);d.vec3.normalize(this._up,
this._up);d.vec3.subtract(this._right,c,a);d.vec3.normalize(this._right,this._right);d.vec3.copy(this._position,a);this.recreateGeometry()};c.prototype.createExternalResources=function(){var b=this;this._triangleCornerMaterial=new v(this.materialParameters,"triangle-corner");this._handles.add(this.view.state.watch("camera",function(){var a=b.object;p.isSome(a)&&(b._updateTransform(),a.objectTransformation=b._transform)}))};c.prototype.destroyExternalResources=function(){this._triangleCornerMaterial=
null;this._handles.destroy();this._handles=null};c.prototype.forEachExternalResource=function(b){b(this._triangleCornerMaterial)};c.prototype.createGeometries=function(b){var a=new t(this._quadGeometryData(this._position,this._up,this._right,1,this._position),"triangle-corner");this._updateTransform();b.addGeometry(a,this._triangleCornerMaterial);b.objectTransformation=this._transform};c.prototype._updateTransform=function(){var b=32*this.view._stage.getCamera().computeScreenPixelSizeAt(this._position),
b=Math.min(this._maxSize,b);k.mat4.identity(this._transform);k.mat4.translate(this._transform,this._transform,this._position);k.mat4.scale(this._transform,this._transform,[b,b,b])};c.prototype._quadGeometryData=function(b,a,c,f,k){var e=l.sv3d.get(),g=[],h=l.sv3d.get();d.vec3.scale(h,c,f);c=l.sv3d.get();d.vec3.scale(c,a,-f);for(a=0;4>a;++a)d.vec3.copy(e,b),d.vec3.subtract(e,e,k),a&1&&d.vec3.add(e,e,h),a&2&&d.vec3.add(e,e,c),g.push(e[0],e[1],e[2]);return new u.GeometryData({position:{size:3,data:g}},
{position:new Uint32Array([0,1,2,1,2,3])})};return c}(r.Object3DVisualElement);f.RightAngleQuadVisualElement=h});