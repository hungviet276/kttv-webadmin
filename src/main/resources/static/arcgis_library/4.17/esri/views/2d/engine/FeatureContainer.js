// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/promiseUtils ../../../core/promiseUtils ../../../core/Queue ../../../geometry/support/aaBoundingRect ./webgl/AttributeStoreView ./webgl/TileContainer ./webgl/TileData ./webgl/WGLRendererInfo ./webgl/WGLTile".split(" "),function(g,e,d,h,k,l,m,n,p,q,r,t){Object.defineProperty(e,"__esModule",{value:!0});e.FeatureContainer=void 0;g=function(f){function b(a){a=f.call(this,a)||this;a._rendererInfo=new r.WGLRendererInfo;a._materialItemsRequestQueue=new l.default;
a.attributeView=new n.AttributeStoreView;return a}d.__extends(b,f);b.prototype.destroy=function(){this.removeAllChildren();this.children.forEach(function(a){return a.destroy()});this.attributeView.destroy();this._materialItemsRequestQueue.clear()};b.prototype.setRendererInfo=function(a,c,b){this._rendererInfo.setInfo(a,c,b);this.requestRender()};b.prototype.getMaterialItems=function(a,c){return d.__awaiter(this,void 0,void 0,function(){var b;return d.__generator(this,function(d){if(!a||0===a.length)return[2,
null];b=h.createResolver();this._materialItemsRequestQueue.push({items:a,abortOptions:c,resolver:b});this.requestRender();return[2,b.promise]})})};b.prototype.onTileData=function(a,c){if(!(c.addOrUpdate&&"tileDisplayData"in c.addOrUpdate)){var b=c.addOrUpdate&&q.TileData.decode(c.addOrUpdate);c=d.__assign(d.__assign({},c),{addOrUpdate:b})}a.setData(c);this.contains(a)||this.addChild(a);this.requestRender()};b.prototype.onTileError=function(a){a.clear();this.contains(a)||this.addChild(a)};b.prototype.doRender=
function(a){a.context.capabilities.textureFloat;a.context.capabilities.vao;if(0<this._materialItemsRequestQueue.length)for(var c=this._materialItemsRequestQueue.pop();c;)this._processMaterialItemRequest(a,c),c=this._materialItemsRequestQueue.pop();f.prototype.doRender.call(this,a)};b.prototype.renderChildren=function(a){for(var c=0,b=this.children;c<b.length;c++)b[c].commitChanges(a);this._rendererInfo.update(a.state);this.attributeView.bindTextures(a.context);f.prototype.renderChildren.call(this,
a)};b.prototype.createTile=function(a){var c=this._tileInfoView.getTileBounds(m.create(),a);return new t.WGLTile(a,c)};b.prototype.destroyTile=function(a){this.removeChild(a);a.destroy()};b.prototype.createRenderParams=function(a){return d.__assign(d.__assign({},f.prototype.createRenderParams.call(this,a)),{rendererInfo:this._rendererInfo,attributeView:this.attributeView})};b.prototype._processMaterialItemRequest=function(a,c){var b=this,d=c.items,f=c.abortOptions,e=c.resolver,g=a.painter,h=a.pixelRatio;
a=d.map(function(a){return g.textureManager.rasterizeItem(a.symbol,h,a.glyphIds,f)});k.all(a).then(function(a){b.stage?(a=a.map(function(a,b){return{id:d[b].id,mosaicItem:a}}),e.resolve(a)):e.reject()},e.reject)};return b}(p.default);e.FeatureContainer=g});