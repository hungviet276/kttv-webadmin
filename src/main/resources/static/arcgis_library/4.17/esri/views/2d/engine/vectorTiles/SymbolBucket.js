// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/BidiEngine ../../../../core/string ./BaseBucket ./GeometryUtils ./Placement ./TextShaping ./style/StyleLayer ../webgl/Geometry".split(" "),function(T,U,P,Q,O,R,z,G,H,K,E){function S(z,n){return z.iconMosaicItem&&n.iconMosaicItem?z.iconMosaicItem.page===n.iconMosaicItem.page?0:z.iconMosaicItem.page-n.iconMosaicItem.page:z.iconMosaicItem&&!n.iconMosaicItem?1:!z.iconMosaicItem&&n.iconMosaicItem?-1:0}(function(){return function(){}})();return function(N){function n(c,
a,f,b,l,g,k,d){a=N.call(this,c,a)||this;a.type=3;a._markerMap=new Map;a._glyphMap=new Map;a._glyphBufferDataStorage=new Map;a._isIconSDF=!1;if(c.hasDataDrivenIcon!==f.isDataDriven())throw Error("incompatible icon buffer");if(c.hasDataDrivenText!==l.isDataDriven())throw Error("incompatible text buffer");a._iconVertexBuffer=f;a._iconIndexBuffer=b;a._textVertexBuffer=l;a._textIndexBuffer=g;a._placementEngine=k;a._workerTileHandler=d;return a}P.__extends(n,N);Object.defineProperty(n.prototype,"markerPageMap",
{get:function(){return this._markerMap},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"glyphsPageMap",{get:function(){return this._glyphMap},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"symbolInstances",{get:function(){return this._symbolInstances},enumerable:!1,configurable:!0});n.prototype.getResources=function(c,a,f){var b=this.layer,l=this.zoom,g=b.hasDataDrivenIcon,k=b.hasDataDrivenText;c&&c.setExtent(this.layerExtent);for(var d=b.getLayoutProperty("icon-image"),
h=b.getLayoutProperty("text-field"),r=[],p=[1,1,1,1],m=1,e=1,v=[1,1,1,1],C=1,t=1,x,q,u,y,A,w,I,F,z,E=0,G=this._features;E<G.length;E++){var B=G[E],H=B.getGeometry(c);if(H&&0!==H.length){var J=void 0;d&&(J=b.getLayoutValue("icon-image",l,B),d.isDataDriven||(J=this._replaceKeys(J,B.values)),J&&(a.add(J),x=b.getLayoutValue("icon-rotate",l,B),q=b.getLayoutValue("icon-offset",l,B)));var D=void 0,L=!1;if(h&&((D=b.getLayoutValue("text-field",l,B))&&!h.isDataDriven&&(D=this._replaceKeys(D,B.values)),D)){D=
D.replace(/\\n/g,"\n");switch(b.getLayoutValue("text-transform",l,B)){case 2:D=D.toLowerCase();break;case 1:D=D.toUpperCase()}n._bidiEngine.hasBidiChar(D)&&(L=void 0,L="rtl"===n._bidiEngine.checkContextual(D)?"IDNNN":"ICNNN",D=n._bidiEngine.bidiTransform(D,L,"VLYSN"),L=!0);var M=D.length;if(0<M){z=b.getLayoutValue("text-font",l,B);u=0;for(y=z;u<y.length;u++)for(w=y[u],(A=f[w])||(A=f[w]=new Set),w=0;w<M;w++)I=D.charCodeAt(w),A.add(I);u=b.getLayoutValue("text-rotate",l,B);y=b.getLayoutValue("text-anchor",
l,B);A=b.getLayoutValue("text-offset",l,B);w=b.getLayoutValue("text-justify",l,B);I=b.getLayoutValue("text-letter-spacing",l,B);F=b.getLayoutValue("text-max-width",l,B)}}if(J||D){var M=b.getLayoutValue("icon-size",l,B),K=b.getLayoutValue("text-size",l,B);b.hasDataDrivenIconColor&&(p=b.getPaintValue("icon-color",l,B));b.hasDataDrivenIconOpacity&&(m=b.getPaintValue("icon-opacity",l,B));b.hasDataDrivenIconSize&&(e=M);b.hasDataDrivenTextColor&&(v=b.getPaintValue("text-color",l,B));b.hasDataDrivenTextOpacity&&
(C=b.getPaintValue("text-opacity",l,B));b.hasDataDrivenTextSize&&(t=K);var N=b.getLayoutValue("symbol-sort-key",l,B),B={sprite:J,label:D,rtl:L,type:B.type,geometry:H,hash:(D?O.numericHash(D):0)^(J?O.numericHash(J):0),priority:N,iconSize:M,iconRotate:x,ddIconValues:g?{color:p,opacity:m,size:e}:null,iconOffset:q,textSize:K,textRotate:u,ddTextValues:k?{color:v,opacity:C,size:t}:null,textAnchor:y,textOffset:A,textJustify:w,textLetterSpacing:I,textMaxWidth:F,textFontArray:z};r.push(B)}}}this._symbolFeatures=
r};n.prototype.processFeatures=function(c){c&&c.setExtent(this.layerExtent);var a=this.layer,f=this.zoom;c=1===a.getLayoutValue("symbol-placement",f);var b=a.getLayoutValue("symbol-spacing",f)*G.TILE_PIXEL_RATIO,l=a.getLayoutProperty("icon-image"),g=a.getLayoutProperty("text-field"),k=l?new K.IconLayout(a,f,c):null,a=g?new K.TextLayout(a,f,c):null,d=this._workerTileHandler,h;l&&(h=d.getSpriteItems());this._iconIndexStart=3*this._iconIndexBuffer.index;this._textIndexStart=3*this._textIndexBuffer.index;
this._textIndexCount=this._iconIndexCount=0;this._markerMap.clear();this._glyphMap.clear();l=[];f=1;a&&a.size&&(f=a.size/H.SDF_GLYPH_SIZE);for(var g=a?a.maxAngle*z.C_DEG_TO_RAD:0,r=a?a.size*G.TILE_PIXEL_RATIO:0,p=0,m=this._symbolFeatures;p<m.length;p++){var e=m[p],v=void 0;k&&h&&e.sprite&&(v=h[e.sprite])&&v.sdf&&(this._isIconSDF=!0);v&&(k.size=e.iconSize,k.rotate=e.iconRotate,k.offset=e.iconOffset);var C=void 0,t=0,x=e.label;if(x){a.size=e.textSize;a.rotate=e.textRotate;a.anchor=e.textAnchor;a.fontArray=
e.textFontArray;a.justify=e.textJustify;a.letterSpacing=e.textLetterSpacing;a.maxWidth=e.textMaxWidth;a.offset=e.textOffset;var C=c?a.keepUpright:a.writingMode&&0<=a.writingMode.indexOf(1),q=.5;switch(a.anchor){case 5:case 1:case 7:q=0;break;case 6:case 2:case 8:q=1}var u=.5;switch(a.anchor){case 5:case 3:case 6:u=0;break;case 7:case 4:case 8:u=1}var y=.5;switch(a.justify){case 0:y=q;break;case 1:y=0;break;case 3:y=1}var A=a.letterSpacing*H.SDF_GLYPH_SIZE,w=c?0:a.maxWidth*H.SDF_GLYPH_SIZE,I=a.lineHeight*
H.SDF_GLYPH_SIZE,F=void 0,F=void 0,F=a.fontArray.map(function(a){return d.getGlyphItems(a)}),F=new H.TextShaping(F,w,I,A,q,u,y);if((C=F.getShaping(x,e.rtl,C))&&0<C.length){t=1E30;x=-1E30;q=0;for(u=C;q<u.length;q++)y=u[q],t=Math.min(t,y.x),x=Math.max(x,y.x);t=(x-t+2*H.SDF_GLYPH_SIZE)*f*G.TILE_PIXEL_RATIO}}x=0;for(q=e.geometry;x<q.length;x++)for(u=q[x],A=void 0,c?(C&&0<C.length&&a&&a.size&&(u=n._smoothVertices(u,a.size*G.TILE_PIXEL_RATIO*(2+Math.min(2,4*Math.abs(a.offset[1]))))),A=n._findAnchors(u,
b,t)):A=3===e.type?n._findCentroid(u):[new G.Anchor(u[0].x,u[0].y)],y=0;y<A.length;y++)w=A[y],0>w.x||w.x>G.TILE_COORD_SIZE||0>w.y||w.y>G.TILE_COORD_SIZE||c&&0<t&&0===a.rotationAlignment&&!n._honorsTextMaxAngle(u,w,t,g,r)||(w={shaping:C,line:u,iconMosaicItem:v,anchor:w,symbolFeature:e,textColliders:[],iconColliders:[],textVertexRanges:[],iconVertexRanges:[]},l.push(w),this._processFeature(w,k,a))}l.sort(S);this._addPlacedGlyphs();this._symbolInstances=l};n.prototype.serialize=function(){var c;c=13+
this.layerIndices.length;c+=3*this.markerPageMap.size;c+=3*this.glyphsPageMap.size;c+=n.symbolsSerializationLength(this._symbolInstances);c+=this._iconVertexBuffer.array.length;c+=this._iconIndexBuffer.array.length;c+=this._textVertexBuffer.array.length;c+=this._textIndexBuffer.array.length;var a=0,f=new Uint32Array(c);c=new Int32Array(f.buffer);var b=new Float32Array(f.buffer);f[a++]=this.type;f[a++]=this.layerIndices.length;for(var l=0;l<this.layerIndices.length;l++)f[a++]=this.layerIndices[l];
f[a++]=this._isIconSDF?1:0;f[a++]=this._iconVertexBuffer.isDataDriven()?1:0;f[a++]=this._textVertexBuffer.isDataDriven()?1:0;f[a++]=this.markerPageMap.size;this.markerPageMap.forEach(function(b,c){var d=b[0];b=b[1];f[a++]=c;f[a++]=d;f[a++]=b});f[a++]=this.glyphsPageMap.size;this.glyphsPageMap.forEach(function(b,c){var d=b[0];b=b[1];f[a++]=c;f[a++]=d;f[a++]=b});f[a++]=this._iconVertexBuffer.index/4;f[a++]=this._textVertexBuffer.index/4;a=n.serializeSymbols(f,c,b,a,this._symbolInstances);f[a++]=this._iconVertexBuffer.array.length;
for(b=0;b<this._iconVertexBuffer.array.length;b++)c[a++]=this._iconVertexBuffer.array[b];f[a++]=this._iconIndexBuffer.array.length;for(b=0;b<this._iconIndexBuffer.array.length;b++)f[a++]=this._iconIndexBuffer.array[b];f[a++]=this._textVertexBuffer.array.length;for(b=0;b<this._textVertexBuffer.array.length;b++)c[a++]=this._textVertexBuffer.array[b];f[a++]=this._textIndexBuffer.array.length;for(c=0;c<this._textIndexBuffer.array.length;c++)f[a++]=this._textIndexBuffer.array[c];return f.buffer};n.symbolsSerializationLength=
function(c){var a;a=1;for(var f=0;f<c.length;f++){var b=c[f];a+=4;a+=1;for(var l=0,g=b.textColliders;l<g.length;l++)a+=10;l=0;for(g=b.iconColliders;l<g.length;l++)a+=10;a+=1;a+=2*b.textVertexRanges.length;a+=1;a+=2*b.iconVertexRanges.length}return a};n.serializeSymbols=function(c,a,f,b,l){a[b++]=l.length;for(c=0;c<l.length;c++){var g=l[c];a[b++]=g.anchor.x;a[b++]=g.anchor.y;a[b++]=g.symbolFeature.hash;a[b++]=g.symbolFeature.priority;a[b++]=g.textColliders.length+g.iconColliders.length;for(var k=0,
d=g.textColliders;k<d.length;k++){var h=d[k];a[b++]=h.xTile;a[b++]=h.yTile;a[b++]=h.dxPixels;a[b++]=h.dyPixels;a[b++]=h.hard?1:0;a[b++]=h.partIndex;f[b++]=h.minLod;f[b++]=h.maxLod;a[b++]=h.width;a[b++]=h.height}k=0;for(d=g.iconColliders;k<d.length;k++)h=d[k],a[b++]=h.xTile,a[b++]=h.yTile,a[b++]=h.dxPixels,a[b++]=h.dyPixels,a[b++]=h.hard?1:0,a[b++]=h.partIndex,f[b++]=h.minLod,f[b++]=h.maxLod,a[b++]=h.width,a[b++]=h.height;a[b++]=g.textVertexRanges.length;for(var d=0,r=g.textVertexRanges;d<r.length;d++)k=
r[d],h=k[0],k=k[1],a[b++]=h,a[b++]=k;a[b++]=g.iconVertexRanges.length;d=0;for(g=g.iconVertexRanges;d<g.length;d++)k=g[d],h=k[0],k=k[1],a[b++]=h,a[b++]=k}return b};n.prototype._replaceKeys=function(c,a){return c.replace(/{([^{}]+)}/g,function(c,b){return b in a?a[b]:""})};n.prototype._processFeature=function(c,a,f){var b=c.line,l=c.iconMosaicItem,g=c.shaping,k=c.anchor,d=!!l,h=!0;d&&(h=a.optional||!l);var r=g&&0<g.length,p=!0;r&&(p=f.optional||!g||0===g.length);var m;d&&(m=this._placementEngine.getIconPlacement(k,
l,a));if(m||h){var e;r&&(e=this._placementEngine.getTextPlacement(k,g,b,f));if(e||p){m&&e||(p||h?p||e?h||m||(e=null):m=null:e=m=null);if(e&&(this._storePlacedGlyphs(c,e.shapes,this.zoom,f.rotationAlignment),e.textColliders))for(c.textColliders=e.textColliders,f=0,b=e.textColliders;f<b.length;f++)if(e=b[f],e.minLod=Math.max(this.zoom+z.log2(e.minLod),0),e.maxLod=Math.min(this.zoom+z.log2(e.maxLod),25),g=e.angle){var h=Math.cos(g),v=Math.sin(g),r=e.dxPixels*h-e.dyPixels*v,g=e.dxPixels*v+e.dyPixels*
h,p=(e.dxPixels+e.width)*h-e.dyPixels*v,k=(e.dxPixels+e.width)*v+e.dyPixels*h,n=e.dxPixels*h-(e.dyPixels+e.height)*v,d=e.dxPixels*v+(e.dyPixels+e.height)*h,t=(e.dxPixels+e.width)*h-(e.dyPixels+e.height)*v,v=(e.dxPixels+e.width)*v+(e.dyPixels+e.height)*h,h=Math.min(r,p,n,t),r=Math.max(r,p,n,t),p=Math.min(g,k,d,v),g=Math.max(g,k,d,v);e.dxPixels=h;e.dyPixels=p;e.width=r-h;e.height=g-p}if(m&&(this._addPlacedIcons(c,m.shapes,this.zoom,l.page,1===a.rotationAlignment),m.iconColliders))for(c.iconColliders=
m.iconColliders,c=0,m=m.iconColliders;c<m.length;c++)if(e=m[c],e.minLod=Math.max(this.zoom+z.log2(e.minLod),0),e.maxLod=Math.min(this.zoom+z.log2(e.maxLod),25),g=e.angle)h=Math.cos(g),v=Math.sin(g),r=e.dxPixels*h-e.dyPixels*v,g=e.dxPixels*v+e.dyPixels*h,p=(e.dxPixels+e.width)*h-e.dyPixels*v,k=(e.dxPixels+e.width)*v+e.dyPixels*h,n=e.dxPixels*h-(e.dyPixels+e.height)*v,d=e.dxPixels*v+(e.dyPixels+e.height)*h,t=(e.dxPixels+e.width)*h-(e.dyPixels+e.height)*v,v=(e.dxPixels+e.width)*v+(e.dyPixels+e.height)*
h,h=Math.min(r,p,n,t),r=Math.max(r,p,n,t),p=Math.min(g,k,d,v),g=Math.max(g,k,d,v),e.dxPixels=h,e.dyPixels=p,e.width=r-h,e.height=g-p}}};n.prototype._addPlacedIcons=function(c,a,f,b,l){for(var g=c.symbolFeature.ddIconValues,k=Math.max(f-1,0),d=this._iconVertexBuffer,h=this._iconIndexBuffer,r=this._markerMap,p=0;p<a.length;p++){var m=a[p],e=l?0:Math.max(f+z.log2(m.minzoom),k),v=l?25:Math.min(f+z.log2(m.maxzoom),25);if(!(v<=e)){var n=m.tl,t=m.tr,x=m.bl,q=m.br,u=m.mosaicRect,y=m.labelAngle,A=m.minAngle,
w=m.maxAngle,m=m.anchor,I=d.index,F=u.x,E=u.y,G=F+u.width,u=E+u.height,H=d.index;d.add(m.x,m.y,n.x,n.y,F,E,y,A,w,e,v,g);d.add(m.x,m.y,t.x,t.y,G,E,y,A,w,e,v,g);d.add(m.x,m.y,x.x,x.y,F,u,y,A,w,e,v,g);d.add(m.x,m.y,q.x,q.y,G,u,y,A,w,e,v,g);0<c.iconVertexRanges.length&&c.iconVertexRanges[0][0]+c.iconVertexRanges[0][1]===H?c.iconVertexRanges[0][1]+=4:c.iconVertexRanges.push([H,4]);h.add(I+0,I+1,I+2);h.add(I+1,I+2,I+3);r.has(b)?r.get(b)[1]+=6:r.set(b,[this._iconIndexStart+this._iconIndexCount,6]);this._iconIndexCount+=
6}}};n.prototype._addPlacedGlyphs=function(){var c=this,a=this._textVertexBuffer,f=this._textIndexBuffer,b=this._glyphMap;this._glyphBufferDataStorage.forEach(function(l,g){for(var k=0;k<l.length;k++){var d=l[k],h=a.index,r=d.symbolInstance,p=r.symbolFeature.ddTextValues,m=a.index;a.add(d.glyphAnchor[0],d.glyphAnchor[1],d.tl[0],d.tl[1],d.xmin,d.ymin,d.labelAngle,d.minAngle,d.maxAngle,d.minLod,d.maxLod,p);a.add(d.glyphAnchor[0],d.glyphAnchor[1],d.tr[0],d.tr[1],d.xmax,d.ymin,d.labelAngle,d.minAngle,
d.maxAngle,d.minLod,d.maxLod,p);a.add(d.glyphAnchor[0],d.glyphAnchor[1],d.bl[0],d.bl[1],d.xmin,d.ymax,d.labelAngle,d.minAngle,d.maxAngle,d.minLod,d.maxLod,p);a.add(d.glyphAnchor[0],d.glyphAnchor[1],d.br[0],d.br[1],d.xmax,d.ymax,d.labelAngle,d.minAngle,d.maxAngle,d.minLod,d.maxLod,p);0<r.textVertexRanges.length&&r.textVertexRanges[0][0]+r.textVertexRanges[0][1]===m?r.textVertexRanges[0][1]+=4:r.textVertexRanges.push([m,4]);f.add(h+0,h+1,h+2);f.add(h+1,h+2,h+3);b.has(g)?b.get(g)[1]+=6:b.set(g,[c._textIndexStart+
c._textIndexCount,6]);c._textIndexCount+=6}});this._glyphBufferDataStorage.clear()};n.prototype._storePlacedGlyphs=function(c,a,f,b){var l=Math.max(f-1,0);b=1===b;for(var g,k,d,h,r,p,m,e,v,n,t,x=0;x<a.length;x++){var q=a[x];g=b?0:Math.max(f+z.log2(q.minzoom),l);k=b?25:Math.min(f+z.log2(q.maxzoom),25);k<=g||(d=q.tl,h=q.tr,r=q.bl,p=q.br,m=q.labelAngle,e=q.minAngle,v=q.maxAngle,n=q.anchor,t=q.mosaicRect,this._glyphBufferDataStorage.has(q.page)||this._glyphBufferDataStorage.set(q.page,[]),this._glyphBufferDataStorage.get(q.page).push({glyphAnchor:[n.x,
n.y],tl:[d.x,d.y],tr:[h.x,h.y],bl:[r.x,r.y],br:[p.x,p.y],xmin:t.x,ymin:t.y,xmax:t.x+t.width,ymax:t.y+t.height,labelAngle:m,minAngle:e,maxAngle:v,minLod:g,maxLod:k,placementLod:l,symbolInstance:c}))}};n._findAnchors=function(c,a,f){a+=f;for(var b=0,l=c.length-1,g=0;g<l;g++)b+=E.Point.distance(c[g],c[g+1]);g=.5*(f||a);if(b<=g)return[];f=g/b;a=b/Math.max(Math.round(b/a),1);for(var b=0,l=-a/2,k=[],d=c.length-1,g=0;g<d;g++){for(var h=c[g],r=c[g+1],p=r.x-h.x,m=r.y-h.y,e=Math.sqrt(p*p+m*m),n=void 0;l+a<
b+e;){var l=l+a,C=(l-b)/e,t=z.interpolate(h.x,r.x,C),C=z.interpolate(h.y,r.y,C);void 0===n&&(n=Math.atan2(m,p));k.push(new G.Anchor(t,C,n,g,f))}b+=e}return k};n._deviation=function(c,a,f){return Math.atan2((a.x-c.x)*(f.y-a.y)-(a.y-c.y)*(f.x-a.x),(a.x-c.x)*(f.x-a.x)+(a.y-c.y)*(f.y-a.y))};n._honorsTextMaxAngle=function(c,a,f,b,l){var g=0;f/=2;for(var k=new E.Point(a.x,a.y),d=a.segment+1;g>-f;){--d;if(0>d)return!1;g-=E.Point.distance(c[d],k);k=c[d]}g+=E.Point.distance(c[d],c[d+1]);a=[];for(var k=0,h=
c.length;g<f;){var r=c[d],p=void 0;do{++d;if(d===h)return!1;p=c[d]}while(p.isEqual(r));var m=d,e=void 0;do{++m;if(m===h)return!1;e=c[m]}while(e.isEqual(p));r=this._deviation(r,p,e);a.push({deviation:r,distToAnchor:g});for(k+=r;g-a[0].distToAnchor>l;)k-=a.shift().deviation;if(Math.abs(k)>b)return!1;g+=E.Point.distance(p,e)}return!0};n._smoothVertices=function(c,a){if(0>=a)return c;var f=c.length;if(3>f)return c;var b=[],l=0,g=0;b.push(0);for(var k=1;k<f;k++){var d=E.Point.distance(c[k],c[k-1]);0<d&&
(l+=d,b.push(l),g++,g!==k&&(c[g]=c[k]))}f=g+1;if(3>f)return c;a=Math.min(a,.2*l);var l=c[0].x,g=c[0].y,h=c[f-1].x,r=c[f-1].y,k=E.Point.sub(c[0],c[1]);k.normalize();c[0].x+=a*k.x;c[0].y+=a*k.y;k.assignSub(c[f-1],c[f-2]);k.normalize();c[f-1].x+=a*k.x;c[f-1].y+=a*k.y;b[0]-=a;b[f-1]+=a;var p=[];p.push(new E.Point(l,g));for(var m=.5*a,k=1;k<f-1;k++){for(var e=0,n=0,C=0,t=k-1;0<=t;t--){var x=m+b[t+1]-b[k];if(0>x)break;var d=b[t+1]-b[t],q=b[k]-b[t]<m?1:x/d;if(1E-6>q)break;var u=q*q,y=q*x-.5*u*d,A=q*d/a,
w=c[t+1],z=c[t].x-w.x,F=c[t].y-w.y,e=e+A/y*(w.x*q*x+.5*u*(x*z-d*w.x)-u*q*d*z/3),n=n+A/y*(w.y*q*x+.5*u*(x*F-d*w.y)-u*q*d*F/3),C=C+A}for(t=k+1;t<f;t++){x=m-b[t-1]+b[k];if(0>x)break;d=b[t]-b[t-1];q=b[t]-b[k]<m?1:x/d;if(1E-6>q)break;u=q*q;y=q*x-.5*u*d;A=q*d/a;w=c[t-1];z=c[t].x-w.x;F=c[t].y-w.y;e+=A/y*(w.x*q*x+.5*u*(x*z-d*w.x)-u*q*d*z/3);n+=A/y*(w.y*q*x+.5*u*(x*F-d*w.y)-u*q*d*F/3);C+=A}p.push(new E.Point(e/C,n/C))}p.push(new E.Point(h,r));c[0].x=l;c[0].y=g;c[f-1].x=h;c[f-1].y=r;return p};n._findCentroid=
function(c){var a=c.length-1,f=0,b=0,l=0,g=c[0].x,k=c[0].y;4096<g&&(g=4096);0>g&&(g=0);4096<k&&(k=4096);0>k&&(k=0);for(var d=1;d<a;d++){var h=c[d].x,n=c[d].y,p=c[d+1].x,m=c[d+1].y;4096<h&&(h=4096);0>h&&(h=0);4096<n&&(n=4096);0>n&&(n=0);4096<p&&(p=4096);0>p&&(p=0);4096<m&&(m=4096);0>m&&(m=0);var e=(h-g)*(m-k)-(p-g)*(n-k),f=f+e*(g+h+p),b=b+e*(k+n+m),l=l+e}f/=3*l;b/=3*l;return isNaN(f)||isNaN(b)?[]:[new G.Anchor(f,b)]};n._bidiEngine=new Q.default;return n}(R)});