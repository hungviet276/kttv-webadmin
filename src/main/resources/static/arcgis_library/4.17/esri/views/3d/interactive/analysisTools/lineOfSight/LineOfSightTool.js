// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../Color ../../../../../core/Collection ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../geometry/Point ../../../../../layers/graphics/dehydratedFeatures ./lineOfSightToolConfig ./lineOfSightToolUtils ../../../support/geometryUtils ../../../support/LaserLineRenderer ../../../support/stack ../../../terrain/tileUtils ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/Layer ../../../webgl-engine/lib/Object3D ../../../../interactive/dragEventPipeline ../../../../interactive/InteractiveToolBase ../../../../support/Scheduler ../../../../../widgets/LineOfSight/LineOfSightTarget".split(" "),
function(A,y,g,F,G,H,B,J,v,r,K,d,m,C,L,I,n,w,M,N,O,P,Q,R,S,T,l,E){Object.defineProperty(y,"__esModule",{value:!0});y.LineOfSightTool=y.LineOfSightTargetCollection=void 0;y.LineOfSightTargetCollection=G.ofType(E);A=function(A){function c(a){a=A.call(this,a)||this;a.deferCreation=!0;a.observer=null;a.targets=new y.LineOfSightTargetCollection;a.configuration=null;a.updating=!1;a._handles=new H;a._manipulatorHandles=new H;a._observer=null;a._tracker=null;a._analyses=new G;a._screenPixelSize=0;a._grabbedManipulator=
null;a._showTracker=!0;return a}g.__extends(c,A);c.prototype.initialize=function(){var a=this,b=v.init(this,"state",function(b){switch(b){case "created":a.complete();break;default:a.create()}},!0),e=this.configuration=new I.Configuration;this._intersector=new P.Intersector(this.view.state.mode);this._intersector.options.hud=!1;this._intersector.options.store=0;this._engineLayer=new Q("line-of-sight-analysis",{isPickable:!1});var c=this.view._stage;c.addToViewContent([this._engineLayer.id]);c.add(0,
this._engineLayer);this._createEngineResources();this._observer={location:null,intersection:null,manipulator:this._addManipulator({size:e.observerManipulatorSize,color:e.observerManipulatorColor,visible:!1})};this._tracker=this._createLineOfSightAnalysis(new E({location:new C}));this._tracker.point.manipulator.available=!1;this._tracker.point.manipulator.interactive=!1;e=this._handles;e.add([b,this.view.state.watch("camera",function(){return a._onCameraChange()}),this.view.watch("map.ground.opacity",
function(b,e){return a._onGroundOpacityChange(b,e)}),v.init(this.view,"slicePlane",function(){return a._onSlicePlaneChange()}),v.init(this,"observer",function(b){return a._onObserverChange(b)},!0),v.on(this,"targets","change",function(b){return a._onTargetCollectionChange(b)},function(b){return a._onTargetsChange(b)},null,!0),v.watch(this.configuration,"laserLineEnabled laserLineGlowColor laserLineGlowWidth laserLineInnerColor laserLineInnerWidth laserLineGlobalAlpha lineOfSightInnerWidth lineOfSightOuterWidth lineOfSightVisibleInnerColor lineOfSightVisibleOuterColor lineOfSightOccludedInnerColor lineOfSightOccludedOuterColor lineOfSightUndefinedInnerColor lineOfSightUndefinedOuterColor lineOfSightUndefinedStipplePattern lineOfSightUndefinedStipplePatternOffColor".split(" "),
function(){return a._createEngineResources()}),v.watch(this.configuration,["observerManipulatorSize","observerManipulatorColor"],function(){return a._recreateManipulator(a._observer)}),v.watch(this.configuration,["targetManipulatorSize","targetManipulatorVisibleColor","targetManipulatorOccludedColor","targetManipulatorUndefinedColor"],function(){return a._analyses.forEach(function(b){return a._recreateManipulator(b.point)})})]);(b=this.view.pointsOfInterest)&&e.add([b.contentGeometryUpdates.events.on("request-update",
function(){return a._onContentChange()}),this.view.elevationProvider.on("elevation-change",function(){return a._onContentChange()})]);if(b=this.view.resourceController&&this.view.resourceController.scheduler)this._frameTask=b.registerTask(l.Task.LINE_OF_SIGHT_TOOL,function(b){return a._updateAnalyses(b)},function(){return a.updating}),e.add(this._frameTask);this.continue()};c.prototype.destroy=function(){var a=this;this.detach();this._handles.destroy();this._handles=null;this._manipulatorHandles.destroy();
this._manipulatorHandles=null;this.manipulators.remove(this._observer.manipulator);this._destroyLineOfSightAnalysis(this._tracker);this._analyses.forEach(function(b){a._destroyLineOfSightAnalysis(b)});var b=this.view._stage;b.removeFromViewContent([this._engineLayer.id]);b.remove(0,this._engineLayer.id);this._removeEngineResources();this._engineLayer=null;b.removeRenderPlugin(this._engineResources.laserLineRenderer);this.observer=this._intersector=this._engineResources=this._engineResources.laserLineRenderer=
null;this._set("targets",null)};Object.defineProperty(c.prototype,"state",{get:function(){return this._showTracker?"creating":this.observer?"created":"ready"},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"cursor",{get:function(){return this.manipulators.some(function(a){return a.manipulator.focused})?null:this._showTracker?"crosshair":null},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"isSupported",{get:function(){return"3d"===this.get("view.type")},enumerable:!1,
configurable:!0});c.prototype.continue=function(){this.view.activeTool=this;this._showTracker=!0;this._updateTrackerVisibility()};c.prototype.stop=function(){this._showTracker=!1;this._setDirty(l.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE);this._updateTrackerVisibility()};c.prototype.onInputEvent=function(a){switch(a.type){case "immediate-double-click":this._doubleClickHandler(a);break;case "key-down":this._keyDownHandler(a);break;case "pointer-move":this._pointerMoveHandler(a)}};c.prototype.onInputEventAfter=
function(a){switch(a.type){case "immediate-click":this._clickHandler(a)}};c.prototype._setDirty=function(a){this.updating?a===l.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE&&this._frameTask&&(this._frameTask.task=a):(this._set("updating",!0),this._frameTask&&(this._frameTask.task=a))};c.prototype._updateTrackerVisibility=function(){this._tracker.shouldRender=this._showTracker&&!this.manipulators.some(function(a){return a.manipulator.focused});this._updateLaserLineRenderer()};c.prototype._manipulatorFocusChanged=
function(){this._updateTrackerVisibility();this.notifyChange("cursor")};c.prototype._addManipulator=function(a){var b=this,e=n.createSphereManipulator(this.view,a);this._manipulatorHandles.add([this._createManipulatorDragPipeline(e),e.events.on("focus-changed",function(){return b._manipulatorFocusChanged()}),e.events.on("grab-changed",function(a){return b._manipulatorGrabChanged(e,a)}),e.events.on("immediate-click",function(a){return a.stopPropagation()})],e);this.manipulators.add(e);return e};c.prototype._removeManipulator=
function(a){this.manipulators.remove(a);this._manipulatorHandles.remove(a)};c.prototype._recreateManipulator=function(a){var b=this.configuration,e=a.manipulator;this._removeManipulator(e);a.manipulator=this._addManipulator(a===this._observer?{size:b.observerManipulatorSize,color:b.observerManipulatorColor,visible:e.available}:{size:b.targetManipulatorSize,customColor1:b.targetManipulatorVisibleColor,customColor2:b.targetManipulatorOccludedColor,customColor3:b.targetManipulatorUndefinedColor});a.manipulator.location=
e.location;this._setDirty(l.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)};c.prototype._screenToIntersection=function(){var a=this;return function(b){var e=a._getScreenPointIntersection(b.screenEnd);return e?g.__assign(g.__assign({},b),{intersection:e}):null}};c.prototype._createManipulatorDragPipeline=function(a){var b=this;return S.createManipulatorDragEventPipeline(a,function(e,c,d){c.next(b._screenToIntersection()).next(a===b._observer.manipulator?b._updateObserverDragStep():b._updateAnalysisDragStep(a)).next(function(){return b._updateLaserLineRenderer()});
d.next(a===b._observer.manipulator?b._cancelObserverDragStep():b._cancelAnalysisDragStep(a)).next(function(){return b._updateLaserLineRenderer()})})};c.prototype._updateObserverDragStep=function(){var a=this;return function(b){a.observer=b.intersection.point;a._observer.intersection=b.intersection;return b}};c.prototype._cancelObserverDragStep=function(){var a=this,b=this.observer.clone(),e=this._observer.intersection;return function(c){a.observer=b;a._observer.intersection=e;return c}};c.prototype._updateAnalysisDragStep=
function(a){var b=this;return function(e){var c=b._analyses.find(function(b){return b.point.manipulator===a});c.target.location=e.intersection.point;c.point.intersection=e.intersection;return e}};c.prototype._cancelAnalysisDragStep=function(a){var b=this._analyses.find(function(b){return b.point.manipulator===a}),e=b.target.location.clone(),c=b.point.intersection;return function(a){b.target.location=e;b.point.intersection=c;return a}};c.prototype._updateLaserLineRenderer=function(){var a=this._engineResources.laserLineRenderer;
if(this.configuration.laserLineEnabled){var b=B.isSome(this._grabbedManipulator)?this._grabbedManipulator:this._tracker.shouldRender&&this.observer?this._tracker.point.manipulator:null;this.configuration.laserLineEnabled&&B.isSome(b)?(a.heightManifoldEnabled=!0,a.heightManifoldTarget=b.renderLocation,b!==this._observer.manipulator?(a.lineVerticalPlaneEnabled=!0,a.lineVerticalPlaneSegment=w.lineSegment.fromPoints(this._observer.manipulator.renderLocation,b.renderLocation,U)):a.lineVerticalPlaneEnabled=
!1):(a.heightManifoldEnabled=!1,a.lineVerticalPlaneEnabled=!1)}else a.heightManifoldEnabled=!1,a.lineVerticalPlaneEnabled=!1};c.prototype._createLaserLineRenderer=function(){var a=this.configuration;return new M.LaserLineRenderer(this.view.renderCoordsHelper,{glowColor:F.toUnitRGB(a.laserLineGlowColor),glowWidth:a.laserLineGlowWidth,innerColor:F.toUnitRGB(a.laserLineInnerColor),innerWidth:a.laserLineInnerWidth,globalAlpha:a.laserLineGlobalAlpha})};c.prototype._removeEngineResources=function(){var a=
this.view._stage;a.remove(3,this._engineResources.visibleLineMaterialInner.id);a.remove(3,this._engineResources.visibleLineMaterialOuter.id);a.remove(3,this._engineResources.occludedLineMaterialInner.id);a.remove(3,this._engineResources.occludedLineMaterialOuter.id);a.remove(3,this._engineResources.undefinedLineMaterialInner.id);a.remove(3,this._engineResources.undefinedLineMaterialOuter.id)};c.prototype._createEngineResources=function(){var a=this.view._stage,b=this.configuration;this._engineResources&&
(this._removeEngineResources(),a.removeRenderPlugin(this._engineResources.laserLineRenderer));this._engineResources={laserLineRenderer:this._createLaserLineRenderer(),visibleLineMaterialInner:n.createPolylineMaterial(b.lineOfSightInnerWidth,b.lineOfSightVisibleInnerColor),visibleLineMaterialOuter:n.createPolylineMaterial(b.lineOfSightOuterWidth,b.lineOfSightVisibleOuterColor),occludedLineMaterialInner:n.createPolylineMaterial(b.lineOfSightInnerWidth,b.lineOfSightOccludedInnerColor),occludedLineMaterialOuter:n.createPolylineMaterial(b.lineOfSightOuterWidth,
b.lineOfSightOccludedOuterColor),undefinedLineMaterialInner:n.createPolylineMaterial(b.lineOfSightInnerWidth,b.lineOfSightUndefinedInnerColor),undefinedLineMaterialOuter:n.createPolylineMaterial(b.lineOfSightOuterWidth,b.lineOfSightUndefinedOuterColor)};a.addRenderPlugin(this._engineResources.laserLineRenderer.renderSlots,this._engineResources.laserLineRenderer);a.add(3,this._engineResources.visibleLineMaterialInner);a.add(3,this._engineResources.visibleLineMaterialOuter);a.add(3,this._engineResources.occludedLineMaterialInner);
a.add(3,this._engineResources.occludedLineMaterialOuter);a.add(3,this._engineResources.undefinedLineMaterialInner);a.add(3,this._engineResources.undefinedLineMaterialOuter);this._setDirty(l.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)};c.prototype._onObserverChange=function(a){B.isNone(a)?(this._observer.manipulator.available=!1,this.targets.removeAll()):(this._observer.location=a,this._observer.intersection=null,this._observer.manipulator.available=!0,this._observer.manipulator.location=a,this._tracker.point.manipulator.location=
a,this._analyses.forEach(function(a){a.isDirty=!0;a.isValid=!1}),this._setDirty(l.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE))};c.prototype._onTargetsChange=function(a){var b=this;this._analyses.forEach(function(a){b._destroyLineOfSightAnalysis(a)});this._analyses.removeAll();a.items&&this._onTargetCollectionChange({target:a,added:a.items,removed:[],moved:[]})};c.prototype._onTargetCollectionChange=function(a){var b=this;a.added.forEach(function(a){if(!b._analyses.some(function(b){return b.target===a})){var c=
b._createLineOfSightAnalysis(a);b._analyses.add(c)}b._setDirty(l.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)});a.removed.forEach(function(a){var c=b._analyses.find(function(b){return b.point.location===a.location});b._destroyLineOfSightAnalysis(c);b._analyses.remove(c)})};c.prototype._onTargetLocationChange=function(a,b){a.isValid=!1;a.point.location=b;a.point.intersection=null;a.point.manipulator.location=b;a.isDirty=!0;this._setDirty(l.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)};c.prototype._onGroundOpacityChange=
function(a,b){!this._analyses.length||1!==a&&1!==b||a===b||(this._setDirty(l.Task.LINE_OF_SIGHT_TOOL),this._analyses.forEach(function(a){return a.isDirty=!0}))};c.prototype._onContentChange=function(){this._analyses.forEach(function(a){a.isDirty=!0;a.shouldIntersect=!0});this._setDirty(l.Task.LINE_OF_SIGHT_TOOL)};c.prototype._onCameraChange=function(){if(this._analyses.length){var a=!1;if(this.observer){this.view.renderCoordsHelper.toRenderCoords(this.observer,t);var b=this.view.state.camera.computeScreenPixelSizeAt(t),
a=a||.1<Math.abs((b-this._screenPixelSize)/this._screenPixelSize)}this._analyses.some(function(a){return!a.isValid})&&(a=!0);a&&(this._setDirty(l.Task.LINE_OF_SIGHT_TOOL),this._analyses.forEach(function(a){return a.isDirty=!0}))}};c.prototype._onSlicePlaneChange=function(){this._analyses.length&&(this._setDirty(l.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE),this._analyses.forEach(function(a){return a.isDirty=!0}))};c.prototype._addPointFromClickEvent=function(a){if((a=this._getScreenPointIntersection(a))&&
a.point)if(this.observer){var b=new E({location:a.point}),c=this._createLineOfSightAnalysis(b);this._analyses.add(c);c.point.intersection=a;this.targets.add(b)}else this.observer=a.point,this._observer.intersection=a};c.prototype._clickHandler=function(a){this._showTracker&&(this._addPointFromClickEvent({x:a.x,y:a.y}),a.stopPropagation())};c.prototype._doubleClickHandler=function(a){this._showTracker&&(this.stop(),a.stopPropagation())};c.prototype._keyDownHandler=function(a){this._showTracker&&"Escape"===
a.key&&(this.stop(),a.stopPropagation())};c.prototype._pointerMoveHandler=function(a){this._showTracker&&(a=this._getScreenPointIntersection({x:a.x,y:a.y}))&&(this._tracker.point.manipulator.location=a.point,this._tracker.isDirty=!0,this._updateLaserLineRenderer(),this._setDirty(l.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE))};c.prototype._getScreenPointIntersection=function(a){a=J.screenPointObjectToArray(a,N.sv2d.get());a=w.ray.fromScreen(this.view.state.camera,a,D);return this._getRayIntersection(a)};
c.prototype._getRayIntersection=function(a){this.view.sceneIntersectionHelper.intersectToolIntersectorRay(a,this._intersector);var b=this._intersector.results.min;if(!b||!b.getIntersectionPoint(t))return null;var c=new C;this.view.renderCoordsHelper.fromRenderCoords(t,c,this.view.spatialReference);var f=m.vec3f64.create();d.vec3.copy(f,b.normal);var h=0<d.vec3.dot(f,a.direction)?-1:1;d.vec3.scale(f,f,h);var z=b.toGraphic(this.view);if(B.isSome(z)){var h=z.layer,k=z.sourceLayer,g=void 0;if(k)switch(k.type){case "scene":g=
L.getObjectId(z,k.objectIdField);break;case "integrated-mesh":b=b.target;g=b.metadata.nodeIndex+"/"+b.metadata.componentIndex;break;default:g=z.uid}else g=z.uid;return{type:"Graphic",id:h.uid+"/"+g,ray:w.ray.copy(a),normal:f,point:c}}return"TerrainRenderer"===b.intersector?(b=b.target,{type:"Terrain",id:b.metadata.tile.lij.slice(),ray:w.ray.copy(a),normal:f,point:c}):null};c.prototype._createLineOfSightAnalysis=function(a){var b=this,c=this.configuration,f={isValid:!1,isDirty:!0,shouldRender:!0,shouldIntersect:!1,
point:{location:a.location,manipulator:this._addManipulator({size:c.targetManipulatorSize,customColor1:c.targetManipulatorVisibleColor,customColor2:c.targetManipulatorOccludedColor,customColor3:c.targetManipulatorUndefinedColor}),intersection:null},isTargetVisible:!1,hasIntersection:!1,target:a,targetHandle:null,engine:{points:{observer:m.vec3f64.create(),target:m.vec3f64.create(),intersection:m.vec3f64.create(),intersectionObserver:m.vec3f64.create(),intersectionTarget:m.vec3f64.create()},visualization:new R}};
f.point.manipulator.location=a.location;f.targetHandle=v.init(a,"location",function(a){return b._onTargetLocationChange(f,a)},!0);this.manipulators.add(f.point.manipulator);this.view._stage.add(1,f.engine.visualization);this._engineLayer.addObject(f.engine.visualization);return f};c.prototype._destroyLineOfSightAnalysis=function(a){a.targetHandle.remove();this.manipulators.remove(a.point.manipulator);this.view._stage.remove(1,a.engine.visualization.id);this._engineLayer.removeObject(a.engine.visualization)};
c.prototype._canComputeAnalysis=function(a){this.view.renderCoordsHelper.toRenderCoords(this.observer,t);var b=this.view.frustum.intersectsPoint(t);this.view.renderCoordsHelper.toRenderCoords(a.point.location,t);a=this.view.frustum.intersectsPoint(t);return b&&a};c.prototype._manipulatorGrabChanged=function(a,b){switch(b.action){case "start":this._grabbedManipulator=a;break;case "end":this._grabbedManipulator===a&&(this._grabbedManipulator=null)}this._updateTrackerVisibility()};c.prototype._canUpdateFromIntersectionResult=
function(a,b){return a&&b&&a.type===b.type?"Terrain"===a.type?(a=a.id,b=b.id,a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]||O.tilesAreRelated(a,b)):"Graphic"===a.type||"I3S"===a.type?a.id===b.id:!1:!1};c.prototype._updateFromIntersectionResult=function(a){var b;if("Terrain"===a.type){this.view.renderCoordsHelper.toRenderCoords(a.point,k);this.view.renderCoordsHelper.worldUpAtPosition(k,h);var c=this.view.basemapTerrain.elevationBounds;b=this.view.renderCoordsHelper.getAltitude(k);c=c?Math.abs(c.max-c.min)/
Math.abs(b):100;b=0<b?1:-1;d.vec3.normalize(h,h);d.vec3.scale(h,h,b*c);d.vec3.add(p,k,h);w.ray.fromPoints(p,k,D);b=this._getRayIntersection(D)}else b=this._getRayIntersection(a.ray);return this._canUpdateFromIntersectionResult(b,a)?b.point:null};c.prototype._updateAnalyses=function(a){var b=this;if(this.observer){if(this._analyses.some(function(a){return a.shouldIntersect})){var c=this._observer.intersection;if(c=c&&this._updateFromIntersectionResult(c))this._observer.manipulator.location=c}this._set("updating",
this._updateAnalysis(this._tracker,"tracker")||this._analyses.items.some(function(c,d){return b._updateAnalysis(c,""+d,a)}))}else this._set("updating",!1)};c.prototype._updateAnalysis=function(a,b,c){if(!a.shouldRender)return a.engine.visualization.removeAllGeometries(),a.isDirty=!1;if(!a.isDirty)return!1;if(a.shouldIntersect){var f=a.point.intersection;if(f=f&&this._updateFromIntersectionResult(f))a.point.manipulator.location=f;a.shouldIntersect=!1}this.view.renderCoordsHelper.toRenderCoords(a.point.manipulator.location,
a.engine.points.target);this.view.renderCoordsHelper.toRenderCoords(this._observer.manipulator.location,a.engine.points.observer);var e="tracker"===b?!0:this._canComputeAnalysis(a),f=a.engine,g=f.points.observer,l=f.points.target;this._screenPixelSize=this.view.state.camera.computeScreenPixelSizeAt(g);this._observer.intersection?d.vec3.copy(h,this._observer.intersection.normal):d.vec3.subtract(h,l,g);var m=this._screenPixelSize;d.vec3.normalize(h,h);d.vec3.scale(h,h,Math.min(m,1));d.vec3.add(p,g,
h);a.point.intersection?d.vec3.copy(h,a.point.intersection.normal):d.vec3.subtract(h,g,l);m=this.view.state.camera.computeScreenPixelSizeAt(l);d.vec3.normalize(h,h);d.vec3.scale(h,h,Math.min(m,1));d.vec3.add(k,l,h);e?(e=w.ray.fromPoints(p,k,D),this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this._intersector),a.hasIntersection=this._intersector.results.min?this._intersector.results.min.getIntersectionPoint(q):!1,a.isTargetVisible=!0,a.hasIntersection&&(d.vec3.copy(f.points.intersection,
q),d.vec3.copy(f.points.intersectionObserver,p),d.vec3.copy(f.points.intersectionTarget,k),this.view.renderCoordsHelper.fromRenderCoords(f.points.intersection,t,this.view.spatialReference),e=1-d.vec3.dist(k,l)/d.vec3.dist(g,l),a.isTargetVisible=d.vec3.dist(g,f.points.intersection)>=e*d.vec3.dist(g,l)),a.isValid=!0,g=new C(t,this.view.spatialReference),a.target.intersectedLocation=a.isTargetVisible?null:g,a.target.intersectedGraphic=a.isTargetVisible?null:this._intersector.results.min.toGraphic(this.view),
a.target.visible=a.hasIntersection?a.isTargetVisible:!1):a.isValid?(d.vec3.copy(q,f.points.intersection),g=d.vec3.dist(a.engine.points.intersectionObserver,f.points.intersection)/d.vec3.dist(a.engine.points.intersectionObserver,a.engine.points.intersectionTarget),d.vec3.sub(x,p,a.engine.points.intersectionObserver),d.vec3.scale(x,x,1-g),d.vec3.add(q,q,x),d.vec3.sub(x,k,a.engine.points.intersectionTarget),d.vec3.scale(x,x,g),d.vec3.add(q,q,x)):(a.hasIntersection=!1,a.target.intersectedLocation=null,
a.target.intersectedGraphic=null,a.target.visible=void 0);u[12]=f.points.observer[0];u[13]=f.points.observer[1];u[14]=f.points.observer[2];d.vec3.subtract(p,p,f.points.observer);d.vec3.subtract(k,k,f.points.observer);d.vec3.subtract(q,q,f.points.observer);a.engine.visualization.removeAllGeometries();a.isValid?(a.point.manipulator.state=a.isTargetVisible?16:32,a.engine.visualization.addGeometry(n.createPolylineGeometry(p,a.isTargetVisible?k:q,b+"-visible-inner"),this._engineResources.visibleLineMaterialInner,
u),a.isTargetVisible?a.engine.visualization.addGeometry(n.createPolylineGeometry(p,a.isTargetVisible?k:q,b+"-visible-outer"),this._engineResources.visibleLineMaterialOuter,u):(a.engine.visualization.addGeometry(n.createPolylineGeometry(q,k,b+"-occluded-inner"),this._engineResources.occludedLineMaterialInner,u),a.engine.visualization.addGeometry(n.createPolylineGeometry(p,k,b+"-occluded-outer"),this._engineResources.occludedLineMaterialOuter,u))):(a.point.manipulator.state=64,a.engine.visualization.addGeometry(n.createPolylineGeometry(p,
k,b+"-observer-inner"),this._engineResources.undefinedLineMaterialInner,u),a.engine.visualization.addGeometry(n.createPolylineGeometry(p,k,b+"-observer-inner"),this._engineResources.undefinedLineMaterialOuter,u));a.isDirty=!1;return c?(c.madeProgress(),c.done):!1};g.__decorate([r.property({constructOnly:!0})],c.prototype,"view",void 0);g.__decorate([r.property({dependsOn:["_showTracker","observer"],readOnly:!0})],c.prototype,"state",null);g.__decorate([r.property({readOnly:!0,dependsOn:["_showTracker"]})],
c.prototype,"cursor",null);g.__decorate([r.property({dependsOn:["view.type"],readOnly:!0})],c.prototype,"isSupported",null);g.__decorate([r.property({type:C})],c.prototype,"observer",void 0);g.__decorate([r.property({type:y.LineOfSightTargetCollection,nonNullable:!0})],c.prototype,"targets",void 0);g.__decorate([r.property({type:I.Configuration})],c.prototype,"configuration",void 0);g.__decorate([r.property({readOnly:!0})],c.prototype,"updating",void 0);g.__decorate([r.property()],c.prototype,"_showTracker",
void 0);return c=g.__decorate([r.subclass("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool")],c)}(T.InteractiveToolBase);y.LineOfSightTool=A;var t=m.vec3f64.create(),p=m.vec3f64.create(),k=m.vec3f64.create(),q=m.vec3f64.create(),h=m.vec3f64.create(),D=w.ray.create(),x=m.vec3f64.create(),u=K.mat4f64.create(),U=w.lineSegment.create()});