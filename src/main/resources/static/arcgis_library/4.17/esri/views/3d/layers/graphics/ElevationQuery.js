// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../geometry ../../../../core/arrayUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../support/Scheduler".split(" "),function(h,k,f,p,q,m,l,r){Object.defineProperty(k,"__esModule",{value:!0});k.ElevationQuery=k.ViewElevationProvider=void 0;h=function(){function b(a,g){this.spatialReference=a;this.view=g}b.prototype.getElevation=function(a,g,c){return this.view.elevationProvider.getElevation(a,g,0,this.spatialReference,c)};b.prototype.queryElevation=
function(a,g,c,e,d){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(b){return[2,this.view.elevationProvider.queryElevation(a,g,0,this.spatialReference,d,c,e)]})})};return b}();k.ViewElevationProvider=h;h=function(){function b(a,g,c,e){var d=this;this.spatialReference=g;this._getElevationQueryProvider=c;this._queries=[];this._queryOptions=f.__assign(f.__assign({},e),{ignoreInvisibleLayers:!0});this._frameTask=a.registerTask(r.Task.ELEVATION_QUERY,function(){return d._update()},
function(){return 0<d._queries.length})}b.prototype.destroy=function(){this._frameTask.remove()};b.prototype.queryElevation=function(a,g,c,e){var d=this;void 0===e&&(e=0);return l.create(function(b,f){var n={x:a,y:g,minDemResolution:e,result:{resolve:b,reject:f},signal:c};d._queries.push(n);l.onAbort(c,function(){q.remove(d._queries,n);f(l.createAbortError())})})};b.prototype._update=function(){var a=this._queries;this._queries=[];var b=this._getElevationQueryProvider();if(b){var c=a.map(function(a){return[a.x,
a.y]}),e=a.reduce(function(a,b){return Math.min(a,b.minDemResolution)},Infinity),c=new p.Multipoint({points:c,spatialReference:this.spatialReference}),d=1<a.length&&a.some(function(a){return!!a.signal})?l.createAbortController():null,k=m.isSome(d)?d.signal:a[0].signal;if(m.isSome(d)){var h=0;a.forEach(function(b){return l.onAbort(b.signal,function(){h++;b.result.reject(l.createAbortError());h===a.length&&d.abort()})})}e=f.__assign(f.__assign({},this._queryOptions),{minDemResolution:e,signal:k});b.queryElevation(c,
e).then(function(b){a.forEach(function(a,c){m.isSome(a.signal)&&a.signal.aborted?a.result.reject(l.createAbortError()):a.result.resolve(b.geometry.points[c][2])})}).catch(function(b){a.forEach(function(a){return a.result.reject(b)})})}else a.forEach(function(a){return a.result.reject()})};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{update:function(){return 0<a._queries.length&&a._update()}}},enumerable:!1,configurable:!0});return b}();k.ElevationQuery=h});