// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/geodesicConstants ../webgl-engine/lib/BufferVectorMath".split(" "),function(ma,f,R,D,ia,N,O,P,Z,ja,m,ka){function W(a,c,b,d){if(2>a.length)return!1;2===a.length&&(e[0]=a[0],e[1]=a[1],e[2]=0,a=e);return F(a,
c,0,b,d,0,1)}function F(a,c,b,d,g,h,f){void 0===f&&(f=1);c=S(c,g,X);if(D.isNone(c))return!1;if(c===k){if(a===d&&b===h)return!0;for(c=b+3*f;b<c;b++,h++)d[h]=a[b];return!0}for(f=b+3*f;b<f;b+=3,h+=3)c(a,b,d,h);return!0}function C(a,c){if(c.spatialReference===a)return c.spatialReferenceId;c.spatialReference=a;"metersPerUnit"in c&&(c.metersPerUnit=ia.getMetersPerUnitForSR(a,1));return a.wkt===f.SphericalECEFSpatialReference.wkt?c.spatialReferenceId=1:a.isWGS84?c.spatialReferenceId=2:a.isWebMercator?c.spatialReferenceId=
3:a.wkt===f.WGS84ECEFSpatialReference.wkt?c.spatialReferenceId=4:4490===a.wkid?c.spatialReferenceId=5:c.spatialReferenceId=0}function k(a,c,b,d){a!==b&&(b[d++]=a[c++],b[d++]=a[c++],b[d]=a[c])}function Q(a,c,b,d){b[d++]=G*(a[c++]/m.earthRadius);b[d++]=G*(Math.PI/2-2*Math.atan(Math.exp(-1*a[c++]/m.earthRadius)));b[d]=a[c]}function aa(a,c,b,d){Q(a,c,b,d);H(b,d,b,d)}function ba(a,c,b,d){Q(a,c,b,d);I(b,d,b,d)}function J(a,c,b,d){var g=.4999999*Math.PI,g=R.clamp(p*a[c+1],-g,g),g=Math.sin(g);b[d++]=p*a[c]*
m.earthRadius;b[d++]=m.halfEarthRadius*Math.log((1+g)/(1-g));b[d]=a[c+2]}function H(a,c,b,d){var g=m.earthRadius+a[c+2],h=p*a[c+1];a=p*a[c];c=Math.cos(h);b[d++]=Math.cos(a)*c*g;b[d++]=Math.sin(a)*c*g;b[d]=Math.sin(h)*g}function K(a,c,b,d){var g=ka.Vec3Compact.length(a,c),h=R.asinClamped(a[c+2]/(0===g?1:g));a=Math.atan2(a[c+1],a[c]);b[d++]=G*a;b[d++]=G*h;b[d]=g-m.earthRadius}function ca(a,c,b,d){K(a,c,b,d);J(b,d,b,d)}function da(a,c,b,d){K(a,c,b,d);I(b,d,b,d)}function I(a,c,b,d){var g=m.earthEllipsoidConstants,
h=p*a[c],f=p*a[c+1];a=a[c+2];c=Math.sin(f);var f=Math.cos(f),q=g.a/Math.sqrt(1-g.e2*c*c);b[d++]=(q+a)*f*Math.cos(h);b[d++]=(q+a)*f*Math.sin(h);b[d++]=(q*(1-g.e2)+a)*c}function L(a,c,b,d){var g=m.earthEllipsoidConstants,f=a[c],e=a[c+1];a=a[c+2];var q,k,l,n,r,p;c=Math.abs(a);q=f*f+e*e;k=Math.sqrt(q);l=q+a*a;n=Math.sqrt(l);f=Math.atan2(e,f);r=a*a/l;l=q/l;e=g.a2/n;q=g.a3-g.a4/n;.3<l?(r=c/n*(1+l*(g.a1+e+r*q)/n),n=Math.asin(r),e=r*r,l=Math.sqrt(1-e)):(l=k/n*(1-r*(g.a5-e-l*q)/n),n=Math.acos(l),e=1-l*l,r=
Math.sqrt(e));p=1-g.e2*e;e=g.a/Math.sqrt(p);g=g.a6*e;e=k-e*l;q=c-g*r;c=l*e+r*q;k=l*q-r*e;g=k/(g/p+c);n+=g;0>a&&(n=-n);b[d++]=G*f;b[d++]=G*n;b[d]=c+k*g/2}function ea(a,c,b,d){L(a,c,b,d);H(b,d,b,d)}function fa(a,c,b,d){L(a,c,b,d);J(b,d,b,d)}function S(a,c,b){void 0===b&&(b=Y());return ga(a,c,b).projector}function ga(a,c,b){if(b.source.spatialReference===a&&b.dest.spatialReference===c)return b;var d=C(a,b.source),g=C(c,b.dest);0===d&&0===g?a.equals(c)?b.projector=k:b.projector=null:b.projector=E[d][g];
return b}function Y(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:k}}var u,v,w,x,y,z,A,B;Object.defineProperty(f,"__esModule",{value:!0});f.getProjector=f.wgs84ComparableLonLatToECEF=f.vectorToWGS84ComparableLonLat=f.canProjectToWGS84ComparableLonLat=f.webMercator=f.boundingRectToBoundingRect=f.mbsToMbs=f.transformDirection=f.computeLinearTransformation=f.localLinearScaleFactors=f.bufferToBuffer=
f.xyzToVector=f.pathsToPaths=f.vectorToVector=f.getProjectorName=f.canProject=f.WGS84ECEFSpatialReference=f.SphericalECEFSpatialReference=void 0;f.SphericalECEFSpatialReference=new Z({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",'+m.earthRadius+',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});f.WGS84ECEFSpatialReference=new Z({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});
f.canProject=function(a,c){return!!S(a,c,X)};f.getProjectorName=function(a,c){a=S(a,c,X);return a===k?"copy3":a===H?"wgs84ToSphericalECEF":a===J?"wgs84ToWebMercator":a===I?"wgs84ToWGS84ECEF":a===Q?"webMercatorToWGS84":a===aa?"webMercatorToSphericalECEF":a===ba?"webMercatorToWGS84ECEF":a===L?"wgs84ECEFToWGS84":a===ea?"wgs84ECEFToSphericalECEF":a===fa?"wgs84ECEFToWebMercator":a===K?"sphericalECEFToWGS84":a===ca?"sphericalECEFToWebMercator":a===da?"sphericalECEFToWGS84ECEF":null};f.vectorToVector=W;
f.pathsToPaths=function(a,c,b,d,g,f,e){void 0===e&&(e=0);for(var h=[],k=0;k<a.length;k++)for(var l=a[k],n=0,m=l;n<m.length;n++)l=m[n],h.push(l[0],l[1],c?l[2]:e);if(!F(h,d,0,h,f,0,h.length/3))return!1;d=0;for(f=g.length=0;f<a.length;f++){l=a[f];e=[];k=0;for(n=l;k<n.length;k++)l=n[k],c&&b?e.push([h[d++],h[d++],h[d++],l[3]]):c?e.push([h[d++],h[d++],h[d++]]):(b?e.push([h[d++],h[d++],l[2]]):e.push([h[d++],h[d++]]),d++);g.push(e)}return!0};f.xyzToVector=function(a,c,b,d,f,h){e[0]=a;e[1]=c;e[2]=b;return F(e,
d,0,f,h,0,1)};f.bufferToBuffer=F;f.localLinearScaleFactors=function(a,c,b,d){var f=C(c,T),e=C(d,ha);if(f===e&&0!==f||c.equals(d))return b[0]=1,b[1]=1,b[2]=1,!0;if(1===f){c=O.vec3.length(a);a=c/Math.sqrt(a[0]*a[0]+a[1]*a[1]);c/=m.earthRadius;if(3===e)return b[0]=a*c,b[1]=a*c,b[2]=1,!0;if(2===e||5===e)return e=180/(m.earthRadius*Math.PI),b[0]=e*a*c,b[1]=e*c,b[2]=1,!0}return!1};f.computeLinearTransformation=function(a,c,b,d){var f=C(a,T),e=C(d,ha);if(f===e&&1!==e&&(0!==f||a.equals(d)))return N.mat4.identity(b),
N.mat4.translate(b,b,c),!0;if(1===e){a=E[f][6];e=E[6][e];if(D.isNone(a)||D.isNone(e))return!1;a(c,0,t,0);e(t,0,M,0);a=p*t[0];e=p*t[1];c=Math.sin(a);a=Math.cos(a);d=Math.sin(e);e=Math.cos(e);b[0]=-c;b[4]=-d*a;b[8]=e*a;b[12]=M[0];b[1]=a;b[5]=-d*c;b[9]=e*c;b[13]=M[1];b[2]=0;b[6]=e;b[10]=d;b[14]=M[2];b[3]=0;b[7]=0;b[11]=0;b[15]=1;return!0}if(3===e&&(2===f||1===f)){a=E[f][6];if(D.isNone(a))return!1;a(c,0,t,0);c=p*t[1];J(t,0,M,0);N.mat4.identity(b);N.mat4.translate(b,b,M);c=1/Math.cos(c);N.mat4.scale(b,
b,[c,c,1]);return!0}return!1};f.transformDirection=function(a,c,b,d,e){O.vec3.copy(U,a);O.vec3.add(V,a,c);W(U,b,U,e);W(V,b,V,e);O.vec3.subtract(d,V,U);O.vec3.normalize(d,d)};f.mbsToMbs=function(a,c,b,d){c=ga(c,d,la);if(c.projector===k)return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],!0;if(D.isNone(c.projector))return!1;d=c.source;var e=c.dest;if(3===e.spatialReferenceId){c=E[d.spatialReferenceId][2];if(D.isNone(c))return!1;c(a,0,t,0);c=Math.abs(p*t[1])+Math.asin(a[3]/(m.earthRadius+a[2]));J(t,0,b,0);
b[3]=c>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(c)*a[3];return!0}c.projector(a,0,b,0);b[3]=a[3]*d.metersPerUnit/e.metersPerUnit;return!0};f.boundingRectToBoundingRect=function(a,c,b,d){if(null==a)return!1;if(c.equals(d))return ja.set(b,a),!0;e[0]=a[0];e[1]=a[1];e[2]=0;if(!F(e,c,0,e,d,0,1))return!1;b[0]=e[0];b[1]=e[1];e[0]=a[2];e[1]=a[3];e[2]=0;if(!F(e,c,0,e,d,0,1))return!1;b[2]=e[0];b[3]=e[1];return!0};(function(a){a.x2lon=function(a){return a/m.earthRadius};a.y2lat=function(a){return Math.PI/2-
2*Math.atan(Math.exp(-1*a/m.earthRadius))};a.lon2x=function(a){return a*m.earthRadius};a.lat2y=function(a){a=Math.sin(a);return m.earthRadius/2*Math.log((1+a)/(1-a))}})(f.webMercator||(f.webMercator={}));f.canProjectToWGS84ComparableLonLat=function(a){a=C(a,T);return!!E[a][6]};f.vectorToWGS84ComparableLonLat=function(a,c,b){c=C(c,T);c=E[c][6];if(D.isNone(c))return!1;c(a,0,e,0);b!==e&&(b[0]=e[0],b[1]=e[1],2<b.length&&(b[2]=e[2]));return!0};f.wgs84ComparableLonLatToECEF=function(a,c,b,d){void 0===d&&
(d=0);d=m.earthRadius+d;var e=Math.cos(b);a[0]=Math.cos(c)*e*d;a[1]=Math.sin(c)*e*d;a[2]=Math.sin(b)*d};var E=(u={},u[2]=(v={},v[5]=null,v[6]=k,v[1]=H,v[0]=null,v[3]=J,v[2]=k,v[4]=I,v),u[5]=(w={},w[5]=k,w[6]=k,w[1]=H,w[0]=null,w[3]=null,w[2]=null,w[4]=I,w),u[3]=(x={},x[5]=null,x[6]=Q,x[1]=aa,x[0]=null,x[3]=k,x[2]=Q,x[4]=ba,x),u[4]=(y={},y[5]=L,y[6]=L,y[1]=ea,y[0]=null,y[3]=fa,y[2]=L,y[4]=k,y),u[1]=(z={},z[5]=K,z[6]=K,z[1]=k,z[0]=null,z[3]=ca,z[2]=K,z[4]=da,z),u[0]=(A={},A[5]=null,A[6]=null,A[1]=null,
A[0]=k,A[3]=null,A[2]=null,A[4]=null,A),u[6]=(B={},B[5]=null,B[6]=k,B[1]=H,B[0]=null,B[3]=null,B[2]=k,B[4]=I,B),u);f.getProjector=S;var T={spatialReference:null,spatialReferenceId:0},ha={spatialReference:null,spatialReferenceId:0},X=Y(),la=Y(),p=R.deg2rad(1),G=R.rad2deg(1),e=P.vec3f64.create(),t=P.vec3f64.create(),M=P.vec3f64.create(),U=P.vec3f64.create(),V=P.vec3f64.create()});