// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),function(h,c,k,q,d,f,l,r,t,m,n,u,v){Object.defineProperty(c,"__esModule",{value:!0});c.ZoomStepController=
void 0;h=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.zoomLocation=f.vec3f64.create();a.tmpCamera=new n.default;a.tmpViewDir=f.vec3f64.create();a.targetOnSphere=f.vec3f64.create();a.tmpCenter=f.vec3f64.create();a.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new n.default,interactionDirection:null,tiltMode:0};a.sphere=m.sphere.create();return a}k.__extends(b,c);b.prototype.initialize=function(){this.intersector=new u.Intersector(this.view.state.mode)};
b.prototype.zoomStep=function(a,p){if(this.active){var c=this.view.state,b=this.constraintOptions.interactionStartCamera;this.animation.finished?b.copyFrom(c.camera):this.animation.cameraAt(1,b);b=!1;0<a&&this.intersectionHelper.intersectScreen(p,this.zoomLocation)&&(b=!0);this.tmpCamera.copyFrom(c.camera);b?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,
this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:d.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,p);this.begin(this.tmpCamera)}};b.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:v.outExpo}};b.prototype.updateCamera=function(a,b,c,f){this.sphere.radius=d.vec3.length(c);d.vec3.subtract(this.tmpViewDir,a.center,a.eye);var e=d.vec3.length(this.tmpViewDir),g=e*b;1>=b&&4>g&&(g=4,b=g/e);1E-6>Math.abs(e-
g)||(e=d.vec3.length(a.center),this.sphere.radius!==e&&d.vec3.scale(a.center,a.center,(this.sphere.radius+b*(e-this.sphere.radius))/e),d.vec3.scale(this.tmpViewDir,this.tmpViewDir,-b),d.vec3.add(a.eye,a.center,this.tmpViewDir),l.applyAll(this.view,a,this.constraintOptions),1E-12<d.vec3.squaredDistance(c,a.center)&&m.sphere.intersectScreen(this.sphere,a,f,this.targetOnSphere)&&t.panToPosition(this.sphere,a,c,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0),l.applySurfaceCollisionConstraint(this.view,
a))};return b=k.__decorate([q.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],b)}(r.PointToPointAnimationController);c.ZoomStepController=h});