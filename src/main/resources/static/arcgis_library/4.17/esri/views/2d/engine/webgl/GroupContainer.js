// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","tslib","../../../webgl","./WGLContainer"],function(h,e,f,l,m){Object.defineProperty(e,"__esModule",{value:!0});e.GroupContainer=void 0;h=function(g){function b(){var a=null!==g&&g.apply(this,arguments)||this;a._lastWidth=0;a._lastHeight=0;return a}f.__extends(b,g);b.prototype.dispose=function(){this._renderTarget&&(this._renderTarget.dispose(),this._renderTarget=null)};b.prototype.doRender=function(a){a=this.createRenderParams(a);var c=a.context,d=a.painter,k=a.profiler;
this._prevFBO=c.getBoundFramebufferObject();k.recordContainerStart(this.name);var b=this._getFbo(a),g=d.getRenderTarget();c.bindFramebuffer(b);d.setRenderTarget(b);c.setDepthWriteEnabled(!0);c.setClearColor(0,0,0,0);c.setClearDepth(1);c.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT);c.setDepthWriteEnabled(!1);for(var e=0,f=this.children;e<f.length;e++)f[e].processRender(a);d.setRenderTarget(g);c.bindFramebuffer(this._prevFBO);d.beforeRenderLayer(a,this._clippingInfos?255:0,this.computedOpacity);
c.setStencilTestEnabled(!1);c.setStencilWriteMask(0);d.blitTexture(c,b.colorTexture,9728);d.compositeLayer(a,this.computedOpacity);k.recordContainerEnd()};b.prototype.createRenderParams=function(a){return f.__assign(f.__assign({},g.prototype.createRenderParams.call(this,a)),{blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:1})};b.prototype._getFbo=function(a){var c=a.context;a=a.painter;var d=c.getViewport(),b=d.width,d=d.height;if(b!==this._lastWidth||d!==this._lastHeight)this._lastWidth=
b,this._lastHeight=d,this._renderTarget?this._renderTarget.resize(b,d):(b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:b,height:d},a=a.getSharedStencilBuffer(),this._renderTarget=new l.FramebufferObject(c,{colorTarget:0,depthStencilTarget:3},b,a));return this._renderTarget};return b}(m.default);e.GroupContainer=h});