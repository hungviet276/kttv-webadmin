// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/maybe","../../../core/PooledArray"],function(h,c,p,l){function m(a){return a?a[0]+"/"+a[1]+"/"+a[2]:"null"}function k(a,b){b(a);if(!a.isLeaf){var d=0;for(a=a.children;d<a.length;d++)k(a[d],b)}}function n(a,b,d){a=a.screenDepth;b=b.screenDepth;return a<b?-d:a>b?d:0}Object.defineProperty(c,"__esModule",{value:!0});c.tilesAreRelated=c.hasVisibleSiblings=c.computeUpsampleInfo=c.compareTiles=c.sortTiles=c.fallsWithinLayer=c.traverseTilesPreorder=c.tile2str=c.lij2str=
c.IteratorPostorder=c.IteratorPreorder=void 0;h=function(){function a(){this.q=new l;this._last=null}Object.defineProperty(a.prototype,"done",{get:function(){return 0===this.q.length&&(!this._last||this._last.isLeaf)},enumerable:!1,configurable:!0});a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null};a.prototype.reset=function(a){this.q.clear();a&&this.q.pushArray(a);this._last=null};a.prototype.skipSubtree=function(){this._last=null};a.prototype.next=function(){this._last&&
!this._last.isLeaf&&this.q.pushArray(this._last.children);return this._last=this.q.pop()};return a}();c.IteratorPreorder=h;h=function(){function a(){this.q=new l}Object.defineProperty(a.prototype,"done",{get:function(){return 0===this.q.length},enumerable:!1,configurable:!0});a.prototype.reset=function(a){this.q.clear();if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a){var b=this.q.data[a];b.isLeaf||this.q.pushArray(b.children)}};a.prototype.next=function(){return this.q.pop()};return a}();c.IteratorPostorder=
h;c.lij2str=m;c.tile2str=function(a){return a?m(a.lij):"null"};c.traverseTilesPreorder=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)k(a[c],b);else k(a,b)};c.fallsWithinLayer=function(a,b,c){if(p.isNone(b))return!1;var e=b.fullExtent,d=a.extent;if(c){if(d[0]<e.xmin||d[1]<e.ymin||d[2]>e.xmax||d[3]>e.ymax)return!1}else if(e.xmin>d[2]||e.ymin>d[3]||e.xmax<d[0]||e.ymax<d[1])return!1;a=a.surface.tilingScheme.levels[a.lij[0]].scale;return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&
a<.99999999*b.maxScale?!1:!0};c.sortTiles=function(a,b){b.sort(function(b,c){return n(b,c,a)})};c.compareTiles=n;c.computeUpsampleInfo=function(a,b,c){for(var d=1,f=0,g=0;a!==b;)if(d*=.5,f*=.5,g*=.5,a.lij[2]&1&&(f+=.5),0===(a.lij[1]&1)&&(g+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of upsampleTile");c.init(b,f,g,d)};c.hasVisibleSiblings=function(a){for(var b=0;b<a.length;b++){var c=a[b],e=c.parent;if(e)for(var f=0;4>f;f++){var g=e.children[f];if(g&&g!==c&&g.visible)return!0}}return!1};
c.tilesAreRelated=function(a,b){if(!a||!b)return!1;var c=a[0]<b[0],e=c?a:b;a=c?b:a;b=a[0]-e[0];if(0===b)return!1;b=1<<b;return Math.floor(a[1]/b)===e[1]&&Math.floor(a[2]/b)===e[2]}});