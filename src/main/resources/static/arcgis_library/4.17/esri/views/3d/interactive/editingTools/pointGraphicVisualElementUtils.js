// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/handleUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../support/elevationInfoUtils ./ManipulatorState ./settings ../visualElements/LaserlineVisualElement ../visualElements/LineVisualElement ../visualElements/PointVisualElement ../../layers/graphics/elevationAlignmentUtils ../../layers/graphics/ElevationContext ../../layers/graphics/GraphicState ../../support/pointUtils ../../support/projectionUtils".split(" "),
function(V,p,l,D,t,E,F,G,w,H,y,I,g,z,J,K,L,M,N,O,A){function P(a,e,b,c){var h=a.view,k=a.graphic,u=new J.LineVisualElement({view:h,infinite:g.settings.visualElements.zVerticalLine.infiniteType,attached:!1});g.settings.visualElements.zVerticalLine.apply(u);var q=new z.LaserlineVisualElement({view:h,intersectsLineInfinite:!0,attached:!1});g.settings.visualElements.pointGraphics.shadowStyle.apply(q);var m=D.deg2rad(g.settings.visualElements.heightPlaneAngleCutoff),n=new z.LaserlineVisualElement({view:h,
attached:!1,angleCutoff:m});g.settings.visualElements.heightPlane.apply(n);var m=y.getGraphicEffectiveElevationInfo(a.graphic),p=M.ElevationContext.fromElevationInfo(m),t="on-the-ground"===m.mode||!m.offset&&"absolute-height"!==m.mode,x=new I.ManipulatorState,B=1,C=1,v=function(){x.update(a);var b=t&&(e.isDraped||!r(k)||!k.geometry.hasZ),l=!0;if(!b&&r(k)){var f=k.geometry,m=L.evaluateElevationAlignmentAtPoint(k.geometry,h.elevationProvider,p,h.renderCoordsHelper);F.vec3.set(d,f.x,f.y,m);A.vectorToVector(d,
f.spatialReference,d,h.renderCoordsHelper.spatialReference);u.worldDownAtLocation=d;q.intersectsWorldUpAtLocation=d}else l=!1;f=x.grabbingState&2?g.settings.visualElements.laserlineAlphaMultiplier:1;f!==B&&(B=f,g.settings.visualElements.heightPlane.apply(n,f));f=w.empty(Q);!b&&e.displaying&&c.calculateMapBounds(f)&&A.vectorToVector(w.getMin(f,d),h.spatialReference,d,h.renderCoordsHelper.spatialReference)?(n.heightManifoldTarget=d,n.attached=!0):n.attached=!1;f=x.grabbingState&4?g.settings.visualElements.laserlineAlphaMultiplier:
1;f!==C&&(C=f,g.settings.visualElements.pointGraphics.shadowStyle.apply(q,f));b=l&&e.displaying&&!b;q.attached=b;u.attached=b};b.push(e.watch(["displaying","isDraped"],v),e.on("changed",v));a.forEachManipulator(function(a){b.push(a.events.on("grab-changed",v))});b.push(l.destroyHandle(q));b.push(l.destroyHandle(u));b.push(l.destroyHandle(n));v()}function R(a,e,b){var c=a.graphic,c=new K.PointVisualElement({view:a.view,geometry:r(c)?c.geometry:null,elevationInfo:y.getGraphicEffectiveElevationInfo(c),
attached:!1});S(a,c,e,b);b.push(l.destroyHandle(c));return c}function S(a,e,b,c){T(a,e,b,c);g.settings.visualElements.pointGraphics.outline.apply(e);c.push(E.init(b,"displaying",function(){return e.attached=b.displaying}))}function T(a,e,b,c){var h=a.view,k=a.graphic,d=null,g=function(){t.isSome(d)&&(d.remove(),d=null);b.isDraped&&r(k)&&(d=U(h,k.geometry,function(){e.geometry=k.geometry}))};a=function(){g();e.geometry=r(k)?k.geometry:null};c.push(b.on("changed",a),l.refHandle(function(){return d}));
a()}function U(a,e,b){O.pointToVector(e,d,a.elevationProvider.spatialReference);var c=d[0],h=d[1];return a.elevationProvider.on("elevation-change",function(a){H.containsXY(a.extent,c,h)&&b()})}function r(a){return t.isSome(a.geometry)&&"point"===a.geometry.type}Object.defineProperty(p,"__esModule",{value:!0});p.createVisualElements=void 0;p.createVisualElements=function(a){var e=a.view,b=new N.GraphicState({graphic:a.graphic}),c=[],d=R(a,b,c);P(a,b,c,d);c.push(e.trackGraphicState(b));return{visualElement:d,
remove:function(){l.handlesGroup(c).remove()}}};var d=G.vec3f64.create(),Q=w.create()});