// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../geometry ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../support/elevationInfoUtils ../../support/geometryUtils ../../support/geometryUtils ../../support/pointUtils ../../support/stack ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils ../../../interactive/dragEventPipeline".split(" "),function(K,a,m,r,D,f,n,g,
p,q,E,l,t,u,F,v,G){function w(d,b){var k=p.vec3f64.create(),c=p.vec3f64.create(),h=!1;return function(e){if("start"===e.action){var a=n.screenPointObjectToArray(e.screenStart,n.castScreenPointArray(u.sv2d.get())),a=l.ray.fromScreen(d.state.camera,a,x);h=l.plane.intersectRay(b,a,k)}if(!h)return null;a=n.screenPointObjectToArray(e.screenEnd,n.castScreenPointArray(u.sv2d.get()));a=l.ray.fromScreen(d.state.camera,a,x);return l.plane.intersectRay(b,a,c)?m.__assign(m.__assign({},e),{renderStart:k,renderEnd:c,
plane:b,ray:a}):null}}function y(d,b,k,c){void 0===c&&(c=null);var a=null;return function(e){if("start"===e.action&&(a=d.sceneIntersectionHelper.intersectElevationFromScreen(n.createScreenPointArray(e.screenStart.x,e.screenStart.y),b,k),f.isSome(a)&&f.isSome(c)&&!t.pointToPoint(a,a,c))||f.isNone(a))return null;var h=d.sceneIntersectionHelper.intersectElevationFromScreen(n.createScreenPointArray(e.screenEnd.x,e.screenEnd.y),b,k);return f.isSome(h)?f.isSome(c)&&!t.pointToPoint(h,h,c)?null:m.__assign(m.__assign({},
e),{mapStart:a,mapEnd:h}):null}}function z(d,b,a,c){void 0===c&&(c=null);b=q.getZForElevationMode(b,d,a);return y(d,a,b,c)}function A(d,a,k,c){void 0===c&&(c=null);return z(d,k,q.getGraphicEffectiveElevationInfo(a),c)}function H(a,b){var d=I,c=J,h=l.plane.create();a.renderCoordsHelper.worldUpAtPosition(b,d);a=g.vec3.cross(h,d,g.vec3.subtract(c,b,a.state.camera.eye));g.vec3.cross(a,a,d);return l.plane.fromPositionAndNormal(b,a,h)}function B(a,b){var d=p.vec3f64.create(),c=g.vec3.length(b);a.renderCoordsHelper.worldUpAtPosition(b,
d);var h=p.vec3f64.create(),e=p.vec3f64.create(),f=function(e){g.vec3.subtract(e,e,b);E.vector.projectPoint(d,e,e);"global"===a.viewingMode&&g.vec3.length(e)*D.sign(g.vec3.dot(d,e))<-c+.001&&g.vec3.subtract(e,g.vec3.scale(e,d,.001),b);g.vec3.add(e,e,b);return e};return function(a){a.renderStart=f(g.vec3.copy(h,a.renderStart));a.renderEnd=f(g.vec3.copy(e,a.renderEnd));return a}}function C(a,b){var d=a.renderCoordsHelper;return function(a){var c=d.fromRenderCoords(a.renderStart,new r.Point,b),e=d.fromRenderCoords(a.renderEnd,
new r.Point,b);return f.isSome(c)&&f.isSome(e)?m.__assign(m.__assign({},a),{mapStart:c,mapEnd:e}):null}}Object.defineProperty(a,"__esModule",{value:!0});a.screenToMap3D=a.hideManipulatorWhileDragging=a.convertToMapCoordinates=a.projectToWorldUp=a.screenToZConstrained=a.screenToMapXYForGraphic=a.screenToMapXYForGraphicAtLocation=a.screenToMapXYAtLocation=a.screenToMapXY=a.screenToRenderPlane=void 0;a.screenToRenderPlane=w;a.screenToMapXY=y;a.screenToMapXYAtLocation=z;a.screenToMapXYForGraphicAtLocation=
A;a.screenToMapXYForGraphic=function(a,b,k,c){a=b.toMap(a.screenStart,{include:[k]});return f.isSome(a)?A(b,k,a,c):null};a.screenToZConstrained=function(a,b,k){var c=null,d=new G.EventPipeline;d.next(w(a,H(a,b))).next(B(a,b)).next(C(a,k)).next(function(a){a.mapEnd.x=a.mapStart.x;a.mapEnd.y=a.mapStart.y;c=a});return function(a){c=null;d.execute(a);return c}};a.projectToWorldUp=B;a.convertToMapCoordinates=C;a.hideManipulatorWhileDragging=function(a){var b=null;return function(d){switch(d.action){case "start":b=
a.disableDisplay();break;case "end":case "cancel":f.isSome(b)&&(b.remove(),b=null)}return d}};a.screenToMap3D=function(a,b){void 0===b&&(b=null);var d=null,c=new F.Intersector(a.state.mode);c.options.selectionMode=!0;c.options.store=0;var h=n.createScreenPointArray(),e={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},g=p.vec3f64.create(),l=f.unwrapOr(b,a.spatialReference),q=function(b){a.map.ground&&1>a.map.ground.opacity?e.exclude.add(v.TERRAIN_ID):e.exclude.delete(v.TERRAIN_ID);a.sceneIntersectionHelper.intersectIntersectorScreen(n.screenPointObjectToArray(b,
h),c,e);b=c.results.min;if(b.getIntersectionPoint(g))b="TerrainRenderer"===b.intersector?0:1;else if(c.results.ground.getIntersectionPoint(g))b=0;else return null;var d=new r.Point({spatialReference:l});a.renderCoordsHelper.fromRenderCoords(g,d);return{location:d,surfaceType:b}};return function(a){if("start"===a.action){var b=q(a.screenStart);d=f.isSome(b)?b.location:null}if(f.isNone(d))return null;b=q(a.screenEnd);return f.isSome(b)?m.__assign(m.__assign({},a),{mapStart:d,mapEnd:b.location,surfaceType:b.surfaceType}):
null}};var I=p.vec3f64.create(),J=p.vec3f64.create(),x=l.ray.create()});