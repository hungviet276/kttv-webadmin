// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),function(e,g,c,k,r,t,d,f,l,u,m,n){function p(b,a){b&&!b.spatialReference.equals(a)&&(b=l.canProject(b.spatialReference,a)?l.project(b,a):null);return b}Object.defineProperty(g,"__esModule",{value:!0});
g.SurfaceExtentHelperLocal=g.SurfaceExtentHelperGlobal=void 0;e=function(b){function a(a){a=b.call(this,a)||this;a._handles=new r;return a}c.__extends(a,b);a.prototype.initialize=function(){var a=this;this._handles.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};a.prototype.destroy=function(){this._handles.destroy();this._handles=null};Object.defineProperty(a.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!1,configurable:!0});a.prototype._computeStencilEnabledExtents=function(a,b){var q=[],c=0;for(a=a.items;c<a.length;c++){var h=a[c].layer;"IntegratedMeshLayer"===h.operationalLayerType&&null!=b&&(h=p(h.fullExtent,b),null!=h&&q.push(f.fromExtent(h)))}return q};c.__decorate([d.property({readOnly:!0})],a.prototype,"layerViewsExtent",null);c.__decorate([d.property({readOnly:!0,
dependsOn:["spatialReference","tilingScheme"]})],a.prototype,"tiledLayersExtent",null);c.__decorate([d.property({readOnly:!0,dependsOn:["spatialReference"]})],a.prototype,"stencilEnabledExtents",null);c.__decorate([d.property()],a.prototype,"spatialReference",null);c.__decorate([d.property()],a.prototype,"tilingScheme",null);c.__decorate([d.property()],a.prototype,"defaultTiledLayersExtent",void 0);c.__decorate([d.property({constructOnly:!0})],a.prototype,"layers",void 0);c.__decorate([d.property({constructOnly:!0})],
a.prototype,"layerViews",void 0);return a=c.__decorate([d.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],a)}(k);k=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}c.__extends(a,b);a.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};a.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};a.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?m.WEBMERCATOR_WORLD_EXTENT:m.GEOGRAPHIC_WORLD_EXTENT};
c.__decorate([d.property({dependsOn:["spatialReference"]})],a.prototype,"layerViewsExtent",void 0);return a=c.__decorate([d.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],a)}(e);g.SurfaceExtentHelperGlobal=k;e=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}c.__extends(a,b);a.prototype.initialize=function(){var a=this;this._handles.add([this.layers.on("change",function(b){return a._handleLayersChanged(b)}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};
a.prototype._handleLayersChanged=function(a){for(var b=this,c=0,d=a.removed;c<d.length;c++)this._handles.remove(d[c].uid);c=0;for(a=a.added;c<a.length;c++)d=a[c],this._handles.add(t.init(d,"loaded",function(){return b.notifyChange("tiledLayersExtent")}),d.uid)};a.prototype._computeLayerViewsExtent=function(){var a=f.empty(),c=this.spatialReference;this.layerViews.forEach(function(b){b.isResolved()&&(b=p("fullExtentInLocalViewSpatialReference"in b&&b.fullExtentInLocalViewSpatialReference||b.layer.fullExtent,
c))&&f.expand(a,b)});var b=f.allFinite(a)?a:null,d=this._get("layerViewsExtent");return f.equals(b,d)?d:b};a.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var b=this.spatialReference,c=f.empty();this.layers.forEach(function(d){if(d.loaded&&u.isTiledLayer(d)){var e=n.getTiledLayerInfo(d,b,2),g=e.tileInfo,e=e.fullExtent;g&&n.isProjectableRasterLayer(d)&&e?f.expand(c,e):g&&a.compatibleWith(g)&&e&&e.spatialReference.equals(b)&&f.expand(c,e)}});this.defaultTiledLayersExtent&&
f.expand(c,this.defaultTiledLayersExtent);var d=f.allFinite(c)?c:null,e=this._get("tiledLayersExtent");return f.equals(d,e)?e:d};return a=c.__decorate([d.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],a)}(e);g.SurfaceExtentHelperLocal=e});