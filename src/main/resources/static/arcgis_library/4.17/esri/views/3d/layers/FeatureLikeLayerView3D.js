// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../renderers/support/renderingInfoUtils ../../../tasks/support/Query ./graphics/Graphics3DFeatureLikeLayerView ./graphics/QueryEngine ./support/projectExtentUtils ../../support/Scheduler".split(" "),function(w,e,c,h,f,k,m,d,n,p,l,
q,r,t,u,v){Object.defineProperty(e,"__esModule",{value:!0});e.FeatureLikeLayerView3D=void 0;e.FeatureLikeLayerView3D=function(e){return function(e){function a(){var b=null!==e&&e.apply(this,arguments)||this;b.controller=null;b.asyncGraphicsUpdates=!1;b.suspendResumeExtentMode="computed";b.slicePlaneEnabled=!1;b.drapeSourceType=1;b.fullExtentInLocalViewSpatialReference=null;b.suspendResumeExtent=null;b._controllerCreated=!1;b.clippingExtent=null;b.supportsHeightUnitConversion=!0;b.pendingController=
null;b.queryEngine=null;return b}c.__extends(a,e);a.prototype.initialize=function(){var b=this,a=this.layer;"isTable"in a&&a.isTable?this.addResolvingPromise(k.reject(new h("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:a}))):(this._set("graphics3d",new r.default({owner:this,layer:a,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,
preferredUpdatePolicy:this.asyncGraphicsUpdates?1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(a){return b.updateClippingExtent(a)}})),this.updatingHandles.add(this,"asyncGraphicsUpdates",function(a){b.graphics3d.graphicsCore.preferredUpdatePolicy=a?1:0}),this.updatingHandles.add(this,"suspendResumeExtentMode",function(a){b.graphics3d.suspendResumeExtentMode=a}),this.addResolvingPromise(this.graphics3d.setup().then(function(){return b.validateGeometryType()}).then(function(){return b.queryEngine=
new t.default({layerView:b,task:v.Task.FEATURE_QUERY_ENGINE})}).then(function(){return u.toViewIfLocal(b)}).then(function(a){return b.fullExtentInLocalViewSpatialReference=a}).then(function(){return b.initializeController()})),this.notifyChange("updating"))};a.prototype.destroy=function(){this.destroyPendingController();this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this.queryEngine&&(this.queryEngine.destroy(),
this.queryEngine=null);this.loadedGraphics=null};a.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)};Object.defineProperty(a.prototype,"legendEnabled",{get:function(){return this.canResume()},enumerable:!1,configurable:!0});a.prototype.notifyGraphicUpdate=function(b,a){this.graphics3d.graphicsCore.notifyGraphicUpdate(b,a)};a.prototype.getRenderingInfo=function(b,a,c){(b=l.getRenderingInfo(b,{renderer:a,arcade:c}))&&
b.color&&(a=b.color,a[0]/=255,a[1]/=255,a[2]/=255);return b};a.prototype.getRenderingInfoAsync=function(b,a,d,e){return c.__awaiter(this,void 0,void 0,function(){return c.__generator(this,function(g){return[2,l.getRenderingInfoAsync(b,c.__assign({renderer:a,arcade:d},e))]})})};a.prototype.getGraphicFromGraphicUid=function(b){var a=this,c=null;this.loadedGraphics&&this.loadedGraphics.forEach(function(g){g.uid===b&&(c=n.hydrateGraphic(g,a.layer))});return c};Object.defineProperty(a.prototype,"graphics3DGraphics",
{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!1,configurable:!0});
a.prototype.whenGraphicBounds=function(b,a){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(b,a):null};a.prototype.computeAttachmentOrigin=function(a,c){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(a,c):null};a.prototype.getSymbolLayerSize=function(a,c){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(a,c):null};a.prototype.queryFeatures=function(a,c){return this.queryEngine.executeQuery(this._ensureQuery(a),f.get(c,"signal"))};
a.prototype.queryObjectIds=function(a,c){return this.queryEngine.executeQueryForIds(this._ensureQuery(a),f.get(c,"signal"))};a.prototype.queryFeatureCount=function(a,c){return this.queryEngine.executeQueryForCount(this._ensureQuery(a),f.get(c,"signal"))};a.prototype.queryExtent=function(a,c){return this.queryEngine.executeQueryForExtent(this._ensureQuery(a),f.get(c,"signal"))};a.prototype._ensureQuery=function(a){return f.isNone(a)?this.createQuery():q.from(a)};a.prototype.highlight=function(a){return this.graphics3d.highlight(a,
this.layer.objectIdField)};a.prototype.canResume=function(){return!e.prototype.canResume.call(this)||this.graphics3d&&this.graphics3d.suspended?!1:!0};a.prototype.getSuspendInfo=function(){var a=e.prototype.getSuspendInfo.call(this);return this.graphics3d?c.__assign(c.__assign({},a),this.graphics3d.suspendInfo):a};a.prototype.isUpdating=function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!(!(!this._controllerCreated||this.controller&&this.controller.updating)&&this.view.basemapTerrain&&
this.view.basemapTerrain.ready&&!this.graphics3d.updating)};a.prototype.initializeController=function(){return c.__awaiter(this,void 0,void 0,function(){var a;return c.__generator(this,function(b){switch(b.label){case 0:return this.pendingController=a=this.createController(),[4,a.when()];case 1:return b.sent(),this.setControllerWhenInitialized(a),[2]}})})};a.prototype.setControllerWhenInitialized=function(a){return c.__awaiter(this,void 0,void 0,function(){return c.__generator(this,function(b){switch(b.label){case 0:return b.trys.push([0,
2,,3]),[4,this.when()];case 1:return b.sent(),[3,3];case 2:return b.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),!this.isResolved()||this.destroyed?(this.destroyPendingController(),[2]):[4,m.whenTrueOnce(this.view,"basemapTerrain.ready")];case 4:return b.sent(),this.beforeSetController(a),this.pendingController=null,this.controller=a,this.loadedGraphics=a.graphics,this.notifyChange("updating"),[2]}})})};a.prototype.updateClippingExtent=function(a){this.clippingExtent=
a;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=a,!0}};a.prototype.validateGeometryType=function(){switch(this.layer.geometryType){case "multipatch":case "multipoint":return k.reject(new h("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}};a.prototype._getResourceInfo=function(){var a=this.controller&&this.controller instanceof p?
this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:a?a.maximumNumberOfFeatures:-1,totalNumberOfFeatures:a?a.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}};Object.defineProperty(a.prototype,"performanceInfo",{get:function(){return this._getResourceInfo()},
enumerable:!1,configurable:!0});c.__decorate([d.property()],a.prototype,"loadedGraphics",void 0);c.__decorate([d.property({dependsOn:["graphics3d.suspended"]})],a.prototype,"suspended",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["graphics3d.suspended"]})],a.prototype,"legendEnabled",null);c.__decorate([d.property({dependsOn:["graphics3d.updating","controller.updating"]})],a.prototype,"updating",void 0);c.__decorate([d.property()],a.prototype,"controller",void 0);c.__decorate([d.property()],
a.prototype,"graphics3d",void 0);c.__decorate([d.property({readOnly:!0})],a.prototype,"asyncGraphicsUpdates",void 0);c.__decorate([d.property({readOnly:!0})],a.prototype,"suspendResumeExtentMode",void 0);c.__decorate([d.property({type:Boolean})],a.prototype,"slicePlaneEnabled",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["graphics3d.suspendInfo"]})],a.prototype,"suspendInfo",void 0);c.__decorate([d.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],a.prototype,"hasDraped",void 0);
return a=c.__decorate([d.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],a)}(e)}});