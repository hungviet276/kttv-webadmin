// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/promiseUtils ./WorkerTile ./style/StyleRepository".split(" "),function(t,u,n,k,r,p){return function(){function a(){this._spriteInfo={};this._glyphInfo={}}a.prototype.reset=function(){this._spriteInfo={};this._glyphInfo={};return k.resolve()};a.prototype.getLayers=function(){return this._layers};a.prototype.setLayers=function(b){this._layers=(new p(b.style)).layers};a.prototype.createTileAndParse=function(b,a){return n.__awaiter(this,void 0,void 0,function(){var e,
c,d,m,f,q,l,g;return n.__generator(this,function(h){switch(h.label){case 0:e=b.key;c={};d=0;for(m=Object.keys(b.sourceName2DataAndRefKey);d<m.length;d++)f=m[d],q=b.sourceName2DataAndRefKey[f],c[f]=q.refKey;l=new r(e,c,this);h.label=1;case 1:return h.trys.push([1,3,,4]),[4,l.parse(b.sourceName2DataAndRefKey,a)];case 2:return[2,h.sent()];case 3:g=h.sent();l.setObsolete();l.release();if(!k.isAbortError(g))throw g;return[2,null];case 4:return[2]}})})};a.prototype.updateStyle=function(b){this._layers=
(new p(b)).layers};a.prototype.fetchSprites=function(b,a,e){var c=[],d=this._spriteInfo;b.forEach(function(a){void 0===d[a]&&c.push(a)});return 0===c.length?k.resolve():a.invoke("getSprites",c,{signal:e&&e.signal}).then(function(a){for(var b in a)d[b]=a[b]})};a.prototype.getSpriteItems=function(){return this._spriteInfo};a.prototype.fetchGlyphs=function(a,g,e,c,d){var b=[],f=this._glyphInfo[g];f?e.forEach(function(a){f[a]||b.push(a)}):(f=this._glyphInfo[g]=[],e.forEach(function(a){return b.push(a)}));
return 0===b.length?k.resolve():c.invoke("getGlyphs",{tileID:a,font:g,codePoints:b},d).then(function(a){for(var b=0;b<a.length;b++)a[b]&&(f[b]=a[b])})};a.prototype.getGlyphItems=function(a){return this._glyphInfo[a]};return a}()});