// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(h,d,q,r,t,m,e,u,v,w){Object.defineProperty(d,"__esModule",{value:!0});d.test=d.ObjectResourceCache=void 0;h=function(){function b(){this.gltfCache=new Map;this.wosrCache=new Map;this.evictHandles=new r}b.prototype.loadGLTF=function(c,a){return this.fromCache(this.gltfCache,"gltf:"+
c,function(a){return v.load(new u.DefaultLoadingContext(a.streamDataRequester),c,a)},a)};b.prototype.loadWOSR=function(c,a){return this.fromCache(this.wosrCache,"wosr:"+c+":"+a.disableTextures,function(a){return w.load(c,a)},a)};b.prototype.destroy=function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};Object.defineProperty(b.prototype,"size",{get:function(){return this.wosrCache.size+this.gltfCache.size},enumerable:!1,configurable:!0});b.prototype.fromCache=function(c,
a,b,d){var n=this;return e.create(function(g,k){if(e.isAborted(d))k(e.createAbortError());else{var l=e.onAbort(d,function(){n.remove(c,a);k(e.createAbortError())}),f=c.get(a);if(f)n.evictHandles.remove(a),f.refCount++,f.item.then(g,k);else{var f=e.createAbortController(),h=q.__assign(q.__assign({},d),{signal:f.signal}),p={refCount:1,abortController:f,item:b(h).then(function(b){p.abortController=null;b.remove=function(){return n.remove(c,a)};return b})};c.set(a,p);p.item.then(function(a){m.isSome(l)&&
l.remove();g(a)},function(a){m.isSome(l)&&l.remove();k(a)})}}})};b.prototype.remove=function(b,a){var c=b.get(a);c&&(c.refCount--,0===c.refCount&&this.evictHandles.add(t.timeoutHandle(function(){b.delete(a);m.isSome(c.abortController)&&c.abortController.abort()},g),a))};return b}();d.ObjectResourceCache=h;var g=1E4;d.test={overrideEvictDelay:function(b){g=b;return{remove:function(){g=1E4}}}}});