// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ./graphicUtils ../../support/ElevationProvider ../../support/projectionUtils".split(" "),function(H,d,A,B,C,D,E,u,w){function y(a,b,c,e,f){var g=a.z||0;switch(c.mode){case "on-the-ground":return a=u.getElevationAtPoint(b,a,"ground")||0,f&&(f.verticalDistanceToGround=0,f.sampledElevation=a),a;case "relative-to-ground":return a=
u.getElevationAtPoint(b,a,"ground")||0,c=c.geometryZWithOffset(g,e),f&&(f.verticalDistanceToGround=c,f.sampledElevation=a),c+a;case "relative-to-scene":return a=u.getElevationAtPoint(b,a,"scene")||0,c=c.geometryZWithOffset(g,e),f&&(f.verticalDistanceToGround=c,f.sampledElevation=a),c+a;case "absolute-height":return c=c.geometryZWithOffset(g,e),f&&(a=u.getElevationAtPoint(b,a,"ground")||0,f.verticalDistanceToGround=c-a,f.sampledElevation=a),c;default:return A.neverReached(c.mode),0}}Object.defineProperty(d,
"__esModule",{value:!0});d.SymbolUpdateType=d.applyElevationAlignmentForHUD=d.needsElevationUpdates3D=d.needsElevationUpdates2D=d.elevationModeChangeUpdateType=d.evaluateElevationAlignmentAtPoint=d.applyPerVertexElevationAlignment=void 0;d.applyPerVertexElevationAlignment=function(a,b,c,e,f,g,h,k,d,m,l){var r=F[l.mode],p=0;if(w.bufferToBuffer(a,b,c,e,d.spatialReference,f,k)&&(r.requiresAlignment(l)?(p=r.applyElevationAlignmentBuffer(e,f,g,h,k,d,m,l),a=g,f=h):a=e,w.bufferToBuffer(a,d.spatialReference,
f,g,m.spatialReference,h,k)))return p};d.evaluateElevationAlignmentAtPoint=y;d.elevationModeChangeUpdateType=function(a,b,c){return null==b||null==c?a.definedChanged:"on-the-ground"===b&&"on-the-ground"===c?a.staysOnTheGround:b===c||"on-the-ground"!==b&&"on-the-ground"!==c?z.UPDATE:a.onTheGroundChanged};d.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};d.needsElevationUpdates3D=function(a){return"absolute-height"!==a};d.applyElevationAlignmentForHUD=function(a,
b,c,e,f){c=y(b,c,f,e,x);E.updateVertexAttributeAuxpos1w(a,x.verticalDistanceToGround);f=x.sampledElevation;var g=B.mat4.copy(G,a.objectTransformation);v[0]=b.x;v[1]=b.y;v[2]=c;w.computeLinearTransformation(b.spatialReference,v,g,e.spatialReference)?a.objectTransformation=g:console.warn("Could not locate symbol object properly, it might be misplaced");return f};var z;(function(a){a[a.NONE=0]="NONE";a[a.UPDATE=1]="UPDATE";a[a.RECREATE=2]="RECREATE"})(z=d.SymbolUpdateType||(d.SymbolUpdateType={}));var F=
{"absolute-height":{applyElevationAlignmentBuffer:function(a,b,c,e,f,g,h,d){g=d.calculateOffsetRenderUnits(h);d=d.featureExpressionInfoContext;b*=3;e*=3;for(h=0;h<f;++h){var k=a[b+1],m=a[b+2];c[e+0]=a[b+0];c[e+1]=k;c[e+2]=null==d?m+g:g;b+=3;e+=3}return 0},requiresAlignment:function(a){var b=a.featureExpressionInfoContext;return 0!==a.meterUnitOffset||null!=b}},"on-the-ground":{applyElevationAlignmentBuffer:function(a,b,c,e,f,d){var h=0,g=d.spatialReference;b*=3;e*=3;for(var r=0;r<f;++r){var m=a[b+
0],l=a[b+1],n=d.getElevation(m,l,a[b+2],g,"ground")||0,h=h+n;c[e+0]=m;c[e+1]=l;c[e+2]=n;b+=3;e+=3}return h/f},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(a,b,c,e,f,d,h,k){var g=0;h=k.calculateOffsetRenderUnits(h);k=k.featureExpressionInfoContext;var m=d.spatialReference;b*=3;e*=3;for(var l=0;l<f;++l){var n=a[b+0],p=a[b+1],t=a[b+2],q=d.getElevation(n,p,t,m,"ground")||0,g=g+q;c[e+0]=n;c[e+1]=p;c[e+2]=null==k?t+q+h:q+h;b+=3;e+=3}return g/f},requiresAlignment:function(){return!0}},
"relative-to-scene":{applyElevationAlignmentBuffer:function(a,b,c,e,f,d,h,k){var g=0;h=k.calculateOffsetRenderUnits(h);k=k.featureExpressionInfoContext;var m=d.spatialReference;b*=3;e*=3;for(var l=0;l<f;++l){var n=a[b+0],p=a[b+1],t=a[b+2],q=d.getElevation(n,p,t,m,"scene")||0,g=g+q;c[e+0]=n;c[e+1]=p;c[e+2]=null==k?t+q+h:q+h;b+=3;e+=3}return g/f},requiresAlignment:function(){return!0}}},G=C.mat4f64.create(),x={verticalDistanceToGround:0,sampledElevation:0},v=D.vec3f64.create()});