// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/maybe ../definitions ../VertexStream ./Effect".split(" "),function(k,f,l,p,m,q,n){Object.defineProperty(f,"__esModule",{value:!0});f.AnimationEffect=void 0;k=function(f){function b(){var a=null!==f&&f.apply(this,arguments)||this;a.defines=[];a._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:{a_position:0}};return a}l.__extends(b,f);b.prototype.dispose=function(){this._quad&&this._quad.dispose()};b.prototype.bind=function(){};b.prototype.unbind=
function(){};b.prototype.draw=function(a,h){if(h.size){var d=a.context,c=a.renderingOptions;this._quad||(this._quad=new q(d,[0,0,1,0,0,1,1,1]));var b=d.getBoundFramebufferObject(),e=d.getViewport(),f=e.x,k=e.y,l=e.width,e=e.height;h.bindTextures(d);var g=h.getBlock(m.ATTRIBUTE_DATA_ANIMATION);if(!p.isNone(g)){var n=g.getFBO(d),g=g.getFBO(d,1);d.setViewport(0,0,h.size,h.size);this._computeDelta(a,g,c.labelsAnimationTime);this._updateAnimationState(a,g,n);d.bindFramebuffer(b);d.setViewport(f,k,l,e)}}};
b.prototype._computeDelta=function(a,b,d){var c=a.context,f=a.displayLevel,e=a.painter.materialManager.getProgram(a,this._desc,["delta"]);c.bindFramebuffer(b);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(e);e.setUniform1i("u_maskTexture",m.TEXTURE_BINDING_ATTRIBUTE_DATA_0);e.setUniform1i("u_sourceTexture",m.TEXTURE_BINDING_ATTRIBUTE_DATA_1);e.setUniform1f("u_timeDelta",a.deltaTime);e.setUniform1f("u_animationTime",d/1E3);e.setUniform1f("u_zoomLevel",Math.round(10*f));this._quad.draw()};
b.prototype._updateAnimationState=function(a,b,d){var c=a.context;a=a.painter.materialManager.getProgram(a,this._desc,["update"]);c.bindTexture(b.colorTexture,1);c.bindProgram(a);a.setUniform1i("u_sourceTexture",1);c.bindFramebuffer(d);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);this._quad.draw()};return b}(n.Effect);f.AnimationEffect=k});