// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack ./ray ./vector".split(" "),function(J,c,B,C,D,E,q,e,g,r,h,l,F){function m(a){return a?{radius:a.radius,center:g.vec3f64.clone(a.center)}:{radius:1,center:g.vec3f64.create()}}function t(a,b){void 0===b&&(b=m());return u(a.radius,
a.center,b)}function u(a,b,d){void 0===d&&(d=m());e.vec3.copy(d.center,b);d.radius=a;return d}function k(a,b,d){var c=e.vec3.subtract(h.sv3d.get(),b.origin,a.center),f=e.vec3.dot(b.direction,b.direction),g=2*e.vec3.dot(b.direction,c);a=e.vec3.dot(c,c)-a.radius*a.radius;a=g*g-4*f*a;if(0>a)return!1;c=Math.sqrt(a);a=(-g-c)/(2*f);f=(-g+c)/(2*f);if(0>a||f<a&&0<f)a=f;if(0>a)return!1;d&&e.vec3.add(d,b.origin,e.vec3.scale(h.sv3d.get(),b.direction,a));return!0}function v(a,b,d){var c=h.sv3d.get(),f=h.sm4d.get();
e.vec3.cross(c,b.origin,b.direction);e.vec3.cross(d,c,b.origin);e.vec3.scale(d,d,1/e.vec3.length(d)*a.radius);a=w(a,b.origin);b=F.angle(b.origin,d);q.mat4.identity(f);q.mat4.rotate(f,f,b+a,c);e.vec3.transformMat4(d,d,f);return d}function x(a,b,d){b=e.vec3.subtract(h.sv3d.get(),b,a.center);b=e.vec3.scale(h.sv3d.get(),b,a.radius/e.vec3.length(b));return e.vec3.add(d,b,a.center)}function w(a,b){b=e.vec3.subtract(h.sv3d.get(),b,a.center);b=e.vec3.length(b);return D.acosClamped(a.radius/(a.radius+Math.abs(a.radius-
b)))}function y(a,b,d,c){a=e.vec3.subtract(n,b,a.center);switch(d){case 0:return a=r.cartesianToSpherical(a,n),a=a[2],e.vec3.set(c,-Math.sin(a),Math.cos(a),0);case 1:return a=r.cartesianToSpherical(a,n),d=a[1],a=a[2],b=Math.sin(d),e.vec3.set(c,-b*Math.cos(a),-b*Math.sin(a),Math.cos(d));case 2:return e.vec3.normalize(c,a);default:B.neverReached(d)}}function z(a,b){b=e.vec3.subtract(p,b,a.center);return e.vec3.length(b)-a.radius}Object.defineProperty(c,"__esModule",{value:!0});c.setAltitudeAt=c.altitudeAt=
c.axisAt=c.angleToSilhouette=c.distanceToSilhouette=c.projectPoint=c.closestPoint=c.closestPointOnSilhouette=c.intersectRayClosestSilhouette=c.intersectsRay=c.intersectScreen=c.intersectRay=c.setExtent=c.elevate=c.fromValues=c.copy=c.wrap=c.create=void 0;var G=C.getLogger("esri.views.3d.support.geometryUtils.sphere");c.create=m;c.wrap=function(a,b){var d=H.get();d.radius=a;d.center=b||A;return d};c.copy=t;c.fromValues=u;c.elevate=function(a,b,d){a!==d&&e.vec3.copy(d.center,a.center);d.radius=a.radius+
b;return d};c.setExtent=function(a,b,d){G.error("sphere.setExtent is not yet supported");return a===d?d:t(a,d)};c.intersectRay=k;c.intersectScreen=function(a,b,d,c){b=l.fromScreenAtEye(b,d,I);return k(a,b,c)};c.intersectsRay=function(a,b){return k(a,b,null)};c.intersectRayClosestSilhouette=function(a,b,d){if(k(a,b,d))return d;a=v(a,b,h.sv3d.get());e.vec3.add(d,b.origin,e.vec3.scale(h.sv3d.get(),b.direction,e.vec3.distance(b.origin,a)/e.vec3.length(b.direction)));return d};c.closestPointOnSilhouette=
v;c.closestPoint=function(a,b,d){if(k(a,b,d))return d;l.closestPoint(b,a.center,d);return x(a,d,d)};c.projectPoint=x;c.distanceToSilhouette=function(a,b){b=e.vec3.subtract(h.sv3d.get(),b,a.center);b=e.vec3.squaredLength(b);return Math.sqrt(Math.abs(b-a.radius*a.radius))};c.angleToSilhouette=w;var n=g.vec3f64.create();c.axisAt=y;c.altitudeAt=z;c.setAltitudeAt=function(a,b,d,c){var f=z(a,b);a=y(a,b,2,p);d=e.vec3.scale(p,a,d-f);e.vec3.add(c,b,d);return c};var H=new E.ObjectStack(function(){return{center:null,
radius:0}}),I=l.create(),A=g.vec3f64.create(),p=g.vec3f64.create();Object.freeze(A)});