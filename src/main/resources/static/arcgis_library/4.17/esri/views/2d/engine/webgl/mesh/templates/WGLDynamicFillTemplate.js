// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../color ../../definitions ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(g,p,w,t,n,q,u,v,l,x,e,y,z,A){Object.defineProperty(p,"__esModule",{value:!0});g=function(g){function h(a){var d=g.call(this,a)||this;if(e.isFunction(a.color))d._dynamicPropertyMap.set("_fillColor",function(b,c,d){return(b=
a.color(b,c,d))&&q.premultiplyAlphaRGBA(b)||0});else{var l=a.color;d.fillColor=l&&q.premultiplyAlphaRGBA(l)||0}var h=0;e.isFunction(a.height)||(h=a.height||0);d._dynamicPropertyMap.set("_height",function(b,c,d){return e.isFunction(a.height)?a.height(b,c,d):h});var m=0;e.isFunction(a.offsetX)||(m=n.pt2px(a.offsetX||0)+128,255<m&&(m=255));d._dynamicPropertyMap.set("_offsetX",function(b,c,d){return e.isFunction(a.offsetX)?(b=n.pt2px(a.offsetX(b,c,d))+128,255<b&&(b=255),b):m});var f=1;e.isFunction(a.scaleX)||
(f=a.scaleX||1);d._dynamicPropertyMap.set("_scaleX",function(b,c,d){return e.isFunction(a.scaleX)?a.scaleX(b,c,d):f});var c=0;e.isFunction(a.offsetY)||(c=n.pt2px(-a.offsetY||0)+128,255<c&&(c=255));d._dynamicPropertyMap.set("_offsetY",function(b,d,f){return e.isFunction(a.offsetY)?(b=n.pt2px(-a.offsetY(b,d,f))+128,255<b&&(b=255),b):c});var k=0;e.isFunction(a.angle)||(k=v.radToByte(a.angle)||0);d._dynamicPropertyMap.set("_angle",function(b,c,d){return e.isFunction(a.angle)?v.radToByte(a.angle(b,c,d)):
k});d.effects=a.effects;d._cimFillLayer=a;d._fillMaterialKey=x.FillMaterialKey.load(a.materialKey);return d}w.__extends(h,g);h.fromCIMFill=function(a){return new h(a)};h.prototype.bindFeature=function(a,d,e){var h=this,m=a.readLegacyFeature();this._dynamicPropertyMap.forEach(function(a,b){h[b]=a(m,d,e)});a=this._fillMaterialKey;var f=this._materialCache,c=this._cimFillLayer;this.aux3=l.i8888to32(0,0,this._angle,c.colorLocked?1:0);c=c.materialHash;c=c(m,d,e);c=f.get(c);f=null;c&&A.ok(c.spriteMosaicItem)&&
(f=c.spriteMosaicItem);if(f){var k=f.rect,b=f.width,g=f.height,c=k.x+u.SPRITE_PADDING,k=k.y+u.SPRITE_PADDING,p=c+b,q=k+g,r=t.nextHighestPowerOfTwo(n.pt2px(this._height));255<r?r=255:0>=r&&(r=t.nextHighestPowerOfTwo(q-k));b=t.nextHighestPowerOfTwo(n.pt2px(this._height/g*b||0));255<b?b=255:0>=b&&(b=t.nextHighestPowerOfTwo(p-c));g=this._scaleX;this.tl=l.i1616to32(c,k);this.br=l.i1616to32(p,q);this.aux1=l.i8888to32(b,r,this._offsetX,this._offsetY);this.aux2=l.i1616to32(128*g,128);a.sdf=f.sdf;a.pattern=
!0;a.textureBinding=f.textureBinding}else this.aux2=this.aux1=this.br=this.tl=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data};return h}(y.default(z.default));p.default=g});