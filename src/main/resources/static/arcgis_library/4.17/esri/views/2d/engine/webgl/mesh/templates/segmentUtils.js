// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../../../core/maybe","./util"],function(J,f,H,w){function x(a){return a.length-1}function y(a){for(var h=0,d=0;d<x(a);d++)h+=I(a,d);return h}function I(a,h,d){void 0===d&&(d=1);h=a[h+1];a=h[0];h=h[1];return Math.sqrt(a*a+h*h)*d}function F(a,h,d,b,f){if(!(d<h)){var c=b.clone().seek(d/2);H.isNone(c)||(a(c.clone(),d,f),d=(d-h)/2,c=H.unwrap(c.seek(h/2)),F(a,h,d,b,f+1),F(a,h,d,c,f+1))}}Object.defineProperty(f,"__esModule",{value:!0});f.smoothPaths=f.pathSubdivide=
f.pathDivide=f.SegmentCursor=f.segmentLength=f.pathLength=f.segmentCount=f.segmentAt=void 0;f.segmentAt=function(a,h){return a[h+1]};f.segmentCount=x;f.pathLength=y;f.segmentLength=I;var G=function(){function a(a,d,b,f,c){this._segments=a;this._index=d;this._distance=b;this._xStart=f;this._yStart=c;this._done=!1}a.create=function(h){return new a(h,0,0,h[0][0],h[0][1])};a.prototype.clone=function(){return new a(this._segments,this._index,this._distance,this.xStart,this.yStart)};a.prototype.equals=
function(a){return this._index===a._index||a._index===this._index-1&&(0===this._distance||1===a._distance)||a._index===this._index+1&&(1===this._distance||0===a._distance)};a.prototype.leq=function(a){return this._index<a._index||this._index===a._index&&this._distance<=a._distance};a.prototype.geq=function(a){return this._index>a._index||this._index===a._index&&this._distance>=a._distance};Object.defineProperty(a.prototype,"_segment",{get:function(){return this._segments[this._index+1]},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"angle",{get:function(){var a=this.dy,d=Math.acos((0*a+-1*-this.dx)/(1*this.length));0<a&&(d=2*Math.PI-d);return d},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"xStart",{get:function(){return this._xStart},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"yStart",{get:function(){return this._yStart},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"x",{get:function(){return this.xStart+this.distance*
this.dx},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this.yStart+this.distance*this.dy},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"dx",{get:function(){return this._segment[0]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"dy",{get:function(){return this._segment[1]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"xMidpoint",{get:function(){return this.xStart+.5*this.dx},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"yMidpoint",{get:function(){return this.yStart+.5*this.dy},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"xEnd",{get:function(){return this.xStart+this.dx},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"yEnd",{get:function(){return this.yStart+this.dy},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"length",{get:function(){var a=this.dx,d=this.dy;return Math.sqrt(a*a+d*d)},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"remainingLength",{get:function(){return this.length*(1-this._distance)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"backwardLength",{get:function(){return this.length*this._distance},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"distance",{get:function(){return this._distance},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"done",{get:function(){return this._done},enumerable:!1,configurable:!0});a.prototype.hasPrev=
function(){return 0<=this._index-1};a.prototype.hasNext=function(){return this._index+1<x(this._segments)};a.prototype.next=function(){if(!this.hasNext())return null;this._xStart+=this.dx;this._yStart+=this.dy;this._distance=0;this._index+=1;return this};a.prototype.prev=function(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=this.dx;this._yStart-=this.dy;this._distance=1;return this};a.prototype._seekBackwards=function(a,d){var b=this.backwardLength;if(a<=b)return this._distance=
(b-a)/this.length,this;for(b=this.backwardLength;this.prev();){if(b+this.length>a)return this._seekBackwards(a-b);b+=this.length}this._distance=0;return d?this:null};a.prototype.seek=function(a,d){void 0===d&&(d=!1);if(0>a)return this._seekBackwards(Math.abs(a),d);if(a<=this.remainingLength)return this._distance=(this.backwardLength+a)/this.length,this;for(var b=this.remainingLength;this.next();){if(b+this.length>a)return this.seek(a-b,d);b+=this.length}this._distance=1;return d?this:null};return a}();
f.SegmentCursor=G;f.pathDivide=function(a,h,d){var b=y(a);a=G.create(a);var f=b/2,c=Math.floor((b-h)/2/h);a.seek(f-c*h);for(var k=-c;k<=c;k++)512>a.x&&0<=a.x&&512>a.y&&0<=a.y&&d(a.clone(),k,f+k*h,b),a.seek(h)};f.pathSubdivide=function(a,h,d){F(d,h,y(a),G.create(a),0)};f.smoothPaths=function(a,h){for(var d=0;d<a.length;d++){var b=a[d],f=[];f.push(b[0]);for(var c=1;c<b.length;c++){var k=f[c-1],e=k[0],k=k[1],e=e+b[c][0],k=k+b[c][1];f.push([e,k])}e=f;k=h;if(!(0>=k||(b=e.length,3>b))){var c=[],p=0;c.push(0);
for(var g=1;g<b;g++)p+=w.dist(e[g],e[g-1]),c.push(p);k=Math.min(k,.2*p);p=[];p.push(e[0][0]);p.push(e[0][1]);var x=e[b-1][0],y=e[b-1][1],g=w.sub([0,0],e[0],e[1]);w.normalize(g);e[0][0]+=k*g[0];e[0][1]+=k*g[1];w.sub(g,e[b-1],e[b-2]);w.normalize(g);e[b-1][0]+=k*g[0];e[b-1][1]+=k*g[1];for(g=1;g<b;g++)c[g]+=k;c[b-1]+=k;for(var v=.5*k,g=1;g<b-1;g++){for(var D=0,E=0,z=0,l=g-1;0<=l&&!(c[l+1]<c[g]-v);l--){var q=v+c[l+1]-c[g],n=c[l+1]-c[l],m=c[g]-c[l]<v?1:q/n;if(1E-6>Math.abs(m))break;var t=m*m,A=m*q-.5*t*
n,u=m*n/k,r=e[l+1],B=e[l][0]-r[0],C=e[l][1]-r[1],D=D+u/A*(r[0]*m*q+.5*t*(q*B-n*r[0])-t*m*n*B/3),E=E+u/A*(r[1]*m*q+.5*t*(q*C-n*r[1])-t*m*n*C/3),z=z+u}for(l=g+1;l<b&&!(c[l-1]>c[g]+v);l++){q=v-c[l-1]+c[g];n=c[l]-c[l-1];m=c[l]-c[g]<v?1:q/n;if(1E-6>Math.abs(m))break;t=m*m;A=m*q-.5*t*n;u=m*n/k;r=e[l-1];B=e[l][0]-r[0];C=e[l][1]-r[1];D+=u/A*(r[0]*m*q+.5*t*(q*B-n*r[0])-t*m*n*B/3);E+=u/A*(r[1]*m*q+.5*t*(q*C-n*r[1])-t*m*n*C/3);z+=u}p.push(D/z);p.push(E/z)}p.push(x);p.push(y);for(l=g=0;g<b;g++)e[g][0]=p[l++],
e[g][1]=p[l++]}b=[];b.push(f[0]);for(c=1;c<f.length;c++)e=f[c-1],g=e[0],p=e[1],k=f[c],e=k[0],k=k[1],b.push([Math.round(e-g),Math.round(k-p)]);a[d]=b}return a}});