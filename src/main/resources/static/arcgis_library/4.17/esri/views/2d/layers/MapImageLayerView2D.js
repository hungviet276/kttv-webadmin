// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ../engine/BitmapContainer ./LayerView2D ./support/ExportStrategy ../../layers/LayerView ../../layers/MapImageLayerView ../../layers/RefreshableLayerView ../../support/drapedUtils".split(" "),function(w,x,b,g,h,k,c,l,m,n,p,q,r,t,u){var v=g.getLogger("esri.views.2d.layers.MapImageLayerView2D");return function(e){function a(){var a=
null!==e&&e.apply(this,arguments)||this;a._exportImageVersion=-1;return a}b.__extends(a,e);a.prototype.hitTest=function(){return null};a.prototype.update=function(a){this.strategy.update(a).catch(function(a){h.isAbortError(a)||v.error(a)})};a.prototype.attach=function(){var a=this,d=this.layer,b=d.imageMaxWidth,c=d.imageMaxHeight,f=d.version,d=10.3<=f,f=10<=f;this._bitmapContainer=new m.BitmapContainer;this.container.addChild(this._bitmapContainer);this.strategy=new p({container:this._bitmapContainer,
fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:b,imageMaxHeight:c,imageRotationSupported:d,imageNormalizationSupported:f,hidpi:!0});this.imageParameters=new l.ExportImageParameters({view:this.view,layer:this.layer});this.handles.add(k.init(this.imageParameters,"version",function(b){a._exportImageVersion!==b&&(a._exportImageVersion=b,a.requestUpdate())}),"mapimagelayerview-update")};a.prototype.detach=function(){this.strategy.destroy();this.handles.remove("mapimagelayerview-update");
this.imageParameters.destroy();this.imageParameters=null;this._exportImageVersion=-1;this.container.removeChild(this._bitmapContainer);this._bitmapContainer.removeAllChildren()};a.prototype.moveStart=function(){};a.prototype.viewChange=function(){};a.prototype.moveEnd=function(){this.requestUpdate()};a.prototype.createFetchPopupFeaturesQueryGeometry=function(a,b){return u.createQueryGeometry(a,b,this.view)};a.prototype.doRefresh=function(){return b.__awaiter(this,void 0,void 0,function(){return b.__generator(this,
function(a){this.requestUpdate();return[2]})})};a.prototype.isUpdating=function(){return this.strategy.updating||this.updateRequested};a.prototype.fetchImage=function(a,d,c,e){return this.layer.fetchImage(a,d,c,b.__assign({timeExtent:this.imageParameters.timeExtent,timestamp:this.refreshTimestamp},e))};b.__decorate([c.property()],a.prototype,"strategy",void 0);b.__decorate([c.property({dependsOn:["strategy.updating"]})],a.prototype,"updating",void 0);return a=b.__decorate([c.subclass("esri.views.2d.layers.MapImageLayerView2D")],
a)}(r.MapImageLayerView(t.RefreshableLayerView(n.LayerView2DMixin(q))))});