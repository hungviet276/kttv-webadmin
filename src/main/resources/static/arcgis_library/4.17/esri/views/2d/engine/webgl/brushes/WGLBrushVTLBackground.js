// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../../vectorTiles/shaders/Programs ../definitions ../enums ../number ./WGLBrush".split(" "),function(m,c,v,w,x,k,n,t,y,z,A){Object.defineProperty(c,"__esModule",{value:!0});c.WGLBrushVTLBackground=void 0;m=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a._color=x.vec4f32.fromValues(1,0,0,1);a._patternMatrix=w.mat3f32.create();a._programOptions=
{id:!1,pattern:!1};return a}v.__extends(b,c);b.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};b.prototype.drawMany=function(a,c){var l=a.context,g=a.styleLayerId;this._loadWGLResources(l);var b=a.displayLevel,e=a.styleLayer,d=a.painter.getVectorTileProgramCach(),h=e.getPaintValue("background-color",b),p=e.getPaintValue("background-opacity",b),k=e.getPaintValue("background-pattern",b),q=void 0!==k,r=h[3]*p,m=
a.spriteMosaic,f,n=(window.devicePixelRatio|1)>t.VTL_HIGH_RES_CUTOFF?2:1;a=a.drawPhase===y.WGLDrawPhase.HITTEST;var u=this._programOptions;u.id=a;u.pattern=q;d=d.getProgram(0,(a?1:0)<<1|(q?1:0),u);l.bindVAO(this._vao);l.bindProgram(d);if(q){f=m.getMosaicItemPosition(k,!0);if(!f)return;d.setUniform1f("u_opacity",p);d.setUniform2f("u_pattern_tl",f.tl[0],f.tl[1]);d.setUniform2f("u_pattern_br",f.br[0],f.br[1]);d.setUniform1i("u_texture",t.VTL_TEXTURE_BINDING_UNIT_SPRITES);m.bind(l,9729,f.page,t.VTL_TEXTURE_BINDING_UNIT_SPRITES)}else this._color[0]=
r*h[0],this._color[1]=r*h[1],this._color[2]=r*h[2],this._color[3]=r,d.setUniform4fv("u_color",this._color);d.setUniform1f("u_depth",e.z||0);a&&(g=z.u32to4Xu8(g+1),d.setUniform4fv("u_id",g));for(g=0;g<c.length;g++)e=c[g],d.setUniform1f("u_coord_range",e.coordRange[0]),d.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),q&&(h=n*e.size[0]*Math.max(Math.pow(2,Math.round(b)-e.key.level),1),p=h/f.size[1],this._patternMatrix[0]=h/f.size[0],this._patternMatrix[4]=p,d.setUniformMatrix3fv("u_pattern_matrix",
this._patternMatrix)),l.setStencilFunction(514,e.stencilRef,255),l.drawArrays(5,0,4)};b.prototype._loadWGLResources=function(a){if(!this._program||!this._vao){var c=k.createProgram(a,n.background);if(c){var b=new Int8Array([0,0,1,0,0,1,1,1]),b=k.BufferObject.createVertex(a,35044,b);a=new k.VertexArrayObject(a,n.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:b});this._program=c;this._vao=a}}};return b}(A.default);c.WGLBrushVTLBackground=
m});