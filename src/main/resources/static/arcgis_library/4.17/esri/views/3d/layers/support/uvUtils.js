// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/SpatialReference ../../support/projectionUtils ../../support/buffer/BufferView ../../support/geometryUtils/plane".split(" "),function(O,m,L,z,t,b,c,F,M,N,A){function B(e,f,a,u,g,c,h){b.vec3.set(e,f*g[0]+a*c[0]+u*h[0],f*g[1]+a*c[1]+u*h[1],f*g[2]+a*c[2]+
u*h[2])}Object.defineProperty(m,"__esModule",{value:!0});m.createMapSpaceUVCoords=m.createMapSpaceUVCoordsDraped=void 0;m.createMapSpaceUVCoordsDraped=function(b,f,a,c){void 0===c&&(c=1);if(a.isGeographic){var l=new Float64Array(f.typedBuffer.length);M.bufferToBuffer(f.typedBuffer,a,0,l,F.WebMercator,0,f.count);f=N.BufferViewVec3f64.fromTypedArray(l);a=F.WebMercator}z.vec2.set(e,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(a=0;a<f.count;a++)f.getVec(a,g),e[0]=Math.min(e[0],g[0]),e[1]=Math.min(e[1],
g[1]);a=e[1]%c;h[0]=e[0]-e[0]%c;h[1]=e[1]-a;for(a=0;a<f.count;a++)f.getVec(a,g),b.setValues(a,(g[0]-h[0])/c,(g[1]-h[1])/c,h[0]/c,h[1]/c)};m.createMapSpaceUVCoords=function(c,f,a,u,m,t,n){void 0===n&&(n=1);b.vec3.set(p,1,0,0);b.vec3.set(q,0,1,0);b.vec3.set(v,0,0,1);var d=C;b.vec3.set(w,0,0,0);for(var k=0;k<f.count-1;k++)f.getVec(k,g),b.vec3.add(w,w,g);b.vec3.scale(d,w,1/(f.count-1));if(A.fromManyPointsSampleAt(f,G,0,Math.floor(f.count/3),Math.floor(2/3*f.count))){var x=G,d=p,k=q,y=v;a.basisMatrixAtPosition(C,
l);b.vec3.set(D,l[0],l[1],l[2]);b.vec3.set(E,l[4],l[5],l[6]);b.vec3.set(H,l[8],l[9],l[10]);a=A.normal(x);0>b.vec3.dot(a,H)&&b.vec3.scale(a,a,-1);b.vec3.copy(y,a);y=b.vec3.dot(a,E);x=b.vec3.dot(a,D);Math.abs(y)<Math.abs(x)?(b.vec3.scaleAndAdd(d,D,a,-x),b.vec3.normalize(d,d),b.vec3.cross(k,d,a),b.vec3.normalize(k,k),b.vec3.scale(k,k,-1)):(b.vec3.scaleAndAdd(k,E,a,-y),b.vec3.normalize(k,k),b.vec3.cross(d,k,a),b.vec3.normalize(d,d))}z.vec2.set(e,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);z.vec2.set(r,
Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(d=0;d<f.count;d++)f.getVec(d,g),k=b.vec3.dot(p,g),a=b.vec3.dot(q,g),e[0]=Math.min(e[0],k),e[1]=Math.min(e[1],a),r[0]=Math.max(r[0],k),r[1]=Math.max(r[1],a);d=b.vec3.dot(v,C);B(I,e[0],e[1],d,p,q,v);B(J,r[0],e[1],d,p,q,v);B(K,e[0],r[1],d,p,q,v);d=e[1]%n;h[0]=e[0]-e[0]%n;h[1]=e[1]-d;for(d=0;d<f.count;d++)f.getVec(d,g),c.setValues(d,(b.vec3.dot(p,g)-h[0])/n,(b.vec3.dot(q,g)-h[1])/n,h[0]/n,h[1]/n),u&&m&&t&&(u.setVec(d,I),m.setVec(d,J),t.setVec(d,K))};
var C=c.vec3f64.create(),g=c.vec3f64.create(),G=A.create(),p=c.vec3f64.create(),q=c.vec3f64.create(),v=c.vec3f64.create(),e=t.vec2f64.create(),r=t.vec2f64.create(),h=t.vec2f64.create(),I=c.vec3f64.create(),J=c.vec3f64.create(),K=c.vec3f64.create(),l=L.mat4f64.create(),D=c.vec3f64.create(),E=c.vec3f64.create(),H=c.vec3f64.create(),w=c.vec3f64.create()});