// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/mathUtils ../../../../core/maybe ../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl".split(" "),function(r,e,k,m,n,l){Object.defineProperty(e,"__esModule",{value:!0});e.getMaterialAndTexturesFromShared=e.getMaterialAndTextures=void 0;e.getMaterialAndTextures=function(b,a){var d=new Map,g=function(a,b){if(m.isNone(a))return-1;if(d.has(a.id))return a=d.get(a.id),a.usage|=
b,a.id;var c=d.size;d.set(a.id,{id:c,usage:b});return c},c=a.pbrMetallicRoughness,f=c&&c.baseColorFactor,h=a.emissiveFactor,e=null==a.normalTexture&&null==a.emissiveTexture&&null==a.occlusionTexture&&(c?null==c.metallicRoughnessTexture&&1===c.roughnessFactor&&(1===c.metallicFactor||0===c.metallicFactor):!0),k=e?n.PBRSchematicMRRValues[0]:c?c.metallicFactor:1,l=e?n.PBRSchematicMRRValues[1]:c?c.roughnessFactor:1,c={baseColorFactor:f?[f[0],f[1],f[2],f[3]]:[1,1,1,1],baseColorTextureId:g(c&&c.baseColorTexture,
"mask"===a.alphaMode?33:1),metallicRoughnessTextureId:g(c&&c.metallicRoughnessTexture,2),metallicFactor:k,roughnessFactor:l};a={alphaMode:a.alphaMode,alphaCutoff:a.alphaCutoff,doubleSided:a.doubleSided,cullFace:"none"===a.cullFace?0:"back"===a.cullFace?2:"front"===a.cullFace?1:void 0,normalTextureId:g(a.normalTexture,4),emissiveTextureId:g(a.emissiveTexture,16),occlusionTextureId:g(a.occlusionTexture,8),emissiveFactor:h?[h[0],h[1],h[2]]:[0,0,0],metallicRoughness:c,wrapTextures:!1,isSchematic:e};var p=
[];d.forEach(function(a,c){a=a.usage;var d=m.isSome(b)&&b[c]&&b[c].formats,d=d?d.map(function(a){return{name:a.name,encoding:q[a.format]}}):[];p.push({id:c,usage:a,encodings:d})});return{material:a,textures:p}};var q={jpg:"image/jpeg",png:"image/png",dds:"image/vnd-ms.dds","ktx-etc2":"image/ktx"};e.getMaterialAndTexturesFromShared=function(b){var a=b&&b.materialDefinitions?Object.keys(b.materialDefinitions)[0]:null,d=b&&b.textureDefinitions?Object.keys(b.textureDefinitions)[0]:null,a=a&&b.materialDefinitions[a],
d=d&&b.textureDefinitions[d];b={alphaMode:"opaque",alphaCutoff:l.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,isSchematic:!0};if(null!=a){a=a.params;a.diffuse&&(b.metallicRoughness.baseColorFactor=[a.diffuse[0],a.diffuse[1],a.diffuse[2],1]);null!=a.doubleSided&&
(b.doubleSided=a.doubleSided,b.cullFace=a.doubleSided?0:2);if("none"===a.cullFace||"front"===a.cullFace||"back"===a.cullFace)b.cullFace="none"===a.cullFace?0:"back"===a.cullFace?2:1;a.transparency&&(b.metallicRoughness.baseColorFactor[3]=k.clamp(1-a.transparency,0,1));if(a.useVertexColorAlpha||1>b.metallicRoughness.baseColorFactor[3])b.alphaMode="blend"}a=[];if(null!=d){!d.wrap||"repeat"!==d.wrap[0]&&"repeat"!==d.wrap[1]||(b.wrapTextures=!0);var e=1;"rgba"===d.channels&&(b.alphaMode="blend",e|=32);
var c=d.images[d.images.length-1],f=function(a){return a&&a.split("/").pop()},d=Array.isArray(d.encoding)?d.encoding.map(function(a,b){return{name:f(c.href[b]),encoding:a}}):[{name:f(c.href),encoding:d.encoding}];a.push({id:0,usage:e,encodings:d});b.metallicRoughness.baseColorTextureId=0}return{material:b,textures:a}}});