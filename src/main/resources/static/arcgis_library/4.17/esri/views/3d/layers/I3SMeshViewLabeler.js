// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../Graphic ../../../symbols ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/accessorSupport/diffUtils ../../../core/libs/gl-matrix-2/vec3f64 ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap".split(" "),function(g,l,c,q,r,t,u,m,e,v,w,x,y,z,A,B){Object.defineProperty(l,"__esModule",{value:!0});
g=function(g){function a(b){b=g.call(this,b)||this;b.loadedGraphics=new B.LimitGraphicsMap(5E4);b.slicePlaneEnabled=!1;b._renderingInfo={symbol:new r.PointSymbol3D};b._handles=new u;b._graphicsByNode=new Map;b._scaleVisibility=null;return b}c.__extends(a,g);a.prototype.initialize=function(){var b=this;this._graphicsCore=new y.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:1,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,
hasM:!1});var a=this.view.basemapTerrain;this._scaleVisibility=new z({layerScaleEnabled:!1});this._scaleVisibility.setup(this,this.layer,function(a,d,f){return b._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(a,d,f)},this._graphicsCore,a);var a=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),d=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);
this._graphicsCore.setup({labeler:a,deconflictor:d,scaleVisibility:this._scaleVisibility}).then(function(){b._graphicsCore.startCreateGraphics()}).catch(function(){});this._handles.add([this.layer.watch("labelingInfo",function(a,d){v.diff(a,d)&&b._graphicsCore.updateLabelingInfo()})])};a.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);null!=this._scaleVisibility&&(this._scaleVisibility.destroy(),this._scaleVisibility=null);null!=this._graphicsCore&&(this._graphicsCore.destroy(),
this._graphicsCore=null);this.loadedGraphics.destroy();this.view=null};a.prototype.addNodeMeta=function(b,a){var d=this,f=0,k=b.filteredIds,c=b.featureIds.map(function(c,e){A.boundingBoxTop(e,d.collection,b.objectHandle,p);var n=x.makeDehydratedPoint(0,0,0,d.view.spatialReference);d.view.renderCoordsHelper.fromRenderCoords(p,n);e=a(e,b);var h=!1;m.isNone(k)?h=!0:f<k.length&&c===k[f]&&(h=!0,f++);return{objectId:c,uid:q.generateUID(),attributes:e,visible:h,geometry:n}});this.loadedGraphics.addMany(c);
this._graphicsByNode.set(b.node.index,c)};a.prototype.setNodeMetaAttributes=function(b,a){for(var d=this._graphicsByNode.get(b.node.index),f=Array(d.length),c=0;c<d.length;c++){var e=d[c];e.attributes=a(c,b);f[c]=e.uid}this._graphicsCore.updateLabelingInfo(f)};a.prototype.applyFilterChange=function(a){var b=this._graphicsByNode.get(a.node.index);if(b)if(m.isNone(a.filteredIds))for(a=0;a<b.length;a++){var d=b[a];d.visible||(d.visible=!0,f.graphic=d,f.property="visible",f.oldValue=!1,f.newValue=!0,
this._graphicsCore.graphicUpdateHandler(f))}else for(var c=0,e=0;e<b.length;e++){var d=b[e],g=d.visible;c<a.filteredIds.length&&d.objectId===a.filteredIds[c]?(d.visible=!0,c++):d.visible=!1;g!==d.visible&&(f.graphic=d,f.property="visible",f.oldValue=g,f.newValue=d.visible,this._graphicsCore.graphicUpdateHandler(f))}};a.prototype.removeNodeMeta=function(a){this.loadedGraphics.removeManyByObjectId(a.featureIds)};a.prototype.getRenderingInfo=function(){return this._renderingInfo};a.prototype.notifyGraphicUpdate=
function(){};Object.defineProperty(a.prototype,"usedMemory",{get:function(){return this._graphicsCore.usedMemory},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"unloadedMemoryEstimate",{get:function(){return this._graphicsCore.unprocessedMemoryEstimate},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"test",{get:function(){return{graphicsCore:this._graphicsCore}},enumerable:!1,configurable:!0});c.__decorate([e.property()],a.prototype,"view",void 0);c.__decorate([e.property()],
a.prototype,"layer",void 0);c.__decorate([e.property()],a.prototype,"collection",void 0);c.__decorate([e.property()],a.prototype,"loadedGraphics",void 0);c.__decorate([e.property({aliasOf:"_graphicsCore.updating"})],a.prototype,"updating",void 0);c.__decorate([e.property()],a.prototype,"slicePlaneEnabled",void 0);c.__decorate([e.property()],a.prototype,"_graphicsCore",void 0);return a=c.__decorate([e.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],a)}(t);var f={graphic:null,property:null,oldValue:null,
newValue:null},p=w.vec3f64.create();l.default=g});