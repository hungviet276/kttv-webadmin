// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/accessorSupport/watch ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/geodesicConstants ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),function(h,l,c,r,t,u,d,v,g,m,w,x,y,k,n,f){Object.defineProperty(l,"__esModule",{value:!0});
h=function(h){function a(){var b=h.call(this)||this;b._propertiesPool=new n.default({camera:f.default},b);b._lastSeenCameraProjectionValues=new f.default;b.events=new t;b.mode=1;b._cameraChanged=!1;b.updateQueue=[];b.processingUpdates=!1;return b}c.__extends(a,h);a.prototype.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new n.default({camera:f.default},this)};a.prototype.init=function(b,a){this.viewingMode=b;this._set("spatialReference",a);b=1===this.mode?
new f.default(g.vec3f64.fromValues(4*m.earthRadius,0,0),g.vec3f64.fromValues(m.earthRadius,0,0),g.vec3f64.fromValues(0,0,1)):new f.default(g.vec3f64.fromValues(0,0,100),g.vec3f64.fromValues(0,0,0),g.vec3f64.fromValues(0,1,0));this.camera=b;this._set("constraints",new x.default({mode:this.mode}))};Object.defineProperty(a.prototype,"animation",{get:function(){return this.cameraController instanceof y.AnimationController&&u.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:
null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"camera",{get:function(){return this._get("camera")},set:function(b){var a=this;b!==e&&e.copyFrom(b);e.markViewDirty();e.computeUp(this.mode);p.camera=e;this.events.emit("before-camera-change",p);b=this._get("camera");this.cameraProjectionChanged(this._lastSeenCameraProjectionValues,e)&&(this._lastSeenCameraProjectionValues.copyFrom(e),q.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",
q));if(!b||!b.equals(e))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(e)),this._cameraChanged=!b||!b.almostEquals(e))var c=v.afterDispatch(function(){a._cameraChanged=!1;c.remove()})},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isLocal",{get:function(){return 2===this.mode},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"viewingMode",
{set:function(b){this._set("mode","global"===b?1:2)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"navigating",{get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"stationary",{get:function(){return!this._cameraChanged&&!this.navigating},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(b){var a=
this;this.stopActiveCameraController()?(b&&(b.watch("state",function(c){if(c===k.State.Finished||c===k.State.Stopped)a._set("cameraController",null),a.updateCamera(function(a){return b.onControllerEnd(a)})},!0),b.onControllerStart(this.camera)),this._set("cameraController",b)):b&&(b.state=k.State.Rejected)},enumerable:!1,configurable:!0});a.prototype.switchCameraController=function(b){this.cameraController=b;return b.state!==k.State.Rejected};a.prototype.stopActiveCameraController=function(){return this.cameraController&&
!this.cameraController.stopController()?!1:!0};a.prototype.updateCamera=function(b){this.updateQueue.push(b);this.processUpdateQueue()};a.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var b=this.updateQueue.shift();e.copyFrom(this._get("camera"));b(e);this.camera=e;this.processingUpdates=!1;this.processUpdateQueue()}};a.prototype.cameraProjectionChanged=function(b,a){return b.fov!==a.fov||b.fullViewport[0]!==a.fullViewport[0]||
b.fullViewport[1]!==a.fullViewport[1]||b.fullViewport[2]!==a.fullViewport[2]||b.fullViewport[3]!==a.fullViewport[3]||b.padding[0]!==a.padding[0]||b.padding[1]!==a.padding[1]||b.padding[2]!==a.padding[2]||b.padding[3]!==a.padding[3]?!0:!1};c.__decorate([d.property({readOnly:!0,type:w,dependsOn:["cameraController"]})],a.prototype,"animation",null);c.__decorate([d.property({type:f.default})],a.prototype,"camera",null);c.__decorate([d.property({readOnly:!0})],a.prototype,"constraints",void 0);c.__decorate([d.property({readOnly:!0})],
a.prototype,"events",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["isLocal"]})],a.prototype,"isGlobal",null);c.__decorate([d.property({readOnly:!0,dependsOn:["mode"]})],a.prototype,"isLocal",null);c.__decorate([d.property({readOnly:!0})],a.prototype,"mode",void 0);c.__decorate([d.property({constructOnly:!0})],a.prototype,"spatialReference",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["cameraController"]})],a.prototype,"navigating",null);c.__decorate([d.property({readOnly:!0,
dependsOn:["navigating","_cameraChanged"]})],a.prototype,"stationary",null);c.__decorate([d.property()],a.prototype,"_cameraChanged",void 0);c.__decorate([d.property()],a.prototype,"cameraController",null);return a=c.__decorate([d.subclass("esri.views.3d.state.ViewState")],a)}(r);l.default=h;var e=new f.default,p={camera:null},q={camera:null}});