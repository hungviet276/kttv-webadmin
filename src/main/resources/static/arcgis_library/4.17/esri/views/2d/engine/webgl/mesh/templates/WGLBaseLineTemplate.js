// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../../core/has ../../definitions ../../enums ../../number ../../TileClipper ../../TurboLine ../../materialKey/MaterialKey".split(" "),function(I,x,z,J,w,A,d,B,q,C){Object.defineProperty(x,"__esModule",{value:!0});var t=w.TILE_SIZE+16,y=1/3.8,r=new B.TileClipper(0,0,0,1,16);r.setExtent(w.TILE_SIZE);var e=new Uint32Array(9),b=new Uint32Array(36),m=new Uint32Array(3),l=new Uint32Array(6),D=function(a){return function(c){var u=Math.ceil(1024*a._halfWidth),f=Math.ceil(1024*
a._halfReferenceWidth);c.entry0=a.offset+a.vertexCount++;var g=d.i1616to32(c.distance,u),k=d.i8888to32(Math.round(31*c.prevNormal.x),Math.round(31*c.prevNormal.y),Math.round(0),Math.round(-31)),n=d.i8888to32(0,0,0,a._bitset);b[0]=d.i1616to32(8*c.currentVertex.x,8*c.currentVertex.y);b[1]=a.id;b[2]=a._fillColor;b[3]=k;b[4]=g;b[5]=a._tl;b[6]=a._br;b[7]=n;b[8]=d.i1616to32(f,0);c.entry2=a.offset+a.vertexCount++;g=d.i1616to32(c.distance,u);k=d.i8888to32(Math.round(31*-c.prevNormal.x),Math.round(31*-c.prevNormal.y),
Math.round(0),Math.round(31));n=d.i8888to32(0,0,0,a._bitset);b[9]=d.i1616to32(8*c.currentVertex.x,8*c.currentVertex.y);b[10]=a.id;b[11]=a._fillColor;b[12]=k;b[13]=g;b[14]=a._tl;b[15]=a._br;b[16]=n;b[17]=d.i1616to32(f,0);c.exit0=a.offset+a.vertexCount++;g=d.i1616to32(c.distance,u);k=d.i8888to32(Math.round(31*c.nextNormal.x),Math.round(31*c.nextNormal.y),Math.round(0),Math.round(-31));n=d.i8888to32(0,0,0,a._bitset);b[18]=d.i1616to32(8*c.currentVertex.x,8*c.currentVertex.y);b[19]=a.id;b[20]=a._fillColor;
b[21]=k;b[22]=g;b[23]=a._tl;b[24]=a._br;b[25]=n;b[26]=d.i1616to32(f,0);c.exit2=a.offset+a.vertexCount++;g=d.i1616to32(c.distance,u);k=d.i8888to32(Math.round(31*-c.nextNormal.x),Math.round(31*-c.nextNormal.y),Math.round(0),Math.round(31));n=d.i8888to32(0,0,0,a._bitset);b[27]=d.i1616to32(8*c.currentVertex.x,8*c.currentVertex.y);b[28]=a.id;b[29]=a._fillColor;b[30]=k;b[31]=g;b[32]=a._tl;b[33]=a._br;b[34]=n;b[35]=d.i1616to32(f,0);a.geometryBuf.writeRegion(b)}},E=function(a){return function(c){l[0]=c.leftExit0;
l[1]=c.rightEntry0;l[2]=c.leftExit2;l[3]=c.rightEntry0;l[4]=c.rightEntry2;l[5]=c.leftExit2;a.indexCount+=6;a.indexBuf.writeRegion(l)}},G=function(a){return function(c,b,f,g,k,n,v,F,h){h=d.i1616to32(h,Math.ceil(1024*a._halfWidth));k=d.i8888to32(Math.round(31*k),Math.round(31*n),Math.round(31*v),Math.round(31*F));f=d.i8888to32(31*f,31*g,0,a._bitset);e[0]=d.i1616to32(8*c,8*b);e[1]=a.id;e[2]=a._fillColor;e[3]=k;e[4]=h;e[5]=a._tl;e[6]=a._br;e[7]=f;e[8]=d.i1616to32(Math.ceil(1024*a._halfReferenceWidth),
0);a.geometryBuf.writeRegion(e);return a.offset+a.vertexCount++}},H=function(a){return function(b,d,f){m[0]=b;m[1]=d;m[2]=f;a.indexCount+=3;a.indexBuf.writeRegion(m)}};x.default=function(a){return function(a){function b(){for(var b=[],g=0;g<arguments.length;g++)b[g]=arguments[g];b=a.apply(this,b)||this;b.tessellationProperties={_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,indexCount:null,geometryBuf:null,vertexCount:null,offset:null};
b._tessellationOptions={};b.geometryType=A.WGLGeometryType.LINE;return b}z.__extends(b,a);b.prototype.writeMeshWithGeometry=function(b,a,c,d,v,e){var g=a.indexVector,k=a.get("geometry");a=a.getVector("geometry").vertexCount;var f=g.length;if(c=null!==e&&void 0!==e?e:c.readLegacyGeometry()){switch(d){case "esriGeometryPolyline":d=this._clipLines(c.paths);if(0===d.length)return;this._write(g,k,a,v,d);break;case "esriGeometryPolygon":d=this._clipLines(c.rings);if(0===d.length)return;this._write(g,k,
a,v,d)}b.writeDisplayRecord(this.geometryType,this._materialKey,a,this.tessellationProperties.vertexCount,f,this.tessellationProperties.indexCount)}};b.prototype._clipLines=function(a){for(var b=[],c=!1,d=0;d<a.length;){var f=[],e=a[d];r.reset(2);var h=e[0],p=h[0],h=h[1];if(c)r.moveTo(p,h);else{if(-16>p||p>t||-16>h||h>t){c=!0;continue}f.push({x:p,y:h})}for(var l=!1,q=e.length,m=1;m<q;++m)if(p+=e[m][0],h+=e[m][1],c)r.lineTo(p,h);else{if(-16>p||p>t||-16>h||h>t){l=!0;break}f.push({x:p,y:h})}if(l)c=!0;
else{if(c){if(f=r.resultWithStarts())for(c=0;c<f.length;c++)b.push(f[c])}else b.push({line:f,start:0});d++;c=!1}}return b};b.prototype._write=function(a,b,c,d,e){this.tessellationProperties.id=d;this.tessellationProperties.indexBuf=a;this.tessellationProperties.indexCount=0;this.tessellationProperties.geometryBuf=b;this.tessellationProperties.vertexCount=0;this.tessellationProperties.offset=c;for(a=0;a<e.length;a++)b=e[a],c=b.line,2>c.length||(this._tessellationOptions.initialDistance=b.start%65535,
this._tessellationCallbacks instanceof q.StandardTessellationCallbacks&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=this._joinType),q.tessellate(c,this._tessellationOptions,this._tessellationCallbacks),q.cleanup())};b.prototype._initializeTessellator=function(a){var b=C.LineMaterialKey.load(this._materialKey);this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern;this._tessellationOptions.thin=!a&&this.tessellationProperties._halfWidth<
w.THIN_LINE_THRESHOLD/2&&!(b.vvSizeFieldStops||b.vvSizeMinMaxValue||b.vvSizeScaleStops||b.vvSizeUnitValue);this._tessellationOptions.wrapDistance=65535;this._tessellationOptions.outerBisectorAutoSplitThreshold=y;this._tessellationOptions.enableOuterBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.innerBisectorAutoSplitThreshold=y;this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.thin?this._tessellationCallbacks={vertex:D(this.tessellationProperties),
bridge:E(this.tessellationProperties)}:(a=new q.StandardTessellationCallbacks(G(this.tessellationProperties),H(this.tessellationProperties)),a.miterLimitCosine=this._miterLimitCosine,a.textured=this._isDashed||this._hasPattern,a.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=a)};return b}(a)}});