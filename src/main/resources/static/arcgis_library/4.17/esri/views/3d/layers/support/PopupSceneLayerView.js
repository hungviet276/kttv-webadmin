// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/SetUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),function(x,a,c,e,u,l,v,w,r,m){Object.defineProperty(a,"__esModule",{value:!0});a.PopupSceneLayerView=void 0;a.PopupSceneLayerView=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}c.__extends(b,a);b.prototype._validateFetchPopupFeatures=
function(a){var d=this.layer;if(!d.popupEnabled)return new e("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:d});if(!m.getFetchPopupTemplate(d,a))return new e("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:d})};b.prototype.prepareFetchPopupFeatures=function(a){return c.__awaiter(this,void 0,void 0,function(){return c.__generator(this,function(a){return[2]})})};b.prototype.fetchPopupFeatures=function(a,d){return c.__awaiter(this,void 0,void 0,
function(){var a,b,g,f,n,e,t,p,h,q,k;return c.__generator(this,function(c){switch(c.label){case 0:if(a=this._validateFetchPopupFeatures(d))return[2,l.reject(a)];b=u.isSome(d)?d.clientGraphics:null;if(!b||0===b.length)return[2,l.resolve([])];g=[];f=[];e=r.unpackFieldNames;t=[this.layer.fields];return[4,m.getRequiredFields(this.layer,m.getFetchPopupTemplate(this.layer,d))];case 1:return n=e.apply(void 0,t.concat([c.sent()])),[4,this.prepareFetchPopupFeatures(n)];case 2:c.sent();p=new Set;h=0;for(q=
b;h<q.length;h++)k=q[h],r.populateMissingFields(n,k,p)?f.push(k):g.push(k);return 0===f.length?[2,l.resolve(g)]:[2,this.whenGraphicAttributes(f,v.valuesOfSet(p)).catch(function(){return f}).then(function(a){return g.concat(a)})]}})})};return b=c.__decorate([w.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],b)}(a)}});