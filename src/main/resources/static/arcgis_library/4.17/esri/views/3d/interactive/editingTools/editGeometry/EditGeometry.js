// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../../geometry","../../../../../core/arrayUtils","../coordinateHelper"],function(r,f,t,v,w){Object.defineProperty(f,"__esModule",{value:!0});f.EditGeometry=f.Component=f.Edge=f.Vertex=void 0;var p=function(){function b(a){this.right=this.left=null;this.type="vertex";this.index=null;this.component=a}Object.defineProperty(b.prototype,"pos",{get:function(){return this._pos},set:function(a){this._pos=a;this.component.unnormalizeVertexPositions()},enumerable:!1,configurable:!0});
return b}();f.Vertex=p;var n=function(){return function(b,a,u){this.type="edge";this.component=b;this.left=a;this.right=u;a.right=this;u.left=this}}();f.Edge=n;var q=function(){function b(a){this.vertices=[];this.edges=[];this.data=a}b.prototype.unnormalizeVertexPositions=function(){1>=this.vertices.length||this.data.coordinateHelper.unnormalize(this.vertices)};b.prototype.updateVertexIndex=function(a,b){if(0!==this.vertices.length){var c=this.vertices[0],d=null;do d=a,d.index=b++,a=d.right?d.right.right:
null;while(null!=a&&a!==c);d.left&&d!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(d),this.vertices.length-1)}};b.prototype.findEndVertex=function(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]};b.prototype.swapVertices=function(a,b){var c=this.vertices[a];this.vertices[a]=this.vertices[b];this.vertices[b]=c};return b}();f.Component=q;r=function(){function b(a){this.coordinateHelper=a;this.undoStack=[];this.redoStack=[];this.components=
[]}b.prototype.apply=function(a){a.apply();this.undoStack.push(a);this.redoStack=[]};b.prototype.undo=function(){if(0<this.undoStack.length){var a=this.undoStack.pop();a.undo();this.redoStack.push(a)}};Object.defineProperty(b.prototype,"canUndo",{get:function(){return 0<this.undoStack.length},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"lastOperation",{get:function(){return 0<this.undoStack.length?this.undoStack[this.undoStack.length-1]:null},enumerable:!1,configurable:!0});
b.prototype.redo=function(){if(0<this.redoStack.length){var a=this.redoStack.pop();a.apply();this.undoStack.push(a)}};Object.defineProperty(b.prototype,"canRedo",{get:function(){return 0<this.redoStack.length},enumerable:!1,configurable:!0});b.prototype.toPoint=function(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.createPoint(this.components[0].vertices[0].pos)};b.prototype.toPolyline=function(){var a=[],b=this.coordinateHelper.toArray;this.components.forEach(function(c,
d){d=[];var g=c=v.find(c.vertices,function(a){return null==a.left});do d.push(b(c.pos)),c=c.right?c.right.right:null;while(c&&c!==g);a.push(d)});return new t.Polyline({paths:a,spatialReference:this.coordinateHelper.spatialReference})};b.prototype.toPolygon=function(){var a=[],b=this.coordinateHelper.toArray;this.components.forEach(function(c,d){d=[];var g=c=c.vertices[0],f=g;do d.push(b(g.pos)),g=g.right.right;while(g&&g!==f);d.push(b(c.pos));a.push(d)});return new t.Polygon({rings:a,spatialReference:this.coordinateHelper.spatialReference})};
b.fromGeometry=function(a,f){f=w.createCoordinateHelper(a.hasZ,a.hasM,a.spatialReference,f);var c=new b(f);switch(a.type){case "polygon":for(var d=a.rings,g=0;g<d.length;++g){var m=d[g];a=new q(c);for(var l=m.length-1,e=0;e<l;++e){var h=f.fromArray(m[e]),k=new p(a);a.vertices.push(k);k.pos=h;k.index=e}l=a.vertices.length-1;for(e=0;e<l;++e)h=a.vertices[e],k=a.vertices[e+1],h=new n(a,h,k),a.edges.push(h);l=new n(a,a.vertices[a.vertices.length-1],a.vertices[0]);a.edges.push(l);c.components.push(a)}break;
case "polyline":for(d=a.paths,g=0;g<d.length;++g){m=d[g];a=new q(c);l=m.length;for(e=0;e<l;++e)h=f.fromArray(m[e]),k=new p(a),a.vertices.push(k),k.pos=h,k.index=e;l=a.vertices.length-1;for(e=0;e<l;++e)h=a.vertices[e],k=a.vertices[e+1],h=new n(a,h,k),a.edges.push(h);c.components.push(a)}}return c};return b}();f.EditGeometry=r});