// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../debugFlags ../debugUtils ../geometryUtils ../PropertiesPool ./PointOfInterest".split(" "),function(n,a,e,r,p,t,g,f,l,u,v,w,x,y,z){Object.defineProperty(a,"__esModule",{value:!0});a.setupFocusDebugGraphic=a.Focus=void 0;var A=Array;n=function(a){function c(b){b=
a.call(this,b)||this;b._propertiesPool=new y.default({locationOnSurface:u,renderLocationOnSurface:A},b);b.centerOnSurface=null;return b}e.__extends(c,a);c.prototype.destroy=function(){this._propertiesPool.destroy();this._propertiesPool=null;p.isSome(d)&&(d.remove(),d=null)};Object.defineProperty(c.prototype,"locationOnSurface",{get:function(){var b=this._propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,b,this.state.spatialReference);return b},
enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"renderLocationOnSurface",{get:function(){var b=this.centerOnSurface.renderLocation,h=this.renderCoordsHelper,c=this.calculateScreenHorizontalEdgeOnSurface(B);f.vec3.subtract(m,b,this.state.camera.eye);f.vec3.normalize(m,m);h.worldUpAtPosition(b,q);var a=Math.abs(Math.acos(f.vec3.dot(q,m))-.5*Math.PI),h=this._propertiesPool.get("renderLocationOnSurface"),a=1-r.clamp(a/(.5*Math.PI),0,1);f.vec3.lerp(h,b,c,a*a*a);p.isSome(d)&&(v.SHOW_POI?
d.showPoint(h,this.renderCoordsHelper.spatialReference):d.remove());return h},enumerable:!1,configurable:!0});c.prototype.calculateScreenHorizontalEdgeOnSurface=function(b){var a=this.state.camera,c=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),d=this.renderCoordsHelper.getAltitude(a.eye)>=c,e=a.getRenderCenter(t.createRenderScreenPointArray3());e[1]=d?a.padding[2]:a.fullHeight-a.padding[0];a.unprojectPoint(e,k);f.vec3.subtract(k,k,a.eye);d=f.vec3.normalize(k,k);if(this.renderCoordsHelper.intersectManifold(x.ray.wrap(a.eye,
d),c,b))return b;f.vec3.copy(b,a.eye);this.renderCoordsHelper.setAltitude(c,b);return b};c.prototype.updateRenderLocation=function(){};e.__decorate([g.property({constructOnly:!0})],c.prototype,"centerOnSurface",void 0);e.__decorate([g.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],c.prototype,"locationOnSurface",null);e.__decorate([g.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],c.prototype,"renderLocationOnSurface",null);e.__decorate([g.property({readOnly:!0,
aliasOf:"centerOnSurface.updating"})],c.prototype,"updating",void 0);return c=e.__decorate([g.subclass("esri.views.3d.support.CenterOnSurface")],c)}(z.PointOfInterest);a.Focus=n;a.setupFocusDebugGraphic=function(a){p.isSome(d)&&d.remove();d=new w.GraphicsHandle(a,"green")};var m=l.vec3f64.create(),q=l.vec3f64.create(),k=l.vec3f64.create(),B=l.vec3f64.create(),d;a.default=n});