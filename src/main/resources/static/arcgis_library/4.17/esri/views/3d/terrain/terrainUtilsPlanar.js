// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/Error ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ./TerrainConst ./TilingScheme".split(" "),function(v,e,q,k,n,p,r,t){function m(a,d,b,c){k.vec3.copy(l,b);l[c]=d[c];c=k.vec3.subtract(l,l,d);var g=k.vec3.subtract(u,a,d),g=k.vec3.dot(g,c),e=k.vec3.dot(c,c);d=0>=g?d:e<=g?b:k.vec3.add(l,d,k.vec3.scale(c,c,g/e));a=k.vec3.subtract(l,a,d);return Math.PI/2-Math.atan(a[2]/Math.sqrt(a[0]*a[0]+a[1]*
a[1]))}Object.defineProperty(e,"__esModule",{value:!0});e.checkIfTileInfoSupportedForViewSR=e.tiltToExtentEdge=e.tiltOnEdge=e.isInsideExtent=void 0;var l=n.vec3f64.create(),u=n.vec3f64.create(),h=n.vec3f64.create(),f=n.vec3f64.create();e.isInsideExtent=function(a,d,b){void 0===b&&(b=0);a=a.extent;return 0===b?p.containsPoint(a,d):p.containsPointWithMargin(a,d,b*Math.min(a[2]-a[0],a[3]-a[1]))};e.tiltOnEdge=m;e.tiltToExtentEdge=function(a,d){var b=a.elevationBounds;a=a.extent;b=.5*(b.min+b.max);h[0]=
a[0];h[1]=a[1];h[2]=b;f[0]=a[2];f[1]=a[3];f[2]=b;a=b=Infinity;d[0]<h[0]?b=m(d,h,f,0):d[0]>f[0]&&(b=m(d,f,h,0));d[1]<h[1]?a=m(d,h,f,1):d[1]>f[1]&&(a=m(d,f,h,1));return Math.min(b,a)};e.checkIfTileInfoSupportedForViewSR=function(a,d,b){if(a.spatialReference.isGeographic)return new q("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var c=t.checkUnsupported(a);if(c)return c;var g=a.lods,c=g[0].resolution*Math.pow(2,g[0].level),e=[c*a.size[0],c*
a.size[1]],h=[a.origin.x,a.origin.y];b=p.fromExtent(b);var f=p.create();t.computeRowColExtent(b,e,h,f);e=(f[2]-f[0])*(f[3]-f[1]);e>r.MAX_ROOT_TILES?(g=g[0].scale*Math.pow(2,g[0].level),c=Math.max((b[3]-b[1])/a.size[1],(b[2]-b[0])/a.size[0])*g/c,b=Math.floor(Math.log(c)/Math.log(10)),c=Math.ceil(c/Math.pow(10,b))*Math.pow(10,b),c=new q("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(g).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+
c.toLocaleString()+".",{level0Scale:g,suggestedLevel0Scale:c,requiredNumRootTiles:e,allowedNumRootTiles:r.MAX_ROOT_TILES})):c=null;return c?c:d&&!a.spatialReference.equals(d)?new q("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}});