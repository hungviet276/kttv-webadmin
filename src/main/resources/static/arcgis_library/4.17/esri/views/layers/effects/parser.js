// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../colorUtils ../../../core/Error ./effects ./grammar".split(" "),function(E,g,u,e,l,z){function A(a){try{switch(a.name){case "grayscale":case "sepia":case "saturate":case "invert":case "brightness":case "contrast":var b=1;m(a.parameters,1);1===a.parameters.length&&(b=f(a.parameters[0]));return new l.ColorMatrixEffect(a.name,b);case "opacity":return b=1,m(a.parameters,1),1===a.parameters.length&&(b=f(a.parameters[0])),new l.OpacityEffect(b);case "hue-rotate":b=0;m(a.parameters,
1);if(1===a.parameters.length){var c=a.parameters[0];if("quantity"!==c.type||(0!==c.value||null!==c.unit)&&null==v[c.unit])throw new e("effect:type-error","Expected \x3cangle\x3e, Actual: "+r(c),{term:c});b=c.value*v[c.unit]||0}return new l.HueRotateEffect(b);case "radial-blur":case "blur":return b=0,m(a.parameters,1),1===a.parameters.length&&(b=w(a.parameters[0]),q(b,a.parameters[0])),new l.BlurEffect(a.name,b);case "drop-shadow":for(var c=[],h=0,n=a.parameters;h<n.length;h++){var k=n[h];if("color"===
k.type){c.length&&Object.freeze(c);if(b)throw new e("effect:type-error","Accepts only one color",{});a:{var t=k;switch(t.colorType){case "hex":b=u.hex2rgba(t.value);break a;case "named":b=x(t.value);break a;case "function":var g=void 0;var d=t.value;m(d.parameters,4);if(B.test(d.name))g=[f(d.parameters[0]),f(d.parameters[1]),f(d.parameters[2]),d.parameters[3]?f(d.parameters[3]):1];else if(C.test(d.name))g=u.hsla2rgba(D(d.parameters[0]),f(d.parameters[1]),f(d.parameters[2]),d.parameters[3]?f(d.parameters[3]):
1);else throw new e("effect:syntax-error","Invalid color function '"+d.name+"'",{colorFunction:d});b=g;break a}b=void 0}}else{var p=w(k);if(Object.isFrozen(c))throw new e("effect:type-error","\x3clength\x3e parameters not consecutive",{lengths:c});c.push(p);3===c.length&&q(p,k)}}if(2>c.length||3<c.length)throw new e("effect:type-error","Expected \x3clength\x3e{2,3}, Actual: \x3clength\x3e{"+c.length+"}",{lengths:c});return new l.DropShadowEffect(c[0],c[1],c[2]||0,b||x("black"));case "bloom":return b=
1,k=n=0,m(a.parameters,3),a.parameters[0]&&(b=f(a.parameters[0])),a.parameters[1]&&(n=w(a.parameters[1]),q(n,a.parameters[1])),a.parameters[2]&&(k=f(a.parameters[2])),new l.BloomEffect(b,n,k)}}catch(y){throw y.details.filter=a,y;}throw new e("effect:unknown-effect","Effect '"+a.name+"' is not supported",{effect:a});}function m(a,b){if(a.length>b)throw new e("effect:type-error","Function supports up to "+b+" parameters, Actual: "+a.length,{parameters:a});}function r(a){return"color"===a.type?"\x3ccolor\x3e":
p[a.unit]?"\x3clength\x3e":v[a.unit]?"\x3cangle\x3e":"%"===a.unit?"\x3cpercentage\x3e":"\x3cdouble\x3e"}function q(a,b){if(0>a)throw new e("effect:type-error","Negative values are not allowed, Actual: "+a,{term:b});}function f(a){if("quantity"!==a.type||null!==a.unit&&"%"!==a.unit)throw new e("effect:type-error","Expected \x3cdouble\x3e or \x3cpercentage\x3e, Actual: "+r(a),{term:a});var b=a.value;q(b,a);return"%"===a.unit?.01*b:b}function D(a){if("quantity"!==a.type||null!==a.unit)throw new e("effect:type-error",
"Expected \x3cdouble\x3e, Actual: "+r(a),{term:a});q(a.value,a);return a.value}function w(a){if("quantity"!==a.type||(0!==a.value||null!==a.unit)&&null==p[a.unit])throw new e("effect:type-error","Expected \x3clength\x3e, Actual: "+r(a),{term:a});return a.value*p[a.unit]||0}function x(a){var b=u.getNamedColorCopy(a);if(!b)throw new e("effect:unknown-color","color '"+a+"' isn't valid",{namedColor:a});return b}Object.defineProperty(g,"__esModule",{value:!0});g.parse=void 0;g.parse=function(a){var b;
try{b=a?z.parse(a):[]}catch(h){return{input:a,parsedFunctions:[],effects:[],error:new e("effect:invalid-syntax","Invalid filter syntax",{input:a,error:h})}}a={input:a,parsedFunctions:b,effects:[],error:null};try{for(var c=0;c<b.length;c++)a.effects.push(A(b[c]))}catch(h){a.effects.length=0,a.error=h}return a};var v={deg:1,grad:.9,rad:180/Math.PI,turn:360},p={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/73},B=/^rgba?/i,C=/^hsla?/i});