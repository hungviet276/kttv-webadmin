// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/geodesicConstants ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),function(M,h,n,u,F,g,w,G,H,I,J,y,K,B){function C(d,a,c,f){void 0===f&&(f=y.createDirectionUp());g.vec3.cross(t,
d,D);0===g.vec3.dot(t,t)&&g.vec3.cross(t,d,E);u.mat4.identity(m);u.mat4.rotate(m,m,-n.deg2rad(a),d);u.mat4.rotate(m,m,-n.deg2rad(c),t);a=f.up;c=f.direction;g.vec3.cross(a,t,d);g.vec3.normalize(a,a);g.vec3.transformMat4(a,a,m);g.vec3.normalize(c,d);g.vec3.negate(c,c);g.vec3.transformMat4(c,c,m);return f}function z(d){var a=d[1];d[1]=-d[2];d[2]=a}function A(d,a){a=C(a,d.heading,d.tilt);d.up=a.up;return d}Object.defineProperty(h,"__esModule",{value:!0});h.toExtent=h.eyeTiltToLookAtTilt=h.lookAtTiltToEyeTilt=
h.eyeForCenterWithHeadingTilt=h.directionToHeadingTilt=h.headingTiltToDirectionUp=void 0;var D=w.vec3f64.fromValues(0,0,1),E=g.vec3.normalize(w.vec3f64.create(),w.vec3f64.fromValues(1,1,1)),L=new B.Cyclical(-180,180),m=F.mat4f64.create(),t=w.vec3f64.create(),p=w.vec3f64.create();h.headingTiltToDirectionUp=C;h.directionToHeadingTilt=function(d,a,c,f){var b=t;g.vec3.normalize(b,d);g.vec3.cross(p,b,D);0===g.vec3.dot(p,p)&&g.vec3.cross(p,b,E);g.vec3.cross(p,p,b);return y.directionToHeadingTilt(a,c,f,
b,p)};h.eyeForCenterWithHeadingTilt=function(d,a,c,f){var b={eye:w.vec3f64.create(),up:null,tilt:f,heading:c},l=t;l[0]=d[0];l[1]=d[2];l[2]=-d[1];c=n.deg2rad(c);var e=n.deg2rad(f);f=Math.sin(c);c=Math.cos(c);var k=Math.sin(e),h=Math.cos(e),x=g.vec3.length(l);if(1E-8>Math.abs(e))e=a+x;else var q=x/k,m=n.asinClamped(a/q),e=q*Math.sin(Math.PI-e-m);var h=h*a,q=a*a*k*k,m=c*c*q,p=e-h,u=p*p,r=m*(m+u-l[1]*l[1]);if(0>r)return g.vec3.scale(b.eye,l,e/x),b.tilt=0,b;var v=Math.sqrt(r),y=l[1]*p,r=m+u,v=0<c?-v+y:
v+y;if(1E-8>Math.abs(r))return 1E-8>x?(b.eye[0]=0,b.eye[1]=0,b.eye[2]=a):g.vec3.scale(b.eye,l,e/x),b.tilt=0,z(b.eye),A(b,d);b.eye[1]=v/r;a*=k;v=b.eye[1]*b.eye[1];k=1-v;r=Math.sqrt(k);q=m*v+f*f*q-2*c*a*b.eye[1]*r*p+k*u;if(1E-8>Math.abs(q))return g.vec3.scale(b.eye,l,e/x),b.tilt=0,z(b.eye),A(b,d);b.eye[0]=(k*(e*l[0]-h*l[0])-a*r*(l[0]*b.eye[1]*c+l[2]*f))/q;b.eye[2]=(k*(e*l[2]-h*l[2])-a*r*(l[2]*b.eye[1]*c-l[0]*f))/q;g.vec3.scale(b.eye,b.eye,e);z(b.eye);return A(b,d)};h.lookAtTiltToEyeTilt=function(d,
a,c){a=g.vec3.length(a);c=n.asinClamped(c/(Math.sqrt(c*c+a*a-2*c*a*Math.cos(Math.PI-d))/Math.sin(d)));return n.rad2deg(d-c)};h.eyeTiltToLookAtTilt=function(d,a,c){d=n.deg2rad(d);a=g.vec3.length(a);return n.asinClamped(c/(a/Math.sin(d)))+d};h.toExtent=function(d,a,c,f,b){function g(a){var b=Math.PI/2;a=B.cyclical2PI.normalize(a,-b);a>b&&(a=Math.PI-a);return a}var e;e=a.latitude;a=a.longitude;var k=K.getLonDeltaForDistance(e,c)/2;c=a-k;a+=k;e=n.deg2rad(e);k=I.earthRadius;e=(1+Math.sin(e))/(1-Math.sin(e));
var h=(e+1)*Math.tan(f/k/2);e=1.5*Math.PI-2*Math.atan(.5*(h+Math.sqrt(4*e+h*h)));f=e+f/k;e=g(e);f=g(f);f<e&&(k=f,f=e,e=k);e=Math.max(n.rad2deg(e),-90);f=Math.min(n.rad2deg(f),90);a=L.monotonic(c,a);180<a-c&&(k=(a-c-180)/2,c+=k,a-=k);k=d.spatialReference&&d.spatialReference.isGeographic?d.spatialReference:H.WGS84;b?(b.xmin=c,b.ymin=e,b.xmax=a,b.ymax=f,b.spatialReference=k):b=new G(c,e,a,f,k);d.spatialReference&&d.spatialReference.isWebMercator&&J.geographicToWebMercator(b,!1,b);return b}});