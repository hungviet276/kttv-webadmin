// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ./NativeLine.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),function(p,f,e,m,q,r,
n,t,h,c,u,l,v,w,k){Object.defineProperty(f,"__esModule",{value:!0});f.NativeLineTechniqueConfiguration=f.NativeLineTechnique=void 0;h=function(c){function a(d,b){b=c.call(this,d,b)||this;b.stipplePattern=null;b.stippleTextureBind=null;b.stippleTextureRepository=d.stippleTextureRepository;return b}e.__extends(a,c);a.prototype.initializeProgram=function(d){var b=a.shader.get(),g=this.configuration,b=b.build({output:g.output,attributeColor:g.vertexColors,slicePlaneEnabled:g.slicePlaneEnabled,sliceHighlightDisabled:g.sliceHighlightDisabled,
sliceEnabledForVertexPrograms:!1,stippleEnabled:g.stippleEnabled,stippleOffColorEnabled:g.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:g.stippleIntegerRepeatsEnabled});return new w(d.rctx,b.generateSource("vertex"),b.generateSource("fragment"),u.Default3D)};a.prototype.dispose=function(){c.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};a.prototype.bindPass=function(d,b,a){n.View.bindProjectionMatrix(this.program,
a.camera.projectionMatrix);if(this.stipplePattern!==b.stipplePattern){var c=b.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,c);this.stipplePattern=c}this.configuration.stippleEnabled&&(c=m.isSome(this.stippleTextureBind)?this.stippleTextureBind(d,0)*a.camera.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/c),this.program.setUniform2f("ndcToPixel",a.camera.fullViewport[2]/2,a.camera.fullViewport[3]/
2));this.program.setUniform4fv("constantColor",b.color);this.program.setUniform1f("alphaCoverage",Math.min(1,b.width*a.camera.pixelRatio));this.configuration.stippleOffColorEnabled&&(b=m.unwrap(b.stippleOffColor),this.program.setUniform4f("stippleOffColor",b[0],b[1],b[2],3<b.length?b[3]:1));4===this.configuration.output&&r.OutputHighlight.bindOutputHighlight(d,this.program,a)};a.prototype.bindDraw=function(d){n.View.bindView(this.program,d);q.Slice.bindUniformsWithOrigin(this.program,this.configuration,
d)};a.prototype.initializePipeline=function(){var d=this.configuration,a=k.separateBlendingParams(770,1,771,771),c=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=null);return k.makePipelineState({blending:b,depthTest:l.depthCompareLess,depthWrite:c,colorWrite:k.defaultColorWriteParams,stencilWrite:d.sceneHasOcludees?l.stencilWriteMaskOn:null,stencilTest:d.sceneHasOcludees?a?l.stencilToolMaskBaseParams:l.stencilBaseAllZerosParams:null})};return 0===d.output?(this._occludeeState=c(!0,d.transparent||
d.stippleEnabled?a:null,k.defaultDepthWriteParams),c(!1,d.transparent||d.stippleEnabled?a:null,k.defaultDepthWriteParams)):c(!1)};Object.defineProperty(a.prototype,"primitiveType",{get:function(){return 1},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!1,configurable:!0});a.shader=new t.ReloadableShaderModule(v,function(){return new Promise(function(a,b){p(["./NativeLine.glsl"],a,b)})});return a}(h.ShaderTechnique);
f.NativeLineTechnique=h;h=function(f){function a(){var a=null!==f&&f.apply(this,arguments)||this;a.output=0;a.slicePlaneEnabled=!1;a.sliceHighlightDisabled=!1;a.vertexColors=!1;a.transparent=!1;a.stippleEnabled=!1;a.stippleOffColorEnabled=!1;a.stippleIntegerRepeatsEnabled=!1;a.sceneHasOcludees=!1;return a}e.__extends(a,f);e.__decorate([c.parameter({count:7})],a.prototype,"output",void 0);e.__decorate([c.parameter()],a.prototype,"slicePlaneEnabled",void 0);e.__decorate([c.parameter()],a.prototype,
"sliceHighlightDisabled",void 0);e.__decorate([c.parameter()],a.prototype,"vertexColors",void 0);e.__decorate([c.parameter()],a.prototype,"transparent",void 0);e.__decorate([c.parameter()],a.prototype,"stippleEnabled",void 0);e.__decorate([c.parameter()],a.prototype,"stippleOffColorEnabled",void 0);e.__decorate([c.parameter()],a.prototype,"stippleIntegerRepeatsEnabled",void 0);e.__decorate([c.parameter()],a.prototype,"sceneHasOcludees",void 0);return a}(c.ShaderTechniqueConfiguration);f.NativeLineTechniqueConfiguration=
h});