// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/libs/gl-matrix-2/vec3f64","./Octree"],function(n,e,k,g){function h(c,a){void 0===a&&(a=!1);var b=c instanceof g?c.root:c,d;d={};c instanceof g&&a&&(d.center=k.vec3f64.clone(c.center),d.size=c.size);0<b.terminals.length&&(d.terminals=b.terminals.map(function(a){return a.id}));null!==b.residents&&0<b.residents.length&&(d.residents=b.residents.map(function(a){return a.id}));null===b.residents&&b.children.forEach(function(a,b){a&&(d["child"+b]=h(a))});return d}
function l(c,a,b,d,e){for(var f=0;3>f;f++)if(c[f]<b[f]||c[f]>d[f])throw Error("[Octree Validation] Object is not within node bounds");c=.25*(d[0]-b[0]);if(e&&a<c)throw Error("[Octree Validation] Object is too small to be a terminal");if(!e&&a>c)throw Error("[Octree Validation] Object is too large to be a resident");}function m(c,a,b){b=b||c;b[0]=c[0]+a;b[1]=c[1]+a;b[2]=c[2]+a;return b}Object.defineProperty(e,"__esModule",{value:!0});e.assert=e.debugDump=e.stats=void 0;e.stats=function(c){var a={numNodes:0,
numObjects:0,numTerminals:0,numResidents:0,numOutsiders:0,numInnerNodes:0,numTerminalNodes:0,maximumDepth:0,maxNumTerminals:0,maxNumResidents:0,maxNumObjects:0};c.forEachNode(function(b,d,e){null===b.residents?a.numInnerNodes++:a.numTerminalNodes++;a.numTerminals+=b.terminals.length;a.maxNumTerminals=Math.max(b.terminals.length,a.maxNumTerminals);d=b.terminals.length;null!==b.residents&&(a.numResidents+=b.residents.length,a.maxNumResidents=Math.max(b.residents.length,a.maxNumResidents),d+=b.residents.length);
a.maxNumObjects=Math.max(d,a.maxNumObjects);a.maximumDepth=Math.max(a.maximumDepth,Math.round(Math.log(c.size/e)*Math.LOG2E));return!0});a.numObjects=a.numOutsiders+a.numTerminals+a.numResidents;a.numNodes=a.numInnerNodes+a.numTerminalNodes;return a};e.debugDump=h;e.assert=function(c,a){c.forEachNode(function(b,d,e){var f=m(d,-e/2,k.vec3f64.create()),g=m(d,e/2,k.vec3f64.create());b.terminals.forEachSimple(function(b){return l(a.getCenter(b),a.getRadius(b),f,g,!0)});if(null!==b.residents){if(b.residents.length>
c.maximumObjectsPerNode)throw Error("[Octree Validation] Number of objects "+b.residents.length+" exceeds maximum allowed ("+c.maximumObjectsPerNode+")");b.residents.forEachSimple(function(b){return l(a.getCenter(b),a.getRadius(b),f,g,!1)})}var h=!1;b.children.forEach(function(a){if(a&&(h=!0,null!==b.residents))throw Error("[Octree Validation] Node has residents and children");});if(!h&&(null===b.residents||0===b.residents.length)&&0===b.terminals.length)throw Error("[Octree Validation] dangling empty node");
return!0});return!0}});