// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/math/common ../../../../../support/elevationInfoUtils ../../manipulatorUtils ../manipulatorUtils ../visualElementUtils ../manipulations/config ../manipulations/MoveManipulation ./GraphicScaleRotateTransform ../../../layers/graphics/GraphicState ../../../../interactive/InteractiveToolBase".split(" "),
function(g,e,c,l,m,n,f,d,p,q,r,h,t,u,k,v,w,x){Object.defineProperty(e,"__esModule",{value:!0});e.GraphicTransformTool=void 0;g=function(e){function b(a){a=e.call(this,a)||this;a.enableZ=!0;a.enableRotation=!0;a.enableScaling=!0;a.type="transform-3d";a.handles=new m;a.scaleRotate=null;return a}c.__extends(b,e);b.prototype.initialize=function(){var a=this;this.graphicState=new w.GraphicState({graphic:this.graphic});this.moveManipulation=new k.MoveManipulation({tool:this,view:this.view,snapToScene:this.snapToScene,
xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&h.canMoveZ(this.graphic),radius:k.MoveManipulation.radiusForSymbol(this.graphic.symbol)});this.moveManipulation.forEachManipulator(function(b){return a.handles.add(b.events.on("immediate-click",function(a){return a.stopPropagation()}))});this.moveManipulation.elevationInfo=q.getGraphicEffectiveElevationInfo(this.graphic);this.moveManipulation.createGraphicDragPipeline(this.graphicState,function(b){var c={graphic:b.graphic,dxScreen:b.dxScreen,
dyScreen:b.dyScreen};switch(b.action){case "start":a.emit("graphic-translate-start",c);break;case "update":a.emit("graphic-translate",c);break;case "end":a.emit("graphic-translate-stop",c)}});this.moveManipulation.angle=this.symbolRotationAngle;if(this.enableScaling||this.enableRotation)this.scaleRotate=new v.GraphicScaleRotateTransform({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate"}),this.handles.add(this.scaleRotate.events.on("scale-changed",function(){return a.onScaleChanged()}));
this.handles.add([t.createVisualElements({view:this.view,graphic:this.graphic,forEachManipulator:function(b){return a.forEachManipulator(b)},onManipulatorsChanged:function(){return n.makeHandle()}}),this.graphic.watch("symbol",function(){return a.updateMoveAngle()}),this.graphicState.on("changed",function(){return a.onGeometryChanged()}),this.hideManipulatorsForGraphicState(),this.view.watch("scale",function(){return a.updateMoveAngle()})]);this.handles.add(this.view.trackGraphicState(this.graphicState));
this.onGeometryChanged()};b.prototype.forEachManipulator=function(a){this.moveManipulation.forEachManipulator(a);f.isSome(this.scaleRotate)&&this.scaleRotate.forEachManipulator(a)};b.prototype.hideManipulatorsForGraphicState=function(){var a=this;return this.graphicState.watch("displaying",function(b){a.forEachManipulator(function(a){return a.available=b});a.moveManipulation.zManipulation.available=b&&a.enableZ&&h.canMoveZ(a.graphic)})};b.prototype.destroy=function(){this.handles.destroy();this.moveManipulation.destroy();
f.isSome(this.scaleRotate)&&(this.scaleRotate.destroy(),this.scaleRotate=null);this._set("view",null);this._set("graphic",null)};Object.defineProperty(b.prototype,"snapToScene",{set:function(a){this.moveManipulation&&(this.moveManipulation.snapToScene=a);this._set("snapToScene",a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"symbolRotationAngle",{get:function(){var a=this.graphic.symbol;return a?(a=a.symbolLayers.find(function(a){return"object"===a.type}),p.toRadian(-(a&&a.heading||
0))):0},enumerable:!1,configurable:!0});b.prototype.reset=function(){};b.prototype.onDetach=function(){f.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()};b.prototype.onHide=function(){f.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()};b.prototype.onScaleChanged=function(){if(!f.isNone(this.scaleRotate)){var a=this.scaleRotate.getScale();this.moveManipulation.displayScale=a}};b.prototype.updateMoveAngle=function(){this.moveManipulation.angle="local"===this.view.viewingMode||
this.view.scale<u.ALIGN_ARROWS_SCALE_THRESHOLD?this.symbolRotationAngle:0};b.prototype.onGeometryChanged=function(){r.placeAtGraphic(this.view,this.moveManipulation,this.graphic)};Object.defineProperty(b.prototype,"test",{get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:f.isSome(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}},enumerable:!1,
configurable:!0});c.__decorate([d.property({constructOnly:!0,nonNullable:!0})],b.prototype,"view",void 0);c.__decorate([d.property({constructOnly:!0,nonNullable:!0})],b.prototype,"graphic",void 0);c.__decorate([d.property({constructOnly:!0,nonNullable:!0})],b.prototype,"enableZ",void 0);c.__decorate([d.property()],b.prototype,"enableRotation",void 0);c.__decorate([d.property()],b.prototype,"enableScaling",void 0);c.__decorate([d.property({value:!1})],b.prototype,"snapToScene",null);c.__decorate([d.property({readOnly:!0})],
b.prototype,"type",void 0);return b=c.__decorate([d.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],b)}(l.EventedMixin(x.InteractiveToolBase));e.GraphicTransformTool=g});