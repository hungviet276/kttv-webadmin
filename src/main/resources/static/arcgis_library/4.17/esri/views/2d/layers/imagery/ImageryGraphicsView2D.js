// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../Graphic ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../support/GraphicsCollection ../../engine/Container ../LayerView2D ../graphics/GraphicsView2D ../../../layers/LayerView".split(" "),function(k,n,c,r,t,l,u,f,v,w,x,y,z,A){Object.defineProperty(n,"__esModule",{value:!0});var B=t.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D");
k=function(g){function b(){var a=null!==g&&g.apply(this,arguments)||this;a.container=new x.Container;a._graphicsView=null;a.type="Graphics";a._graphics=new w.default;a._updateGraphics=l.debounce(function(b,C){return c.__awaiter(a,void 0,void 0,function(){var a,q,f,h,e,m,g,p,k,n=this;return c.__generator(this,function(d){switch(d.label){case 0:if(!b.stationary)return[2];a=b.state;q=new v({xmin:a.extent.xmin,ymin:a.extent.ymin,xmax:a.extent.xmax,ymax:a.extent.ymax,spatialReference:a.spatialReference});
f=b.state.size[0];h=b.state.size[1];e={};e.timeExtent=this.timeExtent;e.requestAsImageElement=!1;e.signal=C;m=this._getVectorFieldExportParams({extent:q,width:f,height:h});return[4,this.layer.fetchImage(m.extent,m.width,m.height,e)];case 1:g=d.sent();p=this.layer.renderer;if("vector-field"!==p.type)return[3,4];this._pixelData={extent:m.extent,pixelBlock:g.pixelData.pixelBlock};return[4,p.getGraphicsFromPixelData(g.pixelData,"vector-uv"===this.layer.rasterInfo.dataType)];case 2:return k=d.sent(),this._graphicsView.update(b),
[4,l.after(0).then(function(){n._graphics.set("items",k)})];case 3:d.sent(),d.label=4;case 4:return[2]}})})});return a}c.__extends(b,g);Object.defineProperty(b.prototype,"updating",{get:function(){var a;return null===(a=this._graphicsView)||void 0===a?void 0:a.updating},enumerable:!1,configurable:!0});b.prototype.update=function(a){this._updateGraphics(a).catch(function(a){l.isAbortError(a)||B.error(a)})};b.prototype.hitTest=function(a,b){if(this.suspended)return l.resolve(null);a=this.view.toMap(u.createScreenPoint(a,
b));return l.resolve(new r({attributes:{},geometry:a,layer:this.layer}))};b.prototype.attach=function(){var a=this;this._graphicsView=new z.default({view:this.view,graphics:this._graphics,requestUpdateCallback:function(){return a.requestUpdate()}})};b.prototype.detach=function(){this._graphics.destroy();this._graphicsView.destroy();this.container.removeChild(this._graphicsView.container);this._graphicsView=null};b.prototype.moveStart=function(){};b.prototype.viewChange=function(){};b.prototype.moveEnd=
function(){};b.prototype.install=function(a){this.container.addChild(this._graphicsView.container);a.addChild(this.container)};b.prototype.uninstall=function(a){this.container.removeChild(this._graphicsView.container);a.removeChild(this.container)};b.prototype.isUpdating=function(){return this._graphicsView.updating||this.updateRequested};b.prototype.getPixelData=function(){return this.updating?null:this._pixelData};b.prototype.redraw=function(){};b.prototype._getVectorFieldExportParams=function(a){var b,
c,d=a.extent,f=a.width;a=a.height;var g=this.layer,h=null===(b=g.fullExtent)||void 0===b?void 0:b.xmin;b=null===(c=g.fullExtent)||void 0===c?void 0:c.ymax;var e;"vector-field"===g.renderer.type&&(e=g.renderer.symbolTileSize);e=Math.max(e||0,30);f=Math.ceil(1/e*f);a=Math.ceil(1/e*a);c=(d.xmax-d.xmin)/f;e=(d.ymax-d.ymin)/a;d.xmin=h+Math.floor((d.xmin-h)/c)*c;d.xmax=h+Math.ceil((d.xmax-h)/c)*c;d.ymin=b+Math.floor((d.ymin-b)/e)*e;d.ymax=b+Math.ceil((d.ymax-b)/e)*e;return{extent:d,width:f,height:a}};c.__decorate([f.property()],
b.prototype,"container",void 0);c.__decorate([f.property()],b.prototype,"layer",void 0);c.__decorate([f.property()],b.prototype,"timeExtent",void 0);c.__decorate([f.property({dependsOn:["_graphicsView.updating"]})],b.prototype,"updating",null);c.__decorate([f.property()],b.prototype,"_graphicsView",void 0);c.__decorate([f.enumeration({graphics:"Graphics"})],b.prototype,"type",void 0);return b=c.__decorate([f.subclass("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],b)}(y.LayerView2DMixin(A));
n.default=k});