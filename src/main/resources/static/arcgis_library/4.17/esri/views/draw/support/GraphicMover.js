// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/arrayUtils ../../../core/Evented ../../../core/Handles ../../../core/lang ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./drawUtils ./input/GraphicMoverEvents ../../input/InputManager".split(" "),function(x,y,f,t,u,p,v,m,w,g,q,l,h){return function(r){function d(a){a=r.call(this,a)||this;a._activeGraphic=null;a._dragEvent=null;a._handles=new p;a._hoverGraphic=null;a._initialDragGeometry=null;a._viewHandles=new p;
a.type="graphic-mover";a.callbacks={onGraphicClick:function(){},onGraphicDoubleClick:function(){},onGraphicMoveStart:function(){},onGraphicMove:function(){},onGraphicMoveStop:function(){},onGraphicPointerOver:function(){},onGraphicPointerOut:function(){},onGraphicPointerDown:function(){},onGraphicPointerUp:function(){}};a.enableMoveAllGraphics=!1;a.graphics=[];a.view=null;return a}f.__extends(d,r);d.prototype.initialize=function(){var a=this;this._handles.add([w.whenOnce(this,"view.ready",function(){a._viewHandles.add([a.view.on("immediate-click",
function(b){return a._clickHandler(b)},h.ViewEventPriorities.TOOL),a.view.on("double-click",function(b){return a._doubleClickHandler(b)},h.ViewEventPriorities.TOOL),a.view.on("pointer-down",function(b){return a._pointerDownHandler(b)},h.ViewEventPriorities.TOOL),a.view.on("pointer-move",function(b){return a._pointerMoveHandler(b)},h.ViewEventPriorities.TOOL),a.view.on("pointer-up",function(b){return a._pointerUpHandler(b)},h.ViewEventPriorities.TOOL),a.view.on("drag",function(b){return a._dragHandler(b)},
h.ViewEventPriorities.TOOL),a.view.on("key-down",function(b){return a._keyDownHandler(b)},h.ViewEventPriorities.TOOL)])})])};d.prototype.destroy=function(){this.reset();this._viewHandles.removeAll();this._handles.removeAll()};Object.defineProperty(d.prototype,"state",{get:function(){var a=!!this.get("view.ready"),b=!!this.get("graphics.length"),c=this._activeGraphic;return a&&b?c?"moving":"active":a?"ready":"disabled"},enumerable:!1,configurable:!0});d.prototype.reset=function(){this._dragEvent=this._hoverGraphic=
this._activeGraphic=null};d.prototype.updateGeometry=function(a,b){(a=this.graphics[a])&&a.set("geometry",b)};d.prototype._clickHandler=function(a){var b=this;this.view.hitTest(m.createScreenPointFromEvent(a)).then(function(c){c=c.results;c.length&&c[0].graphic&&(c=c[0].graphic,-1<b.graphics.indexOf(c)&&(c=new l.GraphicClickEvent(c,b.graphics.indexOf(c),a.x,a.y,a),b.emit("graphic-click",c),b.callbacks.onGraphicClick&&b.callbacks.onGraphicClick(c)))})};d.prototype._doubleClickHandler=function(a){var b=
this;this.view.hitTest(m.createScreenPointFromEvent(a)).then(function(c){c=c.results;c.length&&c[0].graphic&&(c=c[0].graphic,-1<b.graphics.indexOf(c)&&(c=new l.GraphicDoubleClickEvent(c,b.graphics.indexOf(c),a.x,a.y,a),b.emit("graphic-double-click",c),b.callbacks.onGraphicDoubleClick&&b.callbacks.onGraphicDoubleClick(c)))})};d.prototype._pointerDownHandler=function(a){var b=this;this.view.hitTest(m.createScreenPointFromEvent(a)).then(function(c){if(c=t.find(c.results,function(a){return-1!==b.graphics.indexOf(a.graphic)}))if(c=
c.graphic,-1<b.graphics.indexOf(c)){b._activeGraphic=c;var d=a.x,k=a.y;c=new l.GraphicPointerDownEvent(c,b.graphics.indexOf(c),d,k,a);b.emit("graphic-pointer-down",c);b.callbacks.onGraphicPointerDown&&b.callbacks.onGraphicPointerDown(c)}else c!==b._activeGraphic&&(b._activeGraphic=null);else b._activeGraphic=null})};d.prototype._pointerUpHandler=function(a){if(this._activeGraphic){var b=a.x,c=a.y,d=this.graphics.indexOf(this._activeGraphic);a=new l.GraphicPointerUpEvent(this._activeGraphic,d,b,c,
a);this.emit("graphic-pointer-up",a);this.callbacks.onGraphicPointerUp&&this.callbacks.onGraphicPointerUp(a)}};d.prototype._pointerMoveHandler=function(a){var b=this;this._dragEvent||this.view.hitTest(m.createScreenPointFromEvent(a)).then(function(c){c=c.results;if(c.length&&c[0].graphic){c=c[0].graphic;if(c===b._hoverGraphic)return;if(-1<b.graphics.indexOf(c)){var d=a.x,k=a.y;if(b._hoverGraphic){var e=b.graphics.indexOf(b._hoverGraphic),e=new l.GraphicPointerOutEvent(b.graphics[e],e,d,k,a);b._hoverGraphic=
null;b.emit("graphic-pointer-out",e);b.callbacks.onGraphicPointerOut&&b.callbacks.onGraphicPointerOut(e)}e=b.graphics.indexOf(c);d=new l.GraphicPointerOverEvent(c,e,d,k,a);b._hoverGraphic=c;b.emit("graphic-pointer-over",d);b.callbacks.onGraphicPointerOver&&b.callbacks.onGraphicPointerOver(d);return}}b._hoverGraphic&&(d=a.x,k=a.y,e=b.graphics.indexOf(b._hoverGraphic),d=new l.GraphicPointerOutEvent(b.graphics[e],e,d,k,a),b._hoverGraphic=null,b.emit("graphic-pointer-out",d),b.callbacks.onGraphicPointerOut&&
b.callbacks.onGraphicPointerOut(d))})};d.prototype._dragHandler=function(a){var b=this;if(("start"===a.action||this._dragEvent)&&this._activeGraphic&&this._activeGraphic.geometry){a.stopPropagation();var c=a.action,d=a.x,k=a.y,e=this.graphics.indexOf(this._activeGraphic),f=this._activeGraphic.geometry,g=this._dragEvent?d-this._dragEvent.x:0,h=this._dragEvent?k-this._dragEvent.y:0,m=d-a.origin.x,n=k-a.origin.y;this._activeGraphic.geometry=q.cloneMove(f,g,h,this.view);this.enableMoveAllGraphics&&this.graphics.forEach(function(a){a!==
b._activeGraphic&&(a.geometry=q.cloneMove(a.geometry,g,h,b.view))});this._dragEvent=a;"start"===c?(this._initialDragGeometry=v.clone(f),a=new l.GraphicMoveStartEvent(this._activeGraphic,this.graphics,e,d,k,g,h,m,n,a),this.emit("graphic-move-start",a),this.callbacks.onGraphicMoveStart&&this.callbacks.onGraphicMoveStart(a),a.defaultPrevented&&this._activeGraphic.set("geometry",f)):"update"===c?(a=new l.GraphicMoveEvent(this._activeGraphic,this.graphics,e,d,k,g,h,m,n,a),this.emit("graphic-move",a),this.callbacks.onGraphicMove&&
this.callbacks.onGraphicMove(a),a.defaultPrevented&&this._activeGraphic.set("geometry",f)):(a=new l.GraphicMoveStopEvent(this._activeGraphic,this.graphics,e,d,k,g,h,m,n,a),this._activeGraphic=this._dragEvent=null,this.emit("graphic-move-stop",a),this.callbacks.onGraphicMoveStop&&this.callbacks.onGraphicMoveStop(a),a.defaultPrevented&&this.graphics[e].set("geometry",this._initialDragGeometry),this._initialDragGeometry=null)}};d.prototype._keyDownHandler=function(a){"a"!==a.key&&"d"!==a.key&&"n"!==
a.key||"moving"!==this.state||a.stopPropagation()};f.__decorate([g.property()],d.prototype,"_activeGraphic",void 0);f.__decorate([g.property({readOnly:!0})],d.prototype,"type",void 0);f.__decorate([g.property()],d.prototype,"callbacks",void 0);f.__decorate([g.property()],d.prototype,"enableMoveAllGraphics",void 0);f.__decorate([g.property()],d.prototype,"graphics",void 0);f.__decorate([g.property({dependsOn:["view.ready","graphics.length","_activeGraphic"],readOnly:!0})],d.prototype,"state",null);
f.__decorate([g.property()],d.prototype,"view",void 0);return d=f.__decorate([g.subclass("esri.views.draw.support.GraphicMover")],d)}(u.EventedAccessor)});