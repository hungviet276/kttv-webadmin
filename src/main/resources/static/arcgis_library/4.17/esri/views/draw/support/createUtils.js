// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../geometry ../../../core/arrayUtils ../../../core/lang ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat2d ../../../core/libs/gl-matrix-2/mat2df64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Circle ../../../geometry/geometryEngine ../../../geometry/support/coordsUtils ../../../geometry/support/spatialReferenceUtils".split(" "),
function(t,e,x,n,F,G,y,H,I,v,z,A,p,l,J,B,u,C){function q(a,d,f){void 0===f&&(f=null);return y.isSome(f)?[a,d,f]:[a,d]}function g(a,d,f){void 0===f&&(f=null);return y.isSome(f)?{x:a,y:d,z:f}:{x:a,y:d}}function w(a,d){d=new n.Point({x:a[0],y:a[1],spatialReference:d});2<a.length&&(d.z=a[2]);return d}function r(a,d,f,c){void 0===c&&(c=!0);a=G.clone(a);a.forEach(function(b){F.equals(b[0],b[b.length-1])&&1!==b.length||b.push(b[0])});a=new n.Polygon({rings:a,spatialReference:d});a.rings.forEach(function(b){u.isClockwise(b,
!1,!1)||b.reverse()});f&&u.unnormalizeGeometryOnDatelineCrossing(a);c&&a.isSelfIntersecting&&C.isValid(d)&&(a=B.simplify(a));return a}Object.defineProperty(e,"__esModule",{value:!0});e.createEllipse=e.createCircle=e.createRectangle=e.createSquare=e.createPolygon=e.createPolyline=e.createMultipoint=e.createPoint=e.createViewAlignedCoordinateSystem=e.SceneViewCoordinateSystem=e.AffineCoordinateSystem=e.SurfaceCoordinateSystem=e.makeSurfacePoint=e.makeMapPoint=void 0;e.makeMapPoint=q;e.makeSurfacePoint=
g;t=function(){function a(a){this.spatialReference=a}a.prototype.mapToLocalMultiple=function(a){var f=this;return a.map(function(a){return f.mapToLocal(a)})};Object.defineProperty(a.prototype,"doUnnormalization",{get:function(){return!1},enumerable:!1,configurable:!0});return a}();e.SurfaceCoordinateSystem=t;var D=function(a){function d(f,c,b){void 0===b&&(b=null);c=a.call(this,c)||this;c.defaultZ=b;c.transform=v.mat2df64.create();c.transformInv=v.mat2df64.create();c.transform=v.mat2df64.clone(f);
I.mat2d.invert(c.transformInv,c.transform);return c}x.__extends(d,a);d.prototype.makeMapPoint=function(a,c){return q(a,c,this.defaultZ)};d.prototype.mapToLocal=function(a){return g(this.transform[0]*a[0]+this.transform[2]*a[1]+this.transform[4],this.transform[1]*a[0]+this.transform[3]*a[1]+this.transform[5])};d.prototype.localToMap=function(a){return q(this.transformInv[0]*a.x+this.transformInv[2]*a.y+this.transformInv[4],this.transformInv[1]*a.x+this.transformInv[3]*a.y+this.transformInv[5],this.defaultZ)};
return d}(t);e.AffineCoordinateSystem=D;var E=function(a){function d(f,c){var b=a.call(this,f.spatialReference)||this;b.view=f;b.defaultZ=null;b.pWS=l.vec3f64.create();b.tangentFrameUpWS=l.vec3f64.create();b.tangentFrameRightWS=l.vec3f64.create();b.tangentFrameForwardWS=l.vec3f64.create();b.localFrameRightWS=l.vec3f64.create();b.localFrameUpWS=l.vec3f64.create();b.worldToLocalTransform=A.quatf64.create();b.localToWorldTransform=A.quatf64.create();b.scale=1;b.scale=f.resolution;b.referenceMapPoint=
c;b.defaultZ=c.hasZ?c.z:null;f=f.state.camera.viewRight;b.view.renderCoordsHelper.toRenderCoords(b.referenceMapPoint,b.pWS);b.view.renderCoordsHelper.worldBasisAtPosition(b.pWS,0,b.tangentFrameRightWS);b.view.renderCoordsHelper.worldBasisAtPosition(b.pWS,1,b.tangentFrameUpWS);b.view.renderCoordsHelper.worldBasisAtPosition(b.pWS,2,b.tangentFrameForwardWS);c=l.vec3f64.create();p.vec3.scale(c,b.tangentFrameForwardWS,p.vec3.dot(f,b.tangentFrameForwardWS));p.vec3.subtract(b.localFrameRightWS,f,c);p.vec3.normalize(b.localFrameRightWS,
b.localFrameRightWS);p.vec3.cross(b.localFrameUpWS,b.tangentFrameForwardWS,b.localFrameRightWS);z.quat.rotationTo(b.worldToLocalTransform,b.localFrameRightWS,b.tangentFrameRightWS);z.quat.invert(b.localToWorldTransform,b.worldToLocalTransform);return b}x.__extends(d,a);Object.defineProperty(d.prototype,"doUnnormalization",{get:function(){return"global"===this.view.viewingMode},enumerable:!1,configurable:!0});d.prototype.makeMapPoint=function(a,c){return q(a,c,this.defaultZ)};d.prototype.mapToLocal=
function(a){var c=l.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(new n.Point({x:a[0],y:a[1],spatialReference:this.spatialReference}),c);p.vec3.transformQuat(c,c,this.worldToLocalTransform);a=this.view.renderCoordsHelper.fromRenderCoords(c,this.view.spatialReference);return g(a.x/this.scale,a.y/this.scale)};d.prototype.localToMap=function(a){var c=l.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(new n.Point({x:a.x*this.scale,y:a.y*this.scale,spatialReference:this.spatialReference}),
c);p.vec3.transformQuat(c,c,this.localToWorldTransform);a=this.view.renderCoordsHelper.fromRenderCoords(c,this.view.spatialReference);return q(a.x,a.y,this.defaultZ)};return d}(t);e.SceneViewCoordinateSystem=E;e.createViewAlignedCoordinateSystem=function(a,d){return"2d"===a.type?new D(a.state.transform,a.spatialReference,2<d.length?d[2]:null):"3d"===a.type?(d=2<d.length?new n.Point({x:d[0],y:d[1],z:d[2],spatialReference:a.spatialReference}):new n.Point({x:d[0],y:d[1],spatialReference:a.spatialReference}),
new E(a,d)):null};e.createPoint=w;e.createMultipoint=function(a,d){return new n.Multipoint({points:a,spatialReference:d})};e.createPolyline=function(a,d,f){a=new n.Polyline({paths:a,spatialReference:d});f&&u.unnormalizeGeometryOnDatelineCrossing(a);return a};e.createPolygon=r;e.createSquare=function(a,d,f){var c=d.mapToLocalMultiple(a);a=[];var b=c[0].x,m=c[0].y,e=Math.round(c[1].x-b),k=Math.round(c[1].y-m),c=Math.max(Math.abs(e),Math.abs(k));f?(f=b+c,e=m+c,b-=c,m-=c,a.push(g(f,m),g(b,m),g(b,e),g(f,
e))):(f=0<e?b+c:b-c,c=0<k?m+c:m-c,a.push(g(b,m),g(f,m),g(f,c),g(b,c)));return r([a.map(function(a){return d.localToMap(a)})],d.spatialReference,d.doUnnormalization,!0)};e.createRectangle=function(a,d,f){var c=d.mapToLocalMultiple(a);1===c.length&&(a=c[0],c=[g(a.x-48,a.y+48),g(a.x+48,a.y-48),g(a.x+48,a.y-48),g(a.x-48,a.y+48)]);a=[];var b=c[0].x,e=c[0].y,h=c[1].x,c=c[1].y;if(f){f=Math.round(h-b);var k=Math.round(c-e);a.push(g(b-f,e-k),g(h,e-k),g(h,c),g(b-f,c))}else a.push(g(b,e),g(h,e),g(h,c),g(b,c));
return r([a.map(function(a){return d.localToMap(a)})],d.spatialReference,d.doUnnormalization,!0)};e.createCircle=function(a,d,f,c){var b=d.mapToLocalMultiple(a),e=a=null;f?(a=b[0],e=b[1]):(a=b[0],e=b[1],f=Math.round(e.x-a.x),e=Math.round(e.y-a.y),b=Math.max(Math.abs(f),Math.abs(e)),a=g(0<f?a.x+b/2:a.x-b/2,0<e?a.y+b/2:a.y-b/2),e=g(Math.abs(f)>Math.abs(e)?a.x-b/2:a.x,Math.abs(f)>Math.abs(e)?a.y:a.y-b/2));b=d.localToMap(a);f=d.localToMap(e);d.doUnnormalization&&u.unnormalizeVerticesOnDatelineCrossing([[b,
f]],d.spatialReference);b=w(b,d.spatialReference);f=w(f,d.spatialReference);var h=H.getMetersPerUnitForSR(d.spatialReference),k=0;C.isValid(d.spatialReference)?k=h*B.distance(b,f,null):(f=a.x-e.x,e=a.y-e.y,k=h*Math.sqrt(f*f+e*e)*(c||1));d=new J({center:b,radius:k,radiusUnit:"meters",spatialReference:d.spatialReference});return r(d.rings,d.spatialReference,!1)};e.createEllipse=function(a,d,f){var c=d.mapToLocalMultiple(a);a=c[0];var b=c[1],c=Math.round(b.x-a.x),b=Math.round(b.y-a.y);a=g(f?a.x:a.x+
c/2,f?a.y:a.y+b/2);c=f?c:c/2;f=f?b:b/2;for(var b=[],e=2*Math.PI/60,h=0;60>h;h++){var k=g(c*Math.cos(h*e)+a.x,f*Math.sin(h*e)+a.y);b.push(k)}b.push(b[0]);return r([b.map(function(a){return d.localToMap(a)})],d.spatialReference,d.doUnnormalization,!1)}});