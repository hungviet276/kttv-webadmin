// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/maybe ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./RasterTile ./terrainUtilsPlanar ./terrainUtilsSpherical ./TileTexture".split(" "),function(F,b,t,u,v,w,x,y,z,A,B,C){function h(a){return"imagery-tile"===a.type||"wcs"===a.type}function k(a){return a&&"esri.views.3d.layers.ImageryTileLayerView3D"===a.declaredClass}function m(a){return a&&"esri.views.3d.layers.TileLayerView3D"===
a.declaredClass}function n(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function p(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function q(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function l(a,b,c,d){return r[2===d||"planar"===d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,c,b)}Object.defineProperty(b,"__esModule",{value:!0});b.test=b.getTiledLayerInfo=b.checkIfTileInfoSupportedForView=b.useFetchTileForLayer=
b.releaseTileData=b.isRasterTileRenderInfo=b.isTextureTileRenderInfo=b.isVectorTileRenderInfo=b.isImageryTileRenderInfo=b.isSurfaceLayerView=b.isElevationLayerView=b.isWMTSLayerView=b.isVectorTileLayerView=b.isTileLayerView=b.isImageryTileLayerView=b.isProjectableRasterLayer=b.isVectorTileLayer=b.getLayerWithExtentRange=b.autoUpdateSkirtsVisibility=b.weakAssert=void 0;var r={planar:A,spherical:B};b.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};var D=80/180*Math.PI,E=110/180*Math.PI;b.autoUpdateSkirtsVisibility=
function(a,b,c,d){var e=r[a.manifold],f=e.isInsideExtent(a,b);f?c=a.getElevation(b[0],b[1],b[1],c):(c=a.elevationBounds,c=.5*(c.min+c.max));c=b[2]-c;d=Math.abs(c)<d?0:0>c?-1:1;f||(e.isInsideExtent(a,b,1.2)?(b=e.tiltToExtentEdge(a,b),b>D&&b<E&&(d=0)):d=0);a.skirtScale=d};b.getLayerWithExtentRange=function(a){return k(a)?{fullExtent:a.fullExtent,minScale:a.layer.minScale,maxScale:a.layer.maxScale,tilemapCache:null}:a.layer};b.isVectorTileLayer=function(a){return a&&a instanceof w};b.isProjectableRasterLayer=
h;b.isImageryTileLayerView=k;b.isTileLayerView=m;b.isVectorTileLayerView=n;b.isWMTSLayerView=p;b.isElevationLayerView=q;b.isSurfaceLayerView=function(a){return a&&(m(a)||k(a)||q(a)||n(a)||p(a))};b.isImageryTileRenderInfo=function(a){return a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof z.default};b.isVectorTileRenderInfo=function(a){return a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof x.VectorTile};b.isTextureTileRenderInfo=function(a){return a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof
C.TileTexture};b.isRasterTileRenderInfo=function(a){a=a&&a.sourceLayerInfo&&a.sourceLayerInfo.data;return a instanceof HTMLImageElement||a instanceof y.ImageWithType||a instanceof HTMLCanvasElement||a instanceof ImageData};b.releaseTileData=function(a){!t.isSome(a)||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData||a.release();return null};b.useFetchTileForLayer=function(a){return a.fetchTile&&!(a.fetchTile===v.prototype.fetchTile||a.fetchTile===u.prototype.fetchTile)};
b.checkIfTileInfoSupportedForView=l;b.getTiledLayerInfo=function(a,g,c){var d,e;if("wmts"===a.type){if(a=a.activeLayer){var f=a.tileMatrixSet;if(f)d=f.tileInfo,e=f.fullExtent;else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==l(a.tileInfo,a.fullExtent,g,c)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else e=h(a)?a.getCompatibleFullExtent(g):a.fullExtent,d="vector-tile"!==a.type||b.test.force512VTL?h(a)?a.getCompatibleTileInfo(g,e):a.tileInfo:a.compatibleTileInfo256;return d&&
e&&null==l(d,e,g,c)?{tileInfo:d,fullExtent:e}:{tileInfo:null,fullExtent:null}};b.test={force512VTL:!1}});