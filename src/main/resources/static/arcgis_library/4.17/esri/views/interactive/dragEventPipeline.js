// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/handleUtils ../../core/lang ../../core/mathUtils ../../core/maybe ../../core/screenUtils ../../geometry/support/webMercatorUtils ../draw/support/drawUtils".split(" "),function(B,a,h,x,y,n,f,z,m,A){function p(c,g){var b=null,d=null;return function(e){if("cancel"===e.action)f.isSome(d)&&(d.execute({action:"cancel"}),d=b=null);else{var a={action:e.action,screenStart:e.start,screenEnd:e.screenPoint};"start"===e.action&&f.isNone(b)&&(b=new l,d=new l,g(c,b,d,a));
f.isSome(b)&&b.execute(a);"end"===e.action&&f.isSome(b)&&(d=b=null)}}}function q(c,a){return c.events.on("drag",p(c,a))}function r(c,a){var b=null,d=f.isSome(c[a])?c[a].spatialReference:null;return function(e){if("start"===e.action&&f.isSome(c[a])){var k=c[a],g=e.mapStart.spatialReference;b=f.isNone(k)||"mesh"===k.type?null:k.spatialReference.equals(g)?k.clone():m.canProject(k,g)?m.project(k,g):null}if(f.isNone(b))return null;var k=e.mapEnd.x-e.mapStart.x,g=e.mapEnd.y-e.mapStart.y,t=e.mapEnd.z-e.mapStart.z,
l=A.move(b.clone(),k,g,t);l.spatialReference.equals(d)?c[a]=l:c[a]=m.project(l,d);return h.__assign(h.__assign({},e),{translationX:k,translationY:g,translationZ:t})}}function u(c){return r(c,"geometry")}function v(c,a){for(var b=new Map,d=0;d<a.length;d++){var e=a[d];b.set(e,y.clone(c[e]))}return function(d){b.forEach(function(b,d){c[d]=b});return d}}function w(c){return v(c,["geometry"])}Object.defineProperty(a,"__esModule",{value:!0});a.EventPipeline=a.dragAtLocation=a.addScreenDelta=a.addMapDelta=
a.allDegreesOfFreedom=a.verticalDegreesOfFreedom=a.horizontalDegreesOfFreedom=a.resetSymbol=a.resetGraphicMany=a.resetGraphic=a.resetProperties=a.dragGraphicMany=a.screenToMap=a.dragGraphic=a.dragGeometry=a.constrainToMapAxis=a.createManipulatorDragEventPipelineMany=a.createManipulatorDragEventPipeline=a.createDragEventPipelineCallback=void 0;a.createDragEventPipelineCallback=p;a.createManipulatorDragEventPipeline=q;a.createManipulatorDragEventPipelineMany=function(c,a){for(var b=[],d=0;d<c.length;d++)b.push(q(c[d],
a));return x.handlesGroup(b)};a.constrainToMapAxis=function(c,a){var b=[c.x,c.y,c.z],d=[Math.cos(a),Math.sin(a)];c=Math.sqrt(d[0]*d[0]+d[1]*d[1]);if(0===c)return null;d[0]/=c;d[1]/=c;var e=function(c){var a=(c.x-b[0])*d[0]+(c.y-b[1])*d[1];c.x=b[0]+a*d[0];c.y=b[1]+a*d[1]};return function(b){e(b.mapStart);e(b.mapEnd);return b}};a.dragGeometry=r;a.dragGraphic=u;a.screenToMap=function(c,a,b){void 0===a&&(a=null);var d=null,e=f.isSome(a)&&!c.spatialReference.equals(a)?function(b){return f.isSome(b)?m.project(b,
a):b}:function(b){return b},g=h.__assign({exclude:[]},b);return function(b){"start"===b.action&&(d=e(c.toMap(b.screenStart,g)));if(f.isNone(d))return null;var a=e(c.toMap(b.screenEnd,g));return f.isSome(a)?h.__assign(h.__assign({},b),{mapStart:d,mapEnd:a}):null}};a.dragGraphicMany=function(a){var c=a.map(function(b){return f.unwrap(u(b))}).filter(function(b){return f.isSome(b)});return function(b){var a=b.mapEnd.x-b.mapStart.x,e=b.mapEnd.y-b.mapStart.y,g=b.mapEnd.z-b.mapStart.z;c.forEach(function(a){return a(b)});
return h.__assign(h.__assign({},b),{translationX:a,translationY:e,translationZ:g})}};a.resetProperties=v;a.resetGraphic=w;a.resetGraphicMany=function(a){var c=a.map(function(b){return f.unwrap(w(b))}).filter(function(b){return f.isSome(b)});return function(b){c.forEach(function(a){return a(b)});return b}};a.resetSymbol=function(a){var c=f.isSome(a.symbol)?a.symbol.clone():null;return function(b){a.symbol=c;return b}};a.horizontalDegreesOfFreedom=3;a.verticalDegreesOfFreedom=4;a.allDegreesOfFreedom=
7;a.addMapDelta=function(c){void 0===c&&(c=a.allDegreesOfFreedom);var g=0,b=0,d=0;return function(a){"start"===a.action&&(g=a.mapStart.x,b=a.mapStart.y,d=a.mapStart.z);var e=c&1?a.mapEnd.x-g:0,f=c&2?a.mapEnd.y-b:0,l=c&4?a.mapEnd.z-d:0;g=a.mapEnd.x;b=a.mapEnd.y;d=a.mapEnd.z;return h.__assign(h.__assign({},a),{mapDeltaX:e,mapDeltaY:f,mapDeltaZ:l,mapDeltaSpatialReference:a.mapStart.spatialReference})}};a.addScreenDelta=function(c){void 0===c&&(c=a.allDegreesOfFreedom);var g=0,b=0;return function(a){"start"===
a.action&&(g=a.screenStart.x,b=a.screenStart.y);var d=c&1?a.screenEnd.x-g:0,f=c&2?a.screenEnd.y-b:0;g=a.screenEnd.x;b=a.screenEnd.y;return h.__assign(h.__assign({},a),{screenDeltaX:d,screenDeltaY:f})}};a.dragAtLocation=function(a,g){var b=null,c=0,e=0;return function(d){"start"===d.action&&(b=a.toScreen(g),0>b.x||b.x>a.width||0>b.y||b.y>a.height?b=null:(c=d.screenStart.x-b.x,e=d.screenStart.y-b.y));if(null==b)return null;var f=n.clamp(d.screenEnd.x-c,0,a.width),h=n.clamp(d.screenEnd.y-e,0,a.height),
f=z.createScreenPoint(f,h);d.screenStart=b;d.screenEnd=f;return d}};var l=function(){function a(){this.execute=function(){}}a.prototype.next=function(c,b){void 0===b&&(b=new a);f.isSome(c)&&(this.execute=function(a){a=c(a);f.isSome(a)&&b.execute(a)});return b};return a}();a.EventPipeline=l});