// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/domUtils ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ./overlay/ViewOverlay ../widgets/Popup".split(" "),function(r,g,e,k,m,l,f,n,p){function q(e){e&&(k.empty(e),e.parentNode&&e.parentNode.removeChild(e))}Object.defineProperty(g,"__esModule",{value:!0});g.isDOMContainer=g.DOMContainer=void 0;var h=[0,0];g.DOMContainer=function(g){return function(g){function b(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];var c=g.apply(this,
a)||this;c._freqInfo={freq:16,time:750};c._overlayRenderTaskHandle=null;c.height=0;c.position=null;c.resizing=!1;c.root=null;c.surface=null;c.suspended=!0;c.ui=null;c.userContent=null;c.width=0;c.widthBreakpoint=null;c.handles.add([c.watch("cursor",function(a){var d=c.surface;d&&d.setAttribute("data-cursor",a)}),c.watch("interacting",function(a){var d=c.surface;d&&d.setAttribute("data-interacting",a.toString())})]);return c}e.__extends(b,g);b.prototype.initialize=function(){var a=this;this.handles.add(this.watch("ui",
function(d,c){return a._handleUIChange(d,c)}));this._wireUI(this.ui);this.handles.add([this.on("focus",function(){return a.notifyChange("focused")}),this.on("blur",function(){return a.notifyChange("focused")})])};b.prototype.destroy=function(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)};Object.defineProperty(b.prototype,"container",{set:function(a){var d=this,c=this._get("container");if(c!==a)if(this.handles.remove("dom-size"),
this._stopMeasuring(),c&&(c.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),q(this.root),this._set("root",null),k.reparent(this.userContent,c),q(this.userContent),this._set("userContent",null)),a){a.classList.add("esri-view");c=document.createElement("div");c.className="esri-view-user-storage";k.reparent(a,c);a.appendChild(c);this._set("userContent",c);c=document.createElement("div");
c.className="esri-view-root";a.insertBefore(c,a.firstChild);this._set("root",c);var b=document.createElement("div");b.className="esri-view-surface";b.setAttribute("role","application");b.tabIndex=0;c.appendChild(b);this._set("surface",b);var e=new n;c.appendChild(e.surface);this._set("overlay",e);e.watch("needsRender",function(a){a&&!d._overlayRenderTaskHandle?d._overlayRenderTaskHandle=m.addFrameTask({render:function(){d.overlay.render()}}):d._overlayRenderTaskHandle&&(d._overlayRenderTaskHandle.remove(),
d._overlayRenderTaskHandle=null)});this.forceDOMReadyCycle();this.handles.add(l.init(this,"size",function(a){var c=a[1];a[0]>=document.body.clientWidth||c>=document.body.clientHeight?b.classList.add("esri-view-surface--inset-outline"):b.classList.remove("esri-view-surface--inset-outline")}),"dom-size");this._set("container",a);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",
null)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"focused",{get:function(){var a=document.activeElement===this.surface;return document.hasFocus()&&a},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"popup",{get:function(){return this._get("popup")||new p({view:this})},set:function(a){var d=this._get("popup");d&&d!==a&&d.destroy();this._set("popup",a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return[this.width,
this.height]},enumerable:!1,configurable:!0});b.prototype.blur=function(){this.surface&&this.surface.blur()};b.prototype.focus=function(){this.surface&&this.surface.focus()};b.prototype.pageToContainer=function(a,d,c){var b=this.position;a-=b[0];d-=b[1];c?(c[0]=a,c[1]=d):c=[a,d];return c};b.prototype.containerToPage=function(a,d,c){var b=this.position;a+=b[0];d+=b[1];c?(c[0]=a,c[1]=d):c=[a,d];return c};b.prototype._handleUIChange=function(a,d){d&&(this.handles.remove("ui"),d.destroy());a&&this._wireUI(a);
this._set("ui",a)};b.prototype._wireUI=function(a){this.handles.remove("ui");a&&(a.view=this,this.handles.add([l.init(this,"root",function(d){if(d){var c=document.createElement("div");d.appendChild(c);d=c}else d=null;a.container=d}),l.init(this,"popup",function(d,c){c&&a.remove(c,"popup");d&&(d.view=a.view,a.add(d,{key:"popup",position:"manual"}))})],"ui"))};b.prototype._stopMeasuring=function(){this.handles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};b.prototype._startMeasuring=
function(){var a=this,d=this._freqInfo;d.freq=16;d.time=750;this.handles.add([function(){var a=function(){d.freq=16;d.time=750};window.addEventListener("resize",a);return{remove:function(){window.removeEventListener("resize",a)}}}(),m.addFrameTask({prepare:function(c){var d=a._measure(),b=a._freqInfo;b.time+=c.deltaTime;d&&(b.freq=16,a._get("resizing")||a._set("resizing",!0));b.time<b.freq||(b.time=0,a._position()||d?b.freq=16:b.freq=Math.min(750,2*b.freq),!d&&512<=b.freq&&a._get("resizing")&&a._set("resizing",
!1))}})],"measuring");this._measure();this._position()};b.prototype._measure=function(){var a=this.container,d=a?a.clientWidth:0,a=a?a.clientHeight:0;if(0===d||0===a)return this.suspended||this._set("suspended",!0),!1;var c=this.width,b=this.height;if(d===c&&a===b)return this.suspended&&this._set("suspended",!1),!1;this._set("width",d);this._set("height",a);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:c,oldHeight:b,width:d,height:a});return!0};b.prototype._position=function(){var a=
this.container,b=this.position,c=(a.ownerDocument||window.document).defaultView,a=a.getBoundingClientRect();h[0]=a.left+c.pageXOffset;h[1]=a.top+c.pageYOffset;return b&&h[0]===b[0]&&h[1]===b[1]?!1:(this._set("position",[h[0],h[1]]),!0)};b.prototype.forceDOMReadyCycle=function(){};e.__decorate([f.property({value:null,cast:function(a){return k.byId(a)}})],b.prototype,"container",null);e.__decorate([f.property({readOnly:!0,dependsOn:["surface"]})],b.prototype,"focused",null);e.__decorate([f.property({readOnly:!0})],
b.prototype,"height",void 0);e.__decorate([f.property({type:p})],b.prototype,"popup",null);e.__decorate([f.property({type:n})],b.prototype,"overlay",void 0);e.__decorate([f.property({readOnly:!0})],b.prototype,"position",void 0);e.__decorate([f.property({readOnly:!0})],b.prototype,"resizing",void 0);e.__decorate([f.property({readOnly:!0})],b.prototype,"root",void 0);e.__decorate([f.property({value:null,dependsOn:["width","height"],readOnly:!0})],b.prototype,"size",null);e.__decorate([f.property({readOnly:!0})],
b.prototype,"surface",void 0);e.__decorate([f.property({readOnly:!0})],b.prototype,"suspended",void 0);e.__decorate([f.property()],b.prototype,"ui",void 0);e.__decorate([f.property({readOnly:!0})],b.prototype,"userContent",void 0);e.__decorate([f.property({readOnly:!0})],b.prototype,"width",void 0);e.__decorate([f.property()],b.prototype,"widthBreakpoint",void 0);return b=e.__decorate([f.subclass("esri.views.DOMContainer")],b)}(g)};g.isDOMContainer=function(e){return e&&"focus"in e}});