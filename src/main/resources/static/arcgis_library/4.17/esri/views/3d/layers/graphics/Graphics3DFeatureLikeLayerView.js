// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../Graphic ../../../../core/Accessor ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/accessorSupport/diffUtils ../../../../geometry/support/webMercatorUtils ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../../../support/WatchUpdatingTracking".split(" "),
function(e,l,d,m,t,u,v,n,h,c,p,q,w,x,y,z,A,B,C,D,E,r,F){Object.defineProperty(l,"__esModule",{value:!0});e=function(e){function b(a){a=e.call(this,a)||this;a._handles=new v;a.watchUpdatingTracking=new F.WatchUpdatingTracking;a.suspendResumeExtentMode="computed";a.dataExtent=null;a.suspendResumeExtent=null;return a}d.__extends(b,e);Object.defineProperty(b.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},
enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"suspendInfo",{get:function(){var a={};this.scaleVisibility&&this.scaleVisibility.suspended&&(a.outsideScaleRange=!0);this.frustumVisibility&&this.frustumVisibility.suspended&&(a.outsideOfView=!0);return a},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.watchUpdatingTracking&&
this.watchUpdatingTracking.updating)},enumerable:!1,configurable:!0});b.prototype.normalizeCtorArgs=function(a){var b=a.frustumVisibilityEnabled?new B:null,d=a.scaleVisibilityEnabled?new D:null,g=(a.filterVisibilityEnabled||a.timeExtentVisibilityEnabled)&&"multipatch"!==a.layer.geometryType?new A.Graphics3DFilterVisibility:null,c=a.elevationAlignmentEnabled?new z.default:null;return{graphicsCore:new y.Graphics3DCore({owner:a.owner,layer:a.layer,preferredUpdatePolicy:a.preferredUpdatePolicy,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled,
graphicSymbolSupported:!1,hasZ:a.owner.hasZ,hasM:a.owner.hasM}),frustumVisibility:b,scaleVisibility:d,filterVisibility:g,elevationAlignment:c,updateClippingExtent:a.updateClippingExtent,suspendResumeExtentMode:a.suspendResumeExtentMode,dataExtent:a.dataExtent}};b.prototype.initialize=function(){var a=this;this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()});this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,
"filter",function(){return a.filterVisibility.filterChanged()}),this.watchUpdatingTracking.add(this.owner,"timeExtent",function(){return a.filterVisibility.filterChanged()}));this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",function(b,d){p.diff(b,d)&&a.watchUpdatingTracking.addPromise(a.graphicsCore.elevationInfoChange())});this.watchUpdatingTracking.add(this.layer,"labelsVisible",function(){return a.graphicsCore.updateVisibilityInfo()});this.watchUpdatingTracking.add(this.layer,
"labelingInfo",function(b,d){p.diff(b,d)&&a.graphicsCore.updateLabelingInfo()})};b.prototype.setup=function(){return d.__awaiter(this,void 0,void 0,function(){var a,b,c,g,f=this;return d.__generator(this,function(d){switch(d.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),a=this.owner,b=this.owner.view.basemapTerrain,c=function(a,b,d){return f.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(a,b,d)},this.scaleVisibility&&this.scaleVisibility.setup(a,this.layer,
c,this.graphicsCore,b),this.filterVisibility&&("filter"in a||"timeExtent"in a)&&this.filterVisibility.setup(a,this.graphicsCore),this.elevationAlignment&&(g=a.view.elevationProvider,this.elevationAlignment.setup(a,c,this.graphicsCore,g)),this._set("objectStates",new C.Graphics3DObjectStates(this.graphicsCore)),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",a.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,
n.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}))];case 1:return d.sent(),this.watchUpdatingTracking.add(this.layer,"renderer",function(a){return f.watchUpdatingTracking.addPromise(f.graphicsCore.rendererChange(a))}),this.watchUpdatingTracking.add(a,"fullOpacity",function(){return f.graphicsCore.opacityChange()}),
this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(a.view,"clippingArea",function(){return f._updateClippingExtent()}),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,n.logOnError(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:d.sent(),d.label=3;case 3:return[2]}})})};b.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var a=0,b="watchUpdatingTracking frustumVisibility scaleVisibility filterVisibility elevationAlignment objectStates graphicsCore".split(" ");a<
b.length;a++){var d=b[a],c=this[d];c&&(c.destroy(),this._set(d,null))}this._set("layer",null);this._set("owner",null)};b.prototype.highlight=function(a,b){var d=this;if(a instanceof w){var c=this.objectStates.acquireSet(0,b),f=c.set,c=c.handle;this.owner.queryObjectIds(a).then(function(a){return d.objectStates.setObjectIds(f,a)});return c}if("number"===typeof a||"string"===typeof a||a instanceof m)return this.highlight([a],b);"toArray"in a&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof
m)if(b&&a[0].attributes&&null!==r.attributeLookup(a[0].attributes,b))a=a.map(function(a){return r.attributeLookup(a.attributes,b)});else{var e=a.map(function(a){return a.uid}),c=this.objectStates.acquireSet(0,null);a=c.set;c=c.handle;this.objectStates.setUids(a,e);return c}if("number"===typeof a[0]||"string"===typeof a[0])return e=a,c=this.objectStates.acquireSet(0,b),a=c.set,c=c.handle,this.objectStates.setObjectIds(a,e),c}return G};b.prototype._updateClippingExtent=function(){var a=this.owner.view.clippingArea;
this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())};b.prototype.setupSuspendResumeExtent=function(){var a=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(h.init(this,"suspendResumeExtentMode",function(){a._handles.remove(k);switch(a.suspendResumeExtentMode){case "computed":a._handles.add([h.init(a.graphicsCore,"computedExtent",function(b){return a.updateSuspendResumeExtent(b)}),a.graphicsCore.watch("extentPadding",
function(){return a.updateSuspendResumeExtent(a.graphicsCore.computedExtent)})],k);break;case "data":a._handles.add([h.init(a,"dataExtent",function(b){return a.updateSuspendResumeExtent(b)}),a.graphicsCore.watch("extentPadding",function(){return a.updateSuspendResumeExtent(a.dataExtent)})],k);break;default:u.neverReached(a.suspendResumeExtentMode)}}))};b.prototype.updateSuspendResumeExtent=function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};
b.prototype.extentToSuspendResumeRect=function(a,b){var c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!q.canProject(a,c))return;a=q.project(a,c)}return E.enlargeExtent(a,b,x.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};b.prototype.suspendResumeExtentChanged=function(a){this.frustumVisibility&&this.frustumVisibility.setExtent(a);this.scaleVisibility&&this.scaleVisibility.setExtent(a)};d.__decorate([c.property({aliasOf:"graphicsCore.layer"})],b.prototype,
"layer",void 0);d.__decorate([c.property({aliasOf:"graphicsCore.owner"})],b.prototype,"owner",void 0);d.__decorate([c.property({constructOnly:!0})],b.prototype,"updateClippingExtent",void 0);d.__decorate([c.property({constructOnly:!0})],b.prototype,"graphicsCore",void 0);d.__decorate([c.property({constructOnly:!0})],b.prototype,"scaleVisibility",void 0);d.__decorate([c.property({constructOnly:!0})],b.prototype,"filterVisibility",void 0);d.__decorate([c.property({constructOnly:!0})],b.prototype,"elevationAlignment",
void 0);d.__decorate([c.property({constructOnly:!0})],b.prototype,"frustumVisibility",void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"deconfliction",void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"labeling",void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"objectStates",void 0);d.__decorate([c.property({readOnly:!0})],b.prototype,"watchUpdatingTracking",void 0);d.__decorate([c.property()],b.prototype,"suspendResumeExtentMode",void 0);d.__decorate([c.property()],
b.prototype,"dataExtent",void 0);d.__decorate([c.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],b.prototype,"suspended",null);d.__decorate([c.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],b.prototype,"suspendInfo",null);d.__decorate([c.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],b.prototype,"updating",null);return b=d.__decorate([c.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],
b)}(t);l.default=e;var k="suspendResumeExtentMode",G={remove:function(){},pause:function(){},resume:function(){}}});