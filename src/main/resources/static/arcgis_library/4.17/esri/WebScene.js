// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../multiOriginJSONSupportUtils"],function(n,b,d){Object.defineProperty(b,"__esModule",{value:!0});b.updateOrigins=void 0;b.updateOrigins=function(b){b&&b.writtenProperties&&b.writtenProperties.forEach(function(b){var k=b.target;b.newOrigin&&b.oldOrigin!==b.newOrigin&&d.isMultiOriginJSONMixin(k)&&k.updateOrigin(b.propName,b.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports",
"../core/Error"],function(n,b,d){Object.defineProperty(b,"__esModule",{value:!0});b.isSchemaValidationError=b.createSchemaValidationError=b.isCopyError=b.createCopyError=void 0;b.createCopyError=function(){return new d("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};b.isCopyError=function(b){return b&&"webscene:failed-to-copy-embedded-resources"===b.name};b.createSchemaValidationError=function(b){return new d("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",
{errors:b})};b.isSchemaValidationError=function(b){return b&&"webscene:schema-validation"===b.name}})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/geodesicConstants ../webgl-engine/lib/BufferVectorMath".split(" "),
function(n,b,d,l,k,h,g,m,t,a,c,e){function f(a,c,e,f){if(2>a.length)return!1;2===a.length&&(I[0]=a[0],I[1]=a[1],I[2]=0,a=I);return r(a,c,0,e,f,0,1)}function r(a,c,e,f,b,r,d){void 0===d&&(d=1);c=y(c,b,ba);if(l.isNone(c))return!1;if(c===v){if(a===f&&e===r)return!0;for(c=e+3*d;e<c;e++,r++)f[r]=a[e];return!0}for(d=e+3*d;e<d;e+=3,r+=3)c(a,e,f,r);return!0}function w(a,c){if(c.spatialReference===a)return c.spatialReferenceId;c.spatialReference=a;"metersPerUnit"in c&&(c.metersPerUnit=k.getMetersPerUnitForSR(a,
1));return a.wkt===b.SphericalECEFSpatialReference.wkt?c.spatialReferenceId=1:a.isWGS84?c.spatialReferenceId=2:a.isWebMercator?c.spatialReferenceId=3:a.wkt===b.WGS84ECEFSpatialReference.wkt?c.spatialReferenceId=4:4490===a.wkid?c.spatialReferenceId=5:c.spatialReferenceId=0}function v(a,c,e,f){a!==e&&(e[f++]=a[c++],e[f++]=a[c++],e[f]=a[c])}function q(a,e,f,b){f[b++]=S*(a[e++]/c.earthRadius);f[b++]=S*(Math.PI/2-2*Math.atan(Math.exp(-1*a[e++]/c.earthRadius)));f[b]=a[e]}function C(a,c,e,f){q(a,c,e,f);
D(e,f,e,f)}function p(a,c,e,f){q(a,c,e,f);E(e,f,e,f)}function U(a,e,f,b){var r=.4999999*Math.PI,r=d.clamp(A*a[e+1],-r,r),r=Math.sin(r);f[b++]=A*a[e]*c.earthRadius;f[b++]=c.halfEarthRadius*Math.log((1+r)/(1-r));f[b]=a[e+2]}function D(a,e,f,b){var r=c.earthRadius+a[e+2],d=A*a[e+1];a=A*a[e];e=Math.cos(d);f[b++]=Math.cos(a)*e*r;f[b++]=Math.sin(a)*e*r;f[b]=Math.sin(d)*r}function N(a,f,b,r){var A=e.Vec3Compact.length(a,f),w=d.asinClamped(a[f+2]/(0===A?1:A));a=Math.atan2(a[f+1],a[f]);b[r++]=S*a;b[r++]=S*
w;b[r]=A-c.earthRadius}function H(a,c,e,f){N(a,c,e,f);U(e,f,e,f)}function G(a,c,e,f){N(a,c,e,f);E(e,f,e,f)}function E(a,e,f,b){var r=c.earthEllipsoidConstants,d=A*a[e],w=A*a[e+1];a=a[e+2];e=Math.sin(w);var w=Math.cos(w),S=r.a/Math.sqrt(1-r.e2*e*e);f[b++]=(S+a)*w*Math.cos(d);f[b++]=(S+a)*w*Math.sin(d);f[b++]=(S*(1-r.e2)+a)*e}function u(a,e,f,b){var r=c.earthEllipsoidConstants,d=a[e],A=a[e+1];a=a[e+2];var w,v,q,p,C,g;e=Math.abs(a);w=d*d+A*A;v=Math.sqrt(w);q=w+a*a;p=Math.sqrt(q);d=Math.atan2(A,d);C=
a*a/q;q=w/q;A=r.a2/p;w=r.a3-r.a4/p;.3<q?(C=e/p*(1+q*(r.a1+A+C*w)/p),p=Math.asin(C),A=C*C,q=Math.sqrt(1-A)):(q=v/p*(1-C*(r.a5-A-q*w)/p),p=Math.acos(q),A=1-q*q,C=Math.sqrt(A));g=1-r.e2*A;A=r.a/Math.sqrt(g);r=r.a6*A;A=v-A*q;w=e-r*C;e=q*A+C*w;v=q*w-C*A;r=v/(r/g+e);p+=r;0>a&&(p=-p);f[b++]=S*d;f[b++]=S*p;f[b]=e+v*r/2}function K(a,c,e,f){u(a,c,e,f);D(e,f,e,f)}function x(a,c,e,f){u(a,c,e,f);U(e,f,e,f)}function y(a,c,e){void 0===e&&(e=z());return B(a,c,e).projector}function B(a,c,e){if(e.source.spatialReference===
a&&e.dest.spatialReference===c)return e;var f=w(a,e.source),b=w(c,e.dest);0===f&&0===b?a.equals(c)?e.projector=v:e.projector=null:e.projector=T[f][b];return e}function z(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:v}}var J,L,Q,O,M,P,R,F;Object.defineProperty(b,"__esModule",{value:!0});b.getProjector=b.wgs84ComparableLonLatToECEF=b.vectorToWGS84ComparableLonLat=b.canProjectToWGS84ComparableLonLat=
b.webMercator=b.boundingRectToBoundingRect=b.mbsToMbs=b.transformDirection=b.computeLinearTransformation=b.localLinearScaleFactors=b.bufferToBuffer=b.xyzToVector=b.pathsToPaths=b.vectorToVector=b.getProjectorName=b.canProject=b.WGS84ECEFSpatialReference=b.SphericalECEFSpatialReference=void 0;b.SphericalECEFSpatialReference=new t({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",'+c.earthRadius+',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});
b.WGS84ECEFSpatialReference=new t({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});b.canProject=function(a,c){return!!y(a,c,ba)};b.getProjectorName=function(a,c){a=
y(a,c,ba);return a===v?"copy3":a===D?"wgs84ToSphericalECEF":a===U?"wgs84ToWebMercator":a===E?"wgs84ToWGS84ECEF":a===q?"webMercatorToWGS84":a===C?"webMercatorToSphericalECEF":a===p?"webMercatorToWGS84ECEF":a===u?"wgs84ECEFToWGS84":a===K?"wgs84ECEFToSphericalECEF":a===x?"wgs84ECEFToWebMercator":a===N?"sphericalECEFToWGS84":a===H?"sphericalECEFToWebMercator":a===G?"sphericalECEFToWGS84ECEF":null};b.vectorToVector=f;b.pathsToPaths=function(a,c,e,f,b,d,A){void 0===A&&(A=0);for(var w=[],S=0;S<a.length;S++)for(var q=
a[S],v=0,p=q;v<p.length;v++)q=p[v],w.push(q[0],q[1],c?q[2]:A);if(!r(w,f,0,w,d,0,w.length/3))return!1;f=0;for(d=b.length=0;d<a.length;d++){q=a[d];A=[];S=0;for(v=q;S<v.length;S++)q=v[S],c&&e?A.push([w[f++],w[f++],w[f++],q[3]]):c?A.push([w[f++],w[f++],w[f++]]):(e?A.push([w[f++],w[f++],q[2]]):A.push([w[f++],w[f++]]),f++);b.push(A)}return!0};b.xyzToVector=function(a,c,e,f,b,d){I[0]=a;I[1]=c;I[2]=e;return r(I,f,0,b,d,0,1)};b.bufferToBuffer=r;b.localLinearScaleFactors=function(a,e,f,b){var r=w(e,V),d=w(b,
Y);if(r===d&&0!==r||e.equals(b))return f[0]=1,f[1]=1,f[2]=1,!0;if(1===r){e=g.vec3.length(a);a=e/Math.sqrt(a[0]*a[0]+a[1]*a[1]);e/=c.earthRadius;if(3===d)return f[0]=a*e,f[1]=a*e,f[2]=1,!0;if(2===d||5===d)return d=180/(c.earthRadius*Math.PI),f[0]=d*a*e,f[1]=d*e,f[2]=1,!0}return!1};b.computeLinearTransformation=function(a,c,e,f){var b=w(a,V),r=w(f,Y);if(b===r&&1!==r&&(0!==b||a.equals(f)))return h.mat4.identity(e),h.mat4.translate(e,e,c),!0;if(1===r){a=T[b][6];r=T[6][r];if(l.isNone(a)||l.isNone(r))return!1;
a(c,0,W,0);r(W,0,X,0);a=A*W[0];r=A*W[1];c=Math.sin(a);a=Math.cos(a);f=Math.sin(r);r=Math.cos(r);e[0]=-c;e[4]=-f*a;e[8]=r*a;e[12]=X[0];e[1]=a;e[5]=-f*c;e[9]=r*c;e[13]=X[1];e[2]=0;e[6]=r;e[10]=f;e[14]=X[2];e[3]=0;e[7]=0;e[11]=0;e[15]=1;return!0}if(3===r&&(2===b||1===b)){a=T[b][6];if(l.isNone(a))return!1;a(c,0,W,0);c=A*W[1];U(W,0,X,0);h.mat4.identity(e);h.mat4.translate(e,e,X);c=1/Math.cos(c);h.mat4.scale(e,e,[c,c,1]);return!0}return!1};b.transformDirection=function(a,c,e,b,r){g.vec3.copy(Z,a);g.vec3.add(aa,
a,c);f(Z,e,Z,r);f(aa,e,aa,r);g.vec3.subtract(b,aa,Z);g.vec3.normalize(b,b)};b.mbsToMbs=function(a,e,f,b){e=B(e,b,ca);if(e.projector===v)return f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],!0;if(l.isNone(e.projector))return!1;b=e.source;var r=e.dest;if(3===r.spatialReferenceId){e=T[b.spatialReferenceId][2];if(l.isNone(e))return!1;e(a,0,W,0);e=Math.abs(A*W[1])+Math.asin(a[3]/(c.earthRadius+a[2]));U(W,0,f,0);f[3]=e>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(e)*a[3];return!0}e.projector(a,0,f,0);f[3]=a[3]*
b.metersPerUnit/r.metersPerUnit;return!0};b.boundingRectToBoundingRect=function(c,e,f,b){if(null==c)return!1;if(e.equals(b))return a.set(f,c),!0;I[0]=c[0];I[1]=c[1];I[2]=0;if(!r(I,e,0,I,b,0,1))return!1;f[0]=I[0];f[1]=I[1];I[0]=c[2];I[1]=c[3];I[2]=0;if(!r(I,e,0,I,b,0,1))return!1;f[2]=I[0];f[3]=I[1];return!0};(function(a){a.x2lon=function(a){return a/c.earthRadius};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/c.earthRadius))};a.lon2x=function(a){return a*c.earthRadius};a.lat2y=function(a){a=
Math.sin(a);return c.earthRadius/2*Math.log((1+a)/(1-a))}})(b.webMercator||(b.webMercator={}));b.canProjectToWGS84ComparableLonLat=function(a){a=w(a,V);return!!T[a][6]};b.vectorToWGS84ComparableLonLat=function(a,c,e){c=w(c,V);c=T[c][6];if(l.isNone(c))return!1;c(a,0,I,0);e!==I&&(e[0]=I[0],e[1]=I[1],2<e.length&&(e[2]=I[2]));return!0};b.wgs84ComparableLonLatToECEF=function(a,e,f,b){void 0===b&&(b=0);b=c.earthRadius+b;var r=Math.cos(f);a[0]=Math.cos(e)*r*b;a[1]=Math.sin(e)*r*b;a[2]=Math.sin(f)*b};var T=
(J={},J[2]=(L={},L[5]=null,L[6]=v,L[1]=D,L[0]=null,L[3]=U,L[2]=v,L[4]=E,L),J[5]=(Q={},Q[5]=v,Q[6]=v,Q[1]=D,Q[0]=null,Q[3]=null,Q[2]=null,Q[4]=E,Q),J[3]=(O={},O[5]=null,O[6]=q,O[1]=C,O[0]=null,O[3]=v,O[2]=q,O[4]=p,O),J[4]=(M={},M[5]=u,M[6]=u,M[1]=K,M[0]=null,M[3]=x,M[2]=u,M[4]=v,M),J[1]=(P={},P[5]=N,P[6]=N,P[1]=v,P[0]=null,P[3]=H,P[2]=N,P[4]=G,P),J[0]=(R={},R[5]=null,R[6]=null,R[1]=null,R[0]=v,R[3]=null,R[2]=null,R[4]=null,R),J[6]=(F={},F[5]=null,F[6]=v,F[1]=D,F[0]=null,F[3]=null,F[2]=v,F[4]=E,F),
J);b.getProjector=y;var V={spatialReference:null,spatialReferenceId:0},Y={spatialReference:null,spatialReferenceId:0},ba=z(),ca=z(),A=d.deg2rad(1),S=d.rad2deg(1),I=m.vec3f64.create(),W=m.vec3f64.create(),X=m.vec3f64.create(),Z=m.vec3f64.create(),aa=m.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require","exports","./math/mat4"],function(n,b,d){Object.defineProperty(b,"__esModule",{value:!0});b.mat4=void 0;b.mat4=d})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require",
"exports","../factories/vec3f64","./common"],function(n,b,d,l){function k(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function h(a,c,e){var f=c[0],b=c[1],d=c[2],v=c[3],q=c[4],C=c[5],p=c[6],g=c[7],k=c[8],h=c[9],l=c[10],m=c[11],t=c[12],u=c[13],n=c[14];c=c[15];var x=e[0],y=e[1],B=e[2],z=e[3];a[0]=x*f+y*q+B*k+z*t;a[1]=x*b+y*C+B*h+z*u;a[2]=x*d+y*p+B*l+z*n;a[3]=x*v+y*g+B*m+z*c;x=e[4];y=e[5];B=e[6];z=e[7];a[4]=x*f+y*q+
B*k+z*t;a[5]=x*b+y*C+B*h+z*u;a[6]=x*d+y*p+B*l+z*n;a[7]=x*v+y*g+B*m+z*c;x=e[8];y=e[9];B=e[10];z=e[11];a[8]=x*f+y*q+B*k+z*t;a[9]=x*b+y*C+B*h+z*u;a[10]=x*d+y*p+B*l+z*n;a[11]=x*v+y*g+B*m+z*c;x=e[12];y=e[13];B=e[14];z=e[15];a[12]=x*f+y*q+B*k+z*t;a[13]=x*b+y*C+B*h+z*u;a[14]=x*d+y*p+B*l+z*n;a[15]=x*v+y*g+B*m+z*c;return a}function g(a,c,e){var f=c[0],b=c[1],d=c[2],v=c[3],q=f+f,C=b+b,p=d+d;c=f*q;var g=f*C,f=f*p,k=b*C,b=b*p,d=d*p,q=v*q,C=v*C,v=v*p;a[0]=1-(k+d);a[1]=g+v;a[2]=f-C;a[3]=0;a[4]=g-v;a[5]=1-(c+d);
a[6]=b+q;a[7]=0;a[8]=f+C;a[9]=b-q;a[10]=1-(c+k);a[11]=0;a[12]=e[0];a[13]=e[1];a[14]=e[2];a[15]=1;return a}function m(a,c,e){a[0]=c[0]-e[0];a[1]=c[1]-e[1];a[2]=c[2]-e[2];a[3]=c[3]-e[3];a[4]=c[4]-e[4];a[5]=c[5]-e[5];a[6]=c[6]-e[6];a[7]=c[7]-e[7];a[8]=c[8]-e[8];a[9]=c[9]-e[9];a[10]=c[10]-e[10];a[11]=c[11]-e[11];a[12]=c[12]-e[12];a[13]=c[13]-e[13];a[14]=c[14]-e[14];a[15]=c[15]-e[15];return a}Object.defineProperty(b,"__esModule",{value:!0});b.sub=b.mul=b.equals=b.exactEquals=b.multiplyScalarAndAdd=b.multiplyScalar=
b.subtract=b.add=b.frob=b.str=b.targetTo=b.lookAt=b.ortho=b.perspectiveFromFieldOfView=b.perspective=b.frustum=b.fromQuat=b.fromRotationTranslationScaleOrigin=b.fromRotationTranslationScale=b.getRotation=b.getScaling=b.getTranslation=b.fromQuat2=b.fromRotationTranslation=b.fromZRotation=b.fromYRotation=b.fromXRotation=b.fromRotation=b.fromScaling=b.fromTranslation=b.rotateZ=b.rotateY=b.rotateX=b.rotate=b.scale=b.translate=b.multiply=b.determinant=b.adjoint=b.invert=b.transpose=b.identity=b.set=b.copy=
void 0;b.copy=function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];a[9]=c[9];a[10]=c[10];a[11]=c[11];a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a};b.set=function(a,c,e,f,b,d,v,q,C,p,g,k,h,l,m,t,u){a[0]=c;a[1]=e;a[2]=f;a[3]=b;a[4]=d;a[5]=v;a[6]=q;a[7]=C;a[8]=p;a[9]=g;a[10]=k;a[11]=h;a[12]=l;a[13]=m;a[14]=t;a[15]=u;return a};b.identity=k;b.transpose=function(a,c){if(a===c){var e=c[1],f=c[2],b=c[3],d=c[6],v=c[7],q=c[11];a[1]=c[4];a[2]=c[8];
a[3]=c[12];a[4]=e;a[6]=c[9];a[7]=c[13];a[8]=f;a[9]=d;a[11]=c[14];a[12]=b;a[13]=v;a[14]=q}else a[0]=c[0],a[1]=c[4],a[2]=c[8],a[3]=c[12],a[4]=c[1],a[5]=c[5],a[6]=c[9],a[7]=c[13],a[8]=c[2],a[9]=c[6],a[10]=c[10],a[11]=c[14],a[12]=c[3],a[13]=c[7],a[14]=c[11],a[15]=c[15];return a};b.invert=function(a,c){var e=c[0],f=c[1],b=c[2],d=c[3],v=c[4],q=c[5],C=c[6],p=c[7],g=c[8],k=c[9],h=c[10],l=c[11],m=c[12],t=c[13],u=c[14];c=c[15];var n=e*q-f*v,x=e*C-b*v,y=e*p-d*v,B=f*C-b*q,z=f*p-d*q,J=b*p-d*C,L=g*t-k*m,Q=g*u-
h*m,O=g*c-l*m,M=k*u-h*t,P=k*c-l*t,R=h*c-l*u,F=n*R-x*P+y*M+B*O-z*Q+J*L;if(!F)return null;F=1/F;a[0]=(q*R-C*P+p*M)*F;a[1]=(b*P-f*R-d*M)*F;a[2]=(t*J-u*z+c*B)*F;a[3]=(h*z-k*J-l*B)*F;a[4]=(C*O-v*R-p*Q)*F;a[5]=(e*R-b*O+d*Q)*F;a[6]=(u*y-m*J-c*x)*F;a[7]=(g*J-h*y+l*x)*F;a[8]=(v*P-q*O+p*L)*F;a[9]=(f*O-e*P-d*L)*F;a[10]=(m*z-t*y+c*n)*F;a[11]=(k*y-g*z-l*n)*F;a[12]=(q*Q-v*M-C*L)*F;a[13]=(e*M-f*Q+b*L)*F;a[14]=(t*x-m*B-u*n)*F;a[15]=(g*B-k*x+h*n)*F;return a};b.adjoint=function(a,c){var e=c[0],f=c[1],b=c[2],d=c[3],
v=c[4],q=c[5],g=c[6],p=c[7],k=c[8],h=c[9],l=c[10],m=c[11],t=c[12],n=c[13],u=c[14];c=c[15];a[0]=q*(l*c-m*u)-h*(g*c-p*u)+n*(g*m-p*l);a[1]=-(f*(l*c-m*u)-h*(b*c-d*u)+n*(b*m-d*l));a[2]=f*(g*c-p*u)-q*(b*c-d*u)+n*(b*p-d*g);a[3]=-(f*(g*m-p*l)-q*(b*m-d*l)+h*(b*p-d*g));a[4]=-(v*(l*c-m*u)-k*(g*c-p*u)+t*(g*m-p*l));a[5]=e*(l*c-m*u)-k*(b*c-d*u)+t*(b*m-d*l);a[6]=-(e*(g*c-p*u)-v*(b*c-d*u)+t*(b*p-d*g));a[7]=e*(g*m-p*l)-v*(b*m-d*l)+k*(b*p-d*g);a[8]=v*(h*c-m*n)-k*(q*c-p*n)+t*(q*m-p*h);a[9]=-(e*(h*c-m*n)-k*(f*c-d*n)+
t*(f*m-d*h));a[10]=e*(q*c-p*n)-v*(f*c-d*n)+t*(f*p-d*q);a[11]=-(e*(q*m-p*h)-v*(f*m-d*h)+k*(f*p-d*q));a[12]=-(v*(h*u-l*n)-k*(q*u-g*n)+t*(q*l-g*h));a[13]=e*(h*u-l*n)-k*(f*u-b*n)+t*(f*l-b*h);a[14]=-(e*(q*u-g*n)-v*(f*u-b*n)+t*(f*g-b*q));a[15]=e*(q*l-g*h)-v*(f*l-b*h)+k*(f*g-b*q);return a};b.determinant=function(a){var c=a[0],e=a[1],f=a[2],b=a[3],d=a[4],g=a[5],q=a[6],k=a[7],p=a[8],h=a[9],l=a[10],m=a[11],t=a[12],n=a[13],E=a[14];a=a[15];return(c*g-e*d)*(l*a-m*E)-(c*q-f*d)*(h*a-m*n)+(c*k-b*d)*(h*E-l*n)+(e*
q-f*g)*(p*a-m*t)-(e*k-b*g)*(p*E-l*t)+(f*k-b*q)*(p*n-h*t)};b.multiply=h;b.translate=function(a,c,e){var f=e[0],b=e[1];e=e[2];var d=void 0,g=void 0,q=void 0,k=void 0,p=void 0,h=void 0,l=void 0,m=void 0,t=void 0,n=void 0,E=void 0,u=void 0;c===a?(a[12]=c[0]*f+c[4]*b+c[8]*e+c[12],a[13]=c[1]*f+c[5]*b+c[9]*e+c[13],a[14]=c[2]*f+c[6]*b+c[10]*e+c[14],a[15]=c[3]*f+c[7]*b+c[11]*e+c[15]):(d=c[0],g=c[1],q=c[2],k=c[3],p=c[4],h=c[5],l=c[6],m=c[7],t=c[8],n=c[9],E=c[10],u=c[11],a[0]=d,a[1]=g,a[2]=q,a[3]=k,a[4]=p,a[5]=
h,a[6]=l,a[7]=m,a[8]=t,a[9]=n,a[10]=E,a[11]=u,a[12]=d*f+p*b+t*e+c[12],a[13]=g*f+h*b+n*e+c[13],a[14]=q*f+l*b+E*e+c[14],a[15]=k*f+m*b+u*e+c[15]);return a};b.scale=function(a,c,e){var f=e[0],b=e[1];e=e[2];a[0]=c[0]*f;a[1]=c[1]*f;a[2]=c[2]*f;a[3]=c[3]*f;a[4]=c[4]*b;a[5]=c[5]*b;a[6]=c[6]*b;a[7]=c[7]*b;a[8]=c[8]*e;a[9]=c[9]*e;a[10]=c[10]*e;a[11]=c[11]*e;a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a};b.rotate=function(a,c,e,f){var b=f[0],d=f[1];f=f[2];var g=Math.sqrt(b*b+d*d+f*f),q=void 0,k=void 0,
p=void 0,h=void 0,m=void 0,t=void 0,n=void 0,G=void 0,E=void 0,u=void 0,K=void 0,x=void 0,y=void 0,B=void 0,z=void 0,J=void 0,L=void 0,Q=void 0,O=void 0,M=void 0,P=void 0,R=void 0,k=q=void 0;if(g<l.EPSILON)return null;g=1/g;b*=g;d*=g;f*=g;q=Math.sin(e);k=Math.cos(e);p=1-k;h=c[0];m=c[1];t=c[2];n=c[3];G=c[4];E=c[5];u=c[6];K=c[7];x=c[8];y=c[9];B=c[10];z=c[11];J=b*b*p+k;L=d*b*p+f*q;Q=f*b*p-d*q;O=b*d*p-f*q;M=d*d*p+k;P=f*d*p+b*q;R=b*f*p+d*q;q=d*f*p-b*q;k=f*f*p+k;a[0]=h*J+G*L+x*Q;a[1]=m*J+E*L+y*Q;a[2]=t*
J+u*L+B*Q;a[3]=n*J+K*L+z*Q;a[4]=h*O+G*M+x*P;a[5]=m*O+E*M+y*P;a[6]=t*O+u*M+B*P;a[7]=n*O+K*M+z*P;a[8]=h*R+G*q+x*k;a[9]=m*R+E*q+y*k;a[10]=t*R+u*q+B*k;a[11]=n*R+K*q+z*k;c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);return a};b.rotateX=function(a,c,e){var f=Math.sin(e);e=Math.cos(e);var b=c[4],d=c[5],g=c[6],q=c[7],k=c[8],p=c[9],h=c[10],m=c[11];c!==a&&(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[4]=b*e+k*f;a[5]=d*e+p*f;a[6]=g*e+h*f;a[7]=q*e+m*f;
a[8]=k*e-b*f;a[9]=p*e-d*f;a[10]=h*e-g*f;a[11]=m*e-q*f;return a};b.rotateY=function(a,c,e){var f=Math.sin(e);e=Math.cos(e);var b=c[0],d=c[1],g=c[2],q=c[3],k=c[8],h=c[9],m=c[10],l=c[11];c!==a&&(a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[0]=b*e-k*f;a[1]=d*e-h*f;a[2]=g*e-m*f;a[3]=q*e-l*f;a[8]=b*f+k*e;a[9]=d*f+h*e;a[10]=g*f+m*e;a[11]=q*f+l*e;return a};b.rotateZ=function(a,c,e){var f=Math.sin(e);e=Math.cos(e);var b=c[0],d=c[1],g=c[2],k=c[3],h=c[4],p=c[5],
m=c[6],l=c[7];c!==a&&(a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[0]=b*e+h*f;a[1]=d*e+p*f;a[2]=g*e+m*f;a[3]=k*e+l*f;a[4]=h*e-b*f;a[5]=p*e-d*f;a[6]=m*e-g*f;a[7]=l*e-k*f;return a};b.fromTranslation=function(a,c){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};b.fromScaling=function(a,c){a[0]=c[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;
a[10]=c[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotation=function(a,c,e){var f=e[0],b=e[1];e=e[2];var d=Math.sqrt(f*f+b*b+e*e),g=void 0,k=void 0,h=void 0;if(d<l.EPSILON)return null;d=1/d;f*=d;b*=d;e*=d;g=Math.sin(c);k=Math.cos(c);h=1-k;a[0]=f*f*h+k;a[1]=b*f*h+e*g;a[2]=e*f*h-b*g;a[3]=0;a[4]=f*b*h-e*g;a[5]=b*b*h+k;a[6]=e*b*h+f*g;a[7]=0;a[8]=f*e*h+b*g;a[9]=b*e*h-f*g;a[10]=e*e*h+k;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromXRotation=function(a,c){var e=Math.sin(c);c=Math.cos(c);
a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=e;a[7]=0;a[8]=0;a[9]=-e;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromYRotation=function(a,c){var e=Math.sin(c);c=Math.cos(c);a[0]=c;a[1]=0;a[2]=-e;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=e;a[9]=0;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromZRotation=function(a,c){var e=Math.sin(c);c=Math.cos(c);a[0]=c;a[1]=e;a[2]=0;a[3]=0;a[4]=-e;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;
return a};b.fromRotationTranslation=g;b.fromQuat2=function(a,c){var e=t,f=-c[0],b=-c[1],d=-c[2],k=c[3],h=c[4],m=c[5],p=c[6],l=c[7],n=f*f+b*b+d*d+k*k;0<n?(e[0]=2*(h*k+l*f+m*d-p*b)/n,e[1]=2*(m*k+l*b+p*f-h*d)/n,e[2]=2*(p*k+l*d+h*b-m*f)/n):(e[0]=2*(h*k+l*f+m*d-p*b),e[1]=2*(m*k+l*b+p*f-h*d),e[2]=2*(p*k+l*d+h*b-m*f));g(a,c,e);return a};var t=d.create();b.getTranslation=function(a,c){a[0]=c[12];a[1]=c[13];a[2]=c[14];return a};b.getScaling=function(a,c){var e=c[0],f=c[1],b=c[2],d=c[4],g=c[5],k=c[6],h=c[8],
m=c[9];c=c[10];a[0]=Math.sqrt(e*e+f*f+b*b);a[1]=Math.sqrt(d*d+g*g+k*k);a[2]=Math.sqrt(h*h+m*m+c*c);return a};b.getRotation=function(a,c){var e=c[0]+c[5]+c[10],f=0;0<e?(f=2*Math.sqrt(e+1),a[3]=.25*f,a[0]=(c[6]-c[9])/f,a[1]=(c[8]-c[2])/f,a[2]=(c[1]-c[4])/f):c[0]>c[5]&&c[0]>c[10]?(f=2*Math.sqrt(1+c[0]-c[5]-c[10]),a[3]=(c[6]-c[9])/f,a[0]=.25*f,a[1]=(c[1]+c[4])/f,a[2]=(c[8]+c[2])/f):c[5]>c[10]?(f=2*Math.sqrt(1+c[5]-c[0]-c[10]),a[3]=(c[8]-c[2])/f,a[0]=(c[1]+c[4])/f,a[1]=.25*f,a[2]=(c[6]+c[9])/f):(f=2*Math.sqrt(1+
c[10]-c[0]-c[5]),a[3]=(c[1]-c[4])/f,a[0]=(c[8]+c[2])/f,a[1]=(c[6]+c[9])/f,a[2]=.25*f);return a};b.fromRotationTranslationScale=function(a,c,e,f){var b=c[0],d=c[1],g=c[2],k=c[3],h=b+b,m=d+d,l=g+g;c=b*h;var t=b*m,b=b*l,n=d*m,d=d*l,g=g*l,h=k*h,m=k*m,k=k*l,l=f[0],H=f[1];f=f[2];a[0]=(1-(n+g))*l;a[1]=(t+k)*l;a[2]=(b-m)*l;a[3]=0;a[4]=(t-k)*H;a[5]=(1-(c+g))*H;a[6]=(d+h)*H;a[7]=0;a[8]=(b+m)*f;a[9]=(d-h)*f;a[10]=(1-(c+n))*f;a[11]=0;a[12]=e[0];a[13]=e[1];a[14]=e[2];a[15]=1;return a};b.fromRotationTranslationScaleOrigin=
function(a,c,e,f,b){var d=c[0],g=c[1],k=c[2],r=c[3],h=d+d,m=g+g,l=k+k;c=d*h;var t=d*m,n=d*l,d=g*m,g=g*l,G=k*l,k=r*h,m=r*m,E=r*l,u=f[0],K=f[1],l=f[2];f=b[0];r=b[1];b=b[2];var h=(1-(d+G))*u,x=(t+E)*u,u=(n-m)*u,t=(t-E)*K,G=(1-(c+G))*K,K=(g+k)*K,n=(n+m)*l,g=(g-k)*l;c=(1-(c+d))*l;a[0]=h;a[1]=x;a[2]=u;a[3]=0;a[4]=t;a[5]=G;a[6]=K;a[7]=0;a[8]=n;a[9]=g;a[10]=c;a[11]=0;a[12]=e[0]+f-(h*f+t*r+n*b);a[13]=e[1]+r-(x*f+G*r+g*b);a[14]=e[2]+b-(u*f+K*r+c*b);a[15]=1;return a};b.fromQuat=function(a,c){var e=c[0],f=c[1],
b=c[2];c=c[3];var d=e+e,g=f+f,k=b+b,e=e*d,h=f*d,f=f*g,m=b*d,l=b*g,b=b*k,d=c*d,g=c*g;c*=k;a[0]=1-f-b;a[1]=h+c;a[2]=m-g;a[3]=0;a[4]=h-c;a[5]=1-e-b;a[6]=l+d;a[7]=0;a[8]=m+g;a[9]=l-d;a[10]=1-e-f;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.frustum=function(a,c,e,f,b,d,g){var k=1/(e-c),h=1/(b-f),r=1/(d-g);a[0]=2*d*k;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*d*h;a[6]=0;a[7]=0;a[8]=(e+c)*k;a[9]=(b+f)*h;a[10]=(g+d)*r;a[11]=-1;a[12]=0;a[13]=0;a[14]=g*d*2*r;a[15]=0;return a};b.perspective=function(a,c,e,f,
b){c=1/Math.tan(c/2);var d=void 0;a[0]=c/e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=b&&Infinity!==b?(d=1/(f-b),a[10]=(b+f)*d,a[14]=2*b*f*d):(a[10]=-1,a[14]=-2*f);return a};b.perspectiveFromFieldOfView=function(a,c,e,b){var f=Math.tan(c.upDegrees*Math.PI/180),d=Math.tan(c.downDegrees*Math.PI/180),g=Math.tan(c.leftDegrees*Math.PI/180);c=Math.tan(c.rightDegrees*Math.PI/180);var k=2/(g+c),h=2/(f+d);a[0]=k;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=h;
a[6]=0;a[7]=0;a[8]=-((g-c)*k*.5);a[9]=(f-d)*h*.5;a[10]=b/(e-b);a[11]=-1;a[12]=0;a[13]=0;a[14]=b*e/(e-b);a[15]=0;return a};b.ortho=function(a,c,e,b,d,g,k){var f=1/(c-e),h=1/(b-d),m=1/(g-k);a[0]=-2*f;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*h;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*m;a[11]=0;a[12]=(c+e)*f;a[13]=(d+b)*h;a[14]=(k+g)*m;a[15]=1;return a};b.lookAt=function(a,c,e,b){var f=void 0,d=void 0,g=void 0,h=void 0,m=void 0,t=void 0,n=void 0,D=void 0,N=void 0,H=void 0,G=c[0],E=c[1];c=c[2];g=b[0];h=b[1];b=b[2];
n=e[0];D=e[1];e=e[2];if(Math.abs(G-n)<l.EPSILON&&Math.abs(E-D)<l.EPSILON&&Math.abs(c-e)<l.EPSILON)return k(a);n=G-n;D=E-D;N=c-e;H=1/Math.sqrt(n*n+D*D+N*N);n*=H;D*=H;N*=H;f=h*N-b*D;d=b*n-g*N;g=g*D-h*n;(H=Math.sqrt(f*f+d*d+g*g))?(H=1/H,f*=H,d*=H,g*=H):g=d=f=0;h=D*g-N*d;m=N*f-n*g;t=n*d-D*f;(H=Math.sqrt(h*h+m*m+t*t))?(H=1/H,h*=H,m*=H,t*=H):t=m=h=0;a[0]=f;a[1]=h;a[2]=n;a[3]=0;a[4]=d;a[5]=m;a[6]=D;a[7]=0;a[8]=g;a[9]=t;a[10]=N;a[11]=0;a[12]=-(f*G+d*E+g*c);a[13]=-(h*G+m*E+t*c);a[14]=-(n*G+D*E+N*c);a[15]=
1;return a};b.targetTo=function(a,c,e,b){var f=c[0],d=c[1];c=c[2];var g=b[0],h=b[1],k=b[2];b=f-e[0];var m=d-e[1];e=c-e[2];var l=b*b+m*m+e*e;0<l&&(l=1/Math.sqrt(l),b*=l,m*=l,e*=l);var t=h*e-k*m,k=k*b-g*e,g=g*m-h*b,l=t*t+k*k+g*g;0<l&&(l=1/Math.sqrt(l),t*=l,k*=l,g*=l);a[0]=t;a[1]=k;a[2]=g;a[3]=0;a[4]=m*g-e*k;a[5]=e*t-b*g;a[6]=b*k-m*t;a[7]=0;a[8]=b;a[9]=m;a[10]=e;a[11]=0;a[12]=f;a[13]=d;a[14]=c;a[15]=1;return a};b.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+
a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};b.add=function(a,c,e){a[0]=c[0]+e[0];a[1]=c[1]+e[1];a[2]=c[2]+e[2];a[3]=c[3]+e[3];
a[4]=c[4]+e[4];a[5]=c[5]+e[5];a[6]=c[6]+e[6];a[7]=c[7]+e[7];a[8]=c[8]+e[8];a[9]=c[9]+e[9];a[10]=c[10]+e[10];a[11]=c[11]+e[11];a[12]=c[12]+e[12];a[13]=c[13]+e[13];a[14]=c[14]+e[14];a[15]=c[15]+e[15];return a};b.subtract=m;b.multiplyScalar=function(a,c,e){a[0]=c[0]*e;a[1]=c[1]*e;a[2]=c[2]*e;a[3]=c[3]*e;a[4]=c[4]*e;a[5]=c[5]*e;a[6]=c[6]*e;a[7]=c[7]*e;a[8]=c[8]*e;a[9]=c[9]*e;a[10]=c[10]*e;a[11]=c[11]*e;a[12]=c[12]*e;a[13]=c[13]*e;a[14]=c[14]*e;a[15]=c[15]*e;return a};b.multiplyScalarAndAdd=function(a,
c,e,b){a[0]=c[0]+e[0]*b;a[1]=c[1]+e[1]*b;a[2]=c[2]+e[2]*b;a[3]=c[3]+e[3]*b;a[4]=c[4]+e[4]*b;a[5]=c[5]+e[5]*b;a[6]=c[6]+e[6]*b;a[7]=c[7]+e[7]*b;a[8]=c[8]+e[8]*b;a[9]=c[9]+e[9]*b;a[10]=c[10]+e[10]*b;a[11]=c[11]+e[11]*b;a[12]=c[12]+e[12]*b;a[13]=c[13]+e[13]*b;a[14]=c[14]+e[14]*b;a[15]=c[15]+e[15]*b;return a};b.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]&&a[9]===c[9]&&a[10]===c[10]&&a[11]===c[11]&&
a[12]===c[12]&&a[13]===c[13]&&a[14]===c[14]&&a[15]===c[15]};b.equals=function(a,c){var e=a[0],b=a[1],d=a[2],g=a[3],k=a[4],h=a[5],m=a[6],t=a[7],n=a[8],D=a[9],N=a[10],H=a[11],G=a[12],E=a[13],u=a[14];a=a[15];var K=c[0],x=c[1],y=c[2],B=c[3],z=c[4],J=c[5],L=c[6],Q=c[7],O=c[8],M=c[9],P=c[10],R=c[11],F=c[12],T=c[13],V=c[14];c=c[15];return Math.abs(e-K)<=l.EPSILON*Math.max(1,Math.abs(e),Math.abs(K))&&Math.abs(b-x)<=l.EPSILON*Math.max(1,Math.abs(b),Math.abs(x))&&Math.abs(d-y)<=l.EPSILON*Math.max(1,Math.abs(d),
Math.abs(y))&&Math.abs(g-B)<=l.EPSILON*Math.max(1,Math.abs(g),Math.abs(B))&&Math.abs(k-z)<=l.EPSILON*Math.max(1,Math.abs(k),Math.abs(z))&&Math.abs(h-J)<=l.EPSILON*Math.max(1,Math.abs(h),Math.abs(J))&&Math.abs(m-L)<=l.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(t-Q)<=l.EPSILON*Math.max(1,Math.abs(t),Math.abs(Q))&&Math.abs(n-O)<=l.EPSILON*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(D-M)<=l.EPSILON*Math.max(1,Math.abs(D),Math.abs(M))&&Math.abs(N-P)<=l.EPSILON*Math.max(1,Math.abs(N),Math.abs(P))&&
Math.abs(H-R)<=l.EPSILON*Math.max(1,Math.abs(H),Math.abs(R))&&Math.abs(G-F)<=l.EPSILON*Math.max(1,Math.abs(G),Math.abs(F))&&Math.abs(E-T)<=l.EPSILON*Math.max(1,Math.abs(E),Math.abs(T))&&Math.abs(u-V)<=l.EPSILON*Math.max(1,Math.abs(u),Math.abs(V))&&Math.abs(a-c)<=l.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};b.mul=h;b.sub=m})},"esri/geometry/support/aaBoundingRect":function(){define(["require","exports","../../core/compilerUtils","../Extent"],function(n,b,d,l){function k(a){void 0===a&&(a=b.ZERO);
return[a[0],a[1],a[2],a[3]]}function h(a){return a[0]>=a[2]?0:a[2]-a[0]}function g(a){return a[1]>=a[3]?0:a[3]-a[1]}function m(a,c,b){return c>=a[0]&&b>=a[1]&&c<=a[2]&&b<=a[3]}function t(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];return a}function a(a){return 4===a.length}function c(a,c,b){return a<c?c:a>b?b:a}Object.defineProperty(b,"__esModule",{value:!0});b.UNIT=b.ZERO=b.NEGATIVE_INFINITY=b.POSITIVE_INFINITY=b.equals=b.isPoint=b.is=b.empty=b.set=b.setMax=b.setMin=b.pad=b.offset=b.size=b.distance=
b.intersection=b.contains=b.intersects=b.containsPointWithMargin=b.containsXY=b.containsPointObject=b.containsPoint=b.center=b.area=b.diameter=b.height=b.width=b.allFinite=b.expandWithNestedArray=b.expand=b.expandPointInPlace=b.toExtent=b.fromExtent=b.fromValues=b.clone=b.create=void 0;b.create=k;b.clone=function(a){return[a[0],a[1],a[2],a[3]]};b.fromValues=function(a,c,b,d,g){void 0===g&&(g=k());g[0]=a;g[1]=c;g[2]=b;g[3]=d;return g};b.fromExtent=function(a,c){void 0===c&&(c=k());c[0]=a.xmin;c[1]=
a.ymin;c[2]=a.xmax;c[3]=a.ymax;return c};b.toExtent=function(a,c){return new l({xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:c})};b.expandPointInPlace=function(a,c){c[0]<a[0]&&(a[0]=c[0]);c[0]>a[2]&&(a[2]=c[0]);c[1]<a[1]&&(a[1]=c[1]);c[1]>a[3]&&(a[3]=c[1])};b.expand=function(c,b,g){void 0===g&&(g=c);if("length"in b)if(a(b))g[0]=Math.min(c[0],b[0]),g[1]=Math.min(c[1],b[1]),g[2]=Math.max(c[2],b[2]),g[3]=Math.max(c[3],b[3]);else{if(2===b.length||3===b.length)g[0]=Math.min(c[0],b[0]),g[1]=
Math.min(c[1],b[1]),g[2]=Math.max(c[2],b[0]),g[3]=Math.max(c[3],b[1])}else switch(b.type){case "extent":g[0]=Math.min(c[0],b.xmin);g[1]=Math.min(c[1],b.ymin);g[2]=Math.max(c[2],b.xmax);g[3]=Math.max(c[3],b.ymax);break;case "point":g[0]=Math.min(c[0],b.x);g[1]=Math.min(c[1],b.y);g[2]=Math.max(c[2],b.x);g[3]=Math.max(c[3],b.y);break;default:d.neverReached(b)}return g};b.expandWithNestedArray=function(a,c,b){void 0===b&&(b=a);var e=c.length,d=a[0],f=a[1],g=a[2];a=a[3];for(var k=0;k<e;k++){var h=c[k],
d=Math.min(d,h[0]),f=Math.min(f,h[1]),g=Math.max(g,h[0]);a=Math.max(a,h[1])}b[0]=d;b[1]=f;b[2]=g;b[3]=a;return b};b.allFinite=function(a){for(var c=0;4>c;c++)if(!isFinite(a[c]))return!1;return!0};b.width=h;b.height=g;b.diameter=function(a){var c=h(a);a=g(a);return Math.sqrt(c*c+a*a)};b.area=function(a){return h(a)*g(a)};b.center=function(a,c){void 0===c&&(c=[0,0]);c[0]=(a[0]+a[2])/2;c[1]=(a[1]+a[3])/2;return c};b.containsPoint=function(a,c){return m(a,c[0],c[1])};b.containsPointObject=function(a,
c){return m(a,c.x,c.y)};b.containsXY=m;b.containsPointWithMargin=function(a,c,b){return c[0]>=a[0]-b&&c[1]>=a[1]-b&&c[0]<=a[2]+b&&c[1]<=a[3]+b};b.intersects=function(a,c){return Math.max(c[0],a[0])<=Math.min(c[2],a[2])&&Math.max(c[1],a[1])<=Math.min(c[3],a[3])};b.contains=function(a,c){return c[0]>=a[0]&&c[2]<=a[2]&&c[1]>=a[1]&&c[3]<=a[3]};b.intersection=function(a,b,d){void 0===d&&(d=a);var e=b[0],f=b[1],g=b[2];b=b[3];d[0]=c(a[0],e,g);d[1]=c(a[1],f,b);d[2]=c(a[2],e,g);d[3]=c(a[3],f,b);return d};
b.distance=function(a,c){var b=(a[1]+a[3])/2,e=Math.max(Math.abs(c[0]-(a[0]+a[2])/2)-h(a)/2,0);a=Math.max(Math.abs(c[1]-b)-g(a)/2,0);return Math.sqrt(e*e+a*a)};b.size=function(a,c){c[0]=a[2]-a[0];c[1]=a[3]-a[1]};b.offset=function(a,c,b,d){void 0===d&&(d=a);d[0]=a[0]+c;d[1]=a[1]+b;d[2]=a[2]+c;d[3]=a[3]+b;return d};b.pad=function(a,c,b){void 0===b&&(b=a);b[0]=a[0]-c;b[1]=a[1]-c;b[2]=a[2]+c;b[3]=a[3]+c;return b};b.setMin=function(a,c,b){void 0===b&&(b=a);b[0]=c[0];b[1]=c[1];b!==a&&(b[2]=a[2],b[3]=a[3]);
return b};b.setMax=function(a,c,b){void 0===b&&(b=a);b[2]=c[0];b[3]=c[1];b!==a&&(b[0]=a[0],b[1]=a[1]);return a};b.set=t;b.empty=function(a){return a?t(a,b.NEGATIVE_INFINITY):k(b.NEGATIVE_INFINITY)};b.is=a;b.isPoint=function(a){return(0===h(a)||!isFinite(a[0]))&&(0===g(a)||!isFinite(a[1]))};b.equals=function(c,b,d){if(null==c||null==b)return c===b;if(!a(c)||!a(b))return!1;if(d)for(var e=0;e<c.length;e++){if(!d(c[e],b[e]))return!1}else for(e=0;e<c.length;e++)if(c[e]!==b[e])return!1;return!0};b.POSITIVE_INFINITY=
[-Infinity,-Infinity,Infinity,Infinity];b.NEGATIVE_INFINITY=[Infinity,Infinity,-Infinity,-Infinity];b.ZERO=[0,0,0,0];b.UNIT=[0,0,1,1]})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.Vec3Compact=void 0;(function(b){b.length=function(b,d){var k=b[d],g=b[d+1];b=b[d+2];return Math.sqrt(k*k+g*g+b*b)};b.normalize=function(b,d){var h=b[d],g=b[d+1],k=b[d+2],h=1/Math.sqrt(h*h+g*g+k*k);b[d]*=h;b[d+
1]*=h;b[d+2]*=h};b.scale=function(b,d,h){b[d]*=h;b[d+1]*=h;b[d+2]*=h};b.add=function(b,d,h,g,m,t){void 0===t&&(t=d);m=m||b;m[t]=b[d]+h[g];m[t+1]=b[d+1]+h[g+1];m[t+2]=b[d+2]+h[g+2]};b.subtract=function(b,d,h,g,m,t){void 0===t&&(t=d);m=m||b;m[t]=b[d]-h[g];m[t+1]=b[d+1]-h[g+1];m[t+2]=b[d+2]-h[g+2]}})(b.Vec3Compact||(b.Vec3Compact={}))})},"esri/views/support/spatialReferenceSupport":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.isSpatialReferenceSupported=
void 0;b.isSpatialReferenceSupported=function(b,l){return null==b?!1:"2d"===l?!0:"local"===l?!b.isGeographic:b.isWebMercator||b.isWGS84||4490===b.wkid}})},"esri/webdoc/support/saveUtils":function(){define("require exports tslib ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/SetUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),function(n,b,d,l,k,h,g,m,t){function a(a,c){return d.__awaiter(this,void 0,void 0,function(){var b;return d.__generator(this,function(e){switch(e.label){case 0:return[4,
l.result(a.resource.portalItem.addResource(a.resource,a.content,c))];case 1:b=e.sent();if(!0===b.ok)a.finish&&a.finish(a.resource);else throw a.error&&a.error(b.error),b.error;return[2]}})})}function c(a,c){return d.__awaiter(this,void 0,void 0,function(){var b;return d.__generator(this,function(e){switch(e.label){case 0:return[4,l.result(a.resource.update(a.content,c))];case 1:b=e.sent();if(!0===b.ok)a.finish(a.resource);else throw a.error(b.error),b.error;return[2]}})})}Object.defineProperty(b,
"__esModule",{value:!0});b.saveResources=void 0;b.saveResources=function(b,f,l){return d.__awaiter(this,void 0,void 0,function(){var e,n,q,r,p,U,D,N,H,G,E,u,K,x,y,B,z;return d.__generator(this,function(d){switch(d.label){case 0:if(!f||!f.resources)return[2];e=f.portalItem===b.portalItem?g.SetFromValues(b.paths):new Set;b.paths.length=0;b.portalItem=f.portalItem;n=g.SetFromValues(f.resources.toKeep.map(function(a){return a.resource.path}));q=new Set;r=[];n.forEach(function(a){e.delete(a);b.paths.push(a)});
p=0;for(U=f.resources.toUpdate;p<U.length;p++)D=U[p],e.delete(D.resource.path),n.has(D.resource.path)||q.has(D.resource.path)?(N=D.resource,H=D.content,G=D.finish,E=D.error,u=t.getSiblingOfSameTypeI(N,m.generateUUID()),b.paths.push(u.path),r.push(a({resource:u,content:H,finish:G,error:E},l))):(b.paths.push(D.resource.path),r.push(c(D,l)),q.add(D.resource.path));K=0;for(x=f.resources.toAdd;K<x.length;K++)y=x[K],r.push(a(y,l)),b.paths.push(y.resource.path);e.forEach(function(a){a=f.portalItem.resourceFromPath(a);
r.push(a.portalItem.removeResource(a).catch(function(){}))});return 0===r.length?[2]:[4,h.eachAlways(r)];case 1:B=d.sent();h.throwIfAborted(l);z=B.filter(function(a){return"error"in a}).map(function(a){return a.error});if(0<z.length)throw new k("save:resources","Failed to save one or more resources",{errors:z});return[2]}})})}})},"esri/webdoc/support/thumbnailUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.getOptimalThumbnailSize=void 0;
var d={width:600,height:400};b.getOptimalThumbnailSize=function(b,k){k=k||d;var h=k.width;k=k.height;var g=h/k;1.5>g?k=h/1.5:1.5<g&&(h=1.5*k);h>b.width&&(k*=b.width/h,h=b.width);k>b.height&&(h*=b.height/k,k=b.height);return{width:Math.round(h),height:Math.round(k)}}})},"esri/webscene/ApplicationProperties":function(){define("require exports tslib ../core/JSONSupport ../core/accessorSupport/decorators ../webdoc/applicationProperties/Viewing".split(" "),function(n,b,d,l,k,h){return function(b){function g(a){a=
b.call(this,a)||this;a.viewing=null;return a}d.__extends(g,b);l=g;g.prototype.clone=function(){return new l({viewing:this.viewing?this.viewing.clone():null})};var l;d.__decorate([k.property({type:h,json:{write:!0}})],g.prototype,"viewing",void 0);return g=l=d.__decorate([k.subclass("esri.webscene.ApplicationProperties")],g)}(l.JSONSupport)})},"esri/webdoc/applicationProperties/Viewing":function(){define("require exports tslib ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./Search".split(" "),
function(n,b,d,l,k,h,g){return function(b){function m(a){a=b.call(this,a)||this;a.search=null;return a}d.__extends(m,b);a=m;m.prototype.clone=function(){return new a(k.clone({search:this.search}))};var a;d.__decorate([h.property({type:g,json:{write:!0}})],m.prototype,"search",void 0);return m=a=d.__decorate([h.subclass("esri.webdoc.applicationProperties.Viewing")],m)}(l.JSONSupport)})},"esri/webdoc/applicationProperties/Search":function(){define("require exports tslib ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(n,b,d,l,k,h,g,m){var t=l.ofType(m);return function(a){function c(c){c=a.call(this,c)||this;c.addressSearchEnabled=!0;c.enabled=!0;c.hintText=null;c.layers=new t;return c}d.__extends(c,a);b=c;c.prototype.readAddressSearchEnabled=function(a){return!a};c.prototype.writeAddressSearchEnabled=function(a,c,b){c[b]=!a};c.prototype.clone=function(){return new b(h.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers}))};var b;d.__decorate([g.property({type:Boolean,
json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder"},default:!0,origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"addressSearchEnabled",void 0);d.__decorate([g.reader("addressSearchEnabled")],c.prototype,"readAddressSearchEnabled",null);d.__decorate([g.writer("addressSearchEnabled")],c.prototype,"writeAddressSearchEnabled",null);d.__decorate([g.property({type:Boolean,json:{write:!0,default:!0}})],c.prototype,"enabled",void 0);d.__decorate([g.property({type:String,json:{write:!0}})],
c.prototype,"hintText",void 0);d.__decorate([g.property({type:t,json:{write:{enabled:!0,isRequired:!0}}})],c.prototype,"layers",void 0);return c=b=d.__decorate([g.subclass("esri.webdoc.applicationProperties.Search")],c)}(k.JSONSupport)})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("require exports tslib ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),function(n,b,d,l,k,h,g,m){return function(b){function a(a){a=
b.call(this,a)||this;a.field=null;a.id=null;a.subLayer=null;return a}d.__extends(a,b);c=a;a.prototype.clone=function(){return new c(k.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};var c;d.__decorate([h.property({type:m,json:{write:{enabled:!0,isRequired:!0}}})],a.prototype,"field",void 0);d.__decorate([h.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],a.prototype,"id",void 0);d.__decorate([h.property({type:g.Integer,json:{write:!0}})],a.prototype,"subLayer",void 0);
return a=c=d.__decorate([h.subclass("esri.webdoc.applicationProperties.SearchLayer")],a)}(l.JSONSupport)})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("require exports tslib ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(n,b,d,l,k,h){return function(b){function g(a){a=b.call(this,a)||this;a.exactMatch=!1;a.name=null;a.type=null;return a}d.__extends(g,b);l=g;g.prototype.clone=function(){return new l({exactMatch:this.exactMatch,
type:this.type,name:this.name})};var l;d.__decorate([k.property({type:Boolean,json:{write:!0}})],g.prototype,"exactMatch",void 0);d.__decorate([k.property({type:String,json:{write:!0}})],g.prototype,"name",void 0);d.__decorate([k.enumeration(h.kebabDict)],g.prototype,"type",void 0);return g=l=d.__decorate([k.subclass("esri.webdoc.applicationProperties.SearchLayerField")],g)}(l.JSONSupport)})},"esri/webscene/Environment":function(){define("require exports tslib ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(n,b,d,l,k,h,g,m){var t=function(a,c,b){return{enabled:!b||!b.isPresentation}};return function(a){function c(c){c=a.call(this,c)||this;c.lighting=new g;c.background=null;c.atmosphereEnabled=!0;c.starsEnabled=!0;return c}d.__extends(c,a);b=c;c.prototype.clone=function(){return new b(this.cloneConstructProperties())};c.prototype.cloneConstructProperties=function(){return{lighting:g.prototype.clone.call(this.lighting),background:k.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,
starsEnabled:this.starsEnabled}};var b;d.__decorate([h.property({type:g,json:{write:!0}})],c.prototype,"lighting",void 0);d.__decorate([h.property(m.backgroundProperty)],c.prototype,"background",void 0);d.__decorate([h.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:t}}})],c.prototype,"atmosphereEnabled",void 0);d.__decorate([h.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:t}}})],c.prototype,"starsEnabled",void 0);return c=b=d.__decorate([h.subclass("esri.webscene.Environment")],
c)}(l.JSONSupport)})},"esri/webscene/Lighting":function(){define(["require","exports","tslib","../core/JSONSupport","../core/accessorSupport/decorators"],function(n,b,d,l,k){return function(b){function g(d){d=b.call(this,d)||this;d.date=null;d.directShadowsEnabled=!1;d.displayUTCOffset=null;return d}d.__extends(g,b);h=g;g.prototype.readDate=function(b,a){return null!=a.datetime&&new Date(a.datetime)||null};g.prototype.writeDate=function(b,a,c){a[c]=b.getTime()};g.prototype.readDirectShadowsEnabled=
function(b,a){return!!a.directShadows};g.prototype.writedirectShadowsEnabled=function(b,a,c){b&&(a[c]=b)};g.prototype.writeDisplayUTCOffset=function(b,a){null!=b&&(a.displayUTCOffset=b)};g.prototype.clone=function(){return new h(this.cloneConstructProperties())};g.prototype.cloneConstructProperties=function(){var b={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(b.date=new Date(this.date.getTime()));return b};
var h;d.__decorate([k.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],g.prototype,"date",void 0);d.__decorate([k.reader("date",["datetime"])],g.prototype,"readDate",null);d.__decorate([k.writer("date")],g.prototype,"writeDate",null);d.__decorate([k.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],g.prototype,"directShadowsEnabled",void 0);d.__decorate([k.reader("directShadowsEnabled",["directShadows"])],g.prototype,"readDirectShadowsEnabled",null);d.__decorate([k.writer("directShadowsEnabled")],
g.prototype,"writedirectShadowsEnabled",null);d.__decorate([k.property({type:Number,json:{write:!0}})],g.prototype,"displayUTCOffset",void 0);d.__decorate([k.writer("displayUTCOffset")],g.prototype,"writeDisplayUTCOffset",null);return g=h=d.__decorate([k.subclass("esri.webscene.Lighting")],g)}(l.JSONSupport)})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(n,b,d,l){Object.defineProperty(b,"__esModule",{value:!0});b.backgroundProperty=
void 0;n={base:d,key:"type",typeMap:{color:l}};b.backgroundProperty={types:n,json:{read:function(b){return function(d,g,k){if(!d)return d;for(var h in b.typeMap)if(d.type===h)return g=new b.typeMap[h],g.read(d,k),g}}(n),write:{overridePolicy:function(b,d,g){return{enabled:!g||!g.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define(["require","exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],function(n,b,d,l,k){return function(b){function g(d){return b.call(this,
d)||this}d.__extends(g,b);g.prototype.clone=function(){};d.__decorate([k.property({readOnly:!0,json:{read:!1}})],g.prototype,"type",void 0);return g=d.__decorate([k.subclass("esri.webscene.background.Background")],g)}(l.JSONSupport)})},"esri/webscene/background/ColorBackground":function(){define("require exports tslib ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),function(n,b,d,l,k,h,g){var m=d.__assign(d.__assign({},h.colorAndTransparencyProperty),
{nonNullable:!0});return function(b){function a(a){a=b.call(this,a)||this;a.type="color";a.color=new l([0,0,0,1]);return a}d.__extends(a,b);c=a;a.prototype.clone=function(){return new c(this.cloneProperties())};a.prototype.cloneProperties=function(){return{color:this.color.clone()}};var c;d.__decorate([k.enumeration({color:"color"},{readOnly:!0})],a.prototype,"type",void 0);d.__decorate([k.property(m)],a.prototype,"color",void 0);return a=c=d.__decorate([k.subclass("esri.webscene.background.ColorBackground")],
a)}(g)})},"esri/webscene/InitialViewProperties":function(){define("require exports tslib ../Viewpoint ../core/JSONSupport ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(n,b,d,l,k,h,g,m){return function(b){function a(a){a=b.call(this,a)||this;a.environment=new m;a.spatialReference=null;a.viewpoint=null;return a}d.__extends(a,b);c=a;Object.defineProperty(a.prototype,"viewingMode",{set:function(a){this._set("viewingMode",a)},enumerable:!1,configurable:!0});
a.prototype.clone=function(){return new c({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var c;d.__decorate([h.property({type:m,json:{write:{isRequired:!0}}})],a.prototype,"environment",void 0);d.__decorate([h.property({type:g})],a.prototype,"spatialReference",void 0);d.__decorate([h.property({type:["local","global"]})],a.prototype,"viewingMode",null);
d.__decorate([h.property({type:l,json:{write:{isRequired:!0}}})],a.prototype,"viewpoint",void 0);return a=c=d.__decorate([h.subclass("esri.webscene.InitialViewProperties")],a)}(k.JSONSupport)})},"esri/webscene/Presentation":function(){define("require exports tslib ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),function(n,b,d,l,k,h,g,m){var t=l.ofType(m);return function(a){function c(c){c=a.call(this,c)||this;c.slides=new t;return c}
d.__extends(c,a);c.prototype.destroy=function(){this.slides.forEach(function(a){return a.destroy()});this.slides.removeAll()};Object.defineProperty(c.prototype,"slides",{set:function(a){a&&(a=a.filter(function(a){return!!a.viewpoint}));this._set("slides",k.referenceSetter(a,this._get("slides"),t))},enumerable:!1,configurable:!0});c.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};d.__decorate([g.property({type:t,nonNullable:!0,json:{write:!0}}),g.cast(k.castForReferenceSetter)],
c.prototype,"slides",null);return c=d.__decorate([g.subclass("esri.webscene.Presentation")],c)}(h.JSONSupport)})},"esri/webscene/Slide":function(){define("require exports tslib ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3 ../core/libs/gl-matrix-2/vec3f64 ../layers/Layer ../support/basemapUtils ../views/3d/support/mathUtils ../webdoc/support/Thumbnail ./Lighting ./support/Description ./support/SlideEnvironment ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(n,b,d,l,k,h,g,m,t,a,c,e,f,r,w,v,q,C,p,U,D,N,H,G,E){function u(a){if("building-scene"===a.type||"map-image"===a.type)return a.allSublayers.toArray()}function K(a){if(a=u(a))return a.filter(function(a){return a.visible}).map(function(a){return a.id})}function x(a,c){a=c-a;a>L&&(a-=J);a<-L&&(a+=J);return a}var y=0,B=g.ofType(G.default),z=a.getLogger("esri.webscene.Slide"),J=86400,L=43200;return function(a){function b(c){c=a.call(this,c)||this;c._applyToController=null;c.id=Date.now().toString(16)+
"-slide-"+y++;c.title=new E.default;c.description=new D.default;c.thumbnail=new p.default;c.viewpoint=null;c.basemap=null;c.ground=null;c.environment=new N.SlideEnvironment;c.visibleLayers=new B;return c}d.__extends(b,a);b.prototype.destroy=function(){this.visibleLayers.removeAll();this.basemap=null;this.thumbnail&&this.thumbnail.destroy();this.thumbnail=this.title=this.description=null};b.prototype.castTitle=function(a){return"string"===typeof a?new E.default({text:a}):f.ensureType(E.default,a)};
b.prototype.castDescription=function(a){return"string"===typeof a?new D.default({text:a}):f.ensureType(D.default,a)};b.prototype.castThumbnail=function(a){return"string"===typeof a?new p.default({url:a}):f.ensureType(p.default,a)};b.prototype.castBasemap=function(a){return q.ensureType(a)};Object.defineProperty(b.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",m.referenceSetter(a,this._get("visibleLayers"),B))},enumerable:!1,configurable:!0});b.prototype.castVisibleLayers=function(a){return a&&
"function"===typeof a.map?a.map(function(a){if("string"===typeof a)return{id:a};if(a instanceof v){var c=K(a);return{id:a.id,sublayerIds:c}}if(a.id)return{id:a.id,sublayerIds:a.sublayerIds};z.warn('Invalid visible layer, expected { id }, Layer or "id"');return a}):null};b.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||
null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})};b.prototype._updateVisibleLayersFrom=function(a){var b=this,d=[];return c.eachAlways(this._allLayers(a.map).map(function(c){return a.whenLayerView(c).then(function(a){if(a.visible){var b=K(c);d.push(new G.default({id:a.layer.id,sublayerIds:b}))}})}).toArray()).then(function(){b.visibleLayers.removeAll();
b.visibleLayers.addMany(d)})};b.prototype.updateFrom=function(a,c){var b=this;c={screenshot:d.__assign({format:"jpeg",quality:80,width:120,height:75,disableSlice:!0},c&&c.screenshot)};return a.when(function(){b.viewpoint=a.viewpoint.clone();b.environment.lighting=U.prototype.clone.apply(a.environment.lighting);b.basemap=a.map.basemap&&a.map.basemap.clone()||null;b.ground=a.map.ground?H.default.fromGround(a.map.ground):null;return b._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(c.screenshot)}).then(function(a){b.thumbnail=
new p.default({url:a.dataUrl});return b})};b.prototype.applyTo=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var e,f,g,k,m=this;return d.__generator(this,function(l){switch(l.label){case 0:return this._applyToController&&this._applyToController.abort(),this._applyToController=e=c.createAbortController(),f=c.onAbortOrThrow(b,function(){return e.abort()}),g=d.__assign(d.__assign({animate:!0},b),{signal:this._applyToController.signal}),[4,h.result(function(){return d.__awaiter(m,void 0,
void 0,function(){return d.__generator(this,function(c){switch(c.label){case 0:return[4,this._applyBasemap(a,g)];case 1:return c.sent(),this._applyLayerVisibility(a),this._applyGround(a),[4,this._applyViewpoint(a,g)];case 2:return c.sent(),[2]}})})}())];case 1:k=l.sent();this._applyToController===e&&(this._applyToController=null);null===f||void 0===f?void 0:f.remove();e=f=null;if(!1===k.ok)throw k.error;return[2,this]}})})};b.prototype._applyBasemap=function(a,b){return d.__awaiter(this,void 0,void 0,
function(){var e;return d.__generator(this,function(d){switch(d.label){case 0:if(!this.basemap)return[3,5];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.basemap.load(b)];case 2:return d.sent(),[3,4];case 3:e=d.sent();if(c.isAbortError(e))throw e;return[3,4];case 4:a.map.basemap=q.clonePreservingTiledLayers(this.basemap,a.map.basemap),d.label=5;case 5:return[2]}})})};b.prototype._applyGround=function(a){this.ground&&(a.map.ground=this.ground.cloneAndApplyTo(a.map.ground))};b.prototype._allLayers=
function(a){var c=new g;this._collectLayers(a,c);this._collectLayers(a.ground,c);return c};b.prototype._collectLayers=function(a,c){var b=this;a.layers.forEach(function(a){c.add(a);a.layers&&b._collectLayers(a,c)})};b.prototype._applyLayerVisibility=function(a){var c=this;this.visibleLayers&&this._allLayers(a.map).forEach(function(a){var b=c.visibleLayers.find(function(c){return c.id===a.id});a.visible=null!=b;var d=b&&b.sublayerIds,b=u(a);d&&b&&b.forEach(function(a){return a.visible=0<=d.indexOf(a.id)})})};
b.prototype._applyViewpoint=function(a,c){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(b){switch(b.label){case 0:if(!this.viewpoint||c.ignoreViewpoint)return[3,5];this.viewpoint.camera.fov=a.camera.fov;return c.animate&&this.get("environment.lighting.date")?[4,this._animateToLighting(a,c)]:[3,2];case 1:return b.sent(),[2];case 2:if(!c.animate)return[3,4];a.environment.updateLighting(this.environment.lighting.clone());return[4,a.goTo(this.viewpoint,c)];case 3:b.sent(),
b.label=4;case 4:a.viewpoint=this.viewpoint,b.label=5;case 5:return a.environment.updateLighting(this.environment.lighting.clone()),[2]}})})};b.prototype._animateToLighting=function(a,c){return d.__awaiter(this,void 0,void 0,function(){var b,e,f,g=this;return d.__generator(this,function(d){b=null;"global"===a.viewingMode&&(b=this._animateLightingWithCamera(a));a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;
null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);e=a.goTo(this.viewpoint,c);f=function(){b&&b.remove();a.environment.lighting.cameraTrackingEnabled=!0};return[2,e.then(function(){a.environment.updateLighting(g.environment.lighting.clone());f()},function(a){f();throw a;})]})})};b.prototype._getTime=function(a){var c=a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[c,a]};b.prototype._setTime=
function(a,c,b){a.setTime(c);a.setUTCHours(b/3600);a.setUTCMinutes(b%3600/60);a.setUTCSeconds(b%3600%60);return a};b.prototype._animateLightingWithCamera=function(a){var c=this,b=this._getTime(new Date(a.environment.lighting.date.toString())),d=b[0],e=b[1],b=this._getTime(this.environment.lighting.date),f=b[0],g=x(e,b[1]),h=a.renderCoordsHelper,k=w.vec3f64.create();h.toRenderCoords(a.camera.position,k);var A=w.vec3f64.create();h.toRenderCoords(this.viewpoint.camera.position,A);var m=w.vec3f64.create(),
l=new Date;return a.watch("camera",function(b){h.toRenderCoords(b.position,m);var S=r.vec3.squaredDistance(k,m),I=r.vec3.squaredDistance(A,m);b=0;0!==S+I&&(b=S/(S+I));S=d+(f-d)*b;b=C.moduloPositive(e+g*b,J);a.environment.lighting.date=c._setTime(l,S,b)})};b.createFrom=function(a,c){return(new this).updateFrom(a,c)};d.__decorate([e.property({type:String,json:{write:{isRequired:!0}}})],b.prototype,"id",void 0);d.__decorate([e.property({type:E.default,json:{default:function(){return new E.default({text:""})},
write:{isRequired:!0}}})],b.prototype,"title",void 0);d.__decorate([e.cast("title")],b.prototype,"castTitle",null);d.__decorate([e.property({type:D.default,json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.text)}}}}})],b.prototype,"description",void 0);d.__decorate([e.cast("description")],b.prototype,"castDescription",null);d.__decorate([e.property({type:p.default,json:{default:function(){return new p.default({url:""})},write:{isRequired:!0}}})],b.prototype,"thumbnail",void 0);d.__decorate([e.cast("thumbnail")],
b.prototype,"castThumbnail",null);d.__decorate([e.property({type:k,nonNullable:!0,json:{write:{isRequired:!0}}})],b.prototype,"viewpoint",void 0);d.__decorate([e.property({type:l,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],b.prototype,"basemap",void 0);d.__decorate([e.cast("basemap")],b.prototype,"castBasemap",null);d.__decorate([e.property({type:H.default,json:{write:!0}})],b.prototype,"ground",void 0);d.__decorate([e.property({type:B,json:{write:{isRequired:!0}}})],b.prototype,"visibleLayers",
null);d.__decorate([e.cast("visibleLayers")],b.prototype,"castVisibleLayers",null);d.__decorate([e.property({type:N.SlideEnvironment,json:{write:!0}})],b.prototype,"environment",void 0);return b=d.__decorate([e.subclass("esri.webscene.Slide")],b)}(t.JSONSupport)})},"esri/webdoc/support/Thumbnail":function(){define(["require","exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],function(n,b,d,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(){var d=
null!==b&&b.apply(this,arguments)||this;d.url="";return d}d.__extends(g,b);h=g;g.prototype.destroy=function(){this.url=""};g.prototype.clone=function(){return new h({url:this.url})};var h;d.__decorate([k.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"url",void 0);return g=h=d.__decorate([k.subclass("esri.webdoc.support.Thumbnail")],g)}(l.JSONSupport);b.default=n})},"esri/webscene/support/Description":function(){define(["require","exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],
function(n,b,d,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(){var d=null!==b&&b.apply(this,arguments)||this;d.text="";return d}d.__extends(g,b);h=g;g.prototype.clone=function(){return new h({text:this.text})};var h;d.__decorate([k.property({type:String,json:{write:!0}})],g.prototype,"text",void 0);return g=h=d.__decorate([k.subclass("esri.webscene.support.Description")],g)}(l.JSONSupport);b.default=n})},"esri/webscene/support/SlideEnvironment":function(){define("require exports tslib ../../core/JSONSupport ../../core/accessorSupport/decorators ../Lighting".split(" "),
function(n,b,d,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});b.SlideEnvironment=void 0;n=function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a.lighting=new h;return a}d.__extends(g,b);l=g;g.prototype.clone=function(){return new l({lighting:h.prototype.clone.call(this.lighting)})};var l;d.__decorate([k.property({type:h,json:{write:!0}})],g.prototype,"lighting",void 0);return g=l=d.__decorate([k.subclass("esri.webscene.Environment")],g)}(l.JSONSupport);b.SlideEnvironment=
n})},"esri/webscene/support/SlideGround":function(){define("require exports tslib ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../webdoc/support/opacityUtils".split(" "),function(n,b,d,l,k,h,g,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.opacity=null;return a}d.__extends(a,b);c=a;a.prototype.clone=function(){return new c({opacity:this.opacity})};a.prototype.cloneAndApplyTo=
function(a){if(null==this.opacity)return a;a=null!=a?a.clone():new l;a.opacity=this.opacity;return a};a.fromGround=function(a){return new c({opacity:a.opacity})};var c;d.__decorate([h.property({type:Number,json:{type:g.Integer,read:{reader:m.transparencyToOpacity,source:"transparency"},write:{writer:function(a,c){c.transparency=m.opacityToTransparency(a)},target:"transparency"}}})],a.prototype,"opacity",void 0);return a=c=d.__decorate([h.subclass("esri.webscene.support.SlideGround")],a)}(k.JSONSupport);
b.default=n})},"esri/webscene/support/SlideVisibleLayer":function(){define("require exports tslib ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),function(n,b,d,l,k,h,g){Object.defineProperty(b,"__esModule",{value:!0});b.SlideVisibleLayer=void 0;n=function(b){function l(a){a=b.call(this,a)||this;a.id="";a.sublayerIds=null;return a}d.__extends(l,b);a=l;l.prototype.clone=function(){return new a({id:this.id,sublayerIds:k.clone(this.sublayerIds)})};
var a;d.__decorate([h.property({type:String,json:{write:!0}})],l.prototype,"id",void 0);d.__decorate([h.property({type:[g.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],l.prototype,"sublayerIds",void 0);return l=a=d.__decorate([h.subclass("esri.webscene.support.SlideVisibleLayer")],l)}(l.JSONSupport);b.SlideVisibleLayer=n;b.default=n})},"esri/webscene/support/Title":function(){define(["require","exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],
function(n,b,d,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(){var d=null!==b&&b.apply(this,arguments)||this;d.text="";return d}d.__extends(g,b);h=g;g.prototype.clone=function(){return new h({text:this.text})};var h;d.__decorate([k.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"text",void 0);return g=h=d.__decorate([k.subclass("esri.webscene.support.Title")],g)}(l.JSONSupport);b.default=n})},"esri/webscene/TransportationNetwork":function(){define(["require",
"exports","tslib","../core/JSONSupport","../core/accessorSupport/decorators"],function(n,b,d,l,k){return function(b){function g(d){return b.call(this,d)||this}d.__extends(g,b);h=g;g.prototype.clone=function(){return new h({name:this.name,path:this.path,title:this.title})};var h;d.__decorate([k.property({type:String,json:{write:!0}})],g.prototype,"name",void 0);d.__decorate([k.property({type:String,json:{write:!0}})],g.prototype,"path",void 0);d.__decorate([k.property({type:String,json:{write:!0}})],
g.prototype,"title",void 0);return g=h=d.__decorate([k.subclass("esri.webscene.TransportationNetwork")],g)}(l.JSONSupport)})},"esri/webscene/Version":function(){define(["require","exports","tslib","../core/Version"],function(n,b,d,l){Object.defineProperty(b,"__esModule",{value:!0});b.Version=void 0;n=function(b){function h(d,h){return b.call(this,d,h,"webscene")||this}d.__extends(h,b);Object.defineProperty(h.prototype,"supportsGround",{get:function(){return this.since(1,8)},enumerable:!1,configurable:!0});
Object.defineProperty(h.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!1,configurable:!0});return h}(l.Version);b.Version=n;b.default=n})},"esri/core/Version":function(){define(["require","exports","./Error"],function(n,b,d){Object.defineProperty(b,"__esModule",{value:!0});b.Version=void 0;n=function(){function b(b,d,g){void 0===g&&(g="");this.major=b;this.minor=d;this._context=g}b.prototype.lessThan=function(b,d){return this.major<b||b===
this.major&&this.minor<d};b.prototype.since=function(b,d){return!this.lessThan(b,d)};b.prototype.validate=function(b){if(this.major!==b.major)throw new d((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:b});};b.prototype.clone=function(){return new b(this.major,this.minor,this._context)};b.parse=function(k,h){void 0===h&&(h="");var g=k.split("."),l=g[0],
g=g[1],n=/^\s*\d+\s*$/;if(!l||!l.match||!l.match(n))throw new d((h&&h+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:k});if(!g||!g.match||!g.match(n))throw new d((h&&h+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:k});k=parseInt(l,10);l=parseInt(g,10);return new b(k,l,h)};return b}();b.Version=n})},"*noref":1}});
define("require exports tslib ./kernel ./Map ./Viewpoint ./core/Collection ./core/Error ./core/Handles ./core/has ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/MultiOriginJSONSupport ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./views/3d/support/projectionUtils ./views/support/spatialReferenceSupport ./webdoc/support/saveUtils ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/TransportationNetwork ./webscene/Version @dojo/framework/shim/Promise".split(" "),function(n,
b,d,l,k,h,g,m,t,a,c,e,f,r,w,v,q,C,p,U,D,N,H,G,E,u,K,x,y,B,z,J,L,Q,O,M,P,R,F){var T=r.getLogger("esri.WebScene"),V=new F.default(1,21),Y=function(){for(var a=[],b=V.major,c=8;c<=V.minor;c++)a.push(b+"."+c);return a};return function(a){function b(b){var c=a.call(this,b)||this;c._handles=new t;c.applicationProperties=null;c.clippingArea=null;c.clippingEnabled=!1;c.heightModelInfo=null;c.sourceVersion=null;c.supportsHeightModelInfo=!0;c.transportationNetworks=null;c.presentation=new P;c.initialViewProperties=
new M;c.portalItem=null;c.resourceInfo=null;c.debouncedSaveOperations=q.debounce(function(a,b,e){return d.__awaiter(c,void 0,void 0,function(){return d.__generator(this,function(c){switch(a){case 0:return[2,this._saveImpl(b)];case 1:return[2,this._saveAsImpl(e,b)]}return[2]})})});c.resourceReferences={portalItem:null,paths:[]};c.authoringApp=null;c.authoringAppVersion=null;c._isAuthoringAppSetByUser=!1;c._isAuthoringAppVersionSetByUser=!1;return c}d.__extends(b,a);b.prototype.initialize=function(){var a=
this;this.when().catch(function(a){T.error("#load()","Failed to load web scene",a)});if(this.resourceInfo){var b=void 0;try{b=this._validateJSON(this.resourceInfo)}catch(I){this.addResolvingPromise(q.reject(I));return}this.read(b);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",function(){return a._scheduleLayersIdGC()}))};b.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy();
this.presentation&&this.presentation.destroy();var a=this.portalItem;this.portalItem=null;null===a||void 0===a?void 0:a.destroy()};b.prototype.writeClippingArea=function(a,b){b.clippingArea||(b.clippingArea={});b.clippingArea.geometry=a.toJSON()};b.prototype.readClippingEnabled=function(a,b){return b.clippingArea?!!b.clippingArea.clip:!1};b.prototype.writeClippingEnabled=function(a,b){this.clippingArea&&(b.clippingArea||(b.clippingArea={}),b.clippingArea.clip=a)};b.prototype.writeLayers=function(a,
b,c,e){var f=this,g=d.__assign(d.__assign({},e),{layerContainerType:"operational-layers"});a=a.map(function(a){return f.verifyWriteLayer(a,e)?a.write(null,g):null}).filter(function(a){return!!a});b[c]=a.toArray()};b.prototype.verifyWriteLayer=function(a,b){return"write"in a?!0:(b&&b.messages&&b.messages.push(new m("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in web scenes",{layer:a})),!1)};b.prototype.readSourceVersion=function(a,b){a=b.version.split(".");
b=a[1];return new F.default(parseInt(a[0],10),parseInt(b,10))};b.prototype.writeSourceVersion=function(a,b,c){b[c]=V.major+"."+V.minor};Object.defineProperty(b.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?this._override("thumbnailUrl",a):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=
!0;this._set("authoringApp",a)},enumerable:!1,configurable:!0});b.prototype.writeAuthoringApp=function(a,b){b.authoringApp=a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(b.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!1,configurable:!0});b.prototype.writeAuthoringAppVersion=function(a,b){b.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:l.version};b.prototype.writeGround=
function(a,b,c,d){b[c]=a?a.write(null,d):{transparency:0,layers:[]}};b.prototype.readInitialViewProperties=function(a,b){a={};b.initialState&&b.initialState.environment&&(a.environment=O.fromJSON(b.initialState.environment));a.spatialReference=b.spatialReference?G.fromJSON(b.spatialReference):G.WebMercator;a.viewingMode=b.viewingMode||"global";b.initialState&&b.initialState.viewpoint&&(a.viewpoint=h.fromJSON(b.initialState.viewpoint));return new M(a)};Object.defineProperty(b.prototype,"spatialReference",
{get:function(){var a,b;return null!==(b=null===(a=this.initialViewProperties)||void 0===a?void 0:a.spatialReference)&&void 0!==b?b:G.WebMercator},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"viewingMode",{get:function(){var a,b;return null!==(b=null===(a=this.initialViewProperties)||void 0===a?void 0:a.viewingMode)&&void 0!==b?b:"global"},enumerable:!1,configurable:!0});b.prototype.load=function(a){this.addResolvingPromise(this._loadFromSource());return q.resolve(this)};b.prototype.loadAll=
function(){var a=this;return f.default(this,function(b){var c=a.presentation&&a.presentation.slides;b(a.ground,a.basemap,a.layers,c&&c.map(function(a){return a.basemap}))})};b.prototype.read=function(b,c){var e=this;c=d.__assign(d.__assign({},c),{origin:"web-scene"});var f=this._isAuthoringAppVersionSetByUser,g=this._isAuthoringAppSetByUser;D.readLoadable(this,b,function(c){return a.prototype.read.call(e,b,c)},c);g||(this._isAuthoringAppSetByUser=!1);f||(this._isAuthoringAppVersionSetByUser=!1);if(b.baseMap&&
Array.isArray(b.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){c=b.baseMap.elevationLayers.map(function(a){return{id:a.id}});var h=this.presentation.slides,k=function(a,b){return a.visibleLayers.some(function(a){return a.id===b})},l=c.filter(function(a){return!h.some(function(b){return k(b,a.id)})});h.forEach(function(a){a.visibleLayers.addMany(l)})}};b.prototype._writeBasemapElevationLayers=function(a){var b=a.ground&&a.ground.layers;!a.baseMap&&b&&b.length&&
(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=c.clone(b))};b.prototype.write=function(b,c){if("loaded"!==this.loadStatus){var e=new m("webscene:not-loaded","Web scene must be loaded before it can be serialized");T.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw e;}this._runLayersIdGC();e=!(null===c||void 0===c?0:c.messages);c=d.__assign(d.__assign({messages:[]},c),{origin:"web-scene"});b=a.prototype.write.call(this,
b,c);if(e&&(c=c.messages.filter(function(a){return"web-document-write:property-required"===a.name}),c.length))throw e=new m("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:c}),T.error("#toJSON()","One or more properties that are required in the webscene JSON are missing",c),e;this._writeBasemapElevationLayers(b);return b};b.prototype.save=function(a){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,
function(b){return[2,this.debouncedSaveOperations(0,a)]})})};b.prototype._saveImpl=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c,e;return d.__generator(this,function(d){switch(d.label){case 0:if(this.portalItem)return[3,2];T.error("save(): requires the .portalItem property to be set");return[4,q.reject(new m("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:d.sent(),d.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,
4]:[4,q.reject(new m("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];case 3:d.sent(),d.label=4;case 4:return b=this._updateFromPromise,[4,this._ensureLoadBeforeSave()];case 5:return d.sent(),c=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&C.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||K.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],
toKeep:[],pendingOperations:[]}}),e=this.write(null,c),[4,q.all(c.resources.pendingOperations)];case 6:return d.sent(),[4,this._verifySave(e,c,a)];case 7:return d.sent(),this._updateTypeKeywords(this.portalItem),[4,this.portalItem.update({data:e})];case 8:return d.sent(),[4,J.saveResources(this.resourceReferences,c,null)];case 9:return d.sent(),U.updateOrigins(c),b?[4,b]:[3,11];case 10:d.sent(),d.label=11;case 11:return[4,this._saveThumbnail()];case 12:return d.sent(),[2,this.portalItem]}})})};b.prototype.saveAs=
function(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){return[2,this.debouncedSaveOperations(1,b,a)]})})};b.prototype._saveAsImpl=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e,f,g,h,k;return d.__generator(this,function(d){switch(d.label){case 0:if(c=x.from(a))return[3,2];T.error("saveAs(portalItem): requires a portal item parameter");return[4,q.reject(new m("webscene:portal-item-required","saveAs requires a portal item to save to"))];
case 1:d.sent(),d.label=2;case 2:return c.id&&(c=c.clone(),c.id=null),e=c.portal||K.getDefault(),[4,this._ensureLoadBeforeSave()];case 3:return d.sent(),c.type="Web Scene",c.portal=e,f=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:e,portalItem:c,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),g=this.write(null,f),[4,q.all(f.resources.pendingOperations)];case 4:return d.sent(),[4,this._verifySaveAs(g,
f,b)];case 5:return d.sent(),h=this.thumbnailUrl,k=!this._isOverridden("thumbnailUrl"),this._updateTypeKeywords(c),[4,e._signIn()];case 6:return d.sent(),[4,e.user.addItem({item:c,folder:b&&b.folder,data:g})];case 7:return d.sent(),[4,J.saveResources(this.resourceReferences,f,null)];case 8:return d.sent(),this.portalItem=c,w.MultiOriginJSONSupport.prototype.read.call(this,{version:g.version,authoringApp:g.authoringApp,authoringAppVersion:g.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,
url:c.itemUrl&&C.urlToObject(c.itemUrl)}),U.updateOrigins(f),h&&(this.thumbnailUrl=k?C.addQueryParameter(h,"w","8192"):h),f.portalItem=c,[4,this._saveThumbnail()];case 9:return d.sent(),[2,c]}})})};b.prototype._saveThumbnail=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(a){switch(a.label){case 0:return this._isOverridden("thumbnailUrl")?[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:[3,2];case 1:a.sent(),this._clearOverride("thumbnailUrl"),
this.clear("thumbnailUrl","user"),a.label=2;case 2:return[2]}})})};b.prototype._verifySave=function(a,b,c,d){void 0===d&&(d=!1);var e=b.messages.filter(function(a){return"error"===a.type}).map(function(a){return new m(a.name,a.message,a.details)});b.blockedRelativeUrls&&(e=e.concat(b.blockedRelativeUrls.map(function(a){return new m("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));c&&c.ignoreUnsupported&&(e=e.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==
a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name&&"scenemodification:unsupported"!==a.name}));if(null===c||void 0===c?0:c.requiredPropertyChecksDisabled)e=e.filter(function(a){return"web-document-write:property-required"!==a.name});var f=c&&c.strictSchemaValidationEnabled;return(f?(new Promise(function(a,b){n(["./webscene/support/schemaValidator"],a,b)})).then(function(b){b=b.validate(a);if(0<b.length){var c="webscene did not validate:\n"+b.join("\n");
T.error((d?"saveAs":"save")+"(): "+c)}return b.map(function(a){return new m("webscene:schema-validation",a)})}).then(function(a){if(f&&0<a.length)throw y.createSchemaValidationError(a.concat(e));return e}):q.resolve(e)).then(function(a){if(0<a.length)return q.reject(new m("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a}))})};b.prototype._verifySaveAs=function(a,b,c){return this.canSaveAs(b)?q.reject(y.createCopyError()):
this._verifySave(a,b,c,!0)};b.prototype.verifySaveAs=function(a){var b=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),c=this.write(null,b);return this._verifySaveAs(c,b,a)};b.prototype.canSaveAs=function(a){a||(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a));return a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length};b.prototype.updateFrom=function(a,b){void 0===b&&(b={});return d.__awaiter(this,void 0,void 0,function(){var c,
e;return d.__generator(this,function(d){switch(d.label){case 0:return this._updateFromPromise=c=this._updateFromInternal(a,b),[4,c];case 1:d.sent();if(e=this._updateFromPromise===c)this._updateFromPromise=null;return[2]}})})};b.prototype._updateFromInternal=function(a,b){void 0===b&&(b={});return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){switch(c.label){case 0:return[4,a.whenReady()];case 1:return c.sent(),!b.environmentExcluded&&a.environment&&(this.initialViewProperties.environment=
O.prototype.clone.apply(a.environment)),!b.viewpointExcluded&&a.viewpoint&&(this.initialViewProperties.viewpoint=a.viewpoint.clone()),this.initialViewProperties.spatialReference=a.spatialReference.clone(),this.initialViewProperties.viewingMode=a.viewingMode,a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,a.heightModelInfo&&(this.heightModelInfo=a.heightModelInfo.clone()),a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=
a.visible}),!1===b.thumbnailExcluded||null==b.thumbnailExcluded&&!b.viewpointExcluded?[4,this._updateFromThumbnail(a,b.thumbnailSize||void 0)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2]}})})};b.prototype._updateFromThumbnail=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,e;return d.__generator(this,function(d){switch(d.label){case 0:return c=L.getOptimalThumbnailSize(a,b),[4,a.takeScreenshot({format:"jpg",width:c.width,height:c.height,disableSlice:!0})];case 1:return e=
d.sent(),this.thumbnailUrl=e.dataUrl,[2]}})})};b.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};b.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a);this.read(a,b);return this._loadFromJSON(a,b)};b.prototype._extractOperationalLayers=function(a){var b=this,c=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&
Array.isArray(a.baseMap.elevationLayers))for(var d=0,e=a.baseMap.elevationLayers;d<e.length;d++)c.push(e[d]);var f=[],g=function(a){a.layers&&(a.layers=a.layers.filter(g));return"ArcGISTiledElevationServiceLayer"===a.layerType?(b.sourceVersion.supportsGround||f.push(a),!1):!0};return{operationalLayers:a.operationalLayers?a.operationalLayers.filter(g):[],operationalElevationLayers:f,basemapElevationLayers:c}};b.prototype._loadFromJSON=function(a,b){var c=this,e=new g;return this._validateSpatialReference().then(function(){return c._validateHeightModelInfo()}).then(function(){return new Promise(function(a,
b){n(["./portal/support/layersCreator"],a,b)})}).then(function(f){var g=c._extractOperationalLayers(a),h=g.operationalLayers,k=g.operationalElevationLayers,g=g.basemapElevationLayers,l=[],m={context:d.__assign(d.__assign({},b),{layerContainerType:"operational-layers"})};c.portalItem&&(m.context.portal=c.portalItem.portal||K.getDefault());if(0<g.length){var n=d.__assign(d.__assign({},m),{context:d.__assign(d.__assign({},m.context),{layerContainerType:"ground"})});n.defaultLayerType="ArcGISTiledElevationServiceLayer";
l.push(f.populateOperationalLayers(c.ground.layers,g,n))}0<k.length&&(n=d.__assign(d.__assign({},m),{context:d.__assign(d.__assign({},m.context),{layerContainerType:"ground"})}),n.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(f.populateOperationalLayers(e,k,n)));h&&0<h.length&&l.push(f.populateOperationalLayers(c.layers,h,m));return q.eachAlways(l).then(function(){})}).then(function(){return c._loadObjectsWithLayers()}).then(function(){c.ground.layers.addMany(e)})};b.prototype._ensureLoadBeforeSave=
function(){return d.__awaiter(this,void 0,void 0,function(){var a,b,c,e,f;return d.__generator(this,function(d){switch(d.label){case 0:return[4,this.load()];case 1:return d.sent(),[4,this._loadObjectsWithLayers()];case 2:d.sent();a=[];b=0;for(c=this.allLayers.items;b<c.length;b++)e=c[b],"beforeSave"in e&&"function"===typeof e.beforeSave&&(f=e.beforeSave())&&a.push(f);return[4,q.eachAlways(a)];case 3:return d.sent(),[2]}})})};b.prototype._loadObjectsWithLayers=function(){return d.__awaiter(this,void 0,
void 0,function(){var a;return d.__generator(this,function(b){switch(b.label){case 0:return a=[],this.ground&&a.push(this.ground.load()),this.basemap&&a.push(this.basemap.load()),this.presentation.slides.forEach(function(b){b.basemap&&a.push(b.basemap.load())}),[4,q.eachAlways(a)];case 1:return b.sent(),[2]}})})};b.prototype._loadFromItem=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c;return d.__generator(this,function(d){switch(d.label){case 0:return[4,a.load().catch(function(a){throw new m("webscene:load-portal-item",
"Failed to load portal item",{error:a});})];case 1:d.sent();if("Web Scene"!==a.type)throw new m("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});return[4,a.fetchData()];case 2:return this.resourceInfo=b=d.sent(),c={origin:"web-scene",url:C.urlToObject(a.itemUrl),portal:a.portal||K.getDefault(),portalItem:a,readResourcePaths:[]},[4,this._readAndLoadFromJSON(b,c)];case 3:return d.sent(),this.resourceReferences={portalItem:a,paths:c.readResourcePaths},
[2]}})})};b.prototype._validateSpatialReference=function(){var a=this.initialViewProperties,b=this._sceneSpatialReference,c;if("local"!==a.viewingMode){if(!z.isSpatialReferenceSupported(b,"global"))return q.reject(new m("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||B.canProject(a,b)}}else{if(!z.isSpatialReferenceSupported(b,
"local"))return q.reject(new m("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||a.equals(b)}}var d=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},e=d(a.viewpoint);return e&&!c(e)?q.reject(new m("webscene:incompatible-camera-spatial-reference",
"Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:e,sceneSpatialReference:b,viewingMode:a.viewingMode})):(e=this.presentation.slides.find(function(a){return!c(d(a.viewpoint))}))?(e=d(e.viewpoint),q.reject(new m("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{slideSpatialReference:e,sceneSpatialReference:b,viewingMode:a.viewingMode}))):q.resolve()};b.prototype._validateHeightModelInfo=function(){var a=E.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return a?q.reject(a):q.resolve()};b.prototype._validateJSON=function(a){var b=F.default.parse(a.version||"","webscene");V.validate(b);a.version=b.major+"."+b.minor;1===b.major&&2>=b.minor&&(a.spatialReference=G.WebMercator.toJSON());return a};b.prototype._updateTypeKeywords=function(a){"local"===
this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):a.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b}))};Object.defineProperty(b.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||
G.WebMercator},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"_verifyItemRelativeRootPath",{get:function(){return this.portalItem&&this.portalItem.itemUrl?C.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!1,configurable:!0});b.prototype._enableVerifyItemRelativeUrls=function(a){var b=this._verifyItemRelativeRootPath;b&&(a.verifyItemRelativeUrls={rootPath:b,writtenUrls:[]});return a};b.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),
this._layersIdGCTimeoutId=0)};b.prototype._scheduleLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){a._layersIdGCTimeoutId=0;a._runLayersIdGC()},3E3)};b.prototype._runLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();var b=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,c=function(b){return!!a.allLayers.find(function(a){return a.id===b})};b&&b.layers&&(b.layers=b.layers.filter(function(a){return c(a.id)}));
(b=this.presentation&&this.presentation.slides)&&b.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return c(a.id)}))})};b.fromJSON=function(a){if(!a)throw new m("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};b.VERSION=V;d.__decorate([p.property({type:Q,json:{write:!0}})],b.prototype,"applicationProperties",void 0);d.__decorate([p.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],b.prototype,
"basemap",void 0);d.__decorate([p.property({type:N,json:{read:{source:"clippingArea.geometry",reader:u.fromJSON},write:{target:"clippingArea.geometry"}}})],b.prototype,"clippingArea",void 0);d.__decorate([p.writer("clippingArea")],b.prototype,"writeClippingArea",null);d.__decorate([p.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],b.prototype,"clippingEnabled",void 0);d.__decorate([p.reader("clippingEnabled",["clippingArea"])],b.prototype,"readClippingEnabled",null);d.__decorate([p.writer("clippingEnabled")],
b.prototype,"writeClippingEnabled",null);d.__decorate([p.property({type:H,json:{write:!0}})],b.prototype,"heightModelInfo",void 0);d.__decorate([p.property({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],b.prototype,"layers",void 0);d.__decorate([p.writer("layers")],b.prototype,"writeLayers",null);d.__decorate([p.property({readOnly:!0,type:F.default,json:{type:Y(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:function(){return{enabled:!0,allowNull:!0,ignoreOrigin:!0}}}}})],
b.prototype,"sourceVersion",void 0);d.__decorate([p.reader("sourceVersion",["version"])],b.prototype,"readSourceVersion",null);d.__decorate([p.writer("sourceVersion")],b.prototype,"writeSourceVersion",null);d.__decorate([p.property({json:{read:!1,write:!1}})],b.prototype,"tables",void 0);d.__decorate([p.property({dependsOn:["portalItem.thumbnailUrl"]})],b.prototype,"thumbnailUrl",null);d.__decorate([p.property({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],b.prototype,"authoringApp",
null);d.__decorate([p.writer("authoringApp")],b.prototype,"writeAuthoringApp",null);d.__decorate([p.property({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],b.prototype,"authoringAppVersion",null);d.__decorate([p.writer("authoringAppVersion")],b.prototype,"writeAuthoringAppVersion",null);d.__decorate([p.property({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],b.prototype,"ground",void 0);d.__decorate([p.writer("ground")],b.prototype,"writeGround",null);d.__decorate([p.property({type:g.ofType(R),
json:{write:!0}})],b.prototype,"transportationNetworks",void 0);d.__decorate([p.property({type:P,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:function(a,b,c,e){a.slides&&0<a.slides.length&&(c=d.__assign(d.__assign({},e),{isPresentation:!0}),b.presentation=a.write(null,c))}}}})],b.prototype,"presentation",void 0);d.__decorate([p.property({type:M,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:function(){return new M({viewingMode:"global",spatialReference:G.WebMercator})}}})],
b.prototype,"initialViewProperties",void 0);d.__decorate([p.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],b.prototype,"readInitialViewProperties",null);d.__decorate([p.property({type:G,dependsOn:["initialViewProperties.spatialReference"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],b.prototype,"spatialReference",null);d.__decorate([p.property({type:["local","global"],dependsOn:["initialViewProperties.viewingMode"],
json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],b.prototype,"viewingMode",null);d.__decorate([p.property({type:x})],b.prototype,"portalItem",void 0);d.__decorate([p.property()],b.prototype,"resourceInfo",void 0);return b=d.__decorate([p.subclass("esri.WebScene")],b)}(e.LoadableMixin(v.EsriPromiseMixin(w.MultiOriginJSONMixin(k))))});