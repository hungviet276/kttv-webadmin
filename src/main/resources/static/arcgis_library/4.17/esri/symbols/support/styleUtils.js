// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../request ../../symbols ../../core/arrayUtils ../../core/devEnvironmentUtils ../../core/Error ../../core/promiseUtils ../../core/urlUtils ../../portal/Portal ../../portal/PortalQueryParams ../../support/featureFlags ../../support/persistableUrlUtils ./jsonUtils ./StyleOrigin ./Thumbnail".split(" "),function(P,c,C,D,E,F,q,m,r,h,G,H,I,u,v,w,x){function J(a,b){return t(a,b).then(function(b){return{data:b.data,baseUrl:h.removeFile(a),styleUrl:a}})}function K(a,b,e){b=
b.portal||G.getDefault();var d,k=b.url+" - "+(b.user&&b.user.username)+" - "+a;l[k]||(l[k]=L(a,b,e).then(function(a){d=a;return a.fetchData()}).then(function(b){return{data:b,baseUrl:d.itemUrl,styleName:a}}));return l[k]}function L(a,b,e){return b.load(e).then(function(){var d=new H({disableExtraQuery:!0,query:"owner:"+n+" AND type:"+y+' AND typekeywords:"'+a+'"'});return b.queryItems(d,e)}).then(function(b){b=b.results;var d=null,f=a.toLowerCase();if(b&&Array.isArray(b))for(var c=0;c<b.length;c++){var g=
b[c];if(g.typeKeywords.some(function(a){return a.toLowerCase()===f})&&g.type===y&&g.owner===n){d=g;break}}if(!d)throw new m("symbolstyleutils:style-not-found","The style '"+a+"' could not be found",{styleName:a});return d.load(e)})}function z(a,b,e){return a.styleUrl?J(a.styleUrl,e):a.styleName?K(a.styleName,b,e):r.reject(new m("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function A(a,b,e,d,c){var f=a.data,k={portal:e.portal,url:h.urlToObject(a.baseUrl),
origin:"portal-item"},f=F.find(f.items,function(a){return a.name===b});if(!f)return r.reject(new m("symbolstyleutils:symbol-name-not-found","The symbol name '"+b+"' could not be found",{symbolName:b}));var g=u.fromJSON(M(f,d),k),p=f.thumbnail&&f.thumbnail.href,l=f.thumbnail&&f.thumbnail.imageData;q.isDevEnvironment()&&(g=q.adjustStaticAGOUrl(g),p=q.adjustStaticAGOUrl(p));var n={portal:e.portal,url:h.urlToObject(h.removeFile(g)),origin:"portal-item"};return t(g,c).then(function(c){c="cimRef"===d?B(c.data):
c.data;if((c=v.fromJSON(c,n))&&E.isSymbol3D(c)){if(p){var f=u.fromJSON(p,k);c.thumbnail=new x.default({url:f})}else l&&(c.thumbnail=new x.default({url:"data:image/png;base64,"+l}));a.styleUrl?c.styleOrigin=new w({portal:e.portal,styleUrl:a.styleUrl,name:b}):a.styleName&&(c.styleOrigin=new w({portal:e.portal,styleName:a.styleName,name:b}))}return c})}function B(a){return null===a||"CIMSymbolReference"===a.type?a:{type:"CIMSymbolReference",symbol:a}}function M(a,b){if("cimRef"===b)return a.cimRef;if(a.formatInfos&&
!I.enableWebStyleForceWOSR()){b=0;for(var c=a.formatInfos;b<c.length;b++){var d=c[b];if("gltf"===d.type)return d.href}}return a.webRef}function N(a,b,c){var d=O.replace(/\{SymbolName\}/gi,a.name);return t(d,c).then(function(a){a=B(a.data);return v.fromJSON(a,{portal:b.portal,url:h.urlToObject(h.removeFile(d)),origin:"portal-item"})})}function t(a,b){b=C.__assign({responseType:"json",query:{f:"json"}},b);return D(h.normalize(a),b)}Object.defineProperty(c,"__esModule",{value:!0});c.styleNameFromItem=
c.fetchSymbolFromStyle=c.resolveWebStyleSymbol=c.fetchStyle=void 0;var l={};c.fetchStyle=z;c.resolveWebStyleSymbol=function(a,b,c,d){return a.name?a.styleName&&"Esri2DPointSymbolsStyle"===a.styleName?N(a,b,d):z(a,b,d).then(function(e){return A(e,a.name,b,c,d)}):r.reject(new m("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))};c.fetchSymbolFromStyle=A;c.styleNameFromItem=function(a){var b=0;for(a=a.typeKeywords;b<a.length;b++){var c=a[b];if(/^Esri.*Style$/.test(c)&&
"Esri Style"!==c)return c}};var n="esri_en",y="Style",O="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f\x3djson"});