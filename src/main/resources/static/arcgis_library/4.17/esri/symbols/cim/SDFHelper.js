// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../geometry/support/jsonUtils","./packingUtils","./Rect"],function(G,p,D,E,F){function z(a){if(!a)return null;switch(a.type){case "CIMPointSymbol":a=a.symbolLayers;if(!a||1!==a.length)break;return z(a[0]);case "CIMVectorMarker":a=a.markerGraphics;if(!a||1!==a.length)break;var b=a[0];if(!b)break;a=b.geometry;if(!a)break;b=b.symbol;if(!b||"CIMPolygonSymbol"!==b.type&&"CIMLineSymbol"!==b.type)break;return{geom:a,asFill:"CIMPolygonSymbol"===b.type};case "sdf":return{geom:a.geom,
asFill:a.asFill}}return null}function C(a){for(var b=Infinity,c=-Infinity,g=Infinity,u=-Infinity,e=0;e<a.length;e++)for(var q=0,f=a[e];q<f.length;q++){var k=f[q];k[0]<b&&(b=k[0]);k[0]>c&&(c=k[0]);k[1]<g&&(g=k[1]);k[1]>u&&(u=k[1])}return[b,g,c,u]}Object.defineProperty(p,"__esModule",{value:!0});p.buildSDF=p.getSDFMetrics=p.getExtent=p.getSDFSymbol=p.getSDFInfo=void 0;p.getSDFInfo=z;p.getSDFSymbol=function(a){a=a.markerGraphics;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;a=a.symbol;return!a||
"CIMPolygonSymbol"!==a.type&&"CIMLineSymbol"!==a.type?null:a};p.getExtent=function(a){return a?a.rings?C(a.rings):a.paths?C(a.paths):D.isExtent(a)?[a.xmin,a.ymin,a.xmax,a.ymax]:null:null};p.getSDFMetrics=function(a,b,c,g,u){var e=a[0],q=a[1],f=a[2];a=a[3];if(f<e||a<q)return[0,0,0];var k=f-e,d=a-q,f=Math.floor(31.5);a=(128-2*(f+1))/Math.max(k,d);var k=Math.round(k*a),d=Math.round(d*a)+2*f,l=1;b&&(l=d/a/(b.ymax-b.ymin));var m=0,h=0;g&&(u?b&&c&&0<b.ymax-b.ymin&&(m=g.x/((b.xmax-b.xmin)/(b.ymax-b.ymin)*
c),h=g.y/c):(m=g.x,h=g.y));m=.5*(b.xmax+b.xmin)+m*(b.xmax-b.xmin);h=.5*(b.ymax+b.ymin)+h*(b.ymax-b.ymin);m=(m-e)*a+f;h=(h-q)*a+f;return[l,m/(k+2*f)-.5,-(h/d-.5)]};p.buildSDF=function(a){var b,c=a.geom;b=c?c.rings?c.rings:c.paths?c.paths:void 0!==c.xmin&&void 0!==c.ymin&&void 0!==c.xmax&&void 0!==c.ymax?[[[c.xmin,c.ymin],[c.xmin,c.ymax],[c.xmax,c.ymax],[c.xmax,c.ymin],[c.xmin,c.ymin]]]:null:null;var g,c=Infinity,u=-Infinity,e=Infinity,q=-Infinity;for(g=0;g<b.length;g++)for(var f=0,k=b[g];f<k.length;f++){var d=
k[f];d[0]<c&&(c=d[0]);d[0]>u&&(u=d[0]);d[1]<e&&(e=d[1]);d[1]>q&&(q=d[1])}g=new F.default(c,e,u-c,q-e);e=Math.floor(31.5);f=(128-2*(e+1))/Math.max(g.width,g.height);c=Math.round(g.width*f)+2*e;u=Math.round(g.height*f)+2*e;q=[];for(k=0;k<b.length;k++){var l=b[k];if(l&&1<l.length){for(var d=[],m=0;m<l.length;m++){var h=l[m],n=h[0],h=h[1],n=n-g.x,h=h-g.y,n=n*f,h=h*f,n=n+(e-.5),h=h+(e-.5);d.push([n,h])}a.asFill&&(m=d.length-1,d[0][0]===d[m][0]&&d[0][1]===d[m][1]||d.push(d[0]));q.push(d)}}g=c*u;b=Array(g);
k=e*e+1;for(f=0;f<g;++f)b[f]=k;for(k=0;k<q.length;k++)for(d=q[k],m=d.length,f=1;f<m;++f){var l=d[f-1],n=d[f],t=void 0,h=void 0;l[0]<n[0]?(t=l[0],h=n[0]):(t=n[0],h=l[0]);var r=void 0,v=void 0;l[1]<n[1]?(r=l[1],v=n[1]):(r=n[1],v=l[1]);var p=Math.floor(t)-e,h=Math.floor(h)+e,r=Math.floor(r)-e,v=Math.floor(v)+e;0>p&&(p=0);h>c&&(h=c);0>r&&(r=0);v>u&&(v=u);for(var t=n[0]-l[0],B=n[1]-l[1],z=t*t+B*B;p<h;p++)for(var y=r;y<v;y++){var w=(p-l[0])*t+(y-l[1])*B,x=void 0,A=void 0;0>w?(x=l[0],A=l[1]):w>z?(x=n[0],
A=n[1]):(w/=z,x=l[0]+w*t,A=l[1]+w*B);w=(p-x)*(p-x)+(y-A)*(y-A);x=(u-y-1)*c+p;w<b[x]&&(b[x]=w)}}for(f=0;f<g;++f)b[f]=Math.sqrt(b[f]);if(a.asFill)for(a=0;a<q.length;a++)for(g=q[a],f=g.length,k=1;k<f;++k)for(d=g[k-1],m=g[k],n=l=void 0,d[0]<m[0]?(l=d[0],n=m[0]):(l=m[0],n=d[0]),h=r=void 0,d[1]<m[1]?(r=d[1],h=m[1]):(r=m[1],h=d[1]),l=Math.floor(l),n=Math.floor(n)+1,r=Math.floor(r),h=Math.floor(h)+1,l<e&&(l=e),n>c-e&&(n=c-e),r<e&&(r=e),h>u-e&&(h=u-e);r<h;++r)if(d[1]>r!==m[1]>r){v=(u-r-1)*c;for(t=l;t<n;++t)t<
(m[0]-d[0])*(r-d[1])/(m[1]-d[1])+d[0]&&(b[v+t]=-b[v+t]);for(t=e;t<l;++t)b[v+t]=-b[v+t]}e*=2;q=b.length;a=new Uint8Array(4*q);for(g=0;g<q;++g)E.packFloatRGBA(.5-b[g]/e,a,4*g);return[a,c,u]}});