// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/lang","../../../geometry/support/jsonUtils","../CIMCursor"],function(g,c,h,d,r){Object.defineProperty(c,"__esModule",{value:!0});c.EffectAddControlPoints=void 0;g=function(){function b(){}b.local=function(){null===b.instance&&(b.instance=new b);return b.instance};b.prototype.execute=function(a,b,e){return new t(a,b,e)};b.instance=null;return b}();c.EffectAddControlPoints=g;var t=function(){function b(a,b,e){this._inputGeometries=a;this._angleTolerance=void 0!==
b.angleTolerance?b.angleTolerance:120;this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}b.prototype.next=function(){for(var a=this._inputGeometries.next();a;){if(d.isPolygon(a))return this._isClosed=!0,a=h.clone(a),this._processMultipath(a.rings),a;if(d.isPolyline(a))return this._isClosed=!1,a=h.clone(a),this._processMultipath(a.paths),a;if(d.isExtent(a)){if(this._maxCosAngle)return a;this._isClosed=!0;a=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,
a.ymin]];this._processPath(a);return{rings:[a]}}a=this._inputGeometries.next()}return null};b.prototype._processMultipath=function(a){if(a)for(var b=0;b<a.length;b++)this._processPath(a[b])};b.prototype._processPath=function(a){if(a){var b=a.length,e=a[0],c=void 0,d=void 0,k=void 0,g=void 0,h=void 0,q=void 0;this._isClosed&&++b;for(var f=1;f<b;++f){var p=void 0,p=this._isClosed&&f===b-1?a[0]:a[f],l=p[0]-e[0],m=p[1]-e[1],n=Math.sqrt(l*l+m*m);1<f&&0<n&&0<k&&(c*l+d*m)/n/k<=this._maxCosAngle&&r.setId(e,
1);1===f&&(g=l,h=m,q=n);0<n&&(e=p,c=l,d=m,k=n)}this._isClosed&&0<k&&0<q&&(c*g+d*h)/q/k<=this._maxCosAngle&&r.setId(a[0],1)}};return b}()});