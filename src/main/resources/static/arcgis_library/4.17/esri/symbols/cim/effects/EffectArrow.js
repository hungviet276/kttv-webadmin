// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","tslib","../CIMCursor","../CurveHelper"],function(n,l,p,m,k){Object.defineProperty(l,"__esModule",{value:!0});l.EffectArrow=void 0;n=function(){function e(){}e.local=function(){null===e.instance&&(e.instance=new e);return e.instance};e.prototype.execute=function(e,a,c){return new q(e,a,c)};e.instance=null;return e}();l.EffectArrow=n;var q=function(e){function h(a,c,b){a=e.call(this,a,!1,!0)||this;a._curveHelper=new k.CurveHelper;a._width=(void 0!==c.width?c.width:5)*b;
a._arrowType=void 0!==c.geometricEffectArrowType?c.geometricEffectArrowType:"OpenEnded";a._offsetFlattenError=k.PIXEL_TOLERANCE*b;return a}p.__extends(h,e);h.prototype.processPath=function(a){switch(this._arrowType){default:return this._constructSimpleArrow(a,!0);case "Block":return this._constructSimpleArrow(a,!1);case "Crossed":return this._constructCrossedArrow(a)}};h.prototype._constructSimpleArrow=function(a,c){var b=this._curveHelper.calculatePathLength(a),f=this._width;b<2*f&&(f=b/2);b=this._curveHelper.getSubCurve(a,
0,b-f);if(!b)return null;var g=f/2;if(this._curveHelper.isEmpty(b,!1))return null;f=this._constructOffset(b,-g);if(!f)return null;b=this._constructOffset(b,g);if(!b)return null;var e=this._constructArrowBasePoint(f,-g/2);if(!e)return null;g=this._constructArrowBasePoint(b,g/2);if(!g)return null;a=a[a.length-1];c||(this._makeControlPoint(b,!0),this._makeControlPoint(f,!0));var d=new k.PathHelper;d.addPath(b,!0);d.lineTo(g);this._makeControlPoint(d.path());d.lineTo(a);this._makeControlPoint(d.path());
d.lineTo(e);this._makeControlPoint(d.path());d.addPath(f,!1);return c?{paths:[d.path()]}:(d.close(),{rings:[d.path()]})};h.prototype._constructCrossedArrow=function(a){var c=this._curveHelper.calculatePathLength(a),b=this._width;c<3.732050807568877*b&&(b=c/3.732050807568877);var f=this._curveHelper.getSubCurve(a,0,c-2.732050807568877*b);if(!f)return null;var g=b/2;if(this._curveHelper.isEmpty(f,!1))return null;var e=this._constructOffset(f,g);if(!e)return null;f=this._constructOffset(f,-g);if(!f)return null;
c=this._curveHelper.getSubCurve(a,0,c-b);if(!c||this._curveHelper.isEmpty(c,!1))return null;b=this._constructOffset(c,g);if(!b)return null;var d=this._constructOffset(c,-g);if(!d)return null;c=b[b.length-1];b=this._constructArrowBasePoint(b,g/2);if(!b)return null;var h=d[d.length-1],g=this._constructArrowBasePoint(d,-g/2);if(!g)return null;a=a[a.length-1];this._makeControlPoint(e,!1);this._makeControlPoint(f,!1);d=new k.PathHelper;d.addPath(e,!0);this._makeControlPoint(d.path());d.lineTo(h);d.lineTo(g);
this._makeControlPoint(d.path());d.lineTo(a);this._makeControlPoint(d.path());d.lineTo(b);this._makeControlPoint(d.path());d.lineTo(c);this._makeControlPoint(d.path());d.addPath(f,!1);return{paths:[d.path()]}};h.prototype._constructOffset=function(a,c){return this._curveHelper.offset(a,c,"Rounded",4,this._offsetFlattenError)};h.prototype._constructArrowBasePoint=function(a,c){if(!a||2>a.length)return null;var b=a[a.length-2];a=a[a.length-1];b=[a[0]-b[0],a[1]-b[1]];this._curveHelper.normalize(b);return[a[0]+
b[1]*c,a[1]-b[0]*c]};h.prototype._makeControlPoint=function(a,c){void 0===c&&(c=!1);c?m.setId(a[0],1):m.setId(a[a.length-1],1)};return h}(m.PathGeometryCursor)});