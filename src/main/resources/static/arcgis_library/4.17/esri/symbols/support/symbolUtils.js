// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/compilerUtils ../../core/maybe ../../support/arcadeOnDemand ./utils @dojo/framework/shim/Promise".split(" "),function(u,l,v,J,r,K,y){function w(b,a){return v.__awaiter(this,void 0,void 0,function(){var c,h,k,f,d;return v.__generator(this,function(e){switch(e.label){case 0:c=b.type;switch(c){case "web-style":return[3,1];case "label-3d":return[3,3];case "line-3d":return[3,3];case "mesh-3d":return[3,3];case "point-3d":return[3,3];case "polygon-3d":return[3,3];
case "simple-marker":return[3,5];case "simple-line":return[3,5];case "simple-fill":return[3,5];case "picture-marker":return[3,5];case "picture-fill":return[3,5];case "text":return[3,5];case "cim":return[3,7]}return[3,9];case 1:return[4,new Promise(function(a,b){u(["./previewWebStyleSymbol"],a,b)})];case 2:return h=e.sent().previewWebStyleSymbol,[2,h(b,w,a)];case 3:return[4,new Promise(function(a,b){u(["./previewSymbol3D"],a,b)})];case 4:return k=e.sent().previewSymbol3D,[2,k(b,a)];case 5:return[4,
new Promise(function(a,b){u(["./previewSymbol2D"],a,b)})];case 6:return f=e.sent().previewSymbol2D,[2,f(b,a)];case 7:return[4,new Promise(function(a,b){u(["./previewCIMSymbol"],a,b)})];case 8:return d=e.sent().previewCIMSymbol,[2,d(b,a)];case 9:return J.neverReached(b),[2,void 0]}})})}function F(b){return b&&"opacity"in b?b.opacity*F(b.parent):1}Object.defineProperty(l,"__esModule",{value:!0});l.getDisplayedSymbol=l.renderPreviewHTML=l.renderColorRampPreviewHTML=l.renderDotDensityPreviewHTML=void 0;
var p=null;l.renderDotDensityPreviewHTML=function(b,a,c){var h=b.backgroundColor,k=b.outline;b=b.dotSize;var f=c&&c.swatchSize||22,d=Math.round(f*f/Math.pow(b,2)*.8),e=window.devicePixelRatio;c=document.createElement("canvas");var m=f*e;c.width=m;c.height=m;c.style.width=c.width/e+"px";c.style.height=c.height/e+"px";var g=c.getContext("2d");h&&(g.fillStyle=h.toCss(!0),g.fillRect(0,0,m,m),g.fill());g.fillStyle=a.toCss(!0);if(p&&p.length/2===d)for(a=0;a<2*d;a+=2){var h=p[a],n=p[a+1];g.fillRect(h,n,
b*e,b*e);g.fill()}else for(p=[],a=0;a<2*d;a+=2)h=Math.floor(Math.random()*(m-0+1)+0),n=Math.floor(Math.random()*(m-0+1)+0),p.push(h,n),g.fillRect(h,n,b*e,b*e),g.fill();k&&(k.color&&(g.strokeStyle=k.color.toCss(!0)),g.lineWidth=k.width,g.strokeRect(0,0,m,m));k=new Image(f,f);k.src=c.toDataURL();return k};l.renderColorRampPreviewHTML=function(b,a){void 0===a&&(a={});var c="horizontal"===a.align,h=a.width,h=void 0===h?c?75:24:h,k=a.height,k=void 0===k?c?24:75:k;a=a.gradient;var f=void 0===a?!0:a;a=window.devicePixelRatio;
var d=h*a,e=k*a;a=document.createElement("canvas");a.width=d;a.height=e;a.style.width=h+"px";a.style.height=k+"px";var m=a.getContext("2d"),g=c?d:0,n=c?0:e;if(f){var l=m.createLinearGradient(0,0,g,n),r=1/(b.length-1);b.forEach(function(a,b){return l.addColorStop(b*r,a.toString())});m.fillStyle=l;m.fillRect(0,0,d,e)}else for(f=c?d/b.length:d,d=c?e:e/b.length,n=g=e=0;n<b.length;n++)m.fillStyle=b[n].toString(),m.fillRect(e,g,f,d),e=c?e+f:0,g=c?0:g+d;b=document.createElement("div");b.style.width=h+"px";
b.style.height=k+"px";b.appendChild(a);return b};l.renderPreviewHTML=w;l.getDisplayedSymbol=function(b,a){return v.__awaiter(this,void 0,void 0,function(){var c,h,k,f,d,e,m,g,n,l,p,B,z,C,t,w,G,H,x,I,A,D,E;return v.__generator(this,function(q){switch(q.label){case 0:if(!b)return[2,void 0];c=F(b.layer||b.sourceLayer);return!r.isSome(b.symbol)||r.isSome(a)&&!0===a.ignoreGraphicSymbol?[3,4]:"web-style"!==b.symbol.type?[3,2]:[4,b.symbol.fetchSymbol(r.isSome(a)?a.abortOptions:null)];case 1:return k=q.sent(),
[3,3];case 2:k=b.symbol.clone(),q.label=3;case 3:return h=k,y.applyColorToSymbol(h,null,c),[2,h];case 4:return f=r.isSome(a)&&a.renderer||b.get("layer.renderer")||b.get("sourceLayer.renderer"),[4,f.getSymbolAsync(b)];case 5:return(d=q.sent())?"web-style"!==d.type?[3,7]:[4,d.fetchSymbol(r.isSome(a)?a.abortOptions:null)]:[2,void 0];case 6:return d=q.sent(),[3,8];case 7:d=d.clone(),q.label=8;case 8:if(!("visualVariables"in f)||"visualVariables"in f&&!f.visualVariables||"visualVariables"in f&&f.visualVariables&&
!f.visualVariables.length)return[2,d];if(!f.arcadeRequiredForVisualVariables||!r.isNone(a)&&!r.isNone(a.arcade))return[3,10];m=e=v.__assign({},r.unwrap(a));return[4,K.loadArcade()];case 9:m.arcade=q.sent(),a=e,q.label=10;case 10:return[4,new Promise(function(a,b){u(["../../renderers/visualVariables/support/visualVariableUtils"],a,b)})];case 11:g=q.sent();n=[];l=[];p=[];B=[];z=0;for(C=f.visualVariables;z<C.length;z++)switch(t=C[z],t.type){case "color":n.push(t);break;case "opacity":l.push(t);break;
case "rotation":B.push(t);break;case "size":t.target||p.push(t)}G=(w=!!n.length&&n[n.length-1])?g.getColor(w,b,a):null;x=(H=!!l.length&&l[l.length-1])?g.getOpacity(H,b,a):null;null!=c&&(x=null!=x?x*c:c);y.applyColorToSymbol(d,G,x);if(!p.length)return[3,13];I=g.getAllSizes(p,b,a);return[4,y.applySizesToSymbol(d,I)];case 12:q.sent(),q.label=13;case 13:A=0;for(D=B;A<D.length;A++)E=D[A],y.applyRotationToSymbol(d,g.getRotationAngle(E,b,a),E.axis);return[2,d]}})})}});