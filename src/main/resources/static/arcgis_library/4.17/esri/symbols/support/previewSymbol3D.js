// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../assets ../../core/colorUtils ../../core/compilerUtils ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./styleUtils ./utils".split(" "),function(na,u,z,D,E,F,G,aa,r,x,v,H,ba,ca,n,N,da,I){function B(b){var a=b.outline,c=r.isSome(b.material)?b.material.color:null,c=r.isSome(c)?c.toRgba().toString():null;if(r.isNone(a))return"fill"===
b.type&&"255,255,255,1"===c?{color:"#bdc3c7",width:.75}:null;b=v.pt2px(a.size)||0;return{color:"rgba("+(r.isSome(a.color)?a.color.toRgba():"255,255,255,1")+")",width:Math.min(b,80)}}function ea(b,a){var c=a&&a.resource,c=c&&c.href;return b.thumbnail&&b.thumbnail.url?x.resolve(b.thumbnail.url):c&&"object"!==a.type?x.resolve(I.getIconHref(b,a)):b.styleOrigin&&(b.styleOrigin.styleName||b.styleOrigin.styleUrl)?da.resolveWebStyleSymbol(b.styleOrigin,{portal:b.styleOrigin.portal},"webRef").catch(function(a){return a}).then(function(a){return a&&
a.thumbnail&&a.thumbnail.url||J}):x.resolve(J)}function S(b,a){void 0===a&&(a=1);var c=b.a;b=E.toHSV(b);a=E.toRGB({h:b.h,s:b.s/a,v:100-(100-b.v)/a});return[a.r,a.g,a.b,c]}function w(b,a){return Math.round(Math.min(Math.max(b+191.25*a,0),255))}function O(b){return"water"===b.type?r.isNone(b.color)?null:b.color:r.isNone(b.material)||r.isNone(b.material.color)?null:b.material.color}function f(b,a){void 0===a&&(a=0);b=O(b);if(!b)return a=w(H.defaultThematicColor.r,a),[a,a,a,100];b=b.toRgba();for(var c=
0;3>c;c++)b[c]=w(b[c],a);return b}function X(b,a){return z.__awaiter(this,void 0,void 0,function(){var c,e;return z.__generator(this,function(f){switch(f.label){case 0:return c=b.style,"none"===c?[2,null]:[4,H.getPatternUrlWithColor(""+fa+c+".png",a.toCss(!0))];case 1:return e=f.sent(),[2,{type:"pattern",x:0,y:0,src:e,width:5,height:5}]}})})}function Y(b){return b.outline?B(b):{color:"rgba(0, 0, 0, 1)",width:1.5}}function Z(b,a){b=O(b);if(!b)return null;var c;c="rgba("+(w(b.r,a)+",");c+=w(b.g,a)+
",";c+=w(b.b,a)+",";return c+b.a+");"}function T(b,a){a=Z(b,a);if(!a)return{};b=Math.min(b.size?v.pt2px(b.size):.75,80);return{color:a,width:b}}function y(b,a,c){c*=.75;return{type:"linear",x1:c?.25*c:0,y1:c?.5*c:0,x2:c||4,y2:c?.5*c:4,colors:[{color:b,offset:0},{color:a,offset:1}]}}function ga(b){var a=b.depth,c=b.height;return(b=b.width)&&a&&c&&b===a&&b<c}function ha(b,a,c){var e=[];if(!b)return e;switch(b.type){case "icon":var k=b.resource&&b.resource.primitive||ba.defaultPrimitive;switch(k){case "circle":e.push({shape:{type:"circle",
cx:0,cy:0,r:.5*a},fill:f(b,0),stroke:B(b)});break;case "square":e.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[0,0]},{command:"L",values:[a,0]},{command:"L",values:[a,a]},{command:"Z",values:[]}]},fill:f(b,0),stroke:B(b)});break;case "triangle":e.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[.5*a,0]},{command:"L",values:[a,a]},{command:"Z",values:[]}]},fill:f(b,0),stroke:B(b)});break;case "cross":e.push({shape:{type:"path",path:[{command:"M",
values:[.5*a,0]},{command:"L",values:[.5*a,a]},{command:"M",values:[0,.5*a]},{command:"L",values:[a,.5*a]}]},stroke:Y(b)});break;case "x":e.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,a]},{command:"M",values:[a,0]},{command:"L",values:[0,a]}]},stroke:Y(b)});break;case "kite":e.push({shape:{type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[.5*a,0]},{command:"L",values:[a,.5*a]},{command:"L",values:[.5*a,a]},{command:"Z",values:[]}]},fill:f(b,
0),stroke:B(b)});break;default:F.neverReached(k)}break;case "object":switch(k=b.resource&&b.resource.primitive||ca.defaultPrimitive,k){case "cone":k=f(b,0);b=f(b,-.6);b=y(k,b,c?20:a);a=n.getConeShapes(a,c);e.push({shape:a[0],fill:b});e.push({shape:a[1],fill:b});break;case "inverted-cone":c=f(b,0);b=f(b,-.6);b=y(c,b,a);a=n.getInvertedConeShapes(a);e.push({shape:a[0],fill:b});e.push({shape:a[1],fill:c});break;case "cube":a=n.getCubeShapes(a,c);e.push({shape:a[0],fill:f(b,0)});e.push({shape:a[1],fill:f(b,
-.3)});e.push({shape:a[2],fill:f(b,-.5)});break;case "cylinder":var k=f(b,0),ia=f(b,-.6),k=y(k,ia,c?20:a);a=n.getCylinderShapes(a,c);e.push({shape:a[0],fill:k});e.push({shape:a[1],fill:k});e.push({shape:a[2],fill:f(b,0)});break;case "diamond":a=n.getDiamondShapes(a);e.push({shape:a[0],fill:f(b,-.3)});e.push({shape:a[1],fill:f(b,0)});e.push({shape:a[2],fill:f(b,-.3)});e.push({shape:a[3],fill:f(b,-.7)});break;case "sphere":c=f(b,0);b=f(b,-.6);b=y(c,b);b.x1=0;b.y1=0;b.x2=.25*a;b.y2=.25*a;e.push({shape:{type:"circle",
cx:0,cy:0,r:.5*a},fill:b});break;case "tetrahedron":a=n.getTetrahedronShapes(a);e.push({shape:a[0],fill:f(b,-.3)});e.push({shape:a[1],fill:f(b,0)});e.push({shape:a[2],fill:f(b,-.6)});break;default:F.neverReached(k)}}return e}function ja(b,a){var c=a&&a.size?v.pt2px(a.size):null,e=a&&a.maxSize?v.pt2px(a.maxSize):null,f=a&&a.disableUpsampling,n=b.symbolLayers,p=[],l=0,q=0,d=n.getItemAt(n.length-1),m;d&&"icon"===d.type&&(m=d.size&&v.pt2px(d.size));n.forEach(function(d){if("icon"===d.type||"object"===
d.type){var t="icon"===d.type?d.size&&v.pt2px(d.size):0,h=c||t?Math.ceil(Math.min(c||t,e||120)):22;if(d&&d.resource&&d.resource.href){var g=ea(b,d).then(function(a){var b=d.get("material.color"),c;c="icon"===d.type?"multiply":"tint";return N.tintImageWithColor(a,h,b,c,f)}).then(function(a){var b=a.width,c=a.height;l=Math.max(l,b);q=Math.max(q,c);return[{shape:{type:"image",x:0,y:0,width:b,height:c,src:a.url},fill:null,stroke:null}]});p.push(g)}else g=h,"icon"===d.type&&m&&c&&(g=t/m*h),t=a&&"tall"===
a.symbolConfig||("object"===d.type?ga(d):!1),l=Math.max(l,t?20:g),q=Math.max(q,g),p.push(x.resolve(ha(d,g,t)))}});return x.eachAlways(p).then(function(b){var c=[];b.forEach(function(a){a.value?c.push(a.value):a.error&&ka.warn("error while building swatchInfo!",a.error)});return N.renderSymbol(c,[l,q],{node:a&&a.node,scale:!1,opacity:a&&a.opacity})})}function la(b,a){var c=b.symbolLayers,e=[];b=I.isVolumetricSymbol(b);var k=a&&a.size?v.pt2px(a.size):null,r=(a&&a.maxSize?v.pt2px(a.maxSize):null)||80,
p=0,l=0,q;c.forEach(function(a,b){if(a&&("line"===a.type||"path"===a.type)){var c=[];switch(a.type){case "line":var d=T(a,0),h=d&&d.width||0;0===b&&(q=h);var g=Math.min(k||h,r);b=0===b?g:k?h/q*g:g;l=Math.max(l,b);p=Math.max(p,20<b?2*b:40);d.width=b;c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[p,.5*l]}]},stroke:d});break;case "path":b=Math.min(k||22,r);h=f(a,0);g=f(a,-.2);d=(d=Z(a,-.4))?{color:d,width:1}:{};if("quad"===a.profile){var m=a.width||a.size;a=a.height||
a.size;a=n.getPathSymbolShapes(m&&a?m/a:1);d=z.__assign(z.__assign({},d),{join:"bevel"});c.push({shape:a[0],fill:g,stroke:d});c.push({shape:a[1],fill:g,stroke:d});c.push({shape:a[2],fill:h,stroke:d})}else c.push({shape:n.shapes.pathSymbol3DLayer[0],fill:g,stroke:d}),c.push({shape:n.shapes.pathSymbol3DLayer[1],fill:h,stroke:d});p=l=Math.max(l,b)}e.push(c)}});return x.resolve(N.renderSymbol(e,[p,l],{node:a&&a.node,scale:b,opacity:a&&a.opacity}))}function ma(b,a){return z.__awaiter(this,void 0,void 0,
function(){var c,e,k,u,p,l,q,d,m,w,t,h,g,y,D,E,C,U,K,A,F,G,L,P,V,W,Q,H,I,J,R;return z.__generator(this,function(M){switch(M.label){case 0:c=b.type,e="mesh-3d"===c,k=b.symbolLayers,u=a&&a.size?v.pt2px(a.size):null,p=a&&a.maxSize?v.pt2px(a.maxSize):null,l=u||22,q=[],m=d=0,w=!1,t=0,M.label=1;case 1:if(!(t<k.length))return[3,10];h=k.getItemAt(t);g=[];if(e&&"fill"!==h.type)return[3,9];y=n.shapes.fill[0];D=h.type;switch(D){case "fill":return[3,2];case "line":return[3,5];case "extrude":return[3,6];case "water":return[3,
7]}return[3,8];case 2:return E=B(h),C=Math.min(l,p||120),d=Math.max(d,C),m=Math.max(m,C),w=!0,U=f(h,0),K="pattern"in h&&h.pattern,A=O(h),!e&&r.isSome(K)&&"style"===K.type&&"solid"!==K.style&&A?[4,X(K,A)]:[3,4];case 3:U=M.sent(),M.label=4;case 4:return g.push({shape:y,fill:U,stroke:E}),[3,8];case 5:return F=T(h,0),G={stroke:F,shape:y},d=Math.max(d,22),m=Math.max(m,22),g.push(G),[3,8];case 6:return L=z.__assign({join:"round"},T(h,-.4)),P=f(h,0),V=f(h,-.2),W=Math.min(l,p||120),Q=n.getExtrudeSymbolShapes(W),
L.width=1,g.push({shape:Q[0],fill:V,stroke:L}),g.push({shape:Q[1],fill:V,stroke:L}),g.push({shape:Q[2],fill:P,stroke:L}),H=22*.7+.5*W,d=Math.max(d,22),m=Math.max(m,H),[3,8];case 7:return A=O(h),P=S(A),I=S(A,2),J=S(A,3),R=n.getWaterSymbolShapes(),w=!0,g.push({shape:R[0],fill:P}),g.push({shape:R[1],fill:I}),g.push({shape:R[2],fill:J}),C=Math.min(l,p||120),d=Math.max(d,C),m=Math.max(m,C),[3,8];case 8:q.push(g),M.label=9;case 9:return t++,[3,1];case 10:return[2,x.resolve(N.renderSymbol(q,[d,m],{node:a&&
a.node,scale:w,opacity:a&&a.opacity}))]}})})}Object.defineProperty(u,"__esModule",{value:!0});u.previewSymbol3D=u.getPatternDescriptor=u.getSymbolLayerFill=void 0;var fa=D.getAssetUrl("esri/symbols/patterns/"),J=D.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png"),ka=aa.getLogger("esri.symbols.support.previewSymbol3D");u.getSymbolLayerFill=f;u.getPatternDescriptor=X;u.previewSymbol3D=function(b,a){if(0===b.symbolLayers.length)return x.reject(new G("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));
var c=null;switch(b.type){case "point-3d":c=ja(b,a);break;case "line-3d":c=la(b,a);break;case "polygon-3d":case "mesh-3d":c=ma(b,a)}return c?c:x.reject(new G("symbolPreview: swatchInfo3D","symbol not supported."))}});