// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/SetUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),function(G,g,f,k,C,v,w,D,E){function x(a,c){return f.__awaiter(this,void 0,void 0,function(){var b;return f.__generator(this,function(e){switch(e.label){case 0:return[4,k.result(a.resource.portalItem.addResource(a.resource,a.content,c))];case 1:b=e.sent();if(!0===b.ok)a.finish&&a.finish(a.resource);else throw a.error&&a.error(b.error),
b.error;return[2]}})})}function F(a,c){return f.__awaiter(this,void 0,void 0,function(){var b;return f.__generator(this,function(e){switch(e.label){case 0:return[4,k.result(a.resource.update(a.content,c))];case 1:b=e.sent();if(!0===b.ok)a.finish(a.resource);else throw a.error(b.error),b.error;return[2]}})})}Object.defineProperty(g,"__esModule",{value:!0});g.saveResources=void 0;g.saveResources=function(a,c,b){return f.__awaiter(this,void 0,void 0,function(){var e,g,n,h,l,p,d,k,y,z,A,q,m,r,t,B,u;return f.__generator(this,
function(f){switch(f.label){case 0:if(!c||!c.resources)return[2];e=c.portalItem===a.portalItem?w.SetFromValues(a.paths):new Set;a.paths.length=0;a.portalItem=c.portalItem;g=w.SetFromValues(c.resources.toKeep.map(function(a){return a.resource.path}));n=new Set;h=[];g.forEach(function(b){e.delete(b);a.paths.push(b)});l=0;for(p=c.resources.toUpdate;l<p.length;l++)d=p[l],e.delete(d.resource.path),g.has(d.resource.path)||n.has(d.resource.path)?(k=d.resource,y=d.content,z=d.finish,A=d.error,q=E.getSiblingOfSameTypeI(k,
D.generateUUID()),a.paths.push(q.path),h.push(x({resource:q,content:y,finish:z,error:A},b))):(a.paths.push(d.resource.path),h.push(F(d,b)),n.add(d.resource.path));m=0;for(r=c.resources.toAdd;m<r.length;m++)t=r[m],h.push(x(t,b)),a.paths.push(t.resource.path);e.forEach(function(a){a=c.portalItem.resourceFromPath(a);h.push(a.portalItem.removeResource(a).catch(function(){}))});return 0===h.length?[2]:[4,v.eachAlways(h)];case 1:B=f.sent();v.throwIfAborted(b);u=B.filter(function(a){return"error"in a}).map(function(a){return a.error});
if(0<u.length)throw new C("save:resources","Failed to save one or more resources",{errors:u});return[2]}})})}});