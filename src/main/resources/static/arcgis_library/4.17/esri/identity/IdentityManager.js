// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
require({cache:{"esri/identity/IdentityManagerBase":function(){define("require exports tslib ../config ../kernel ../request ../core/cookie ../core/Error ../core/Evented ../core/global ../core/lang ../core/object ../core/promiseUtils ../core/string ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ./IdentityForm ./IdentityModal ./OAuthCredential ./OAuthInfo ./ServerInfo".split(" "),function(t,u,f,k,b,l,h,p,m,y,A,C,w,G,r,z,v,M,H,I,J,E){Object.defineProperty(u,"__esModule",{value:!0});
u.Credential=u.IdentityManagerBase=void 0;var D={},K=function(b){var e=(new z.Url(b.owningSystemUrl)).host;b=(new z.Url(b.server)).host;var a=/.+\.arcgis\.com$/i;return a.test(e)&&a.test(b)},F=function(b,e){return!!(K(b)&&e&&e.some(function(a){return a.test(b.server)}))};t=function(b){function e(){var a=b.call(this)||this;a._portalConfig=y.esriGeowConfig;a.serverInfos=[];a.oAuthInfos=[];a.credentials=[];a._soReqs=[];a._xoReqs=[];a._portals=[];a.defaultOAuthInfo=null;a.defaultTokenValidity=60;a.dialog=
null;a.formConstructor=M;a.tokenValidity=null;a.signInPage=null;a.useSignInPage=!0;a.normalizeWebTierAuth=!1;a._busy=null;a._rejectOnPersistedPageShow=!1;a._oAuthHash=null;a._gwTokenUrl="/sharing/rest/generateToken";a._agsRest="/rest/services";a._agsPortal=/\/sharing(\/|$)/i;a._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i;a._adminSvcs=/\/rest\/admin\/services(\/|$)/i;a._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},
{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},
{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}];a._legacyFed=[];a._regexSDirUrl=/http.+\/rest\/services\/?/gi;a._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi;
a._gwUser=/http.+\/users\/([^\/]+)\/?.*/i;a._gwItem=/http.+\/items\/([^\/]+)\/?.*/i;a._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i;a._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i;a._createDefaultOAuthInfo=!0;a._hasTestedIfAppIsOnPortal=!1;a._getOAuthHash();window.addEventListener("pageshow",function(c){a._pageShowHandler(c)});return a}f.__extends(e,b);e.prototype.registerServers=function(a){var c=this,d=this.serverInfos;d?(a=a.filter(function(a){return!c.findServerInfo(a.server)}),this.serverInfos=
d.concat(a)):this.serverInfos=a;a.forEach(function(a){a.owningSystemUrl&&c._portals.push(a.owningSystemUrl);a.hasPortal&&c._portals.push(a.server)})};e.prototype.registerOAuthInfos=function(a){var c=this,d=this.oAuthInfos;d?(a=a.filter(function(a){return!c.findOAuthInfo(a.portalUrl)}),this.oAuthInfos=d.concat(a)):this.oAuthInfos=a};e.prototype.registerToken=function(a){a=f.__assign({},a);var c=this._sanitizeUrl(a.server),d=this._isServerRsrc(c),g=this.findServerInfo(c),n=!0,b;g||(g=new E,g.server=
this._getServerInstanceRoot(c),d?g.hasServer=!0:(g.tokenServiceUrl=this._getTokenSvcUrl(c),g.hasPortal=!0),this.registerServers([g]));(b=this._findCredential(c))?(delete a.server,A.mixin(b,a),n=!1):(b=new x({userId:a.userId,server:g.server,token:a.token,expires:a.expires,ssl:a.ssl,scope:d?"server":"portal"}),b.resources=[c],this.credentials.push(b));b.emitTokenChange(!1);n||b.refreshServerTokens()};e.prototype.toJSON=function(){return A.fixJson({serverInfos:this.serverInfos.map(function(a){return a.toJSON()}),
oAuthInfos:this.oAuthInfos.map(function(a){return a.toJSON()}),credentials:this.credentials.map(function(a){return a.toJSON()})})};e.prototype.initialize=function(a){var c=this;if(a){"string"===typeof a&&(a=JSON.parse(a));var d=a.serverInfos,g=a.oAuthInfos;a=a.credentials;if(d){var n=[];d.forEach(function(a){a.server&&a.tokenServiceUrl&&n.push(a.declaredClass?a:new E(a))});n.length&&this.registerServers(n)}if(g){var b=[];g.forEach(function(a){a.appId&&b.push(a.declaredClass?a:new J(a))});b.length&&
this.registerOAuthInfos(b)}a&&a.forEach(function(a){a.server&&a.token&&a.expires&&a.expires>Date.now()&&(a=a.declaredClass?a:new x(a),a.emitTokenChange(),c.credentials.push(a))})}};e.prototype.findServerInfo=function(a){var c;a=this._sanitizeUrl(a);for(var d=0,g=this.serverInfos;d<g.length;d++){var n=g[d];if(this._hasSameServerInstance(n.server,a)){c=n;break}}return c};e.prototype.findOAuthInfo=function(a){var c;a=this._sanitizeUrl(a);for(var d=0,g=this.oAuthInfos;d<g.length;d++){var n=g[d];if(this._hasSameServerInstance(n.portalUrl,
a)){c=n;break}}return c};e.prototype.findCredential=function(a,c){var d,g;a=this._sanitizeUrl(a);g=this._isServerRsrc(a)?"server":"portal";if(c)for(var n=0,b=this.credentials;n<b.length;n++){var e=b[n];if(this._hasSameServerInstance(e.server,a)&&c===e.userId&&e.scope===g){d=e;break}}else for(c=0,n=this.credentials;c<n.length;c++)if(e=n[c],this._hasSameServerInstance(e.server,a)&&-1!==this._getIdenticalSvcIdx(a,e)&&e.scope===g){d=e;break}return d};e.prototype.getCredential=function(a,c){var d,g,n=
!0;c&&(d=!!c.token,g=c.error,n=!1!==c.prompt);c=f.__assign({},c);a=this._sanitizeUrl(a);var b=w.createAbortController(),e=w.createResolver();if(c.signal)w.onAbort(c.signal,function(){b.abort()});w.onAbort(b,function(){e.reject(new p("identity-manager:user-aborted","ABORTED"))});if(w.isAborted(b))return e.promise;c.signal=b.signal;var m=this._isAdminResource(a),k=d&&this._doPortalSignIn(a)?this._getEsriAuthCookie():null;if((d=d?this.findCredential(a):null)&&g&&g.details&&498===g.details.httpStatus)d.destroy(),
k&&k.token===c.token&&(h.writeCookie("esri_auth",null,{expires:-1,path:"/",domain:document.domain}),G.endsWith(window.location.hostname,".arcgis.com")&&h.writeCookie("esri_auth",null,{expires:-1,path:"/",domain:"arcgis.com"}));else if(k||d)return a=new p("identity-manager:not-authorized","You are currently signed in as: '"+(k&&k.email||d&&d.userId)+"'. You do not have access to this resource: "+a,{error:g}),e.reject(a),e.promise;if(g=this._findCredential(a,c))return e.resolve(g),e.promise;g=this.findServerInfo(a);
if(g)!g.hasServer&&this._isServerRsrc(a)&&(g._restInfoPms=this._getTokenSvcUrl(a),g.hasServer=!0);else{k=this._getTokenSvcUrl(a);if(!k)return a=new p("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),e.reject(a),e.promise;g=new E;g.server=this._getServerInstanceRoot(a);"string"===typeof k?(g.tokenServiceUrl=k,g.hasPortal=!0):(g._restInfoPms=k,g.hasServer=!0);this.registerServers([g])}n&&g.hasPortal&&void 0===g._selfReq&&!this._findOAuthInfo(a)&&(g._selfReq=
{owningTenant:c&&c.owningTenant,selfDfd:this._getPortalSelf(g.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),a)});return this._enqueue(a,g,c,e,m)};e.prototype.getResourceName=function(a){return this._isRESTService(a)?a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(a)&&a.replace(this._gwUser,"$1")||this._gwItem.test(a)&&a.replace(this._gwItem,"$1")||this._gwGroup.test(a)&&a.replace(this._gwGroup,"$1")||""};e.prototype.generateToken=
function(a,c,d){var g=this._rePortalTokenSvc.test(a.tokenServiceUrl),n=new z.Url(window.location.href.toLowerCase()),b=this._getEsriAuthCookie(),e=a.shortLivedTokenValidity,h,f,q,k,m,L,y,B;c&&(B=this.tokenValidity||e||this.defaultTokenValidity,B>e&&0<e&&(B=e));d&&(f=d.isAdmin,q=d.serverUrl,k=d.token,L=d.signal,y=d.ssl,a.customParameters=d.customParameters);f?e=a.adminTokenServiceUrl:(e=a.tokenServiceUrl,m=new z.Url(e.toLowerCase()),b&&(h=(h=b.auth_tier)&&h.toLowerCase()),("web"===h||a.webTierAuth)&&
d&&d.serverUrl&&!y&&"http"===n.scheme&&(r.hasSameOrigin(n.uri,e,!0)||"https"===m.scheme&&n.host===m.host&&"7080"===n.port&&"7443"===m.port)&&(e=e.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));d=A.mixin({query:A.mixin({request:"getToken",username:c&&c.username,password:c&&c.password,serverUrl:q,token:k,expiration:B,referer:f||g?window.location.host:null,client:f?"referer":null,f:"json"},a.customParameters),method:"post",authMode:"anonymous",useProxy:this._useProxy(a,d),signal:L},d&&d.ioArgs);
g||(d.withCredentials=!1);return l(e,d).then(function(d){d=d.data;if(!d||!d.token)return new p("identity-manager:authentication-failed","Unable to generate token");var g=a.server;D[g]||(D[g]={});c&&(D[g][c.username]=c.password);d.validity=B;return d})};e.prototype.isBusy=function(){return!!this._busy};e.prototype.checkSignInStatus=function(a){return this.checkAppAccess(a,"").then(function(a){return a.credential})};e.prototype.checkAppAccess=function(a,c,d){var g=this,n=!1;return this.getCredential(a,
{prompt:!1}).then(function(b){var e,h={f:"json"};if("portal"===b.scope)if(c&&(g._doPortalSignIn(a,!0)||d&&d.force))e=b.server+"/sharing/rest/oauth2/validateAppAccess",h.client_id=c;else if(b.token)e=b.server+"/sharing/rest";else return{credential:b};else if(b.token)e=b.server+"/rest/services";else return{credential:b};b.token&&(h.token=b.token);return l(e,{query:h,authMode:"anonymous"}).then(function(a){if(!1===a.data.valid)throw new p("identity-manager:not-authorized","You are currently signed in as: '"+
b.userId+"'.");n=!!a.data.viewOnlyUserTypeApp;return{credential:b}}).catch(function(a){if("identity-manager:not-authorized"===a.name)throw a;a=a.details&&a.details.httpStatus;if(498===a)throw b.destroy(),new p("identity-manager:not-authenticated","User is not signed in.");if(400===a)throw new p("identity-manager:invalid-request");return{credential:b}})}).then(function(a){return{credential:a.credential,viewOnly:n}})};e.prototype.setOAuthResponseHash=function(a){var c=this._oAuthDfd;this._oAuthDfd=
null;if(c&&a)if(clearInterval(this._oAuthIntervalId),"#"===a.charAt(0)&&(a=a.substring(1)),a=r.queryToObject(a),a.error){var d="access_denied"===a.error;a=new p(d?"identity-manager:user-aborted":"identity-manager:authentication-failed",d?"ABORTED":"OAuth: "+a.error+" - "+a.error_description);c.reject(a)}else{var d=c.oinfo_._oAuthCred,g=new x({userId:a.username,server:c.sinfo_.server,token:a.access_token,expires:Date.now()+1E3*Number(a.expires_in),ssl:"true"===a.ssl,_oAuthCred:d});d.storage=a.persist?
window.localStorage:window.sessionStorage;d.token=g.token;d.expires=g.expires;d.userId=g.userId;d.ssl=g.ssl;d.save();c.resolve(g)}};e.prototype.setRedirectionHandler=function(a){this._redirectFunc=a};e.prototype.setOAuthRedirectionHandler=function(a){this._oAuthRedirectFunc=a};e.prototype.setProtocolErrorHandler=function(a){this._protocolFunc=a};e.prototype.signIn=function(a,c,d){var g=this;void 0===d&&(d={});var b=w.createResolver(),e=function(){var a;null===k||void 0===k?void 0:k.remove();null===
q||void 0===q?void 0:q.remove();null===m||void 0===m?void 0:m.remove();null===f||void 0===f?void 0:f.destroy();null===(a=g.dialog)||void 0===a?void 0:a.destroy();g.dialog=f=k=q=m=null},h=function(){e();g._oAuthDfd=null;b.reject(new p("identity-manager:user-aborted","ABORTED"))};if(d.signal)w.onAbort(d.signal,function(){h()});var f=new this.formConstructor;f.resource=this.getResourceName(a);f.server=c.server;this.dialog=new H;this.dialog.content=f;this.dialog.open=!0;this.emit("dialog-create");var k=
f.on("cancel",h),q=this.dialog.watch("open",h),m=f.on("submit",function(a){g.generateToken(c,a,{isAdmin:d.isAdmin,signal:d.signal}).then(function(g){e();g=new x({userId:a.username,server:c.server,token:g.token,expires:null!=g.expires?Number(g.expires):null,ssl:!!g.ssl,isAdmin:d.isAdmin,validity:g.validity});b.resolve(g)}).catch(function(a){f.error=a;f.signingIn=!1})});return b.promise};e.prototype.oAuthSignIn=function(a,c,d,g){var b=this,e=this._oAuthDfd=w.createResolver();if(null===g||void 0===g?
0:g.signal)w.onAbort(g.signal,function(){var a=b._oAuthDfd&&b._oAuthDfd.oAuthWin_;a&&!a.closed?a.close():b.dialog&&h()});e.resUrl_=a;e.sinfo_=c;e.oinfo_=d;g=!g||!1!==g.oAuthPopupConfirmation;if(!d.popup||!g)return this._doOAuthSignIn(a,c,d),e.promise;var f=new this.formConstructor;f.oAuthPrompt=!0;f.server=c.server;this.dialog=new H;this.dialog.content=f;this.dialog.open=!0;this.emit("dialog-create");var h=function(){l();b._oAuthDfd=null;e.reject(new p("identity-manager:user-aborted","ABORTED"))},
k=f.on("cancel",h),q=this.dialog.watch("open",h),m=f.on("submit",function(){l();b._doOAuthSignIn(a,c,d)}),l=function(){k.remove();q.remove();m.remove();f.destroy();b.dialog.destroy();b.dialog=null};return e.promise};e.prototype.destroyCredentials=function(){this.credentials&&this.credentials.slice().forEach(function(a){a.destroy()});this.emit("credentials-destroy")};e.prototype._getOAuthHash=function(){var a=window.location.hash;if(a){"#"===a.charAt(0)&&(a=a.substring(1));var a=r.queryToObject(a),
c=!1;a.access_token&&a.expires_in&&a.state&&a.hasOwnProperty("username")?(a.state=JSON.parse(a.state),this._oAuthHash=a,c=!0):a.error&&a.error_description&&(console.log("IdentityManager OAuth Error: ",a.error," - ",a.error_description),"access_denied"===a.error&&(c=!0));c&&(window.location.hash="object"===typeof a.state&&a.state.hash||"")}};e.prototype._pageShowHandler=function(a){a.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(a=new p("identity-manager:user-aborted","ABORTED"),this._errbackFunc(a))};
e.prototype._findCredential=function(a,c){var d=this,g=-1,b,e,f,h=c&&c.token;c=c&&c.resource;var k=this._isServerRsrc(a)?"server":"portal",q=this.credentials.filter(function(c){return d._hasSameServerInstance(c.server,a)&&c.scope===k});a=c||a;if(q.length)if(1===q.length)if(c=q[0],e=(b=(f=this.findServerInfo(c.server))&&f.owningSystemUrl)&&this.findCredential(b,c.userId),g=this._getIdenticalSvcIdx(a,c),h)-1!==g&&(c.resources.splice(g,1),this._removeResource(a,e));else return-1===g&&c.resources.push(a),
this._addResource(a,e),c;else{var m,p;q.some(function(c){p=d._getIdenticalSvcIdx(a,c);return-1!==p?(m=c,e=(b=(f=d.findServerInfo(m.server))&&f.owningSystemUrl)&&d.findCredential(b,m.userId),g=p,!0):!1});if(h)m&&(m.resources.splice(g,1),this._removeResource(a,e));else if(m)return this._addResource(a,e),m}};e.prototype._findOAuthInfo=function(a){var c=this.findOAuthInfo(a);if(!c)for(var d=0,g=this.oAuthInfos;d<g.length;d++){var b=g[d];if(this._isIdProvider(b.portalUrl,a)){c=b;break}}return c};e.prototype._addResource=
function(a,c){c&&-1===this._getIdenticalSvcIdx(a,c)&&c.resources.push(a)};e.prototype._removeResource=function(a,c){var d=-1;c&&(d=this._getIdenticalSvcIdx(a,c),-1<d&&c.resources.splice(d,1))};e.prototype._useProxy=function(a,c){return c&&c.isAdmin&&!r.hasSameOrigin(a.adminTokenServiceUrl,window.location.href)||!this._isPortalDomain(a.tokenServiceUrl)&&"10.1"===String(a.currentVersion)&&!r.hasSameOrigin(a.tokenServiceUrl,window.location.href)};e.prototype._getOrigin=function(a){a=new z.Url(a);return a.scheme+
"://"+a.host+(null!=a.port?":"+a.port:"")};e.prototype._getServerInstanceRoot=function(a){var c=a.toLowerCase(),d=c.indexOf(this._agsRest);-1===d&&this._isAdminResource(a)&&(d=this._agsAdmin.test(a)?a.replace(this._agsAdmin,"$1").length:a.search(this._adminSvcs));-1===d&&(d=c.indexOf("/sharing"));-1===d&&"/"===c.substr(-1)&&(d=c.length-1);return-1<d?a.substring(0,d):a};e.prototype._hasSameServerInstance=function(a,c){"/"===a.substr(-1)&&(a=a.slice(0,-1));a=a.toLowerCase();c=this._getServerInstanceRoot(c).toLowerCase();
a=this._normalizeAGOLorgDomain(a);c=this._normalizeAGOLorgDomain(c);a=a.substr(a.indexOf(":"));c=c.substr(c.indexOf(":"));return a===c};e.prototype._normalizeAGOLorgDomain=function(a){var c=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,d=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,g=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;c.test(a)?a=a.replace(c,"https://www.arcgis.com"):d.test(a)?a=a.replace(d,"https://devext.arcgis.com"):g.test(a)&&(a=a.replace(g,"https://qaext.arcgis.com"));
return a};e.prototype._sanitizeUrl=function(a){var c=(k.request.proxyUrl||"").toLowerCase(),d=c?a.toLowerCase().indexOf(c+"?"):-1;-1!==d&&(a=a.substring(d+c.length+1));a=r.normalize(a);return r.urlToObject(a).path};e.prototype._isRESTService=function(a){return-1<a.indexOf(this._agsRest)};e.prototype._isAdminResource=function(a){return this._agsAdmin.test(a)||this._adminSvcs.test(a)};e.prototype._isServerRsrc=function(a){return this._isRESTService(a)||this._isAdminResource(a)};e.prototype._isIdenticalService=
function(a,c){var d;this._isRESTService(a)&&this._isRESTService(c)?(a=this._getSuffix(a).toLowerCase(),c=this._getSuffix(c).toLowerCase(),d=a===c,d||(d=/(.*)\/(MapServer|FeatureServer).*/gi,d=a.replace(d,"$1")===c.replace(d,"$1"))):this._isAdminResource(a)&&this._isAdminResource(c)?d=!0:this._isServerRsrc(a)||this._isServerRsrc(c)||!this._isPortalDomain(a)||(d=!0);return d};e.prototype._isPortalDomain=function(a){var c=this,d=new z.Url(a.toLowerCase());a=this._portalConfig;var g=this._gwDomains.some(function(a){return a.regex.test(d.uri)});
!g&&a&&(g=this._hasSameServerInstance(this._getServerInstanceRoot(a.restBaseUrl),d.uri));g||k.portalUrl&&(g=r.hasSameOrigin(d,k.portalUrl,!0));g||(g=this._portals.some(function(a){return c._hasSameServerInstance(a,d.uri)}));return g=g||this._agsPortal.test(d.path)};e.prototype._isIdProvider=function(a,c){var d=-1,g=-1;this._gwDomains.forEach(function(b,e){-1===d&&b.regex.test(a)&&(d=e);-1===g&&b.regex.test(c)&&(g=e)});var b=!1;if(-1<d&&-1<g)if(0===d||4===d){if(0===g||4===g)b=!0}else if(1===d){if(1===
g||2===g)b=!0}else 2===d?2===g&&(b=!0):3===d&&3===g&&(b=!0);if(!b){var e=this.findServerInfo(c),f=e&&e.owningSystemUrl;f&&K(e)&&this._isPortalDomain(f)&&this._isIdProvider(a,f)&&(b=!0)}return b};e.prototype._getIdenticalSvcIdx=function(a,c){for(var d=-1,g=0;g<c.resources.length;g++)if(this._isIdenticalService(a,c.resources[g])){d=g;break}return d};e.prototype._getSuffix=function(a){return a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")};e.prototype._getTokenSvcUrl=function(a){var c=
this,d,g;if(this._isRESTService(a)||this._isAdminResource(a))return g=this._getServerInstanceRoot(a),d=g+"/admin/generateToken",a=g+"/rest/info",g=l(a,{query:{f:"json"}}).then(function(a){return a.data}),{adminUrl:d,promise:g};if(this._isPortalDomain(a)){var b="";this._gwDomains.some(function(c){c.regex.test(a)&&(b=c.tokenServiceUrl);return!!b});b||this._portals.some(function(d){c._hasSameServerInstance(d,a)&&(b=d+c._gwTokenUrl);return!!b});b||(d=a.toLowerCase().indexOf("/sharing"),-1!==d&&(b=a.substring(0,
d)+this._gwTokenUrl));b||(b=this._getOrigin(a)+this._gwTokenUrl);b&&(d=(new z.Url(a)).port,/^http:\/\//i.test(a)&&"7080"===d&&(b=b.replace(/:7080/i,":7443")),b=b.replace(/http:/i,"https:"));return b}if(-1!==a.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"};e.prototype._exchangeToken=function(a,c,d){return l(a+"/sharing/rest/oauth2/exchangeToken",{authMode:"anonymous",method:"post",query:{f:"json",client_id:c,token:d}}).then(function(a){return a.data.token})};
e.prototype._getPortalSelf=function(a,c){var d;this._gwDomains.some(function(c){c.regex.test(a)&&(d=c.customBaseUrl);return!!d});if(d)return w.resolve({allSSL:!0,currentVersion:"4.4",customBaseUrl:d,portalMode:"multitenant",supportsOAuth:!0});"https:"===window.location.protocol?a=a.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(c)&&(a=a.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));return l(a,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(function(a){return a.data})};
e.prototype._hasPortalSession=function(){return!!this._getEsriAuthCookie()};e.prototype._getEsriAuthCookie=function(){var a=null;if(navigator.cookieEnabled){for(var c=this._getAllCookies("esri_auth"),d=void 0,g=0;g<c.length;g++){var b=JSON.parse(c[g]);if(b.portalApp){a=b;break}d?d.push(b):d=[b]}if(!a&&d)for(c=0;c<d.length;c++)if(b=d[c],b.urlKey&&window.location.hostname===b.urlKey.toLowerCase()+"."+b.customBaseUrl){a=b;break}}a&&(b=null,a.expires&&("number"===typeof a.expires?b=a.expires:"string"===
typeof a.expires&&(b=Date.parse(a.expires)),isNaN(b)&&(b=null),a.expires=b),b&&b<Date.now()&&(a=null));return a};e.prototype._getAllCookies=function(a){var c=[];if(a=document.cookie.match(new RegExp("(?:^|; )"+G.escapeRegExpString(a)+"\x3d([^;]*)","g")))for(var d=0;d<a.length;d++){var b=a[d],e=b.indexOf("\x3d");-1<e&&(b=b.substring(e+1),c.push(decodeURIComponent(b)))}return c};e.prototype._doPortalSignIn=function(a,c){if(navigator.cookieEnabled){var d=this._getEsriAuthCookie(),b=this._portalConfig,
e=window.location.href,f=this.findServerInfo(a);if((c||this.useSignInPage)&&(b||this._isPortalDomain(e)||d)&&(f?f.hasPortal||f.owningSystemUrl&&this._isPortalDomain(f.owningSystemUrl):this._isPortalDomain(a))&&(this._isIdProvider(e,a)||b&&(this._hasSameServerInstance(this._getServerInstanceRoot(b.restBaseUrl),a)||this._isIdProvider(b.restBaseUrl,a))||r.hasSameOrigin(e,a,!0)))return!0}return!1};e.prototype._canUsePortalSignInWorkflow=function(a){return this._doPortalSignIn(a)&&(window===window.top||
this._hasPortalSession())};e.prototype._checkProtocol=function(a,c,d,b){var g=!0;b=b?c.adminTokenServiceUrl:c.tokenServiceUrl;0===b.trim().toLowerCase().indexOf("https:")&&0!==window.location.href.toLowerCase().indexOf("https:")&&r.getProxyRule(b)&&(g=this._protocolFunc?!!this._protocolFunc({resourceUrl:a,serverInfo:c}):!1,g||(a=new p("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection."),d(a)));return g};e.prototype._enqueue=function(a,c,d,b,
e,f){b||(b=w.createResolver());b.resUrl_=a;b.sinfo_=c;b.options_=d;b.admin_=e;b.refresh_=f;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(a),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(b)):this._xoReqs.push(b):this._doSignIn(b);return b.promise};e.prototype._doSignIn=function(a){var c=this;this._busy=a;this._rejectOnPersistedPageShow=!1;var b=function(b){var d=a.options_&&a.options_.resource,g=a.resUrl_,e=a.refresh_,
f=!1;-1===c.credentials.indexOf(b)&&(e&&-1!==c.credentials.indexOf(e)?(e.userId=b.userId,e.token=b.token,e.expires=b.expires,e.validity=b.validity,e.ssl=b.ssl,e.creationTime=b.creationTime,f=!0,b=e):c.credentials.push(b));b.resources||(b.resources=[]);b.resources.push(d||g);b.scope=c._isServerRsrc(g)?"server":"portal";b.emitTokenChange();var d=c._soReqs,h={};c._soReqs=[];d.forEach(function(a){if(!c._isIdenticalService(g,a.resUrl_)){var d=c._getSuffix(a.resUrl_);h[d]||(h[d]=!0,b.resources.push(a.resUrl_))}});
a.resolve(b);d.forEach(function(a){c._hasSameServerInstance(c._getServerInstanceRoot(g),a.resUrl_)?a.resolve(b):c._soReqs.push(a)});c._busy=a.resUrl_=a.sinfo_=a.refresh_=null;f||c.emit("credential-create",{credential:b});c._soReqs.length?c._doSignIn(c._soReqs.shift()):c._xoReqs.length&&c._doSignIn(c._xoReqs.shift())},g=function(b){a.reject(b);c._busy=a.resUrl_=a.sinfo_=a.refresh_=null;c._soReqs.length?c._doSignIn(c._soReqs.shift()):c._xoReqs.length&&c._doSignIn(c._xoReqs.shift())},e=function(d,e,
f,h){var m=a.sinfo_,k=!a.options_||!1!==a.options_.prompt,q=m.hasPortal&&c._findOAuthInfo(a.resUrl_),l;if(c._canUsePortalSignInWorkflow(a.resUrl_))e=c._getEsriAuthCookie(),d=c._portalConfig,e?(m.webTierAuth||"web"!==(e.auth_tier&&e.auth_tier.toLowerCase())||(m.webTierAuth=!0),l=new x({userId:e.email,server:m.server,token:m.webTierAuth?null:e.token,expires:e.expires}),l.token?a._pendingDfd=c._exchangeToken(l.server,q?q.appId:"arcgisonline",l.token).then(function(a){l.token=a;b(l)}).catch(function(){b(l)}):
b(l)):k?(k="",q=window.location.href,k=c.signInPage?c.signInPage:d?d.baseUrl+d.signin:c._isIdProvider(q,a.resUrl_)?c._getOrigin(q)+"/home/signin.html":m.tokenServiceUrl.replace(c._rePortalTokenSvc,"")+"/home/signin.html",k=k.replace(/http:/i,"https:"),d&&!1===d.useSSL&&(k=k.replace(/https:/i,"http:")),0===q.toLowerCase().replace("https","http").indexOf(k.toLowerCase().replace("https","http"))?(m=new p("identity-manager:unexpected-error","Cannot redirect to Sign-In page from within Sign-In page. URL of the resource that triggered this workflow: "+
a.resUrl_),g(m)):(c._rejectOnPersistedPageShow=!0,c._redirectFunc?c._redirectFunc({signInPage:k,returnUrlParamName:"returnUrl",returnUrl:q,resourceUrl:a.resUrl_,serverInfo:m}):window.location.href=k+"?returnUrl\x3d"+encodeURIComponent(q))):(m=new p("identity-manager:not-authenticated","User is not signed in."),g(m));else if(d)b(new x({userId:d,server:m.server,token:f,expires:null!=h?Number(h):null,ssl:!!e}));else if(q){var n=q._oAuthCred;n||(d=new I(q,window.localStorage),e=new I(q,window.sessionStorage),
d.isValid()&&e.isValid()?d.expires>e.expires?(n=d,e.destroy()):(n=e,d.destroy()):n=d.isValid()?d:e,q._oAuthCred=n);n.isValid()?(l=new x({userId:n.userId,server:m.server,token:n.token,expires:n.expires,ssl:n.ssl,_oAuthCred:n}),q.appId!==n.appId&&c._doPortalSignIn(a.resUrl_,!0)?a._pendingDfd=c._exchangeToken(l.server,q.appId,l.token).then(function(a){l.token=a;n.token=a;n.save();b(l)}).catch(function(){b(l)}):b(l)):c._oAuthHash&&c._oAuthHash.state.portalUrl===q.portalUrl?(k=c._oAuthHash,l=new x({userId:k.username,
server:m.server,token:k.access_token,expires:Date.now()+1E3*Number(k.expires_in),ssl:"true"===k.ssl,oAuthState:k.state,_oAuthCred:n}),n.storage=k.persist?window.localStorage:window.sessionStorage,n.token=l.token,n.expires=l.expires,n.userId=l.userId,n.ssl=l.ssl,n.save(),c._oAuthHash=null,b(l)):k?a._pendingDfd=c.oAuthSignIn(a.resUrl_,m,q,a.options_).then(b,g):(m=new p("identity-manager:not-authenticated","User is not signed in."),g(m))}else k?c._checkProtocol(a.resUrl_,m,g,a.admin_)&&(k=a.options_,
a.admin_&&(k=k||{},k.isAdmin=!0),a._pendingDfd=c.signIn(a.resUrl_,m,k).then(b,g)):(m=new p("identity-manager:not-authenticated","User is not signed in."),g(m))},f=function(){var d=a.sinfo_,e=d.owningSystemUrl,f=a.options_,k,h,m,l;f&&(k=f.token,h=f.error,m=f.prompt);l=c._findCredential(e,{token:k,resource:a.resUrl_});if(!l)for(var f=0,p=c.credentials;f<p.length;f++){var n=p[f];if(c._isIdProvider(e,n.server)){l=n;break}}l?(e=c.findCredential(a.resUrl_,l.userId))?b(e):F(d,c._legacyFed)?(n=l.toJSON(),
n.server=d.server,n.resources=null,b(new x(n))):(a._pendingDfd=c.generateToken(c.findServerInfo(l.server),null,{serverUrl:a.resUrl_,token:l.token,signal:a.options_.signal,ssl:l.ssl})).then(function(c){b(new x({userId:l.userId,server:d.server,token:c.token,expires:null!=c.expires?Number(c.expires):null,ssl:!!c.ssl,isAdmin:a.admin_,validity:c.validity}))},g):(c._busy=null,k&&(a.options_.token=null),(a._pendingDfd=c.getCredential(e.replace(/\/?$/,"/sharing"),{resource:a.resUrl_,owningTenant:d.owningTenant,
signal:a.options_.signal,token:k,error:h,prompt:m})).then(function(){c._enqueue(a.resUrl_,a.sinfo_,a.options_,a,a.admin_)},function(a){g(a)}))};this._errbackFunc=g;var h=a.sinfo_.owningSystemUrl,m=this._isServerRsrc(a.resUrl_),k=a.sinfo_._restInfoPms;k?k.promise.then(function(b){var d=a.sinfo_;d._restInfoPms&&(d.adminTokenServiceUrl=d._restInfoPms.adminUrl,d._restInfoPms=null,d.tokenServiceUrl=C.getDeepValue("authInfo.tokenServicesUrl",b)||C.getDeepValue("authInfo.tokenServiceUrl",b)||C.getDeepValue("tokenServiceUrl",
b),d.shortLivedTokenValidity=C.getDeepValue("authInfo.shortLivedTokenValidity",b),d.currentVersion=b.currentVersion,d.owningTenant=b.owningTenant,(b=d.owningSystemUrl=b.owningSystemUrl)&&c._portals.push(b));m&&d.owningSystemUrl?f():e()},function(){a.sinfo_._restInfoPms=null;var c=new p("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");g(c)}):m&&h?f():a.sinfo_._selfReq?a.sinfo_._selfReq.selfDfd.then(function(b){var d={},e,g,f,k;b&&(e=b.user&&
b.user.username,d.username=e,d.allSSL=b.allSSL,g=b.supportsOAuth,f=b.currentVersion,"multitenant"===b.portalMode&&(k=b.customBaseUrl));a.sinfo_.webTierAuth=!!e;return e&&c.normalizeWebTierAuth?c.generateToken(a.sinfo_,null,{ssl:d.allSSL}).catch(function(){return null}).then(function(a){d.portalToken=a&&a.token;d.tokenExpiration=a&&a.expires;return d}):!e&&g&&4.4<=parseFloat(f)&&!c._canUsePortalSignInWorkflow(a.resUrl_)?c._generateOAuthInfo({portalUrl:a.sinfo_.server,customBaseUrl:k,owningTenant:a.sinfo_._selfReq.owningTenant}).catch(function(){return null}).then(function(){return d}):
d}).catch(function(){return null}).then(function(c){a.sinfo_._selfReq=null;c?e(c.username,c.allSSL,c.portalToken,c.tokenExpiration):e()}):e()};e.prototype._generateOAuthInfo=function(a){var c=this,b,e=a.portalUrl,f=a.customBaseUrl,k=a.owningTenant;if(a=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){b=window.location.href;var h=b.indexOf("?");-1<h&&(b=b.slice(0,h));h=b.search(/\/(apps|home)\//);b=-1<h?b.slice(0,h):null}a&&b?(this._hasTestedIfAppIsOnPortal=!0,
a=l(b+"/sharing/rest",{query:{f:"json"}}).then(function(){c.defaultOAuthInfo=new J({appId:"arcgisonline",popup:!0,popupCallbackUrl:b+"/home/oauth-callback.html"})})):a=w.resolve();return a.then(function(){if(c.defaultOAuthInfo)return e=e.replace(/^http:/i,"https:"),l(e+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:k,client_id:c.defaultOAuthInfo.appId,redirect_uri:r.makeAbsolute(c.defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(function(a){if(a.data.valid){var b=c.defaultOAuthInfo.clone();
b.portalUrl=a.data.urlKey&&f?"https://"+a.data.urlKey.toLowerCase()+"."+f:e;c.oAuthInfos.push(b)}})})};e.prototype._doOAuthSignIn=function(a,c,b){var d=this,e={portalUrl:b.portalUrl};!b.popup&&b.preserveUrlHash&&window.location.hash&&(e.hash=window.location.hash);e={client_id:b.appId,response_type:"token",state:JSON.stringify(e),expiration:b.expiration,locale:b.locale,redirect_uri:b.popup?r.makeAbsolute(b.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};b.forceLogin&&(e.force_login=!0);
var f=b.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",k=f+"?"+r.objectToQuery(e);if(b.popup){var h=window.open(k,"esriJSAPIOAuth",b.popupWindowFeatures);h?(h.focus(),this._oAuthDfd.oAuthWin_=h,this._oAuthIntervalId=setInterval(function(){if(h.closed){clearInterval(d._oAuthIntervalId);var a=d._oAuthDfd;if(a){var b=new p("identity-manager:user-aborted","ABORTED");a.reject(b)}}},500)):(a=new p("identity-manager:popup-blocked","ABORTED"),this._oAuthDfd.reject(a))}else this._rejectOnPersistedPageShow=
!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:e,authorizeUrl:f,resourceUrl:a,serverInfo:c,oAuthInfo:b}):window.location.href=k};return e=f.__decorate([v.subclass("esri.identity.IdentityManagerBase")],e)}(m);u.IdentityManagerBase=t;var x=function(k){function e(a){var b=k.call(this,a)||this;b._oAuthCred=null;b.tokenRefreshBuffer=2;a&&a._oAuthCred&&(b._oAuthCred=a._oAuthCred);return b}f.__extends(e,k);e.prototype.initialize=function(){this.resources=this.resources||[];null==this.creationTime&&
(this.creationTime=Date.now())};e.prototype.refreshToken=function(){var a=this,c=b.id.findServerInfo(this.server),d=c&&c.owningSystemUrl,e=!!d&&"server"===this.scope,f=e&&F(c,b.id._legacyFed),k=c.webTierAuth,h=k&&b.id.normalizeWebTierAuth,m=D[this.server],l=m&&m[this.userId],m=this.resources&&this.resources[0],p=e&&b.id.findServerInfo(d),y={username:this.userId,password:l},r;if(!k||h)if(e&&!p&&b.id.serverInfos.some(function(a){b.id._isIdProvider(d,a.server)&&(p=a);return!!p}),k=p&&b.id.findCredential(p.server,
this.userId),!e||k)if(f)k.refreshToken();else{if(e)r={serverUrl:m,token:k&&k.token,ssl:k&&k.ssl};else if(h)y=null,r={ssl:this.ssl};else if(l)this.isAdmin&&(r={isAdmin:!0});else return e=void 0,m&&(m=b.id._sanitizeUrl(m),this._enqueued=1,e=b.id._enqueue(m,c,null,null,this.isAdmin,this),e.then(function(){a._enqueued=0;a.refreshServerTokens()}).catch(function(){a._enqueued=0})),e;return b.id.generateToken(e?p:c,e?null:y,r).then(function(b){a.token=b.token;a.expires=null!=b.expires?Number(b.expires):
null;a.creationTime=Date.now();a.validity=b.validity;a.emitTokenChange();a.refreshServerTokens()}).catch(function(){})}};e.prototype.refreshServerTokens=function(){var a=this;"portal"===this.scope&&b.id.credentials.forEach(function(c){var d=b.id.findServerInfo(c.server),e=d&&d.owningSystemUrl;c!==a&&c.userId===a.userId&&e&&"server"===c.scope&&(b.id._hasSameServerInstance(a.server,e)||b.id._isIdProvider(e,a.server))&&(F(d,b.id._legacyFed)?(c.token=a.token,c.expires=a.expires,c.creationTime=a.creationTime,
c.validity=a.validity,c.emitTokenChange()):c.refreshToken())})};e.prototype.emitTokenChange=function(a){clearTimeout(this._refreshTimer);var c=this.server&&b.id.findServerInfo(this.server),d=(c=c&&c.owningSystemUrl)&&b.id.findServerInfo(c);!1===a||c&&"portal"!==this.scope&&(!d||!d.webTierAuth||b.id.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer();this.emit("token-change")};e.prototype.destroy=function(){this.userId=this.server=this.token=this.expires=this.validity=
this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);var a=b.id.credentials.indexOf(this);-1<a&&b.id.credentials.splice(a,1);this.emitTokenChange();this.emit("destroy")};e.prototype.toJSON=function(){var a=A.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),b=this.resources;b&&0<b.length&&(a.resources=b.slice());
return a};e.prototype._startRefreshTimer=function(){clearTimeout(this._refreshTimer);var a=6E4*this.tokenRefreshBuffer,b=(this.validity?this.creationTime+6E4*this.validity:this.expires)-Date.now();0>b&&(b=0);this._refreshTimer=setTimeout(this.refreshToken.bind(this),b>a?b-a:b)};f.__decorate([v.property()],e.prototype,"creationTime",void 0);f.__decorate([v.property()],e.prototype,"expires",void 0);f.__decorate([v.property()],e.prototype,"isAdmin",void 0);f.__decorate([v.property()],e.prototype,"oAuthState",
void 0);f.__decorate([v.property()],e.prototype,"resources",void 0);f.__decorate([v.property()],e.prototype,"scope",void 0);f.__decorate([v.property()],e.prototype,"server",void 0);f.__decorate([v.property()],e.prototype,"ssl",void 0);f.__decorate([v.property()],e.prototype,"token",void 0);f.__decorate([v.property()],e.prototype,"tokenRefreshBuffer",void 0);f.__decorate([v.property()],e.prototype,"userId",void 0);f.__decorate([v.property()],e.prototype,"validity",void 0);return e=f.__decorate([v.subclass("esri.identity.Credential")],
e)}(m.EventedAccessor);u.Credential=x})},"esri/core/cookie":function(){define(["require","exports","./maybe"],function(t,u,f){Object.defineProperty(u,"__esModule",{value:!0});u.writeCookie=void 0;u.writeCookie=function(k,b,l){void 0===l&&(l={});var h=f.assumeNonNull(l.expires);if("number"===typeof h){var p=new Date;p.setTime(p.getTime()+864E5*h);h=l.expires=p}"string"!==typeof h&&(l.expires=h.toUTCString());k=k+"\x3d"+encodeURIComponent(b);for(var m in l)k+="; "+m,b=l[m],!0!==b&&(k+="\x3d"+b);document.cookie=
k}})},"esri/identity/IdentityForm":function(){define("require exports tslib ../core/accessorSupport/decorators ../intl/substitute ../widgets/Widget ../widgets/support/widget".split(" "),function(t,u,f,k,b,l,h){return function(l){function m(b,f){b=l.call(this,b,f)||this;b._usernameInputNode=null;b._passwordInputNode=null;b.messages=null;b.signingIn=!1;b.server=null;b.resource=null;b.error=null;b.oAuthPrompt=!1;return b}f.__extends(m,l);m.prototype.render=function(){var f=this.error,k=this.server,m=
this.resource,l=this.signingIn,p=this.oAuthPrompt,r=this.messages,k=h.tsx("div",{class:"esri-identity-form__group"},b.substitute(p?r.oAuthInfo:r.info,{server:/\.arcgis\.com/i.test(k)?"ArcGIS Online":k,resource:"("+(m||r.lblItem)+")"})),m=p?null:h.tsx("div",{class:"esri-identity-form__group"},h.tsx("label",{class:"esri-identity-form__label"},r.lblUser,h.tsx("input",{value:"",required:!0,autofocus:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:h.storeNode,"data-node-ref":"_usernameInputNode",
class:"esri-input"}))),p=p?null:h.tsx("div",{class:"esri-identity-form__group"},h.tsx("label",{class:"esri-identity-form__label"},r.lblPwd,h.tsx("input",{value:"",required:!0,type:"password",bind:this,afterCreate:h.storeNode,"data-node-ref":"_passwordInputNode",class:"esri-input"}))),l=h.tsx("div",{class:this.classes("esri-identity-form__group","esri-identity-form__footer")},h.tsx("input",{type:"submit",disabled:!!l,value:l?r.lblSigning:r.lblOk,class:"esri-button"}),h.tsx("input",{type:"button",value:r.lblCancel,
bind:this,onclick:this._cancel,class:this.classes("esri-button","esri-button--secondary")})),f=f?h.tsx("div",null,f.details&&f.details.httpStatus?r.invalidUser:r.noAuthService):null;return h.tsx("form",{class:"esri-identity-form",bind:this,onsubmit:this._submit},k,f,m,p,l)};m.prototype._cancel=function(){this._set("signingIn",!1);this._usernameInputNode&&(this._usernameInputNode.value="");this._passwordInputNode&&(this._passwordInputNode.value="");this.emit("cancel")};m.prototype._submit=function(b){b.preventDefault();
this._set("signingIn",!0);this.emit("submit",this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value})};f.__decorate([k.property(),h.renderable(),h.messageBundle("esri/identity/t9n/identity")],m.prototype,"messages",void 0);f.__decorate([k.property(),h.renderable()],m.prototype,"signingIn",void 0);f.__decorate([k.property(),h.renderable()],m.prototype,"server",void 0);f.__decorate([k.property(),h.renderable()],
m.prototype,"resource",void 0);f.__decorate([k.property(),h.renderable()],m.prototype,"error",void 0);f.__decorate([k.property(),h.renderable()],m.prototype,"oAuthPrompt",void 0);return m=f.__decorate([k.subclass("esri.identity.IdentityForm")],m)}(l)})},"esri/identity/IdentityModal":function(){define("require exports tslib ../core/accessorSupport/decorators ../widgets/Widget ../widgets/support/widget".split(" "),function(t,u,f,k,b,l){return function(b){function h(f,k){f=b.call(this,f,k)||this;f.container=
document.createElement("div");f.content=null;f.open=!1;document.body.appendChild(f.container);return f}f.__extends(h,b);h.prototype.render=function(){var b,f=this.id,k=this.content,h=this.title,p=this.messages,t=this.open&&!!k,k=(b={},b["esri-identity-modal--open"]=t,b["esri-identity-modal--closed"]=!t,b);b=l.tsx("button",{class:"esri-identity-modal__close-button","aria-label":p.close,bind:this,onclick:this._close},l.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"}));p=f+"_title";f+="_content";
h=h?l.tsx("h1",{id:p,class:"esri-identity-modal__title"},h):null;h=t?l.tsx("div",{class:"esri-identity-modal__dialog",role:"dialog","aria-labelledby":p,"aria-describedby":f},b,h,this._renderContent(f)):null;return l.tsx("div",{tabIndex:-1,class:this.classes("esri-identity-modal",k)},h)};h.prototype._close=function(){this.open=!1};h.prototype._renderContent=function(b){var f=this.content;return"string"===typeof f?l.tsx("div",{class:"esri-identity-modal__content",id:b,innerHTML:f}):l.isWidget(f)?l.tsx("div",
{class:"esri-identity-modal__content",id:b},f.render()):f instanceof HTMLElement?l.tsx("div",{class:"esri-identity-modal__content",id:b,bind:f,afterCreate:this._attachToNode}):null};h.prototype._attachToNode=function(b){b.appendChild(this)};f.__decorate([k.property({readOnly:!0})],h.prototype,"container",void 0);f.__decorate([k.property(),l.renderable()],h.prototype,"content",void 0);f.__decorate([k.property(),l.renderable()],h.prototype,"open",void 0);f.__decorate([k.property(),l.renderable(),l.messageBundle("esri/t9n/common")],
h.prototype,"messages",void 0);f.__decorate([k.property({aliasOf:"messages.auth.signIn"}),l.renderable()],h.prototype,"title",void 0);return h=f.__decorate([k.subclass("esri.identity.IdentityModal")],h)}(b)})},"esri/identity/OAuthCredential":function(){define(["require","exports"],function(t,u){t=function(){function f(f,b){this.userId=this.token=this.ssl=this.expires=this.appId=this.storage=this.oAuthInfo=null;this.oAuthInfo=f;this.storage=b;this._init()}f.prototype.isValid=function(){var f=!1;if(this.oAuthInfo&&
this.token&&this.userId){var b=Date.now();this.expires>b&&(this.expires-b)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&(f=!0)}return f};f.prototype.save=function(){if(this.storage){var f=this._load(),b=this.oAuthInfo;if(b&&b.authNamespace&&b.portalUrl){var l=f[b.authNamespace];l||(l=f[b.authNamespace]={});l[b.portalUrl]={appId:this.appId=b.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(f))}catch(h){console.log(h)}}}};
f.prototype.destroy=function(){var f=this._load(),b=this.oAuthInfo;if(b&&b.appId&&b.portalUrl&&this.token&&this.expires>Date.now()){var l=b.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",h=new FormData;h.append("f","json");h.append("auth_token",this.token);h.append("client_id",b.appId);h.append("token_type_hint","access_token");if("function"===typeof navigator.sendBeacon)navigator.sendBeacon(l,h);else{var p=new XMLHttpRequest;p.open("POST",l);p.send(h)}}if(b&&b.authNamespace&&
b.portalUrl&&this.storage&&(l=f[b.authNamespace])){delete l[b.portalUrl];try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(f))}catch(m){console.log(m)}}b&&(this.oAuthInfo=b._oAuthCred=null)};f.prototype._init=function(){var f=this._load(),b=this.oAuthInfo;b&&b.authNamespace&&b.portalUrl&&(f=f[b.authNamespace])&&(f=f[b.portalUrl])&&(this.appId=f.appId,this.expires=f.expires,this.ssl=f.ssl,this.token=f.token,this.userId=f.userId)};f.prototype._load=function(){var f={};if(this.storage){var b=
this.storage.getItem("esriJSAPIOAuth");if(b)try{f=JSON.parse(b)}catch(l){console.log(l)}}return f};return f}();t.prototype.declaredClass="esri.identity.OAuthCredential";return t})},"esri/identity/OAuthInfo":function(){define(["require","exports","tslib","../core/JSONSupport","../core/accessorSupport/decorators"],function(t,u,f,k,b){return function(k){function h(b){b=k.call(this,b)||this;b._oAuthCred=null;b.appId=null;b.authNamespace="/";b.expiration=20160;b.forceLogin=!1;b.locale=null;b.minTimeUntilExpiration=
30;b.popup=!1;b.popupCallbackUrl="oauth-callback.html";b.popupWindowFeatures="height\x3d490,width\x3d800,resizable,scrollbars,status";b.portalUrl="https://www.arcgis.com";b.preserveUrlHash=!1;return b}f.__extends(h,k);l=h;h.prototype.clone=function(){return l.fromJSON(this.toJSON())};var l;f.__decorate([b.property({json:{write:!0}})],h.prototype,"appId",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"authNamespace",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,
"expiration",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"forceLogin",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"locale",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"minTimeUntilExpiration",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"popup",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"popupCallbackUrl",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"popupWindowFeatures",void 0);
f.__decorate([b.property({json:{write:!0}})],h.prototype,"portalUrl",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"preserveUrlHash",void 0);return h=l=f.__decorate([b.subclass("esri.identity.OAuthInfo")],h)}(k.JSONSupport)})},"esri/identity/ServerInfo":function(){define(["require","exports","tslib","../core/JSONSupport","../core/accessorSupport/decorators"],function(t,u,f,k,b){return function(k){function h(b){b=k.call(this,b)||this;b.adminTokenServiceUrl=null;b.currentVersion=
null;b.hasPortal=null;b.hasServer=null;b.owningSystemUrl=null;b.owningTenant=null;b.server=null;b.shortLivedTokenValidity=null;b.tokenServiceUrl=null;b.webTierAuth=null;return b}f.__extends(h,k);f.__decorate([b.property({json:{write:!0}})],h.prototype,"adminTokenServiceUrl",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"currentVersion",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"hasPortal",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"hasServer",
void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"owningSystemUrl",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"owningTenant",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"server",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"shortLivedTokenValidity",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"tokenServiceUrl",void 0);f.__decorate([b.property({json:{write:!0}})],h.prototype,"webTierAuth",void 0);return h=
f.__decorate([b.subclass("esri.identity.ServerInfo")],h)}(k.JSONSupport)})},"*noref":1}});define("require exports tslib ../kernel ../core/accessorSupport/decorators/subclass ./IdentityManagerBase".split(" "),function(t,u,f,k,b,l){t=new (function(h){function k(){return null!==h&&h.apply(this,arguments)||this}f.__extends(k,h);return k=f.__decorate([b.subclass("esri.identity.IdentityManager")],k)}(l.IdentityManagerBase));k.setId(t);return t});