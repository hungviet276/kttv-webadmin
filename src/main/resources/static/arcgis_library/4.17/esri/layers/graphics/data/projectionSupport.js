// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(z,e,k,p,q,h,r,g,l){function t(b,a){var d;if(!a)return null;if("x"in a){var c={x:0,y:0};b=b(a.x,a.y,m);c.x=b[0];c.y=b[1];null!=a.z&&(c.z=a.z);null!=a.m&&(c.m=a.m);return c}if("xmin"in a)return c={xmin:0,ymin:0,xmax:0,ymax:0},d=b(a.xmin,a.ymin,m),
c.xmin=d[0],c.ymin=d[1],b=b(a.xmax,a.ymax,m),c.xmax=b[0],c.ymax=b[1],a.hasZ&&(c.zmin=a.zmin,c.zmax=a.zmax,c.hasZ=!0),a.hasM&&(c.mmin=a.mmin,c.mmax=a.mmax,c.hasM=!0),c;if("rings"in a)return{rings:u(a.rings,b),hasM:a.hasM,hasZ:a.hasZ};if("paths"in a)return{paths:u(a.paths,b),hasM:a.hasM,hasZ:a.hasZ};if("points"in a)return{points:v(a.points,b),hasM:a.hasM,hasZ:a.hasZ}}function u(b,a){for(var d=[],c=0;c<b.length;c++)d.push(v(b[c],a));return d}function v(b,a){for(var d=[],c=0;c<b.length;c++){var f=b[c],
e=a(f[0],f[1],[0,0]);d.push(e);2<f.length&&e.push(f[2]);3<f.length&&e.push(f[3])}return d}function n(b,a){return!g.isValid(b)||!g.isValid(a)||g.equals(b,a)||l.canProject(b,a)?!1:!0}Object.defineProperty(e,"__esModule",{value:!0});e.projectMany=e.project=e.checkProjectionSupport=e.doesBrowserSupportProjection=void 0;var m=[0,0];e.doesBrowserSupportProjection=function(b,a){return n(b,a)?h.isSupported():!0};e.checkProjectionSupport=function(b,a){return k.__awaiter(this,void 0,void 0,function(){var d,
c,f;return k.__generator(this,function(e){if(!a)return[2];if(Array.isArray(b)){d=0;for(c=b;d<c.length;d++)if(f=c[d],n(f.geometry&&f.geometry.spatialReference,a)){if(h.isSupported())return[2,h.load()];throw new p("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,outSpatialReference:a});}return[2]}if(!n(b,a))return[2];if(h.isSupported())return[2,h.load()];throw new p("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,outSpatialReference:a});
})})};var w=t.bind(null,l.lngLatToXY),x=t.bind(null,l.xyToLngLat);e.project=function(b,a,d){if(!b)return b;d||(d=a,a=b.spatialReference);return g.isValid(a)&&g.isValid(d)&&!g.equals(a,d)?l.canProject(a,d)?g.isWebMercator(d)?w(b):x(b):h.projectMany(r.jsonAdapter,[b],a,d,null)[0]:b};var y=new (function(){function b(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}b.prototype.push=function(a,b,c){return k.__awaiter(this,void 0,void 0,function(){var d,e=this;return k.__generator(this,
function(f){a&&a.length&&b&&c&&!g.equals(b,c)||q.resolve(a);d={geometries:a,inSpatialReference:b,outSpatialReference:c,resolve:null};this._jobs.push(d);return[2,q.create(function(a){d.resolve=a;null===e._timer&&(e._timer=setTimeout(e._process,10))})]})})};b.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var b=a.geometries,c=a.inSpatialReference,e=a.outSpatialReference,a=a.resolve;l.canProject(c,e)?g.isWebMercator(e)?a(b.map(w)):a(b.map(x)):a(h.projectMany(r.jsonAdapter,
b,c,e,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return b}());e.projectMany=function(b,a,d){return k.__awaiter(this,void 0,void 0,function(){return k.__generator(this,function(c){return[2,y.push(b,a,d)]})})}});