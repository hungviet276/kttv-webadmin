// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../geometry ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),function(A,B,d,h,v,w,x,g,q,r,l,y,z){var t=new v.default({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",
GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});return function(u){function b(a){a=u.call(this,a)||this;a.dpi=96;a.format=null;a.origin=null;a.minScale=0;a.maxScale=0;a.size=null;a.spatialReference=null;return a}d.__extends(b,u);m=b;b.create=function(a){void 0===a&&(a={size:256,spatialReference:h.SpatialReference.WebMercator});var c=a.resolutionFactor||1,k=a.scales,e=a.size||256,b=a.spatialReference||h.SpatialReference.WebMercator;if(!l.isValid(b)){c=
[];if(k)for(a=0;a<k.length;a++){var f=k[a];c.push({level:a,scale:f,resolution:f})}else{var d=5E-4;for(a=23;0<=a;a--)c.unshift({level:a,scale:d,resolution:d}),d*=2}return new m({dpi:96,lods:c,origin:new h.Point(0,0,b),size:[e,e],spatialReference:b})}var f=l.getInfo(b),g=a.origin?new h.Point({x:a.origin.x,y:a.origin.y,spatialReference:b}):f?new h.Point({x:f.origin[0],y:f.origin[1],spatialReference:b}):new h.Point({x:0,y:0,spatialReference:b}),p=1/(39.37*x.getMetersPerUnitForSR(b)*96),n=[];if(k)for(a=
0;a<k.length;a++)f=k[a],d=f*p,n.push({level:a,scale:f,resolution:d});else for(f=l.isGeographic(b)?512/e*5.916575275917094E8:256/e*5.91657527591555E8,k=Math.ceil(24/c),n.push({level:0,scale:f,resolution:f*p}),a=1;a<k;a++)f/=Math.pow(2,c),d=f*p,n.push({level:a,scale:f,resolution:d});return new m({dpi:96,lods:n,origin:g,size:[e,e],spatialReference:b})};Object.defineProperty(b.prototype,"isWrappable",{get:function(){var a=this.spatialReference,c=this.origin;if(a&&c){var b=l.getInfo(a);return a.isWrappable&&
Math.abs(b.origin[0]-c.x)<=b.dx}return!1},enumerable:!1,configurable:!0});b.prototype.readOrigin=function(a,c){return h.Point.fromJSON(d.__assign({spatialReference:c.spatialReference},a))};Object.defineProperty(b.prototype,"lods",{set:function(a){var c=this,b=0,e=0,d=[];this._levelToLOD={};a&&(b=-Infinity,e=Infinity,a.forEach(function(a){d.push(a.scale);b=a.scale>b?a.scale:b;e=a.scale<e?a.scale:e;c._levelToLOD[a.level]=a}));this._set("scales",d);this._set("minScale",b);this._set("maxScale",e);this._set("lods",
a);this._initializeUpsampleLevels()},enumerable:!1,configurable:!0});b.prototype.readSize=function(a,c){return[c.cols,c.rows]};b.prototype.writeSize=function(a,c){c.cols=a[0];c.rows=a[0]};b.prototype.zoomToScale=function(a){var c=this.scales;if(0>=a)return c[0];if(a>=c.length)return c[c.length-1];var b=Math.round(a);return c[b]+(b-a)*(c[Math.round(a-.5)]-c[b])};b.prototype.scaleToZoom=function(a){for(var c=this.scales,b=c.length-1,e=0;e<b;e++){var d=c[e],f=c[e+1];if(d<=a)break;if(f===a)return e+1;
if(d>a&&f<a)return e+1-(a-f)/(d-f)}return e};b.prototype.snapScale=function(a,c){void 0===c&&(c=.95);a=this.scaleToZoom(a);return a%Math.floor(a)>=c?this.zoomToScale(Math.ceil(a)):this.zoomToScale(Math.floor(a))};b.prototype.tileAt=function(a,c,b,e){var d=this.lodAt(a);if(!d)return null;var f;if("number"===typeof c)f=c,c=b;else{if(l.equals(c.spatialReference,this.spatialReference))f=c.x,c=c.y;else{e=y.project(c,this.spatialReference);if(!e)return null;f=e.x;c=e.y}e=b}b=d.resolution*this.size[0];d=
d.resolution*this.size[1];e||(e={id:null,level:0,row:0,col:0,extent:r.create()});e.level=a;e.row=Math.floor((this.origin.y-c)/d+.001);e.col=Math.floor((f-this.origin.x)/b+.001);this.updateTileInfo(e);return e};b.prototype.updateTileInfo=function(a){var c=this.lodAt(a.level);if(c){var b=c.resolution*this.size[0],c=c.resolution*this.size[1];a.id=a.level+"/"+a.row+"/"+a.col;a.extent||(a.extent=r.create());a.extent[0]=this.origin.x+a.col*b;a.extent[1]=this.origin.y-(a.row+1)*c;a.extent[2]=a.extent[0]+
b;a.extent[3]=a.extent[1]+c}};b.prototype.upsampleTile=function(a){var c=this._upsampleLevels[a.level];if(!c||-1===c.parentLevel)return!1;a.level=c.parentLevel;a.row=Math.floor(a.row/c.factor+.001);a.col=Math.floor(a.col/c.factor+.001);this.updateTileInfo(a);return!0};b.prototype.getTileBounds=function(a,c){var b=this.lodAt(c.level).resolution,e=b*this.size[0],b=b*this.size[1];a[0]=this.origin.x+c.col*e;a[1]=this.origin.y-(c.row+1)*b;a[2]=a[0]+e;a[3]=a[1]+b;return a};b.prototype.lodAt=function(a){return this._levelToLOD&&
this._levelToLOD[a]||null};b.prototype.clone=function(){return m.fromJSON(this.write({}))};b.prototype._initializeUpsampleLevels=function(){var a=this.lods;this._upsampleLevels=[];for(var b=null,d=0;d<a.length;d++){var e=a[d];this._upsampleLevels[e.level]={parentLevel:b?b.level:-1,factor:b?b.resolution/e.resolution:0};b=e}};var m;d.__decorate([g.property({type:Number,json:{write:!0}})],b.prototype,"compressionQuality",void 0);d.__decorate([g.property({type:Number,json:{write:!0}})],b.prototype,"dpi",
void 0);d.__decorate([g.property({type:String,json:{read:t.read,write:t.write,origins:{"web-scene":{read:!1,write:!1}}}})],b.prototype,"format",void 0);d.__decorate([g.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],b.prototype,"isWrappable",null);d.__decorate([g.property({type:h.Point,json:{write:!0}})],b.prototype,"origin",void 0);d.__decorate([g.reader("origin")],b.prototype,"readOrigin",null);d.__decorate([g.property({type:[z],value:null,json:{write:!0}})],b.prototype,"lods",
null);d.__decorate([g.property({readOnly:!0})],b.prototype,"minScale",void 0);d.__decorate([g.property({readOnly:!0})],b.prototype,"maxScale",void 0);d.__decorate([g.property({readOnly:!0})],b.prototype,"scales",void 0);d.__decorate([g.property({cast:function(a){return Array.isArray(a)?a:"number"===typeof a?[a,a]:[256,256]}})],b.prototype,"size",void 0);d.__decorate([g.reader("size",["rows","cols"])],b.prototype,"readSize",null);d.__decorate([g.writer("size",{cols:{type:q.Integer},rows:{type:q.Integer}})],
b.prototype,"writeSize",null);d.__decorate([g.property({type:h.SpatialReference,json:{write:!0}})],b.prototype,"spatialReference",void 0);return b=m=d.__decorate([g.subclass("esri.layers.support.TileInfo")],b)}(w.JSONSupport)});