// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Accessor ../../core/Handles ../../core/accessorSupport/decorators ./commonProperties ./wmsUtils".split(" "),function(v,w,c,p,h,e,q,r){var t={visible:"visibleSublayers"},k=[102100,3857,102113,900913],u=[3395,54004];return function(g){function b(){var a=null!==g&&g.apply(this,arguments)||this;a._layerHandles=new h;a.extent=null;a._scale=null;a.view=null;return a}c.__extends(b,g);Object.defineProperty(b.prototype,"layer",{set:function(a){var d=this;this._get("layer")!==
a&&(this._set("layer",a),this._layerHandles&&(this._layerHandles.removeAll(),this._layerHandles=null),a&&(this._layerHandles||(this._layerHandles=new h),this._layerHandles.add([a.sublayers.on("change",function(){return d.notifyChange("visibleSublayers")}),a.on("wms-sublayer-update",function(a){return d.notifyChange(t[a.propertyName])})])))},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"layers",{get:function(){return this.visibleSublayers.filter(function(a){return a.name}).map(function(a){return a.name}).join(",")},
enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"scale",{get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(a){this.view||(this._scale=a,this.notifyChange("scale"))},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"visibleSublayers",{get:function(){var a=this.scale,d=this.layer.sublayers,b=[],
c=function(d){var e=d.minScale,m=d.maxScale,f=d.sublayers,e=0===a||(0===e||a<=e)&&(0===m||a>=m);d.visible&&e&&(f?f.forEach(c):b.unshift(d))};null===d||void 0===d?void 0:d.forEach(c);return b},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"wkid",{get:function(){var a=this.extent,d=this.layer.spatialReferences,b=a.spatialReference&&a.spatialReference.wkid;d&&-1===d.indexOf(b)&&a.spatialReference.latestWkid&&(b=a.spatialReference.latestWkid);a=k.some(function(a){return a===b});if(!d)return b;
if(a){var c=[];d.forEach(function(a){-1<k.indexOf(a)&&c.push(a)});c.length||d.forEach(function(a){-1<u.indexOf(a)&&c.push(a)});b=0<c.length?c[0]:k[0]}return b},enumerable:!1,configurable:!0});b.prototype.toJSON=function(){var a=this.extent,b=this.layer,e=this.layers,k=b.imageFormat,m=b.imageTransparency,l=b.spatialReferences,g=b.version,f=this.wkid;l&&-1===l.indexOf(f)&&a.spatialReference.latestWkid&&(f=a.spatialReference.latestWkid);var l=a.xmin,h=a.ymin,n=a.xmax,a=a.ymax,b={bbox:"1.3.0"===b.version&&
r.coordsReversed(f)?h+","+l+","+a+","+n:l+","+h+","+n+","+a,format:k,request:"GetMap",service:"WMS",styles:"",transparent:m,version:g};isNaN(f)||("1.3.0"===g?b.crs="EPSG:"+f:b.srs="EPSG:"+f);return c.__assign(c.__assign({},b),{layers:e})};c.__decorate([e.property()],b.prototype,"extent",void 0);c.__decorate([e.property()],b.prototype,"layer",null);c.__decorate([e.property({readOnly:!0,dependsOn:["visibleSublayers"]})],b.prototype,"layers",null);c.__decorate([e.property({type:Number,dependsOn:["view.scale"]})],
b.prototype,"scale",null);c.__decorate([e.property(q.combinedViewLayerTimeExtentProperty)],b.prototype,"timeExtent",void 0);c.__decorate([e.property({type:Number,dependsOn:["layers","layer.imageTransparency","timeExtent"],readOnly:!0})],b.prototype,"version",null);c.__decorate([e.property()],b.prototype,"view",void 0);c.__decorate([e.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],b.prototype,"visibleSublayers",null);c.__decorate([e.property()],b.prototype,"wkid",null);return b=c.__decorate([e.subclass("esri.layers.support.ExportWMSImageParameters")],
b)}(p)});