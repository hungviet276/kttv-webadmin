// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/Collection ../core/CollectionFlattener ../core/Error ../core/lang ../core/loadAll ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./buildingSublayers/BuildingComponentSublayer ./buildingSublayers/BuildingGroupSublayer ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/BuildingFilter ./support/BuildingSummaryStatistics ./support/commonProperties ./support/FetchAssociatedFeatureLayer".split(" "),
function(M,N,c,u,v,n,p,w,x,y,z,A,B,d,C,D,E,q,f,F,G,H,I,J,K,r,k,L){var l=x.getLogger("esri.layers.BuildingSceneLayer"),t=u.ofType(K),m=p.clone(f.sublayersProperty);m.json.origins["web-scene"]={type:[q],write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}};m.json.origins["portal-item"]={type:[q],write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}};return function(h){function b(a){a=h.call(this,a)||this;a.operationalLayerType="BuildingSceneLayer";a.allSublayers=new v({root:a,
rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return"building-group"===a.type?a.sublayers:null}});a.sublayers=null;a.sublayerOverrides=null;a.filters=new t;a.activeFilterId=null;a.summaryStatistics=null;a.outFields=null;a.type="building-scene";return a}c.__extends(b,h);b.prototype.normalizeCtorArgs=function(a){return"string"===typeof a?{url:a}:a};b.prototype.destroy=function(){this.allSublayers.destroy()};b.prototype.readSublayers=function(a,e,b){var c=this;a=f.readSublayers(a,
e,b);f.forEachSublayer(a,function(a){return a.layer=c});this.sublayerOverrides&&(this.applySublayerOverrides(a,this.sublayerOverrides),this.sublayerOverrides=null);return a};b.prototype.applySublayerOverrides=function(a,e){var b=e.overrides,c=e.context;f.forEachSublayer(a,function(a){return a.read(b.get(a.id),c)})};b.prototype.readSublayerOverrides=function(a,b){for(var e=new Map,c=0;c<a.length;c++){var g=a[c];null==g||"object"!==typeof g||"number"!==typeof g.id?b.messages.push(new n("building-scene-layer:invalid-sublayer-override",
"Invalid value for sublayer override. Not an object or no id specified.",{value:g})):e.set(g.id,g)}return{overrides:e,context:b}};b.prototype.writeSublayerOverrides=function(a,b,c){var e=[];f.forEachSublayer(this.sublayers,function(a){a=a.write({},c);1<Object.keys(a).length&&e.push(a)});0<e.length&&(b.sublayers=e)};b.prototype.writeUnappliedOverrides=function(a,b){b.sublayers=[];a.overrides.forEach(function(a){b.sublayers.push(p.clone(a))})};b.prototype.write=function(a,b){a=h.prototype.write.call(this,
a,b);!b||"web-scene"!==b.origin&&"portal-item"!==b.origin||(this.sublayers?this.writeSublayerOverrides(this.sublayers,a,b):this.sublayerOverrides&&this.writeUnappliedOverrides(this.sublayerOverrides,a));return a};b.prototype.read=function(a,b){h.prototype.read.call(this,a,b);b&&("web-scene"===b.origin||"portal-item"===b.origin)&&null!=a&&Array.isArray(a.sublayers)&&(a=this.readSublayerOverrides(a.sublayers,b),this.sublayers?this.applySublayerOverrides(this.sublayers,a):this.sublayerOverrides=a)};
b.prototype.readSummaryStatistics=function(a,b){return"string"===typeof b.statisticsHRef?(a=B.join(this.parsedUrl.path,b.statisticsHRef),new r({url:a})):null};Object.defineProperty(b.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this._validateElevationInfo()},enumerable:!1,configurable:!0});b.prototype.load=function(a){var b=this,c=y.isSome(a)?a.signal:null;a=this.loadFromPortal({supportedTypes:["Scene Service"]},a).catch(function(){}).then(function(){return b._fetchService(c)}).then(function(){return b._fetchAssociatedFeatureService(c)});
this.addResolvingPromise(a);return A.resolve(this)};b.prototype.loadAll=function(){var a=this;return w.loadAll(this,function(b){f.forEachSublayer(a.sublayers,function(a){"building-group"!==a.type&&b(a)});a.summaryStatistics&&b(a.summaryStatistics)})};b.prototype.saveAs=function(a,b){return c.__awaiter(this,void 0,void 0,function(){var d=this;return c.__generator(this,function(e){return[2,this._debouncedSaveOperations(1,c.__assign(c.__assign({},b),{getTypeKeywords:function(){return d._getTypeKeywords()},
portalItemLayerType:"building-scene"}),a)]})})};b.prototype.save=function(){return c.__awaiter(this,void 0,void 0,function(){var a,b=this;return c.__generator(this,function(c){a={getTypeKeywords:function(){return b._getTypeKeywords()},portalItemLayerType:"building-scene"};return[2,this._debouncedSaveOperations(0,a)]})})};b.prototype.validateLayer=function(a){if(!a.layerType||"Building"!==a.layerType)throw new n("buildingscenelayer:layer-type-not-supported","BuildingSceneLayer does not support this layer type",
{layerType:a.layerType});};b.prototype._getTypeKeywords=function(){return["Building"]};b.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("absolute-height"!==a.mode&&l.warn(".elevationInfo\x3d","Building scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&l.warn(".elevationInfo\x3d","Building scene layers do not support featureExpressionInfo"))};b.prototype._fetchAssociatedFeatureService=function(a){return c.__awaiter(this,
void 0,void 0,function(){var b,d,f;return c.__generator(this,function(c){switch(c.label){case 0:b=new L.FetchAssociatedFeatureLayer(this.parsedUrl,this.portalItem,a),c.label=1;case 1:return c.trys.push([1,3,,4]),d=this,[4,b.fetchPortalItem()];case 2:return d.associatedFeatureServiceItem=c.sent(),[3,4];case 3:return f=c.sent(),l.warn("Associated feature service item could not be loaded",f),[3,4];case 4:return[2]}})})};c.__decorate([d.property({type:["BuildingSceneLayer"]})],b.prototype,"operationalLayerType",
void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"allSublayers",void 0);c.__decorate([d.property(m)],b.prototype,"sublayers",void 0);c.__decorate([d.reader("service","sublayers")],b.prototype,"readSublayers",null);c.__decorate([d.property({type:t,nonNullable:!0,json:{write:!0}})],b.prototype,"filters",void 0);c.__decorate([d.property({type:String,json:{write:!0}})],b.prototype,"activeFilterId",void 0);c.__decorate([d.property({readOnly:!0,type:r})],b.prototype,"summaryStatistics",void 0);
c.__decorate([d.reader("summaryStatistics",["statisticsHRef"])],b.prototype,"readSummaryStatistics",null);c.__decorate([d.property({type:[String],json:{read:!1}})],b.prototype,"outFields",void 0);c.__decorate([d.property(k.readOnlyService(C))],b.prototype,"fullExtent",void 0);c.__decorate([d.property({type:["show","hide","hide-children"]})],b.prototype,"listMode",void 0);c.__decorate([d.property(k.readOnlyService(D))],b.prototype,"spatialReference",void 0);c.__decorate([d.property(k.elevationInfo)],
b.prototype,"elevationInfo",null);c.__decorate([d.property({json:{read:!1},readOnly:!0})],b.prototype,"type",void 0);c.__decorate([d.property()],b.prototype,"associatedFeatureServiceItem",void 0);return b=c.__decorate([d.subclass("esri.layers.BuildingSceneLayer")],b)}(J.SceneService(F.ArcGISService(G.OperationalLayer(H.PortalLayer(I.ScaleRangeLayer(z.MultiOriginJSONMixin(E)))))))});