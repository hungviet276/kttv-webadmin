// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/maybe","./attributeSupport"],function(k,l,m,g){Object.defineProperty(l,"__esModule",{value:!0});k=function(){function f(a,b,d){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=a.returnDistinctValues;this.fieldsIndex=d;this.featureAdapter=b;if((a=a.outFields)&&-1===a.indexOf("*")){this.outFields=a;for(var e=b=0;e<a.length;e++){var c=a[e],f=g.getExpressionFromFieldName(c),h=this.fieldsIndex.get(f),f=h?null:g.getWhereClause(f,
d),h=h?h.name:g.getAliasFromFieldName(c)||"FIELD_EXP_"+b++;this._fieldDataCache.set(c,{alias:h,clause:f})}}}f.prototype.countDistinctValues=function(a){var b=this;if(!this.returnDistinctValues)return a.length;a.forEach(function(a){return b.getAttributes(a)});return this._returnDistinctMap.size};f.prototype.getAttributes=function(a){a=this._processAttributesForOutFields(a);return this._processAttributesForDistinctValues(a)};f.prototype.getFieldValue=function(a,b,d){var e=d?d.name:b,c=null;this._fieldDataCache.has(e)?
c=this._fieldDataCache.get(e).clause:d||(c=g.getWhereClause(b,this.fieldsIndex),this._fieldDataCache.set(e,{alias:e,clause:c}));return d?this.featureAdapter.getAttribute(a,e):c.calculateValue(a,this.featureAdapter)};f.prototype.validateItem=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:g.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testFeature(a,this.featureAdapter)};f.prototype.validateItems=function(a,b){this._fieldDataCache.has(b)||
this._fieldDataCache.set(b,{alias:b,clause:g.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testSet(a,this.featureAdapter)};f.prototype._processAttributesForOutFields=function(a){var b=this.outFields;if(!b||!b.length)return this.featureAdapter.getAttributes(a);for(var d={},e=0;e<b.length;e++){var c=this._fieldDataCache.get(b[e]),f=c.alias,c=c.clause;d[f]=c?c.calculateValue(a,this.featureAdapter):this.featureAdapter.getAttribute(a,f)}return d};f.prototype._processAttributesForDistinctValues=
function(a){if(m.isNone(a)||!this.returnDistinctValues)return a;var b=this.outFields,d=[];if(b)for(var e=0;e<b.length;e++){var c=this._fieldDataCache.get(b[e]).alias;d.push(a[c])}else for(c in a)d.push(a[c]);b=(b||["*"]).join(",")+"\x3d"+d.join(",");d=this._returnDistinctMap.get(b)||0;this._returnDistinctMap.set(b,++d);return 1<d?null:a};return f}();l.default=k});