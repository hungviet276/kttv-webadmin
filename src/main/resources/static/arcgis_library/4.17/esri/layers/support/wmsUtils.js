// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/urlUtils ../../geometry/Extent ../../geometry/SpatialReference".split(" "),function(S,g,O,P,E,w){function q(a){return Q.some(function(c){var d=c[1];return a>=c[0]&&a<=d})}function I(a){var c=[];a.forEach(function(a){c.push(a);a.sublayers&&a.sublayers.length&&(c=c.concat(I(a.sublayers)),delete a.sublayers)});return c}function t(a,c,d){var b;return null!==(b=c.getAttribute(a))&&void 0!==b?b:d}function h(a,c){for(var d=0;d<c.childNodes.length;d++){var b=
c.childNodes[d];if(b.nodeType===Node.ELEMENT_NODE&&b.nodeName===a)return b}return null}function u(a,c){for(var d=[],b=0;b<c.childNodes.length;b++){var f=c.childNodes[b];f.nodeType===Node.ELEMENT_NODE&&f.nodeName===a&&d.push(f)}return d}function n(a,c,d){return(a=h(a,c))?a.textContent:d}function r(a,c,d){if(!a)return null;var b=parseFloat(a.getAttribute("minx")),f=parseFloat(a.getAttribute("miny")),e=parseFloat(a.getAttribute("maxx"));a=parseFloat(a.getAttribute("maxy"));d?(d=isNaN(f)?-Number.MAX_VALUE:
f,b=isNaN(b)?-Number.MAX_VALUE:b,f=isNaN(a)?Number.MAX_VALUE:a,e=isNaN(e)?Number.MAX_VALUE:e):(d=isNaN(b)?-Number.MAX_VALUE:b,b=isNaN(f)?-Number.MAX_VALUE:f,f=isNaN(e)?Number.MAX_VALUE:e,e=isNaN(a)?Number.MAX_VALUE:a);c=new w({wkid:c});return new E({xmin:d,ymin:b,xmax:f,ymax:e,spatialReference:c})}function J(a,c){if(a=h(c,a))if(a=h("DCPType",a))if(a=h("HTTP",a))if(a=h("Get",a)){var d;if(d=(a=h("OnlineResource",a))?t("xlink:href",a,null):null){d.indexOf("\x26")===d.length-1&&(d=d.substring(0,d.length-
1));a=["service","request"];c=[];d=P.urlToObject(d);for(var b in d.query)d.query.hasOwnProperty(b)&&-1===a.indexOf(b.toLowerCase())&&c.push(b+"\x3d"+d.query[b]);return d.path+(c.length?"?"+c.join("\x26"):"")}}return null}function K(a,c){var d=u("Operation",a);if(0===d.length)return a=h(c,a),u("Format",a).map(function(a){return a.textContent});var b=[];d.forEach(function(a){a.getAttribute("name")===c&&u("Format",a).forEach(function(a){b.push(a.textContent)})});return b}function x(a,c,d){a=h(c,a);if(!a)return d;
a=a.textContent;if(null==a||""===a)return d;a=Number(a);return isNaN(a)?d:a}function F(a,c,d){if(!a)return null;var b={id:d.idCounter++,fullExtents:[],parentLayerId:null,queryable:"1"===a.getAttribute("queryable"),spatialReferences:[],sublayers:null},f=h("LatLonBoundingBox",a),e=h("EX_GeographicBoundingBox",a),k=null;f&&(k=r(f,4326));e&&(k=new E(0,0,0,0,new w({wkid:4326})),k.xmin=parseFloat(n("westBoundLongitude",e,"0")),k.ymin=parseFloat(n("southBoundLatitude",e,"0")),k.xmax=parseFloat(n("eastBoundLongitude",
e,"0")),k.ymax=parseFloat(n("northBoundLatitude",e,"0")));f||e||(k=new E(-180,-90,180,90,new w({wkid:4326})));b.minScale=x(a,"MaxScaleDenominator",0);b.maxScale=x(a,"MinScaleDenominator",0);var g=-1<["1.0.0","1.1.0","1.1.1"].indexOf(c)?"SRS":"CRS";Array.prototype.slice.call(a.childNodes).forEach(function(a){if("Name"===a.nodeName)b.name=a.textContent||"";else if("Title"===a.nodeName)b.title=a.textContent||"";else if("Abstract"===a.nodeName)b.description=a.textContent||"";else if("BoundingBox"===a.nodeName){var f=
a.getAttribute(g);if(f&&0===f.indexOf("EPSG:")){var e=parseInt(f.substring(5),10);0===e||isNaN(e)||k||(k="1.3.0"===c?r(a,e,q(e)):r(a,e))}(e=f&&f.indexOf(":"))&&-1<e&&(e=parseInt(f.substring(e+1,f.length),10),0===e||isNaN(e)||(e=v[e]?v[e]:e),a="1.3.0"===c?r(a,e,q(e)):r(a,e),b.fullExtents.push(a))}else if(a.nodeName===g)a.textContent.split(" ").forEach(function(a){a=-1<a.indexOf(":")?parseInt(a.split(":")[1],10):parseInt(a,10);0===a||isNaN(a)||(v[a]&&(a=v[a]),-1===b.spatialReferences.indexOf(a)&&b.spatialReferences.push(a))});
else if("Style"!==a.nodeName||b.legendURL)"Layer"===a.nodeName&&(a=F(a,c,d))&&(a.parentLayerId=b.id,b.sublayers||(b.sublayers=[]),b.sublayers.push(a));else if(a=h("LegendURL",a))if(a=h("OnlineResource",a))b.legendURL=a.getAttribute("xlink:href")});b.extent=null===k||void 0===k?void 0:k.toJSON();b.dimensions=u("Dimension",a).filter(function(a){return a.getAttribute("name")&&a.getAttribute("units")&&a.textContent}).map(function(a){var d=a.getAttribute("name"),b=a.getAttribute("units"),c=a.textContent,
e=a.getAttribute("unitSymbol"),f=a.getAttribute("default"),g="0"!==t("default",a,"0"),k="0"!==t("nearestValue",a,"0");a="0"!==t("current",a,"0");return/^time$/i.test(d)&&/^ISO8601$/i.test(b)?{name:"time",units:"ISO8601",extent:y(c),default:y(f),multipleValues:g,nearestValue:k,current:a}:/^elevation$/i.test(d)?{name:"elevation",units:b,extent:z(c),unitSymbol:e,default:z(f),multipleValues:g,nearestValue:k}:{name:d,units:b,extent:A(c),unitSymbol:e,default:A(f),multipleValues:g,nearestValue:k}});return b}
function R(a){return Array.isArray(a)&&0<a.length&&a[0]instanceof Date}function L(a){return"time"===a.name}function z(a){if(!a)return null;var c=-1!==a.indexOf("/");a=a.split(",");return c?a.map(function(a){var b=a.split("/");if(2>b.length)return null;a=parseFloat(b[0]);var d=parseFloat(b[1]),b=3<=b.length&&"0"!==b[2]?parseFloat(b[2]):void 0;return{min:a,max:d,resolution:b}}).filter(function(a){return a}):a.map(function(a){return parseFloat(a)})}function A(a){if(!a)return null;var c=-1!==a.indexOf("/");
a=a.split(",");return c?a.map(function(a){a=a.split("/");return 2>a.length?null:{min:a[0],max:a[1],resolution:3<=a.length&&"0"!==a[2]?a[2]:void 0}}).filter(function(a){return a}):a}function y(a){if(!a)return null;var c=-1!==a.indexOf("/");a=a.split(",");return c?a.map(function(a){var b=a.split("/");if(2>b.length)return null;a=new Date(b[0]);var c=new Date(b[1]),b=3<=b.length&&"0"!==b[2]?G(b[2]):void 0;return{min:a,max:c,resolution:b}}).filter(function(a){return a}):a.map(function(a){return new Date(a)})}
function G(a){var c=a.match(/(?:p(\d+y|\d+(?:.|,)\d+y)?(\d+m|\d+(?:.|,)\d+m)?(\d+d|\d+(?:.|,)\d+d)?)?(?:t(\d+h|\d+(?:.|,)\d+h)?(\d+m|\d+(?:.|,)\d+m)?(\d+s|\d+(?:.|,)\d+s)?)?/i);if(!c)return null;a=m(c[1]);var d=m(c[2]),b=m(c[3]),f=m(c[4]),e=m(c[5]),c=m(c[6]);return{years:a,months:d,days:b,hours:f,minutes:e,seconds:c}}function m(a){if(!a)return 0;a=a.match(/(?:\d+(?:.|,)\d+|\d+)/);if(!a)return 0;a=a[0].replace(",",".");return Number(a)}Object.defineProperty(g,"__esModule",{value:!0});g.toISOString=
g.fromISODuration=g.isTimeDimension=g.isGenericDimension=g.isElevationDimension=g.isDimensionInterval=g.getPopupLayers=g.coordsReversed=g.parseCapabilities=void 0;var Q=[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],
[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],v={84:4326,83:4269,27:4267};g.parseCapabilities=function(a){if(!a)return null;var c={idCounter:-1};"string"===typeof a&&(a=(new DOMParser).parseFromString(a,"text/xml"));a=a.documentElement;
if("ServiceExceptionReport"===a.nodeName){var d=Array.prototype.slice.call(a.childNodes).map(function(a){return a.textContent}).join("\r\n");throw new O("wmslayer:wms-capabilities-xml-is-not-valid","The server returned errors when the WMS capabilities were requested.",d);}var b=h("Capability",a),f=h("Service",a),e=h("Request",b);if(!b||!f||!e)return null;var g=h("Layer",b);if(!g)return null;var m="WMS_Capabilities"===a.nodeName||"WMT_MS_Capabilities"===a.nodeName?a.getAttribute("version"):"1.3.0";
a=n("Title",f,"")||n("Name",f,"");var r=n("AccessConstraints",f,""),t=n("Abstract",f,""),u=parseInt(n("MaxWidth",f,"5000"),10),f=parseInt(n("MaxHeight",f,"5000"),10),v=K(e,"GetMap"),w=J(e,"GetMap"),l=F(g,m,c),q=0,x;Array.prototype.slice.call(b.childNodes).forEach(function(a){"Layer"===a.nodeName&&(0===q?x=a:(1===q&&l.name&&(l.name="",l.sublayers.push(F(x,m,c))),l.sublayers.push(F(a,m,c))),q++)});if(!l)return null;var p,B,b=l.fullExtents;(p=l.sublayers)||(p=[]);0===p.length&&p.push(l);g=l.extent;g||
(g=new E(p[0].extent),l.extent=g.toJSON(),g=l.extent);B=l.spatialReferences;if(!B.length&&0<p.length){var y=function(a){var b=[];a.sublayers.forEach(function(a){!b.length&&a.spatialReferences.length&&(b=a.spatialReferences||y(a))});return b};p.forEach(function(a){B.length||(B=a.spatialReferences||y(a))})}var z=J(e,"GetFeatureInfo");z&&(e=K(e,"GetFeatureInfo"),-1<e.indexOf("text/html")?d="text/html":-1<e.indexOf("text/plain")&&(d="text/plain"));if(!d){var A=function(a){a&&(a.queryable=!1,a.sublayers&&
a.sublayers.forEach(function(a){A(a)}))};A(l)}e=I(p);p=l.minScale||0;var G=l.maxScale||0,M=l.dimensions,H=e.reduce(function(a,b){return a.concat(b.dimensions)},[]),H=M.concat(H).filter(L),N=null;if(0<H.length){var C=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY;H.forEach(function(a){a=a.extent;R(a)?a.forEach(function(a){C=Math.min(C,a.getTime());D=Math.max(D,a.getTime())}):a.forEach(function(a){C=Math.min(C,a.min.getTime());D=Math.max(D,a.max.getTime())})});N={startTimeField:null,endTimeField:null,
trackIdField:null,timeExtent:[C,D]}}return{copyright:r,description:t,dimensions:M,extent:g,fullExtents:b,featureInfoFormat:d,featureInfoUrl:z,mapUrl:w,maxImageWidth:u,maxImageHeight:f,maxScale:G,minScale:p,layers:e,spatialReferences:B,supportedImageFormatTypes:v,timeInfo:N,title:a,version:m}};g.coordsReversed=q;g.getPopupLayers=function(a){return a.length?a.filter(function(a){return a.popupEnabled&&a.name&&a.queryable}).map(function(a){return a.name}).join(","):""};g.isDimensionInterval=function(a){return void 0!==
a.min&&void 0!==a.max};g.isElevationDimension=function(a){return"elevation"===a.name};g.isGenericDimension=function(a){return"time"!==a.name&&"elevation"!==a.name};g.isTimeDimension=L;g.fromISODuration=G;g.toISOString=function(a){return a.toISOString().replace(/\.[0-9]{3}/,"")}});