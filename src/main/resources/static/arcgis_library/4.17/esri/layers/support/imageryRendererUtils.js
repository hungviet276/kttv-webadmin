// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../core/arrayUtils ../../core/lang ../../core/SetUtils ./RasterFunction ../../renderers/support/colorRampUtils ../../renderers/support/stretchRendererUtils ../../renderers/visualVariables/SizeVariable".split(" "),function(F,h,v,r,w,k,p,x,y){function t(a){var b=a.Raster;return b&&"esri.layers.support.RasterFunction"===b.declaredClass?t(b.functionArguments):a}function z(a,b){var e=new k;e.functionName="VectorFieldRenderer";var c=b.bandProperties;b="vector-uv"===b.dataType?
!0:!1;var d,g;c&&2===c.length&&(d=c.map(function(a){return a.BandName.toLowerCase()}).indexOf("magnitude"),g=c.map(function(a){return a.BandName.toLowerCase()}).indexOf("direction"));if(-1===d||null===d)d=0,g=1;var c="arithmetic"===a.rotationType?1:2,f="flow-from"===a.flowRepresentation?0:1,l=a.visualVariables?a.visualVariables.filter(function(a){return"Magnitude"===a.field})[0]:new y;a={magnitudeBandID:d,directionBandID:g,isUVComponents:b,referenceSystem:c,massFlowAngleRepresentation:f,symbolTileSize:50,
symbolTileSizeUnits:100,calculationMethod:"Vector Average",symbologyName:A[a.style.toLowerCase()],minimumMagnitude:l.minDataValue,maximumMagnitude:l.maxDataValue,minimumSymbolSize:l.minSize,maximumSymbolSize:l.maxSize};e.functionArguments=a;return e}function B(a,b){var e=[],c=[],d=[],g=[],f=b.pixelType,l=(b=b.rasterAttributeTable)&&b.features,h=u(b);if(l&&Array.isArray(l)&&a.classBreakInfos)return a.classBreakInfos.forEach(function(b,d){var e=b.symbol.color,c;e.a&&l.forEach(function(f){c=f.attributes[a.field];
(c>=b.minValue&&c<b.maxValue||d===a.classBreakInfos.length-1&&c>=b.minValue)&&g.push([f.attributes[h],e.r,e.g,e.b])})}),f=f?n(g,f):g,b=new k,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=f,b.variableName="Raster",b;a.classBreakInfos.forEach(function(a,b){var f=a.symbol&&a.symbol.color;f.a?(0===b?e.push(a.minValue,a.maxValue+1E-6):e.push(a.minValue+1E-6,a.maxValue+1E-6),c.push(b),g.push([b,f.r,f.g,f.b])):d.push(a.minValue,a.maxValue)});f=f?n(g,f):g;b=new k;b.functionName=
"Remap";b.functionArguments={InputRanges:e,OutputValues:c,NoDataRanges:d};b.variableName="Raster";var q=new k;q.functionName="Colormap";q.functionArguments={Colormap:f,Raster:b};return q}function n(a,b){(b=h.pixelTypeRanges[String(b).toLowerCase()])&&a.push([Math.floor(b[0]-1),0,0,0],[Math.ceil(b[1]+1),0,0,0]);return a}function u(a){if(a)return(a=(a=a.fields)&&v.find(a,function(a){return a&&a.name&&"value"===a.name.toLowerCase()}))&&a.name}function C(a,b){var e=[],c=b.pixelType,d=(b=b.rasterAttributeTable)&&
b.features,g=u(b),f=!1;a.uniqueValueInfos&&a.uniqueValueInfos.forEach(function(b){var c=b.symbol.color;c.a&&(a.field!==g&&d?d&&d.forEach(function(d){String(d.attributes[a.field])===String(b.value)&&e.push([d.attributes[g],c.r,c.g,c.b])}):isNaN(+b.value)?f=!0:e.push([+b.value,c.r,c.g,c.b]))});if(f)return null;c=c&&0<e.length?n(e,c):e;b=new k;b.functionName="Colormap";b.functionArguments={};b.functionArguments.Colormap=c;b.variableName="Raster";return b}function D(a){var b=[];a.forEach(function(a){Array.isArray(a)?
b.push(a):null!=a.min&&null!=a.max&&b.push([a.min,a.max,a.avg||0,a.stddev||0])});return b}Object.defineProperty(h,"__esModule",{value:!0});h.convertRendererToRenderingRule=h.combineRenderingRules=h.isSupportedRendererType=h.pixelTypeRanges=void 0;h.pixelTypeRanges={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4*1E39,3.4*1E39],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]};var A={simple_scalar:"Simple Scalar",
wind_speed:"Wind Barb",single_arrow:"Single Arrow",beaufort_kn:"Beaufort Wind (Knots)",beaufort_m:"Beaufort Wind (MetersPerSecond)",ocean_current_m:"Ocean Current (MetersPerSecond)",ocean_current_kn:"Ocean Current (Knots)"},E=w.SetFromValues(["raster-stretch","unique-value","class-breaks","raster-shaded-relief","vector-field"]);h.isSupportedRendererType=function(a){return E.has(a.type)};h.combineRenderingRules=function(a,b){if(!a||!b)return r.clone(a||b);a=r.clone(a);"none"!==b.functionName.toLowerCase()&&
(t(a.functionArguments).Raster=b);return a};h.convertRendererToRenderingRule=function(a,b){b=b||{};switch(a.type){case "raster-stretch":var e=new k;e.functionName="Stretch";var c=m[x.stretchTypeJSONDict.toJSON(a.stretchType)],d=D(a.statistics),d={StretchType:c,Statistics:d,DRA:a.dynamicRangeAdjustment,UseGamma:a.useGamma,Gamma:a.gamma,ComputeGamma:a.computeGamma};null!=a.outputMin&&(d.Min=a.outputMin);null!=a.outputMax&&(d.Max=a.outputMax);c===m.standardDeviation?(d.NumberOfStandardDeviations=a.numberOfStandardDeviations,
e.outputPixelType="u8"):c===m.percentClip?(d.MinPercent=a.minPercent,d.MaxPercent=a.maxPercent,e.outputPixelType="u8"):c===m.minMax?e.outputPixelType="u8":c===m.sigmoid&&(d.SigmoidStrengthLevel=a.sigmoidStrengthLevel);e.functionArguments=d;e.variableName="Raster";if(a.colorRamp){var c=a.colorRamp,d=new k,g=p.getColorRampName(c);d.functionArguments=g?{colorRamp:g}:!b.convertColorRampToColormap||"algorithmic"!==c.type&&"multipart"!==c.type?{colorRamp:a.colorRamp.toJSON()}:{Colormap:p.convertColorRampToColormap(c,
256)};d.variableName="Raster";d.functionName="Colormap";d.functionArguments.Raster=e;a=d}else a=e;return a;case "class-breaks":return B(a,b);case "unique-value":return C(a,b);case "raster-colormap":return(a=a.extractColormap())&&0!==a.length?(a=(b=b.pixelType)?n(a,b):a,b=new k,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=a,a=b):a=void 0,a;case "vector-field":return z(a,b);case "raster-shaded-relief":return"elevation"!==b.dataType?a=new k:(b=new k,b.functionName="Hillshade",
e="traditional"===a.hillshadeType?0:1,c="none"===a.scalingType?1:3,d={HillshadeType:e,SlopeType:c,ZFactor:a.zFactor},0===e&&(d.Azimuth=a.azimuth,d.Altitude=a.altitude),3===c&&(d.PSPower=a.pixelSizePower,d.PSZFactor=a.pixelSizeFactor),b.functionArguments=d,b.variableName="Raster",a.colorRamp&&(b.functionName="ShadedRelief",d.Colormap=p.convertColorRampToColormap(a.colorRamp,256)),a=b),a}};var m={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9}});