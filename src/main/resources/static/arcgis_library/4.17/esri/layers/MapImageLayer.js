// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/scaleUtils":function(){define(["require","exports","../../core/unitUtils"],function(u,g,a){function m(h,c){c=a.getMetersPerUnitForSR(c);return h/(c*a.inchesPerMeter*96)}Object.defineProperty(g,"__esModule",{value:!0});g.getExtentForScale=g.getScaleForResolution=g.getResolutionForScale=g.getScale=void 0;g.getScale=function(h,c){c=c||h.extent;h=h.width;var e=a.getMetersPerUnitForSR(c&&c.spatialReference);return c&&h?c.width/h*e*a.inchesPerMeter*96:0};g.getResolutionForScale=
m;g.getScaleForResolution=function(h,c){c=a.getMetersPerUnitForSR(c);return h*c*a.inchesPerMeter*96};g.getExtentForScale=function(a,c){var e=a.extent;a=a.width;c=m(c,e.spatialReference);return e.clone().expand(c*a/e.width)}})},"esri/layers/mixins/ArcGISMapService":function(){define("require exports tslib ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),function(u,
g,a,m,h,c,e,n,v,p){Object.defineProperty(g,"__esModule",{value:!0});g.ArcGISMapService=void 0;g.ArcGISMapService=function(g){return function(g){function b(){var a=null!==g&&g.apply(this,arguments)||this;a.capabilities=void 0;a.copyright=null;a.fullExtent=null;a.legendEnabled=!0;a.spatialReference=null;a.version=null;return a}a.__extends(b,g);b.prototype.readCapabilities=function(a,b){var c=b.capabilities&&b.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});if(!c)return{operations:{supportsQuery:!1,
supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};a=this.type;var e=-1!==c.indexOf("query"),g=-1!==c.indexOf("map"),f=!!b.exportTilesAllowed,c=-1!==c.indexOf("tilemap"),q="tile"!==a&&!!b.supportsDynamicLayers,D="tile"!==a&&(!b.tileInfo||q),h="tile"!==a&&(!b.tileInfo||q);return{operations:{supportsQuery:e,supportsExportMap:g,supportsExportTiles:f,supportsTileMap:c},exportMap:g?{supportsSublayersChanges:"tile"!==a,supportsDynamicLayers:q,supportsSublayerVisibility:D,
supportsSublayerDefinitionExpression:h}:null,exportTiles:f?{maxExportTilesCount:+b.maxExportTilesCount}:null}};b.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=b.hasOwnProperty("capabilities")||b.hasOwnProperty("tables")?10:b.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return a};b.prototype.fetchSublayerInfo=function(b,c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.fetchAllLayersAndTables(c)];case 1:return a.sent(),
[2,this._allLayersAndTablesMap.get(b)]}})})};b.prototype.fetchAllLayersAndTables=function(b){return a.__awaiter(this,void 0,void 0,function(){var e,g=this;return a.__generator(this,function(l){switch(l.label){case 0:return[4,this.load(b)];case 1:return l.sent(),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=m(c.urlToObject(this.url).path+"/layers",{responseType:"json",query:a.__assign({f:"json"},this.customParameters)}).then(function(a){g._allLayersAndTablesMap=new Map;for(var b=
0,c=a.data.layers;b<c.length;b++){var e=c[b];g._allLayersAndTablesMap.set(e.id,e)}return{result:a.data}},function(a){return{error:a}})),[4,this._allLayersAndTablesPromise];case 2:e=l.sent();h.throwIfAborted(b);if("result"in e)return[2,e.result];throw e.error;}})})};a.__decorate([e.property({readOnly:!0})],b.prototype,"capabilities",void 0);a.__decorate([e.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],b.prototype,"readCapabilities",
null);a.__decorate([e.property({json:{read:{source:"copyrightText"}}})],b.prototype,"copyright",void 0);a.__decorate([e.property({type:n})],b.prototype,"fullExtent",void 0);a.__decorate([e.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],b.prototype,"id",void 0);a.__decorate([e.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],b.prototype,"legendEnabled",void 0);a.__decorate([e.property(p.popupEnabled)],
b.prototype,"popupEnabled",void 0);a.__decorate([e.property({type:v})],b.prototype,"spatialReference",void 0);a.__decorate([e.property()],b.prototype,"version",void 0);a.__decorate([e.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],b.prototype,"readVersion",null);return b=a.__decorate([e.subclass("esri.layers.mixins.ArcGISMapService")],b)}(g)}})},"esri/layers/mixins/CustomParametersMixin":function(){define(["require","exports","tslib","../../core/accessorSupport/decorators"],
function(u,g,a,m){Object.defineProperty(g,"__esModule",{value:!0});g.CustomParametersMixin=void 0;g.CustomParametersMixin=function(g){return function(c){function e(){return null!==c&&c.apply(this,arguments)||this}a.__extends(e,c);a.__decorate([m.property({json:{write:!0,origins:{"web-scene":{write:!1}}}})],e.prototype,"customParameters",void 0);return e=a.__decorate([m.subclass("esri.layers.mixins.CustomParametersMixin")],e)}(g)}})},"esri/layers/mixins/SublayersOwner":function(){define("require exports tslib ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ../support/Sublayer ../support/sublayerUtils".split(" "),
function(u,g,a,m,h,c,e,n,v,p,l,B){function b(a,b){var f=[],c={};if(!a)return f;a.forEach(function(a){var e=new l;e.read(a,b);c[e.id]=e;null!=a.parentLayerId&&-1!==a.parentLayerId?(a=c[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(e)):f.unshift(e)});return f}function x(a,b){a&&a.forEach(function(a){b(a);a.sublayers&&a.sublayers.length&&x(a.sublayers,b)})}Object.defineProperty(g,"__esModule",{value:!0});g.SublayersOwner=g.forEachSublayer=void 0;var C=e.getLogger("esri.layers.TileLayer"),
y=m.ofType(l);g.forEachSublayer=x;g.SublayersOwner=function(e){return function(e){function f(){for(var a,b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];var f=e.apply(this,b)||this;f.allSublayers=new h({root:f,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return a.sublayers}});f.sublayersSourceJSON=(a={},a[2]={},a[3]={},a[4]={},a[5]={},a);f.watch("sublayers",function(a,b){return f._handleSublayersChange(a,b)},!0);return f}a.__extends(f,e);f.prototype.readSublayers=function(a,
b){if(b&&a){var c=this.sublayersSourceJSON,f=v.nameToId(b.origin);2>f||(c[f]={context:b,visibleLayers:a.visibleLayers||c[f].visibleLayers,layers:a.layers||c[f].layers},2<f||(this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers),b=this.createSublayersForOrigin("web-document"),a=b.sublayers,b=b.origin,c=p.getProperties(this),c.setDefaultOrigin(b),this._set("sublayers",new y(a)),c.setDefaultOrigin("user")))}};f.prototype.findSublayerById=function(a){return this.allSublayers.find(function(b){return b.id===
a})};f.prototype.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};f.prototype.createSublayersForOrigin=function(a){var c="web-document"===a?v.nameToId("web-map"):v.nameToId(a),f=2;a=this.sublayersSourceJSON[2].layers;for(var e=this.sublayersSourceJSON[2].context,g=null,h=0,m=[3,4,5].filter(function(a){return a<=c});h<m.length;h++){var l=m[h],n=this.sublayersSourceJSON[l];B.isSublayerOverhaul(n.layers)&&(f=l,a=n.layers,e=n.context,n.visibleLayers&&(g={visibleLayers:n.visibleLayers,
context:n.context}))}for(var q=null,h=0,m=[3,4,5].filter(function(a){return a>f&&a<=c});h<m.length;h++){var p=this.sublayersSourceJSON[m[h]],l=p.layers,n=p.visibleLayers,p=p.context;l&&(q={layers:l,context:p});n&&(g={visibleLayers:n,context:p})}a=b(a,e);var F=new Map,t=new Set;if(q)for(e=0,h=q.layers;e<h.length;e++)m=h[e],F.set(m.id,m);if(g)for(e=0,h=g.visibleLayers;e<h.length;e++)t.add(h[e]);x(a,function(a){q&&a.read(F.get(a.id),q.context);g&&a.read({defaultVisibility:t.has(a.id)},g.context)});return{origin:v.idToName(f),
sublayers:new y({items:a})}};f.prototype.read=function(a,b){e.prototype.read.call(this,a,b);this.readSublayers(a,b)};f.prototype._handleSublayersChange=function(a,b){var f=this;b&&(b.forEach(function(a){a.parent=null;a.layer=null}),this.handles.remove("sublayers-owner"));a&&(a.forEach(function(a){a.parent=f;a.layer=f}),this.handles.add([a.on("after-add",function(a){a=a.item;a.parent=f;a.layer=f}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})],"sublayers-owner"),"tile"===this.type&&
this.handles.add(a.on("before-changes",function(a){C.error(new c("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:f}));a.preventDefault()}),"sublayers-owner"))};a.__decorate([n.property({readOnly:!0})],f.prototype,"allSublayers",void 0);a.__decorate([n.property({readOnly:!0,type:m.ofType(l)})],f.prototype,"serviceSublayers",void 0);a.__decorate([n.property({value:null,type:y,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],f.prototype,
"sublayers",void 0);a.__decorate([n.property({readOnly:!0})],f.prototype,"sublayersSourceJSON",void 0);return f=a.__decorate([n.subclass("esri.layers.mixins.SublayersOwner")],f)}(e)}})},"esri/layers/support/Sublayer":function(){define("require exports tslib ../../geometry ../../PopupTemplate ../../renderers ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ./FeatureType ./Field ./FieldsIndex ./fieldUtils ./LabelClass ./source/DataLayerSource ./source/MapLayerSource ../../support/popupUtils ../../tasks/support/Query @dojo/framework/shim/Promise".split(" "),
function(u,g,a,m,h,c,e,n,v,p,l,B,b,x,C,y,J,K,f,q,D,E,I,L,M,N,O,H,A,Q,F){function t(a){return a&&"esriSMS"===a.type}function r(a,b,f){return{ignoreOrigin:!0,enabled:f&&f.writeSublayerStructure||!1}}function G(a,b,f){return{ignoreOrigin:!0,enabled:f?f.writeSublayerStructure||this.originIdOf(b)>=D.nameToId(f.origin):!1}}var P=C.getLogger("esri.layers.support.Sublayer"),R=0,z=new Set;z.add("layer");z.add("parent");z.add("loaded");z.add("loadStatus");z.add("loadError");z.add("loadWarnings");return function(g){function d(a){a=
g.call(this,a)||this;a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.globalIdField=null;a.legendEnabled=!0;a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=null;a.title=null;a.typeIdField=null;a.types=null;return a}a.__extends(d,g);l=d;d.prototype.load=function(w){return a.__awaiter(this,void 0,void 0,function(){var k=this;return a.__generator(this,function(b){this.addResolvingPromise(function(){return a.__awaiter(k,void 0,void 0,function(){var k,b,d,f,c;return a.__generator(this,
function(t){switch(t.label){case 0:if(!this.layer&&!this.url)throw new p("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});k=null;return!this.layer||2<this.originIdOf("url")||"data-layer"===(null===(f=this.source)||void 0===f?void 0:f.type)?[4,e(this.url,a.__assign({responseType:"json",query:{f:"json"}},w))]:[3,2];case 1:return b=t.sent(),k=b.data,[3,4];case 2:return d=this.id,"map-layer"===(null===(c=this.source)||void 0===c?void 0:c.type)&&(d=this.source.mapLayerId),
[4,this.layer.fetchSublayerInfo(d,w)];case 3:k=t.sent(),t.label=4;case 4:return k&&(this.sourceJSON=k,this.read({layerDefinition:k},{origin:"service"})),[2]}})})}());return[2,this]})})};d.prototype.readCapabilities=function(a,k){k=k.layerDefinition||k;a=(a=k.capabilities||a)?a.toLowerCase().split(",").map(function(a){return a.trim()}):[];return{exportMap:{supportsModification:!!k.canModifyLayer},operations:{supportsQuery:-1!==a.indexOf("query")}}};Object.defineProperty(d.prototype,"definitionExpression",
{set:function(a){this._setAndNotifyLayer("definitionExpression",a)},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"fieldsIndex",{get:function(){return new M(this.fields||[])},enumerable:!1,configurable:!0});d.prototype.readGlobalIdFieldFromService=function(a,k){k=k.layerDefinition||k;if(k.globalIdField)return k.globalIdField;if(k.fields)for(a=0,k=k.fields;a<k.length;a++){var w=k[a];if("esriFieldTypeGlobalID"===w.type)return w.name}};Object.defineProperty(d.prototype,"id",{get:function(){var a=
this._get("id");return null==a?R++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"labelingInfo",{set:function(a){this._setAndNotifyLayer("labelingInfo",a)},enumerable:!1,configurable:!0});d.prototype.writeLabelingInfo=function(a,k,b,d){a&&a.length&&
(k.layerDefinition={drawingInfo:{labelingInfo:a.map(function(a){return a.write({},d)})}})};Object.defineProperty(d.prototype,"labelsVisible",{set:function(a){this._setAndNotifyLayer("labelsVisible",a)},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"layer",{set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(function(w){return w.layer=a})},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"listMode",{set:function(a){this._set("listMode",a)},
enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"minScale",{set:function(a){this._setAndNotifyLayer("minScale",a)},enumerable:!1,configurable:!0});d.prototype.readMinScale=function(a,k){return k.minScale||k.layerDefinition&&k.layerDefinition.minScale||0};Object.defineProperty(d.prototype,"maxScale",{set:function(a){this._setAndNotifyLayer("maxScale",a)},enumerable:!1,configurable:!0});d.prototype.readMaxScale=function(a,k){return k.maxScale||k.layerDefinition&&k.layerDefinition.maxScale||
0};d.prototype.readObjectIdFieldFromService=function(a,k){k=k.layerDefinition||k;if(k.objectIdField)return k.objectIdField;if(k.fields)for(a=0,k=k.fields;a<k.length;a++){var w=k[a];if("esriFieldTypeOID"===w.type)return w.name}};Object.defineProperty(d.prototype,"opacity",{set:function(a){this._setAndNotifyLayer("opacity",a)},enumerable:!1,configurable:!0});d.prototype.readOpacity=function(a,k){a=k.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};d.prototype.writeOpacity=
function(a,k,b,d){k.layerDefinition={drawingInfo:{transparency:100-100*a}}};d.prototype.writeParent=function(a,k){k.parentLayerId=this.parent&&this.parent!==this.layer?this.parent.id:-1};Object.defineProperty(d.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"renderer",{set:function(a){if(a)for(var k=0,b=a.getSymbols();k<b.length;k++)if(n.isSymbol3D(b[k])){P.warn("Sublayer renderer should use 2D symbols");
break}this._setAndNotifyLayer("renderer",a)},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"source",{get:function(){return this._get("source")||new A.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"sublayers",{set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)},enumerable:!1,configurable:!0});d.prototype.castSublayers=function(a){return q.default(v.ofType(l),
a)};d.prototype.writeSublayers=function(a,b,d){this.get("sublayers.length")&&(b[d]=this.sublayers.map(function(a){return a.id}).toArray().reverse())};d.prototype.readTypeIdField=function(a,b){b=b.layerDefinition||b;if(a=b.typeIdField)if(b=N.getField(b.fields,a))return b.name;return null};Object.defineProperty(d.prototype,"url",{get:function(){var a,b,d=null!==(b=null===(a=this.layer)||void 0===a?void 0:a.parsedUrl)&&void 0!==b?b:this._lastParsedUrl;a=this.source;if(!d)return null;this._lastParsedUrl=
d;if("map-layer"===(null===a||void 0===a?void 0:a.type))return d.path+"/"+a.mapLayerId;a={layer:JSON.stringify({source:this.source})};return d.path+"/dynamicLayer?"+K.objectToQuery(a)},set:function(a){a?this._override("url",a):this._clearOverride("url")},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"visible",{set:function(a){this._setAndNotifyLayer("visible",a)},enumerable:!1,configurable:!0});d.prototype.writeVisible=function(a,b,d,f){b[d]=this.getAtOrigin("defaultVisibility",
"service")||a};d.prototype.clone=function(){var a=E.getProperties(this).store,b=new l;E.getProperties(b).store=a.clone(z);this.url;b._lastParsedUrl=this._lastParsedUrl;return b};d.prototype.createPopupTemplate=function(a){return Q.createPopupTemplate(this,a)};d.prototype.createQuery=function(){return new F({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};d.prototype.createFeatureLayer=function(){var d,k;return a.__awaiter(this,void 0,void 0,function(){var f,c,e;return a.__generator(this,
function(a){switch(a.label){case 0:if(this.hasOwnProperty("sublayers"))return[2,null];f=null===(d=this.layer)||void 0===d?void 0:d.parsedUrl;return[4,new Promise(function(a,b){u(["../FeatureLayer"],a,b)})];case 1:return c=a.sent(),e=new c({url:f.path}),f&&this.source&&("map-layer"===this.source.type?e.layerId=this.source.mapLayerId:e.dynamicDataSource=this.source),null!=this.layer.refreshInterval&&(e.refreshInterval=this.layer.refreshInterval),this.definitionExpression&&(e.definitionExpression=this.definitionExpression),
2<this.originIdOf("labelingInfo")&&(e.labelingInfo=b.clone(this.labelingInfo)),0<this.originIdOf("labelsVisible")&&(e.labelsVisible=this.labelsVisible),0<this.originIdOf("legendEnabled")&&(e.legendEnabled=this.legendEnabled),0<this.originIdOf("visible")&&(e.visible=this.visible),0<this.originIdOf("minScale")&&(e.minScale=this.minScale),0<this.originIdOf("maxScale")&&(e.maxScale=this.maxScale),0<this.originIdOf("opacity")&&(e.opacity=this.opacity),0<this.originIdOf("popupTemplate")&&(e.popupTemplate=
b.clone(this.popupTemplate)),2<this.originIdOf("renderer")&&(e.renderer=b.clone(this.renderer)),"data-layer"===(null===(k=this.source)||void 0===k?void 0:k.type)&&(e.dynamicDataSource=this.source.clone()),0<this.originIdOf("title")&&(e.title=this.title),[2,e]}})})};d.prototype.getFeatureType=function(a){var b=this.typeIdField;if(!b||!a)return null;var d=a.attributes?a.attributes[b]:void 0;if(null==d)return null;var f=null;this.types.some(function(a){var b=a.id;if(null==b)return!1;b.toString()===d.toString()&&
(f=a);return!!f});return f};d.prototype.getFieldDomain=function(a,b){return(b=this.getFeatureType(b&&b.feature))&&(b=b.domains&&b.domains[a])&&"inherited"!==b.type?b:this._getLayerDomain(a)};d.prototype.queryFeatures=function(a,b){var d=this;void 0===a&&(a=this.createQuery());return this.load().then(function(){if(!d.get("capabilities.operations.supportsQuery"))throw new p("Sublayer.queryFeatures","this layer doesn't support queries.");return J.all([new Promise(function(a,b){u(["../../tasks/operations/query"],
a,b)}),new Promise(function(a,b){u(["../../tasks/support/FeatureSet"],a,b)})])}).then(function(f){var e=f[0].executeQuery,c=f[1];return e(d.url,F.from(a),d.layer?d.layer.spatialReference:null,b).then(function(a){return c.fromJSON(a.data)})}).then(function(a){a&&a.features&&a.features.forEach(function(a){a.sourceLayer=d});return a})};d.prototype.toExportImageJSON=function(){var a=this,b,d={id:this.id,source:null===(b=this.source)||void 0===b?void 0:b.toJSON()};this.definitionExpression&&(d.definitionExpression=
this.definitionExpression);var f=["renderer","labelingInfo","opacity","labelsVisible"].reduce(function(b,d){b[d]=a.originIdOf(d);return b},{});Object.keys(f).some(function(a){return 2<=f[a]})&&(b=d.drawingInfo={},2<=f.renderer&&(b.renderer=this.renderer?this.renderer.toJSON():null),2<=f.labelsVisible&&(b.showLabels=this.labelsVisible),this.labelsVisible&&2<=f.labelingInfo&&(b.labelingInfo=this.labelingInfo?this.labelingInfo.map(function(a){return a.write({},{origin:"service"})}):null,b.showLabels=
!0),2<=f.opacity&&(b.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(b.renderer));return d};d.prototype._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,function(a){a.color||"esriSMSX"!==a.style&&"esriSMSCross"!==a.style||(a.color=a.outline&&a.outline.color?a.outline.color:[0,0,0,0])})};d.prototype._forEachSimpleMarkerSymbols=function(a,b){if(a){var d=0,f="uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:[];for(;d<f.length;d++){var e=
f[d];t(e.symbol)&&b(e.symbol)}"symbol"in a&&t(a.symbol)&&b(a.symbol);"defaultSymbol"in a&&t(a.defaultSymbol)&&b(a.defaultSymbol)}};d.prototype._setAndNotifyLayer=function(a,b){var d=this.layer,f=this._get(a),e,c;switch(a){case "definitionExpression":e="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":e="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":e="supportsDynamicLayers",c="supportsModification"}var k=
E.getProperties(this).getDefaultOrigin();if("service"!==k){if(e&&!1===this.get("layer.capabilities.exportMap."+e)){this._logLockedError(a,"capability not available 'layer.capabilities.exportMap."+e+"'");return}if(c&&!1===this.get("capabilities.exportMap."+c)){this._logLockedError(a,"capability not available 'capabilities.exportMap."+c+"'");return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,b),"service"!==
k&&f!==b&&d&&d.emit&&d.emit("sublayer-update",{propertyName:a,target:this}))};d.prototype._handleSublayersChange=function(a,b){var d=this;b&&(b.forEach(function(a){a.parent=null;a.layer=null}),this.handles.removeAll());a&&(a.forEach(function(a){a.parent=d;a.layer=d.layer}),this.handles.add([a.on("after-add",function(a){a=a.item;a.parent=d;a.layer=d.layer}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null}),a.on("before-changes",function(a){var b=d.get("layer.capabilities.exportMap.supportsSublayersChanges");
null==b||b||(P.error(new p("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:d,layer:d.layer})),a.preventDefault())})]))};d.prototype._logLockedError=function(a,b){P.error(new p("sublayer:locked","Property '"+a+"' can't be changed on Sublayer from the layer '"+this.layer.id+"'",{reason:b,sublayer:this,layer:this.layer}))};d.prototype._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};var l;d.test={isSublayerStructureOverridePolicy:function(a){return a===
r}};a.__decorate([f.property({readOnly:!0})],d.prototype,"capabilities",void 0);a.__decorate([f.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],d.prototype,"readCapabilities",null);a.__decorate([f.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression",overridePolicy:G}}})],d.prototype,"definitionExpression",null);a.__decorate([f.property({type:[L],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],
d.prototype,"fields",void 0);a.__decorate([f.property({readOnly:!0,dependsOn:["fields"]})],d.prototype,"fieldsIndex",null);a.__decorate([f.property({type:m.Extent,json:{read:{source:"layerDefinition.extent"}}})],d.prototype,"fullExtent",void 0);a.__decorate([f.property({type:String})],d.prototype,"globalIdField",void 0);a.__decorate([f.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],d.prototype,"readGlobalIdFieldFromService",null);a.__decorate([f.property({type:Number,
json:{write:{ignoreOrigin:!0}}})],d.prototype,"id",null);a.__decorate([f.property({value:null,type:[O],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:r}}})],d.prototype,"labelingInfo",null);a.__decorate([f.writer("labelingInfo")],d.prototype,"writeLabelingInfo",null);a.__decorate([f.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",
overridePolicy:r}}})],d.prototype,"labelsVisible",null);a.__decorate([f.property({value:null})],d.prototype,"layer",null);a.__decorate([f.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:G}}})],d.prototype,"legendEnabled",void 0);a.__decorate([f.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],d.prototype,"listMode",null);a.__decorate([f.property({type:Number,
value:0,json:{write:{overridePolicy:r}}})],d.prototype,"minScale",null);a.__decorate([f.reader("minScale",["minScale","layerDefinition.minScale"])],d.prototype,"readMinScale",null);a.__decorate([f.property({type:Number,value:0,json:{write:{overridePolicy:r}}})],d.prototype,"maxScale",null);a.__decorate([f.reader("maxScale",["maxScale","layerDefinition.maxScale"])],d.prototype,"readMaxScale",null);a.__decorate([f.property({type:String})],d.prototype,"objectIdField",void 0);a.__decorate([f.reader("service",
"objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],d.prototype,"readObjectIdFieldFromService",null);a.__decorate([f.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:r}}})],d.prototype,"opacity",null);a.__decorate([f.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],d.prototype,"readOpacity",null);a.__decorate([f.writer("opacity")],d.prototype,"writeOpacity",null);a.__decorate([f.property({json:{type:Number,
write:{target:"parentLayerId",allowNull:!0,overridePolicy:r}}})],d.prototype,"parent",void 0);a.__decorate([f.writer("parent")],d.prototype,"writeParent",null);a.__decorate([f.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(a,b){return!b.disablePopup}},write:{target:"disablePopup",overridePolicy:G,writer:function(a,b,d){b[d]=!a}}}})],d.prototype,"popupEnabled",void 0);a.__decorate([f.property({type:h,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:G}}})],
d.prototype,"popupTemplate",void 0);a.__decorate([f.property({readOnly:!0,dependsOn:["fields","title"]})],d.prototype,"defaultPopupTemplate",null);a.__decorate([f.property({types:c.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:r},origins:{"web-scene":{types:c.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:r}}}}})],d.prototype,"renderer",null);a.__decorate([f.property({types:{key:"type",base:null,typeMap:{"data-layer":H.DataLayerSource,
"map-layer":A.MapLayerSource}},cast:function(a){if(a){if("mapLayerId"in a)return q.ensureClass(A.MapLayerSource,a);if("dataSource"in a)return q.ensureClass(H.DataLayerSource,a)}return a},json:{name:"layerDefinition.source",write:{overridePolicy:r}}})],d.prototype,"source",null);a.__decorate([f.property()],d.prototype,"sourceJSON",void 0);a.__decorate([f.property({value:null,json:{type:[q.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:r}}})],d.prototype,"sublayers",null);a.__decorate([f.cast("sublayers")],
d.prototype,"castSublayers",null);a.__decorate([f.writer("sublayers")],d.prototype,"writeSublayers",null);a.__decorate([f.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:G}}})],d.prototype,"title",void 0);a.__decorate([f.property({type:String})],d.prototype,"typeIdField",void 0);a.__decorate([f.reader("typeIdField",["layerDefinition.typeIdField"])],d.prototype,"readTypeIdField",null);a.__decorate([f.property({type:[I],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],
d.prototype,"types",void 0);a.__decorate([f.property({type:String,dependsOn:["layer","source"],json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:function(){return{enabled:this._isOverridden("url")}}}}})],d.prototype,"url",null);a.__decorate([f.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:r}}})],d.prototype,"visible",null);a.__decorate([f.writer("visible")],d.prototype,"writeVisible",null);return d=l=a.__decorate([f.subclass("esri.layers.support.Sublayer")],
d)}(l.HandleOwnerMixin(y.MultiOriginJSONMixin(B.IdentifiableMixin(x))))})},"esri/layers/support/sublayerUtils":function(){define(["require","exports"],function(u,g){function a(a,g){if(!a||!a.length)return!0;g=g.slice().reverse().flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).map(function(a){return a.id}).toArray();if(a.length>g.length)return!1;for(var c=0,e=g.length,h=0;h<a.length;h++){for(var m=a[h].id;c<e&&g[c]!==m;)c++;if(c>=e)return!1}return!0}Object.defineProperty(g,"__esModule",
{value:!0});g.isSublayerOverhaul=g.isExportDynamic=g.shouldWriteSublayerStructure=void 0;g.shouldWriteSublayerStructure=function(g,h,c){return h.flatten(function(a){return a.sublayers}).length!==g.length||g.some(function(a){return a.originIdOf("minScale")>c||a.originIdOf("maxScale")>c||a.originIdOf("renderer")>c||a.originIdOf("labelingInfo")>c||a.originIdOf("opacity")>c||a.originIdOf("labelsVisible")>c||a.originIdOf("source")>c})?!0:!a(g,h)};g.isExportDynamic=function(g,h,c){return g.some(function(a){var e=
a.source;return!(!e||"map-layer"===e.type&&e.mapLayerId===a.id&&(!e.gdbVersion||e.gdbVersion===c.gdbVersion))||2<a.originIdOf("renderer")||2<a.originIdOf("labelingInfo")||2<a.originIdOf("opacity")||2<a.originIdOf("labelsVisible")})?!0:!a(g,h)};g.isSublayerOverhaul=function(a){return!!a&&a.some(function(a){return null!=a.minScale||a.layerDefinition&&null!=a.layerDefinition.minScale})}})},"esri/layers/support/ExportImageParameters":function(){define("require exports tslib ../../core/Accessor ../../core/HandleOwner ../../core/accessorSupport/decorators ./commonProperties ./sublayerUtils ../../views/View".split(" "),
function(u,g,a,m,h,c,e,n,v){Object.defineProperty(g,"__esModule",{value:!0});g.ExportImageParameters=void 0;var p={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};u=function(g){function h(){var a=null!==g&&g.apply(this,arguments)||this;a._scale=null;a.view=null;return a}a.__extends(h,g);
h.prototype.destroy=function(){this.layer=this.view=null};Object.defineProperty(h.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;var a=this.visibleSublayers.map(function(a){return a.toExportImageJSON()});return a.length?JSON.stringify(a):null},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"hasDynamicLayers",{get:function(){return this.layer&&n.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!1,configurable:!0});
Object.defineProperty(h.prototype,"layer",{set:function(a){var b=this;this._get("layer")!==a&&(this._set("layer",a),this.handles.remove("layer"),a&&this.handles.add([a.allSublayers.on("change",function(){return b.notifyChange("visibleSublayers")}),a.on("sublayer-update",function(a){return b.notifyChange(p[a.propertyName])})],"layer"))},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"layers",{get:function(){var a=this.visibleSublayers;return a?a.length?"show:"+a.map(function(a){return a.id}).join(","):
"show:-1":null},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"layerDefs",{get:function(){var a=this.visibleSublayers.filter(function(a){return null!=a.definitionExpression});return a.length?JSON.stringify(a.reduce(function(a,b){a[b.id]=b.definitionExpression;return a},{})):null},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"scale",{get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(a){this.view||(this._scale=a,
this.notifyChange("scale"))},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"version",{get:function(){this.layers;this.layerDefs;this.dynamicLayers;this.timeExtent;var a=this.layer;a&&(a.dpi,a.imageFormat,a.imageTransparency,a.gdbVersion);return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"visibleSublayers",{get:function(){var a=this,c=[];if(!this.layer)return c;var e=this.layer.sublayers,
g=function(b){var e=a.scale,f=0===b.minScale||e<=b.minScale,h=0===b.maxScale||e>=b.maxScale;b.visible&&(0===e||f&&h)&&(b.sublayers?b.sublayers.forEach(g):c.unshift(b))};e&&e.forEach(g);e=this._get("visibleSublayers");return!e||e.length!==c.length||e.some(function(a,b){return c[b]!==a})?c:e},enumerable:!1,configurable:!0});h.prototype.toJSON=function(){var b=this.layer,b={dpi:b.dpi,format:b.imageFormat,transparent:b.imageTransparency,gdbVersion:b.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?
b.dynamicLayers=this.dynamicLayers:b=a.__assign(a.__assign({},b),{layers:this.layers,layerDefs:this.layerDefs});return b};a.__decorate([c.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],h.prototype,"dynamicLayers",null);a.__decorate([c.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],h.prototype,"hasDynamicLayers",null);a.__decorate([c.property()],h.prototype,"layer",null);a.__decorate([c.property({readOnly:!0,dependsOn:["visibleSublayers"]})],
h.prototype,"layers",null);a.__decorate([c.property({readOnly:!0,dependsOn:["visibleSublayers"]})],h.prototype,"layerDefs",null);a.__decorate([c.property({type:Number,dependsOn:["view.scale"]})],h.prototype,"scale",null);a.__decorate([c.property(e.combinedViewLayerTimeExtentProperty)],h.prototype,"timeExtent",void 0);a.__decorate([c.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion timeExtent".split(" ")})],h.prototype,"version",
null);a.__decorate([c.property({type:v})],h.prototype,"view",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],h.prototype,"visibleSublayers",null);return h=a.__decorate([c.subclass("esri.layers.mixins.ExportImageParameters")],h)}(h.HandleOwnerMixin(m));g.ExportImageParameters=u})},"*noref":1}});
define("require exports tslib ../request ../core/Error ../core/HandleOwner ../core/loadAll ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/accessorSupport/PropertyOrigin ../geometry/support/scaleUtils ./Layer ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./mixins/TemporalLayer ./support/commonProperties ./support/ExportImageParameters ./support/Sublayer ./support/sublayerUtils".split(" "),function(u,
g,a,m,h,c,e,n,v,p,l,B,b,x,C,y,J,K,f,q,D,E,I,L,M,N,O,H,A){return function(f){function c(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];a=f.apply(this,a)||this;a.alwaysRefetch=!1;a.dpi=96;a.gdbVersion=null;a.imageFormat="png24";a.imageMaxHeight=2048;a.imageMaxWidth=2048;a.imageTransparency=!0;a.labelsVisible=!1;a.isReference=null;a.operationalLayerType="ArcGISMapServiceLayer";a.sourceJSON=null;a.sublayers=null;a.type="map-image";a.url=null;return a}a.__extends(c,f);c.prototype.normalizeCtorArgs=
function(b,c){return"string"===typeof b?a.__assign({url:b},c):b};c.prototype.load=function(a){var b=this,c=n.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},a).then(function(){return b._fetchService(c)},function(){return b._fetchService(c)}));return p.resolve(this)};c.prototype.readImageFormat=function(a,b){return(a=b.supportedImageFormatTypes)&&-1<a.indexOf("PNG32")?"png32":"png24"};c.prototype.writeSublayers=function(c,f,e,g){if(this.loaded&&
c){c=c.slice().reverse().flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray();e=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){var h=b.nameToId(g.origin);3===h?(e=this.createSublayersForOrigin("service").sublayers,e=A.shouldWriteSublayerStructure(c,e,2)):3<h&&(e=this.createSublayersForOrigin("portal-item"),e=A.shouldWriteSublayerStructure(c,e.sublayers,b.nameToId(e.origin)))}var l=[],t=a.__assign({writeSublayerStructure:e},
g),d=e;c.forEach(function(a){var b=a.write({},t);l.push(b);d=d||"user"===a.originOf("visible")});l.some(function(a){return 1<Object.keys(a).length})&&(f.layers=l);d&&(f.visibleLayers=c.filter(function(a){return a.visible}).map(function(a){return a.id}))}};c.prototype.createExportImageParameters=function(b,c,f,e){var g=e&&e.pixelRatio||1;b&&10<=this.version&&(b=b.clone().shiftCentralMeridian());var h=new O.ExportImageParameters({layer:this,scale:x.getScale({extent:b,width:c})*g}),l=h.toJSON();h.destroy();
var h=!e||!e.rotation||10.3>this.version?{}:{rotation:-e.rotation},d=b&&b.spatialReference,d=d.wkid||JSON.stringify(d.toJSON());l.dpi*=g;g={};if(null===e||void 0===e?0:e.timeExtent){var m=e.timeExtent.toJSON();e=m.start;m=m.end;g.time=e&&m&&e===m?""+e:(null==e?"null":e)+","+(null==m?"null":m)}else this.timeInfo&&!this.timeInfo.hasLiveData&&(g.time="null,null");return a.__assign(a.__assign(a.__assign({bbox:b&&b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,bboxSR:d,imageSR:d,size:c+","+f},l),h),g)};c.prototype.fetchImage=
function(b,c,e,f){return a.__awaiter(this,void 0,void 0,function(){var g,l,n,d;return a.__generator(this,function(r){g={responseType:"image"};f&&f.timestamp&&(g.query={_ts:f.timestamp});f&&f.signal&&(g.signal=f.signal);l=this.parsedUrl.path+"/export";n=a.__assign(a.__assign(a.__assign({},this.parsedUrl.query),this.createExportImageParameters(b,c,e,f)),{f:"image",_ts:this.alwaysRefetch?Date.now():null});if(null!=n.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)return[2,p.reject(new h("mapimagelayer:dynamiclayer-not-supported",
"service "+this.url+" doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.",{query:n}))];g.query=g.query?a.__assign(a.__assign({},n),g.query):n;d=m(l,g);return[2,d.then(function(a){return a.data}).catch(function(a){if(p.isAbortError(a))throw a;throw new h("mapimagelayer:image-fetch-error","Unable to load image: "+l,{error:a});})]})})};c.prototype.loadAll=function(){var a=this;return e.default(this,function(b){b(a.allSublayers)})};
c.prototype._fetchService=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,e,f;return a.__generator(this,function(g){switch(g.label){case 0:return this.sourceJSON?(this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl}),[2]):[4,m(this.parsedUrl.path,{query:a.__assign({f:"json"},this.parsedUrl.query),signal:b})];case 1:c=g.sent();e=c.data;if(f=c.ssl)this.url=this.url.replace(/^http:/i,"https:");this.sourceJSON=e;this.read(e,{origin:"service",url:this.parsedUrl});return[2]}})})};
a.__decorate([l.property()],c.prototype,"alwaysRefetch",void 0);a.__decorate([l.property()],c.prototype,"dpi",void 0);a.__decorate([l.property()],c.prototype,"gdbVersion",void 0);a.__decorate([l.property({json:{read:!1,write:!1}})],c.prototype,"popupEnabled",void 0);a.__decorate([l.property()],c.prototype,"imageFormat",void 0);a.__decorate([l.reader("imageFormat",["supportedImageFormatTypes"])],c.prototype,"readImageFormat",null);a.__decorate([l.property({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],
c.prototype,"imageMaxHeight",void 0);a.__decorate([l.property({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],c.prototype,"imageMaxWidth",void 0);a.__decorate([l.property()],c.prototype,"imageTransparency",void 0);a.__decorate([l.property({json:{read:!1,write:!1}})],c.prototype,"labelsVisible",void 0);a.__decorate([l.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],c.prototype,"isReference",void 0);a.__decorate([l.property({type:["ArcGISMapServiceLayer"]})],
c.prototype,"operationalLayerType",void 0);a.__decorate([l.property()],c.prototype,"sourceJSON",void 0);a.__decorate([l.property({json:{write:{ignoreOrigin:!0}}})],c.prototype,"sublayers",void 0);a.__decorate([l.writer("sublayers",{layers:{type:[H]},visibleLayers:{type:[B.Integer]}})],c.prototype,"writeSublayers",null);a.__decorate([l.property({type:["show","hide","hide-children"]})],c.prototype,"listMode",void 0);a.__decorate([l.property({json:{read:!1},readOnly:!0,value:"map-image"})],c.prototype,
"type",void 0);a.__decorate([l.property(N.url)],c.prototype,"url",void 0);return c=a.__decorate([l.subclass("esri.layers.MapImageLayer")],c)}(K.BlendLayer(M.TemporalLayer(I.ScaleRangeLayer(E.RefreshableLayer(L.SublayersOwner(y.ArcGISMapService(J.ArcGISService(q.OperationalLayer(D.PortalLayer(v.MultiOriginJSONMixin(f.CustomParametersMixin(c.HandleOwnerMixin(C)))))))))))))});