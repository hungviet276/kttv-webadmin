// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../geometry ../core/Collection ../core/CollectionFlattener ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/SpatialReference ./Layer ./mixins/BlendLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/KMLSublayer ./support/kmlUtils".split(" "),function(A,B,c,n,p,q,r,t,h,d,k,u,v,w,x,y,z,l,g){return function(m){function b(){for(var a=[],b=0;b<arguments.length;b++)a[b]=
arguments[b];a=m.apply(this,a)||this;a._visibleFolders=[];a.allSublayers=new q({root:a,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return a.sublayers}});a.outSpatialReference=k.WGS84;a.path=null;a.operationalLayerType="KML";a.sublayers=null;a.type="kml";a.url=null;return a}c.__extends(b,m);b.prototype.initialize=function(){var a=this;this.watch("sublayers",function(b,e){e&&e.forEach(function(a){a.parent=null;a.layer=null});b&&b.forEach(function(b){b.parent=a;b.layer=a})},!0);
this.on("sublayer-update",function(){return a.notifyChange("fullExtent")})};b.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?c.__assign({url:a},b):a};b.prototype.readSublayersFromItemOrWebMap=function(a,b){this._visibleFolders=b.visibleFolders};b.prototype.readSublayers=function(a,b,e){return g.sublayersFromJSON(l,b,e,this._visibleFolders)};b.prototype.writeSublayers=function(a,b){var e=[];for(a=a.toArray();a.length;){var c=a[0];c.networkLink||(c.visible&&e.push(c.id),c.sublayers&&
a.push.apply(a,c.sublayers.toArray()));a.shift()}b.visibleFolders=e};Object.defineProperty(b.prototype,"title",{get:function(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){var a=this.url.substring(this.url.lastIndexOf("/")+1,this.parsedUrl.path.lastIndexOf("."));0===a.length&&(a="KML");return a}return this._get("title")||""},set:function(a){this._set("title",a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"visibleSublayers",
{get:function(){var a=this.sublayers,b=[],c=function(a){a.visible&&(b.push(a),a.sublayers&&a.sublayers.forEach(c))};a&&a.forEach(c);return b},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"fullExtent",{get:function(){return this._recomputeFullExtent()},enumerable:!1,configurable:!0});b.prototype.load=function(a){var b=this,c=r.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["KML"]},a).then(function(){return b._fetchService(c)}));return h.resolve(this)};
b.prototype._fetchService=function(a){return c.__awaiter(this,void 0,void 0,function(){var b,d,f=this;return c.__generator(this,function(c){switch(c.label){case 0:return[4,h.resolve().then(function(){return f.resourceInfo?{ssl:!1,data:f.resourceInfo}:g.fetchService(f.url,f.outSpatialReference,f.refreshInterval,a)})];case 1:return b=c.sent(),(d=g.parseKML(b.data))&&this.read(d,{origin:"service"}),[2]}})})};b.prototype._recomputeFullExtent=function(){var a=null;this.extent&&(a=this.extent.clone());
var b=function(c){if(c.sublayers){var d=0;for(c=c.sublayers.items;d<c.length;d++){var e=c[d];b(e);e.visible&&e.fullExtent&&(a?a.union(e.fullExtent):a=e.fullExtent.clone())}}};b(this);return a};c.__decorate([d.property({readOnly:!0})],b.prototype,"allSublayers",void 0);c.__decorate([d.property({type:k})],b.prototype,"outSpatialReference",void 0);c.__decorate([d.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],b.prototype,"path",void 0);c.__decorate([d.property({type:["show",
"hide","hide-children"]})],b.prototype,"listMode",void 0);c.__decorate([d.property({type:["KML"]})],b.prototype,"operationalLayerType",void 0);c.__decorate([d.property({type:p.ofType(l),json:{write:{ignoreOrigin:!0}}})],b.prototype,"sublayers",void 0);c.__decorate([d.reader(["web-map","portal-item"],"sublayers",["visibleFolders"])],b.prototype,"readSublayersFromItemOrWebMap",null);c.__decorate([d.reader("service","sublayers",["sublayers"])],b.prototype,"readSublayers",null);c.__decorate([d.writer("sublayers")],
b.prototype,"writeSublayers",null);c.__decorate([d.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);c.__decorate([d.property({json:{origins:{"web-map":{read:{source:"title"}}},write:{ignoreOrigin:!0}},dependsOn:["url","parsedUrl"]})],b.prototype,"title",null);c.__decorate([d.property()],b.prototype,"url",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["sublayers"]})],b.prototype,"visibleSublayers",null);c.__decorate([d.property({type:n.Extent})],b.prototype,"extent",void 0);
c.__decorate([d.property({dependsOn:["extent"]})],b.prototype,"fullExtent",null);return b=c.__decorate([d.subclass("esri.layers.KMLLayer")],b)}(v.BlendLayer(y.RefreshableLayer(z.ScaleRangeLayer(w.OperationalLayer(x.PortalLayer(t.MultiOriginJSONMixin(u)))))))});