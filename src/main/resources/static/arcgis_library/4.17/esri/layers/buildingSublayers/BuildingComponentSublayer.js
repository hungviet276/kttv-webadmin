// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../PopupTemplate ../../renderers ../../request ../../core/Error ../../core/jsonMap ../../core/Loadable ../../core/maybe ../../core/Promise ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/SpatialReference ../FeatureLayer ./BuildingSublayer ../support/commonProperties ../support/fieldProperties ../support/FieldsIndex ../support/I3SLayerDefinitions ../../support/popupUtils ../../symbols/support/ElevationInfo ../../tasks/support/Query".split(" "),
function(F,G,b,p,q,r,g,t,u,e,v,h,c,w,x,k,y,z,A,B,f,C,D,E){var l=A.defineFieldProperties();return function(m){function a(d){d=m.call(this,d)||this;d.type="building-component";d.nodePages=null;d.materialDefinitions=null;d.textureSetDefinitions=null;d.geometryDefinitions=null;d.serviceUpdateTimeStamp=null;d.fields=null;d.associatedLayer=null;d.outFields=null;d.listMode="show";d.renderer=null;d.definitionExpression=null;d.popupEnabled=!0;d.popupTemplate=null;d.layerType="3d-object";return d}b.__extends(a,
m);Object.defineProperty(a.prototype,"parsedUrl",{get:function(){return this.layer?{path:this.layer.parsedUrl.path+"/sublayers/"+this.id,query:this.layer.parsedUrl.query}:null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"fieldsIndex",{get:function(){return new B(this.fields)},enumerable:!1,configurable:!0});a.prototype.readAssociatedLayer=function(d,a){d=this.layer.associatedFeatureServiceItem;a=a.associatedLayerID;return e.isSome(d)&&"number"===typeof a?new k({portalItem:d,
layerId:a}):null};Object.defineProperty(a.prototype,"objectIdField",{get:function(){if(null!=this.fields)for(var d=0,a=this.fields;d<a.length;d++){var b=a[d];if("oid"===b.type)return b.name}return null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!1,configurable:!0});a.prototype.load=function(d){d=e.isSome(d)?d.signal:null;this.addResolvingPromise(this._fetchService(d));return h.resolve(this)};
a.prototype.createPopupTemplate=function(d){return C.createPopupTemplate(this,d)};a.prototype._fetchService=function(d){return b.__awaiter(this,void 0,void 0,function(){var a,c;return b.__generator(this,function(b){switch(b.label){case 0:return[4,r(this.parsedUrl.path,{query:{f:"json"},responseType:"json",signal:d})];case 1:return a=b.sent(),c=a.data,this.read(c,{origin:"service",url:this.parsedUrl}),[2]}})})};a.prototype.getField=function(a){return this.fieldsIndex.get(a)};a.prototype.getFieldDomain=
function(a){return(a=this.getField(a))&&a.domain?a.domain:null};Object.defineProperty(a.prototype,"geometryType",{get:function(){return"3d-object"===this.layerType?"mesh":"point"},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"profile",{get:function(){return"3d-object"===this.layerType?"mesh-pyramids":"points"},enumerable:!1,configurable:!0});a.prototype.createQuery=function(){var a=new E;"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||
"1\x3d1";a.sqlFormat="standard";return a};a.prototype.queryExtent=function(a,b){var d=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryExtent(a||d.createQuery(),b)})};a.prototype.queryFeatureCount=function(a,b){var d=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatureCount(a||d.createQuery(),b)})};a.prototype.queryFeatures=function(a,b){var d=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatures(a||d.createQuery(),
b)}).then(function(a){if(a&&a.features)for(var b=0,c=a.features;b<c.length;b++){var n=c[b];n.layer=d.layer;n.sourceLayer=d}return a})};a.prototype.queryObjectIds=function(a,b){var d=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryObjectIds(a||d.createQuery(),b)})};a.prototype.getFieldUsageInfo=function(a){return this.fieldsIndex.has(a)?{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}:{supportsLabelingInfo:!1,supportsRenderer:!0,
supportsPopupTemplate:!0,supportsLayerQuery:e.isSome(this.associatedLayer)}};a.prototype._getAssociatedLayerForQuery=function(){var a=this.associatedLayer;return e.isSome(a)&&a.loaded?h.resolve(a):this._loadAssociatedLayerForQuery()};a.prototype._loadAssociatedLayerForQuery=function(){return b.__awaiter(this,void 0,void 0,function(){var a;return b.__generator(this,function(b){switch(b.label){case 0:return[4,this.load()];case 1:b.sent();if(e.isNone(this.associatedLayer))throw new g("buildingscenelayer:query-not-available",
"BuildingSceneLayer component layer queries are not available without an associated feature layer",{layer:this});b.label=2;case 2:return b.trys.push([2,4,,5]),[4,this.associatedLayer.load()];case 3:return b.sent(),[3,5];case 4:throw a=b.sent(),new g("buildingscenelayer:query-not-available","BuildingSceneLayer associated feature layer could not be loaded",{layer:this,error:a});case 5:return[2,this.associatedLayer]}})})};b.__decorate([c.property({readOnly:!0,dependsOn:["layer","id"]})],a.prototype,
"parsedUrl",null);b.__decorate([c.property({type:f.I3SNodePageDefinition,readOnly:!0})],a.prototype,"nodePages",void 0);b.__decorate([c.property({type:[f.I3SMaterialDefinition],readOnly:!0})],a.prototype,"materialDefinitions",void 0);b.__decorate([c.property({type:[f.I3STextureSetDefinition],readOnly:!0})],a.prototype,"textureSetDefinitions",void 0);b.__decorate([c.property({type:[f.I3SGeometryDefinition],readOnly:!0})],a.prototype,"geometryDefinitions",void 0);b.__decorate([c.property({readOnly:!0})],
a.prototype,"serviceUpdateTimeStamp",void 0);b.__decorate([c.property({readOnly:!0})],a.prototype,"store",void 0);b.__decorate([c.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],a.prototype,"rootNode",void 0);b.__decorate([c.property({readOnly:!0})],a.prototype,"attributeStorageInfo",void 0);b.__decorate([c.property(l.fields)],a.prototype,"fields",void 0);b.__decorate([c.property({readOnly:!0,dependsOn:["fields"]})],a.prototype,"fieldsIndex",null);b.__decorate([c.property({readOnly:!0,
type:k})],a.prototype,"associatedLayer",void 0);b.__decorate([c.reader("service","associatedLayer",["associatedLayerID"])],a.prototype,"readAssociatedLayer",null);b.__decorate([c.property(l.outFields)],a.prototype,"outFields",void 0);b.__decorate([c.property({type:String,dependsOn:["fields"],readOnly:!0})],a.prototype,"objectIdField",null);b.__decorate([c.property({readOnly:!0,type:w,aliasOf:"layer.fullExtent"})],a.prototype,"fullExtent",void 0);b.__decorate([c.property({readOnly:!0,type:x,aliasOf:"layer.spatialReference"})],
a.prototype,"spatialReference",void 0);b.__decorate([c.property({readOnly:!0,aliasOf:"layer.version"})],a.prototype,"version",void 0);b.__decorate([c.property({readOnly:!0,type:D,aliasOf:"layer.elevationInfo"})],a.prototype,"elevationInfo",void 0);b.__decorate([c.property({readOnly:!0,type:Number,aliasOf:"layer.minScale"})],a.prototype,"minScale",void 0);b.__decorate([c.property({readOnly:!0,type:Number,aliasOf:"layer.maxScale"})],a.prototype,"maxScale",void 0);b.__decorate([c.property({type:["hide",
"show"],json:{write:!0}})],a.prototype,"listMode",void 0);b.__decorate([c.property({types:q.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],a.prototype,"renderer",void 0);b.__decorate([c.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],a.prototype,"definitionExpression",
void 0);b.__decorate([c.property(z.popupEnabled)],a.prototype,"popupEnabled",void 0);b.__decorate([c.property({type:p,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],a.prototype,"popupTemplate",void 0);b.__decorate([c.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],a.prototype,"normalReferenceFrame",void 0);b.__decorate([c.property({readOnly:!0,json:{read:!1},dependsOn:["fields","title"]})],a.prototype,"defaultPopupTemplate",
null);b.__decorate([c.property({json:{write:!1}}),c.enumeration(new t.default({"3DObject":"3d-object",Point:"point"}))],a.prototype,"layerType",void 0);b.__decorate([c.property({dependsOn:["layerType"]})],a.prototype,"geometryType",null);b.__decorate([c.property({dependsOn:["layerType"]})],a.prototype,"profile",null);return a=b.__decorate([c.subclass("esri.layers.buildingSublayers.BuildingComponentSublayer")],a)}(u.LoadableMixin(v.EsriPromiseMixin(y)))});