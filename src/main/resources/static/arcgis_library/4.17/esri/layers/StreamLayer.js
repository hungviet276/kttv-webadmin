// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../geometry ../PopupTemplate ../renderers ../request ../symbols ../core/Error ../core/global ../core/jsonMap ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/accessorSupport/extensions/serializableProperty/reader ./Layer ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/commonProperties ./support/featureReductionUtils ./support/Field ./support/FieldsIndex ./support/fieldUtils ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/PurgeOptions ../renderers/support/jsonUtils ../renderers/support/styleUtils ../support/popupUtils ../symbols/support/ElevationInfo ../tasks/support/Query".split(" "),
function(f,X,c,k,v,e,w,x,h,y,z,A,B,C,q,d,r,D,E,F,G,H,I,J,K,L,g,l,M,N,O,t,P,Q,u,m,R,S,T,U){var V=A.getLogger("esri.layers.StreamLayer"),W=new z.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"});f=function(f){function a(){for(var b=[],a=0;a<arguments.length;a++)b[a]=arguments[a];b=f.apply(this,b)||this;b.copyright=null;b.definitionExpression=null;b.displayField=null;b.elevationInfo=null;b.featureReduction=null;b.fields=
null;b.geometryDefinition=null;b.geometryType=null;b.labelsVisible=!0;b.labelingInfo=null;b.legendEnabled=!0;b.maxReconnectionAttempts=0;b.maxReconnectionInterval=20;b.objectIdField=null;b.operationalLayerType="ArcGISStreamLayer";b.popupEnabled=!0;b.popupTemplate=null;b.purgeOptions=new u;b.screenSizePerspectiveEnabled=!0;b.sourceJSON=null;b.spatialReference=k.SpatialReference.WGS84;b.type="stream";b.url=null;b.webSocketUrl=null;return b}c.__extends(a,f);a.prototype.normalizeCtorArgs=function(b,a){return"string"===
typeof b?c.__assign({url:b},a):b};a.prototype.load=function(b){var a=this;"WebSocket"in y||q.reject(new h("stream-layer:websocket-unsupported","WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."));var c=B.isSome(b)?b.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service"]},b).catch(function(b){return b}).then(function(){return a._fetchService(c)}));return q.resolve(this)};Object.defineProperty(a.prototype,
"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!1,configurable:!0});a.prototype.readFeatureReduction=function(b,a){return l.read(b,a)};a.prototype.writeWebSceneFeatureReduction=function(b,a,c,d){l.writeTarget(b,a,"layerDefinition.featureReduction",d)};Object.defineProperty(a.prototype,"fieldsIndex",{get:function(){return new N(this.fields)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"renderer",{set:function(b){O.fixRendererFields(b,this.fields);
this._set("renderer",b)},enumerable:!1,configurable:!0});a.prototype.readRenderer=function(b,a,c){a=a.layerDefinition||a;if(b=a.drawingInfo&&a.drawingInfo.renderer||void 0)return(b=m.read(b,a,c)||void 0)||V.error("Failed to create renderer",{rendererDefinition:a.drawingInfo.renderer,layer:this,context:c}),b;if(a.defaultSymbol)return a.types&&a.types.length?new e.UniqueValueRenderer({defaultSymbol:p(a.defaultSymbol,a,c),field:a.typeIdField,uniqueValueInfos:a.types.map(function(a){return{id:a.id,symbol:p(a.symbol,
a,c)}})}):new e.SimpleRenderer({symbol:p(a.defaultSymbol,a,c)})};a.prototype.writeRenderer=function(a,c,d,n){m.write(a,c,d,n)};a.prototype.writeWebSceneRenderer=function(a,c,d,n){m.write(a,c,"layerDefinition.drawingInfo.renderer",n)};a.prototype.createPopupTemplate=function(a){return S.createPopupTemplate(this,a)};a.prototype.createQuery=function(){var a=new U;a.returnGeometry=!0;a.outFields=["*"];a.where=this.definitionExpression||"1\x3d1";return a};a.prototype.getFieldDomain=function(a,c){if(!this.fields)return null;
var b=null;this.fields.some(function(c){c.name===a&&(b=c.domain);return!!b});return b};a.prototype.getField=function(a){return this.fieldsIndex.get(a)};a.prototype._fetchService=function(a){var b,d;return c.__awaiter(this,void 0,void 0,function(){var f,g;return c.__generator(this,function(e){switch(e.label){case 0:return(f=!!this.webSocketUrl)?[3,3]:this.sourceJSON?[3,2]:[4,w(this.parsedUrl.path,{query:c.__assign({f:"json"},this.parsedUrl.query),responseType:"json",signal:a})];case 1:this.sourceJSON=
g=e.sent().data,e.label=2;case 2:return[3,4];case 3:if(null===(b=this.timeInfo)||void 0===b||!b.trackIdField)throw new h("stream-layer:missing-metadata","The stream layer trackIdField must be specified.");if(!this.objectIdField)throw new h("stream-layer:missing-metadata","The stream layer objectIdField must be specified.");if(!this.fields)throw new h("stream-layer:missing-metadata","The stream layer fields must be specified.");if(!this.geometryType)throw new h("stream-layer:missing-metadata","The stream layer geometryType must be specified.");
this.url=this.webSocketUrl;e.label=4;case 4:return this.sourceJSON=c.__assign(c.__assign({},null!==(d=this.sourceJSON)&&void 0!==d?d:{}),{objectIdField:"__esri_stream_id__"}),this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl}),t.fixRendererFields(this.renderer,this.fields),t.fixTimeInfoFields(this.timeInfo,this.fields),[2,R.loadStyleRenderer(this,{origin:"service"})]}})})};c.__decorate([d.property({type:String})],a.prototype,"copyright",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["fields",
"title"]})],a.prototype,"defaultPopupTemplate",null);c.__decorate([d.property({type:String})],a.prototype,"definitionExpression",void 0);c.__decorate([d.property({type:String})],a.prototype,"displayField",void 0);c.__decorate([d.property({type:T})],a.prototype,"elevationInfo",void 0);c.__decorate([d.reader("featureReduction",["layerDefinition.featureReduction"])],a.prototype,"readFeatureReduction",null);c.__decorate([d.writer("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:l.webSceneFeatureReductionTypes}})],
a.prototype,"writeWebSceneFeatureReduction",null);c.__decorate([d.property({type:[M]})],a.prototype,"fields",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["fields"]})],a.prototype,"fieldsIndex",null);c.__decorate([d.property({type:k.Extent})],a.prototype,"geometryDefinition",void 0);c.__decorate([d.property({type:["point","polygon","polyline","multipoint"],json:{read:{reader:W.read}}})],a.prototype,"geometryType",void 0);c.__decorate([d.property(g.labelsVisible)],a.prototype,"labelsVisible",
void 0);c.__decorate([d.property({type:[P],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:Q.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],a.prototype,"labelingInfo",void 0);c.__decorate([d.property(g.legendEnabled)],a.prototype,"legendEnabled",void 0);c.__decorate([d.property({type:["show","hide"]})],a.prototype,"listMode",void 0);c.__decorate([d.property({type:r.Integer})],a.prototype,"maxReconnectionAttempts",void 0);c.__decorate([d.property({type:r.Integer})],
a.prototype,"maxReconnectionInterval",void 0);c.__decorate([d.property({type:String})],a.prototype,"objectIdField",void 0);c.__decorate([d.property({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],a.prototype,"operationalLayerType",void 0);c.__decorate([d.property(g.popupEnabled)],a.prototype,"popupEnabled",void 0);c.__decorate([d.property({type:v,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],a.prototype,"popupTemplate",void 0);c.__decorate([d.property({type:u})],a.prototype,
"purgeOptions",void 0);c.__decorate([d.property({types:e.rendererTypes,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],a.prototype,"renderer",null);c.__decorate([d.reader("service","renderer",["drawingInfo.renderer","defaultSymbol","type"]),d.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol","layerDefinition.type"])],a.prototype,"readRenderer",null);c.__decorate([d.writer("renderer")],
a.prototype,"writeRenderer",null);c.__decorate([d.writer("web-scene","renderer",{"layerDefinition.drawingInfo.renderer":{types:e.webSceneRendererTypes}})],a.prototype,"writeWebSceneRenderer",null);c.__decorate([d.property(g.screenSizePerspectiveEnabled)],a.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([d.property({type:k.SpatialReference,json:{origins:{service:{read:{source:"spatialReference"}}}}})],a.prototype,"spatialReference",void 0);c.__decorate([d.property({json:{read:!1}})],
a.prototype,"type",void 0);c.__decorate([d.property(g.url)],a.prototype,"url",void 0);c.__decorate([d.property({type:String})],a.prototype,"webSocketUrl",void 0);return a=c.__decorate([d.subclass("esri.layers.StreamLayer")],a)}(G.BlendLayer(L.TemporalLayer(K.ScaleRangeLayer(J.RefreshableLayer(F.ArcGISService(H.OperationalLayer(I.PortalLayer(C.MultiOriginJSONMixin(E)))))))));var p=D.createTypeReader({types:x.symbolTypesRenderer});return f});