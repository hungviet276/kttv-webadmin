// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/loadAll ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/utils ./Layer ./mixins/BlendLayer ./mixins/OperationalLayer ./mixins/PortalLayer ../support/LayersMixin ../support/TablesMixin ../webdoc/support/writeUtils @dojo/framework/shim/Promise".split(" "),function(x,y,c,h,k,l,m,e,n,p,q,r,t,u,v,w){return function(g){function b(a){a=g.call(this,a)||this;a._visibilityHandles={};a.fullExtent=
void 0;a.operationalLayerType="GroupLayer";a.spatialReference=void 0;a.type="group";a._visibilityWatcher=a._visibilityWatcher.bind(a);return a}c.__extends(b,g);b.prototype.initialize=function(){this._enforceVisibility(this.visibilityMode,this.visible);this.watch("visible",this._visibleWatcher.bind(this),!0)};b.prototype._writeLayers=function(a,b,c,d){var f=[];if(!a)return f;a.forEach(function(a){a=w.getLayerJSON(a,d.webmap?d.webmap.getLayerJSONFromResourceInfo(a):null,d);k.isSome(a)&&a.layerType&&
f.push(a)});b.layers=f};Object.defineProperty(b.prototype,"portalItem",{set:function(a){this._set("portalItem",a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"visibilityMode",{set:function(a){var b=this._get("visibilityMode")!==a;this._set("visibilityMode",a);b&&this._enforceVisibility(a,this.visible)},enumerable:!1,configurable:!0});b.prototype.load=function(a){this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},
a));return m.resolve(this)};b.prototype.loadAll=function(){var a=this;return h.loadAll(this,function(b){b(a.layers)})};b.prototype.layerAdded=function(a){a.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(a):"inherited"===this.visibilityMode&&(a.visible=this.visible);this._visibilityHandles[a.uid]=a.watch("visible",this._visibilityWatcher,!0)};b.prototype.layerRemoved=function(a){var b=this._visibilityHandles[a.uid];b&&(b.remove(),delete this._visibilityHandles[a.uid]);this._enforceVisibility(this.visibilityMode,
this.visible)};b.prototype._turnOffOtherLayers=function(a){this.layers.forEach(function(b){b!==a&&(b.visible=!1)})};b.prototype._enforceVisibility=function(a,b){if(n.getProperties(this).initialized){var c=this.layers,d=c.find(function(a){return a.visible});switch(a){case "exclusive":c.length&&!d&&(d=c.getItemAt(0),d.visible=!0);this._turnOffOtherLayers(d);break;case "inherited":c.forEach(function(a){a.visible=b})}}};b.prototype._visibleWatcher=function(a){"inherited"===this.visibilityMode&&this.layers.forEach(function(b){b.visible=
a})};b.prototype._visibilityWatcher=function(a,b,c,d){switch(this.visibilityMode){case "exclusive":a?this._turnOffOtherLayers(d):this._isAnyLayerVisible()||(d.visible=!0);break;case "inherited":d.visible=this.visible}};b.prototype._isAnyLayerVisible=function(){return this.layers.some(function(a){return a.visible})};c.__decorate([e.property()],b.prototype,"fullExtent",void 0);c.__decorate([e.property({json:{read:!1,write:{ignoreOrigin:!0}}})],b.prototype,"layers",void 0);c.__decorate([e.writer("layers")],
b.prototype,"_writeLayers",null);c.__decorate([e.property({type:["GroupLayer"]})],b.prototype,"operationalLayerType",void 0);c.__decorate([e.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],b.prototype,"portalItem",null);c.__decorate([e.property()],b.prototype,"spatialReference",void 0);c.__decorate([e.property({json:{read:!1},readOnly:!0,value:"group"})],b.prototype,"type",void 0);c.__decorate([e.property({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,
origins:{"web-map":{read:!1,write:!1}}}})],b.prototype,"visibilityMode",null);return b=c.__decorate([e.subclass("esri.layers.GroupLayer")],b)}(q.BlendLayer(r.OperationalLayer(t.PortalLayer(v.TablesMixin(u.LayersMixin(l.MultiOriginJSONMixin(p)))))))});