// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/rasterFormats/LercCodec":function(){define(["../../../core/mathUtils"],function(J){var B={};B.defaultNoDataValue=J.clampFloat32(-Infinity);B.decode=function(d,h){var y;h=h||{};var c=h.inputOffset||0,k=h.encodedMaskData||null===h.encodedMaskData,a={},b=new Uint8Array(d,c,10);a.fileIdentifierString=String.fromCharCode.apply(null,b);if("CntZImage"!=a.fileIdentifierString.trim())throw"Unexpected file identifier string: "+a.fileIdentifierString;c+=10;b=new DataView(d,
c,24);a.fileVersion=b.getInt32(0,!0);a.imageType=b.getInt32(4,!0);a.height=b.getUint32(8,!0);a.width=b.getUint32(12,!0);a.maxZError=b.getFloat64(16,!0);c+=24;if(!k)if(b=new DataView(d,c,16),a.mask={},a.mask.numBlocksY=b.getUint32(0,!0),a.mask.numBlocksX=b.getUint32(4,!0),a.mask.numBytes=b.getUint32(8,!0),a.mask.maxValue=b.getFloat32(12,!0),c+=16,0<a.mask.numBytes){var k=new Uint8Array(Math.ceil(a.width*a.height/8)),b=new DataView(d,c,a.mask.numBytes),p=b.getInt16(0,!0),l=2,z=0;do{if(0<p)for(;p--;)k[z++]=
b.getUint8(l++);else for(var A=b.getUint8(l++),p=-p;p--;)k[z++]=A;p=b.getInt16(l,!0);l+=2}while(l<a.mask.numBytes);if(-32768!==p||z<k.length)throw"Unexpected end of mask RLE encoding";a.mask.bitset=k;c+=a.mask.numBytes}else 0===(a.mask.numBytes|a.mask.numBlocksY|a.mask.maxValue)&&(k=new Uint8Array(Math.ceil(a.width*a.height/8)),a.mask.bitset=k);b=new DataView(d,c,16);a.pixels={};a.pixels.numBlocksY=b.getUint32(0,!0);a.pixels.numBlocksX=b.getUint32(4,!0);a.pixels.numBytes=b.getUint32(8,!0);a.pixels.maxValue=
b.getFloat32(12,!0);c+=16;k=a.pixels.numBlocksX;b=a.pixels.numBlocksY;k+=0<a.width%k?1:0;p=b+(0<a.height%b?1:0);a.pixels.blocks=Array(k*p);l=1E9;for(A=z=0;A<p;A++)for(var F=0;F<k;F++){var e=0,b=new DataView(d,c,Math.min(10,d.byteLength-c)),f={};a.pixels.blocks[z++]=f;var g=b.getUint8(0);e++;f.encoding=g&63;if(3<f.encoding)throw"Invalid block encoding ("+f.encoding+")";if(2===f.encoding)c++,l=Math.min(l,0);else{if(0!==g&&2!==g){g>>=6;f.offsetType=g;if(2===g)f.offset=b.getInt8(1),e++;else if(1===g)f.offset=
b.getInt16(1,!0),e+=2;else if(0===g)f.offset=b.getFloat32(1,!0),e+=4;else throw"Invalid block offset type";l=Math.min(f.offset,l);if(1===f.encoding)if(g=b.getUint8(e),e++,f.bitsPerPixel=g&63,g>>=6,f.numValidPixelsType=g,2===g)f.numValidPixels=b.getUint8(e),e++;else if(1===g)f.numValidPixels=b.getUint16(e,!0),e+=2;else if(0===g)f.numValidPixels=b.getUint32(e,!0),e+=4;else throw"Invalid valid pixel count type";}c+=e;if(3!=f.encoding)if(0===f.encoding){b=(a.pixels.numBytes-1)/4;if(b!==Math.floor(b))throw"uncompressed block has invalid length";
e=new ArrayBuffer(4*b);g=new Uint8Array(e);g.set(new Uint8Array(d,c,4*b));e=new Float32Array(e);for(g=0;g<e.length;g++)l=Math.min(l,e[g]);f.rawData=e;c+=4*b}else 1===f.encoding&&(b=Math.ceil(f.numValidPixels*f.bitsPerPixel/8),e=new ArrayBuffer(4*Math.ceil(b/4)),g=new Uint8Array(e),g.set(new Uint8Array(d,c,b)),f.stuffedData=new Uint32Array(e),c+=b)}}a.pixels.minValue=l;a.eofOffset=c;d=null!=h.noDataValue?J.clampFloat32(h.noDataValue):B.defaultNoDataValue;var k=h.encodedMaskData,f=h.returnMask,b=0,
p=a.pixels.numBlocksX,l=a.pixels.numBlocksY,z=Math.floor(a.width/p),A=Math.floor(a.height/l),F=2*a.maxZError,k=k||(a.mask?a.mask.bitset:null),t,c=new (h.pixelType||Float32Array)(a.width*a.height);f&&k&&(t=new Uint8Array(a.width*a.height));for(var f=new Float32Array(z*A),u,v,e=0;e<=l;e++)if(g=e!==l?A:a.height%l,0!==g)for(var G=0;G<=p;G++){var C=G!==p?z:a.width%p;if(0!==C){var m=e*a.width*A+G*z,H=a.width-C,r=a.pixels.blocks[b],n,q;if(2>r.encoding){if(0===r.encoding)n=r.rawData;else{n=r.stuffedData;
q=r.bitsPerPixel;u=r.numValidPixels;v=r.offset;var M=F,P=f,N=a.pixels.maxValue,K=(1<<q)-1,O=0,I=void 0,w=0,D=void 0,E=void 0,Q=Math.ceil((N-v)/M);n[n.length-1]<<=8*(4*n.length-Math.ceil(q*u/8));for(I=0;I<u;I++)0===w&&(E=n[O++],w=32),w>=q?(D=E>>>w-q&K,w-=q):(w=q-w,D=(E&K)<<w&K,E=n[O++],w=32-w,D+=E>>>w),P[I]=D<Q?v+D*M:N;n=f}q=0}else y=2===r.encoding?0:r.offset;var x;if(k)for(v=0;v<g;v++){m&7&&(x=k[m>>3],x<<=m&7);for(u=0;u<C;u++)m&7||(x=k[m>>3]),x&128?(t&&(t[m]=1),c[m++]=2>r.encoding?n[q++]:y):(t&&(t[m]=
0),c[m++]=d),x<<=1;m+=H}else if(2>r.encoding)for(v=0;v<g;v++){for(u=0;u<C;u++)c[m++]=n[q++];m+=H}else for(v=0;v<g;v++)if(c.fill)c.fill(y,m,m+C),m+=C+H;else{for(u=0;u<C;u++)c[m++]=y;m+=H}if(1===r.encoding&&q!==r.numValidPixels)throw"Block and Mask do not match";b++}}y=t;t={width:a.width,height:a.height,pixelData:c,minValue:a.pixels.minValue,maxValue:a.pixels.maxValue,noDataValue:d};y&&(t.maskData=y);h.returnEncodedMask&&a.mask&&(t.encodedMaskData=a.mask.bitset?a.mask.bitset:null);if(h.returnFileInfo&&
(t.fileInfo=L(a),h.computeUsedBitDepths)){h=t.fileInfo;y=a.pixels.numBlocksX*a.pixels.numBlocksY;x={};for(n=0;n<y;n++)q=a.pixels.blocks[n],0===q.encoding?x.float32=!0:1===q.encoding?x[q.bitsPerPixel]=!0:x[0]=!0;a=Object.keys(x);h.bitDepths=a}return t};var L=function(d){return{fileIdentifierString:d.fileIdentifierString,fileVersion:d.fileVersion,imageType:d.imageType,height:d.height,width:d.width,maxZError:d.maxZError,eofOffset:d.eofOffset,mask:d.mask?{numBlocksX:d.mask.numBlocksX,numBlocksY:d.mask.numBlocksY,
numBytes:d.mask.numBytes,maxValue:d.mask.maxValue}:null,pixels:{numBlocksX:d.pixels.numBlocksX,numBlocksY:d.pixels.numBlocksY,numBytes:d.pixels.numBytes,maxValue:d.pixels.maxValue,minValue:d.pixels.minValue,noDataValue:this.noDataValue}}};return B})},"*noref":1}});
define(["require","exports","../../core/promiseUtils","./rasterFormats/LercCodec","@dojo/framework/shim/Promise"],function(J,B,L,d){Object.defineProperty(B,"__esModule",{value:!0});var h=function(){function h(){}h.prototype._decode=function(c){c=d.decode(c.buffer,c.options);return L.resolve({result:c,transferList:[c.pixelData.buffer]})};return h}();B.default=function(){return new h}});