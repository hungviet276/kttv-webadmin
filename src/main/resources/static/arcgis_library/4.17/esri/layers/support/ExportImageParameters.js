// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Accessor ../../core/HandleOwner ../../core/accessorSupport/decorators ./commonProperties ./sublayerUtils ../../views/View".split(" "),function(f,e,c,g,h,d,k,l,m){Object.defineProperty(e,"__esModule",{value:!0});e.ExportImageParameters=void 0;var n={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",
source:"hasDynamicLayers"};f=function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;a._scale=null;a.view=null;return a}c.__extends(b,e);b.prototype.destroy=function(){this.layer=this.view=null};Object.defineProperty(b.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;var a=this.visibleSublayers.map(function(a){return a.toExportImageJSON()});return a.length?JSON.stringify(a):null},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"hasDynamicLayers",
{get:function(){return this.layer&&l.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"layer",{set:function(a){var b=this;this._get("layer")!==a&&(this._set("layer",a),this.handles.remove("layer"),a&&this.handles.add([a.allSublayers.on("change",function(){return b.notifyChange("visibleSublayers")}),a.on("sublayer-update",function(a){return b.notifyChange(n[a.propertyName])})],"layer"))},enumerable:!1,configurable:!0});
Object.defineProperty(b.prototype,"layers",{get:function(){var a=this.visibleSublayers;return a?a.length?"show:"+a.map(function(a){return a.id}).join(","):"show:-1":null},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"layerDefs",{get:function(){var a=this.visibleSublayers.filter(function(a){return null!=a.definitionExpression});return a.length?JSON.stringify(a.reduce(function(a,b){a[b.id]=b.definitionExpression;return a},{})):null},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"scale",{get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(a){this.view||(this._scale=a,this.notifyChange("scale"))},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"version",{get:function(){this.layers;this.layerDefs;this.dynamicLayers;this.timeExtent;var a=this.layer;a&&(a.dpi,a.imageFormat,a.imageTransparency,a.gdbVersion);return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"visibleSublayers",{get:function(){var a=this,b=[];if(!this.layer)return b;var c=this.layer.sublayers,d=function(c){var e=a.scale,f=0===c.minScale||e<=c.minScale,g=0===c.maxScale||e>=c.maxScale;c.visible&&(0===e||f&&g)&&(c.sublayers?c.sublayers.forEach(d):b.unshift(c))};c&&c.forEach(d);c=this._get("visibleSublayers");return!c||c.length!==b.length||c.some(function(a,c){return b[c]!==a})?b:c},enumerable:!1,configurable:!0});b.prototype.toJSON=function(){var a=this.layer,a={dpi:a.dpi,format:a.imageFormat,
transparent:a.imageTransparency,gdbVersion:a.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?a.dynamicLayers=this.dynamicLayers:a=c.__assign(c.__assign({},a),{layers:this.layers,layerDefs:this.layerDefs});return a};c.__decorate([d.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],b.prototype,"dynamicLayers",null);c.__decorate([d.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],b.prototype,"hasDynamicLayers",
null);c.__decorate([d.property()],b.prototype,"layer",null);c.__decorate([d.property({readOnly:!0,dependsOn:["visibleSublayers"]})],b.prototype,"layers",null);c.__decorate([d.property({readOnly:!0,dependsOn:["visibleSublayers"]})],b.prototype,"layerDefs",null);c.__decorate([d.property({type:Number,dependsOn:["view.scale"]})],b.prototype,"scale",null);c.__decorate([d.property(k.combinedViewLayerTimeExtentProperty)],b.prototype,"timeExtent",void 0);c.__decorate([d.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion timeExtent".split(" ")})],
b.prototype,"version",null);c.__decorate([d.property({type:m})],b.prototype,"view",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],b.prototype,"visibleSublayers",null);return b=c.__decorate([d.subclass("esri.layers.mixins.ExportImageParameters")],b)}(h.HandleOwnerMixin(g));e.ExportImageParameters=f});