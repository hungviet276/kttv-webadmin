// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/MapUtils"],function(g,h,f){return function(){function d(a,b){void 0===a&&(a=15E3);void 0===b&&(b=5E3);this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=a;this._interval=Math.min(a,b)}d.prototype.decreaseRefCount=function(a,b){a=a+"/"+b;b=this._cachedBlocks;if(b.has(a)){var c=b.get(a);c.refCount--;0>=c.refCount&&(b.delete(a),c.controller&&c.controller.abort());return c.refCount}return 0};d.prototype.getBlock=function(a,b){a=a+"/"+b;
b=this._cachedBlocks;if(b.has(a)){var c=b.get(a);c.ts=Date.now();c.refCount++;b.delete(a);b.set(a,c);return c.block}return null};d.prototype.putBlock=function(a,b,c,d){void 0===d&&(d=null);var e=this._cachedBlocks;a=a+"/"+b;e.has(a)?(c=e.get(a),c.ts=Date.now(),c.refCount++):e.set(a,{block:c,ts:Date.now(),refCount:1,controller:d});this.trim();this.updateTimer()};d.prototype.deleteBlock=function(a,b){var c=this._cachedBlocks;a=a+"/"+b;c.has(a)&&c.delete(a)};d.prototype.updateMaxSize=function(a){this._size=
a;this.trim()};d.prototype.empty=function(){this._cachedBlocks.clear();this.clearTimer()};d.prototype.getCurrentSize=function(){return this._cachedBlocks.size};d.prototype.updateTimer=function(){var a=this;if(null==this._timer){var b=this._cachedBlocks;this._timer=setInterval(function(){for(var c=f.pairsOfMap(b),d=Date.now(),e=0;e<c.length;e++)if(c[e][1].ts<=d-a._duration)b.delete(c[e][0]);else break;0===b.size&&a.clearTimer()},this._interval)}};d.prototype.trim=function(){var a=this._cachedBlocks;
if(!(-1===this._size||this._size>=a.size))for(var b=f.pairsOfMap(a),c=0;c<b.length-this._size;c++)a.delete(b[c][0])};d.prototype.clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)};return d}()});