// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../geometry ../../../core/has ../../../core/Loadable ../../../core/maybe ../../../core/promiseUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../tasks/support/FeatureSet".split(" "),function(f,g,e,h,k,l,m,n,p,d,q){Object.defineProperty(g,"__esModule",{value:!0});f=function(f){function a(b){b=f.call(this,b)||this;b.type="csv";return b}e.__extends(a,f);a.prototype.load=function(b){b=m.isSome(b)?b.signal:null;this.addResolvingPromise(this._startWorker(b));
return n.resolve(this)};a.prototype.destroy=function(){var b;null===(b=this._connection)||void 0===b?void 0:b.close();this._connection=null};a.prototype.openPorts=function(){var b=this;return this.load().then(function(){return b._connection.openPorts()})};a.prototype.queryFeatures=function(b,c){var a=this;void 0===c&&(c={});return this.load(c).then(function(){return a._connection.invoke("queryFeatures",b?b.toJSON():null,c)}).then(function(b){return q.fromJSON(b)})};a.prototype.queryFeaturesJSON=function(b,
c){var a=this;void 0===c&&(c={});return this.load(c).then(function(){return a._connection.invoke("queryFeatures",b?b.toJSON():null,c)})};a.prototype.queryFeatureCount=function(b,a){var c=this;void 0===a&&(a={});return this.load(a).then(function(){return c._connection.invoke("queryFeatureCount",b?b.toJSON():null,a)})};a.prototype.queryObjectIds=function(b,a){var c=this;void 0===a&&(a={});return this.load(a).then(function(){return c._connection.invoke("queryObjectIds",b?b.toJSON():null,a)})};a.prototype.queryExtent=
function(a,c){var b=this;void 0===c&&(c={});return this.load(c).then(function(){return b._connection.invoke("queryExtent",a?a.toJSON():null,c)}).then(function(a){return{count:a.count,extent:h.Extent.fromJSON(a.extent)}})};a.prototype._startWorker=function(a){return e.__awaiter(this,void 0,void 0,function(){var b,d;return e.__generator(this,function(c){switch(c.label){case 0:return b=this,[4,p.open("CSVSourceWorker",{strategy:k("feature-layers-workers")?"dedicated":"local",signal:a})];case 1:return b._connection=
c.sent(),[4,this._connection.invoke("load",{url:this.url,parsing:{columnDelimiter:this.delimiter,fields:this.fields&&this.fields.map(function(a){return a.toJSON()}),latitudeField:this.latitudeField,longitudeField:this.longitudeField,spatialReference:this.spatialReference&&this.spatialReference.toJSON(),timeInfo:this.timeInfo&&this.timeInfo.toJSON()}},{signal:a})];case 2:return d=c.sent(),this.locationInfo=d.locationInfo,this.sourceJSON=d.layerDefinition,this.columnDelimiter=d.columnDelimiter,[2]}})})};
e.__decorate([d.property()],a.prototype,"type",void 0);e.__decorate([d.property()],a.prototype,"url",void 0);e.__decorate([d.property()],a.prototype,"delimiter",void 0);e.__decorate([d.property()],a.prototype,"fields",void 0);e.__decorate([d.property()],a.prototype,"latitudeField",void 0);e.__decorate([d.property()],a.prototype,"longitudeField",void 0);e.__decorate([d.property()],a.prototype,"spatialReference",void 0);e.__decorate([d.property()],a.prototype,"timeInfo",void 0);e.__decorate([d.property()],
a.prototype,"locationInfo",void 0);e.__decorate([d.property()],a.prototype,"sourceJSON",void 0);e.__decorate([d.property()],a.prototype,"columnDelimiter",void 0);return a=e.__decorate([d.subclass("esri.layers.graphics.sources.CSVSource")],a)}(l);g.default=f});