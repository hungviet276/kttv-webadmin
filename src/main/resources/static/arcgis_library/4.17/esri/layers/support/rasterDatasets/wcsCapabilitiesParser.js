// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/Error","../../../geometry/Extent","./xmlUtilities"],function(x,p,w,r,a){function n(a){return a.indexOf("?")===a.length-1?a.substring(0,a.length-1):a}function t(g){for(var b={},c=0;c<g.childNodes.length;c++){var d=g.childNodes[c];if(1===d.nodeType){var e=a.getNodeNameIgnoreNS(d).toLowerCase();switch(e){case "title":case "abstract":b[e]=a.getElementValue(d);break;case "identifier":b.id=a.getElementValue(d);break;case "wgs84boundingbox":e=a.getSpaceDelimitedNumericValues(d,
"LowerCorner");d=a.getSpaceDelimitedNumericValues(d,"UpperCorner");b.lonLatEnvelope=new r({xmin:e[0],ymin:e[1],xmax:d[0],ymax:d[1],spatialReference:{wkid:4326}});break;case "coveragesummary":b.coverageSummaries=b.coverageSummaries||[],b.coverageSummaries.push(t(d))}}}return b}function u(a,b){if(a.coverageSummaries)for(var c=0;c<a.coverageSummaries.length;c++)a.coverageSummaries[c]["abstract"]=a.coverageSummaries[c]["abstract"]||a["abstract"],a.coverageSummaries[c].lonLatEnvelope=a.coverageSummaries[c].lonLatEnvelope||
a.lonLatEnvelope,a.coverageSummaries[c].title=a.coverageSummaries[c].title||a.title,u(a.coverageSummaries[c],b);null!=a.id&&b.push(a)}function v(g){var b=a.getElement(g.querySelector("Operation[name\x3dGetCapabilities]"),"Get").getAttribute("xlink:href")||"",c=a.getElement(g.querySelector("Operation[name\x3dDescribeCoverage]"),"Get").getAttribute("xlink:href")||"";g=a.getElement(g.querySelector("Operation[name\x3dGetCoverage]"),"Get").getAttribute("xlink:href")||"";return{getCapabilities:n(b),describeCoverage:n(c),
getCoverage:n(g)}}Object.defineProperty(p,"__esModule",{value:!0});p.parseCapabilities=void 0;p.parseCapabilities=function(g,b){void 0===b&&(b=null);var c=null,c="string"===typeof g?(new DOMParser).parseFromString(g,"text/xml"):g;g=c.documentElement.getAttribute("version");b=(g||b||"1.0.0").slice(0,3);if("2.0"===b){var d=c,e=a.getElement(d,"ServiceIdentification"),c=a.getElementValue(e,"Title"),m=a.getElementValues(e,"ServiceTypeVersion"),e=a.getElementValues(e,"Profile"),h=a.getElement(d,"OperationsMetadata"),
h=v(h),f=a.getElements(d,"Contents/CoverageSummary");b=[];for(var k=0;k<f.length;k++){var l=f[k],p=a.getElementValue(l,"CoverageId"),l=a.getElement(l,"WGS84BoundingBox"),q=void 0;l&&(q=a.getSpaceDelimitedNumericValues(l,"LowerCorner"),l=a.getSpaceDelimitedNumericValues(l,"UpperCorner"),q=new r({xmin:q[0],ymin:q[1],xmax:l[0],ymax:l[1],spatialReference:{wkid:4326}}));b.push({id:p,lonLatEnvelope:q})}f=a.getElement(d,"ServiceMetadata");d=a.getElementValues(f,"formatSupported");f=a.getElementValues(f,
"interpolationSupported");c={name:c,supportedVersions:m,supportedFormats:d,supportedInterpolations:f,onlineResources:h,profiles:e,coverages:b}}else if("1.1"===b){b=c;c=a.getElementValue(b,"ServiceIdentification/Title");m=a.getElementValues(b,"ServiceIdentification/ServiceTypeVersion");e=a.getElement(b,"OperationsMetadata");e=v(e);h=[];b=a.getElement(b,"Contents");for(d=0;d<b.childNodes.length;d++)f=b.childNodes[d],1===f.nodeType&&a.isSameTagIgnoreNS(f,"CoverageSummary")&&u(t(f),h);b=a.getElementValues(b,
"SupportedFormat");c={name:c,onlineResources:e,coverages:h,supportedVersions:m,supportedFormats:b}}else if("1.0"===b){b=c;c=a.getElementValue(b,"Service/name");f=a.getElement(b,"Capability");d=null!==(h=a.getElement(f,"GetCapabilities/Get/OnlineResource").getAttribute("xlink:href"))&&void 0!==h?h:"";h=null!==(e=a.getElement(f,"DescribeCoverage/Get/OnlineResource").getAttribute("xlink:href"))&&void 0!==e?e:"";e=null!==(m=a.getElement(f,"GetCoverage/Get/OnlineResource").getAttribute("xlink:href"))&&
void 0!==m?m:"";m={getCapabilities:n(d),describeCoverage:n(h),getCoverage:n(e)};e=a.getElements(b,"CoverageOfferingBrief");h=[];for(b=0;b<e.length;b++)f=e[b],d=a.getElementValue(f,"name"),k=a.getElements(f,"pos"),f=a.getSpaceDelimitedNumericValues(k[0]),k=a.getSpaceDelimitedNumericValues(k[1]),f=new r({xmin:f[0],ymin:f[1],xmax:k[0],ymax:k[1],spatialReference:{wkid:4326}}),h.push({id:d,lonLatEnvelope:f});c={name:c,onlineResources:m,coverages:h,supportedVersions:["1.0.0"]}}else throw new w("wcsraster:parsecapabilities",
"the capabilities version is not supported");c.capabilitiesVersion=g;return c}});