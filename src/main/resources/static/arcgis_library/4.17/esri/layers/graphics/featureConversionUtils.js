// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/Logger ../../geometry/support/jsonUtils ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),function(ua,d,A,oa,F,B,pa,y){function t(a,b){return a?b?4:3:b?3:2}function G(a,b,c,e){if(a){if(c)return b&&e?ga:H;if(b&&e)return qa}else if(b&&e)return H;return ha}function I(a,b){return Math.round((b-a.translate[0])/a.scale[0])}function J(a,b){return Math.round((a.translate[1]-b)/a.scale[1])}function L(a,b){return b*a.scale[0]+a.translate[0]}
function M(a,b){return a.translate[1]-b*a.scale[1]}function K(a){a=a.coords;return{x:a[0],y:a[1]}}function ia(a,b){a.coords[0]=b.x;a.coords[1]=b.y;return a}function N(a){a=a.coords;return{x:a[0],y:a[1],z:a[2]}}function ra(a,b){a.coords[0]=b.x;a.coords[1]=b.y;a.coords[2]=b.z;return a}function O(a){a=a.coords;return{x:a[0],y:a[1],m:a[2]}}function sa(a,b){a.coords[0]=b.x;a.coords[1]=b.y;a.coords[2]=b.m;return a}function P(a){a=a.coords;return{x:a[0],y:a[1],z:a[2],m:a[3]}}function ta(a,b){a.coords[0]=
b.x;a.coords[1]=b.y;a.coords[2]=b.z;a.coords[3]=b.m;return a}function Q(a,b){return a&&b?ta:a?ra:b?sa:ia}function R(a,b,c,e,g){c=Q(c,e);for(e=0;e<b.length;e++){var f=b[e],k=f.geometry,f=f.attributes,h=void 0;k&&(h=c(new y.default,k));a.push(new B.default(h,f,null,f[g]))}return a}function ja(a,b,c,e){for(var g=0;g<b.length;g++){var f=b[g],k=f.geometry,f=f.attributes,h=void 0;k&&(h=S(k,c,e));a.push({attributes:f,geometry:h})}return a}function S(a,b,c){if(!a)return null;for(var e=t(b,c),g=[],f=0;f<a.coords.length;f+=
e){for(var k=[],h=0;h<e;h++)k.push(a.coords[f+h]);g.push(k)}return b?c?{points:g,hasZ:b,hasM:c}:{points:g,hasZ:b}:c?{points:g,hasM:c}:{points:g}}function T(a,b,c,e,g){c=t(c,e);for(e=0;e<b.length;e++){var f=b[e],k=f.geometry,f=f.attributes,h=void 0;k&&(h=U(new y.default,k,c));a.push(new B.default(h,f,null,f[g]))}return a}function U(a,b,c){void 0===c&&(c=t(b.hasZ,b.hasM));a.lengths[0]=b.points.length;var e=a.coords,g=0,f=0;for(b=b.points;f<b.length;f++)for(var k=b[f],h=0;h<c;h++)e[g++]=k[h];return a}
function V(a,b,c){if(!a)return null;var e=t(b,c),g=a.coords,f=[],k=0,h=0;for(a=a.lengths;h<a.length;h++){for(var m=a[h],d=[],p=0;p<m;p++){for(var n=[],q=0;q<e;q++)n.push(g[k++]);d.push(n)}f.push(d)}return b?c?{paths:f,hasZ:b,hasM:c}:{paths:f,hasZ:b}:c?{paths:f,hasM:c}:{paths:f}}function W(a,b,c,e,g){c=t(c,e);for(e=0;e<b.length;e++){var f=b[e],k=f.geometry,f=f.attributes,h=void 0;k&&(h=X(new y.default,k,c));a.push(new B.default(h,f,null,f[g]))}return a}function X(a,b,c){void 0===c&&(c=t(b.hasZ,b.hasM));
var e=a.lengths,g=a.coords,f=0,k=0;for(b=b.paths;k<b.length;k++){for(var h=b[k],m=0,d=h;m<d.length;m++)for(var p=d[m],n=0;n<c;n++)g[f++]=p[n];e.push(h.length)}return a}function Y(a,b,c){if(!a)return null;var e=t(b,c),g=a.coords,f=[],k=0,h=0;for(a=a.lengths;h<a.length;h++){for(var m=a[h],d=[],p=0;p<m;p++){for(var n=[],q=0;q<e;q++)n.push(g[k++]);d.push(n)}f.push(d)}return b?c?{rings:f,hasZ:b,hasM:c}:{rings:f,hasZ:b}:c?{rings:f,hasM:c}:{rings:f}}function ka(a,b,c,e,g){for(var f=0;f<b.length;f++){var k=
b[f],h=k.geometry,m=k.centroid,k=k.attributes,d=void 0;h&&(d=Z(new y.default,h,c,e));m?a.push(new B.default(d,k,ia(new y.default,m),k[g])):a.push(new B.default(d,k,null,k[g]))}return a}function Z(a,b,c,e){void 0===c&&(c=b.hasZ);void 0===e&&(e=b.hasM);la(a,b.rings,c,e);return a}function la(a,b,c,e){c=t(c,e);e=a.lengths;for(var g=a.coords,f=0,k=e.length=g.length=0;k<b.length;k++){for(var h=b[k],d=0,l=h;d<l.length;d++)for(var p=l[d],n=0;n<c;n++)g[f++]=p[n];e.push(h.length)}return a}function aa(a,b,c,
e,g,f){a.length=0;if(!c){for(c=0;c<b.length;c++)e=b[c],a.push(new B.default(null,e.attributes,null,e.attributes[f]));return a}switch(c){case "esriGeometryPoint":return R(a,b,e,g,f);case "esriGeometryMultipoint":return T(a,b,e,g,f);case "esriGeometryPolyline":return W(a,b,e,g,f);case "esriGeometryPolygon":return ka(a,b,e,g,f);default:C.error("convertToFeatureSet:unknown-geometry",new A("Unable to parse unknown geometry type '"+c+"'")),a.length=0}return a}function ma(a,b,c,e){a=a&&("coords"in a?a:a.geometry);
if(!a)return null;switch(b){case "esriGeometryPoint":return b=K,c&&e?b=P:c?b=N:e&&(b=O),b(a);case "esriGeometryMultipoint":return S(a,c,e);case "esriGeometryPolyline":return V(a,c,e);case "esriGeometryPolygon":return Y(a,c,e);default:C.error("convertToGeometry:unknown-geometry",new A("Unable to parse unknown geometry type '"+b+"'"))}}function ba(a,b,c,e,g){a.length=0;switch(c){case "esriGeometryPoint":c=K;e&&g?c=P:e?c=N:g&&(c=O);for(e=0;e<b.length;e++){var f=b[e];g=f.geometry;f=f.attributes;g=g?c(g):
null;a.push({attributes:f,geometry:g})}break;case "esriGeometryMultipoint":return ja(a,b,e,g);case "esriGeometryPolyline":for(c=0;c<b.length;c++){var k=b[c],f=k.geometry,k=k.attributes,h=void 0;f&&(h=V(f,e,g));a.push({attributes:k,geometry:h})}break;case "esriGeometryPolygon":for(c=0;c<b.length;c++){var h=b[c],k=h.geometry,f=h.attributes,d=h.centroid,h=void 0;k&&(h=Y(k,e,g));d?(k=K(d),a.push({attributes:f,centroid:k,geometry:h})):a.push({attributes:f,geometry:h})}break;default:C.error("convertToFeatureSet:unknown-geometry",
new A("Unable to parse unknown geometry type '"+c+"'"))}return a}function ca(a,b,c,e,g,f,k,h){void 0===k&&(k=c);void 0===h&&(h=e);a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!b||!b.coords.length)return null;g=da[g];var d=b.coords;b=b.lengths;var l=t(c,e),p=t(c&&k,e&&h);c=G(c,e,k,h);if(!b.length)return c(a.coords,d,0,0,I(f,d[0]),J(f,d[1])),a.lengths.length&&(a.lengths.length=0),a.coords.length=l,a;for(var n,q=0,r,u=0,v=0;v<b.length;v++){var z=b[v];if(!(z<g)){var w=
0;r=u;h=e=I(f,d[q]);n=k=J(f,d[q+1]);c(a.coords,d,r,q,h,n);w++;q+=l;r+=p;for(var x=1;x<z;x++,q+=l)if(h=I(f,d[q]),n=J(f,d[q+1]),h!==e||n!==k)c(a.coords,d,r,q,h-e,n-k),r+=p,w++,e=h,k=n;w>=g&&(a.lengths.push(w),u=r)}}a.coords.length=u;return a.coords.length?a:null}function ea(a,b,c,e,g,f,k){for(var h=e,d=0,l,p=f+c;p<k;p+=c){l=b[p];var n=b[p+1],q=b[k],r=b[k+1],u=b[f],v=b[f+1],t=q-u,w=r-v;if(0!==t||0!==w){var x=((l-u)*t+(n-v)*w)/(t*t+w*w);1<x?(u=q,v=r):0<x&&(u+=t*x,v+=w*x)}t=l-u;w=n-v;l=t*t+w*w;l>h&&(d=
p,h=l)}h>e&&(d-f>c&&ea(a,b,c,e,g,f,d),g(a,b,a.length,d,b[d],b[d+1]),k-d>c&&ea(a,b,c,e,g,d,k))}function fa(a,b,c,e,g){var f=b.coords,k=b.lengths,h=c?e?ga:H:e?H:ha;c=t(c,e);if(!f.length)return a!==b&&(a.lengths.length=0,a.coords.length=0),a;if(!k.length)return h(a.coords,f,0,0,L(g,f[0]),M(g,f[1])),a!==b&&(a.lengths.length=0,a.coords.length=c),a;var d=g.scale;e=d[0];for(var d=d[1],l=0,p=0;p<k.length;p++){var n=k[p];a.lengths[p]=n;var q=L(g,f[l]),r=M(g,f[l+1]);h(a.coords,f,l,l,q,r);for(var l=l+c,u=1;u<
n;u++,l+=c)q+=f[l]*e,r-=f[l+1]*d,h(a.coords,f,l,l,q,r)}a!==b&&(a.lengths.length=k.length,a.coords.length=f.length);return a}function na(a,b,c,e){for(var g=0,f=a[e*b],k=a[e*(b+1)],d=1;d<c;d++)var m=f+a[e*(b+d)],l=k+a[e*(b+d)+1],p=(m-f)*(l+k),f=m,k=l,g=g+p;return.5*g}Object.defineProperty(d,"__esModule",{value:!0});d.deltaDecodeGeometry=d.deltaEncodeGeometry=d.getQuantizedArea=d.getSignedQuantizedRingArea=d.removeCollinearVectices=d.removeZMValues=d.unquantizeOptimizedGeometry=d.getQuantizedBoundsOptimizedGeometry=
d.getBoundsOptimizedGeometry=d.generalizeOptimizedGeometry=d.quantizeOptimizedGeometry=d.quantizeOptimizedFeatureSet=d.unquantizeOptimizedFeatureSet=d.convertFromFeatureSet=d.convertToFeatureSet=d.convertToFeatures=d.convertToGeometry=d.convertFromGeometry=d.convertToFeature=d.convertFromGraphics=d.convertFromFeatures=d.convertFromFeature=d.convertFromNestedArray=d.convertFromPolygon=d.convertToPolygon=d.convertFromPolyline=d.convertFromPolylineFeatures=d.convertToPolyline=d.convertFromMultipoint=
d.convertFromMultipointFeatures=d.convertToMultipoint=d.convertToMultipointFeatures=d.convertFromPoint=d.convertFromPointFeatures=d.convertToPoint=d.unquantizeY=d.unquantizeX=d.quantizeY=d.quantizeX=void 0;var C=oa.getLogger("esri.tasks.support.optimizedFeatureSet"),da={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},ha=function(a,b,c,e,g,f){a[c]=g;a[c+1]=f},H=function(a,b,c,e,g,f){a[c]=g;a[c+1]=f;a[c+2]=b[e+2]},qa=function(a,b,c,e,g,f){a[c]=g;a[c+1]=f;a[c+
2]=b[e+3]},ga=function(a,b,c,e,g,f){a[c]=g;a[c+1]=f;a[c+2]=b[e+2];a[c+3]=b[e+3]};d.quantizeX=I;d.quantizeY=J;d.unquantizeX=L;d.unquantizeY=M;d.convertToPoint=function(a,b,c){return a?b?c?P(a):N(a):c?O(a):K(a):null};d.convertFromPointFeatures=R;d.convertFromPoint=function(a,b,c){void 0===c&&(c=Q(null!=b.z,null!=b.m));return c(a,b)};d.convertToMultipointFeatures=ja;d.convertToMultipoint=S;d.convertFromMultipointFeatures=T;d.convertFromMultipoint=U;d.convertToPolyline=V;d.convertFromPolylineFeatures=
W;d.convertFromPolyline=X;d.convertToPolygon=Y;d.convertFromPolygon=Z;d.convertFromNestedArray=la;var D=[],E=[];d.convertFromFeature=function(a,b,c,e,g){D[0]=a;a=aa(E,D,b,c,e,g)[0];D.length=E.length=0;return a};d.convertFromFeatures=aa;d.convertFromGraphics=function(a,b,c,e,g,f){var d=a.length;switch(c){case "esriGeometryPoint":R(a,b,e,g,f);break;case "esriGeometryMultipoint":T(a,b,e,g,f);break;case "esriGeometryPolyline":W(a,b,e,g,f);break;case "esriGeometryPolygon":ka(a,b,e,g,f);break;default:C.error("convertToFeatureSet:unknown-geometry",
new A("Unable to parse unknown geometry type '"+c+"'"))}for(e=0;e<b.length;e++)a[e+d].geometryType=c,a[e+d].insertAfter=b[e].insertAfter,a[e+d].groupId=b[e].groupId;return a};d.convertToFeature=function(a,b,c,e){E[0]=a;ba(D,E,b,c,e);a=D[0];D.length=E.length=0;return a};d.convertFromGeometry=function(a,b,c){if(!a)return null;var e=new y.default;"hasZ"in a&&null==b&&(b=a.hasZ);"hasM"in a&&null==c&&(c=a.hasM);if(F.isPoint(a))return Q(null!=b?b:null!=a.z,null!=c?c:null!=a.m)(e,a);if(F.isPolygon(a))return Z(e,
a,b,c);if(F.isPolyline(a))return X(e,a,t(b,c));if(F.isMultipoint(a))return U(e,a,t(b,c));C.error("convertFromGeometry:unknown-geometry",new A("Unable to parse unknown geometry type '"+a+"'"))};d.convertToGeometry=ma;d.convertToFeatures=ba;d.convertToFeatureSet=function(a){var b=a.objectIdFieldName,c=a.spatialReference,e=a.transform,g=a.fields,f=a.hasM,d=a.hasZ,h=a.geometryType,m=a.exceededTransferLimit,l=a.uniqueIdField,p=a.queryGeometry,n=a.queryGeometryType;a=ba([],a.features,h,d,f);p=ma(p,n,!1,
!1);b={features:a,fields:g,geometryType:h,objectIdFieldName:b,spatialReference:c,uniqueIdField:l,queryGeometry:p};e&&(b.transform=e);m&&(b.exceededTransferLimit=m);f&&(b.hasM=f);d&&(b.hasZ=d);return b};d.convertFromFeatureSet=function(a,b){var c=new pa.default,e=a.hasM,g=a.hasZ,f=a.features,d=a.objectIdFieldName,h=a.spatialReference,m=a.geometryType,l=a.exceededTransferLimit,p=a.transform;if(a=a.fields)c.fields=a;c.geometryType=m;c.objectIdFieldName=d||b;c.spatialReference=h;if(!c.objectIdFieldName)return C.error(new A("optimized-features:invalid-objectIdFieldName",
"objectIdFieldName is missing")),c;f&&aa(c.features,f,m,g,e,c.objectIdFieldName);l&&(c.exceededTransferLimit=l);e&&(c.hasM=e);g&&(c.hasZ=g);p&&(c.transform=p);return c};d.unquantizeOptimizedFeatureSet=function(a){var b=a.transform,c=a.hasM,e=a.hasZ;if(!b)return a;for(var g=0,f=a.features;g<f.length;g++){var d=f[g];d.geometry&&fa(d.geometry,d.geometry,c,e,b);d.centroid&&fa(d.centroid,d.centroid,c,e,b)}a.transform=null;return a};d.quantizeOptimizedFeatureSet=function(a,b){var c=b.geometryType,e=b.features,
d=b.hasM,f=b.hasZ;if(!a)return b;for(var k=0;k<e.length;k++){var h=e[k],m=h.weakClone();m.geometry=new y.default;ca(m.geometry,h.geometry,d,f,c,a);h.centroid&&(m.centroid=new y.default,ca(m.centroid,h.centroid,d,f,"esriGeometryPoint",a));e[k]=m}b.transform=a;return b};d.quantizeOptimizedGeometry=ca;d.generalizeOptimizedGeometry=function(a,b,c,e,d,f,k,h){void 0===k&&(k=c);void 0===h&&(h=e);a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!b||!b.coords.length)return null;
d=da[d];var g=b.coords;b=b.lengths;var l=t(c,e),p=t(c&&k,e&&h);c=G(c,e,k,h);if(!b.length)return c(a.coords,g,0,0,g[0],g[1]),a.lengths.length&&(a.lengths.length=0),a.coords.length=l,a;e=0;f*=f;for(k=0;k<b.length;k++){h=b[k];if(!(h<d)){var n=a.coords.length/p,q=e,r=e+(h-1)*l;c(a.coords,g,a.coords.length,q,g[q],g[q+1]);ea(a.coords,g,l,f,c,q,r);c(a.coords,g,a.coords.length,r,g[r],g[r+1]);q=a.coords.length/p-n;q>=d?a.lengths.push(q):a.coords.length=n*p}e+=h*l}return a.coords.length?a:null};d.getBoundsOptimizedGeometry=
function(a,b,c,e){if(!b||!b.coords||!b.coords.length)return null;c=t(c,e);var d=e=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY;if(b&&b.coords){b=b.coords;for(var h=0;h<b.length;h+=c){var m=b[h],l=b[h+1];e=Math.min(e,m);f=Math.max(f,m);d=Math.min(d,l);k=Math.max(k,l)}}a[0]=e;a[1]=d;a[2]=f;a[3]=k;return a};d.getQuantizedBoundsOptimizedGeometry=function(a,b,c,e){c=t(c,e);e=b.coords;var d=Number.POSITIVE_INFINITY,f=Number.POSITIVE_INFINITY,k=Number.NEGATIVE_INFINITY,
h=Number.NEGATIVE_INFINITY,m=0,l=0;for(b=b.lengths;l<b.length;l++)for(var p=b[l],n=e[m],q=e[m+1],d=Math.min(n,d),f=Math.min(q,f),k=Math.max(n,k),h=Math.max(q,h),m=m+c,r=1;r<p;r++,m+=c){var u=e[m],v=e[m+1],n=n+u,q=q+v;0>u&&(d=Math.min(d,n));0<u&&(k=Math.max(k,n));0>v?f=Math.min(f,q):0<v&&(h=Math.max(h,q))}a[0]=d;a[1]=f;a[2]=k;a[3]=h;return a};d.unquantizeOptimizedGeometry=fa;d.removeZMValues=function(a,b,c,e,d,f){var g,h=t(c,e);c=G(c,e,d,f);e=b.coords;a.coords.length=0;a.lengths.length=0;(g=a.lengths).push.apply(g,
b.lengths);for(b=0;b<e.length;b+=h)c(a.coords,e,a.coords.length,b,e[b],e[b+1]);return a};d.removeCollinearVectices=function(a,b,c,e,d){if(!b||!b.coords||!b.coords.length)return null;c=da[c];var f=b.coords;b=b.lengths;var g=G(e,d,e,d);e=t(e,d);for(var h=d=0,m=0,l=0,p=0;p<b.length;p++){var n=b[p],h=l;g(a.coords,f,h,d,f[d],f[d+1]);d+=e;var q=f[d],r=f[d+1],u=q,v=r,z=r/q,h=h+e;g(a.coords,f,h,d,u,v);d+=e;for(var w=2;w<n;w++){var q=f[d],r=f[d+1],x=r/q,y=z===x||!isFinite(z)&&!isFinite(x),z=y&&isFinite(x)?
0<=z&&0<=x||0>=z&&0>=x:0<=v&&0<=r||0>=v&&0>=r;y&&z?(u+=q,v+=r):(u=q,v=r,h+=e);g(a.coords,f,h,d,u,v);d+=e;z=x}h+=e;n=(h-l)/e;n>=c&&(a.lengths[m]=n,l=h,m++)}a.coords.length>l&&(a.coords.length=l);a.lengths.length>m&&(a.lengths.length=m);return a.coords.length&&a.lengths.length?a:null};d.getSignedQuantizedRingArea=na;d.getQuantizedArea=function(a,b){var c=a.coords;a=a.lengths;for(var e=0,d=0,f=0;f<a.length;f++)d+=na(c,e,a[f],b),e+=f;return Math.abs(d)};d.deltaEncodeGeometry=function(a,b){var c=a.clone(),
e=a.coords;a=a.lengths;for(var d=0,f=0;f<a.length;f++){for(var k=a[f],h=e[b*d],m=e[b*d+1],l=1;l<k;l++){var p=e[b*(d+l)],n=e[b*(d+l)+1],m=n-m;c.coords[b*(d+l)]=p-h;c.coords[b*(d+l)+1]=m;h=p;m=n}d+=k}return c};d.deltaDecodeGeometry=function(a,b){var c=a.clone(),d=a.coords;a=a.lengths;for(var g=0,f=0;f<a.length;f++){for(var k=a[f],h=d[b*g],m=d[b*g+1],l=1;l<k;l++)h+=d[b*(g+l)],m+=d[b*(g+l)+1],c.coords[b*(g+l)]=h,c.coords[b*(g+l)+1]=m;g+=k}return c}});