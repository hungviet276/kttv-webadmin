// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),function(r,d,a,g,k,l,c,m,n,p){Object.defineProperty(d,"__esModule",{value:!0});d.ArcGISMapService=void 0;d.ArcGISMapService=function(d){return function(d){function b(){var e=null!==d&&d.apply(this,arguments)||this;e.capabilities=void 0;e.copyright=null;e.fullExtent=null;e.legendEnabled=
!0;e.spatialReference=null;e.version=null;return e}a.__extends(b,d);b.prototype.readCapabilities=function(e,f){var a=f.capabilities&&f.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});if(!a)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};e=this.type;var b=-1!==a.indexOf("query"),c=-1!==a.indexOf("map"),d=!!f.exportTilesAllowed,a=-1!==a.indexOf("tilemap"),h="tile"!==e&&!!f.supportsDynamicLayers,
q="tile"!==e&&(!f.tileInfo||h),g="tile"!==e&&(!f.tileInfo||h);return{operations:{supportsQuery:b,supportsExportMap:c,supportsExportTiles:d,supportsTileMap:a},exportMap:c?{supportsSublayersChanges:"tile"!==e,supportsDynamicLayers:h,supportsSublayerVisibility:q,supportsSublayerDefinitionExpression:g}:null,exportTiles:d?{maxExportTilesCount:+f.maxExportTilesCount}:null}};b.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=b.hasOwnProperty("capabilities")||b.hasOwnProperty("tables")?10:b.hasOwnProperty("supportedImageFormatTypes")?
9.31:9.3);return a};b.prototype.fetchSublayerInfo=function(b,c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.fetchAllLayersAndTables(c)];case 1:return a.sent(),[2,this._allLayersAndTablesMap.get(b)]}})})};b.prototype.fetchAllLayersAndTables=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,e=this;return a.__generator(this,function(d){switch(d.label){case 0:return[4,this.load(b)];case 1:return d.sent(),
this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=g(l.urlToObject(this.url).path+"/layers",{responseType:"json",query:a.__assign({f:"json"},this.customParameters)}).then(function(a){e._allLayersAndTablesMap=new Map;for(var b=0,c=a.data.layers;b<c.length;b++){var d=c[b];e._allLayersAndTablesMap.set(d.id,d)}return{result:a.data}},function(a){return{error:a}})),[4,this._allLayersAndTablesPromise];case 2:c=d.sent();k.throwIfAborted(b);if("result"in c)return[2,c.result];throw c.error;}})})};
a.__decorate([c.property({readOnly:!0})],b.prototype,"capabilities",void 0);a.__decorate([c.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],b.prototype,"readCapabilities",null);a.__decorate([c.property({json:{read:{source:"copyrightText"}}})],b.prototype,"copyright",void 0);a.__decorate([c.property({type:m})],b.prototype,"fullExtent",void 0);a.__decorate([c.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],
b.prototype,"id",void 0);a.__decorate([c.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],b.prototype,"legendEnabled",void 0);a.__decorate([c.property(p.popupEnabled)],b.prototype,"popupEnabled",void 0);a.__decorate([c.property({type:n})],b.prototype,"spatialReference",void 0);a.__decorate([c.property()],b.prototype,"version",void 0);a.__decorate([c.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],
b.prototype,"readVersion",null);return b=a.__decorate([c.subclass("esri.layers.mixins.ArcGISMapService")],b)}(d)}});