// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Error ../../core/Logger ../../intl/date ../../intl/number ./FieldsIndex ./fieldUtils ./labelUtils ../../support/arcadeOnDemand @dojo/framework/shim/Promise".split(" "),function(v,f,n,w,x,g,y,z,p,q,A){function r(b,e){if(null==b)return"";var a=e.domain;if(a)if("codedValue"===a.type||"coded-value"===a.type)for(var c=0,a=a.codedValues;c<a.length;c++){var d=a[c];if(d.code===b)return d.name}else if("range"===a.type&&(c=+b,d="range"in a?a.range[1]:a.maxValue,("range"in
a?a.range[0]:a.minValue)<=c&&c<=d))return a.name;"date"===e.type||"esriFieldTypeDate"===e.type?b=g.formatDate(b,g.convertDateFormatToIntlOptions("short-date")):p.isNumericField(e)&&(b=y.formatNumber(+b));return b?b:""}Object.defineProperty(f,"__esModule",{value:!0});f.formatField=f.createLabelFunction=void 0;var B=x.getLogger("esri.layers.support.labelFormatUtils"),t={type:"simple",evaluate:function(){return null}},C={getAttribute:function(b,e){return b.field(e)}};f.createLabelFunction=function(b,
e,a){return n.__awaiter(this,void 0,void 0,function(){var c,d,f,m,h,l,g,u;return n.__generator(this,function(k){switch(k.label){case 0:if(!b||!b.symbol)return[2,t];c=b.where;d=q.getLabelExpression(b);return c?[4,new Promise(function(a,b){v(["../../core/sql/WhereClause"],a,b)})]:[3,2];case 1:return m=k.sent(),[3,3];case 2:m=null,k.label=3;case 3:return f=m,"arcade"!==d.type?[3,5]:[4,A.createLabelExpression(d.expression,a,e)];case 4:return l=k.sent(),h={type:"arcade",evaluate:function(a){try{var b=
l.evaluate({$feature:"attributes"in a?l.repurposeFeature(a):l.repurposeAdapter(a)});if(null!=b)return b.toString()}catch(E){B.error(w("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:a,expression:d}))}return null},needsHydrationToEvaluate:function(){return null==q.getSingleFieldArcadeExpression(d.expression)}},[3,6];case 5:h={type:"simple",evaluate:function(a){return d.expression.replace(/{[^}]*}/g,function(b){var c=b.slice(1,-1),c=p.getField(e,
c);if(!c)return b;b=null;"attributes"in a?a&&a.attributes&&(b=a.attributes[c.name]):b=a.field(c.name);return null==b?"":r(b,c)})}},k.label=6;case 6:if(c){try{g=f.WhereClause.create(c,new z(e))}catch(D){return[2,t]}u=h.evaluate;h.evaluate=function(a){return g.testFeature(a,"attributes"in a?void 0:C)?u(a):null}}return[2,h]}})})};f.formatField=r});