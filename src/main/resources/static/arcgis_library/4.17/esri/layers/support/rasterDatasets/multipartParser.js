// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports"],function(r,p){function q(e,a){for(var c,d=String.fromCharCode.apply(null,e.subarray(0,Math.min(300,e.length))).split("\n"),g=Math.min(d.length,7),b={},k=0,f=0;f<g;f++)if(4>d[f].length)k=k+d[f].length+1;else if("content"===d[f].slice(0,7).toLowerCase()){if(k=k+d[f].length+1,-1!==d[f].indexOf(":")){var m=d[f].substring(0,d[f].indexOf(":")).trim(),l=d[f].substring(d[f].indexOf(":")+1).trim();switch(m.toLowerCase()){case "content-type":b.contentType=l;break;case "content-description":b.contentDescription=
l;break;case "content-transfer-encoding":b.contentTransferEncoding=l;break;case "content-id":b.contentID=l;break;case "content-disposition":b.contentDisposition=l;break;case "content-location":b.contentLocation=l}}}else if(b.contentDisposition&&4<=d[f].length&&-1<(null===(c=b.contentType)||void 0===c?void 0:c.toLowerCase().indexOf("image"))){a=new ArrayBuffer(e.length-k);(new Uint8Array(a)).set(e.subarray(k,e.length));b.contentData=a;break}else if((""===a.start||b.contentID===a.start)&&b.contentType){if(-1<
b.contentType.indexOf("text")){b.contentData=String.fromCharCode.apply(null,e.subarray(k,e.length));break}b.contentData=e.subarray(k,e.length)}return b}Object.defineProperty(p,"__esModule",{value:!0});p.parse=void 0;p.parse=function(e){var a;var c;a=null===(c=e.getHeader("Content-Type"))||void 0===c?void 0:c.split(";");c=null===a||void 0===a?void 0:a[0];if("multipart/related"!==c&&"multipart/mixed"!==c)a=null;else{c={boundary:"",start:"",type:""};for(var d=1;d<a.length;d++){var g=a[d].split("\x3d");
c[g[0].trim()]=g[1].trim().slice(1,g[1].length-1)}a=c}if(!a)return{isMultipart:!1,data:null};var b=e.data;e=a;d="--"+e.boundary;c=[];for(a=0;a<d.length;a++)c.push(d.charCodeAt(a));d=[];g="\n--"+e.boundary+"--";for(a=0;a<g.length;a++)d.push(g.charCodeAt(a));var k=[10],f=[13,10],g=[],m=c.length,b=new Uint8Array(b),l=Math.min(1E4,b.length-m),n=0,h=0;for(a=0;a<l;a++){for(h=0;h<m&&b[a+h]===c[h];h++);h===m&&(n&&g.push(q(b.subarray(n,a),e)),a+=m-1,b[a+1]===k[0]?a+=1:b[a+1]===f[0]&&b[a+2]===f[1]&&(a+=2),
n=a+1)}c=d.length;for(a=b.length-c-10;a<b.length-c;a++){for(h=0;h<c&&b[a+h]===d[h];h++);if(h===c){g.push(q(b.subarray(n,a),e));break}}return{isMultipart:!0,data:g}}});