// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),function(M,b,n,A,B,C,D,E,F,q,G,l,r,t,H){function x(a,c,h,e,f){void 0===e&&(e=a.hasZ);void 0===f&&(f=a.hasM);var b=a.hasZ&&e,g=a.hasM&&
f;return h?(a=l.quantizeOptimizedGeometry(u,c,a.hasZ,a.hasM,"esriGeometryPoint",h,e,f),l.convertToPoint(a,b,g)):l.convertToPoint(c,b,g)}function v(a,c,h){return n.__awaiter(this,void 0,void 0,function(){var e,f,m,g,d,p;return n.__generator(this,function(k){switch(k.label){case 0:if(!a)return[2,null];e=a.where;a.where=e=e&&e.trim();if(!e||/^1 *= *1$/.test(e)||c&&c===e)a.where=null;return a.geometry?[4,I(a)]:[2,a];case 1:return f=k.sent(),a.distance=0,a.units=null,"esriSpatialRelEnvelopeIntersects"===
a.spatialRel&&(m=a.geometry.spatialReference,f=D.getGeometryExtent(f),f.spatialReference=m),a.geometry=f,[4,t.checkProjectionSupport(f.spatialReference,h)];case 2:return k.sent(),[4,F.normalizeCentralMeridian(E.fromJSON(f))];case 3:g=k.sent()[0];if(B.isNone(g))throw b.QUERY_ENGINE_EMPTY_RESULT;d=g.toJSON();return[4,t.project(d,d.spatialReference,h)];case 4:p=k.sent();if(!p)throw b.QUERY_ENGINE_EMPTY_RESULT;p.spatialReference=h;a.geometry=p;return[2,a]}})})}function I(a){return n.__awaiter(this,void 0,
void 0,function(){var c,b,e,f,m,g,d,p,k;return n.__generator(this,function(h){switch(h.label){case 0:c=a.geometry;b=a.distance;e=a.units;if(null==b||"vertexAttributes"in c)return[2,c];f=c.spatialReference;m=e?J.fromJSON(e):C.getUnitString(f);g=f&&(q.isGeographic(f)||q.isWebMercator(f));if(!g)return[3,1];p=c;return[3,3];case 1:return[4,t.checkProjectionSupport(f,q.WGS84).then(function(){return t.project(c,q.WGS84)})];case 2:p=h.sent(),h.label=3;case 3:return d=p,[4,H.getGeodesicBufferOperator()];case 4:return k=
h.sent(),[2,k(d.spatialReference,d,b,m)]}})})}Object.defineProperty(b,"__esModule",{value:!0});b.cleanFromGeometryEngine=b.normalizeQueryLike=b.normalizeFilter=b.normalizeQuery=b.getGeometry=b.getCentroid=b.transformCentroid=b.QUERY_ENGINE_EMPTY_RESULT=void 0;var J=new A.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});b.QUERY_ENGINE_EMPTY_RESULT=
Object.freeze({});var y=new r.default,K=new r.default,u=new r.default,w={esriGeometryPoint:l.convertToPoint,esriGeometryPolyline:l.convertToPolyline,esriGeometryPolygon:l.convertToPolygon,esriGeometryMultipoint:l.convertToMultipoint};b.transformCentroid=x;b.getCentroid=function(a,c,b){if("esriGeometryPolygon"!==a.geometryType||!c||!c.centroid&&!c.geometry)return null;c.centroid||(c.centroid=G.getCentroidOptimizedGeometry(new r.default,c.geometry,a.hasZ,a.hasM));return x(a,c.centroid,b)};b.getGeometry=
function(a,c,b,e,f,m,g,d){void 0===g&&(g=c);void 0===d&&(d=b);var h=c&&g,k=b&&d;e=e?"coords"in e?e:e.geometry:null;if(!e)return null;if(f)return c=l.generalizeOptimizedGeometry(K,e,c,b,a,f,g,d),m&&(c=l.quantizeOptimizedGeometry(u,c,h,k,a,m)),w[a](c,h,k);if(m)return c=l.quantizeOptimizedGeometry(u,e,c,b,a,m,g,d),w[a](c,h,k);l.removeZMValues(y,e,c,b,g,d);return w[a](y,h,k)};b.normalizeQuery=function(a,c,b){return n.__awaiter(this,void 0,void 0,function(){var e,f,h,g,d;return n.__generator(this,function(l){e=
a.outFields;f=a.orderByFields;h=a.groupByFieldsForStatistics;g=a.outStatistics;if(e)for(d=0;d<e.length;d++)e[d]=e[d].trim();if(f)for(d=0;d<f.length;d++)f[d]=f[d].trim();if(h)for(d=0;d<h.length;d++)h[d]=h[d].trim();if(g)for(d=0;d<g.length;d++)g[d].onStatisticField&&(g[d].onStatisticField=g[d].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return[2,v(a,c,b)]})})};b.normalizeFilter=function(a,c,b){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,
function(e){return[2,v(a,c,b)]})})};b.normalizeQueryLike=v;b.cleanFromGeometryEngine=function(a){return a&&z in a?JSON.parse(JSON.stringify(a,L)):a};var z="_geVersion",L=function(a,b){return a!==z?b:void 0}});