// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../languageUtils ./shared ./sqlUtils ../../../core/promiseUtils".split(" "),function(y,d,x,p,q,m){function n(c){for(var a=0,b=0;b<c.length;b++)a+=c[b];return a/c.length}function r(c){for(var a=n(c),b=0,e=0;e<c.length;e++)b+=Math.pow(a-c[e],2);return b/c.length}function t(c){for(var a=n(c),b=0,e=0;e<c.length;e++)b+=Math.pow(a-c[e],2);return b/(c.length-1)}function u(c){for(var a=0,b=0;b<c.length;b++)a+=c[b];return a}function h(c,a,b,e){void 0===e&&(e=!1);try{var k=c.iterator(b);
return m.create(function(b,c){v(k,[],a,e,b,c)})}catch(g){return m.reject(g)}}function v(c,a,b,e,k,g){x.tick(c.next().then(function(d){try{if(null!==d){var f=b.calculateValue(d);null===f?!1===e&&(a[a.length]=f):a[a.length]=f;return v(c,a,b,e,k,g)}k(a)}catch(l){g(l)}},g))}function w(c,a,b,e,k){return c.next().then(function(d){return null!==d?(d=e.calculateValue(d),void 0!==d&&null!==d&&void 0===a[d]&&(b.push(d),a[d]=1),b.length>=k&&-1!==k?b:w(c,a,b,e,k)):b})}Object.defineProperty(d,"__esModule",{value:!0});
d.distinct=d.count=d.sum=d.stdev=d.variance=d.mean=d.max=d.min=d.calculateStat=d.decodeStatType=void 0;d.decodeStatType=function(c){switch(c.toLowerCase()){case "distinct":return"distinct";case "avg":case "mean":return"avg";case "min":return"min";case "sum":return"sum";case "max":return"max";case "stdev":case "stddev":return"stddev";case "var":case "variance":return"var";case "count":return"count"}return""};d.calculateStat=function(c,a,b){void 0===b&&(b=1E3);switch(c.toLowerCase()){case "distinct":a:{c=
b;b=[];for(var e={},d=[],g=0;g<a.length;g++){if(void 0!==a[g]&&null!==a[g]){var f=a[g];if(p.isNumber(f)||p.isString(f))void 0===e[f]&&(b.push(f),e[f]=1);else{for(var h=!1,l=0;l<d.length;l++)!0===p.equalityTest(d[l],f)&&(h=!0);!1===h&&(d.push(f),b.push(f))}}if(b.length>=c&&-1!==c){a=b;break a}}a=b}return a;case "avg":case "mean":return n(a);case "min":return Math.min.apply(Math,a);case "sum":return u(a);case "max":return Math.max.apply(Math,a);case "stdev":case "stddev":return Math.sqrt(r(a));case "var":case "variance":return r(a);
case "count":return a.length}return 0};d.min=function(c,a,b){return h(c,a,b,!0).then(function(a){return 0===a.length?null:Math.min.apply(Math,a)})};d.max=function(c,a,b){return h(c,a,b,!0).then(function(a){return 0===a.length?null:Math.max.apply(Math,a)})};d.mean=function(c,a,b){var d="";!1===q.isSingleField(a)&&(d=q.predictType(a,c.fields,null));return h(c,a,b,!0).then(function(a){if(0===a.length)return null;a=n(a);if(null===a)return a;"integer"===d&&(a=+a,a=isFinite(a)?a-a%1||(0>a?-0:0===a?a:0):
a);return a})};d.variance=function(c,a,b){return h(c,a,b,!0).then(function(a){return 0===a.length?null:t(a)})};d.stdev=function(c,a,b){return h(c,a,b,!0).then(function(a){return 0===a.length?null:Math.sqrt(t(a))})};d.sum=function(c,a,b){return h(c,a,b,!0).then(function(a){return 0===a.length?null:u(a)})};d.count=function(c,a){try{return c.iterator(a).count()}catch(b){return m.reject(b)}};d.distinct=function(c,a,b,d){void 0===b&&(b=1E3);void 0===d&&(d=null);var e;try{var g=c.iterator(d);e=w(g,{},[],
a,b)}catch(f){e=m.reject(f)}return e}});