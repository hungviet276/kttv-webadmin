// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../Basemap ../../Ground ../../WebScene ../../core/compilerUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/extensions/serializableProperty/type ../../layers/GroupLayer ../../layers/KMLLayer ../../layers/mixins/operationalLayerModuleMap ../../layers/mixins/operationalLayers ../../layers/support/Sublayer ../../layers/support/source/DataLayerSource ../../layers/support/source/JoinTableDataSource ../../layers/support/source/MapLayerSource ./utils".split(" "),
function(ga,w,d,H,M,N,z,x,O,I,P,Q,R,C,S,T,U,V){function B(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var f;return d.__generator(this,function(e){switch(e.label){case 0:f=b.typeName;switch(f){case "array":return[3,1];case "union":return[3,3];case "json":return[3,5];case "native":return[3,7];case "enum":return[3,9]}return[3,11];case 1:return[4,W(a,b,c)];case 2:return e.sent(),[3,12];case 3:return[4,X(a,b,c)];case 4:return e.sent(),[3,12];case 5:return[4,J(a,b,c)];case 6:return e.sent(),
[3,12];case 7:return[4,Y(a,b,c)];case 8:return e.sent(),[3,12];case 9:return[4,Z(a,b,c)];case 10:return e.sent(),[3,12];case 11:z.neverReached(b),e.label=12;case 12:return[2]}})})}function Y(a,b,c){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(f){c.addProperty({name:a,type:p(b),default:b.default});return[2]})})}function aa(a){a=a.slice();a.sort();return a}function Z(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var f;return d.__generator(this,function(e){f=
b.values.slice();b.nullable&&f.push(null);c.currentClass&&c.currentClass.typeValue&&"type"===a?c.addProperty({name:a,type:"string",enum:'"'+c.currentClass.typeValue+'"'}):c.addProperty({name:a,type:p(b),enum:aa(f).map(function(a){return"string"===typeof a?'"'+a+'"':""+a}).join("|"),default:b.default});return[2]})})}function W(a,b,c){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(f){switch(f.label){case 0:return[4,B(a+"[]",b.elementType,c)];case 1:return f.sent(),
[2]}})})}function X(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var f,e,k,h,g,l;return d.__generator(this,function(d){switch(d.label){case 0:f=[],e=0,k=b.types,d.label=1;case 1:if(!(e<k.length))return[3,5];h=k[e];if("native"!==h.type.typeName&&b.key)return[3,2];f.push(h.type);return[3,4];case 2:var m=h.type;d=h.value;if("json"===m.typeName){var t=(m=(m=m.type.__accessorMetadata__)&&m.properties&&m.properties&&m.properties.type)&&u(m),r=(t=t&&t.type)||m&&m.type;r&&Array.isArray(r)&&1===
r.length&&"string"===typeof r[0]&&(d=t?r[0]:D(m,r[0]))}g=a+"\x3c"+d+"\x3e";return[4,B(g,h.type,c)];case 3:d.sent(),d.label=4;case 4:return e++,[3,1];case 5:return f.length&&(l=f.map(p),b.nullable&&l.push("null"),l.sort(),c.addProperty({type:l.join("|"),name:a,default:b.default})),[2]}})})}function K(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){return a.type===N&&"layers"===b?[2,v("web-scene/operational-layers")]:a.type!==H||"baseLayers"!==b&&"baseMapLayers"!==
b?a.type===H&&"elevationLayers"===b||a.type===M&&"layers"===b?[2,v("web-scene/ground")]:a.type===I&&"layers"===b?[2,v("web-scene/operational-layers",function(a){return a!==I})]:a.type!==T.JoinTableDataSource||"leftTableSource"!==b&&"rightTableSource"!==b?[2,null]:[2,q({key:"type",base:null,typeMap:{"data-layer":S.DataLayerSource,"map-layer":U.MapLayerSource}})]:[2,v("web-scene/basemap")]})})}function ba(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var f;return d.__generator(this,function(e){switch(e.label){case 0:return[4,
K(a,b)];case 1:if(f=e.sent())return[2,f];e=u(c);if(e.types)e=q(e.types);else if(!e.type&&c.types)e=q(c.types);else{e=E;var d=u(c),h=F(c),g=n(d&&d.type||c.type);d&&void 0!==d.default&&"function"!==typeof d.default&&(g.default=D(c,d.default));h.allowNull&&(g.nullable=!0);e=e(g)}return[2,e]}})})}function J(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var f,e,k,h,g,l,t,m,n,r,p,q,u,A,v,w,z,y,x;return d.__generator(this,function(d){switch(d.label){case 0:f=b.type.__accessorMetadata__;e=b.type.prototype.declaredClass.replace(/\./g,
"/");k=f&&f.properties;if(!k)return a&&c.addProperty({name:a,type:"unknown"}),[2,null];h=e;g=null;if(l=a&&a.match(/<([^>]+)>$/))h+="--"+l[1],g=l[1];b.type===C&&(h+="--"+c.currentClass.name,g=c.currentClass.name);if((t=c.seen.get(h))&&a)return c.addProperty({name:a,type:t}),[2,t];m={type:b.type,name:e,id:h,properties:[]};a&&(c.addProperty({name:a,type:m}),m.typeValue=g);c.push(a,m);n=[];for(r in k)n.push(r);p=0;d.label=1;case 1:if(!(p<n.length))return[3,7];q=n[p];u=k[q];A=F(u);if(!A||!A.enabled||b.type===
C&&(v=c.stack[c.stack.length-2],w="esri/layers/TileLayer"!==v.klass.name,(z=C.test.isSublayerStructureOverridePolicy(A.overridePolicy))&&!w))return[3,6];y=A.target;return"string"!==typeof y&&null!=y?[3,4]:[4,ba(b,q,u)];case 2:return(x=d.sent())?[4,B("string"===typeof y?y:q,x,c)]:[3,6];case 3:return d.sent(),[3,6];case 4:return[4,ca(b,y,c)];case 5:d.sent(),d.label=6;case 6:return p++,[3,1];case 7:return[2,c.pop()]}})})}function ca(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var f,e,k,h,
g,l;return d.__generator(this,function(d){switch(d.label){case 0:f=[];for(e in b)f.push(e);k=0;d.label=1;case 1:if(!(k<f.length))return[3,5];h=f[k];return[4,K(a,h)];case 2:return g=d.sent(),g||(l=b[h],g=l.types?q(l.types):n(l.type),g.default=l.default,g=E(g)),[4,B(h,g,c)];case 3:d.sent(),d.label=4;case 4:return k++,[3,1];case 5:return[2]}})})}function v(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,f,e,k,h,g,l;return d.__generator(this,function(d){switch(d.label){case 0:c={typeName:"union",
key:"layerType",types:[]};f=[];for(e in R.supportedTypes[a])f.push(e);k=0;d.label=1;case 1:if(!(k<f.length))return[3,4];h=f[k];return"web-scene/operational-layers"===a&&"ArcGISTiledElevationServiceLayer"===h?[3,3]:[4,Q.typeModuleMap[h]()];case 2:g=d.sent();if(!g||b&&!b(g)||g===P)return[3,3];c.types.push({type:{typeName:"json",type:g},value:h});d.label=3;case 3:return k++,[3,1];case 4:if(0===c.types.length)return[2,null];l={typeName:"array",elementType:1===c.types.length?c.types[0].type:c};return[2,
l]}})})}function p(a){switch(a.typeName){case "array":return p(a.elementType)+"[]";case "union":var b=a.types.map(function(a){return p(a.type)});a.nullable&&b.push("null");b.sort();return""+b.join(" | ");case "native":switch(a.type){case Number:return"number";case x.Integer:return"integer";case String:return"string";case Boolean:return"boolean";case Object:return"object";default:return"unknown"}case "json":return a.type.prototype.declaredClass;case "enum":return"string";default:z.neverReached(a)}}
function da(a){a=a.prototype.itemType&&a.prototype.itemType.Type;if(!a)return{typeName:"array",elementType:{typeName:"native",type:null}};if("function"===typeof a)return{typeName:"array",elementType:n(a)};if(a.typeMap){var b=[],c;for(c in a.typeMap){var d=a.typeMap[c];b.push({type:n(d),value:G(d)?null:c})}return{typeName:"array",elementType:{typeName:"union",key:"string"===typeof a.key?a.key:"type",types:b}}}}function ea(a){if("json"!==a.typeName)return null;var b=(a=a.type.__accessorMetadata__)&&
a.properties&&a.properties.type,c=(a=(a=b&&u(b))&&a.type)||b&&b.type;return c&&Array.isArray(c)&&"string"===typeof c[0]?a?a:b.type.map(function(a){return D(b,a)}):null}function E(a){if("array"===a.typeName)return a.elementType=E(a.elementType),a;var b=ea(a);return b?{typeName:"union",key:"type",types:b.map(function(b){return{value:b,type:a}})}:a}function q(a){if(Array.isArray(a))return{typeName:"array",elementType:q(a[0])};var b=[],c;for(c in a.typeMap){var d=a.typeMap[c];b.push({type:n(d),value:G(d)?
null:c})}return{typeName:"union",key:"string"===typeof a.key?a.key:"type",types:b}}function D(a,b){a=F(a);var c=a.writer;return null!=c&&c.isJSONMapWriter?(c={value:""},a.writer(b,c,"value"),c.value):b}function n(a){return a?x.isLongFormType(a)?L(a):Array.isArray(a)?"string"===typeof a[0]||"number"===typeof a[0]?{typeName:"enum",values:a}:1<a.length?{typeName:"union",key:null,types:a.map(function(a){return{type:n(a),value:null}})}:{typeName:"array",elementType:n(a[0])}:O.isCollection(a)?da(a):G(a)?
{typeName:"native",type:a}:fa(a)?{typeName:"json",type:a}:{typeName:"native",type:null}:{typeName:"native",type:null}}function L(a){switch(a.type){case "native":return{typeName:"native",type:a.value};case "array":return{typeName:"array",elementType:n(a.value)};case "one-of":return{typeName:"union",key:null,types:a.values.map(function(a){return{type:L(a),value:null}})};default:z.neverReached(a)}}function fa(a){for(;a;){if(a.prototype&&("esri.core.JSONSupport"===a.prototype.declaredClass||"esri.core.MultiOriginJSONSupport"===
a.prototype.declaredClass))return!0;a=Object.getPrototypeOf(a)}return!1}function G(a){return a===String||a===Boolean||a===Number||a===x.Integer||a===Object}function u(a){if(!a.json)return null;var b=a.json.origins;a=a.json;var c=b&&b["web-document"];return b&&b["web-scene"]||c||a||null}function F(a){if(!a.json)return null;var b=a.json.origins;a=a.json.write;var c=b&&b["web-document"]&&b["web-document"].write;return b&&b["web-scene"]&&b["web-scene"].write||c||a||null}Object.defineProperty(w,"__esModule",
{value:!0});w.scan=void 0;w.scan=function(a){return d.__awaiter(this,void 0,void 0,function(){var b;return d.__generator(this,function(c){b=new V.ScanContext;return[2,J(null,{typeName:"json",type:a},b)]})})}});