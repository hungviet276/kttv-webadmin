// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../Basemap ../core/Collection ../core/Logger ../core/urlUtils ../core/accessorSupport/ensureType ./basemapDefinitions".split(" "),function(A,d,f,k,x,y,z,e){function l(a,c){var b;if("string"===typeof a){if(!(a in e.esriBasemapDefinitions))return c=Object.keys(e.esriBasemapDefinitions).map(function(a){return'"'+a+'"'}).join(", "),m.warn("Unable to find basemap definition for: "+a+". Try one of these: "+c),null;c&&(b=c[a]);b||(b=f.fromId(a),c&&(c[a]=b))}else b=z.default(f,a);
if(null===b||void 0===b?0:b.destroyed)m.warn("The provided basemap is already destroyed",{basemap:b}),b=null;return b}function n(a,c){var b=new k;a.forEach(function(a){var d=c.find(function(c){return p(g(a),g(c))})||a;b.some(function(a){return a===d})?b.push(a):b.push(d)});return b}function h(a){return a?!a.loaded&&a.resourceInfo?q(a.resourceInfo.data):{baseLayers:r(a.baseLayers),referenceLayers:r(a.referenceLayers)}:null}function r(a){return(k.isCollection(a)?a.toArray():a).map(g)}function g(a){return{type:a.type,
url:t("urlTemplate"in a&&a.urlTemplate||a.url||"styleUrl"in a&&a.styleUrl),minScale:"minScale"in a&&null!=a.minScale?a.minScale:0,maxScale:"maxScale"in a&&null!=a.maxScale?a.maxScale:0,opacity:null!=a.opacity?a.opacity:1,visible:null!=a.visible?!!a.visible:!0}}function q(a){return a?{baseLayers:u(a.baseMapLayers.filter(function(a){return!a.isReference})),referenceLayers:u(a.baseMapLayers.filter(function(a){return a.isReference}))}:null}function u(a){return a.map(function(a){var b;switch(a.layerType){case "VectorTileLayer":b=
"vector-tile";break;case "ArcGISTiledMapServiceLayer":b="tile";break;default:b="unknown"}return{type:b,url:t(a.templateUrl||a.urlTemplate||a.styleUrl||a.url),minScale:null!=a.minScale?a.minScale:0,maxScale:null!=a.maxScale?a.maxScale:0,opacity:null!=a.opacity?a.opacity:1,visible:null!=a.visibility?!!a.visibility:!0}})}function v(a,c,b){return null!=a!==(null!=c)?"not-equal":a?w(a.baseLayers,c.baseLayers)?w(a.referenceLayers,c.referenceLayers)?"equal":b.mustMatchReferences?"not-equal":"base-layers-equal":
"not-equal":"equal"}function w(a,c){if(a.length!==c.length)return!1;for(var b=0;b<a.length;b++)if(!p(a[b],c[b]))return!1;return!0}function p(a,c){return a.type===c.type&&a.url===c.url&&a.minScale===c.minScale&&a.maxScale===c.maxScale&&a.visible===c.visible&&a.opacity===c.opacity}function t(a){return a?y.normalize(a).replace(/^\s*https?:/i,"").toLowerCase():""}Object.defineProperty(d,"__esModule",{value:!0});d.contentEquals=d.getWellKnownBasemapId=d.clonePreservingTiledLayers=d.ensureType=d.destroyCache=
d.createCache=void 0;var m=x.getLogger("esri.support.basemapUtils");d.createCache=function(){return{}};d.destroyCache=function(a){for(var c in a){var b=a[c];!1===(null===b||void 0===b?void 0:b.destroyed)&&b.destroy();delete a[c]}};d.ensureType=l;d.clonePreservingTiledLayers=function(a,c){void 0===c&&(c=null);a=l(a);if(!a)return null;var b=new f({id:a.id,title:a.title,baseLayers:a.baseLayers.slice(),referenceLayers:a.referenceLayers.slice()});c&&(b.baseLayers=n(b.baseLayers,c.baseLayers),b.referenceLayers=
n(b.referenceLayers,c.referenceLayers));b.load().catch(function(){});b.portalItem=a.portalItem;return b};d.getWellKnownBasemapId=function(a){var c=null;a=h(a);for(var b in e.esriBasemapDefinitions){var d=q(e.esriBasemapDefinitions[b]),d=v(a,d,{mustMatchReferences:!1});if("equal"===d){c=b;break}"base-layers-equal"===d&&(c=b)}return c};d.contentEquals=function(a,c){if(a===c)return!0;a=h(a);c=h(c);return"equal"===v(a,c,{mustMatchReferences:!0})}});