// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","../../core/global","../../core/mathUtils"],function(E,b,C,D){function t(c,a,d,h,e){c=new Uint32Array(c*c);a="buffer"in a?a:new Float64Array(a);d="buffer"in d?new Uint32Array(d.buffer):new Uint32Array((new Uint8Array(d)).buffer);e=d.length/(e-h);for(var b=0;b<a.length;b++)c[b]=d[D.clamp(Math.floor((a[b]-h)*e),0,d.length-1)];return c.buffer}function y(c){for(var a=Math.round(3*c),d=2*c*c,b=new Float64Array(2*a+1),e=0;e<=b.length;e++)b[e]=Math.exp(-Math.pow(e-a,2)/d)/Math.sqrt(2*
Math.PI)*(c/2);return b}function w(c,a){return"function"===typeof c?c:c?"string"===typeof a?function(a){return-1*+a[c]}:function(d){return+d[c]+a}:function(){return 1}}function B(c,a){return null!=c?"string"===typeof a?function(a){return-1*+a.readAttribute(c)}:function(d){return+d.readAttribute(c)+a}:function(a){return 1}}Object.defineProperty(b,"__esModule",{value:!0});b.createValueFunctionCursor=b.createValueFunction=b.createKernel=b.createHeatmapImageData=b.drawHeatmap=b.calculateHeatmapIntensityInfoReaders=
b.calculateHeatmapIntensityInfo=b.generateGradient=void 0;b.generateGradient=function(){if(!("document"in C))return function(){return null};var c=document.createElement("canvas"),a=c.getContext("2d");c.height=512;c.width=1;return function(d){a.clearRect(0,0,1,c.height);var b=a.createLinearGradient(0,0,0,c.height),e=0;for(d=d.colorStops;e<d.length;e++){var m=d[e],f=m.color;b.addColorStop(Math.max(m.ratio,.001),"rgba("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")")}a.fillStyle=b;a.fillRect(0,0,1,c.height);
return a.getImageData(0,0,1,c.height).data}}();b.calculateHeatmapIntensityInfo=function(c,a,d,b){var e=a.blurRadius,m=a.fieldOffset,f=a.field;a=new Float64Array(d*b);for(var h=y(e),e=Math.round(3*e),p=Number.NEGATIVE_INFINITY,g,m=w(f,m),f=0;f<c.length;f++){var n=c[f],k=n.geometry,q=k.x-e,u=k.y-e,x=Math.max(0,q);g=Math.max(0,u);for(var z=Math.min(b,k.y+e),k=Math.min(d,k.x+e),n=+m(n.attributes),r=g;r<z;r++)for(var A=h[r-u],l=x;l<k;l++)g=a[r*d+l]+=A*h[l-q]*n,g>p&&(p=g)}return{matrix:a.buffer,max:p}};
b.calculateHeatmapIntensityInfoReaders=function(c,a,b,h){var e=a.blurRadius,d=a.fieldOffset,f=a.field;a=new Float64Array(b*h);for(var t=y(e),e=Math.round(3*e),p=Number.NEGATIVE_INFINITY,g,d=B(f,d),f=new Set,n=0;n<c.length;n++)for(var k=c[n].getCursor();k.next();){var q=k.getObjectId();if(!f.has(q)){f.add(q);g=k.readLegacyPointGeometry();for(var q=+d(k),u=g.x-e,x=g.y-e,z=Math.max(0,u),r=Math.min(h,g.y+e),A=Math.min(b,g.x+e),l=Math.max(0,x);l<r;l++)for(var w=t[l-x],v=z;v<A;v++)g=a[l*b+v]+=w*t[v-u]*
q,g>p&&(p=g)}}return{matrix:a.buffer,max:p}};b.drawHeatmap=function(c,a,b,h,e,m){c.canvas.width=c.canvas.height=a;c.clearRect(0,0,a,a);var d=c.getImageData(0,0,a,a);b&&h&&d.data.set(new Uint8ClampedArray(t(a,b,h,e,m)));c.putImageData(d,0,0)};b.createHeatmapImageData=t;b.createKernel=y;b.createValueFunction=w;b.createValueFunctionCursor=B});