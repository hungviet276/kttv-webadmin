// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../global ./RemoteClient ./utils @dojo/framework/shim/Promise".split(" "),function(p,r,l,d,m,f){var q=function(){return function(){var a=this,c=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(b){a[b]=function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];return c[b].apply(c,e)}})}}(),g=d.MutationObserver||d.WebKitMutationObserver,h=function(){var a;if(d.process&&d.process.nextTick)a=function(c){d.process.nextTick(c)};
else if(d.Promise)a=function(c){d.Promise.resolve().then(c)};else if(g){var c=[],b=document.createElement("div");(new g(function(){for(;0<c.length;)c.shift()()})).observe(b,{attributes:!0});a=function(a){c.push(a);b.setAttribute("queueStatus","1")}}return a}(),n=function(){var a=d.MessageEvent;try{new a("message",{data:null})}catch(c){return function(c,a){void 0===a&&(a={});var b=a.data,e=a.bubbles,e=void 0===e?!1:e;a=a.cancelable;a=void 0===a?!1:a;var d=document.createEvent("Event");d.initEvent(c,
e,a);d.data=b;return d}}return function(c,b){return new a(c,b)}}();return function(){function a(){this._dispatcher=new q;this._isInitialized=!1;this._workerPostMessage({type:f.MessageType.HANDSHAKE})}a.prototype.terminate=function(){};Object.defineProperty(a.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(a){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=a)&&this.addEventListener("message",a)},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"onmessageerror",{get:function(){return this._onmessageerrorHandler},set:function(a){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler);(this._onmessageerrorHandler=a)&&this.addEventListener("messageerror",a)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(a){this._onerrorHandler&&this.removeEventListener("error",
this._onerrorHandler);(this._onerrorHandler=a)&&this.addEventListener("error",a)},enumerable:!1,configurable:!0});a.prototype.postMessage=function(a){var c=this;h(function(){c._workerMessageHandler(n("message",{data:a}))})};a.prototype.dispatchEvent=function(a){return this._dispatcher.dispatchEvent(a)};a.prototype.addEventListener=function(a,b,e){this._dispatcher.addEventListener(a,b,e)};a.prototype.removeEventListener=function(a,b,e){this._dispatcher.removeEventListener(a,b,e)};a.prototype._workerPostMessage=
function(a){var b=this;h(function(){b.dispatchEvent(n("message",{data:a}))})};a.prototype._workerMessageHandler=function(a){return l.__awaiter(this,void 0,void 0,function(){var b,c,d,g,k,h;return l.__generator(this,function(e){switch(e.label){case 0:b=f.receiveMessage(a);if(!b)return[2];c=b.type;switch(c){case f.MessageType.CONFIGURE:return[3,1];case f.MessageType.OPEN:return[3,2]}return[3,6];case 1:return this._isInitialized||this._workerPostMessage({type:f.MessageType.CONFIGURED}),[3,6];case 2:return d=
b.modulePath,g=b.jobId,[4,m.loadWorker(d)];case 3:return(k=e.sent())?[3,5]:[4,new Promise(function(a,b){p([d],a,b)})];case 4:k=e.sent(),e.label=5;case 5:return h=m.connect(k),this._workerPostMessage({type:f.MessageType.OPENED,jobId:g,data:h}),[3,6];case 6:return[2]}})})};return a}()});