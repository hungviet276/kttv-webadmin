// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ./maybe ./nextTick ./PooledArray ./promiseUtils".split(" "),function(A,b,w,m,n,f){function x(a){void 0===a&&(a=performance.now());b.debug.rafId=null;0<c.length&&(b.debug.rafId=d());b.debug.executeFrameTasks(a)}function d(){return b.debug.requestNextFrame?b.debug.requestNextFrame(p):p()}function q(){c.forEachSimple(function(a){a.removed&&g.push(a)});c.removeUnorderedMany(g.data,g.length);g.clear()}function r(){for(;k.length;){var a=w.assumeNonNull(k.shift());a.isActive&&a.callback()}b.debug.willDispatch=
!1}function p(){return requestAnimationFrame(x)}Object.defineProperty(b,"__esModule",{value:!0});b.waitTicks=b.requestNextFrame=b.setFrameDuration=b.addFrameTask=b.schedule=b.debug=b.FrameTaskHandle=void 0;var y=function(){return function(a){this.phases=a;this.paused=!1;this.ticks=-1;this.removed=!1}}(),z=function(){function a(a){this.callback=a;this.isActive=!0}a.prototype.remove=function(){this.isActive=!1};return a}(),e=-1,l=0,h={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},t=["prepare",
"preRender","render","postRender","update"],k=[],c=new n,u=function(){function a(a){this._task=a}a.prototype.remove=function(){this._task.removed=!0};a.prototype.pause=function(){this._task.paused=!0};a.prototype.resume=function(){this._task.paused=!1};return a}();b.FrameTaskHandle=u;b.debug={frameTasks:c,rafId:null,requestNextFrame:null,willDispatch:!1,clearFrameTasks:function(a){void 0===a&&(a=!1);c.forEachSimple(function(a){a.removed=!0});a&&q()},dispatch:r,executeFrameTasks:function(a){void 0===
a&&(a=performance.now());0>e&&(e=a);var b=a-e,v=0<l?l:1E3/60,g=Math.max(0,b-v);e=a;for(var f=function(d){var f=t[d];c.forEachSimple(function(c){var e;c.paused||c.removed||(0===d&&c.ticks++,c.phases[f]&&(h.time=a,h.deltaTime=0===c.ticks?0:b,h.elapsedFrameTime=performance.now()-a,h.frameDuration=v-g,null===(e=c.phases[f])||void 0===e?void 0:e.call(c,h)))})},d=0;d<t.length;d++)f(d);q()}};b.schedule=function(a){a=new z(a);k.push(a);b.debug.willDispatch||(b.debug.willDispatch=!0,m(r));return a};b.addFrameTask=
function(a){a=new y(a);c.push(a);b.debug.rafId||(e=-1,b.debug.rafId=d());return new u(a)};b.setFrameDuration=function(a){l=Math.max(0,a)};b.requestNextFrame=d;var g=new n;b.waitTicks=function(a,b){void 0===a&&(a=1);var c=f.createResolver(),d=function(){f.isAborted(b)?c.reject(f.createAbortError()):0===a?c():(--a,m(function(){return d()}))};d();return c.promise}});