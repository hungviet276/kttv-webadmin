// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ./ArrayPool ./arrayUtils ./Evented ./lang ./maybe ./ObjectPool ./scheduling ./accessorSupport/ensureType ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass".split(" "),function(B,Q,l,w,C,J,K,D,L,M,E,F,G){function y(d){return d?d instanceof H?d.toArray():d.length?Array.prototype.slice.apply(d):[]:[]}function z(d){if(d&&d.length)return d[0]}function I(d,b,l,a){b&&b.forEach(function(c,b,f){d.push(c);I(d,l.call(a,c,b,f),l,a)})}B=function(){function d(){this.target=
null;this.defaultPrevented=this.cancellable=!1;this.type=this.item=void 0}d.prototype.preventDefault=function(){this.cancellable&&(this.defaultPrevented=!0)};d.prototype.reset=function(b){this.defaultPrevented=!1;this.item=b};return d}();var p=new L(B,void 0,function(d){d.item=null;d.target=null;d.defaultPrevented=!1;d.cancellable=!1}),O=function(){},r=new Set,t=new Set,u=new Set,A=new Map,P=0,H=function(d){function b(a){a=d.call(this,a)||this;a._chgListeners=[];a._notifications=null;a._timer=null;
a.length=0;a._items=[];Object.defineProperty(a,"uid",{value:P++});return a}l.__extends(b,d);m=b;b.isCollection=function(a){return null!=a&&a instanceof m};b.prototype.normalizeCtorArgs=function(a){return a?Array.isArray(a)||a instanceof m?{items:a}:a:{}};Object.defineProperty(b.prototype,"items",{get:function(){return this._items},set:function(a){this._emitBeforeChanges(1)||(this._splice.apply(this,l.__spreadArrays([0,this.length],y(a))),this._emitAfterChanges(1))},enumerable:!1,configurable:!0});
b.prototype.hasEventListener=function(a){return"change"===a?0<this._chgListeners.length:this._emitter.hasEventListener(a)};b.prototype.on=function(a,c){if("change"===a){var b=this._chgListeners,f={removed:!1,callback:c};b.push(f);this._notifications&&this._notifications.push({listeners:b.slice(),items:this._items.slice(),changes:[]});return{remove:function(){this.remove=O;f.removed=!0;b.splice(b.indexOf(f),1)}}}return this._emitter.on(a,c)};b.prototype.once=function(a,c){var b=this.on(a,c);return{remove:function(){b.remove()}}};
b.prototype.add=function(a,c){if(this._emitBeforeChanges(1))return this;c=this.getNextIndex(null!==c&&void 0!==c?c:null);this._splice(c,0,a);this._emitAfterChanges(1);return this};b.prototype.addMany=function(a,c){void 0===c&&(c=this._items.length);if(!a||!a.length||this._emitBeforeChanges(1))return this;c=this.getNextIndex(c);this._splice.apply(this,l.__spreadArrays([c,0],y(a)));this._emitAfterChanges(1);return this};b.prototype.removeAll=function(){if(!this.length||this._emitBeforeChanges(2))return[];
var a=this._splice(0,this.length)||[];this._emitAfterChanges(2);return a};b.prototype.clone=function(){return this._createNewInstance({items:this._items.map(K.clone)})};b.prototype.concat=function(){for(var a,c=[],b=0;b<arguments.length;b++)c[b]=arguments[b];c=c.map(y);return this._createNewInstance({items:(a=this._items).concat.apply(a,c)})};b.prototype.drain=function(a,c){if(this.length&&!this._emitBeforeChanges(2)){for(var b=D.assumeNonNull(this._splice(0,this.length)),f=b.length,h=0;h<f;h++)a.call(c,
b[h],h,b);this._emitAfterChanges(2)}};b.prototype.every=function(a,c){return this._items.every(a,c)};b.prototype.filter=function(a,c){var b;b=2===arguments.length?this._items.filter(a,c):this._items.filter(a);return this._createNewInstance({items:b})};b.prototype.find=function(a,c){return C.find(this._items,a,c)};b.prototype.findIndex=function(a,c){return C.findIndex(this._items,a,c)};b.prototype.flatten=function(a,c){var b=[];I(b,this,a,c);return new m(b)};b.prototype.forEach=function(a,c){return this._items.forEach(a,
c)};b.prototype.getItemAt=function(a){return this._items[a]};b.prototype.getNextIndex=function(a){var c=this.length;a=null==a?c:a;0>a?a=0:a>c&&(a=c);return a};b.prototype.includes=function(a,c){void 0===c&&(c=0);return arguments.length?-1!==this._items.indexOf(a,c):!1};b.prototype.indexOf=function(a,c){void 0===c&&(c=0);return this._items.indexOf(a,c)};b.prototype.join=function(a){void 0===a&&(a=",");return this._items.join(a)};b.prototype.lastIndexOf=function(a,c){void 0===c&&(c=this.length-1);return this._items.lastIndexOf(a,
c)};b.prototype.map=function(a,c){a=this._items.map(a,c);return new m({items:a})};b.prototype.reorder=function(a,c){void 0===c&&(c=this.length-1);var b=this.indexOf(a);if(-1!==b){0>c?c=0:c>=this.length&&(c=this.length-1);if(b!==c){if(this._emitBeforeChanges(4))return a;this._splice(b,1);this._splice(c,0,a);this._emitAfterChanges(4)}return a}};b.prototype.pop=function(){if(this.length&&!this._emitBeforeChanges(2)){var a=z(this._splice(this.length-1,1));this._emitAfterChanges(2);return a}};b.prototype.push=
function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];if(this._emitBeforeChanges(1))return this.length;this._splice.apply(this,l.__spreadArrays([this.length,0],a));this._emitAfterChanges(1);return this.length};b.prototype.reduce=function(a,c){var b=this._items;return 2===arguments.length?b.reduce(a,c):b.reduce(a)};b.prototype.reduceRight=function(a,c){var b=this._items;return 2===arguments.length?b.reduceRight(a,c):b.reduceRight(a)};b.prototype.remove=function(a){return this.removeAt(this.indexOf(a))};
b.prototype.removeAt=function(a){if(!(0>a||a>=this.length||this._emitBeforeChanges(2)))return a=z(this._splice(a,1)),this._emitAfterChanges(2),a};b.prototype.removeMany=function(a){if(!a||!a.length||this._emitBeforeChanges(2))return[];a=a instanceof m?a.toArray():a;for(var c=this._items,b=[],f=a.length,h=0;h<f;h++){var n=c.indexOf(a[h]);if(-1<n){for(var k=h+1,q=n+1,e=Math.min(a.length-k,c.length-q),g=0;g<e&&a[k+g]===c[q+g];)g++;k=1+g;(n=this._splice(n,k))&&0<n.length&&b.push.apply(b,n);h+=k-1}}this._emitAfterChanges(2);
return b};b.prototype.reverse=function(){if(this._emitBeforeChanges(4))return this;var a=this._splice(0,this.length);a&&(a.reverse(),this._splice.apply(this,l.__spreadArrays([0,0],a)));this._emitAfterChanges(4);return this};b.prototype.shift=function(){if(this.length&&!this._emitBeforeChanges(2)){var a=z(this._splice(0,1));this._emitAfterChanges(2);return a}};b.prototype.slice=function(a,c){void 0===a&&(a=0);void 0===c&&(c=this.length);return this._createNewInstance({items:this._items.slice(a,c)})};
b.prototype.some=function(a,c){return this._items.some(a,c)};b.prototype.sort=function(a){if(!this.length||this._emitBeforeChanges(4))return this;var c=D.assumeNonNull(this._splice(0,this.length));arguments.length?c.sort(a):c.sort();this._splice.apply(this,l.__spreadArrays([0,0],c));this._emitAfterChanges(4);return this};b.prototype.splice=function(a,c){for(var b=[],f=2;f<arguments.length;f++)b[f-2]=arguments[f];f=(c?2:0)|(b.length?1:0);if(this._emitBeforeChanges(f))return[];b=this._splice.apply(this,
l.__spreadArrays([a,c],b))||[];this._emitAfterChanges(f);return b};b.prototype.toArray=function(){return this._items.slice()};b.prototype.toJSON=function(){return this.toArray()};b.prototype.toLocaleString=function(){return this._items.toLocaleString()};b.prototype.toString=function(){return this._items.toString()};b.prototype.unshift=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];if(!a.length||this._emitBeforeChanges(1))return this.length;this._splice.apply(this,l.__spreadArrays([0,
0],a));this._emitAfterChanges(1);return this.length};b.prototype._createNewInstance=function(a){return new this.constructor(a)};b.prototype._splice=function(a,c){for(var b=this,f=[],h=2;h<arguments.length;h++)f[h-2]=arguments[h];var h=this._items,n=this.constructor.prototype.itemType,k,q=void 0;!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=M.schedule(function(){return b._dispatchChange()}));
if(c){q=h.splice(a,c);if(this.hasEventListener("before-remove")){var e=p.acquire();e.target=this;e.cancellable=!0;for(var g=0,d=q.length;g<d;g++)k=q[g],e.reset(k),this.emit("before-remove",e),e.defaultPrevented&&(q.splice(g,1),h.splice(a,0,k),a+=1,--g,--d);p.release(e)}this.length=this._items.length;if(this.hasEventListener("after-remove")){k=p.acquire();k.target=this;k.cancellable=!1;d=q.length;for(g=0;g<d;g++)k.reset(q[g]),this.emit("after-remove",k);p.release(k)}}if(f&&f.length){if(n){g=[];for(d=
0;d<f.length;d++)k=f[d],e=n.ensureType(k),null==e&&null!=k||g.push(e);f=g}n=this.hasEventListener("before-add");g=this.hasEventListener("after-add");d=a===this.length;if(n||g){k=p.acquire();k.target=this;k.cancellable=!0;e=p.acquire();e.target=this;e.cancellable=!1;for(var m=0,r=f;m<r.length;m++){var v=r[m];n?(k.reset(v),this.emit("before-add",k),k.defaultPrevented||(d?h.push(v):h.splice(a++,0,v),this._set("length",h.length),g&&(e.reset(v),this.emit("after-add",e)))):(d?h.push(v):h.splice(a++,0,v),
this._set("length",h.length),e.reset(v),this.emit("after-add",e))}p.release(e);p.release(k)}else{if(d)for(n=0,g=f;n<g.length;n++)h.push(g[n]);else h.splice.apply(h,l.__spreadArrays([a,0],f));this._set("length",h.length)}}(f&&f.length||q&&q.length)&&this._notifyChangeEvent(f,q);return q};b.prototype._emitBeforeChanges=function(a){var c=!1;if(this.hasEventListener("before-changes")){var b=p.acquire();b.target=this;b.cancellable=!0;b.type=a;this.emit("before-changes",b);c=b.defaultPrevented;p.release(b)}return c};
b.prototype._emitAfterChanges=function(a){if(this.hasEventListener("after-changes")){var c=p.acquire();c.target=this;c.cancellable=!1;c.type=a;this.emit("after-changes",c);p.release(c)}};b.prototype._notifyChangeEvent=function(a,c){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:a,removed:c})};b.prototype._dispatchChange=function(){this._timer&&(this._timer.remove(),this._timer=null);if(this._notifications){var a=this._notifications;
this._notifications=null;for(var c=function(a){var c=a.changes;r.clear();t.clear();u.clear();for(var f=0;f<c.length;f++){var d=c[f],e=d.added,d=d.removed;if(e)if(0===u.size&&0===t.size)for(var g=0,h=e;g<h.length;g++)e=h[g],r.add(e);else for(g=0,h=e;g<h.length;g++)e=h[g],t.has(e)?(u.add(e),t.delete(e)):u.has(e)||r.add(e);if(d)if(0===u.size&&0===r.size)for(g=0;g<d.length;g++)e=d[g],t.add(e);else for(g=0;g<d.length;g++)e=d[g],r.has(e)?r.delete(e):(u.delete(e),t.add(e))}var l=w.acquire();r.forEach(function(a){l.push(a)});
var m=w.acquire();t.forEach(function(a){m.push(a)});var p=b._items,N=a.items,x=w.acquire();u.forEach(function(a){N.indexOf(a)!==p.indexOf(a)&&x.push(a)});if(a.listeners&&(l.length||m.length||x.length))for(c={target:b,added:l,removed:m,moved:x},f=a.listeners.length,e=0;e<f;e++)d=a.listeners[e],d.removed||d.callback.call(b,c);w.release(l);w.release(m);w.release(x)},b=this,f=0;f<a.length;f++)c(a[f]);r.clear();t.clear();u.clear()}};var m;b.ofType=function(a){if(!a)return m;if(A.has(a))return A.get(a);
var c=null;if("function"===typeof a)c=a.prototype.declaredClass;else if(a.base)c=a.base.prototype.declaredClass;else for(var b in a.typeMap)var d=a.typeMap[b].prototype.declaredClass,c=c?c+(" | "+d):d;b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l.__extends(b,a);return b=l.__decorate([G.subclass("esri.core.Collection\x3c"+c+"\x3e")],b)}(m);d={Type:a,ensureType:"function"===typeof a?E.ensureType(a):E.ensureOneOfType(a)};Object.defineProperty(b.prototype,"itemType",{value:d});
A.set(a,b);return b};l.__decorate([F.property()],b.prototype,"length",void 0);l.__decorate([F.property()],b.prototype,"items",null);return b=m=l.__decorate([G.subclass("esri.core.Collection")],b)}(J.EventedAccessor);return H});