// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../maybe ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceUtils ../../../support/persistableUrlUtils @dojo/framework/shim/Promise".split(" "),function(y,q,t,k,z,r,A,B,C,D,u,p){function E(c,d,e){var g=B.getOwnPropertyMetadata(d,e);return{type:String,read:function(a,c,e){a=p.read(a,c,e);if(g.type===String)return a;if("function"===typeof g.type)return new g.type({url:a})},write:{writer:function(a,
h,d,b){if(b&&b.resources){var f;f=k.isNone(a)?null:"string"===typeof a?a:a.url;f=f?p.toJSON(f,t.__assign(t.__assign({},b),{verifyItemRelativeUrls:b&&b.verifyItemRelativeUrls?{writtenUrls:b.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null})):null;var m=g.type!==String&&(!z.isMultiOriginJSONMixin(this)||b&&b.origin&&this.originIdOf(e)>C.nameToId(b.origin));if(b&&b.portalItem&&k.isSome(f)&&!r.isAbsolute(f))if(m){var m=b.portalItem.resourceFromPath(f),n=v(a,f,b),l=u.resourceContentExtension(n),
q=r.getPathExtension(m.path);l!==q?w(this,e,a,f,h,d,b,c):(x(this,e,m,n,b.resources.toUpdate),h[d]=f)}else b.resources.toKeep.push({resource:b.portalItem.resourceFromPath(f)}),h[d]=f;else b&&b.portalItem&&(k.isNone(f)||k.isSome(p.itemIdFromResourceUrl(f))||r.isBlobProtocol(f)||m)?w(this,e,a,f,h,d,b,c):h[d]=f}else h[d]="string"===typeof a?p.toJSON(a,b):a.write({},b)}}}}function w(c,d,e,g,a,h,l,b){var f=A.generateUUID();e=v(e,g,l);var m=r.join(k.get(b,"prefix"),f);b=m+"."+u.resourceContentExtension(e);
var n=l.portalItem.resourceFromPath(b);r.isBlobProtocol(g)&&l.resources.pendingOperations.push(F(g).then(function(b){n.path=m+"."+u.resourceContentExtension(b);a[h]=n.itemRelativeUrl}).catch(function(){}));x(c,d,n,e,l.resources.toAdd);a[h]=n.itemRelativeUrl}function x(c,d,e,g,a){a.push({resource:e,content:g,finish:function(a){"string"===typeof c[d]?c[d]=a.url:c[d].url=a.url}})}function v(c,d,e){return"string"===typeof c?{url:d}:new Blob([JSON.stringify(c.toJSON(e))],{type:"application/json"})}function F(c){return t.__awaiter(this,
void 0,void 0,function(){var d,e;return t.__generator(this,function(g){switch(g.label){case 0:return[4,new Promise(function(a,c){y(["../../../request"],a,c)})];case 1:return d=g.sent(),[4,d(c,{responseType:"blob"})];case 2:return e=g.sent().data,[2,e]}})})}Object.defineProperty(q,"__esModule",{value:!0});q.persistable=void 0;q.persistable=function(c){var d=k.isSome(c)&&c.origins?c.origins:[void 0];return function(e,g){var a;a:if(k.isSome(c)&&"resource"===c.type)a=E(c,e,g);else{switch(k.isSome(c)&&
c.type?c.type:"other"){case "other":a={read:!0,write:!0};break a;case "url":a={read:p.read,write:p.write};break a}a=void 0}for(var h=0;h<d.length;h++){var l=D.propertyJSONMeta(e,d[h],g),b;for(b in a)l[b]=a[b]}}}});