// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../config ./Error ./global ./Logger ./maybe ./string".split(" "),function(ka,b,J,K,W,v,X,n,B){function l(a){var c={path:null,query:null},e=new m(a),b=a.indexOf("?");null===e.query?c.path=a:(c.path=a.substring(0,b),c.query=C(e.query));e.fragment&&(c.hash=e.fragment,null===e.query&&(c.path=c.path.substring(0,c.path.length-(e.fragment.length+1))));return c}function C(a){var c={},e=0;for(a=a.split("\x26");e<a.length;e++){var b=a[e];if(b){var f=b.indexOf("\x3d"),h=void 0,
k=void 0;0>f?(h=decodeURIComponent(b),k=""):(h=decodeURIComponent(b.slice(0,f)),k=decodeURIComponent(b.slice(f+1)));b=c[h];"string"===typeof b&&(b=c[h]=[b]);Array.isArray(b)?b.push(k):c[h]=k}}return c}function L(a){return a&&"object"===typeof a&&"toJSON"in a&&"function"===typeof a.toJSON}function r(a,c){return a?c&&"function"===typeof c?Object.keys(a).map(function(e){return encodeURIComponent(e)+"\x3d"+encodeURIComponent(c(e,a[e]))}).join("\x26"):Object.keys(a).map(function(e){var b=a[e];if(null==
b)return"";var f=encodeURIComponent(e)+"\x3d";return(e=c&&c[e])?f+encodeURIComponent(e(b)):Array.isArray(b)?b.map(function(a){return L(a)?f+encodeURIComponent(JSON.stringify(a)):f+encodeURIComponent(a)}).join("\x26"):L(b)?f+encodeURIComponent(JSON.stringify(b)):f+encodeURIComponent(b)}).filter(function(a){return a}).join("\x26"):""}function D(a){var c=a.indexOf("?");-1!==c?(t.path=a.slice(0,c),t.query=a.slice(c+1)):(t.path=a,t.query=null);return t}function M(a){a=D(a).path;a&&"/"===a[a.length-1]||
(a+="/");a=w(a,!0);return a=a.toLowerCase()}function x(a){var c=p.proxyRules;a=M(a);for(var b=0;b<c.length;b++)if(0===a.indexOf(c[b].urlPrefix))return c[b]}function N(a){a=u(a);var c=a.indexOf("/sharing");return 0<c?a.substring(0,c):a.replace(/\/+$/,"")}function E(a,c,b){void 0===b&&(b=!1);a=F(a);c=F(c);return!b&&a.scheme!==c.scheme||null==a.host||null==c.host?!1:a.host.toLowerCase()===c.host.toLowerCase()&&a.port===c.port}function y(a,c,e){void 0===c&&(c=b.appBaseUrl);return g(a)?e&&e.preserveProtocolRelative?
a:"http"===b.appUrl.scheme&&b.appUrl.authority===O(a).slice(2)?"http:"+a:"https:"+a:z(a)?a:n.assumeNonNull(P("/"===a[0]?Y(c):c,a))}function u(a){a=a.trim();a=y(a);if(/^https?:\/\//i.test(a)){var c=D(a);a=c.path.replace(/\/{2,}/g,"/");a=a.replace("/","//");c.query&&(a+="?"+c.query)}a=a.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2");return a=Z(a)}function P(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];if((c=a.filter(n.isSome))&&c.length){a=[];if(q(c[0])){var b=c[0],d=b.indexOf("//");
-1!==d&&(a.push(b.slice(0,d+1)),aa.test(c[0])&&(a[0]+="/"),c[0]=b.slice(d+2))}else"/"===c[0][0]&&a.push("");c=c.reduce(function(a,c){return c?a.concat(c.split("/")):a},[]);for(b=0;b<c.length;b++)d=c[b],".."===d&&0<a.length&&".."!==a[a.length-1]?a.pop():(!d&&b===c.length-1||d&&("."!==d||0===a.length))&&a.push(d);return a.join("/")}}function O(a,c){void 0===c&&(c=!1);if(Q(a)||R(a))return null;var b=a.indexOf("://");if(-1===b&&g(a))b=2;else if(-1!==b)b+=3;else return null;b=a.indexOf("/",b);-1!==b&&
(a=a.slice(0,b));c&&(a=w(a,!0));return a}function q(a){return g(a)||z(a)}function Q(a){return null!=a&&"blob:"===a.slice(0,5)}function R(a){return"data:"===a.slice(0,5)}function S(a){a=G(a);if(!a||!a.isBase64)return null;a=atob(a.data);for(var c=new Uint8Array(a.length),b=0;b<a.length;b++)c[b]=a.charCodeAt(b);return c.buffer}function G(a){return(a=a.match(ba))?{mediaType:a[1],isBase64:!!a[2],data:a[3]}:null}function H(a){var c=S(a);if(!c)return null;a=G(a);return new Blob([c],{type:a.mediaType})}
function g(a){return null!=a&&void 0!==a&&"/"===a[0]&&"/"===a[1]}function z(a){return T.test(a)}function ca(a){return U.test(a)||"http"===b.appUrl.scheme&&g(a)}function I(a){return g(a)?"https:"+a:a.replace(U,"https:")}function A(){return"https"===b.appUrl.scheme}function w(a,c){void 0===c&&(c=!1);if(g(a))return a.slice(2);a=a.replace(T,"");c&&1<a.length&&"/"===a[0]&&"/"===a[1]&&(a=a.slice(2));return a}function Y(a){var c=a.indexOf("//"),c=a.indexOf("/",c+2);return-1===c?a:a.slice(0,c)}function Z(a){var c=
p.httpsDomains;if(!ca(a))return a;var e=a.indexOf("/",7),d;d=-1===e?a:a.slice(0,e);d=d.toLowerCase().slice(7);if(da.test(d))if(B.endsWith(d,":80"))d=d.slice(0,-3),a=a.replace(":80","");else return a;if("http"===b.appUrl.scheme&&d===b.appUrl.authority&&!ea.test(a))return a;if(A()&&d===b.appUrl.authority||c&&c.some(function(a){return d===a||B.endsWith(d,"."+a)})||A()&&!x(a))a=I(a);return a}function F(a){if("string"===typeof a)return new m(y(a));a.scheme||(a.scheme=b.appUrl.scheme);return a}Object.defineProperty(b,
"__esModule",{value:!0});b.getPathExtension=b.removeQueryParameter=b.addQueryParameters=b.addQueryParameter=b.removeQueryParameters=b.isSVG=b.changeDomain=b.removeTrailingSlash=b.removeFile=b.isAppHTTPS=b.toHTTPS=b.toHTTP=b.hasProtocol=b.isProtocolRelative=b.downloadDataAsFile=b.dataToBlob=b.makeData=b.dataComponents=b.dataToArrayBuffer=b.isDataProtocol=b.isBlobProtocol=b.isAbsolute=b.getOrigin=b.join=b.normalize=b.makeRelative=b.makeAbsolute=b.isTrustedServer=b.hasSameOrigin=b.getInterceptor=b.hasSamePortal=
b.getProxyRule=b.addProxyRule=b.addProxy=b.getProxyUrl=b.objectToQuery=b.queryToObject=b.urlToObject=b.appBaseUrl=b.trustedServersUrlCache=b.appUrl=b.Url=void 0;var fa=X.getLogger("esri.core.urlUtils"),p=K.request,T=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,U=/^\s*http:/i,V=/^\s*https:/i,aa=/^\s*file:/i,da=/:\d+$/,ea=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,ga=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/,ha=/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,m=function(){function a(a){void 0===
a&&(a="");this.uri=a;this.port=this.host=this.password=this.user=this.fragment=this.query=this.path=this.authority=this.scheme=null;a=n.assumeNonNull(this.uri.match(ga));this.scheme=a[2]||(a[1]?"":null);this.authority=a[4]||(a[3]?"":null);this.path=a[5];this.query=a[7]||(a[6]?"":null);this.fragment=a[9]||(a[8]?"":null);null!=this.authority&&(a=n.assumeNonNull(this.authority.match(ha)),this.user=a[3]||null,this.password=a[4]||null,this.host=a[6]||a[7],this.port=a[9]||null)}a.prototype.toString=function(){return this.uri};
return a}();b.Url=m;b.appUrl=new m(K.applicationUrl);b.trustedServersUrlCache={};b.appBaseUrl=function(){var a=n.assumeNonNull(b.appUrl.path),a=a.substring(0,a.lastIndexOf(a.split("/")[a.split("/").length-1]));return""+(b.appUrl.scheme+"://"+b.appUrl.host+(null!=b.appUrl.port?":"+b.appUrl.port:""))+a}();b.urlToObject=l;b.queryToObject=C;b.objectToQuery=r;b.getProxyUrl=function(a){void 0===a&&(a=!1);var c,e=p.proxyUrl;if("string"===typeof a){if(c=a,c=V.test(c)||"https"===b.appUrl.scheme&&g(c),a=x(a))e=
a.proxyUrl}else c=!!a;if(!e)throw fa.warn("esri/config: esriConfig.request.proxyUrl is not set."),new W("urlutils:proxy-not-set","esri/config: esriConfig.request.proxyUrl is not set.");c&&A()&&(e=I(e));return l(e)};b.addProxy=function(a){var b=x(a),e=void 0,d;b&&(d=D(b.proxyUrl),e=d.path,d=d.query?C(d.query):null);e&&(b=l(a),a=e+"?"+b.path,(e=r(J.__assign(J.__assign({},d),b.query)))&&(a=a+"?"+e));return a};var t={path:"",query:""};b.addProxyRule=function(a){a={proxyUrl:a.proxyUrl,urlPrefix:M(a.urlPrefix)};
for(var b=p.proxyRules,e=a.urlPrefix,d=b.length,f=0;f<b.length;f++){var h=b[f].urlPrefix;if(0===e.indexOf(h)){if(e.length===h.length)return-1;d=f;break}0===h.indexOf(e)&&(d=f+1)}b.splice(d,0,a);return d};b.getProxyRule=x;b.hasSamePortal=function(a,b){a=N(a);b=N(b);return w(a)===w(b)};b.getInterceptor=function(a){var b=function(b){return null==b||b instanceof RegExp&&b.test(a)||"string"===typeof b&&B.startsWith(a,b)},e=p.interceptors;if(e)for(var d=0;d<e.length;d++){var f=e[d];if(Array.isArray(f.urls)){if(f.urls.some(b))return f}else if(b(f.urls))return f}return null};
b.hasSameOrigin=E;b.isTrustedServer=function(a){if("string"===typeof a)if(q(a))a=F(a);else return!0;if(E(a,b.appUrl))return!0;for(var c=p.trustedServers||[],e=0;e<c.length;e++){var d;d=c[e];b.trustedServersUrlCache[d]||(z(d)||g(d)?b.trustedServersUrlCache[d]=[new m(y(d))]:b.trustedServersUrlCache[d]=[new m("http://"+d),new m("https://"+d)]);d=b.trustedServersUrlCache[d];for(var f=0;f<d.length;f++)if(E(a,d[f]))return!0}return!1};b.makeAbsolute=y;b.makeRelative=function(a,c,e){void 0===c&&(c=b.appBaseUrl);
if(!q(a))return a;var d=u(a),f=d.toLowerCase();c=u(c).toLowerCase().replace(/\/+$/,"");if((e=e?u(e).toLowerCase().replace(/\/+$/,""):null)&&0!==c.indexOf(e))return a;for(var h=function(a,b,c){c=a.indexOf(b,c);return-1===c?a.length:c},k=h(f,"/",f.indexOf("//")+2),g=-1;f.slice(0,k+1)===c.slice(0,k)+"/";){g=k+1;if(k===f.length)break;k=h(f,"/",k+1)}if(-1===g||e&&g<e.length)return a;a=d.slice(g);d=c.slice(g-1).replace(/[^/]+/g,"").length;if(0<d)for(f=0;f<d;f++)a="../"+a;else a="./"+a;return a};b.normalize=
u;b.join=P;b.getOrigin=O;b.isAbsolute=q;b.isBlobProtocol=Q;b.isDataProtocol=R;b.dataToArrayBuffer=S;var ba=/^data:(.*?)(;base64)?,(.*)$/;b.dataComponents=G;b.makeData=function(a){return a.isBase64?"data:"+a.mediaType+";base64,"+a.data:"data:"+a.mediaType+","+a.data};b.dataToBlob=H;b.downloadDataAsFile=function(a,b){var c;a:if(c=document.createElement("a"),"download"in c){var d=null;if(v.URL&&v.URL.createObjectURL){d=H(a);if(!d){c=!1;break a}d=v.URL.createObjectURL(d)}c.download=b;c.href=d||a;c.style.display=
"none";document.body.appendChild(c);c.click();document.body.removeChild(c);d&&v.URL.revokeObjectURL(d);c=void 0}else c=!1;c||window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(H(a),b)};b.isProtocolRelative=g;b.hasProtocol=z;b.toHTTP=function(a){return g(a)?"http:"+a:a.replace(V,"http:")};b.toHTTPS=I;b.isAppHTTPS=A;b.removeFile=function(a){var b=0;if(q(a)){var e=a.indexOf("//");-1!==e&&(b=e+2)}e=a.lastIndexOf("/");return e<b?a:a.slice(0,e+1)};b.removeTrailingSlash=function(a){return a.replace(/\/+$/,
"")};b.changeDomain=function(a,b,e){if(!(b&&e&&a&&q(a)))return a;var c=a.indexOf("//"),f=a.indexOf("/",c+2),g=a.indexOf(":",c+2),f=Math.min(0>f?a.length:f,0>g?a.length:g);if(a.slice(c+2,f).toLowerCase()!==b.toLowerCase())return a;b=a.slice(0,c+2);a=a.slice(f);return""+b+e+a};b.isSVG=function(a){return ia.test(a)};b.removeQueryParameters=function(a,b){a=l(a);var c=Object.keys(a.query||{});0<c.length&&b&&b.warn("removeQueryParameters()","Url query parameters are not supported, the following parameters have been removed: "+
c.join(", ")+".");return a.path};b.addQueryParameter=function(a,b,e){a=l(a);var c=a.query||{};c[b]=String(e);return a.path+"?"+r(c)};b.addQueryParameters=function(a,b){a=l(a);var c=a.query||{},d;for(d in b)c[d]=b[d];return(b=r(c))?a.path+"?"+b:a.path};b.removeQueryParameter=function(a,b){var c=l(a),d=c.path,c=c.query;if(!c)return a;delete c[b];return(a=r(c))?d+"?"+a:d};b.getPathExtension=function(a){return n.isNone(a)?null:(a=a.match(ja))?a[1]:null};var ja=/.*?\.([^\/]*)$/,ia=/(^data:image\/svg|\.svg$)/i});