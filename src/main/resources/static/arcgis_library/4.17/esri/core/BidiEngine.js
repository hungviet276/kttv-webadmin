// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","./bidiEngineTables"],function(F,G,d){function x(b,a,e,d,c){var g=b;void 0===a&&(a=c.defInFormat);void 0===e&&(e=c.defOutFormat);void 0===d&&(d=c.defSwap);if(a!==e){var f=a.substring(0,1),h=e.substring(0,1),l;l=a.substring(1,4);var k=e.substring(1,4);"C"===l.charAt(0)&&(l=A(g),l="ltr"===l||"rtl"===l?l.toUpperCase():"L"===a.charAt(2)?"LTR":"RTL",a=f+l);"C"===k.charAt(0)&&(l=A(g),"rtl"===l?k="RTL":"ltr"===l?(g=g.split(""),g.reverse(),l=A(g.join("")),k=l.toUpperCase()):k=
"L"===e.charAt(2)?"LTR":"RTL",e=h+k)}if(a===e)return b;h=a.substring(0,1);g=a.substring(1,4);f=e.substring(0,1);k=e.substring(1,4);c.inFormat=a;c.outFormat=e;c.swap=d;if("L"===h&&"VLTR"===e){if("LTR"===g)return c.dir=w,t(b,c);if("RTL"===g)return c.dir=y,t(b,c)}if("V"===h&&"V"===f)return c.dir="RTL"===g?y:w,D(b,c);if("L"===h&&"VRTL"===e)return c.dir="LTR"===g?w:y,b=t(b,c),D(b);if("VLTR"===a&&"LLTR"===e)return c.dir=w,t(b,c);if("V"===h&&"L"===f&&g!==k)return b=D(b),"RTL"===g?x(b,"LLTR","VLTR",d,c):
x(b,"LRTL","VRTL",d,c);if("VRTL"===a&&"LRTL"===e)return x(b,"LRTL","VRTL",d,c);"L"===h&&"L"===f&&(a=c.swap,c.swap=a.substr(0,1)+"N","RTL"===g?(c.dir=y,b=t(b,c),c.swap="N"+a.substr(1,2),c.dir=w,b=t(b,c)):(c.dir=w,b=t(b,c),c.swap="N"+a.substr(1,2),b=x(b,"VLTR","LRTL",c.swap,c)));return b}function A(b){return(b=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(b))?"z">=b[0]?"ltr":"rtl":""}function t(b,a){b=b.split("");var e=[];H(b,e,a);if(0!==a.hiLevel&&a.swap.substr(0,
1)!==a.swap.substr(1,2))for(var h=0;h<b.length;h++)if(1===e[h]){var c=h,g;b:{g=b[h];for(var f=void 0,u=0,l=d.SwapTable.length-1;u<=l;)if(f=Math.floor((u+l)/2),g<d.SwapTable[f][0])l=f-1;else if(g>d.SwapTable[f][0])u=f+1;else{g=d.SwapTable[f][1];break b}}b[c]=g}I(2,b,e,a);I(1,b,e,a);B=e;return b.join("")}function H(b,a,e){var h=b.length,c=e.dir?d.impTabRtl:d.impTabLtr,g=0,f=-1,u=[],l=[];e.hiLevel=e.dir;e.lastArabic=!1;e.hasUbatAl=!1;e.hasUbatB=!1;e.hasUbatS=!1;for(var k=0;k<h;k++){var n=k,m=b[k].charCodeAt(0),
p=d.PrimaryTable[m>>8];u[n]=p<d.TBBASE?p:d.UnicodeTable[p-d.TBBASE][m&255]}for(n=0;n<h;n++){k=P(b,u,l,n,e);l[n]=k;g=c[g][k];k=g&240;g&=15;m=c[g][Q];a[n]=m;if(0<k){if(16===k)for(k=f;k<n;k++)a[k]=1;f=-1}if(c[g][R])-1===f&&(f=n);else if(-1<f){for(k=f;k<n;k++)a[k]=m;f=-1}u[n]===d.UBAT_B&&(a[n]=0);e.hiLevel|=m}if(e.hasUbatS)for(b=0;b<h;b++)if(u[b]===d.UBAT_S)for(a[b]=e.dir,c=b-1;0<=c;c--)if(u[c]===d.UBAT_WS)a[c]=e.dir;else break}function D(b,a){b=b.split("");if(a){var e=[];H(b,e,a);B=e}b.reverse();q.reverse();
return b.join("")}function J(b){for(var a=0;a<d.ArabicAlefBetIntervalsBegine.length;a++)if(b>=d.ArabicAlefBetIntervalsBegine[a]&&b<=d.ArabicAlefBetIntervalsEnd[a])return!0;return!1}function K(b,a,e,d){for(;a*e<d&&z(b[a]);)a+=e;return a*e<d&&J(b[a])?!0:!1}function I(b,a,e,d){if(!(d.hiLevel<b))if(1!==b||d.dir!==y||d.hasUbatB){d=a.length;for(var c=0,g,f,h;c<d;){if(e[c]>=b){for(g=c+1;g<d&&e[g]>=b;)g++;for(f=g-1;c<f;c++,f--)h=a[c],a[c]=a[f],a[f]=h,h=q[c],q[c]=q[f],q[f]=h;c=g}c++}}else a.reverse(),q.reverse()}
function P(b,a,e,h,c){return{UBAT_L:function(){c.lastArabic=!1;return d.UBAT_L},UBAT_R:function(){c.lastArabic=!1;return d.UBAT_R},UBAT_ON:function(){return d.UBAT_ON},UBAT_AN:function(){return d.UBAT_AN},UBAT_EN:function(){return c.lastArabic?d.UBAT_AN:d.UBAT_EN},UBAT_AL:function(){c.lastArabic=!0;c.hasUbatAl=!0;return d.UBAT_R},UBAT_WS:function(){return d.UBAT_ON},UBAT_CS:function(){var b,f;if(1>h||h+1>=a.length||(b=e[h-1])!==d.UBAT_EN&&b!==d.UBAT_AN||(f=a[h+1])!==d.UBAT_EN&&f!==d.UBAT_AN)return d.UBAT_ON;
c.lastArabic&&(f=d.UBAT_AN);return f===b?f:d.UBAT_ON},UBAT_ES:function(){return(0<h?e[h-1]:d.UBAT_B)===d.UBAT_EN&&h+1<a.length&&a[h+1]===d.UBAT_EN?d.UBAT_EN:d.UBAT_ON},UBAT_ET:function(){if(0<h&&e[h-1]===d.UBAT_EN)return d.UBAT_EN;if(c.lastArabic)return d.UBAT_ON;for(var b=h+1,f=a.length;b<f&&a[b]===d.UBAT_ET;)b++;return b<f&&a[b]===d.UBAT_EN?d.UBAT_EN:d.UBAT_ON},UBAT_NSM:function(){if("VLTR"===c.inFormat){for(var g=a.length,f=h+1;f<g&&a[f]===d.UBAT_NSM;)f++;if(f<g&&(g=b[h].charCodeAt[0],f=a[f],(1425<=
g&&2303>=g||64286===g)&&(f===d.UBAT_R||f===d.UBAT_AL)))return d.UBAT_R}return 1>h||a[h-1]===d.UBAT_B?d.UBAT_ON:e[h-1]},UBAT_B:function(){c.lastArabic=!0;c.hasUbatB=!0;return c.dir},UBAT_S:function(){c.hasUbatS=!0;return d.UBAT_ON},UBAT_LRE:function(){c.lastArabic=!1;return d.UBAT_ON},UBAT_RLE:function(){c.lastArabic=!1;return d.UBAT_ON},UBAT_LRO:function(){c.lastArabic=!1;return d.UBAT_ON},UBAT_RLO:function(){c.lastArabic=!1;return d.UBAT_ON},UBAT_PDF:function(){c.lastArabic=!1;return d.UBAT_ON},
UBAT_BN:function(){return d.UBAT_ON}}[d.TYPES_NAMES[a[h]]]()}function E(b,a){for(var e=0;e<d.BaseForm.length;e++)if(b===d.BaseForm[e])return a[e];return b}function z(b){return"\u064b"<=b&&"\u0655">=b?!0:!1}function L(b){return"L"===b?"LTR":"R"===b?"RTL":"C"===b?"CLR":"D"===b?"CRL":""}function M(b,a){for(var e=0;e<d.AlefTable.length;e++)if(b===d.AlefTable[e])return a[e];return b}function N(b,a,d,h){for(var c=0;c<b.length;c++)if(b[c]>a||!d&&b[c]===a)b[c]+=h}Object.defineProperty(G,"__esModule",{value:!0});
F=function(){function b(){this.inputFormat="ILYNN";this.outputFormat="VLNNN";this.sourceToTarget=[];this.targetToSource=[];this.levels=[]}b.prototype.bidiTransform=function(a,b,h){this.sourceToTarget=[];this.targetToSource=[];if(!a)return"";var c=this.sourceToTarget,g=this.targetToSource,f=a.length;q=[];B=[];for(var e=0;e<f;e++)c[e]=e,g[e]=e,q[e]=e;if(!this.checkParameters(b,h))return a;b=this.inputFormat;h=this.outputFormat;var c=a,c=S,e=L(b.charAt(1)),g=L(h.charAt(1)),l="I"===b.charAt(0)?"L":b.charAt(0),
f="I"===h.charAt(0)?"L":h.charAt(0),e=l+e,g=f+g,f=b.charAt(2)+h.charAt(2);c.defInFormat=e;c.defOutFormat=g;c.defSwap=f;a=x(a,e,g,f,c);c=!1;if("R"===h.charAt(1))c=!0;else if("C"===h.charAt(1)||"D"===h.charAt(1))c="rtl"===this.checkContextual(a);g=this.sourceToTarget=q;f=Array(g.length);for(e=0;e<g.length;e++)f[g[e]]=e;C=this.targetToSource=f;if(b.charAt(3)===h.charAt(3))c=a;else if("S"===h.charAt(3))if(b=c,h=!0,0===a.length)c="";else{void 0===b&&(b=!0);void 0===h&&(h=!0);a=String(a);a=a.split("");
var k=0,g=1,c=a.length;b||(k=a.length-1,g=-1,c=1);for(var f=c,e=h,n=0,c=[],l=0;k*g<f;k+=g)if(J(a[k])||z(a[k])){var m;if(m="\u0644"===a[k])b:{for(var p=a,r=k+g,v=g,t=f;r*v<t&&z(p[r]);)r+=v;m=" ";if(r*v<t)for(m=p[r],p=0;p<d.AlefTable.length;p++)if(d.AlefTable[p]===m){m=!0;break b}m=!1}if(m){a[k]=0===n?M(a[k+g],d.LamAlefInialTableFE):M(a[k+g],d.LamAlefMedialTableFE);k+=g;n=a;m=k;p=g;for(r=f;m*p<r&&z(n[m]);)m+=p;m*p<r&&(n[m]=" ");e&&(c[l]=k,l++);n=0}else{m=a[k];if(1===n){p=k;if(K(a,k+g,g,f))b:for(r=a[k],
v=0;v<d.BaseForm.length;v++){if(r===d.BaseForm[v]){r=d.MedialForm[v];break b}}else r=E(a[k],d.FinalForm);a[p]=r}else!0===K(a,k+g,g,f)?a[k]=E(a[k],d.InitialForm):a[k]=E(a[k],d.IsolatedForm);z(m)||(n=1);b:{for(p=0;p<d.StandAlonForm.length;p++)if(d.StandAlonForm[p]===m){m=!0;break b}m=!1}!0===m&&(n=0)}}else n=0;g="";for(f=0;f<a.length;f++){if(e=h){b:{for(e=0;e<c.length;e++)if(c[e]===f)break b;e=-1}e=-1<e}e?(N(C,f,!b,-1),q.splice(f,1)):g+=a[f]}c=g}else if(b=a,h=c,a=!0,0===b.length)c="";else for(void 0===
a&&(a=!0),void 0===h&&(h=!0),b=String(b),c="",g=b.split(""),f=0;f<b.length;f++)e=!1,"\ufe70"<=g[f]&&"\ufeff">g[f]?(l=b.charCodeAt(f),"\ufef5"<=g[f]&&"\ufefc">=g[f]?(h?(0<f&&a&&" "===g[f-1]?c=c.substring(0,c.length-1)+"\u0644":(c+="\u0644",e=!0),c+=d.AlefTable[(l-65269)/2]):(c+=d.AlefTable[(l-65269)/2],c+="\u0644",f+1<b.length&&a&&" "===g[f+1]?f++:e=!0),e&&(N(C,f,!0,1),q.splice(f,0,q[f]))):c+=d.FETo06Table[l-65136]):c+=g[f];this.sourceToTarget=q;this.targetToSource=C;this.levels=B;return c};b.prototype._inputFormatSetter=
function(a){if(!O.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=a};b.prototype._outputFormatSetter=function(a){if(!O.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=a};b.prototype.checkParameters=function(a,b){a?this._inputFormatSetter(a):a=this.inputFormat;b?this._outputFormatSetter(b):b=this.outputFormat;return a===b?!1:!0};b.prototype.checkContextual=function(a){a=A(a);if("ltr"!==a&&"rtl"!==a){try{a=
document.dir.toLowerCase()}catch(e){}"ltr"!==a&&"rtl"!==a&&(a="ltr")}return a};b.prototype.hasBidiChar=function(a){return T.test(a)};return b}();G.default=F;var q=[],C=[],B=[],S={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},Q=5,R=6,w=0,y=1,O=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,T=/[\u0591-\u06ff\ufb1d-\ufefc]/});