// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","tslib","../../support/adapters/support/utils","../../../support/arcadeOnDemand"],function(M,N,F,u,L){function G(b,e,c){void 0===e&&(e=!0);void 0===c&&(c=!0);return u.isValidNumber(b)&&(e||0!==b)&&(c||0<=b)}return function(b){return F.__awaiter(this,void 0,void 0,function(){var e,c,v,w,f,n,x,h,k,d,y,a,p,u,H,q,z,r,A,I,B,C,t,J,D,E,l,K,g;return F.__generator(this,function(m){switch(m.label){case 0:e=b.features,c=b.attributes,v=b.includeZeros,w=b.includeNegatives,f=b.view,
x=n=0,h=Infinity,k=-Infinity,d=null,y=new Map,a=0,m.label=1;case 1:return a<c.length?(p=c[a].valueExpression)?d?[3,3]:[4,L.loadArcade()]:[3,4]:[3,5];case 2:d=u=m.sent().arcadeUtils,m.label=3;case 3:y.set(a,d.createFunction(p)),m.label=4;case 4:return a++,[3,1];case 5:H=f&&d&&d.getViewInfo({viewingMode:"2d"===f.type?"map":f.viewingMode,scale:f.scale,spatialReference:f.spatialReference});q=0;for(z=e;q<z.length;q++)if(r=z[q],A=r.geometry,I=r.attributes,A&&(B=A.extent))if(C=B.width*B.height,0<C){t=0;
J=d&&d.createExecContext(r,H);for(a=0;a<c.length;a++)D=c[a],E=D.field,p=D.valueExpression,l=null,E?l=I[E]:p&&(K=y.get(a),l=d.executeFunction(K,J)),G(l,v,w)&&(t+=l||0);G(t,v,w)&&(g=t/C,++n,x+=g,g<h&&(h=g),g>k&&(k=g))}return[2,{minDensity:Infinity!==h?h:null,maxDensity:-Infinity!==k?k:null,avgDensity:n?x/n:null}]}})})}});