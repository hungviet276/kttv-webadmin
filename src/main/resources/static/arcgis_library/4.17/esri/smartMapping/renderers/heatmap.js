// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../Color ../../renderers ../../core/Error ../../core/maybe ../../renderers/support/HeatmapColorStop ./support/utils ../statistics/heatmapStatistics ../support/utils ../support/adapters/support/layerUtils ../symbology/heatmap".split(" "),function(M,n,g,E,G,q,p,w,y,H,I,r,z){function J(b){return g.__awaiter(this,void 0,void 0,function(){var a,d,e,f,c,h,k,t,u,v;return g.__generator(this,function(l){switch(l.label){case 0:if(!(b&&b.layer&&b.view))throw new q("heatmap-renderer:missing-parameters",
"'layer' and 'view' parameters are required");a=b.blurRadius;d=b.minRatio;e=b.maxRatio;f=b.fadeToTransparent;c=g.__assign({},b);c.blurRadius=null==a?10:a;c.minRatio=null==d?.01:d;c.maxRatio=null==e?1:e;c.fadeToTransparent=null==f?!0:f;h=[0,2,1];k=r.createLayerAdapter(c.layer,h);c.layer=k;if(!k)throw new q("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(h).join(", "));t=p.isSome(c.signal)?{signal:c.signal}:null;return[4,k.load(t)];case 1:return l.sent(),
[4,I.getFieldsList({field:c.field})];case 2:u=l.sent();if(v=y.verifyBasicFieldValidity(k,u,"heatmap-renderer:invalid-parameters"))throw v;return[2,c]}})})}function K(b){return g.__awaiter(this,void 0,void 0,function(){var a,d,e,f,c;return g.__generator(this,function(h){switch(h.label){case 0:return a=b.scheme,e=d=null,[4,y.getBasemapInfo(b.basemap,b.view)];case 1:f=h.sent();d=p.isSome(f.basemapId)?f.basemapId:null;e=p.isSome(f.basemapTheme)?f.basemapTheme:null;if(a)return[2,{scheme:z.cloneScheme(a),
basemapId:d,basemapTheme:e}];if(c=z.getSchemes({basemap:d,basemapTheme:e}))a=c.primaryScheme,d=c.basemapId,e=c.basemapTheme;return[2,{scheme:a,basemapId:d,basemapTheme:e}]}})})}function L(b,a){return g.__awaiter(this,void 0,void 0,function(){var d,e,f,c,h,k,t,u,v,l,n,p,q,x,A,r,B,F,m,C,D;return g.__generator(this,function(g){switch(g.label){case 0:return d=b.fieldOffset,e=a.field,f=a.basemap,c=a.blurRadius,h=a.minRatio,k=a.maxRatio,t=a.fadeToTransparent,u=a.heatmapScheme,v=a.view,[4,K({basemap:f,scheme:u,
view:v})];case 1:return l=g.sent(),n=l.scheme,p=l.basemapId,q=l.basemapTheme,x=n.colors,A=x.length,B=(r=!b.count)?[0,100]:[b.min,b.max],F=(k-h)/(A-1),m=x[0],C=[new w({ratio:0,color:new E([m.r,m.g,m.b,0])}),new w({ratio:.01,color:new E([m.r,m.g,m.b,0])}),new w({ratio:t?h:.01,color:m})],y.createColors(x,A).forEach(function(a,b){C.push(new w({ratio:h+F*b,color:a}))}),D=new G.HeatmapRenderer({blurRadius:c,colorStops:C,field:e,minPixelIntensity:B[0],maxPixelIntensity:B[1]}),null!=d&&(D.fieldOffset=d),
[2,{renderer:D,statistics:b,defaultValuesUsed:r,scheme:z.cloneScheme(n),basemapId:p,basemapTheme:q}]}})})}Object.defineProperty(n,"__esModule",{value:!0});n.createRenderer=void 0;n.createRenderer=function(b){return g.__awaiter(this,void 0,void 0,function(){var a,d,e;return g.__generator(this,function(f){switch(f.label){case 0:return[4,J(b)];case 1:a=f.sent();if(!a.statistics)return[3,2];e=a.statistics;return[3,4];case 2:return[4,H({layer:a.layer,field:a.field,fieldOffset:a.fieldOffset,blurRadius:a.blurRadius,
view:a.view,signal:a.signal})];case 3:e=f.sent(),f.label=4;case 4:return d=e,[2,L(d,a)]}})})}});