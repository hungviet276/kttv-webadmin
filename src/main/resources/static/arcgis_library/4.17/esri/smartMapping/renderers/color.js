// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../pointCloudRenderers ../../renderers ../../core/Error ../../core/maybe ../../core/promiseUtils ../../intl/messages ../../intl/substitute ../../renderers/support/AuthoringInfo ../../renderers/support/AuthoringInfoVisualVariable ../../renderers/support/numberUtils ../../renderers/support/utils ../../renderers/visualVariables/ColorVariable ../heuristics/ageUnit ../heuristics/outline ../heuristics/sizeRange ./support/utils ../statistics/support/ageUtils ../support/utils ../support/adapters/support/layerUtils ../symbology/color".split(" "),
function(ja,q,f,C,D,n,u,v,I,T,E,U,V,F,W,X,M,N,h,H,y,r,x){function Y(b){return f.__awaiter(this,void 0,void 0,function(){var a,c,d,g,e,k,l;return f.__generator(this,function(p){switch(p.label){case 0:if(!(b&&b.layer&&(b.field||b.valueExpression||b.sqlExpression)))throw new n("color-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(b.valueExpression&&!b.sqlExpression&&!b.view)throw new n("color-visual-variable:missing-parameters",
"View is required when 'valueExpression' is specified");a=f.__assign({},b);c=[0,2,1,3];d=r.createLayerAdapter(a.layer,c);a.layer=d;if(!d)throw new n("color-visual-variable:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(c).join(", "));g=u.isSome(a.signal)?{signal:a.signal}:null;return[4,d.load(g)];case 1:return p.sent(),e=d.geometryType,"mesh"===e||!a.worldScale||a.view&&"3d"===a.view.type?[4,y.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression})]:
[2,v.reject(h.createError("color-visual-variable:invalid-parameters","'view' parameter should be an instance of SceneView when 'worldScale' parameter is true"))];case 2:k=p.sent();if(l=h.verifyBasicFieldValidity(d,k,"color-visual-variable:invalid-parameters"))throw l;return[2,a]}})})}function Z(b){return f.__awaiter(this,void 0,void 0,function(){var a,c,d,g,e,k,l;return f.__generator(this,function(p){switch(p.label){case 0:if(!(b&&b.layer&&(b.field||b.valueExpression||b.sqlExpression)))throw new n("color-continuous-renderer:missing-parameters",
"'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(b.valueExpression&&!b.sqlExpression&&!b.view)throw new n("color-continuous-renderer:missing-parameters","View is required when 'valueExpression' is specified");a=f.__assign({},b);a.symbolType=a.symbolType||"2d";a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled;c=[0,2,1,3];d=r.createLayerAdapter(a.layer,c);a.layer=d;if(!d)throw new n("color-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+
r.getLayerTypeLabels(c).join(", "));g=u.isSome(a.signal)?{signal:a.signal}:null;return[4,d.load(g)];case 1:p.sent();e=d.geometryType;a.outlineOptimizationEnabled="polygon"===e?a.outlineOptimizationEnabled:!1;a.sizeOptimizationEnabled="point"===e||"multipoint"===e||"polyline"===e?a.sizeOptimizationEnabled:!1;if("mesh"===e)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||"replace",a.edgesType=a.edgesType||"none";else{if("3d-volumetric-uniform"===a.symbolType&&"point"!==e)throw new n("color-continuous-renderer:not-supported",
"3d-volumetric-uniform symbols are supported for point layers only");if(-1<a.symbolType.indexOf("3d-volumetric")&&(!a.view||"3d"!==a.view.type))throw new n("color-continuous-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");}return[4,y.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression})];case 2:k=p.sent();if(l=h.verifyBasicFieldValidity(d,
k,"color-continuous-renderer:invalid-parameters"))throw l;return[2,a]}})})}function aa(b){return f.__awaiter(this,void 0,void 0,function(){var a,c,d,g,e,k,l,p;return f.__generator(this,function(m){switch(m.label){case 0:if(!b||!b.layer||!b.field&&!b.valueExpression)throw new n("color-class-breaks-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(b.valueExpression&&!b.view)throw new n("color-class-breaks-renderer:missing-parameters","View is required when 'valueExpression' is specified");
a=f.__assign({},b);a.symbolType=a.symbolType||"2d";a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled;a.classificationMethod=a.classificationMethod||"equal-interval";a.normalizationType=y.getNormalizationType(a);c=[0,2,1,3];d=r.createLayerAdapter(a.layer,c);a.layer=d;if(!d)throw new n("color-class-breaks-renderer:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(c).join(", "));g=null!=a.minValue&&null!=a.maxValue;if(!g&&(null!=a.minValue||null!=
a.maxValue))throw new n("color-class-breaks-renderer:missing-parameters","Both 'minValue' and 'maxValue' are required when specifying custom data range");e=u.isSome(a.signal)?{signal:a.signal}:null;return[4,d.load(e)];case 1:m.sent();k=d.geometryType;a.outlineOptimizationEnabled="polygon"===k?a.outlineOptimizationEnabled:!1;if("mesh"===k)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||"replace",a.edgesType=a.edgesType||"none";else{if("3d-volumetric-uniform"===a.symbolType&&"point"!==k)throw new n("color-continuous-renderer:not-supported",
"3d-volumetric-uniform symbols are supported for point layers only");if(-1<a.symbolType.indexOf("3d-volumetric")&&(!a.view||"3d"!==a.view.type))throw new n("color-class-breaks-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");}return[4,y.getFieldsList({field:a.field,normalizationField:a.normalizationField})];case 2:l=m.sent();if(p=h.verifyBasicFieldValidity(d,l,"color-class-breaks-renderer:invalid-parameters"))throw p;
return[2,a]}})})}function ba(b){b=f.__assign({},b);delete b.basemap;delete b.colorScheme;delete b.legendOptions;delete b.symbolType;delete b.defaultSymbolEnabled;delete b.colorMixMode;delete b.edgesType;b.analyzeData=!(null!=b.minValue&&null!=b.maxValue);return b}function ca(b){if(!b||!b.layer)return v.reject(h.createError("color-point-cloud-true-color-renderer:missing-parameters","'layer' parameter is required"));var a=f.__assign({},b),c=[4];b=r.createLayerAdapter(a.layer,c);a.layer=b;a.density=
a.density||25;a.size=a.size||"100%";if(!h.isValidPointSize(a.size))return v.reject(h.createError("color-point-cloud-true-color-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'"));if(!b)return v.reject(h.createError("color-point-cloud-true-color-renderer:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(c).join(", ")));c=u.isSome(a.signal)?{signal:a.signal}:null;return b.load(c).then(function(){return a})}function da(b){if(!(b&&
b.layer&&b.field))return v.reject(h.createError("color-point-cloud-continuous-renderer:missing-parameters","'layer' and 'field' parameters are required"));var a=b.field.toLowerCase();if("intensity"!==a&&"elevation"!==a)return v.reject(h.createError("color-point-cloud-continuous-renderer:invalid-parameters","'field' should be either 'intensity' or 'elevation'"));var c=f.__assign({},b),a=[4];b=r.createLayerAdapter(c.layer,a);c.layer=b;c.density=c.density||25;c.size=c.size||"100%";if(!h.isValidPointSize(c.size))return v.reject(h.createError("color-point-cloud-continuous-renderer:invalid-parameters",
"Invalid 'size' parameter. It should be a string of the form '100%'"));if(!b)return v.reject(h.createError("color-point-cloud-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(a).join(", ")));a=u.isSome(c.signal)?{signal:c.signal}:null;return b.load(a).then(function(){return c})}function O(b){b=f.__assign({},b);var a=-1<b.symbolType.indexOf("3d-volumetric");delete b.symbolType;delete b.defaultSymbolEnabled;delete b.colorMixMode;delete b.edgesType;
b.worldScale=a;return b}function ea(b){return f.__awaiter(this,void 0,void 0,function(){var a,c,d,g,e,k;return f.__generator(this,function(h){switch(h.label){case 0:if(!(b&&b.layer&&b.view&&b.startTime&&b.endTime))throw new n("color-age-renderer:missing-parameters","'layer', 'view', startTime', 'endTime' parameters are required");a=f.__assign({},b);a.symbolType=a.symbolType||"2d";a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled;c=[0,2,1,3];d=r.createLayerAdapter(a.layer,
c);a.layer=d;if(!d)throw new n("color-age-renderer:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(c).join(", "));g=u.isSome(a.signal)?{signal:a.signal}:null;return[4,d.load(g)];case 1:h.sent();e=d.geometryType;a.outlineOptimizationEnabled="polygon"===e?a.outlineOptimizationEnabled:!1;a.sizeOptimizationEnabled="point"===e||"multipoint"===e||"polyline"===e?a.sizeOptimizationEnabled:!1;if("mesh"===e)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||"replace",
a.edgesType=a.edgesType||"none";else if("3d-volumetric-uniform"===a.symbolType&&"point"!==e)throw new n("color-continuous-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(-1<a.symbolType.indexOf("3d-volumetric")&&(!a.view||"3d"!==a.view.type))throw new n("color-age-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");if(k=H.verifyDates(d,a.startTime,
a.endTime,"color-age-renderer:invalid-parameters"))throw k;if(a.unit&&-1===H.supportedAgeUnits.indexOf(a.unit))throw new n("color-age-renderer:invalid-unit","Supported units are: "+H.supportedAgeUnits.join(", "));return[2,a]}})})}function B(b,a){return f.__awaiter(this,void 0,void 0,function(){var c,d,g,e,k,l,p;return f.__generator(this,function(f){switch(f.label){case 0:return c=b.colorScheme,g=d=null,[4,h.getBasemapInfo(b.basemap,b.view)];case 1:e=f.sent();d=u.isSome(e.basemapId)?e.basemapId:null;
g=u.isSome(e.basemapTheme)?e.basemapTheme:null;if(c)return[2,{scheme:x.cloneScheme(c),basemapId:d,basemapTheme:g}];k=a||b.theme||"high-to-low";if(l=x.getSchemes({theme:k,basemap:d,basemapTheme:g,geometryType:b.geometryType,worldScale:b.worldScale,view:b.view}))d=l.basemapId,g=l.basemapTheme,b.schemeId?(p=k+"/"+d+"/"+b.schemeId,c=x.getSchemeById({id:p,geometryType:b.geometryType})):c=l.primaryScheme;return[2,{scheme:c,basemapId:d,basemapTheme:g}]}})})}function G(b,a,c){for(var d=(a-b)/(c-1),g=[b],
e=1;e<=c-2;e++)g.push(b+e*d);g.push(a);return V.round(g,{strictBounds:!0})}function fa(b,a){return f.__awaiter(this,void 0,void 0,function(){var c,d,g,e,k,l,p;return f.__generator(this,function(f){switch(f.label){case 0:return c=a.layer,[4,B({basemap:a.basemap,colorScheme:a.colorScheme,geometryType:c.geometryType,schemeId:"elevation"===a.field.toLowerCase()?"point-cloud-elevation-scheme":"point-cloud-intensity-scheme"})];case 1:d=f.sent();g=d.scheme;if(!g)throw h.createError("color-point-cloud-continuous-renderer:insufficient-info",
"Unable to find color scheme");e=h.createColors(g.colors,5);if(5>e.length)throw h.createError("color-point-cloud-continuous-renderer:insufficient-info","Color scheme does not have enough colors");l=(k=h.getDefaultDataRange(b,!1,!0))?G(k[0],k[1],5):h.createStopValues(b);p=F.createColorStops({values:l,isDate:!1,dateFormatOptions:null,colors:e,labelIndexes:[0,2,4]});return[2,{stops:p,basemapId:d.basemapId,basemapTheme:d.basemapTheme,statistics:b,defaultValuesUsed:!!k,colorScheme:x.cloneScheme(g)}]}})})}
function ga(b,a,c){return f.__awaiter(this,void 0,void 0,function(){var d,g,e,k,l,p,m,n,w,P,t,Q,q,r,v;return f.__generator(this,function(f){switch(f.label){case 0:return d=c.layer,g=c.field,e="function"===typeof g,l=(k=g&&!e?d.getField(g):null)&&"date"===k.type,[4,B({basemap:c.basemap,theme:c.theme,geometryType:d.geometryType,colorScheme:c.colorScheme,worldScale:c.worldScale,view:c.view})];case 1:p=f.sent();m=p.scheme;if(!m)throw h.createError("color-visual-variable:insufficient-info","Unable to find color scheme");
n=h.createColors(m.colors,5);if(5>n.length)throw h.createError("color-visual-variable:insufficient-info","Color scheme does not have enough colors");w=h.getDefaultDataRange(b,l,!0);P=-1<m.id.indexOf("seq-");t=w?G(w[0],w[1],5):h.createStopValues(b,P);Q=h.createColors(n,5);q=new W({field:g,valueExpression:c.valueExpression,valueExpressionTitle:c.valueExpressionTitle,normalizationField:a,stops:t.map(function(a,b){return{value:a,color:Q[b]}}),legendOptions:c.legendOptions});r=new U({type:"color",minSliderValue:null!=
c.minValue?c.minValue:b.min,maxSliderValue:null!=c.maxValue?c.maxValue:b.max,theme:m.theme});v=new E({visualVariables:[r]});return[2,{basemapId:p.basemapId,basemapTheme:p.basemapTheme,visualVariable:q,statistics:b,defaultValuesUsed:!!w,colorScheme:x.cloneScheme(m),authoringInfo:v}]}})})}function R(b,a,c,d,g,e){return f.__awaiter(this,void 0,void 0,function(){var k,l,p,m,n,w,q,t,r;return f.__generator(this,function(f){switch(f.label){case 0:return[4,I.loadMessageBundle("esri/smartMapping/t9n/smartMapping")];
case 1:return k=f.sent(),l=e.layer,p=e.field,m=l.geometryType,n=e.defaultSymbolEnabled,w=x.cloneScheme(b.colorScheme),q=a&&a.opacity,t=[b.visualVariable.clone()],a&&a.visualVariables&&a.visualVariables.length&&t.push.apply(t,a.visualVariables.map(function(a){return a.clone()})),c&&c.minSize&&t.push(c.minSize),r=new D.ClassBreaksRenderer({classBreakInfos:[{minValue:-S,maxValue:S,symbol:h.createSymbol(m,{type:e.symbolType,color:w.noDataColor,size:h.getSymbolSizeFromScheme(w,m),outline:h.getSymbolOutlineFromScheme(w,
m,q),meshInfo:{colorMixMode:e.colorMixMode,edgesType:e.edgesType}})}],defaultLabel:n?k.other:null,defaultSymbol:n?h.createSymbol(m,{type:e.symbolType,color:w.noDataColor,size:h.getSymbolSizeFromScheme(w,m),outline:h.getSymbolOutlineFromScheme(w,m,q),meshInfo:{colorMixMode:e.colorMixMode,edgesType:e.edgesType}}):null,field:p,normalizationType:d,normalizationField:g,valueExpression:e.valueExpression,valueExpressionTitle:e.valueExpressionTitle,visualVariables:t,authoringInfo:b.authoringInfo&&b.authoringInfo.clone()}),
[2,{renderer:r,visualVariable:b.visualVariable.clone(),statistics:b.statistics,defaultValuesUsed:b.defaultValuesUsed,colorScheme:x.cloneScheme(b.colorScheme),basemapId:b.basemapId,basemapTheme:b.basemapTheme}]}})})}function K(b){return f.__awaiter(this,void 0,void 0,function(){var a,c,d,g,e;return f.__generator(this,function(k){switch(k.label){case 0:return[4,Y(b)];case 1:a=k.sent();d=(c=a.normalizationField)?"field":void 0;if(!a.statistics)return[3,2];e=a.statistics;return[3,4];case 2:return[4,h.getSummaryStatistics({layer:a.layer,
field:a.field,valueExpression:a.valueExpression,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,normalizationType:d,normalizationField:c,minValue:a.minValue,maxValue:a.maxValue,view:a.view,signal:a.signal})];case 3:e=k.sent(),k.label=4;case 4:return g=e,[2,ga(g,c,a)]}})})}function ha(b,a){b=b.colorsForClassBreaks;var c;if(b&&0<b.length&&(b.some(function(b){b.numClasses===a&&(c=b.colors);return!!c}),!c)){var d=b[b.length-1];b=a-d.numClasses;if(0<b){var g=d.colors[d.numClasses-1];c=d.colors.splice(0);
for(d=1;d<=b;d++)c.push(g)}}c&&(c=h.createColors(c,c.length));return c}function ia(b,a){return f.__awaiter(this,void 0,void 0,function(){var c,d,g,e,k,l,p,m,q,w,r,t,v,u,A;return f.__generator(this,function(f){switch(f.label){case 0:return[4,I.loadMessageBundle("esri/smartMapping/t9n/smartMapping")];case 1:return c=f.sent(),d=b.layer,g=b.defaultSymbolEnabled,e=d.geometryType,[4,B({basemap:b.basemap,geometryType:e,colorScheme:b.colorScheme,worldScale:-1<b.symbolType.indexOf("3d-volumetric"),view:b.view})];
case 2:k=f.sent();l=k.scheme;p=a.result;m=a.outlineResult;q=p.classBreakInfos;w=b.classificationMethod;r="standard-deviation"===w;t=b.normalizationType;if(!l)throw new n("color-class-breaks-renderer:insufficient-info","Unable to find color scheme");v=ha(l,q.length);if(!v||v.length!==q.length)throw new n("color-class-breaks-renderer:insufficient-info","Color scheme does not have enough colors");u=m&&m.opacity;A=new D.ClassBreaksRenderer({classBreakInfos:q.map(function(a,c){return{minValue:a.minValue,
maxValue:a.maxValue,symbol:h.createSymbol(e,{type:b.symbolType,color:v[c],size:h.getSymbolSizeFromScheme(l,e),outline:h.getSymbolOutlineFromScheme(l,e,u),meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}}),label:a.label}}),defaultLabel:g?c.other:null,defaultSymbol:g?h.createSymbol(e,{type:b.symbolType,color:l.noDataColor,size:h.getSymbolSizeFromScheme(l,e),outline:h.getSymbolOutlineFromScheme(l,e,u),meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}}):null,field:b.field,valueExpression:b.valueExpression,
valueExpressionTitle:b.valueExpressionTitle,normalizationType:t,normalizationField:b.normalizationField,normalizationTotal:"percent-of-total"===t?p.normalizationTotal:void 0,legendOptions:b.legendOptions,authoringInfo:new E({type:"class-breaks-color",classificationMethod:w,standardDeviationInterval:b.standardDeviationInterval})});r||F.setLabelsForClassBreaks({classBreakInfos:A.classBreakInfos,classificationMethod:w,normalizationType:t,round:!0});m&&m.visualVariables&&m.visualVariables.length&&(A.visualVariables=
m.visualVariables.map(function(a){return a.clone()}));return[2,{renderer:A,colorScheme:x.cloneScheme(l),classBreaksResult:p,defaultValuesUsed:a.defaultValuesUsed,basemapId:k.basemapId,basemapTheme:k.basemapTheme}]}})})}Object.defineProperty(q,"__esModule",{value:!0});q.createAgeRenderer=q.createPCContinuousRenderer=q.createPCTrueColorRenderer=q.createClassBreaksRenderer=q.createContinuousRenderer=q.createVisualVariable=void 0;var S=Math.pow(2,53)-1;q.createVisualVariable=K;q.createContinuousRenderer=
function(b){return f.__awaiter(this,void 0,void 0,function(){var a,c,d,g,e,k,h,p,m,n;return f.__generator(this,function(f){switch(f.label){case 0:return[4,Z(b)];case 1:return a=f.sent(),c=a.layer,d=a.view,g=a.signal,[4,v.all([K(O(a)),a.outlineOptimizationEnabled?M({layer:c,view:d,signal:g}):null,a.sizeOptimizationEnabled?N({layer:c,view:d,signal:g}):null])];case 2:return e=f.sent(),k=e[0],h=e[1],p=e[2],n=(m=a.normalizationField)?"field":void 0,[2,R(k,h,p,n,m,a)]}})})};q.createClassBreaksRenderer=
function(b){return f.__awaiter(this,void 0,void 0,function(){var a,c;return f.__generator(this,function(d){switch(d.label){case 0:return[4,aa(b)];case 1:return a=d.sent(),[4,h.getClassBreaks(ba(a),a.outlineOptimizationEnabled)];case 2:return c=d.sent(),[2,ia(a,c)]}})})};q.createPCTrueColorRenderer=function(b){return ca(b).then(function(a){return{renderer:new C.PointCloudRGBRenderer({field:"RGB",pointsPerInch:a.density,pointSizeAlgorithm:h.getPointSizeAlgorithm(a.size)})}})};q.createPCContinuousRenderer=
function(b){return f.__awaiter(this,void 0,void 0,function(){var a,c,d,g,e;return f.__generator(this,function(f){switch(f.label){case 0:return[4,da(b)];case 1:a=f.sent();if(!a.statistics)return[3,2];d=a.statistics;return[3,4];case 2:return[4,h.getSummaryStatistics({layer:a.layer,field:a.field,signal:a.signal})];case 3:d=f.sent(),f.label=4;case 4:return c=d,[4,fa(c,a)];case 5:return g=f.sent(),e=new C.PointCloudStretchRenderer({field:a.field,pointsPerInch:a.density,pointSizeAlgorithm:h.getPointSizeAlgorithm(a.size),
stops:g.stops}),[2,{renderer:e,basemapId:g.basemapId,basemapTheme:g.basemapTheme,statistics:g.statistics,defaultValuesUsed:g.defaultValuesUsed,colorScheme:g.colorScheme}]}})})};q.createAgeRenderer=function(b){return f.__awaiter(this,void 0,void 0,function(){var a,c,d,g,e,k,l,p,n,q,r,u,t,x,y,A,B,z,C,J,D,E,F,L,G;return f.__generator(this,function(m){switch(m.label){case 0:return[4,I.loadMessageBundle("esri/smartMapping/t9n/smartMapping")];case 1:return a=m.sent(),[4,ea(b)];case 2:return c=m.sent(),
d=c.defaultSymbolEnabled,g=c.view,e=c.startTime,k=c.endTime,l=c.symbolType,p=c.colorMixMode,n=c.edgesType,q=c.minValue,r=c.maxValue,u=c.signal,t=c.layer,[4,v.all([c.unit?{unit:c.unit,statistics:null}:X({view:g,layer:t,startTime:e,endTime:k,minValue:q,maxValue:r,signal:u}),c.outlineOptimizationEnabled?M({layer:t,view:g,signal:u}):null,c.sizeOptimizationEnabled?N({layer:t,view:g,signal:u}):null])];case 3:return x=m.sent(),y=x[0],A=x[1],B=x[2],z=y.unit,C=y.statistics,J=H.getAgeExpressions({layer:t,startTime:e,
endTime:k,unit:z}).valueExpression,D=T.substitute(a["ageInfo_"+z],{unit:z,startTime:h.formatDate(e,z,t),endTime:h.formatDate(k,z,t)}),[4,K(O({layer:t,basemap:c.basemap,valueExpression:J,symbolType:l,statistics:C,legendOptions:{title:D},colorScheme:c.colorScheme,theme:c.theme,view:g,minValue:c.minValue,maxValue:c.maxValue,signal:u}))];case 4:return E=m.sent(),F={layer:t,valueExpression:J,defaultSymbolEnabled:d,symbolType:l,colorMixMode:p,edgesType:n},[4,R(E,A,B,null,null,F)];case 5:return L=m.sent(),
G=L.renderer.authoringInfo.visualVariables,G.forEach(function(a){return h.updateAgeRendererAuthoringInfoVV(a,e,k,z)}),[2,f.__assign(f.__assign({},L),{unit:z})]}})})}});