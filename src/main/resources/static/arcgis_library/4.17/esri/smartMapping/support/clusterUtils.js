// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../core/arrayUtils ../../core/maybe ../../core/MD5 ../../renderers/visualVariables/support/sizeVariableUtils ../popup/support/utils ./utils".split(" "),function(y,b,q,h,r,t,u,v){function k(c,a){var e;if(c){var b=c.field,d=c.valueExpression,g=c.normalizationField,f=c.normalizationType,l=c.normalizationTotal;e=null;d?e=d:b&&(d=v.getNormalizationType({normalizationType:f,normalizationField:g,normalizationTotal:l}))&&(d=d.toLowerCase(),e=b.toLowerCase()+",norm:"+d,g?e+=","+
g.toLowerCase():"percent-of-total"===d&&(b=l,t.isValidNumber(b)&&0!==b||(b=null),e+=","+b))}else e=null;c=h.isSome(e)?r.createMD5Hash(e):c.field;return a+"_"+c}function m(c,a){return(c=a.getField(c))&&c.type}function n(c,a){var b="field"in a&&a.field;c=b?m(b,c):null;return{field:b,fieldType:h.isSome(c)?c:null,valueExpression:"valueExpression"in a?a.valueExpression:null,valueExpressionTitle:"valueExpressionTitle"in a?a.valueExpressionTitle:null,normalizationField:"normalizationField"in a?a.normalizationField:
null,normalizationType:"normalizationType"in a?a.normalizationType:null,normalizationTotal:"normalizationTotal"in a?a.normalizationTotal:null}}function p(c,a){var b="rotation"===a.type?a.rotationType:null,w=a.legendOptions&&a.legendOptions.title,d=a.field;c=d?m(d,c):null;return{field:d,fieldType:h.isSome(c)?c:null,rotationType:b,valueExpression:a.valueExpression,valueExpressionTitle:a.valueExpressionTitle||a.valueExpression&&w,normalizationField:"normalizationField"in a?a.normalizationField:null,
vvType:a.type}}function x(c){return c.map(function(a){var c='{\n        "value": "'+String(a.value)+'",\n        "label": "';a=(a=String(a.label))?a.replace(/"/g,'\\"'):"";return c+a+'"\n      }'})}function f(c,a){var b=[k(c,a)];"date"===c.fieldType&&b.push(c.fieldType.toLowerCase());c.rotationType&&b.push(c.rotationType.toLowerCase());return{statisticHash:b.join("_"),attributeInfo:c,statisticType:a}}Object.defineProperty(b,"__esModule",{value:!0});b.getStatisticInfos=b.getStatisticInfo=b.getPredominantTypeExpression=
b.getVariableAttributeInfo=b.getRendererAttributeInfo=b.getClusterField=b.getStatisticId=b.getClusterFieldHash=b.clusterCountField=void 0;b.clusterCountField="cluster_count";b.getClusterFieldHash=function(c,a){return c.split("cluster_"+a+"_").pop()};b.getStatisticId=k;b.getClusterField=function(c,a){return"cluster_"+k(c,a)};b.getRendererAttributeInfo=n;b.getVariableAttributeInfo=p;b.getPredominantTypeExpression=function(c,a,b){return"\n  var uvInfos \x3d ["+x(c).join(", ")+'];\n  var predominantType \x3d Text($feature["'+
a+'"]);\n  var label \x3d "'+(b?b.replace(/"/g,'\\"'):"")+'";\n\n  for (var i \x3d 0; i \x3c Count(uvInfos); i++) {\n    if (uvInfos[i].value \x3d\x3d predominantType) {\n      label \x3d uvInfos[i].label;\n      break;\n    }\n  }\n\n  return label;\n  '};b.getStatisticInfo=f;b.getStatisticInfos=function(c,a,b){void 0===b&&(b=!0);var e=[],d=n(c,a);"class-breaks"===a.type?e.push(f(d,"avg")):"unique-value"===a.type&&e.push(f(d,"type"));d=0;for(a=u.getPrimaryVisualVariables(a);d<a.length;d++){var g=
p(c,a[d]);e.push(f(g,"avg"))}return b?q.unique(e,function(a,b){return a.statisticHash===b.statisticHash}):e}});