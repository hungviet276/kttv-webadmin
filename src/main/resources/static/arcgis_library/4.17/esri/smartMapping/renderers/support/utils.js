// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../Color ../../../symbols ../../../core/compilerUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../intl/date ../../../renderers/support/numberUtils ../../../renderers/support/pointCloud/PointSizeSplatAlgorithm ../../heuristics/outline ../../statistics/classBreaks ../../statistics/summaryStatistics ../../support/utils ../../../views/support/colorUtils".split(" "),function(K,c,m,y,h,p,z,q,A,r,t,B,C,u,D,l,E){function n(a,b){return new z(a,
b)}function v(a,b,d){var e,f,c;(b=(e={statistics:a,isDate:b},e.statistics))||(b={});var g,k;null==b.min?e.isDate?(k=w(),g=k[0],k=k[1]):(g=0,k=100):b.min===b.max&&(e.isDate?(k=w(b.min),g=k[0],k=k[1]):0>b.min?(g=2*b.min,k=0):0<b.min?(g=0,k=2*b.min):(g=0,k=100));e=null!=g?g:b.min;b=null!=k?k:b.max;null!=g||null!=k?(f=e,c=b):!d||null!=a.avg&&a.stddev||(f=a.min,c=a.max);return null!=f?[f,c]:null}function w(a){var b=("number"===typeof a?new Date(a):new Date).getUTCFullYear(),d=Date.UTC(b,0,1,12,0,0,0),
b=Date.UTC(b,11,31,12,0,0,0);"number"===typeof a&&(a<d&&(d=a),a>b&&(b=a));return[d,b]}function F(a){var b=a.layer;return a.fields.filter(function(a){return!b.getField(a)})}function G(a){var b=a.layer;return a.fields.filter(function(a){a=b.getFieldUsageInfo(a);return!a||!a.supportsRenderer})}Object.defineProperty(c,"__esModule",{value:!0});c.getBasemapInfo=c.updateAgeRendererAuthoringInfoVV=c.getPointSizeAlgorithm=c.isValidPointSize=c.getSizeRangeForAxis=c.getSummaryStatistics=c.getClassBreaks=c.verifyBasicFieldValidity=
c.createSymbol=c.getSymbolOutlineFromScheme=c.getSymbolSizeFromScheme=c.createStopValues=c.createColors=c.getDefaultDataRange=c.createError=c.formatDate=void 0;var x=/^(\d+(\.\d+)?)\s*(%)$/i,H=[0,0,0,.4],I=["hours","minutes","seconds"],J=[].concat(l.defaultBasemapGroups.light).concat(l.defaultBasemapGroups.dark);c.formatDate=function(a,b,d){if("string"===typeof a){if((b=d.getField(a))&&"date"===b.type)return b.alias||b.name}else if("number"===typeof a||a instanceof Date)return b=-1<I.indexOf(b)?"short-date-short-time":
"short-date",r.formatDate(a,r.convertDateFormatToIntlOptions(b));return a};c.createError=n;c.getDefaultDataRange=v;c.createColors=function(a,b){for(var d=[],e=a.length,f=0;f<b;f++)d.push(new y(a[f%e]));return d};c.createStopValues=function(a,b){void 0===b&&(b=!0);var d=a.avg,e=d-a.stddev,f=d+a.stddev;e<a.min&&(e=a.min);f>a.max&&(f=a.max);b&&(d=e+(f-e)/2);a=t.round([e,f],{strictBounds:!0});e=a[0];f=a[1];a=[e,e+(d-e)/2,d,d+(f-d)/2,f];return t.round(a,{strictBounds:!0})};c.getSymbolSizeFromScheme=function(a,
b,d){switch(b){case "point":case "multipoint":return d?"noDataSize"in a?a.noDataSize:null:"size"in a?a.size:null;case "polyline":return d?"noDataWidth"in a?a.noDataWidth:null:"width"in a?a.width:null;case "polygon":return"size"in a?a.size:null;case "mesh":break;default:p.neverReached(b)}};c.getSymbolOutlineFromScheme=function(a,b,d){switch(b){case "point":case "multipoint":case "polygon":if(!("outline"in a))return null;a={color:a.outline.color,width:a.outline.width};null!=d&&a.color&&(b=a.color.clone(),
b.a=d,a.color=b);return a;case "polyline":case "mesh":break;default:p.neverReached(b)}};c.createSymbol=function(a,b){var d=b.type,e=b.size,f=b.color,c=b.outline,g;switch(a){case "point":case "multipoint":"2d"===d?g=new h.SimpleMarkerSymbol({color:f,size:e,outline:{color:c.color,width:c.width}}):"3d-flat"===d?g=new h.PointSymbol3D({symbolLayers:[new h.IconSymbol3DLayer({size:e,resource:{primitive:"circle"},material:{color:f},outline:{color:c.color,size:c.width}})]}):-1<d.indexOf("3d-volumetric")&&
(a="3d-volumetric-uniform"===d,f=new h.ObjectSymbol3DLayer({height:e,resource:{primitive:a?"sphere":"cylinder"},material:{color:f}}),a||(f.width=b.widthAndDepth,f.depth=b.widthAndDepth),g=new h.PointSymbol3D({symbolLayers:[f]}));break;case "polyline":"2d"===d?g=new h.SimpleLineSymbol({color:f,width:e}):"3d-flat"===d?g=new h.LineSymbol3D({symbolLayers:[new h.LineSymbol3DLayer({size:e,material:{color:f}})]}):"3d-volumetric"===d&&(g=new h.LineSymbol3D({symbolLayers:[new h.PathSymbol3DLayer({size:e,material:{color:f}})]}));
break;case "polygon":"2d"===d?g=new h.SimpleFillSymbol({color:f,outline:{color:c.color,width:c.width}}):"3d-flat"===d?g=new h.PolygonSymbol3D({symbolLayers:[new h.FillSymbol3DLayer({material:{color:f},outline:{color:c.color,size:c.width}})]}):"3d-volumetric"===d&&(g=new h.PolygonSymbol3D({symbolLayers:[new h.ExtrudeSymbol3DLayer({size:e,material:{color:f}})]}));break;case "mesh":e=b.meshInfo&&b.meshInfo.edgesType,g=new h.MeshSymbol3D({symbolLayers:[new h.FillSymbol3DLayer({material:{color:f,colorMixMode:b.meshInfo&&
b.meshInfo.colorMixMode},edges:null==e||"none"===e?null:{type:e,color:H}})]})}return g};c.verifyBasicFieldValidity=function(a,b,d){var e=F({layer:a,fields:b});if(e.length)return n(d,"Unknown fields: "+e.join(", ")+". You can only use fields defined in the layer schema");a=G({layer:a,fields:b});if(a.length)return n(d,"Unsupported fields: "+a.join(", ")+". You can only use fields that are accessible to the renderer i.e. FieldUsageInfo.supportsRenderer must be true")};c.getClassBreaks=function(a,b){return m.__awaiter(this,
void 0,void 0,function(){var d,e,c,h,g,k,l;return m.__generator(this,function(f){switch(f.label){case 0:return d={layer:a.layer,view:a.view,signal:a.signal},[4,A.all([u(a),b?C(d):null])];case 1:return e=f.sent(),c=e[0],h=e[1],(g=v({min:c.minValue,max:c.maxValue,avg:null,stddev:null},!1,!1))?[4,u(m.__assign(m.__assign({},a),{classificationMethod:"equal-interval",numClasses:1,analyzeData:!1,minValue:g[0],maxValue:g[1],normalizationTotal:g[0]+g[1]}))]:[3,3];case 2:return l=f.sent(),[3,4];case 3:l=c,
f.label=4;case 4:return k=l,[2,{result:k,defaultValuesUsed:!!g,outlineResult:h}]}})})};c.getSummaryStatistics=function(a){return D(a)};c.getSizeRangeForAxis=function(a,b){var d=a.minSize;a=a.maxSize;"height"===b&&(d=((a-d)/2+d)/4.6,a*=2);return{minSize:d,maxSize:a}};c.isValidPointSize=function(a){return x.test(a)};c.getPointSizeAlgorithm=function(a){a=a.match(x);var b=Number(a[1]);if("%"===a[3])return new B.default({scaleFactor:b/100})};c.updateAgeRendererAuthoringInfoVV=function(a,b,d,c){a.startTime=
b instanceof Date?b.getTime():b;a.endTime=d instanceof Date?d.getTime():d;a.units=c;a.field="string"===typeof b?b:"string"===typeof d?d:null};c.getBasemapInfo=function(a,b){return m.__awaiter(this,void 0,void 0,function(){var d,c,f;return m.__generator(this,function(e){switch(e.label){case 0:c=d=null;if(!a&&!b)return[2,{basemapId:d,basemapTheme:c}];!a&&b&&(a=b&&b.get("map.basemap"));a&&(d=l.getBasemapId(a,J,!1))&&(f=l.getBasemapGroup(d),q.isSome(f)&&(c=f));return d||!b?[3,2]:[4,E.getBackgroundColorTheme(b)];
case 1:c=e.sent(),q.isSome(c)&&(d="dark"===c?"dark-gray":"gray"),e.label=2;case 2:return[2,{basemapId:d,basemapTheme:c}]}})})}});