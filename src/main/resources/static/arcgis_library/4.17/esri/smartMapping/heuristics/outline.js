// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Error ../../core/maybe ../../geometry/support/scaleUtils ../../renderers/visualVariables/SizeVariable ../statistics/spatialStatistics ../support/adapters/support/layerUtils".split(" "),function(x,y,c,k,p,q,r,t,m){function u(a){return c.__awaiter(this,void 0,void 0,function(){var d,e,g,h,b,f,n;return c.__generator(this,function(l){switch(l.label){case 0:d=a.view;if(!(a&&d&&a.layer))throw new k("outline:missing-parameters","'view' and 'layer' parameters are required");
e=[0,2,3,1];g=a.layer;h=c.__rest(a,["layer"]);b=m.createLayerAdapter(g,e);f=c.__assign({layerAdapter:b},h);if(!b)throw new k("outline:invalid-parameters","'layer' must be one of these types: "+m.getLayerTypeLabels(e).join(", "));return[4,d.when()];case 1:return l.sent(),n=p.isSome(f.signal)?{signal:f.signal}:null,[4,b.load(n)];case 2:l.sent();if("polygon"!==b.geometryType)throw new k("outline:not-supported","outline is not supported for geometryType: "+b.geometryType);return[2,f]}})})}function v(a,
d){var e=a.avgSize,c=q.getScaleForResolution(1,d.spatialReference);a=w.map(function(a){return{size:a.width,value:Math.round(e/a.size*c)}});a.sort(function(a,b){return a.value-b.value});return{visualVariables:[new r({target:"outline",valueExpression:"$view.scale",stops:a})],opacity:.25}}var w=[{size:10,width:0},{size:20,width:.5},{size:80,width:1},{size:250,width:2}];return function(a){return c.__awaiter(this,void 0,void 0,function(){var d,e,g,h,b;return c.__generator(this,function(f){switch(f.label){case 0:return[4,
u(a)];case 1:return d=f.sent(),e=d.layerAdapter,g=c.__rest(d,["layerAdapter"]),[4,e.getSampleFeatures(c.__assign({sampleSize:-1,returnGeometry:!0},g))];case 2:return h=f.sent(),[4,t({features:h,geometryType:e.geometryType})];case 3:b=f.sent();if(!("avgSize"in b&&b.avgSize))throw new k("outline:insufficient-info","average polygon size is invalid");return[2,v(b,g.view)]}})})}});