// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../pointCloudRenderers ../../renderers ../../core/Error ../../core/lang ../../core/maybe ../../core/promiseUtils ../../intl/messages ../../renderers/support/LegendOptions ../../renderers/support/utils ../heuristics/outline ../heuristics/sizeRange ./support/utils ../statistics/uniqueValues ../support/utils ../support/adapters/support/layerUtils ../symbology/type".split(" "),function(ca,p,k,y,Q,m,z,q,R,S,T,F,U,V,l,A,L,r,G){function W(d){return k.__awaiter(this,void 0,
void 0,function(){var a,b,c,g,e,f,h;return k.__generator(this,function(t){switch(t.label){case 0:if(!d||!d.layer||!d.field&&!d.valueExpression)throw new m("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(d.valueExpression&&!d.view)throw new m("type-renderer:missing-parameters","View is required when 'valueExpression' is specified");a=k.__assign({},d);a.symbolType=a.symbolType||"2d";a.numTypes=null==a.numTypes?10:a.numTypes;a.defaultSymbolEnabled=
null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled;a.sortBy=null==a.sortBy?"count":a.sortBy;a.sortEnabled=null==a.sortEnabled?!0:a.sortEnabled;a.statistics=z.clone(a.statistics);b=[0,2,1,3];c=r.createLayerAdapter(a.layer,b);a.layer=c;if(!c)throw new m("type-renderer:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(b).join(", "));g=q.isSome(a.signal)?{signal:a.signal}:null;return[4,c.load(g)];case 1:t.sent();e=c.geometryType;a.outlineOptimizationEnabled="polygon"===
e?a.outlineOptimizationEnabled:!1;a.sizeOptimizationEnabled="point"===e||"multipoint"===e||"polyline"===e?a.sizeOptimizationEnabled:!1;if("mesh"===e)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||"replace",a.edgesType=a.edgesType||"none";else{if("3d-volumetric-uniform"===a.symbolType&&"point"!==e)throw new m("type-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(-1<a.symbolType.indexOf("3d-volumetric")&&(!a.view||"3d"!==a.view.type))throw new m("type-renderer:invalid-parameters",
"'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");}return[4,L.getFieldsList({field:a.field,valueExpression:a.valueExpression})];case 2:f=t.sent();if(h=l.verifyBasicFieldValidity(c,f,"type-renderer:invalid-parameters"))throw h;return[2,a]}})})}function X(d){return k.__awaiter(this,void 0,void 0,function(){var a,b,c,g,e,f;return k.__generator(this,function(h){switch(h.label){case 0:if(!(d&&d.layer&&d.field))throw new m("type-point-cloud-class-renderer:missing-parameters",
"'layer' and 'field' parameters are required");a=k.__assign({},d);a.statistics=z.clone(a.statistics);b=[4];c=r.createLayerAdapter(a.layer,b);a.layer=c;a.density=a.density||25;a.size=a.size||"100%";if(!l.isValidPointSize(a.size))throw new m("type-point-cloud-class-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");if(!c)throw new m("type-point-cloud-class-renderer:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(b).join(", "));
g=q.isSome(a.signal)?{signal:a.signal}:null;return[4,c.load(g)];case 1:return h.sent(),[4,L.getFieldsList({field:a.field})];case 2:e=h.sent();if(f=l.verifyBasicFieldValidity(c,e,"type-point-cloud-class-renderer:invalid-parameters"))throw f;return[2,a]}})})}function M(d){return k.__awaiter(this,void 0,void 0,function(){var a,b,c,g,e;return k.__generator(this,function(f){switch(f.label){case 0:return a=d.typeScheme,c=b=null,[4,l.getBasemapInfo(d.basemap,d.view)];case 1:g=f.sent();b=q.isSome(g.basemapId)?
g.basemapId:null;c=q.isSome(g.basemapTheme)?g.basemapTheme:null;if(a)return[2,{scheme:G.cloneScheme(a),basemapId:b,basemapTheme:c}];if(e=G.getSchemes({basemap:b,basemapTheme:c,geometryType:d.geometryType,theme:d.theme,worldScale:d.worldScale,view:d.view}))a=e.primaryScheme,b=e.basemapId,c=e.basemapTheme;return[2,{scheme:a,basemapId:b,basemapTheme:c}]}})})}function N(d,a){return d.label<a.label?-1:d.label>a.label?1:0}function O(d,a){return d.value<a.value?-1:d.value>a.value?1:0}function Y(d,a){var b=
a.count-d.count;0===b&&(b=N(d,a));return b}function Z(d,a){var b=a.count-d.count;0===b&&(b=O(d,a));return b}function P(d,a,b){var c;"count"===a?(c=Z,b&&b.codedValues&&(c=Y)):"value"===a&&(c=O,b&&b.codedValues&&(c=N));c&&d.sort(c)}function aa(d,a,b,c){return k.__awaiter(this,void 0,void 0,function(){var g,e,f,h,t,m,D,v,p,w,n,q,r,x,y,z,A,E,B,C,u,I,J,K;return k.__generator(this,function(H){switch(H.label){case 0:return[4,S.loadMessageBundle("esri/smartMapping/t9n/smartMapping")];case 1:return g=H.sent(),
e=d.uniqueValueInfos,f=a.layer,m=(t=(h=a.field)?f.getField(h):null)?f.getFieldDomain(t.name):null,D=-1===a.numTypes?e.length:a.numTypes,v=f.geometryType,[4,M({basemap:a.basemap,geometryType:v,typeScheme:a.typeScheme,worldScale:-1<a.symbolType.indexOf("3d-volumetric"),view:a.view})];case 2:p=H.sent();w=p.scheme;n=new Q.UniqueValueRenderer({field:h});q=-1;x={value:null,domain:m,fieldInfo:t};e.forEach(function(a,b){x.value=a.value;a.label=F.createUniqueValueLabel(x);null===a.value&&(q=b)});-1<q&&(r=
e.splice(q,1)[0]);!1!==a.sortEnabled&&P(e,a.sortBy,m);t&&"date"===t.type&&(y=e.filter(function(a,b){return b<D}),z=y.map(function(a){return a.value}),x.dateFormatInterval=F.calculateDateFormatInterval(z));A=b&&b.opacity;E=l.createColors(w.colors,e.length);B=l.getSymbolSizeFromScheme(w,v);C=l.getSymbolOutlineFromScheme(w,v,A);e.forEach(function(b,c){x.value=b.value;b.label=F.createUniqueValueLabel(x);b.symbol=l.createSymbol(v,{type:a.symbolType,color:E[c],size:B,outline:C,meshInfo:{colorMixMode:a.colorMixMode,
edgesType:a.edgesType}})});a.valueExpression&&(n.valueExpression=a.valueExpression,n.valueExpressionTitle=a.valueExpressionTitle);a.legendOptions&&(n.legendOptions=new T.LegendOptions(a.legendOptions));E=l.createColors(w.colors,D);for(u=0;u<D;u++)(I=e[u])&&n.addUniqueValueInfo({value:I.value,label:I.label,symbol:l.createSymbol(v,{type:a.symbolType,color:E[u],size:B,outline:C,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}})});a.defaultSymbolEnabled&&(n.defaultSymbol=l.createSymbol(v,
{type:a.symbolType,color:w.noDataColor,size:B,outline:C,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}}),n.defaultLabel=g.other);r&&(r.symbol=l.createSymbol(v,{type:a.symbolType,color:w.noDataColor,size:B,outline:C,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}}),e.push(r));J=[];K=n.uniqueValueInfos.length===e.length?-1:n.uniqueValueInfos.length;if(-1<K)for(u=K;u<e.length;u++)J.push(k.__assign({},e[u]));b&&b.visualVariables&&b.visualVariables.length&&(n.visualVariables=
b.visualVariables.map(function(a){return a.clone()}));c&&c.minSize&&(n.visualVariables?n.visualVariables.push(c.minSize):n.visualVariables=[c.minSize]);return[2,{renderer:n,uniqueValueInfos:e,excludedUniqueValueInfos:J,typeScheme:G.cloneScheme(w),basemapId:p.basemapId,basemapTheme:p.basemapTheme}]}})})}function ba(d,a){return k.__awaiter(this,void 0,void 0,function(){var b,c,g,e,f;return k.__generator(this,function(h){switch(h.label){case 0:return b=d.uniqueValueInfos,[4,M({basemap:"gray",theme:"point-cloud-class",
geometryType:"point",typeScheme:a})];case 1:return g=(c=h.sent())&&c.scheme,f=(e="point-cloud-class"===g.theme)?g.colors:l.createColors(g.colors,b.length),P(b,"value"),[2,b.map(function(a,b){var c=a.value,d=null;e?(d=f[c])||(d=f[f.length-1]):d=f[b];return{values:[c],color:d,label:a.label}})]}})})}Object.defineProperty(p,"__esModule",{value:!0});p.createPCClassRenderer=p.createRenderer=void 0;p.createRenderer=function(d){return k.__awaiter(this,void 0,void 0,function(){var a,b,c,g,e,f,h,l,m;return k.__generator(this,
function(k){switch(k.label){case 0:return[4,W(d)];case 1:return a=k.sent(),b=a.layer,c=a.view,g=a.signal,e={layer:b,field:a.field,valueExpression:a.valueExpression,returnAllCodedValues:a.returnAllCodedValues,view:c,signal:g},[4,R.all([null!=a.statistics?a.statistics:A(e),a.outlineOptimizationEnabled?U({layer:b,view:c,signal:g}):null,a.sizeOptimizationEnabled?V({layer:b,view:c,signal:g}):null])];case 2:return f=k.sent(),h=f[0],l=f[1],m=f[2],[2,aa(h,a,l,m)]}})})};p.createPCClassRenderer=function(d){return k.__awaiter(this,
void 0,void 0,function(){var a,b,c,g,e,f;return k.__generator(this,function(h){switch(h.label){case 0:return[4,X(d)];case 1:a=h.sent();if(null==a.statistics)return[3,2];c=a.statistics;return[3,4];case 2:return[4,A({layer:a.layer,field:a.field,signal:a.signal})];case 3:c=h.sent(),h.label=4;case 4:return b=c,e=y.PointCloudUniqueValueRenderer.bind,f={field:a.field,pointsPerInch:a.density,pointSizeAlgorithm:l.getPointSizeAlgorithm(a.size)},[4,ba(b,a.typeScheme)];case 5:return g=new (e.apply(y.PointCloudUniqueValueRenderer,
[void 0,(f.colorUniqueValueInfos=h.sent(),f)])),[2,{renderer:g}]}})})}});