// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Error ../../core/maybe ../../geometry/support/scaleUtils ../statistics/spatialStatistics ../support/adapters/support/layerUtils".split(" "),function(C,D,f,v,z,w,A,r){function B(e){return f.__awaiter(this,void 0,void 0,function(){var k,g,b,h,l,m,p,t;return f.__generator(this,function(n){switch(n.label){case 0:k=e.view;g=e.sampleSize;if(!(e&&k&&e.layer))throw new v("scale-range:missing-parameters","'view' and 'layer' parameters are required");b=[0,2,3,1];h=e.layer;
l=f.__rest(e,["layer"]);m=r.createLayerAdapter(h,b);p=f.__assign({layerAdapter:m},l);p.sampleSize=g||500;if(!m)throw new v("scale-range:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(b).join(", "));return[4,k.when()];case 1:return n.sent(),t=z.isSome(p.signal)?{signal:p.signal}:null,[4,m.load(t)];case 2:return n.sent(),[2,p]}})})}function x(e,k,g){void 0===g&&(g=!0);if(e.constraints&&"effectiveLODs"in e.constraints){var b=e.constraints.effectiveLODs;e=null;for(var h=
0,b=g?b:b.slice(0).reverse();h<b.length;h++){var l=b[h];if(!(g?l.scale>k:l.scale<k)){e=l;break}}return e}}return function(e){return f.__awaiter(this,void 0,void 0,function(){var k,g,b,h,l,m,p,t,n,r,y;return f.__generator(this,function(c){var a;switch(c.label){case 0:return[4,B(e)];case 1:return b=c.sent(),h=b.view,l=b.sampleSize,m=b.layerAdapter,p=b.signal,[4,m.getSampleFeatures({view:h,sampleSize:l,returnGeometry:!0,signal:p})];case 2:return t=c.sent(),[4,A({features:t,geometryType:m.geometryType})];
case 3:n=c.sent();c=h;var d=null,f=null,q=a=null;switch(m.geometryType){case "point":case "multipoint":a=n;d=a.avgMinDistance;f=12;a=a.minDistance;q=320;break;case "polyline":a=n;d=a.avgLength;f=30;a=a.minLength;q=320;break;case "polygon":a=n,d=a.avgSize,f=15,a=a.minSize,q=640}a=0<a?a/q:null;d=w.getScaleForResolution(0<d?d/f:null,c.spatialReference);c=w.getScaleForResolution(a,c.spatialReference);k=d;g=c;r=k;y=g;c=r;var d=y,f=n,u=b.view;a=b.layerAdapter;b.snapToLOD&&(q=x(u,c),u=x(u,d,!1),c=q?q.scale:
c,d=u?u.scale:d);if(c<d)throw new v("scale-range:invalid","calculated minScale is less than maxScale.");d>c/2&&(d=Math.floor(d/2));1E8<c&&(c=0);"polygon"!==a.geometryType&&(d=0);return[2,{minScale:Math.ceil(c),maxScale:Math.floor(d),spatialStatistics:f}]}})})}});