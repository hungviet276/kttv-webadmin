// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Error ../../core/maybe ../../core/promiseUtils ../../renderers/support/AuthoringInfo ../../renderers/support/AuthoringInfoVisualVariable ../../renderers/visualVariables/OpacityVariable ./support/utils ../statistics/summaryStatistics ../support/utils ../support/adapters/support/layerUtils".split(" "),function(z,l,k,m,q,r,t,u,v,n,w,x,p){function y(d){return k.__awaiter(this,void 0,void 0,function(){var a,h,c,b,e,f;return k.__generator(this,function(g){switch(g.label){case 0:if(!(d&&
d.layer&&(d.field||d.valueExpression||d.sqlExpression)))throw new m("opacity-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(d.valueExpression&&!d.view)throw new m("opacity-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");a=k.__assign({},d);h=[0,2,1,3];c=p.createLayerAdapter(a.layer,h);a.layer=c;if(!c)throw new m("opacity-visual-variable:invalid-parameters","'layer' must be one of these types: "+
p.getLayerTypeLabels(h).join(", "));b=q.isSome(a.signal)?{signal:a.signal}:null;return[4,c.load(b)];case 1:return g.sent(),[4,x.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression})];case 2:e=g.sent();if(f=n.verifyBasicFieldValidity(c,e,"opacity-visual-variable:invalid-parameters"))throw f;return[2,a]}})})}Object.defineProperty(l,"__esModule",{value:!0});l.createVisualVariable=void 0;l.createVisualVariable=function(d){return k.__awaiter(this,void 0,
void 0,function(){var a,h;return k.__generator(this,function(c){switch(c.label){case 0:return[4,y(d)];case 1:a=c.sent();h=null;if(!a.statistics)return[3,2];h=a.statistics;return[3,4];case 2:return[4,w({layer:a.layer,field:a.field,valueExpression:a.valueExpression,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,normalizationType:a.normalizationField?"field":void 0,normalizationField:a.normalizationField,minValue:a.minValue,maxValue:a.maxValue,view:a.view,signal:a.signal})];case 3:h=c.sent(),c.label=
4;case 4:c=h;var b=a,e=b.layer,f=b.field,e=(e=f&&"function"!==typeof f?e.getField(f):null)&&"date"===e.type,g=n.createStopValues(c),g=(e=n.getDefaultDataRange(c,e,!0))||[g[0],g[4]],f=new v({field:f,valueExpression:b.valueExpression,valueExpressionTitle:b.valueExpressionTitle,normalizationField:b.normalizationField,stops:[{value:g[0],opacity:.3},{value:g[1],opacity:1}],legendOptions:b.legendOptions}),b=new u({type:"opacity",minSliderValue:null!=b.minValue?b.minValue:c.min,maxSliderValue:null!=b.maxValue?
b.maxValue:c.max}),b=new t({visualVariables:[b]});return[2,r.resolve({visualVariable:f,statistics:c,defaultValuesUsed:!!e,authoringInfo:b})]}})})}});