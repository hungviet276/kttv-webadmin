// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","./spatialReferenceUtils"],function(u,b,t){function l(a,c){var e=c[0]-a[0],d=c[1]-a[1];return 2<a.length&&2<c.length?(a=a[2]-c[2],Math.sqrt(e*e+d*d+a*a)):Math.sqrt(e*e+d*d)}function p(a,c,e){var d=a[0]+e*(c[0]-a[0]),f=a[1]+e*(c[1]-a[1]);return 2<a.length&&2<c.length?[d,f,a[2]+e*(c[2]-a[2])]:[d,f]}function q(a,c,e){for(var d=a.length,f=0,g=0,b=0,n=0;n<d;n++){var h=a[n],k=a[(n+1)%d],m=2,f=f+(h[0]*k[1]-k[0]*h[1]);2<h.length&&2<k.length&&e&&(g+=h[0]*k[2]-k[0]*h[2],m=3);h.length>
m&&k.length>m&&c&&(b+=h[0]*k[m]-k[0]*h[m])}return 0>=f&&0>=g&&0>=b}function r(a,c){if(c=t.getInfo(c)){var e=c.valid[0],d=c.valid[1],f=d-e;c=function(a){var c=Infinity,g=-Infinity;a.forEach(function(a){for(var b=a[0];b<e;)b+=f;for(;b>d;)b-=f;c=Math.min(c,b);g=Math.max(g,b);a[0]=b});var b=g-c;f-b<b&&a.forEach(function(a){0>a[0]&&(a[0]+=f)})};for(var g=0;g<a.length;g++)c(a[g])}}Object.defineProperty(b,"__esModule",{value:!0});b.computeUnnormalizedVertexPositionsOnDateLineCrossing=b.unnormalizeVerticesOnDatelineCrossing=
b.unnormalizeGeometryOnDatelineCrossing=b.getRingArea=b.closeRings=b.closeRingsAndFixWinding=b.isClockwise=b.getPointOnPath=b.getPathLength=b.getMidpoint=b.projectPointOnLine=b.getLength=b.geometryToCoordinates=void 0;b.geometryToCoordinates=function(a){if(!a)return null;if(Array.isArray(a))return a;var c=a.hasZ,e=a.hasM;if("point"===a.type)return e&&c?[a.x,a.y,a.z,a.m]:c?[a.x,a.y,a.z]:e?[a.x,a.y,a.m]:[a.x,a.y];if("polygon"===a.type)return a.rings.slice(0);if("polyline"===a.type)return a.paths.slice(0);
if("multipoint"===a.type)return a.points.slice(0);if("extent"===a.type){a=a.clone().normalize();if(!a)return null;var d=!1,b=!1;a.forEach(function(a){a.hasZ&&(d=!0);a.hasM&&(b=!0)});return a.map(function(a){var c=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(d&&a.hasZ)for(var e=.5*(a.zmax-a.zmin),f=0;f<c.length;f++)c[f].push(e);if(b&&a.hasM)for(a=.5*(a.mmax-a.mmin),f=0;f<c.length;f++)c[f].push(a);return c})}return null};b.getLength=l;b.projectPointOnLine=function(a,
c,e,d){var b=e[d],g=b[0],b=b[1];d=e[d+1];e=d[0]-g;d=d[1]-b;c=Math.min(1,Math.max(0,((c[0]-g)*e+(c[1]-b)*d)/(e*e+d*d)));a[0]=g+e*c;a[1]=b+d*c;return a};b.getMidpoint=function(a,c){return p(a,c,.5)};b.getPathLength=function(a){for(var c=a.length,e=0,d=0;d<c-1;++d)e+=l(a[d],a[d+1]);return e};b.getPointOnPath=function(a,c){if(0>=c)return a[0];for(var e=a.length,d=0,b=0;b<e-1;++b){var g=l(a[b],a[b+1]);if(c-d<g)return p(a[b],a[b+1],(c-d)/g);d+=g}return a[e-1]};b.isClockwise=q;b.closeRingsAndFixWinding=
function(a){if("rings"in a){for(var c=0,b=a.rings;c<b.length;c++){var d=b[c];3>d.length||d[0][0]===d[d.length-1][0]&&d[0][1]===d[d.length-1][1]||d.push([d[0][0],d[0][1]])}if(0<a.rings.length&&!q(a.rings[0],a.hasM,a.hasZ))for(c=0;c<a.rings.length;++c)a.rings[c]=a.rings[c].reverse()}};b.closeRings=function(a){if("rings"in a){var c=0;for(a=a.rings;c<a.length;c++){var b=a[c];3>b.length||b[0][0]===b[b.length-1][0]&&b[0][1]===b[b.length-1][1]||b.push([b[0][0],b[0][1]])}}};b.getRingArea=function(a){for(var b=
a.length,e=0,d=0;d<b;d++)var f=a[d],g=a[(d+1)%b],e=e+(f[0]*g[1]-g[0]*f[1]);return e};b.unnormalizeGeometryOnDatelineCrossing=function(a){if("polygon"!==a.type&&"polyline"!==a.type)return a;r("polygon"===a.type?a.rings:a.paths,a.spatialReference);return a};b.unnormalizeVerticesOnDatelineCrossing=r;b.computeUnnormalizedVertexPositionsOnDateLineCrossing=function(a,b,e,d){var c=Infinity,g=-Infinity;a.forEach(function(a){for(var f=a.pos[0];f<b;)f+=d;for(;f>e;)f-=d;c=Math.min(c,f);g=Math.max(g,f);a.unnormalizedPos[0]=
f;a.unnormalizedPos[1]=a.pos[1];2<a.pos.length&&(a.unnormalizedPos[2]=a.pos[2]);3<a.pos.length&&(a.unnormalizedPos[3]=a.pos[3])});var l=g-c;d-l<l&&a.forEach(function(a){0>a.unnormalizedPos[0]&&(a.unnormalizedPos[0]+=d)})}});