// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../config ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../Polygon ../Polyline ../SpatialReference ./spatialReferenceUtils ./webMercatorUtils ../../tasks/geometry/cut ../../tasks/geometry/simplify".split(" "),function(na,p,X,fa,ga,ha,Y,ia,S,C,y,T,J,ja,ka){function v(a){return"polygon"===a.type?a.rings:a.paths}function u(a,c){return Math.ceil((a-c)/(2*c))}function Z(a,c){for(var d=0,b=v(a);d<b.length;d++)for(var e=0,g=b[d];e<g.length;e++)g[e][0]+=
c;return a}function G(a){for(var c=[],d=0,b=0,e=0;e<a.length;e++){for(var g=a[e],h=null,f=0;f<g.length;f++)h=g[f],c.push(h),0===f?b=d=h[0]:(d=Math.min(d,h[0]),b=Math.max(b,h[0]));h&&c.push([(d+b)/2,0])}return c}function H(a,c){if(!(a instanceof C||a instanceof S))throw la.error("straightLineDensify: the input geometry is neither polyline nor polygon"),new ga("straightLineDensify: the input geometry is neither polyline nor polygon");for(var d=[],b=0,e=v(a);b<e.length;b++){var g=e[b],h=[];d.push(h);
h.push([g[0][0],g[0][1]]);for(var f=0;f<g.length-1;f++){var n=g[f][0],k=g[f][1],z=g[f+1][0],D=g[f+1][1],q=Math.sqrt((z-n)*(z-n)+(D-k)*(D-k)),w=(D-k)/q,m=(z-n)/q,p=q/c;if(1<p){for(var u=1;u<=p-1;u++){var l=u*c;h.push([m*l+n,w*l+k])}q=(q+Math.floor(p-1)*c)/2;h.push([m*q+n,w*q+k])}h.push([z,D])}}return"polygon"===a.type?new S({rings:d,spatialReference:a.spatialReference}):new C({paths:d,spatialReference:a.spatialReference})}function aa(a,c,d){c&&(a=H(a,1E6),a=J.webMercatorToGeographic(a,!0));d&&(a=Z(a,
d));return a}function ba(a,c,d){if(Array.isArray(a)){var b=a[0];if(b>c){var e=u(b,c);a[0]=b+-2*e*c}else b<d&&(e=u(b,d),a[0]=b+-2*e*d)}else b=a.x,b>c?(e=u(b,c),a=a.clone().offset(-2*e*c,0)):b<d&&(e=u(b,d),a=a.clone().offset(-2*e*d,0));return a}function ma(a,c){for(var d=-1,b=function(b){var e=c.cutIndexes[b],f=c.geometries[b],g=v(f);b=function(a){var b=g[a];b.some(function(c){if(180>c[0])return!0;for(var d=c=0;d<b.length;d++){var e=b[d][0];c=e>c?e:c}c=Number(c.toFixed(9));c=-360*u(c,180);for(d=0;d<
b.length;d++)e=f.getPoint(a,d),f.setPoint(a,d,e.clone().offset(c,0));return!0})};for(var k=0;k<g.length;k++)b(k);if(e===d)if("polygon"===a[0].type)for(b=0,k=v(f);b<k.length;b++)a[e]=a[e].addRing(k[b]);else{if("polyline"===a[0].type)for(b=0,k=v(f);b<k.length;b++)a[e]=a[e].addPath(k[b])}else d=e,a[e]=f},e=0;e<c.cutIndexes.length;e++)b(e);return a}function ca(a,c,d){return X.__awaiter(this,void 0,void 0,function(){var b,e,g,h,f,n,k,p,D,q,w,m,v,y,l,K,r,L,G,M,A,I,N,H,U,V,da,ea,O,E,t,x,B,F,W,P,Q;return X.__generator(this,
function(z){switch(z.label){case 0:if(!Array.isArray(a))return[2,ca([a],c)];b=c?c.url:fa.geometryServiceUrl;q=0;w=[];m=[];v=0;for(y=a;v<y.length;v++)l=y[v],Y.isNone(l)?m.push(l):(e||(e=l.spatialReference,g=T.getInfo(e),k=(h=e.isWebMercator)?102100:4326,f=R[k].maxX,n=R[k].minX,p=R[k].plus180Line,D=R[k].minus180Line),g?"mesh"===l.type?m.push(l):"point"===l.type?m.push(ba(l.clone(),f,n)):"multipoint"===l.type?(K=l.clone(),K.points=K.points.map(function(a){return ba(a,f,n)}),m.push(K)):"extent"===l.type?
(r=l.clone(),L=r._normalize(!1,!1,g),m.push(L.rings?new S(L):L)):l.extent?(r=l.extent,G=u(r.xmin,n),M=2*G*f,A=0===M?l.clone():Z(l.clone(),M),r.offset(M,0),r.intersects(p)&&r.xmax!==f?(q=r.xmax>q?r.xmax:q,A=aa(A,h),w.push(A),m.push("cut")):r.intersects(D)&&r.xmin!==n?(q=2*r.xmax*f>q?2*r.xmax*f:q,A=aa(A,h,360),w.push(A),m.push("cut")):m.push(A)):m.push(l.clone()):m.push(l));I=u(q,f);N=-90;H=I;for(U=new C;0<I;)V=-180+360*I,U.addPath([[V,N],[V,-1*N]]),N*=-1,I--;return 0<w.length&&0<H?[4,ja.cut(b,w,U,
d)]:[3,3];case 1:da=z.sent();ea=ma(w,da);O=[];E=[];for(t=0;t<m.length;t++)x=m[t],"cut"!==x?E.push(x):(B=ea.shift(),F=a[t],Y.isSome(F)&&"polygon"===F.type&&F.rings&&1<F.rings.length&&B.rings.length>=F.rings.length?(O.push(B),E.push("simplify")):E.push(h?J.geographicToWebMercator(B):B));return O.length?[4,ka.simplify(b,O,d)]:[2,E];case 2:W=z.sent();P=[];for(t=0;t<E.length;t++)x=E[t],"simplify"!==x?P.push(x):P.push(h?J.geographicToWebMercator(W.shift()):W.shift());return[2,P];case 3:Q=[];for(t=0;t<m.length;t++)x=
m[t],"cut"!==x?Q.push(x):(B=w.shift(),Q.push(!0===h?J.geographicToWebMercator(B):B));return[2,ia.resolve(Q)]}})})}Object.defineProperty(p,"__esModule",{value:!0});p.normalizeMapX=p.getDenormalizedExtent=p.normalizeCentralMeridian=p.straightLineDensify=void 0;var la=ha.getLogger("esri.geometry.support.normalizeUtils"),R={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:new C({paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],
spatialReference:y.WebMercator}),minus180Line:new C({paths:[[[-2.0037508342788905E7,-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:y.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new C({paths:[[[180,-180],[180,180]]],spatialReference:y.WGS84}),minus180Line:new C({paths:[[[-180,-180],[-180,180]]],spatialReference:y.WGS84})}};p.straightLineDensify=H;p.normalizeCentralMeridian=ca;p.getDenormalizedExtent=function(a){var c;if(!a)return null;var d=a.extent;
if(!d)return null;var b=a.spatialReference&&T.getInfo(a.spatialReference);if(!b)return d;var b=b.valid,e=b[0],b=b[1],g=d.width,h=d.xmin;c=d.xmax;c=[c,h];h=c[0];c=c[1];if("extent"===a.type||0===g||g<=b||g>2*b||h<e||c>b)return d;var f;switch(a.type){case "polygon":if(1<a.rings.length)f=G(a.rings);else return d;break;case "polyline":if(1<a.paths.length)f=G(a.paths);else return d;break;case "multipoint":f=a.points}a=d.clone();for(e=0;e<f.length;e++){var n=f[e][0];0>n?(n+=b,c=Math.max(n,c)):(n-=b,h=Math.min(n,
h))}a.xmin=h;a.xmax=c;return a.width<g?(a.xmin-=b,a.xmax-=b,a):d};p.normalizeMapX=function(a,c){if(c=T.getInfo(c)){var d=c.valid;c=d[0];var d=d[1],b=d-c;if(a<c)for(;a<c;)a+=b;if(a>d)for(;a>d;)a-=b}return a}});