// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports @dojo/framework/shim/object ../. ../../core/Error ../../core/unitUtils ./geodesicConstants".split(" "),function(K,g,J,B,v,G,t){function H(a){if(!a||!a.isGeographic)return null;if(a.wkid){var b=t.spheroids[a.wkid];if(b)return b}if(a.wkt){a=t.WKT_SPHEROID_REGEX.exec(a.wkt);if(!a||2!==a.length)return null;b=a[1].split(",");if(!b||3!==b.length)return null;a=parseFloat(b[1]);b=parseFloat(b[2]);return isNaN(a)||isNaN(b)?null:{a:a,f:0===b?0:1/b}}return null}function E(a){a=H(a||B.SpatialReference.WGS84);
if("b"in a&&"eSq"in a&&"radius"in a)return a;var b=a.a*(1-a.f);return J.assign(a,{b:b,eSq:1-Math.pow(b/a.a,2),radius:(2*a.a+b)/3})}function C(a,b,e){var d=E(e);e=d.a;var d=d.eSq,c=Math.sqrt(d),h=Math.sin(b[1]*t.toRadians);b=e*b[0]*t.toRadians;e=0<d?e*(1-d)*(h/(1-d*h*h)-1/(2*c)*Math.log((1-c*h)/(1+c*h)))*.5:e*h;a[0]=b;a[1]=e;return a}function A(a){return null!==H(a)}function I(a,b){if("polyline"!==a.type&&"polygon"!==a.type)throw new v("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");
var e=a.spatialReference;if(!A(e))throw new v("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");var d=E(e).radius/1E4;b<d&&(b=d);for(var d=[],c=[0,0],h={distance:null},k=0,l="polyline"===a.type?a.paths:a.rings;k<l.length;k++){var f=l[k],y=[];d.push(y);y.push([f[0][0],f[0][1]]);for(var n=f[0][0],p=f[0][1],m=void 0,r=void 0,g=0;g<f.length-1;g++)if(m=f[g+1][0],r=f[g+1][1],n!==m||p!==r){var u=[n,p];F(h,[n,p],[m,r],e);n=h.azimuth;p=h.distance;m=p/b;if(1<
m){for(r=1;r<=m-1;r++)D(c,u,n,r*b,e),y.push(c.slice(0));D(c,u,n,(p+Math.floor(m-1)*b)/2,e);y.push(c.slice(0))}D(c,u,n,p,e);y.push(c.slice(0));n=c[0];p=c[1]}}return"polyline"===a.type?new B.Polyline({paths:d,spatialReference:e}):new B.Polygon({rings:d,spatialReference:e})}function D(a,b,e,d,c){var h=b[0]*t.toRadians,k=b[1]*t.toRadians;b=e*t.toRadians;c=E(c);var l=c.a,f=c.b;c=c.f;e=Math.sin(b);b=Math.cos(b);for(var y=(1-c)*Math.tan(k),k=1/Math.sqrt(1+y*y),n=y*k,p=Math.atan2(y,b),y=k*e,m=y*y,r=1-m,l=
r*(l*l-f*f)/(f*f),g=1+l/16384*(4096+l*(-768+l*(320-175*l))),u=l/1024*(256+l*(-128+l*(74-47*l))),l=d/(f*g),v=2*Math.PI,w,x,q,z;1E-12<Math.abs(l-v);)q=Math.cos(2*p+l),w=Math.sin(l),x=Math.cos(l),z=u*w*(q+u/4*(x*(-1+2*q*q)-u/6*q*(-3+4*w*w)*(-3+4*q*q))),v=l,l=d/(f*g)+z;d=n*w-k*x*b;f=c/16*r*(4+c*(4-3*r));d=Math.atan2(n*x+k*w*b,(1-c)*Math.sqrt(m+d*d))/t.toRadians;h=(h+(Math.atan2(w*e,k*x-n*w*b)-(1-f)*c*y*(l+f*w*(q+f*x*(-1+2*q*q)))))/t.toRadians;a.splice(0,a.length);a.push(h,d);return a}function F(a,b,e,
d){var c=b[0]*t.toRadians;b=b[1]*t.toRadians;var h=e[0]*t.toRadians;e=e[1]*t.toRadians;var k=E(d),l=k.a;d=k.b;var f=k.f,g=k.radius,n=h-c,p=Math.atan((1-f)*Math.tan(b)),m=Math.atan((1-f)*Math.tan(e)),k=Math.sin(p),p=Math.cos(p),r=Math.sin(m),m=Math.cos(m),v=1E3,u=n,A,w,x,q,z,D,B,C;do{q=Math.sin(u);z=Math.cos(u);x=Math.sqrt(m*q*m*q+(p*r-k*m*z)*(p*r-k*m*z));if(0===x)return{distance:0};z=k*r+p*m*z;D=Math.atan2(x,z);B=p*m*q/x;w=1-B*B;q=z-2*k*r/w;isNaN(q)&&(q=0);C=f/16*w*(4+f*(4-3*w));A=u;u=n+(1-C)*f*B*
(D+C*x*(q+C*z*(-1+2*q*q)))}while(1E-12<Math.abs(u-A)&&0<--v);if(0===v)return a=h-c,{azimuth:Math.atan2(Math.sin(a)*Math.cos(e),Math.cos(b)*Math.sin(e)-Math.sin(b)*Math.cos(e)*Math.cos(a))/t.toRadians,distance:Math.acos(Math.sin(b)*Math.sin(e)+Math.cos(b)*Math.cos(e)*Math.cos(h-c))*g};c=w*(l*l-d*d)/(d*d);b=c/1024*(256+c*(-128+c*(74-47*c)));h=Math.atan2(p*Math.sin(u),p*r*Math.cos(u)-k*m);a.azimuth=Math.atan2(m*Math.sin(u),p*r-k*m*Math.cos(u))/t.toRadians;a.distance=d*(1+c/16384*(4096+c*(-768+c*(320-
175*c))))*(D-b*x*(q+b/4*(z*(-1+2*q*q)-b/6*q*(-3+4*x*x)*(-3+4*q*q))));a.reverseAzimuth=h/t.toRadians;return a}Object.defineProperty(g,"__esModule",{value:!0});g.pointFromDistance=g.geodesicDistance=g.inverseGeodeticSolver=g.directGeodeticSolver=g.geodesicDensify=g.geodesicLengths=g.geodesicAreas=g.isSupported=void 0;g.isSupported=A;g.geodesicAreas=function(a,b){void 0===b&&(b="square-meters");if(a.some(function(a){return!A(a.spatialReference)}))throw new v("geodesic-areas:invalid-spatial-reference",
"the input geometries spatial reference is not supported");for(var e=[],d=0;d<a.length;d++){var c=a[d],h=c.spatialReference,h=E(h).radius*t.densificationRatio;e.push(I(c,h))}a=[];for(var d=[0,0],c=[0,0],k=0;k<e.length;k++){for(var h=e[k],l=h.rings,h=h.spatialReference,f=0,g=0;g<l.length;g++){var n=l[g];C(d,n[0],h);C(c,n[n.length-1],h);for(var p=c[0]*d[1]-d[0]*c[1],m=0;m<n.length-1;m++)C(d,n[m+1],h),C(c,n[m],h),p+=c[0]*d[1]-d[0]*c[1];f+=p}f=G.convertUnit(f,"square-meters",b);a.push(f/-2)}return a};
g.geodesicLengths=function(a,b){void 0===b&&(b="meters");if(!a&&!a)throw new v("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(a.some(function(a){return!A(a.spatialReference)}))throw new v("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");for(var e=[],d=0;d<a.length;d++){for(var c=a[d],h=c.spatialReference,c="polyline"===c.type?c.paths:c.rings,k=0,l=0;l<c.length;l++){for(var f=c[l],g=0,n=1;n<f.length;n++){var p=
f[n-1][0],m=f[n][0],r=f[n-1][1],t=f[n][1];if(r!==t||p!==m){var u={distance:null};F(u,[p,r],[m,t],h);g+=u.distance}}k+=g}k=G.convertUnit(k,"meters",b);e.push(k)}return e};g.geodesicDensify=I;g.directGeodeticSolver=D;g.inverseGeodeticSolver=F;g.geodesicDistance=function(a,b,e){void 0===e&&(e="meters");if(!a||!b)throw new v("geodesic-distance:missing-parameters","one or both input parameters are missing");if(!a.spatialReference||!b.spatialReference)throw new v("geodesic-distance:invalid-parameters",
"one or both input points do not have a spatial reference");if(!a.spatialReference.equals(b.spatialReference))throw new v("geodesic-distance:invalid-parameters","spatial references of input parameters do not match");var d=a.spatialReference;if(!A(d))throw new v("geodesic-distance:not-supported","input geometry spatial reference is not supported");if(a.equals(b))return{distance:0,azimuth:0,reverseAzimuth:0};var c={distance:null};F(c,[a.x,a.y],[b.x,b.y],d);c.distance=G.convertUnit(c.distance,"meters",
e);return c};g.pointFromDistance=function(a,b,e){if(!a||null==b||null==e)throw new v("point-from-distance:missing-parameters","one or more input parameters are missing or undefined");if(0>e||360<e)throw new v("point-from-distance:-of-bounds","azimuth is restricted to angles between, and including, 0\u00b0 to 360\u00b0 degrees");if(!a.spatialReference)throw new v("point-from-distance:missing-spatial-reference","the input point must have a spatial reference");var d=a.spatialReference;if(!A(d))throw new v("geodesic-distance:not-supported",
"input geometry spatial reference is not supported");var c=[0,0];D(c,[a.x,a.y],e,b,d);return new B.Point({x:c[0],y:c[1],spatialReference:d})}});