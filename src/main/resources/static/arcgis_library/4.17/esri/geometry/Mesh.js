// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/Error ../core/lang ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/libs/gl-matrix-2/vec3f64 ../core/libs/gl-matrix-2/vec4f64 ./Extent ./Geometry ./Point ./Polygon ./support/MeshComponent ./support/MeshVertexAttributes ./support/triangulationUtils ./support/meshUtils/centerAt ./support/meshUtils/merge ./support/meshUtils/offset ./support/meshUtils/primitives ./support/meshUtils/rotate ./support/meshUtils/scale @dojo/framework/shim/Promise".split(" "),
function(z,v,d,A,F,G,B,f,k,w,x,H,r,I,t,C,J,K,L,M,m,n,N){var q=G.getLogger("esri.geometry.Mesh");v=function(k){function b(a){a=k.call(this,a)||this;a.components=null;a.hasZ=!0;a.hasM=!1;a.vertexAttributes=new C.MeshVertexAttributes;a.type="mesh";return a}d.__extends(b,k);l=b;Object.defineProperty(b.prototype,"extent",{get:function(){var a=this.spatialReference,c=this.vertexAttributes&&this.vertexAttributes.position;if(!c||0===c.length||this.components&&0===this.components.length)return new x({xmin:0,
ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:a});a={xmin:Infinity,xmax:-Infinity,ymin:Infinity,ymax:-Infinity,zmin:Infinity,zmax:-Infinity,spatialReference:a};if(!this.components)return new x(this.extendExtent(a,c,null));for(var b=0,e=this.components;b<e.length;b++){var h=e[b];if(h.faces)this.extendExtent(a,c,h.faces);else{this.extendExtent(a,c,null);break}}return new x(a)},enumerable:!1,configurable:!0});b.prototype.addComponent=function(a){this.components||(this.components=[]);this.components.push(t.from(a));
this.clearCache()};b.prototype.removeComponent=function(a){if(this.components&&(a=this.components.indexOf(a),-1!==a)){this.components=this.components.splice(a,1);return}q.error("removeComponent()","Provided component is not part of the list of components")};b.prototype.rotate=function(a,c,b,e){n.axisAngleFrom(y.x,a/180*Math.PI,p);n.axisAngleFrom(y.y,c/180*Math.PI,D);n.axisAngleFrom(y.z,b/180*Math.PI,E);n.axisAngleMultiply(p,D,p);n.axisAngleMultiply(p,E,p);n.rotate(this,p,e);return this};b.prototype.offset=
function(a,c,b,e){u[0]=a;u[1]=c;u[2]=b;M.offset(this,u,e);return this};b.prototype.scale=function(a,c){N.scale(this,a,c);return this};b.prototype.centerAt=function(a,c){K.centerAt(this,a,c);return this};b.prototype.clone=function(){var a=this.components?new Map:null,c=this.components?new Map:null,b=this.components?this.components.map(function(b){return b.cloneWithDeduplication(a,c)}):null;return new l({components:b,spatialReference:this.spatialReference,vertexAttributes:F.clone(this.vertexAttributes)})};
b.prototype.vertexAttributesChanged=function(){this.clearCache()};b.prototype.toJSON=function(a){return this.write(null,a)};b.prototype.forEachVertex=function(a,c,b){if(c)for(h=0;h<c.length;h++){var e=3*c[h];b(a[e+0],a[e+1],a[e+2])}else for(var h=0;h<a.length;h+=3)b(a[h+0],a[h+1],a[h+2])};b.prototype.extendExtent=function(a,c,b){this.forEachVertex(c,b,function(c,b,d){a.xmin=Math.min(a.xmin,c);a.xmax=Math.max(a.xmax,c);a.ymin=Math.min(a.ymin,b);a.ymax=Math.max(a.ymax,b);a.zmin=Math.min(a.zmin,d);a.zmax=
Math.max(a.zmax,d)});return a};b.prototype.toBinaryGLTF=function(a){return d.__awaiter(this,void 0,void 0,function(){var c;return d.__generator(this,function(b){switch(b.label){case 0:return[4,new Promise(function(a,c){z(["./support/meshUtils/exporters/gltf/gltfexport"],a,c)})];case 1:return c=b.sent().toBinaryGLTF,[2,c(this,a)]}})})};b.createBox=function(a,c){if(!(a instanceof r))return q.error(".createBox()","expected location to be a Point instance"),null;a=new l(m.convertUnitGeometry(m.createUnitSizeBox(),
a,c));if(c&&c.imageFace&&"all"!==c.imageFace){var b=a.components[0],e=b.faces,d=m.boxFaceOrder[c.imageFace],f=6*d;c=new Uint32Array(6);for(var k=new Uint32Array(e.length-6),n=0,p=0,g=0;g<e.length;g++)g>=f&&g<f+6?c[n++]=e[g]:k[p++]=e[g];e=new Float32Array(a.vertexAttributes.uv);d*=8;f=[0,1,1,1,1,0,0,0];for(g=0;g<f.length;g++)e[d+g]=f[g];a.vertexAttributes.uv=e;a.components=[new t({faces:c,material:b.material}),new t({faces:k})]}return a};b.createSphere=function(a,b){return a instanceof r?new l(m.convertUnitGeometry(m.createUnitSizeSphere(b&&
b.densificationFactor||0),a,b)):(q.error(".createSphere()","expected location to be a Point instance"),null)};b.createCylinder=function(a,b){return a instanceof r?new l(m.convertUnitGeometry(m.createUnitSizeCylinder(b&&b.densificationFactor||0),a,b)):(q.error(".createCylinder()","expected location to be a Point instance"),null)};b.createPlane=function(a,b){return a instanceof r?new l(m.convertUnitGeometry(m.createUnitSizePlane(b&&b.facing||"up"),a,b)):(q.error(".createPlane()","expected location to be a Point instance"),
null)};b.createFromPolygon=function(a,b){if(!(a instanceof I))return q.error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;var c=J.triangulate(a);return new l({vertexAttributes:{position:c.position},components:[{faces:c.faces,shading:"flat",material:b&&b.material||null}],spatialReference:a.spatialReference})};b.createFromGLTF=function(a,b,f){return d.__awaiter(this,void 0,void 0,function(){var c=this;return d.__generator(this,function(e){if(!(a instanceof r))throw q.error(".createfromGLTF()",
"expected location to be a Point instance"),new A("invalid-input","Expected location to be a Point instance");return[2,B.create(function(e,h){(new Promise(function(a,b){z(["./support/loadGLTFMesh"],a,b)})).then(function(k){return d.__awaiter(c,void 0,void 0,function(){var c,g;return d.__generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),B.throwIfAborted(f),[4,k.loadGLTFMesh(a,b,f)];case 1:return c=d.sent(),e(new l(L.merge(c.map(function(a){return new l(a)}),{reuseMaterials:!0}))),
[3,3];case 2:return g=d.sent(),h(new A("gltf-loader-error","Failed to load glTF.","["+g.name+"] "+g.message)),[3,3];case 3:return[2]}})})})})]})})};var l;d.__decorate([f.property({dependsOn:["vertexAttributes","vertexAttributes.position","components"],json:{read:!1}})],b.prototype,"cache",void 0);d.__decorate([f.property({type:[t]})],b.prototype,"components",void 0);d.__decorate([f.property({dependsOn:["cache"],readOnly:!0,json:{read:!1}})],b.prototype,"extent",null);d.__decorate([f.property({readOnly:!0,
json:{read:!1,write:!1}})],b.prototype,"hasZ",void 0);d.__decorate([f.property({readOnly:!0,json:{read:!1,write:!1}})],b.prototype,"hasM",void 0);d.__decorate([f.property({type:C.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],b.prototype,"vertexAttributes",void 0);return b=l=d.__decorate([f.subclass("esri.geometry.Mesh")],b)}(H);v.prototype.toJSON.isDefaultToJSON=!0;var y={x:k.vec3f64.fromValues(1,0,0),y:k.vec3f64.fromValues(0,1,0),z:k.vec3f64.fromValues(0,0,1)},u=k.vec3f64.create(),p=w.vec4f64.create(),
D=w.vec4f64.create(),E=w.vec4f64.create();return v});