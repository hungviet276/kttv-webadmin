// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports ../../core/maybe ../../geometry/support/jsonUtils ../../geometry/support/scaleUtils ../../layers/support/layerUtils".split(" "),function(E,f,u,v,w,q){Object.defineProperty(f,"__esModule",{value:!0});f.identifyToIdentifyRESTParameters=void 0;f.identifyToIdentifyRESTParameters=function(a,g){var b=a.toJSON(),e=b.dpi,k=b.dynamicLayers,d=b.geometry,c=b.geometryPrecision,l=b.height,h=b.layerDefinitions,m=b.layerIds,n=b.layerOption,f=b.layerTimeOptions;a=b.mapExtent;var x=b.maxAllowableOffset,
y=b.returnFieldName,z=b.returnGeometry,A=b.returnUnformattedValues,B=b.returnZ,p=b.spatialReference,r=b.timeExtent,C=b.tolerance,b=b.width;g=g&&u.isSome(g.geometry)?g.geometry:null;c={geometryPrecision:c,maxAllowableOffset:x,returnFieldName:y,returnGeometry:z,returnUnformattedValues:A,returnZ:B,tolerance:C};d=g&&g.toJSON()||d;c.imageDisplay=b+","+l+","+e;d&&(delete d.spatialReference,c.geometry=JSON.stringify(d),c.geometryType=v.getJsonType(d));p?c.sr=p.wkid||JSON.stringify(p):d&&d.spatialReference?
c.sr=d.spatialReference.wkid||JSON.stringify(d.spatialReference):a&&a.spatialReference&&(c.sr=a.spatialReference.wkid||JSON.stringify(a.spatialReference));c.time=r?r.join(","):null;a&&(c.mapExtent=a.xmin+","+a.ymin+","+a.xmax+","+a.ymax);c.layers=n;m&&(c.layers+=":"+m.join(","));if(h){l=[];for(e=0;e<h.length;e++)n=h[e],l[n.id]=n.definitionExpression;c.layerDefs=q.serializeLayerDefinitions(l)}if(k&&k.length){var t=[];a=w.getScale({extent:a,width:b,spatialReference:a.spatialReference});var D=q.getLayersForScale(a,
k);a=function(b){var a=k[b],c=a.id;!a.subLayerIds&&m&&-1!==m.indexOf(c)&&-1!==D.indexOf(c)&&(b={id:c},b.source=a.source,a=null,h&&h.length&&(a=(a=h.filter(function(a){return a.id===c})[0])&&a.definitionExpression),a&&(b.definitionExpression=a),a=void 0,f&&f[c]&&(a=f[c]),a&&(b.layerTimeOptions=a),t.push(b))};for(e=0;e<k.length;e++)a(e);a=JSON.stringify(t);"[]"===a&&(a="[{}]");c.dynamicLayers=a}return c}});