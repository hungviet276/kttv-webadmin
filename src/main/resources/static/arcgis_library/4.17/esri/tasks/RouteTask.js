// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../request ../core/promiseUtils ../core/queryUtils ../core/string ../core/accessorSupport/decorators ../geometry/support/normalizeUtils ./Task ./mixins/NAServiceDescription ./support/RouteResultsContainer".split(" "),function(D,E,h,t,u,v,w,x,y,z,A,B){var C=v.createQueryParamsHelper({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,directionsTimeAttribute:{name:"directionsTimeAttributeName"},impedanceAttribute:{name:"impedanceAttributeName"},
outSpatialReference:{name:"outSR",getter:function(h){return h.outSpatialReference.wkid}},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},stops:!0,travelMode:!0});return function(n){function m(a){return n.call(this,a)||this}h.__extends(m,n);m.prototype.solve=function(a,e){var b=this,f=[],d=[],l={},g={};a.stops&&a.stops.features&&this._collectGeometries(a.stops.features,d,"stops.features",l);a.pointBarriers&&a.pointBarriers.features&&
this._collectGeometries(a.pointBarriers.features,d,"pointBarriers.features",l);a.polylineBarriers&&a.polylineBarriers.features&&this._collectGeometries(a.polylineBarriers.features,d,"polylineBarriers.features",l);a.polygonBarriers&&a.polygonBarriers.features&&this._collectGeometries(a.polygonBarriers.features,d,"polygonBarriers.features",l);return y.normalizeCentralMeridian(d).then(function(a){for(var c in l){var e=l[c];f.push(c);g[c]=a.slice(e[0],e[1])}return b._isInputGeometryZAware(g,f)?b.getServiceDescription():
u.resolve({dontCheck:!0})}).then(function(c){("dontCheck"in c?c.dontCheck:c.hasZ)||b._dropZValuesOffInputGeometry(g,f);c=function(c){g[c].forEach(function(b,d){a.get(c)[d].geometry=b})};for(var d in g)c(d);d={query:h.__assign(h.__assign(h.__assign({},b.parsedUrl.query),{f:"json"}),C.toQueryParams(a))};if(b.requestOptions||e)d=h.__assign(h.__assign(h.__assign({},b.requestOptions),e),d);c=b.parsedUrl.path;c=w.endsWith(c,"/solve")?c:c+"/solve";return t(c,d)}).then(function(a){return b._handleSolveResponse(a)})};
m.prototype._collectGeometries=function(a,e,b,f){f[b]=[e.length,e.length+a.length];a.forEach(function(a){e.push(a.geometry)})};m.prototype._handleSolveResponse=function(a){var e=[],b=[],f=a.data;a=f.directions;var d=f.routes,l=void 0===d?{}:d,d=l.features,d=void 0===d?[]:d,l=l.spatialReference,g=f.stops,c=void 0===g?{}:g,g=c.features,g=void 0===g?[]:g,h=c.spatialReference,c=f.barriers,m=f.polygonBarriers,p=f.polylineBarriers,f=f.messages,n=!0,k,q,r=d&&(void 0===l?null:l)||g&&(void 0===h?null:h)||
c&&c.spatialReference||m&&m.spatialReference||p&&p.spatialReference;(void 0===a?[]:a).forEach(function(a){e.push(k=a.routeName);b[k]={directions:a}});d.forEach(function(a){-1===e.indexOf(k=a.attributes.Name)&&(e.push(k),b[k]={});a.geometry&&(a.geometry.spatialReference=r);b[k].route=a});g.forEach(function(a){q=a.attributes;-1===e.indexOf(k=q.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(e.push(k),b[k]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==k&&(n=!1);a.geometry&&(a.geometry.spatialReference=
r);null==b[k].stops&&(b[k].stops=[]);b[k].stops.push(a)});0<g.length&&!0===n&&(b[e[0]].stops=b["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete b["esri.tasks.RouteTask.NULL_ROUTE_NAME"],e.splice(e.indexOf("esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));a=e.map(function(a){b[a].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===a?null:a;return b[a]});return B.fromJSON({routeResults:a,pointBarriers:c,polygonBarriers:m,polylineBarriers:p,messages:f})};return m=h.__decorate([x.subclass("esri.tasks.RouteTask")],
m)}(A.NAServiceDescriptionMixin(z))});