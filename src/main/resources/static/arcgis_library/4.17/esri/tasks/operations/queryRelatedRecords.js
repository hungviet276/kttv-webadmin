// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","tslib","../../request","./urlUtils"],function(w,c,b,u,v){function p(a,b){a=a.toJSON();a.objectIds&&(a.objectIds=a.objectIds.join(","));a.orderByFields&&(a.orderByFields=a.orderByFields.join(","));!a.outFields||(null===b||void 0===b?0:b.returnCountOnly)?delete a.outFields:-1!==a.outFields.indexOf("*")?a.outFields="*":a.outFields=a.outFields.join(",");a.outSpatialReference&&(a.outSR=a.outSR.wkid||JSON.stringify(a.outSR.toJSON()),delete a.outSpatialReference);a.dynamicDataSource&&
(a.layer=JSON.stringify({source:a.dynamicDataSource}),delete a.dynamicDataSource);return a}function t(a,c,g,e){void 0===g&&(g={});return b.__awaiter(this,void 0,void 0,function(){var d;return b.__generator(this,function(k){d=v.mapParameters(b.__assign(b.__assign(b.__assign(b.__assign({},a.query),{f:"json"}),e),p(c,e)));return[2,u(a.path+"/queryRelatedRecords",b.__assign(b.__assign({},g),{query:b.__assign(b.__assign({},g.query),d)}))]})})}Object.defineProperty(c,"__esModule",{value:!0});c.executeRelationshipQueryForCount=
c.executeRelationshipQuery=c.toQueryStringParameters=void 0;c.toQueryStringParameters=p;c.executeRelationshipQuery=function(a,c,g){return b.__awaiter(this,void 0,void 0,function(){var e,d,k,l,h,f,n,m,r,q;return b.__generator(this,function(p){switch(p.label){case 0:return[4,t(a,c,g)];case 1:e=p.sent();d=e.data;k=d.geometryType;l=d.spatialReference;h={};f=0;for(n=d.relatedRecordGroups;f<n.length;f++)if(m=n[f],r={fields:void 0,objectIdFieldName:void 0,geometryType:k,spatialReference:l,hasZ:!!d.hasZ,
hasM:!!d.hasM,features:m.relatedRecords},null!=m.objectId)h[m.objectId]=r;else for(q in m)m.hasOwnProperty(q)&&"relatedRecords"!==q&&(h[m[q]]=r);return[2,b.__assign(b.__assign({},e),{data:h})]}})})};c.executeRelationshipQueryForCount=function(a,c,g){return b.__awaiter(this,void 0,void 0,function(){var e,d,k,l,h,f;return b.__generator(this,function(n){switch(n.label){case 0:return[4,t(a,c,g,{returnCountOnly:!0})];case 1:e=n.sent();d=e.data;k={};l=0;for(h=d.relatedRecordGroups;l<h.length;l++)f=h[l],
null!=f.objectId&&(k[f.objectId]=f.count);return[2,b.__assign(b.__assign({},e),{data:k})]}})})}});