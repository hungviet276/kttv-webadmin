// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../geometry ../core/accessorSupport/decorators ../layers/support/source/DataLayerSource ./Task ./operations/pbfJSONFeatureSet ./operations/query ./operations/queryAttachments ./operations/queryRelatedRecords ./support/AttachmentQuery ./support/FeatureSet ./support/Query ./support/RelationshipQuery".split(" "),function(y,z,c,t,e,f,u,v,g,l,m,w,n,x,p){return function(q){function d(a){a=q.call(this,a)||this;a.dynamicDataSource=null;a.format="json";a.gdbVersion=null;a.sourceSpatialReference=
null;return a}c.__extends(d,q);d.prototype.execute=function(a,b){return this.executeJSON(a,b).then(function(a){return n.fromJSON(a)})};d.prototype.executeJSON=function(a,b){return c.__awaiter(this,void 0,void 0,function(){var d,h,e,r,f;return c.__generator(this,function(k){switch(k.label){case 0:d=c.__assign(c.__assign({},this.requestOptions),b);h=this._normalizeQuery(a);if("pbf"!==this.format)return[3,2];e=!h.quantizationParameters;return[4,g.executeQueryPBF(this.parsedUrl,h,new v.JSONFeatureSetParserContext({sourceSpatialReference:this.sourceSpatialReference,
applyTransform:e}),d)];case 1:return r=k.sent().data,[2,r];case 2:return[4,g.executeQuery(this.parsedUrl,h,this.sourceSpatialReference,d)];case 3:return f=k.sent().data,[2,f]}})})};d.prototype.executeForCount=function(a,b){return g.executeQueryForCount(this.parsedUrl,this._normalizeQuery(a),c.__assign(c.__assign({},this.requestOptions),b)).then(function(a){return a.data.count})};d.prototype.executeForExtent=function(a,b){return g.executeQueryForExtent(this.parsedUrl,this._normalizeQuery(a),c.__assign(c.__assign({},
this.requestOptions),b)).then(function(a){return{count:a.data.count,extent:t.Extent.fromJSON(a.data.extent)}})};d.prototype.executeForIds=function(a,b){return g.executeQueryForIds(this.parsedUrl,this._normalizeQuery(a),c.__assign(c.__assign({},this.requestOptions),b)).then(function(a){return a.data.objectIds})};d.prototype.executeRelationshipQuery=function(a,b){a=p.from(a);if(this.gdbVersion||this.dynamicDataSource)a=a.clone(),a.gdbVersion=a.gdbVersion||this.gdbVersion,a.dynamicDataSource=a.dynamicDataSource||
this.dynamicDataSource;return m.executeRelationshipQuery(this.parsedUrl,a,c.__assign(c.__assign({},this.requestOptions),b)).then(function(a){var b=a.data,c={};Object.keys(b).forEach(function(a){return c[a]=n.fromJSON(b[a])});return c})};d.prototype.executeRelationshipQueryForCount=function(a,b){a=p.from(a);if(this.gdbVersion||this.dynamicDataSource)a=a.clone(),a.gdbVersion=a.gdbVersion||this.gdbVersion,a.dynamicDataSource=a.dynamicDataSource||this.dynamicDataSource;return m.executeRelationshipQueryForCount(this.parsedUrl,
a,c.__assign(c.__assign({},this.requestOptions),b)).then(function(a){return a.data})};d.prototype.executeAttachmentQuery=function(a,b){var d=this;return l.executeAttachmentQuery(this.parsedUrl,w.from(a),c.__assign(c.__assign({},this.requestOptions),b)).then(function(a){return l.processAttachmentQueryResult(a.data.attachmentGroups,d.parsedUrl.path)})};d.prototype._normalizeQuery=function(a){var b=x.from(a);if(!this.gdbVersion&&!this.dynamicDataSource)return b;b=b===a?b.clone():b;b.gdbVersion=a.gdbVersion||
this.gdbVersion;b.dynamicDataSource=a.dynamicDataSource?f.DataLayerSource.from(a.dynamicDataSource):this.dynamicDataSource;return b};c.__decorate([e.property({type:f.DataLayerSource})],d.prototype,"dynamicDataSource",void 0);c.__decorate([e.property()],d.prototype,"format",void 0);c.__decorate([e.property()],d.prototype,"gdbVersion",void 0);c.__decorate([e.property()],d.prototype,"sourceSpatialReference",void 0);return d=c.__decorate([e.subclass("esri.tasks.QueryTask")],d)}(u)});