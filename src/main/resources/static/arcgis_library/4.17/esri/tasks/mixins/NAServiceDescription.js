// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../request ../../core/Error ../../core/maybe ../../core/object ../../core/urlUtils ../../core/accessorSupport/decorators ../Task".split(" "),function(n,g,b,p,q,y,z,A,x,B){function C(a){return b.__awaiter(this,void 0,void 0,function(){var f,d,k,c;return b.__generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,p(a+("/"===a[a.length-1]?"":"/")+"retrieveTravelModes",{query:{f:"json"}})];case 1:return f=e.sent().data,d=f.supportedTravelModes,
k=f.defaultTravelMode,[2,{supportedTravelModes:d,defaultTravelMode:k}];case 2:throw c=e.sent(),new q("network-service:retrieveTravelModes","Could not get to the NAServer's retrieveTravelModes.",{error:c});case 3:return[2]}})})}function D(a){return b.__awaiter(this,void 0,void 0,function(){var f,d,k,c,e,h,l,u,g,r,v,m,t,w,n,q;return b.__generator(this,function(b){switch(b.label){case 0:return[4,p(a.substring(0,a.indexOf("/rest/")+6)+"info",{query:{f:"json"}})];case 1:f=b.sent().data;if(!f||!f.owningSystemUrl)return[2,
{supportedTravelModes:[],defaultTravelMode:null}];a=f.owningSystemUrl;return[4,p(a+("/"===a[a.length-1]?"":"/")+"sharing/rest/portals/self",{query:{f:"json"}})];case 2:d=b.sent().data;k=z.getDeepValue("helperServices.routingUtilities.url",d);if(!k)return[2,{supportedTravelModes:[],defaultTravelMode:null}];c=A.urlToObject(a);e=/\/solveClosestFacility$/.test(c.path)?"Route":/\/solveClosestFacility$/.test(c.path)?"ClosestFacility":"ServiceAreas";return[4,p(k+("/"===k[k.length-1]?"":"/")+"GetTravelModes/execute",
{query:{f:"json",serviceName:e}})];case 3:h=b.sent();l=[];u=null;if(h&&h.data&&h.data.results&&h.data.results.length)for(g=h.data.results,r=0,v=g;r<v.length;r++)if(m=v[r],"supportedTravelModes"===m.paramName){if(m.value&&m.value.features)for(t=0,w=m.value.features;t<w.length;t++)if(n=w[t].attributes)q=JSON.parse(n.TravelMode),l.push(q)}else"defaultTravelMode"===m.paramName&&(u=m.value);return[2,{supportedTravelModes:l,defaultTravelMode:u}]}})})}Object.defineProperty(g,"__esModule",{value:!0});g.NAServiceDescription=
g.NAServiceDescriptionMixin=void 0;g.NAServiceDescriptionMixin=function(a){return function(a){function d(){return null!==a&&a.apply(this,arguments)||this}b.__extends(d,a);d.prototype.getServiceDescription=function(){return b.__awaiter(this,void 0,void 0,function(){return b.__generator(this,function(a){this._serviceDescriptionPromise||(this._serviceDescriptionPromise=this._fetchServiceDescription());return[2,this._serviceDescriptionPromise]})})};d.prototype._fetchServiceDescription=function(){return b.__awaiter(this,
void 0,void 0,function(){var a,c,e,h,l,d,f;return b.__generator(this,function(b){switch(b.label){case 0:if(!this.url||!this.parsedUrl)throw new q("network-service:missing-url","Url to Network service is missing");a=this.url;return[4,p(a,{query:{f:"json"}})];case 1:c=b.sent().data;c.supportedTravelModes||(c.supportedTravelModes=[]);for(e=0;e<c.supportedTravelModes.length;e++)c.supportedTravelModes[e].id||(c.supportedTravelModes[e].id=c.supportedTravelModes[e].itemId);h=10.4<=c.currentVersion?C(a):
D(a);return[4,h];case 2:return l=b.sent(),d=l.defaultTravelMode,f=l.supportedTravelModes,c.defaultTravelMode=d,c.supportedTravelModes=f,[2,c]}})})};d.prototype._isInputGeometryZAware=function(a,c){for(var e=0;e<c.length;e++){var b=a[c[e]];if(b&&b.length)for(var d=0;d<b.length;d++){var f=b[d];if(y.isSome(f)&&f.hasZ)return!0}}return!1};d.prototype._dropZValuesOffInputGeometry=function(a,b){for(var e=0;e<b.length;e++){var c=a[b[e]];if(c&&c.length)for(var d=0;d<c.length;d++)c[d].z=void 0}console.log("The remote Network Analysis service is powered by a network dataset which is not Z-aware.\nZ-coordinates of the input geometry are ignored.")};
return d=b.__decorate([x.subclass("esri.tasks.mixins.NAServiceDescription")],d)}(a)};n=function(a){function f(){return null!==a&&a.apply(this,arguments)||this}b.__extends(f,a);return f=b.__decorate([x.subclass("esri.tasks.mixins.NAServiceDescription")],f)}(g.NAServiceDescriptionMixin(B));g.NAServiceDescription=n});