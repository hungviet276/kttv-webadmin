// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../intl ../../PopupTemplate ../../core/Error ../../core/Handles ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../Popup/actions ../support/GeolocationPositioning ../support/geolocationUtils".split(" "),function(v,w,d,h,m,k,n,p,q,e,l,r,t){function u(){return d.__awaiter(this,void 0,void 0,function(){var b;return d.__generator(this,function(a){switch(a.label){case 0:return[4,h.loadMessageBundle("esri/widgets/Locate/t9n/Locate")];
case 1:return b=a.sent(),[2,new m({title:b.currentLocation,fieldInfos:[{fieldName:"timestamp",label:b.timestamp,format:{dateFormat:"short-date-short-time"}},{fieldName:"latitude",label:b.latitude,format:{places:4,digitSeparator:!0}},{fieldName:"longitude",label:b.longitude,format:{places:4,digitSeparator:!0}},{fieldName:"accuracy",label:b.accuracy,format:{places:0,digitSeparator:!0}},{fieldName:"altitude",label:b.altitude,format:{places:0,digitSeparator:!0}},{fieldName:"altitudeAccuracy",label:b.altitudeAccuracy,
format:{places:0,digitSeparator:!0}},{fieldName:"heading",label:b.heading,format:{places:0,digitSeparator:!0}},{fieldName:"speed",label:b.speed,format:{places:0,digitSeparator:!0}}],actions:[l.removeSelectedFeature.clone()],content:[{type:"fields"}]})]}})})}return function(b){function a(c){c=b.call(this,c)||this;c._locateController=null;c._handles=new n;c.locate=c.locate.bind(c);return c}d.__extends(a,b);a.prototype.initialize=function(){var c=this;this._handles.add([q.on(this,"view.popup","trigger-action",
function(a){return l.triggerAction({event:a,view:c.view})}),h.onLocaleChange(function(){var a,b=c.graphic,g=c.view;(null===(a=null===g||void 0===g?void 0:g.graphics)||void 0===a?0:a.includes(b))&&c._updatePopupTemplate(b)})])};a.prototype.destroy=function(){this.cancelLocate();this._handles.destroy();this._handles=null};Object.defineProperty(a.prototype,"state",{get:function(){return this._geolocationUsable?this.get("view.ready")?this._locateController?"locating":"ready":"disabled":"feature-unsupported"},
enumerable:!1,configurable:!0});a.prototype.locate=function(){return d.__awaiter(this,void 0,void 0,function(){var a,b,f;return d.__generator(this,function(c){switch(c.label){case 0:this.cancelLocate();if("disabled"===this.state)throw new k("locate:disabled-state","Cannot locate when disabled.");if("feature-unsupported"===this.state)throw new k("locate:feature-unsupported-state","Cannot locate in unsecure domain.");this._locateController=a=p.createAbortController();c.label=1;case 1:return c.trys.push([1,
6,,7]),[4,t.getCurrentPosition(this.geolocationOptions)];case 2:return b=c.sent(),[4,this._setPosition(b,{signal:a.signal})];case 3:b=c.sent();if(this._locateController!==a)return[2,null];if(!this.graphic)return[3,5];this.graphic=this.graphic.clone();return[4,this._updatePopupTemplate(this.graphic)];case 4:c.sent(),this.view.graphics.push(this.graphic),c.label=5;case 5:return this.emit("locate",{position:b}),this._locateController=null,[2,b];case 6:throw f=c.sent(),this._locateController=null,this.emit("locate-error",
{error:f}),f;case 7:return[2]}})})};a.prototype.cancelLocate=function(){this._clear();this._locateController&&this._locateController.abort();this._locateController=null};a.prototype._updatePopupTemplate=function(a){return d.__awaiter(this,void 0,void 0,function(){var b,c;return d.__generator(this,function(d){switch(d.label){case 0:return[4,u()];case 1:b=d.sent();c=a!==this.graphic;if(this.destroyed||c)return[2];a.popupTemplate=b;return[2]}})})};d.__decorate([e.property()],a.prototype,"_locateController",
void 0);d.__decorate([e.property({dependsOn:["view.ready","_locateController","_geolocationUsable"],readOnly:!0})],a.prototype,"state",null);d.__decorate([e.property()],a.prototype,"locate",null);d.__decorate([e.property()],a.prototype,"cancelLocate",null);return a=d.__decorate([e.subclass("esri.widgets.Locate.LocateViewModel")],a)}(r)});