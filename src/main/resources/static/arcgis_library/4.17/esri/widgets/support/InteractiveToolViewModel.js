// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Accessor ../../core/Error ../../core/Handles ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../views/interactive/interactiveToolUtils".split(" "),function(f,e,d,m,n,p,q,r,c,t){Object.defineProperty(e,"__esModule",{value:!0});e.InteractiveToolViewModel=void 0;f=function(e){function a(b){var a=e.call(this,b)||this;a.tool=null;a._baseHandles=new p;a._loggedUnsupportedErrorOnce=!1;a._creationAbortController=null;b&&null!=
b.visible&&(a.visible=b.visible);return a}d.__extends(a,e);a.prototype.initialize=function(){var b=this;this._baseHandles.add(r.init(this,["view.ready","isSupported"],function(){b.view&&b.view.ready&&!b.isSupported?b._loggedUnsupportedErrorOnce||(b.logUnsupportedError(),b._loggedUnsupportedErrorOnce=!0):b._loggedUnsupportedErrorOnce=!1}))};a.prototype.destroy=function(){this.removeTool();this.view=null;this._baseHandles.destroy();this._baseHandles=null};Object.defineProperty(a.prototype,"isSupported",
{get:function(){return!this.view||this.view.type===this.supportedViewType},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"view",{get:function(){return this._get("view")},set:function(b){var a=this;b!==this.view&&(this.removeTool(),this._set("view",b),this._baseHandles.remove("tools"),b&&this._baseHandles.add(b.tools.on("change",function(b){if(a.tool){var d=0;for(b=b.removed;d<b.length;d++){var c=b[d];if(a.tool===c){c.destroyed||c.destroy();a._set("tool",null);break}}}}),"tools"))},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"visible",{set:function(b){this._set("visible",b);this.tool&&(this.tool.visible=b);!b&&this._creationAbortController&&(this._creationAbortController.abort(),this._creationAbortController=null)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"active",{get:function(){return null!=this._creationAbortController||null!=this.tool&&this.tool.active},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isDisabled",
{get:function(){return!this.view||!this.view.ready||!this.isSupported},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"creatingTool",{get:function(){return!!this._creationAbortController},enumerable:!1,configurable:!0});a.prototype.createTool=function(){return d.__awaiter(this,void 0,void 0,function(){var b,a,c,e,h,f,l,k=this;return d.__generator(this,function(g){switch(g.label){case 0:this.removeTool();if(!this.isSupported)return[2,q.reject(new n("tool:create","The view does not support the tool"))];
b=this.createToolParams();a=function(){var a=t.evaluateToolConstructorArguments(b.constructorArguments);return d.__assign({visible:k.visible},a)};c=new AbortController;e=c.signal;this._creationAbortController=c;h=function(){c===k._creationAbortController&&(k._creationAbortController=null)};g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.view.createTool(b.toolConstructor,a,{signal:e})];case 2:return f=g.sent(),this._set("tool",f),h(),[3,4];case 3:throw l=g.sent(),h(),l;case 4:return[2]}})})};
a.prototype.removeTool=function(){this._creationAbortController&&this._creationAbortController.abort();this._creationAbortController=null;var a=this.tool;a&&(this.view&&this.view.tools&&this.view.tools.remove(a),a.destroyed||a.destroy(),this._set("tool",null))};d.__decorate([c.property({constructOnly:!0})],a.prototype,"tool",void 0);d.__decorate([c.property({dependsOn:["view.type"]})],a.prototype,"isSupported",null);d.__decorate([c.property({value:null})],a.prototype,"view",null);d.__decorate([c.property({type:Boolean,
value:!0})],a.prototype,"visible",null);d.__decorate([c.property({dependsOn:["_creationAbortController","tool.active"]})],a.prototype,"active",null);d.__decorate([c.property({dependsOn:["view","view.ready","isSupported"]})],a.prototype,"isDisabled",null);d.__decorate([c.property()],a.prototype,"_creationAbortController",void 0);d.__decorate([c.property({readOnly:!0,dependsOn:["_creationAbortController"]})],a.prototype,"creatingTool",null);return a=d.__decorate([c.subclass("esri.widgets.support.InteractiveToolViewModel")],
a)}(m);e.InteractiveToolViewModel=f});