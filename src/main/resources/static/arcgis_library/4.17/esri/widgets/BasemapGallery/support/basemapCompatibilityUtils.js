// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../layers/support/layerUtils ../../../views/3d/terrain/terrainUtils ../../../views/3d/terrain/TilingScheme ../../../views/support/spatialReferenceSupport".split(" "),function(D,d,b,x,f,l,y,t,z,A){function n(){throw new f("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view");}function B(u,c){return b.__awaiter(this,void 0,void 0,
function(){var a,v,h,k,q,p,d,l,r,n,w;return b.__generator(this,function(e){switch(e.label){case 0:return a=u.basemap,v=u.view,[4,a.load(c)];case 1:e.sent();if(0===a.baseLayers.length)return[2,void 0];h=a.baseLayers.concat(a.referenceLayers);k=C(h);if(k.length)throw k[0];q=x.typeCast(a.baseLayers.getItemAt(0))();e.label=2;case 2:return e.trys.push([2,4,,5]),[4,q.load(c)];case 3:return e.sent(),[3,5];case 4:throw p=e.sent(),d=p.name,l=void 0===d?"basemap-compatibility:unknown-error":d,r=p.message,n=
void 0===r?"Unknown basemap compatibility error":r,w=p.details,new f(l,n,w);case 5:e=q;var b=v,m=e.tileInfo;if(m){var g=b.viewingMode;if(g){if(!A.isSpatialReferenceSupported(m.spatialReference,g))throw new f("basemapgalleryitem:spatial-reference-unsupported-"+g,"Basemap spatial reference is unsupported in "+g+" mode");if("global"===g){if((g=t.checkIfTileInfoSupportedForView(m,e.fullExtent,null,1))&&e.compatibleTileInfo256&&!t.checkIfTileInfoSupportedForView(e.compatibleTileInfo256,e.fullExtent,null,
1)&&(g=null),g)throw new f("basemapgalleryitem:tiling-scheme-unsupported-"+(m.spatialReference.isWebMercator?"web-mercator":"wgs84")+"-global","Basemap tiling scheme is unsupported in global mode",{error:g});}else if(z.checkUnsupported(m))throw new f("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");b=b.get("basemapTerrain.tilingScheme");if(!(!b||b.compatibleWith(m)||e.compatibleTileInfo256&&b.compatibleWith(e.compatibleTileInfo256)))throw new f("basemapgalleryitem:tiling-scheme-incompatible",
"Basemap tiling scheme is incompatible with the view");}}return[2]}})})}function C(b){var c=["ArcGISTiledImageServiceLayer","ArcGISTiledMapServiceLayer","OpenStreetMap","VectorTileLayer","WebTiledLayer"];return b.toArray().filter(function(a){return-1===c.indexOf(a.operationalLayerType)}).map(function(a){return new f("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:a,operationalLayerType:a.operationalLayerType||"unknown"})})}Object.defineProperty(d,
"__esModule",{value:!0});d.default2DCompatibility=d.default3DCompatibility=void 0;d.default3DCompatibility=function(d,c){void 0===c&&(c={});return b.__awaiter(this,void 0,void 0,function(){return b.__generator(this,function(a){switch(a.label){case 0:return[4,B(d,c)];case 1:return a.sent(),l.throwIfAborted(c),[2]}})})};d.default2DCompatibility=function(d,c){void 0===c&&(c={});return b.__awaiter(this,void 0,void 0,function(){var a,f,h,k;return b.__generator(this,function(b){switch(b.label){case 0:return a=
d.basemap,f=d.view,[4,a.load(c)];case 1:b.sent();l.throwIfAborted(c);if(0===a.baseLayers.length)return[2,void 0];h=a.baseLayers.getItemAt(0);if(!y.isTiledLayer(h))return[2,void 0];if(a.spatialReference){if(f.spatialReference.equals(a.spatialReference))return[2,void 0];n()}return[4,h.load(c)];case 2:b.sent();l.throwIfAborted(c);k=(h.get("supportedSpatialReferences")||[h.get("tileInfo.spatialReference")]).filter(Boolean);if(0===k.length)return[2,void 0];k.every(function(a){return!f.spatialReference.equals(a)})&&
n();return[2,void 0]}})})}});