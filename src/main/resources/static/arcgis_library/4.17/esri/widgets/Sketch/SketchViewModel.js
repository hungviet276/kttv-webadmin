// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../geometry ../../Graphic ../../symbols ../../core/Collection ../../core/compilerUtils ../../core/Error ../../core/Evented ../../core/Handles ../../core/Logger ../../core/maybe ../../core/screenUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/coordsUtils ../../geometry/support/geodesicConstants ../../layers/GraphicsLayer ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ../../symbols/SimpleMarkerSymbol ../../views/DOMContainer ../../views/3d/interactive/editingTools/isSupportedGraphicUtils ../../views/3d/interactive/editingTools/moveGraphic/isSupportedGraphic ../../views/3d/interactive/editingTools/reshapeGraphic/isSupportedGraphic ../../views/3d/interactive/editingTools/transformGraphic/isSupportedGraphic ../../views/draw/Draw ../../views/draw/support/createUtils ../../views/draw/support/layerUtils ../../views/input/InputManager ./support/OperationHandle @dojo/framework/shim/Promise".split(" "),
function(C,ha,f,I,z,D,U,V,W,X,N,Y,t,E,G,r,O,Z,aa,L,M,H,ba,P,ca,Q,da,ea,w,R,u,F){function J(f,d){var a=f.history.undo.pop().updates,b=[];d.forEach(function(c,e){e=a[e];var h={};null!=e&&(t.isSome(e.geometry)&&(h.geometry=c.geometry,c.geometry=e.geometry),t.isSome(e.symbol)&&(h.symbol=c.symbol,c.symbol=e.symbol),b.push(h))});f.history.redo.push({updates:b})}function K(f,d){var a=f.history.redo.pop().updates,b=[];d.forEach(function(c,e){e=a[e];var h={};null!=e&&(t.isSome(e.geometry)&&(h.geometry=c.geometry,
c.geometry=e.geometry),t.isSome(e.symbol)&&(h.symbol=c.symbol,c.symbol=e.symbol),b.push(h))});f.history.undo.push({updates:b})}function B(f){return{updates:f.map(function(d){return{geometry:d.geometry}})}}function T(f){return{updates:f.map(function(d){return{symbol:d.symbol}})}}function A(f){return"requireError"in f&&"aborted"===f.requireError}var fa=Y.getLogger("esri.widgets.Sketch.SketchViewModel"),ga=["Backspace","Delete"];return function(S){function d(a){a=S.call(this,a)||this;a._activeFillGraphic=
null;a._activeLineGraphic=null;a._centerIndicatorGraphic=null;a._centerSymbol=new H({style:"cross",size:6,color:[255,255,255]});a._defaultSegmentOffset=48;a._numUpdating=0;a._handles=new N;a._internalGraphicsLayer=new aa({listMode:"hide"});a._lineGraphic=null;a._operationHandle=null;a._vertexGraphics=[];a._viewHandles=new N;a._doUnnormalization=!1;a.activeFillSymbol=new L({style:"solid",color:[150,150,150,.2],outline:{color:[0,0,0,0]}});a.activeLineSymbol=new M({color:[12,207,255,1],width:2,style:"dash"});
a.activePointSymbol=new H({style:"circle",size:6,color:[12,207,255],outline:{color:[50,50,50],width:1}});a.activeVertexSymbol=new H({style:"circle",size:6,color:[12,207,255],outline:{color:[50,50,50],width:1}});a.createGraphic=null;a.defaultCreateOptions={mode:"hybrid"};a.defaultUpdateOptions={enableMidpoints:!0,enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,tool:"transform",enableZ:!0};a.layer=null;a.pointSymbol=
new H({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}});a.polygonSymbol=new L({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}});a.polylineSymbol=new M({color:[130,130,130,1],width:2});a.updateGraphics=new U;a.updateOnGraphicClick=!0;a.updatePointSymbol=new H({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}});a.updatePolygonSymbol=new L({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}});a.updatePolylineSymbol=new M({color:[12,
207,255],width:2});a.vertexSymbol=new H({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}});a._originalAutoOpenEnabled=null;return a}f.__extends(d,S);d.prototype.initialize=function(){var a=this;this._handles.add([G.watch(this,"layer",function(){a.cancel();a._internalGraphicsLayer.elevationInfo=t.isSome(a.layer)?a.layer.elevationInfo:null}),G.on(this,"view.map.layers","change",function(b){0<=b.removed.indexOf(a.layer)&&a.cancel()}),G.on(this,"layer.graphics","change",function(b){if(t.isSome(a._operationHandle)){var c=
0;for(b=b.removed;c<b.length;c++){var e=b[c];a.updateGraphics.includes(e)&&(1<a.updateGraphics.length?a._operationHandle.removeFromSelection(e):a._operationHandle.cancel())}}}),G.init(this,"layer.elevationInfo",function(){a.cancel();a._internalGraphicsLayer.elevationInfo=t.isSome(a.layer)?a.layer.elevationInfo:null},!0)])};d.prototype.destroy=function(){this.cancel();this._handles.removeAll();this._handles=null;this._viewHandles.removeAll();this._viewHandles=null;this._removeDefaultLayer();this._draw&&
this._draw.destroy();this._set("view",null);this.emit("destroy")};Object.defineProperty(d.prototype,"_defaultUpdateTool",{get:function(){return"3d"===this.view.type?"move":"transform"},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"_draw",{get:function(){return"ready"===this.state||"active"===this.state?new ea({view:this.view}):null},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return 0<this._numUpdating},enumerable:!1,configurable:!0});
Object.defineProperty(d.prototype,"activeTool",{get:function(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"activeComponent",{get:function(){return this._operationHandle?this._operationHandle.activeComponent:null},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"state",{get:function(){var a=!(!this.get("view.ready")||!this.layer),b=this._operationHandle;return a&&b?"active":
a?"ready":"disabled"},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"view",{get:function(){return this._get("view")},set:function(a){var b=this,c=this._get("view");if(c){var e=c.map;c.container&&(c.cursor=null);e&&e.remove(this._internalGraphicsLayer);this._viewHandles.removeAll();this.cancel()}this._doUnnormalization=null!=a&&"3d"===a.type&&"global"===a.viewingMode;this._handles.remove("view-ready");a&&this._handles.add(G.when(a,"ready",function(c){b._viewHandles.removeAll();
c&&b._viewHandles.add(b._generateViewHandles(a))},!0),"view-ready");this._set("view",a)},enumerable:!1,configurable:!0});d.prototype.cancel=function(){this._moduleLoaderAbortController&&(this._moduleLoaderAbortController.abort(),this._moduleLoaderAbortController=null);this._operationHandle&&this._operationHandle.cancel()};d.prototype.complete=function(){this._operationHandle&&this._operationHandle.complete()};d.prototype.delete=function(){var a=this.updateGraphics;if("active"===this.state&&a.length){var b=
this.activeTool,c=this.layer,a=a.toArray();c.removeMany(a);this.cancel();this._emitDeleteEvent({graphics:a,tool:b})}};d.prototype.create=function(a,b){return f.__awaiter(this,void 0,void 0,function(){var c,e,h=this;return f.__generator(this,function(p){switch(p.label){case 0:if("disabled"===this.state)return this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),
[2];this.cancel();return a?[4,this._setupCreateOperation(a,b)]:(this._logError("sketch:missing-parameter","Missing parameter 'tool'."),[2]);case 1:c=p.sent();if(t.isNone(c))return[2];R.addUniqueLayer(this.view,this._internalGraphicsLayer);e=function(){if(c===h._operationHandle){var e=h.createGraphic,b=h._operationHandle.cancelled;h._operationHandle.destroy();h._operationHandle=null;h._set("createGraphic",null);h.view&&h.view.map&&h.view.map.remove(h._internalGraphicsLayer);c.cancelled||h.layer.add(e);
h.emit("create",{graphic:e,state:b?"cancel":"complete",tool:a,toolEventInfo:null,type:"create"})}};c.on("complete",e);this._operationHandle=c;this.view.ready&&ba.isDOMContainer(this.view)&&this.view.focus();return[2]}})})};d.prototype.update=function(a,b){return f.__awaiter(this,void 0,void 0,function(){var c,e,h,p,g,d,k,m=this;return f.__generator(this,function(f){switch(f.label){case 0:c=this;e=c.layer;h=c.state;p=c.view;if("disabled"===h)return e||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),
p||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),[2];this.cancel();g=Array.isArray(a)?a:[a];return null!=a&&g&&g.length?(d=g.some(function(a){return a.layer!==e?(m._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):t.isNone(a.geometry)?(m._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):"2d"!==
p.type||p.spatialReference.equals(a.geometry.spatialReference)?!1:(m._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with a spatial reference different from the supplied MapView."),!0)}))?[2]:[4,this._setupUpdateOperation(g,b)]:(this._logError("sketch:missing-parameter","Missing parameter 'graphics'."),[2]);case 1:k=f.sent();if(t.isNone(k)||A(k))return[2];R.addUniqueLayer(this.view,this._internalGraphicsLayer);this.emit("update",{graphics:g,state:"start",aborted:!1,
tool:k.tool,toolEventInfo:null,type:"update"});this._setUpdateOperationHandle(k);return[2]}})})};d.prototype.undo=function(){this.canUndo()&&this._operationHandle.undo()};d.prototype.redo=function(){this.canRedo()&&this._operationHandle.redo()};d.prototype.canUndo=function(){return!(!this._operationHandle||!this._operationHandle.canUndo())};d.prototype.canRedo=function(){return!(!this._operationHandle||!this._operationHandle.canRedo())};d.prototype.toggleUpdateTool=function(){this._operationHandle&&
this._operationHandle.toggleTool&&this._operationHandle.toggleTool()};Object.defineProperty(d.prototype,"snapToScene",{set:function(a){this._operationHandle&&this._operationHandle.setSnapToScene&&this._operationHandle.setSnapToScene(a);this._set("snapToScene",a)},enumerable:!1,configurable:!0});d.prototype._getFirstHit=function(a){var b,c;return f.__awaiter(this,void 0,void 0,function(){var e,h,p,g,d,k;return f.__generator(this,function(m){switch(m.label){case 0:e=[];h=this.view.type;switch(h){case "2d":return[3,
1];case "3d":return[3,3]}return[3,5];case 1:return[4,this.view.hitTest(a)];case 2:return p=m.sent(),0<p.results.length&&(g=p.results[0],g.graphic&&(d=g.graphic,"vector-tile"!==(null===(b=d.layer)||void 0===b?void 0:b.type)&&"imagery"!==(null===(c=d.layer)||void 0===c?void 0:c.type)&&e.push(g))),[3,5];case 3:return k=[this.view.map.ground],this.view.map.allLayers.forEach(function(a){"integrated-mesh"===a.type&&k.push(a)}),[4,this.view.hitTest(a,{exclude:k})];case 4:return p=m.sent(),0<p.results.length&&
(g=p.results[0],(!p.ground||1>this.view.map.ground.opacity||p.ground.distance-g.distance>-Math.min(3*p.ground.distance,"global"===this.view.viewingMode?Z.earthRadius/this.view.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY))&&e.push(g)),[3,5];case 5:return[2,{screenPoint:a,results:e}]}})})};d.prototype._generateViewHandles=function(a){var b=this;return[a.on("immediate-click",function(c){var e=b._operationHandle,h=b.defaultUpdateOptions,p=b.layer,g=b.state,d=b.updateGraphics,k=b.updateOnGraphicClick,
e="active"===g&&"create"===e.type;"disabled"!==g&&!e&&k&&(b._beginAsyncOperation(),b._getFirstHit(E.createScreenPointFromEvent(c)).then(function(e){e=e.results;if(e.length)for(var k=0;k<e.length;++k){var l=e[k];if(l.graphic){l=l.graphic;if(-1<d.indexOf(l)||l.layer===p)return c.stopPropagation(),l;"2d"!==a.type||b._isComponentGraphic(l)||"active"!==g||b.cancel()}}else"active"===g&&b.cancel();return null}).then(function(a){return t.isSome(a)&&-1===d.indexOf(a)?b.update([a],f.__assign({},h)):null}).then(function(){b._endAsyncOperation()}))},
u.ViewEventPriorities.WIDGET)]};d.prototype._setupCreateOperation=function(a,b){return f.__awaiter(this,void 0,void 0,function(){var c,e,h;return f.__generator(this,function(p){switch(p.label){case 0:if(!a)return[2,null];c=f.__assign(f.__assign({hasZ:"3d"===this.view.type,defaultZ:0},this.defaultCreateOptions),b);if("2d"!==this.view.type)return[3,1];switch(a){case "point":e=this._setupCreatePointOperation(a,c);break;case "multipoint":e=this._setupCreateMultipointOperation(a,null);break;case "polygon":e=
this._setupCreatePolyOperation(a,c);break;case "polyline":e=this._setupCreatePolyOperation(a,c);break;case "rectangle":e=this._setupCreateRectangleOperation(a,c);break;case "circle":e=this._setupCreateCircleOperation(a,c)}return[3,3];case 1:return[4,this._setupCreate3DOperation(a,this.view,c)];case 2:h=p.sent();if(t.isNone(h)||A(h))return[2,null];e=h;p.label=3;case 3:return[2,e]}})})};d.prototype._setupCreate3DOperation=function(a,b,c){return f.__awaiter(this,void 0,void 0,function(){var e,h,p,g,
d,k,m,n,l=this;return f.__generator(this,function(x){switch(x.label){case 0:if(!a||"multipoint"===a)return[2,null];e={point:this.pointSymbol,multipoint:null,polyline:this.polylineSymbol,polygon:this.polygonSymbol,rectangle:this.polygonSymbol,circle:this.polygonSymbol};h=e[a];this._removeCreateOperationGraphics();p=f.__assign(f.__assign(f.__assign({view:b,hasZ:!0,defaultZ:0,mode:"hybrid",elevationInfo:this.layer.elevationInfo,geometryType:a},this.defaultCreateOptions),c),{createGraphicSymbol:h,snapToScene:this._getDefaultSnapToScene(),
forceUniformSize:!1,centered:"rectangle"===a?!1:!0});return[4,this._requireModule(new Promise(function(a,c){C(["../../views/3d/interactive/editingTools"],a,c)}))];case 1:g=x.sent();if(A(g))return[2,g];d=new g.module.DrawGraphicTool(p);this.view.tools.add(d);k=null;this.view.activeTool=d;m=[];n=new F.OperationHandle({activeComponent:d,tool:a,type:"update",onEnd:function(){var a;m.forEach(function(a){return a.remove()});m.length=0;null===(a=l.view.tools)||void 0===a?void 0:a.remove(d);d.destroy()},
undo:function(){d.canUndo&&d.undo()},redo:function(){d.canRedo&&d.redo()},canUndo:function(){return d.canUndo},canRedo:function(){return d.canRedo},setSnapToScene:function(a){d.snapToScene=a}});m.push(this.view.on("key-down",function(c){" "===c.key?(c.stopPropagation(),c.repeat||(d.enabled=!1)):"c"===c.key?(c.stopPropagation(),d.completeCreateOperation()):"z"===c.key?(c.stopPropagation(),n.undo()):"r"===c.key?(c.stopPropagation(),n.redo()):"Control"===c.key?c.repeat||(d.forceUniformSize=!0,c.stopPropagation()):
"Alt"!==c.key||c.repeat||(d.centered="rectangle"===a?!0:!1,c.stopPropagation())},u.ViewEventPriorities.WIDGET),this.view.on("key-up",function(c){" "===c.key?d.enabled=!0:"Control"===c.key?(d.forceUniformSize=!1,c.stopPropagation()):"Alt"===c.key&&(d.centered="rectangle"===a?!1:!0,c.stopPropagation())},u.ViewEventPriorities.WIDGET),d.on("vertex-add",function(c){k=t.isNone(k)?"start":"active";switch(c.operation){case "apply":l.emit("create",{graphic:t.unwrap(d.createGraphic),state:k,tool:l.activeTool,
toolEventInfo:c,type:"create"});break;case "undo":l._emitUndoEvent({graphics:[t.unwrap(d.createGraphic)],tool:a});break;case "redo":l._emitRedoEvent({graphics:[t.unwrap(d.createGraphic)],tool:a})}}),d.on("cursor-update",function(a){0<d.drawOperation.numCommittedVertices&&l.emit("create",{graphic:t.unwrap(d.createGraphic),state:"active",tool:l.activeTool,toolEventInfo:{coordinates:a.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),d.on("vertex-remove",function(c){switch(c.operation){case "apply":l.emit("create",
{graphic:t.unwrap(d.createGraphic),state:"active",tool:l.activeTool,toolEventInfo:c,type:"create"});break;case "undo":l._emitUndoEvent({graphics:[t.unwrap(d.createGraphic)],tool:a});break;case "redo":l._emitRedoEvent({graphics:[t.unwrap(d.createGraphic)],tool:a})}}),d.on("complete",function(a){l._removeCreateOperationGraphics();l._set("createGraphic",t.unwrap(a.graphic));k="complete";a.aborted?n&&n.cancel():n&&n.complete()}));return[2,n]}})})};d.prototype._setupCreatePointOperation=function(a,b){var c=
this;b=this._draw.create(a,{elevationInfo:this.layer.elevationInfo,hasZ:b.hasZ,defaultZ:b.defaultZ,interactiveUndoDisabled:!0});var e=[b.on("cursor-update",function(a){t.isSome(a.vertexIndex)?c._displayCrosshairCursor():c._displayDefaultCursor()}),b.on("draw-complete",function(a){a=c.createPointFromVertex(a.vertices[0]);a=new z(a,c.pointSymbol);c._set("createGraphic",a);d&&d.complete()})],h=[this.view.on("key-down",function(a){"Escape"===a.key&&(d&&d.cancel(),a.stopPropagation())},u.ViewEventPriorities.WIDGET)],
d=this._operationHandleForCreateAction(b,f.__spreadArrays(e,h),a);return d};d.prototype._setupCreateMultipointOperation=function(a,b){var c=this;b=f.__assign(f.__assign({},b),{undoDisabled:!0});b=this._draw.create(a,b);var e=null,h=[],d=this._operationHandleForCreateAction(b,h,a);h.push(b.on("vertex-add",function(b){var h=b.type,k=b.vertexIndex,d=b.vertices,g=d[k];e=b;c._drawMultipointGraphic(d,!0);c.emit("create",{graphic:c.createGraphic,state:1===d.length?"start":"active",tool:a,toolEventInfo:{added:g,
vertices:[{coordinates:g,componentIndex:0,vertexIndex:k}],type:h},type:"create"})}),b.on("vertex-remove",function(b){var h=b.type,k=b.vertexIndex,d=b.vertices,g=d[k];e=b;c._drawMultipointGraphic(d,!0);c.emit("create",{graphic:c.createGraphic,state:"active",tool:a,toolEventInfo:{removed:g,vertices:[{coordinates:g,componentIndex:0,vertexIndex:k}],type:h},type:"create"})}),b.on("vertex-update",function(b){var h=b.type,k=b.vertexIndex,d=b.vertices,g=d[k];e=b;c._drawMultipointGraphic(d,!0);c.emit("create",
{graphic:c.createGraphic,state:"active",tool:a,toolEventInfo:{type:h,updated:g,vertices:[{coordinates:g,componentIndex:0,vertexIndex:k}]},type:"create"})}),b.on("cursor-update",function(a){e=a}),b.on("draw-complete",function(a){a=a.vertices.slice(0);(a=w.createMultipoint(a,c.view.spatialReference))&&c.createGraphic&&(c.createGraphic.geometry=a);d&&d.complete()}),b.on("undo",function(a){a=a.vertices;var b=e&&"cursor-update"!==e.type;c._resetCreateOperationGraphics();a.length&&c._drawMultipointGraphic(a,
b)}),b.on("redo",function(a){a=a.vertices;var b=e&&"cursor-update"!==e.type;c._resetCreateOperationGraphics();a.length&&c._drawMultipointGraphic(a,b)}));h.push(this.view.on("pointer-move",function(){return c._displayCrosshairCursor()},u.ViewEventPriorities.WIDGET),this.view.on("key-down",function(a){return c._getCommonUpdateOperationKeyDownHandlers(d,a)},u.ViewEventPriorities.WIDGET));return d};d.prototype._getDefaultSnapToScene=function(){if("2d"===this.view.type)return!1;var a=null;return a=t.isSome(this.snapToScene)?
this.snapToScene:t.isSome(this.layer.elevationInfo)?"absolute-height"===this.layer.elevationInfo.mode:!0};d.prototype._setupCreatePolyOperation=function(a,b){var c=this;b=f.__assign(f.__assign({},b),{elevationInfo:this.layer.elevationInfo,interactiveUndoDisabled:!0});var e=null;"polyline"===a?e=this._draw.create(a,b):"polygon"===a&&(e=this._draw.create(a,b));var h=new I.Point,d=null,g=!1;b=[e.on("vertex-add",function(b){var e=b.type,k=b.vertexIndex,h=b.vertices,l=h[k];c._snap(a,h,g);d=b;c._drawVertexGraphics(a,
h,{userClicked:!0});c.emit("create",{graphic:c.createGraphic,state:1===h.length?"start":"active",tool:a,toolEventInfo:{added:l,vertices:[{coordinates:l,componentIndex:0,vertexIndex:k}],type:e},type:"create"})}),e.on("vertex-remove",function(b){var e=b.type,k=b.vertexIndex,h=b.vertices,l=h[k];c._snap(a,h,g);d=b;c._drawVertexGraphics(a,h,{userClicked:!0});c.emit("create",{graphic:c.createGraphic,state:"active",tool:a,toolEventInfo:{removed:l,vertices:[{coordinates:l,componentIndex:0,vertexIndex:k}],
type:e},type:"create"})}),e.on("vertex-update",function(b){var e=b.type,k=b.vertexIndex,h=b.vertices,l=h[k];c._snap(a,h,g);d=b;c._drawVertexGraphics(a,h,{userClicked:!0});c.emit("create",{graphic:c.createGraphic,state:"active",tool:a,toolEventInfo:{type:e,updated:l,vertices:[{coordinates:l,componentIndex:0,vertexIndex:k}]},type:"create"})}),e.on("cursor-update",function(b){var e=b.type,k=b.vertices;b.mapPoint&&(c._snap(a,k,g),d=b,h=b.mapPoint,c._drawVertexGraphics(a,k,{userClicked:!1}),1<k.length&&
c.emit("create",{graphic:c.createGraphic,state:"active",tool:a,toolEventInfo:{coordinates:k[k.length-1],type:e},type:"create"}))}),e.on("draw-complete",function(b){b=b.vertices.slice(0);var e=null;"polyline"===a?e=w.createPolyline([b],c.view.spatialReference,c._doUnnormalization):"polygon"===a&&(e=w.createPolygon([b],c.view.spatialReference,c._doUnnormalization,!0));e&&(c.createGraphic.geometry=e);n&&n.complete()}),e.on("undo",function(b){b=b.vertices;var e=d&&"cursor-update"!==d.type;c._resetCreateOperationGraphics();
c._snap(a,b,g);b.length&&c._drawVertexGraphics(a,b,{userClicked:e})}),e.on("redo",function(b){b=b.vertices;var e=d&&"cursor-update"!==d.type;c._resetCreateOperationGraphics();c._snap(a,b,g);b.length&&c._drawVertexGraphics(a,b,{userClicked:e})})];var q=[this.view.on("pointer-move",function(a){c.view.toMap(E.createScreenPoint(a.x,a.y))?c._displayCrosshairCursor():c._displayDefaultCursor()},u.ViewEventPriorities.WIDGET),this.view.on("key-down",function(b){var k=e.vertices.slice(0),h=d&&"cursor-update"!==
d.type;"Control"===b.key?"2d"!==c.view.type||g||(g=!0,c._snap(a,k,!h),c._drawVertexGraphics(a,k,{userClicked:h})):"z"===b.key&&n&&n.canUndo()?(b.stopPropagation(),n.undo()):"r"===b.key&&n&&n.canRedo()?(b.stopPropagation(),n.redo()):"Escape"===b.key&&n&&n.cancel()},u.ViewEventPriorities.WIDGET),this.view.on("key-up",function(b){var k=e.vertices.slice(0),l=d&&"cursor-update"!==d.type;"Control"===b.key&&g&&(l||(k.pop(),k.push([h.x,h.y]),c._drawVertexGraphics(a,k,{userClicked:l})),g=!1)},u.ViewEventPriorities.WIDGET)];
if("polygon"===a){var k=function(a,b,e){if(!a||!a.layer||!a.visible)return!1;a=c.view.toScreen(a.geometry);return c._isWithinScreenDistance(a,b,e)},m=!1;q.push(this.view.on("pointer-move",function(){m=!1},u.ViewEventPriorities.WIDGET),this.view.on("pointer-down",function(a){var b;b=2>=c._vertexGraphics.length?void 0:k(c._vertexGraphics[0],a,c._getVertexIntersectDistance());b?(m=!0,a.stopPropagation()):c._vertexGraphics.some(function(b){return k(b,a,c._getVertexIntersectDistance())})&&a.stopPropagation()},
u.ViewEventPriorities.WIDGET),this.view.on("pointer-up",function(a){m&&(a.stopPropagation(),e.complete())}))}var n=this._operationHandleForCreateAction(e,f.__spreadArrays(b,q),a);return n};d.prototype._setupCreateCircleOperation=function(a,b){var c=this;b=f.__assign(f.__assign({},b),{elevationInfo:this.layer.elevationInfo,interactiveUndoDisabled:!0});var e=this._draw.create(a,b),h=!1,d=!0;b=[e.on("vertex-add",function(b){var k=b.type,g=b.vertexIndex;b=b.vertices;var l=b[g];c._drawSegmentGraphic(a,
b,{centered:d,constrained:h},e.viewAlignedCoordinateSystem);c.emit("create",{graphic:c.createGraphic,state:1===b.length?"start":"active",tool:a,toolEventInfo:{added:l,vertices:[{coordinates:l,componentIndex:0,vertexIndex:g}],type:k},type:"create"})}),e.on("cursor-update",function(b){var k=b.type;b=b.vertices;c._drawSegmentGraphic(a,b,{centered:d,constrained:h},e.viewAlignedCoordinateSystem);2===b.length&&c.emit("create",{graphic:c.createGraphic,state:"active",tool:a,toolEventInfo:{coordinates:b[b.length-
1],type:k},type:"create"})}),e.on("draw-complete",function(a){a=a.vertices.slice(0);var b=null;1===a.length?(a.push(e.viewAlignedCoordinateSystem.makeMapPoint(a[0][0]+c._defaultSegmentOffset*c.view.resolution,a[0][1])),b=w.createCircle(a,e.viewAlignedCoordinateSystem,!0,c.view.resolution)):b=h?w.createEllipse(a,e.viewAlignedCoordinateSystem,d):w.createCircle(a,e.viewAlignedCoordinateSystem,d,c.view.resolution);c.createGraphic?c.createGraphic.geometry=b:(c._removeCreateGraphic(),c._set("createGraphic",
new z(b,c.polygonSymbol)));q&&q.complete()})];var g=[this.view.on("pointer-move",function(a){t.isSome(e.getCoordsFromScreenPoint(E.createScreenPoint(a.x,a.y)))?c._displayCrosshairCursor():c._displayDefaultCursor()},u.ViewEventPriorities.WIDGET),this.view.on("key-down",function(b){"Control"===b.key?h||(h=!0,c._drawSegmentGraphic(a,e.vertices,{centered:d,constrained:h},e.viewAlignedCoordinateSystem)):"Alt"===b.key?d&&(d=!1,c._drawSegmentGraphic(a,e.vertices,{centered:d,constrained:h},e.viewAlignedCoordinateSystem)):
"Escape"===b.key&&q&&q.cancel()},u.ViewEventPriorities.WIDGET),this.view.on("key-up",function(b){"Control"===b.key?(h=!1,c._drawSegmentGraphic(a,e.vertices,{centered:d,constrained:h},e.viewAlignedCoordinateSystem)):"Alt"===b.key&&(d=!0,c._drawSegmentGraphic(a,e.vertices,{centered:d,constrained:h},e.viewAlignedCoordinateSystem))},u.ViewEventPriorities.WIDGET)],q=this._operationHandleForCreateAction(e,f.__spreadArrays(b,g),a);return q};d.prototype._setupCreateRectangleOperation=function(a,b){var c=
this;b=f.__assign(f.__assign({},b),{elevationInfo:this.layer.elevationInfo,interactiveUndoDisabled:!0});var e=this._draw.create(a,b),h=!1,d=!1;b=[e.on("vertex-add",function(b){var k=b.type,g=b.vertexIndex;b=b.vertices;var l=b[g];c._drawSegmentGraphic(a,b,{centered:d,constrained:h},e.viewAlignedCoordinateSystem);c.emit("create",{graphic:c.createGraphic,state:1===b.length?"start":"active",tool:a,toolEventInfo:{added:l,vertices:[{coordinates:l,componentIndex:0,vertexIndex:g}],type:k},type:"create"})}),
e.on("cursor-update",function(b){var k=b.type;b=b.vertices;c._drawSegmentGraphic(a,b,{centered:d,constrained:h},e.viewAlignedCoordinateSystem);2===b.length&&c.emit("create",{graphic:c.createGraphic,state:"active",tool:a,toolEventInfo:{coordinates:b[b.length-1],type:k},type:"create"})}),e.on("draw-complete",function(a){a=a.vertices.slice(0);var b=null;1===a.length&&(d=h=!1);b=h?w.createSquare(a,e.viewAlignedCoordinateSystem,d):w.createRectangle(a,e.viewAlignedCoordinateSystem,d);c.createGraphic?c.createGraphic.geometry=
b:(c._removeCreateGraphic(),c._set("createGraphic",new z(b,c.polygonSymbol)));q&&q.complete()})];var g=[this.view.on("pointer-move",function(a){t.isSome(e.getCoordsFromScreenPoint(E.createScreenPoint(a.x,a.y)))?c._displayCrosshairCursor():c._displayDefaultCursor()},u.ViewEventPriorities.WIDGET),this.view.on("key-down",function(b){"Control"===b.key?h||(h=!0,c._drawSegmentGraphic(a,e.vertices,{centered:d,constrained:h},e.viewAlignedCoordinateSystem)):"Alt"===b.key?d||(d=!0,c._drawSegmentGraphic(a,e.vertices,
{centered:d,constrained:h},e.viewAlignedCoordinateSystem)):"Escape"===b.key&&q&&q.cancel()},u.ViewEventPriorities.WIDGET),this.view.on("key-up",function(b){"Control"===b.key?(h=!1,c._drawSegmentGraphic(a,e.vertices,{centered:d,constrained:h},e.viewAlignedCoordinateSystem)):"Alt"===b.key&&(d=!1,c._drawSegmentGraphic(a,e.vertices,{centered:d,constrained:h},e.viewAlignedCoordinateSystem))},u.ViewEventPriorities.WIDGET)],q=this._operationHandleForCreateAction(e,f.__spreadArrays(b,g),a);return q};d.prototype._setupUpdateOperation=
function(a,b){return f.__awaiter(this,void 0,void 0,function(){var c,e,d,p,g,q,k,m,n,l,x,y;return f.__generator(this,function(h){c=this;e=c._defaultUpdateTool;d=c.defaultUpdateOptions;p=c.layer;g=c.view;q=f.__assign(f.__assign({},d),b);k=q.tool||e;m=0;for(n=a;m<n.length;m++)l=n[m],p.remove(l),p.add(l);if("3d"===g.type){if(0===a.length)return[2,null];switch(k){case "move":return[2,this._setupMove3DOperation(a,q,g,k)];case "reshape":if(1<a.length)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),
[2,null];x=Q.isSupportedGraphic(a[0]);if(0===x)return[2,this._setupReshape3DOperation(a[0],q,g)];this._logError("sketch:reshape","Reshape operation not supported for provided graphic(s) ("+P.isSupportedGraphicResultMessage(x)+").");return[2,null];case "transform":return 1===a.length&&0===da.isSupportedGraphic(a[0])?[2,this._setupPointTransform3DOperation(a[0],q,g)]:[2,this._setupMove3DOperation(a,q,g,k)]}}if("move"===k)return[2,this._setupMoveOperation(a,q,g)];if(1<a.length)return"reshape"===k?(this._logError("sketch:reshape-multiple",
"Reshape operation does not support multiple graphics."),[2,null]):[2,this._setupTransformOrReshapeOperation(a,k,q,g)];if(1===a.length){l=a[0];y=t.get(l.geometry,"type");if("point"===y||"multipoint"===y)return[2,this._setupMoveOperation(a,q,g)];if("transform"===k||"reshape"===k)return[2,this._setupTransformOrReshapeOperation(a,k,q,g)]}return[2,null]})})};d.prototype._setupMove3DOperation=function(a,b,c,e,d){void 0===d&&(d=!1);return f.__awaiter(this,void 0,void 0,function(){var h,g,q,k,m,n,l,x,y=
this;return f.__generator(this,function(p){switch(p.label){case 0:h=0;for(g=a;h<g.length;h++)if(q=g[h],k=ca.isSupportedGraphic(q),0!==k)return this._logError("sketch:move","Move operation not supported for provided graphic(s) ("+P.isSupportedGraphicResultMessage(k)+")."),[2,null];return[4,this._requireModule(new Promise(function(a,b){C(["../../views/3d/interactive/editingTools"],a,b)}))];case 1:m=p.sent();if(A(m))return[2,m];n=new m.module.GraphicMoveTool({view:c,enableZ:b.enableZ});this.view.tools.add(n);
n.graphics.addMany(a);d||this.updateGraphics.addMany(a);l=[];x=new F.OperationHandle({activeComponent:n,tool:e,type:"update",onEnd:function(){var a;l.forEach(function(a){return a.remove()});l.length=0;null===(a=y.view.tools)||void 0===a?void 0:a.remove(n);n.destroyed||n.destroy()},undo:function(){J(x,y.updateGraphics.toArray());y._emitUndoEvent({graphics:y.updateGraphics.toArray(),tool:e})},redo:function(){K(x,y.updateGraphics.toArray());y._emitRedoEvent({graphics:y.updateGraphics.toArray(),tool:e})},
addToSelection:function(a){y.updateGraphics.push(a);n.graphics.push(a);y.emit("update",{graphics:y.updateGraphics.toArray(),state:"active",aborted:!1,tool:y.activeTool,toolEventInfo:{added:[a],type:"selection-change"},type:"update"})},removeFromSelection:function(a){var b=y.updateGraphics.indexOf(a);x.history.undo.forEach(function(a){return a.updates.splice(b,1)});x.history.redo.forEach(function(a){return a.updates.splice(b,1)});y.updateGraphics.remove(a);0===y.updateGraphics.length?x.complete():
n.graphics.remove(a)},toggleTool:function(){return f.__awaiter(y,void 0,void 0,function(){var a,d;return f.__generator(this,function(h){switch(h.label){case 0:if(1!==this.updateGraphics.length||!1===b.toggleToolOnClick||"transform"!==e)return[2];a=this.updateGraphics.getItemAt(0);return 0!==Q.isSupportedGraphic(a)?[2]:[4,this._setupReshape3DOperation(a,b,c,!0)];case 1:d=h.sent();if(A(d))return[2];x.onEnd();x.destroy();this._setUpdateOperationHandle(d);return[2]}})})}});l.push.apply(l,f.__spreadArrays(this._getHandlesForComponent(x,
b),[this.view.on("immediate-click",function(a){return y._getCommonUpdateOperationClickHandlers(x,a)},u.ViewEventPriorities.WIDGET),this.view.on("key-down",function(a){return y._getCommonUpdateOperationKeyDownHandlers(x,a)},u.ViewEventPriorities.WIDGET)]));return[2,x]}})})};d.prototype._setupPointTransform3DOperation=function(a,b,c){return f.__awaiter(this,void 0,void 0,function(){var e,d,p,g,q,k,m,n,l=this;return f.__generator(this,function(h){switch(h.label){case 0:return e="transform",d=b.enableRotation,
p=b.enableScaling,g=b.enableZ,[4,this._requireModule(new Promise(function(a,b){C(["../../views/3d/interactive/editingTools"],a,b)}))];case 1:q=h.sent();if(A(q))return[2,q];k=new q.module.GraphicTransformTool({graphic:a,view:c,enableRotation:d,enableScaling:p,enableZ:g,snapToScene:this.snapToScene});this.view.tools.add(k);this.updateGraphics.add(a);m=[];n=new F.OperationHandle({activeComponent:k,tool:e,type:"update",onEnd:function(){var a;m.forEach(function(a){return a.remove()});m.length=0;null===
(a=l.view.tools)||void 0===a?void 0:a.remove(k);k.destroyed||k.destroy()},undo:function(){J(n,l.updateGraphics.toArray());l._emitUndoEvent({graphics:l.updateGraphics.toArray(),tool:e})},redo:function(){K(n,l.updateGraphics.toArray());l._emitRedoEvent({graphics:l.updateGraphics.toArray(),tool:e})},addToSelection:function(a){return f.__awaiter(l,void 0,void 0,function(){var e;return f.__generator(this,function(d){switch(d.label){case 0:return this.updateGraphics.add(a),[4,this._setupMove3DOperation(this.updateGraphics.toArray(),
b,c,"transform",!0)];case 1:e=d.sent();if(A(e))return[2];n.onEnd();n.destroy();this._setUpdateOperationHandle(e);return[2]}})})},setSnapToScene:function(a){k.snapToScene=a}});m.push.apply(m,f.__spreadArrays(this._getHandlesForComponent(n,b),[this.view.on("immediate-click",function(a){return l._getCommonUpdateOperationClickHandlers(n,a)},u.ViewEventPriorities.WIDGET),this.view.on("key-down",function(a){return l._getCommonUpdateOperationKeyDownHandlers(n,a)},u.ViewEventPriorities.WIDGET)]));return[2,
n]}})})};d.prototype._setupMoveOperation=function(a,b,c){return f.__awaiter(this,void 0,void 0,function(){var e,d,p,g,q,k,m=this;return f.__generator(this,function(h){switch(h.label){case 0:return e=[],d="move",a.forEach(function(a){e.push(new z(a.geometry,a.symbol,a.attributes));a.symbol=m._getUpdateSymbol(a.geometry)}),this.updateGraphics.addMany(a),[4,this._getGraphicMover(a,b,c)];case 1:p=h.sent();if(A(p))return[2,p];g=new F.OperationHandle({activeComponent:p,tool:d,type:"update",onEnd:function(){k.forEach(function(a){return a.remove()});
q.forEach(function(a){return a.remove()});k=[];q=[];p.destroy();m._internalGraphicsLayer&&m._internalGraphicsLayer.removeMany(m.updateGraphics.toArray());m.updateGraphics.forEach(function(a,b){a.symbol=e[b].symbol})},undo:function(){J(g,m.updateGraphics.toArray());m._emitUndoEvent({graphics:m.updateGraphics.toArray(),tool:d})},redo:function(){K(g,m.updateGraphics.toArray());m._emitRedoEvent({graphics:m.updateGraphics.toArray(),tool:d})},addToSelection:function(a){e.push(new z(a.geometry,a.symbol,
a.attributes));a.symbol=m._getUpdateSymbol(a.geometry);m.updateGraphics.push(a);p.graphics=m.updateGraphics.toArray();m.emit("update",{graphics:m.updateGraphics.toArray(),state:"active",aborted:!1,tool:m.activeTool,toolEventInfo:{added:[a],type:"selection-change"},type:"update"})},removeFromSelection:function(a){var b=m.updateGraphics.indexOf(a);g.history.undo.forEach(function(a){return a.updates.splice(b,1)});g.history.redo.forEach(function(a){return a.updates.splice(b,1)});var c=e.splice(b,1)[0];
a.symbol=c.symbol;m.updateGraphics.remove(a);0===m.updateGraphics.length?g.complete():p.graphics=m.updateGraphics.toArray()}});q=[c.on("immediate-click",function(a){return m._getCommonUpdateOperationClickHandlers(g,a,b)},u.ViewEventPriorities.WIDGET),c.on("key-down",function(a){m._getCommonUpdateOperationKeyDownHandlers(g,a);"Control"!==a.key||a.repeat||(p.enableMoveAllGraphics=!p.enableMoveAllGraphics)},u.ViewEventPriorities.WIDGET),c.on("key-up",function(a){"Control"===a.key&&(p.enableMoveAllGraphics=
!p.enableMoveAllGraphics)},u.ViewEventPriorities.WIDGET)];k=this._getHandlesForComponent(g,b);return[2,g]}})})};d.prototype._setupReshape3DOperation=function(a,b,c,e){void 0===e&&(e=!1);return f.__awaiter(this,void 0,void 0,function(){var d,p,g,q,k,m=this;return f.__generator(this,function(h){switch(h.label){case 0:return d="reshape",[4,this._requireModule(new Promise(function(a,b){C(["../../views/3d/interactive/editingTools"],a,b)}))];case 1:p=h.sent();if(A(p))return[2,p];g=new p.module.GraphicReshapeTool({view:c,
graphic:a,enableZ:b.enableZ});c.tools.add(g);e||this.updateGraphics.add(a);q=[];k=new F.OperationHandle({activeComponent:g,tool:d,type:"update",onEnd:function(){var a;q.forEach(function(a){return a.remove()});q.length=0;null===(a=m.view.tools)||void 0===a?void 0:a.remove(g);g.destroyed||g.destroy()},undo:function(){J(k,m.updateGraphics.toArray());m._emitUndoEvent({graphics:m.updateGraphics.toArray(),tool:d})},redo:function(){K(k,m.updateGraphics.toArray());m._emitRedoEvent({graphics:m.updateGraphics.toArray(),
tool:d})},addToSelection:function(a){return f.__awaiter(m,void 0,void 0,function(){var e;return f.__generator(this,function(d){switch(d.label){case 0:return this.updateGraphics.add(a),[4,this._setupMove3DOperation(this.updateGraphics.toArray(),b,c,"transform",!0)];case 1:e=d.sent();if(A(e))return[2];k.onEnd();k.destroy();this._setUpdateOperationHandle(e);return[2]}})})},toggleTool:function(){return f.__awaiter(m,void 0,void 0,function(){var a;return f.__generator(this,function(e){switch(e.label){case 0:return!1===
b.toggleToolOnClick?[2]:[4,this._setupMove3DOperation(this.updateGraphics.toArray(),b,c,"transform",!0)];case 1:a=e.sent();if(A(a))return[2];k.onEnd();k.destroy();this._setUpdateOperationHandle(a);return[2]}})})}});q.push.apply(q,f.__spreadArrays(this._getHandlesForComponent(k,b),[c.on("immediate-click",function(a){return m._getCommonUpdateOperationClickHandlers(k,a)},u.ViewEventPriorities.WIDGET),c.on("key-down",function(a){return m._getCommonUpdateOperationKeyDownHandlers(k,a)},u.ViewEventPriorities.WIDGET)]));
return[2,k]}})})};d.prototype._setupTransformOrReshapeOperation=function(a,b,c,e){return f.__awaiter(this,void 0,void 0,function(){var d,p,g,q,k,m,n,l,x,r,v=this;return f.__generator(this,function(h){switch(h.label){case 0:return d=c.multipleSelectionEnabled,p=void 0===d?!0:d,g=c.toggleToolOnClick,q=void 0===g?!0:g,k=[],a.forEach(function(a){k.push(new z(a.geometry,a.symbol,a.attributes));a.symbol=v._getUpdateSymbol(a.geometry)}),this.updateGraphics.addMany(a),"transform"!==b?[3,2]:[4,this._getBox(a,
c,e)];case 1:return n=h.sent(),[3,4];case 2:return[4,this._getReshape(a,c,e)];case 3:n=h.sent(),h.label=4;case 4:m=n;if(A(m))return[2,m];l=new F.OperationHandle({activeComponent:m,type:"update",onEnd:function(){r.forEach(function(a){return a.remove()});x.forEach(function(a){return a.remove()});r=[];x=[];l.activeComponent&&!l.activeComponent.destroyed&&l.activeComponent.destroy();v._internalGraphicsLayer.removeMany(v.updateGraphics.toArray());v.updateGraphics.forEach(function(a,b){k[b]&&k[b].symbol&&
(a.symbol=k[b].symbol)})},undo:function(){J(l,v.updateGraphics.toArray());l.refreshComponent();v._emitUndoEvent({graphics:v.updateGraphics.toArray(),tool:l.tool})},redo:function(){K(l,v.updateGraphics.toArray());l.refreshComponent();v._emitRedoEvent({graphics:v.updateGraphics.toArray(),tool:l.tool})},addToSelection:function(a){var b=l.activeComponent;k.push(new z(a.geometry,a.symbol,a.attributes));a.symbol=v._getUpdateSymbol(a.geometry);v.updateGraphics.add(a);b.graphics=v.updateGraphics.toArray();
b.refresh();l.resetHistory();v.emit("update",{graphics:v.updateGraphics.toArray(),state:"active",aborted:!1,tool:v.activeTool,toolEventInfo:{added:[a],type:"selection-change"},type:"update"})},removeFromSelection:function(a){var b=l.activeComponent,c=v.updateGraphics.indexOf(a);l.history.undo.forEach(function(a){return a.updates.splice(c,1)});l.history.redo.forEach(function(a){return a.updates.splice(c,1)});var e=k.splice(c,1)[0];a.symbol=e.symbol;v.updateGraphics.remove(a);0===v.updateGraphics.length?
l.complete():b.graphics=v.updateGraphics.toArray()},toggleTool:function(){return f.__awaiter(v,void 0,void 0,function(){var b;return f.__generator(this,function(d){switch(d.label){case 0:if(1<this.updateGraphics.length)return[2];b=null;return"transform"!==l.tool?[3,2]:[4,this._getReshape(a,c,e)];case 1:return b=d.sent(),[3,4];case 2:return"reshape"!==l.tool?[3,4]:[4,this._getBox(a,c,e)];case 3:b=d.sent(),d.label=4;case 4:if(A(b))return[2];l.activeComponent.destroy();l.activeComponent=b;l.activeComponent&&
(r.forEach(function(a){return a.remove()}),r=this._getHandlesForComponent(l,c));return[2]}})})}});x=[e.on("immediate-click",function(a){v._getFirstHit(E.createScreenPointFromEvent(a)).then(function(b){if(l)if(b=b.results,b.length){var c=l.activeComponent,e=a.native&&a.native.shiftKey;b.some(function(a){if(a.graphic){a=a.graphic;if(p&&e&&c&&"box"===c.type&&!c.isUIGraphic(a))return l.addToSelection(a),!0;if(c&&"box"===c.type&&c.isUIGraphic(a))return!1!==q&&1===v.updateGraphics.length&&(a=v.updateGraphics.getItemAt(0).geometry,
"extent"===t.get(a,"type")?v._logError("sketch:reshape-extent","Reshape operation does not support graphics with geometry of type 'extent'."):l.toggleTool()),!0;if(c&&"reshape"===c.type){if(a===c.graphic)return!1!==q&&l.toggleTool(),!0;if(c.isUIGraphic(a)||a.layer===v._internalGraphicsLayer)return!0}else a.layer===v.layer&&l.complete()}return!1})&&a.stopPropagation()}else l.complete()})},u.ViewEventPriorities.WIDGET),e.on("key-down",function(a){v._getCommonUpdateOperationKeyDownHandlers(l,a);"Control"===
a.key&&!a.repeat&&l&&(a=l.activeComponent)&&"box"===a.type&&(a.preserveAspectRatio=!a.preserveAspectRatio)},u.ViewEventPriorities.WIDGET),e.on("key-up",function(a){"Control"===a.key&&l&&(a=l.activeComponent)&&"box"===a.type&&(a.preserveAspectRatio=!a.preserveAspectRatio)},u.ViewEventPriorities.WIDGET)];r=this._getHandlesForComponent(l,c);return[2,l]}})})};d.prototype._getGraphicMover=function(a,b,c){return f.__awaiter(this,void 0,void 0,function(){var e,d,p,g=this;return f.__generator(this,function(h){switch(h.label){case 0:return e=
b.enableMoveAllGraphics,d=void 0===e?!0:e,[4,this._requireModule(new Promise(function(a,b){C(["../../views/draw/support/GraphicMover"],a,b)}))];case 1:return p=h.sent(),A(p)?[2,p]:[2,new p.module({enableMoveAllGraphics:d,graphics:a,view:c,callbacks:{onGraphicMoveStart:function(a){var b=a.dx,c=a.dy;a=a.graphic;return g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:{dx:b,dy:c,mover:a,type:"move-start"},type:"update"})},onGraphicMove:function(a){var b=
a.dx,c=a.dy;a=a.graphic;return g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:{dx:b,dy:c,mover:a,type:"move"},type:"update"})},onGraphicMoveStop:function(a){var b=a.dx,c=a.dy;a=a.graphic;return g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:{dx:b,dy:c,mover:a,type:"move-stop"},type:"update"})},onGraphicPointerOver:function(){return g._displayDefaultCursor()},onGraphicPointerOut:function(){return g._displayDefaultCursor()}}})]}})})};
d.prototype._getBox=function(a,b,c){return f.__awaiter(this,void 0,void 0,function(){var e,d,p,g,q,k,m,n=this;return f.__generator(this,function(h){switch(h.label){case 0:return e=b.enableRotation,d=void 0===e?!0:e,p=b.enableScaling,g=void 0===p?!0:p,q=b.preserveAspectRatio,k=void 0===q?!1:q,[4,this._requireModule(new Promise(function(a,b){C(["../../views/draw/support/Box"],a,b)}))];case 1:return m=h.sent(),A(m)?[2,m]:[2,new m.module({graphics:a,enableRotation:d,enableScaling:g,preserveAspectRatio:k,
layer:this._internalGraphicsLayer,view:c,callbacks:{onMoveStart:function(a){return n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:f.__assign({},a),type:"update"})},onMove:function(a){return n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:f.__assign({},a),type:"update"})},onMoveStop:function(a){return n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,
tool:n.activeTool,toolEventInfo:f.__assign({},a),type:"update"})},onScaleStart:function(a){return n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:f.__assign({},a),type:"update"})},onScale:function(a){return n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:f.__assign({},a),type:"update"})},onScaleStop:function(a){return n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",
aborted:!1,tool:n.activeTool,toolEventInfo:f.__assign({},a),type:"update"})},onRotateStart:function(a){return n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:f.__assign({},a),type:"update"})},onRotate:function(a){return n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:f.__assign({},a),type:"update"})},onRotateStop:function(a){return n.emit("update",{graphics:n.updateGraphics.toArray(),
state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:f.__assign({},a),type:"update"})}}})]}})})};d.prototype._getReshape=function(a,b,c){return f.__awaiter(this,void 0,void 0,function(){var e,d,p,g=this;return f.__generator(this,function(h){switch(h.label){case 0:return e=b.enableMidpoints,d=void 0===e?!0:e,[4,this._requireModule(new Promise(function(a,b){C(["../../views/draw/support/Reshape"],a,b)}))];case 1:return p=h.sent(),A(p)?[2,p]:[2,new p.module({enableMidpoints:d,graphic:a[0],layer:this._internalGraphicsLayer,
view:c,callbacks:{onReshapeStart:function(a){return g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:f.__assign({},a),type:"update"})},onReshape:function(a){return g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:f.__assign({},a),type:"update"})},onReshapeStop:function(a){var b=a.mover;a=a.type;return g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,
tool:g.activeTool,toolEventInfo:{mover:b,type:a},type:"update"})},onMoveStart:function(a){var b=a.dx,c=a.dy,e=a.mover;a=a.type;return g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:{dx:b,dy:c,mover:e,type:a},type:"update"})},onMove:function(a){var b=a.dx,c=a.dy,e=a.mover;a=a.type;return g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:{dx:b,dy:c,mover:e,type:a},type:"update"})},
onMoveStop:function(a){var b=a.dx,c=a.dy,e=a.mover;a=a.type;return g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:{dx:b,dy:c,mover:e,type:a},type:"update"})},onVertexAdd:function(a){var b=a.type,c=a.vertices;a=a.added.map(function(a){return O.geometryToCoordinates(a.geometry)});g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:{added:a,vertices:c,type:b},type:"update"})},onVertexRemove:function(a){var b=
a.type,c=a.vertices;a=a.removed.map(function(a){return O.geometryToCoordinates(a.geometry)});g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:{removed:a,vertices:c,type:b},type:"update"})}}})]}})})};d.prototype._getHandlesForComponent=function(a,b){var c=this,e=a.activeComponent;switch(e.type){case "graphic-mover":return[e.on("graphic-move-start",function(b){return a.addToHistory(B(b.allGraphics))})];case "box":return[e.on("move-start",
function(b){return a.addToHistory(B(b.graphics))}),e.on("rotate-start",function(b){return a.addToHistory(B(b.graphics))}),e.on("scale-start",function(b){return a.addToHistory(B(b.graphics))})];case "reshape":return[e.on("move-start",function(b){return a.addToHistory(B([b.mover]))}),e.on("reshape-start",function(b){return a.addToHistory(B([b.graphic]))}),e.on("vertex-add",function(b){return a.addToHistory(B([b.oldGraphic]))}),e.on("vertex-remove",function(b){return a.addToHistory(B([b.oldGraphic]))})];
case "move-3d":return[e.on("graphic-move-start",function(b){a.addToHistory(B(b.allGraphics));c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:{dx:0,dy:0,mover:0<b.allGraphics.length?b.allGraphics[0]:null,type:"move-start"},type:"update"})}),e.on("graphic-move",function(a){c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:{dx:a.dx,dy:a.dy,mover:0<a.allGraphics.length?a.allGraphics[0]:
null,type:"move"},type:"update"})}),e.on("graphic-move-stop",function(a){c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:{dx:0,dy:0,mover:0<a.allGraphics.length?a.allGraphics[0]:null,type:"move-stop"},type:"update"})}),e.on("immediate-click",function(e){e.shiftKey?c._toggleSelection([e.graphic],a,b):a.toggleTool()})];case "transform-3d":return[e.on("graphic-translate-start",function(b){a.addToHistory(B([b.graphic]));c.emit("update",{graphics:c.updateGraphics.toArray(),
state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:{mover:b.graphic,dx:b.dxScreen,dy:b.dyScreen,type:"move-start"},type:"update"})}),e.on("graphic-translate-stop",function(a){c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:{mover:a.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move-stop"},type:"update"})}),e.on("graphic-rotate-start",function(b){a.addToHistory(T([b.graphic]));c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",
aborted:!1,tool:c.activeTool,toolEventInfo:{mover:b.graphic,angle:b.angle,type:"rotate-start"},type:"update"})}),e.on("graphic-rotate-stop",function(a){c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:{mover:a.graphic,angle:a.angle,type:"rotate-stop"},type:"update"})}),e.on("graphic-scale-start",function(b){a.addToHistory(T([b.graphic]));c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:{mover:b.graphic,
xScale:b.scale,yScale:b.scale,type:"scale-start"},type:"update"})}),e.on("graphic-scale-stop",function(a){c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:{mover:a.graphic,xScale:a.scale,yScale:a.scale,type:"scale-stop"},type:"update"})}),e.on("graphic-translate",function(a){c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:{mover:a.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move"},
type:"update"})}),e.on("graphic-rotate",function(a){c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:{mover:a.graphic,angle:a.angle,type:"rotate"},type:"update"})}),e.on("graphic-scale",function(a){c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:{mover:a.graphic,xScale:a.scale,yScale:a.scale,type:"scale"},type:"update"})})];case "reshape-3d":return[e.on("reshape",function(b){"reshape-start"===
b.type&&a.addToHistory(B([b.mover]));c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:b,type:"update"})}),e.on("move",function(b){"move-start"===b.type&&a.addToHistory(B([b.mover]));c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:b,type:"update"})}),e.on("vertex-add",function(a){c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,
toolEventInfo:a,type:"update"})}),e.on("vertex-remove",function(a){c.emit("update",{graphics:c.updateGraphics.toArray(),state:"active",aborted:!1,tool:c.activeTool,toolEventInfo:a,type:"update"})}),e.on("immediate-click",function(){return a.toggleTool()})];case "draw":case "draw-3d":return null;default:V.neverReached(e)}};d.prototype._setUpdateOperationHandle=function(a){var b=this;this._operationHandle=a;var c=this.view.map;this._disablePopup();a.on("complete",function(){if(a===b._operationHandle){var e=
b.updateGraphics.toArray(),d=b._operationHandle.tool;b._operationHandle.destroy();b._operationHandle=null;b._internalGraphicsLayer.removeMany(b.updateGraphics.toArray());b.updateGraphics.removeAll();c&&c.remove(b._internalGraphicsLayer);b._restorePopup();b.emit("update",{graphics:e,state:"complete",aborted:a.cancelled,tool:d,toolEventInfo:null,type:"update"})}})};d.prototype._getCommonUpdateOperationClickHandlers=function(a,b,c){var e=this,d=E.createScreenPointFromEvent(b);this._getFirstHit(d).then(function(d){d=
d.results;d.length?b.native.shiftKey&&e._toggleSelection(d.map(function(a){return a.graphic}),a,c)?b.stopPropagation():d.some(function(a){return a.graphic&&-1<e.updateGraphics.indexOf(a.graphic)})?b.stopPropagation():a.complete():a.complete()})};d.prototype._toggleSelection=function(a,b,c){var e=this,d=c?!!c.multipleSelectionEnabled:!0;return a.some(function(a){return null==a?!1:d&&a.layer===e.layer?(-1===e.updateGraphics.indexOf(a)?b.addToSelection(a):b.removeFromSelection(a),!0):!1})};d.prototype._getCommonUpdateOperationKeyDownHandlers=
function(a,b){if(a){var c=b.key;"z"===c&&a.canUndo()?(b.stopPropagation(),a.undo()):"r"===c&&a.canRedo()?(b.stopPropagation(),a.redo()):"Escape"===c?(b.stopPropagation(),a.cancel()):0<=ga.indexOf(c)&&this._onDeleteKey(b)}};d.prototype._onDeleteKey=function(a){if(this._operationHandle&&"update"===this._operationHandle.type){var b=this.activeComponent;b&&"reshape"!==b.type&&"reshape-3d"!==b.type&&(a.stopPropagation(),a=this.updateGraphics.toArray(),this.layer.removeMany(a),this._emitDeleteEvent({graphics:a,
tool:this.activeTool}))}};d.prototype._getCreateSymbol=function(a,b){void 0===b&&(b=!1);b="3d"!==this.view.type&&b;switch(a.type){case "point":case "multipoint":return b?this.activePointSymbol:this.pointSymbol;case "polyline":return b?this.activeLineSymbol:this.polylineSymbol;case "polygon":return b?this.activeFillSymbol:this.polygonSymbol}return null};d.prototype._getUpdateSymbol=function(a){if(t.isNone(a))return null;switch(a.type){case "point":case "multipoint":return this.updatePointSymbol;case "polyline":return this.updatePolylineSymbol;
case "polygon":case "extent":return this.updatePolygonSymbol}return null};d.prototype._drawMultipointGraphic=function(a,b){var c=null;!b&&1<a.length?(c=a.slice(0),c.pop(),c=w.createMultipoint(c,this.view.spatialReference)):c=w.createMultipoint(a,this.view.spatialReference);this.createGraphic?this.createGraphic.geometry=c:this._set("createGraphic",new z(c,this.pointSymbol));b&&1===a.length&&this._internalGraphicsLayer.add(this.createGraphic)};d.prototype._drawVertexGraphics=function(a,b,c){c=!(!c||
!c.userClicked);var d="polygon"===a,h=d?this.polygonSymbol:this.polylineSymbol;if(1===b.length){this._removeLineGraphic();this._removeActiveLineGraphic();var f=this.createPointFromVertex(b[0]),d=d?w.createPolygon([b],this.view.spatialReference,this._doUnnormalization,!0):w.createPolyline([b],this.view.spatialReference,this._doUnnormalization);this._vertexGraphics.length?this._vertexGraphics[0].geometry=f:this._vertexGraphics.push(new z(f,this.activeVertexSymbol));this.createGraphic?this.createGraphic.geometry=
d:this._set("createGraphic",new z(d,h));c&&this._internalGraphicsLayer.add(this._vertexGraphics[0])}else if(2===b.length){a=this.createPointFromVertex(b[1]);var g=this.vertexSymbol,h=w.createPolyline([b],this.view.spatialReference,this._doUnnormalization),d=d?w.createPolygon([b],this.view.spatialReference,this._doUnnormalization,!0):w.createPolyline([b],this.view.spatialReference,this._doUnnormalization);this._vertexGraphics.length||(f=this.createPointFromVertex(b[0]),b=new z(f,g),this._vertexGraphics.push(b));
1===this._vertexGraphics.length?(b=this._vertexGraphics[0],a=new z(a,g),this._removeLineGraphic(),this._removeActiveFillGraphic(),this._vertexGraphics.push(a),this._internalGraphicsLayer.remove(b),this._internalGraphicsLayer.add(b)):this._vertexGraphics[1].geometry=a;this._showActiveLineGraphic(h);b=this._vertexGraphics[0];c&&(this._activeLineGraphic.symbol=this.polylineSymbol,b.symbol=this.vertexSymbol,this._internalGraphicsLayer.add(this._vertexGraphics[1]));this.createGraphic?this.createGraphic.geometry=
d:this._set("createGraphic",new z(d,this.polygonSymbol));this._internalGraphicsLayer.remove(b);this._internalGraphicsLayer.add(b)}else if(2<b.length){d=d?w.createPolygon([b],this.view.spatialReference,this._doUnnormalization,!0):w.createPolyline([b],this.view.spatialReference,this._doUnnormalization);"polygon"===a&&this._showFillGraphic(d);a=b.map(function(a){return a.slice()});g=a.pop();f=[a[a.length-1],g];g=w.createPolyline([a],this.view.spatialReference,this._doUnnormalization);f=w.createPolyline([f],
this.view.spatialReference,this._doUnnormalization);this._showLineGraphic(g);this._showActiveLineGraphic(f);for(g=0;g<a.length;g++)(f=this._vertexGraphics[g])?f.symbol=c||g!==this._vertexGraphics.length-1?this.vertexSymbol:this.activeVertexSymbol:(f=this.createPointFromVertex(b[g]),this._showVertexGraphic(f));c?(this._activeLineGraphic.symbol=this.polylineSymbol,g=b.length-1,f=this.createPointFromVertex(b[g]),this._showVertexGraphic(f)):this._activeLineGraphic.symbol=this.activeLineSymbol;this.createGraphic?
this.createGraphic.geometry=d:(this._removeCreateGraphic(),this._set("createGraphic",new z(d,h)));c=0;for(d=this._vertexGraphics;c<d.length;c++)b=d[c],this._internalGraphicsLayer.remove(b),this._internalGraphicsLayer.add(b)}};d.prototype._drawSegmentGraphic=function(a,b,c,d){if(b.length){var e=!(!c||!c.centered);c=!(!c||!c.constrained);var f=null;1===b.length?this._removeCenterIndicatorGraphic():("rectangle"===a?f=c?w.createSquare(b,d,e):w.createRectangle(b,d,e):"circle"===a&&(f=c?w.createEllipse(b,
d,e):w.createCircle(b,d,e,this.view.resolution)),f.extent&&f.extent.center&&this._showCenterIndicatorGraphic(f.extent.center));f?this.createGraphic?this.createGraphic.geometry=f:(this._removeCreateGraphic(),this._set("createGraphic",new z(f,this.polygonSymbol)),this._internalGraphicsLayer.add(this.createGraphic)):this._removeCreateGraphic()}};d.prototype._showCenterIndicatorGraphic=function(a){this._centerIndicatorGraphic?this._centerIndicatorGraphic.geometry=a:(this._centerIndicatorGraphic=new z(a,
this._centerSymbol),this._internalGraphicsLayer.add(this._centerIndicatorGraphic))};d.prototype._removeCenterIndicatorGraphic=function(){this._centerIndicatorGraphic&&(this._internalGraphicsLayer.remove(this._centerIndicatorGraphic),this._centerIndicatorGraphic.destroy(),this._centerIndicatorGraphic=null)};d.prototype._showActiveLineGraphic=function(a){this._activeLineGraphic?this._activeLineGraphic.geometry=a:(this._activeLineGraphic=new z(a,this.activeLineSymbol),this._internalGraphicsLayer.graphics.add(this._activeLineGraphic,
0))};d.prototype._showFillGraphic=function(a){this._activeFillGraphic?this._activeFillGraphic.geometry=a:(this._activeFillGraphic=new z(a,this._getCreateSymbol(a,!0)),this._internalGraphicsLayer.add(this._activeFillGraphic))};d.prototype._showLineGraphic=function(a){this._lineGraphic?this._lineGraphic.geometry=a:(this._lineGraphic=new z(a,this.polylineSymbol),this._internalGraphicsLayer.graphics.add(this._lineGraphic,0))};d.prototype._showVertexGraphic=function(a,b){a=new z(a,b?this.activeVertexSymbol:
this.vertexSymbol);this._vertexGraphics.push(a);this._internalGraphicsLayer.add(a)};d.prototype._resetCreateOperationGraphics=function(){this._removeActiveFillGraphic();this._removeLineGraphic();this._removeActiveLineGraphic();this._removeVertexGraphics()};d.prototype._removeCreateGraphic=function(){this.createGraphic&&(this._internalGraphicsLayer.remove(this.createGraphic),this._set("createGraphic",null))};d.prototype._removeCreateOperationGraphics=function(){this._removeCenterIndicatorGraphic();
this._removeActiveLineGraphic();this._removeActiveFillGraphic();this._removeLineGraphic();this._removeVertexGraphics()};d.prototype._removeActiveLineGraphic=function(){this._activeLineGraphic&&(this._internalGraphicsLayer.remove(this._activeLineGraphic),this._activeLineGraphic.destroy(),this._activeLineGraphic=null)};d.prototype._removeActiveFillGraphic=function(){this._activeFillGraphic&&(this._internalGraphicsLayer.remove(this._activeFillGraphic),this._activeFillGraphic.destroy(),this._activeFillGraphic=
null)};d.prototype._removeLineGraphic=function(){this._lineGraphic&&(this._internalGraphicsLayer.remove(this._lineGraphic),this._lineGraphic.destroy(),this._lineGraphic=null)};d.prototype._removeVertexGraphics=function(){this._vertexGraphics.length&&(this._internalGraphicsLayer.removeMany(this._vertexGraphics),this._vertexGraphics.forEach(function(a){return a.destroy()}),this._vertexGraphics=[])};d.prototype._removeDefaultLayer=function(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),
this._internalGraphicsLayer.destroy(),this._internalGraphicsLayer=null)};d.prototype._operationHandleForCreateAction=function(a,b,c){var d=this;return new F.OperationHandle({activeComponent:this._draw,tool:c,type:"create",onEnd:function(){b.forEach(function(a){return a.remove()});b.length=0;d._removeCreateOperationGraphics();d._internalGraphicsLayer&&d._internalGraphicsLayer.remove(d.createGraphic);d._displayDefaultCursor()},undo:function(){a.undo();d._emitUndoEvent({graphics:[d.createGraphic],tool:c})},
redo:function(){a.redo();d._emitRedoEvent({graphics:[d.createGraphic],tool:c})},canUndo:function(){return a&&a.canUndo()},canRedo:function(){return a&&a.canRedo()},setSnapToScene:function(b){a.snapToScene=b}})};d.prototype._isComponentGraphic=function(a){var b=this.activeComponent;return a&&b?a.attributes&&a.attributes.esriSketchTool?!0:("box"===b.type||"reshape"===b.type)&&b.isUIGraphic(a):!1};d.prototype._snap=function(a,b,c){c&&this._snapLastVertexToAxis(b);"polygon"===a&&this._snapLastPolygonVertexToFirst(b)};
d.prototype._snapLastPolygonVertexToFirst=function(a){if(!(2>=a.length)){var b=a[0];a=a[a.length-1];var c=this.view.toScreen(new I.Point(b[0],b[1],this.view.spatialReference)),d=this.view.toScreen(new I.Point(a[0],a[1],this.view.spatialReference));this._isWithinScreenDistance(c,d,this._getVertexIntersectDistance())&&(a[0]=b[0],a[1]=b[1])}};d.prototype._getVertexIntersectDistance=function(){return this.vertexSymbol&&"simple-marker"===this.vertexSymbol.type?E.pt2px(this.vertexSymbol.size)/2+3:3};d.prototype._isWithinScreenDistance=
function(a,b,c){var d=a.x-b.x;a=a.y-b.y;return Math.sqrt(d*d+a*a)<=c};d.prototype._snapLastVertexToAxis=function(a){if(!(2>a.length)){var b=a.pop(),c=a[a.length-1],d=w.createViewAlignedCoordinateSystem(this.view,c),c=d.mapToLocal(c),b=d.mapToLocal(b),f=Math.abs(b.x-c.x),p=Math.abs(b.y-c.y),d=d.localToMap(w.makeSurfacePoint(f>p?b.x:c.x,f>p?c.y:b.y));a.push(d)}};d.prototype._displayCrosshairCursor=function(){this.view&&this.view.container&&"crosshair"!==this.view.cursor&&(this.view.cursor="crosshair")};
d.prototype._displayDefaultCursor=function(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)};d.prototype._logError=function(a,b,c){fa.error(new W(a,b,c))};d.prototype._requireModule=function(a){return f.__awaiter(this,void 0,void 0,function(){var b,c;return f.__generator(this,function(d){switch(d.label){case 0:return this._moduleLoaderAbortController=b=new AbortController,[4,a];case 1:return c=d.sent(),this._moduleLoaderAbortController!==b||b.signal.aborted?[2,{requireError:"aborted"}]:
[2,{module:c}]}})})};d.prototype._emitUndoEvent=function(a){this.emit("undo",f.__assign(f.__assign({},a),{type:"undo"}))};d.prototype._emitRedoEvent=function(a){this.emit("redo",f.__assign(f.__assign({},a),{type:"redo"}))};d.prototype._emitDeleteEvent=function(a){this.emit("delete",f.__assign(f.__assign({},a),{type:"delete"}))};d.prototype.createPointFromVertex=function(a){return 2<a.length?new I.Point(a[0],a[1],a[2],this.view.spatialReference):new I.Point(a[0],a[1],this.view.spatialReference)};d.prototype.test=
function(){return this._operationHandle};d.prototype.wait=function(){return G.whenNotOnce(this,"updating")};d.prototype._beginAsyncOperation=function(){this._numUpdating+=1;this.notifyChange("updating")};d.prototype._endAsyncOperation=function(){--this._numUpdating;this.notifyChange("updating")};d.prototype._disablePopup=function(){var a=this.view.popup;a&&t.isNone(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=a.autoOpenEnabled,a.autoOpenEnabled=!1)};d.prototype._restorePopup=function(){var a=
this.view.popup;a&&t.isSome(this._originalAutoOpenEnabled)&&(a.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)};f.__decorate([r.property({dependsOn:["state"],readOnly:!0})],d.prototype,"_draw",null);f.__decorate([r.property()],d.prototype,"updating",null);f.__decorate([r.property()],d.prototype,"_operationHandle",void 0);f.__decorate([r.property({dependsOn:["_operationHandle","_operationHandle.tool"],readOnly:!0})],d.prototype,"activeTool",null);f.__decorate([r.property()],
d.prototype,"activeFillSymbol",void 0);f.__decorate([r.property()],d.prototype,"activeLineSymbol",void 0);f.__decorate([r.property()],d.prototype,"activePointSymbol",void 0);f.__decorate([r.property()],d.prototype,"activeVertexSymbol",void 0);f.__decorate([r.property({readOnly:!0})],d.prototype,"createGraphic",void 0);f.__decorate([r.property()],d.prototype,"defaultCreateOptions",void 0);f.__decorate([r.property()],d.prototype,"defaultUpdateOptions",void 0);f.__decorate([r.property()],d.prototype,
"layer",void 0);f.__decorate([r.property({types:D.symbolTypes})],d.prototype,"pointSymbol",void 0);f.__decorate([r.property({types:D.symbolTypes})],d.prototype,"polygonSymbol",void 0);f.__decorate([r.property({types:D.symbolTypes})],d.prototype,"polylineSymbol",void 0);f.__decorate([r.property({dependsOn:["view.ready","layer","_operationHandle"],readOnly:!0})],d.prototype,"state",null);f.__decorate([r.property({readOnly:!0})],d.prototype,"updateGraphics",void 0);f.__decorate([r.property()],d.prototype,
"updateOnGraphicClick",void 0);f.__decorate([r.property({types:D.symbolTypes})],d.prototype,"updatePointSymbol",void 0);f.__decorate([r.property({types:D.symbolTypes})],d.prototype,"updatePolygonSymbol",void 0);f.__decorate([r.property({types:D.symbolTypes})],d.prototype,"updatePolylineSymbol",void 0);f.__decorate([r.property({types:D.symbolTypes})],d.prototype,"vertexSymbol",void 0);f.__decorate([r.property({value:null})],d.prototype,"view",null);f.__decorate([r.property()],d.prototype,"cancel",
null);f.__decorate([r.property()],d.prototype,"complete",null);f.__decorate([r.property()],d.prototype,"delete",null);f.__decorate([r.property()],d.prototype,"create",null);f.__decorate([r.property()],d.prototype,"update",null);f.__decorate([r.property()],d.prototype,"undo",null);f.__decorate([r.property()],d.prototype,"redo",null);f.__decorate([r.property()],d.prototype,"canUndo",null);f.__decorate([r.property()],d.prototype,"canRedo",null);f.__decorate([r.property()],d.prototype,"toggleUpdateTool",
null);f.__decorate([r.property({value:null})],d.prototype,"snapToScene",null);return d=f.__decorate([r.subclass("esri.widgets.Sketch.SketchViewModel")],d)}(X.EventedAccessor)});