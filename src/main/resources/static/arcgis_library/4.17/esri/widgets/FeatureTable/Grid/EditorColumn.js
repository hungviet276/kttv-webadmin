// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define(["require","exports","tslib","../../../core/accessorSupport/decorators","./Column"],function(q,r,d,e,m){return function(k){function a(a){var c=k.call(this,a)||this;c.activeEditInfo=null;c.cellValueValidatorFunction=function(b){return b.oldValue!==b.value};c.editable=!1;c.inputRenderFunction=function(b){var f,a,h=b.root,g=b.column;b=b.rowData;if((null===(f=c.activeEditInfo)||void 0===f||!f.updating)&&c.editable){var d=c.getCellValue(g,b);f=c.createInputElement({root:h,column:g,rowData:b,value:d});
c._set("activeEditInfo",{column:g,input:f,root:h,rowData:b,updating:!0,oldValue:d});g=c.createInputContainer();g.appendChild(f);c.removeCellContent(h);h.appendChild(g);f.focus();f instanceof HTMLInputElement&&f.select();null===(a=c.grid)||void 0===a?void 0:a.notifyResize()}};c.loadingMessage="";c.inputType="text";c.maxLength=null;c.parseInputValueFunction=function(b){return b.input.value};c.renderFunction=function(b){var f,a=b.root,d=b.column,g=b.rowData,e=c.activeEditInfo;if(!e||!e.updating){e=c.getCellValue(d,
g);d=c.cellValueFormatFunction({column:d,rowData:g,value:e});a.onclick=function(){return a.focus()};a.ondblclick=function(){return c.inputRenderFunction(b)};a.ontouchend=function(){return c.inputRenderFunction(b)};g=null===(f=c.grid)||void 0===f?void 0:f.getSlotElementByName(a.slot);if(f=null===g||void 0===g?void 0:g.parentElement)f.onkeydown=function(a){"Enter"!==a.key||c.activeEditInfo||c.inputRenderFunction(b);"Escape"===a.key&&c.activeEditInfo&&c.cancel()};(null===d||void 0===d?void 0:d.toString())!==
a.innerHTML&&(a.innerHTML=d)}};c.required=!1;c.store=null;c.updateRowItemFunction=function(b){b.rowData.item[b.column.path]=b.value};c.updateStoreItemFunction=function(b){var a,d=b.rowData,e=b.column;b=b.value;return null===(a=c.store)||void 0===a?void 0:a.updateItem({index:d.index,name:e.path,value:b})};return c}d.__extends(a,k);a.prototype.cancel=function(){var a,c=this.activeEditInfo;if(c){var b=c.column,d=c.root,e=c.rowData,c=c.oldValue;this._set("activeEditInfo",null);b=this.cellValueFormatFunction({column:b,
rowData:e,value:c});d.innerHTML=b;null===(a=this.grid)||void 0===a?void 0:a.notifyResize()}};a.prototype.createInputContainer=function(){var a=document.createElement("div");a.classList.add("esri-editor-column__cell-input--container");return a};a.prototype.createInputElement=function(a){var c=this;a=a.value;var b=document.createElement("input");b.classList.add("esri-editor-column__cell-input");b.maxLength=this.maxLength;b.type=this.inputType;b.value=a;b.onblur=function(){b.onblur=null;c.submit()};
return b};a.prototype.submit=function(){var a,c;return d.__awaiter(this,void 0,void 0,function(){var b,f,e,h,g,k,l,m,n,p;return d.__generator(this,function(d){switch(d.label){case 0:b=this.activeEditInfo;if(!b)return[2];f=b.column;e=b.input;h=b.root;g=b.rowData;k=b.oldValue;l=this.parseInputValueFunction({input:e,column:f,rowData:g});if(m=!this.cellValueValidatorFunction({value:l,oldValue:k,column:f,rowData:g}))return this.cancel(),[2];h.innerHTML=this.loadingMessage;null===(a=this.grid)||void 0===
a?void 0:a.notifyResize();d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.updateStoreItemFunction({rowData:g,column:f,value:l})];case 2:return d.sent(),this.updateRowItemFunction({rowData:g,column:f,value:l}),n=this.getCellValue(f,g),p=this.cellValueFormatFunction({column:f,rowData:g,value:n}),h.innerHTML=p,this.emit("value-change",{column:f,rowData:g,value:n}),this._set("activeEditInfo",null),null===(c=this.grid)||void 0===c?void 0:c.notifyResize(),[3,4];case 3:return d.sent(),this.cancel(),
[3,4];case 4:return[2]}})})};d.__decorate([e.property({readOnly:!0})],a.prototype,"activeEditInfo",void 0);d.__decorate([e.property()],a.prototype,"cellValueValidatorFunction",void 0);d.__decorate([e.property()],a.prototype,"editable",void 0);d.__decorate([e.property()],a.prototype,"inputRenderFunction",void 0);d.__decorate([e.property({constructOnly:!0})],a.prototype,"loadingMessage",void 0);d.__decorate([e.property()],a.prototype,"inputType",void 0);d.__decorate([e.property()],a.prototype,"maxLength",
void 0);d.__decorate([e.property()],a.prototype,"parseInputValueFunction",void 0);d.__decorate([e.property()],a.prototype,"renderFunction",void 0);d.__decorate([e.property()],a.prototype,"required",void 0);d.__decorate([e.property()],a.prototype,"store",void 0);d.__decorate([e.property()],a.prototype,"updateRowItemFunction",void 0);d.__decorate([e.property()],a.prototype,"updateStoreItemFunction",void 0);return a=d.__decorate([e.subclass("esri.widgets.FeatureTable.EditorColumn")],a)}(m)});