// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Accessor ../../core/Collection ../../core/HandleOwner ../../core/Identifiable ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/support/Sublayer ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionSlider ../../support/actions/ActionToggle ./ListItemPanel ./support/layerListUtils".split(" "),function(g,x,c,n,k,p,q,e,d,r,t,u,v,w,l,f){g=k.ofType({key:"type",defaultKeyValue:"button",base:t,typeMap:{button:u,
toggle:w,slider:v}});var m=k.ofType(g);return function(g){function b(a){a=g.call(this,a)||this;a.actionsSections=new m;a.actionsOpen=!1;a.children=new (k.ofType(h));a.childrenSortable=!0;a.error=null;a.layer=null;a.layerView=null;a.open=!1;a.panel=null;a.parent=null;a.sortable=!0;a.view=null;a.visible=null;return a}c.__extends(b,g);h=b;b.prototype.initialize=function(){var a=this;this.handles.add([e.init(this,"layer",function(b){return a._watchLayerProperties(b)}),e.init(this,"view",function(b){return a._updateChildren(b)}),
e.init(this,"panel",function(b){return a._setListItemOnPanel(b)}),e.init(this,["layer","view"],function(){return a._getLayerView()})])};b.prototype.destroy=function(){this.view=null};b.prototype.castPanel=function(a){this.get("panel.open")&&!a.hasOwnProperty("open")&&(a.open=!0);return a?new l(a):null};Object.defineProperty(b.prototype,"title",{get:function(){var a=this.get("layer.layer");return(!a||a&&this.get("layer.layer.loaded"))&&this.get("layer.title")||""},set:function(a){void 0===a?this._clearOverride("title"):
this._override("title",a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){var a=this.layerView;return a?a.updating:this._isLayerUpdating(this.layer)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"visibleAtCurrentScale",{get:function(){return!f.isLayerOutsideScaleRange(this.layer,this.get("view.scale"))},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"visibilityMode",{get:function(){return f.findLayerVisibilityMode(this.layer)},
enumerable:!1,configurable:!0});b.prototype.clone=function(){return new h({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,children:this.children.clone(),layer:this.layer,open:this.open,panel:this.panel,title:this.title,view:this.view,visible:this.visible})};b.prototype._setListItemOnPanel=function(a){a&&(a.listItem=this)};b.prototype._updateChildren=function(a){var b=this.children;b&&b.forEach(function(b){return b.view=a})};b.prototype._addChildren=function(a){var b=this;
this.handles.remove("child-list-mode");this.children.removeAll();if(a){a.forEach(function(c){b.handles.add(e.watch(c,"listMode",function(){return b._addChildren(a)}),"child-list-mode")});var c=[];a.filter(function(a){return"hide"!==f.findLayerListMode(a)}).forEach(function(a){f.canDisplayLayer(a)&&(a=new h({layer:a,parent:b,view:b.view}),c.unshift(a))});this.children.addMany(c)}};b.prototype._watchSublayerChanges=function(a){var b=this;a&&this.handles.add(a.on("change",function(){b._addChildren(a)}),
"layer")};b.prototype._initializeChildLayers=function(a){this._addChildren(a);this._watchSublayerChanges(a)};b.prototype._watchLayerProperties=function(a){var b=this;if(this.handles&&(this.handles.remove("layer"),this.handles.remove("child-list-mode"),a))if(this.handles.add(e.watch(a,"listMode",function(){return b._watchLayerProperties(a)}),"layer"),"hide-children"===f.findLayerListMode(a))this.children.removeAll();else{var c=f.getNormalizedChildLayerProperty(a);c&&this.handles.add(e.init(a,c,function(){a.hasOwnProperty(c)&&
b._initializeChildLayers(a[c])}),"layer")}};b.prototype._getLayerView=function(){return c.__awaiter(this,void 0,void 0,function(){var a,b,d,e;return c.__generator(this,function(c){switch(c.label){case 0:a=this;b=a.layer;d=a.view;if(!b||!d)return[2];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,d.whenLayerView(b)];case 2:e=c.sent();if(e.layer!==this.layer)return[2];this._set("layerView",e);return[3,4];case 3:return c.sent(),[3,4];case 4:return[2]}})})};b.prototype._isLayerUpdating=function(a){return a instanceof
r?!1:a&&"loading"===a.loadStatus};var h;c.__decorate([d.property({type:m})],b.prototype,"actionsSections",void 0);c.__decorate([d.property()],b.prototype,"actionsOpen",void 0);c.__decorate([d.property({type:k})],b.prototype,"children",void 0);c.__decorate([d.property()],b.prototype,"childrenSortable",void 0);c.__decorate([d.aliasOf("layer.loadError?")],b.prototype,"error",void 0);c.__decorate([d.property()],b.prototype,"layer",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"layerView",
void 0);c.__decorate([d.property()],b.prototype,"open",void 0);c.__decorate([d.property({type:l})],b.prototype,"panel",void 0);c.__decorate([d.cast("panel")],b.prototype,"castPanel",null);c.__decorate([d.property()],b.prototype,"parent",void 0);c.__decorate([d.property()],b.prototype,"sortable",void 0);c.__decorate([d.property({dependsOn:["layer.layer?.loaded","layer.title"]})],b.prototype,"title",null);c.__decorate([d.property({dependsOn:["layer.loadStatus?","layerView.updating"],readOnly:!0})],
b.prototype,"updating",null);c.__decorate([d.property({value:null})],b.prototype,"view",void 0);c.__decorate([d.aliasOf("layer.visible")],b.prototype,"visible",void 0);c.__decorate([d.property({dependsOn:["layer.minScale?","layer.maxScale?","view.scale"],readOnly:!0})],b.prototype,"visibleAtCurrentScale",null);c.__decorate([d.property({dependsOn:["layer.visibilityMode?","layer.capabilities?.exportMap?.supportsSublayerVisibility","layer.layer?.capabilities?.exportMap?.supportsSublayerVisibility"],
readOnly:!0})],b.prototype,"visibilityMode",null);return b=h=c.__decorate([d.subclass("esri.widgets.LayerList.ListItem")],b)}(q.IdentifiableMixin(p.HandleOwnerMixin(n)))});