// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/arrayUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/Multipoint ../../../geometry/support/geodesicUtils ../../../views/support/QueueProcessor ../../../views/support/Scheduler ./constants ./geometryUtils ./statsUtils ./traversal @dojo/framework/shim/Promise".split(" "),function(R,g,a,H,D,m,I,J,K,L,M,A,N,O,P){function E(c,e,n){var l,p=c.densificationResult,h=c.result,F=c.provider,q=c.queryOptions,x=c.queue;return a.__awaiter(this,
void 0,void 0,function(){var c,k,r,t,b,d;return a.__generator(this,function(f){switch(f.label){case 0:return c=p.densifiedPath,k=p.pathLength,r=c.paths[0],t=e.map(function(b){return r[b]}),b=n?Math.round(k/F.numSamplesForPreview):null!==(l=q.demResolution)&&void 0!==l?l:"finest-contiguous",[4,x.push({geometry:new J({spatialReference:c.spatialReference,points:t,hasZ:!0}),provider:F,indices:e,result:h,queryOptions:a.__assign(a.__assign({},q),{demResolution:b})})];case 1:return f.sent(),m.throwIfAborted(q.signal),
d=h.samples.filter(function(b){return b.processed}),h.stats=O.getStats(d),h.progress=n?0:h.progress+e.length/r.length,[2,a.__assign(a.__assign({},h),{samples:d})]}})})}function Q(c){var e=c.geometry,n=c.provider,l=c.indices,p=c.result,h=c.queryOptions;return a.__awaiter(this,void 0,void 0,function(){var c,q,m,g,k,r,t,b,d,f;return a.__generator(this,function(a){switch(a.label){case 0:return 0===l.length?[2,null]:[4,n.queryElevation(e,h)];case 1:c=a.sent();q=c.geometry;m=h.noDataValue;g=p.samples;for(k=
0;k<l.length;k++)r=l[k],t=g[r],b=q.getPoint(k),d=b.hasZ,f=b.z,t.z=d&&f!==m?f:null,t.processed=!0;return[2]}})})}function C(a,e){return{x:a[0],y:a[1],z:null,distance:e,processed:!1}}Object.defineProperty(g,"__esModule",{value:!0});g.createProfileQueue=g.generateProfile=void 0;g.generateProfile=function(c){return a.__asyncGenerator(this,arguments,function(){var e,n,l,p,h,g,q,x,G,k,r,t;return a.__generator(this,function(b){switch(b.label){case 0:return b=c,e=a.__assign(a.__assign({},b),{options:a.__assign(a.__assign({},
A.DEFAULT_OPTIONS),b.options),queryOptions:a.__assign(a.__assign({},A.DEFAULT_ELEVATION_PROFILE_QUERY_OPTIONS),b.queryOptions)}),n=e.queryOptions.signal,b=l=e.path,D.isSome(b)&&0<b.paths.length&&2<=b.paths[0].length?[3,2]:[4,a.__await(null)];case 1:return[2,b.sent()];case 2:return[4,a.__await(N.densifyPath(l,e.options,{signal:n}))];case 3:p=b.sent();b=p.densifiedPath;var d=p.densifiedPathWgs84,f=b.paths[0],B=f.length,v=0,y=Array(B);y[0]=C(f[0],v);if(D.isSome(d))for(var w=f,f=d.paths[0],z=I.getMetersPerUnitForSR(b.spatialReference),
u={distance:0},d=1;d<B;d++)K.inverseGeodeticSolver(u,f[d-1],f[d]),v+=u.distance/z,y[d]=C(w[d],v);else for(d=1;d<B;d++)w=f[d],u=f[d-1],z=w[0]-u[0],u=w[1]-u[1],v+=Math.sqrt(z*z+u*u),y[d]=C(w,v);h={progress:0,samples:y,stats:null,spatialReference:b.spatialReference};g=a.__assign(a.__assign({},e),{path:l,densificationResult:p,result:h});q=P.getIndices(0,p.densifiedPath.paths[0].length);x=q.slice(0,g.provider.numSamplesForPreview);return[4,a.__await(E(g,x,!0))];case 4:return[4,a.__await.apply(void 0,[b.sent()])];
case 5:return[4,b.sent()];case 6:return b.sent(),m.throwIfAborted(n),[4,a.__await(m.after(A.DELAY_AFTER_PREVIEW_MILLIS))];case 7:b.sent(),m.throwIfAborted(n),G=H.splitIntoChunks(q,g.provider.numSamplesPerChunk),k=0,r=G,b.label=8;case 8:if(!(k<r.length))return[3,13];t=r[k];return[4,a.__await(E(g,t,!1))];case 9:return[4,a.__await.apply(void 0,[b.sent()])];case 10:return[4,b.sent()];case 11:b.sent(),m.throwIfAborted(n),b.label=12;case 12:return k++,[3,8];case 13:return h.progress=1,[4,a.__await(h)];
case 14:return[4,b.sent()];case 15:return b.sent(),[2]}})})};g.createProfileQueue=function(c){var e=this;return new L.QueueProcessor({task:M.Task.ELEVATION_PROFILE,concurrency:1,scheduler:c,process:function(c){return a.__awaiter(e,void 0,void 0,function(){var e;return a.__generator(this,function(a){switch(a.label){case 0:m.throwIfAborted(c.queryOptions),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,Q(c)];case 2:return a.sent(),[3,4];case 3:return e=a.sent(),m.isAbortError(e)?[2]:[3,4];case 4:return[2]}})})}})}});