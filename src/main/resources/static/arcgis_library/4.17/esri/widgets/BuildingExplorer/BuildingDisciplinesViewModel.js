// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Accessor ../../core/Collection ../../core/collectionUtils ../../core/Handles ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ./support/buildingLayerUtils ./support/LayerTreeNode ./support/layerUtils".split(" "),function(v,w,c,n,k,p,q,l,r,f,t,h,u){return function(m){function b(a){a=m.call(this,a)||this;a.root=new h.LayerTreeNode;a.state="disabled";a._handles=new q;a._loadLayers=u.createLoadLayersFunction();a.layers=new k;return a}
c.__extends(b,m);b.prototype.initialize=function(){var a=this;this._handles.add(this.layers.on("change",function(){return a._onLayersChange()}));this._onLayersChange()};b.prototype.destroy=function(){this._set("state","disabled");this._handles.destroy();this.root.destroy()};Object.defineProperty(b.prototype,"layers",{set:function(a){var d=this._get("layers");this._set("layers",p.referenceSetter(a,d))},enumerable:!1,configurable:!0});b.prototype._updateLayerTree=function(){var a=this;this.root.destroy();
this._set("root",new h.LayerTreeNode({collapsed:!1}));var d=new Map,b=1<this.layers.length?"modelName":"id";this.layers.forEach(function(e){e=t.findFullModelSublayer(e);l.isSome(e)&&a._addNodesForSublayers(e,a.root,d,b)});return this};b.prototype._addNodeForLayer=function(a,b,c,e){var d=String(a.get(e)).toLowerCase();if(l.isSome(d)&&!a.isEmpty){var f=b.id+"/"+d,g=c.get(f);g||(g=new h.LayerTreeNode({id:d,level:b.level+1}),c.set(f,g));g.layers.push(a);b.children.push(g);this._addNodesForSublayers(a,
g,c,e)}};b.prototype._addNodesForSublayers=function(a,b,c,e){var d=this;"building-group"!==a.type||a.isEmpty||a.sublayers.forEach(function(a){return d._addNodeForLayer(a,b,c,e)})};b.prototype._onLayersChange=function(){return c.__awaiter(this,void 0,void 0,function(){var a;return c.__generator(this,function(b){switch(b.label){case 0:this._set("state","loading");if(0===this.layers.length)return[2];b.label=1;case 1:return b.trys.push([1,3,,4]),[4,this._loadLayers(this.layers)];case 2:return b.sent(),
this._updateLayerTree(),this._set("state","ready"),[3,4];case 3:return a=b.sent(),r.isAbortError(a)||this._set("state","failed"),[3,4];case 4:return[2]}})})};c.__decorate([f.property({readOnly:!0})],b.prototype,"root",void 0);c.__decorate([f.property({type:k,nonNullable:!0})],b.prototype,"layers",null);c.__decorate([f.property({readOnly:!0,nonNullable:!0})],b.prototype,"state",void 0);return b=c.__decorate([f.subclass("esri.widgets.BuildingExplorer.BuildingDisciplineViewModel")],b)}(n)});