// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/Error ../core/unitFormatUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/widget".split(" "),function(z,A,d,h,x,n,f,y,t,u,b){var v={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},p=window.CSS;return function(w){function c(a,b){a=w.call(this,a,b)||this;a.abilities=null;a.displayType=
"list";a.graphic=null;a.label=void 0;a.messages=null;a.messagesUnits=null;a.selectedFile=null;a.submitting=!1;a.viewModel=new t;a.visibleElements=d.__assign({},v);a._supportsImageOrientation=p&&p.supports&&p.supports("image-orientation","from-image");a._addAttachmentForm=null;a._updateAttachmentForm=null;return a}d.__extends(c,w);c.prototype.initialize=function(){var a=this;this.own(n.on(this,"viewModel.attachmentInfos","change",function(){return a.scheduleRender()}),n.init(this,"viewModel.mode",
function(){return a._modeChanged()}))};c.prototype.castVisibleElements=function(a){return d.__assign(d.__assign({},v),a)};c.prototype.addAttachment=function(){var a=this,b=this._addAttachmentForm,c=this.viewModel;this._set("submitting",!0);this._set("error",null);return c.addAttachment(b).then(function(b){a._set("submitting",!1);a._set("error",null);c.mode="view";return b}).catch(function(b){a._set("submitting",!1);a._set("error",new h("attachments:add-attachment",a.messages.addErrorMessage,b));throw b;
})};c.prototype.deleteAttachment=function(a){var b=this,c=this.viewModel;this._set("submitting",!0);this._set("error",null);return c.deleteAttachment(a).then(function(a){b._set("submitting",!1);b._set("error",null);c.mode="view";return a}).catch(function(a){b._set("submitting",!1);b._set("error",new h("attachments:delete-attachment",b.messages.deleteErrorMessage,a));throw a;})};c.prototype.updateAttachment=function(){var a=this,b=this.viewModel,c=this._updateAttachmentForm;this._set("submitting",
!0);this._set("error",null);return b.updateAttachment(c).then(function(c){a._set("submitting",!1);a._set("error",null);b.mode="view";return c}).catch(function(b){a._set("submitting",!1);a._set("error",new h("attachments:update-attachment",a.messages.updateErrorMessage,b));throw b;})};c.prototype.render=function(){var a=this.submitting,c=this.viewModel.state;return b.tsx("div",{class:this.classes("esri-attachments","esri-widget")},a?this.renderProgressBar():null,"loading"===c?this.renderLoading():
this.renderAttachments(),this.renderErrorMessage())};c.prototype.renderErrorMessage=function(){var a=this.error,c=this.visibleElements;return a&&c.errorMessage?b.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},a.message):null};c.prototype.renderAttachments=function(){var a=this.viewModel,b=a.mode,a=a.activeAttachmentInfo;return"add"===b?this.renderAddForm():"edit"===b?this.renderDetailsForm(a):this.renderAttachmentContainer()};c.prototype.renderLoading=function(){return b.tsx("div",
{class:"esri-attachments__loader-container",key:"loader"},b.tsx("div",{class:"esri-attachments__loader"}))};c.prototype.renderProgressBar=function(){return this.visibleElements.progressBar?b.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null};c.prototype.renderAddForm=function(){var a,c=this.submitting,g=this.selectedFile,e=c||!g,c=this.visibleElements.cancelAddButton?b.tsx("button",{type:"button",bind:this,disabled:c,onclick:this._cancelForm,class:this.classes("esri-button",
"esri-button--tertiary","esri-button--small","esri-button--half",c&&"esri-button--disabled")},this.messages.cancel):null,e=this.visibleElements.addSubmitButton?b.tsx("button",{type:"submit",disabled:e,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",(a={},a["esri-button--disabled"]=e,a))},this.messages.add):null;a=g?b.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},g.name):null;g=b.tsx("form",{bind:this,afterCreate:b.storeNode,afterRemoved:b.discardNode,
"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},b.tsx("fieldset",{class:"esri-attachments__file-fieldset"},a,b.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},g?this.messages.changeFile:this.messages.selectFile,b.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),e,c);return b.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},
g)};c.prototype.renderDetailsForm=function(a){var c,g,e,d=this,f=this.visibleElements,l=this.selectedFile,k=this.submitting,q=a.contentType,h=a.size,p=a.url,m=this.viewModel.abilities,n=k||!l,r=m.editing&&m.operations.delete&&f.deleteButton?b.tsx("button",{key:"delete-button",type:"button",disabled:k,bind:this,onclick:function(b){return d._submitDeleteAttachment(b,a)},class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",(c={},c["esri-button--disabled"]=
k,c))},this.messages.delete):null;c=m.editing&&m.operations.update&&f.updateButton?b.tsx("button",{disabled:n,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",(g={},g["esri-button--disabled"]=n,g))},this.messages.update):null;g=this.visibleElements.cancelUpdateButton?b.tsx("button",{disabled:k,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small","esri-button--tertiary",
"esri-button--third",(e={},e["esri-button--disabled"]=k,e))},this.messages.cancel):null;e=l?b.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},l.name):null;m=m.editing&&m.operations.update?b.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},e,b.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,b.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):
null;h=b.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},b.tsx("label",null,x.formatFileSize(this.messagesUnits,h)));q=b.tsx("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},b.tsx("label",null,q));r=b.tsx("form",{bind:this,afterCreate:b.storeNode,afterRemoved:b.discardNode,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},b.tsx("div",{class:"esri-attachments__metadata"},h,q),m,b.tsx("div",{class:"esri-attachments__actions"},
r,g,c));return b.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},b.tsx("a",{class:"esri-attachments__item-link",href:p,rel:"noreferrer",target:"_blank",alt:name},this.renderImageMask({attachmentInfo:a,size:400}),b.tsx("div",{class:"esri-attachments__item-link-overlay"},b.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},b.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},b.tsx("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),
b.tsx("path",{fill:"none",d:"M0 0h32v32H0z"}))))),r)};c.prototype.renderImageMask=function(a){var c,g,e=a.attachmentInfo,d=a.size;a=this.viewModel.supportsResizeAttachments;var f=e.contentType,l=e.url,k=a&&u.isSupportedImage(f),e=(e=this._getCSSTransform(e,k))?{transform:e,"image-orientation":"none"}:{},h=-1===l.indexOf("?")?"?":"\x26",d=k?""+l+h+"w\x3d"+d:u.getIconPath(f),k=(c={},c["esri-attachments__item-mask--icon"]=!k,c);c=(g={},g["esri-attachments__image--resizable"]=a,g);return b.tsx("div",
{class:this.classes(k,"esri-attachments__item-mask")},b.tsx("img",{styles:e,alt:"",src:d,class:this.classes(c,"esri-attachments__image")}))};c.prototype.renderAttachmentInfo=function(a){var c=this,g=a.attachmentInfo,e=this.viewModel.abilities,d=g.name,f=g.url;a=this.renderImageMask({attachmentInfo:g,size:"list"===a.displayType?48:400});var l=e.editing?b.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",b.isRTL()?"esri-icon-left":"esri-icon-right")}):null,d=
b.tsx("label",{class:"esri-attachments__label"},b.tsx("span",{class:"esri-attachments__filename"},d||this.messages.noTitle),l),d=[a,d],e=e.editing?b.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":g.id,onclick:function(){return c._startEditAttachment(g)},type:"button"},d):b.tsx("a",{key:"details-link",class:"esri-attachments__item-button",href:f,target:"_blank"},
d);return b.tsx("li",{class:"esri-attachments__item",key:g},e)};c.prototype.renderAttachmentContainer=function(){var a,c=this,d=this.displayType,e=this.viewModel,f=this.visibleElements,h=e.attachmentInfos,l=e.abilities,k=h&&h.length,e=(a={},a["esri-attachments__container--list"]="preview"!==d,a["esri-attachments__container--preview"]="preview"===d,a);a=l.editing&&l.operations.add&&f.addButton?b.tsx("button",{bind:this,onclick:function(){return c._startAddAttachment()},class:this.classes("esri-button",
"esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},b.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null;h=k?b.tsx("ul",{class:"esri-attachments__items"},h.toArray().map(function(a){return c.renderAttachmentInfo({attachmentInfo:a,displayType:d})})):b.tsx("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return b.tsx("div",{key:"attachments-container",class:this.classes("esri-attachments__container",
e)},h,a)};c.prototype._modeChanged=function(){this._set("error",null);this._set("selectedFile",null)};c.prototype._handleFileInputChange=function(a){a=(a=a.target)&&a.files&&a.files.item(0);this._set("selectedFile",a)};c.prototype._submitDeleteAttachment=function(a,b){a.preventDefault();this.deleteAttachment(b)};c.prototype._submitAddAttachment=function(a){a.preventDefault();this.addAttachment()};c.prototype._submitUpdateAttachment=function(a){a.preventDefault();this.updateAttachment()};c.prototype._startEditAttachment=
function(a){var b=this.viewModel;b.activeAttachmentInfo=a;b.mode="edit"};c.prototype._startAddAttachment=function(){this.viewModel.mode="add"};c.prototype._cancelForm=function(a){a.preventDefault();this.viewModel.mode="view"};c.prototype._getCSSTransform=function(a,b){a=a.orientationInfo;return!this._supportsImageOrientation&&b&&a?[a.rotation?"rotate("+a.rotation+"deg)":"",a.mirrored?"scaleX(-1)":""].join(" "):""};d.__decorate([f.aliasOf("viewModel.abilities")],c.prototype,"abilities",void 0);d.__decorate([f.property(),
b.renderable()],c.prototype,"displayType",void 0);d.__decorate([f.aliasOf("viewModel.graphic")],c.prototype,"graphic",void 0);d.__decorate([f.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],c.prototype,"label",void 0);d.__decorate([f.property(),b.renderable(),b.messageBundle("esri/widgets/Attachments/t9n/Attachments")],c.prototype,"messages",void 0);d.__decorate([f.property(),b.renderable(),b.messageBundle("esri/core/t9n/Units")],c.prototype,"messagesUnits",void 0);d.__decorate([f.property({readOnly:!0})],
c.prototype,"selectedFile",void 0);d.__decorate([b.renderable(),f.property({readOnly:!0})],c.prototype,"submitting",void 0);d.__decorate([b.renderable(),f.property({readOnly:!0})],c.prototype,"error",void 0);d.__decorate([f.property({type:t}),b.renderable("viewModel.activeAttachmentInfo viewModel.mode viewModel.state viewModel.supportsResizeAttachments viewModel.attachmentInfos viewModel.graphic viewModel.abilities viewModel.abilities.editing viewModel.abilities.operations".split(" "))],c.prototype,
"viewModel",void 0);d.__decorate([f.property(),b.renderable()],c.prototype,"visibleElements",void 0);d.__decorate([f.cast("visibleElements")],c.prototype,"castVisibleElements",null);return c=d.__decorate([f.subclass("esri.widgets.Attachments")],c)}(y)});