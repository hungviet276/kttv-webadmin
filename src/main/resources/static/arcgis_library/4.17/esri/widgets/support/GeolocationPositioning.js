// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../assets ../../Graphic ../../core/Accessor ../../core/Error ../../core/Evented ../../core/promiseUtils ../../core/accessorSupport/decorators ../../symbols/PictureMarkerSymbol ./geolocationUtils ./GoTo".split(" "),function(E,F,d,w,x,y,z,A,B,e,C,h,D){return function(g){function b(){var a=null!==g&&g.apply(this,arguments)||this;a._geolocationUsable=!0;a._iconPath=w.getAssetUrl("esri/images/support/sdk_gps_location.png");a.geolocationOptions=null;a.goToLocationEnabled=
!0;a.graphic=new x({symbol:new C({url:a._iconPath,width:21,height:21})});a.scale=null;a.useHeadingEnabled=!0;a.view=null;return a}d.__extends(b,g);b.prototype.initialize=function(){h.supported()||(this._geolocationUsable=!1)};b.prototype.destroy=function(){this._clear();this.view=null};b.prototype._clear=function(){this.view&&this.view.graphics.remove(this.graphic)};b.prototype._getScaleWithinConstraints=function(a,c){return c?"2d"===c.type?(c=c.constraints,Math.min(c.effectiveMinScale,Math.max(c.effectiveMaxScale,
a))):a:a};b.prototype._getScale=function(a){var c=this.scale;return this._getScaleWithinConstraints("number"===typeof c?c:2500,a)};b.prototype._getHeading=function(a,c){c=c&&c.spatialReference;a=a.coords&&a.coords.heading;if(!(!c||!c.isWebMercator&&!c.isGeographic||"number"!==typeof a||isNaN(a)||0>a||360<a))return a};b.prototype._addHeading=function(a){var c=a.heading,b=a.target;(a=a.view)&&"number"===typeof c&&!isNaN(c)&&("3d"===a.type?b.heading=c:"2d"===a.type&&(b.rotation=360-c))};b.prototype._animatePoint=
function(a,c,b,d){var e=this.view;if(!this.goToLocationEnabled||!e)return B.resolve(c);var f=this.useHeadingEnabled?this._getHeading(c,e):void 0;a={target:a,scale:b};this._addHeading({heading:f,target:a,view:e});return this.callGoTo({target:a,options:d}).then(function(){return c})};b.prototype._setPosition=function(a,c){return d.__awaiter(this,void 0,void 0,function(){var b,e,g,f,k,l,m,n,p,q,r,t,u,v;return d.__generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,h.positionToPoint({position:a,
view:this.view},c)];case 1:return b=d.sent(),e=this.graphic,g=a.timestamp,f=a.coords,k=f.accuracy,l=f.altitude,m=f.altitudeAccuracy,n=f.heading,p=f.latitude,q=f.longitude,r=f.speed,t={timestamp:g,accuracy:k,altitude:l,altitudeAccuracy:m,heading:n,latitude:p,longitude:q,speed:r},e&&(e.geometry=b,e.attributes=t),u=this._getScale(this.view),[2,this._animatePoint(b,a,u,c)];case 2:throw v=d.sent(),new z("positioning:invalid-point","Cannot position invalid point",{error:v});case 3:return[2]}})})};d.__decorate([e.property()],
b.prototype,"_geolocationUsable",void 0);d.__decorate([e.property()],b.prototype,"geolocationOptions",void 0);d.__decorate([e.property()],b.prototype,"goToLocationEnabled",void 0);d.__decorate([e.property()],b.prototype,"graphic",void 0);d.__decorate([e.property()],b.prototype,"scale",void 0);d.__decorate([e.property()],b.prototype,"useHeadingEnabled",void 0);d.__decorate([e.property()],b.prototype,"view",void 0);return b=d.__decorate([e.subclass("esri.widgets.support.GeolocationPositioning")],b)}(D.GoToMixin(A.EventedMixin(y)))});