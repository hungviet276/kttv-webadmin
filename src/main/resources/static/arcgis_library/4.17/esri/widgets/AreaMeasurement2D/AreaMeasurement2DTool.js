// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../geometry ../../Graphic ../../intl ../../symbols ../../core/Handles ../../core/unitFormatUtils ../../core/unitUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/geometryEngine ../../geometry/projection ../../geometry/support/geodesicUtils ../../layers/GraphicsLayer ../../layers/GroupLayer ../../views/2d/draw/Draw ../../views/interactive/dragEventPipeline ../../views/interactive/GraphicManipulator ../../views/interactive/InteractiveToolBase".split(" "),
function(x,n,g,p,t,u,q,D,r,y,z,k,f,l,e,A,E,F,v,G,H){function I(b,d,c,a){var h=new q.SimpleMarkerSymbol({style:"circle",color:a.handleColor,size:a.handleWidth,outline:{type:"simple-line",width:0}});a=new q.SimpleMarkerSymbol({style:"circle",color:a.handleColor,size:1.5*a.handleWidth,outline:{type:"simple-line",width:0}});b=new t({geometry:b,symbol:h});return new G.GraphicManipulator({view:d,layer:c,graphic:b,focusedSymbol:a})}function B(b,d,c){if(2===b.length){b=new p.Polyline({paths:b,spatialReference:d});
var a=void 0;if(d.isGeographic)e.isSupported(d)?a=e.geodesicDensify(b,1E5):(b=l.project(b,p.SpatialReference.WGS84),b=e.geodesicDensify(b,1E5),a=l.project(b,d));else if(d.isWebMercator)a=f.geodesicDensify(b,1E5,"meters");else{var h=f.planarLength(b,"meters");h>=c?(b=l.project(b,p.SpatialReference.WGS84),b=e.geodesicDensify(b,1E5),a=l.project(b,d)):a=b}return{measurement:null,fillGeometry:null,outlineGeometry:a}}b.push(b[0]);var m=new p.Polyline({paths:[b],spatialReference:d}),g=new p.Polygon({rings:[b],
spatialReference:d}),a=b=null;if(d.isGeographic)if(e.isSupported(d)){b=e.geodesicDensify(m,1E5);a=e.geodesicDensify(g,1E5);a=f.simplify(a);if(!a)return null;c=e.geodesicLengths([m],"meters")[0];m=e.geodesicAreas([a],"square-meters")[0]}else{b=p.SpatialReference.WGS84;c=l.project(m,b);a=l.project(g,b);b=e.geodesicDensify(c,1E5);a=e.geodesicDensify(a,1E5);a=f.simplify(a);if(!a)return null;c=e.geodesicLengths([c],"meters")[0];m=e.geodesicAreas([a],"square-meters")[0];b=l.project(b,d);a=l.project(a,d)}else if(d.isWebMercator){b=
f.geodesicDensify(m,1E5,"meters");a=f.geodesicDensify(g,1E5,"meters");a=f.simplify(a);if(!a)return null;c=f.geodesicLength(m,"meters");m=f.geodesicArea(a,"square-meters")}else if(h=f.planarLength(m,"meters"),h>=c){b=p.SpatialReference.WGS84;c=l.project(m,b);a=l.project(g,b);b=e.geodesicDensify(c,1E5);a=e.geodesicDensify(a,1E5);a=f.simplify(a);if(!a)return null;c=e.geodesicLengths([c],"meters")[0];m=e.geodesicAreas([a],"square-meters")[0];b=l.project(b,d);a=l.project(a,d)}else{b=m;a=f.simplify(g);
if(!a)return null;c=h;m=f.planarArea(a,"square-meters")}return{measurement:{geometry:a,area:m,perimeter:c},fillGeometry:a,outlineGeometry:b}}function w(b){if(!b)return!1;var d=b.isGeographic,c=b.isWebMercator,a=b.isWGS84;return d&&!a&&!e.isSupported(b)||!d&&!c}function C(b,d,c){if(!d||!b)return null;var a={area:null,perimeter:null},h=d.area;d=d.perimeter;switch(c){case "metric":a.area=r.formatMetricArea(b,h,"square-meters");break;case "imperial":a.area=r.formatImperialArea(b,h,"square-meters");break;
default:h=y.convertUnit(h,"square-meters",c),a.area=r.formatDecimal(b,h,c)}if(c=J(c))switch(c){case "metric":a.perimeter=r.formatMetricLength(b,d,"meters");break;case "imperial":a.perimeter=r.formatImperialLength(b,d,"meters");break;default:d=y.convertUnit(d,"meters",c),a.perimeter=r.formatDecimal(b,d,c)}else a.perimeter="";return a}function J(b){switch(b){case "metric":return"metric";case "imperial":return"imperial";case "square-inches":return"inches";case "square-feet":return"feet";case "square-yards":return"yards";
case "square-miles":return"miles";case "square-us-feet":return"us-feet";case "square-meters":return"meters";case "square-kilometers":return"kilometers";case "acres":return"imperial";case "ares":case "hectares":return"metric";case "square-millimeters":return"millimeters";case "square-centimeters":return"centimeters";case "square-decimeters":return"decimeters";default:return null}}Object.defineProperty(n,"__esModule",{value:!0});n.createAreaMeasurementLabel=n.isSupported=n.createAreaMeasurementInfo2D=
void 0;x=function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;c._drawActive=!1;c._handles=new D;c._graphicsLayer=new A;c._manipulatorLayer=new A;c._groupLayer=new E({layers:[c._graphicsLayer,c._manipulatorLayer],listMode:"hide",visible:!1});c._vertices=[];c.deferCreation=!0;c.geodesicDistanceThreshold=1E5;c.measurement=null;c.measurementLabel=null;return c}g.__extends(d,b);d.prototype.initialize=function(){var c=this;u.loadMessageBundle("esri/core/t9n/Units").then(function(a){c.messages=
a});this._handles.add(u.onLocaleChange(function(){return g.__awaiter(c,void 0,void 0,function(){var a;return g.__generator(this,function(c){switch(c.label){case 0:return a=this,[4,u.loadMessageBundle("esri/core/t9n/Units")];case 1:return a.messages=c.sent(),[2]}})})}))};d.prototype.destroy=function(){this.detach();this._draw&&(this._draw.destroy(),this._draw=null);this._handles&&(this._handles.destroy(),this._handles=null);this._graphicsLayer&&(this._graphicsLayer.destroy(),this._graphicsLayer=null);
this._manipulatorLayer&&(this._manipulatorLayer.destroy(),this._manipulatorLayer=null)};Object.defineProperty(d.prototype,"editable",{set:function(c){this._set("editable",c);c||this._draw.reset()},enumerable:!1,configurable:!0});d.prototype.activate=function(){this._drawActive||0!==this._vertices.length||this._startSketch()};d.prototype.onAttach=function(){var c=this,a=this.view;this._draw=new F({view:a});a.map.add(this._groupLayer);a.focus();this._handles.add([z.init(this,["unit","geodesicDistanceThreshold",
"palette","messages"],function(){0<c._vertices.length&&c._updateGraphics()}),z.init(this,"view.spatialReference",function(a){w(a)&&!l.isLoaded()&&l.load()})]);this.create()};d.prototype.onDetach=function(){var c=this.view.map;this._draw.view=null;this._draw.destroy();this._draw=null;c.remove(this._groupLayer);this._handles.removeAll();this._graphicsLayer.removeAll();this._manipulatorLayer.removeAll();this._set("measurement",null);this._set("measurementLabel",null)};d.prototype.onShow=function(){this._groupLayer.visible=
!0};d.prototype.onHide=function(){this._groupLayer.visible=!1};d.prototype.reset=function(){this._vertices=[];this._graphicsLayer.removeAll();this._set("measurement",null);this._set("measurementLabel",null);this._draw.reset();this._drawActive=!1;this._updateSketch([])};d.prototype.onInputEvent=function(c){"pointer-move"===c.type&&this._updateCursor()};d.prototype._startSketch=function(){var c=this;this._drawActive=!0;var a=this._draw.create("polyline",{mode:"click"});a.on("vertex-add vertex-update vertex-remove cursor-update undo redo".split(" "),
function(a){return c._updateSketch(a.vertices)});a.on("draw-complete",function(){return c._stopSketch()})};d.prototype._stopSketch=function(){3>this._vertices.length?(this.reset(),this._startSketch()):(this.manipulators.forEach(function(c){c.manipulator.interactive=!0}),this._drawActive=!1,this.complete())};d.prototype._updateSketch=function(c){var a=this;if(!w(this.view.spatialReference)||l.isLoaded())if(2>c.length)this._vertices=[],this.manipulators.removeAll(),this._graphicsLayer.removeAll();else{this.create();
for(var b=this.view.spatialReference;this._vertices.length>c.length;){var d=this._vertices.pop().manipulatorId;this.manipulators.remove(d)}for(var d=function(d){var e=c[d],f=e[0],e=e[1],h=new p.Point({x:f,y:e,spatialReference:b}),h=I(h,g.view,g._manipulatorLayer,g.palette),m=g.manipulators.add(h);v.createManipulatorDragEventPipeline(h,function(c,b){b.next(v.screenToMap(a.view)).next(v.dragGraphic(c.graphic)).next(function(){var b=c.graphic.geometry;a._vertices[d].coord=[b.x,b.y];a._updateGraphics()})});
g._vertices.push({manipulatorId:m,coord:[f,e]})},g=this,e=this._vertices.length;e<c.length;e++)d(e);var d=this._vertices.length-1,e=this._vertices[d],f=c[d],k=f[0],f=f[1];if(e.coord[0]!==k||e.coord[1]!==f)e.coord=[k,f],k=new p.Point({x:k,y:f,spatialReference:b}),this.manipulators.findById(e.manipulatorId).graphic.geometry=k;var n=this._drawActive?this._vertices[d].manipulatorId:null;this.manipulators.forEach(function(a){a.manipulator.interactive=null==n||a.id!==n});this._updateGraphics()}};d.prototype._updateCursor=
function(){this.cursor=this._drawActive?"crosshair":null};d.prototype._updateGraphics=function(){this._graphicsLayer.removeAll();var c=this._vertices.map(function(a){return a.coord}),a=B(c,this.view.spatialReference,this.geodesicDistanceThreshold),b=a.measurement,c=a.fillGeometry,a=a.outlineGeometry;this._set("measurement",b);b=b?C(this.messages,b,this.unit):null;this._set("measurementLabel",b);if(c||a){var d=this.palette,e=d.fillColor,g=d.pathColor,d=d.pathWidth,f=[];c&&f.push(new t({geometry:c,
symbol:new q.SimpleFillSymbol({color:e,outline:new q.SimpleLineSymbol({width:0})})}));a&&f.push(new t({geometry:a,symbol:new q.SimpleLineSymbol({color:g,width:d})}));c&&b&&f.push(new t({geometry:c.centroid,symbol:new q.TextSymbol({color:[255,255,255,1],haloColor:[0,0,0,.5],haloSize:2,text:b.area,font:new q.Font({size:14,family:"sans-serif"})})}));this._graphicsLayer.addMany(f)}};g.__decorate([k.property()],d.prototype,"cursor",void 0);g.__decorate([k.property({value:!0})],d.prototype,"editable",null);
g.__decorate([k.property({type:Number})],d.prototype,"geodesicDistanceThreshold",void 0);g.__decorate([k.property({readOnly:!0})],d.prototype,"measurement",void 0);g.__decorate([k.property({readOnly:!0})],d.prototype,"measurementLabel",void 0);g.__decorate([k.property()],d.prototype,"messages",void 0);g.__decorate([k.property()],d.prototype,"palette",void 0);g.__decorate([k.property()],d.prototype,"unit",void 0);g.__decorate([k.property({constructOnly:!0})],d.prototype,"view",void 0);return d=g.__decorate([k.subclass("esri.widgets.AreaMeasurement2D.AreaMeasurement2DTool")],
d)}(H.InteractiveToolBase);n.createAreaMeasurementInfo2D=B;n.isSupported=function(b){return null!=b&&(!w(b)||l.isSupported())};n.createAreaMeasurementLabel=C;n.default=x});