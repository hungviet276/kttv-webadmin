// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../TimeExtent ../../TimeInterval ../../core/compilerUtils ../../core/HandleOwner ../../core/mathUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../layers/support/timeUtils".split(" "),function(u,v,d,f,l,m,n,p,q,e,h,r){return function(k){function b(a){a=k.call(this,a)||this;a.fullTimeExtent=null;a.loop=!1;a.mode="time-window";a.stops={count:10};a.timerId=null;a.view=null;return a}d.__extends(b,k);b.prototype.initialize=
function(){var a=this;this.handles.add(q.init(this,["stops","fullTimeExtent"],function(){return a._createDefaultValues()}))};b.prototype.destroy=function(){null!=this.timerId&&(clearInterval(this.timerId),this.timerId=null);this.view=null};Object.defineProperty(b.prototype,"effectiveStops",{get:function(){var a=this.fullTimeExtent,c=this.stops;if(!c)return[];if("dates"in c){c=c.dates;if(null==c||0===c.length)return null;c=c.sort(function(a,c){return a.getTime()-c.getTime()});return a?c.filter(function(c){var b=
a.start,t=a.end;return!(c.getTime()<b.getTime()||c.getTime()>t.getTime())}):c}if("count"in c){var b=c.timeExtent||a;return this._divideTimeExtentByCount(b,c.count)}return"interval"in c?(b=c.timeExtent||a,this._divideTimeExtentByInterval(b,c.interval)):[]},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"playRate",{set:function(a){0>=a||36E5<a||("playing"===this.state&&this._startAnimation(),this._set("playRate",a))},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"state",{get:function(){return this.values&&this.fullTimeExtent?this.timerId?"playing":"ready":"disabled"},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"timeExtent",{get:function(){var a=this.mode,c=this.values;if(!c||0===c.length)return null;switch(a){case "instant":return new f({start:c[0],end:c[0]});case "time-window":return 1<c.length?new f({start:c[0],end:c[1]}):null;case "cumulative-from-start":return new f({start:null,end:c[0]});case "cumulative-from-end":return new f({start:c[0],
end:null});default:m.neverReached(a)}},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"values",{set:function(a){var c=this.fullTimeExtent,b=this.view;if(c){var g=c.end,d=c.start.getTime(),e=g.getTime();a=a&&a.filter(function(a){return a}).map(function(a){a=a.getTime();a=p.clamp(a,d,e);return new Date(a)})}b&&(b.timeExtent=this._toTimeExtent(a));this._set("values",a)},enumerable:!1,configurable:!0});b.prototype.next=function(){this.values&&this.fullTimeExtent&&this._step({forward:!0,
allowRestart:!1})};b.prototype.play=function(){this._clearAnimation();this._startAnimation()};b.prototype.previous=function(){this._step({forward:!1,allowRestart:!1})};b.prototype.stop=function(){this._clearAnimation()};b.prototype._clearAnimation=function(){null!=this.timerId&&(clearInterval(this.timerId),this.timerId=null)};b.prototype._createDefaultValues=function(){var a=this.effectiveStops,c=this.mode,b=this.values;this.fullTimeExtent&&a&&c&&!b&&(this.values="time-window"===c?1<a.length?[a[0],
a[1]]:null:0<a.length?[a[0]]:null)};b.prototype._startAnimation=function(){var a=this;this._step({forward:!0,allowRestart:!0});this.timerId=setInterval(function(){a._step({forward:!0,allowRestart:!1})},this.playRate)};b.prototype._step=function(a){var c=a.forward;a=a.allowRestart;var b=this.effectiveStops,g=this.values;if(g&&0!==g.length&&!(g.length>b.length)){var d=b.map(function(a){return a.getTime()}).sort(function(a,c){return a-c}),b=g.map(function(a){return a.getTime()}).map(function(a){var c=
d.indexOf(a);if(-1!==c)return c;c=d.reduce(function(c,b){return Math.abs(b-a)<Math.abs(c-a)?b:c});return d.indexOf(c)}),g=b.map(function(a){return a+=c?1:-1}),e=g.some(function(a){return 0>a||a>d.length-1}),f=this.loop,h=this.state;if(e)if(f||a){var k=Math.min.apply(Math,b),l=Math.max.apply(Math,b);this.values=(c?b.map(function(a){return a-k}):b.map(function(a){return a+(d.length-1-l)})).map(function(a){return new Date(d[a])})}else"playing"===h&&this.stop();else this.values=g.map(function(a){return new Date(d[a])})}};
b.prototype._divideTimeExtentByCount=function(a,c){void 0===c&&(c=10);if(!a||!c)return[];var b=a.start,d=a.end;if(!b||!d)return[];if(1E4<c)return this._divideTimeExtentByCount(a);a=[];for(var b=b.getTime(),d=d.getTime()-b,e=0;e<=c;e++)a.push(new Date(b+e/c*d));return a};b.prototype._divideTimeExtentByInterval=function(a,c,b){void 0===b&&(b=1E4);if(!a||!c)return[];var d=a.start,e=a.end;if(!d||!e)return[];var f=e.getTime()-d.getTime(),h=c.toMilliseconds();if(f/h>b)return this._divideTimeExtentByCount(a);
a=[];b=c.value;for(c=c.unit;d.getTime()<=e.getTime();)a.push(new Date(d.getTime())),d=r.offsetDate(d,b,c);return a};b.prototype._toTimeExtent=function(a){if(!a||0===a.length)return null;var b=a[0];a=1<a.length?a[1]:a[0];switch(this.mode){case "instant":case "time-window":return new f({start:b,end:a});case "cumulative-from-start":return new f({start:null,end:b});case "cumulative-from-end":return new f({start:b,end:null});default:return null}};d.__decorate([e.property({dependsOn:["stops","fullTimeExtent"],
readOnly:!0})],b.prototype,"effectiveStops",null);d.__decorate([e.property({type:f})],b.prototype,"fullTimeExtent",void 0);d.__decorate([e.property({nonNullable:!0})],b.prototype,"loop",void 0);d.__decorate([e.property({nonNullable:!0})],b.prototype,"mode",void 0);d.__decorate([e.property({nonNullable:!0,value:1E3})],b.prototype,"playRate",null);d.__decorate([e.property({dependsOn:["fullTimeExtent","timerId","values"],readOnly:!0})],b.prototype,"state",null);d.__decorate([e.property({cast:function(a){if(!a)return null;
"interval"in a&&(a.interval=h.ensureType(l,a.interval));"timeExtent"in a&&(a.timeExtent=h.ensureType(f,a.timeExtent));return a}})],b.prototype,"stops",void 0);d.__decorate([e.property({dependsOn:["values"],readOnly:!0})],b.prototype,"timeExtent",null);d.__decorate([e.property()],b.prototype,"timerId",void 0);d.__decorate([e.property({value:null})],b.prototype,"values",null);d.__decorate([e.property()],b.prototype,"view",void 0);d.__decorate([e.property()],b.prototype,"next",null);d.__decorate([e.property()],
b.prototype,"play",null);d.__decorate([e.property()],b.prototype,"previous",null);d.__decorate([e.property()],b.prototype,"stop",null);return b=d.__decorate([e.subclass("esri.widgets.TimeSlider.TimeSliderViewModel")],b)}(n.HandleOwner)});