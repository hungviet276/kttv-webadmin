// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/compilerUtils ../core/promiseUtils ../core/accessorSupport/decorators ./Widget ./Measurement/MeasurementViewModel ./support/widget @dojo/framework/shim/Promise".split(" "),function(m,v,c,n,t,d,u,k,g){return function(l){function a(b,e){b=l.call(this,b,e)||this;b._widgets=new Map;b.activeTool=null;b.activeWidget=null;b.areaUnit=null;b.iconClass="esri-icon-measure";b.label=void 0;b.linearUnit=null;b.messages=null;b.view=null;b.viewModel=new k;return b}c.__extends(a,
l);a.prototype.initialize=function(){var b=this;this.activeWidget&&this.viewModel.set("activeViewModel",this.activeWidget.viewModel);this.view&&this.activeTool&&this._getActiveWidget().then(function(e){b._set("activeWidget",e)});this.own([this.watch(["view","activeTool"],function(){b._getActiveWidget().then(function(e){b._set("activeWidget",e)})}),this.watch("activeWidget",function(e,a){b.viewModel.set("activeViewModel",e?e.viewModel:null);a&&(a.visible=!1)}),this.watch(["areaUnit","linearUnit"],
function(){return b._updateWidgetUnits()})])};a.prototype.destroy=function(){this._destroyWidgets()};a.prototype.render=function(){var b=this.activeWidget,b=b&&!b.destroyed?b.render():null;return g.tsx("div",{class:"esri-measurement"},b)};a.prototype.clear=function(){this.activeTool=null;this._destroyWidgets()};a.prototype.startMeasurement=function(){var b=this.viewModel.activeViewModel;b&&t.ignoreAbortErrors(b.start())};a.prototype._createWidget=function(b){return c.__awaiter(this,void 0,void 0,
function(){var e,a,f,h,d,g,k,l,p,q,r;return c.__generator(this,function(c){switch(c.label){case 0:e=this;a=e.areaUnit;f=e.linearUnit;h=e.view;d=b;switch(d){case "area":return[3,1];case "distance":return[3,7];case "direct-line":return[3,9]}return[3,11];case 1:k=g=h.type;switch(k){case "2d":return[3,2];case "3d":return[3,4]}return[3,6];case 2:return[4,new Promise(function(b,a){m(["./AreaMeasurement2D"],b,a)})];case 3:return l=c.sent(),[2,new l({view:h,unit:a})];case 4:return[4,new Promise(function(b,
a){m(["./AreaMeasurement3D"],b,a)})];case 5:return p=c.sent(),[2,new p({view:h,unit:a})];case 6:return n.neverReached(g),[2,null];case 7:return[4,new Promise(function(b,a){m(["./DistanceMeasurement2D"],b,a)})];case 8:return q=c.sent(),[2,new q({view:h,unit:f})];case 9:return[4,new Promise(function(b,a){m(["./DirectLineMeasurement3D"],b,a)})];case 10:return r=c.sent(),[2,new r({view:h,unit:f})];case 11:return n.neverReached(b),[2,null]}})})};a.prototype._destroyWidgets=function(){this._widgets.forEach(function(b){return b.destroy()});
this._widgets.clear()};a.prototype._getActiveWidget=function(){return c.__awaiter(this,void 0,void 0,function(){var b,a,d,f;return c.__generator(this,function(c){switch(c.label){case 0:b=this;a=b.activeTool;d=b.view;if(!d||!a)return[2,null];f=null;if(!this._widgets.has(a))return[3,1];f=this._widgets.get(a);f.visible=!0;return[3,4];case 1:return[4,this._createWidget(a)];case 2:return(f=c.sent())?[4,f.viewModel.start()]:[2,null];case 3:c.sent(),this._widgets.set(a,f),c.label=4;case 4:return[2,f]}})})};
a.prototype._updateWidgetUnits=function(){var b=this;this._widgets.forEach(function(a){var c=b.areaUnit,d=b.linearUnit;a.unit=!a||"esri.widgets.AreaMeasurement2D"!==a.declaredClass&&"esri.widgets.AreaMeasurement3D"!==a.declaredClass?d:c})};c.__decorate([d.aliasOf("viewModel.activeTool")],a.prototype,"activeTool",void 0);c.__decorate([d.property({readOnly:!0}),g.renderable()],a.prototype,"activeWidget",void 0);c.__decorate([d.aliasOf("viewModel.areaUnit")],a.prototype,"areaUnit",void 0);c.__decorate([d.property()],
a.prototype,"iconClass",void 0);c.__decorate([d.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],a.prototype,"label",void 0);c.__decorate([d.aliasOf("viewModel.linearUnit")],a.prototype,"linearUnit",void 0);c.__decorate([d.property(),g.renderable(),g.messageBundle("esri/widgets/Measurement/t9n/Measurement")],a.prototype,"messages",void 0);c.__decorate([d.aliasOf("viewModel.view"),g.renderable()],a.prototype,"view",void 0);c.__decorate([d.property({type:k}),g.renderable(["viewModel.state"])],
a.prototype,"viewModel",void 0);return a=c.__decorate([d.subclass("esri.widgets.Measurement")],a)}(u)});