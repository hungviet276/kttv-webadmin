// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Collection ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./ListItem ./support/layerListUtils".split(" "),function(w,x,k,t,u,v,l,m,p,n){var q=t.ofType(p);return function(r){function b(a){a=r.call(this,a)||this;a._handles=new v;a.listItemCreatedFunction=null;a.operationalItems=new q;a.view=null;return a}k.__extends(b,r);b.prototype.initialize=function(){var a=this;this._handles.add(l.init(this,["view","view.ready"],
function(){return a._viewHandles()}),"view")};b.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null;this.operationalItems.removeAll()};Object.defineProperty(b.prototype,"state",{get:function(){var a=this.get("view");return this.get("view.ready")?"ready":a?"loading":"disabled"},enumerable:!1,configurable:!0});b.prototype.triggerAction=function(a,c){a&&!a.disabled&&this.emit("trigger-action",{action:a,item:c})};b.prototype.moveListItem=function(a,c,d,b){var e,f,g=null===
a||void 0===a?void 0:a.layer;if(g){var h=null===(f=null===(e=this.view)||void 0===e?void 0:e.map)||void 0===f?void 0:f.layers;e=c?n.getItemLayers(c):h;h=d?n.getItemLayers(d):h;e&&h&&(f=this.operationalItems,c=(null===c||void 0===c?void 0:c.children)||f,f=(null===d||void 0===d?void 0:d.children)||f,b=h.length-b,a.parent=d||null,c.includes(a)&&c.remove(a),e.includes(g)&&e.remove(g),f.includes(a)||f.add(a,b),h.includes(g)||h.add(g,b))}};b.prototype._createLayerViewHandles=function(a){var c=this,d=this._handles;
d.remove("layer-views");this._compileList();a&&d.add(a.on("change",function(){return c._compileList()}),"layer-views")};b.prototype._createMapLayerHandles=function(a){var c=this,d=this._handles;d.remove("map-layers");this._compileList();a&&d.add(a.on("change",function(){return c._compileList()}),"map-layers")};b.prototype._watchItemProperties=function(a){var c=this;this._handles.add([a.children.on("change",function(){c._modifyListItemChildren(a.children)})],"children-change-"+a.uid)};b.prototype._modifyListItemChildren=
function(a){var c=this;a.forEach(function(a){return c._modifyListItem(a)})};b.prototype._modifyListItem=function(a){"function"===typeof this.listItemCreatedFunction&&this.listItemCreatedFunction.call(null,{item:a});this._modifyListItemChildren(a.children)};b.prototype._createListItem=function(a){a=new p({layer:a,view:this.view});this._watchItemProperties(a);return a};b.prototype._removeAllItems=function(){var a=this._handles,c=this.operationalItems;c.forEach(function(c){a.remove("children-change-"+
c.uid)});c.removeAll()};b.prototype._getViewableLayers=function(a){if(a)return a.filter(function(a){return"hide"!==n.findLayerListMode(a)})};b.prototype._watchLayersListMode=function(a){var c=this,b=this._handles;b.remove("layer-list-mode");a&&a.forEach(function(a){b.add(l.watch(a,"listMode",function(){return c._compileList()}),"layer-list-mode")})};b.prototype._compileList=function(){var a=this.get("view.map.layers");this._watchLayersListMode(a);(a=this._getViewableLayers(a))&&a.length?(this._createNewItems(a),
this._modifyOrRemoveItems(a),this._sortItems(a)):this._removeAllItems()};b.prototype._createNewItems=function(a){var c=this,b=this.operationalItems;a.forEach(function(a){b.find(function(b){return b.layer===a})||b.add(c._createListItem(a))})};b.prototype._modifyOrRemoveItems=function(a){var b=this,d=this._handles,g=this.operationalItems,e=[];g.forEach(function(c){c&&a&&a.find(function(a){return c.layer===a})?b._modifyListItem(c):(d.remove("children-change-"+c.uid),e.push(c))});g.removeMany(e)};b.prototype._sortItems=
function(a){this.operationalItems.sort(function(b,d){b=a.indexOf(b.layer);d=a.indexOf(d.layer);return b>d?-1:b<d?1:0})};b.prototype._viewHandles=function(){var a=this,b=this._handles,d=this.view;b.remove(["map-layers","layer-views","view-layers"]);this._compileList();d&&d.ready&&b.add([l.init(this,"view.map.layers",function(b){return a._createMapLayerHandles(b)}),l.init(this,"view.layerViews",function(b){return a._createLayerViewHandles(b)}),l.init(this,"listItemCreatedFunction",function(){return a._compileList()})],
"view-layers")};k.__decorate([m.property()],b.prototype,"listItemCreatedFunction",void 0);k.__decorate([m.property({type:q})],b.prototype,"operationalItems",void 0);k.__decorate([m.property({dependsOn:["view.ready"],readOnly:!0})],b.prototype,"state",null);k.__decorate([m.property()],b.prototype,"view",void 0);return b=k.__decorate([m.subclass("esri.widgets.LayerList.LayerListViewModel")],b)}(u.EventedAccessor)});