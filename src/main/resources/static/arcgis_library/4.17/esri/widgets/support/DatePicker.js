// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../intl ../../core/events ../../core/Logger ../../core/accessorSupport/decorators ../../intl/moment ../Widget ./datePickerUtils ./DatePickerViewModel ./Popover ./widget".split(" "),function(D,E,f,g,m,t,h,w,x,y,n,z,c){var k={year:"numeric",month:"2-digit",day:"2-digit"},A=" ;ArrowDown;ArrowLeft;ArrowRight;ArrowUp;End;Enter;Home;PageDown;PageUp".split(";"),B=t.getLogger("esri.widgets.support.DatePicker"),p="onfocusout"in HTMLElement.prototype,C="formatToParts"in Intl.DateTimeFormat.prototype;
return function(q){function a(b,a){var d=q.call(this,b,a)||this;d._activeDate=null;d._calendarNode=null;d._calendarPopover=new z({owner:d,placement:"bottom-start",anchorElement:function(){return d._rootNode},renderContentFunction:d._renderCalendar});d._closedByUserAction=!1;d._isOpen=!1;d._requestDayPickerFocusOnCreate=!1;d._rootNode=null;d.dateInputEnabled=!1;d.label=void 0;d.messages=null;d.value=null;d.commitOnMonthChange=!1;d.viewModel=new n;d._handleDatePickerBlur=p?null:d._handleDatePickerBlurOrFocusOut;
d._handleDatePickerFocusOut=p?d._handleDatePickerBlurOrFocusOut:null;d._toggle=d._toggle.bind(d);return d}f.__extends(a,q);a.prototype.loadLocale=function(){return f.__awaiter(this,void 0,void 0,function(){var b;return f.__generator(this,function(a){switch(a.label){case 0:return b=this,[4,w.loadMoment()];case 1:return b._moment=a.sent(),this._isOpen&&(this._activeDate=this._moment(this._activeDate.toDate())),[2]}})})};a.prototype.destroy=function(){this._calendarPopover.destroy()};a.prototype.render=
function(){return c.tsx("div",{afterCreate:c.storeNode,bind:this,class:this.classes("esri-date-picker","esri-widget"),"data-node-ref":"_rootNode"},C&&this.dateInputEnabled?this.renderInputAndButtonMode():this.renderButtonOnlyMode())};a.prototype.renderButtonOnlyMode=function(){var b=g.formatDate(this.viewModel.value,k),a=this._isOpen,d=this.messages;return c.tsx("div",{afterUpdate:this._focusSelectedOrClosed,"aria-controls":a?this._getCalendarId():null,"aria-expanded":a.toString(),"aria-haspopup":"true",
"aria-label":d.setDate,"aria-pressed":a.toString(),class:this.classes("esri-widget--button","esri-select","esri-date-picker__calendar-toggle"),onclick:this._toggle,onkeydown:this._toggle,role:"button",tabIndex:0},c.tsx("span",{class:"esri-date-picker__date"},b))};a.prototype.renderInputAndButtonMode=function(){var b=g.formatDate(this.viewModel.value,k),a=this._isOpen,d=this.messages;return c.tsx("div",{class:this.classes("esri-date-picker__input")},c.tsx("input",{"aria-controls":a?this._getCalendarId():
null,"aria-haspopup":"true","aria-label":d.setDate,bind:this,class:this.classes("esri-date-picker__text-input","esri-input"),key:"date-input",onblur:this._handleDateInputBlur,onfocus:this._handleDateInputFocus,onkeydown:this._handleDateInputKeyDown,type:"text",value:b}),c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-date-picker__icon--leading","esri-icon-calendar")}))};a.prototype._handleDateInputKeyDown=function(b){"Enter"===b.key&&this._handleDateText(b)};a.prototype._handleDateInputBlur=
function(b){this._handleDatePickerBlurOrFocusOut(b);this._isOpen||this._handleDateText(b)};a.prototype._handleDateInputFocus=function(){this._open(this.viewModel.value,!1)};a.prototype._handleDateText=function(b){b=b.currentTarget;var a;try{a=y.parseDateIntoParts(b.value,k)}catch(d){B.warn(d);b.value=g.formatDate(this.viewModel.value,k);return}a=this._moment(a);a.isValid()?(this.viewModel.value=a.toDate(),this._activeDate=a):b.value=g.formatDate(this.viewModel.value,k)};a.prototype._focusSelectedOrClosed=
function(b){this._closedByUserAction&&(this._closedByUserAction=!1,b.focus())};a.prototype._handleDatePickerKeydown=function(b){"Escape"===m.eventKey(b)&&(this._closedByUserAction=!0,this._close(),b.preventDefault(),b.stopPropagation())};a.prototype._renderCalendar=function(){var b=this._activeDate,a=this._moment(this.viewModel.value);return c.tsx("div",{afterCreate:c.storeNode,bind:this,class:this.classes("esri-date-picker__calendar","esri-widget"),"data-node-ref":"_calendarNode",id:this._getCalendarId(),
key:"esri-date-picker__calendar",onkeydown:this._handleDatePickerKeydown},this._renderMonthPicker(b),this._renderDayPicker(b,a),this._renderYearPicker(b))};a.prototype._getCalendarId=function(){return"date-picker__calendar--"+this.id};a.prototype._handleDatePickerBlurOrFocusOut=function(b){b.currentTarget===b.target&&(b=b.relatedTarget,this._calendarNode.contains(b)||this._rootNode.contains(b)||this._close())};a.prototype._renderMonthPicker=function(b){var a=c.isRTL(),d=a?"esri-icon-right":"esri-icon-left",
a=a?"esri-icon-left":"esri-icon-right",r=this._moment.months().map(function(a,d){d=b.month()===d;return c.tsx("option",{selected:d},a)}),e=this.messages;return c.tsx("div",{class:"esri-date-picker__month-picker"},c.tsx("div",{"aria-label":e.goToPreviousMonth,bind:this,class:"esri-widget--button",onblur:this._handleDatePickerBlur,onclick:this._setPreviousMonth,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setPreviousMonth,role:"button",tabIndex:0,title:e.goToPreviousMonth},c.tsx("span",
{"aria-hidden":"true",class:d})),c.tsx("select",{"aria-live":"assertive","aria-label":e.selectMonth,bind:this,class:this.classes("esri-date-picker__month-dropdown","esri-select"),id:this.id+"__month-picker",onblur:this._handleDatePickerBlur,onchange:this._setMonth,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setMonth,title:e.selectMonth},r),c.tsx("div",{"aria-label":e.goToNextMonth,bind:this,class:"esri-widget--button",onblur:this._handleDatePickerBlur,onclick:this._setNextMonth,onfocusout:this._handleDatePickerFocusOut,
onkeydown:this._setNextMonth,role:"button",tabIndex:0,title:e.goToNextMonth},c.tsx("span",{"aria-hidden":"true",class:a})))};a.prototype._renderDayPicker=function(a,u){var b=this,r=a.clone().day(this._moment.localeData().firstDayOfWeek()),r=this._getWeekLabels(r),e=this._getDayId(a);a=this._renderMonth(a,u);return c.tsx("div",{afterCreate:this._handleDayPickerCreate,"aria-activedescendant":e,"aria-labelledby":this.id+"__month-picker "+this.id+"__selected-year",bind:this,class:"esri-date-picker__day-picker",
id:this.id+"__day-picker",onblur:this._handleDatePickerBlur,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._handleDayPickerKeydown,role:"grid",tabIndex:0},c.tsx("div",{class:"esri-date-picker__week-item",role:"row"},r.map(function(a){return c.tsx("div",{"aria-label":a.name,class:b.classes("esri-date-picker__day-item","esri-date-picker__day-item--header"),role:"columnheader",title:a.name},a.abbr)})),a)};a.prototype._getDayId=function(a){return this.id+"__"+g.formatDate(a.valueOf(),k)};a.prototype._handleDayPickerCreate=
function(a){this._requestDayPickerFocusOnCreate&&(this._requestDayPickerFocusOnCreate=!1,a.focus())};a.prototype._getWeekLabels=function(a){for(var b=[],d={weekday:"long"},c={weekday:"narrow"},e=0;7>e;e++)b.push({name:g.formatDate(a.valueOf(),d),abbr:g.formatDate(a.valueOf(),c)}),a.add(1,"day");return b};a.prototype._handleDayPickerKeydown=function(a){var b=a.ctrlKey,d=a.shiftKey,c=m.eventKey(a),e=this._activeDate;if(-1!==A.indexOf(c)){if("ArrowLeft"===c)e.subtract(1,"day");else if("ArrowRight"===
c)e.add(1,"day");else if("ArrowUp"===c)e.subtract(1,"week");else if("ArrowDown"===c)e.add(1,"week");else if("PageUp"===c)e.subtract(1,d?"year":"month");else if("PageDown"===c)e.add(1,d?"year":"month");else if("Home"===c)e.startOf(b?"year":"month");else if("End"===c)e.endOf(b?"year":"month");else if("Enter"===c||" "===c)this.viewModel.value=e.toDate(),this._closedByUserAction=!0,this._close();a.preventDefault();a.stopPropagation()}};a.prototype._renderMonth=function(a,f){for(var b,u=this._moment(),
e=a.clone().startOf("month"),g=a.clone().endOf("month"),l=e.clone().subtract(e.weekday(),"day"),h=[],k=0;6>k;k++){for(var m=[],n=0;7>n;n++){var p=l.date(),q=l.isSame(a,"day"),v=l.isSame(f,"day"),t=this._getDayId(l),v=(b={},b["esri-date-picker__day-item--nearby-month"]=!l.isBetween(e,g,null,"[]"),b["esri-date-picker__day-item--today"]=l.isSame(u,"day"),b["esri-date-picker__day-item--active"]=q,b["esri-date-picker__day-item--selected"]=v,b);m.push(c.tsx("div",{"aria-label":p.toString(),"aria-selected":q.toString(),
bind:this,class:this.classes("esri-date-picker__day-item",v),"data-iso-date":l.toISOString(),id:t,onclick:this._handleSelectedDate,onkeydown:this._handleSelectedDate,role:"gridcell"},p));l.add(1,"day")}h.push(c.tsx("div",{class:"esri-date-picker__week-item",role:"row"},m))}return h};a.prototype._renderYearPicker=function(a){var b={year:"numeric"},d=a.clone();a=g.formatDate(d.valueOf(),b);var f=g.formatDate(d.add(1,"year").valueOf(),b),b=g.formatDate(d.subtract(2,"year").valueOf(),b),d=this.messages;
return c.tsx("div",{class:"esri-date-picker__year-picker"},c.tsx("div",{"aria-label":d.goToPreviousYear,bind:this,class:"esri-date-picker__year-picker-item",onblur:this._handleDatePickerBlur,onclick:this._setPreviousYear,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setPreviousYear,tabIndex:0,title:d.goToPreviousYear},b),c.tsx("div",{class:this.classes("esri-date-picker__year-picker-item","esri-date-picker__year-picker-item--selected"),id:this.id+"__selected-year"},a),c.tsx("div",{"aria-label":d.goToNextYear,
bind:this,class:"esri-date-picker__year-picker-item",onblur:this._handleDatePickerBlur,onclick:this._setNextYear,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setNextYear,tabIndex:0,title:d.goToNextYear},f))};a.prototype._toggle=function(){this._isOpen?this._close():this._open(this.viewModel.value)};a.prototype._setMonth=function(a){this._activeDate.month(a.target.value);this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toDate())};a.prototype._close=function(){this._activeDate=
null;this._isOpen=!1;this._calendarPopover.open=!1};a.prototype._open=function(a,c){void 0===c&&(c=!0);this._activeDate=this._moment(a);this._isOpen=!0;this._calendarPopover.open=!0;this._requestDayPickerFocusOnCreate=c};a.prototype._setPreviousMonth=function(){this._activeDate.subtract(1,"month");this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toDate())};a.prototype._setNextMonth=function(){this._activeDate.add(1,"month");this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toDate())};
a.prototype._setPreviousYear=function(){this._activeDate.subtract(1,"year")};a.prototype._setNextYear=function(){this._activeDate.add(1,"year")};a.prototype._handleSelectedDate=function(a){this.viewModel.value=this._moment(a.target.getAttribute("data-iso-date")).toDate();this._closedByUserAction=!0;this._close()};f.__decorate([h.property(),c.renderable()],a.prototype,"dateInputEnabled",void 0);f.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],a.prototype,"label",
void 0);f.__decorate([h.property(),c.renderable(),c.messageBundle("esri/widgets/support/t9n/DatePicker")],a.prototype,"messages",void 0);f.__decorate([h.aliasOf("viewModel.value")],a.prototype,"value",void 0);f.__decorate([h.property()],a.prototype,"commitOnMonthChange",void 0);f.__decorate([h.property({type:n}),c.renderable("viewModel.value")],a.prototype,"viewModel",void 0);f.__decorate([c.accessibleHandler()],a.prototype,"_toggle",null);f.__decorate([c.accessibleHandler()],a.prototype,"_setPreviousMonth",
null);f.__decorate([c.accessibleHandler()],a.prototype,"_setNextMonth",null);f.__decorate([c.accessibleHandler()],a.prototype,"_setPreviousYear",null);f.__decorate([c.accessibleHandler()],a.prototype,"_setNextYear",null);f.__decorate([c.accessibleHandler()],a.prototype,"_handleSelectedDate",null);return a=f.__decorate([h.subclass("esri.widgets.support.DatePicker")],a)}(x)});