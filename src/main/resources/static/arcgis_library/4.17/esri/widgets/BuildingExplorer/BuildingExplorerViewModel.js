// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Accessor ../../core/Collection ../../core/collectionUtils ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/BuildingSceneLayer ../../layers/support/BuildingFilter ./BuildingDisciplinesViewModel ./BuildingLevel ./BuildingPhase ./support/buildingLayerUtils ./support/filterUtils ./support/layerUtils".split(" "),function(A,B,c,q,g,r,t,u,h,k,e,d,v,w,l,m,n,x,f,y){var z=
u.getLogger("esri.widgets.BuildingExplorer.BuildingExplorerViewModel");return function(p){function b(a){a=p.call(this,a)||this;a.view=null;a.state="disabled";a.level=new m;a.phase=new n;a.disciplines=new l;a._handles=new t;a._loadLayers=y.createLoadLayersFunction();a.layers=new g;return a}c.__extends(b,p);b.prototype.initialize=function(){var a=this;this._handles.add([this.layers.on("change",function(){return a._onLayersChange()}),e.init(this,"_filter",function(){return f.setFilterOnLayers(a.layers,
a._filter)})]);this._onLayersChange()};b.prototype.destroy=function(){this._handles.destroy();this.level.destroyed||this.level.destroy();this.phase.destroyed||this.phase.destroy();this.disciplines.destroyed||this.disciplines.destroy()};Object.defineProperty(b.prototype,"isSupported",{get:function(){var a;return"3d"===(null===(a=this.view)||void 0===a?void 0:a.type)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"layers",{set:function(a){var b=a.filter(function(a){return a instanceof
v});b.length!==a.length&&z.error("Some layers are not BuildingSceneLayers but only BuildingSceneLayers can be passed to the widget.");this._set("layers",r.referenceSetter(b,this._get("layers")))},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"_filter",{get:function(){var a=this.level.filterExpressions,b=this.phase.filterExpressions,c=[],d=f.getFilterBlockSolid([a.solid,b.solid]);h.isSome(d)&&c.push(d);a=f.getFilterBlockXRay([a.xRay,b.xRay]);h.isSome(a)&&c.push(a);return 0===c.length?
null:new w({id:f.generateFilterId(),name:"Building Explorer Filter",filterBlocks:c})},enumerable:!1,configurable:!0});b.prototype._onLayersChange=function(){return c.__awaiter(this,void 0,void 0,function(){var a;return c.__generator(this,function(b){switch(b.label){case 0:this.level.layers=this.layers;this.phase.layers=this.layers;this.disciplines.layers=this.layers;if(0===this.layers.length)return this._set("state","disabled"),[2];this._set("state","loading");b.label=1;case 1:return b.trys.push([1,
4,,5]),[4,this._loadLayers(this.layers)];case 2:return b.sent(),[4,k.all([e.whenEqualOnce(this.level,"state","ready"),e.whenEqualOnce(this.phase,"state","ready"),e.whenEqualOnce(this.disciplines,"state","ready")])];case 3:return b.sent(),this.layers.forEach(x.showFullModel),this._set("state","ready"),[3,5];case 4:return a=b.sent(),k.isAbortError(a)||this._set("state","failed"),[3,5];case 5:return[2]}})})};c.__decorate([d.property({value:null})],b.prototype,"view",void 0);c.__decorate([d.property({dependsOn:["view.type"]})],
b.prototype,"isSupported",null);c.__decorate([d.property({type:g,nonNullable:!0})],b.prototype,"layers",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"state",void 0);c.__decorate([d.property({readOnly:!0,type:m})],b.prototype,"level",void 0);c.__decorate([d.property({readOnly:!0,type:n})],b.prototype,"phase",void 0);c.__decorate([d.property({readOnly:!0,type:l})],b.prototype,"disciplines",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["level.filterExpressions","phase.filterExpressions"]})],
b.prototype,"_filter",null);return b=c.__decorate([d.subclass("esri.widgets.BuildingExplorer.BuildingExplorerViewModel")],b)}(q)});