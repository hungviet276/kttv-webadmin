// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../assets ../intl ../core/arrayUtils ../core/Collection ../core/events ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ../intl/moment ../libs/sortablejs/Sortable ./Search ./Widget ./Directions/DirectionsViewModel ./Directions/support/CostSummary ./Directions/support/directionsUtils ./Directions/support/maneuverUtils ./Directions/support/RouteSections ./support/DatePicker ./support/TimePicker ./support/widget".split(" "),function(P,Q,f,y,q,z,A,m,
B,l,h,C,D,E,F,w,G,u,H,I,J,K,d){function L(d){d=d.getTimezoneOffset();var b=Math.abs(Math.floor(d)%60);return"GMT"+(0<d?"-":"+")+q.formatNumber(Math.abs(Math.floor(d/60)),v)+q.formatNumber(b,v)}function x(d){var b;return!!z.find(null===(b=d.composedPath)||void 0===b?void 0:b.call(d),function(a){var e;return null===(e=a.classList)||void 0===e?void 0:e.contains("esri-search__suggestions-list")})}var M=y.getAssetUrl("esri/themes/base/images/maneuvers/"),N={hour:"numeric",minute:"numeric"},v={minimumIntegerDigits:2};
return function(v){function b(a,e){var c=v.call(this,a,e)||this;c._autoStopRemovalDelay=100;c._costSummary=new G;c._departureTime="now";c._datePicker=new J;c._handles=new B;c._newPlaceholderStop=null;c._pointerPressedSearchSuggestionStop=null;c._routeSections=new I;c._stops=new A([{},{}]);c._stopsToSearches=new Map;c._timePicker=new K;c.goToOverride=null;c.iconClass="esri-icon-directions";c.label=void 0;c.lastRoute=null;c.maxStops=null;c.messages=null;c.messagesCommon=null;c.routeServiceUrl=null;
c.routeSymbol=null;c.searchProperties=null;c.stopSymbols=null;c.view=null;c.viewModel=new w;c._setUpDragAndDropStops=function(a){c._sortable=D.create(a,{draggable:".esri-directions__stop-row--valid",ghostClass:"esri-directions__stop-row-ghost",handle:".esri-directions__stop-handle",onEnd:c._handleStopInputDragEnd})};c._handleDragHandlePointerDown=function(){return c._stops.forEach(function(a){return c._acquireSearch(a).activeMenu="none"})};c._handleStopInputDragEnd=function(a){var e=a.oldIndex,d=
a.newIndex;a=a.target;if(e!==d){var b=a.children,k=b[e];a.insertBefore(b[d],0>d-e?k.nextElementSibling:k);a=c._stops;a.reorder(a.getItemAt(e),d);c._processStops()}};return c}f.__extends(b,v);b.prototype.loadLocale=function(){return f.__awaiter(this,void 0,void 0,function(){var a;return f.__generator(this,function(e){switch(e.label){case 0:return a=this,[4,C.loadMoment()];case 1:return a._moment=e.sent(),[2]}})})};b.prototype.initialize=function(){var a=this;this.own([l.init(this,"viewModel.lastRoute",
function(){a._routeSections.routePath=a.get("viewModel.directionLines");a._activeManeuver=null;a._focusedManeuver=null;a.scheduleRender()}),l.init(this,"viewModel.selectedTravelMode, viewModel.departureTime",function(){1<a.get("viewModel.stops.length")&&a.getDirections()}),l.when(this,"view",function(e,c){c&&(a._viewClickHandle=null,a._handles.remove(c));if(e){c=a._prepPointerDownUpClick();var d=a._prepViewClick();c.pause();d.pause();a._handles.add([m.on(e.surface,"mousedown",function(){return a._autoStopRemovalDelay=
500}),m.on(e.surface,"mouseup",function(){return a._autoStopRemovalDelay=100}),c,d],a.view.surface);a._pointerDownUpHandle=c;a._viewClickHandle=d}}),l.whenOnce(this,"routeServiceUrl",function(){return a.viewModel.load()}),l.watch(this,"viewModel.stops.length",function(e){0===e&&(a._stops.toArray().forEach(function(c){return a._removeStop(c,!0)}),a._stops.addMany([{},{}]),a.scheduleRender())})])};b.prototype.destroy=function(){this._datePicker.destroy();this._timePicker.destroy();this._stopsToSearches.forEach(function(a){return a.destroy()});
this._sortable&&this._sortable.destroy()};b.prototype.getDirections=function(){return null};b.prototype.zoomToRoute=function(){};b.prototype.render=function(){return d.tsx("div",{class:this.classes("esri-directions esri-widget esri-widget--panel","esri-directions__scroller")},this._renderPanelContent())};b.prototype._renderPanelContent=function(){var a,e=this.viewModel.state,c="initializing"===e,b="error"===e&&!this.viewModel.serviceDescription,g="unauthenticated"===e,e=(a={},a["esri-directions__panel-content--loading"]=
c,a["esri-directions__panel-content--error"]=b,a["esri-directions__panel-content--sign-in"]=g,a);a=c?"presentation":"group";c=g?this._renderSignIn():b?this._renderMessage(this._getErrorMessage()):c?this._renderLoader():this._renderReadyContent();return d.tsx("div",{class:this.classes("esri-directions__panel-content",e),role:a},c)};b.prototype._renderReadyContent=function(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSectionSplitter(),
this._renderDirectionsContainer(),this._renderDisclaimer()]};b.prototype._renderSignIn=function(){return d.tsx("div",{key:"sign-in",class:"esri-directions__sign-in-content"},d.tsx("h2",{class:this.classes("esri-widget__heading","esri-directions__content-title")},this.messages.widgetLabel),this._renderPlaceholder(),d.tsx("h3",{class:"esri-widget__heading"},this.messages.signInRequired),d.tsx("button",{class:this.classes("esri-button","esri-button--secondary","esri-directions__sign-in-button"),tabIndex:0,
onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))};b.prototype._handleSignInClick=function(){this.viewModel.load().catch(function(){})};b.prototype._renderTravelModeOptions=function(){var a=this.viewModel.travelModes;if(0===a.length)return null;var e=this.viewModel.selectedTravelMode,c=e.name||this.messages.travelMode;return d.tsx("select",{"aria-label":c,bind:this,class:this.classes("esri-directions__travel-modes-select","esri-select"),key:"esri-directions__travel-mode-options",
onchange:this._handleTravelModeChange,title:c},a.map(function(a){return d.tsx("option",{key:a,"data-mode":a,selected:a.id===e.id,value:a.id},a.name)}))};b.prototype._handleTravelModeChange=function(a){a=a.currentTarget;a=a.item(a.selectedIndex);this.viewModel.selectedTravelMode=a["data-mode"]};b.prototype._renderStopsContainer=function(){return d.tsx("div",{class:"esri-directions__section",key:"esri-directions__stops-container",role:"group"},this._renderStops())};b.prototype._renderDepartureTimeControls=
function(){var a="now"===this._departureTime,e=this.messages,c=e.departureTime;return d.tsx("div",{class:"esri-directions__departure-time",key:"esri-directions__departure-time-controls",role:"group"},d.tsx("select",{"aria-label":c,bind:this,class:this.classes("esri-directions__departure-time-select","esri-select"),onchange:this._handleDepartureOptionChange,title:c},d.tsx("option",{value:"now",selected:a},e.leaveNow),d.tsx("option",{value:"depart-by",selected:!a},e.departBy)),a?null:this._renderTimeControls())};
b.prototype._renderStops=function(){var a=this,e=this._stops,c=0;e.forEach(function(e){"none"!==a._acquireSearch(e).activeMenu&&(c+=1)});var b=e.toArray().map(function(b,k){var g,f,h,n=e.length,r=1<k&&!b.result,O=(g={},g["esri-icon-radio-unchecked"]=0<=k&&k<n-1,g["esri-icon-radio-checked"]=k===n-1,g);g=(f={},f["esri-directions__stop-icon-container--last"]=k===n-1,f);f=(h={},h["esri-directions__stop-row--valid"]=!r,h);var l=(h=e.getItemAt(n-1))&&h.result;h=(h=e.getItemAt(k+1))&&h.result;var t=k===
n-1,p=k===n-2;h=2===n&&0===k||2<n&&!t&&!p||2<n&&p&&h||2<n&&t&&!b.result;var n=2===n||3===n&&!l||r,r=a._acquireSearch(b),p=a.messages,l=p.removeStop,t=p.reverseStops,m=p.unlocated,p=q.substitute(p.stopLabelTemplate,{number:k+1,label:b.result?b.result.name:m}),m=a.id+"__stop--"+k;b=!!r.searchTerm&&!!r.selectedResult&&!!b.result&&r.selectedResult===b.result;var u={zIndex:"none"!==r.activeMenu?""+c--:""};return d.tsx("li",{"aria-label":p,afterCreate:a._handleStopFieldCreation,bind:a,class:a.classes("esri-directions__stop-row",
f),id:m,key:k,"data-stop-index":k,styles:u},d.tsx("div",{class:"esri-directions__stop-handle"},d.tsx("span",{"aria-hidden":"true",class:a.classes("esri-directions__stop-icon","esri-icon-handle-vertical","esri-directions__stop-handle-icon","esri-directions__stop-icon--interactive"),onpointerdown:a._handleDragHandlePointerDown}),d.tsx("div",{bind:a,"aria-labelledby":m,class:a.classes("esri-directions__stop-icon-container",g),"data-stop-index":k,onclick:a._handleStopIconClick,onkeydown:a._handleStopIconClick,
role:"button"},d.tsx("span",{class:a.classes("esri-directions__stop-icon",O),tabindex:b?"0":null}))),d.tsx("div",{class:"esri-directions__stop-input"},r.render()),d.tsx("div",{class:"esri-directions__stop-options",role:"group"},d.tsx("div",{"aria-label":l,class:"esri-directions__remove-stop",bind:a,"data-stop-index":k,hidden:n,onkeydown:a._handleRemoveStop,onclick:a._handleRemoveStop,role:"button",tabIndex:0,title:l},d.tsx("span",{"aria-hidden":"true",class:a.classes("esri-directions__stop-icon",
"esri-directions__remove-stop-icon","esri-icon-trash","esri-directions__stop-icon--interactive")}),d.tsx("span",{class:"esri-icon-font-fallback-text"},"removeStopTitle")),d.tsx("div",{"aria-label":t,class:"esri-directions__reverse-stops",bind:a,hidden:h,onkeydown:a._handleReverseStops,onclick:a._handleReverseStops,role:"button",tabIndex:0,title:t},d.tsx("span",{"aria-hidden":"true",class:a.classes("esri-directions__stop-icon","esri-icon-up-down-arrows","esri-directions__stop-icon--interactive")}),
d.tsx("span",{class:"esri-icon-font-fallback-text"},"removeStopTitle"))))}),g=e.every(function(c){var e=a._stopsToSearches.get(c);return c.result&&e.selectedResult===c.result}),f=this._stops.length>=this.maxStops,h=this.messages.addStop,g=2<=e.length&&g&&!f?d.tsx("div",{"aria-label":h,bind:this,class:"esri-directions__add-stop",key:"esri-directions__add-stop",onfocus:this._handleAddStopFocus,tabIndex:0},d.tsx("span",{"aria-hidden":"true",class:this.classes("esri-icon-plus","esri-directions__stop-icon",
"esri-directions__stop-icon--interactive")}),d.tsx("div",{"aria-hidden":"true",class:"esri-directions__add-stop-text"},h)):null;return d.tsx("div",null,d.tsx("ol",{class:"esri-directions__stops",role:"group",afterCreate:this._setUpDragAndDropStops},b),g)};b.prototype._handleStopIconClick=function(a){(a=this._stops.getItemAt(a.currentTarget["data-stop-index"]))&&a.result&&this._centerAtStop(a)};b.prototype._handleClearRouteClick=function(){this.viewModel.reset()};b.prototype._centerAtStop=function(a){this.viewModel.centerAt(a.result.feature)};
b.prototype._handleStopFieldCreation=function(a){var e=this,c=this._newPlaceholderStop;if(c){a=this._stops.getItemAt(a["data-stop-index"]);if(c===a){var b=this._acquireSearch(a);b.when(function(){e.renderNow();b.focus()})}this._newPlaceholderStop=null}};b.prototype._handleStopInputBlur=function(a,e){var c=this;this._handles.remove("awaiting-view-click-stop");this.view.cursor=this._previousCursor;a.selectedResult&&e.result&&a.selectedResult===e.result?this._pointerDownUpHandle.pause():"none"!==a.activeMenu||
!a.searchTerm||a.selectedResult===e.result&&(a.selectedResult||e.result)?a.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout(function(){c.destroyed||(c._viewClickHandle.pause(),"searching"===a.viewModel.state?c._pointerDownUpHandle.pause():c._pointerPressedSearchSuggestionStop||(c._removeStop(e),e.result&&(e.result=null,c._processStops()),c.scheduleRender()))},this._autoStopRemovalDelay)):(a.search(),this._pointerDownUpHandle.pause())};
b.prototype._handleStopInputFocus=function(a,e){this._pointerDownUpHandle.resume();if(!this._handles.has("awaiting-view-click-stop")){var c=this.view,b=this.view.cursor;this._previousCursor=b;this._handles.add(l.init(a,"searchTerm",function(a){c.cursor=0===a.length?"copy":b}),"awaiting-view-click-stop");this._activeStop=e}};b.prototype._prepViewClick=function(){var a=this,b=this.get("viewModel.view"),c=m.pausable(b,"click",this._handleViewClick.bind(this)),d=m.pausable(b.surface,"click",function(){clearTimeout(a._autoStopRemovalTimeoutId);
d.pause()});return{remove:function(){d.remove();c.remove()},pause:function(){d.pause();c.pause()},resume:function(){d.resume();c.resume()}}};b.prototype._prepPointerDownUpClick=function(){var a=this,b=m.pausable(document,"pointerdown",function(b){a._pointerPressedSearchSuggestionStop=x(b)?a._activeStop:null}),c=m.pausable(document,"pointerup",function(b){a._pointerDownUpHandle.pause();b=x(b);var c=a._activeStop;b||c!==a._pointerPressedSearchSuggestionStop||a._removeStop(c);a.scheduleRender();a._pointerPressedSearchSuggestionStop=
b?a._activeStop:null});return{remove:function(){c.remove();b.remove()},pause:function(){c.pause();b.pause()},resume:function(){b.resume()}}};b.prototype._handleViewClick=function(a){var b=this,c=this._stopsToSearches.get(this._activeStop);c&&!c.searchTerm&&(c.search(a.mapPoint).then(function(a){a=a.results[0].results[0];var d=b._activeStop;d.result=a;d.result.feature.attributes.Name=a.name;c.searchTerm=a.name}),this.scheduleRender());this._viewClickHandle.pause();clearTimeout(this._autoStopRemovalTimeoutId)};
b.prototype._handleAddStopFocus=function(){this._addNewPlaceholder()};b.prototype._addNewPlaceholder=function(){this._pointerDownUpHandle.pause();if(!this._newPlaceholderStop){var a={};this._stops.add(a);this._newPlaceholderStop=a}};b.prototype._handleReverseStops=function(){this._reverseStops()};b.prototype._reverseStops=function(){this._stops.reverse();this._processStops()};b.prototype._handleRemoveStop=function(a){this._removeStop(this._stops.getItemAt(a.currentTarget["data-stop-index"]));this._processStops()};
b.prototype._removeStop=function(a,b){void 0===b&&(b=!1);2>=this._stops.length&&!b||(this._disposeSearch(a),this._stops.remove(a))};b.prototype._handleDepartureOptionChange=function(){var a=this,b=event.currentTarget,b=b.item(b.selectedIndex);"now"===b.value?(this._departureTime="now",this.viewModel.departureTime="now",this._handles.remove("departure-time-controls")):"depart-by"===b.value&&(this._departureTime="depart-by",this._handles.add([l.init(this._datePicker,"value",function(){return a._updateDepartureTime()}),
l.init(this._timePicker,"value",function(){return a._updateDepartureTime()})],"departure-time-controls"))};b.prototype._updateDepartureTime=function(){var a=this._moment(this._datePicker.value),b=this._moment(this._timePicker.value),a=this._moment({date:a.date(),month:a.month(),year:a.year(),hour:b.hour(),minute:b.minute()});this.viewModel.departureTime=a.toDate()};b.prototype._renderTimeControls=function(){return d.tsx("div",{class:"esri-directions__departure-time-controls",key:"esri-directions__time-controls",
role:"group"},this._datePicker.render(),this._timePicker.render())};b.prototype._renderSectionSplitter=function(){return d.tsx("div",{class:"esri-directions__section-splitter"})};b.prototype._renderDisclaimer=function(){var a=this.messages,a=q.substitute(a.disclaimer,{esriTerms:'\x3ca class\x3d"esri-widget__anchor" href\x3d"http://www.esri.com/legal/software-license" rel\x3d"noreferrer" target\x3d"_blank"\x3e'+a.esriTerms+"\x3c/a\x3e"});return d.tsx("div",{class:"esri-directions__disclaimer",innerHTML:a,
key:"esri-directions__disclaimer"})};b.prototype._renderDirectionsContainer=function(){return d.tsx("div",{class:this.classes("esri-directions__directions-section","esri-directions__section"),key:"esri-directions__container"},this._renderDirectionsContainerContent())};b.prototype._renderLoader=function(){return d.tsx("div",{class:"esri-directions__loader",key:"loader"})};b.prototype._renderWarningCard=function(){return d.tsx("div",{class:"esri-directions__warning-card",role:"alert"},d.tsx("div",{class:"esri-directions__warning-header"},
d.tsx("span",{class:"esri-icon-notice-triangle","aria-hidden":"true"}),d.tsx("div",{class:this.classes("esri-widget__heading","esri-directions__warning-heading")},this.messagesCommon.warning)),d.tsx("div",{class:"esri-directions__warning-message"},this._getErrorMessage()))};b.prototype._renderDirectionsContainerContent=function(){var a=this.viewModel,b=a.lastRoute,a=a.state,c="routing"===a;return"error"===a?this._renderWarningCard():c?this._renderLoader():b?d.tsx("div",{class:"esri-directions__summary",
key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):d.tsx("div",{key:"esri-directions__placeholder",class:"esri-widget__content--empty"},this._renderPlaceholder(),d.tsx("h3",{class:this.classes("esri-directions__message","esri-widget__heading")},this.messages.directionsPlaceholder))};b.prototype._renderPlaceholder=function(){return d.tsx("svg",{class:"esri-widget__content-illustration--empty",xmlns:"http://www.w3.org/2000/svg",
viewBox:"0 0 256 256"},d.tsx("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))};
b.prototype._renderMessage=function(a){return d.tsx("h3",null,a)};b.prototype._renderRouteActions=function(){return d.tsx("div",{class:"esri-directions__route-actions"},d.tsx("button",{"aria-label":this.messages.clearRoute,class:this.classes("esri-directions__clear-route-button","esri-button","esri-button--tertiary"),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))};b.prototype._renderManeuverSections=function(){var a=this,b=this._routeSections.sections;
return d.tsx("div",{class:"esri-directions__maneuvers",role:"group"},b.map(function(c,e){var g,k,f=c.open,h;0<c.maneuvers.length&&f&&(h=d.tsx("ol",{class:"esri-directions__maneuver-list"},c.maneuvers.map(function(b){return a._renderManeuver(b)})));var l=2<b.length,m=e===b.length-1;e=(g={},g["esri-directions__maneuver-section--collapsible"]=l,g);g=(k={},k["esri-icon-right-triangle-arrow"]=!f,k["esri-icon-down-arrow"]=f,k);l&&!m?(k=f?a.messagesCommon.open:a.messagesCommon.close,c=d.tsx("header",{class:a.classes("esri-directions__maneuver-section-header",
"esri-directions__maneuver-section-toggle"),key:"esri-directions__maneuver-section-header"},d.tsx("div",{"aria-expanded":f,"aria-label":k,bind:a,class:"esri-directions__maneuver-section-header-toggle-button","data-maneuver-section":c,onkeydown:a._handleSectionToggle,onclick:a._handleSectionToggle,role:"button",tabIndex:0,title:k},d.tsx("span",{"aria-hidden":"true",class:a.classes(g)}),d.tsx("h2",{class:a.classes("esri-widget__heading","esri-directions__maneuver-section-title")},c.name)))):c=d.tsx("header",
{class:"esri-directions__maneuver-section-header",key:"esri-directions__maneuver-section-header"},m?d.tsx("span",{"aria-hidden":"true",class:"esri-icon-radio-checked"}):null,d.tsx("h2",{class:a.classes("esri-widget__heading","esri-directions__maneuver-section-title")},c.name));return d.tsx("section",{class:a.classes("esri-directions__maneuver-section",e)},c,h)}))};b.prototype._handleSectionToggle=function(a){a=a.currentTarget["data-maneuver-section"];a.open=!a.open};b.prototype._renderCosts=function(){var a=
this.get("viewModel.directionLines"),b=new Date(a[a.length-1].attributes.arriveTimeUTC),a=this._costSummary.set({directionsViewModel:this.viewModel,messages:this.messages}),c=this.messages,k=c.zoomToRoute,g=q.formatDate(b,N),b=q.substitute(c.etaTemplate,{time:"\x3cstrong\x3e"+g+"\x3c/strong\x3e",gmt:""+L(b)}),g=c.primaryCosts,f=c.secondaryCosts,c=c.eta;return d.tsx("div",{"aria-label":k,bind:this,class:"esri-directions__costs",onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,
role:"button",tabIndex:0,title:k},d.tsx("div",{class:"esri-directions__costs-details",role:"group"},d.tsx("div",{"aria-label":g,class:"esri-directions__costs-value",title:g},a.primary),d.tsx("div",{class:"esri-directions__vertical-splitter"}),d.tsx("div",{"aria-label":f,class:"esri-directions__other-costs-total",title:f},a.secondary)),d.tsx("div",{"aria-label":c,innerHTML:b,title:c}))};b.prototype._handleSummaryInteraction=function(){this._focusedManeuver=this._activeManeuver=null;this.viewModel.clearHighlights();
this.zoomToRoute()};b.prototype._getErrorMessage=function(){var a=this.messages,b=this.viewModel.error;return"directions-view-model:unable-to-route"===b.name?a.errors.unableToRoute:"directions-view-model:service-metadata-unavailable"===b.name?a.errors.unableToLoadServiceMetadata:a.errors.unknownError};b.prototype._normalizeSearchSources=function(a){this._overrideDefaultSources(a);this._ensureLocationTypeOnLocatorSources(a)};b.prototype._overrideDefaultSources=function(a){a.viewModel.defaultSources.forEach(function(a){a.autoNavigate=
!1})};b.prototype._ensureLocationTypeOnLocatorSources=function(a){a=a.allSources;0!==a.length&&a.forEach(function(a){"locator"in a&&a.locator&&null===a.locationType&&(a.locationType="street")})};b.prototype._acquireSearch=function(a){var b=this,c=this.get("viewModel.view");if(this._stopsToSearches.has(a)){var d=this._stopsToSearches.get(a);d.view=c;this._overrideDefaultSources(d);return d}var g=new E(f.__assign({view:c,resultGraphicEnabled:!1,popupEnabled:!1},this.searchProperties));this._normalizeSearchSources(g);
this._handles.add([l.on(g,"allSources","change",function(){return b._normalizeSearchSources(g)}),g.on("select-result",function(){a.result=g.selectedResult;a.result.feature.attributes.Name=g.selectedResult.name;b._processStops();b.scheduleRender()}),g.on("search-focus",function(){return b._handleStopInputFocus(g,a)}),g.on("search-blur",function(){return b._handleStopInputBlur(g,a)})],g);this._stopsToSearches.set(a,g);return g};b.prototype._disposeSearch=function(a){this._stopsToSearches.get(a).destroy();
this._stopsToSearches.delete(a)};b.prototype._processStops=function(){var a=this.viewModel;a.stops.removeAll();a.stops.addMany(this._stops.filter(function(a){return!!a.result}).map(function(a){return a.result.feature}));1<a.stops.length&&a.getDirections()};b.prototype._renderManeuver=function(a){var b,c,f=a.attributes,g=this.get("viewModel.routeParameters.directionsLengthUnits"),h=this.messages,g=u.formatDistance(h,f.length,{toUnits:g}),l=u.formatTime(f.time),m=u.getAssociatedStop(a);u.useSpatiallyLocalTime(a,
this.get("viewModel.routeParameters.startTime"))?c=u.toSpatiallyLocalTimeString(h,f.arriveTimeUTC,f.ETA,"now"===this._departureTime):g&&(c=l?g+"\x26nbsp;\x26middot;\x26nbsp;"+l:g);g=this._getFormattedManeuverText(a);f=this._getIconPath(f.maneuverType);if(m)return d.tsx("li",{class:"esri-directions__maneuver",key:a},d.tsx("header",null,m.attributes.Name));var m="esri-directions__maneuver-"+a.uid,l="esri-directions__cumulative-costs-"+a.uid,t="esri-directions__intermediate-costs-"+a.uid,q=(b={},b["esri-directions__maneuver--active"]=
this._activeManeuver===a,b);return d.tsx("li",{"aria-labelledby":m+" "+l+" "+t,bind:this,class:this.classes("esri-directions__maneuver",q),"data-maneuver":a,key:a,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},d.tsx("img",{alt:"",class:"esri-directions__maneuver-icon",src:f}),d.tsx("div",{class:"esri-directions__maneuver-costs-container"},
d.tsx("span",{id:m,innerHTML:g}),d.tsx("div",{class:"esri-directions__maneuver-costs"},d.tsx("div",{class:"esri-directions__horizontal-splitter"}),d.tsx("div",{id:l,"aria-label":h.cumulativeCosts,class:"esri-directions__cost--cumulative",innerHTML:"",title:h.cumulativeCosts}),d.tsx("div",{id:t,"aria-label":h.intermediateCosts,class:"esri-directions__cost--intermediate",innerHTML:c,title:h.intermediateCosts}))))};b.prototype._getIconPath=function(a){a=H.toIconName(a);return""+M+a+(2===window.devicePixelRatio?
"@2x":"")+".png"};b.prototype._handleManeuverClick=function(a){a=a.currentTarget["data-maneuver"];this._activeManeuver===a?(this._activeManeuver=null,this.zoomToRoute()):(this._activeManeuver=a,this.viewModel.centerAt(a),this.viewModel.highlightSegment(a))};b.prototype._handleManeuverMouseOver=function(a){this._activeManeuver||this._focusedManeuver||this.viewModel.highlightSegment(a.currentTarget["data-maneuver"])};b.prototype._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||
this.viewModel.clearHighlights()};b.prototype._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())};b.prototype._handleManeuverFocus=function(a){this._activeManeuver||(this._focusedManeuver=a=a.currentTarget["data-maneuver"],this.viewModel.highlightSegment(a))};b.prototype._getFormattedManeuverText=function(a){var b=a.attributes.text;a=a.strings;if(!a)return b;var c=b;a.forEach(function(a){c=c.replace(a.string,"\x3cstrong\x3e"+a.string+
"\x3c/strong\x3e")});return c};f.__decorate([h.aliasOf("viewModel.goToOverride")],b.prototype,"goToOverride",void 0);f.__decorate([h.property()],b.prototype,"iconClass",void 0);f.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],b.prototype,"label",void 0);f.__decorate([h.aliasOf("viewModel.lastRoute")],b.prototype,"lastRoute",void 0);f.__decorate([h.aliasOf("viewModel.maxStops")],b.prototype,"maxStops",void 0);f.__decorate([h.property(),d.renderable(),d.messageBundle("esri/widgets/Directions/t9n/Directions")],
b.prototype,"messages",void 0);f.__decorate([h.property(),d.renderable(),d.messageBundle("esri/t9n/common")],b.prototype,"messagesCommon",void 0);f.__decorate([h.aliasOf("viewModel.routeServiceUrl")],b.prototype,"routeServiceUrl",void 0);f.__decorate([h.aliasOf("viewModel.routeSymbol")],b.prototype,"routeSymbol",void 0);f.__decorate([h.property()],b.prototype,"searchProperties",void 0);f.__decorate([h.aliasOf("viewModel.stopSymbols")],b.prototype,"stopSymbols",void 0);f.__decorate([h.aliasOf("viewModel.view")],
b.prototype,"view",void 0);f.__decorate([d.renderable(["lastRoute","state","travelModes"]),h.property({type:w})],b.prototype,"viewModel",void 0);f.__decorate([h.aliasOf("viewModel.getDirections")],b.prototype,"getDirections",null);f.__decorate([h.aliasOf("viewModel.zoomToRoute")],b.prototype,"zoomToRoute",null);f.__decorate([d.accessibleHandler()],b.prototype,"_handleStopIconClick",null);f.__decorate([d.accessibleHandler()],b.prototype,"_handleClearRouteClick",null);f.__decorate([d.accessibleHandler()],
b.prototype,"_handleReverseStops",null);f.__decorate([d.accessibleHandler()],b.prototype,"_handleRemoveStop",null);f.__decorate([d.accessibleHandler()],b.prototype,"_handleSectionToggle",null);f.__decorate([d.accessibleHandler()],b.prototype,"_handleSummaryInteraction",null);f.__decorate([d.accessibleHandler()],b.prototype,"_handleManeuverClick",null);return b=f.__decorate([h.subclass("esri.widgets.Directions")],b)}(F)});