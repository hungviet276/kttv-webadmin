// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Accessor ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ./ScaleRanges ../Slider/SliderViewModel".split(" "),function(p,q,d,l,m,g,e,h,n){return function(k){function b(a){a=k.call(this,a)||this;a.layer=null;a.scaleRanges=h.fromScaleRange({minScale:0,maxScale:0});var c;c=a._getSliderIndexRange(a.scaleRanges.length-1).max;c=new n({precision:10,min:0,max:c,values:[0,c]});a.sliderViewModel=c;return a}d.__extends(b,k);b.prototype.initialize=
function(){var a=this;this.handles.add([g.init(this,"sliderViewModel.values",function(){if(a._hasTiledLayer()){var c=a.sliderViewModel.values,b=c[0],c=c[1],f=a.mapScaleToSlider(a._getTiledLayerMaxScale()),d=a.mapScaleToSlider(a._getTiledLayerMinScale());if(c>f||b<d)a.sliderViewModel.values=[Math.max(b,d),Math.min(c,f)]}}),g.init(this,"layer.loaded",function(){return d.__awaiter(a,void 0,void 0,function(){var a,b,f,e,g;return d.__generator(this,function(c){switch(c.label){case 0:return a=this,b=a.layer,
f=a.view,b?f?[4,f.when()]:[3,2]:[2];case 1:c.sent(),c.label=2;case 2:return[4,b.when()];case 3:return c.sent(),"minScale"in b&&"maxScale"in b?(e=b.minScale,g=b.maxScale,this.set({minScale:e,maxScale:g})):this.set({minScale:void 0,maxScale:void 0}),[2]}})})})])};Object.defineProperty(b.prototype,"maxScale",{get:function(){var a=this.mapSliderToScale(this.sliderViewModel.values[1]);return this._handleEdgeScale("max",a)},set:function(a){this._setMaxScaleOnSlider(a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"maxScaleLimit",{get:function(){return this.mapSliderToScale(this.sliderViewModel.max)},set:function(a){this._setSliderRange({maxScale:a,minScale:this.minScaleLimit})},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"minScale",{get:function(){var a=this.mapSliderToScale(this.sliderViewModel.values[0]);return this._handleEdgeScale("min",a)},set:function(a){this._setMinScaleOnSlider(a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"minScaleLimit",{get:function(){return this.mapSliderToScale(this.sliderViewModel.min)},
set:function(a){this._setSliderRange({maxScale:this.maxScaleLimit,minScale:a})},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){var a=this.view,c=this.layer;return!a&&!c||!a&&c&&c.loaded||!c&&a&&a.ready||a&&a.ready&&c&&c.loaded?"ready":"disabled"},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"view",{set:function(a){this._set("view",a)},enumerable:!1,configurable:!0});b.prototype.mapScaleToSlider=function(a){var c=this.scaleRanges.scaleToRangeIndex(a),
b=this.scaleRanges.findScaleRangeByIndex(c),d=b.maxScale,b=b.minScale,c=this._getSliderIndexRange(c);return this._mapToRange(a,b,d,c.min,c.max)};b.prototype.mapSliderToScale=function(a){var c=this.scaleRanges.findScaleRangeByIndex(a),b=c.maxScale,c=c.minScale,d=this._getSliderIndexRange(a);return this._mapToRange(a,d.min,d.max,c,b)};b.prototype._setSliderRange=function(a){this.scaleRanges=h.fromScaleRange(a);a=this._getSliderIndexRange(this.scaleRanges.length-1).max;this.sliderViewModel.max=a;this.sliderViewModel.min=
0;this.notifyChange("maxScaleLimit");this.notifyChange("minScaleLimit")};b.prototype._getSliderIndexRange=function(a){a=Math.floor(a);return{min:a,max:a+.99999}};b.prototype._mapToRange=function(a,c,b,d,e){return d+(a-c)*(e-d)/(b-c)};b.prototype._setMaxScaleOnSlider=function(a){var b=this.scaleRanges,d=this.sliderViewModel;void 0!==a&&(a=this.mapScaleToSlider(this._constrainMaxScaleToLayer(b.clampMaxScale(a))),d.values=[d.values[0],a])};b.prototype._setMinScaleOnSlider=function(a){var b=this.scaleRanges,
d=this.sliderViewModel;void 0!==a&&(a=this.mapScaleToSlider(this._constrainMinScaleToLayer(b.clampMinScale(a))),d.values=[a,d.values[1]])};b.prototype._constrainMinScaleToLayer=function(a){var b=this.scaleRanges;if(this._hasTiledLayer()){var b=b.firstRange,d=this._getTiledLayerMinScale();a=.85<this._mapToRange(a,b.maxScale,b.minScale,0,1)?d:a>d?d:a}return a};b.prototype._constrainMaxScaleToLayer=function(a){if(this._hasTiledLayer()){var b=this._getTiledLayerMaxScale();a=a<b?b:a}return a};b.prototype._handleEdgeScale=
function(a,b){return Number((this.scaleRanges["max"===a?"maxScale":"minScale"]===b?0:b).toFixed(6))};b.prototype._getLayerLODS=function(){return this.get("layer.tileInfo.lods")};b.prototype._getTiledLayerMinScale=function(){var a=this._getLayerLODS();return this.scaleRanges.clampMinScale(a[0].scale)};b.prototype._getTiledLayerMaxScale=function(){var a=this._getLayerLODS();return a[a.length-1].scale};b.prototype._hasTiledLayer=function(){return!!this._getLayerLODS()};d.__decorate([e.property()],b.prototype,
"layer",void 0);d.__decorate([e.property({dependsOn:["sliderViewModel.values"]})],b.prototype,"maxScale",null);d.__decorate([e.property({dependsOn:["sliderViewModel.max"]})],b.prototype,"maxScaleLimit",null);d.__decorate([e.property({dependsOn:["sliderViewModel.values"]})],b.prototype,"minScale",null);d.__decorate([e.property({dependsOn:["sliderViewModel.min"]})],b.prototype,"minScaleLimit",null);d.__decorate([e.property()],b.prototype,"scaleRanges",void 0);d.__decorate([e.property()],b.prototype,
"sliderViewModel",void 0);d.__decorate([e.property({dependsOn:["layer.loaded","view.ready"],readOnly:!0})],b.prototype,"state",null);d.__decorate([e.property()],b.prototype,"view",null);return b=d.__decorate([e.subclass("esri.widgets.ScaleRangeSlider.ScaleRangeSliderViewModel")],b)}(m.HandleOwnerMixin(l))});