// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/accessorSupport/decorators ../../intl/date ../../intl/number ../../layers/support/CodedValueDomain ../../layers/support/fieldUtils ../FeatureForm/InputField ./Grid/EditorColumn ../support/DatePicker ../support/TimePicker ../support/widgetUtils".split(" "),function(B,C,d,e,l,n,t,k,u,v,w,x,p){var y=l.convertDateFormatToIntlOptions("short-date-short-time"),z=l.convertDateFormatToIntlOptions("short-date"),A=n.convertNumberFormatToIntlOptions({digitSeparator:!0,
places:null});return function(q){function c(a){var b=q.call(this,a)||this;b._inputField=null;b.alias=null;b.cellValueFormatFunction=function(a){var h,c=a.rowData;a=a.value;if(b.formatFunction)return b.formatFunction({config:b.config,field:b.field,value:p.renderingSanitizer.sanitize(a)});if(null===a)return"\x26nbsp;";var f=b.config,g=b.field,d=b.type;return(c=b._getDomainForFeature(c.item.feature))?b._getComputedDomain(a,c):"date"===d?(c=(null===(h=null===f||void 0===f?void 0:f.format)||void 0===h?
0:h.dateFormat)?l.convertDateFormatToIntlOptions(f.format.dateFormat):!1===(null===f||void 0===f?void 0:f.includeTime)?z:y,a?l.formatDate(a,c):null):k.isNumericField(g)?(c=(null===f||void 0===f?0:f.format)?n.convertNumberFormatToIntlOptions(f.format):A,n.formatNumber(parseFloat(a),c)):p.renderingSanitizer.sanitize(a)};b.cellValueValidatorFunction=function(b){return b.oldValue!==b.value};b.config=null;b.defaultValue=null;b.description=null;b.direction=null;b.editingEnabled=!1;b.field=null;b.formatFunction=
null;b.headerRenderFunction=function(a){var c=a.root,h=b.editable,f=b.editingEnabled,g=b.headerMenuEnabled,d=b.sortable;b.removeCellContent(c);c.classList.add("esri-field-column__header-content");f&&!h&&c.appendChild(b.createLockedElement());d?b.headerSorterRenderFunction(a):(h=b.header,f=b.path,d=document.createElement("div"),d.innerHTML=h||f,c.appendChild(d));g&&b.headerMenuRenderFunction(a)};b.inputRenderFunction=function(a){var c,h,f=a.root,g=a.column;a=a.rowData;if((null===(c=b.activeEditInfo)||
void 0===c||!c.updating)&&b.editable){var d=b.getCellValue(g,a);c=b.createInputElement({root:f,column:g,rowData:a,value:d});b._set("activeEditInfo",{column:g,input:c,root:f,rowData:a,updating:!0,oldValue:d});"date"===b.type?b._renderDateEditors(d,f,c):(g=b.createInputContainer(),g.appendChild(c),b.removeCellContent(f),f.appendChild(g),c.focus(),c instanceof HTMLInputElement&&c.select(),null===(h=b.grid)||void 0===h?void 0:h.notifyResize())}};b.layer=null;b.menuConfig=null;b.name=null;b.nullable=!0;
b.parseInputValueFunction=function(a){var c=b._inputField;a=a.input.value;var h=c.type;return c.required||""!==a?"number"===h||"date"===h?parseFloat(a):a:null};b.path=null;b.type=null;b.updateRowItemFunction=function(a){a.rowData.item.feature.attributes[a.column.path]=a.value};return b}d.__extends(c,q);Object.defineProperty(c.prototype,"editable",{get:function(){var a,b,c;return this.editingEnabled?this.config?!1===this.config.editable?!1:null===(a=this.field)||void 0===a?void 0:a.editable:null===
(b=this.field)||void 0===b?void 0:b.editable:this.config?!0===this.config.editable&&(null===(c=this.field)||void 0===c?void 0:c.editable):!1},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"header",{get:function(){var a;return(null===(a=this.config)||void 0===a?void 0:a.label)||this.alias||this.path||null},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"hidden",{get:function(){var a=this.config;return!1===(null===a||void 0===a?void 0:a.visible)||this._get("hidden")||
!1},set:function(a){this._set("hidden",a)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"loadingMessage",{get:function(){var a;return(null===(a=this.messages)||void 0===a?void 0:a.loading)||"..."},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"maxLength",{get:function(){var a,b,c=null===(a=this.field)||void 0===a?void 0:a.length;a=null===(b=this.config)||void 0===b?void 0:b.maxLength;return!isNaN(a)&&-1<=a&&(-1===c||a<=c)?a:c},enumerable:!1,configurable:!0});
Object.defineProperty(c.prototype,"required",{get:function(){var a=this.get("field.nullable"),b=this.get("config.required");return this.editable&&(!a||!0===b)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"sortable",{get:function(){var a;return!1!==(null===(a=this.config)||void 0===a?void 0:a.sortable)},enumerable:!1,configurable:!0});c.prototype.createInputElement=function(a){var b=this,c=a.value;a=a.rowData.item;if(!a||!a.feature)return null;this._inputField=this._setUpInputField(a.feature,
c);a=this.field;var d=this.maxLength,e=this.required,f=this._inputField.domain,g=null;"coded-value"===(null===f||void 0===f?void 0:f.type)?(g=this._createSelectElement(c,f.codedValues.map(function(a){return{value:a.code,name:a.name}}),this._inputField),g.onchange=function(){g.onblur=null;m()}):(g=document.createElement("input"),g.type=k.isNumericField(a)?"number":"text",-1<d&&(g.maxLength=d));g.classList.add("esri-field-column__cell-input");g.value=c;g.required=e;var r=!1;g.onkeydown=function(a){r=
"Escape"===a.key};g.onblur=function(){g.onblur=null;m()};var m=function(){r?b.cancel():b.submit();b._inputField=null};return g};c.prototype.createInputContainer=function(){var a=document.createElement("div");a.classList.add("esri-field-column__cell__input-container");return a};c.prototype.createLockedElement=function(){var a=document.createElement("div");a.classList.add("esri-icon-locked");return a};c.prototype.getCellValue=function(a,b){var c,d;a=a.path;b=b.item;return(null===(d=null===(c=null===
b||void 0===b?void 0:b.feature)||void 0===c?void 0:c.attributes)||void 0===d?void 0:d[a])||null};c.prototype._renderDateEditors=function(a,b,c){var d=this,e,f=this.config,g=this.messagesCommon,h=a?new Date(a):new Date(Date.now()),m=new w({dateInputEnabled:!0,value:h}),k=new x({value:h});c.value=h.getTime().toString();var l=!a,n=function(){l=!0;var a=d._getCombinedDateTime(m.value,k.value);c.value=a.getTime().toString()};m.watch("value",function(){return n()});k.watch("value",function(){return n()});
var p=document.createElement("div"),q=document.createElement("div");m.container=p;k.container=q;a=document.createElement("button");a.classList.add("esri-field-column__button","esri-icon-save");a.onclick=function(){l?d.submit():d.cancel()};a.title=null===g||void 0===g?void 0:g.save;h=document.createElement("button");h.classList.add("esri-field-column__button","esri-icon-trash");h.onclick=function(){c.value=null;d.submit()};h.title=null===g||void 0===g?void 0:g.clear;g=document.createElement("div");
g.classList.add("esri-field-column__cell__date-input-wrapper");g.appendChild(p);!1!==f.includeTime&&g.appendChild(q);f=document.createElement("div");f.classList.add("esri-field-column__cell__date-input-container");f.appendChild(g);f.appendChild(a);f.appendChild(h);m.when(function(){var a;return null===(a=d.grid)||void 0===a?void 0:a.notifyResize()});k.when(function(){var a;return null===(a=d.grid)||void 0===a?void 0:a.notifyResize()});this.removeCellContent(b);b.appendChild(f);null===(e=this.grid)||
void 0===e?void 0:e.notifyResize()};c.prototype._createSelectElement=function(a,b,c){var d=!1;b=b.map(function(b){b.value===a&&(d=!0);var c=document.createElement("option");c.text=b.name;c.value=b.value;return c});if(null!=a&&""!==a&&!d){var e=document.createElement("option");e.text=a;e.value=a;b.unshift(e)}c.required||null!=c.value||(e=document.createElement("option"),e.value="",b.unshift(e));var f=document.createElement("select");b.forEach(function(a){return f.add(a)});f.value=a;return f};c.prototype._setUpInputField=
function(a,b){a=new u({config:this.config,feature:a,field:this.field,layer:this.layer,group:null,messages:null});a.set("value",b);return a};c.prototype._isDomainCompatible=function(a){var b=this.field;if(a&&"coded-value"===a.type){var c=typeof a.codedValues[0].code;if("string"===c&&k.isStringField(b)||"number"===c&&k.isNumericField(b))return!0}return a&&"range"===a.type&&k.isNumericField(b)?!0:!1};c.prototype._getDomainForFeature=function(a){var b=this.layer,c=this.name,d=b.typeIdField,e=d===c,f=
this.get("field.domain");if(e&&!f)return new t({name:"__internal-type-based-coded-value-domain__",codedValues:b.types.map(function(a){return{code:a.id,name:a.name}})});a=d&&b.getFieldDomain(c,{feature:a})||f;b=this.get("config.domain");return this._isDomainCompatible(b)?b:a};c.prototype._getComputedDomain=function(a,b){return b?"range"===b.type?a:"coded-value"===b.type?(b=b.codedValues.filter(function(b){return b.hasOwnProperty("code")&&b.code===a}))&&b.length?b[0].name:a:null:null};c.prototype._getCombinedDateTime=
function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),b.getHours(),b.getMinutes(),b.getSeconds())};d.__decorate([e.property({readOnly:!0,aliasOf:"field.alias"})],c.prototype,"alias",void 0);d.__decorate([e.property()],c.prototype,"cellValueFormatFunction",void 0);d.__decorate([e.property()],c.prototype,"cellValueValidatorFunction",void 0);d.__decorate([e.property()],c.prototype,"config",void 0);d.__decorate([e.property({readOnly:!0,aliasOf:"field.defaultValue"})],c.prototype,"defaultValue",
void 0);d.__decorate([e.property({readOnly:!0,aliasOf:"field.description"})],c.prototype,"description",void 0);d.__decorate([e.property()],c.prototype,"direction",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:["config","editingEnabled","field.editable"]})],c.prototype,"editable",null);d.__decorate([e.property()],c.prototype,"editingEnabled",void 0);d.__decorate([e.property()],c.prototype,"field",void 0);d.__decorate([e.property()],c.prototype,"formatFunction",void 0);d.__decorate([e.property({readOnly:!0,
dependsOn:["alias","config"]})],c.prototype,"header",null);d.__decorate([e.property({dependsOn:["config"]})],c.prototype,"hidden",null);d.__decorate([e.property()],c.prototype,"headerRenderFunction",void 0);d.__decorate([e.property()],c.prototype,"inputRenderFunction",void 0);d.__decorate([e.property()],c.prototype,"layer",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:["messages"]})],c.prototype,"loadingMessage",null);d.__decorate([e.property({dependsOn:["field.length","config"]})],c.prototype,
"maxLength",null);d.__decorate([e.property({readOnly:!0,aliasOf:"config.menuConfig"})],c.prototype,"menuConfig",void 0);d.__decorate([e.property({readOnly:!0,aliasOf:"field.name"})],c.prototype,"name",void 0);d.__decorate([e.property({readOnly:!0,aliasOf:"field.nullable"})],c.prototype,"nullable",void 0);d.__decorate([e.property()],c.prototype,"parseInputValueFunction",void 0);d.__decorate([e.property({readOnly:!0,aliasOf:"field.name"})],c.prototype,"path",void 0);d.__decorate([e.property({readOnly:!0,
dependsOn:["field","config"]})],c.prototype,"required",null);d.__decorate([e.property({dependsOn:["config"]})],c.prototype,"sortable",null);d.__decorate([e.property({readOnly:!0,aliasOf:"field.type"})],c.prototype,"type",void 0);d.__decorate([e.property()],c.prototype,"updateRowItemFunction",void 0);return c=d.__decorate([e.subclass("esri.widgets.FeatureTable.FieldColumn")],c)}(v)});