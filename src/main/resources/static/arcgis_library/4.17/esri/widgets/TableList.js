// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/Collection ../core/events ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ../libs/sortablejs/Sortable ./Widget ./support/widget ./TableList/ListItem ./TableList/TableListViewModel ./TableList/support/tableListUtils".split(" "),function(C,D,g,v,w,x,l,h,y,z,e,A,t,r){var B=v.ofType(A);return function(u){function c(a,b){a=u.call(this,a,b)||this;a._handles=new x;a._sortable=null;a._sortableNode=null;a._focusSortUid=null;a.visibleItems=null;a.iconClass=
"esri-icon-table";a.label=void 0;a.listItemCreatedFunction=null;a.map=null;a.messages=null;a.messagesCommon=null;a.multipleSelectionEnabled=!1;a.selectionEnabled=!1;a.selectedItems=new B;a.tableItems=null;a.viewModel=new t;return a}g.__extends(c,u);c.prototype.initialize=function(){var a=this;this._setVisibleItems(this.tableItems);this.own(l.on(this.viewModel,"tableItems","change",function(){return a._itemsChanged()}),l.init(this,"selectionEnabled",function(){return a._toggleSorting()}))};c.prototype.destroy=
function(){this._destroySortable();this._handles.destroy();this._handles=null};c.prototype.triggerAction=function(a,b){this.viewModel.triggerAction(a,b)};c.prototype.render=function(){var a,b,f=this.visibleItems,d=null===(b=this.viewModel)||void 0===b?void 0:b.state;b=(a={},a["esri-hidden"]="loading"===d,a["esri-disabled"]="disabled"===d,a);return e.tsx("div",{class:this.classes("esri-table-list","esri-widget","esri-widget--panel",b)},(null===f||void 0===f?0:f.length)?this.renderList():this.renderNoItems())};
c.prototype.renderNoItems=function(){return e.tsx("div",{class:"esri-table-list__no-items"},this.messages.noItemsToDisplay)};c.prototype.renderList=function(){var a=this,b=this.visibleItems;return e.tsx("ul",{"aria-label":this.messages.widgetLabel,role:this.selectionEnabled?"listbox":void 0,afterCreate:this._sortNodeCreated,afterRemoved:this._destroySortable,"data-node-ref":"_sortableNode",bind:this,class:this.classes("esri-table-list__list","esri-table-list__list--root")},b.map(function(b){return a.renderItem(b)}).toArray())};
c.prototype.renderItem=function(a){var b,f,d,c=this.selectionEnabled,h=this.selectedItems,q=this.id+"_"+a.uid+"__title",k=!!a.error,k=(b={},b["esri-table-list__item--error"]=!!k,b["esri-table-list__item--selectable"]=c,b);return c?(b=(f={},f["data-layer-uid"]=null===(d=a.layer)||void 0===d?void 0:d.uid,f),e.tsx("li",g.__assign({key:"item-with-selection-"+a.uid,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes("esri-table-list__item",k),"aria-labelledby":q,
onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item":a,tabIndex:0,"aria-selected":r.findSelectedItem(a,h)?"true":"false",role:"option"},b),this.renderItemContent(a,q))):e.tsx("li",{key:"item-no-selection-"+a.uid,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes("esri-table-list__item",k),"aria-labelledby":q},this.renderItemContent(a,q))};c.prototype.renderActionsMenuIcon=function(a,b){var f,d=this.messagesCommon,c=(f={},f["esri-table-list__item-actions-menu-item--active"]=
a.actionsOpen,f);f=a.actionsOpen?d.close:d.open;return e.tsx("div",{key:"actions-menu-toggle","data-item":a,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes("esri-table-list__item-actions-menu-item",c),tabindex:"0",role:"button","aria-controls":b,"aria-label":f,title:f},e.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"}))};c.prototype.renderActionsMenu=function(a,b,f,d){var c=(b=1===f&&this._getSingleActionButton(b))?this.renderAction({item:a,
action:b,singleAction:!0}):null;return(a=!b&&f?this.renderActionsMenuIcon(a,d):null)||b?e.tsx("div",{key:"actions-menu",class:"esri-table-list__item-actions-menu"},c,a):null};c.prototype.renderError=function(a){return a.error?e.tsx("div",{key:"error",class:"esri-table-list__item-error-message",role:"alert"},e.tsx("span",null,this.messages.tableError)):null};c.prototype.renderItemContent=function(a,b){var f=this.id+"_"+a.uid+"_actions",d=this._filterActions(a.actionsSections),c=this._countActions(d);
return[e.tsx("div",{key:"list-item-container",class:"esri-table-list__item-container"},this.renderLabel(a,b),this.renderActionsMenu(a,d,c,f)),this.renderError(a),c?this.renderActionsSections(a,d,f):null]};c.prototype.renderTitle=function(a,b){var f=this.messages;return e.tsx("span",{key:"layer-title-container",id:b,class:"esri-table-list__item-title"},a.title||f.untitledTable)};c.prototype.renderItemError=function(a){return a.error?e.tsx("span",{key:"notice-triangle","aria-hidden":"true",class:"esri-icon-notice-triangle"}):
null};c.prototype.renderLabel=function(a,b){return a.error?[this.renderItemError(a),this.renderTitle(a,b)]:this.renderTitle(a,b)};c.prototype.renderActionsSections=function(a,b,f){var d=this;b=b.toArray().map(function(b){return e.tsx("ul",{key:b,class:"esri-table-list__item-actions-list"},d.renderActionSection(a,b))});return e.tsx("div",{role:"group","aria-expanded":a.actionsOpen?"true":"false",key:"actions-section",id:f,class:"esri-table-list__item-actions",hidden:a.actionsOpen?null:!0},b)};c.prototype.renderActionSection=
function(a,b){var f=this;return(b&&b.toArray()).map(function(b){return f.renderAction({item:a,action:b})})};c.prototype.renderActionIcon=function(a){var b,f=a.active,c=a.className,m=this._getIconImageStyles(a);a="button"!==a.type||a.image||c?c:"esri-icon-default-action";c=(b={},b["esri-table-list__item-action-image"]=!f&&!!m["background-image"],b["esri-icon-loading-indicator"]=f,b["esri-rotating"]=f,b);a&&!f&&(c[a]=!0);return e.tsx("span",{key:"action-icon","aria-hidden":"true",class:this.classes("esri-table-list__item-action-icon",
c),styles:m})};c.prototype.renderActionTitle=function(a,b){return b?null:e.tsx("span",{key:"action-title",class:"esri-table-list__item-action-title"},a)};c.prototype.renderAction=function(a){var b,c=a.item,d=a.action;a=a.singleAction;var m=d.active,g=d.disabled,h=d.title,m=(b={},b["esri-table-list__item-actions-menu-item"]=a&&"button"===d.type,b["esri-table-list__item-action"]=m||!a&&"toggle"!==d.type,b["esri-table-list__action-toggle"]=!m&&"toggle"===d.type,b["esri-table-list__action-toggle--on"]=
!m&&"toggle"===d.type&&d.value,b["esri-disabled-element"]=g,b);b=[this.renderActionIcon(d),this.renderActionTitle(h,a)];return a?e.tsx("div",{bind:this,"data-item":c,"data-action":d,role:"button",key:d,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:m,tabindex:"0",title:h,"aria-label":h},b):e.tsx("li",{bind:this,"data-item":c,"data-action":d,key:d,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:m,tabindex:"0",role:"button",title:h,"aria-label":h},b)};c.prototype._filterActions=
function(a){return a.map(function(a){return a.filter(function(a){return a.visible})})};c.prototype._setVisibleItems=function(a){var b=this;this.visibleItems=null===a||void 0===a?void 0:a.filter(function(a){return b.errorsVisible||!a.error})};c.prototype._destroySortable=function(){var a=this._sortable;a&&a.destroy();this._sortable=null};c.prototype._toggleSorting=function(){var a=this,b=this._sortable,c=this._sortableNode,d=this.selectionEnabled;if(c)if(b)b.option("disabled",!d);else{var e=y.create(c,
{dataIdAttr:"data-layer-uid",group:"root-tables",fallbackTolerance:4,disabled:!d,onSort:function(){return a._sortTablesToItems(e.toArray())},chosenClass:"esri-table-list__item--chosen"});this._sortable=e}};c.prototype._sortNodeCreated=function(a){this._sortableNode=a;this._toggleSorting()};c.prototype._sortTablesToItems=function(a){var b,c=null===(b=this.map)||void 0===b?void 0:b.tables;c&&c.sort(function(b,c){b=a.indexOf(b.uid);c=a.indexOf(c.uid);return b>c?-1:b<c?1:0})};c.prototype._getSingleActionButton=
function(a){return a.reduce(function(a){return a}).filter(function(a){return a&&"button"===a.type}).getItemAt(0)};c.prototype._focusListItem=function(a){var b,c=this._focusSortUid;a&&c&&(null===(b=a["data-item"].layer)||void 0===b?void 0:b.uid)===c&&(a.focus(),this._focusSortUid=null)};c.prototype._watchActionSectionChanges=function(a,b){var c=this,d="action-section"+b;this._handles.add(a.on("change",function(){return c.scheduleRender()}),d);a.forEach(function(a){return c._renderOnActionChanges(a,
b)})};c.prototype._renderOnActionChanges=function(a,b){var c=this;b="actions"+b;var d=function(){return c.scheduleRender()};"toggle"===a.type?this._handles.add([l.init(a,"className image id title visible value".split(" "),d)],b):"slider"===a.type?this._handles.add([l.init(a,"className id title visible value displayValueEnabled max min step".split(" "),d)],b):this._handles.add([l.init(a,["className","image","id","title","visible"],d)],b)};c.prototype._renderOnItemChanges=function(a){var b=this,c=a.uid,
d="items"+c,e=function(){return b.scheduleRender()};this._handles.add([l.init(a,["actionsOpen","open","title","error"],e),a.actionsSections.on("change",e)],d);a.actionsSections.forEach(function(a){return b._watchActionSectionChanges(a,c)})};c.prototype._itemsChanged=function(){var a=this,b=this.viewModel.tableItems;this._setVisibleItems(b);this._handles.removeAll();b.forEach(function(b){return a._renderOnItemChanges(b)});this.scheduleRender()};c.prototype._countActions=function(a){return a.reduce(function(a,
c){return a+c.length},0)};c.prototype._getIconImageStyles=function(a){a="esri.support.Action.ActionButton"===a.declaredClass||"esri.support.Action.ActionToggle"===a.declaredClass?a.image:null;return{"background-image":a?'url("'+a+'")':null}};c.prototype._selectionKeydown=function(a){var b,c,d,e,h=w.eventKey(a);if(-1===["ArrowDown","ArrowUp"].indexOf(h))this._toggleSelection(a);else{a.stopPropagation();var g=a.currentTarget["data-item"],k=this._sortable,l=r.findSelectedItem(g,this.selectedItems),n=
k.toArray();a=n.indexOf(a.target.dataset.layerUid);if(-1!==a){if("ArrowDown"===h){var p=a+1;if(p>=n.length)return;l?(n.splice(p,0,n.splice(a,1)[0]),k.sort(n),this._sortTablesToItems(k.toArray()),this._focusSortUid=null===(b=g.layer)||void 0===b?void 0:b.uid):(this._focusSortUid=null===(c=g.layer)||void 0===c?void 0:c.uid,this.scheduleRender())}"ArrowUp"===h&&(p=a-1,-1>=p||(l?(n.splice(p,0,n.splice(a,1)[0]),k.sort(n),this._sortTablesToItems(k.toArray()),this._focusSortUid=null===(d=g.layer)||void 0===
d?void 0:d.uid):(this._focusSortUid=null===(e=g.layer)||void 0===e?void 0:e.uid,this.scheduleRender())))}}};c.prototype._toggleActionsOpen=function(a){var b=a.currentTarget["data-item"],c=!b.actionsOpen;c&&this.tableItems.forEach(function(a){a.actionsOpen&&(a.actionsOpen=!1)});b.actionsOpen=c;a.stopPropagation()};c.prototype._triggerAction=function(a){var b=a.currentTarget,c=b["data-action"],b=b["data-item"];"toggle"===c.type&&(c.value=!c.value);this.triggerAction(c,b);a.stopPropagation()};c.prototype._toggleSelection=
function(a){a.stopPropagation();var b=this.selectedItems,c=this.multipleSelectionEnabled&&(a.metaKey||a.ctrlKey);a=a.currentTarget["data-item"];var d=r.findSelectedItem(a,b),e=b.length,g=d&&1===e;c?d?b.remove(d):b.add(a):e&&!g?(b.removeAll(),b.add(a)):d?b.remove(d):b.add(a)};g.__decorate([h.property()],c.prototype,"visibleItems",void 0);g.__decorate([h.property()],c.prototype,"iconClass",void 0);g.__decorate([h.property(),e.renderable()],c.prototype,"errorsVisible",void 0);g.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",
overridable:!0}})],c.prototype,"label",void 0);g.__decorate([h.aliasOf("viewModel.listItemCreatedFunction"),e.renderable()],c.prototype,"listItemCreatedFunction",void 0);g.__decorate([h.aliasOf("viewModel.map")],c.prototype,"map",void 0);g.__decorate([h.property(),e.renderable(),e.messageBundle("esri/widgets/TableList/t9n/TableList")],c.prototype,"messages",void 0);g.__decorate([h.property(),e.renderable(),e.messageBundle("esri/t9n/common")],c.prototype,"messagesCommon",void 0);g.__decorate([h.property()],
c.prototype,"multipleSelectionEnabled",void 0);g.__decorate([h.property(),e.renderable()],c.prototype,"selectionEnabled",void 0);g.__decorate([h.property(),e.renderable()],c.prototype,"selectedItems",void 0);g.__decorate([h.aliasOf("viewModel.tableItems"),e.renderable()],c.prototype,"tableItems",void 0);g.__decorate([e.vmEvent("trigger-action"),h.property({type:t}),e.renderable("viewModel.state")],c.prototype,"viewModel",void 0);g.__decorate([h.aliasOf("viewModel.triggerAction")],c.prototype,"triggerAction",
null);g.__decorate([e.accessibleHandler()],c.prototype,"_toggleActionsOpen",null);g.__decorate([e.accessibleHandler()],c.prototype,"_triggerAction",null);g.__decorate([e.accessibleHandler()],c.prototype,"_toggleSelection",null);return c=g.__decorate([h.subclass("esri.widgets.TableList")],c)}(z)});