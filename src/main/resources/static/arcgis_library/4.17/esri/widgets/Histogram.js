// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../intl ../core/maybe ../core/accessorSupport/decorators ./Widget ./Histogram/HistogramViewModel ./support/widget".split(" "),function(u,v,f,p,q,g,r,t,d){return function(l){function b(a,e){a=l.call(this,a,e)||this;a._containerNode=null;a._defaultBarColor="#d8d8d8";a.average=null;a.barCreatedFunction=null;a.bins=null;a.dataLines=null;a.dataLineCreatedFunction=null;a.label=void 0;a.labelFormatFunction=null;a.max=null;a.messages=null;a.min=null;a.state=null;a.viewModel=
new t;return a}f.__extends(b,l);k=b;Object.defineProperty(b.prototype,"layout",{set:function(a){"vertical"!==a&&(a="horizontal");this._set("layout",a)},enumerable:!1,configurable:!0});b.fromHistogramResult=function(a){return new k({bins:a.bins,max:a.maxValue,min:a.minValue})};b.prototype.render=function(){var a=this.label,e=this.state,c=this.classes("esri-histogram","esri-widget","horizontal"===this.layout?"esri-histogram--horizontal":"esri-histogram--vertical","disabled"===e?"esri-disabled":null);
return d.tsx("div",{"aria-label":a,afterCreate:d.storeNode,bind:this,class:c,"data-node-ref":"_containerNode"},"ready"===e?this.renderContent():null)};b.prototype.renderContent=function(){if(this._containerNode)return d.tsx("div",{class:"esri-histogram__content"},d.tsx("svg",{class:"esri-histogram__svg",xmlns:"http://www.w3.org/2000/svg"},this.renderBarsGroup(),this.renderLinesGroup()))};b.prototype.renderBarsGroup=function(){return d.tsx("g",{class:this.classes("esri-histogram__bars")},this.renderBars())};
b.prototype.renderBars=function(){var a=this,e=this.layout,c=this.viewModel,b=c.binRange,c=c.range;if(b&&c){var b=b/c,d=this._getContainerDimensions(),c=d[0],d=d[1];if(0!==c||0!==d)if(0===c&&0!==d)this.scheduleRender();else return e="vertical"===e?[c*b,d]:[c,d*b],this._getBarDimensions(e[0],e[1]).map(function(c,b){return a.renderBar(b,c[0],c[1])})}};b.prototype.renderBar=function(a,b,c){var e=this.bins,f=this.layout,g=this.max,n=this.messages,h=this.viewModel.range,m=this._getContainerDimensions(),
k=m[0],l=m[1],e=e.slice()[a],m=e.maxValue,g=g-m,h="vertical"===f?[0,k/h*g]:[l-c-l/h*g,k-b],f=h[0],h=h[1],n=p.substitute(n.barLabel,{count:e.count,maxValue:m,minValue:e.minValue});return d.tsx("rect",{"aria-label":n,afterCreate:this._afterBarCreate,bind:this,class:"esri-histogram__bar","data-index":a,fill:this._defaultBarColor,height:b,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:c,x:f,y:h})};b.prototype.renderLinesGroup=function(){return d.tsx("g",{class:this.classes("esri-histogram__data-lines")},
this.renderAverageLine(),this.renderCustomLines())};b.prototype.renderAverageLine=function(){var a=this.average;if(q.isSome(a)){var b=[d.tsx("tspan",{class:this.classes("esri-histogram__average-symbol")},"x\u0304 "),d.tsx("tspan",{class:this.classes("esri-histogram__average-label")},this.labelFormatFunction?this.labelFormatFunction(a,"average"):a)];return d.tsx("g",{afterCreate:this._afterLinesSubgroupCreate,bind:this,class:this.classes("esri-histogram__data-lines-subgroup")},this.renderLine(a,this.classes("esri-histogram__average-data-line")),
this.renderLabel(a,b))}};b.prototype.renderCustomLines=function(){var a=this;if(this.dataLines&&this.dataLines.length)return this.dataLines.map(function(b,c){return a.renderLineSubgroup(c,b.value,b.label)})};b.prototype.renderLineSubgroup=function(a,b,c){return d.tsx("g",{afterCreate:this._afterLinesSubgroupCreate,bind:this,class:this.classes("esri-histogram__data-lines-subgroup"),"data-index":a},this.renderLine(b),this.renderLabel(b,c))};b.prototype.renderLine=function(a,b){var c=this._getLinePosition(a);
a=c[0];var e=c[1],f=c[2],c=c[3];return d.tsx("line",{class:this.classes("esri-histogram__data-line",b),x1:a,x2:e,y1:f,y2:c,"shape-rendering":"crispEdges"})};b.prototype.renderLabel=function(a,b,c){var e=this._getLabelPosition(a);a=e[0];e=e[1];return d.tsx("text",{class:this.classes("esri-histogram__label",c),"text-anchor":"end",transform:"horizontal"===this.layout?"rotate(270)":null,x:a,y:e-2},b)};b.prototype._afterBarCreate=function(a){if(this.barCreatedFunction){var b=a.dataset?parseInt(a.dataset.index,
10):a.getAttribute("data-index")?parseInt(a.getAttribute("data-index"),10):null;this.barCreatedFunction(isNaN(b)?null:b,a)}};b.prototype._afterLinesSubgroupCreate=function(a){if(this.dataLineCreatedFunction){var b=a.dataset?parseInt(a.dataset.index,10):a.getAttribute("data-index")?parseInt(a.getAttribute("data-index"),10):null;this.dataLineCreatedFunction(a.childNodes[0],a.childNodes[1]?a.childNodes[1]:null,isNaN(b)?null:b)}};b.prototype._getContainerDimensions=function(){var a=this._containerNode;
return a?[a.offsetHeight,a.offsetWidth]:[0,0]};b.prototype._getBarDimensions=function(a,b){var c=this.bins,d=this.layout,e=c?c.map(function(a){return a.count}):[],f=Math.max.apply(Math,e);return e.map(function(c){return"vertical"===d?[a/e.length,0!==f?c/f*b:0]:[0!==f?c/f*a:0,b/e.length]})};b.prototype._getLinePosition=function(a){var b=this.layout;a=(a-this.min)/this.viewModel.range;var c=this._getContainerDimensions(),d=c[0],c=[a*c[1],d-a*d];a=c[0];c=c[1];return"vertical"===b?[0,"100%",c,c]:[a,a,
"100%",0]};b.prototype._getLabelPosition=function(a){var b=this.layout;a=(a-this.min)/this.viewModel.range;var c=this._getContainerDimensions(),d=c[0],c=c[1];return"vertical"===b?[c,d-a*d]:[0,a*c]};var k;f.__decorate([g.aliasOf("viewModel.average")],b.prototype,"average",void 0);f.__decorate([g.property(),d.renderable()],b.prototype,"barCreatedFunction",void 0);f.__decorate([g.aliasOf("viewModel.bins")],b.prototype,"bins",void 0);f.__decorate([g.property(),d.renderable()],b.prototype,"dataLines",
void 0);f.__decorate([g.property(),d.renderable()],b.prototype,"dataLineCreatedFunction",void 0);f.__decorate([g.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],b.prototype,"label",void 0);f.__decorate([g.aliasOf("viewModel.labelFormatFunction")],b.prototype,"labelFormatFunction",void 0);f.__decorate([g.property({value:"horizontal"})],b.prototype,"layout",null);f.__decorate([g.aliasOf("viewModel.max")],b.prototype,"max",void 0);f.__decorate([g.property(),d.renderable(),d.messageBundle("esri/widgets/Histogram/t9n/Histogram")],
b.prototype,"messages",void 0);f.__decorate([g.aliasOf("viewModel.min")],b.prototype,"min",void 0);f.__decorate([g.aliasOf("viewModel.state")],b.prototype,"state",void 0);f.__decorate([g.property(),d.renderable("viewModel.average viewModel.bins viewModel.labelFormatFunction viewModel.max viewModel.min viewModel.state".split(" "))],b.prototype,"viewModel",void 0);return b=k=f.__decorate([g.subclass("esri.widgets.Histogram")],b)}(r)});