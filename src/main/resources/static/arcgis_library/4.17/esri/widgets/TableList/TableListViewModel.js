// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Collection ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../LayerList/support/layerListUtils ./ListItem".split(" "),function(r,t,e,m,n,p,f,g,q,h){var k=m.ofType(h);return function(l){function b(a){a=l.call(this,a)||this;a._handles=new p;a.listItemCreatedFunction=null;a.tableItems=new k;a.map=null;return a}e.__extends(b,l);b.prototype.initialize=function(){var a=this;this._handles.add([f.init(this,["map","map.loaded"],
function(){return a._mapHandles()})],"map")};b.prototype.destroy=function(){this._handles.destroy();this.map=this._handles=null;this.tableItems.removeAll()};Object.defineProperty(b.prototype,"state",{get:function(){var a,c=null===(a=this.map)||void 0===a?void 0:a.loadStatus;return"string"===typeof c?"loaded"===c?"ready":"loading"===c?"loading":"disabled":"ready"},enumerable:!1,configurable:!0});b.prototype.triggerAction=function(a,c){a&&!a.disabled&&this.emit("trigger-action",{action:a,item:c})};
b.prototype._mapHandles=function(){var a=this,c=this._handles,b=this.map;c.remove("tables");this._compileList();b&&c.add([f.on(this,"map.tables","change",function(){return a._compileList()}),f.init(this,"map.tables",function(){return a._compileList()}),f.init(this,"listItemCreatedFunction",function(){return a._compileList()})],"tables")};b.prototype._modifyListItem=function(a){"function"===typeof this.listItemCreatedFunction&&this.listItemCreatedFunction.call(null,{item:a})};b.prototype._removeAllItems=
function(){this.tableItems.removeAll()};b.prototype._getViewableTables=function(a){if(a)return a.filter(function(a){return"hide"!==q.findLayerListMode(a)})};b.prototype._watchTablesListMode=function(a){var c=this,b=this._handles;b.remove("layer-list-mode");a&&a.forEach(function(a){b.add(f.watch(a,"listMode",function(){return c._compileList()}),"layer-list-mode")})};b.prototype._compileList=function(){var a,b=null===(a=this.map)||void 0===a?void 0:a.tables;this._watchTablesListMode(b);(a=this._getViewableTables(b))&&
a.length?(this._createNewItems(a),this._modifyOrRemoveItems(a),this._sortItems(a)):this._removeAllItems()};b.prototype._createNewItems=function(a){var b=this.tableItems;a.forEach(function(a){b.find(function(b){return b.layer===a})||b.add(new h({layer:a}))})};b.prototype._modifyOrRemoveItems=function(a){var b=this,d=this.tableItems;d.forEach(function(c){c&&(a&&a.find(function(a){return c.layer===a})?b._modifyListItem(c):d.remove(c))})};b.prototype._sortItems=function(a){this.tableItems.sort(function(b,
d){b=a.indexOf(b.layer);d=a.indexOf(d.layer);return b>d?-1:b<d?1:0})};e.__decorate([g.property()],b.prototype,"listItemCreatedFunction",void 0);e.__decorate([g.property({type:k})],b.prototype,"tableItems",void 0);e.__decorate([g.property()],b.prototype,"map",void 0);e.__decorate([g.property({dependsOn:["map","map.loadStatus"],readOnly:!0})],b.prototype,"state",null);return b=e.__decorate([g.subclass("esri.widgets.TableList.TableListViewModel")],b)}(n.EventedAccessor)});