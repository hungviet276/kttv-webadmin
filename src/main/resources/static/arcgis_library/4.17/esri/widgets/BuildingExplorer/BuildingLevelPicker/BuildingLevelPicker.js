// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/arrayUtils ../../../core/events ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/pep/pep ../../Widget ../BuildingLevel ./constants ./Label ./LevelItem ../../support/widget".split(" "),function(A,B,d,u,l,m,n,h,k,e,v,w,p,g,x,y,f){var z={selectLevel:"selectLevel",clearLevel:"clearLevel",nextLevel:"nextLevel",previousLevel:"previousLevel",currentLevel:"{{value}}"};
return function(q){function a(b,a){var c=q.call(this,b,a)||this;c._defaultViewModel=new p;c.viewModel=c._defaultViewModel;c.messages=z;c._levelHandles=new m;c._levelEventHandles=new m;c._levelWidgets=[];c._labelWidget=new x.Label({onClear:function(){return c.viewModel.clear()}});c._hoveredLevel=null;c._expandedLevelsHeight=void 0;c._normalizedPointerPosition=0;c._hovering=!1;c._containerPosTop=null;c._levelsContainer=null;c._onPointerUp=function(){window.getSelection().removeAllRanges();h.isSome(c._hoveredLevel)&&
(c.viewModel.enabled&&c._hoveredLevel===c.viewModel.value?c.viewModel.clear():c.viewModel.select(c._hoveredLevel))};c._onPointerEnter=function(){var b;!c._hovering&&h.isSome(c._levelsContainer)&&(c._hovering=!0,c._containerPosTop=null!==(b=c._levelsContainer.getBoundingClientRect().top)&&void 0!==b?b:0)};c._onPointerLeave=function(){c._hovering&&(c._normalizedPointerPosition=0,c._hoveredLevel=null,c._hovering=!1)};c._onPointerMove=function(b){if(!c._hovering)return!1;window.getSelection().removeAllRanges();
if(h.isSome(c._containerPosTop)){var a=c._levelHeight/2;b=(b.clientY-(c._containerPosTop+g.LEVELS_PADDING*g.LEVELS_MARGIN_FACTOR+c._expandedLevelsMargin+a))/(c._levelsHeight-a);b+=g.LEVELS_POINTER_ADJUSTMENT;c._normalizedPointerPosition=b}return!1};return c}d.__extends(a,q);a.prototype.postInitialize=function(){var b=this;this.own(k.init(this,"_levelsContainer",function(){return b._onContainerChange()}),k.init(this,"_levels",function(){return b._createLevelWidgets()}),k.init(this,"messages",function(){return b._labelWidget.messages=
b.messages}))};a.prototype.destroy=function(){this._levelHandles.destroy();this._levelEventHandles.destroy();this._levelWidgets.forEach(function(b){return b.destroy()});this._labelWidget.destroy();this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()};Object.defineProperty(a.prototype,"_levelsHeight",{get:function(){return Math.round(this._levelHeight*this._numLevels)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"_expandedLevelsMargin",{get:function(){return Math.round((this._expandedLevelsHeight-
this._levelsHeight)/2)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"_levelWidth",{get:function(){return Math.round(n.clamp(g.LEVEL_WIDTH_NOMINATOR/Math.sqrt(this._numLevels)+g.LEVEL_WIDTH_CONSTANT,g.LEVEL_WIDTH_MIN,g.LEVEL_WIDTH_MAX))},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"_levelHeight",{get:function(){var b=g.LEVEL_HEIGHT_DEFAULT;return Math.round(n.clamp(2*b/Math.sqrt(this._numLevels),2,b))},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"_gaussianFactor",{get:function(){var b=this._numLevels;return b/Math.log(g.ALPHA_LEVEL_DEPENDENCY_FACTOR*b)*g.ALPHA_SPREAD_FACTOR},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"_levelClosestToPointer",{get:function(){if(!this._hovering)return null;var b=this._numLevels-1,a=this._normalizedPointerPosition;return 0<=b&&h.isSome(a)?this._levels[Math.round((1-a)*b)]:null},enumerable:!1,configurable:!0});a.prototype.render=function(){var b,a=this._levelWidgets.length,c=1<a?this._levelWidgets.map(function(b){return b.render()}):
null,d=g.LEVELS_PADDING*g.LEVELS_MARGIN_FACTOR,e=-d/g.LEVELS_MARGIN_FACTOR,t=this._levelsHeight,d=t+2*d;return f.tsx("div",{bind:this,key:this,class:this.classes("esri-widget","esri-building-level-picker",(b={},b["esri-building-level-picker--animate-level"]=!this._hovering,b["esri-building-level-picker--no-level"]=2>a,b)),onkeydown:this._onKeyDown},this._renderLabelContainer(),f.tsx("div",{bind:this,class:"esri-building-level-picker__levels-container",styles:{height:d+"px",marginTop:e+"px",marginBottom:e+
"px"},onfocus:this._onFocus,afterCreate:f.storeNode,"data-node-ref":"_levelsContainer"},f.tsx("div",{styles:{height:t+"px",margin:g.LEVELS_PADDING-this._expandedLevelsMargin+"px 0 0 0"},class:"esri-building-level-picker__inner-levels-container"},c)))};a.prototype._renderLabelContainer=function(){var b=this.messages.previousLevel,a=this.messages.nextLevel;return f.tsx("div",{class:"esri-building-level-picker__label-container",tabIndex:0},f.tsx("button",{bind:this,class:"esri-building-level-picker__arrow-up",
disabled:!this.viewModel.hasNext,onclick:this._onArrowUpClick,"aria-label":a,title:a,type:"button"}),this._labelWidget.render(),f.tsx("button",{bind:this,class:"esri-building-level-picker__arrow-down",disabled:!this.viewModel.hasPrevious,onclick:this._onArrowDownClick,"aria-label":b,title:b,type:"button"}))};a.prototype._updateComponents=function(){var b=this,a=this.viewModel.enabled?this.viewModel.value:null,c=h.isSome(this._hoveredLevel)?this._hoveredLevel:a;this._levelWidgets.forEach(function(c){var d,
e,r=b.viewModel.getValueLabel(c.level);c.label=h.isSome(r)?r:null===(e=null===(d=b.messages)||void 0===d?void 0:d.currentLevel)||void 0===e?void 0:e.replace("{{level}}",String(c.level));c.active=c.level===a;c.hovering=c.level===b._hoveredLevel});this._labelWidget.level=c;this._labelWidget.active=c===a;this._labelWidget.hovering=h.isSome(this._hoveredLevel)};a.prototype._onWidthChange=function(){var b=this;this._levelWidgets.forEach(function(a){a.width=b._levelWidth})};a.prototype._createLevelWidgets=
function(){var b=this;this._levelWidgets.forEach(function(b){return b.destroy()});this._levelWidgets=this._levels.map(function(a){return new y.LevelItem({level:a,onSelect:function(){return b._onLevelToggle(a)}})});this._levelHandles.removeAll();this._levelHandles.add([k.init(this,["messages","viewModel.value","viewModel.enabled","_hoveredLevel","_hovering"],function(){return b._updateComponents()}),k.init(this,["_normalizedPointerPosition","_hovering"],function(){return b._onPointerPositionChange()}),
k.init(this,"_width",function(){return b._onWidthChange()})])};a.prototype._onContainerChange=function(){var b=this._levelsContainer;h.isSome(b)&&(v.applyLocal(b),this._levelEventHandles.removeAll(),this._levelEventHandles.add([l.on(b,"pointerenter",this._onPointerEnter),l.on(b,"pointerover",this._onPointerEnter),l.on(b,"pointerleave",this._onPointerLeave),l.on(b,"pointerup",this._onPointerUp),l.on(b,"pointermove",this._onPointerMove)]))};a.prototype._onKeyDown=function(b){switch(b.key){case "ArrowDown":case "ArrowLeft":b.preventDefault();
b.stopPropagation();this.viewModel.previous();this._focusCurrentLevel();break;case "ArrowUp":case "ArrowRight":b.preventDefault(),b.stopPropagation(),this.viewModel.next(),this._focusCurrentLevel()}};a.prototype._focusCurrentLevel=function(){var b=this,a=u.find(this._levelWidgets,function(a){return a.level===b.viewModel.value});a&&a.focus()};a.prototype._onFocus=function(){this._hoveredLevel=0<this._levels.length?this._levels[0]:null};a.prototype._onLevelToggle=function(b){this.viewModel.enabled&&
this.viewModel.value===b?this.viewModel.clear():this.viewModel.select(b)};a.prototype._onArrowUpClick=function(){this.viewModel.next()};a.prototype._onArrowDownClick=function(){this.viewModel.previous()};a.prototype._onPointerPositionChange=function(){var b=this,a=0;this._levelWidgets.forEach(function(c,d){var e=b._getLevelWidgetSize(d);d=e.width;e=e.height;c.height=e;c.width=d;a+=e});this._hoveredLevel=this._levelClosestToPointer;var c=this._expandedLevelsHeight;if(null==c||30<Math.abs(c-a))this._expandedLevelsHeight=
a};a.prototype._getLevelWidgetSize=function(b){var a={width:this._levelWidth,height:this._levelHeight};this._hovering&&(b=this._getGaussianFactor(b,this._normalizedPointerPosition),a.width+=g.LEVEL_HOVERED_EXTRA_WIDTH*b,a.height+=g.LEVEL_HOVERED_EXTRA_HEIGHT*b);return a};a.prototype._getGaussianFactor=function(a,d){var b=this._numLevels-1;return Math.exp(-Math.pow(this._gaussianFactor*((b-a)/b-d),2))};d.__decorate([e.property({type:p}),f.renderable(["viewModel.hasNext","viewModel.hasPrevious"])],
a.prototype,"viewModel",void 0);d.__decorate([e.property()],a.prototype,"messages",void 0);d.__decorate([e.property(),f.renderable()],a.prototype,"_levelWidgets",void 0);d.__decorate([e.property(),f.renderable()],a.prototype,"_labelWidget",void 0);d.__decorate([e.property(),f.renderable()],a.prototype,"_hoveredLevel",void 0);d.__decorate([e.aliasOf("viewModel.allowedValues"),f.renderable()],a.prototype,"_levels",void 0);d.__decorate([e.aliasOf("_levels.length"),f.renderable()],a.prototype,"_numLevels",
void 0);d.__decorate([e.property({readOnly:!0,dependsOn:["_numLevels","_levelHeight"]}),f.renderable()],a.prototype,"_levelsHeight",null);d.__decorate([e.property(),f.renderable()],a.prototype,"_expandedLevelsHeight",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:["_expandedLevelsHeight","_levelsHeight"]}),f.renderable()],a.prototype,"_expandedLevelsMargin",null);d.__decorate([e.property({readOnly:!0,dependsOn:["_numLevels"]})],a.prototype,"_levelWidth",null);d.__decorate([e.property({readOnly:!0,
dependsOn:["_numLevels"]})],a.prototype,"_levelHeight",null);d.__decorate([e.property({readOnly:!0,dependsOn:["_numLevels"]})],a.prototype,"_gaussianFactor",null);d.__decorate([e.property({readOnly:!0,dependsOn:["_levels","_numLevels","_hovering","_normalizedPointerPosition"]})],a.prototype,"_levelClosestToPointer",null);d.__decorate([e.property({type:Number,range:{min:0,max:1}}),f.renderable()],a.prototype,"_normalizedPointerPosition",void 0);d.__decorate([e.property()],a.prototype,"_hovering",void 0);
d.__decorate([e.property()],a.prototype,"_containerPosTop",void 0);d.__decorate([e.property()],a.prototype,"_levelsContainer",void 0);return a=d.__decorate([e.subclass("esri.widgets.BuildingExplorer.BuildingLevelPicker.BuildingLevelPicker")],a)}(w)});