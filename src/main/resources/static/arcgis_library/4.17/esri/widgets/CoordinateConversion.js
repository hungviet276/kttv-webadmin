// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/events ../core/global ../core/Logger ../core/accessorSupport/decorators ./Widget ./CoordinateConversion/CoordinateConversionViewModel ./CoordinateConversion/support/Conversion ./support/widget".split(" "),function(w,x,d,r,l,t,e,u,m,n,b){var p=t.getLogger("esri.widgets.CoordinateConversion");return function(q){function c(a,h){a=q.call(this,a,h)||this;a._popupMessage=null;a._popupId=null;a._coordinateInput=null;a._badInput=!1;a._goToEnabled=!1;a._conversionFormat=
null;a._settingsFormat=null;a._previewConversion=null;a._expanded=!1;a._popupVisible=!1;a._settingsVisible=!1;a._inputVisible=!1;a.conversions=null;a.currentLocation=null;a.formats=null;a.goToOverride=null;a.label=void 0;a.messages=null;a.messagesCommon=null;a.mode=null;a.orientation="auto";a.requestDelay=null;a.view=null;a.viewModel=new m;return a}d.__extends(c,q);Object.defineProperty(c.prototype,"multipleConversions",{get:function(){var a=this._get("multipleConversions");return"boolean"===typeof a?
a:!0},set:function(a){!1===a&&(this._expanded=!1,this.conversions.splice(1,this.conversions.length-1));this._set("multipleConversions",a)},enumerable:!1,configurable:!0});c.prototype.reverseConvert=function(a,h){return this.viewModel.reverseConvert(a,h)};c.prototype.render=function(){var a,h=this.get("viewModel.state"),c="disabled"===h?b.tsx("div",{key:"esri-coordinate__no-basemap"},this.messages.noBasemap):null,f=!c&&this._inputVisible?this._renderInputForm():null,k=!c&&this._settingsVisible?this._renderSettings():
null,g=c||f||k?null:this._renderConversionsView(),d=this._popupVisible?this._renderPopup():null,h=(a={},a["esri-coordinate-conversion--capture-mode"]="capture"===this.mode,a["esri-disabled"]="loading"===h,a["esri-coordinate-conversion--no-basemap"]="disabled"===h,a);return b.tsx("div",{class:this.classes("esri-coordinate-conversion esri-widget",h)},d,c,g,k,f)};c.prototype._addConversion=function(a){a=a.target;var h=a["data-index"],b=new n({format:a.options[a.options.selectedIndex]["data-format"]});
a.options.selectedIndex=0;0<=h&&this.conversions.removeAt(h);this.conversions.add(b,h)};c.prototype._findSettingsFormat=function(){return this._settingsFormat||this.conversions.reduceRight(function(a,b){b=b.format;return b.get("hasDisplayProperties")?b:a},null)||this.formats.find(function(a){return a.hasDisplayProperties})};c.prototype._hidePopup=function(){this._popupId&&(clearTimeout(this._popupId),this._popupId=null);this._popupVisible=!1;this._popupMessage=null;this.scheduleRender()};c.prototype._onConvertComplete=
function(){this._inputVisible=!1;this._coordinateInput.value=""};c.prototype._onCopy=function(a){var b=a.currentTarget["data-conversion"].displayCoordinate;"clipboardData"in l?l.clipboardData.setData("text",b):a.clipboardData.setData("text/plain",b);this._showPopup(this.messages.copySuccessMessage);a.preventDefault()};c.prototype._processUserInput=function(a){var b=this;a=r.eventKey(a);var c=this.viewModel;"Enter"!==a&&a?this._badInput&&(this._badInput=!1):this._reverseConvert(this._coordinateInput.value,
this._coordinateInput["data-format"]).then(function(a){"capture"===b.mode?c.resume():b.mode="capture";b.currentLocation=a;c.setLocation(a);b._onConvertComplete()}).catch(function(a){p.error(a);b._showPopup(b.messages.invalidCoordinate);b._badInput=!0})};c.prototype._reverseConvert=function(a,b){var c=this,h=this.viewModel;return b.reverseConvert(a).then(function(a){c._goToEnabled&&h.goToLocation(a).catch(function(a){p.warn(a);c._showPopup(c.messages.locationOffBasemap)});return a})};c.prototype._setInputFormat=
function(a){a=a.target;this._conversionFormat=a[a.options.selectedIndex]["data-format"]};c.prototype._setPreviewConversion=function(){var a=this._findSettingsFormat(),b=this.viewModel;if(a){var c=this.conversions.find(function(b){return b.format===a});this._previewConversion=new n({format:a,position:{location:this.currentLocation,coordinate:c&&c.position.coordinate}});this._previewConversion.position.coordinate||b.previewConversion(this._previewConversion)}};c.prototype._setSettingsFormat=function(a){a=
a.target;this._settingsFormat=a[a.options.selectedIndex]["data-format"];this._setPreviewConversion()};c.prototype._showPopup=function(a,b){var c=this;void 0===b&&(b=2500);this._popupMessage=a;this._popupVisible?clearTimeout(this._popupId):this._popupVisible=!0;this.scheduleRender();this._popupId=setTimeout(function(){c._popupId=null;c._hidePopup()},b)};c.prototype._toggleGoTo=function(){this._goToEnabled=!this._goToEnabled};c.prototype._updateCurrentPattern=function(a){a.stopPropagation();a=a.target;
var b=this._findSettingsFormat();b&&(b.currentPattern=a.value)};c.prototype._renderConversion=function(a,c){var h=this.messages,f=this.id+"__list-item-"+c,k=a.format.name+" "+h.conversionOutputSuffix,g=0===c,d=g||this._expanded,e=g?this._renderFirstConversion(a):this._renderTools(c,a,f),g=g&&!a.displayCoordinate?h.noLocation:a.displayCoordinate,g=b.tsx("div",{"aria-label":g,class:"esri-coordinate-conversion__display","data-conversion":a,role:"listitem",tabindex:"0",title:g},g),v=this._renderOptions(this.formats.filter(function(b){return b!==
a.format}));return d?b.tsx("li",{"aria-label":k,class:"esri-coordinate-conversion__row",id:f,key:a,role:"group",title:k,tabindex:"0"},b.tsx("select",{"aria-controls":f,"aria-label":h.selectFormat,class:this.classes("esri-select","esri-coordinate-conversion__select-row"),bind:this,"data-index":c,onchange:this._addConversion,title:h.selectFormat},b.tsx("option",{"aria-label":a.format.name,selected:!0,title:a.format.name},a.format.name.toUpperCase()),v),g,e):null};c.prototype._renderCopyButton=function(a){return b.tsx("li",
{"aria-label":this.messagesCommon.copy,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__row-button"),"data-conversion":a,onclick:this._copyCoordinateOutput,onkeydown:this._copyCoordinateOutput,oncopy:this._onCopy,role:"button",tabindex:"0",title:this.messagesCommon.copy},b.tsx("span",{"aria-hidden":"true",class:"esri-icon-duplicate"}))};c.prototype._renderFirstConversion=function(a){var c,d=this.id,f=(c={},c["esri-icon-down"]=!this._expanded,c["esri-icon-up"]=this._expanded,
c);c=this.messages;var k=this.messagesCommon;c="live"===this.mode?c.captureMode:c.liveMode;k=this._expanded?k.collapse:k.expand;a=a.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(a):null;d=this.multipleConversions?b.tsx("li",{"aria-controls":d+"__esri-coordinate-conversion__conversion-list","aria-label":k,bind:this,class:"esri-widget--button",key:"esri-coordinate-conversion__expand-button",onclick:this._toggleExpand,onkeydown:this._toggleExpand,role:"button",tabindex:"0",title:k},
b.tsx("span",{"aria-hidden":"true",class:this.classes(f)})):b.tsx("li",{"aria-label":c,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__mode-toggle"),key:"esri-coordinate-conversion__mode-toggle",onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",tabindex:"0",title:c},b.tsx("span",{"aria-hidden":"true",class:"esri-icon-map-pin"}));return b.tsx("ul",{class:"esri-coordinate-conversion__tools"},a,d)};c.prototype._renderInputForm=function(){var a,c=this._conversionFormat||
this.conversions.getItemAt(0).format,d=this.formats.findIndex(function(a){return a.name===c.name}),f=this.id,k=f+"__esri-coordinate-conversion__input-coordinate",f=f+"__esri-coordinate-conversion__input-coordinate__header",d=this._renderOptions(this.formats,!0,d),g=(a={},a["esri-coordinate-conversion__input-coordinate--rejected"]=this._badInput,a);a=this.messages;var e=this.messagesCommon;return b.tsx("div",{"aria-labelledby":f,class:"esri-coordinate-conversion__input-form",key:"esri-coordinate-conversion__input-form",
role:"search"},b.tsx("div",{class:"esri-coordinate-conversion__heading"},b.tsx("div",{"aria-label":e.back,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__back-button"),onclick:this._toggleInputVisibility,onkeydown:this._toggleInputVisibility,role:"button",tabindex:"0",title:e.back},b.tsx("span",{"aria-hidden":"true",class:"esri-icon-left-arrow"})),b.tsx("h4",{class:"esri-widget__heading",id:f},a.inputCoordTitle)),b.tsx("div",{class:"esri-coordinate-conversion__input-group"},
b.tsx("select",{"aria-controls":k,"aria-label":a.selectFormat,bind:this,class:this.classes("esri-select","esri-coordinate-conversion__select-row"),onchange:this._setInputFormat,title:a.selectFormat},d),b.tsx("input",{afterCreate:b.storeNode,"aria-labelledby":f,"aria-required":"true",bind:this,class:this.classes("esri-coordinate-conversion__input-coordinate","esri-input",g),"data-format":c,"data-node-ref":"_coordinateInput",id:k,onkeydown:this._processUserInput,placeholder:a.inputCoordTitle,role:"textbox",
spellcheck:!1,title:a.inputCoordTitle,type:"text"})),b.tsx("div",{class:"esri-coordinate-conversion__input-group"},b.tsx("label",{"aria-label":a.goTo},b.tsx("input",{bind:this,checked:this._goToEnabled,onclick:this._toggleGoTo,title:a.goTo,type:"checkbox"}),a.goTo),b.tsx("button",{"aria-label":a.convert,bind:this,class:this.classes("esri-coordinate-conversion__button","esri-button"),onclick:this._processUserInput,title:a.convert,type:"button"},a.convert)))};c.prototype._renderConversionsView=function(){var a,
c=this,d=this.id+"__esri-coordinate-conversion__conversion-list",f=this._renderPrimaryTools(),k=this._renderOptions(this.formats),g=this.conversions.map(function(a,b){return c._renderConversion(a,b)}).toArray(),e=this.messages,f=this._expanded?b.tsx("div",{class:"esri-coordinate-conversion__row"},b.tsx("select",{"aria-controls":d,"aria-label":e.addConversion,bind:this,class:this.classes("esri-select","esri-coordinate-conversion__select-primary"),onchange:this._addConversion,title:e.addConversion},
b.tsx("option",{disabled:!0,selected:!0,value:""},e.addConversion),k),f):null,k=(a={},a["esri-coordinate-conversion__conversions-view--expanded"]=this._expanded,a["esri-coordinate-conversion__conversions-view--expand-up"]="expand-up"===this.orientation,a["esri-coordinate-conversion__conversions-view--expand-down"]="expand-down"===this.orientation,a);return b.tsx("div",{class:this.classes("esri-coordinate-conversion__conversions-view",k),key:"esri-coordinate-conversion__main-view"},b.tsx("ul",{"aria-expanded":this._expanded?
"true":"false",class:"esri-coordinate-conversion__conversion-list",id:d},g),f)};c.prototype._renderOptions=function(a,c,d){var h=this,k=this.conversions.getItemAt(0);return a.map(function(a,f){var e=c||!k?!1:k.format.name===a.name||h.conversions.map(function(a){return a.format.name}).includes(a.name);return b.tsx("option",{"aria-label":a.name,"data-format":a,disabled:e,key:a.name,selected:f===d,value:a.name},a.name.toUpperCase())}).toArray()};c.prototype._renderPopup=function(){return b.tsx("div",
{class:"esri-coordinate-conversion__popup",role:"alert"},this._popupMessage)};c.prototype._renderPrimaryTools=function(){var a=this.messages,c="live"===this.mode?a.captureMode:a.liveMode;return b.tsx("ul",{class:"esri-coordinate-conversion__tools"},b.tsx("li",{bind:this,class:"esri-widget--button",onclick:this._toggleInputVisibility,onkeydown:this._toggleInputVisibility,role:"button",tabindex:"0",title:a.inputCoordTitle},b.tsx("span",{"aria-hidden":"true",class:"esri-icon-edit"})),b.tsx("li",{bind:this,
class:this.classes("esri-widget--button","esri-coordinate-conversion__mode-toggle"),onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",tabindex:"0",title:c},b.tsx("span",{"aria-hidden":"true",class:"esri-icon-map-pin"})),b.tsx("li",{bind:this,class:"esri-widget--button",onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,role:"button",tabindex:"0",title:a.settingsTitle},b.tsx("span",{"aria-hidden":"true",class:"esri-icon-settings2"})))};c.prototype._renderSettings=
function(){var a=this.id,c=a+"__esri-coordinate-conversion__pattern-input",d=a+"__esri-coordinate-conversion__pattern-input__header",a=a+"__esri-coordinate-conversion__preview-coordinate",f=this.formats.filter(function(a){return a.hasDisplayProperties}),e=this._findSettingsFormat(),g=f.indexOf(e),f=this._renderOptions(f,!0,g),e=e.get("currentPattern"),g=this.messages,l=this.messagesCommon;return b.tsx("div",{"aria-labelledby":d,class:"esri-coordinate__settings",key:"esri-coordinate-conversion__settings"},
b.tsx("div",{class:"esri-coordinate-conversion__heading"},b.tsx("div",{bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__back-button"),onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,role:"button",tabindex:"0",title:l.back},b.tsx("span",{"aria-hidden":"true",class:"esri-icon-left-arrow"})),b.tsx("h4",{class:"esri-widget__heading",id:d},g.settingsTitle)),b.tsx("div",{class:"esri-coordinate-conversion__settings-group"},b.tsx("label",{for:c},
g.changeCoordinateDisplay),b.tsx("select",{"aria-label":g.selectFormat,class:"esri-select",bind:this,onchange:this._setSettingsFormat,title:g.selectFormat},f),b.tsx("div",{class:"esri-coordinate-conversion__settings-group-horizontal"},b.tsx("input",{"aria-controls":a,bind:this,class:this.classes("esri-coordinate-conversion__pattern-input","esri-input"),id:c,oninput:this._updateCurrentPattern,spellcheck:!1,title:g.changeCoordinateDisplay,type:"text",value:e}),b.tsx("div",{"aria-controls":c,bind:this,
class:"esri-widget--button",onclick:this._setDefaultPattern,onkeydown:this._setDefaultPattern,role:"button",tabindex:"0",title:g.defaultPattern},b.tsx("span",{"aria-hidden":"true",class:"esri-icon-refresh"})))),b.tsx("div",{class:"esri-coordinate-conversion__settings-group"},b.tsx("label",null,l.preview,b.tsx("div",{class:"esri-coordinate-conversion__preview-coordinate",id:a,tabindex:"0"},this._previewConversion.displayCoordinate))))};c.prototype._renderTools=function(a,c,d){c=c.displayCoordinate&&
"capture"===this.mode?this._renderCopyButton(c):null;var e=this.messages;return b.tsx("ul",{class:"esri-coordinate-conversion__tools",role:"listitem"},c,b.tsx("li",{"aria-controls":d,"aria-label":e.removeConversion,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__row-button"),"data-index":a,key:d+"__esri-widget--button",onclick:this._removeConversion,onkeydown:this._removeConversion,tabindex:"0",role:"button",title:e.removeConversion},b.tsx("span",{"aria-hidden":"true",
class:"esri-icon-close"})))};c.prototype._copyCoordinateOutput=function(a){a=a.target;if(!("createTextRange"in document.body)){var b=window.getSelection(),c=document.createRange();c.selectNodeContents(a);b.removeAllRanges();b.addRange(c)}document.execCommand("copy")};c.prototype._removeConversion=function(a){this.conversions.removeAt(a.currentTarget["data-index"])};c.prototype._setDefaultPattern=function(a){a.stopPropagation();if(a=this._findSettingsFormat())a.currentPattern=a.get("defaultPattern")};
c.prototype._toggleExpand=function(){this._expanded=!this._expanded};c.prototype._toggleInputVisibility=function(){this._inputVisible=!this._inputVisible;this._popupVisible&&this._hidePopup();this._inputVisible?this.viewModel.pause():this.viewModel.resume()};c.prototype._toggleMode=function(){this.mode="live"===this.mode?"capture":"live"};c.prototype._toggleSettingsVisibility=function(){this._settingsVisible=!this._settingsVisible;this._popupVisible&&this._hidePopup();this._settingsVisible?(this._setPreviewConversion(),
this.viewModel.pause()):this.viewModel.resume()};d.__decorate([e.aliasOf("viewModel.conversions")],c.prototype,"conversions",void 0);d.__decorate([e.aliasOf("viewModel.currentLocation"),b.renderable()],c.prototype,"currentLocation",void 0);d.__decorate([e.aliasOf("viewModel.formats"),b.renderable()],c.prototype,"formats",void 0);d.__decorate([e.aliasOf("viewModel.goToOverride")],c.prototype,"goToOverride",void 0);d.__decorate([e.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],
c.prototype,"label",void 0);d.__decorate([e.property(),b.renderable(),b.messageBundle("esri/widgets/CoordinateConversion/t9n/CoordinateConversion")],c.prototype,"messages",void 0);d.__decorate([e.property(),b.renderable(),b.messageBundle("esri/t9n/common")],c.prototype,"messagesCommon",void 0);d.__decorate([e.aliasOf("viewModel.mode"),b.renderable()],c.prototype,"mode",void 0);d.__decorate([e.property(),b.renderable()],c.prototype,"orientation",void 0);d.__decorate([e.aliasOf("viewModel.requestDelay")],
c.prototype,"requestDelay",void 0);d.__decorate([e.property(),b.renderable()],c.prototype,"multipleConversions",null);d.__decorate([e.aliasOf("viewModel.locationSymbol")],c.prototype,"locationSymbol",void 0);d.__decorate([e.aliasOf("viewModel.view"),b.renderable()],c.prototype,"view",void 0);d.__decorate([e.property({type:m}),b.renderable(["viewModel.state","viewModel.waitingForConversions"])],c.prototype,"viewModel",void 0);d.__decorate([b.accessibleHandler()],c.prototype,"_copyCoordinateOutput",
null);d.__decorate([b.accessibleHandler()],c.prototype,"_removeConversion",null);d.__decorate([b.accessibleHandler()],c.prototype,"_setDefaultPattern",null);d.__decorate([b.accessibleHandler()],c.prototype,"_toggleExpand",null);d.__decorate([b.accessibleHandler()],c.prototype,"_toggleInputVisibility",null);d.__decorate([b.accessibleHandler()],c.prototype,"_toggleMode",null);d.__decorate([b.accessibleHandler()],c.prototype,"_toggleSettingsVisibility",null);return c=d.__decorate([e.subclass("esri.widgets.CoordinateConversion")],
c)}(u)});