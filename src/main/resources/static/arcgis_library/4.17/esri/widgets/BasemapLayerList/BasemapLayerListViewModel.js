// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Collection ../../core/Evented ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ../LayerList/ListItem".split(" "),function(t,u,f,p,q,r,h,g,l){var k=p.ofType(l);return function(m){function b(a){a=m.call(this,a)||this;a.baseItems=new k;a.baseListItemCreatedFunction=null;a.referenceListItemCreatedFunction=null;a.referenceItems=new k;a.view=null;a._compileBaseList=a._compileBaseList.bind(a);a._compileReferenceList=a._compileReferenceList.bind(a);
return a}f.__extends(b,m);b.prototype.initialize=function(){var a=this;this.handles.add(h.init(this,["view.map.basemap","view","view.ready","view.basemapView"],function(){return a._watchBasemapLayers()}),"view")};b.prototype.destroy=function(){this.view=null;this.baseItems.removeAll();this.referenceItems.removeAll()};Object.defineProperty(b.prototype,"basemapTitle",{get:function(){return this.get("view.map.basemap.title")||null},set:function(a){void 0===a?this._clearOverride("basemapTitle"):this._override("basemapTitle",
a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){return this.get("view.ready")?"ready":this.get("view")?"loading":"disabled"},enumerable:!1,configurable:!0});b.prototype.triggerAction=function(a,d){a&&!a.disabled&&this.emit("trigger-action",{action:a,item:d})};b.prototype.transferListItem=function(a){var d=a.listItem,c=a.from,e=a.to;a=a.newIndex;var b=this.referenceItems,f=this.baseItems,n=d.layer,g=this.get("view.map.basemap.baseLayers"),h=this.get("view.map.basemap.referenceLayers");
if(g&&h&&c!==e){var k="reference"===e?b:f,l="reference"===c?h:g,e="reference"===e?h:g;("reference"===c?b:f).remove(d);l.remove(n);k.add(d,a);e.add(n,a)}};b.prototype._createItemChangeHandles=function(a){var d=a.items,c=a.key,e=a.callback;a=this.handles;a.remove(c);e();d&&a.add(d.on("change",function(){return e()}),c)};b.prototype._watchItemProperties=function(a){var d=this,c=a.item,e=a.type;this.handles.add([c.children.on("change",function(){d._modifyListItemChildren({type:e,childItems:c.children})})],
"children-change-"+c.uid)};b.prototype._modifyListItemChildren=function(a){var d=this,c=a.type;a.childItems.forEach(function(a){return d._modifyListItem({type:c,item:a})})};b.prototype._modifyListItem=function(a){var d=a.item;a=a.type;var c={item:d};"base"===a&&"function"===typeof this.baseListItemCreatedFunction&&this.baseListItemCreatedFunction.call(null,c);"reference"===a&&"function"===typeof this.referenceListItemCreatedFunction&&this.referenceListItemCreatedFunction.call(null,c);this._modifyListItemChildren({type:a,
childItems:d.children})};b.prototype._createListItem=function(a){var d=a.type;a=new l({layer:a.layer,view:this.view});this._watchItemProperties({type:d,item:a});return a};b.prototype._watchLayersListMode=function(a){var d=a.layers,c=a.key,b=a.callback,f=this.handles;f.remove(c);d&&d.forEach(function(a){f.add(h.watch(a,"listMode",function(){return b()}),c)})};b.prototype._compileListItems=function(a){var d=a.layers,c=a.items,b=a.type;this._watchLayersListMode({layers:d,key:a.key,callback:a.callback});
this._createNewItems({type:b,items:c,layers:d});this._modifyOrRemoveItems({type:b,items:c,layers:d});this._sortItems(c,d)};b.prototype._compileReferenceList=function(){var a=this.referenceItems,b=this.get("view.map.basemap.referenceLayers");this._compileListItems({type:"reference",layers:b,items:a,key:"base-layers-list-mode",callback:this._compileReferenceList})};b.prototype._compileBaseList=function(){var a=this.baseItems,b=this.get("view.map.basemap.baseLayers");this._compileListItems({type:"base",
layers:b,items:a,key:"reference-layers-list-mode",callback:this._compileBaseList})};b.prototype._compileLists=function(){this._compileReferenceList();this._compileBaseList()};b.prototype._createNewItems=function(a){var b=this,c=a.items,e=a.layers,f=a.type;e&&e.forEach(function(a){c.find(function(b){return b.layer===a})||c.add(b._createListItem({type:f,layer:a}))})};b.prototype._modifyOrRemoveItems=function(a){var b=this,c=a.items,e=a.layers,f=a.type,g=this.handles;c&&c.forEach(function(a){a&&(e&&
e.find(function(b){return a.layer===b})?b._modifyListItem({type:f,item:a}):(g.remove("children-change-"+a.uid),c.remove(a)))})};b.prototype._sortItems=function(a,b){a&&a.sort(function(a,e){a=b.indexOf(a.layer);e=b.indexOf(e.layer);return a>e?-1:a<e?1:0})};b.prototype._watchBasemapLayers=function(){var a=this,b=this.handles,c=this.view;b.remove(["base-layers","reference-layers","basemap","base-layer-views","reference-layer-views"]);this._compileLists();c&&c.ready&&b.add([h.init(this,"view.map.basemap.baseLayers",
function(b){return a._createItemChangeHandles({items:b,key:"base-layers",callback:a._compileBaseList})}),h.init(this,"view.map.basemap.referenceLayers",function(b){return a._createItemChangeHandles({items:b,key:"reference-layers",callback:a._compileReferenceList})}),h.init(this,"view.basemapView.baseLayerViews",function(b){return a._createItemChangeHandles({items:b,key:"base-layer-views",callback:a._compileBaseList})}),h.init(this,"view.basemapView.referenceLayerViews",function(b){return a._createItemChangeHandles({items:b,
key:"reference-layer-views",callback:a._compileReferenceList})}),h.init(this,"baseListItemCreatedFunction",function(){return a._compileBaseList()}),h.init(this,"referenceListItemCreatedFunction",function(){return a._compileReferenceList()})],"basemap")};f.__decorate([g.property({type:k})],b.prototype,"baseItems",void 0);f.__decorate([g.property({dependsOn:["view","view.map","view.map.basemap","view.map.basemap.title"]})],b.prototype,"basemapTitle",null);f.__decorate([g.property()],b.prototype,"baseListItemCreatedFunction",
void 0);f.__decorate([g.property()],b.prototype,"referenceListItemCreatedFunction",void 0);f.__decorate([g.property({type:k})],b.prototype,"referenceItems",void 0);f.__decorate([g.property({dependsOn:["view.ready"],readOnly:!0})],b.prototype,"state",null);f.__decorate([g.property()],b.prototype,"view",void 0);f.__decorate([g.property()],b.prototype,"transferListItem",null);return b=f.__decorate([g.subclass("esri.widgets.BasemapLayerList.BasemapLayerListViewModel")],b)}(r.HandleOwnerMixin(q.EventedAccessor))});