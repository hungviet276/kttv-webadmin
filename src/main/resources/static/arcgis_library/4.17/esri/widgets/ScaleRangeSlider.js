// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../intl ../core/domUtils ../core/events ../core/HandleOwner ../core/watchUtils ../core/accessorSupport/decorators ./Slider ./Widget ./ScaleRangeSlider/scalePreviewUtils ./ScaleRangeSlider/ScaleRanges ./ScaleRangeSlider/ScaleRangeSliderViewModel ./support/Popover ./support/widget".split(" "),function(C,D,d,n,w,l,x,m,f,y,z,r,p,A,q,e){var t={preview:!0},u={maximumFractionDigits:0};return function(v){function a(c,a){var b=v.call(this,c,a)||this;b._activeMenu=null;b._activeMenuNode=
null;b._activeMenuToggleNode=null;b._activeThumb=null;b._customMaxScale=-1;b._customMinScale=-1;b._focusedMenuItemIndex=-1;b._previewAutoCloseTimeoutId=null;b._previewPopover=new q({owner:b,placement:"top",anchorElement:function(){return 0===b._activeThumb?b._minThumbNode:b._maxThumbNode},offset:[0,16],renderContentFunction:b.renderScalePreview});b._maxScaleMenuPopover=new q({owner:b,placement:"bottom-end",anchorElement:function(){return b._activeMenuToggleNode},renderContentFunction:b.renderMaxScaleMenu});
b._minScaleMenuPopover=new q({owner:b,placement:"bottom-start",anchorElement:function(){return b._activeMenuToggleNode},renderContentFunction:b.renderMinScaleMenu});b._scaleMenuNode=null;b._slider=new y({thumbCreatedFunction:function(c,a,g){0===c&&(b._minThumbNode=g);1===c&&(b._maxThumbNode=g);b.own([l.on(g,"mouseenter",function(){var a=b.visibleElements.preview;b._activeThumb=c;b._previewPopover.open=a;b.scheduleRender()}),l.on(g,"mouseleave",function(){b._previewAutoCloseTimeoutId||(b._activeThumb=
null,b._previewPopover.open=!1,b.scheduleRender())})])}});b.disabled=!1;b.label=void 0;b.layer=null;b.maxScale=null;b.maxScaleLimit=null;b.messages=null;b.minScale=null;b.minScaleLimit=null;b.region="US";b.view=null;b.viewModel=new A;b.visibleElements=t;b._handleScaleMenuToggleClick=function(c){c=c.currentTarget;var a=c.getAttribute("data-type");b.handles.remove("menu-closing-click-handle");a===b._activeMenu?(b._setActiveMenu(null),b._activeMenuToggleNode=null):(b._setActiveMenu(a),b._activeMenuToggleNode=
c,b.handles.add(l.on(document,"mousedown",function(c){c=c.target;var a=w.closest(c,".esri-scale-range-slider__scale-menu-toggle"),g=a&&a.getAttribute("data-type");a&&g===b._activeMenu||g||!b._scaleMenuNode||b._scaleMenuNode.contains(c)||(b._setActiveMenu(null),b.handles.remove("menu-closing-click-handle"),b.scheduleRender())}),"menu-closing-click-handle"))};b._afterMenuListCreate=function(c){b._activeMenuNode=c;c.children[0].focus({preventScroll:!0})};b._handleCustomScaleEntry=function(c){b._setScaleFromMenuSelection(c);
b._customMaxScale=-1;b._customMinScale=-1};b._handleCustomScaleInputBlur=function(){"max"===b._activeMenu?b._customMaxScale=-1:b._customMinScale=-1};b.handleCustomScaleInputKeyDown=function(c){var a=c.currentTarget,g=a["data-render-props"].handleCustomScaleSelect,e=c.key,B=c.ctrlKey,d=c.metaKey,f=b.viewModel.scaleRanges;"Enter"===e?(a=a.value.replace(/.*\(/,"").replace(/\).*$/,"").replace(/.*:/,"").replace(/[^\d.\s]/g,""),a=parseFloat(a),g(isNaN(a)?-1:f.clampScale(a)),c.preventDefault(),c.stopPropagation()):
1<e.length||B||d||/[:,.\d]/.test(e)||(c.preventDefault(),c.stopPropagation())};b._handleScaleMenuKeyDown=function(c){var a=l.eventKey(c);if("Escape"===a||"Tab"===a)b._setActiveMenu(null),b._activeMenuToggleNode.focus();else if("ArrowUp"===a||"ArrowDown"===a){var g=b._activeMenuNode.children,e=b._focusedMenuItemIndex,a="ArrowUp"===a?(0===e?g.length:e)-1:(e+1)%g.length;c.preventDefault();c.stopPropagation();g[a].focus();b._focusedMenuItemIndex=a}};return b}d.__extends(a,v);a.prototype.initialize=function(){var c=
this;this.own([m.init(this,"viewModel",function(a){return c._slider.viewModel=a?a.sliderViewModel:null}),m.init(this,"_interactive",function(a){c._slider.disabled=!a;a||c._setActiveMenu(null)}),this._slider.on("thumb-drag",function(a){var b=c.visibleElements.preview;c._activeThumb=a.index;c._previewPopover.open=b;clearTimeout(c._previewAutoCloseTimeoutId);c._previewAutoCloseTimeoutId=setTimeout(function(){c._previewAutoCloseTimeoutId=null;c._activeThumb=null;c._previewPopover.open=!1;c.scheduleRender()},
250)}),m.whenTrue(this,"view.stationary",function(){return c.scheduleRender()})])};a.prototype.destroy=function(){this._previewPopover.destroy();this._previewPopover=null;this._maxScaleMenuPopover.destroy();this._maxScaleMenuPopover=null;this._minScaleMenuPopover.destroy();this._minScaleMenuPopover=null;this._slider.destroy();this._slider=null};Object.defineProperty(a.prototype,"_effectiveMaxScale",{get:function(){return 0===this.maxScale?this.maxScaleLimit:this.maxScale},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"_effectiveMinScale",{get:function(){return 0===this.minScale?this.minScaleLimit:this.minScale},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"_interactive",{get:function(){return"disabled"!==this.get("viewModel.state")&&!this.disabled},enumerable:!1,configurable:!0});a.prototype.castVisibleElements=function(c){return d.__assign(d.__assign({},t),c)};a.prototype.render=function(){var c=this._interactive,a=this._slider,b=this.label,d=this.messages,
f=this.view,h=this.viewModel,k=h.scaleRanges,h=h.state,l=d.scaleRangeLabels[k.findScaleRangeByIndex(a.values[0]).id],d=d.scaleRangeLabels[k.findScaleRangeByIndex(a.values[1]).id];a.layout=e.isRTL()?"horizontal-reversed":"horizontal";return e.tsx("div",{"aria-label":b,class:this.classes("esri-scale-range-slider","esri-widget",c?null:"esri-disabled")},"ready"===h&&f?this.renderCurrentScaleIndicator():null,a.render(),e.tsx("div",{class:"esri-scale-range-slider__scale-menu-container",key:"scale-menu-toggles"},
this.renderScaleMenuToggle("min",l),this.renderScaleMenuToggle("max",d)))};a.prototype.renderMinScaleMenu=function(){var c=this.view,c=c?c.scale:void 0;return this.renderScaleMenu({type:"min",min:this.minScaleLimit,max:this.viewModel.scaleRanges.findScaleRange(this._effectiveMaxScale).minScale,map:c})};a.prototype.renderMaxScaleMenu=function(){var c=this.maxScaleLimit,a=this.view,a=a?a.scale:void 0;return this.renderScaleMenu({type:"max",min:this.viewModel.scaleRanges.findScaleRange(this._effectiveMinScale).maxScale,
max:c,map:a})};a.prototype.renderScalePreview=function(){var c=this._slider,a=this.region,b=this.viewModel.scaleRanges,c=0===this._activeThumb?c.values[0]:c.values[1],b=Object.keys(p.RecommendedScales).indexOf(b.findScaleRangeByIndex(c).id),a={backgroundImage:r.getScalePreviewSource(a),backgroundPosition:r.getScalePreviewSpriteBackgroundPosition(b)};return e.tsx("div",{class:"esri-scale-range-slider__scale-preview"},e.tsx("div",{class:"esri-scale-range-slider__scale-preview-thumbnail",styles:a}))};
a.prototype.renderScaleMenu=function(c){var a=this,b=c.map,d=c.type,f=p.fromScaleRange({minScale:c.min,maxScale:c.max}),h=this.messages.featuredScaleLabels,k=p.RecommendedScales;c=Object.keys(k).filter(function(b){return f.contains(k[b])}).map(function(b){return a.renderScaleMenuItem({scaleLabel:h[b],scaleValue:k[b],valueVisible:"world"!==b,handleNamedScaleSelect:a._handleRecommendedScaleClick})});var l=this._customMaxScale,n=this._customMinScale,m=this.messages;return e.tsx("div",{bind:this,class:"esri-scale-range-slider__scale-menu",
"data-type":d,id:this.id+"__scale-menu--"+d,key:d+"-scale-menu",afterCreate:e.storeNode,"data-node-ref":"_scaleMenuNode",onkeydown:this._handleScaleMenuKeyDown},e.tsx("div",{class:"esri-scale-range-slider__scale-menu-scroller"},e.tsx("ul",{class:"esri-scale-range-slider__scale-menu-list",afterCreate:this._afterMenuListCreate},this.renderScaleMenuItem({scaleValue:"max"===d?l:n,scaleLabel:m.featuredScaleLabels.custom,valueVisible:!1,handleNamedScaleSelect:this._handleScaleSelection,handleCustomScaleSelect:this._handleCustomScaleEntry}),
null!=b?this.renderScaleMenuItem({scaleValue:b,scaleLabel:m.featuredScaleLabels.current,valueVisible:!0,handleNamedScaleSelect:this._handleRecommendedScaleClick}):null,c)))};a.prototype._handleScaleSelection=function(){"max"===this._activeMenu?this._customMaxScale=this._effectiveMaxScale:this._customMinScale=this._effectiveMinScale};a.prototype.renderScaleMenuToggle=function(c,a){var b=this._interactive,d=this._activeMenu===c;return e.tsx("button",{"aria-controls":d?this.id+"__scale-menu--"+c:"",
"aria-pressed":d?"true":"false",class:this.classes("esri-scale-range-slider__scale-menu-toggle",d?"esri-scale-range-slider__scale-menu-toggle--active":null),"data-type":c,key:c+"-scale-menu-toggle",onclick:this._handleScaleMenuToggleClick,disabled:!b,type:"button"},a,e.tsx("span",{class:this.classes("esri-scale-range-slider__scale-menu-toggle-icon","esri-icon-down"),"aria-hidden":"true"}))};a.prototype.renderScaleMenuItem=function(c){var a=c.scaleValue,b=c.scaleLabel,d=c.valueVisible,f=c.handleNamedScaleSelect,
h=c.handleCustomScaleSelect,h=void 0===h?null:h,k=this.id+"__custom-scale-input";return e.tsx("li",{bind:this,class:"esri-scale-range-slider__scale-menu-item","data-scale":a,key:b,onclick:f,onkeydown:f,tabIndex:-1},e.tsx("label",{class:"esri-scale-range-slider__scale-item-label",for:k},b),-1<a?h?e.tsx("input",{afterCreate:this.focusAndSelectInputOnCreate,class:this.classes("esri-scale-range-slider__scale-item-value","esri-scale-range-slider__scale-item-value--editable"),"data-render-props":c,id:k,
key:"value",value:"1:"+n.formatNumber(a,u),onkeydown:this.handleCustomScaleInputKeyDown,onblur:this._handleCustomScaleInputBlur}):d?e.tsx("div",{class:"esri-scale-range-slider__scale-item-value",key:"value"},"1:"+n.formatNumber(a,u)):null:null)};a.prototype.focusAndSelectInputOnCreate=function(a){a.focus();a.select()};a.prototype.renderCurrentScaleIndicator=function(){var a=this._slider,d=this.messages,b=this.viewModel.scaleRanges,f=b.clampScale(this.view.scale),f=this.viewModel.mapScaleToSlider(f),
a=f/a.max,b=d.scaleRangeLabels[b.findScaleRangeByIndex(f).id],d=n.substitute(d.currentScaleTooltip,{scaleLabel:b});return e.tsx("div",{class:"esri-scale-range-slider__scale-indicator-container",key:"scale-indicator"},e.tsx("div",{"aria-label":d,class:"esri-scale-range-slider__scale-indicator",styles:{left:(e.isRTL()?-1:1)*a*100+"%"},title:d},this.renderCurrentScaleIndicatorIcon()))};a.prototype.renderCurrentScaleIndicatorIcon=function(){return e.tsx("svg",{class:"esri-scale-range-slider__scale-indicator-icon",
height:"8",width:"8",viewBox:"0 0 8 8",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},e.tsx("polygon",{points:"4 0 8 8 0 8"}))};a.prototype._handleRecommendedScaleClick=function(a){this._setScaleFromMenuSelection(Number(a.currentTarget["data-scale"]))};a.prototype._setScaleFromMenuSelection=function(a){"max"===this._activeMenu?this.maxScale=Math.min(a,this._effectiveMinScale-1):this.minScale=Math.max(a,this._effectiveMaxScale+1);this._setActiveMenu(null)};a.prototype._setActiveMenu=function(a){this._activeMenu=
a;this._maxScaleMenuPopover.open="max"===a;this._minScaleMenuPopover.open="min"===a;this._focusedMenuItemIndex=a?0:-1};d.__decorate([f.property()],a.prototype,"_slider",void 0);d.__decorate([f.property({dependsOn:["viewModel.maxScaleLimit","viewModel.maxScale"]})],a.prototype,"_effectiveMaxScale",null);d.__decorate([f.property({dependsOn:["viewModel.minScaleLimit","viewModel.minScale"]})],a.prototype,"_effectiveMinScale",null);d.__decorate([f.property({dependsOn:["disabled","viewModel.state"],readOnly:!0})],
a.prototype,"_interactive",null);d.__decorate([f.property(),e.renderable()],a.prototype,"disabled",void 0);d.__decorate([f.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],a.prototype,"label",void 0);d.__decorate([f.property({aliasOf:"viewModel.layer"})],a.prototype,"layer",void 0);d.__decorate([f.property({aliasOf:"viewModel.maxScale"})],a.prototype,"maxScale",void 0);d.__decorate([f.property({aliasOf:"viewModel.maxScaleLimit"})],a.prototype,"maxScaleLimit",void 0);d.__decorate([f.property(),
e.renderable(),e.messageBundle("esri/widgets/ScaleRangeSlider/t9n/ScaleRangeSlider")],a.prototype,"messages",void 0);d.__decorate([f.property({aliasOf:"viewModel.minScale"})],a.prototype,"minScale",void 0);d.__decorate([f.property({aliasOf:"viewModel.minScaleLimit"})],a.prototype,"minScaleLimit",void 0);d.__decorate([f.property(),e.renderable()],a.prototype,"region",void 0);d.__decorate([f.property({aliasOf:"viewModel.view"})],a.prototype,"view",void 0);d.__decorate([f.property(),e.renderable("viewModel.state")],
a.prototype,"viewModel",void 0);d.__decorate([f.property(),e.renderable()],a.prototype,"visibleElements",void 0);d.__decorate([f.cast("visibleElements")],a.prototype,"castVisibleElements",null);d.__decorate([e.accessibleHandler()],a.prototype,"_handleScaleSelection",null);d.__decorate([e.accessibleHandler()],a.prototype,"_handleRecommendedScaleClick",null);return a=d.__decorate([f.subclass("esri.widgets.ScaleRangeSlider")],a)}(x.HandleOwnerMixin(z))});