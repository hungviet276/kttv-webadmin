// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../intl ../../../core/Handles ../../../core/screenUtils ../../../core/accessorSupport/decorators ../../../symbols/support/svgUtils ../../Widget ./support/utils ../support/styleUtils ../../support/widget".split(" "),function(D,E,r,y,z,w,t,A,B,C,u,f){var v=window.devicePixelRatio;return function(x){function e(a,c){a=x.call(this,a,c)||this;a._handles=new z;a._hasIndicators=!1;a._selectedSectionName=null;a._sectionNames=[];a._sectionMap=new Map;a.activeLayerInfos=null;
a.layout="stack";a.messages=null;a.messagesCommon=null;a.type="card";a.view=null;return a}r.__extends(e,x);e.prototype.initialize=function(){var a=this;this.own([this.watch("activeLayerInfos",function(c){a._handles.removeAll();a._watchForSectionChanges(c)})])};e.prototype.destroy=function(){this._handles.destroy();this._handles=null};e.prototype.render=function(){var a,c=this;this._hasIndicators="auto"===this.layout&&768>=this.view.container.clientWidth||"stack"===this.layout;var d=this.activeLayerInfos,
b=d&&d.toArray().map(function(a){return c._renderLegendForLayer(a)}).filter(function(a){return!!a});this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;var p=this._sectionNames.length,d=this._sectionNames.map(function(a,b){var d;b=y.substitute(c.messagesCommon.pagination.pageText,{index:b+1,total:p});return f.tsx("div",{key:a,"aria-label":b,title:b,
tabIndex:0,onclick:c._selectSection,onkeydown:c._selectSection,bind:c,class:c.classes("esri-legend--card__carousel-indicator",(d={},d["esri-legend--card__carousel-indicator--activated"]=c._selectedSectionName===a,d)),"data-section-name":a})}),d=this._hasIndicators&&1<p?f.tsx("div",{class:"esri-legend--card__carousel-indicator-container",key:"carousel-navigation"},d):null,b=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):b&&b.length?b:null,k=(a={},a["esri-legend--stacked"]=this._hasIndicators,
a);return f.tsx("div",{class:this.classes("esri-legend--card",k)},d,b?b:f.tsx("div",{class:"esri-legend--card__message"},this.messages.noLegend))};e.prototype._selectSection=function(a){if(a=a.target.getAttribute("data-section-name"))this._selectedSectionName=a};e.prototype._watchForSectionChanges=function(a){var c=this;this._generateSectionNames();a&&(a.forEach(function(a){var b="activeLayerInfo-"+a.layer.uid+"-version-change";c._handles.remove(b);c._watchForSectionChanges(a.children);c._handles.add(a.watch("version",
function(){return c._generateSectionNames()}),b)}),this._handles.remove("activeLayerInfos-collection-change"),this._handles.add(a.on("change",function(){return c._watchForSectionChanges(a)}),"activeLayerInfos-collection-change"))};e.prototype._generateSectionNames=function(){this._sectionNames.length=0;this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)};e.prototype._generateSectionNamesForActiveLayerInfo=function(a){var c=this;a.children.forEach(this._generateSectionNamesForActiveLayerInfo,
this);a.legendElements&&a.legendElements.forEach(function(d,b){c._sectionNames.push("esri-legend--card__"+a.layer.uid+"-type-"+d.type+"-"+b)})};e.prototype._renderLegendForLayer=function(a){var c,d=this;if(!a.ready)return null;if(a.children.length)return c=a.children.map(function(a){return d._renderLegendForLayer(a)}).toArray(),f.tsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},f.tsx("div",{class:"esri-legend--card__service-caption-container"},
a.title),c);var b=a.legendElements;if(b&&!b.length)return null;var p=b.some(function(a){return"relationship-ramp"===a.type}),b=b.map(function(b,c){return d._renderLegendForElement(b,a,c,p)}).filter(function(a){return!!a});if(!b.length)return null;var k=(c={},c["esri-legend--card__group-layer-child"]=!!a.parent,c);return f.tsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service",k)},f.tsx("div",{class:"esri-legend--card__service-caption-container"},f.tsx("div",{class:"esri-legend--card__service-caption-text"},
a.title)),f.tsx("div",{class:"esri-legend--card__service-content"},b))};e.prototype._renderLegendForElement=function(a,c,d,b){var p,k=this;void 0===b&&(b=!1);var h="color-ramp"===a.type,g="opacity-ramp"===a.type,l="size-ramp"===a.type,e=c.layer,n=a.title,m=null;"string"===typeof n?m=n:n&&(m=u.getTitle(this.messages,n,h||g),m=n.title?n.title+" ("+m+")":m);d="esri-legend--card__"+e.uid+"-type-"+a.type+"-"+d;n=this._hasIndicators?f.tsx("div",null,f.tsx("h3",{class:this.classes("esri-widget__heading",
"esri-legend--card__carousel-title")},c.title),f.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},m)):m?f.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},m):null;m=null;"symbol-table"===a.type?(l=a.infos.map(function(b,d){return k._renderLegendForElementInfo(b,c,a.legendType,d)}).filter(function(a){return!!a}),l.length&&(e=l[0].properties.classes&&l[0].properties.classes["esri-legend--card__symbol-row"],b=(p={},p["esri-legend--card__label-container"]=
!e&&!b,p["esri-legend--card__relationship-label-container"]=b,p),m=f.tsx("div",{key:d,class:"esri-legend--card__section"},n,f.tsx("div",{class:this.classes(b)},l)))):"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?m=f.tsx("div",{key:d,class:"esri-legend--card__section"},n,this._renderLegendForRamp(a,e.opacity)):l?m=f.tsx("div",{key:d,class:"esri-legend--card__section"},n,this._renderSizeRamp(a,e.opacity)):"relationship-ramp"===a.type&&(m=f.tsx("div",{key:d,class:this.classes("esri-legend--card__section",
"esri-legend--card__relationship-section")},n,C.renderRelationshipRamp(a,this.id,e.opacity)));if(!m)return null;this._sectionMap.set(d,m);return m};e.prototype._renderLegendForElementInfo=function(a,c,d,b){var p,k,h,g,e,q=c.layer;if(a.type)return this._renderLegendForElement(a,c,b);c=u.isImageryStretchedLegend(q,d);if(a.symbol&&a.preview){if(-1===a.symbol.type.indexOf("simple-fill")){if(!a.label)return f.tsx("div",{key:b,bind:a.preview,afterCreate:u.attachToNode});g=(p={},p["esri-legend--card__symbol-cell"]=
this._hasIndicators,p);return f.tsx("div",{key:b,class:this.classes("esri-legend--card__layer-row",(k={},k["esri-legend--card__symbol-row"]=this._hasIndicators,k))},f.tsx("div",{class:this.classes(g),bind:a.preview,afterCreate:u.attachToNode}),f.tsx("div",{class:this.classes("esri-legend--card__image-label",(h={},h["esri-legend--card__label-cell"]=this._hasIndicators,h))},u.getTitle(this.messages,a.label,!1)||""))}h=k=p=255;c=0;var n=d=255,m=255,r=0,t=a.symbol.color&&a.symbol.color.a,v=a.symbol.outline&&
a.symbol.outline.color&&a.symbol.outline.color.a;t&&(p=a.symbol.color.r,k=a.symbol.color.g,h=a.symbol.color.b,c=a.symbol.color.a*q.opacity);v&&(d=a.symbol.outline.color.r,n=a.symbol.outline.color.g,m=a.symbol.outline.color.b,r=a.symbol.outline.color.a*q.opacity);g=(q=null!==(e=null===(g=a.symbol.color)||void 0===g?void 0:g.isBright)&&void 0!==e?e:!0)?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return f.tsx("div",{key:b,class:"esri-legend--card__layer-row"},f.tsx("div",{class:"esri-legend--card__label-element",
styles:{background:t?"rgba("+p+", "+k+", "+h+", "+c+")":"none",color:q?"black":"white",textShadow:"-1px -1px 0 "+g+",\n                                              1px -1px 0 "+g+",\n                                              -1px 1px 0 "+g+",\n                                              1px 1px 0 "+g,border:v?"1px solid rgba("+d+", "+n+", "+m+", "+r+")":"none"}}," ",a.label," "))}if(a.src)return g=this._renderImage(a,q,c),f.tsx("div",{key:b,class:"esri-legend--card__layer-row"},g,f.tsx("div",
{class:"esri-legend--card__image-label"},a.label||""))};e.prototype._renderImage=function(a,c,d){var b,e=a.label,k=a.src,h=a.opacity;d=(b={},b["esri-legend--card__imagery-layer-image--stretched"]=d,b["esri-legend--card__symbol"]=!d,b);c={opacity:""+(null!=h?h:c.opacity)};return f.tsx("img",{alt:u.getTitle(this.messages,e,!1),src:k,border:0,width:a.width,height:a.height,class:this.classes(d),styles:c})};e.prototype._renderSizeRampLines=function(a){a=a.infos;var c=a[0],d=a[a.length-1],b=c.symbol;a=
this._hasIndicators;var c=w.pt2px(c.size+c.outlineSize)*v,d=w.pt2px(d.size+d.outlineSize)*v,e=a?c:c+50*v,k=a?c/2+50*v:c,h;b?-1<b.type.indexOf("3d")?(h=b.symbolLayers&&b.symbolLayers.length)?(h=b.symbolLayers.getItemAt(h-1).get("resource.primitive"),h="triangle"===h||"cone"===h||"tetrahedron"===h):h=void 0:h="triangle"===b.style:h=void 0;if(b)if(-1<b.type.indexOf("3d")){var g=b.symbolLayers&&b.symbolLayers.length;g?(b=b.symbolLayers.getItemAt(g-1),b=b.resource&&b.resource.primitive,b="circle"===b||
"cross"===b||"kite"===b||"sphere"===b||"cube"===b||"diamond"===b):b=void 0}else b=b.style,b="circle"===b||"diamond"===b||"cross"===b;else b=void 0;g=document.createElement("canvas");g.width=e;g.height=k;g.style.width=g.width/v+"px";g.style.height=g.height/v+"px";var l=g.getContext("2d");if(a){l.beginPath();var q=e/2-d/2;l.moveTo(0,0);l.lineTo(q,k);q=e/2+d/2;l.moveTo(e,0);l.lineTo(q,k)}else l.beginPath(),l.moveTo(0,k/2-d/2),l.lineTo(e,0),l.moveTo(0,k/2+d/2),l.lineTo(e,k);l.strokeStyle="#ddd";l.stroke();
return f.tsx("div",{bind:g,afterCreate:u.attachToNode,styles:a?{display:"flex",marginTop:"-"+(h?0:b?c/2:0)+"px",marginBottom:"-"+(h?d:b?d/2:0)+"px"}:{display:"flex",marginRight:"-"+(h?0:b?c/2:0)+"px",marginLeft:"-"+(h?0:b?d/2:0)+"px"}})};e.prototype._renderSizeRamp=function(a,c){var d,b=a.infos,e=b[0].label,k=b[b.length-1].label,h=b[0].preview,b=b[b.length-1].preview,g=this._hasIndicators,l={"flex-direction":g?"column":"row-reverse"};h&&(h=h.cloneNode(!0),h.style.display="flex");b&&(b=b.cloneNode(!0),
b.style.display="flex");c={opacity:null!=c?""+c:""};return f.tsx("div",{class:this.classes("esri-legend--card__layer-row",(d={},d["esri-legend--card__size-ramp-row"]=g,d))},f.tsx("div",{class:"esri-legend--card__ramp-label"},g?e:k),f.tsx("div",{class:"esri-legend--card__size-ramp-container",styles:l},f.tsx("div",{bind:h,afterCreate:u.attachToNode,class:"esri-legend--card__size-ramp-preview",styles:c}),this._renderSizeRampLines(a),f.tsx("div",{bind:b,afterCreate:u.attachToNode,class:"esri-legend--card__size-ramp-container",
styles:c})),f.tsx("div",{class:"esri-legend--card__ramp-label"},g?k:e))};e.prototype._renderLegendForRamp=function(a,c){var d=a.infos,b="heatmap-ramp"===a.type,e=d.length-1,k=2<e&&!b?25*e:100,h=k+20,g=d.slice(0).reverse();g.forEach(function(a,c){a.offset=b?a.ratio:c/e});var l=g.length-1;a=(a=0!==g.length%2&&g[g.length/2|0])&&f.tsx("div",{class:"esri-legend--card__interval-separators-container"},f.tsx("div",{class:"esri-legend--card__interval-separator"},"|"),f.tsx("div",{class:"esri-legend--card__ramp-label"},
a.label));var q=d[d.length-1].label,d=d[0].label,n=null;null!=c&&(n="opacity: "+c);c=A.renderSVG([[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:g[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:k,height:25},fill:{type:"linear",x1:10,y1:0,x2:k+10,y2:0,colors:g},stroke:{width:0}},{shape:{type:"path",path:"M"+(k+10)+" 0 L"+h+" 12.5 L"+(k+10)+" 25 Z"},fill:g[l].color,stroke:{width:0}}]],h,25);k=this.messages;return f.tsx("div",{class:"esri-legend--card__layer-row"},f.tsx("div",
{class:"esri-legend--card__ramp-label"},b?k[q]:q),f.tsx("div",{class:"esri-legend--card__symbol-container"},f.tsx("div",{style:n},c),a),f.tsx("div",{class:"esri-legend--card__ramp-label"},b?k[d]:d))};r.__decorate([f.renderable(),t.property()],e.prototype,"activeLayerInfos",void 0);r.__decorate([t.property()],e.prototype,"layout",void 0);r.__decorate([t.property(),f.renderable(),f.messageBundle("esri/widgets/Legend/t9n/Legend")],e.prototype,"messages",void 0);r.__decorate([t.property(),f.renderable(),
f.messageBundle("esri/t9n/common")],e.prototype,"messagesCommon",void 0);r.__decorate([t.property({readOnly:!0})],e.prototype,"type",void 0);r.__decorate([t.property()],e.prototype,"view",void 0);r.__decorate([f.accessibleHandler()],e.prototype,"_selectSection",null);return e=r.__decorate([t.subclass("esri.widgets.Legend.styles.Card")],e)}(B)});