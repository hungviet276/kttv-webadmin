// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/maybe ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./ElevationProfile/ElevationProfileViewModel ./ElevationProfile/Stats ./ElevationProfile/support/chartUtils ./support/widget".split(" "),function(x,y,b,f,k,l,d,u,m,v,w,e){var r={newProfileButton:!0,stats:!0};return function(t){function a(a,c){var q;c=t.call(this,a,c)||this;c.view=null;c.visibleElements=b.__assign({},r);c.iconClass="";c.label=void 0;c.messages=null;c.messagesCommon=
null;c.messagesUnits=null;c._chartContainer=null;c._chart=null;c._chartAbortController=null;c._defaultViewModel=new m({view:a.view});c.viewModel=null!==(q=a.viewModel)&&void 0!==q?q:c._defaultViewModel;return c}b.__extends(a,t);a.prototype.postInitialize=function(){var a=this;this.own([l.init(this,"_chartContainer",function(){return a._initializeChart()}),l.init(this,["viewModel.chartData","messages","messagesUnits"],function(){a._updateChart()})])};a.prototype.destroy=function(){this._destroyChart();
this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()};a.prototype._castVisibleElements=function(a){return b.__assign(b.__assign({},r),a)};a.prototype.render=function(){var a,c=this.viewModel,b=this.messages,d=this.messagesUnits,h=this.visibleElements,n=c.state,g=c.path,k=c.unit,l=f.isSome(g)?g.spatialReference:null,p="creating"===n,m="ready"===n||p&&f.isNone(g),h=(g="created"===n||p&&f.isSome(g))&&h.stats,p=1===c.profiles.length?this.profiles.getItemAt(0):null;return e.tsx("div",
{key:this,class:this.classes("esri-elevation-profile esri-widget--panel esri-widget",(a={},a["esri-widget--disabled"]="disabled"===n,a)),"aria-label":b.widgetLabel},this._renderProgressBar(c.updating,c.progress),this._renderHeader(),m&&this._renderNoPathMessage(),g&&this._renderChartContainer(),h&&v.renderStats({line:p,messages:b,messagesUnits:d,systemOrUnit:k,spatialReference:l}))};a.prototype._renderProgressBar=function(a,c){var b;return e.tsx("div",{key:"progress-bar",class:this.classes("esri-elevation-profile__progress-bar",
(b={},b["esri-elevation-profile__progress-bar--visible"]=a,b)),styles:{width:100*c+"%"},role:"presentation","aria-hidden":"true",title:this.messagesCommon.loading})};a.prototype._renderNoPathMessage=function(){return e.tsx("div",{key:"no-path-message",bind:this,class:"esri-elevation-profile__no-path-container"},e.tsx("p",null,this.messages.noPath))};a.prototype._renderChartContainer=function(){return e.tsx("div",{key:"chart-container",bind:this,class:"esri-elevation-profile__chart-container",afterCreate:this._onChartContainerCreate,
afterRemoved:this._onChartContainerRemoved})};a.prototype._renderHeader=function(){var a=this.messages;return e.tsx("div",{class:"esri-elevation-profile__header-container"},e.tsx("h4",{class:"esri-elevation-profile__header esri-widget__heading"},a.widgetLabel),e.tsx("button",{bind:this,class:"esri-elevation-profile__new-profile-button esri-button",onclick:this._onNewProfileClick},a.newProfile))};a.prototype._onNewProfileClick=function(){this.viewModel.start()};a.prototype._updateChart=function(){!f.isNone(this._chart)&&
this.messages&&this.messagesUnits&&this._chart.update({data:this.viewModel.chartData,messages:b.__assign(b.__assign({},this.messagesUnits),this.messages)})};a.prototype._onChartContainerCreate=function(a){this._chartContainer=a};a.prototype._onChartContainerRemoved=function(){this._chartContainer=null};a.prototype._initializeChart=function(){return b.__awaiter(this,void 0,void 0,function(){var a,c,d,e,h=this;return b.__generator(this,function(b){switch(b.label){case 0:this._destroyChart();a=this._chartContainer;
if(f.isNone(a))return[2];this._chartAbortController=c=k.createAbortController();b.label=1;case 1:return b.trys.push([1,3,,4]),d=this,[4,w.createChart({container:a,onCursorPositionChange:function(a,b){h.viewModel.hoveredChartPosition=a},abortOptions:{signal:c.signal}})];case 2:return d._chart=b.sent(),[3,4];case 3:e=b.sent();if(k.isAbortError(e))this._chartAbortController===c&&(this._chartAbortController=null);else throw e;return[3,4];case 4:return this._updateChart(),[2]}})})};a.prototype._destroyChart=
function(){f.isSome(this._chartAbortController)&&(this._chartAbortController.abort(),this._chartAbortController=null);f.isSome(this._chart)&&(this._chart.destroy(),this._chart=null)};b.__decorate([d.property({type:m}),e.renderable(["state","chartData","progress","updating"])],a.prototype,"viewModel",void 0);b.__decorate([d.aliasOf("viewModel.view"),e.renderable()],a.prototype,"view",void 0);b.__decorate([d.property(),e.renderable()],a.prototype,"visibleElements",void 0);b.__decorate([d.cast("visibleElements")],
a.prototype,"_castVisibleElements",null);b.__decorate([d.property()],a.prototype,"iconClass",void 0);b.__decorate([d.aliasOf("messages.widgetLabel",{overridable:!0})],a.prototype,"label",void 0);b.__decorate([d.property(),e.renderable(),e.messageBundle("esri/widgets/ElevationProfile/t9n/ElevationProfile")],a.prototype,"messages",void 0);b.__decorate([d.property(),e.renderable(),e.messageBundle("esri/t9n/common")],a.prototype,"messagesCommon",void 0);b.__decorate([d.property(),e.renderable(),e.messageBundle("esri/core/t9n/Units")],
a.prototype,"messagesUnits",void 0);b.__decorate([d.aliasOf("viewModel.path")],a.prototype,"path",void 0);b.__decorate([d.aliasOf("viewModel.profiles")],a.prototype,"profiles",void 0);b.__decorate([d.aliasOf("viewModel.unitOptions")],a.prototype,"unitOptions",void 0);b.__decorate([d.aliasOf("viewModel.unit")],a.prototype,"unit",void 0);b.__decorate([d.property()],a.prototype,"_chartContainer",void 0);b.__decorate([d.property()],a.prototype,"_chart",void 0);return a=b.__decorate([d.subclass("esri.widgets.ElevationProfile")],
a)}(u)});