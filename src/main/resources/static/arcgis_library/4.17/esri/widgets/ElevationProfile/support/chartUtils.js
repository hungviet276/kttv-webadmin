// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../intl ../../../core/arrayUtils ../../../core/events ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/unitFormatUtils ../../../core/unitUtils ../../support/chartUtils ../../support/widget".split(" "),function(J,n,q,t,r,u,z,k,A,w,l,B,C){function D(b){for(var c,d=0,a,f,e=0;e<b.length;e++){var g=b[e],h=g.samples,g=g.stats;if(!k.isNone(h)&&!k.isNone(g)){h=null===(c=r.last(h))||void 0===c?void 0:c.distance;void 0!==h&&h>d&&(d=h);if(void 0===
a||g.minElevation<a)a=g.minElevation;if(void 0===f||g.maxElevation>f)f=g.maxElevation}}void 0===a&&(a=0);void 0===f&&(f=0);return{minDistance:0,maxDistance:d,minElevation:a,maxElevation:f}}function E(b,c,d){var a=d.data,f=d.messages;d=c.amChart;var e=c.xAxis,g=c.yAxis;d.tooltip.hide();if(k.isNone(a)||0===a.lines.length)d.series.clear();else if(c.data=a,c.messages=f,e.title.text=t.substitute(f.elevationLabel,{units:f.units[a.distanceUnit].abbr}),e.min=a.minX,e.max=a.maxX,g.title.text=t.substitute(f.elevationLabel,
{units:f.units[a.elevationUnit].abbr}),c=a.maxY-a.minY,g.min=a.minY-.1*c,g.max=a.maxY+.2*c,r.equals(d.series.values,a.lines,function(a,b){return a.id+a.name===b.id+b.name}))d.series.each(function(c,d){var e=a.lines[d];d=e.name;var f=e.points,e=e.color.toRgba();c.stroke=b.am4core.color({r:e[0],g:e[1],b:e[2],a:e[3]});c.name=d;c.data=f});else for(d.series.clear(),c=0,g=a.lines;c<g.length;c++)d.series.push(F(b,g[c]))}function F(b,c){var d=b.am4core;b=new b.am4charts.LineSeries;b.id=c.id;b.name=c.name;
b.dataFields.valueX="x";b.dataFields.valueY="y";b.simplifiedProcessing=!0;b.connect=!1;b.showOnInit=!1;var a=c.color.toRgba();c=a[0];var f=a[1],e=a[2],a=a[3];b.stroke=d.color({r:c,g:f,b:e,a:a});b.fill=d.color({r:c,g:f,b:e,a:a});b.strokeWidth=1.5;b.fillOpacity=1;d=new d.LinearGradientModifier;d.opacities=[.3,0];d.offsets=[0,.3];d.gradient.rotation=90;b.segments.template.fillModifier=d;return b}function x(b,c){var d=b.amChart,a=b.xAxis,f=b.yAxis,e=d.cursor,g=e.events.on("cursorpositionchanged",function(){var b=
a.toAxisPosition(e.xPosition),d=f.toAxisPosition(e.yPosition);c(b,d)}),h=u.on(d.chartContainer.htmlContainer,["mouseleave","pointerleave"],function(){c(null,null)});return{remove:function(){g.dispose();h.remove()}}}function G(b){var c=b.amChart,d=b.xAxis,a=c.cursor.events.on("cursorpositionchanged",function(){var a=c.tooltip,e=H(b);k.isSome(e)?(a.text=e.text,a.pointTo(e.point,!0),a.show()):a.hide();a=d.tooltip;var e=b.data,g=b.messages;if(k.isNone(e)||k.isNone(g))e="";else var h=e.lines[0],h=h?y(b,
h):null,e=k.isSome(h)?w.formatDecimal(g,h.x,e.distanceUnit):"-";a.text=e;d.showTooltip()});return{remove:function(){return a.dispose()}}}function I(b){var c=b.amChart,d=b.xAxis;return u.on(c.chartContainer.htmlContainer,["mouseleave","pointerleave"],function(){c.tooltip.hide();d.hideTooltip()})}function H(b){var c=b.amChart,d=b.yAxis,a=b.data,f=b.messages;if(k.isNone(a)||k.isNone(f))return null;for(var e="",g=null,h=0;h<a.lines.length;h++){var p=k.applySome(y(b,a.lines[h]),function(a){return a.y}),
m=c.series.getIndex(h);if(m){var l=k.isSome(p)?w.formatDecimal(f,p,a.elevationUnit):"-",e=e+("["+m.stroke.hex+"]\u25cf[/] "+m.name+": "+l+"\n");k.isSome(p)&&(g=p)}}b=c.cursor;if(k.isNone(g))return null;a=d.measuredHeight;return{text:e,point:{x:b.point.x+b.parent.pixelX+c.pixelPaddingLeft,y:a+c.pixelPaddingTop-d.valueToPosition(g)*a-10}}}function y(b,c){var d=b.xAxis;c=c.points;if(0===c.length)return null;b=d.toAxisPosition(b.amChart.cursor.xPosition);d=d.xToValue(b);return r.binaryFindClosest(c,d,
function(a){return a.x})}Object.defineProperty(n,"__esModule",{value:!0});n.onCursorPositionChange=n.createChart=n.getChartData=void 0;n.getChartData=function(b,c,d){var a=D(b),f=a.minDistance,e=a.maxDistance,g=a.minElevation,a=a.maxElevation,h=l.getMetersPerUnitForSR(c),p=l.getMetersPerVerticalUnitForSR(c),f=f*h,e=e*h,g=g*p,a=a*p;c=l.preferredLengthUnit(e,"meters",d);var m=l.preferredVerticalLengthUnit(a,"meters",d);d=[];for(var n=0;n<b.length;n++){var v=b[n],q=[];if(!k.isNone(v.samples)){for(var r=
0,t=v.samples;r<t.length;r++){var u=t[r],w=u.z;q.push({x:l.convertUnit(u.distance*h,"meters",c),y:k.applySome(w,function(a){return l.convertUnit(a*p,"meters",m)})})}d.push({id:v.id,name:v.label,color:v.color,points:q})}}return{lines:d,distanceUnit:c,elevationUnit:m,minX:l.convertUnit(f,"meters",c),maxX:l.convertUnit(e,"meters",c),minY:l.convertUnit(g,"meters",m),maxY:l.convertUnit(a,"meters",m)}};n.createChart=function(b){return q.__awaiter(this,void 0,void 0,function(){var c,d,a,f,e,g,h,k,m,l;return q.__generator(this,
function(n){switch(n.label){case 0:return[4,B.loadChartsModule()];case 1:return c=n.sent(),A.throwIfAborted(b.abortOptions),d=c.am4core,a=c.am4charts,f=d.create(b.container,a.XYChart),f.rtl=C.isRTL(),f.padding(20,10,0,10),e=f.tooltip,e.pointerOrientation="down",e.getFillFromObject=!1,e.label.fill=d.color("#323232"),e.background.cornerRadius=0,e.background.stroke=null,e.background.fill=d.color("#ffffff"),g=f.xAxes.push(new a.ValueAxis),g.strictMinMax=!0,g.fontWeight="500",g.fontSize=10,g.renderer.labels.template.fontWeight=
"400",g.renderer.minGridDistance=50,h=f.yAxes.push(new a.ValueAxis),h.cursorTooltipEnabled=!1,h.strictMinMax=!0,h.fontWeight="500",h.fontSize=10,h.renderer.labels.template.fontWeight="400",h.renderer.minGridDistance=15,k=new a.XYCursor,k.trackable=!0,k.lineY.disabled=!0,f.cursor=k,m={amChart:f,xAxis:g,yAxis:h,data:null,messages:null},l=new z,l.add([x(m,b.onCursorPositionChange),G(m),I(m)]),[2,q.__assign(q.__assign({},m),{update:function(a){E(c,m,a)},destroy:function(){l.destroy();f.dispose()}})]}})})};
n.onCursorPositionChange=x});