// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../intl ../core/Collection ../core/HandleOwner ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./FeatureTable/FeatureTableViewModel ./FeatureTable/Grid/support/ButtonMenu ./FeatureTable/Grid/support/ButtonMenuItem ./support/widget".split(" "),function(v,w,d,l,p,q,h,c,r,t,u,k,e){var m={header:!0,menu:!0,menuItems:{clearSelection:!0,refreshData:!0,toggleColumns:!0}};return function(n){function a(b,a){b=n.call(this,b,a)||this;b._menu=null;b.attachmentsEnabled=
null;b.columns=new p;b.editingEnabled=null;b.fieldConfigs=null;b.grid=null;b.highlightOnRowSelectEnabled=!0;b.label=void 0;b.layer=null;b.messages=null;b.menuConfig=null;b.view=null;b.viewModel=new t;b.visibleElements=d.__assign({},m);return b}d.__extends(a,n);a.prototype.initialize=function(){var b=this,a,c,f,g=function(){return d.__awaiter(b,void 0,void 0,function(){var b;return d.__generator(this,function(a){switch(a.label){case 0:return b=this,[4,l.loadMessageBundle("esri/widgets/FeatureTable/t9n/FeatureTable")];
case 1:return[2,b.messages=a.sent()]}})})};g();this.handles.add([l.onLocaleChange(g),h.on(this,"grid.selectedItems","change",function(a){return b._onSelectionChange(a)}),h.watch(this,["viewModel.store.querying","viewModel.store.syncing","grid.size"],function(){return b.scheduleRender()}),h.on(this,"viewModel.columns","change",function(){return b._updateMenuItems()}),h.watch(this,"menuConfig",function(){return b._updateMenuItems()}),h.watch(this,"messages",function(){var a;b._menu.label=null===(a=
b.messages)||void 0===a?void 0:a.options;b._updateMenuItems()})]);this._menu=new u(d.__assign({label:null===(a=this.messages)||void 0===a?void 0:a.options,iconClass:"esri-icon-handle-horizontal"},this.menuConfig));a=this.attachmentsEnabled;g=this.relatedRecordsEnabled;null===(f=null===(c=this.viewModel)||void 0===c?void 0:c.store)||void 0===f?void 0:f.set({attachmentsEnabled:a,relatedRecordsEnabled:g})};a.prototype.destroy=function(){this.clearSelection();this.handles.removeAll()};a.prototype.castVisibleElements=
function(b){return d.__assign(d.__assign({},m),b)};a.prototype.clearHighlights=function(){};a.prototype.clearSelection=function(){};a.prototype.deselectRows=function(){};a.prototype.hideColumn=function(b){var a;null===(a=this.grid)||void 0===a?void 0:a.hideColumn(b);this._updateMenuItems()};a.prototype.refresh=function(){};a.prototype.showColumn=function(b){var a;null===(a=this.grid)||void 0===a?void 0:a.showColumn(b);this._updateMenuItems()};a.prototype.sortColumn=function(){};a.prototype.selectRows=
function(){};a.prototype.render=function(){var b;return e.tsx("div",{bind:this,class:this.classes("esri-feature-table","esri-widget")},this.visibleElements.header?this._renderHeader():null,e.tsx("div",{class:"esri-feature-table__content"},"disabled"!==this.state&&(null===(b=this.grid)||void 0===b?void 0:b.render())))};a.prototype._renderHeader=function(){return e.tsx("div",{key:"header",class:"esri-feature-table__header"},this._renderLoader(),this._renderTitle(),this._renderMenu())};a.prototype._renderTitle=
function(){return e.tsx("div",{class:"esri-feature-table__title",key:"title"},this._getTitle())};a.prototype._getTitle=function(){var b=this.grid;return b?l.substitute(this.messages.header,{title:this.layer.title,count:this.viewModel.size,selected:b.selectedItems.length||0}):""};a.prototype._renderLoader=function(){var b=this.viewModel,a=b.store;return e.tsx("div",{class:"esri-feature-table__loader-container"},"loading"===b.state||a.syncing||a.querying?e.tsx("div",{class:"esri-feature-table__loader",
key:"loader"}):null)};a.prototype._renderMenu=function(){return e.tsx("div",{class:"esri-feature-table__menu"},this._menu.render())};a.prototype._onSelectionChange=function(a){var b=a.removed;this.emit("selection-change",{added:d.__spreadArrays(a.added),removed:d.__spreadArrays(b)})};a.prototype._updateMenuItems=function(){var a,d,c=null===(a=this.menuConfig)||void 0===a?void 0:a.items;a=this._getDefaultMenuItems();var f=[];(null===a||void 0===a?0:a.length)&&f.push.apply(f,a);(null===c||void 0===
c?0:c.length)&&f.push.apply(f,c);f.length&&(null===(d=this._menu)||void 0===d?void 0:d.set("items",f))};a.prototype._getDefaultMenuItems=function(){var a=this,d,c=this.messages,f=this.viewModel,g=this.visibleElements.menuItems,e=[];(null===g||void 0===g?0:g.clearSelection)&&e.push(new k({selectionEnabled:!1,label:null===c||void 0===c?void 0:c.clearSelection,clickFunction:function(){return a.clearSelection()}}));(null===g||void 0===g?0:g.refreshData)&&e.push(new k({selectionEnabled:!1,label:null===
c||void 0===c?void 0:c.refreshData,clickFunction:function(){return a.refresh()}}));(null===g||void 0===g?0:g.toggleColumns)&&e.push(new k({iconClass:"esri-icon-right",label:null===c||void 0===c?void 0:c.toggleColumns,clickFunction:this._toggleMenuItemSelectedIcon,items:null===(d=null===f||void 0===f?void 0:f.columns)||void 0===d?void 0:d.items.map(function(b){var c=b.path;return new k({label:b.header||c,selected:!b.hidden,selectionEnabled:!0,iconClass:"esri-icon-check-mark",clickFunction:function(){return a._toggleColumnFromMenuItem(c)}})})}));
return e.length?e:null};a.prototype._toggleMenuItemSelectedIcon=function(a){a=a.item;null===a||void 0===a?void 0:a.set("iconClass",(null===a||void 0===a?0:a.selected)?"esri-icon-down":"esri-icon-right")};a.prototype._toggleColumnFromMenuItem=function(a){var b,c=null===(b=this.viewModel)||void 0===b?void 0:b.findColumn(a);(null===c||void 0===c?0:c.hidden)?this.showColumn(a):this.hideColumn(a)};d.__decorate([c.aliasOf("viewModel.attachmentsEnabled")],a.prototype,"attachmentsEnabled",void 0);d.__decorate([c.aliasOf("viewModel.columns")],
a.prototype,"columns",void 0);d.__decorate([c.aliasOf("viewModel.editingEnabled")],a.prototype,"editingEnabled",void 0);d.__decorate([c.aliasOf("viewModel.fieldConfigs")],a.prototype,"fieldConfigs",void 0);d.__decorate([c.aliasOf("viewModel.grid")],a.prototype,"grid",void 0);d.__decorate([c.aliasOf("viewModel.highlightOnRowSelectEnabled")],a.prototype,"highlightOnRowSelectEnabled",void 0);d.__decorate([c.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],a.prototype,"label",void 0);
d.__decorate([c.aliasOf("viewModel.layer")],a.prototype,"layer",void 0);d.__decorate([c.property(),e.renderable(),e.messageBundle("esri/widgets/FeatureTable/t9n/FeatureTable")],a.prototype,"messages",void 0);d.__decorate([c.property()],a.prototype,"menuConfig",void 0);d.__decorate([c.aliasOf("viewModel.relatedRecordsEnabled")],a.prototype,"relatedRecordsEnabled",void 0);d.__decorate([c.aliasOf("viewModel.state")],a.prototype,"state",void 0);d.__decorate([c.aliasOf("viewModel.view")],a.prototype,"view",
void 0);d.__decorate([c.property(),e.renderable("viewModel.attachmentsEnabled viewModel.columns viewModel.editingEnabled viewModel.layer viewModel.relatedRecordsEnabled viewModel.state".split(" "))],a.prototype,"viewModel",void 0);d.__decorate([c.property(),e.renderable()],a.prototype,"visibleElements",void 0);d.__decorate([c.cast("visibleElements")],a.prototype,"castVisibleElements",null);d.__decorate([c.aliasOf("viewModel.clearHighlights")],a.prototype,"clearHighlights",null);d.__decorate([c.aliasOf("viewModel.clearSelection")],
a.prototype,"clearSelection",null);d.__decorate([c.aliasOf("viewModel.deselectRows")],a.prototype,"deselectRows",null);d.__decorate([c.aliasOf("viewModel.refresh")],a.prototype,"refresh",null);d.__decorate([c.aliasOf("viewModel.sortColumn")],a.prototype,"sortColumn",null);d.__decorate([c.aliasOf("viewModel.selectRows")],a.prototype,"selectRows",null);return a=d.__decorate([c.subclass("esri.widgets.FeatureTable")],a)}(q.HandleOwnerMixin(r))});