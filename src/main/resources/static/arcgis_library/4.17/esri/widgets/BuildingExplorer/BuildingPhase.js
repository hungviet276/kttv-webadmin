// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/maybe ../../core/accessorSupport/decorators ./BuildingNumericFilterViewModel ./support/buildingLayerUtils ./support/filterUtils ./support/validation".split(" "),function(q,r,d,h,e,m,l,n,p){return function(k){function a(){var b=null!==k&&k.apply(this,arguments)||this;b._createdPhaseFieldName=null;b._demolishedPhaseFieldName=null;b._parseValueFromFilter=function(c){var a,f=b._createdPhaseFieldName,f=new RegExp(f+"\\s*\x3c\x3d\\s*(\\d+)\\s*OR\\s*"+f+"\\s*IS\\s*NULL",
"gi"),g=b._demolishedPhaseFieldName,g=new RegExp(g+"\\s*\x3e\\s*(\\d+)\\s*OR\\s*"+g+"\\s*IS\\s*NULL","gi"),d=0;for(c=c.filterBlocks.items;d<c.length;d++){var e=c[d].filterExpression;if(e=null!==(a=f.exec(e))&&void 0!==a?a:g.exec(e))return parseInt(e[1],10)}return null};return b}d.__extends(a,k);Object.defineProperty(a.prototype,"filterExpressions",{get:function(){if(!this.enabled)return{solid:null,xRay:null};var b=[],c=this._createdPhaseFieldName;c&&b.push("("+c+" \x3c\x3d "+this.value+" OR "+c+" IS NULL)");
(c=this._demolishedPhaseFieldName)&&b.push("("+c+" \x3e "+this.value+" OR "+c+" IS NULL)");b=b.join(" AND ");return{solid:b,xRay:b}},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"_lastValue",{get:function(){var b=this.allowedValues;return 0<b.length?b[b.length-1]:0},enumerable:!1,configurable:!0});a.prototype._setup=function(){var b=this,c=[];this.layers.forEach(function(a){var d=l.findFieldInfoByModelName(a,"createdphase");h.isSome(d)&&(b._createdPhaseFieldName=d.fieldName,c.push(d));
a=l.findFieldInfoByModelName(a,"demolishedphase");h.isSome(a)&&(b._demolishedPhaseFieldName=a.fieldName,c.push(a))});this._domainInfo=p.getDomainInfo(c);var a=n.getValueFromFilters(this.layers,this._parseValueFromFilter);0<this.allowedValues.length?this.select(h.isSome(a)?a:this._lastValue):this.clear()};d.__decorate([e.property({readOnly:!0,dependsOn:["enabled","value","_createdPhaseFieldName","_demolishedPhaseFieldName"]})],a.prototype,"filterExpressions",null);d.__decorate([e.property()],a.prototype,
"_createdPhaseFieldName",void 0);d.__decorate([e.property()],a.prototype,"_demolishedPhaseFieldName",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:["allowedValues.length"]})],a.prototype,"_lastValue",null);return a=d.__decorate([e.subclass("esri.widgets.BuildingExplorer.BuildingPhase")],a)}(m)});