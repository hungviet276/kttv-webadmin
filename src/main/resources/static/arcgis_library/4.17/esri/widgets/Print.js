// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/Collection ../core/events ../core/Logger ../core/urlUtils ../core/watchUtils ../core/accessorSupport/decorators ../tasks/support/PrintTemplate ./Widget ./Print/FileLink ./Print/PrintViewModel ./Print/TemplateOptions ./support/widget".split(" "),function(J,K,g,D,E,F,x,l,h,G,H,y,z,A,a){var B=D.ofType(y),n=F.getLogger("esri.widgets.Print");return function(C){function d(c,a){var b=C.call(this,c,a)||this;b._activeTabFocusRequested=!1;b._advancedOptionsVisibleForLayout=
!1;b._advancedOptionsVisibleForMapOnly=!1;b._awaitingServerResponse=!1;b._exportedFileNameMap={};b._layoutTabSelected=!0;b._pendingExportScroll=!1;b._rootNode=null;b.allowedFormats=null;b.allowedLayouts=null;b.exportedLinks=new B;b.iconClass="esri-icon-printer";b.label=void 0;b.templateOptions=new A;b.printServiceUrl=null;b.view=null;b.viewModel=new z;b._removeLink=function(c){(c=c.currentTarget["data-item"])&&"error"===c.state&&b.exportedLinks.remove(c)};b._focusOnTabChange=b._focusOnTabChange.bind(b);
return b}g.__extends(d,C);d.prototype.initialize=function(){var c=this;this.own([l.init(this,"viewModel.templatesInfo",function(b){var a=c.templateOptions,e=a.format,a=a.layout;if(b){var d=a===b.layout.defaultValue||a&&"MAP_ONLY"===a.toUpperCase()||b.layout.choiceList&&-1<b.layout.choiceList.indexOf(a),I=e===b.format.defaultValue||b.format.choiceList&&-1<b.format.choiceList.indexOf(e);d||(a&&n.warn("User sets an invalid layout, resetting it to the default valid one..."),c.templateOptions.layout=b.layout.defaultValue);
I||(e&&n.warn("User sets an invalid format, resetting it to the default valid one..."),c.templateOptions.format=b.format.defaultValue);a&&"MAP_ONLY"===a.toUpperCase()&&(c._layoutTabSelected=!1)}}),l.init(this,"templateOptions.format",function(b){var a=c.viewModel.templatesInfo;if(a&&b){var e=!1;a.format.choiceList&&a.format.choiceList.forEach(function(a){a.toUpperCase()===b.toUpperCase()&&(c.templateOptions.format=a,e=!0)});e||(c.templateOptions.format=a.format.defaultValue,n.warn("User sets an invalid format, resetting it to the default valid one..."));
c.scheduleRender()}}),l.init(this,"templateOptions.layout",function(b){var a=c.viewModel.templatesInfo;if(a&&b){c._layoutTabSelected="MAP_ONLY"!==b.toUpperCase();var e=!c._layoutTabSelected;e||a.layout.choiceList&&a.layout.choiceList.forEach(function(a){a.toUpperCase()===b.toUpperCase()&&(c.templateOptions.layout=a,e=!0)});e||(c.templateOptions.layout=a.layout.defaultValue,n.warn("User sets an invalid layout, resetting it to the default valid one..."));c.scheduleRender()}}),l.init(this,"templateOptions.dpi",
function(b){0>=b?c.templateOptions.dpi=1:c.scheduleRender()}),l.init(this,"viewModel.view.scale",function(b){var a=c.templateOptions,e=a.scale;a.scaleEnabled&&e||(c.templateOptions.scale=b)}),l.whenOnce(this,"printServiceUrl",function(){var b=setTimeout(function(){c._awaitingServerResponse=!0;c.scheduleRender()},500);c.viewModel.load().then(function(){return clearTimeout(b)})})]);var b=this.templateOptions,a=b.height;this.templateOptions.width=b.width||800;this.templateOptions.height=a||1100};d.prototype.render=
function(){var c,b=this.templateOptions,d=b.attributionEnabled,e=b.author,v=b.copyright,w=b.dpi,g=b.format,h=b.height,m=b.layout,l=b.legendEnabled,k=b.scaleEnabled,p=b.scale,q=b.width,b="ready"!==this.get("viewModel.state"),t=this.renderTitleOrFileNameSection(),f=this.messages,r=this.get("viewModel.templatesInfo.format.choiceList")||[],r=0<r.length?r.map(function(b){return a.tsx("option",{key:b,selected:b===g,value:b},b.toUpperCase())}):a.tsx("option",{key:"format-default-option"},f.formatDefaultOption),
r=a.tsx("div",{class:"esri-print__form-section-container"},a.tsx("label",null,f.fileFormatTitle,a.tsx("select",{class:"esri-select",onchange:this._updateFromOption,"data-target-property":"format",bind:this},r))),u=this.get("viewModel.templatesInfo.layout.choiceList")||[],u=0<u.length?u.map(function(b){return a.tsx("option",{key:b,selected:b===m,value:b},f[b]||b)}):a.tsx("option",{key:"layout-default-option"},f.layoutDefaultOption),u=a.tsx("div",{class:"esri-print__form-section-container"},a.tsx("label",
null,f.layoutTitle,a.tsx("select",{class:"esri-select",onchange:this._updateFromOption,"data-target-property":"layout",bind:this},u))),w=a.tsx("div",{class:"esri-print__form-section-container"},a.tsx("label",null,f.dpi,a.tsx("input",{type:"number",class:this.classes("esri-print__input-text","esri-input"),"data-input-name":"dpi",onchange:this._handleDPIChange,value:""+w,min:"1",tabIndex:0,bind:this}))),k=a.tsx("div",{class:this.classes("esri-print__scale-info-container","esri-print__form-section-container")},
a.tsx("label",null,a.tsx("input",{"data-option-name":"scaleEnabled",checked:k,type:"checkbox",tabIndex:0,onchange:this._toggleInputValue,bind:this}),f.scale),a.tsx("div",{class:"esri-print__scale-input-container"},a.tsx("input",{"aria-label":f.scaleLabel,"aria-valuenow":""+p,role:"spinbutton",type:"number",class:this.classes("esri-print__input-text","esri-input","esri-print__scale-input"),tabIndex:0,"data-input-name":"scale",onchange:this._updateInputValue,disabled:!k,value:""+p,bind:this}),a.tsx("button",
{type:"button","aria-label":f.reset,class:this.classes("esri-widget--button","esri-print__refresh-button","esri-icon-refresh"),tabIndex:0,onclick:this._resetToCurrentScale,bind:this}))),e=this._advancedOptionsVisibleForLayout?a.tsx("div",{"aria-labelledby":this.id+"__advancedOptionsForLayout",class:"esri-print__advanced-options-container"},k,a.tsx("div",{class:this.classes("esri-print__author-info-container","esri-print__form-section-container")},a.tsx("label",null,f.author,a.tsx("input",{type:"text",
value:e,class:this.classes("esri-print__input-text","esri-input"),tabIndex:0,"data-input-name":"author",onchange:this._updateInputValue,bind:this}))),a.tsx("div",{class:this.classes("esri-print__copyright-info-container","esri-print__form-section-container")},a.tsx("label",null,f.copyright,a.tsx("input",{type:"text",class:this.classes("esri-print__input-text","esri-input"),tabIndex:0,value:v,"data-input-name":"copyright",onchange:this._updateInputValue,bind:this}))),w,a.tsx("div",{class:this.classes("esri-print__legend-info-container",
"esri-print__form-section-container")},a.tsx("label",null,a.tsx("input",{type:"checkbox","data-option-name":"legendEnabled",tabIndex:0,checked:l,onchange:this._toggleInputValue,bind:this}),f.legend))):null,d=this._advancedOptionsVisibleForMapOnly?a.tsx("div",{"aria-labelledby":this.id+"__advancedOptionsForMapOnly",class:"esri-print__advanced-options-container"},k,w,a.tsx("div",{class:"esri-print__form-section-container"},a.tsx("label",null,a.tsx("input",{"data-option-name":"attributionEnabled",type:"checkbox",
onchange:this._toggleInputValue,tabIndex:0,checked:d,bind:this}),f.attribution))):null,h=this._layoutTabSelected?a.tsx("section",{key:"esri-print__layoutContent",id:this.id+"__layoutContent","aria-labelledby":this.id+"__layoutTab",class:"esri-print__layout-section",role:"tabpanel","aria-selected":this._layoutTabSelected},a.tsx("div",{class:"esri-print__panel-container"},t,u,this._layoutTabSelected?r:null),a.tsx("div",{class:this.classes("esri-print__panel-container","esri-print__advanced-options-section")},
a.tsx("button",{"aria-label":f.advancedOptions,"aria-expanded":this._advancedOptionsVisibleForLayout?"true":"false",class:"esri-print__advanced-options-button",onclick:this._showAdvancedOptions,bind:this,type:"button"},a.tsx("div",{class:"esri-print__advanced-options-button-container"},a.tsx("span",{"aria-hidden":"true",class:this.classes("esri-icon-right-triangle-arrow","esri-print__advanced-options-button-icon--closed")}),a.tsx("span",{"aria-hidden":"true",class:this.classes("esri-icon-left-triangle-arrow",
"esri-print__advanced-options-button-icon--closed-rtl")}),a.tsx("span",{"aria-hidden":"true",class:this.classes("esri-icon-down-arrow","esri-print__advanced-options-button-icon--opened")}),a.tsx("span",{class:"esri-print__advanced-options-button-title"},f.advancedOptions))),e)):a.tsx("section",{key:"esri-print__mapOnlyContent",id:this.id+"__mapOnlyContent","aria-selected":!this._layoutTabSelected,"aria-labelledby":this.id+"__mapOnlyTab",class:"esri-print__map-only-section",role:"tabpanel"},a.tsx("div",
{class:"esri-print__panel-container"},t,this._layoutTabSelected?null:r,a.tsx("div",{class:this.classes("esri-print__size-container","esri-print__form-section-container")},a.tsx("div",{class:"esri-print__width-container"},a.tsx("label",null,f.width,a.tsx("input",{type:"number",class:this.classes("esri-print__input-text","esri-input"),"data-input-name":"width",onchange:this._updateInputValue,value:""+q,tabIndex:0,bind:this}))),a.tsx("div",{class:"esri-print__height-container"},a.tsx("label",null,f.height,
a.tsx("input",{type:"number",class:this.classes("esri-print__input-text","esri-input"),"data-input-name":"height",onchange:this._updateInputValue,value:""+h,tabIndex:0,bind:this}))),a.tsx("button",{type:"button","aria-label":f.swap,class:this.classes("esri-widget--button","esri-print__swap-button","esri-icon-swap"),onclick:this._switchInput,tabIndex:0,bind:this})),a.tsx("div",{class:this.classes("esri-print__panel-container","esri-print__advanced-options-section")},a.tsx("button",{"aria-label":f.advancedOptions,
"aria-expanded":this._advancedOptionsVisibleForMapOnly?"true":"false",type:"button",class:"esri-print__advanced-options-button",onclick:this._showAdvancedOptions,bind:this},a.tsx("div",{class:"esri-print__advanced-options-button-container"},a.tsx("span",{"aria-hidden":"true",class:this.classes("esri-icon-right-triangle-arrow","esri-print__advanced-options-button-icon--closed")}),a.tsx("span",{"aria-hidden":"true",class:this.classes("esri-icon-left-triangle-arrow","esri-print__advanced-options-button-icon--closed-rtl")}),
a.tsx("span",{"aria-hidden":"true",class:this.classes("esri-icon-down-arrow","esri-print__advanced-options-button-icon--opened")}),a.tsx("span",{class:"esri-print__advanced-options-button-title"},f.advancedOptions))),d))),d=this.exportedLinks.toArray(),q=this._renderExportedLink(d),t=(c={},c["esri-button--disabled"]=b||!m&&!g,c);c=null!=this.get("view")&&"2d"!==this.get("view.type");e=a.tsx("div",{class:"esri-print__panel--error"},c?f.sceneViewError:f.serviceError);b=a.tsx("div",null,a.tsx("ul",{class:"esri-print__layout-tab-list",
role:"tablist",onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,bind:this},a.tsx("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,id:this.id+"__layoutTab","data-tab-id":"layoutTab",class:"esri-print__layout-tab",role:"tab",tabIndex:0,"aria-selected":""+this._layoutTabSelected},f.layoutTab),a.tsx("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,id:this.id+"__mapOnlyTab","data-tab-id":"mapOnlyTab",class:"esri-print__layout-tab",
role:"tab",tabIndex:0,"aria-selected":""+!this._layoutTabSelected},f.mapOnlyTab)),h,a.tsx("button",{"aria-label":f.exportDescription,type:"button",class:this.classes("esri-print__export-button","esri-button",t),disabled:b,tabIndex:0,onclick:this._handlePrintMap,bind:this},f.export),a.tsx("div",{class:"esri-print__export-panel-container",afterUpdate:this._scrollExportIntoView,bind:this},a.tsx("h3",{class:this.classes("esri-print__export-title","esri-widget__heading")},f.exportText),0<d.length?null:
a.tsx("div",null,a.tsx("div",null,f.exportHint)),q));b=a.tsx("div",null,a.tsx("div",{class:"esri-print__container"},a.tsx("header",{class:"esri-print__header-title"},f.export),this.error||!this.printServiceUrl||c||!this.view?e:b));b="initializing"===this.get("viewModel.state")?this._renderLoader():b;return a.tsx("div",{afterCreate:a.storeNode,bind:this,class:"esri-print esri-widget esri-widget--panel","data-node-ref":"_rootNode"},b)};d.prototype.renderTitleOrFileNameSection=function(){var c=this.templateOptions,
b=this.messages,d,e;this._layoutTabSelected?(d=b.title,b=b.titlePlaceHolder,c=c.title,e="title"):(d=b.fileName,b=b.fileNamePlaceHolder,c=c.fileName,e="fileName");return a.tsx("div",{class:"esri-print__form-section-container",key:e},a.tsx("label",null,d,a.tsx("input",{type:"text",tabIndex:0,placeholder:b,class:this.classes("esri-print__input-text","esri-input"),value:c,"data-input-name":e,onchange:this._updateInputValue,bind:this})))};d.prototype._focusOnTabChange=function(a){if(this._activeTabFocusRequested){var b=
a.getAttribute("data-tab-id");if("layoutTab"===b&&this._layoutTabSelected||"mapOnlyTab"===b&&!this._layoutTabSelected)a.focus(),this._activeTabFocusRequested=!1}};d.prototype._renderLoader=function(){var c,b=(c={},c["esri-print__loader"]=this._awaitingServerResponse,c);return a.tsx("div",{class:this.classes(b),key:"loader"})};d.prototype._createFileLink=function(a,b){b=b||this.messages.untitled;a=a.format.toLowerCase();a=-1<a.indexOf("png")?"png":a;var c=b+a;void 0!==this._exportedFileNameMap[c]?
this._exportedFileNameMap[c]++:this._exportedFileNameMap[c]=0;return new y({name:b,extension:a,count:this._exportedFileNameMap[c]})};d.prototype._toPrintTemplate=function(a){var b=a.dpi,c=a.height,d=a.legendEnabled,v=a.width;a=new G({attributionVisible:a.attributionEnabled,layoutOptions:{authorText:a.author||"",copyrightText:a.copyright||"",titleText:a.title||""},forceFeatureAttributes:a.forceFeatureAttributes,format:a.format,layout:a.layout,outScale:a.scale});v&&(a.exportOptions.width=v);c&&(a.exportOptions.height=
c);b&&(a.exportOptions.dpi=b);d||(a.layoutOptions.legendLayers=[]);return a};d.prototype._resetToCurrentScale=function(){this.templateOptions.scale=this.viewModel.view.scale};d.prototype._updateInputValue=function(a){a=a.target;var b=a.getAttribute("data-input-name");this.templateOptions[b]=a.value};d.prototype._handleDPIChange=function(a){this._updateInputValue(a);var b=a.currentTarget.valueAsNumber;a=Math.round(8.3333*b);var c=this.templateOptions;c.height=Math.round(11.4583*b);c.width=a};d.prototype._handlePrintMap=
function(){var a=this;this._pendingExportScroll=!0;var b=this.templateOptions,d=this._toPrintTemplate(b),e=this._createFileLink(d,this._layoutTabSelected?d.layoutOptions.titleText:b.fileName);this.exportedLinks.add(e);this.emit("submit",{link:e});this.viewModel.print(d).then(function(a){e.set({url:a&&a.url,state:"ready"})}).catch(function(a){e.set({error:a,state:"error"})}).then(function(){a.emit("complete",{link:e});a.scheduleRender()})};d.prototype._updateFromOption=function(a){var b=a.target;a=
b.selectedOptions?b.selectedOptions.item(0).value:b.options[b.selectedIndex].value;b=b.getAttribute("data-target-property");this.templateOptions[b]=a};d.prototype._switchInput=function(){var a;a=[this.templateOptions.height,this.templateOptions.width];this.templateOptions.width=a[0];this.templateOptions.height=a[1]};d.prototype._showAdvancedOptions=function(){this._layoutTabSelected?this._advancedOptionsVisibleForLayout=!this._advancedOptionsVisibleForLayout:this._advancedOptionsVisibleForMapOnly=
!this._advancedOptionsVisibleForMapOnly};d.prototype._scrollExportIntoView=function(){if(this._pendingExportScroll){this._pendingExportScroll=!1;var a=this._rootNode,b=this._rootNode,b=b.scrollHeight-b.clientHeight;0<b&&(a.scrollTop=b)}};d.prototype._toggleInputValue=function(a){a=a.target;var b=a.getAttribute("data-option-name");this.templateOptions[b]=a.checked;"scaleEnabled"===b&&(this.viewModel.scaleEnabled=this.templateOptions.scaleEnabled,this.templateOptions[b]||this._resetToCurrentScale())};
d.prototype._renderExportedLink=function(c){var b=this,d=this.messages;return c.map(function(c){var e,g,h,l=c.error,m=c.url,n=c.formattedName,k=c.state,p="error"===k,q="pending"===k,k="ready"===k,t=(e={},e["esri-widget__anchor--disabled"]=q||p,e);(e=m||null)&&(e=x.addProxy(e));m=x.hasSameOrigin(m,location.href);m=(g={},g["esri-icon-loading-indicator"]=q,g["esri-rotating"]=q,g["esri-icon-download"]=m&&k,g["esri-icon-launch-link-external"]=!m&&k,g["esri-icon-error"]=p,g["esri-print__exported-file--error"]=
p,g);g=(h={},h["esri-print__exported-file--error"]=p,h);return a.tsx("div",{"aria-label":q?d.pending:k?d.ready:d.errorMessage,class:"esri-print__exported-file","data-item":c,key:n,onclick:b._removeLink,title:p?l.message:""},a.tsx("a",{"aria-label":n+". "+d.linkReady,download:n,href:e,rel:"noreferrer",tabIndex:0,target:"_blank",class:b.classes("esri-widget__anchor esri-print__exported-file-link",t)},a.tsx("span",{class:b.classes(m)}),a.tsx("span",{class:b.classes("esri-print__exported-file-link-title",
g)},n)))})};d.prototype._toggleLayoutPanel=function(a){this._toggleTab(a.target.getAttribute("data-tab-id"))};d.prototype._toggleTab=function(a){(this._layoutTabSelected="layoutTab"===a)?(a=this.get("viewModel.templatesInfo.layout.choiceList"),this.templateOptions.layout=a&&a[0]):this.templateOptions.layout="MAP_ONLY";this._activeTabFocusRequested=!0};d.prototype._handleLayoutPanelKeyDown=function(a){var b=E.eventKey(a),c=a.target.getAttribute("data-tab-id");if("Enter"===b||" "===b)this._toggleTab(c),
a.preventDefault(),a.stopPropagation();else if("ArrowLeft"===b||"ArrowRight"===b)this._toggleTab("layoutTab"===c?"mapOnlyTab":"layoutTab"),a.preventDefault(),a.stopPropagation()};g.__decorate([h.aliasOf("viewModel.allowedFormats")],d.prototype,"allowedFormats",void 0);g.__decorate([h.aliasOf("viewModel.allowedLayouts")],d.prototype,"allowedLayouts",void 0);g.__decorate([h.aliasOf("viewModel.error")],d.prototype,"error",void 0);g.__decorate([h.property({type:B}),a.renderable()],d.prototype,"exportedLinks",
void 0);g.__decorate([h.property()],d.prototype,"iconClass",void 0);g.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],d.prototype,"label",void 0);g.__decorate([h.property(),a.renderable(),a.messageBundle("esri/widgets/Print/t9n/Print")],d.prototype,"messages",void 0);g.__decorate([a.renderable(),h.property({type:A})],d.prototype,"templateOptions",void 0);g.__decorate([h.aliasOf("viewModel.printServiceUrl")],d.prototype,"printServiceUrl",void 0);g.__decorate([h.aliasOf("viewModel.view"),
a.renderable()],d.prototype,"view",void 0);g.__decorate([h.property({type:z}),a.renderable(["viewModel.templatesInfo","viewModel.state"])],d.prototype,"viewModel",void 0);return d=g.__decorate([h.subclass("esri.widgets.Print")],d)}(H)});