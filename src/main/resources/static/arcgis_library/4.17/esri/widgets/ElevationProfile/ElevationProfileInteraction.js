// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.17/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../Graphic ../../core/Accessor ../../core/Handles ../../core/maybe ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/GraphicsLayer ../../symbols/LineSymbol3D ../Sketch/SketchViewModel".split(" "),function(u,v,d,m,n,p,g,h,e,q,r,t){function k(){return new r({symbolLayers:[{type:"line",size:"3px",material:{color:[1,120,193,1]},cap:"round",join:"round"}]})}function l(c){return void 0!==c&&g.isSome(c)&&"polyline"===c.type?c:null}return function(c){function a(b){b=
c.call(this,b)||this;b.state="ready";b._handles=new p;b._prevPath=null;return b}d.__extends(a,c);a.prototype.initialize=function(){var b=this,a=this.parentViewModel.view;this._graphicsLayer=new q({listMode:"hide",elevationInfo:{mode:"on-the-ground",offset:0}});this._sketchVM=new t({layer:this._graphicsLayer,view:a,defaultCreateOptions:{mode:"click",hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMidpoints:!0,enableRotation:!1,enableScaling:!1,enableMoveAllGraphics:!1,enableZ:!1,multipleSelectionEnabled:!1,
toggleToolOnClick:!0,tool:"reshape"},polylineSymbol:k()});this._handles.add([h.init(this.parentViewModel,"path",function(a){return b._onPathChange(a)},!0),h.init(a,"map",function(a){return a.add(b._graphicsLayer)}),this._sketchVM.on("create",function(a){return b._onSketchViewModelCreate(a)}),this._sketchVM.on("update",function(a){return b._onSketchViewModelUpdate(a)})])};a.prototype.destroy=function(){var a,f;this._handles.destroy();null===(f=null===(a=this.parentViewModel.view)||void 0===a?void 0:
a.map)||void 0===f?void 0:f.remove(this._graphicsLayer);this._graphicsLayer.destroyed||(this._graphicsLayer.graphics.drain(function(a){return a.destroy()}),this._graphicsLayer.destroy());this._sketchVM.destroy()};Object.defineProperty(a.prototype,"_path",{get:function(){return this.parentViewModel.path},set:function(a){this.parentViewModel.path=a},enumerable:!1,configurable:!0});a.prototype.start=function(){this.cancel();this._set("state","creating");this._prevPath=this._path;this._path=null;this._updatePathGraphic();
this._sketchVM.create("polyline")};a.prototype.stop=function(){"creating"===this.state&&(this._sketchVM.complete(),this._afterInteraction())};a.prototype.cancel=function(){"creating"===this.state&&(this._sketchVM.cancel(),this._path=this._prevPath,this._afterInteraction())};a.prototype.clear=function(){this._sketchVM.cancel();this._set("state","ready");this._path=this._prevPath=null};a.prototype._afterInteraction=function(){this._prevPath=null;this._set("state",this._path?"created":"ready");this._updatePathGraphic()};
a.prototype._onPathChange=function(a){switch(this.state){case "ready":a&&this._set("state","created");this._updatePathGraphic();break;case "created":a||(this._set("state","ready"),this._updatePathGraphic())}};a.prototype._updatePathGraphic=function(){this._graphicsLayer.removeAll();var a=this._path;g.isSome(a)&&(this._graphicsLayer.add(new m({geometry:a,symbol:k()})),this._graphicsLayer.visible=!0,this._sketchVM.update(this._graphicsLayer.graphics.items,{tool:"reshape"}))};a.prototype._onSketchViewModelCreate=
function(a){var b;if("polyline"===a.tool)switch(a.state){case "complete":case "cancel":this._afterInteraction();break;default:this._path=l(null===(b=a.graphic)||void 0===b?void 0:b.geometry)}};a.prototype._onSketchViewModelUpdate=function(a){var b;switch(a.state){case "complete":this._updatePathGraphic();break;default:this._path=l(null===(b=a.graphics[0])||void 0===b?void 0:b.geometry)}};d.__decorate([e.property({nonNullable:!0})],a.prototype,"state",void 0);d.__decorate([e.property({nonNullable:!0})],
a.prototype,"parentViewModel",void 0);d.__decorate([e.property()],a.prototype,"_prevPath",void 0);d.__decorate([e.property({dependsOn:["parentViewModel.path"]})],a.prototype,"_path",null);return a=d.__decorate([e.subclass("esri.widgets.ElevationProfile.ElevationProfileInteraction")],a)}(n)});